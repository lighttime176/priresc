(()=>{var cD=Object.create;var jb=Object.defineProperty;var hD=Object.getOwnPropertyDescriptor;var dD=Object.getOwnPropertyNames;var fD=Object.getPrototypeOf,pD=Object.prototype.hasOwnProperty;var mo=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var G=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var mD=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of dD(e))!pD.call(r,i)&&i!==t&&jb(r,i,{get:()=>e[i],enumerable:!(n=hD(e,i))||n.enumerable});return r};var Yi=(r,e,t)=>(t=r!=null?cD(fD(r)):{},mD(e||!r||!r.__esModule?jb(t,"default",{value:r,enumerable:!0}):t,r));var gu=G((p3e,sw)=>{"use strict";var xg=Object.defineProperty,KF=Object.getOwnPropertyDescriptor,QF=Object.getOwnPropertyNames,JF=Object.prototype.hasOwnProperty,e8=(r,e)=>{for(var t in e)xg(r,t,{get:e[t],enumerable:!0})},t8=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of QF(e))!JF.call(r,i)&&i!==t&&xg(r,i,{get:()=>e[i],enumerable:!(n=KF(e,i))||n.enumerable});return r},r8=r=>t8(xg({},"__esModule",{value:!0}),r),Hv={};e8(Hv,{BroadcastChannelMessageBus:()=>E8,MessageBus:()=>m8,MessageBus2:()=>v8,WindowMessageBridge:()=>p8,WorkerMessageBridge:()=>f8}),sw.exports=r8(Hv);var Td=new Error("list is empty"),Cd=class{constructor(r,e){this.prev=null,this.next=null,this.parent=r,this.item=e}insertAfter(r){r.next=this.next,this.next=r,r.prev=this,r.next!==null&&(r.next.prev=r)}insertBefore(r){r.prev=this.prev,this.prev=r,r.next=this,r.prev!==null&&(r.prev.next=r)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(r){this.item=r}},n8=class{constructor(r){this._next=r}hasNext(){return this._next!==null}next(){let r=this._next;if(r!==null)return this._next=r.next,r.item;throw new Error("iterator is null")}},i8=class{constructor(r){this._next=r}hasNext(){return this._next!==null}next(){let r=this._next;if(r!==null)return this._next=r.next,r;throw new Error("iterator is null")}},s8=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(r){return this.addLast(r)}push(r){return this.addLast(r)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let r=this.first;if(r===null)throw Td;return this.remove(r),r.item}removeLast(){let r=this.last;if(r===null)throw Td;return this.remove(r),r.item}addLast(r){if(this.first===null||this.last===null){let e=new Cd(this,r);return this.first=e,this.last=e,this.cnt++,e}else return this.insertAfter(this.last,r)}addFirst(r){if(this.first===null||this.last===null){let e=new Cd(this,r);return this.first=e,this.last=e,this.cnt++,e}else return this.insertBefore(this.first,r)}getFirst(){if(this.first===null)throw Td;return this.first.item}getLast(){if(this.last===null)throw Td;return this.last.item}insertAfter(r,e){let t=new Cd(this,e);return r.insertAfter(t),r===this.last&&(this.last=t),this.cnt++,t}insertBefore(r,e){let t=new Cd(this,e);return r.insertBefore(t),r===this.first&&(this.first=t),this.cnt++,t}remove(r){r.remove(),r===this.first&&(this.first=r.next),r===this.last&&(this.last=r.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new n8(this.first)}listIterator(){return new i8(this.first)}toArray(){let r=new Array,e=this.first;for(;e!=null;)r.push(e.item),e=e.next;return r}},bg=new ArrayBuffer(8),yg=new Float64Array(bg),vg=new Uint32Array(bg),Zv=new Uint16Array(bg),wg=ArrayBuffer;try{wg=self.HTMLImageElement||wg}catch{}function Md(r){if(typeof r!="object"||r===null||r instanceof Date||r instanceof ArrayBuffer||r instanceof Blob||r instanceof FormData||r instanceof Function||r instanceof Uint8ClampedArray||r instanceof wg)return r;if(Array.isArray(r))return r.map(Md);{let e={};for(let t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=Md(r[t]));return e}}function Eg(r,e){return o8(r,e,()=>[])}function o8(r,e,t){let n=r[e];return n!==void 0||(n=t(e),r[e]=n),n}function n3e(r,e){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(e(void 0,r[t],t)===!1)return}else{let t=0;for(let n in r)if(r.hasOwnProperty(n)){let i=r[n];if(e(n,i,t)===!1)return;t++}}}var a8=Object.prototype.hasOwnProperty;async function i3e(r,e){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(await e(void 0,r[t],t)===!1)return}else{let t=0;for(let n in r)if(a8.call(r,n)){let i=r[n];if(await e(n,i,t)===!1)return;t++}}}function s3e(r,e,t){return typeof r=="string"&&(/https?:/.test(r)||(r=location.origin+r)),Promise.race([fetch(r,e),new Promise((n,i)=>setTimeout(i,t))])}function o3e(r,e){let t=0,n=0;return(...i)=>{let s=++t;setTimeout(()=>{let o=performance.now();if(s===t||o-n>=r){try{e(...i)}catch(a){console.log(a)}n=o}},Math.max(0,r-(performance.now()-n)))}}function a3e(r,e){let t=r.length,n=0;for(;n<t;){let i=r.indexOf(`
`,n);i<0&&(i=t);let s=r.substring(n,i);try{if(e(s)===!1)return}catch(o){console.error(o)}n=i+1}}function l3e(r){let e=null;return()=>(e===null&&(e=r()),e)}var _g=0;function u3e(){_g===0&&(_g=Date.now()-performance.now());let r=new Array,e=_g+performance.now();yg[0]=e,r.push(vg[1].toString(16)),yg[0]=Math.random(),r.push(Zv[3].toString(16));let t=Zv[2].toString(16);r.push("4"+t.substr(0,3)),yg[0]=e;let n=vg[0].toString(16)+vg[1].toString(16);return r.push("0"+n.substr(0,3)),r.push(n.substr(3)),r.join("-")}var c3e=class{constructor(r){this.resources=r,this.idle=[]}acquire(r){this.resources>0?(this.resources--,r()):this.idle.push(r)}acquireSync(){return new Promise(r=>{this.acquire(r)})}release(){let r=this.idle.shift();r?r():this.resources++}};function l8(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function h3e(r,e,t){let n=r.length+e-1;for(let i=0;i<n;i++){let s=new Array;for(let o=i-e+1;o<=i;o++)s.push(r[o]);if(t(s)===!1)break}}function d3e(){let r=new Date,e=r.getFullYear(),t=r.getMonth()+1,n=r.getDate(),i=r.getHours(),s=r.getMinutes(),o=r.getSeconds(),a=r.getMilliseconds();return"["+e+"-"+(t<10?"0"+t:t)+"-"+(n<10?"0"+n:n)+" "+(i<10?"0"+i:i)+":"+(s<10?"0"+s:s)+":"+(o<10?"0"+o:o)+"."+(a<100?a<10?"00"+a:"0"+a:a)+"] "}async function f3e(r){let e=typeof r=="string"?new TextEncoder().encode(r):r,t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(n=>n.toString(16).padStart(2,"0")).join("")}function u8(r,e){let t=0,n=r.length;for(let i=0;i<n;i++)r[i]===e&&(r.splice(i,1),i--,n--,t++);return t}var Kv=l8(),c8=Kv.WeakRef||(r=>r);function el(r){if(r!=null){if(typeof r=="object")return new c8(r);console.error(r,r instanceof Object,typeof r);return}}function tl(r){return r==null?void 0:r.deref()}var Pg;typeof window>"u"?Pg=function(r){setTimeout(r,100)}:Pg=Kv.requestAnimationFrame;var h8="_MSG_BUS_RPC_",Qv=5*60*1e3,Lo=new s8;function Jv(){let r=performance.now();for(;Lo.size()>0;){let e=Lo.getFirst();if(e.timeout<=r)Lo.removeFirst(),e.reject(`RPC Call ${e.topic} Timed Out`);else break}Pg(Jv)}Jv();var d8=(r=>(r.PUBLISH="publish",r.SUBSCRIBE="subscribe",r.PUSH="push",r.PULL="pull",r))(d8||{}),ew=class{constructor(r){this.bus=r}processRemoteMessage(r,e){let t=el(e),n=r.topic,i=r.type,s=r.message;switch(i){case"pull":this.bus.pull(n,o=>{this.push(n,o,tl(t))});break;case"subscribe":this.bus.subscribe(n,o=>{this.publish(n,o,tl(t))});break;case"publish":this.bus.publish(n,s,this,tl(t));break;case"push":this.bus.push(n,s,this,tl(t));break;default:console.debug("unknown message type "+i)}}rpcCall(r,e,t,n){let i=el(t);return new Promise((s,o)=>{let a=Lo.push({timeout:performance.now()+n,reject:o,topic:r}),l=this.bus.uniqueRpcTopic(r);this.publish(r,{message:e,reply:l},tl(i)),this.bus.pull(l,(u,c,h)=>{s({message:u,bridge:c,source:el(h)}),Lo.remove(a)})})}},f8=class extends ew{constructor(r,e){super(r),this.worker=e,e.onmessage=t=>{this.processRemoteMessage(t.data,void 0)}}publish(r,e){this.postMessage(r,"publish",e)}subscribe(r){this.postMessage(r,"subscribe",null)}push(r,e){this.postMessage(r,"push",e)}pull(r){this.postMessage(r,"pull",null)}rpcCall(r,e,t=Qv){return super.rpcCall(r,e,void 0,t)}postMessage(r,e,t){let n={topic:r,type:e,message:t};this.worker.postMessage(n)}discard(){this.worker.terminate()}},p8=class extends ew{constructor(r){super(r),window.addEventListener("message",e=>{this.processRemoteMessage(e.data,e.source)},!1)}publish(r,e,t){this.postMessage(r,"publish",e,t)}subscribe(r,e){if(e===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(r,"subscribe",null,e)}push(r,e,t){this.postMessage(r,"push",e,t)}pull(r,e){if(e===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(r,"pull",null,e)}postMessage(r,e,t,n){let i={topic:r,type:e,message:t};n&&n.postMessage(i,"*")}},tw=class{constructor(r){this.isRunning=!0,this.callback=r}cancel(){this.isRunning=!1}running(){return this.isRunning}execute(r,e,t,n){try{r=n?r:Md(r),this.callback(r,e,t)}catch(i){console.error(i)}}},m8=class{constructor(r=!1){this.subscribed={},this.pulled={},this.pushed={},this.rpcTicket=0,this.unsafe=r}uniqueRpcTopic(r){return r+h8+this.rpcTicket++}publish(r,e,t,n){let i=this.subscribed[r];if(i){let s;for(let o of i)o.running()?o.execute(e,t,n,this.unsafe):(s=s||new Array,s.push(o));if(s)for(let o of s)u8(i,o)}else console.debug("no sub on topic: "+r)}subscribe(r,e){let t=new tw(e);return Eg(this.subscribed,r).push(t),t}push(r,e,t,n){let i=!1,s=this.pulled[r];if(s){for(;s.length>0;){let o=s.shift();if(o.running()){o.execute(e,t,n,this.unsafe),i=!0;break}}s.length===0&&delete this.pulled[r]}i||Eg(this.pushed,r).push({message:e,bridge:t,source:el(n)})}pull(r,e){let t=new tw(e),n=this.pushed[r];if(n){let i=n.shift();t.execute(i.message,i.bridge,tl(i.source),this.unsafe),n.length===0&&delete this.pushed[r]}else Eg(this.pulled,r).push(t);return t}pullA(r){return new Promise(e=>{this.pull(r,(t,n,i)=>{e({message:t,bridge:n,source:el(i)})})})}rpcService(r,e){this.subscribe(r,(t,n,i)=>{let{message:s,reply:o}=t;try{let a=e(s);a instanceof Promise?a.then(l=>{this.rpcReply(l,o,n,i)},l=>{console.error(l),this.rpcReply(void 0,o,n,i)}):this.rpcReply(a,o,n,i)}catch(a){console.error(a),this.rpcReply(void 0,o,n,i)}})}rpcCall(r,e,t=Qv){return new Promise((n,i)=>{let s=Lo.push({timeout:performance.now()+t,reject:i,topic:r}),o=this.uniqueRpcTopic(r);this.publish(r,{message:e,reply:o}),this.pull(o,(a,l,u)=>{n({message:a,bridge:l,source:el(u)}),Lo.remove(s)})})}rpcReply(r,e,t,n){t?t.push(e,r,n):this.push(e,r)}},g8="_MSG_BUS_RPC_";function Sg(r,e){let t=0,n=r.length;for(let i=0;i<n;i++)r[i]===e&&(r.splice(i,1),i--,n--,t++);return t}function rl(r,e){return x8(r,e,()=>[])}function x8(r,e,t){let n=r[e];return n!==void 0||(n=t(e),r[e]=n),n}var Nd=class{constructor(r,e){this.callback=r,this.unsafe=e,this.isRunning=!0}cancel(){this.isRunning=!1}running(){return this.isRunning}async execute(r){try{r=this.unsafe?r:Md(r),this.callback(r)}catch(e){console.error(e)}}},b8=Date.now()-performance.now(),rw=new ArrayBuffer(10),y8=new Float64Array(rw,0,1),Ig=new Uint8Array(rw),nw=-1,Bg=0;function Ag(){let r=b8+performance.now();return y8[0]=r,r===nw?Bg++:(Bg=0,nw=r),Ig[8]=Math.random()*1e3,Ig[9]=Bg,btoa(String.fromCharCode(...Ig))}var iw=class{constructor(r=Ag()){this.uuid=r,this.rpcTicket=0}subscribeOnce(r,e){let t=this.subscribe(r,n=>{t.cancel(),e(n)});return t}pullA(r){return new Promise(e=>{this.pull(r,e)})}rpcService(r,e){let t=n=>{try{let{message:i,replyTopic:s}=n;try{let o=e(i);o instanceof Promise?o.then(a=>{this.publish(s,{success:!0,result:a})}).catch(a=>{console.error(a),this.publish(s,{success:!1,err:String(a)})}):this.publish(s,{success:!0,result:o})}catch(o){this.publish(s,{success:!1,err:String(o)})}}finally{this.pull(r,t)}};this.pull(r,t)}rpcCall(r,e,t=0){let n=new Promise((i,s)=>{let o=`${g8}-${r}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce(o,a=>{a.success?i(a.result):s(new Error(a.err))}),this.push(r,{message:e,replyTopic:o})});return t>0?Promise.race([n,new Promise((i,s)=>{setTimeout(s,t)})]):n}},v8=class extends iw{constructor(r=!1){super(),this.unsafe=r,this.subscribed={},this.pulled={},this.pushed={}}publish(r,e){let t=this.subscribed[r];if(t){let n;for(let i of t)i.running()?i.execute(e):(n=n||new Array,n.push(i));if(n)for(let i of n)Sg(t,i)}}subscribe(r,e){let t=new Nd(e,this.unsafe);return rl(this.subscribed,r).push(t),t}push(r,e){let t=!1,n=this.pulled[r];if(n){for(;n.length>0;){let i=n.shift();if(i&&i.running()){i.execute(e),t=!0;break}}n.length===0&&delete this.pulled[r]}t||rl(this.pushed,r).push(e)}pull(r,e){let t=new Nd(e,this.unsafe);return this.repull(r,t),t}repull(r,e){let t=this.pushed[r];if(t){let n=t.shift();n&&(e.execute(n),t.length===0&&delete this.pushed[r])}else rl(this.pulled,r).push(e)}},w8=class extends iw{constructor(r=Ag()){super(r),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(r,e){console.debug("BC",this.uuid,"PUBLISH",r,e),this.broadcastPublish(r,e)}subscribe(r,e){console.debug("BC",this.uuid,"SUBSCRIBE",r);let t=new Nd(e,!0);return rl(this.subscribed,r).push(t),t}push(r,e){let t=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",r,`(${t})`,e),rl(this.pushed,r).push({id:t,message:e}),this.broadcastPushedHeadMessage(r)}pull(r,e){console.debug("BC",this.uuid,"PULL",r);let t=new Nd(e,!0);return rl(this.pulled,r).push(t),this.broadcastWhoHas(r),t}broadcastPushedHeadMessage(r){let e=this.pushed[r];e&&e[0]&&this.broadcastIHave(r,e[0].id)}onReceivedPublish(r,e,t){console.debug("BCMSG(",this.uuid,")","from",r,"PUBLISH",e,"message",t);let n=this.subscribed[e];if(n){let i;for(let s of n)s.running()?s.execute(t):(i=i||new Array,i.push(s));if(i)for(let s of i)Sg(n,s);n.length===0&&delete this.subscribed[e]}}onReceivedWhoHas(r,e){console.debug("BCMSG(",this.uuid,")","from",r,"WHOHAS",e),this.broadcastPushedHeadMessage(e)}onReceivedIHave(r,e,t){console.debug("BCMSG(",this.uuid,")","from",r,"IHAVE",e,"id",t);let n=this.pulled[e];if(n){let i;for(let s of n)if(s.running()){this.broadcastINeed(e,r,t);break}else i=i||new Array,i.push(s);if(i)for(let s of i)Sg(n,s);n.length===0&&delete this.pulled[e]}}onReceivedINeed(r,e,t,n){if(console.debug("BCMSG(",this.uuid,")","from",r,"INEED",e,"source",t,"id",n),this.uuid===t){let i=this.pushed[e];if(i&&i[0]&&i[0].id===n){let{message:s}=i.shift();this.broadcastIGive(e,n,r,s),this.broadcastPushedHeadMessage(e),i.length===0&&delete this.pushed[e]}}}onReceivedIGive(r,e,t,n,i){console.debug("BCMSG(",this.uuid,")","from",r,"IGIVE",e,"id",t,"target",n,"message",i);let s=this.pulled[e];if(s&&this.uuid===n){let o=!1;for(;s.length>0;){let a=s.shift();if(a.running()){a.execute(i),o=!0;break}}o||this.push(e,i),s.length===0&&delete this.pulled[e]}}},E8=class extends w8{constructor(r,e=Ag()){super(e),this.bc=new BroadcastChannel(r),this.bc.onmessage=t=>{this.onMessage(t.data)}}onMessage(r){let{type:e,uuid:t,topic:n}=r;switch(e){case"PUBLISH":{let{message:i}=r;this.onReceivedPublish(t,n,i);break}case"WHOHAS":{this.onReceivedWhoHas(t,n);break}case"IHAVE":{let{id:i}=r;this.onReceivedIHave(t,n,i);break}case"INEED":{let{source:i,id:s}=r;this.onReceivedINeed(t,n,i,s);break}case"IGIVE":{let{target:i,id:s,message:o}=r;this.onReceivedIGive(t,n,s,i,o);break}default:console.warn("unsupported",r)}}broadcastPublish(r,e){this.post({type:"PUBLISH",uuid:this.uuid,topic:r,message:e})}broadcastWhoHas(r){this.post({type:"WHOHAS",uuid:this.uuid,topic:r})}broadcastIHave(r,e){this.post({type:"IHAVE",uuid:this.uuid,topic:r,id:e})}broadcastINeed(r,e,t){this.post({type:"INEED",uuid:this.uuid,topic:r,source:e,id:t})}broadcastIGive(r,e,t,n){this.post({type:"IGIVE",uuid:this.uuid,topic:r,id:e,target:t,message:n})}post(r){this.bc.postMessage(r),Promise.resolve().then(()=>{this.onMessage(r)})}}});var g_=G((INe,m_)=>{"use strict";var m0=Object.defineProperty,eX=Object.getOwnPropertyDescriptor,tX=Object.getOwnPropertyNames,rX=Object.prototype.hasOwnProperty,nX=(r,e)=>{for(var t in e)m0(r,t,{get:e[t],enumerable:!0})},iX=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of tX(e))!rX.call(r,i)&&i!==t&&m0(r,i,{get:()=>e[i],enumerable:!(n=eX(e,i))||n.enumerable});return r},sX=r=>iX(m0({},"__esModule",{value:!0}),r),f_={};nX(f_,{Occapi:()=>lX}),m_.exports=sX(f_);var p_={},oX=(()=>{var r=p_.url;return function(e={}){var t=e,n,i;t.ready=new Promise((x,y)=>{n=x,i=y}),["_malloc","_free","getExceptionMessage","___get_exception_message","___cpp_exception","___cxa_increment_exception_refcount","___cxa_decrement_exception_refcount","___thrown_object_from_unwind_exception","_memory","___indirect_function_table","_sendProgress","_OSD_MemInfo_getModuleHeapLength","_fflush","___start_em_js","___stop_em_js","onRuntimeInitialized"].forEach(x=>{Object.getOwnPropertyDescriptor(t.ready,x)||Object.defineProperty(t.ready,x,{get:()=>St("You are getting "+x+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>St("You are setting "+x+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")})});var s=Object.assign({},t),o=[],a="./this.program",l=(x,y)=>{throw y},u=!0,c=!1,h=!1,f=!1;if(t.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");var d="";function m(x){return t.locateFile?t.locateFile(x,d):d+x}var p,g,b;if(f){if(typeof process=="object"&&typeof mo=="function"||typeof window=="object"||typeof importScripts=="function")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");typeof read<"u"&&(p=read),b=x=>{if(typeof readbuffer=="function")return new Uint8Array(readbuffer(x));let y=read(x,"binary");return F(typeof y=="object"),y},g=(x,y,E)=>{setTimeout(()=>y(b(x)))},typeof clearTimeout>"u"&&(globalThis.clearTimeout=x=>{}),typeof setTimeout>"u"&&(globalThis.setTimeout=x=>typeof x=="function"?x():St()),typeof scriptArgs<"u"?o=scriptArgs:typeof arguments<"u"&&(o=arguments),typeof quit=="function"&&(l=(x,y)=>{throw setTimeout(()=>{if(!(y instanceof kp)){let E=y;y&&typeof y=="object"&&y.stack&&(E=[y,y.stack]),w(`exiting due to exception: ${E}`)}quit(x)}),y}),typeof print<"u"&&(typeof console>"u"&&(console={}),console.log=print,console.warn=console.error=typeof printErr<"u"?printErr:print)}else if(u||c){if(c?d=self.location.href:typeof document<"u"&&document.currentScript&&(d=document.currentScript.src),r&&(d=r),d.indexOf("blob:")!==0?d=d.substr(0,d.replace(/[?#].*/,"").lastIndexOf("/")+1):d="",!(typeof window=="object"||typeof importScripts=="function"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");p=x=>{var y=new XMLHttpRequest;return y.open("GET",x,!1),y.send(null),y.responseText},c&&(b=x=>{var y=new XMLHttpRequest;return y.open("GET",x,!1),y.responseType="arraybuffer",y.send(null),new Uint8Array(y.response)}),g=(x,y,E)=>{var T=new XMLHttpRequest;T.open("GET",x,!0),T.responseType="arraybuffer",T.onload=()=>{if(T.status==200||T.status==0&&T.response){y(T.response);return}E()},T.onerror=E,T.send(null)}}else throw new Error("environment detection error");var v=t.print||console.log.bind(console),w=t.printErr||console.error.bind(console);Object.assign(t,s),s=null,HU(),t.arguments&&(o=t.arguments),Zr("arguments","arguments_"),t.thisProgram&&(a=t.thisProgram),Zr("thisProgram","thisProgram"),t.quit&&(l=t.quit),Zr("quit","quit_"),F(typeof t.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),F(typeof t.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),F(typeof t.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),F(typeof t.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),F(typeof t.read>"u","Module.read option was removed (modify read_ in JS)"),F(typeof t.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),F(typeof t.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),F(typeof t.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),F(typeof t.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),Zr("asm","wasmExports"),Zr("read","read_"),Zr("readAsync","readAsync"),Zr("readBinary","readBinary"),Zr("setWindowTitle","setWindowTitle");var P="IDBFS is no longer included by default; build with -lidbfs.js",_="PROXYFS is no longer included by default; build with -lproxyfs.js",B="WORKERFS is no longer included by default; build with -lworkerfs.js",I="FETCHFS is no longer included by default; build with -lfetchfs.js",C="ICASEFS is no longer included by default; build with -licasefs.js",N="JSFILEFS is no longer included by default; build with -ljsfilefs.js",A="OPFS is no longer included by default; build with -lopfs.js",M="NODEFS is no longer included by default; build with -lnodefs.js";F(!c,"worker environment detected but not enabled at build time.  Add 'worker' to `-sENVIRONMENT` to enable."),F(!h,"node environment detected but not enabled at build time.  Add 'node' to `-sENVIRONMENT` to enable."),F(!f,"shell environment detected but not enabled at build time.  Add 'shell' to `-sENVIRONMENT` to enable.");var S;t.wasmBinary&&(S=t.wasmBinary),Zr("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&St("no native wasm support detected");var $,H=!1,K;function F(x,y){x||St("Assertion failed"+(y?": "+y:""))}var z,L,k,O,ie,W,Q,oe,we;function xe(){var x=$.buffer;t.HEAP8=L=new Int8Array(x),t.HEAP16=O=new Int16Array(x),t.HEAPU8=k=new Uint8Array(x),t.HEAPU16=ie=new Uint16Array(x),t.HEAP32=W=new Int32Array(x),t.HEAPU32=Q=new Uint32Array(x),t.HEAPF32=oe=new Float32Array(x),t.HEAPF64=we=new Float64Array(x)}F(!t.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),F(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),F(!t.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),F(!t.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function ge(){var x=Jp();F((x&3)==0),x==0&&(x+=4),Q[x>>2]=34821223,Q[x+4>>2]=2310721022,Q[0]=1668509029}function Le(){if(!H){var x=Jp();x==0&&(x+=4);var y=Q[x>>2],E=Q[x+4>>2];(y!=34821223||E!=2310721022)&&St(`Stack overflow! Stack cookie has been overwritten at ${Ul(x)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${Ul(E)} ${Ul(y)}`),Q[0]!=1668509029&&St("Runtime error: The application has corrupted its heap memory area (address zero)!")}}(function(){var x=new Int16Array(1),y=new Int8Array(x.buffer);if(x[0]=25459,y[0]!==115||y[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})();var Ne=[],Ve=[],ht=[],R=[],pe=!1;function he(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)se(t.preRun.shift());Up(Ne)}function J(){F(!pe),pe=!0,Le(),!t.noFSInit&&!U.init.initialized&&U.init(),U.ignorePermissions=!1,qi.init(),Up(Ve)}function Z(){if(Le(),t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)ue(t.postRun.shift());Up(R)}function se(x){Ne.unshift(x)}function de(x){Ve.unshift(x)}function _e(x){}function ue(x){R.unshift(x)}F(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),F(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),F(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),F(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var Pe=0,Ue=null,Be=null,We={};function Ut(x){for(var y=x;;){if(!We[x])return x;x=y+Math.random()}}function gt(x){var y;Pe++,(y=t.monitorRunDependencies)==null||y.call(t,Pe),x?(F(!We[x]),We[x]=1,Ue===null&&typeof setInterval<"u"&&(Ue=setInterval(()=>{if(H){clearInterval(Ue),Ue=null;return}var E=!1;for(var T in We)E||(E=!0,w("still waiting on run dependencies:")),w(`dependency: ${T}`);E&&w("(end of list)")},1e4))):w("warning: run dependency added without ID")}function Rr(x){var E;if(Pe--,(E=t.monitorRunDependencies)==null||E.call(t,Pe),x?(F(We[x]),delete We[x]):w("warning: run dependency removed without ID"),Pe==0&&(Ue!==null&&(clearInterval(Ue),Ue=null),Be)){var y=Be;Be=null,y()}}function St(x){var E;(E=t.onAbort)==null||E.call(t,x),x="Aborted("+x+")",w(x),H=!0,K=1,pe&&zb();var y=new WebAssembly.RuntimeError(x);throw i(y),y}var Cn="data:application/octet-stream;base64,",vs=x=>x.startsWith(Cn),Qt=x=>x.startsWith("file://");function Xt(x){return function(){F(pe,`native function \`${x}\` called before runtime initialization`);var y=xn[x];return F(y,`exported native function \`${x}\` not found`),y.apply(null,arguments)}}var pn;t.locateFile?(pn="occapi.wasm",vs(pn)||(pn=m(pn))):pn=new URL("occapi.wasm",p_.url).href;function Mn(x){if(x==pn&&S)return new Uint8Array(S);if(b)return b(x);throw"both async and sync fetching of the wasm failed"}function Tc(x){return!S&&(u||c)&&typeof fetch=="function"?fetch(x,{credentials:"same-origin"}).then(y=>{if(!y.ok)throw"failed to load wasm binary file at '"+x+"'";return y.arrayBuffer()}).catch(()=>Mn(x)):Promise.resolve().then(()=>Mn(x))}function Cc(x,y,E){return Tc(x).then(T=>WebAssembly.instantiate(T,y)).then(T=>T).then(E,T=>{w(`failed to asynchronously prepare wasm: ${T}`),Qt(pn)&&w(`warning: Loading from a file URI (${pn}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),St(T)})}function Lp(x,y,E,T){return!x&&typeof WebAssembly.instantiateStreaming=="function"&&!vs(y)&&typeof fetch=="function"?fetch(y,{credentials:"same-origin"}).then(D=>{var X=WebAssembly.instantiateStreaming(D,E);return X.then(T,function(j){return w(`wasm streaming compile failed: ${j}`),w("falling back to ArrayBuffer instantiation"),Cc(y,E,T)})}):Cc(y,E,T)}function Op(){var x={env:Fb,wasi_snapshot_preview1:Fb};function y(D,X){return xn=D.exports,$=xn.memory,F($,"memory not found in wasm exports"),xe(),Lc=xn.__indirect_function_table,F(Lc,"table not found in wasm exports"),de(xn.__wasm_call_ctors),Rr("wasm-instantiate"),xn}gt("wasm-instantiate");var E=t;function T(D){F(t===E,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),E=null,y(D.instance)}if(t.instantiateWasm)try{return t.instantiateWasm(x,y)}catch(D){w(`Module.instantiateWasm callback failed with error: ${D}`),i(D)}return Lp(S,pn,x,T).catch(i),{}}var He,Rt;function Zr(x,y,E=!0){Object.getOwnPropertyDescriptor(t,x)||Object.defineProperty(t,x,{configurable:!0,get(){let T=E?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";St(`\`Module.${x}\` has been replaced by \`${y}\``+T)}})}function q4(x){Object.getOwnPropertyDescriptor(t,x)&&St(`\`Module.${x}\` was supplied but \`${x}\` not included in INCOMING_MODULE_JS_API`)}function ab(x){return x==="FS_createPath"||x==="FS_createDataFile"||x==="FS_createPreloadedFile"||x==="FS_unlink"||x==="addRunDependency"||x==="FS_createLazyFile"||x==="FS_createDevice"||x==="removeRunDependency"}function lb(x,y){typeof globalThis<"u"&&Object.defineProperty(globalThis,x,{configurable:!0,get(){mn(`\`${x}\` is not longer defined by emscripten. ${y}`)}})}lb("buffer","Please use HEAP8.buffer or wasmMemory.buffer"),lb("asm","Please use wasmExports instead");function z4(x){typeof globalThis<"u"&&!Object.getOwnPropertyDescriptor(globalThis,x)&&Object.defineProperty(globalThis,x,{configurable:!0,get(){var y=`\`${x}\` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line`,E=x;E.startsWith("_")||(E="$"+x),y+=` (e.g. -sDEFAULT_LIBRARY_FUNCS_TO_INCLUDE='${E}')`,ab(x)&&(y+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),mn(y)}}),ub(x)}function ub(x){Object.getOwnPropertyDescriptor(t,x)||Object.defineProperty(t,x,{configurable:!0,get(){var y=`'${x}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;ab(x)&&(y+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),St(y)}})}function Vse(x){console.warn.apply(console,arguments)}function Y4(x){t.exportProgress!=null&&t.exportProgress!=null&&t.exportProgress(x)}function X4(){return t.HEAP8.length}function kp(x){this.name="ExitStatus",this.message=`Program terminated with exit(${x})`,this.status=x}var Up=x=>{for(;x.length>0;)x.shift()(t)},cb=()=>xn.__cpp_exception,Dp=x=>{var y=x.getArg(cb(),0);return nD(y)},Wse=x=>{var y=Dp(x);tD(y)},V4=x=>{var y=Xb(),E=x();return Vb(y),E},hb=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,na=(x,y,E)=>{for(var T=y+E,D=y;x[D]&&!(D>=T);)++D;if(D-y>16&&x.buffer&&hb)return hb.decode(x.subarray(y,D));for(var X="";y<D;){var j=x[y++];if(!(j&128)){X+=String.fromCharCode(j);continue}var te=x[y++]&63;if((j&224)==192){X+=String.fromCharCode((j&31)<<6|te);continue}var le=x[y++]&63;if((j&240)==224?j=(j&15)<<12|te<<6|le:((j&248)!=240&&mn("Invalid UTF-8 leading byte "+Ul(j)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),j=(j&7)<<18|te<<12|le<<6|x[y++]&63),j<65536)X+=String.fromCharCode(j);else{var fe=j-65536;X+=String.fromCharCode(55296|fe>>10,56320|fe&1023)}}return X},Nn=(x,y)=>(F(typeof x=="number",`UTF8ToString expects a number (got ${typeof x})`),x?na(k,x,y):""),W4=x=>V4(()=>{var y=Gc(4),E=Gc(4);iD(x,y,E);var T=Q[y>>2],D=Q[E>>2],X=Nn(T);xi(T);var j;return D&&(j=Nn(D),xi(D)),[X,j]}),db=x=>{var y=Dp(x);return W4(y)};t.getExceptionMessage=db;function $se(x,y="i8"){switch(y.endsWith("*")&&(y="*"),y){case"i1":return L[x>>0];case"i8":return L[x>>0];case"i16":return O[x>>1];case"i32":return W[x>>2];case"i64":St("to do getValue(i64) use WASM_BIGINT");case"float":return oe[x>>2];case"double":return we[x>>3];case"*":return Q[x>>2];default:St(`invalid type for getValue: ${y}`)}}var jse=x=>{var y=Dp(x);rD(y)},$4=t.noExitRuntime||!0,Ul=x=>(F(typeof x=="number"),x>>>=0,"0x"+x.toString(16).padStart(8,"0"));function Hse(x,y,E="i8"){switch(E.endsWith("*")&&(E="*"),E){case"i1":L[x>>0]=y;break;case"i8":L[x>>0]=y;break;case"i16":O[x>>1]=y;break;case"i32":W[x>>2]=y;break;case"i64":St("to do setValue(i64) use WASM_BIGINT");case"float":oe[x>>2]=y;break;case"double":we[x>>3]=y;break;case"*":Q[x>>2]=y;break;default:St(`invalid type for setValue: ${E}`)}}var mn=x=>{mn.shown||(mn.shown={}),mn.shown[x]||(mn.shown[x]=1,w(x))},j4=(x,y,E,T)=>{St(`Assertion failed: ${Nn(x)}, at: `+[y?Nn(y):"unknown filename",E,T?Nn(T):"unknown function"])},Lt={isAbs:x=>x.charAt(0)==="/",splitPath:x=>{var y=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return y.exec(x).slice(1)},normalizeArray:(x,y)=>{for(var E=0,T=x.length-1;T>=0;T--){var D=x[T];D==="."?x.splice(T,1):D===".."?(x.splice(T,1),E++):E&&(x.splice(T,1),E--)}if(y)for(;E;E--)x.unshift("..");return x},normalize:x=>{var y=Lt.isAbs(x),E=x.substr(-1)==="/";return x=Lt.normalizeArray(x.split("/").filter(T=>!!T),!y).join("/"),!x&&!y&&(x="."),x&&E&&(x+="/"),(y?"/":"")+x},dirname:x=>{var y=Lt.splitPath(x),E=y[0],T=y[1];return!E&&!T?".":(T&&(T=T.substr(0,T.length-1)),E+T)},basename:x=>{if(x==="/")return"/";x=Lt.normalize(x),x=x.replace(/\/$/,"");var y=x.lastIndexOf("/");return y===-1?x:x.substr(y+1)},join:function(){var x=Array.prototype.slice.call(arguments);return Lt.normalize(x.join("/"))},join2:(x,y)=>Lt.normalize(x+"/"+y)},H4=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return x=>crypto.getRandomValues(x);St("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: (array) => { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")},Gp=x=>(Gp=H4())(x),gi={resolve:function(){for(var x="",y=!1,E=arguments.length-1;E>=-1&&!y;E--){var T=E>=0?arguments[E]:U.cwd();if(typeof T!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!T)return"";x=T+"/"+x,y=Lt.isAbs(T)}return x=Lt.normalizeArray(x.split("/").filter(D=>!!D),!y).join("/"),(y?"/":"")+x||"."},relative:(x,y)=>{x=gi.resolve(x).substr(1),y=gi.resolve(y).substr(1);function E(fe){for(var ve=0;ve<fe.length&&fe[ve]==="";ve++);for(var Ie=fe.length-1;Ie>=0&&fe[Ie]==="";Ie--);return ve>Ie?[]:fe.slice(ve,Ie-ve+1)}for(var T=E(x.split("/")),D=E(y.split("/")),X=Math.min(T.length,D.length),j=X,te=0;te<X;te++)if(T[te]!==D[te]){j=te;break}for(var le=[],te=j;te<T.length;te++)le.push("..");return le=le.concat(D.slice(j)),le.join("/")}},Fp=[],ia=x=>{for(var y=0,E=0;E<x.length;++E){var T=x.charCodeAt(E);T<=127?y++:T<=2047?y+=2:T>=55296&&T<=57343?(y+=4,++E):y+=3}return y},qp=(x,y,E,T)=>{if(F(typeof x=="string",`stringToUTF8Array expects a string (got ${typeof x})`),!(T>0))return 0;for(var D=E,X=E+T-1,j=0;j<x.length;++j){var te=x.charCodeAt(j);if(te>=55296&&te<=57343){var le=x.charCodeAt(++j);te=65536+((te&1023)<<10)|le&1023}if(te<=127){if(E>=X)break;y[E++]=te}else if(te<=2047){if(E+1>=X)break;y[E++]=192|te>>6,y[E++]=128|te&63}else if(te<=65535){if(E+2>=X)break;y[E++]=224|te>>12,y[E++]=128|te>>6&63,y[E++]=128|te&63}else{if(E+3>=X)break;te>1114111&&mn("Invalid Unicode code point "+Ul(te)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),y[E++]=240|te>>18,y[E++]=128|te>>12&63,y[E++]=128|te>>6&63,y[E++]=128|te&63}}return y[E]=0,E-D};function Mc(x,y,E){var T=E>0?E:ia(x)+1,D=new Array(T),X=qp(x,D,0,D.length);return y&&(D.length=X),D}var Z4=()=>{if(!Fp.length){var x=null;if(typeof window<"u"&&typeof window.prompt=="function"?(x=window.prompt("Input: "),x!==null&&(x+=`
`)):typeof readline=="function"&&(x=readline(),x!==null&&(x+=`
`)),!x)return null;Fp=Mc(x,!0)}return Fp.shift()},qi={ttys:[],init(){},shutdown(){},register(x,y){qi.ttys[x]={input:[],output:[],ops:y},U.registerDevice(x,qi.stream_ops)},stream_ops:{open(x){var y=qi.ttys[x.node.rdev];if(!y)throw new U.ErrnoError(43);x.tty=y,x.seekable=!1},close(x){x.tty.ops.fsync(x.tty)},fsync(x){x.tty.ops.fsync(x.tty)},read(x,y,E,T,D){if(!x.tty||!x.tty.ops.get_char)throw new U.ErrnoError(60);for(var X=0,j=0;j<T;j++){var te;try{te=x.tty.ops.get_char(x.tty)}catch{throw new U.ErrnoError(29)}if(te===void 0&&X===0)throw new U.ErrnoError(6);if(te==null)break;X++,y[E+j]=te}return X&&(x.node.timestamp=Date.now()),X},write(x,y,E,T,D){if(!x.tty||!x.tty.ops.put_char)throw new U.ErrnoError(60);try{for(var X=0;X<T;X++)x.tty.ops.put_char(x.tty,y[E+X])}catch{throw new U.ErrnoError(29)}return T&&(x.node.timestamp=Date.now()),X}},default_tty_ops:{get_char(x){return Z4()},put_char(x,y){y===null||y===10?(v(na(x.output,0)),x.output=[]):y!=0&&x.output.push(y)},fsync(x){x.output&&x.output.length>0&&(v(na(x.output,0)),x.output=[])},ioctl_tcgets(x){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(x,y,E){return 0},ioctl_tiocgwinsz(x){return[24,80]}},default_tty1_ops:{put_char(x,y){y===null||y===10?(w(na(x.output,0)),x.output=[]):y!=0&&x.output.push(y)},fsync(x){x.output&&x.output.length>0&&(w(na(x.output,0)),x.output=[])}}},Zse=(x,y)=>(k.fill(0,x,x+y),x),Kse=(x,y)=>(F(y,"alignment argument is required"),Math.ceil(x/y)*y),fb=x=>{St("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")},ot={ops_table:null,mount(x){return ot.createNode(null,"/",16895,0)},createNode(x,y,E,T){if(U.isBlkdev(E)||U.isFIFO(E))throw new U.ErrnoError(63);ot.ops_table||(ot.ops_table={dir:{node:{getattr:ot.node_ops.getattr,setattr:ot.node_ops.setattr,lookup:ot.node_ops.lookup,mknod:ot.node_ops.mknod,rename:ot.node_ops.rename,unlink:ot.node_ops.unlink,rmdir:ot.node_ops.rmdir,readdir:ot.node_ops.readdir,symlink:ot.node_ops.symlink},stream:{llseek:ot.stream_ops.llseek}},file:{node:{getattr:ot.node_ops.getattr,setattr:ot.node_ops.setattr},stream:{llseek:ot.stream_ops.llseek,read:ot.stream_ops.read,write:ot.stream_ops.write,allocate:ot.stream_ops.allocate,mmap:ot.stream_ops.mmap,msync:ot.stream_ops.msync}},link:{node:{getattr:ot.node_ops.getattr,setattr:ot.node_ops.setattr,readlink:ot.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ot.node_ops.getattr,setattr:ot.node_ops.setattr},stream:U.chrdev_stream_ops}});var D=U.createNode(x,y,E,T);return U.isDir(D.mode)?(D.node_ops=ot.ops_table.dir.node,D.stream_ops=ot.ops_table.dir.stream,D.contents={}):U.isFile(D.mode)?(D.node_ops=ot.ops_table.file.node,D.stream_ops=ot.ops_table.file.stream,D.usedBytes=0,D.contents=null):U.isLink(D.mode)?(D.node_ops=ot.ops_table.link.node,D.stream_ops=ot.ops_table.link.stream):U.isChrdev(D.mode)&&(D.node_ops=ot.ops_table.chrdev.node,D.stream_ops=ot.ops_table.chrdev.stream),D.timestamp=Date.now(),x&&(x.contents[y]=D,x.timestamp=D.timestamp),D},getFileDataAsTypedArray(x){return x.contents?x.contents.subarray?x.contents.subarray(0,x.usedBytes):new Uint8Array(x.contents):new Uint8Array(0)},expandFileStorage(x,y){var E=x.contents?x.contents.length:0;if(!(E>=y)){var T=1024*1024;y=Math.max(y,E*(E<T?2:1.125)>>>0),E!=0&&(y=Math.max(y,256));var D=x.contents;x.contents=new Uint8Array(y),x.usedBytes>0&&x.contents.set(D.subarray(0,x.usedBytes),0)}},resizeFileStorage(x,y){if(x.usedBytes!=y)if(y==0)x.contents=null,x.usedBytes=0;else{var E=x.contents;x.contents=new Uint8Array(y),E&&x.contents.set(E.subarray(0,Math.min(y,x.usedBytes))),x.usedBytes=y}},node_ops:{getattr(x){var y={};return y.dev=U.isChrdev(x.mode)?x.id:1,y.ino=x.id,y.mode=x.mode,y.nlink=1,y.uid=0,y.gid=0,y.rdev=x.rdev,U.isDir(x.mode)?y.size=4096:U.isFile(x.mode)?y.size=x.usedBytes:U.isLink(x.mode)?y.size=x.link.length:y.size=0,y.atime=new Date(x.timestamp),y.mtime=new Date(x.timestamp),y.ctime=new Date(x.timestamp),y.blksize=4096,y.blocks=Math.ceil(y.size/y.blksize),y},setattr(x,y){y.mode!==void 0&&(x.mode=y.mode),y.timestamp!==void 0&&(x.timestamp=y.timestamp),y.size!==void 0&&ot.resizeFileStorage(x,y.size)},lookup(x,y){throw U.genericErrors[44]},mknod(x,y,E,T){return ot.createNode(x,y,E,T)},rename(x,y,E){if(U.isDir(x.mode)){var T;try{T=U.lookupNode(y,E)}catch{}if(T)for(var D in T.contents)throw new U.ErrnoError(55)}delete x.parent.contents[x.name],x.parent.timestamp=Date.now(),x.name=E,y.contents[E]=x,y.timestamp=x.parent.timestamp,x.parent=y},unlink(x,y){delete x.contents[y],x.timestamp=Date.now()},rmdir(x,y){var E=U.lookupNode(x,y);for(var T in E.contents)throw new U.ErrnoError(55);delete x.contents[y],x.timestamp=Date.now()},readdir(x){var y=[".",".."];for(var E of Object.keys(x.contents))y.push(E);return y},symlink(x,y,E){var T=ot.createNode(x,y,41471,0);return T.link=E,T},readlink(x){if(!U.isLink(x.mode))throw new U.ErrnoError(28);return x.link}},stream_ops:{read(x,y,E,T,D){var X=x.node.contents;if(D>=x.node.usedBytes)return 0;var j=Math.min(x.node.usedBytes-D,T);if(F(j>=0),j>8&&X.subarray)y.set(X.subarray(D,D+j),E);else for(var te=0;te<j;te++)y[E+te]=X[D+te];return j},write(x,y,E,T,D,X){if(F(!(y instanceof ArrayBuffer)),y.buffer===L.buffer&&(X=!1),!T)return 0;var j=x.node;if(j.timestamp=Date.now(),y.subarray&&(!j.contents||j.contents.subarray)){if(X)return F(D===0,"canOwn must imply no weird position inside the file"),j.contents=y.subarray(E,E+T),j.usedBytes=T,T;if(j.usedBytes===0&&D===0)return j.contents=y.slice(E,E+T),j.usedBytes=T,T;if(D+T<=j.usedBytes)return j.contents.set(y.subarray(E,E+T),D),T}if(ot.expandFileStorage(j,D+T),j.contents.subarray&&y.subarray)j.contents.set(y.subarray(E,E+T),D);else for(var te=0;te<T;te++)j.contents[D+te]=y[E+te];return j.usedBytes=Math.max(j.usedBytes,D+T),T},llseek(x,y,E){var T=y;if(E===1?T+=x.position:E===2&&U.isFile(x.node.mode)&&(T+=x.node.usedBytes),T<0)throw new U.ErrnoError(28);return T},allocate(x,y,E){ot.expandFileStorage(x.node,y+E),x.node.usedBytes=Math.max(x.node.usedBytes,y+E)},mmap(x,y,E,T,D){if(!U.isFile(x.node.mode))throw new U.ErrnoError(43);var X,j,te=x.node.contents;if(!(D&2)&&te.buffer===L.buffer)j=!1,X=te.byteOffset;else{if((E>0||E+y<te.length)&&(te.subarray?te=te.subarray(E,E+y):te=Array.prototype.slice.call(te,E,E+y)),j=!0,X=fb(y),!X)throw new U.ErrnoError(48);L.set(te,X)}return{ptr:X,allocated:j}},msync(x,y,E,T,D){return ot.stream_ops.write(x,y,0,T,E,!1),0}}},K4=(x,y,E,T)=>{var D=T?"":Ut(`al ${x}`);g(x,X=>{F(X,`Loading data file "${x}" failed (no arrayBuffer).`),y(new Uint8Array(X)),D&&Rr(D)},X=>{if(E)E();else throw`Loading data file "${x}" failed.`}),D&&gt(D)},Q4=(x,y,E,T,D,X)=>{U.createDataFile(x,y,E,T,D,X)},zp=t.preloadPlugins||[],J4=(x,y,E,T)=>{typeof ce<"u"&&ce.init();var D=!1;return zp.forEach(X=>{D||X.canHandle(y)&&(X.handle(x,y,E,T),D=!0)}),D},ek=(x,y,E,T,D,X,j,te,le,fe)=>{var ve=y?gi.resolve(Lt.join2(x,y)):x,Ie=Ut(`cp ${ve}`);function Se(Me){function De(Je){fe==null||fe(),te||Q4(x,y,Je,T,D,le),X==null||X(),Rr(Ie)}J4(Me,ve,De,()=>{j==null||j(),Rr(Ie)})||De(Me)}gt(Ie),typeof E=="string"?K4(E,Me=>Se(Me),j):Se(E)},tk=x=>{var y={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},E=y[x];if(typeof E>"u")throw new Error(`Unknown file open mode: ${x}`);return E},Yp=(x,y)=>{var E=0;return x&&(E|=365),y&&(E|=146),E},rk={0:"Success",1:"Arg list too long",2:"Permission denied",3:"Address already in use",4:"Address not available",5:"Address family not supported by protocol family",6:"No more processes",7:"Socket already connected",8:"Bad file number",9:"Trying to read unreadable message",10:"Mount device busy",11:"Operation canceled",12:"No children",13:"Connection aborted",14:"Connection refused",15:"Connection reset by peer",16:"File locking deadlock error",17:"Destination address required",18:"Math arg out of domain of func",19:"Quota exceeded",20:"File exists",21:"Bad address",22:"File too large",23:"Host is unreachable",24:"Identifier removed",25:"Illegal byte sequence",26:"Connection already in progress",27:"Interrupted system call",28:"Invalid argument",29:"I/O error",30:"Socket is already connected",31:"Is a directory",32:"Too many symbolic links",33:"Too many open files",34:"Too many links",35:"Message too long",36:"Multihop attempted",37:"File or path name too long",38:"Network interface is not configured",39:"Connection reset by network",40:"Network is unreachable",41:"Too many open files in system",42:"No buffer space available",43:"No such device",44:"No such file or directory",45:"Exec format error",46:"No record locks available",47:"The link has been severed",48:"Not enough core",49:"No message of desired type",50:"Protocol not available",51:"No space left on device",52:"Function not implemented",53:"Socket is not connected",54:"Not a directory",55:"Directory not empty",56:"State not recoverable",57:"Socket operation on non-socket",59:"Not a typewriter",60:"No such device or address",61:"Value too large for defined data type",62:"Previous owner died",63:"Not super-user",64:"Broken pipe",65:"Protocol error",66:"Unknown protocol",67:"Protocol wrong type for socket",68:"Math result not representable",69:"Read only file system",70:"Illegal seek",71:"No such process",72:"Stale file handle",73:"Connection timed out",74:"Text file busy",75:"Cross-device link",100:"Device not a stream",101:"Bad font file fmt",102:"Invalid slot",103:"Invalid request code",104:"No anode",105:"Block device required",106:"Channel number out of range",107:"Level 3 halted",108:"Level 3 reset",109:"Link number out of range",110:"Protocol driver not attached",111:"No CSI structure available",112:"Level 2 halted",113:"Invalid exchange",114:"Invalid request descriptor",115:"Exchange full",116:"No data (for no delay io)",117:"Timer expired",118:"Out of streams resources",119:"Machine is not on the network",120:"Package not installed",121:"The object is remote",122:"Advertise error",123:"Srmount error",124:"Communication error on send",125:"Cross mount point (not really error)",126:"Given log. name not unique",127:"f.d. invalid for this operation",128:"Remote address changed",129:"Can   access a needed shared lib",130:"Accessing a corrupted shared lib",131:".lib section in a.out corrupted",132:"Attempting to link in too many libs",133:"Attempting to exec a shared library",135:"Streams pipe error",136:"Too many users",137:"Socket type not supported",138:"Not supported",139:"Protocol family not supported",140:"Can't send after socket shutdown",141:"Too many references",142:"Host is down",148:"No medium (in tape drive)",156:"Level 2 not synchronized"},pb={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},nk=x=>(mn("warning: build with -sDEMANGLE_SUPPORT to link in libcxxabi demangling"),x),ik=x=>{var y=/\b_Z[\w\d_]+/g;return x.replace(y,function(E){var T=nk(E);return E===T?E:T+" ["+E+"]"})},U={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath(x,y={}){if(x=gi.resolve(x),!x)return{path:"",node:null};var E={follow_mount:!0,recurse_count:0};if(y=Object.assign(E,y),y.recurse_count>8)throw new U.ErrnoError(32);for(var T=x.split("/").filter(Ie=>!!Ie),D=U.root,X="/",j=0;j<T.length;j++){var te=j===T.length-1;if(te&&y.parent)break;if(D=U.lookupNode(D,T[j]),X=Lt.join2(X,T[j]),U.isMountpoint(D)&&(!te||te&&y.follow_mount)&&(D=D.mounted.root),!te||y.follow)for(var le=0;U.isLink(D.mode);){var fe=U.readlink(X);X=gi.resolve(Lt.dirname(X),fe);var ve=U.lookupPath(X,{recurse_count:y.recurse_count+1});if(D=ve.node,le++>40)throw new U.ErrnoError(32)}}return{path:X,node:D}},getPath(x){for(var y;;){if(U.isRoot(x)){var E=x.mount.mountpoint;return y?E[E.length-1]!=="/"?`${E}/${y}`:E+y:E}y=y?`${x.name}/${y}`:x.name,x=x.parent}},hashName(x,y){for(var E=0,T=0;T<y.length;T++)E=(E<<5)-E+y.charCodeAt(T)|0;return(x+E>>>0)%U.nameTable.length},hashAddNode(x){var y=U.hashName(x.parent.id,x.name);x.name_next=U.nameTable[y],U.nameTable[y]=x},hashRemoveNode(x){var y=U.hashName(x.parent.id,x.name);if(U.nameTable[y]===x)U.nameTable[y]=x.name_next;else for(var E=U.nameTable[y];E;){if(E.name_next===x){E.name_next=x.name_next;break}E=E.name_next}},lookupNode(x,y){var E=U.mayLookup(x);if(E)throw new U.ErrnoError(E,x);for(var T=U.hashName(x.id,y),D=U.nameTable[T];D;D=D.name_next){var X=D.name;if(D.parent.id===x.id&&X===y)return D}return U.lookup(x,y)},createNode(x,y,E,T){F(typeof x=="object");var D=new U.FSNode(x,y,E,T);return U.hashAddNode(D),D},destroyNode(x){U.hashRemoveNode(x)},isRoot(x){return x===x.parent},isMountpoint(x){return!!x.mounted},isFile(x){return(x&61440)===32768},isDir(x){return(x&61440)===16384},isLink(x){return(x&61440)===40960},isChrdev(x){return(x&61440)===8192},isBlkdev(x){return(x&61440)===24576},isFIFO(x){return(x&61440)===4096},isSocket(x){return(x&49152)===49152},flagsToPermissionString(x){var y=["r","w","rw"][x&3];return x&512&&(y+="w"),y},nodePermissions(x,y){return U.ignorePermissions?0:y.includes("r")&&!(x.mode&292)||y.includes("w")&&!(x.mode&146)||y.includes("x")&&!(x.mode&73)?2:0},mayLookup(x){var y=U.nodePermissions(x,"x");return y||(x.node_ops.lookup?0:2)},mayCreate(x,y){try{var E=U.lookupNode(x,y);return 20}catch{}return U.nodePermissions(x,"wx")},mayDelete(x,y,E){var T;try{T=U.lookupNode(x,y)}catch(X){return X.errno}var D=U.nodePermissions(x,"wx");if(D)return D;if(E){if(!U.isDir(T.mode))return 54;if(U.isRoot(T)||U.getPath(T)===U.cwd())return 10}else if(U.isDir(T.mode))return 31;return 0},mayOpen(x,y){return x?U.isLink(x.mode)?32:U.isDir(x.mode)&&(U.flagsToPermissionString(y)!=="r"||y&512)?31:U.nodePermissions(x,U.flagsToPermissionString(y)):44},MAX_OPEN_FDS:4096,nextfd(){for(var x=0;x<=U.MAX_OPEN_FDS;x++)if(!U.streams[x])return x;throw new U.ErrnoError(33)},getStreamChecked(x){var y=U.getStream(x);if(!y)throw new U.ErrnoError(8);return y},getStream:x=>U.streams[x],createStream(x,y=-1){return U.FSStream||(U.FSStream=function(){this.shared={}},U.FSStream.prototype={},Object.defineProperties(U.FSStream.prototype,{object:{get(){return this.node},set(E){this.node=E}},isRead:{get(){return(this.flags&2097155)!==1}},isWrite:{get(){return(this.flags&2097155)!==0}},isAppend:{get(){return this.flags&1024}},flags:{get(){return this.shared.flags},set(E){this.shared.flags=E}},position:{get(){return this.shared.position},set(E){this.shared.position=E}}})),x=Object.assign(new U.FSStream,x),y==-1&&(y=U.nextfd()),x.fd=y,U.streams[y]=x,x},closeStream(x){U.streams[x]=null},chrdev_stream_ops:{open(x){var E,T;var y=U.getDevice(x.node.rdev);x.stream_ops=y.stream_ops,(T=(E=x.stream_ops).open)==null||T.call(E,x)},llseek(){throw new U.ErrnoError(70)}},major:x=>x>>8,minor:x=>x&255,makedev:(x,y)=>x<<8|y,registerDevice(x,y){U.devices[x]={stream_ops:y}},getDevice:x=>U.devices[x],getMounts(x){for(var y=[],E=[x];E.length;){var T=E.pop();y.push(T),E.push.apply(E,T.mounts)}return y},syncfs(x,y){typeof x=="function"&&(y=x,x=!1),U.syncFSRequests++,U.syncFSRequests>1&&w(`warning: ${U.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var E=U.getMounts(U.root.mount),T=0;function D(j){return F(U.syncFSRequests>0),U.syncFSRequests--,y(j)}function X(j){if(j)return X.errored?void 0:(X.errored=!0,D(j));++T>=E.length&&D(null)}E.forEach(j=>{if(!j.type.syncfs)return X(null);j.type.syncfs(j,x,X)})},mount(x,y,E){if(typeof x=="string")throw x;var T=E==="/",D=!E,X;if(T&&U.root)throw new U.ErrnoError(10);if(!T&&!D){var j=U.lookupPath(E,{follow_mount:!1});if(E=j.path,X=j.node,U.isMountpoint(X))throw new U.ErrnoError(10);if(!U.isDir(X.mode))throw new U.ErrnoError(54)}var te={type:x,opts:y,mountpoint:E,mounts:[]},le=x.mount(te);return le.mount=te,te.root=le,T?U.root=le:X&&(X.mounted=te,X.mount&&X.mount.mounts.push(te)),le},unmount(x){var y=U.lookupPath(x,{follow_mount:!1});if(!U.isMountpoint(y.node))throw new U.ErrnoError(28);var E=y.node,T=E.mounted,D=U.getMounts(T);Object.keys(U.nameTable).forEach(j=>{for(var te=U.nameTable[j];te;){var le=te.name_next;D.includes(te.mount)&&U.destroyNode(te),te=le}}),E.mounted=null;var X=E.mount.mounts.indexOf(T);F(X!==-1),E.mount.mounts.splice(X,1)},lookup(x,y){return x.node_ops.lookup(x,y)},mknod(x,y,E){var T=U.lookupPath(x,{parent:!0}),D=T.node,X=Lt.basename(x);if(!X||X==="."||X==="..")throw new U.ErrnoError(28);var j=U.mayCreate(D,X);if(j)throw new U.ErrnoError(j);if(!D.node_ops.mknod)throw new U.ErrnoError(63);return D.node_ops.mknod(D,X,y,E)},create(x,y){return y=y!==void 0?y:438,y&=4095,y|=32768,U.mknod(x,y,0)},mkdir(x,y){return y=y!==void 0?y:511,y&=1023,y|=16384,U.mknod(x,y,0)},mkdirTree(x,y){for(var E=x.split("/"),T="",D=0;D<E.length;++D)if(!!E[D]){T+="/"+E[D];try{U.mkdir(T,y)}catch(X){if(X.errno!=20)throw X}}},mkdev(x,y,E){return typeof E>"u"&&(E=y,y=438),y|=8192,U.mknod(x,y,E)},symlink(x,y){if(!gi.resolve(x))throw new U.ErrnoError(44);var E=U.lookupPath(y,{parent:!0}),T=E.node;if(!T)throw new U.ErrnoError(44);var D=Lt.basename(y),X=U.mayCreate(T,D);if(X)throw new U.ErrnoError(X);if(!T.node_ops.symlink)throw new U.ErrnoError(63);return T.node_ops.symlink(T,D,x)},rename(x,y){var E=Lt.dirname(x),T=Lt.dirname(y),D=Lt.basename(x),X=Lt.basename(y),j,te,le;if(j=U.lookupPath(x,{parent:!0}),te=j.node,j=U.lookupPath(y,{parent:!0}),le=j.node,!te||!le)throw new U.ErrnoError(44);if(te.mount!==le.mount)throw new U.ErrnoError(75);var fe=U.lookupNode(te,D),ve=gi.relative(x,T);if(ve.charAt(0)!==".")throw new U.ErrnoError(28);if(ve=gi.relative(y,E),ve.charAt(0)!==".")throw new U.ErrnoError(55);var Ie;try{Ie=U.lookupNode(le,X)}catch{}if(fe!==Ie){var Se=U.isDir(fe.mode),Me=U.mayDelete(te,D,Se);if(Me)throw new U.ErrnoError(Me);if(Me=Ie?U.mayDelete(le,X,Se):U.mayCreate(le,X),Me)throw new U.ErrnoError(Me);if(!te.node_ops.rename)throw new U.ErrnoError(63);if(U.isMountpoint(fe)||Ie&&U.isMountpoint(Ie))throw new U.ErrnoError(10);if(le!==te&&(Me=U.nodePermissions(te,"w"),Me))throw new U.ErrnoError(Me);U.hashRemoveNode(fe);try{te.node_ops.rename(fe,le,X)}catch(De){throw De}finally{U.hashAddNode(fe)}}},rmdir(x){var y=U.lookupPath(x,{parent:!0}),E=y.node,T=Lt.basename(x),D=U.lookupNode(E,T),X=U.mayDelete(E,T,!0);if(X)throw new U.ErrnoError(X);if(!E.node_ops.rmdir)throw new U.ErrnoError(63);if(U.isMountpoint(D))throw new U.ErrnoError(10);E.node_ops.rmdir(E,T),U.destroyNode(D)},readdir(x){var y=U.lookupPath(x,{follow:!0}),E=y.node;if(!E.node_ops.readdir)throw new U.ErrnoError(54);return E.node_ops.readdir(E)},unlink(x){var y=U.lookupPath(x,{parent:!0}),E=y.node;if(!E)throw new U.ErrnoError(44);var T=Lt.basename(x),D=U.lookupNode(E,T),X=U.mayDelete(E,T,!1);if(X)throw new U.ErrnoError(X);if(!E.node_ops.unlink)throw new U.ErrnoError(63);if(U.isMountpoint(D))throw new U.ErrnoError(10);E.node_ops.unlink(E,T),U.destroyNode(D)},readlink(x){var y=U.lookupPath(x),E=y.node;if(!E)throw new U.ErrnoError(44);if(!E.node_ops.readlink)throw new U.ErrnoError(28);return gi.resolve(U.getPath(E.parent),E.node_ops.readlink(E))},stat(x,y){var E=U.lookupPath(x,{follow:!y}),T=E.node;if(!T)throw new U.ErrnoError(44);if(!T.node_ops.getattr)throw new U.ErrnoError(63);return T.node_ops.getattr(T)},lstat(x){return U.stat(x,!0)},chmod(x,y,E){var T;if(typeof x=="string"){var D=U.lookupPath(x,{follow:!E});T=D.node}else T=x;if(!T.node_ops.setattr)throw new U.ErrnoError(63);T.node_ops.setattr(T,{mode:y&4095|T.mode&-4096,timestamp:Date.now()})},lchmod(x,y){U.chmod(x,y,!0)},fchmod(x,y){var E=U.getStreamChecked(x);U.chmod(E.node,y)},chown(x,y,E,T){var D;if(typeof x=="string"){var X=U.lookupPath(x,{follow:!T});D=X.node}else D=x;if(!D.node_ops.setattr)throw new U.ErrnoError(63);D.node_ops.setattr(D,{timestamp:Date.now()})},lchown(x,y,E){U.chown(x,y,E,!0)},fchown(x,y,E){var T=U.getStreamChecked(x);U.chown(T.node,y,E)},truncate(x,y){if(y<0)throw new U.ErrnoError(28);var E;if(typeof x=="string"){var T=U.lookupPath(x,{follow:!0});E=T.node}else E=x;if(!E.node_ops.setattr)throw new U.ErrnoError(63);if(U.isDir(E.mode))throw new U.ErrnoError(31);if(!U.isFile(E.mode))throw new U.ErrnoError(28);var D=U.nodePermissions(E,"w");if(D)throw new U.ErrnoError(D);E.node_ops.setattr(E,{size:y,timestamp:Date.now()})},ftruncate(x,y){var E=U.getStreamChecked(x);if((E.flags&2097155)===0)throw new U.ErrnoError(28);U.truncate(E.node,y)},utime(x,y,E){var T=U.lookupPath(x,{follow:!0}),D=T.node;D.node_ops.setattr(D,{timestamp:Math.max(y,E)})},open(x,y,E){if(x==="")throw new U.ErrnoError(44);y=typeof y=="string"?tk(y):y,E=typeof E>"u"?438:E,y&64?E=E&4095|32768:E=0;var T;if(typeof x=="object")T=x;else{x=Lt.normalize(x);try{var D=U.lookupPath(x,{follow:!(y&131072)});T=D.node}catch{}}var X=!1;if(y&64)if(T){if(y&128)throw new U.ErrnoError(20)}else T=U.mknod(x,E,0),X=!0;if(!T)throw new U.ErrnoError(44);if(U.isChrdev(T.mode)&&(y&=-513),y&65536&&!U.isDir(T.mode))throw new U.ErrnoError(54);if(!X){var j=U.mayOpen(T,y);if(j)throw new U.ErrnoError(j)}y&512&&!X&&U.truncate(T,0),y&=-131713;var te=U.createStream({node:T,path:U.getPath(T),flags:y,seekable:!0,position:0,stream_ops:T.stream_ops,ungotten:[],error:!1});return te.stream_ops.open&&te.stream_ops.open(te),t.logReadFiles&&!(y&1)&&(U.readFiles||(U.readFiles={}),x in U.readFiles||(U.readFiles[x]=1)),te},close(x){if(U.isClosed(x))throw new U.ErrnoError(8);x.getdents&&(x.getdents=null);try{x.stream_ops.close&&x.stream_ops.close(x)}catch(y){throw y}finally{U.closeStream(x.fd)}x.fd=null},isClosed(x){return x.fd===null},llseek(x,y,E){if(U.isClosed(x))throw new U.ErrnoError(8);if(!x.seekable||!x.stream_ops.llseek)throw new U.ErrnoError(70);if(E!=0&&E!=1&&E!=2)throw new U.ErrnoError(28);return x.position=x.stream_ops.llseek(x,y,E),x.ungotten=[],x.position},read(x,y,E,T,D){if(F(E>=0),T<0||D<0)throw new U.ErrnoError(28);if(U.isClosed(x))throw new U.ErrnoError(8);if((x.flags&2097155)===1)throw new U.ErrnoError(8);if(U.isDir(x.node.mode))throw new U.ErrnoError(31);if(!x.stream_ops.read)throw new U.ErrnoError(28);var X=typeof D<"u";if(!X)D=x.position;else if(!x.seekable)throw new U.ErrnoError(70);var j=x.stream_ops.read(x,y,E,T,D);return X||(x.position+=j),j},write(x,y,E,T,D,X){if(F(E>=0),T<0||D<0)throw new U.ErrnoError(28);if(U.isClosed(x))throw new U.ErrnoError(8);if((x.flags&2097155)===0)throw new U.ErrnoError(8);if(U.isDir(x.node.mode))throw new U.ErrnoError(31);if(!x.stream_ops.write)throw new U.ErrnoError(28);x.seekable&&x.flags&1024&&U.llseek(x,0,2);var j=typeof D<"u";if(!j)D=x.position;else if(!x.seekable)throw new U.ErrnoError(70);var te=x.stream_ops.write(x,y,E,T,D,X);return j||(x.position+=te),te},allocate(x,y,E){if(U.isClosed(x))throw new U.ErrnoError(8);if(y<0||E<=0)throw new U.ErrnoError(28);if((x.flags&2097155)===0)throw new U.ErrnoError(8);if(!U.isFile(x.node.mode)&&!U.isDir(x.node.mode))throw new U.ErrnoError(43);if(!x.stream_ops.allocate)throw new U.ErrnoError(138);x.stream_ops.allocate(x,y,E)},mmap(x,y,E,T,D){if((T&2)!==0&&(D&2)===0&&(x.flags&2097155)!==2)throw new U.ErrnoError(2);if((x.flags&2097155)===1)throw new U.ErrnoError(2);if(!x.stream_ops.mmap)throw new U.ErrnoError(43);return x.stream_ops.mmap(x,y,E,T,D)},msync(x,y,E,T,D){return F(E>=0),x.stream_ops.msync?x.stream_ops.msync(x,y,E,T,D):0},munmap:x=>0,ioctl(x,y,E){if(!x.stream_ops.ioctl)throw new U.ErrnoError(59);return x.stream_ops.ioctl(x,y,E)},readFile(x,y={}){if(y.flags=y.flags||0,y.encoding=y.encoding||"binary",y.encoding!=="utf8"&&y.encoding!=="binary")throw new Error(`Invalid encoding type "${y.encoding}"`);var E,T=U.open(x,y.flags),D=U.stat(x),X=D.size,j=new Uint8Array(X);return U.read(T,j,0,X,0),y.encoding==="utf8"?E=na(j,0):y.encoding==="binary"&&(E=j),U.close(T),E},writeFile(x,y,E={}){E.flags=E.flags||577;var T=U.open(x,E.flags,E.mode);if(typeof y=="string"){var D=new Uint8Array(ia(y)+1),X=qp(y,D,0,D.length);U.write(T,D,0,X,void 0,E.canOwn)}else if(ArrayBuffer.isView(y))U.write(T,y,0,y.byteLength,void 0,E.canOwn);else throw new Error("Unsupported data type");U.close(T)},cwd:()=>U.currentPath,chdir(x){var y=U.lookupPath(x,{follow:!0});if(y.node===null)throw new U.ErrnoError(44);if(!U.isDir(y.node.mode))throw new U.ErrnoError(54);var E=U.nodePermissions(y.node,"x");if(E)throw new U.ErrnoError(E);U.currentPath=y.path},createDefaultDirectories(){U.mkdir("/tmp"),U.mkdir("/home"),U.mkdir("/home/web_user")},createDefaultDevices(){U.mkdir("/dev"),U.registerDevice(U.makedev(1,3),{read:()=>0,write:(T,D,X,j,te)=>j}),U.mkdev("/dev/null",U.makedev(1,3)),qi.register(U.makedev(5,0),qi.default_tty_ops),qi.register(U.makedev(6,0),qi.default_tty1_ops),U.mkdev("/dev/tty",U.makedev(5,0)),U.mkdev("/dev/tty1",U.makedev(6,0));var x=new Uint8Array(1024),y=0,E=()=>(y===0&&(y=Gp(x).byteLength),x[--y]);U.createDevice("/dev","random",E),U.createDevice("/dev","urandom",E),U.mkdir("/dev/shm"),U.mkdir("/dev/shm/tmp")},createSpecialDirectories(){U.mkdir("/proc");var x=U.mkdir("/proc/self");U.mkdir("/proc/self/fd"),U.mount({mount(){var y=U.createNode(x,"fd",16895,73);return y.node_ops={lookup(E,T){var D=+T,X=U.getStreamChecked(D),j={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>X.path}};return j.parent=j,j}},y}},{},"/proc/self/fd")},createStandardStreams(){t.stdin?U.createDevice("/dev","stdin",t.stdin):U.symlink("/dev/tty","/dev/stdin"),t.stdout?U.createDevice("/dev","stdout",null,t.stdout):U.symlink("/dev/tty","/dev/stdout"),t.stderr?U.createDevice("/dev","stderr",null,t.stderr):U.symlink("/dev/tty1","/dev/stderr");var x=U.open("/dev/stdin",0),y=U.open("/dev/stdout",1),E=U.open("/dev/stderr",1);F(x.fd===0,`invalid handle for stdin (${x.fd})`),F(y.fd===1,`invalid handle for stdout (${y.fd})`),F(E.fd===2,`invalid handle for stderr (${E.fd})`)},ensureErrnoError(){U.ErrnoError||(U.ErrnoError=function(y,E){this.name="ErrnoError",this.node=E,this.setErrno=function(T){this.errno=T;for(var D in pb)if(pb[D]===T){this.code=D;break}},this.setErrno(y),this.message=rk[y],this.stack&&(Object.defineProperty(this,"stack",{value:new Error().stack,writable:!0}),this.stack=ik(this.stack))},U.ErrnoError.prototype=new Error,U.ErrnoError.prototype.constructor=U.ErrnoError,[44].forEach(x=>{U.genericErrors[x]=new U.ErrnoError(x),U.genericErrors[x].stack="<generic error, no stack>"}))},staticInit(){U.ensureErrnoError(),U.nameTable=new Array(4096),U.mount(ot,{},"/"),U.createDefaultDirectories(),U.createDefaultDevices(),U.createSpecialDirectories(),U.filesystems={MEMFS:ot}},init(x,y,E){F(!U.init.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),U.init.initialized=!0,U.ensureErrnoError(),t.stdin=x||t.stdin,t.stdout=y||t.stdout,t.stderr=E||t.stderr,U.createStandardStreams()},quit(){U.init.initialized=!1,qb(0);for(var x=0;x<U.streams.length;x++){var y=U.streams[x];!y||U.close(y)}},findObject(x,y){var E=U.analyzePath(x,y);return E.exists?E.object:null},analyzePath(x,y){try{var E=U.lookupPath(x,{follow:!y});x=E.path}catch{}var T={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var E=U.lookupPath(x,{parent:!0});T.parentExists=!0,T.parentPath=E.path,T.parentObject=E.node,T.name=Lt.basename(x),E=U.lookupPath(x,{follow:!y}),T.exists=!0,T.path=E.path,T.object=E.node,T.name=E.node.name,T.isRoot=E.path==="/"}catch(D){T.error=D.errno}return T},createPath(x,y,E,T){x=typeof x=="string"?x:U.getPath(x);for(var D=y.split("/").reverse();D.length;){var X=D.pop();if(!!X){var j=Lt.join2(x,X);try{U.mkdir(j)}catch{}x=j}}return j},createFile(x,y,E,T,D){var X=Lt.join2(typeof x=="string"?x:U.getPath(x),y),j=Yp(T,D);return U.create(X,j)},createDataFile(x,y,E,T,D,X){var j=y;x&&(x=typeof x=="string"?x:U.getPath(x),j=y?Lt.join2(x,y):x);var te=Yp(T,D),le=U.create(j,te);if(E){if(typeof E=="string"){for(var fe=new Array(E.length),ve=0,Ie=E.length;ve<Ie;++ve)fe[ve]=E.charCodeAt(ve);E=fe}U.chmod(le,te|146);var Se=U.open(le,577);U.write(Se,E,0,E.length,0,X),U.close(Se),U.chmod(le,te)}},createDevice(x,y,E,T){var D=Lt.join2(typeof x=="string"?x:U.getPath(x),y),X=Yp(!!E,!!T);U.createDevice.major||(U.createDevice.major=64);var j=U.makedev(U.createDevice.major++,0);return U.registerDevice(j,{open(te){te.seekable=!1},close(te){var le;(le=T==null?void 0:T.buffer)!=null&&le.length&&T(10)},read(te,le,fe,ve,Ie){for(var Se=0,Me=0;Me<ve;Me++){var De;try{De=E()}catch{throw new U.ErrnoError(29)}if(De===void 0&&Se===0)throw new U.ErrnoError(6);if(De==null)break;Se++,le[fe+Me]=De}return Se&&(te.node.timestamp=Date.now()),Se},write(te,le,fe,ve,Ie){for(var Se=0;Se<ve;Se++)try{T(le[fe+Se])}catch{throw new U.ErrnoError(29)}return ve&&(te.node.timestamp=Date.now()),Se}}),U.mkdev(D,X,j)},forceLoadFile(x){if(x.isDevice||x.isFolder||x.link||x.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(p)try{x.contents=Mc(p(x.url),!0),x.usedBytes=x.contents.length}catch{throw new U.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(x,y,E,T,D){function X(){this.lengthKnown=!1,this.chunks=[]}if(X.prototype.get=function(Me){if(!(Me>this.length-1||Me<0)){var De=Me%this.chunkSize,Je=Me/this.chunkSize|0;return this.getter(Je)[De]}},X.prototype.setDataGetter=function(Me){this.getter=Me},X.prototype.cacheLength=function(){var Me=new XMLHttpRequest;if(Me.open("HEAD",E,!1),Me.send(null),!(Me.status>=200&&Me.status<300||Me.status===304))throw new Error("Couldn't load "+E+". Status: "+Me.status);var De=Number(Me.getResponseHeader("Content-length")),Je,ur=(Je=Me.getResponseHeader("Accept-Ranges"))&&Je==="bytes",Ft=(Je=Me.getResponseHeader("Content-Encoding"))&&Je==="gzip",Ee=1024*1024;ur||(Ee=De);var $e=(It,Lr)=>{if(It>Lr)throw new Error("invalid range ("+It+", "+Lr+") or no bytes requested!");if(Lr>De-1)throw new Error("only "+De+" bytes available! programmer error!");var Vt=new XMLHttpRequest;if(Vt.open("GET",E,!1),De!==Ee&&Vt.setRequestHeader("Range","bytes="+It+"-"+Lr),Vt.responseType="arraybuffer",Vt.overrideMimeType&&Vt.overrideMimeType("text/plain; charset=x-user-defined"),Vt.send(null),!(Vt.status>=200&&Vt.status<300||Vt.status===304))throw new Error("Couldn't load "+E+". Status: "+Vt.status);return Vt.response!==void 0?new Uint8Array(Vt.response||[]):Mc(Vt.responseText||"",!0)},nr=this;nr.setDataGetter(It=>{var Lr=It*Ee,Vt=(It+1)*Ee-1;if(Vt=Math.min(Vt,De-1),typeof nr.chunks[It]>"u"&&(nr.chunks[It]=$e(Lr,Vt)),typeof nr.chunks[It]>"u")throw new Error("doXHR failed!");return nr.chunks[It]}),(Ft||!De)&&(Ee=De=1,De=this.getter(0).length,Ee=De,v("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=De,this._chunkSize=Ee,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!c)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var j=new X;Object.defineProperties(j,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var te={isDevice:!1,contents:j}}else var te={isDevice:!1,url:E};var le=U.createFile(x,y,te,T,D);te.contents?le.contents=te.contents:te.url&&(le.contents=null,le.url=te.url),Object.defineProperties(le,{usedBytes:{get:function(){return this.contents.length}}});var fe={},ve=Object.keys(le.stream_ops);ve.forEach(Se=>{var Me=le.stream_ops[Se];fe[Se]=function(){return U.forceLoadFile(le),Me.apply(null,arguments)}});function Ie(Se,Me,De,Je,ur){var Ft=Se.node.contents;if(ur>=Ft.length)return 0;var Ee=Math.min(Ft.length-ur,Je);if(F(Ee>=0),Ft.slice)for(var $e=0;$e<Ee;$e++)Me[De+$e]=Ft[ur+$e];else for(var $e=0;$e<Ee;$e++)Me[De+$e]=Ft.get(ur+$e);return Ee}return fe.read=(Se,Me,De,Je,ur)=>(U.forceLoadFile(le),Ie(Se,Me,De,Je,ur)),fe.mmap=(Se,Me,De,Je,ur)=>{U.forceLoadFile(le);var Ft=fb(Me);if(!Ft)throw new U.ErrnoError(48);return Ie(Se,L,Ft,Me,De),{ptr:Ft,allocated:!0}},le.stream_ops=fe,le},absolutePath(){St("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder(){St("FS.createFolder has been removed; use FS.mkdir instead")},createLink(){St("FS.createLink has been removed; use FS.symlink instead")},joinPath(){St("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc(){St("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath(){St("FS.standardizePath has been removed; use PATH.normalize instead")}},dt={DEFAULT_POLLMASK:5,calculateAt(x,y,E){if(Lt.isAbs(y))return y;var T;if(x===-100)T=U.cwd();else{var D=dt.getStreamFromFD(x);T=D.path}if(y.length==0){if(!E)throw new U.ErrnoError(44);return T}return Lt.join2(T,y)},doStat(x,y,E){try{var T=x(y)}catch(te){if(te&&te.node&&Lt.normalize(y)!==Lt.normalize(U.getPath(te.node)))return-54;throw te}W[E>>2]=T.dev,W[E+4>>2]=T.mode,Q[E+8>>2]=T.nlink,W[E+12>>2]=T.uid,W[E+16>>2]=T.gid,W[E+20>>2]=T.rdev,Rt=[T.size>>>0,(He=T.size,+Math.abs(He)>=1?He>0?+Math.floor(He/4294967296)>>>0:~~+Math.ceil((He-+(~~He>>>0))/4294967296)>>>0:0)],W[E+24>>2]=Rt[0],W[E+28>>2]=Rt[1],W[E+32>>2]=4096,W[E+36>>2]=T.blocks;var D=T.atime.getTime(),X=T.mtime.getTime(),j=T.ctime.getTime();return Rt=[Math.floor(D/1e3)>>>0,(He=Math.floor(D/1e3),+Math.abs(He)>=1?He>0?+Math.floor(He/4294967296)>>>0:~~+Math.ceil((He-+(~~He>>>0))/4294967296)>>>0:0)],W[E+40>>2]=Rt[0],W[E+44>>2]=Rt[1],Q[E+48>>2]=D%1e3*1e3,Rt=[Math.floor(X/1e3)>>>0,(He=Math.floor(X/1e3),+Math.abs(He)>=1?He>0?+Math.floor(He/4294967296)>>>0:~~+Math.ceil((He-+(~~He>>>0))/4294967296)>>>0:0)],W[E+56>>2]=Rt[0],W[E+60>>2]=Rt[1],Q[E+64>>2]=X%1e3*1e3,Rt=[Math.floor(j/1e3)>>>0,(He=Math.floor(j/1e3),+Math.abs(He)>=1?He>0?+Math.floor(He/4294967296)>>>0:~~+Math.ceil((He-+(~~He>>>0))/4294967296)>>>0:0)],W[E+72>>2]=Rt[0],W[E+76>>2]=Rt[1],Q[E+80>>2]=j%1e3*1e3,Rt=[T.ino>>>0,(He=T.ino,+Math.abs(He)>=1?He>0?+Math.floor(He/4294967296)>>>0:~~+Math.ceil((He-+(~~He>>>0))/4294967296)>>>0:0)],W[E+88>>2]=Rt[0],W[E+92>>2]=Rt[1],0},doMsync(x,y,E,T,D){if(!U.isFile(y.node.mode))throw new U.ErrnoError(43);if(T&2)return 0;var X=k.slice(x,x+E);U.msync(y,X,D,E,T)},varargs:void 0,get(){F(dt.varargs!=null);var x=W[+dt.varargs>>2];return dt.varargs+=4,x},getp(){return dt.get()},getStr(x){var y=Nn(x);return y},getStreamFromFD(x){var y=U.getStreamChecked(x);return y}};function sk(x,y){try{return x=dt.getStr(x),U.chmod(x,y),0}catch(E){if(typeof U>"u"||E.name!=="ErrnoError")throw E;return-E.errno}}function ok(x,y,E,T){try{if(y=dt.getStr(y),F(T===0),y=dt.calculateAt(x,y),E&-8)return-28;var D=U.lookupPath(y,{follow:!0}),X=D.node;if(!X)return-44;var j="";return E&4&&(j+="r"),E&2&&(j+="w"),E&1&&(j+="x"),j&&U.nodePermissions(X,j)?-2:0}catch(te){if(typeof U>"u"||te.name!=="ErrnoError")throw te;return-te.errno}}var ak=x=>(W[ZU()>>2]=x,x);function lk(x,y,E){dt.varargs=E;try{var T=dt.getStreamFromFD(x);switch(y){case 0:{var D=dt.get();if(D<0)return-28;for(;U.streams[D];)D++;var X;return X=U.createStream(T,D),X.fd}case 1:case 2:return 0;case 3:return T.flags;case 4:{var D=dt.get();return T.flags|=D,0}case 5:{var D=dt.getp(),j=0;return O[D+j>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return ak(28),-1;default:return-28}}catch(te){if(typeof U>"u"||te.name!=="ErrnoError")throw te;return-te.errno}}function uk(x,y){try{var E=dt.getStreamFromFD(x);return dt.doStat(U.stat,E.path,y)}catch(T){if(typeof U>"u"||T.name!=="ErrnoError")throw T;return-T.errno}}var Dl=(x,y,E)=>(F(typeof E=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),qp(x,k,y,E));function ck(x,y,E){try{var T=dt.getStreamFromFD(x);T.getdents||(T.getdents=U.readdir(T.path));for(var D=280,X=0,j=U.llseek(T,0,1),te=Math.floor(j/D);te<T.getdents.length&&X+D<=E;){var le,fe,ve=T.getdents[te];if(ve===".")le=T.node.id,fe=4;else if(ve===".."){var Ie=U.lookupPath(T.path,{parent:!0});le=Ie.node.id,fe=4}else{var Se=U.lookupNode(T.node,ve);le=Se.id,fe=U.isChrdev(Se.mode)?2:U.isDir(Se.mode)?4:U.isLink(Se.mode)?10:8}F(le),Rt=[le>>>0,(He=le,+Math.abs(He)>=1?He>0?+Math.floor(He/4294967296)>>>0:~~+Math.ceil((He-+(~~He>>>0))/4294967296)>>>0:0)],W[y+X>>2]=Rt[0],W[y+X+4>>2]=Rt[1],Rt=[(te+1)*D>>>0,(He=(te+1)*D,+Math.abs(He)>=1?He>0?+Math.floor(He/4294967296)>>>0:~~+Math.ceil((He-+(~~He>>>0))/4294967296)>>>0:0)],W[y+X+8>>2]=Rt[0],W[y+X+12>>2]=Rt[1],O[y+X+16>>1]=280,L[y+X+18>>0]=fe,Dl(ve,y+X+19,256),X+=D,te+=1}return U.llseek(T,te*D,0),X}catch(Me){if(typeof U>"u"||Me.name!=="ErrnoError")throw Me;return-Me.errno}}function hk(x,y,E){dt.varargs=E;try{var T=dt.getStreamFromFD(x);switch(y){case 21509:return T.tty?0:-59;case 21505:{if(!T.tty)return-59;if(T.tty.ops.ioctl_tcgets){var D=T.tty.ops.ioctl_tcgets(T),X=dt.getp();W[X>>2]=D.c_iflag||0,W[X+4>>2]=D.c_oflag||0,W[X+8>>2]=D.c_cflag||0,W[X+12>>2]=D.c_lflag||0;for(var j=0;j<32;j++)L[X+j+17>>0]=D.c_cc[j]||0;return 0}return 0}case 21510:case 21511:case 21512:return T.tty?0:-59;case 21506:case 21507:case 21508:{if(!T.tty)return-59;if(T.tty.ops.ioctl_tcsets){for(var X=dt.getp(),te=W[X>>2],le=W[X+4>>2],fe=W[X+8>>2],ve=W[X+12>>2],Ie=[],j=0;j<32;j++)Ie.push(L[X+j+17>>0]);return T.tty.ops.ioctl_tcsets(T.tty,y,{c_iflag:te,c_oflag:le,c_cflag:fe,c_lflag:ve,c_cc:Ie})}return 0}case 21519:{if(!T.tty)return-59;var X=dt.getp();return W[X>>2]=0,0}case 21520:return T.tty?-28:-59;case 21531:{var X=dt.getp();return U.ioctl(T,y,X)}case 21523:{if(!T.tty)return-59;if(T.tty.ops.ioctl_tiocgwinsz){var Se=T.tty.ops.ioctl_tiocgwinsz(T.tty),X=dt.getp();O[X>>1]=Se[0],O[X+2>>1]=Se[1]}return 0}case 21524:return T.tty?0:-59;case 21515:return T.tty?0:-59;default:return-28}}catch(Me){if(typeof U>"u"||Me.name!=="ErrnoError")throw Me;return-Me.errno}}function dk(x,y){try{return x=dt.getStr(x),dt.doStat(U.lstat,x,y)}catch(E){if(typeof U>"u"||E.name!=="ErrnoError")throw E;return-E.errno}}function fk(x,y,E){try{return y=dt.getStr(y),y=dt.calculateAt(x,y),y=Lt.normalize(y),y[y.length-1]==="/"&&(y=y.substr(0,y.length-1)),U.mkdir(y,E,0),0}catch(T){if(typeof U>"u"||T.name!=="ErrnoError")throw T;return-T.errno}}function pk(x,y,E,T){try{y=dt.getStr(y);var D=T&256,X=T&4096;return T=T&-6401,F(!T,`unknown flags in __syscall_newfstatat: ${T}`),y=dt.calculateAt(x,y,X),dt.doStat(D?U.lstat:U.stat,y,E)}catch(j){if(typeof U>"u"||j.name!=="ErrnoError")throw j;return-j.errno}}function mk(x,y,E,T){dt.varargs=T;try{y=dt.getStr(y),y=dt.calculateAt(x,y);var D=T?dt.get():0;return U.open(y,E,D).fd}catch(X){if(typeof U>"u"||X.name!=="ErrnoError")throw X;return-X.errno}}function gk(x,y){try{return x=dt.getStr(x),dt.doStat(U.stat,x,y)}catch(E){if(typeof U>"u"||E.name!=="ErrnoError")throw E;return-E.errno}}var xk=x=>{var y=new WebAssembly.Exception(cb(),[x],{traceStack:!0});if(y.message=db(y),y.stack){var E=y.stack.split(`
`);E.splice(1,1),y.stack=E.join(`
`)}throw y},bk=(x,y,E,T,D)=>{},yk=()=>{for(var x=new Array(256),y=0;y<256;++y)x[y]=String.fromCharCode(y);mb=x},mb,Kn=x=>{for(var y="",E=x;k[E];)y+=mb[k[E++]];return y},sa={},ho={},Nc={},gb,gn=x=>{throw new gb(x)},xb,bb=x=>{throw new xb(x)},vk=(x,y,E)=>{x.forEach(function(te){Nc[te]=y});function T(te){var le=E(te);le.length!==x.length&&bb("Mismatched type converter count");for(var fe=0;fe<x.length;++fe)zi(x[fe],le[fe])}var D=new Array(y.length),X=[],j=0;y.forEach((te,le)=>{ho.hasOwnProperty(te)?D[le]=ho[te]:(X.push(te),sa.hasOwnProperty(te)||(sa[te]=[]),sa[te].push(()=>{D[le]=ho[te],++j,j===X.length&&T(D)}))}),X.length===0&&T(D)};function wk(x,y,E={}){var T=y.name;if(x||gn(`type "${T}" must have a positive integer typeid pointer`),ho.hasOwnProperty(x)){if(E.ignoreDuplicateRegistrations)return;gn(`Cannot register type '${T}' twice`)}if(ho[x]=y,delete Nc[x],sa.hasOwnProperty(x)){var D=sa[x];delete sa[x],D.forEach(X=>X())}}function zi(x,y,E={}){if(!("argPackAdvance"in y))throw new TypeError("registerType registeredInstance requires argPackAdvance");return wk(x,y,E)}var fo=8,Ek=(x,y,E,T)=>{y=Kn(y),zi(x,{name:y,fromWireType:function(D){return!!D},toWireType:function(D,X){return X?E:T},argPackAdvance:fo,readValueFromPointer:function(D){return this.fromWireType(k[D])},destructorFunction:null})};function _k(){Object.assign(yb.prototype,{get(x){return F(this.allocated[x]!==void 0,`invalid handle: ${x}`),this.allocated[x]},has(x){return this.allocated[x]!==void 0},allocate(x){var y=this.freelist.pop()||this.allocated.length;return this.allocated[y]=x,y},free(x){F(this.allocated[x]!==void 0),this.allocated[x]=void 0,this.freelist.push(x)}})}function yb(){this.allocated=[void 0],this.freelist=[]}var Rn=new yb,vb=x=>{x>=Rn.reserved&&--Rn.get(x).refcount===0&&Rn.free(x)},Pk=()=>{for(var x=0,y=Rn.reserved;y<Rn.allocated.length;++y)Rn.allocated[y]!==void 0&&++x;return x},Sk=()=>{Rn.allocated.push({value:void 0},{value:null},{value:!0},{value:!1}),Rn.reserved=Rn.allocated.length,t.count_emval_handles=Pk},Xp={toValue:x=>(x||gn("Cannot use deleted val. handle = "+x),Rn.get(x).value),toHandle:x=>{switch(x){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return Rn.allocate({refcount:1,value:x})}}};function wb(x){return this.fromWireType(W[x>>2])}var Ik=(x,y)=>{y=Kn(y),zi(x,{name:y,fromWireType:E=>{var T=Xp.toValue(E);return vb(E),T},toWireType:(E,T)=>Xp.toHandle(T),argPackAdvance:fo,readValueFromPointer:wb,destructorFunction:null})},Vp=x=>{if(x===null)return"null";var y=typeof x;return y==="object"||y==="array"||y==="function"?x.toString():""+x},Bk=(x,y)=>{switch(y){case 4:return function(E){return this.fromWireType(oe[E>>2])};case 8:return function(E){return this.fromWireType(we[E>>3])};default:throw new TypeError(`invalid float width (${y}): ${x}`)}},Ak=(x,y,E)=>{y=Kn(y),zi(x,{name:y,fromWireType:T=>T,toWireType:(T,D)=>{if(typeof D!="number"&&typeof D!="boolean")throw new TypeError(`Cannot convert ${Vp(D)} to ${this.name}`);return D},argPackAdvance:fo,readValueFromPointer:Bk(y,E),destructorFunction:null})},Wp=(x,y)=>Object.defineProperty(y,"name",{value:x}),Tk=x=>{for(;x.length;){var y=x.pop(),E=x.pop();E(y)}};function Eb(x){for(var y=1;y<x.length;++y)if(x[y]!==null&&x[y].destructorFunction===void 0)return!0;return!1}function Ck(x,y){if(!(x instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof x} which is not a function`);var E=Wp(x.name||"unknownFunctionName",function(){});E.prototype=x.prototype;var T=new E,D=x.apply(T,y);return D instanceof Object?D:T}function Mk(x,y,E,T,D){for(var X=Eb(y),j=y.length,te="",le="",fe=0;fe<j-2;++fe)te+=(fe!==0?", ":"")+"arg"+fe,le+=(fe!==0?", ":"")+"arg"+fe+"Wired";var ve=`
        return function (${te}) {
        if (arguments.length !== ${j-2}) {
          throwBindingError('function ${x} called with ' + arguments.length + ' arguments, expected ${j-2}');
        }`;X&&(ve+=`var destructors = [];
`);var Ie=X?"destructors":"null",Se=["throwBindingError","invoker","fn","runDestructors","retType","classParam"];E&&(ve+="var thisWired = classParam['toWireType']("+Ie+`, this);
`);for(var fe=0;fe<j-2;++fe)ve+="var arg"+fe+"Wired = argType"+fe+"['toWireType']("+Ie+", arg"+fe+"); // "+y[fe+2].name+`
`,Se.push("argType"+fe);if(E&&(le="thisWired"+(le.length>0?", ":"")+le),ve+=(T||D?"var rv = ":"")+"invoker(fn"+(le.length>0?", ":"")+le+`);
`,X)ve+=`runDestructors(destructors);
`;else for(var fe=E?1:2;fe<y.length;++fe){var Me=fe===1?"thisWired":"arg"+(fe-2)+"Wired";y[fe].destructorFunction!==null&&(ve+=Me+"_dtor("+Me+"); // "+y[fe].name+`
`,Se.push(Me+"_dtor"))}return T&&(ve+=`var ret = retType['fromWireType'](rv);
return ret;
`),ve+=`}
`,ve=`if (arguments.length !== ${Se.length}){ throw new Error("${x} Expected ${Se.length} closure arguments " + arguments.length + " given."); }
${ve}`,[Se,ve]}function Nk(x,y,E,T,D,X){var j=y.length;j<2&&gn("argTypes array size mismatch! Must at least get return value and 'this' types!"),F(!X,"Async bindings are only supported with JSPI.");for(var te=y[1]!==null&&E!==null,le=Eb(y),fe=y[0].name!=="void",ve=[gn,T,D,Tk,y[0],y[1]],Ie=0;Ie<j-2;++Ie)ve.push(y[Ie+2]);if(!le)for(var Ie=te?1:2;Ie<y.length;++Ie)y[Ie].destructorFunction!==null&&ve.push(y[Ie].destructorFunction);let[Se,Me]=Mk(x,y,te,fe,X);Se.push(Me);var De=Ck(Function,Se).apply(null,ve);return Wp(x,De)}var Rk=(x,y,E)=>{if(x[y].overloadTable===void 0){var T=x[y];x[y]=function(){return x[y].overloadTable.hasOwnProperty(arguments.length)||gn(`Function '${E}' called with an invalid number of arguments (${arguments.length}) - expects one of (${x[y].overloadTable})!`),x[y].overloadTable[arguments.length].apply(this,arguments)},x[y].overloadTable=[],x[y].overloadTable[T.argCount]=T}},Lk=(x,y,E)=>{t.hasOwnProperty(x)?((E===void 0||t[x].overloadTable!==void 0&&t[x].overloadTable[E]!==void 0)&&gn(`Cannot register public name '${x}' twice`),Rk(t,x,x),t.hasOwnProperty(E)&&gn(`Cannot register multiple overloads of a function with the same number of arguments (${E})!`),t[x].overloadTable[E]=y):(t[x]=y,E!==void 0&&(t[x].numArguments=E))},Ok=(x,y)=>{for(var E=[],T=0;T<x;T++)E.push(Q[y+T*4>>2]);return E},kk=(x,y,E)=>{t.hasOwnProperty(x)||bb("Replacing nonexistant public symbol"),t[x].overloadTable!==void 0&&E!==void 0?t[x].overloadTable[E]=y:(t[x]=y,t[x].argCount=E)},Uk=(x,y,E)=>{F("dynCall_"+x in t,`bad function pointer type - dynCall function not found for sig '${x}'`),E!=null&&E.length?F(E.length===x.substring(1).replace(/j/g,"--").length):F(x.length==1);var T=t["dynCall_"+x];return E&&E.length?T.apply(null,[y].concat(E)):T.call(null,y)},Rc=[],Lc,$p=x=>{var y=Rc[x];return y||(x>=Rc.length&&(Rc.length=x+1),Rc[x]=y=Lc.get(x)),F(Lc.get(x)==y,"JavaScript-side Wasm function table mirror is out of date!"),y},Dk=(x,y,E)=>{if(x.includes("j"))return Uk(x,y,E);F($p(y),`missing table entry in dynCall: ${y}`);var T=$p(y).apply(null,E);return T},Gk=(x,y)=>{F(x.includes("j")||x.includes("p"),"getDynCaller should only be called with i64 sigs");var E=[];return function(){return E.length=0,Object.assign(E,arguments),Dk(x,y,E)}},Fk=(x,y)=>{x=Kn(x);function E(){return x.includes("j")?Gk(x,y):$p(y)}var T=E();return typeof T!="function"&&gn(`unknown function pointer with signature ${x}: ${y}`),T},qk=(x,y)=>{var E=Wp(y,function(T){this.name=y,this.message=T;var D=new Error(T).stack;D!==void 0&&(this.stack=this.toString()+`
`+D.replace(/^Error(:[^\n]*)?\n/,""))});return E.prototype=Object.create(x.prototype),E.prototype.constructor=E,E.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},E},_b,Pb=x=>{var y=KU(x),E=Kn(y);return xi(y),E},zk=(x,y)=>{var E=[],T={};function D(X){if(!T[X]&&!ho[X]){if(Nc[X]){Nc[X].forEach(D);return}E.push(X),T[X]=!0}}throw y.forEach(D),new _b(`${x}: `+E.map(Pb).join([", "]))},Yk=x=>{x=x.trim();let y=x.indexOf("(");return y!==-1?(F(x[x.length-1]==")","Parentheses for argument names should match."),x.substr(0,y)):x},Xk=(x,y,E,T,D,X,j)=>{var te=Ok(y,E);x=Kn(x),x=Yk(x),D=Fk(T,D),Lk(x,function(){zk(`Cannot call ${x} due to unbound types`,te)},y-1),vk([],te,function(le){var fe=[le[0],null].concat(le.slice(1));return kk(x,Nk(x,fe,null,D,X,j),y-1),[]})},Vk=(x,y,E)=>{switch(y){case 1:return E?T=>L[T>>0]:T=>k[T>>0];case 2:return E?T=>O[T>>1]:T=>ie[T>>1];case 4:return E?T=>W[T>>2]:T=>Q[T>>2];default:throw new TypeError(`invalid integer width (${y}): ${x}`)}},Wk=(x,y,E,T,D)=>{y=Kn(y),D===-1&&(D=4294967295);var X=ve=>ve;if(T===0){var j=32-8*E;X=ve=>ve<<j>>>j}var te=y.includes("unsigned"),le=(ve,Ie)=>{if(typeof ve!="number"&&typeof ve!="boolean")throw new TypeError(`Cannot convert "${Vp(ve)}" to ${Ie}`);if(ve<T||ve>D)throw new TypeError(`Passing a number "${Vp(ve)}" from JS side to C/C++ side to an argument of type "${y}", which is outside the valid range [${T}, ${D}]!`)},fe;te?fe=function(ve,Ie){return le(Ie,this.name),Ie>>>0}:fe=function(ve,Ie){return le(Ie,this.name),Ie},zi(x,{name:y,fromWireType:X,toWireType:fe,argPackAdvance:fo,readValueFromPointer:Vk(y,E,T!==0),destructorFunction:null})},$k=(x,y,E)=>{var T=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],D=T[y];function X(j){var te=Q[j>>2],le=Q[j+4>>2];return new D(L.buffer,le,te)}E=Kn(E),zi(x,{name:E,fromWireType:X,argPackAdvance:fo,readValueFromPointer:X},{ignoreDuplicateRegistrations:!0})};function jk(x){return this.fromWireType(Q[x>>2])}var Hk=(x,y)=>{y=Kn(y);var E=y==="std::string";zi(x,{name:y,fromWireType(T){var D=Q[T>>2],X=T+4,j;if(E)for(var te=X,le=0;le<=D;++le){var fe=X+le;if(le==D||k[fe]==0){var ve=fe-te,Ie=Nn(te,ve);j===void 0?j=Ie:(j+=String.fromCharCode(0),j+=Ie),te=fe+1}}else{for(var Se=new Array(D),le=0;le<D;++le)Se[le]=String.fromCharCode(k[X+le]);j=Se.join("")}return xi(T),j},toWireType(T,D){D instanceof ArrayBuffer&&(D=new Uint8Array(D));var X,j=typeof D=="string";j||D instanceof Uint8Array||D instanceof Uint8ClampedArray||D instanceof Int8Array||gn("Cannot pass non-string to std::string"),E&&j?X=ia(D):X=D.length;var te=po(4+X+1),le=te+4;if(Q[te>>2]=X,E&&j)Dl(D,le,X+1);else if(j)for(var fe=0;fe<X;++fe){var ve=D.charCodeAt(fe);ve>255&&(xi(le),gn("String has UTF-16 code units that do not fit in 8 bits")),k[le+fe]=ve}else for(var fe=0;fe<X;++fe)k[le+fe]=D[fe];return T!==null&&T.push(xi,te),te},argPackAdvance:fo,readValueFromPointer:jk,destructorFunction(T){xi(T)}})},Sb=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Zk=(x,y)=>{F(x%2==0,"Pointer passed to UTF16ToString must be aligned to two bytes!");for(var E=x,T=E>>1,D=T+y/2;!(T>=D)&&ie[T];)++T;if(E=T<<1,E-x>32&&Sb)return Sb.decode(k.subarray(x,E));for(var X="",j=0;!(j>=y/2);++j){var te=O[x+j*2>>1];if(te==0)break;X+=String.fromCharCode(te)}return X},Kk=(x,y,E)=>{if(F(y%2==0,"Pointer passed to stringToUTF16 must be aligned to two bytes!"),F(typeof E=="number","stringToUTF16(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),E!=null||(E=2147483647),E<2)return 0;E-=2;for(var T=y,D=E<x.length*2?E/2:x.length,X=0;X<D;++X){var j=x.charCodeAt(X);O[y>>1]=j,y+=2}return O[y>>1]=0,y-T},Qk=x=>x.length*2,Jk=(x,y)=>{F(x%4==0,"Pointer passed to UTF32ToString must be aligned to four bytes!");for(var E=0,T="";!(E>=y/4);){var D=W[x+E*4>>2];if(D==0)break;if(++E,D>=65536){var X=D-65536;T+=String.fromCharCode(55296|X>>10,56320|X&1023)}else T+=String.fromCharCode(D)}return T},eU=(x,y,E)=>{if(F(y%4==0,"Pointer passed to stringToUTF32 must be aligned to four bytes!"),F(typeof E=="number","stringToUTF32(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),E!=null||(E=2147483647),E<4)return 0;for(var T=y,D=T+E-4,X=0;X<x.length;++X){var j=x.charCodeAt(X);if(j>=55296&&j<=57343){var te=x.charCodeAt(++X);j=65536+((j&1023)<<10)|te&1023}if(W[y>>2]=j,y+=4,y+4>D)break}return W[y>>2]=0,y-T},tU=x=>{for(var y=0,E=0;E<x.length;++E){var T=x.charCodeAt(E);T>=55296&&T<=57343&&++E,y+=4}return y},rU=(x,y,E)=>{E=Kn(E);var T,D,X,j,te;y===2?(T=Zk,D=Kk,j=Qk,X=()=>ie,te=1):y===4&&(T=Jk,D=eU,j=tU,X=()=>Q,te=2),zi(x,{name:E,fromWireType:le=>{for(var fe=Q[le>>2],ve=X(),Ie,Se=le+4,Me=0;Me<=fe;++Me){var De=le+4+Me*y;if(Me==fe||ve[De>>te]==0){var Je=De-Se,ur=T(Se,Je);Ie===void 0?Ie=ur:(Ie+=String.fromCharCode(0),Ie+=ur),Se=De+y}}return xi(le),Ie},toWireType:(le,fe)=>{typeof fe!="string"&&gn(`Cannot pass non-string to C++ string type ${E}`);var ve=j(fe),Ie=po(4+ve+y);return Q[Ie>>2]=ve>>te,D(fe,Ie+4,ve+y),le!==null&&le.push(xi,Ie),Ie},argPackAdvance:fo,readValueFromPointer:wb,destructorFunction(le){xi(le)}})},nU=(x,y)=>{y=Kn(y),zi(x,{isVoid:!0,name:y,argPackAdvance:0,fromWireType:()=>{},toWireType:(E,T)=>{}})},iU=1,sU=()=>iU,oU=x=>{x>4&&(Rn.get(x).refcount+=1)},aU=(x,y)=>{var E=ho[x];return E===void 0&&gn(y+" has unknown type "+Pb(x)),E},lU=(x,y)=>{x=aU(x,"_emval_take_value");var E=x.readValueFromPointer(y);return Xp.toHandle(E)},Gl=x=>x%4===0&&(x%100!==0||x%400===0),uU=[0,31,60,91,121,152,182,213,244,274,305,335],cU=[0,31,59,90,120,151,181,212,243,273,304,334],hU=x=>{var y=Gl(x.getFullYear()),E=y?uU:cU,T=E[x.getMonth()]+x.getDate()-1;return T},Ib=(x,y)=>(F(x==x>>>0||x==(x|0)),F(y===(y|0)),y+2097152>>>0<4194305-!!x?(x>>>0)+y*4294967296:NaN);function dU(x,y,E){var T=Ib(x,y),D=new Date(T*1e3);W[E>>2]=D.getSeconds(),W[E+4>>2]=D.getMinutes(),W[E+8>>2]=D.getHours(),W[E+12>>2]=D.getDate(),W[E+16>>2]=D.getMonth(),W[E+20>>2]=D.getFullYear()-1900,W[E+24>>2]=D.getDay();var X=hU(D)|0;W[E+28>>2]=X,W[E+36>>2]=-(D.getTimezoneOffset()*60);var j=new Date(D.getFullYear(),0,1),te=new Date(D.getFullYear(),6,1).getTimezoneOffset(),le=j.getTimezoneOffset(),fe=(te!=le&&D.getTimezoneOffset()==Math.min(le,te))|0;W[E+32>>2]=fe}var jp=x=>{var y=ia(x)+1,E=po(y);return E&&Dl(x,E,y),E},fU=(x,y,E)=>{var T=new Date().getFullYear(),D=new Date(T,0,1),X=new Date(T,6,1),j=D.getTimezoneOffset(),te=X.getTimezoneOffset(),le=Math.max(j,te);Q[x>>2]=le*60,W[y>>2]=Number(j!=te);function fe(De){var Je=De.toTimeString().match(/\(([A-Za-z ]+)\)$/);return Je?Je[1]:"GMT"}var ve=fe(D),Ie=fe(X),Se=jp(ve),Me=jp(Ie);te<j?(Q[E>>2]=Se,Q[E+4>>2]=Me):(Q[E>>2]=Me,Q[E+4>>2]=Se)},pU=()=>{St("native code called abort()")},mU=()=>Date.now();function gU(){var x=new Error;if(!x.stack){try{throw new Error}catch(y){x=y}if(!x.stack)return"(no stack trace available)"}return x.stack.toString()}function xU(x){var y=gU(),E=y.lastIndexOf("_emscripten_log"),T=y.lastIndexOf("_emscripten_get_callstack"),D=y.indexOf(`
`,Math.max(E,T))+1;y=y.slice(D),x&8&&typeof emscripten_source_map>"u"&&(mn('Source map information is not available, emscripten_log with EM_LOG_C_STACK will be ignored. Build with "--pre-js $EMSCRIPTEN/src/emscripten-source-map.min.js" linker flag to add source map loading to code.'),x^=8,x|=16);var X=y.split(`
`);y="";var j=new RegExp("\\s*(.*?)@(.*?):([0-9]+):([0-9]+)"),te=new RegExp("\\s*(.*?)@(.*):(.*)(:(.*))?"),le=new RegExp("\\s*at (.*?) \\((.*):(.*):(.*)\\)");for(var fe in X){var ve=X[fe],Ie="",Se="",Me=0,De=0,Je=le.exec(ve);if(Je&&Je.length==5)Ie=Je[1],Se=Je[2],Me=Je[3],De=Je[4];else if(Je=j.exec(ve),Je||(Je=te.exec(ve)),Je&&Je.length>=4)Ie=Je[1],Se=Je[2],Me=Je[3],De=Je[4]|0;else{y+=ve+`
`;continue}var ur=!1;if(x&8){var Ft=emscripten_source_map.originalPositionFor({line:Me,column:De});ur=Ft==null?void 0:Ft.source,ur&&(x&64&&(Ft.source=Ft.source.substring(Ft.source.replace(/\\/g,"/").lastIndexOf("/")+1)),y+=`    at ${Ie} (${Ft.source}:${Ft.line}:${Ft.column})
`)}(x&16||!ur)&&(x&64&&(Se=Se.substring(Se.replace(/\\/g,"/").lastIndexOf("/")+1)),y+=(ur?`     = ${Ie}`:`    at ${Ie}`)+` (${Se}:${Me}:${De})
`)}return y=y.replace(/\s+$/,""),y}function bU(x,y,E){var T=xU(x);if(!y||E<=0)return ia(T)+1;var D=Dl(T,y,E);return D+1}var Bb=()=>2147483648,yU=()=>Bb(),Oc;Oc=()=>performance.now();var Hp=(x,y)=>{if(ce.mainLoop.timingMode=x,ce.mainLoop.timingValue=y,!ce.mainLoop.func)return w("emscripten_set_main_loop_timing: Cannot set timing mode for main loop since a main loop does not exist! Call emscripten_set_main_loop first to set one up."),1;if(ce.mainLoop.running||(ce.mainLoop.running=!0),x==0)ce.mainLoop.scheduler=function(){var j=Math.max(0,ce.mainLoop.tickStartTime+y-Oc())|0;setTimeout(ce.mainLoop.runner,j)},ce.mainLoop.method="timeout";else if(x==1)ce.mainLoop.scheduler=function(){ce.requestAnimationFrame(ce.mainLoop.runner)},ce.mainLoop.method="rAF";else if(x==2){if(typeof ce.setImmediate>"u")if(typeof setImmediate>"u"){var E=[],T="setimmediate",D=X=>{(X.data===T||X.data.target===T)&&(X.stopPropagation(),E.shift()())};addEventListener("message",D,!0),ce.setImmediate=function(j){E.push(j),c?(t.setImmediates===void 0&&(t.setImmediates=[]),t.setImmediates.push(j),postMessage({target:T})):postMessage(T,"*")}}else ce.setImmediate=setImmediate;ce.mainLoop.scheduler=function(){ce.setImmediate(ce.mainLoop.runner)},ce.mainLoop.method="immediate"}return 0},vU=(x,y,E,T,D)=>{F(!ce.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),ce.mainLoop.func=x,ce.mainLoop.arg=T;var X=(()=>ce.mainLoop.currentlyRunningMainloop)();function j(){return!(X<ce.mainLoop.currentlyRunningMainloop)}if(ce.mainLoop.running=!1,ce.mainLoop.runner=function(){var Se,Me;if(!H){if(ce.mainLoop.queue.length>0){var le=Date.now(),fe=ce.mainLoop.queue.shift();if(fe.func(fe.arg),ce.mainLoop.remainingBlockers){var ve=ce.mainLoop.remainingBlockers,Ie=ve%1==0?ve-1:Math.floor(ve);fe.counted?ce.mainLoop.remainingBlockers=Ie:(Ie=Ie+.5,ce.mainLoop.remainingBlockers=(8*ve+Ie)/9)}if(ce.mainLoop.updateStatus(),!j())return;setTimeout(ce.mainLoop.runner,0);return}if(!!j()){if(ce.mainLoop.currentFrameNumber=ce.mainLoop.currentFrameNumber+1|0,ce.mainLoop.timingMode==1&&ce.mainLoop.timingValue>1&&ce.mainLoop.currentFrameNumber%ce.mainLoop.timingValue!=0){ce.mainLoop.scheduler();return}else ce.mainLoop.timingMode==0&&(ce.mainLoop.tickStartTime=Oc());ce.mainLoop.method==="timeout"&&t.ctx&&(mn("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),ce.mainLoop.method=""),ce.mainLoop.runIter(x),Le(),j()&&(typeof SDL=="object"&&((Me=(Se=SDL.audio)==null?void 0:Se.queueNewAudioData)==null||Me.call(Se)),ce.mainLoop.scheduler())}}},D||(y&&y>0?Hp(0,1e3/y):Hp(1,1),ce.mainLoop.scheduler()),E)throw"unwind"},Ab=x=>{if(x instanceof kp||x=="unwind")return K;Le(),x instanceof WebAssembly.RuntimeError&&Wb()<=0&&w("Stack overflow detected.  You can try increasing -sSTACK_SIZE (currently set to 65536)"),l(1,x)},Tb=0,Zp=()=>$4||Tb>0,wU=x=>{var y;K=x,Zp()||((y=t.onExit)==null||y.call(t,x),H=!0),l(x,new kp(x))},EU=(x,y)=>{if(K=x,lD(),Zp()&&!y){var E=`program exited (with status: ${x}), but keepRuntimeAlive() is set (counter=${Tb}) due to an async operation, so halting execution but not exiting the runtime or preventing further async execution (you can use emscripten_force_exit, if you want to force a true shutdown)`;i(E),w(E)}wU(x)},Cb=EU,_U=()=>{if(!Zp())try{Cb(K)}catch(x){Ab(x)}},Kp=x=>{if(H){w("user callback triggered after runtime exited or application aborted.  Ignoring.");return}try{x(),_U()}catch(y){Ab(y)}},Mb=(x,y)=>setTimeout(()=>{Kp(x)},y),ce={mainLoop:{running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause(){ce.mainLoop.scheduler=null,ce.mainLoop.currentlyRunningMainloop++},resume(){ce.mainLoop.currentlyRunningMainloop++;var x=ce.mainLoop.timingMode,y=ce.mainLoop.timingValue,E=ce.mainLoop.func;ce.mainLoop.func=null,vU(E,0,!1,ce.mainLoop.arg,!0),Hp(x,y),ce.mainLoop.scheduler()},updateStatus(){if(t.setStatus){var x=t.statusMessage||"Please wait...",y=ce.mainLoop.remainingBlockers,E=ce.mainLoop.expectedBlockers;y?y<E?t.setStatus(x+" ("+(E-y)+"/"+E+")"):t.setStatus(x):t.setStatus("")}},runIter(x){var E;if(!H){if(t.preMainLoop){var y=t.preMainLoop();if(y===!1)return}Kp(x),(E=t.postMainLoop)==null||E.call(t)}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init(){if(ce.initted)return;ce.initted=!0;var x={};x.canHandle=function(X){return!t.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(X)},x.handle=function(X,j,te,le){var fe=new Blob([X],{type:ce.getMimetype(j)});fe.size!==X.length&&(fe=new Blob([new Uint8Array(X).buffer],{type:ce.getMimetype(j)}));var ve=URL.createObjectURL(fe);F(typeof ve=="string","createObjectURL must return a url as a string");var Ie=new Image;Ie.onload=()=>{F(Ie.complete,`Image ${j} could not be decoded`);var Se=document.createElement("canvas");Se.width=Ie.width,Se.height=Ie.height;var Me=Se.getContext("2d");Me.drawImage(Ie,0,0),Db[j]=Se,URL.revokeObjectURL(ve),te==null||te(X)},Ie.onerror=Se=>{w(`Image ${ve} could not be decoded`),le==null||le()},Ie.src=ve},zp.push(x);var y={};y.canHandle=function(X){return!t.noAudioDecoding&&X.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},y.handle=function(X,j,te,le){var fe=!1;function ve(Je){fe||(fe=!0,Gb[j]=Je,te==null||te(X))}function Ie(){fe||(fe=!0,Gb[j]=new Audio,le==null||le())}var Se=new Blob([X],{type:ce.getMimetype(j)}),Me=URL.createObjectURL(Se);F(typeof Me=="string","createObjectURL must return a url as a string");var De=new Audio;De.addEventListener("canplaythrough",()=>ve(De),!1),De.onerror=function(ur){if(fe)return;w(`warning: browser could not fully decode audio ${j}, trying slower base64 approach`);function Ft(Ee){for(var $e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",nr="=",It="",Lr=0,Vt=0,em=0;em<Ee.length;em++)for(Lr=Lr<<8|Ee[em],Vt+=8;Vt>=6;){var uD=Lr>>Vt-6&63;Vt-=6,It+=$e[uD]}return Vt==2?(It+=$e[(Lr&3)<<4],It+=nr+nr):Vt==4&&(It+=$e[(Lr&15)<<2],It+=nr),It}De.src="data:audio/x-"+j.substr(-3)+";base64,"+Ft(X),ve(De)},De.src=Me,Mb(()=>{ve(De)},1e4)},zp.push(y);function E(){ce.pointerLock=document.pointerLockElement===t.canvas||document.mozPointerLockElement===t.canvas||document.webkitPointerLockElement===t.canvas||document.msPointerLockElement===t.canvas}var T=t.canvas;T&&(T.requestPointerLock=T.requestPointerLock||T.mozRequestPointerLock||T.webkitRequestPointerLock||T.msRequestPointerLock||(()=>{}),T.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||(()=>{}),T.exitPointerLock=T.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",E,!1),document.addEventListener("mozpointerlockchange",E,!1),document.addEventListener("webkitpointerlockchange",E,!1),document.addEventListener("mspointerlockchange",E,!1),t.elementPointerLock&&T.addEventListener("click",D=>{!ce.pointerLock&&t.canvas.requestPointerLock&&(t.canvas.requestPointerLock(),D.preventDefault())},!1))},createContext(x,y,E,T){if(y&&t.ctx&&x==t.canvas)return t.ctx;var D,X;if(y){var j={antialias:!1,alpha:!1,majorVersion:1};if(T)for(var te in T)j[te]=T[te];typeof GL<"u"&&(X=GL.createContext(x,j),X&&(D=GL.getContext(X).GLctx))}else D=x.getContext("2d");return D?(E&&(y||F(typeof GLctx>"u","cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),t.ctx=D,y&&GL.makeContextCurrent(X),t.useWebGL=y,ce.moduleContextCreatedCallbacks.forEach(le=>le()),ce.init()),D):null},destroyContext(x,y,E){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen(x,y){ce.lockPointer=x,ce.resizeCanvas=y,typeof ce.lockPointer>"u"&&(ce.lockPointer=!0),typeof ce.resizeCanvas>"u"&&(ce.resizeCanvas=!1);var E=t.canvas;function T(){var j,te;ce.isFullscreen=!1;var X=E.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===X?(E.exitFullscreen=ce.exitFullscreen,ce.lockPointer&&E.requestPointerLock(),ce.isFullscreen=!0,ce.resizeCanvas?ce.setFullscreenCanvasSize():ce.updateCanvasDimensions(E)):(X.parentNode.insertBefore(E,X),X.parentNode.removeChild(X),ce.resizeCanvas?ce.setWindowedCanvasSize():ce.updateCanvasDimensions(E)),(j=t.onFullScreen)==null||j.call(t,ce.isFullscreen),(te=t.onFullscreen)==null||te.call(t,ce.isFullscreen)}ce.fullscreenHandlersInstalled||(ce.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",T,!1),document.addEventListener("mozfullscreenchange",T,!1),document.addEventListener("webkitfullscreenchange",T,!1),document.addEventListener("MSFullscreenChange",T,!1));var D=document.createElement("div");E.parentNode.insertBefore(D,E),D.appendChild(E),D.requestFullscreen=D.requestFullscreen||D.mozRequestFullScreen||D.msRequestFullscreen||(D.webkitRequestFullscreen?()=>D.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):null)||(D.webkitRequestFullScreen?()=>D.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):null),D.requestFullscreen()},requestFullScreen(){St("Module.requestFullScreen has been replaced by Module.requestFullscreen (without a capital S)")},exitFullscreen(){if(!ce.isFullscreen)return!1;var x=document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||(()=>{});return x.apply(document,[]),!0},nextRAF:0,fakeRequestAnimationFrame(x){var y=Date.now();if(ce.nextRAF===0)ce.nextRAF=y+1e3/60;else for(;y+2>=ce.nextRAF;)ce.nextRAF+=1e3/60;var E=Math.max(ce.nextRAF-y,0);setTimeout(x,E)},requestAnimationFrame(x){if(typeof requestAnimationFrame=="function"){requestAnimationFrame(x);return}var y=ce.fakeRequestAnimationFrame;y(x)},safeSetTimeout(x,y){return Mb(x,y)},safeRequestAnimationFrame(x){return ce.requestAnimationFrame(()=>{Kp(x)})},getMimetype(x){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[x.substr(x.lastIndexOf(".")+1)]},getUserMedia(x){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(x)},getMovementX(x){return x.movementX||x.mozMovementX||x.webkitMovementX||0},getMovementY(x){return x.movementY||x.mozMovementY||x.webkitMovementY||0},getMouseWheelDelta(x){var y=0;switch(x.type){case"DOMMouseScroll":y=x.detail/3;break;case"mousewheel":y=x.wheelDelta/120;break;case"wheel":switch(y=x.deltaY,x.deltaMode){case 0:y/=100;break;case 1:y/=3;break;case 2:y*=80;break;default:throw"unrecognized mouse wheel delta mode: "+x.deltaMode}break;default:throw"unrecognized mouse wheel event: "+x.type}return y},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseCoords(x,y){var E=t.canvas.getBoundingClientRect(),T=t.canvas.width,D=t.canvas.height,X=typeof window.scrollX<"u"?window.scrollX:window.pageXOffset,j=typeof window.scrollY<"u"?window.scrollY:window.pageYOffset;F(typeof X<"u"&&typeof j<"u","Unable to retrieve scroll position, mouse positions likely broken.");var te=x-(X+E.left),le=y-(j+E.top);return te=te*(T/E.width),le=le*(D/E.height),{x:te,y:le}},setMouseCoords(x,y){let{x:E,y:T}=ce.calculateMouseCoords(x,y);ce.mouseMovementX=E-ce.mouseX,ce.mouseMovementY=T-ce.mouseY,ce.mouseX=E,ce.mouseY=T},calculateMouseEvent(x){if(ce.pointerLock)x.type!="mousemove"&&"mozMovementX"in x?ce.mouseMovementX=ce.mouseMovementY=0:(ce.mouseMovementX=ce.getMovementX(x),ce.mouseMovementY=ce.getMovementY(x)),typeof SDL<"u"?(ce.mouseX=SDL.mouseX+ce.mouseMovementX,ce.mouseY=SDL.mouseY+ce.mouseMovementY):(ce.mouseX+=ce.mouseMovementX,ce.mouseY+=ce.mouseMovementY);else{if(x.type==="touchstart"||x.type==="touchend"||x.type==="touchmove"){var y=x.touch;if(y===void 0)return;var E=ce.calculateMouseCoords(y.pageX,y.pageY);if(x.type==="touchstart")ce.lastTouches[y.identifier]=E,ce.touches[y.identifier]=E;else if(x.type==="touchend"||x.type==="touchmove"){var T=ce.touches[y.identifier];T||(T=E),ce.lastTouches[y.identifier]=T,ce.touches[y.identifier]=E}return}ce.setMouseCoords(x.pageX,x.pageY)}},resizeListeners:[],updateResizeListeners(){var x=t.canvas;ce.resizeListeners.forEach(y=>y(x.width,x.height))},setCanvasSize(x,y,E){var T=t.canvas;ce.updateCanvasDimensions(T,x,y),E||ce.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize(){if(typeof SDL<"u"){var x=Q[SDL.screen>>2];x=x|8388608,W[SDL.screen>>2]=x}ce.updateCanvasDimensions(t.canvas),ce.updateResizeListeners()},setWindowedCanvasSize(){if(typeof SDL<"u"){var x=Q[SDL.screen>>2];x=x&-8388609,W[SDL.screen>>2]=x}ce.updateCanvasDimensions(t.canvas),ce.updateResizeListeners()},updateCanvasDimensions(x,y,E){y&&E?(x.widthNative=y,x.heightNative=E):(y=x.widthNative,E=x.heightNative);var T=y,D=E;if(t.forcedAspectRatio&&t.forcedAspectRatio>0&&(T/D<t.forcedAspectRatio?T=Math.round(D*t.forcedAspectRatio):D=Math.round(T/t.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===x.parentNode&&typeof screen<"u"){var X=Math.min(screen.width/T,screen.height/D);T=Math.round(T*X),D=Math.round(D*X)}ce.resizeCanvas?(x.width!=T&&(x.width=T),x.height!=D&&(x.height=D),typeof x.style<"u"&&(x.style.removeProperty("width"),x.style.removeProperty("height"))):(x.width!=y&&(x.width=y),x.height!=E&&(x.height=E),typeof x.style<"u"&&(T!=y||D!=E?(x.style.setProperty("width",T+"px","important"),x.style.setProperty("height",D+"px","important")):(x.style.removeProperty("width"),x.style.removeProperty("height"))))}},PU=(x,y,E)=>{(x|0)===x&&(x=Nn(x)),x=gi.resolve(x);var T=Db[x];if(T){var D=T.getContext("2d"),X=D.getImageData(0,0,T.width,T.height),j=po(T.width*T.height*4);return k.set(X.data,j),W[y>>2]=T.width,W[E>>2]=T.height,j}return 0},SU=(x,y,E)=>k.copyWithin(x,y,y+E),IU=x=>{var y=$.buffer,E=(x-y.byteLength+65535)/65536;try{return $.grow(E),xe(),1}catch(T){w(`growMemory: Attempted to grow heap from ${y.byteLength} bytes to ${x} bytes, but got error: ${T}`)}},BU=x=>{var y=k.length;x>>>=0,F(x>y);var E=Bb();if(x>E)return w(`Cannot enlarge memory, requested ${x} bytes, but the limit is ${E} bytes!`),!1;for(var T=(le,fe)=>le+(fe-le%fe)%fe,D=1;D<=4;D*=2){var X=y*(1+.2/D);X=Math.min(X,x+100663296);var j=Math.min(E,T(Math.max(x,X),65536)),te=IU(j);if(te)return!0}return w(`Failed to grow the heap from ${y} bytes to ${j} bytes, not enough memory!`),!1},Qp={},AU=()=>a||"./this.program",Fl=()=>{if(!Fl.strings){var x=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",y={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:x,_:AU()};for(var E in Qp)Qp[E]===void 0?delete y[E]:y[E]=Qp[E];var T=[];for(var E in y)T.push(`${E}=${y[E]}`);Fl.strings=T}return Fl.strings},TU=(x,y)=>{for(var E=0;E<x.length;++E)F(x.charCodeAt(E)===(x.charCodeAt(E)&255)),L[y++>>0]=x.charCodeAt(E);L[y>>0]=0},CU=(x,y)=>{var E=0;return Fl().forEach((T,D)=>{var X=y+E;Q[x+D*4>>2]=X,TU(T,X),E+=T.length+1}),0},MU=(x,y)=>{var E=Fl();Q[x>>2]=E.length;var T=0;return E.forEach(D=>T+=D.length+1),Q[y>>2]=T,0};function NU(x){try{var y=dt.getStreamFromFD(x);return U.close(y),0}catch(E){if(typeof U>"u"||E.name!=="ErrnoError")throw E;return E.errno}}var RU=(x,y,E,T)=>{for(var D=0,X=0;X<E;X++){var j=Q[y>>2],te=Q[y+4>>2];y+=8;var le=U.read(x,L,j,te,T);if(le<0)return-1;if(D+=le,le<te)break;typeof T<"u"&&(T+=le)}return D};function LU(x,y,E,T){try{var D=dt.getStreamFromFD(x),X=RU(D,y,E);return Q[T>>2]=X,0}catch(j){if(typeof U>"u"||j.name!=="ErrnoError")throw j;return j.errno}}function OU(x,y,E,T,D){var X=Ib(y,E);try{if(isNaN(X))return 61;var j=dt.getStreamFromFD(x);return U.llseek(j,X,T),Rt=[j.position>>>0,(He=j.position,+Math.abs(He)>=1?He>0?+Math.floor(He/4294967296)>>>0:~~+Math.ceil((He-+(~~He>>>0))/4294967296)>>>0:0)],W[D>>2]=Rt[0],W[D+4>>2]=Rt[1],j.getdents&&X===0&&T===0&&(j.getdents=null),0}catch(te){if(typeof U>"u"||te.name!=="ErrnoError")throw te;return te.errno}}var kU=(x,y,E,T)=>{for(var D=0,X=0;X<E;X++){var j=Q[y>>2],te=Q[y+4>>2];y+=8;var le=U.write(x,L,j,te,T);if(le<0)return-1;D+=le,typeof T<"u"&&(T+=le)}return D};function UU(x,y,E,T){try{var D=dt.getStreamFromFD(x),X=kU(D,y,E);return Q[T>>2]=X,0}catch(j){if(typeof U>"u"||j.name!=="ErrnoError")throw j;return j.errno}}var DU=(x,y)=>(Gp(k.subarray(x,x+y)),0),Nb=x=>{for(var y=x.split("."),E=0;E<4;E++){var T=Number(y[E]);if(isNaN(T))return null;y[E]=T}return(y[0]|y[1]<<8|y[2]<<16|y[3]<<24)>>>0},kc=x=>parseInt(x),GU=x=>{var y,E,T,D,X,j=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,te=[];if(!j.test(x))return null;if(x==="::")return[0,0,0,0,0,0,0,0];for(x.startsWith("::")?x=x.replace("::","Z:"):x=x.replace("::",":Z:"),x.indexOf(".")>0?(x=x.replace(new RegExp("[.]","g"),":"),y=x.split(":"),y[y.length-4]=kc(y[y.length-4])+kc(y[y.length-3])*256,y[y.length-3]=kc(y[y.length-2])+kc(y[y.length-1])*256,y=y.slice(0,y.length-2)):y=x.split(":"),T=0,D=0,E=0;E<y.length;E++)if(typeof y[E]=="string")if(y[E]==="Z"){for(D=0;D<8-y.length+1;D++)te[E+D]=0;T=D-1}else te[E+T]=QU(parseInt(y[E],16));else te[E+T]=y[E];return[te[1]<<16|te[0],te[3]<<16|te[2],te[5]<<16|te[4],te[7]<<16|te[6]]},ws={address_map:{id:1,addrs:{},names:{}},lookup_name(x){var y=Nb(x);if(y!==null||(y=GU(x),y!==null))return x;var E;if(ws.address_map.addrs[x])E=ws.address_map.addrs[x];else{var T=ws.address_map.id++;F(T<65535,"exceeded max address mappings of 65535"),E="172.29."+(T&255)+"."+(T&65280),ws.address_map.names[E]=x,ws.address_map.addrs[x]=E}return E},lookup_addr(x){return ws.address_map.names[x]?ws.address_map.names[x]:null}},FU=x=>{var y=po(20),E=jp(x);Q[y>>2]=E;var T=po(4);Q[T>>2]=0,Q[y+4>>2]=T;var D=2;W[y+8>>2]=D,W[y+12>>2]=4;var X=po(12);return Q[X>>2]=X+8,Q[X+4>>2]=0,W[X+8>>2]=Nb(ws.lookup_name(x)),Q[y+16>>2]=X,y},qU=x=>FU(Nn(x)),zU=(x,y)=>{for(var E=0,T=0;T<=y;E+=x[T++]);return E},Rb=[31,29,31,30,31,30,31,31,30,31,30,31],Lb=[31,28,31,30,31,30,31,31,30,31,30,31],YU=(x,y)=>{for(var E=new Date(x.getTime());y>0;){var T=Gl(E.getFullYear()),D=E.getMonth(),X=(T?Rb:Lb)[D];if(y>X-E.getDate())y-=X-E.getDate()+1,E.setDate(1),D<11?E.setMonth(D+1):(E.setMonth(0),E.setFullYear(E.getFullYear()+1));else return E.setDate(E.getDate()+y),E}return E},Ob=(x,y)=>{F(x.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),L.set(x,y)},XU=(x,y,E,T)=>{var D=Q[T+40>>2],X={tm_sec:W[T>>2],tm_min:W[T+4>>2],tm_hour:W[T+8>>2],tm_mday:W[T+12>>2],tm_mon:W[T+16>>2],tm_year:W[T+20>>2],tm_wday:W[T+24>>2],tm_yday:W[T+28>>2],tm_isdst:W[T+32>>2],tm_gmtoff:W[T+36>>2],tm_zone:D?Nn(D):""},j=Nn(E),te={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var le in te)j=j.replace(new RegExp(le,"g"),te[le]);var fe=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ve=["January","February","March","April","May","June","July","August","September","October","November","December"];function Ie(Ee,$e,nr){for(var It=typeof Ee=="number"?Ee.toString():Ee||"";It.length<$e;)It=nr[0]+It;return It}function Se(Ee,$e){return Ie(Ee,$e,"0")}function Me(Ee,$e){function nr(Lr){return Lr<0?-1:Lr>0?1:0}var It;return(It=nr(Ee.getFullYear()-$e.getFullYear()))===0&&(It=nr(Ee.getMonth()-$e.getMonth()))===0&&(It=nr(Ee.getDate()-$e.getDate())),It}function De(Ee){switch(Ee.getDay()){case 0:return new Date(Ee.getFullYear()-1,11,29);case 1:return Ee;case 2:return new Date(Ee.getFullYear(),0,3);case 3:return new Date(Ee.getFullYear(),0,2);case 4:return new Date(Ee.getFullYear(),0,1);case 5:return new Date(Ee.getFullYear()-1,11,31);case 6:return new Date(Ee.getFullYear()-1,11,30)}}function Je(Ee){var $e=YU(new Date(Ee.tm_year+1900,0,1),Ee.tm_yday),nr=new Date($e.getFullYear(),0,4),It=new Date($e.getFullYear()+1,0,4),Lr=De(nr),Vt=De(It);return Me(Lr,$e)<=0?Me(Vt,$e)<=0?$e.getFullYear()+1:$e.getFullYear():$e.getFullYear()-1}var ur={"%a":Ee=>fe[Ee.tm_wday].substring(0,3),"%A":Ee=>fe[Ee.tm_wday],"%b":Ee=>ve[Ee.tm_mon].substring(0,3),"%B":Ee=>ve[Ee.tm_mon],"%C":Ee=>{var $e=Ee.tm_year+1900;return Se($e/100|0,2)},"%d":Ee=>Se(Ee.tm_mday,2),"%e":Ee=>Ie(Ee.tm_mday,2," "),"%g":Ee=>Je(Ee).toString().substring(2),"%G":Ee=>Je(Ee),"%H":Ee=>Se(Ee.tm_hour,2),"%I":Ee=>{var $e=Ee.tm_hour;return $e==0?$e=12:$e>12&&($e-=12),Se($e,2)},"%j":Ee=>Se(Ee.tm_mday+zU(Gl(Ee.tm_year+1900)?Rb:Lb,Ee.tm_mon-1),3),"%m":Ee=>Se(Ee.tm_mon+1,2),"%M":Ee=>Se(Ee.tm_min,2),"%n":()=>`
`,"%p":Ee=>Ee.tm_hour>=0&&Ee.tm_hour<12?"AM":"PM","%S":Ee=>Se(Ee.tm_sec,2),"%t":()=>"	","%u":Ee=>Ee.tm_wday||7,"%U":Ee=>{var $e=Ee.tm_yday+7-Ee.tm_wday;return Se(Math.floor($e/7),2)},"%V":Ee=>{var $e=Math.floor((Ee.tm_yday+7-(Ee.tm_wday+6)%7)/7);if((Ee.tm_wday+371-Ee.tm_yday-2)%7<=2&&$e++,$e){if($e==53){var It=(Ee.tm_wday+371-Ee.tm_yday)%7;It!=4&&(It!=3||!Gl(Ee.tm_year))&&($e=1)}}else{$e=52;var nr=(Ee.tm_wday+7-Ee.tm_yday-1)%7;(nr==4||nr==5&&Gl(Ee.tm_year%400-1))&&$e++}return Se($e,2)},"%w":Ee=>Ee.tm_wday,"%W":Ee=>{var $e=Ee.tm_yday+7-(Ee.tm_wday+6)%7;return Se(Math.floor($e/7),2)},"%y":Ee=>(Ee.tm_year+1900).toString().substring(2),"%Y":Ee=>Ee.tm_year+1900,"%z":Ee=>{var $e=Ee.tm_gmtoff,nr=$e>=0;return $e=Math.abs($e)/60,$e=$e/60*100+$e%60,(nr?"+":"-")+String("0000"+$e).slice(-4)},"%Z":Ee=>Ee.tm_zone,"%%":()=>"%"};j=j.replace(/%%/g,"\0\0");for(var le in ur)j.includes(le)&&(j=j.replace(new RegExp(le,"g"),ur[le](X)));j=j.replace(/\0\0/g,"%");var Ft=Mc(j,!1);return Ft.length>y?0:(Ob(Ft,x),Ft.length-1)},VU=(x,y,E,T,D)=>XU(x,y,E,T),WU=x=>{var y=t["_"+x];return F(y,"Cannot call unknown function "+x+", make sure it is exported"),y},$U=x=>{var y=ia(x)+1,E=Gc(y);return Dl(x,E,y),E},kb=(x,y,E,T,D)=>{var X={string:De=>{var Je=0;return De!=null&&De!==0&&(Je=$U(De)),Je},array:De=>{var Je=Gc(De.length);return Ob(De,Je),Je}};function j(De){return y==="string"?Nn(De):y==="boolean"?Boolean(De):De}var te=WU(x),le=[],fe=0;if(F(y!=="array",'Return type should not be "array".'),T)for(var ve=0;ve<T.length;ve++){var Ie=X[E[ve]];Ie?(fe===0&&(fe=Xb()),le[ve]=Ie(T[ve])):le[ve]=T[ve]}var Se=te.apply(null,le);function Me(De){return fe!==0&&Vb(fe),j(De)}return Se=Me(Se),Se},jU=(x,y,E,T)=>function(){return kb(x,y,E,arguments,T)},Ub=function(x,y,E,T){x||(x=this),this.parent=x,this.mount=x.mount,this.mounted=null,this.id=U.nextInode++,this.name=y,this.mode=E,this.node_ops={},this.stream_ops={},this.rdev=T},Uc=365,Dc=146;Object.defineProperties(Ub.prototype,{read:{get:function(){return(this.mode&Uc)===Uc},set:function(x){x?this.mode|=Uc:this.mode&=~Uc}},write:{get:function(){return(this.mode&Dc)===Dc},set:function(x){x?this.mode|=Dc:this.mode&=~Dc}},isFolder:{get:function(){return U.isDir(this.mode)}},isDevice:{get:function(){return U.isChrdev(this.mode)}}}),U.FSNode=Ub,U.createPreloadedFile=ek,U.staticInit(),yk(),gb=t.BindingError=class extends Error{constructor(y){super(y),this.name="BindingError"}},xb=t.InternalError=class extends Error{constructor(y){super(y),this.name="InternalError"}},_k(),Sk(),_b=t.UnboundTypeError=qk(Error,"UnboundTypeError"),t.requestFullscreen=ce.requestFullscreen,t.requestFullScreen=ce.requestFullScreen,t.requestAnimationFrame=ce.requestAnimationFrame,t.setCanvasSize=ce.setCanvasSize,t.pauseMainLoop=ce.mainLoop.pause,t.resumeMainLoop=ce.mainLoop.resume,t.getUserMedia=ce.getUserMedia,t.createContext=ce.createContext;var Db={},Gb={};function HU(){q4("fetchSettings")}var Fb={OSD_MemInfo_getModuleHeapLength:X4,__assert_fail:j4,__syscall_chmod:sk,__syscall_faccessat:ok,__syscall_fcntl64:lk,__syscall_fstat64:uk,__syscall_getdents64:ck,__syscall_ioctl:hk,__syscall_lstat64:dk,__syscall_mkdirat:fk,__syscall_newfstatat:pk,__syscall_openat:mk,__syscall_stat64:gk,__throw_exception_with_stack_trace:xk,_embind_register_bigint:bk,_embind_register_bool:Ek,_embind_register_emval:Ik,_embind_register_float:Ak,_embind_register_function:Xk,_embind_register_integer:Wk,_embind_register_memory_view:$k,_embind_register_std_string:Hk,_embind_register_std_wstring:rU,_embind_register_void:nU,_emscripten_get_now_is_monotonic:sU,_emval_decref:vb,_emval_incref:oU,_emval_take_value:lU,_localtime_js:dU,_tzset_js:fU,abort:pU,emscripten_date_now:mU,emscripten_get_callstack:bU,emscripten_get_heap_max:yU,emscripten_get_now:Oc,emscripten_get_preloaded_image_data:PU,emscripten_memcpy_js:SU,emscripten_resize_heap:BU,environ_get:CU,environ_sizes_get:MU,exit:Cb,fd_close:NU,fd_read:LU,fd_seek:OU,fd_write:UU,getentropy:DU,gethostbyname:qU,sendProgress:Y4,strftime_l:VU},xn=Op(),Qse=Xt("__wasm_call_ctors"),xi=t._free=Xt("free"),ZU=Xt("__errno_location"),po=t._malloc=Xt("malloc"),qb=t._fflush=Xt("fflush"),KU=Xt("__getTypeName"),QU=Xt("htons"),zb=()=>(zb=xn.__trap)(),Jse=Xt("setTempRet0"),Yb=()=>(Yb=xn.emscripten_stack_init)(),JU=()=>(JU=xn.emscripten_stack_get_free)(),eD=()=>(eD=xn.emscripten_stack_get_base)(),Jp=()=>(Jp=xn.emscripten_stack_get_end)(),Xb=Xt("stackSave"),Vb=Xt("stackRestore"),Gc=Xt("stackAlloc"),Wb=()=>(Wb=xn.emscripten_stack_get_current)(),tD=t.___cxa_decrement_exception_refcount=Xt("__cxa_decrement_exception_refcount"),rD=t.___cxa_increment_exception_refcount=Xt("__cxa_increment_exception_refcount"),nD=t.___thrown_object_from_unwind_exception=Xt("__thrown_object_from_unwind_exception"),iD=t.___get_exception_message=Xt("__get_exception_message"),eoe=t.dynCall_viijii=Xt("dynCall_viijii"),toe=t.dynCall_viiiiji=Xt("dynCall_viiiiji"),roe=t.dynCall_jiji=Xt("dynCall_jiji"),noe=t.dynCall_iiiiij=Xt("dynCall_iiiiij"),ioe=t.dynCall_iiiiijj=Xt("dynCall_iiiiijj"),soe=t.dynCall_iiiiiijj=Xt("dynCall_iiiiiijj"),ooe=t.___start_em_js=2898348,aoe=t.___stop_em_js=2898518;t.ccall=kb,t.cwrap=jU,t.FS=U;var sD=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertU32PairToI53","inetNtop4","inetNtop6","readSockaddr","writeSockaddr","emscriptenLog","convertPCtoSourceLocation","readEmAsmArgs","jstoi_s","listenOnce","autoResumeAudioContext","runtimeKeepalivePush","runtimeKeepalivePop","asmjsMangle","getNativeTypeSize","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayToString","AsciiToString","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","findCanvasEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","disableGamepadApiIfItThrows","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","stackTrace","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","createDyncallWrapper","setImmediateWrapped","clearImmediateWrapped","polyfillSetImmediate","getPromise","makePromise","idsToPromises","makePromiseCallback","Browser_asyncPrepareDataCounter","getSocketFromFD","getSocketAddress","FS_unlink","FS_mkdirTree","_setNetworkCallback","heapObjectForWebGLType","heapAccessShiftForWebGLHeap","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","__glGenObject","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","runAndAbortIfError","SDL_unicode","SDL_ttfContext","SDL_audio","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","getFunctionArgsName","init_embind","getBasestPointer","registerInheritedInstance","unregisterInheritedInstance","getInheritedInstance","getInheritedInstanceCount","getLiveInheritedInstances","enumReadValueFromPointer","genericPointerToWireType","constNoSmartPtrRawPointerToWireType","nonConstNoSmartPtrRawPointerToWireType","init_RegisteredPointer","RegisteredPointer","RegisteredPointer_fromWireType","runDestructor","releaseClassHandle","detachFinalizer","attachFinalizer","makeClassHandle","init_ClassHandle","ClassHandle","throwInstanceAlreadyDeleted","flushPendingDeletes","setDelayFunction","RegisteredClass","shallowCopyInternalPointer","downcastPointer","upcastPointer","validateThis","char_0","char_9","makeLegalFunctionName","getStringOrSymbol","emval_get_global","emval_returnValue","emval_lookupTypes","emval_addMethodCaller"];sD.forEach(z4);var oD=["run","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","FS_createFolder","FS_createPath","FS_createLazyFile","FS_createLink","FS_createDevice","FS_readFile","out","err","callMain","abort","wasmMemory","wasmExports","stackAlloc","stackSave","stackRestore","getTempRet0","setTempRet0","writeStackCookie","checkStackCookie","convertI32PairToI53Checked","ptrToString","zeroMemory","exitJS","getHeapMax","growMemory","ENV","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","isLeapYear","ydayFromDate","arraySum","addDays","ERRNO_CODES","ERRNO_MESSAGES","setErrNo","inetPton4","inetPton6","DNS","getHostByName","Protocols","Sockets","initRandomFill","randomFill","timers","warnOnce","getCallstack","UNWIND_CACHE","readEmAsmArgsArray","jstoi_q","getExecutableName","dynCallLegacy","getDynCaller","dynCall","handleException","keepRuntimeAlive","callUserCallback","maybeExit","asyncLoad","alignMemory","mmapAlloc","handleAllocatorInit","HandleAllocator","wasmTable","noExitRuntime","getCFunc","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","intArrayFromString","stringToAscii","UTF16Decoder","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","stringToNewUTF8","stringToUTF8OnStack","writeArrayToMemory","JSEvents","specialHTMLTargets","currentFullscreenStrategy","restoreOldWindowedStyle","demangle","demangleAll","jsStackTrace","ExitStatus","getEnvStrings","doReadv","doWritev","safeSetTimeout","promiseMap","getExceptionMessageCommon","getCppExceptionTag","getCppExceptionThrownObjectFromWebAssemblyException","incrementExceptionRefcount","decrementExceptionRefcount","getExceptionMessage","Browser","setMainLoop","wget","SYSCALLS","preloadPlugins","FS_createPreloadedFile","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar_buffer","FS_stdin_getChar","FS_createDataFile","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","GL","emscripten_webgl_power_preferences","AL","GLUT","EGL","GLEW","IDBStore","SDL","SDL_gfx","allocateUTF8","allocateUTF8OnStack","InternalError","BindingError","throwInternalError","throwBindingError","registeredTypes","awaitingDependencies","typeDependencies","tupleRegistrations","structRegistrations","sharedRegisterType","whenDependentTypesAreResolved","embind_charCodes","embind_init_charCodes","readLatin1String","getTypeName","getFunctionName","heap32VectorToArray","requireRegisteredType","usesDestructorStack","createJsInvoker","UnboundTypeError","PureVirtualError","GenericWireTypeSize","throwUnboundTypeError","ensureOverloadTable","exposePublicSymbol","replacePublicSymbol","extendError","createNamedFunction","embindRepr","registeredInstances","registeredPointers","registerType","integerReadValueFromPointer","floatReadValueFromPointer","simpleReadValueFromPointer","readPointer","runDestructors","newFunc","craftInvokerFunction","embind__requireFunction","finalizationRegistry","detachFinalizer_deps","deletionQueue","delayFunction","emval_handles","emval_symbols","init_emval","count_emval_handles","Emval","emval_methodCallers","reflectConstruct"];oD.forEach(ub);var Fc;Be=function x(){Fc||$b(),Fc||(Be=x)};function aD(){Yb(),ge()}function $b(){if(Pe>0||(aD(),he(),Pe>0))return;function x(){Fc||(Fc=!0,t.calledRun=!0,!H&&(J(),n(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),F(!t._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),Z()))}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),x()},1)):x(),Le()}function lD(){var x=v,y=w,E=!1;v=w=T=>{E=!0};try{qb(0),["stdout","stderr"].forEach(function(T){var le;var D=U.analyzePath("/dev/"+T);if(!!D){var X=D.object,j=X.rdev,te=qi.ttys[j];(le=te==null?void 0:te.output)!=null&&le.length&&(E=!0)}})}catch{}v=x,w=y,E&&mn("stdio streams had content in them that was not flushed. you should set EXIT_RUNTIME to 1 (see the Emscripten FAQ), or make sure to emit a newline when you printf etc.")}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return $b(),e.ready}})(),aX=oX,lX=class{constructor(r=null,e=""){this.cdnUrl="https://modules.lceda.cn/occapi/1.2.2.efa7c3a9/",this.progressCallback=null,e&&(this.cdnUrl=e),/^https?:/.test(this.cdnUrl)||(this.cdnUrl=location.origin+this.cdnUrl),this.progressCallback=r}async init(){let r=this;this.module=await aX({locateFile(e){return r.cdnUrl+e},exportProgress:this.progressCallback})}string2Uint8Array(r){let e=[];for(let t=0,n=r.length;t<n;++t)e.push(r.charCodeAt(t));return new Uint8Array(e)}RECVAndGENStepModel(r,e){if(/\.stp$|\.step$/i.test(r)){let t=new Uint8Array(e),n=this.module._malloc(t.length);this.module.HEAPU8.set(t,n),this.module.stp2component(r,n,t.length)}else if(r==="pcb.json"){let t=new TextEncoder().encode(e),n=this.module._malloc(t.length);return this.module.HEAPU8.set(t,n),this.module.pcb2stp("pcb.json",n,t.length,!0)}}stp2Obj(r){let e="",t=this.string2Uint8Array(r),n=this.module._malloc(t.length);this.module.HEAPU8.set(t,n),this.module.stp2obj("source",n,t.length,!0);try{this.module.FS.readFile("source.mtl",{encoding:"utf8"}).split(/\r?\n/).forEach(o=>{o[0]==="#"||(o[0]==="N"&&o[1]==="s"?(e=e+o+`
`,e=e+`endmtl
`):e=e+o+`
`)})}catch(i){console.log("mtl file error: ",i)}try{this.module.FS.readFile("source.obj",{encoding:"utf8"}).split(/\r?\n/).forEach(o=>{o[0]==="#"||o.indexOf("mtllib")>-1||(e=e+o+`
`)})}catch(i){return console.error("mtl file error: ",i),null}return e}}});var w0=G((w_,v0)=>{(function(r){typeof w_=="object"&&typeof v0<"u"?v0.exports=r():typeof define=="function"&&define.amd?define([],r):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).JSZip=r()})(function(){return function r(e,t,n){function i(a,l){if(!t[a]){if(!e[a]){var u=typeof mo=="function"&&mo;if(!l&&u)return u(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var h=t[a]={exports:{}};e[a][0].call(h.exports,function(f){var d=e[a][1][f];return i(d||f)},h,h.exports,r,e,t,n)}return t[a].exports}for(var s=typeof mo=="function"&&mo,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(r,e,t){"use strict";var n=r("./utils"),i=r("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.encode=function(o){for(var a,l,u,c,h,f,d,m=[],p=0,g=o.length,b=g,v=n.getTypeOf(o)!=="string";p<o.length;)b=g-p,u=v?(a=o[p++],l=p<g?o[p++]:0,p<g?o[p++]:0):(a=o.charCodeAt(p++),l=p<g?o.charCodeAt(p++):0,p<g?o.charCodeAt(p++):0),c=a>>2,h=(3&a)<<4|l>>4,f=1<b?(15&l)<<2|u>>6:64,d=2<b?63&u:64,m.push(s.charAt(c)+s.charAt(h)+s.charAt(f)+s.charAt(d));return m.join("")},t.decode=function(o){var a,l,u,c,h,f,d=0,m=0,p="data:";if(o.substr(0,p.length)===p)throw new Error("Invalid base64 input, it looks like a data url.");var g,b=3*(o=o.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(o.charAt(o.length-1)===s.charAt(64)&&b--,o.charAt(o.length-2)===s.charAt(64)&&b--,b%1!=0)throw new Error("Invalid base64 input, bad content length.");for(g=i.uint8array?new Uint8Array(0|b):new Array(0|b);d<o.length;)a=s.indexOf(o.charAt(d++))<<2|(c=s.indexOf(o.charAt(d++)))>>4,l=(15&c)<<4|(h=s.indexOf(o.charAt(d++)))>>2,u=(3&h)<<6|(f=s.indexOf(o.charAt(d++))),g[m++]=a,h!==64&&(g[m++]=l),f!==64&&(g[m++]=u);return g}},{"./support":30,"./utils":32}],2:[function(r,e,t){"use strict";var n=r("./external"),i=r("./stream/DataWorker"),s=r("./stream/Crc32Probe"),o=r("./stream/DataLengthProbe");function a(l,u,c,h,f){this.compressedSize=l,this.uncompressedSize=u,this.crc32=c,this.compression=h,this.compressedContent=f}a.prototype={getContentWorker:function(){var l=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),u=this;return l.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(l,u,c){return l.pipe(new s).pipe(new o("uncompressedSize")).pipe(u.compressWorker(c)).pipe(new o("compressedSize")).withStreamInfo("compression",u)},e.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,e,t){"use strict";var n=r("./stream/GenericWorker");t.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},t.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,e,t){"use strict";var n=r("./utils"),i=function(){for(var s,o=[],a=0;a<256;a++){s=a;for(var l=0;l<8;l++)s=1&s?3988292384^s>>>1:s>>>1;o[a]=s}return o}();e.exports=function(s,o){return s!==void 0&&s.length?n.getTypeOf(s)!=="string"?function(a,l,u,c){var h=i,f=c+u;a^=-1;for(var d=c;d<f;d++)a=a>>>8^h[255&(a^l[d])];return-1^a}(0|o,s,s.length,0):function(a,l,u,c){var h=i,f=c+u;a^=-1;for(var d=c;d<f;d++)a=a>>>8^h[255&(a^l.charCodeAt(d))];return-1^a}(0|o,s,s.length,0):0}},{"./utils":32}],5:[function(r,e,t){"use strict";t.base64=!1,t.binary=!1,t.dir=!1,t.createFolders=!0,t.date=null,t.compression=null,t.compressionOptions=null,t.comment=null,t.unixPermissions=null,t.dosPermissions=null},{}],6:[function(r,e,t){"use strict";var n=null;n=typeof Promise<"u"?Promise:r("lie"),e.exports={Promise:n}},{lie:37}],7:[function(r,e,t){"use strict";var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",i=r("pako"),s=r("./utils"),o=r("./stream/GenericWorker"),a=n?"uint8array":"array";function l(u,c){o.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=c,this.meta={}}t.magic="\b\0",s.inherits(l,o),l.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(a,u.data),!1)},l.prototype.flush=function(){o.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(c){u.push({data:c,meta:u.meta})}},t.compressWorker=function(u){return new l("Deflate",u)},t.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,e,t){"use strict";function n(h,f){var d,m="";for(d=0;d<f;d++)m+=String.fromCharCode(255&h),h>>>=8;return m}function i(h,f,d,m,p,g){var b,v,w=h.file,P=h.compression,_=g!==a.utf8encode,B=s.transformTo("string",g(w.name)),I=s.transformTo("string",a.utf8encode(w.name)),C=w.comment,N=s.transformTo("string",g(C)),A=s.transformTo("string",a.utf8encode(C)),M=I.length!==w.name.length,S=A.length!==C.length,$="",H="",K="",F=w.dir,z=w.date,L={crc32:0,compressedSize:0,uncompressedSize:0};f&&!d||(L.crc32=h.crc32,L.compressedSize=h.compressedSize,L.uncompressedSize=h.uncompressedSize);var k=0;f&&(k|=8),_||!M&&!S||(k|=2048);var O=0,ie=0;F&&(O|=16),p==="UNIX"?(ie=798,O|=function(Q,oe){var we=Q;return Q||(we=oe?16893:33204),(65535&we)<<16}(w.unixPermissions,F)):(ie=20,O|=function(Q){return 63&(Q||0)}(w.dosPermissions)),b=z.getUTCHours(),b<<=6,b|=z.getUTCMinutes(),b<<=5,b|=z.getUTCSeconds()/2,v=z.getUTCFullYear()-1980,v<<=4,v|=z.getUTCMonth()+1,v<<=5,v|=z.getUTCDate(),M&&(H=n(1,1)+n(l(B),4)+I,$+="up"+n(H.length,2)+H),S&&(K=n(1,1)+n(l(N),4)+A,$+="uc"+n(K.length,2)+K);var W="";return W+=`
\0`,W+=n(k,2),W+=P.magic,W+=n(b,2),W+=n(v,2),W+=n(L.crc32,4),W+=n(L.compressedSize,4),W+=n(L.uncompressedSize,4),W+=n(B.length,2),W+=n($.length,2),{fileRecord:u.LOCAL_FILE_HEADER+W+B+$,dirRecord:u.CENTRAL_FILE_HEADER+n(ie,2)+W+n(N.length,2)+"\0\0\0\0"+n(O,4)+n(m,4)+B+$+N}}var s=r("../utils"),o=r("../stream/GenericWorker"),a=r("../utf8"),l=r("../crc32"),u=r("../signature");function c(h,f,d,m){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=f,this.zipPlatform=d,this.encodeFileName=m,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(c,o),c.prototype.push=function(h){var f=h.meta.percent||0,d=this.entriesCount,m=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,o.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:d?(f+100*(d-m-1))/d:100}}))},c.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var f=this.streamFiles&&!h.file.dir;if(f){var d=i(h,f,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:d.fileRecord,meta:{percent:0}})}else this.accumulate=!0},c.prototype.closedSource=function(h){this.accumulate=!1;var f=this.streamFiles&&!h.file.dir,d=i(h,f,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(d.dirRecord),f)this.push({data:function(m){return u.DATA_DESCRIPTOR+n(m.crc32,4)+n(m.compressedSize,4)+n(m.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:d.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},c.prototype.flush=function(){for(var h=this.bytesWritten,f=0;f<this.dirRecords.length;f++)this.push({data:this.dirRecords[f],meta:{percent:100}});var d=this.bytesWritten-h,m=function(p,g,b,v,w){var P=s.transformTo("string",w(v));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(p,2)+n(p,2)+n(g,4)+n(b,4)+n(P.length,2)+P}(this.dirRecords.length,d,h,this.zipComment,this.encodeFileName);this.push({data:m,meta:{percent:100}})},c.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},c.prototype.registerPrevious=function(h){this._sources.push(h);var f=this;return h.on("data",function(d){f.processChunk(d)}),h.on("end",function(){f.closedSource(f.previous.streamInfo),f._sources.length?f.prepareNextSource():f.end()}),h.on("error",function(d){f.error(d)}),this},c.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},c.prototype.error=function(h){var f=this._sources;if(!o.prototype.error.call(this,h))return!1;for(var d=0;d<f.length;d++)try{f[d].error(h)}catch{}return!0},c.prototype.lock=function(){o.prototype.lock.call(this);for(var h=this._sources,f=0;f<h.length;f++)h[f].lock()},e.exports=c},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,e,t){"use strict";var n=r("../compressions"),i=r("./ZipFileWorker");t.generateWorker=function(s,o,a){var l=new i(o.streamFiles,a,o.platform,o.encodeFileName),u=0;try{s.forEach(function(c,h){u++;var f=function(g,b){var v=g||b,w=n[v];if(!w)throw new Error(v+" is not a valid compression method !");return w}(h.options.compression,o.compression),d=h.options.compressionOptions||o.compressionOptions||{},m=h.dir,p=h.date;h._compressWorker(f,d).withStreamInfo("file",{name:c,dir:m,date:p,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(l)}),l.entriesCount=u}catch(c){l.error(c)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,e,t){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var i=new n;for(var s in this)typeof this[s]!="function"&&(i[s]=this[s]);return i}}(n.prototype=r("./object")).loadAsync=r("./load"),n.support=r("./support"),n.defaults=r("./defaults"),n.version="3.10.1",n.loadAsync=function(i,s){return new n().loadAsync(i,s)},n.external=r("./external"),e.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,e,t){"use strict";var n=r("./utils"),i=r("./external"),s=r("./utf8"),o=r("./zipEntries"),a=r("./stream/Crc32Probe"),l=r("./nodejsUtils");function u(c){return new i.Promise(function(h,f){var d=c.decompressed.getContentWorker().pipe(new a);d.on("error",function(m){f(m)}).on("end",function(){d.streamInfo.crc32!==c.decompressed.crc32?f(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}e.exports=function(c,h){var f=this;return h=n.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),l.isNode&&l.isStream(c)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",c,!0,h.optimizedBinaryString,h.base64).then(function(d){var m=new o(h);return m.load(d),m}).then(function(d){var m=[i.Promise.resolve(d)],p=d.files;if(h.checkCRC32)for(var g=0;g<p.length;g++)m.push(u(p[g]));return i.Promise.all(m)}).then(function(d){for(var m=d.shift(),p=m.files,g=0;g<p.length;g++){var b=p[g],v=b.fileNameStr,w=n.resolve(b.fileNameStr);f.file(w,b.decompressed,{binary:!0,optimizedBinaryString:!0,date:b.date,dir:b.dir,comment:b.fileCommentStr.length?b.fileCommentStr:null,unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions,createFolders:h.createFolders}),b.dir||(f.file(w).unsafeOriginalName=v)}return m.zipComment.length&&(f.comment=m.zipComment),f})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,e,t){"use strict";var n=r("../utils"),i=r("../stream/GenericWorker");function s(o,a){i.call(this,"Nodejs stream input adapter for "+o),this._upstreamEnded=!1,this._bindStream(a)}n.inherits(s,i),s.prototype._bindStream=function(o){var a=this;(this._stream=o).pause(),o.on("data",function(l){a.push({data:l,meta:{percent:0}})}).on("error",function(l){a.isPaused?this.generatedError=l:a.error(l)}).on("end",function(){a.isPaused?a._upstreamEnded=!0:a.end()})},s.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,e,t){"use strict";var n=r("readable-stream").Readable;function i(s,o,a){n.call(this,o),this._helper=s;var l=this;s.on("data",function(u,c){l.push(u)||l._helper.pause(),a&&a(c)}).on("error",function(u){l.emit("error",u)}).on("end",function(){l.push(null)})}r("../utils").inherits(i,n),i.prototype._read=function(){this._helper.resume()},e.exports=i},{"../utils":32,"readable-stream":16}],14:[function(r,e,t){"use strict";e.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,i){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,i);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,i)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var i=new Buffer(n);return i.fill(0),i},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(r,e,t){"use strict";function n(w,P,_){var B,I=s.getTypeOf(P),C=s.extend(_||{},l);C.date=C.date||new Date,C.compression!==null&&(C.compression=C.compression.toUpperCase()),typeof C.unixPermissions=="string"&&(C.unixPermissions=parseInt(C.unixPermissions,8)),C.unixPermissions&&16384&C.unixPermissions&&(C.dir=!0),C.dosPermissions&&16&C.dosPermissions&&(C.dir=!0),C.dir&&(w=p(w)),C.createFolders&&(B=m(w))&&g.call(this,B,!0);var N=I==="string"&&C.binary===!1&&C.base64===!1;_&&_.binary!==void 0||(C.binary=!N),(P instanceof u&&P.uncompressedSize===0||C.dir||!P||P.length===0)&&(C.base64=!1,C.binary=!0,P="",C.compression="STORE",I="string");var A=null;A=P instanceof u||P instanceof o?P:f.isNode&&f.isStream(P)?new d(w,P):s.prepareContent(w,P,C.binary,C.optimizedBinaryString,C.base64);var M=new c(w,A,C);this.files[w]=M}var i=r("./utf8"),s=r("./utils"),o=r("./stream/GenericWorker"),a=r("./stream/StreamHelper"),l=r("./defaults"),u=r("./compressedObject"),c=r("./zipObject"),h=r("./generate"),f=r("./nodejsUtils"),d=r("./nodejs/NodejsStreamInputAdapter"),m=function(w){w.slice(-1)==="/"&&(w=w.substring(0,w.length-1));var P=w.lastIndexOf("/");return 0<P?w.substring(0,P):""},p=function(w){return w.slice(-1)!=="/"&&(w+="/"),w},g=function(w,P){return P=P!==void 0?P:l.createFolders,w=p(w),this.files[w]||n.call(this,w,null,{dir:!0,createFolders:P}),this.files[w]};function b(w){return Object.prototype.toString.call(w)==="[object RegExp]"}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(w){var P,_,B;for(P in this.files)B=this.files[P],(_=P.slice(this.root.length,P.length))&&P.slice(0,this.root.length)===this.root&&w(_,B)},filter:function(w){var P=[];return this.forEach(function(_,B){w(_,B)&&P.push(B)}),P},file:function(w,P,_){if(arguments.length!==1)return w=this.root+w,n.call(this,w,P,_),this;if(b(w)){var B=w;return this.filter(function(C,N){return!N.dir&&B.test(C)})}var I=this.files[this.root+w];return I&&!I.dir?I:null},folder:function(w){if(!w)return this;if(b(w))return this.filter(function(I,C){return C.dir&&w.test(I)});var P=this.root+w,_=g.call(this,P),B=this.clone();return B.root=_.name,B},remove:function(w){w=this.root+w;var P=this.files[w];if(P||(w.slice(-1)!=="/"&&(w+="/"),P=this.files[w]),P&&!P.dir)delete this.files[w];else for(var _=this.filter(function(I,C){return C.name.slice(0,w.length)===w}),B=0;B<_.length;B++)delete this.files[_[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(w){var P,_={};try{if((_=s.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=_.type.toLowerCase(),_.compression=_.compression.toUpperCase(),_.type==="binarystring"&&(_.type="string"),!_.type)throw new Error("No output type specified.");s.checkSupport(_.type),_.platform!=="darwin"&&_.platform!=="freebsd"&&_.platform!=="linux"&&_.platform!=="sunos"||(_.platform="UNIX"),_.platform==="win32"&&(_.platform="DOS");var B=_.comment||this.comment||"";P=h.generateWorker(this,_,B)}catch(I){(P=new o("error")).error(I)}return new a(P,_.type||"string",_.mimeType)},generateAsync:function(w,P){return this.generateInternalStream(w).accumulate(P)},generateNodeStream:function(w,P){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(P)}};e.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,e,t){"use strict";e.exports=r("stream")},{stream:void 0}],17:[function(r,e,t){"use strict";var n=r("./DataReader");function i(s){n.call(this,s);for(var o=0;o<this.data.length;o++)s[o]=255&s[o]}r("../utils").inherits(i,n),i.prototype.byteAt=function(s){return this.data[this.zero+s]},i.prototype.lastIndexOfSignature=function(s){for(var o=s.charCodeAt(0),a=s.charCodeAt(1),l=s.charCodeAt(2),u=s.charCodeAt(3),c=this.length-4;0<=c;--c)if(this.data[c]===o&&this.data[c+1]===a&&this.data[c+2]===l&&this.data[c+3]===u)return c-this.zero;return-1},i.prototype.readAndCheckSignature=function(s){var o=s.charCodeAt(0),a=s.charCodeAt(1),l=s.charCodeAt(2),u=s.charCodeAt(3),c=this.readData(4);return o===c[0]&&a===c[1]&&l===c[2]&&u===c[3]},i.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var o=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,o},e.exports=i},{"../utils":32,"./DataReader":18}],18:[function(r,e,t){"use strict";var n=r("../utils");function i(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(){},readInt:function(s){var o,a=0;for(this.checkOffset(s),o=this.index+s-1;o>=this.index;o--)a=(a<<8)+this.byteAt(o);return this.index+=s,a},readString:function(s){return n.transformTo("string",this.readData(s))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1))}},e.exports=i},{"../utils":32}],19:[function(r,e,t){"use strict";var n=r("./Uint8ArrayReader");function i(s){n.call(this,s)}r("../utils").inherits(i,n),i.prototype.readData=function(s){this.checkOffset(s);var o=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,o},e.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,e,t){"use strict";var n=r("./DataReader");function i(s){n.call(this,s)}r("../utils").inherits(i,n),i.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},i.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},i.prototype.readAndCheckSignature=function(s){return s===this.readData(4)},i.prototype.readData=function(s){this.checkOffset(s);var o=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,o},e.exports=i},{"../utils":32,"./DataReader":18}],21:[function(r,e,t){"use strict";var n=r("./ArrayReader");function i(s){n.call(this,s)}r("../utils").inherits(i,n),i.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var o=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,o},e.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(r,e,t){"use strict";var n=r("../utils"),i=r("../support"),s=r("./ArrayReader"),o=r("./StringReader"),a=r("./NodeBufferReader"),l=r("./Uint8ArrayReader");e.exports=function(u){var c=n.getTypeOf(u);return n.checkSupport(c),c!=="string"||i.uint8array?c==="nodebuffer"?new a(u):i.uint8array?new l(n.transformTo("uint8array",u)):new s(n.transformTo("array",u)):new o(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,e,t){"use strict";t.LOCAL_FILE_HEADER="PK",t.CENTRAL_FILE_HEADER="PK",t.CENTRAL_DIRECTORY_END="PK",t.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",t.ZIP64_CENTRAL_DIRECTORY_END="PK",t.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,e,t){"use strict";var n=r("./GenericWorker"),i=r("../utils");function s(o){n.call(this,"ConvertWorker to "+o),this.destType=o}i.inherits(s,n),s.prototype.processChunk=function(o){this.push({data:i.transformTo(this.destType,o.data),meta:o.meta})},e.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(r,e,t){"use strict";var n=r("./GenericWorker"),i=r("../crc32");function s(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(s,n),s.prototype.processChunk=function(o){this.streamInfo.crc32=i(o.data,this.streamInfo.crc32||0),this.push(o)},e.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,e,t){"use strict";var n=r("../utils"),i=r("./GenericWorker");function s(o){i.call(this,"DataLengthProbe for "+o),this.propName=o,this.withStreamInfo(o,0)}n.inherits(s,i),s.prototype.processChunk=function(o){if(o){var a=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=a+o.data.length}i.prototype.processChunk.call(this,o)},e.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(r,e,t){"use strict";var n=r("../utils"),i=r("./GenericWorker");function s(o){i.call(this,"DataWorker");var a=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,o.then(function(l){a.dataIsReady=!0,a.data=l,a.max=l&&l.length||0,a.type=n.getTypeOf(l),a.isPaused||a._tickAndRepeat()},function(l){a.error(l)})}n.inherits(s,i),s.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var o=null,a=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":o=this.data.substring(this.index,a);break;case"uint8array":o=this.data.subarray(this.index,a);break;case"array":case"nodebuffer":o=this.data.slice(this.index,a)}return this.index=a,this.push({data:o,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(r,e,t){"use strict";function n(i){this.name=i||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(i){this.emit("data",i)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(i){this.emit("error",i)}return!0},error:function(i){return!this.isFinished&&(this.isPaused?this.generatedError=i:(this.isFinished=!0,this.emit("error",i),this.previous&&this.previous.error(i),this.cleanUp()),!0)},on:function(i,s){return this._listeners[i].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(i,s){if(this._listeners[i])for(var o=0;o<this._listeners[i].length;o++)this._listeners[i][o].call(this,s)},pipe:function(i){return i.registerPrevious(this)},registerPrevious:function(i){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=i.streamInfo,this.mergeStreamInfo(),this.previous=i;var s=this;return i.on("data",function(o){s.processChunk(o)}),i.on("end",function(){s.end()}),i.on("error",function(o){s.error(o)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var i=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),i=!0),this.previous&&this.previous.resume(),!i},flush:function(){},processChunk:function(i){this.push(i)},withStreamInfo:function(i,s){return this.extraStreamInfo[i]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var i in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,i)&&(this.streamInfo[i]=this.extraStreamInfo[i])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var i="Worker "+this.name;return this.previous?this.previous+" -> "+i:i}},e.exports=n},{}],29:[function(r,e,t){"use strict";var n=r("../utils"),i=r("./ConvertWorker"),s=r("./GenericWorker"),o=r("../base64"),a=r("../support"),l=r("../external"),u=null;if(a.nodestream)try{u=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function c(f,d){return new l.Promise(function(m,p){var g=[],b=f._internalType,v=f._outputType,w=f._mimeType;f.on("data",function(P,_){g.push(P),d&&d(_)}).on("error",function(P){g=[],p(P)}).on("end",function(){try{var P=function(_,B,I){switch(_){case"blob":return n.newBlob(n.transformTo("arraybuffer",B),I);case"base64":return o.encode(B);default:return n.transformTo(_,B)}}(v,function(_,B){var I,C=0,N=null,A=0;for(I=0;I<B.length;I++)A+=B[I].length;switch(_){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(N=new Uint8Array(A),I=0;I<B.length;I++)N.set(B[I],C),C+=B[I].length;return N;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+_+"'")}}(b,g),w);m(P)}catch(_){p(_)}g=[]}).resume()})}function h(f,d,m){var p=d;switch(d){case"blob":case"arraybuffer":p="uint8array";break;case"base64":p="string"}try{this._internalType=p,this._outputType=d,this._mimeType=m,n.checkSupport(p),this._worker=f.pipe(new i(p)),f.lock()}catch(g){this._worker=new s("error"),this._worker.error(g)}}h.prototype={accumulate:function(f){return c(this,f)},on:function(f,d){var m=this;return f==="data"?this._worker.on(f,function(p){d.call(m,p.data,p.meta)}):this._worker.on(f,function(){n.delay(d,arguments,m)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(f){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},f)}},e.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,e,t){"use strict";if(t.base64=!0,t.array=!0,t.string=!0,t.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",t.nodebuffer=typeof Buffer<"u",t.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")t.blob=!1;else{var n=new ArrayBuffer(0);try{t.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(n),t.blob=i.getBlob("application/zip").size===0}catch{t.blob=!1}}}try{t.nodestream=!!r("readable-stream").Readable}catch{t.nodestream=!1}},{"readable-stream":16}],31:[function(r,e,t){"use strict";for(var n=r("./utils"),i=r("./support"),s=r("./nodejsUtils"),o=r("./stream/GenericWorker"),a=new Array(256),l=0;l<256;l++)a[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;a[254]=a[254]=1;function u(){o.call(this,"utf-8 decode"),this.leftOver=null}function c(){o.call(this,"utf-8 encode")}t.utf8encode=function(h){return i.nodebuffer?s.newBufferFrom(h,"utf-8"):function(f){var d,m,p,g,b,v=f.length,w=0;for(g=0;g<v;g++)(64512&(m=f.charCodeAt(g)))==55296&&g+1<v&&(64512&(p=f.charCodeAt(g+1)))==56320&&(m=65536+(m-55296<<10)+(p-56320),g++),w+=m<128?1:m<2048?2:m<65536?3:4;for(d=i.uint8array?new Uint8Array(w):new Array(w),g=b=0;b<w;g++)(64512&(m=f.charCodeAt(g)))==55296&&g+1<v&&(64512&(p=f.charCodeAt(g+1)))==56320&&(m=65536+(m-55296<<10)+(p-56320),g++),m<128?d[b++]=m:(m<2048?d[b++]=192|m>>>6:(m<65536?d[b++]=224|m>>>12:(d[b++]=240|m>>>18,d[b++]=128|m>>>12&63),d[b++]=128|m>>>6&63),d[b++]=128|63&m);return d}(h)},t.utf8decode=function(h){return i.nodebuffer?n.transformTo("nodebuffer",h).toString("utf-8"):function(f){var d,m,p,g,b=f.length,v=new Array(2*b);for(d=m=0;d<b;)if((p=f[d++])<128)v[m++]=p;else if(4<(g=a[p]))v[m++]=65533,d+=g-1;else{for(p&=g===2?31:g===3?15:7;1<g&&d<b;)p=p<<6|63&f[d++],g--;1<g?v[m++]=65533:p<65536?v[m++]=p:(p-=65536,v[m++]=55296|p>>10&1023,v[m++]=56320|1023&p)}return v.length!==m&&(v.subarray?v=v.subarray(0,m):v.length=m),n.applyFromCharCode(v)}(h=n.transformTo(i.uint8array?"uint8array":"array",h))},n.inherits(u,o),u.prototype.processChunk=function(h){var f=n.transformTo(i.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var d=f;(f=new Uint8Array(d.length+this.leftOver.length)).set(this.leftOver,0),f.set(d,this.leftOver.length)}else f=this.leftOver.concat(f);this.leftOver=null}var m=function(g,b){var v;for((b=b||g.length)>g.length&&(b=g.length),v=b-1;0<=v&&(192&g[v])==128;)v--;return v<0||v===0?b:v+a[g[v]]>b?v:b}(f),p=f;m!==f.length&&(i.uint8array?(p=f.subarray(0,m),this.leftOver=f.subarray(m,f.length)):(p=f.slice(0,m),this.leftOver=f.slice(m,f.length))),this.push({data:t.utf8decode(p),meta:h.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:t.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},t.Utf8DecodeWorker=u,n.inherits(c,o),c.prototype.processChunk=function(h){this.push({data:t.utf8encode(h.data),meta:h.meta})},t.Utf8EncodeWorker=c},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,e,t){"use strict";var n=r("./support"),i=r("./base64"),s=r("./nodejsUtils"),o=r("./external");function a(d){return d}function l(d,m){for(var p=0;p<d.length;++p)m[p]=255&d.charCodeAt(p);return m}r("setimmediate"),t.newBlob=function(d,m){t.checkSupport("blob");try{return new Blob([d],{type:m})}catch{try{var p=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return p.append(d),p.getBlob(m)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(d,m,p){var g=[],b=0,v=d.length;if(v<=p)return String.fromCharCode.apply(null,d);for(;b<v;)m==="array"||m==="nodebuffer"?g.push(String.fromCharCode.apply(null,d.slice(b,Math.min(b+p,v)))):g.push(String.fromCharCode.apply(null,d.subarray(b,Math.min(b+p,v)))),b+=p;return g.join("")},stringifyByChar:function(d){for(var m="",p=0;p<d.length;p++)m+=String.fromCharCode(d[p]);return m},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1}catch{return!1}}()}};function c(d){var m=65536,p=t.getTypeOf(d),g=!0;if(p==="uint8array"?g=u.applyCanBeUsed.uint8array:p==="nodebuffer"&&(g=u.applyCanBeUsed.nodebuffer),g)for(;1<m;)try{return u.stringifyByChunk(d,p,m)}catch{m=Math.floor(m/2)}return u.stringifyByChar(d)}function h(d,m){for(var p=0;p<d.length;p++)m[p]=d[p];return m}t.applyFromCharCode=c;var f={};f.string={string:a,array:function(d){return l(d,new Array(d.length))},arraybuffer:function(d){return f.string.uint8array(d).buffer},uint8array:function(d){return l(d,new Uint8Array(d.length))},nodebuffer:function(d){return l(d,s.allocBuffer(d.length))}},f.array={string:c,array:a,arraybuffer:function(d){return new Uint8Array(d).buffer},uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return s.newBufferFrom(d)}},f.arraybuffer={string:function(d){return c(new Uint8Array(d))},array:function(d){return h(new Uint8Array(d),new Array(d.byteLength))},arraybuffer:a,uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return s.newBufferFrom(new Uint8Array(d))}},f.uint8array={string:c,array:function(d){return h(d,new Array(d.length))},arraybuffer:function(d){return d.buffer},uint8array:a,nodebuffer:function(d){return s.newBufferFrom(d)}},f.nodebuffer={string:c,array:function(d){return h(d,new Array(d.length))},arraybuffer:function(d){return f.nodebuffer.uint8array(d).buffer},uint8array:function(d){return h(d,new Uint8Array(d.length))},nodebuffer:a},t.transformTo=function(d,m){if(m=m||"",!d)return m;t.checkSupport(d);var p=t.getTypeOf(m);return f[p][d](m)},t.resolve=function(d){for(var m=d.split("/"),p=[],g=0;g<m.length;g++){var b=m[g];b==="."||b===""&&g!==0&&g!==m.length-1||(b===".."?p.pop():p.push(b))}return p.join("/")},t.getTypeOf=function(d){return typeof d=="string"?"string":Object.prototype.toString.call(d)==="[object Array]"?"array":n.nodebuffer&&s.isBuffer(d)?"nodebuffer":n.uint8array&&d instanceof Uint8Array?"uint8array":n.arraybuffer&&d instanceof ArrayBuffer?"arraybuffer":void 0},t.checkSupport=function(d){if(!n[d.toLowerCase()])throw new Error(d+" is not supported by this platform")},t.MAX_VALUE_16BITS=65535,t.MAX_VALUE_32BITS=-1,t.pretty=function(d){var m,p,g="";for(p=0;p<(d||"").length;p++)g+="\\x"+((m=d.charCodeAt(p))<16?"0":"")+m.toString(16).toUpperCase();return g},t.delay=function(d,m,p){setImmediate(function(){d.apply(p||null,m||[])})},t.inherits=function(d,m){function p(){}p.prototype=m.prototype,d.prototype=new p},t.extend=function(){var d,m,p={};for(d=0;d<arguments.length;d++)for(m in arguments[d])Object.prototype.hasOwnProperty.call(arguments[d],m)&&p[m]===void 0&&(p[m]=arguments[d][m]);return p},t.prepareContent=function(d,m,p,g,b){return o.Promise.resolve(m).then(function(v){return n.blob&&(v instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(v))!==-1)&&typeof FileReader<"u"?new o.Promise(function(w,P){var _=new FileReader;_.onload=function(B){w(B.target.result)},_.onerror=function(B){P(B.target.error)},_.readAsArrayBuffer(v)}):v}).then(function(v){var w=t.getTypeOf(v);return w?(w==="arraybuffer"?v=t.transformTo("uint8array",v):w==="string"&&(b?v=i.decode(v):p&&g!==!0&&(v=function(P){return l(P,n.uint8array?new Uint8Array(P.length):new Array(P.length))}(v))),v):o.Promise.reject(new Error("Can't read the data of '"+d+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,e,t){"use strict";var n=r("./reader/readerFor"),i=r("./utils"),s=r("./signature"),o=r("./zipEntry"),a=r("./support");function l(u){this.files=[],this.loadOptions=u}l.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var c=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(c)+", expected "+i.pretty(u)+")")}},isSignature:function(u,c){var h=this.reader.index;this.reader.setIndex(u);var f=this.reader.readString(4)===c;return this.reader.setIndex(h),f},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),c=a.uint8array?"uint8array":"array",h=i.transformTo(c,u);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,c,h,f=this.zip64EndOfCentralSize-44;0<f;)u=this.reader.readInt(2),c=this.reader.readInt(4),h=this.reader.readData(c),this.zip64ExtensibleData[u]={id:u,length:c,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,c;for(u=0;u<this.files.length;u++)c=this.files[u],this.reader.setIndex(c.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),c.readLocalPart(this.reader),c.handleUTF8(),c.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(u=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var c=u;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var f=c-h;if(0<f)this.isSignature(c,s.CENTRAL_FILE_HEADER)||(this.reader.zero=f);else if(f<0)throw new Error("Corrupted zip: missing "+Math.abs(f)+" bytes.")},prepareReader:function(u){this.reader=n(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,e,t){"use strict";var n=r("./reader/readerFor"),i=r("./utils"),s=r("./compressedObject"),o=r("./crc32"),a=r("./utf8"),l=r("./compressions"),u=r("./support");function c(h,f){this.options=h,this.loadOptions=f}c.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var f,d;if(h.skip(22),this.fileNameLength=h.readInt(2),d=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(d),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((f=function(m){for(var p in l)if(Object.prototype.hasOwnProperty.call(l,p)&&l[p].magic===m)return l[p];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,f,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var f=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(f),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var f,d,m,p=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<p;)f=h.readInt(2),d=h.readInt(2),m=h.readData(d),this.extraFields[f]={id:f,length:d,value:m};h.setIndex(p)},handleUTF8:function(){var h=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var f=this.findExtraFieldUnicodePath();if(f!==null)this.fileNameStr=f;else{var d=i.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(d)}var m=this.findExtraFieldUnicodeComment();if(m!==null)this.fileCommentStr=m;else{var p=i.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(p)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var f=n(h.value);return f.readInt(1)!==1||o(this.fileName)!==f.readInt(4)?null:a.utf8decode(f.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var f=n(h.value);return f.readInt(1)!==1||o(this.fileComment)!==f.readInt(4)?null:a.utf8decode(f.readData(h.length-5))}return null}},e.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,e,t){"use strict";function n(f,d,m){this.name=f,this.dir=m.dir,this.date=m.date,this.comment=m.comment,this.unixPermissions=m.unixPermissions,this.dosPermissions=m.dosPermissions,this._data=d,this._dataBinary=m.binary,this.options={compression:m.compression,compressionOptions:m.compressionOptions}}var i=r("./stream/StreamHelper"),s=r("./stream/DataWorker"),o=r("./utf8"),a=r("./compressedObject"),l=r("./stream/GenericWorker");n.prototype={internalStream:function(f){var d=null,m="string";try{if(!f)throw new Error("No output type specified.");var p=(m=f.toLowerCase())==="string"||m==="text";m!=="binarystring"&&m!=="text"||(m="string"),d=this._decompressWorker();var g=!this._dataBinary;g&&!p&&(d=d.pipe(new o.Utf8EncodeWorker)),!g&&p&&(d=d.pipe(new o.Utf8DecodeWorker))}catch(b){(d=new l("error")).error(b)}return new i(d,m,"")},async:function(f,d){return this.internalStream(f).accumulate(d)},nodeStream:function(f,d){return this.internalStream(f||"nodebuffer").toNodejsStream(d)},_compressWorker:function(f,d){if(this._data instanceof a&&this._data.compression.magic===f.magic)return this._data.getCompressedWorker();var m=this._decompressWorker();return this._dataBinary||(m=m.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(m,f,d)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof l?this._data:new s(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<u.length;h++)n.prototype[u[h]]=c;e.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,e,t){(function(n){"use strict";var i,s,o=n.MutationObserver||n.WebKitMutationObserver;if(o){var a=0,l=new o(f),u=n.document.createTextNode("");l.observe(u,{characterData:!0}),i=function(){u.data=a=++a%2}}else if(n.setImmediate||n.MessageChannel===void 0)i="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var d=n.document.createElement("script");d.onreadystatechange=function(){f(),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},n.document.documentElement.appendChild(d)}:function(){setTimeout(f,0)};else{var c=new n.MessageChannel;c.port1.onmessage=f,i=function(){c.port2.postMessage(0)}}var h=[];function f(){var d,m;s=!0;for(var p=h.length;p;){for(m=h,h=[],d=-1;++d<p;)m[d]();p=h.length}s=!1}e.exports=function(d){h.push(d)!==1||s||i()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,e,t){"use strict";var n=r("immediate");function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function u(p){if(typeof p!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,p!==i&&d(this,p)}function c(p,g,b){this.promise=p,typeof g=="function"&&(this.onFulfilled=g,this.callFulfilled=this.otherCallFulfilled),typeof b=="function"&&(this.onRejected=b,this.callRejected=this.otherCallRejected)}function h(p,g,b){n(function(){var v;try{v=g(b)}catch(w){return s.reject(p,w)}v===p?s.reject(p,new TypeError("Cannot resolve promise with itself")):s.resolve(p,v)})}function f(p){var g=p&&p.then;if(p&&(typeof p=="object"||typeof p=="function")&&typeof g=="function")return function(){g.apply(p,arguments)}}function d(p,g){var b=!1;function v(_){b||(b=!0,s.reject(p,_))}function w(_){b||(b=!0,s.resolve(p,_))}var P=m(function(){g(w,v)});P.status==="error"&&v(P.value)}function m(p,g){var b={};try{b.value=p(g),b.status="success"}catch(v){b.status="error",b.value=v}return b}(e.exports=u).prototype.finally=function(p){if(typeof p!="function")return this;var g=this.constructor;return this.then(function(b){return g.resolve(p()).then(function(){return b})},function(b){return g.resolve(p()).then(function(){throw b})})},u.prototype.catch=function(p){return this.then(null,p)},u.prototype.then=function(p,g){if(typeof p!="function"&&this.state===a||typeof g!="function"&&this.state===o)return this;var b=new this.constructor(i);return this.state!==l?h(b,this.state===a?p:g,this.outcome):this.queue.push(new c(b,p,g)),b},c.prototype.callFulfilled=function(p){s.resolve(this.promise,p)},c.prototype.otherCallFulfilled=function(p){h(this.promise,this.onFulfilled,p)},c.prototype.callRejected=function(p){s.reject(this.promise,p)},c.prototype.otherCallRejected=function(p){h(this.promise,this.onRejected,p)},s.resolve=function(p,g){var b=m(f,g);if(b.status==="error")return s.reject(p,b.value);var v=b.value;if(v)d(p,v);else{p.state=a,p.outcome=g;for(var w=-1,P=p.queue.length;++w<P;)p.queue[w].callFulfilled(g)}return p},s.reject=function(p,g){p.state=o,p.outcome=g;for(var b=-1,v=p.queue.length;++b<v;)p.queue[b].callRejected(g);return p},u.resolve=function(p){return p instanceof this?p:s.resolve(new this(i),p)},u.reject=function(p){var g=new this(i);return s.reject(g,p)},u.all=function(p){var g=this;if(Object.prototype.toString.call(p)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=p.length,v=!1;if(!b)return this.resolve([]);for(var w=new Array(b),P=0,_=-1,B=new this(i);++_<b;)I(p[_],_);return B;function I(C,N){g.resolve(C).then(function(A){w[N]=A,++P!==b||v||(v=!0,s.resolve(B,w))},function(A){v||(v=!0,s.reject(B,A))})}},u.race=function(p){var g=this;if(Object.prototype.toString.call(p)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=p.length,v=!1;if(!b)return this.resolve([]);for(var w=-1,P=new this(i);++w<b;)_=p[w],g.resolve(_).then(function(B){v||(v=!0,s.resolve(P,B))},function(B){v||(v=!0,s.reject(P,B))});var _;return P}},{immediate:36}],38:[function(r,e,t){"use strict";var n={};(0,r("./lib/utils/common").assign)(n,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),e.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,e,t){"use strict";var n=r("./zlib/deflate"),i=r("./utils/common"),s=r("./utils/strings"),o=r("./zlib/messages"),a=r("./zlib/zstream"),l=Object.prototype.toString,u=0,c=-1,h=0,f=8;function d(p){if(!(this instanceof d))return new d(p);this.options=i.assign({level:c,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},p||{});var g=this.options;g.raw&&0<g.windowBits?g.windowBits=-g.windowBits:g.gzip&&0<g.windowBits&&g.windowBits<16&&(g.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var b=n.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(b!==u)throw new Error(o[b]);if(g.header&&n.deflateSetHeader(this.strm,g.header),g.dictionary){var v;if(v=typeof g.dictionary=="string"?s.string2buf(g.dictionary):l.call(g.dictionary)==="[object ArrayBuffer]"?new Uint8Array(g.dictionary):g.dictionary,(b=n.deflateSetDictionary(this.strm,v))!==u)throw new Error(o[b]);this._dict_set=!0}}function m(p,g){var b=new d(g);if(b.push(p,!0),b.err)throw b.msg||o[b.err];return b.result}d.prototype.push=function(p,g){var b,v,w=this.strm,P=this.options.chunkSize;if(this.ended)return!1;v=g===~~g?g:g===!0?4:0,typeof p=="string"?w.input=s.string2buf(p):l.call(p)==="[object ArrayBuffer]"?w.input=new Uint8Array(p):w.input=p,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new i.Buf8(P),w.next_out=0,w.avail_out=P),(b=n.deflate(w,v))!==1&&b!==u)return this.onEnd(b),!(this.ended=!0);w.avail_out!==0&&(w.avail_in!==0||v!==4&&v!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(i.shrinkBuf(w.output,w.next_out))):this.onData(i.shrinkBuf(w.output,w.next_out)))}while((0<w.avail_in||w.avail_out===0)&&b!==1);return v===4?(b=n.deflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===u):v!==2||(this.onEnd(u),!(w.avail_out=0))},d.prototype.onData=function(p){this.chunks.push(p)},d.prototype.onEnd=function(p){p===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},t.Deflate=d,t.deflate=m,t.deflateRaw=function(p,g){return(g=g||{}).raw=!0,m(p,g)},t.gzip=function(p,g){return(g=g||{}).gzip=!0,m(p,g)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,e,t){"use strict";var n=r("./zlib/inflate"),i=r("./utils/common"),s=r("./utils/strings"),o=r("./zlib/constants"),a=r("./zlib/messages"),l=r("./zlib/zstream"),u=r("./zlib/gzheader"),c=Object.prototype.toString;function h(d){if(!(this instanceof h))return new h(d);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},d||{});var m=this.options;m.raw&&0<=m.windowBits&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),!(0<=m.windowBits&&m.windowBits<16)||d&&d.windowBits||(m.windowBits+=32),15<m.windowBits&&m.windowBits<48&&(15&m.windowBits)==0&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var p=n.inflateInit2(this.strm,m.windowBits);if(p!==o.Z_OK)throw new Error(a[p]);this.header=new u,n.inflateGetHeader(this.strm,this.header)}function f(d,m){var p=new h(m);if(p.push(d,!0),p.err)throw p.msg||a[p.err];return p.result}h.prototype.push=function(d,m){var p,g,b,v,w,P,_=this.strm,B=this.options.chunkSize,I=this.options.dictionary,C=!1;if(this.ended)return!1;g=m===~~m?m:m===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof d=="string"?_.input=s.binstring2buf(d):c.call(d)==="[object ArrayBuffer]"?_.input=new Uint8Array(d):_.input=d,_.next_in=0,_.avail_in=_.input.length;do{if(_.avail_out===0&&(_.output=new i.Buf8(B),_.next_out=0,_.avail_out=B),(p=n.inflate(_,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&I&&(P=typeof I=="string"?s.string2buf(I):c.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,p=n.inflateSetDictionary(this.strm,P)),p===o.Z_BUF_ERROR&&C===!0&&(p=o.Z_OK,C=!1),p!==o.Z_STREAM_END&&p!==o.Z_OK)return this.onEnd(p),!(this.ended=!0);_.next_out&&(_.avail_out!==0&&p!==o.Z_STREAM_END&&(_.avail_in!==0||g!==o.Z_FINISH&&g!==o.Z_SYNC_FLUSH)||(this.options.to==="string"?(b=s.utf8border(_.output,_.next_out),v=_.next_out-b,w=s.buf2string(_.output,b),_.next_out=v,_.avail_out=B-v,v&&i.arraySet(_.output,_.output,b,v,0),this.onData(w)):this.onData(i.shrinkBuf(_.output,_.next_out)))),_.avail_in===0&&_.avail_out===0&&(C=!0)}while((0<_.avail_in||_.avail_out===0)&&p!==o.Z_STREAM_END);return p===o.Z_STREAM_END&&(g=o.Z_FINISH),g===o.Z_FINISH?(p=n.inflateEnd(this.strm),this.onEnd(p),this.ended=!0,p===o.Z_OK):g!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(_.avail_out=0))},h.prototype.onData=function(d){this.chunks.push(d)},h.prototype.onEnd=function(d){d===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},t.Inflate=h,t.inflate=f,t.inflateRaw=function(d,m){return(m=m||{}).raw=!0,f(d,m)},t.ungzip=f},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,e,t){"use strict";var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";t.assign=function(o){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var u in l)l.hasOwnProperty(u)&&(o[u]=l[u])}}return o},t.shrinkBuf=function(o,a){return o.length===a?o:o.subarray?o.subarray(0,a):(o.length=a,o)};var i={arraySet:function(o,a,l,u,c){if(a.subarray&&o.subarray)o.set(a.subarray(l,l+u),c);else for(var h=0;h<u;h++)o[c+h]=a[l+h]},flattenChunks:function(o){var a,l,u,c,h,f;for(a=u=0,l=o.length;a<l;a++)u+=o[a].length;for(f=new Uint8Array(u),a=c=0,l=o.length;a<l;a++)h=o[a],f.set(h,c),c+=h.length;return f}},s={arraySet:function(o,a,l,u,c){for(var h=0;h<u;h++)o[c+h]=a[l+h]},flattenChunks:function(o){return[].concat.apply([],o)}};t.setTyped=function(o){o?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,s))},t.setTyped(n)},{}],42:[function(r,e,t){"use strict";var n=r("./common"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var o=new n.Buf8(256),a=0;a<256;a++)o[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function l(u,c){if(c<65537&&(u.subarray&&s||!u.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(u,c));for(var h="",f=0;f<c;f++)h+=String.fromCharCode(u[f]);return h}o[254]=o[254]=1,t.string2buf=function(u){var c,h,f,d,m,p=u.length,g=0;for(d=0;d<p;d++)(64512&(h=u.charCodeAt(d)))==55296&&d+1<p&&(64512&(f=u.charCodeAt(d+1)))==56320&&(h=65536+(h-55296<<10)+(f-56320),d++),g+=h<128?1:h<2048?2:h<65536?3:4;for(c=new n.Buf8(g),d=m=0;m<g;d++)(64512&(h=u.charCodeAt(d)))==55296&&d+1<p&&(64512&(f=u.charCodeAt(d+1)))==56320&&(h=65536+(h-55296<<10)+(f-56320),d++),h<128?c[m++]=h:(h<2048?c[m++]=192|h>>>6:(h<65536?c[m++]=224|h>>>12:(c[m++]=240|h>>>18,c[m++]=128|h>>>12&63),c[m++]=128|h>>>6&63),c[m++]=128|63&h);return c},t.buf2binstring=function(u){return l(u,u.length)},t.binstring2buf=function(u){for(var c=new n.Buf8(u.length),h=0,f=c.length;h<f;h++)c[h]=u.charCodeAt(h);return c},t.buf2string=function(u,c){var h,f,d,m,p=c||u.length,g=new Array(2*p);for(h=f=0;h<p;)if((d=u[h++])<128)g[f++]=d;else if(4<(m=o[d]))g[f++]=65533,h+=m-1;else{for(d&=m===2?31:m===3?15:7;1<m&&h<p;)d=d<<6|63&u[h++],m--;1<m?g[f++]=65533:d<65536?g[f++]=d:(d-=65536,g[f++]=55296|d>>10&1023,g[f++]=56320|1023&d)}return l(g,f)},t.utf8border=function(u,c){var h;for((c=c||u.length)>u.length&&(c=u.length),h=c-1;0<=h&&(192&u[h])==128;)h--;return h<0||h===0?c:h+o[u[h]]>c?h:c}},{"./common":41}],43:[function(r,e,t){"use strict";e.exports=function(n,i,s,o){for(var a=65535&n|0,l=n>>>16&65535|0,u=0;s!==0;){for(s-=u=2e3<s?2e3:s;l=l+(a=a+i[o++]|0)|0,--u;);a%=65521,l%=65521}return a|l<<16|0}},{}],44:[function(r,e,t){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,e,t){"use strict";var n=function(){for(var i,s=[],o=0;o<256;o++){i=o;for(var a=0;a<8;a++)i=1&i?3988292384^i>>>1:i>>>1;s[o]=i}return s}();e.exports=function(i,s,o,a){var l=n,u=a+o;i^=-1;for(var c=a;c<u;c++)i=i>>>8^l[255&(i^s[c])];return-1^i}},{}],46:[function(r,e,t){"use strict";var n,i=r("../utils/common"),s=r("./trees"),o=r("./adler32"),a=r("./crc32"),l=r("./messages"),u=0,c=4,h=0,f=-2,d=-1,m=4,p=2,g=8,b=9,v=286,w=30,P=19,_=2*v+1,B=15,I=3,C=258,N=C+I+1,A=42,M=113,S=1,$=2,H=3,K=4;function F(R,pe){return R.msg=l[pe],pe}function z(R){return(R<<1)-(4<R?9:0)}function L(R){for(var pe=R.length;0<=--pe;)R[pe]=0}function k(R){var pe=R.state,he=pe.pending;he>R.avail_out&&(he=R.avail_out),he!==0&&(i.arraySet(R.output,pe.pending_buf,pe.pending_out,he,R.next_out),R.next_out+=he,pe.pending_out+=he,R.total_out+=he,R.avail_out-=he,pe.pending-=he,pe.pending===0&&(pe.pending_out=0))}function O(R,pe){s._tr_flush_block(R,0<=R.block_start?R.block_start:-1,R.strstart-R.block_start,pe),R.block_start=R.strstart,k(R.strm)}function ie(R,pe){R.pending_buf[R.pending++]=pe}function W(R,pe){R.pending_buf[R.pending++]=pe>>>8&255,R.pending_buf[R.pending++]=255&pe}function Q(R,pe){var he,J,Z=R.max_chain_length,se=R.strstart,de=R.prev_length,_e=R.nice_match,ue=R.strstart>R.w_size-N?R.strstart-(R.w_size-N):0,Pe=R.window,Ue=R.w_mask,Be=R.prev,We=R.strstart+C,Ut=Pe[se+de-1],gt=Pe[se+de];R.prev_length>=R.good_match&&(Z>>=2),_e>R.lookahead&&(_e=R.lookahead);do if(Pe[(he=pe)+de]===gt&&Pe[he+de-1]===Ut&&Pe[he]===Pe[se]&&Pe[++he]===Pe[se+1]){se+=2,he++;do;while(Pe[++se]===Pe[++he]&&Pe[++se]===Pe[++he]&&Pe[++se]===Pe[++he]&&Pe[++se]===Pe[++he]&&Pe[++se]===Pe[++he]&&Pe[++se]===Pe[++he]&&Pe[++se]===Pe[++he]&&Pe[++se]===Pe[++he]&&se<We);if(J=C-(We-se),se=We-C,de<J){if(R.match_start=pe,_e<=(de=J))break;Ut=Pe[se+de-1],gt=Pe[se+de]}}while((pe=Be[pe&Ue])>ue&&--Z!=0);return de<=R.lookahead?de:R.lookahead}function oe(R){var pe,he,J,Z,se,de,_e,ue,Pe,Ue,Be=R.w_size;do{if(Z=R.window_size-R.lookahead-R.strstart,R.strstart>=Be+(Be-N)){for(i.arraySet(R.window,R.window,Be,Be,0),R.match_start-=Be,R.strstart-=Be,R.block_start-=Be,pe=he=R.hash_size;J=R.head[--pe],R.head[pe]=Be<=J?J-Be:0,--he;);for(pe=he=Be;J=R.prev[--pe],R.prev[pe]=Be<=J?J-Be:0,--he;);Z+=Be}if(R.strm.avail_in===0)break;if(de=R.strm,_e=R.window,ue=R.strstart+R.lookahead,Pe=Z,Ue=void 0,Ue=de.avail_in,Pe<Ue&&(Ue=Pe),he=Ue===0?0:(de.avail_in-=Ue,i.arraySet(_e,de.input,de.next_in,Ue,ue),de.state.wrap===1?de.adler=o(de.adler,_e,Ue,ue):de.state.wrap===2&&(de.adler=a(de.adler,_e,Ue,ue)),de.next_in+=Ue,de.total_in+=Ue,Ue),R.lookahead+=he,R.lookahead+R.insert>=I)for(se=R.strstart-R.insert,R.ins_h=R.window[se],R.ins_h=(R.ins_h<<R.hash_shift^R.window[se+1])&R.hash_mask;R.insert&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[se+I-1])&R.hash_mask,R.prev[se&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=se,se++,R.insert--,!(R.lookahead+R.insert<I)););}while(R.lookahead<N&&R.strm.avail_in!==0)}function we(R,pe){for(var he,J;;){if(R.lookahead<N){if(oe(R),R.lookahead<N&&pe===u)return S;if(R.lookahead===0)break}if(he=0,R.lookahead>=I&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+I-1])&R.hash_mask,he=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),he!==0&&R.strstart-he<=R.w_size-N&&(R.match_length=Q(R,he)),R.match_length>=I)if(J=s._tr_tally(R,R.strstart-R.match_start,R.match_length-I),R.lookahead-=R.match_length,R.match_length<=R.max_lazy_match&&R.lookahead>=I){for(R.match_length--;R.strstart++,R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+I-1])&R.hash_mask,he=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart,--R.match_length!=0;);R.strstart++}else R.strstart+=R.match_length,R.match_length=0,R.ins_h=R.window[R.strstart],R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+1])&R.hash_mask;else J=s._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++;if(J&&(O(R,!1),R.strm.avail_out===0))return S}return R.insert=R.strstart<I-1?R.strstart:I-1,pe===c?(O(R,!0),R.strm.avail_out===0?H:K):R.last_lit&&(O(R,!1),R.strm.avail_out===0)?S:$}function xe(R,pe){for(var he,J,Z;;){if(R.lookahead<N){if(oe(R),R.lookahead<N&&pe===u)return S;if(R.lookahead===0)break}if(he=0,R.lookahead>=I&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+I-1])&R.hash_mask,he=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),R.prev_length=R.match_length,R.prev_match=R.match_start,R.match_length=I-1,he!==0&&R.prev_length<R.max_lazy_match&&R.strstart-he<=R.w_size-N&&(R.match_length=Q(R,he),R.match_length<=5&&(R.strategy===1||R.match_length===I&&4096<R.strstart-R.match_start)&&(R.match_length=I-1)),R.prev_length>=I&&R.match_length<=R.prev_length){for(Z=R.strstart+R.lookahead-I,J=s._tr_tally(R,R.strstart-1-R.prev_match,R.prev_length-I),R.lookahead-=R.prev_length-1,R.prev_length-=2;++R.strstart<=Z&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+I-1])&R.hash_mask,he=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),--R.prev_length!=0;);if(R.match_available=0,R.match_length=I-1,R.strstart++,J&&(O(R,!1),R.strm.avail_out===0))return S}else if(R.match_available){if((J=s._tr_tally(R,0,R.window[R.strstart-1]))&&O(R,!1),R.strstart++,R.lookahead--,R.strm.avail_out===0)return S}else R.match_available=1,R.strstart++,R.lookahead--}return R.match_available&&(J=s._tr_tally(R,0,R.window[R.strstart-1]),R.match_available=0),R.insert=R.strstart<I-1?R.strstart:I-1,pe===c?(O(R,!0),R.strm.avail_out===0?H:K):R.last_lit&&(O(R,!1),R.strm.avail_out===0)?S:$}function ge(R,pe,he,J,Z){this.good_length=R,this.max_lazy=pe,this.nice_length=he,this.max_chain=J,this.func=Z}function Le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*_),this.dyn_dtree=new i.Buf16(2*(2*w+1)),this.bl_tree=new i.Buf16(2*(2*P+1)),L(this.dyn_ltree),L(this.dyn_dtree),L(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(B+1),this.heap=new i.Buf16(2*v+1),L(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*v+1),L(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ne(R){var pe;return R&&R.state?(R.total_in=R.total_out=0,R.data_type=p,(pe=R.state).pending=0,pe.pending_out=0,pe.wrap<0&&(pe.wrap=-pe.wrap),pe.status=pe.wrap?A:M,R.adler=pe.wrap===2?0:1,pe.last_flush=u,s._tr_init(pe),h):F(R,f)}function Ve(R){var pe=Ne(R);return pe===h&&function(he){he.window_size=2*he.w_size,L(he.head),he.max_lazy_match=n[he.level].max_lazy,he.good_match=n[he.level].good_length,he.nice_match=n[he.level].nice_length,he.max_chain_length=n[he.level].max_chain,he.strstart=0,he.block_start=0,he.lookahead=0,he.insert=0,he.match_length=he.prev_length=I-1,he.match_available=0,he.ins_h=0}(R.state),pe}function ht(R,pe,he,J,Z,se){if(!R)return f;var de=1;if(pe===d&&(pe=6),J<0?(de=0,J=-J):15<J&&(de=2,J-=16),Z<1||b<Z||he!==g||J<8||15<J||pe<0||9<pe||se<0||m<se)return F(R,f);J===8&&(J=9);var _e=new Le;return(R.state=_e).strm=R,_e.wrap=de,_e.gzhead=null,_e.w_bits=J,_e.w_size=1<<_e.w_bits,_e.w_mask=_e.w_size-1,_e.hash_bits=Z+7,_e.hash_size=1<<_e.hash_bits,_e.hash_mask=_e.hash_size-1,_e.hash_shift=~~((_e.hash_bits+I-1)/I),_e.window=new i.Buf8(2*_e.w_size),_e.head=new i.Buf16(_e.hash_size),_e.prev=new i.Buf16(_e.w_size),_e.lit_bufsize=1<<Z+6,_e.pending_buf_size=4*_e.lit_bufsize,_e.pending_buf=new i.Buf8(_e.pending_buf_size),_e.d_buf=1*_e.lit_bufsize,_e.l_buf=3*_e.lit_bufsize,_e.level=pe,_e.strategy=se,_e.method=he,Ve(R)}n=[new ge(0,0,0,0,function(R,pe){var he=65535;for(he>R.pending_buf_size-5&&(he=R.pending_buf_size-5);;){if(R.lookahead<=1){if(oe(R),R.lookahead===0&&pe===u)return S;if(R.lookahead===0)break}R.strstart+=R.lookahead,R.lookahead=0;var J=R.block_start+he;if((R.strstart===0||R.strstart>=J)&&(R.lookahead=R.strstart-J,R.strstart=J,O(R,!1),R.strm.avail_out===0)||R.strstart-R.block_start>=R.w_size-N&&(O(R,!1),R.strm.avail_out===0))return S}return R.insert=0,pe===c?(O(R,!0),R.strm.avail_out===0?H:K):(R.strstart>R.block_start&&(O(R,!1),R.strm.avail_out),S)}),new ge(4,4,8,4,we),new ge(4,5,16,8,we),new ge(4,6,32,32,we),new ge(4,4,16,16,xe),new ge(8,16,32,32,xe),new ge(8,16,128,128,xe),new ge(8,32,128,256,xe),new ge(32,128,258,1024,xe),new ge(32,258,258,4096,xe)],t.deflateInit=function(R,pe){return ht(R,pe,g,15,8,0)},t.deflateInit2=ht,t.deflateReset=Ve,t.deflateResetKeep=Ne,t.deflateSetHeader=function(R,pe){return R&&R.state?R.state.wrap!==2?f:(R.state.gzhead=pe,h):f},t.deflate=function(R,pe){var he,J,Z,se;if(!R||!R.state||5<pe||pe<0)return R?F(R,f):f;if(J=R.state,!R.output||!R.input&&R.avail_in!==0||J.status===666&&pe!==c)return F(R,R.avail_out===0?-5:f);if(J.strm=R,he=J.last_flush,J.last_flush=pe,J.status===A)if(J.wrap===2)R.adler=0,ie(J,31),ie(J,139),ie(J,8),J.gzhead?(ie(J,(J.gzhead.text?1:0)+(J.gzhead.hcrc?2:0)+(J.gzhead.extra?4:0)+(J.gzhead.name?8:0)+(J.gzhead.comment?16:0)),ie(J,255&J.gzhead.time),ie(J,J.gzhead.time>>8&255),ie(J,J.gzhead.time>>16&255),ie(J,J.gzhead.time>>24&255),ie(J,J.level===9?2:2<=J.strategy||J.level<2?4:0),ie(J,255&J.gzhead.os),J.gzhead.extra&&J.gzhead.extra.length&&(ie(J,255&J.gzhead.extra.length),ie(J,J.gzhead.extra.length>>8&255)),J.gzhead.hcrc&&(R.adler=a(R.adler,J.pending_buf,J.pending,0)),J.gzindex=0,J.status=69):(ie(J,0),ie(J,0),ie(J,0),ie(J,0),ie(J,0),ie(J,J.level===9?2:2<=J.strategy||J.level<2?4:0),ie(J,3),J.status=M);else{var de=g+(J.w_bits-8<<4)<<8;de|=(2<=J.strategy||J.level<2?0:J.level<6?1:J.level===6?2:3)<<6,J.strstart!==0&&(de|=32),de+=31-de%31,J.status=M,W(J,de),J.strstart!==0&&(W(J,R.adler>>>16),W(J,65535&R.adler)),R.adler=1}if(J.status===69)if(J.gzhead.extra){for(Z=J.pending;J.gzindex<(65535&J.gzhead.extra.length)&&(J.pending!==J.pending_buf_size||(J.gzhead.hcrc&&J.pending>Z&&(R.adler=a(R.adler,J.pending_buf,J.pending-Z,Z)),k(R),Z=J.pending,J.pending!==J.pending_buf_size));)ie(J,255&J.gzhead.extra[J.gzindex]),J.gzindex++;J.gzhead.hcrc&&J.pending>Z&&(R.adler=a(R.adler,J.pending_buf,J.pending-Z,Z)),J.gzindex===J.gzhead.extra.length&&(J.gzindex=0,J.status=73)}else J.status=73;if(J.status===73)if(J.gzhead.name){Z=J.pending;do{if(J.pending===J.pending_buf_size&&(J.gzhead.hcrc&&J.pending>Z&&(R.adler=a(R.adler,J.pending_buf,J.pending-Z,Z)),k(R),Z=J.pending,J.pending===J.pending_buf_size)){se=1;break}se=J.gzindex<J.gzhead.name.length?255&J.gzhead.name.charCodeAt(J.gzindex++):0,ie(J,se)}while(se!==0);J.gzhead.hcrc&&J.pending>Z&&(R.adler=a(R.adler,J.pending_buf,J.pending-Z,Z)),se===0&&(J.gzindex=0,J.status=91)}else J.status=91;if(J.status===91)if(J.gzhead.comment){Z=J.pending;do{if(J.pending===J.pending_buf_size&&(J.gzhead.hcrc&&J.pending>Z&&(R.adler=a(R.adler,J.pending_buf,J.pending-Z,Z)),k(R),Z=J.pending,J.pending===J.pending_buf_size)){se=1;break}se=J.gzindex<J.gzhead.comment.length?255&J.gzhead.comment.charCodeAt(J.gzindex++):0,ie(J,se)}while(se!==0);J.gzhead.hcrc&&J.pending>Z&&(R.adler=a(R.adler,J.pending_buf,J.pending-Z,Z)),se===0&&(J.status=103)}else J.status=103;if(J.status===103&&(J.gzhead.hcrc?(J.pending+2>J.pending_buf_size&&k(R),J.pending+2<=J.pending_buf_size&&(ie(J,255&R.adler),ie(J,R.adler>>8&255),R.adler=0,J.status=M)):J.status=M),J.pending!==0){if(k(R),R.avail_out===0)return J.last_flush=-1,h}else if(R.avail_in===0&&z(pe)<=z(he)&&pe!==c)return F(R,-5);if(J.status===666&&R.avail_in!==0)return F(R,-5);if(R.avail_in!==0||J.lookahead!==0||pe!==u&&J.status!==666){var _e=J.strategy===2?function(ue,Pe){for(var Ue;;){if(ue.lookahead===0&&(oe(ue),ue.lookahead===0)){if(Pe===u)return S;break}if(ue.match_length=0,Ue=s._tr_tally(ue,0,ue.window[ue.strstart]),ue.lookahead--,ue.strstart++,Ue&&(O(ue,!1),ue.strm.avail_out===0))return S}return ue.insert=0,Pe===c?(O(ue,!0),ue.strm.avail_out===0?H:K):ue.last_lit&&(O(ue,!1),ue.strm.avail_out===0)?S:$}(J,pe):J.strategy===3?function(ue,Pe){for(var Ue,Be,We,Ut,gt=ue.window;;){if(ue.lookahead<=C){if(oe(ue),ue.lookahead<=C&&Pe===u)return S;if(ue.lookahead===0)break}if(ue.match_length=0,ue.lookahead>=I&&0<ue.strstart&&(Be=gt[We=ue.strstart-1])===gt[++We]&&Be===gt[++We]&&Be===gt[++We]){Ut=ue.strstart+C;do;while(Be===gt[++We]&&Be===gt[++We]&&Be===gt[++We]&&Be===gt[++We]&&Be===gt[++We]&&Be===gt[++We]&&Be===gt[++We]&&Be===gt[++We]&&We<Ut);ue.match_length=C-(Ut-We),ue.match_length>ue.lookahead&&(ue.match_length=ue.lookahead)}if(ue.match_length>=I?(Ue=s._tr_tally(ue,1,ue.match_length-I),ue.lookahead-=ue.match_length,ue.strstart+=ue.match_length,ue.match_length=0):(Ue=s._tr_tally(ue,0,ue.window[ue.strstart]),ue.lookahead--,ue.strstart++),Ue&&(O(ue,!1),ue.strm.avail_out===0))return S}return ue.insert=0,Pe===c?(O(ue,!0),ue.strm.avail_out===0?H:K):ue.last_lit&&(O(ue,!1),ue.strm.avail_out===0)?S:$}(J,pe):n[J.level].func(J,pe);if(_e!==H&&_e!==K||(J.status=666),_e===S||_e===H)return R.avail_out===0&&(J.last_flush=-1),h;if(_e===$&&(pe===1?s._tr_align(J):pe!==5&&(s._tr_stored_block(J,0,0,!1),pe===3&&(L(J.head),J.lookahead===0&&(J.strstart=0,J.block_start=0,J.insert=0))),k(R),R.avail_out===0))return J.last_flush=-1,h}return pe!==c?h:J.wrap<=0?1:(J.wrap===2?(ie(J,255&R.adler),ie(J,R.adler>>8&255),ie(J,R.adler>>16&255),ie(J,R.adler>>24&255),ie(J,255&R.total_in),ie(J,R.total_in>>8&255),ie(J,R.total_in>>16&255),ie(J,R.total_in>>24&255)):(W(J,R.adler>>>16),W(J,65535&R.adler)),k(R),0<J.wrap&&(J.wrap=-J.wrap),J.pending!==0?h:1)},t.deflateEnd=function(R){var pe;return R&&R.state?(pe=R.state.status)!==A&&pe!==69&&pe!==73&&pe!==91&&pe!==103&&pe!==M&&pe!==666?F(R,f):(R.state=null,pe===M?F(R,-3):h):f},t.deflateSetDictionary=function(R,pe){var he,J,Z,se,de,_e,ue,Pe,Ue=pe.length;if(!R||!R.state||(se=(he=R.state).wrap)===2||se===1&&he.status!==A||he.lookahead)return f;for(se===1&&(R.adler=o(R.adler,pe,Ue,0)),he.wrap=0,Ue>=he.w_size&&(se===0&&(L(he.head),he.strstart=0,he.block_start=0,he.insert=0),Pe=new i.Buf8(he.w_size),i.arraySet(Pe,pe,Ue-he.w_size,he.w_size,0),pe=Pe,Ue=he.w_size),de=R.avail_in,_e=R.next_in,ue=R.input,R.avail_in=Ue,R.next_in=0,R.input=pe,oe(he);he.lookahead>=I;){for(J=he.strstart,Z=he.lookahead-(I-1);he.ins_h=(he.ins_h<<he.hash_shift^he.window[J+I-1])&he.hash_mask,he.prev[J&he.w_mask]=he.head[he.ins_h],he.head[he.ins_h]=J,J++,--Z;);he.strstart=J,he.lookahead=I-1,oe(he)}return he.strstart+=he.lookahead,he.block_start=he.strstart,he.insert=he.lookahead,he.lookahead=0,he.match_length=he.prev_length=I-1,he.match_available=0,R.next_in=_e,R.input=ue,R.avail_in=de,he.wrap=se,h},t.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,e,t){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,e,t){"use strict";e.exports=function(n,i){var s,o,a,l,u,c,h,f,d,m,p,g,b,v,w,P,_,B,I,C,N,A,M,S,$;s=n.state,o=n.next_in,S=n.input,a=o+(n.avail_in-5),l=n.next_out,$=n.output,u=l-(i-n.avail_out),c=l+(n.avail_out-257),h=s.dmax,f=s.wsize,d=s.whave,m=s.wnext,p=s.window,g=s.hold,b=s.bits,v=s.lencode,w=s.distcode,P=(1<<s.lenbits)-1,_=(1<<s.distbits)-1;e:do{b<15&&(g+=S[o++]<<b,b+=8,g+=S[o++]<<b,b+=8),B=v[g&P];t:for(;;){if(g>>>=I=B>>>24,b-=I,(I=B>>>16&255)===0)$[l++]=65535&B;else{if(!(16&I)){if((64&I)==0){B=v[(65535&B)+(g&(1<<I)-1)];continue t}if(32&I){s.mode=12;break e}n.msg="invalid literal/length code",s.mode=30;break e}C=65535&B,(I&=15)&&(b<I&&(g+=S[o++]<<b,b+=8),C+=g&(1<<I)-1,g>>>=I,b-=I),b<15&&(g+=S[o++]<<b,b+=8,g+=S[o++]<<b,b+=8),B=w[g&_];r:for(;;){if(g>>>=I=B>>>24,b-=I,!(16&(I=B>>>16&255))){if((64&I)==0){B=w[(65535&B)+(g&(1<<I)-1)];continue r}n.msg="invalid distance code",s.mode=30;break e}if(N=65535&B,b<(I&=15)&&(g+=S[o++]<<b,(b+=8)<I&&(g+=S[o++]<<b,b+=8)),h<(N+=g&(1<<I)-1)){n.msg="invalid distance too far back",s.mode=30;break e}if(g>>>=I,b-=I,(I=l-u)<N){if(d<(I=N-I)&&s.sane){n.msg="invalid distance too far back",s.mode=30;break e}if(M=p,(A=0)===m){if(A+=f-I,I<C){for(C-=I;$[l++]=p[A++],--I;);A=l-N,M=$}}else if(m<I){if(A+=f+m-I,(I-=m)<C){for(C-=I;$[l++]=p[A++],--I;);if(A=0,m<C){for(C-=I=m;$[l++]=p[A++],--I;);A=l-N,M=$}}}else if(A+=m-I,I<C){for(C-=I;$[l++]=p[A++],--I;);A=l-N,M=$}for(;2<C;)$[l++]=M[A++],$[l++]=M[A++],$[l++]=M[A++],C-=3;C&&($[l++]=M[A++],1<C&&($[l++]=M[A++]))}else{for(A=l-N;$[l++]=$[A++],$[l++]=$[A++],$[l++]=$[A++],2<(C-=3););C&&($[l++]=$[A++],1<C&&($[l++]=$[A++]))}break}}break}}while(o<a&&l<c);o-=C=b>>3,g&=(1<<(b-=C<<3))-1,n.next_in=o,n.next_out=l,n.avail_in=o<a?a-o+5:5-(o-a),n.avail_out=l<c?c-l+257:257-(l-c),s.hold=g,s.bits=b}},{}],49:[function(r,e,t){"use strict";var n=r("../utils/common"),i=r("./adler32"),s=r("./crc32"),o=r("./inffast"),a=r("./inftrees"),l=1,u=2,c=0,h=-2,f=1,d=852,m=592;function p(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function b(A){var M;return A&&A.state?(M=A.state,A.total_in=A.total_out=M.total=0,A.msg="",M.wrap&&(A.adler=1&M.wrap),M.mode=f,M.last=0,M.havedict=0,M.dmax=32768,M.head=null,M.hold=0,M.bits=0,M.lencode=M.lendyn=new n.Buf32(d),M.distcode=M.distdyn=new n.Buf32(m),M.sane=1,M.back=-1,c):h}function v(A){var M;return A&&A.state?((M=A.state).wsize=0,M.whave=0,M.wnext=0,b(A)):h}function w(A,M){var S,$;return A&&A.state?($=A.state,M<0?(S=0,M=-M):(S=1+(M>>4),M<48&&(M&=15)),M&&(M<8||15<M)?h:($.window!==null&&$.wbits!==M&&($.window=null),$.wrap=S,$.wbits=M,v(A))):h}function P(A,M){var S,$;return A?($=new g,(A.state=$).window=null,(S=w(A,M))!==c&&(A.state=null),S):h}var _,B,I=!0;function C(A){if(I){var M;for(_=new n.Buf32(512),B=new n.Buf32(32),M=0;M<144;)A.lens[M++]=8;for(;M<256;)A.lens[M++]=9;for(;M<280;)A.lens[M++]=7;for(;M<288;)A.lens[M++]=8;for(a(l,A.lens,0,288,_,0,A.work,{bits:9}),M=0;M<32;)A.lens[M++]=5;a(u,A.lens,0,32,B,0,A.work,{bits:5}),I=!1}A.lencode=_,A.lenbits=9,A.distcode=B,A.distbits=5}function N(A,M,S,$){var H,K=A.state;return K.window===null&&(K.wsize=1<<K.wbits,K.wnext=0,K.whave=0,K.window=new n.Buf8(K.wsize)),$>=K.wsize?(n.arraySet(K.window,M,S-K.wsize,K.wsize,0),K.wnext=0,K.whave=K.wsize):($<(H=K.wsize-K.wnext)&&(H=$),n.arraySet(K.window,M,S-$,H,K.wnext),($-=H)?(n.arraySet(K.window,M,S-$,$,0),K.wnext=$,K.whave=K.wsize):(K.wnext+=H,K.wnext===K.wsize&&(K.wnext=0),K.whave<K.wsize&&(K.whave+=H))),0}t.inflateReset=v,t.inflateReset2=w,t.inflateResetKeep=b,t.inflateInit=function(A){return P(A,15)},t.inflateInit2=P,t.inflate=function(A,M){var S,$,H,K,F,z,L,k,O,ie,W,Q,oe,we,xe,ge,Le,Ne,Ve,ht,R,pe,he,J,Z=0,se=new n.Buf8(4),de=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!A||!A.state||!A.output||!A.input&&A.avail_in!==0)return h;(S=A.state).mode===12&&(S.mode=13),F=A.next_out,H=A.output,L=A.avail_out,K=A.next_in,$=A.input,z=A.avail_in,k=S.hold,O=S.bits,ie=z,W=L,pe=c;e:for(;;)switch(S.mode){case f:if(S.wrap===0){S.mode=13;break}for(;O<16;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}if(2&S.wrap&&k===35615){se[S.check=0]=255&k,se[1]=k>>>8&255,S.check=s(S.check,se,2,0),O=k=0,S.mode=2;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&k)<<8)+(k>>8))%31){A.msg="incorrect header check",S.mode=30;break}if((15&k)!=8){A.msg="unknown compression method",S.mode=30;break}if(O-=4,R=8+(15&(k>>>=4)),S.wbits===0)S.wbits=R;else if(R>S.wbits){A.msg="invalid window size",S.mode=30;break}S.dmax=1<<R,A.adler=S.check=1,S.mode=512&k?10:12,O=k=0;break;case 2:for(;O<16;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}if(S.flags=k,(255&S.flags)!=8){A.msg="unknown compression method",S.mode=30;break}if(57344&S.flags){A.msg="unknown header flags set",S.mode=30;break}S.head&&(S.head.text=k>>8&1),512&S.flags&&(se[0]=255&k,se[1]=k>>>8&255,S.check=s(S.check,se,2,0)),O=k=0,S.mode=3;case 3:for(;O<32;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}S.head&&(S.head.time=k),512&S.flags&&(se[0]=255&k,se[1]=k>>>8&255,se[2]=k>>>16&255,se[3]=k>>>24&255,S.check=s(S.check,se,4,0)),O=k=0,S.mode=4;case 4:for(;O<16;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}S.head&&(S.head.xflags=255&k,S.head.os=k>>8),512&S.flags&&(se[0]=255&k,se[1]=k>>>8&255,S.check=s(S.check,se,2,0)),O=k=0,S.mode=5;case 5:if(1024&S.flags){for(;O<16;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}S.length=k,S.head&&(S.head.extra_len=k),512&S.flags&&(se[0]=255&k,se[1]=k>>>8&255,S.check=s(S.check,se,2,0)),O=k=0}else S.head&&(S.head.extra=null);S.mode=6;case 6:if(1024&S.flags&&(z<(Q=S.length)&&(Q=z),Q&&(S.head&&(R=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Array(S.head.extra_len)),n.arraySet(S.head.extra,$,K,Q,R)),512&S.flags&&(S.check=s(S.check,$,Q,K)),z-=Q,K+=Q,S.length-=Q),S.length))break e;S.length=0,S.mode=7;case 7:if(2048&S.flags){if(z===0)break e;for(Q=0;R=$[K+Q++],S.head&&R&&S.length<65536&&(S.head.name+=String.fromCharCode(R)),R&&Q<z;);if(512&S.flags&&(S.check=s(S.check,$,Q,K)),z-=Q,K+=Q,R)break e}else S.head&&(S.head.name=null);S.length=0,S.mode=8;case 8:if(4096&S.flags){if(z===0)break e;for(Q=0;R=$[K+Q++],S.head&&R&&S.length<65536&&(S.head.comment+=String.fromCharCode(R)),R&&Q<z;);if(512&S.flags&&(S.check=s(S.check,$,Q,K)),z-=Q,K+=Q,R)break e}else S.head&&(S.head.comment=null);S.mode=9;case 9:if(512&S.flags){for(;O<16;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}if(k!==(65535&S.check)){A.msg="header crc mismatch",S.mode=30;break}O=k=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),A.adler=S.check=0,S.mode=12;break;case 10:for(;O<32;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}A.adler=S.check=p(k),O=k=0,S.mode=11;case 11:if(S.havedict===0)return A.next_out=F,A.avail_out=L,A.next_in=K,A.avail_in=z,S.hold=k,S.bits=O,2;A.adler=S.check=1,S.mode=12;case 12:if(M===5||M===6)break e;case 13:if(S.last){k>>>=7&O,O-=7&O,S.mode=27;break}for(;O<3;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}switch(S.last=1&k,O-=1,3&(k>>>=1)){case 0:S.mode=14;break;case 1:if(C(S),S.mode=20,M!==6)break;k>>>=2,O-=2;break e;case 2:S.mode=17;break;case 3:A.msg="invalid block type",S.mode=30}k>>>=2,O-=2;break;case 14:for(k>>>=7&O,O-=7&O;O<32;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}if((65535&k)!=(k>>>16^65535)){A.msg="invalid stored block lengths",S.mode=30;break}if(S.length=65535&k,O=k=0,S.mode=15,M===6)break e;case 15:S.mode=16;case 16:if(Q=S.length){if(z<Q&&(Q=z),L<Q&&(Q=L),Q===0)break e;n.arraySet(H,$,K,Q,F),z-=Q,K+=Q,L-=Q,F+=Q,S.length-=Q;break}S.mode=12;break;case 17:for(;O<14;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}if(S.nlen=257+(31&k),k>>>=5,O-=5,S.ndist=1+(31&k),k>>>=5,O-=5,S.ncode=4+(15&k),k>>>=4,O-=4,286<S.nlen||30<S.ndist){A.msg="too many length or distance symbols",S.mode=30;break}S.have=0,S.mode=18;case 18:for(;S.have<S.ncode;){for(;O<3;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}S.lens[de[S.have++]]=7&k,k>>>=3,O-=3}for(;S.have<19;)S.lens[de[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,he={bits:S.lenbits},pe=a(0,S.lens,0,19,S.lencode,0,S.work,he),S.lenbits=he.bits,pe){A.msg="invalid code lengths set",S.mode=30;break}S.have=0,S.mode=19;case 19:for(;S.have<S.nlen+S.ndist;){for(;ge=(Z=S.lencode[k&(1<<S.lenbits)-1])>>>16&255,Le=65535&Z,!((xe=Z>>>24)<=O);){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}if(Le<16)k>>>=xe,O-=xe,S.lens[S.have++]=Le;else{if(Le===16){for(J=xe+2;O<J;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}if(k>>>=xe,O-=xe,S.have===0){A.msg="invalid bit length repeat",S.mode=30;break}R=S.lens[S.have-1],Q=3+(3&k),k>>>=2,O-=2}else if(Le===17){for(J=xe+3;O<J;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}O-=xe,R=0,Q=3+(7&(k>>>=xe)),k>>>=3,O-=3}else{for(J=xe+7;O<J;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}O-=xe,R=0,Q=11+(127&(k>>>=xe)),k>>>=7,O-=7}if(S.have+Q>S.nlen+S.ndist){A.msg="invalid bit length repeat",S.mode=30;break}for(;Q--;)S.lens[S.have++]=R}}if(S.mode===30)break;if(S.lens[256]===0){A.msg="invalid code -- missing end-of-block",S.mode=30;break}if(S.lenbits=9,he={bits:S.lenbits},pe=a(l,S.lens,0,S.nlen,S.lencode,0,S.work,he),S.lenbits=he.bits,pe){A.msg="invalid literal/lengths set",S.mode=30;break}if(S.distbits=6,S.distcode=S.distdyn,he={bits:S.distbits},pe=a(u,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,he),S.distbits=he.bits,pe){A.msg="invalid distances set",S.mode=30;break}if(S.mode=20,M===6)break e;case 20:S.mode=21;case 21:if(6<=z&&258<=L){A.next_out=F,A.avail_out=L,A.next_in=K,A.avail_in=z,S.hold=k,S.bits=O,o(A,W),F=A.next_out,H=A.output,L=A.avail_out,K=A.next_in,$=A.input,z=A.avail_in,k=S.hold,O=S.bits,S.mode===12&&(S.back=-1);break}for(S.back=0;ge=(Z=S.lencode[k&(1<<S.lenbits)-1])>>>16&255,Le=65535&Z,!((xe=Z>>>24)<=O);){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}if(ge&&(240&ge)==0){for(Ne=xe,Ve=ge,ht=Le;ge=(Z=S.lencode[ht+((k&(1<<Ne+Ve)-1)>>Ne)])>>>16&255,Le=65535&Z,!(Ne+(xe=Z>>>24)<=O);){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}k>>>=Ne,O-=Ne,S.back+=Ne}if(k>>>=xe,O-=xe,S.back+=xe,S.length=Le,ge===0){S.mode=26;break}if(32&ge){S.back=-1,S.mode=12;break}if(64&ge){A.msg="invalid literal/length code",S.mode=30;break}S.extra=15&ge,S.mode=22;case 22:if(S.extra){for(J=S.extra;O<J;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}S.length+=k&(1<<S.extra)-1,k>>>=S.extra,O-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=23;case 23:for(;ge=(Z=S.distcode[k&(1<<S.distbits)-1])>>>16&255,Le=65535&Z,!((xe=Z>>>24)<=O);){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}if((240&ge)==0){for(Ne=xe,Ve=ge,ht=Le;ge=(Z=S.distcode[ht+((k&(1<<Ne+Ve)-1)>>Ne)])>>>16&255,Le=65535&Z,!(Ne+(xe=Z>>>24)<=O);){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}k>>>=Ne,O-=Ne,S.back+=Ne}if(k>>>=xe,O-=xe,S.back+=xe,64&ge){A.msg="invalid distance code",S.mode=30;break}S.offset=Le,S.extra=15&ge,S.mode=24;case 24:if(S.extra){for(J=S.extra;O<J;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}S.offset+=k&(1<<S.extra)-1,k>>>=S.extra,O-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){A.msg="invalid distance too far back",S.mode=30;break}S.mode=25;case 25:if(L===0)break e;if(Q=W-L,S.offset>Q){if((Q=S.offset-Q)>S.whave&&S.sane){A.msg="invalid distance too far back",S.mode=30;break}oe=Q>S.wnext?(Q-=S.wnext,S.wsize-Q):S.wnext-Q,Q>S.length&&(Q=S.length),we=S.window}else we=H,oe=F-S.offset,Q=S.length;for(L<Q&&(Q=L),L-=Q,S.length-=Q;H[F++]=we[oe++],--Q;);S.length===0&&(S.mode=21);break;case 26:if(L===0)break e;H[F++]=S.length,L--,S.mode=21;break;case 27:if(S.wrap){for(;O<32;){if(z===0)break e;z--,k|=$[K++]<<O,O+=8}if(W-=L,A.total_out+=W,S.total+=W,W&&(A.adler=S.check=S.flags?s(S.check,H,W,F-W):i(S.check,H,W,F-W)),W=L,(S.flags?k:p(k))!==S.check){A.msg="incorrect data check",S.mode=30;break}O=k=0}S.mode=28;case 28:if(S.wrap&&S.flags){for(;O<32;){if(z===0)break e;z--,k+=$[K++]<<O,O+=8}if(k!==(4294967295&S.total)){A.msg="incorrect length check",S.mode=30;break}O=k=0}S.mode=29;case 29:pe=1;break e;case 30:pe=-3;break e;case 31:return-4;case 32:default:return h}return A.next_out=F,A.avail_out=L,A.next_in=K,A.avail_in=z,S.hold=k,S.bits=O,(S.wsize||W!==A.avail_out&&S.mode<30&&(S.mode<27||M!==4))&&N(A,A.output,A.next_out,W-A.avail_out)?(S.mode=31,-4):(ie-=A.avail_in,W-=A.avail_out,A.total_in+=ie,A.total_out+=W,S.total+=W,S.wrap&&W&&(A.adler=S.check=S.flags?s(S.check,H,W,A.next_out-W):i(S.check,H,W,A.next_out-W)),A.data_type=S.bits+(S.last?64:0)+(S.mode===12?128:0)+(S.mode===20||S.mode===15?256:0),(ie==0&&W===0||M===4)&&pe===c&&(pe=-5),pe)},t.inflateEnd=function(A){if(!A||!A.state)return h;var M=A.state;return M.window&&(M.window=null),A.state=null,c},t.inflateGetHeader=function(A,M){var S;return A&&A.state?(2&(S=A.state).wrap)==0?h:((S.head=M).done=!1,c):h},t.inflateSetDictionary=function(A,M){var S,$=M.length;return A&&A.state?(S=A.state).wrap!==0&&S.mode!==11?h:S.mode===11&&i(1,M,$,0)!==S.check?-3:N(A,M,$,$)?(S.mode=31,-4):(S.havedict=1,c):h},t.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,e,t){"use strict";var n=r("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(l,u,c,h,f,d,m,p){var g,b,v,w,P,_,B,I,C,N=p.bits,A=0,M=0,S=0,$=0,H=0,K=0,F=0,z=0,L=0,k=0,O=null,ie=0,W=new n.Buf16(16),Q=new n.Buf16(16),oe=null,we=0;for(A=0;A<=15;A++)W[A]=0;for(M=0;M<h;M++)W[u[c+M]]++;for(H=N,$=15;1<=$&&W[$]===0;$--);if($<H&&(H=$),$===0)return f[d++]=20971520,f[d++]=20971520,p.bits=1,0;for(S=1;S<$&&W[S]===0;S++);for(H<S&&(H=S),A=z=1;A<=15;A++)if(z<<=1,(z-=W[A])<0)return-1;if(0<z&&(l===0||$!==1))return-1;for(Q[1]=0,A=1;A<15;A++)Q[A+1]=Q[A]+W[A];for(M=0;M<h;M++)u[c+M]!==0&&(m[Q[u[c+M]]++]=M);if(_=l===0?(O=oe=m,19):l===1?(O=i,ie-=257,oe=s,we-=257,256):(O=o,oe=a,-1),A=S,P=d,F=M=k=0,v=-1,w=(L=1<<(K=H))-1,l===1&&852<L||l===2&&592<L)return 1;for(;;){for(B=A-F,C=m[M]<_?(I=0,m[M]):m[M]>_?(I=oe[we+m[M]],O[ie+m[M]]):(I=96,0),g=1<<A-F,S=b=1<<K;f[P+(k>>F)+(b-=g)]=B<<24|I<<16|C|0,b!==0;);for(g=1<<A-1;k&g;)g>>=1;if(g!==0?(k&=g-1,k+=g):k=0,M++,--W[A]==0){if(A===$)break;A=u[c+m[M]]}if(H<A&&(k&w)!==v){for(F===0&&(F=H),P+=S,z=1<<(K=A-F);K+F<$&&!((z-=W[K+F])<=0);)K++,z<<=1;if(L+=1<<K,l===1&&852<L||l===2&&592<L)return 1;f[v=k&w]=H<<24|K<<16|P-d|0}}return k!==0&&(f[P+k]=A-F<<24|64<<16|0),p.bits=H,0}},{"../utils/common":41}],51:[function(r,e,t){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,e,t){"use strict";var n=r("../utils/common"),i=0,s=1;function o(Z){for(var se=Z.length;0<=--se;)Z[se]=0}var a=0,l=29,u=256,c=u+1+l,h=30,f=19,d=2*c+1,m=15,p=16,g=7,b=256,v=16,w=17,P=18,_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],N=new Array(2*(c+2));o(N);var A=new Array(2*h);o(A);var M=new Array(512);o(M);var S=new Array(256);o(S);var $=new Array(l);o($);var H,K,F,z=new Array(h);function L(Z,se,de,_e,ue){this.static_tree=Z,this.extra_bits=se,this.extra_base=de,this.elems=_e,this.max_length=ue,this.has_stree=Z&&Z.length}function k(Z,se){this.dyn_tree=Z,this.max_code=0,this.stat_desc=se}function O(Z){return Z<256?M[Z]:M[256+(Z>>>7)]}function ie(Z,se){Z.pending_buf[Z.pending++]=255&se,Z.pending_buf[Z.pending++]=se>>>8&255}function W(Z,se,de){Z.bi_valid>p-de?(Z.bi_buf|=se<<Z.bi_valid&65535,ie(Z,Z.bi_buf),Z.bi_buf=se>>p-Z.bi_valid,Z.bi_valid+=de-p):(Z.bi_buf|=se<<Z.bi_valid&65535,Z.bi_valid+=de)}function Q(Z,se,de){W(Z,de[2*se],de[2*se+1])}function oe(Z,se){for(var de=0;de|=1&Z,Z>>>=1,de<<=1,0<--se;);return de>>>1}function we(Z,se,de){var _e,ue,Pe=new Array(m+1),Ue=0;for(_e=1;_e<=m;_e++)Pe[_e]=Ue=Ue+de[_e-1]<<1;for(ue=0;ue<=se;ue++){var Be=Z[2*ue+1];Be!==0&&(Z[2*ue]=oe(Pe[Be]++,Be))}}function xe(Z){var se;for(se=0;se<c;se++)Z.dyn_ltree[2*se]=0;for(se=0;se<h;se++)Z.dyn_dtree[2*se]=0;for(se=0;se<f;se++)Z.bl_tree[2*se]=0;Z.dyn_ltree[2*b]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0}function ge(Z){8<Z.bi_valid?ie(Z,Z.bi_buf):0<Z.bi_valid&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0}function Le(Z,se,de,_e){var ue=2*se,Pe=2*de;return Z[ue]<Z[Pe]||Z[ue]===Z[Pe]&&_e[se]<=_e[de]}function Ne(Z,se,de){for(var _e=Z.heap[de],ue=de<<1;ue<=Z.heap_len&&(ue<Z.heap_len&&Le(se,Z.heap[ue+1],Z.heap[ue],Z.depth)&&ue++,!Le(se,_e,Z.heap[ue],Z.depth));)Z.heap[de]=Z.heap[ue],de=ue,ue<<=1;Z.heap[de]=_e}function Ve(Z,se,de){var _e,ue,Pe,Ue,Be=0;if(Z.last_lit!==0)for(;_e=Z.pending_buf[Z.d_buf+2*Be]<<8|Z.pending_buf[Z.d_buf+2*Be+1],ue=Z.pending_buf[Z.l_buf+Be],Be++,_e===0?Q(Z,ue,se):(Q(Z,(Pe=S[ue])+u+1,se),(Ue=_[Pe])!==0&&W(Z,ue-=$[Pe],Ue),Q(Z,Pe=O(--_e),de),(Ue=B[Pe])!==0&&W(Z,_e-=z[Pe],Ue)),Be<Z.last_lit;);Q(Z,b,se)}function ht(Z,se){var de,_e,ue,Pe=se.dyn_tree,Ue=se.stat_desc.static_tree,Be=se.stat_desc.has_stree,We=se.stat_desc.elems,Ut=-1;for(Z.heap_len=0,Z.heap_max=d,de=0;de<We;de++)Pe[2*de]!==0?(Z.heap[++Z.heap_len]=Ut=de,Z.depth[de]=0):Pe[2*de+1]=0;for(;Z.heap_len<2;)Pe[2*(ue=Z.heap[++Z.heap_len]=Ut<2?++Ut:0)]=1,Z.depth[ue]=0,Z.opt_len--,Be&&(Z.static_len-=Ue[2*ue+1]);for(se.max_code=Ut,de=Z.heap_len>>1;1<=de;de--)Ne(Z,Pe,de);for(ue=We;de=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],Ne(Z,Pe,1),_e=Z.heap[1],Z.heap[--Z.heap_max]=de,Z.heap[--Z.heap_max]=_e,Pe[2*ue]=Pe[2*de]+Pe[2*_e],Z.depth[ue]=(Z.depth[de]>=Z.depth[_e]?Z.depth[de]:Z.depth[_e])+1,Pe[2*de+1]=Pe[2*_e+1]=ue,Z.heap[1]=ue++,Ne(Z,Pe,1),2<=Z.heap_len;);Z.heap[--Z.heap_max]=Z.heap[1],function(gt,Rr){var St,Cn,vs,Qt,Xt,pn,Mn=Rr.dyn_tree,Tc=Rr.max_code,Cc=Rr.stat_desc.static_tree,Lp=Rr.stat_desc.has_stree,Op=Rr.stat_desc.extra_bits,He=Rr.stat_desc.extra_base,Rt=Rr.stat_desc.max_length,Zr=0;for(Qt=0;Qt<=m;Qt++)gt.bl_count[Qt]=0;for(Mn[2*gt.heap[gt.heap_max]+1]=0,St=gt.heap_max+1;St<d;St++)Rt<(Qt=Mn[2*Mn[2*(Cn=gt.heap[St])+1]+1]+1)&&(Qt=Rt,Zr++),Mn[2*Cn+1]=Qt,Tc<Cn||(gt.bl_count[Qt]++,Xt=0,He<=Cn&&(Xt=Op[Cn-He]),pn=Mn[2*Cn],gt.opt_len+=pn*(Qt+Xt),Lp&&(gt.static_len+=pn*(Cc[2*Cn+1]+Xt)));if(Zr!==0){do{for(Qt=Rt-1;gt.bl_count[Qt]===0;)Qt--;gt.bl_count[Qt]--,gt.bl_count[Qt+1]+=2,gt.bl_count[Rt]--,Zr-=2}while(0<Zr);for(Qt=Rt;Qt!==0;Qt--)for(Cn=gt.bl_count[Qt];Cn!==0;)Tc<(vs=gt.heap[--St])||(Mn[2*vs+1]!==Qt&&(gt.opt_len+=(Qt-Mn[2*vs+1])*Mn[2*vs],Mn[2*vs+1]=Qt),Cn--)}}(Z,se),we(Pe,Ut,Z.bl_count)}function R(Z,se,de){var _e,ue,Pe=-1,Ue=se[1],Be=0,We=7,Ut=4;for(Ue===0&&(We=138,Ut=3),se[2*(de+1)+1]=65535,_e=0;_e<=de;_e++)ue=Ue,Ue=se[2*(_e+1)+1],++Be<We&&ue===Ue||(Be<Ut?Z.bl_tree[2*ue]+=Be:ue!==0?(ue!==Pe&&Z.bl_tree[2*ue]++,Z.bl_tree[2*v]++):Be<=10?Z.bl_tree[2*w]++:Z.bl_tree[2*P]++,Pe=ue,Ut=(Be=0)===Ue?(We=138,3):ue===Ue?(We=6,3):(We=7,4))}function pe(Z,se,de){var _e,ue,Pe=-1,Ue=se[1],Be=0,We=7,Ut=4;for(Ue===0&&(We=138,Ut=3),_e=0;_e<=de;_e++)if(ue=Ue,Ue=se[2*(_e+1)+1],!(++Be<We&&ue===Ue)){if(Be<Ut)for(;Q(Z,ue,Z.bl_tree),--Be!=0;);else ue!==0?(ue!==Pe&&(Q(Z,ue,Z.bl_tree),Be--),Q(Z,v,Z.bl_tree),W(Z,Be-3,2)):Be<=10?(Q(Z,w,Z.bl_tree),W(Z,Be-3,3)):(Q(Z,P,Z.bl_tree),W(Z,Be-11,7));Pe=ue,Ut=(Be=0)===Ue?(We=138,3):ue===Ue?(We=6,3):(We=7,4)}}o(z);var he=!1;function J(Z,se,de,_e){W(Z,(a<<1)+(_e?1:0),3),function(ue,Pe,Ue,Be){ge(ue),Be&&(ie(ue,Ue),ie(ue,~Ue)),n.arraySet(ue.pending_buf,ue.window,Pe,Ue,ue.pending),ue.pending+=Ue}(Z,se,de,!0)}t._tr_init=function(Z){he||(function(){var se,de,_e,ue,Pe,Ue=new Array(m+1);for(ue=_e=0;ue<l-1;ue++)for($[ue]=_e,se=0;se<1<<_[ue];se++)S[_e++]=ue;for(S[_e-1]=ue,ue=Pe=0;ue<16;ue++)for(z[ue]=Pe,se=0;se<1<<B[ue];se++)M[Pe++]=ue;for(Pe>>=7;ue<h;ue++)for(z[ue]=Pe<<7,se=0;se<1<<B[ue]-7;se++)M[256+Pe++]=ue;for(de=0;de<=m;de++)Ue[de]=0;for(se=0;se<=143;)N[2*se+1]=8,se++,Ue[8]++;for(;se<=255;)N[2*se+1]=9,se++,Ue[9]++;for(;se<=279;)N[2*se+1]=7,se++,Ue[7]++;for(;se<=287;)N[2*se+1]=8,se++,Ue[8]++;for(we(N,c+1,Ue),se=0;se<h;se++)A[2*se+1]=5,A[2*se]=oe(se,5);H=new L(N,_,u+1,c,m),K=new L(A,B,0,h,m),F=new L(new Array(0),I,0,f,g)}(),he=!0),Z.l_desc=new k(Z.dyn_ltree,H),Z.d_desc=new k(Z.dyn_dtree,K),Z.bl_desc=new k(Z.bl_tree,F),Z.bi_buf=0,Z.bi_valid=0,xe(Z)},t._tr_stored_block=J,t._tr_flush_block=function(Z,se,de,_e){var ue,Pe,Ue=0;0<Z.level?(Z.strm.data_type===2&&(Z.strm.data_type=function(Be){var We,Ut=4093624447;for(We=0;We<=31;We++,Ut>>>=1)if(1&Ut&&Be.dyn_ltree[2*We]!==0)return i;if(Be.dyn_ltree[18]!==0||Be.dyn_ltree[20]!==0||Be.dyn_ltree[26]!==0)return s;for(We=32;We<u;We++)if(Be.dyn_ltree[2*We]!==0)return s;return i}(Z)),ht(Z,Z.l_desc),ht(Z,Z.d_desc),Ue=function(Be){var We;for(R(Be,Be.dyn_ltree,Be.l_desc.max_code),R(Be,Be.dyn_dtree,Be.d_desc.max_code),ht(Be,Be.bl_desc),We=f-1;3<=We&&Be.bl_tree[2*C[We]+1]===0;We--);return Be.opt_len+=3*(We+1)+5+5+4,We}(Z),ue=Z.opt_len+3+7>>>3,(Pe=Z.static_len+3+7>>>3)<=ue&&(ue=Pe)):ue=Pe=de+5,de+4<=ue&&se!==-1?J(Z,se,de,_e):Z.strategy===4||Pe===ue?(W(Z,2+(_e?1:0),3),Ve(Z,N,A)):(W(Z,4+(_e?1:0),3),function(Be,We,Ut,gt){var Rr;for(W(Be,We-257,5),W(Be,Ut-1,5),W(Be,gt-4,4),Rr=0;Rr<gt;Rr++)W(Be,Be.bl_tree[2*C[Rr]+1],3);pe(Be,Be.dyn_ltree,We-1),pe(Be,Be.dyn_dtree,Ut-1)}(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,Ue+1),Ve(Z,Z.dyn_ltree,Z.dyn_dtree)),xe(Z),_e&&ge(Z)},t._tr_tally=function(Z,se,de){return Z.pending_buf[Z.d_buf+2*Z.last_lit]=se>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&se,Z.pending_buf[Z.l_buf+Z.last_lit]=255&de,Z.last_lit++,se===0?Z.dyn_ltree[2*de]++:(Z.matches++,se--,Z.dyn_ltree[2*(S[de]+u+1)]++,Z.dyn_dtree[2*O(se)]++),Z.last_lit===Z.lit_bufsize-1},t._tr_align=function(Z){W(Z,2,3),Q(Z,b,N),function(se){se.bi_valid===16?(ie(se,se.bi_buf),se.bi_buf=0,se.bi_valid=0):8<=se.bi_valid&&(se.pending_buf[se.pending++]=255&se.bi_buf,se.bi_buf>>=8,se.bi_valid-=8)}(Z)}},{"../utils/common":41}],53:[function(r,e,t){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,e,t){(function(n){(function(i,s){"use strict";if(!i.setImmediate){var o,a,l,u,c=1,h={},f=!1,d=i.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(i);m=m&&m.setTimeout?m:i,o={}.toString.call(i.process)==="[object process]"?function(v){process.nextTick(function(){g(v)})}:function(){if(i.postMessage&&!i.importScripts){var v=!0,w=i.onmessage;return i.onmessage=function(){v=!1},i.postMessage("","*"),i.onmessage=w,v}}()?(u="setImmediate$"+Math.random()+"$",i.addEventListener?i.addEventListener("message",b,!1):i.attachEvent("onmessage",b),function(v){i.postMessage(u+v,"*")}):i.MessageChannel?((l=new MessageChannel).port1.onmessage=function(v){g(v.data)},function(v){l.port2.postMessage(v)}):d&&"onreadystatechange"in d.createElement("script")?(a=d.documentElement,function(v){var w=d.createElement("script");w.onreadystatechange=function(){g(v),w.onreadystatechange=null,a.removeChild(w),w=null},a.appendChild(w)}):function(v){setTimeout(g,0,v)},m.setImmediate=function(v){typeof v!="function"&&(v=new Function(""+v));for(var w=new Array(arguments.length-1),P=0;P<w.length;P++)w[P]=arguments[P+1];var _={callback:v,args:w};return h[c]=_,o(c),c++},m.clearImmediate=p}function p(v){delete h[v]}function g(v){if(f)setTimeout(g,0,v);else{var w=h[v];if(w){f=!0;try{(function(P){var _=P.callback,B=P.args;switch(B.length){case 0:_();break;case 1:_(B[0]);break;case 2:_(B[0],B[1]);break;case 3:_(B[0],B[1],B[2]);break;default:_.apply(s,B)}})(w)}finally{p(v),f=!1}}}}function b(v){v.source===i&&typeof v.data=="string"&&v.data.indexOf(u)===0&&g(+v.data.slice(u.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})});var Ke=G((tRe,__)=>{var E_=r=>r.reduce((e,t)=>Array.isArray(t)?e.concat(E_(t)):e.concat(t),[]);__.exports=E_});var S_=G((rRe,P_)=>{var pX=r=>Object.assign({},r);P_.exports=pX});var B_=G((nRe,I_)=>{var mX=(r,e,t)=>(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r[9]=e[9]+t[9],r[10]=e[10]+t[10],r[11]=e[11]+t[11],r[12]=e[12]+t[12],r[13]=e[13]+t[13],r[14]=e[14]+t[14],r[15]=e[15]+t[15],r);I_.exports=mX});var If=G((iRe,A_)=>{var gX=()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];A_.exports=gX});var C_=G((sRe,T_)=>{var xX=If(),bX=r=>{let e=xX();return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e};T_.exports=bX});var E0=G((oRe,M_)=>{var yX=(r,e)=>(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r);M_.exports=yX});var R_=G((aRe,N_)=>{var vX=(r,e)=>{let t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],f=e[10],d=e[11],m=e[12],p=e[13],g=e[14],b=e[15],v=t*a-n*o,w=t*l-i*o,P=t*u-s*o,_=n*l-i*a,B=n*u-s*a,I=i*u-s*l,C=c*p-h*m,N=c*g-f*m,A=c*b-d*m,M=h*g-f*p,S=h*b-d*p,$=f*b-d*g,H=v*$-w*S+P*M+_*A-B*N+I*C;return H?(H=1/H,r[0]=(a*$-l*S+u*M)*H,r[1]=(i*S-n*$-s*M)*H,r[2]=(p*I-g*B+b*_)*H,r[3]=(f*B-h*I-d*_)*H,r[4]=(l*A-o*$-u*N)*H,r[5]=(t*$-i*A+s*N)*H,r[6]=(g*P-m*I-b*w)*H,r[7]=(c*I-f*P+d*w)*H,r[8]=(o*S-a*A+u*C)*H,r[9]=(n*A-t*S-s*C)*H,r[10]=(m*B-p*P+b*v)*H,r[11]=(h*P-c*B-d*v)*H,r[12]=(a*N-o*M-l*C)*H,r[13]=(t*M-n*N+i*C)*H,r[14]=(p*w-m*_-g*v)*H,r[15]=(c*_-h*w+f*v)*H,r):null};N_.exports=vX});var O_=G((lRe,L_)=>{var wX=(r,e)=>r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15];L_.exports=wX});var bt=G((dRe,k_)=>{var uRe=1e5,cRe=1e-5,hRe=1e-13,EX=Math.PI*2;k_.exports={EPS:1e-5,NEPS:1e-13,TAU:EX,spatialResolution:1e5}});var Mr=G((fRe,D_)=>{var{NEPS:_X}=bt(),U_=r=>Math.abs(r)<_X?0:r,PX=r=>U_(Math.sin(r)),SX=r=>U_(Math.cos(r));D_.exports={sin:PX,cos:SX}});var _0=G((pRe,G_)=>{var IX=r=>(r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r);G_.exports=IX});var P0=G((mRe,F_)=>{var{EPS:BX}=bt(),{sin:AX,cos:TX}=Mr(),CX=_0(),MX=(r,e,t)=>{let[n,i,s]=t,o=n*n+i*i+s*s;if(Math.abs(o)<BX)return CX(r);let a=1/Math.sqrt(o);n*=a,i*=a,s*=a;let l=AX(e),u=TX(e),c=1-u;return r[0]=n*n*c+u,r[1]=i*n*c+s*l,r[2]=s*n*c-i*l,r[3]=0,r[4]=n*i*c-s*l,r[5]=i*i*c+u,r[6]=s*i*c+n*l,r[7]=0,r[8]=n*s*c+i*l,r[9]=i*s*c-n*l,r[10]=s*s*c+u,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r};F_.exports=MX});var z_=G((gRe,q_)=>{var NX=(r,e)=>(r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r);q_.exports=NX});var X_=G((xRe,Y_)=>{var{sin:S0,cos:I0}=Mr(),RX=(r,e,t,n)=>{let i=S0(e),s=I0(e),o=S0(t),a=I0(t),l=S0(n),u=I0(n);return r[0]=a*s,r[1]=a*i,r[2]=-o,r[3]=0,r[4]=l*o*s-u*i,r[5]=u*s+l*o*i,r[6]=l*a,r[7]=0,r[8]=l*i+u*o*s,r[9]=u*o*i-l*s,r[10]=u*a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r};Y_.exports=RX});var W_=G((bRe,V_)=>{var LX=(r,e)=>(r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r);V_.exports=LX});var j_=G((yRe,$_)=>{var OX=If(),kX=(r,e,t,n,i,s,o,a,l,u,c,h,f,d,m,p)=>{let g=OX();return g[0]=r,g[1]=e,g[2]=t,g[3]=n,g[4]=i,g[5]=s,g[6]=o,g[7]=a,g[8]=l,g[9]=u,g[10]=c,g[11]=h,g[12]=f,g[13]=d,g[14]=m,g[15]=p,g};$_.exports=kX});var B0=G((vRe,H_)=>{var UX=(r,e)=>(r[0]=Math.abs(e[0]),r[1]=Math.abs(e[1]),r[2]=Math.abs(e[2]),r);H_.exports=UX});var A0=G((wRe,Z_)=>{var DX=(r,e,t)=>(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r);Z_.exports=DX});var Xu=G((ERe,K_)=>{var GX=(r,e)=>r[0]*e[0]+r[1]*e[1]+r[2]*e[2];K_.exports=GX});var J_=G((_Re,Q_)=>{var FX=Xu(),qX=(r,e)=>{let t=r[0],n=r[1],i=r[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(t*t+n*n+i*i),u=Math.sqrt(s*s+o*o+a*a),c=l*u,h=c&&FX(r,e)/c;return Math.acos(Math.min(Math.max(h,-1),1))};Q_.exports=qX});var Vu=G((PRe,eP)=>{var zX=()=>[0,0,0];eP.exports=zX});var rP=G((SRe,tP)=>{var YX=Vu(),XX=r=>{let e=YX();return e[0]=r[0],e[1]=r[1],e[2]=r[2],e};tP.exports=XX});var T0=G((IRe,nP)=>{var VX=(r,e)=>(r[0]=e[0],r[1]=e[1],r[2]=e[2],r);nP.exports=VX});var cl=G((BRe,iP)=>{var WX=(r,e,t)=>{let n=e[0],i=e[1],s=e[2],o=t[0],a=t[1],l=t[2];return r[0]=i*l-s*a,r[1]=s*o-n*l,r[2]=n*a-i*o,r};iP.exports=WX});var C0=G((ARe,sP)=>{var $X=(r,e)=>{let t=e[0]-r[0],n=e[1]-r[1],i=e[2]-r[2];return Math.sqrt(t*t+n*n+i*i)};sP.exports=$X});var aP=G((TRe,oP)=>{var jX=(r,e,t)=>(r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r);oP.exports=jX});var uP=G((CRe,lP)=>{var HX=(r,e)=>r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2];lP.exports=HX});var hP=G((MRe,cP)=>{var ZX=(r,e)=>(r[0]=e,r[1]=e,r[2]=e,r);cP.exports=ZX});var fP=G((NRe,dP)=>{var KX=Vu(),QX=(r,e,t)=>{let n=KX();return n[0]=r,n[1]=e,n[2]=t,n};dP.exports=QX});var mP=G((RRe,pP)=>{var JX=(r,e,t=0)=>(r[0]=e[0],r[1]=e[1],r[2]=t,r);pP.exports=JX});var M0=G((LRe,gP)=>{var eV=r=>{let e=r[0],t=r[1],n=r[2];return Math.sqrt(e*e+t*t+n*n)};gP.exports=eV});var bP=G((ORe,xP)=>{var tV=(r,e,t,n)=>(r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r[2]=e[2]+n*(t[2]-e[2]),r);xP.exports=tV});var N0=G((kRe,yP)=>{var rV=(r,e,t)=>(r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r);yP.exports=rV});var R0=G((URe,vP)=>{var nV=(r,e,t)=>(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r);vP.exports=nV});var EP=G((DRe,wP)=>{var iV=(r,e,t)=>(r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r);wP.exports=iV});var PP=G((GRe,_P)=>{var sV=(r,e)=>(r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r);_P.exports=sV});var Bf=G((FRe,SP)=>{var oV=(r,e)=>{let t=e[0],n=e[1],i=e[2],s=t*t+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=t*s,r[1]=n*s,r[2]=i*s,r};SP.exports=oV});var BP=G((qRe,IP)=>{var aV=B0(),lV=Vu(),uV=cl(),cV=(r,e)=>{let t=aV(lV(),e),n=0+(t[0]<t[1]&&t[0]<t[2]),i=0+(t[1]<=t[0]&&t[1]<t[2]),s=0+(t[2]<=t[0]&&t[2]<=t[1]);return uV(r,e,[n,i,s])};IP.exports=cV});var TP=G((zRe,AP)=>{var hV=(r,e,t,n)=>{let i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r};AP.exports=hV});var MP=G((YRe,CP)=>{var dV=(r,e,t,n)=>{let i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r};CP.exports=dV});var RP=G((XRe,NP)=>{var fV=(r,e,t,n)=>{let i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=e[2],r};NP.exports=fV});var L0=G((VRe,LP)=>{var pV=(r,e,t)=>(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r);LP.exports=pV});var kP=G((WRe,OP)=>{var mV=(r,e,t)=>(r[0]=Math.round(e[0]/t)*t+0,r[1]=Math.round(e[1]/t)*t+0,r[2]=Math.round(e[2]/t)*t+0,r);OP.exports=mV});var O0=G(($Re,UP)=>{var gV=(r,e)=>{let t=e[0]-r[0],n=e[1]-r[1],i=e[2]-r[2];return t*t+n*n+i*i};UP.exports=gV});var k0=G((jRe,DP)=>{var xV=r=>{let e=r[0],t=r[1],n=r[2];return e*e+t*t+n*n};DP.exports=xV});var Wu=G((HRe,GP)=>{var bV=(r,e,t)=>(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r);GP.exports=bV});var qP=G((ZRe,FP)=>{var yV=r=>`[${r[0].toFixed(7)}, ${r[1].toFixed(7)}, ${r[2].toFixed(7)}]`;FP.exports=yV});var YP=G((KRe,zP)=>{var vV=(r,e,t)=>{let n=e[0],i=e[1],s=e[2],o=t[3]*n+t[7]*i+t[11]*s+t[15];return o=o||1,r[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/o,r[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/o,r[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/o,r};zP.exports=vV});var Ye=G((QRe,XP)=>{XP.exports={abs:B0(),add:A0(),angle:J_(),clone:rP(),copy:T0(),create:Vu(),cross:cl(),distance:C0(),divide:aP(),dot:Xu(),equals:uP(),fromScalar:hP(),fromValues:fP(),fromVec2:mP(),length:M0(),lerp:bP(),max:N0(),min:R0(),multiply:EP(),negate:PP(),normalize:Bf(),orthogonal:BP(),rotateX:TP(),rotateY:MP(),rotateZ:RP(),scale:L0(),snap:kP(),squaredDistance:O0(),squaredLength:k0(),subtract:Wu(),toString:qP(),transform:YP()}});var WP=G((JRe,VP)=>{var eo=Ye(),wV=P0(),EV=(r,e,t)=>{let n=eo.normalize(eo.create(),e),i=eo.normalize(eo.create(),t),s=eo.cross(eo.create(),i,n),o=eo.dot(i,n);if(o===-1)return wV(r,Math.PI,eo.orthogonal(s,n));let a=1/(1+o);return r[0]=s[0]*s[0]*a+o,r[1]=s[1]*s[0]*a-s[2],r[2]=s[2]*s[0]*a+s[1],r[3]=0,r[4]=s[0]*s[1]*a+s[2],r[5]=s[1]*s[1]*a+o,r[6]=s[2]*s[1]*a-s[0],r[7]=0,r[8]=s[0]*s[2]*a-s[1],r[9]=s[1]*s[2]*a+s[0],r[10]=s[2]*s[2]*a+o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r};VP.exports=EV});var jP=G((eLe,$P)=>{var{sin:_V,cos:PV}=Mr(),SV=(r,e)=>{let t=_V(e),n=PV(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=t,r[7]=0,r[8]=0,r[9]=-t,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r};$P.exports=SV});var ZP=G((tLe,HP)=>{var{sin:IV,cos:BV}=Mr(),AV=(r,e)=>{let t=IV(e),n=BV(e);return r[0]=n,r[1]=0,r[2]=-t,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=t,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r};HP.exports=AV});var QP=G((rLe,KP)=>{var{sin:TV,cos:CV}=Mr(),MV=(r,e)=>{let t=TV(e),n=CV(e);return r[0]=n,r[1]=t,r[2]=0,r[3]=0,r[4]=-t,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r};KP.exports=MV});var eS=G((nLe,JP)=>{var NV=r=>r[0]===1&&r[1]===0&&r[2]===0&&r[3]===0&&r[4]===0&&r[5]===1&&r[6]===0&&r[7]===0&&r[8]===0&&r[9]===0&&r[10]===1&&r[11]===0&&r[12]===0&&r[13]===0&&r[14]===0&&r[15]===1;JP.exports=NV});var rS=G((iLe,tS)=>{var RV=r=>ms(r[1])&&ms(r[2])&&ms(r[3])&&ms(r[4])&&ms(r[6])&&ms(r[7])&&ms(r[8])&&ms(r[9])&&ms(r[11])&&r[15]===1,ms=r=>Math.abs(r)<Number.EPSILON;tS.exports=RV});var iS=G((sLe,nS)=>{var LV=r=>{let e=r[4]*r[9]-r[8]*r[5],t=r[8]*r[1]-r[0]*r[9],n=r[0]*r[5]-r[4]*r[1];return e*r[2]+t*r[6]+n*r[10]<0};nS.exports=LV});var oS=G((oLe,sS)=>{var OV=(r,e)=>{let[t,n,i,s]=e;return r[0]=1-2*t*t,r[1]=-2*n*t,r[2]=-2*i*t,r[3]=0,r[4]=-2*t*n,r[5]=1-2*n*n,r[6]=-2*i*n,r[7]=0,r[8]=-2*t*i,r[9]=-2*n*i,r[10]=1-2*i*i,r[11]=0,r[12]=2*t*s,r[13]=2*n*s,r[14]=2*i*s,r[15]=1,r};sS.exports=OV});var lS=G((aLe,aS)=>{var kV=(r,e,t)=>{let n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],f=e[9],d=e[10],m=e[11],p=e[12],g=e[13],b=e[14],v=e[15],w=t[0],P=t[1],_=t[2],B=t[3];return r[0]=w*n+P*a+_*h+B*p,r[1]=w*i+P*l+_*f+B*g,r[2]=w*s+P*u+_*d+B*b,r[3]=w*o+P*c+_*m+B*v,w=t[4],P=t[5],_=t[6],B=t[7],r[4]=w*n+P*a+_*h+B*p,r[5]=w*i+P*l+_*f+B*g,r[6]=w*s+P*u+_*d+B*b,r[7]=w*o+P*c+_*m+B*v,w=t[8],P=t[9],_=t[10],B=t[11],r[8]=w*n+P*a+_*h+B*p,r[9]=w*i+P*l+_*f+B*g,r[10]=w*s+P*u+_*d+B*b,r[11]=w*o+P*c+_*m+B*v,w=t[12],P=t[13],_=t[14],B=t[15],r[12]=w*n+P*a+_*h+B*p,r[13]=w*i+P*l+_*f+B*g,r[14]=w*s+P*u+_*d+B*b,r[15]=w*o+P*c+_*m+B*v,r};aS.exports=kV});var cS=G((lLe,uS)=>{var{EPS:UV}=bt(),{sin:DV,cos:GV}=Mr(),FV=E0(),qV=(r,e,t,n)=>{let[i,s,o]=n,a=i*i+s*s+o*o;if(Math.abs(a)<UV)return FV(r,e);let l=1/Math.sqrt(a);i*=l,s*=l,o*=l;let u=DV(t),c=GV(t),h=1-c,f=e[0],d=e[1],m=e[2],p=e[3],g=e[4],b=e[5],v=e[6],w=e[7],P=e[8],_=e[9],B=e[10],I=e[11],C=i*i*h+c,N=s*i*h+o*u,A=o*i*h-s*u,M=i*s*h-o*u,S=s*s*h+c,$=o*s*h+i*u,H=i*o*h+s*u,K=s*o*h-i*u,F=o*o*h+c;return r[0]=f*C+g*N+P*A,r[1]=d*C+b*N+_*A,r[2]=m*C+v*N+B*A,r[3]=p*C+w*N+I*A,r[4]=f*M+g*S+P*$,r[5]=d*M+b*S+_*$,r[6]=m*M+v*S+B*$,r[7]=p*M+w*S+I*$,r[8]=f*H+g*K+P*F,r[9]=d*H+b*K+_*F,r[10]=m*H+v*K+B*F,r[11]=p*H+w*K+I*F,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r};uS.exports=qV});var dS=G((uLe,hS)=>{var{sin:zV,cos:YV}=Mr(),XV=(r,e,t)=>{let n=zV(t),i=YV(t),s=e[4],o=e[5],a=e[6],l=e[7],u=e[8],c=e[9],h=e[10],f=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*i+u*n,r[5]=o*i+c*n,r[6]=a*i+h*n,r[7]=l*i+f*n,r[8]=u*i-s*n,r[9]=c*i-o*n,r[10]=h*i-a*n,r[11]=f*i-l*n,r};hS.exports=XV});var pS=G((cLe,fS)=>{var{sin:VV,cos:WV}=Mr(),$V=(r,e,t)=>{let n=VV(t),i=WV(t),s=e[0],o=e[1],a=e[2],l=e[3],u=e[8],c=e[9],h=e[10],f=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i-u*n,r[1]=o*i-c*n,r[2]=a*i-h*n,r[3]=l*i-f*n,r[8]=s*n+u*i,r[9]=o*n+c*i,r[10]=a*n+h*i,r[11]=l*n+f*i,r};fS.exports=$V});var gS=G((hLe,mS)=>{var{sin:jV,cos:HV}=Mr(),ZV=(r,e,t)=>{let n=jV(t),i=HV(t),s=e[0],o=e[1],a=e[2],l=e[3],u=e[4],c=e[5],h=e[6],f=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i+u*n,r[1]=o*i+c*n,r[2]=a*i+h*n,r[3]=l*i+f*n,r[4]=u*i-s*n,r[5]=c*i-o*n,r[6]=h*i-a*n,r[7]=f*i-l*n,r};mS.exports=ZV});var bS=G((dLe,xS)=>{var KV=(r,e,t)=>{let n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r};xS.exports=KV});var vS=G((fLe,yS)=>{var QV=(r,e,t)=>(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r[9]=e[9]-t[9],r[10]=e[10]-t[10],r[11]=e[11]-t[11],r[12]=e[12]-t[12],r[13]=e[13]-t[13],r[14]=e[14]-t[14],r[15]=e[15]-t[15],r);yS.exports=QV});var ES=G((pLe,wS)=>{var JV=r=>r.map(e=>e.toFixed(7)).toString();wS.exports=JV});var PS=G((mLe,_S)=>{var e9=(r,e,t)=>{let n=t[0],i=t[1],s=t[2],o,a,l,u,c,h,f,d,m,p,g,b;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*s+e[12],r[13]=e[1]*n+e[5]*i+e[9]*s+e[13],r[14]=e[2]*n+e[6]*i+e[10]*s+e[14],r[15]=e[3]*n+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],u=e[3],c=e[4],h=e[5],f=e[6],d=e[7],m=e[8],p=e[9],g=e[10],b=e[11],r[0]=o,r[1]=a,r[2]=l,r[3]=u,r[4]=c,r[5]=h,r[6]=f,r[7]=d,r[8]=m,r[9]=p,r[10]=g,r[11]=b,r[12]=o*n+c*i+m*s+e[12],r[13]=a*n+h*i+p*s+e[13],r[14]=l*n+f*i+g*s+e[14],r[15]=u*n+d*i+b*s+e[15]),r};_S.exports=e9});var Gt=G((gLe,SS)=>{SS.exports={add:B_(),clone:C_(),copy:E0(),create:If(),invert:R_(),equals:O_(),fromRotation:P0(),fromScaling:z_(),fromTaitBryanRotation:X_(),fromTranslation:W_(),fromValues:j_(),fromVectorRotation:WP(),fromXRotation:jP(),fromYRotation:ZP(),fromZRotation:QP(),identity:_0(),isIdentity:eS(),isOnlyTransformScale:rS(),isMirroring:iS(),mirrorByPlane:oS(),multiply:lS(),rotate:cS(),rotateX:dS(),rotateY:pS(),rotateZ:gS(),scale:bS(),subtract:vS(),toString:ES(),translate:PS()}});var $u=G((xLe,IS)=>{var t9=Gt(),r9=r=>(r===void 0&&(r=[]),{sides:r,transforms:t9.create()});IS.exports=r9});var AS=G((bLe,BS)=>{var n9=(r,e)=>(r[0]=Math.abs(e[0]),r[1]=Math.abs(e[1]),r);BS.exports=n9});var CS=G((yLe,TS)=>{var i9=(r,e,t)=>(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r);TS.exports=i9});var Af=G((vLe,MS)=>{var s9=r=>Math.atan2(r[1],r[0]);MS.exports=s9});var RS=G((wLe,NS)=>{NS.exports=Af()});var OS=G((ELe,LS)=>{var o9=Af(),a9=r=>o9(r)*57.29577951308232;LS.exports=a9});var ju=G((_Le,kS)=>{var l9=()=>[0,0];kS.exports=l9});var DS=G((PLe,US)=>{var u9=ju(),c9=r=>{let e=u9();return e[0]=r[0],e[1]=r[1],e};US.exports=c9});var FS=G((SLe,GS)=>{var h9=(r,e)=>(r[0]=e[0],r[1]=e[1],r);GS.exports=h9});var zS=G((ILe,qS)=>{var d9=(r,e,t)=>(r[0]=0,r[1]=0,r[2]=e[0]*t[1]-e[1]*t[0],r);qS.exports=d9});var XS=G((BLe,YS)=>{var f9=(r,e)=>{let t=e[0]-r[0],n=e[1]-r[1];return Math.sqrt(t*t+n*n)};YS.exports=f9});var WS=G((ALe,VS)=>{var p9=(r,e,t)=>(r[0]=e[0]/t[0],r[1]=e[1]/t[1],r);VS.exports=p9});var jS=G((TLe,$S)=>{var m9=(r,e)=>r[0]*e[0]+r[1]*e[1];$S.exports=m9});var ZS=G((CLe,HS)=>{var g9=(r,e)=>r[0]===e[0]&&r[1]===e[1];HS.exports=g9});var U0=G((MLe,KS)=>{var{sin:x9,cos:b9}=Mr(),y9=(r,e)=>(r[0]=b9(e),r[1]=x9(e),r);KS.exports=y9});var JS=G((NLe,QS)=>{var v9=U0(),w9=(r,e)=>v9(r,e*.017453292519943295);QS.exports=w9});var t3=G((RLe,e3)=>{var E9=(r,e)=>(r[0]=e,r[1]=e,r);e3.exports=E9});var n3=G((LLe,r3)=>{var _9=ju(),P9=(r,e)=>{let t=_9();return t[0]=r,t[1]=e,t};r3.exports=P9});var s3=G((OLe,i3)=>{var S9=r=>Math.sqrt(r[0]*r[0]+r[1]*r[1]);i3.exports=S9});var a3=G((kLe,o3)=>{var I9=(r,e,t,n)=>{let i=e[0],s=e[1];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r};o3.exports=I9});var u3=G((ULe,l3)=>{var B9=(r,e,t)=>(r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r);l3.exports=B9});var h3=G((DLe,c3)=>{var A9=(r,e,t)=>(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r);c3.exports=A9});var f3=G((GLe,d3)=>{var T9=(r,e,t)=>(r[0]=e[0]*t[0],r[1]=e[1]*t[1],r);d3.exports=T9});var m3=G((FLe,p3)=>{var C9=(r,e)=>(r[0]=-e[0],r[1]=-e[1],r);p3.exports=C9});var D0=G((qLe,g3)=>{var M9=(r,e,t,n)=>{let i=e[0]-t[0],s=e[1]-t[1],o=Math.cos(n),a=Math.sin(n);return r[0]=i*o-s*a+t[0],r[1]=i*a+s*o+t[1],r};g3.exports=M9});var b3=G((zLe,x3)=>{var{TAU:N9}=bt(),R9=ju(),L9=D0(),O9=(r,e)=>L9(r,e,R9(),N9/4);x3.exports=O9});var v3=G((YLe,y3)=>{var k9=(r,e)=>{let t=e[0],n=e[1],i=t*t+n*n;return i>0&&(i=1/Math.sqrt(i)),r[0]=t*i,r[1]=n*i,r};y3.exports=k9});var E3=G((XLe,w3)=>{var U9=(r,e,t)=>(r[0]=e[0]*t,r[1]=e[1]*t,r);w3.exports=U9});var P3=G((VLe,_3)=>{var D9=(r,e,t)=>(r[0]=Math.round(e[0]/t)*t+0,r[1]=Math.round(e[1]/t)*t+0,r);_3.exports=D9});var I3=G((WLe,S3)=>{var G9=(r,e)=>{let t=e[0]-r[0],n=e[1]-r[1];return t*t+n*n};S3.exports=G9});var A3=G(($Le,B3)=>{var F9=r=>{let e=r[0],t=r[1];return e*e+t*t};B3.exports=F9});var C3=G((jLe,T3)=>{var q9=(r,e,t)=>(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r);T3.exports=q9});var N3=G((HLe,M3)=>{var z9=r=>`[${r[0].toFixed(7)}, ${r[1].toFixed(7)}]`;M3.exports=z9});var L3=G((ZLe,R3)=>{var Y9=(r,e,t)=>{let n=e[0],i=e[1];return r[0]=t[0]*n+t[4]*i+t[12],r[1]=t[1]*n+t[5]*i+t[13],r};R3.exports=Y9});var st=G((KLe,O3)=>{O3.exports={abs:AS(),add:CS(),angle:RS(),angleDegrees:OS(),angleRadians:Af(),clone:DS(),copy:FS(),create:ju(),cross:zS(),distance:XS(),divide:WS(),dot:jS(),equals:ZS(),fromAngleDegrees:JS(),fromAngleRadians:U0(),fromScalar:t3(),fromValues:n3(),length:s3(),lerp:a3(),max:u3(),min:h3(),multiply:f3(),negate:m3(),normal:b3(),normalize:v3(),rotate:D0(),scale:E3(),snap:P3(),squaredDistance:I3(),squaredLength:A3(),subtract:C3(),toString:N3(),transform:L3()}});var U3=G((QLe,k3)=>{var G0=st(),X9=$u(),V9=r=>{if(!Array.isArray(r))throw new Error("the given points must be an array");let e=r.length;if(e<3)throw new Error("the given points must define a closed geometry with three or more points");G0.equals(r[0],r[e-1])&&--e;let t=[],n=r[e-1];for(let i=0;i<e;i++){let s=r[i];t.push([G0.clone(n),G0.clone(s)]),n=s}return X9(t)};k3.exports=V9});var F3=G((JLe,G3)=>{var W9=Gt(),D3=st(),$9=$u(),j9=r=>{if(r[0]!==0)throw new Error("invalid compact binary data");let e=$9();e.transforms=W9.clone(r.slice(1,17));for(let t=21;t<r.length;t+=4){let n=D3.fromValues(r[t+0],r[t+1]),i=D3.fromValues(r[t+2],r[t+3]);e.sides.push([n,i])}return r[17]>=0&&(e.color=[r[17],r[18],r[19],r[20]]),e};G3.exports=j9});var F0=G((eOe,q3)=>{var H9=r=>!!(r&&typeof r=="object"&&"sides"in r&&"transforms"in r&&Array.isArray(r.sides)&&"length"in r.transforms);q3.exports=H9});var X3=G((tOe,Y3)=>{var z3=Gt(),Tf=st(),Z9=r=>(z3.isIdentity(r.transforms)||(r.sides=r.sides.map(e=>{let t=Tf.transform(Tf.create(),e[0],r.transforms),n=Tf.transform(Tf.create(),e[1],r.transforms);return[t,n]}),r.transforms=z3.create()),r);Y3.exports=Z9});var hl=G((rOe,V3)=>{var K9=X3(),Q9=r=>K9(r).sides;V3.exports=Q9});var $3=G((nOe,W3)=>{var J9=$u(),e7=hl(),t7=r=>{let t=e7(r).map(n=>[n[1],n[0]]);return t.reverse(),J9(t)};W3.exports=t7});var q0=G((iOe,j3)=>{var Hu=st(),r7=hl(),n7=r=>{let e=new Map,t=n=>{let i=n.toString();return e.has(i)?e.get(i):(e.set(i,n),n)};return r.map(n=>n.map(t))},i7=r=>{let e=new Map;return n7(r).forEach(n=>{e.has(n[0])?e.get(n[0]).push(n):e.set(n[0],[n])}),e},s7=r=>{let e=i7(r7(r)),t=[];for(;;){let n;for(let[o,a]of e){if(n=a.shift(),!n){e.delete(o);continue}break}if(n===void 0)break;let i=[],s=n[0];for(;;){i.push(n[0]);let o=n[1];if(o===s)break;let a=e.get(o);if(!a)throw new Error(`geometry is not closed at vertex ${o}`);let l=o7(n,a);a.length===0&&e.delete(o),n=l}i.length>0&&i.push(i.shift()),t.push(i)}return e.clear(),t},o7=(r,e)=>{if(e.length===1)return e.pop();let t=Hu.create(),n=Hu.angleDegrees(Hu.subtract(t,r[1],r[0])),i,s;e.forEach((a,l)=>{let c=Hu.angleDegrees(Hu.subtract(t,a[1],a[0]))-n;c<-180&&(c+=360),c>=180&&(c-=360),(s===void 0||c>i)&&(s=l,i=c)});let o=e[s];return e.splice(s,1),o};j3.exports=s7});var Z3=G((sOe,H3)=>{var a7=hl(),l7=r=>{let t=a7(r).map(n=>n[0]);return t.length>0&&t.push(t.shift()),t};H3.exports=l7});var J3=G((oOe,Q3)=>{var K3=st(),u7=hl(),c7=r=>{let e=u7(r),t="geom2 ("+e.length+` sides):
[
`;return e.forEach(n=>{t+="  ["+K3.toString(n[0])+", "+K3.toString(n[1])+`]
`}),t+=`]
`,t};Q3.exports=c7});var tI=G((aOe,eI)=>{var h7=r=>{let e=r.sides,t=r.transforms,n=[-1,-1,-1,-1];r.color&&(n=r.color);let i=new Float32Array(1+16+4+e.length*4);i[0]=0,i[1]=t[0],i[2]=t[1],i[3]=t[2],i[4]=t[3],i[5]=t[4],i[6]=t[5],i[7]=t[6],i[8]=t[7],i[9]=t[8],i[10]=t[9],i[11]=t[10],i[12]=t[11],i[13]=t[12],i[14]=t[13],i[15]=t[14],i[16]=t[15],i[17]=n[0],i[18]=n[1],i[19]=n[2],i[20]=n[3];for(let s=0;s<e.length;s++){let o=s*4+21,a=e[s][0],l=e[s][1];i[o+0]=a[0],i[o+1]=a[1],i[o+2]=l[0],i[o+3]=l[1]}return i};eI.exports=h7});var iI=G((lOe,nI)=>{var rI=Gt(),d7=(r,e)=>{let t=rI.multiply(rI.create(),r,e.transforms);return Object.assign({},e,{transforms:t})};nI.exports=d7});var oI=G((uOe,sI)=>{var f7=st(),p7=F0(),m7=q0(),g7=r=>{if(!p7(r))throw new Error("invalid geom2 structure");if(m7(r),r.sides.forEach(e=>{if(f7.equals(e[0],e[1]))throw new Error(`geom2 self-edge ${e[0]}`)}),!r.transforms.every(Number.isFinite))throw new Error(`geom2 invalid transforms ${r.transforms}`)};sI.exports=g7});var rt=G((cOe,aI)=>{aI.exports={clone:S_(),create:$u(),fromPoints:U3(),fromCompactBinary:F3(),isA:F0(),reverse:$3(),toOutlines:q0(),toPoints:Z3(),toSides:hl(),toString:J3(),toCompactBinary:tI(),transform:iI(),validate:oI()}});var uI=G((hOe,lI)=>{var x7=r=>Object.assign({},r);lI.exports=x7});var Zu=G((dOe,cI)=>{var b7=Gt(),y7=r=>(r===void 0&&(r=[]),{polygons:r,transforms:b7.create()});cI.exports=y7});var Vo=G((fOe,hI)=>{var v7=r=>((r===void 0||r.length<3)&&(r=[]),{vertices:r});hI.exports=v7});var fI=G((pOe,dI)=>{var w7=Vo(),E7=Ye(),_7=(...r)=>{let e,t;return r.length===1?(e=w7(),t=r[0]):(e=r[0],t=r[1]),e.vertices=t.vertices.map(n=>E7.clone(n)),e};dI.exports=_7});var mI=G((mOe,pI)=>{var P7=Ye(),S7=Vo(),I7=r=>{let e=r.map(t=>P7.clone(t));return S7(e)};pI.exports=I7});var xI=G((gOe,gI)=>{var B7=Vo(),A7=(r,e)=>{let t=B7(r);return t.plane=e,t};gI.exports=A7});var Ku=G((xOe,bI)=>{var T7=()=>[0,0,0,0];bI.exports=T7});var z0=G((bOe,yI)=>{var C7=Ku(),M7=r=>{let e=C7();return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e};yI.exports=M7});var Y0=G((yOe,vI)=>{var N7=(r,e)=>(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r);vI.exports=N7});var X0=G((vOe,wI)=>{var R7=(r,e)=>r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3];wI.exports=R7});var V0=G((wOe,EI)=>{var L7=(r,e)=>(r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r);EI.exports=L7});var PI=G((EOe,_I)=>{var W0=Ye(),O7=(r,e,t)=>{let n=W0.normalize(W0.create(),e),i=W0.dot(t,n);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=i,r};_I.exports=O7});var $0=G((_Oe,SI)=>{var k7=Ku(),U7=(r,e,t,n)=>{let i=k7();return i[0]=r,i[1]=e,i[2]=t,i[3]=n,i};SI.exports=U7});var j0=G((POe,II)=>{var ki=Ye(),D7=(r,...e)=>{let t=e.length,n=ki.create(),i=ki.create(),s=o=>{let a=e[o],l=e[(o+1)%t],u=e[(o+2)%t];return ki.subtract(n,l,a),ki.subtract(i,u,a),ki.cross(n,n,i),ki.normalize(n,n),n};return r[0]=0,r[1]=0,r[2]=0,t===3?ki.copy(r,s(0)):(e.forEach((o,a)=>{ki.add(r,r,s(a))}),ki.normalize(r,r)),r[3]=ki.dot(r,e[0]),r};II.exports=D7});var AI=G((SOe,BI)=>{var{EPS:H0}=bt(),jr=Ye(),G7=(r,e,t,n)=>{let i=jr.subtract(jr.create(),t,e),s=jr.subtract(jr.create(),n,e);jr.length(i)<H0&&(i=jr.orthogonal(i,s)),jr.length(s)<H0&&(s=jr.orthogonal(s,i));let o=jr.cross(jr.create(),i,s);jr.length(o)<H0&&(s=jr.orthogonal(s,i),o=jr.cross(o,i,s)),o=jr.normalize(o,o);let a=jr.dot(o,e);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=a,r};BI.exports=G7});var CI=G((IOe,TI)=>{var F7=Ye(),q7=(r,e)=>{let t=e[0]*r[0]+e[1]*r[1]+e[2]*r[2]-r[3],n=e[0]-t*r[0],i=e[1]-t*r[1],s=e[2]-t*r[2];return F7.fromValues(n,i,s)};TI.exports=q7});var Z0=G((BOe,MI)=>{var z7=Ye(),Y7=(r,e)=>z7.dot(r,e)-r[3];MI.exports=Y7});var K0=G((AOe,NI)=>{var X7=r=>`(${r[0].toFixed(9)}, ${r[1].toFixed(9)}, ${r[2].toFixed(9)}, ${r[3].toFixed(9)})`;NI.exports=X7});var LI=G((TOe,RI)=>{var V7=Gt(),Hr=Ye(),W7=j0(),$7=V0(),j7=(r,e,t)=>{let n=V7.isMirroring(t),i=Hr.orthogonal(Hr.create(),e),s=Hr.cross(i,e,i),o=Hr.cross(Hr.create(),e,s),a=Hr.fromScalar(Hr.create(),e[3]);Hr.multiply(a,a,e);let l=Hr.add(Hr.create(),a,s),u=Hr.add(Hr.create(),a,o);return a=Hr.transform(a,a,t),l=Hr.transform(l,l,t),u=Hr.transform(u,u,t),W7(r,a,l,u),n&&$7(r,r),r};RI.exports=j7});var pi=G((COe,OI)=>{OI.exports={clone:z0(),copy:Y0(),create:Ku(),equals:X0(),flip:V0(),fromNormalAndPoint:PI(),fromValues:$0(),fromPoints:j0(),fromPointsRandom:AI(),projectionOfPoint:CI(),signedDistanceToPoint:Z0(),toString:K0(),transform:LI()}});var DI=G((MOe,UI)=>{var kI=pi(),H7=Vo(),Z7=r=>{let e=r.vertices.slice().reverse(),t=H7(e);return r.plane&&(t.plane=kI.flip(kI.create(),r.plane)),t};UI.exports=Z7});var Q0=G((NOe,GI)=>{var K7=r=>!!(r&&typeof r=="object"&&"vertices"in r&&Array.isArray(r.vertices));GI.exports=K7});var J0=G((ROe,qI)=>{var FI=pi(),Wo=Ye(),Q7=r=>J7(r.vertices),J7=r=>{let e=r.length;if(e>2){let t=FI.fromPoints(FI.create(),...r),n=r[e-2],i=r[e-1];for(let s=0;s<e;s++){let o=r[s];if(!eW(n,i,o,t))return!1;n=i,i=o}}return!0},eW=(r,e,t,n)=>{let i=Wo.cross(Wo.create(),Wo.subtract(Wo.create(),e,r),Wo.subtract(Wo.create(),t,e));return Wo.dot(i,n)>=0};qI.exports=Q7});var Cf=G((LOe,YI)=>{var zI=pi(),tW=r=>(r.plane||(r.plane=zI.fromPoints(zI.create(),...r.vertices)),r.plane);YI.exports=tW});var ex=G((OOe,XI)=>{var rW=Cf(),nW=r=>{let e=r.vertices.length;if(e<3)return 0;let t=r.vertices,n=rW(r),i=Math.abs(n[0]),s=Math.abs(n[1]),o=Math.abs(n[2]);if(i+s+o===0)return 0;let a=3;i>s&&i>o?a=1:s>o&&(a=2);let l=0,u=0,c=1,h=2;switch(a){case 1:for(c=1;c<e;c++)u=c-1,h=(c+1)%e,l+=t[c][1]*(t[h][2]-t[u][2]);l+=t[0][1]*(t[1][2]-t[e-1][2]),l/=2*n[0];break;case 2:for(c=1;c<e;c++)u=c-1,h=(c+1)%e,l+=t[c][2]*(t[h][0]-t[u][0]);l+=t[0][2]*(t[1][0]-t[e-1][0]),l/=2*n[1];break;case 3:default:for(c=1;c<e;c++)u=c-1,h=(c+1)%e,l+=t[c][0]*(t[h][1]-t[u][1]);l+=t[0][0]*(t[1][1]-t[e-1][1]),l/=2*n[2];break}return l};XI.exports=nW});var WI=G((kOe,VI)=>{var Qu=Ye(),iW=r=>{let e=r.vertices,t=e.length,n=t===0?Qu.create():Qu.clone(e[0]),i=Qu.clone(n);for(let s=1;s<t;s++)Qu.min(n,n,e[s]),Qu.max(i,i,e[s]);return[n,i]};VI.exports=iW});var jI=G((UOe,$I)=>{var sW=(r,e)=>r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3];$I.exports=sW});var ZI=G((DOe,HI)=>{var oW=(r,e)=>(r[0]=e,r[1]=e,r[2]=e,r[3]=e,r);HI.exports=oW});var QI=G((GOe,KI)=>{var aW=(r,e,t)=>{let[n,i,s,o]=e;return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*o,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*o,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*o,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*o,r};KI.exports=aW});var tx=G((FOe,JI)=>{JI.exports={clone:z0(),copy:Y0(),create:Ku(),dot:jI(),equals:X0(),fromScalar:ZI(),fromValues:$0(),toString:K0(),transform:QI()}});var rB=G((zOe,tB)=>{var qOe=Ye(),lW=tx(),eB=new WeakMap,uW=r=>{let e=eB.get(r);if(e)return e;let t=r.vertices,n=lW.create();if(t.length===0)return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n;let i=t[0],s=i,o=i,a=i,l=i,u=i;t.forEach(d=>{i[0]>d[0]&&(i=d),s[1]>d[1]&&(s=d),o[2]>d[2]&&(o=d),a[0]<d[0]&&(a=d),l[1]<d[1]&&(l=d),u[2]<d[2]&&(u=d)}),n[0]=(i[0]+a[0])*.5,n[1]=(s[1]+l[1])*.5,n[2]=(o[2]+u[2])*.5;let c=n[0]-a[0],h=n[1]-l[1],f=n[2]-u[2];return n[3]=Math.sqrt(c*c+h*h+f*f),eB.set(r,n),n};tB.exports=uW});var iB=G((YOe,nB)=>{var rx=Ye(),cW=r=>{let e=0,t=r.vertices,n=rx.create();for(let i=0;i<t.length-2;i++)rx.cross(n,t[i+1],t[i+2]),e+=rx.dot(t[0],n);return e/=6,e};nB.exports=cW});var oB=G((XOe,sB)=>{var hW=r=>r.vertices;sB.exports=hW});var lB=G((VOe,aB)=>{var dW=Ye(),fW=r=>{let e="poly3: vertices: [";return r.vertices.forEach(t=>{e+=`${dW.toString(t)}, `}),e+="]",e};aB.exports=fW});var hB=G((WOe,cB)=>{var pW=Gt(),uB=Ye(),mW=Vo(),gW=(r,e)=>{let t=e.vertices.map(n=>uB.transform(uB.create(),n,r));return pW.isMirroring(r)&&t.reverse(),mW(t)};cB.exports=gW});var fB=G(($Oe,dB)=>{var xW=Z0(),{NEPS:bW}=bt(),yW=Ye(),vW=Q0(),wW=J0(),EW=ex(),_W=Cf(),PW=r=>{if(!vW(r))throw new Error("invalid poly3 structure");if(r.vertices.length<3)throw new Error(`poly3 not enough vertices ${r.vertices.length}`);if(EW(r)<=0)throw new Error("poly3 area must be greater than zero");for(let e=0;e<r.vertices.length;e++)if(yW.equals(r.vertices[e],r.vertices[(e+1)%r.vertices.length]))throw new Error(`poly3 duplicate vertex ${r.vertices[e]}`);if(!wW(r))throw new Error("poly3 must be convex");if(r.vertices.forEach(e=>{if(!e.every(Number.isFinite))throw new Error(`poly3 invalid vertex ${e}`)}),r.vertices.length>3){let e=_W(r);r.vertices.forEach(t=>{let n=Math.abs(xW(e,t));if(n>bW)throw new Error(`poly3 must be coplanar: vertex ${t} distance ${n}`)})}};dB.exports=PW});var xt=G((jOe,pB)=>{pB.exports={clone:fI(),create:Vo(),fromPoints:mI(),fromPointsAndPlane:xI(),invert:DI(),isA:Q0(),isConvex:J0(),measureArea:ex(),measureBoundingBox:WI(),measureBoundingSphere:rB(),measureSignedVolume:iB(),plane:Cf(),toPoints:oB(),toString:lB(),transform:hB(),validate:fB()}});var gB=G((HOe,mB)=>{var SW=xt(),IW=Zu(),BW=r=>{if(!Array.isArray(r))throw new Error("the given points must be an array");let e=r.map((n,i)=>SW.create(n));return IW(e)};mB.exports=BW});var bB=G((ZOe,xB)=>{var AW=Ye(),TW=Gt(),CW=xt(),MW=Zu(),NW=r=>{if(r[0]!==1)throw new Error("invalid compact binary data");let e=MW();e.transforms=TW.clone(r.slice(1,17));let t=r[21],n=22,i=r.length-t*3;for(;i<r.length;){let s=r[n];n++;let o=[];for(let a=0;a<s;a++)o.push(AW.fromValues(r[i],r[i+1],r[i+2])),i+=3;e.polygons.push(CW.create(o))}return r[17]>=0&&(e.color=[r[17],r[18],r[19],r[20]]),e};xB.exports=NW});var wB=G((KOe,vB)=>{var yB=Gt(),RW=xt(),LW=r=>(yB.isIdentity(r.transforms)||(r.polygons=r.polygons.map(e=>RW.transform(r.transforms,e)),r.transforms=yB.create()),r);vB.exports=LW});var Ju=G((QOe,EB)=>{var OW=wB(),kW=r=>OW(r).polygons;EB.exports=kW});var PB=G((JOe,_B)=>{var UW=xt(),DW=Zu(),GW=Ju(),FW=r=>{let t=GW(r).map(n=>UW.invert(n));return DW(t)};_B.exports=FW});var nx=G((e4e,SB)=>{var qW=r=>!!(r&&typeof r=="object"&&"polygons"in r&&"transforms"in r&&Array.isArray(r.polygons)&&"length"in r.transforms);SB.exports=qW});var BB=G((t4e,IB)=>{var zW=xt(),YW=Ju(),XW=r=>YW(r).map(n=>zW.toPoints(n));IB.exports=XW});var TB=G((r4e,AB)=>{var VW=xt(),WW=Ju(),$W=r=>{let e=WW(r),t="geom3 ("+e.length+` polygons):
`;return e.forEach(n=>{t+="  "+VW.toString(n)+`
`}),t};AB.exports=$W});var MB=G((n4e,CB)=>{var jW=xt(),HW=r=>{let e=r.polygons,t=r.transforms,n=e.length,i=e.reduce((u,c)=>u+c.vertices.length,0),s=[-1,-1,-1,-1];r.color&&(s=r.color);let o=new Float32Array(1+16+4+1+n+i*3);o[0]=1,o[1]=t[0],o[2]=t[1],o[3]=t[2],o[4]=t[3],o[5]=t[4],o[6]=t[5],o[7]=t[6],o[8]=t[7],o[9]=t[8],o[10]=t[9],o[11]=t[10],o[12]=t[11],o[13]=t[12],o[14]=t[13],o[15]=t[14],o[16]=t[15],o[17]=s[0],o[18]=s[1],o[19]=s[2],o[20]=s[3],o[21]=i;let a=22,l=a+n;return e.forEach(u=>{let c=jW.toPoints(u);o[a]=c.length,a++;for(let h=0;h<c.length;h++){let f=c[h];o[l+0]=f[0],o[l+1]=f[1],o[l+2]=f[2],l+=3}}),o};CB.exports=HW});var LB=G((i4e,RB)=>{var NB=Gt(),ZW=(r,e)=>{let t=NB.multiply(NB.create(),r,e.transforms);return Object.assign({},e,{transforms:t})};RB.exports=ZW});var kB=G((s4e,OB)=>{var KW=xt(),QW=nx(),JW=r=>{if(!QW(r))throw new Error("invalid geom3 structure");if(r.polygons.forEach(KW.validate),e$(r),!r.transforms.every(Number.isFinite))throw new Error(`geom3 invalid transforms ${r.transforms}`)},e$=r=>{let e=new Map;r.polygons.forEach(({vertices:n})=>{n.forEach((i,s)=>{let o=`${i}`,a=`${n[(s+1)%n.length]}`,l=`${o}/${a}`,u=e.has(l)?e.get(l):0;e.set(l,u+1)})});let t=[];if(e.forEach((n,i)=>{let s=i.split("/").reverse().join("/"),o=e.get(s);n!==o&&t.push(i.replace("/"," -> "))}),t.length>0)throw new Error(`non-manifold edges ${t.length}
${t.join(`
`)}`)};OB.exports=JW});var nt=G((o4e,UB)=>{UB.exports={clone:uI(),create:Zu(),fromPoints:gB(),fromCompactBinary:bB(),invert:PB(),isA:nx(),toPoints:BB(),toPolygons:Ju(),toString:TB(),toCompactBinary:MB(),transform:LB(),validate:kB()}});var Mf=G((a4e,DB)=>{var t$=r=>Object.assign({},r);DB.exports=t$});var ix=G((l4e,FB)=>{var{EPS:GB}=bt(),r$=st(),n$=Mf(),i$=r=>{if(r.isClosed)return r;let e=n$(r);if(e.isClosed=!0,e.points.length>1){let t=e.points,n=t[0],i=t[t.length-1];for(;r$.distance(n,i)<GB*GB&&(t.pop(),t.length!==1);)i=t[t.length-1]}return e};FB.exports=i$});var ec=G((u4e,qB)=>{var s$=Gt(),o$=r=>(r===void 0&&(r=[]),{points:r,isClosed:!1,transforms:s$.create()});qB.exports=o$});var Nf=G((c4e,XB)=>{var{EPS:zB}=bt(),YB=st(),a$=ix(),l$=ec(),u$=(r,e)=>{let t={closed:!1},{closed:n}=Object.assign({},t,r),i=l$();if(i.points=e.map(s=>YB.clone(s)),i.points.length>1){let s=i.points[0],o=i.points[i.points.length-1];YB.distance(s,o)<zB*zB&&(n=!0)}return n===!0&&(i=a$(i)),i};XB.exports=u$});var jB=G((h4e,$B)=>{var VB=Gt(),WB=st(),c$=r=>(VB.isIdentity(r.transforms)||(r.points=r.points.map(e=>WB.transform(WB.create(),e,r.transforms)),r.transforms=VB.create()),r);$B.exports=c$});var $o=G((d4e,HB)=>{var h$=jB(),d$=r=>h$(r).points;HB.exports=d$});var KB=G((f4e,ZB)=>{var{TAU:Rf}=bt(),br=st(),f$=Nf(),p$=$o(),m$=(r,e)=>{let t={radius:[0,0],xaxisrotation:0,clockwise:!1,large:!1,segments:16},{endpoint:n,radius:i,xaxisrotation:s,clockwise:o,large:a,segments:l}=Object.assign({},t,r);if(!Array.isArray(n))throw new Error("endpoint must be an array of X and Y values");if(n.length<2)throw new Error("endpoint must contain X and Y values");if(n=br.clone(n),!Array.isArray(i))throw new Error("radius must be an array of X and Y values");if(i.length<2)throw new Error("radius must contain X and Y values");if(l<4)throw new Error("segments must be four or more");let u=1e5;if(e.isClosed)throw new Error("the given path cannot be closed");let c=p$(e);if(c.length<1)throw new Error("the given path must contain one or more points (as the starting point for the arc)");let h=i[0],f=i[1],d=c[c.length-1];h=Math.round(h*u)/u,f=Math.round(f*u)/u,n=br.fromValues(Math.round(n[0]*u)/u,Math.round(n[1]*u)/u);let m=!o,p=[];if(h===0||f===0)p.push(n);else{h=Math.abs(h),f=Math.abs(f);let b=s,v=Math.cos(b),w=Math.sin(b),P=br.subtract(br.create(),d,n);br.scale(P,P,.5);let _=Math.round((v*P[0]+w*P[1])*u)/u,B=Math.round((-w*P[0]+v*P[1])*u)/u,I=br.fromValues(_,B),C=I[0]*I[0]/(h*h)+I[1]*I[1]/(f*f);if(C>1){let L=Math.sqrt(C);h*=L,f*=L,h=Math.round(h*u)/u,f=Math.round(f*u)/u}let N=Math.sqrt((h*h*f*f-h*h*I[1]*I[1]-f*f*I[0]*I[0])/(h*h*I[1]*I[1]+f*f*I[0]*I[0]));m===a&&(N=-N);let A=br.fromValues(h*I[1]/f,-f*I[0]/h);br.scale(A,A,N);let M=br.fromValues(v*A[0]-w*A[1],w*A[0]+v*A[1]);M=br.add(M,M,br.scale(br.create(),br.add(br.create(),d,n),.5));let S=br.fromValues((I[0]-A[0])/h,(I[1]-A[1])/f),$=br.fromValues((-I[0]-A[0])/h,(-I[1]-A[1])/f),H=br.angleRadians(S),F=br.angleRadians($)-H;F=F%Rf,!m&&F>0?F-=Rf:m&&F<0&&(F+=Rf);let z=Math.ceil(Math.abs(F)/Rf*l)+1;z<1&&(z=1);for(let L=1;L<z;L++){let k=H+L/z*F,O=Math.cos(k),ie=Math.sin(k),W=br.fromValues(v*h*O-w*f*ie,w*h*O+v*f*ie);br.add(W,W,M),p.push(W)}z&&p.push(r.endpoint)}return p=c.concat(p),f$({},p)};ZB.exports=m$});var sx=G((p4e,QB)=>{var g$=Nf(),x$=$o(),{equals:b$}=st(),y$=(...r)=>{let e=!1,t=[];return r.forEach((n,i)=>{let s=x$(n).slice();if(t.length>0&&s.length>0&&b$(s[0],t[t.length-1])&&s.shift(),s.length>0&&e)throw new Error(`Cannot concatenate to a closed path; check the ${i}th path`);e=n.isClosed,t=t.concat(s)}),g$({closed:e},t)};QB.exports=y$});var ox=G((m4e,JB)=>{var v$=sx(),w$=ec(),E$=(r,e)=>v$(e,w$(r));JB.exports=E$});var tA=G((g4e,eA)=>{var{TAU:_$}=bt(),Bn=st(),P$=st(),S$=ox(),I$=$o(),B$=(r,e)=>{let t={segments:16},{controlPoints:n,segments:i}=Object.assign({},t,r);if(!Array.isArray(n))throw new Error("controlPoints must be an array of one or more points");if(n.length<1)throw new Error("controlPoints must be an array of one or more points");if(i<4)throw new Error("segments must be four or more");if(e.isClosed)throw new Error("the given geometry cannot be closed");let s=I$(e);if(s.length<1)throw new Error("the given path must contain one or more points (as the starting point for the bezier curve)");if(n=n.slice(),n[0]===null){if(n.length<2)throw new Error("a null control point must be passed with one more control points");let B=s[s.length-2];if("lastBezierControlPoint"in e&&(B=e.lastBezierControlPoint),!Array.isArray(B))throw new Error("the given path must contain TWO or more points if given a null control point");let I=Bn.scale(Bn.create(),s[s.length-1],2);Bn.subtract(I,I,B),n[0]=I}n.unshift(s[s.length-1]);let a=n.length-1,l=[],u=1;for(let B=0;B<=a;++B)B>0&&(u*=B),l.push(u);let c=[];for(let B=0;B<=a;++B){let I=l[a]/(l[B]*l[a-B]);c.push(I)}let h=Bn.create(),f=Bn.create(),d=P$.create(),m=B=>{let I=1,C=Math.pow(1-B,a),N=B!==1?1/(1-B):1,A=Bn.create();for(let M=0;M<=a;++M){M===a&&(C=1);let S=c[M]*I*C,$=Bn.scale(h,n[M],S);Bn.add(A,A,$),I*=B,C*=N}return A},p=[],g=[],b=a+1;for(let B=0;B<b;++B){let I=B/(b-1),C=m(I);p.push(C),g.push(I)}let v=1,w=_$/i,P=Math.sin(w);for(;v<p.length-1;){let B=Bn.subtract(h,p[v],p[v-1]);Bn.normalize(B,B);let I=Bn.subtract(f,p[v+1],p[v]);Bn.normalize(I,I);let C=Bn.cross(d,B,I);if(Math.abs(C[2])>P){let N=g[v-1],A=g[v+1],M=N+(A-N)*1/3,S=N+(A-N)*2/3,$=m(M),H=m(S);p.splice(v,1,$,H),g.splice(v,1,M,S),v--,v<1&&(v=1)}else++v}p.shift();let _=S$(p,e);return _.lastBezierControlPoint=n[n.length-2],_};eA.exports=B$});var iA=G((x4e,nA)=>{var A$=st(),rA=$o(),T$=(r,e)=>{if(r.isClosed!==e.isClosed||r.points.length!==e.points.length)return!1;let t=rA(r),n=rA(e),i=t.length,s=0;do{let o=!1;for(let a=0;a<i;a++)if(!A$.equals(t[a],n[(a+s)%i])){o=!0;break}if(o===!1)return!0;if(!r.isClosed)return!1}while(++s<i);return!1};nA.exports=T$});var oA=G((b4e,sA)=>{var C$=Gt(),M$=st(),N$=ec(),R$=r=>{if(r[0]!==2)throw new Error("invalid compact binary data");let e=N$();e.transforms=C$.clone(r.slice(1,17)),e.isClosed=!!r[17];for(let t=22;t<r.length;t+=2){let n=M$.fromValues(r[t],r[t+1]);e.points.push(n)}return r[18]>=0&&(e.color=[r[18],r[19],r[20],r[21]]),e};sA.exports=R$});var ax=G((y4e,aA)=>{var L$=r=>!!(r&&typeof r=="object"&&"points"in r&&"transforms"in r&&"isClosed"in r&&Array.isArray(r.points)&&"length"in r.transforms);aA.exports=L$});var uA=G((v4e,lA)=>{var O$=Mf(),k$=r=>{let e=O$(r);return e.points=r.points.slice().reverse(),e};lA.exports=k$});var hA=G((w4e,cA)=>{var U$=st(),D$=$o(),G$=r=>{let e=D$(r),t="path ("+e.length+" points, "+r.isClosed+`):
[
`;return e.forEach(n=>{t+="  "+U$.toString(n)+`,
`}),t+=`]
`,t};cA.exports=G$});var fA=G((E4e,dA)=>{var F$=r=>{let e=r.points,t=r.transforms,n=[-1,-1,-1,-1];r.color&&(n=r.color);let i=new Float32Array(1+16+1+4+e.length*2);i[0]=2,i[1]=t[0],i[2]=t[1],i[3]=t[2],i[4]=t[3],i[5]=t[4],i[6]=t[5],i[7]=t[6],i[8]=t[7],i[9]=t[8],i[10]=t[9],i[11]=t[10],i[12]=t[11],i[13]=t[12],i[14]=t[13],i[15]=t[14],i[16]=t[15],i[17]=r.isClosed?1:0,i[18]=n[0],i[19]=n[1],i[20]=n[2],i[21]=n[3];for(let s=0;s<e.length;s++){let o=s*2+22,a=e[s];i[o]=a[0],i[o+1]=a[1]}return i};dA.exports=F$});var gA=G((_4e,mA)=>{var pA=Gt(),q$=(r,e)=>{let t=pA.multiply(pA.create(),r,e.transforms);return Object.assign({},e,{transforms:t})};mA.exports=q$});var bA=G((P4e,xA)=>{var z$=st(),Y$=ax(),X$=r=>{if(!Y$(r))throw new Error("invalid path2 structure");if(r.points.length>1){for(let e=0;e<r.points.length;e++)if(z$.equals(r.points[e],r.points[(e+1)%r.points.length]))throw new Error(`path2 duplicate points ${r.points[e]}`)}if(r.points.forEach(e=>{if(!e.every(Number.isFinite))throw new Error(`path2 invalid point ${e}`)}),!r.transforms.every(Number.isFinite))throw new Error(`path2 invalid transforms ${r.transforms}`)};xA.exports=X$});var kt=G((S4e,yA)=>{yA.exports={appendArc:KB(),appendBezier:tA(),appendPoints:ox(),clone:Mf(),close:ix(),concat:sx(),create:ec(),equals:iA(),fromPoints:Nf(),fromCompactBinary:oA(),isA:ax(),reverse:uA(),toPoints:$o(),toString:hA(),toCompactBinary:fA(),transform:gA(),validate:bA()}});var SA=G((I4e,PA)=>{var V$=Ke(),vA=rt(),wA=nt(),EA=kt(),_A=xt(),W$=(r,e)=>{let t=vA.clone(e);return t.color=r,t},$$=(r,e)=>{let t=wA.clone(e);return t.color=r,t},j$=(r,e)=>{let t=EA.clone(e);return t.color=r,t},H$=(r,e)=>{let t=_A.clone(e);return t.color=r,t},Z$=(r,...e)=>{if(!Array.isArray(r))throw new Error("color must be an array");if(r.length<3)throw new Error("color must contain R, G and B values");if(r.length===3&&(r=[r[0],r[1],r[2],1]),e=V$(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>vA.isA(n)?W$(r,n):wA.isA(n)?$$(r,n):EA.isA(n)?j$(r,n):_A.isA(n)?H$(r,n):(n.color=r,n));return t.length===1?t[0]:t};PA.exports=Z$});var lx=G((B4e,IA)=>{var K$={black:[0,0,0],silver:[.7529411764705882,.7529411764705882,.7529411764705882],gray:[.5019607843137255,.5019607843137255,.5019607843137255],white:[1,1,1],maroon:[.5019607843137255,0,0],red:[1,0,0],purple:[.5019607843137255,0,.5019607843137255],fuchsia:[1,0,1],green:[0,.5019607843137255,0],lime:[0,1,0],olive:[.5019607843137255,.5019607843137255,0],yellow:[1,1,0],navy:[0,0,.5019607843137255],blue:[0,0,1],teal:[0,.5019607843137255,.5019607843137255],aqua:[0,1,1],aliceblue:[.9411764705882353,.9725490196078431,1],antiquewhite:[.9803921568627451,.9215686274509803,.8431372549019608],aquamarine:[.4980392156862745,1,.8313725490196079],azure:[.9411764705882353,1,1],beige:[.9607843137254902,.9607843137254902,.8627450980392157],bisque:[1,.8941176470588236,.7686274509803922],blanchedalmond:[1,.9215686274509803,.803921568627451],blueviolet:[.5411764705882353,.16862745098039217,.8862745098039215],brown:[.6470588235294118,.16470588235294117,.16470588235294117],burlywood:[.8705882352941177,.7215686274509804,.5294117647058824],cadetblue:[.37254901960784315,.6196078431372549,.6274509803921569],chartreuse:[.4980392156862745,1,0],chocolate:[.8235294117647058,.4117647058823529,.11764705882352941],coral:[1,.4980392156862745,.3137254901960784],cornflowerblue:[.39215686274509803,.5843137254901961,.9294117647058824],cornsilk:[1,.9725490196078431,.8627450980392157],crimson:[.8627450980392157,.0784313725490196,.23529411764705882],cyan:[0,1,1],darkblue:[0,0,.5450980392156862],darkcyan:[0,.5450980392156862,.5450980392156862],darkgoldenrod:[.7215686274509804,.5254901960784314,.043137254901960784],darkgray:[.6627450980392157,.6627450980392157,.6627450980392157],darkgreen:[0,.39215686274509803,0],darkgrey:[.6627450980392157,.6627450980392157,.6627450980392157],darkkhaki:[.7411764705882353,.7176470588235294,.4196078431372549],darkmagenta:[.5450980392156862,0,.5450980392156862],darkolivegreen:[.3333333333333333,.4196078431372549,.1843137254901961],darkorange:[1,.5490196078431373,0],darkorchid:[.6,.19607843137254902,.8],darkred:[.5450980392156862,0,0],darksalmon:[.9137254901960784,.5882352941176471,.47843137254901963],darkseagreen:[.5607843137254902,.7372549019607844,.5607843137254902],darkslateblue:[.2823529411764706,.23921568627450981,.5450980392156862],darkslategray:[.1843137254901961,.30980392156862746,.30980392156862746],darkslategrey:[.1843137254901961,.30980392156862746,.30980392156862746],darkturquoise:[0,.807843137254902,.8196078431372549],darkviolet:[.5803921568627451,0,.8274509803921568],deeppink:[1,.0784313725490196,.5764705882352941],deepskyblue:[0,.7490196078431373,1],dimgray:[.4117647058823529,.4117647058823529,.4117647058823529],dimgrey:[.4117647058823529,.4117647058823529,.4117647058823529],dodgerblue:[.11764705882352941,.5647058823529412,1],firebrick:[.6980392156862745,.13333333333333333,.13333333333333333],floralwhite:[1,.9803921568627451,.9411764705882353],forestgreen:[.13333333333333333,.5450980392156862,.13333333333333333],gainsboro:[.8627450980392157,.8627450980392157,.8627450980392157],ghostwhite:[.9725490196078431,.9725490196078431,1],gold:[1,.8431372549019608,0],goldenrod:[.8549019607843137,.6470588235294118,.12549019607843137],greenyellow:[.6784313725490196,1,.1843137254901961],grey:[.5019607843137255,.5019607843137255,.5019607843137255],honeydew:[.9411764705882353,1,.9411764705882353],hotpink:[1,.4117647058823529,.7058823529411765],indianred:[.803921568627451,.3607843137254902,.3607843137254902],indigo:[.29411764705882354,0,.5098039215686274],ivory:[1,1,.9411764705882353],khaki:[.9411764705882353,.9019607843137255,.5490196078431373],lavender:[.9019607843137255,.9019607843137255,.9803921568627451],lavenderblush:[1,.9411764705882353,.9607843137254902],lawngreen:[.48627450980392156,.9882352941176471,0],lemonchiffon:[1,.9803921568627451,.803921568627451],lightblue:[.6784313725490196,.8470588235294118,.9019607843137255],lightcoral:[.9411764705882353,.5019607843137255,.5019607843137255],lightcyan:[.8784313725490196,1,1],lightgoldenrodyellow:[.9803921568627451,.9803921568627451,.8235294117647058],lightgray:[.8274509803921568,.8274509803921568,.8274509803921568],lightgreen:[.5647058823529412,.9333333333333333,.5647058823529412],lightgrey:[.8274509803921568,.8274509803921568,.8274509803921568],lightpink:[1,.7137254901960784,.7568627450980392],lightsalmon:[1,.6274509803921569,.47843137254901963],lightseagreen:[.12549019607843137,.6980392156862745,.6666666666666666],lightskyblue:[.5294117647058824,.807843137254902,.9803921568627451],lightslategray:[.4666666666666667,.5333333333333333,.6],lightslategrey:[.4666666666666667,.5333333333333333,.6],lightsteelblue:[.6901960784313725,.7686274509803922,.8705882352941177],lightyellow:[1,1,.8784313725490196],limegreen:[.19607843137254902,.803921568627451,.19607843137254902],linen:[.9803921568627451,.9411764705882353,.9019607843137255],magenta:[1,0,1],mediumaquamarine:[.4,.803921568627451,.6666666666666666],mediumblue:[0,0,.803921568627451],mediumorchid:[.7294117647058823,.3333333333333333,.8274509803921568],mediumpurple:[.5764705882352941,.4392156862745098,.8588235294117647],mediumseagreen:[.23529411764705882,.7019607843137254,.44313725490196076],mediumslateblue:[.4823529411764706,.40784313725490196,.9333333333333333],mediumspringgreen:[0,.9803921568627451,.6039215686274509],mediumturquoise:[.2823529411764706,.8196078431372549,.8],mediumvioletred:[.7803921568627451,.08235294117647059,.5215686274509804],midnightblue:[.09803921568627451,.09803921568627451,.4392156862745098],mintcream:[.9607843137254902,1,.9803921568627451],mistyrose:[1,.8941176470588236,.8823529411764706],moccasin:[1,.8941176470588236,.7098039215686275],navajowhite:[1,.8705882352941177,.6784313725490196],oldlace:[.9921568627450981,.9607843137254902,.9019607843137255],olivedrab:[.4196078431372549,.5568627450980392,.13725490196078433],orange:[1,.6470588235294118,0],orangered:[1,.27058823529411763,0],orchid:[.8549019607843137,.4392156862745098,.8392156862745098],palegoldenrod:[.9333333333333333,.9098039215686274,.6666666666666666],palegreen:[.596078431372549,.984313725490196,.596078431372549],paleturquoise:[.6862745098039216,.9333333333333333,.9333333333333333],palevioletred:[.8588235294117647,.4392156862745098,.5764705882352941],papayawhip:[1,.9372549019607843,.8352941176470589],peachpuff:[1,.8549019607843137,.7254901960784313],peru:[.803921568627451,.5215686274509804,.24705882352941178],pink:[1,.7529411764705882,.796078431372549],plum:[.8666666666666667,.6274509803921569,.8666666666666667],powderblue:[.6901960784313725,.8784313725490196,.9019607843137255],rosybrown:[.7372549019607844,.5607843137254902,.5607843137254902],royalblue:[.2549019607843137,.4117647058823529,.8823529411764706],saddlebrown:[.5450980392156862,.27058823529411763,.07450980392156863],salmon:[.9803921568627451,.5019607843137255,.4470588235294118],sandybrown:[.9568627450980393,.6431372549019608,.3764705882352941],seagreen:[.1803921568627451,.5450980392156862,.3411764705882353],seashell:[1,.9607843137254902,.9333333333333333],sienna:[.6274509803921569,.3215686274509804,.17647058823529413],skyblue:[.5294117647058824,.807843137254902,.9215686274509803],slateblue:[.41568627450980394,.35294117647058826,.803921568627451],slategray:[.4392156862745098,.5019607843137255,.5647058823529412],slategrey:[.4392156862745098,.5019607843137255,.5647058823529412],snow:[1,.9803921568627451,.9803921568627451],springgreen:[0,1,.4980392156862745],steelblue:[.27450980392156865,.5098039215686274,.7058823529411765],tan:[.8235294117647058,.7058823529411765,.5490196078431373],thistle:[.8470588235294118,.7490196078431373,.8470588235294118],tomato:[1,.38823529411764707,.2784313725490196],turquoise:[.25098039215686274,.8784313725490196,.8156862745098039],violet:[.9333333333333333,.5098039215686274,.9333333333333333],wheat:[.9607843137254902,.8705882352941177,.7019607843137254],whitesmoke:[.9607843137254902,.9607843137254902,.9607843137254902],yellowgreen:[.6039215686274509,.803921568627451,.19607843137254902]};IA.exports=K$});var AA=G((A4e,BA)=>{var Q$=lx(),J$=r=>Q$[r.toLowerCase()];BA.exports=J$});var CA=G((T4e,TA)=>{var ej=r=>{if(r=r.replace("#",""),r.length<6)throw new Error("the given notation must contain 3 or more hex values");let e=parseInt(r.substring(0,2),16)/255,t=parseInt(r.substring(2,4),16)/255,n=parseInt(r.substring(4,6),16)/255;if(r.length>=8){let i=parseInt(r.substring(6,8),16)/255;return[e,t,n,i]}return[e,t,n]};TA.exports=ej});var ux=G((C4e,MA)=>{var tj=(r,e,t)=>(t<0&&(t+=1),t>1&&(t-=1),t<.16666666666666666?r+(e-r)*6*t:t<.5?e:t<.6666666666666666?r+(e-r)*(.6666666666666666-t)*6:r);MA.exports=tj});var RA=G((M4e,NA)=>{var rj=Ke(),cx=ux(),nj=(...r)=>{if(r=rj(r),r.length<3)throw new Error("values must contain H, S and L values");let e=r[0],t=r[1],n=r[2],i=n,s=n,o=n;if(t!==0){let a=n<.5?n*(1+t):n+t-n*t,l=2*n-a;i=cx(l,a,e+1/3),s=cx(l,a,e),o=cx(l,a,e-1/3)}if(r.length>3){let a=r[3];return[i,s,o,a]}return[i,s,o]};NA.exports=nj});var OA=G((N4e,LA)=>{var ij=Ke(),sj=(...r)=>{if(r=ij(r),r.length<3)throw new Error("values must contain H, S and V values");let e=r[0],t=r[1],n=r[2],i=0,s=0,o=0,a=Math.floor(e*6),l=e*6-a,u=n*(1-t),c=n*(1-l*t),h=n*(1-(1-l)*t);switch(a%6){case 0:i=n,s=h,o=u;break;case 1:i=c,s=n,o=u;break;case 2:i=u,s=n,o=h;break;case 3:i=u,s=c,o=n;break;case 4:i=h,s=u,o=n;break;case 5:i=n,s=u,o=c;break}if(r.length>3){let f=r[3];return[i,s,o,f]}return[i,s,o]};LA.exports=sj});var UA=G((R4e,kA)=>{var oj=Ke(),aj=(...r)=>{if(r=oj(r),r.length<3)throw new Error("values must contain R, G and B values");let e=r[0]*255,t=r[1]*255,n=r[2]*255,i=`#${Number(16777216+e*65536+t*256+n).toString(16).substring(1,7)}`;return r.length>3&&(i=i+Number(r[3]*255).toString(16)),i};kA.exports=aj});var GA=G((L4e,DA)=>{var lj=Ke(),uj=(...r)=>{if(r=lj(r),r.length<3)throw new Error("values must contain R, G and B values");let e=r[0],t=r[1],n=r[2],i=Math.max(e,t,n),s=Math.min(e,t,n),o,a,l=(i+s)/2;if(i===s)o=a=0;else{let u=i-s;switch(a=l>.5?u/(2-i-s):u/(i+s),i){case e:o=(t-n)/u+(t<n?6:0);break;case t:o=(n-e)/u+2;break;case n:o=(e-t)/u+4;break}o/=6}if(r.length>3){let u=r[3];return[o,a,l,u]}return[o,a,l]};DA.exports=uj});var qA=G((O4e,FA)=>{var cj=Ke(),hj=(...r)=>{if(r=cj(r),r.length<3)throw new Error("values must contain R, G and B values");let e=r[0],t=r[1],n=r[2],i=Math.max(e,t,n),s=Math.min(e,t,n),o,a=i,l=i-s,u=i===0?0:l/i;if(i===s)o=0;else{switch(i){case e:o=(t-n)/l+(t<n?6:0);break;case t:o=(n-e)/l+2;break;case n:o=(e-t)/l+4;break}o/=6}if(r.length>3){let c=r[3];return[o,u,a,c]}return[o,u,a]};FA.exports=hj});var YA=G((k4e,zA)=>{zA.exports={colorize:SA(),colorNameToRgb:AA(),cssColors:lx(),hexToRgb:CA(),hslToRgb:RA(),hsvToRgb:OA(),hueToColorComponent:ux(),rgbToHex:UA(),rgbToHsl:GA(),rgbToHsv:qA()}});var WA=G((U4e,VA)=>{var dj=r=>{if(!Array.isArray(r))throw new Error("Bezier points must be a valid array/");if(r.length<2)throw new Error("Bezier points must contain at least 2 values.");let e=fj(r);return{points:r,pointType:e,dimensions:e==="float_single"?0:r[0].length,permutations:XA(r.length-1),tangentPermutations:XA(r.length-2)}},fj=function(r){let e=null;return r.forEach(t=>{let n="";if(Number.isFinite(t))n="float_single";else if(Array.isArray(t))t.forEach(i=>{if(!Number.isFinite(i))throw new Error("Bezier point values must all be numbers.")}),n="float_"+t.length;else throw new Error("Bezier points must all be numbers or arrays of number.");if(e==null)e=n;else if(e!==n)throw new Error("Bezier points must be either all numbers or all arrays of numbers of the same size.")}),e},XA=function(r){let e=[];for(let t=0;t<=r;t++)e.push(hx(r)/(hx(t)*hx(r-t)));return e},hx=function(r){let e=1;for(let t=2;t<=r;t++)e*=t;return e};VA.exports=dj});var HA=G((D4e,jA)=>{var pj=(r,e)=>{if(r<0||r>1)throw new Error("Bezier valueAt() input must be between 0 and 1");if(e.pointType==="float_single")return $A(e,e.points,r);{let t=[];for(let n=0;n<e.dimensions;n++){let i=[];for(let s=0;s<e.points.length;s++)i.push(e.points[s][n]);t.push($A(e,i,r))}return t}},$A=function(r,e,t){let n=e.length-1,i=0;for(let s=0;s<=n;s++)i+=r.permutations[s]*Math.pow(1-t,n-s)*Math.pow(t,s)*e[s];return i};jA.exports=pj});var QA=G((G4e,KA)=>{var mj=(r,e)=>{if(r<0||r>1)throw new Error("Bezier tangentAt() input must be between 0 and 1");if(e.pointType==="float_single")return ZA(e,e.points,r);{let t=[];for(let n=0;n<e.dimensions;n++){let i=[];for(let s=0;s<e.points.length;s++)i.push(e.points[s][n]);t.push(ZA(e,i,r))}return t}},ZA=function(r,e,t){let n=e.length-1,i=0;for(let s=0;s<n;s++){let o=n*(e[s+1]-e[s]);i+=r.tangentPermutations[s]*Math.pow(1-t,n-1-s)*Math.pow(t,s)*o}return i};KA.exports=mj});var eT=G((F4e,JA)=>{JA.exports={create:WA(),valueAt:HA(),tangentAt:QA()}});var rT=G((q4e,tT)=>{tT.exports={bezier:eT()}});var tc=G((z4e,nT)=>{var gj=r=>{let e=0;for(let t=0;t<r.length;t++){let n=(t+1)%r.length;e+=r[t][0]*r[n][1],e-=r[n][0]*r[t][1]}return e/2};nT.exports=gj});var dx=G((Y4e,iT)=>{var xj=tc(),bj=r=>xj(r.vertices);iT.exports=bj});var fx=G((X4e,sT)=>{var yj=r=>((r===void 0||r.length<3)&&(r=[]),{vertices:r});sT.exports=yj});var px=G((V4e,oT)=>{var vj=fx(),wj=r=>{let e=r.vertices.slice().reverse();return vj(e)};oT.exports=wj});var lT=G(($4e,aT)=>{var Ej=dx(),_j=px(),Pj=(r,e)=>{if(r.length===0)return 0;let t=e.vertices;return t.length<3?0:(Ej(e)<0&&(e=_j(e)),r.reduce((i,s)=>i+Sj(s,t),0)===r.length?1:0)},Sj=(r,e)=>{let t=e.length,n=r[0],i=r[1],s=e[t-1],o=e[0],a=s[1]>i,l=0,u=0;for(let c=t+1;--c;){let h=o[1]>i;if(a!==h){let f=s[0]>n,d=o[0]>n;(f&&d||o[0]-(o[1]-i)*(s[0]-o[0])/(s[1]-o[1])>=n)&&(l=!l)}a=h,s=o,o=e[++u]}return l},W4e=(r,e,t)=>(e[0]-r[0])*(t[1]-r[1])-(t[0]-r[0])*(e[1]-r[1]);aT.exports=Pj});var Lf=G((j4e,uT)=>{uT.exports={arePointsInside:lT(),create:fx(),flip:px(),measureArea:dx()}});var Of=G((H4e,cT)=>{cT.exports={geom2:rt(),geom3:nt(),path2:kt(),poly2:Lf(),poly3:xt()}});var kf=G((Z4e,hT)=>{var Ij=()=>[0,1,0];hT.exports=Ij});var fT=G((K4e,dT)=>{var Bj=kf(),Aj=r=>{let e=Bj();return e[0]=r[0],e[1]=r[1],e[2]=r[2],e};dT.exports=Aj});var Uf=G((Q4e,pT)=>{var mx=st(),Tj=r=>{let e=mx.normal(mx.create(),r);return mx.negate(e,e),e};pT.exports=Tj});var rc=G((J4e,gT)=>{var mT=st(),Cj=r=>mT.scale(mT.create(),r,r[2]);gT.exports=Cj});var bT=G((eke,xT)=>{var Mj=st(),Nj=Uf(),Rj=rc(),Lj=(r,e)=>{let t=Rj(r),n=Nj(r),i=(n[1]-t[1])/(n[0]-t[0]),s=t[1]-i*t[0],o=-1/i,l=(e[1]-o*e[0]-s)/(i-o),u=i*l+s;return Mj.fromValues(l,u)};xT.exports=Lj});var gx=G((tke,yT)=>{var Oj=(r,e)=>(r[0]=e[0],r[1]=e[1],r[2]=e[2],r);yT.exports=Oj});var wT=G((rke,vT)=>{var kj=st(),Uj=(r,e)=>{let t=kj.dot(e,r);return t=Math.abs(t-r[2]),t};vT.exports=Uj});var _T=G((nke,ET)=>{var Dj=(r,e)=>r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2];ET.exports=Dj});var xx=G((ike,PT)=>{var nc=st(),Gj=(r,e,t)=>{let n=nc.subtract(nc.create(),t,e);nc.normal(n,n),nc.normalize(n,n);let i=nc.dot(e,n);return r[0]=n[0],r[1]=n[1],r[2]=i,r};PT.exports=Gj});var bx=G((ske,ST)=>{var Fj=kf(),qj=(r,e,t)=>{let n=Fj();return n[0]=r,n[1]=e,n[2]=t,n};ST.exports=qj});var ic=G((oke,IT)=>{var{NEPS:yx}=bt(),zj=(r,e)=>Math.abs(r[0]-e[0])<=yx&&Math.abs(r[1]-e[1])<=yx&&Math.abs(r[2]-e[2])<=yx;IT.exports=zj});var vx=G((ake,BT)=>{var Yj=(r,e,t)=>{let n=t-r[1],i=e[1]-r[1];i<0&&(n=-n,i=-i);let s;return n<=0?s=0:n>=i?s=1:i<1e-10?s=.5:s=n/i,r[0]+s*(e[0]-r[0])};BT.exports=Yj});var wx=G((lke,AT)=>{var Xj=(r,e,t,n)=>{if(r[0]===e[0]&&r[1]===e[1]||t[0]===n[0]&&t[1]===n[1])return;let i=(n[1]-t[1])*(e[0]-r[0])-(n[0]-t[0])*(e[1]-r[1]);if(Math.abs(i)<Number.MIN_VALUE)return;let s=((n[0]-t[0])*(r[1]-t[1])-(n[1]-t[1])*(r[0]-t[0]))/i,o=((e[0]-r[0])*(r[1]-t[1])-(e[1]-r[1])*(r[0]-t[0]))/i;if(s<0||s>1||o<0||o>1)return;let a=r[0]+s*(e[0]-r[0]),l=r[1]+s*(e[1]-r[1]);return[a,l]};AT.exports=Xj});var CT=G((uke,TT)=>{var Vj=(r,e,t,n,i,s)=>{let a=1/(r*n-e*t),l=i*n-e*s,u=-i*t+r*s;return l*=a,u*=a,[l,u]};TT.exports=Vj});var dl=G((cke,MT)=>{MT.exports={aboutEqualNormals:ic(),area:tc(),cos:Mr().cos,interpolateBetween2DPointsForY:vx(),intersect:wx(),sin:Mr().sin,solve2Linear:CT()}});var RT=G((hke,NT)=>{var Wj=st(),{solve2Linear:$j}=dl(),jj=(r,e)=>{let t=$j(r[0],r[1],e[0],e[1],r[2],e[2]);return Wj.clone(t)};NT.exports=jj});var kT=G((dke,OT)=>{var LT=st(),Hj=gx(),Zj=bx(),Kj=(r,e)=>{let t=LT.negate(LT.create(),e),n=-e[2];return Hj(r,Zj(t[0],t[1],n))};OT.exports=Kj});var DT=G((fke,UT)=>{var Qj=r=>`line2: (${r[0].toFixed(7)}, ${r[1].toFixed(7)}, ${r[2].toFixed(7)})`;UT.exports=Qj});var qT=G((pke,FT)=>{var GT=st(),Jj=xx(),eH=rc(),tH=Uf(),rH=(r,e,t)=>{let n=eH(e),i=tH(e);return GT.transform(n,n,t),GT.transform(i,i,t),Jj(r,n,i)};FT.exports=rH});var YT=G((mke,zT)=>{var nH=rc(),iH=(r,e)=>{let t=(r[2]-r[1]*e)/r[0];return Number.isNaN(t)&&(t=nH(r)[0]),t};zT.exports=iH});var Df=G((gke,XT)=>{XT.exports={clone:fT(),closestPoint:bT(),copy:gx(),create:kf(),direction:Uf(),distanceToPoint:wT(),equals:_T(),fromPoints:xx(),fromValues:bx(),intersectPointOfLines:RT(),origin:rc(),reverse:kT(),toString:DT(),transform:qT(),xAtY:YT()}});var Ex=G((xke,WT)=>{var VT=Ye(),sH=()=>[VT.fromValues(0,0,0),VT.fromValues(0,0,1)];WT.exports=sH});var HT=G((bke,jT)=>{var $T=Ye(),oH=Ex(),aH=r=>{let e=oH();return $T.copy(e[0],r[0]),$T.copy(e[1],r[1]),e};jT.exports=aH});var _x=G((yke,ZT)=>{var jo=Ye(),lH=(r,e)=>{let t=r[0],n=r[1],i=jo.dot(jo.subtract(jo.create(),e,t),n),s=jo.dot(n,n),o=i/s,a=jo.scale(jo.create(),n,o);return jo.add(a,a,t),a};ZT.exports=lH});var JT=G((vke,QT)=>{var KT=Ye(),uH=(r,e)=>(KT.copy(r[0],e[0]),KT.copy(r[1],e[1]),r);QT.exports=uH});var tC=G((wke,eC)=>{var cH=r=>r[1];eC.exports=cH});var nC=G((Eke,rC)=>{var Px=Ye(),hH=_x(),dH=(r,e)=>{let t=hH(r,e),n=Px.subtract(Px.create(),e,t);return Px.length(n)};rC.exports=dH});var oC=G((_ke,sC)=>{var iC=Ye(),fH=(r,e)=>!(!iC.equals(r[1],e[1])||!iC.equals(r[0],e[0]));sC.exports=fH});var fl=G((Pke,aC)=>{var Gf=Ye(),pH=(r,e,t)=>{let n=Gf.normalize(Gf.create(),t);return Gf.copy(r[0],e),Gf.copy(r[1],n),r};aC.exports=pH});var uC=G((Ske,lC)=>{var Ho=Ye(),{solve2Linear:Sx}=dl(),{EPS:mH}=bt(),gH=fl(),xH=(r,e,t)=>{let n=Ho.cross(Ho.create(),e,t),i=Ho.length(n);if(i<mH)throw new Error("parallel planes do not intersect");i=1/i,n=Ho.scale(n,n,i);let s=Math.abs(n[0]),o=Math.abs(n[1]),a=Math.abs(n[2]),l,u;return s>=o&&s>=a?(u=Sx(e[1],e[2],t[1],t[2],e[3],t[3]),l=Ho.fromValues(0,u[0],u[1])):o>=s&&o>=a?(u=Sx(e[0],e[2],t[0],t[2],e[3],t[3]),l=Ho.fromValues(u[0],0,u[1])):(u=Sx(e[0],e[1],t[0],t[1],e[3],t[3]),l=Ho.fromValues(u[0],u[1],0)),gH(r,l,n)};lC.exports=xH});var dC=G((Ike,hC)=>{var cC=Ye(),bH=fl(),yH=(r,e,t)=>{let n=cC.subtract(cC.create(),t,e);return bH(r,e,n)};hC.exports=yH});var pC=G((Bke,fC)=>{var pl=Ye(),vH=(r,e)=>{let t=e,n=e[3],i=r[0],s=r[1],o=(n-pl.dot(t,i))/pl.dot(t,s);return pl.add(pl.create(),i,pl.scale(pl.create(),s,o))};fC.exports=vH});var gC=G((Ake,mC)=>{var wH=r=>r[0];mC.exports=wH});var bC=G((Tke,xC)=>{var Ix=Ye(),EH=fl(),_H=(r,e)=>{let t=Ix.clone(e[0]),n=Ix.negate(Ix.create(),e[1]);return EH(r,t,n)};xC.exports=_H});var vC=G((Cke,yC)=>{var PH=r=>{let e=r[0],t=r[1];return`line3: point: (${e[0].toFixed(7)}, ${e[1].toFixed(7)}, ${e[2].toFixed(7)}) direction: (${t[0].toFixed(7)}, ${t[1].toFixed(7)}, ${t[2].toFixed(7)})`};yC.exports=PH});var EC=G((Mke,wC)=>{var ml=Ye(),SH=fl(),IH=(r,e,t)=>{let n=e[0],i=e[1],s=ml.add(ml.create(),n,i),o=ml.transform(ml.create(),n,t),a=ml.transform(s,s,t),l=ml.subtract(a,a,o);return SH(r,o,l)};wC.exports=IH});var PC=G((Nke,_C)=>{_C.exports={clone:HT(),closestPoint:_x(),copy:JT(),create:Ex(),direction:tC(),distanceToPoint:nC(),equals:oC(),fromPlanes:uC(),fromPointAndDirection:fl(),fromPoints:dC(),intersectPointOfLineAndPlane:pC(),origin:gC(),reverse:bC(),toString:vC(),transform:EC()}});var IC=G((Rke,SC)=>{SC.exports={constants:bt(),line2:Df(),line3:PC(),mat4:Gt(),plane:pi(),utils:dl(),vec2:st(),vec3:Ye(),vec4:tx()}});var Bx=G((Lke,TC)=>{var BH=Ke(),BC=rt(),AC=nt(),AH=kt(),TH=xt(),Ff=new WeakMap,CH=()=>0,MH=r=>{let e=Ff.get(r);return e||(e=BC.toSides(r).reduce((n,i)=>n+(i[0][0]*i[1][1]-i[0][1]*i[1][0]),0),e*=.5,Ff.set(r,e),e)},NH=r=>{let e=Ff.get(r);return e||(e=AC.toPolygons(r).reduce((n,i)=>n+TH.measureArea(i),0),Ff.set(r,e),e)},RH=(...r)=>{if(r=BH(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>AH.isA(t)?CH(t):BC.isA(t)?MH(t):AC.isA(t)?NH(t):0);return e.length===1?e[0]:e};TC.exports=RH});var MC=G((Oke,CC)=>{var LH=Ke(),OH=Bx(),kH=(...r)=>{if(r=LH(r),r.length===0)throw new Error("measureAggregateArea: no geometries supplied");let e=OH(r);if(r.length===1)return e;let t=0;return e.reduce((n,i)=>n+i,t)};CC.exports=kH});var to=G((kke,kC)=>{var UH=Ke(),Ui=st(),sc=Ye(),NC=rt(),RC=nt(),LC=kt(),OC=xt(),gl=new WeakMap,DH=r=>{let e=gl.get(r);if(e)return e;let t=LC.toPoints(r),n;t.length===0?n=Ui.create():n=Ui.clone(t[0]);let i=Ui.clone(n);return t.forEach(s=>{Ui.min(n,n,s),Ui.max(i,i,s)}),n=[n[0],n[1],0],i=[i[0],i[1],0],e=[n,i],gl.set(r,e),e},GH=r=>{let e=gl.get(r);if(e)return e;let t=NC.toPoints(r),n;t.length===0?n=Ui.create():n=Ui.clone(t[0]);let i=Ui.clone(n);return t.forEach(s=>{Ui.min(n,n,s),Ui.max(i,i,s)}),n=[n[0],n[1],0],i=[i[0],i[1],0],e=[n,i],gl.set(r,e),e},FH=r=>{let e=gl.get(r);if(e)return e;let t=RC.toPolygons(r),n=sc.create();if(t.length>0){let s=OC.toPoints(t[0]);sc.copy(n,s[0])}let i=sc.clone(n);return t.forEach(s=>{OC.toPoints(s).forEach(o=>{sc.min(n,n,o),sc.max(i,i,o)})}),n=[n[0],n[1],n[2]],i=[i[0],i[1],i[2]],e=[n,i],gl.set(r,e),e},qH=(...r)=>{if(r=UH(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>LC.isA(t)?DH(t):NC.isA(t)?GH(t):RC.isA(t)?FH(t):[[0,0,0],[0,0,0]]);return e.length===1?e[0]:e};kC.exports=qH});var qf=G((Uke,UC)=>{var zH=Ke(),YH=R0(),XH=N0(),VH=to(),WH=(...r)=>{if(r=zH(r),r.length===0)throw new Error("measureAggregateBoundingBox: no geometries supplied");let e=VH(r);if(r.length===1)return e;let t=[[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]];return e.reduce((n,i)=>(n=[YH(n[0],n[0],i[0]),XH(n[1],n[1],i[1])],n),t)};UC.exports=WH});var Ax=G((Dke,DC)=>{var{EPS:$H}=bt(),jH=(r,e)=>{let t=0;for(let n=0;n<e;n++)t+=r[1][n]-r[0][n];return $H*t/e};DC.exports=jH});var FC=G((Gke,GC)=>{var HH=Ke(),ZH=qf(),KH=Ax(),{geom2:QH,geom3:JH,path2:eZ}=Of(),tZ=(...r)=>{if(r=HH(r),r.length===0)throw new Error("measureAggregateEpsilon: no geometries supplied");let e=ZH(r),t=0;return t=r.reduce((n,i)=>eZ.isA(i)||QH.isA(i)?Math.max(n,2):JH.isA(i)?Math.max(n,3):0,t),KH(e,t)};GC.exports=tZ});var Tx=G((Fke,YC)=>{var rZ=Ke(),nZ=rt(),qC=nt(),iZ=kt(),sZ=xt(),zC=new WeakMap,oZ=()=>0,aZ=()=>0,lZ=r=>{let e=zC.get(r);return e||(e=qC.toPolygons(r).reduce((n,i)=>n+sZ.measureSignedVolume(i),0),zC.set(r,e),e)},uZ=(...r)=>{if(r=rZ(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>iZ.isA(t)?oZ(t):nZ.isA(t)?aZ(t):qC.isA(t)?lZ(t):0);return e.length===1?e[0]:e};YC.exports=uZ});var VC=G((qke,XC)=>{var cZ=Ke(),hZ=Tx(),dZ=(...r)=>{if(r=cZ(r),r.length===0)throw new Error("measureAggregateVolume: no geometries supplied");let e=hZ(r);if(r.length===1)return e;let t=0;return e.reduce((n,i)=>n+i,t)};XC.exports=dZ});var QC=G((zke,KC)=>{var fZ=Ke(),WC=st(),hn=Ye(),$C=rt(),jC=nt(),HC=kt(),ZC=xt(),xl=new WeakMap,pZ=r=>{let e=xl.get(r);if(e!==void 0)return e;let t=hn.create(),n=0,i=HC.toPoints(r);if(i.length>0){let s=0,o=hn.create();i.forEach(a=>{hn.add(t,t,hn.fromVec2(o,a,0)),s++}),hn.scale(t,t,1/s),i.forEach(a=>{n=Math.max(n,WC.squaredDistance(t,a))}),n=Math.sqrt(n)}return e=[t,n],xl.set(r,e),e},mZ=r=>{let e=xl.get(r);if(e!==void 0)return e;let t=hn.create(),n=0,i=$C.toSides(r);if(i.length>0){let s=0,o=hn.create();i.forEach(a=>{hn.add(t,t,hn.fromVec2(o,a[0],0)),s++}),hn.scale(t,t,1/s),i.forEach(a=>{n=Math.max(n,WC.squaredDistance(t,a[0]))}),n=Math.sqrt(n)}return e=[t,n],xl.set(r,e),e},gZ=r=>{let e=xl.get(r);if(e!==void 0)return e;let t=hn.create(),n=0,i=jC.toPolygons(r);if(i.length>0){let s=0;i.forEach(o=>{ZC.toPoints(o).forEach(a=>{hn.add(t,t,a),s++})}),hn.scale(t,t,1/s),i.forEach(o=>{ZC.toPoints(o).forEach(a=>{n=Math.max(n,hn.squaredDistance(t,a))})}),n=Math.sqrt(n)}return e=[t,n],xl.set(r,e),e},xZ=(...r)=>{r=fZ(r);let e=r.map(t=>HC.isA(t)?pZ(t):$C.isA(t)?mZ(t):jC.isA(t)?gZ(t):[[0,0,0],0]);return e.length===1?e[0]:e};KC.exports=xZ});var eM=G((Yke,JC)=>{var bZ=Ke(),yZ=to(),vZ=(...r)=>{r=bZ(r);let e=r.map(t=>{let n=yZ(t);return[n[0][0]+(n[1][0]-n[0][0])/2,n[0][1]+(n[1][1]-n[0][1])/2,n[0][2]+(n[1][2]-n[0][2])/2]});return e.length===1?e[0]:e};JC.exports=vZ});var iM=G((Xke,nM)=>{var wZ=Ke(),Di=Ye(),tM=rt(),rM=nt(),zf=new WeakMap,EZ=r=>{let e=zf.get(r);if(e!==void 0)return e;let t=tM.toSides(r),n=0,i=0,s=0;if(t.length>0){for(let a=0;a<t.length;a++){let l=t[a][0],u=t[a][1],c=l[0]*u[1]-l[1]*u[0];n+=c,i+=(l[0]+u[0])*c,s+=(l[1]+u[1])*c}n/=2;let o=1/(n*6);i*=o,s*=o}return e=Di.fromValues(i,s,0),zf.set(r,e),e},_Z=r=>{let e=zf.get(r);if(e!==void 0)return e;e=Di.create();let t=rM.toPolygons(r);if(t.length===0)return e;let n=0,i=Di.create();return t.forEach(s=>{let o=s.vertices;for(let a=0;a<o.length-2;a++){Di.cross(i,o[a+1],o[a+2]);let l=Di.dot(o[0],i)/6;n+=l,Di.add(i,o[0],o[a+1]),Di.add(i,i,o[a+2]);let u=Di.scale(i,i,1/4*l);Di.add(e,e,u)}}),Di.scale(e,e,1/n),zf.set(r,e),e},PZ=(...r)=>{r=wZ(r);let e=r.map(t=>tM.isA(t)?EZ(t):rM.isA(t)?_Z(t):[0,0,0]);return e.length===1?e[0]:e};nM.exports=PZ});var oM=G((Vke,sM)=>{var SZ=Ke(),IZ=to(),BZ=(...r)=>{r=SZ(r);let e=r.map(t=>{let n=IZ(t);return[n[1][0]-n[0][0],n[1][1]-n[0][1],n[1][2]-n[0][2]]});return e.length===1?e[0]:e};sM.exports=BZ});var gs=G((Wke,aM)=>{var AZ=Ke(),{geom2:TZ,geom3:CZ,path2:MZ}=Of(),Cx=Ax(),Mx=to(),NZ=r=>Cx(Mx(r),2),RZ=r=>Cx(Mx(r),2),LZ=r=>Cx(Mx(r),3),OZ=(...r)=>{if(r=AZ(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>MZ.isA(t)?NZ(t):TZ.isA(t)?RZ(t):CZ.isA(t)?LZ(t):0);return e.length===1?e[0]:e};aM.exports=OZ});var uM=G(($ke,lM)=>{lM.exports={measureAggregateArea:MC(),measureAggregateBoundingBox:qf(),measureAggregateEpsilon:FC(),measureAggregateVolume:VC(),measureArea:Bx(),measureBoundingBox:to(),measureBoundingSphere:QC(),measureCenter:eM(),measureCenterOfMass:iM(),measureDimensions:oM(),measureEpsilon:gs(),measureVolume:Tx()}});var yr=G((jke,cM)=>{var kZ=(r,e)=>Array.isArray(r)&&r.length>=e?r.every(t=>Number.isFinite(t)):!1,UZ=(r,e)=>Number.isFinite(r)&&r>e,DZ=(r,e)=>Number.isFinite(r)&&r>=e;cM.exports={isNumberArray:kZ,isGT:UZ,isGTE:DZ}});var fM=G((Hke,dM)=>{var{EPS:hM,TAU:bl}=bt(),xs=st(),GZ=kt(),{isGT:FZ,isGTE:Nx,isNumberArray:qZ}=yr(),zZ=r=>{let e={center:[0,0],radius:1,startAngle:0,endAngle:bl,makeTangent:!1,segments:32},{center:t,radius:n,startAngle:i,endAngle:s,makeTangent:o,segments:a}=Object.assign({},e,r);if(!qZ(t,2))throw new Error("center must be an array of X and Y values");if(!FZ(n,0))throw new Error("radius must be greater than zero");if(!Nx(i,0))throw new Error("startAngle must be positive");if(!Nx(s,0))throw new Error("endAngle must be positive");if(!Nx(a,4))throw new Error("segments must be four or more");i=i%bl,s=s%bl;let l=bl;i<s&&(l=s-i),i>s&&(l=s+(bl-i));let u=Math.acos((n*n+n*n-hM*hM)/(2*n*n)),c=xs.clone(t),h,f=[];if(l<u)h=xs.fromAngleRadians(xs.create(),i),xs.scale(h,h,n),xs.add(h,h,c),f.push(h);else{let d=Math.max(1,Math.floor(a*(l/bl)))+1,m=d*.5/l;m>.25&&(m=.25);let p=o?d+2:d;for(let g=0;g<=p;g++){let b=g;o&&(b=(g-1)*(d-2*m)/d+m,b<0&&(b=0),b>d&&(b=d));let v=i+b*(l/d);h=xs.fromAngleRadians(xs.create(),v),xs.scale(h,h,n),xs.add(h,h,c),f.push(h)}}return GZ.fromPoints({closed:!1},f)};dM.exports=zZ});var Ox=G((Zke,gM)=>{var{EPS:pM,TAU:ro}=bt(),Rx=st(),YZ=rt(),{sin:XZ,cos:VZ}=Mr(),{isGTE:Lx,isNumberArray:mM}=yr(),WZ=r=>{let e={center:[0,0],radius:[1,1],startAngle:0,endAngle:ro,segments:32},{center:t,radius:n,startAngle:i,endAngle:s,segments:o}=Object.assign({},e,r);if(!mM(t,2))throw new Error("center must be an array of X and Y values");if(!mM(n,2))throw new Error("radius must be an array of X and Y values");if(!n.every(d=>d>0))throw new Error("radius values must be greater than zero");if(!Lx(i,0))throw new Error("startAngle must be positive");if(!Lx(s,0))throw new Error("endAngle must be positive");if(!Lx(o,3))throw new Error("segments must be three or more");i=i%ro,s=s%ro;let a=ro;i<s&&(a=s-i),i>s&&(a=s+(ro-i));let l=Math.min(n[0],n[1]),u=Math.acos((l*l+l*l-pM*pM)/(2*l*l));if(a<u)throw new Error("startAngle and endAngle do not define a significant rotation");o=Math.floor(o*(a/ro));let c=Rx.clone(t),h=a/o,f=[];o=a<ro?o+1:o;for(let d=0;d<o;d++){let m=h*d+i,p=Rx.fromValues(n[0]*VZ(m),n[1]*XZ(m));Rx.add(p,c,p),f.push(p)}return a<ro&&f.push(c),YZ.fromPoints(f)};gM.exports=WZ});var kx=G((Kke,xM)=>{var{TAU:$Z}=bt(),jZ=Ox(),{isGT:HZ}=yr(),ZZ=r=>{let e={center:[0,0],radius:1,startAngle:0,endAngle:$Z,segments:32},{center:t,radius:n,startAngle:i,endAngle:s,segments:o}=Object.assign({},e,r);if(!HZ(n,0))throw new Error("radius must be greater than zero");return n=[n,n],jZ({center:t,radius:n,startAngle:i,endAngle:s,segments:o})};xM.exports=ZZ});var Ux=G((Qke,yM)=>{var KZ=nt(),QZ=xt(),{isNumberArray:bM}=yr(),JZ=r=>{let e={center:[0,0,0],size:[2,2,2]},{center:t,size:n}=Object.assign({},e,r);if(!bM(t,3))throw new Error("center must be an array of X, Y and Z values");if(!bM(n,3))throw new Error("size must be an array of width, depth and height values");if(!n.every(s=>s>0))throw new Error("size values must be greater than zero");return KZ.create([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(s=>{let o=s[0].map(a=>[t[0]+n[0]/2*(2*!!(a&1)-1),t[1]+n[1]/2*(2*!!(a&2)-1),t[2]+n[2]/2*(2*!!(a&4)-1)]);return QZ.create(o)}))};yM.exports=JZ});var wM=G((Jke,vM)=>{var eK=Ux(),{isGT:tK}=yr(),rK=r=>{let e={center:[0,0,0],size:2},{center:t,size:n}=Object.assign({},e,r);if(!tK(n,0))throw new Error("size must be greater than zero");return n=[n,n,n],eK({center:t,size:n})};vM.exports=rK});var Fx=G((eUe,_M)=>{var{EPS:EM,TAU:no}=bt(),Nr=Ye(),nK=nt(),iK=xt(),{sin:sK,cos:oK}=Mr(),{isGT:aK,isGTE:Dx,isNumberArray:Gx}=yr(),lK=r=>{let e={center:[0,0,0],height:2,startRadius:[1,1],startAngle:0,endRadius:[1,1],endAngle:no,segments:32},{center:t,height:n,startRadius:i,startAngle:s,endRadius:o,endAngle:a,segments:l}=Object.assign({},e,r);if(!Gx(t,3))throw new Error("center must be an array of X, Y and Z values");if(!aK(n,0))throw new Error("height must be greater then zero");if(!Gx(i,2))throw new Error("startRadius must be an array of X and Y values");if(!i.every(N=>N>=0))throw new Error("startRadius values must be positive");if(!Gx(o,2))throw new Error("endRadius must be an array of X and Y values");if(!o.every(N=>N>=0))throw new Error("endRadius values must be positive");if(o.every(N=>N===0)&&i.every(N=>N===0))throw new Error("at least one radius must be positive");if(!Dx(s,0))throw new Error("startAngle must be positive");if(!Dx(a,0))throw new Error("endAngle must be positive");if(!Dx(l,4))throw new Error("segments must be four or more");s=s%no,a=a%no;let u=no;s<a&&(u=a-s),s>a&&(u=a+(no-s));let c=Math.min(i[0],i[1],o[0],o[1]),h=Math.acos((c*c+c*c-EM*EM)/(2*c*c));if(u<h)throw new Error("startAngle and endAngle do not define a significant rotation");let f=Math.floor(l*(u/no)),d=Nr.fromValues(0,0,-(n/2)),m=Nr.fromValues(0,0,n/2),p=Nr.subtract(Nr.create(),m,d),g=Nr.fromValues(1,0,0),b=Nr.fromValues(0,1,0),v=Nr.create(),w=Nr.create(),P=Nr.create(),_=(N,A,M)=>{let S=A*u+s;return Nr.scale(v,g,M[0]*oK(S)),Nr.scale(w,b,M[1]*sK(S)),Nr.add(v,v,w),Nr.scale(P,p,N),Nr.add(P,P,d),Nr.add(Nr.create(),v,P)},B=(...N)=>{let A=N.map(M=>Nr.add(Nr.create(),M,t));return iK.create(A)},I=[];for(let N=0;N<f;N++){let A=N/f,M=(N+1)/f;u===no&&N===f-1&&(M=0),o[0]===i[0]&&o[1]===i[1]?(I.push(B(d,_(0,M,o),_(0,A,o))),I.push(B(_(0,M,o),_(1,M,o),_(1,A,o),_(0,A,o))),I.push(B(m,_(1,A,o),_(1,M,o)))):(i[0]>0&&i[1]>0&&I.push(B(d,_(0,M,i),_(0,A,i))),(i[0]>0||i[1]>0)&&I.push(B(_(0,A,i),_(0,M,i),_(1,A,o))),o[0]>0&&o[1]>0&&I.push(B(m,_(1,A,o),_(1,M,o))),(o[0]>0||o[1]>0)&&I.push(B(_(1,A,o),_(0,M,i),_(1,M,o))))}return u<no&&(I.push(B(d,_(0,0,i),m)),I.push(B(_(0,0,i),_(1,0,o),m)),I.push(B(d,m,_(0,1,i))),I.push(B(_(0,1,i),m,_(1,1,o)))),nK.create(I)};_M.exports=lK});var SM=G((tUe,PM)=>{var uK=Fx(),{isGT:cK}=yr(),hK=r=>{let e={center:[0,0,0],height:2,radius:1,segments:32},{center:t,height:n,radius:i,segments:s}=Object.assign({},e,r);if(!cK(i,0))throw new Error("radius must be greater than zero");return uK({center:t,height:n,startRadius:[i,i],endRadius:[i,i],segments:s})};PM.exports=hK});var qx=G((rUe,MM)=>{var{TAU:IM}=bt(),je=Ye(),dK=nt(),BM=xt(),{sin:AM,cos:TM}=Mr(),{isGTE:fK,isNumberArray:CM}=yr(),pK=r=>{let e={center:[0,0,0],radius:[1,1,1],segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]},{center:t,radius:n,segments:i,axes:s}=Object.assign({},e,r);if(!CM(t,3))throw new Error("center must be an array of X, Y and Z values");if(!CM(n,3))throw new Error("radius must be an array of X, Y and Z values");if(!n.every(m=>m>0))throw new Error("radius values must be greater than zero");if(!fK(i,4))throw new Error("segments must be four or more");let o=je.scale(je.create(),je.normalize(je.create(),s[0]),n[0]),a=je.scale(je.create(),je.normalize(je.create(),s[1]),n[1]),l=je.scale(je.create(),je.normalize(je.create(),s[2]),n[2]),u=Math.round(i/4),c,h=[],f=je.create(),d=je.create();for(let m=0;m<=i;m++){let p=IM*m/i,g=je.add(je.create(),je.scale(f,o,TM(p)),je.scale(d,a,AM(p)));if(m>0){let b,v;for(let w=0;w<=u;w++){let P=IM/4*w/u,_=TM(P),B=AM(P);if(w>0){let I=[],C;C=je.subtract(je.create(),je.scale(f,c,b),je.scale(d,l,v)),I.push(je.add(C,C,t)),C=je.subtract(je.create(),je.scale(f,g,b),je.scale(d,l,v)),I.push(je.add(C,C,t)),w<u&&(C=je.subtract(je.create(),je.scale(f,g,_),je.scale(d,l,B)),I.push(je.add(C,C,t))),C=je.subtract(je.create(),je.scale(f,c,_),je.scale(d,l,B)),I.push(je.add(C,C,t)),h.push(BM.create(I)),I=[],C=je.add(je.create(),je.scale(f,c,b),je.scale(d,l,v)),I.push(je.add(je.create(),t,C)),C=je.add(C,je.scale(f,g,b),je.scale(d,l,v)),I.push(je.add(je.create(),t,C)),w<u&&(C=je.add(C,je.scale(f,g,_),je.scale(d,l,B)),I.push(je.add(je.create(),t,C))),C=je.add(C,je.scale(f,c,_),je.scale(d,l,B)),I.push(je.add(je.create(),t,C)),I.reverse(),h.push(BM.create(I))}b=_,v=B}}c=g}return dK.create(h)};MM.exports=pK});var zx=G((nUe,RM)=>{var mK=nt(),gK=xt(),{isNumberArray:NM}=yr(),xK=r=>{let e={points:[],faces:[],colors:void 0,orientation:"outward"},{points:t,faces:n,colors:i,orientation:s}=Object.assign({},e,r);if(!(Array.isArray(t)&&Array.isArray(n)))throw new Error("points and faces must be arrays");if(t.length<3)throw new Error("three or more points are required");if(n.length<1)throw new Error("one or more faces are required");if(i){if(!Array.isArray(i))throw new Error("colors must be an array");if(i.length!==n.length)throw new Error("faces and colors must have the same length")}t.forEach((a,l)=>{if(!NM(a,3))throw new Error(`point ${l} must be an array of X, Y, Z values`)}),n.forEach((a,l)=>{if(a.length<3)throw new Error(`face ${l} must contain 3 or more indexes`);if(!NM(a,a.length))throw new Error(`face ${l} must be an array of numbers`)}),s!=="outward"&&n.forEach(a=>a.reverse());let o=n.map((a,l)=>{let u=gK.create(a.map(c=>t[c]));return i&&i[l]&&(u.color=i[l]),u});return mK.create(o)};RM.exports=xK});var UM=G((iUe,kM)=>{var LM=Gt(),OM=Ye(),bK=nt(),yK=zx(),{isGT:vK,isGTE:wK}=yr(),EK=r=>{let e={radius:1,frequency:6},{radius:t,frequency:n}=Object.assign({},e,r);if(!vK(t,0))throw new Error("radius must be greater than zero");if(!wK(n,6))throw new Error("frequency must be six or more");n=Math.floor(n/6);let i=[[.850651,0,-.525731],[.850651,-0,.525731],[-.850651,-0,.525731],[-.850651,0,-.525731],[0,-.525731,.850651],[0,.525731,.850651],[0,.525731,-.850651],[0,-.525731,-.850651],[-.525731,-.850651,-0],[.525731,-.850651,-0],[.525731,.850651,0],[-.525731,.850651,0]],s=[[0,9,1],[1,10,0],[6,7,0],[10,6,0],[7,9,0],[5,1,4],[4,1,9],[5,10,1],[2,8,3],[3,11,2],[2,5,4],[4,8,2],[2,11,5],[3,7,6],[6,11,3],[8,7,3],[9,8,4],[11,10,5],[10,11,6],[8,9,7]],o=(f,d,m)=>{let p=f[0],g=f[1],b=f[2],v=m,w=[],P=[];for(let _=0;_<d;_++)for(let B=0;B<d-_;B++){let I=_/d,C=(_+1)/d,N=B/(d-_),A=(B+1)/(d-_),M=d-_-1?B/(d-_-1):1,S=[];S[0]=a(a(p,g,N),b,I),S[1]=a(a(p,g,A),b,I),S[2]=a(a(p,g,M),b,C);for(let $=0;$<3;$++){let H=OM.length(S[$]);for(let K=0;K<3;K++)S[$][K]/=H}if(w.push(S[0],S[1],S[2]),P.push([v,v+1,v+2]),v+=3,B<d-_-1){let $=d-_-1?(B+1)/(d-_-1):1;S[0]=a(a(p,g,A),b,I),S[1]=a(a(p,g,$),b,C),S[2]=a(a(p,g,M),b,C);for(let H=0;H<3;H++){let K=OM.length(S[H]);for(let F=0;F<3;F++)S[H][F]/=K}w.push(S[0],S[1],S[2]),P.push([v,v+1,v+2]),v+=3}}return{points:w,triangles:P,offset:v}},a=(f,d,m)=>{let p=1-m,g=[];for(let b=0;b<3;b++)g[b]=f[b]*p+d[b]*m;return g},l=[],u=[],c=0;for(let f=0;f<s.length;f++){let d=o([i[s[f][0]],i[s[f][1]],i[s[f][2]]],n,c);l=l.concat(d.points),u=u.concat(d.triangles),c=d.offset}let h=yK({points:l,faces:u,orientation:"inward"});return t!==1&&(h=bK.transform(LM.fromScaling(LM.create(),[t,t,t]),h)),h};kM.exports=EK});var GM=G((sUe,DM)=>{var _K=kt(),PK=r=>{if(!Array.isArray(r))throw new Error("points must be an array");return _K.fromPoints({},r)};DM.exports=PK});var qM=G((oUe,FM)=>{var Yx=rt(),SK=r=>{let e={points:[],paths:[]},{points:t,paths:n}=Object.assign({},e,r);if(!(Array.isArray(t)&&Array.isArray(n)))throw new Error("points and paths must be arrays");let i=t;Array.isArray(t[0])&&(Array.isArray(t[0][0])||(i=[t])),i.forEach((l,u)=>{if(!Array.isArray(l))throw new Error("list of points "+u+" must be an array");if(l.length<3)throw new Error("list of points "+u+" must contain three or more points");l.forEach((c,h)=>{if(!Array.isArray(c))throw new Error("list of points "+u+", point "+h+" must be an array");if(c.length<2)throw new Error("list of points "+u+", point "+h+" must contain by X and Y values")})});let s=n;if(n.length===0){let l=0;s=i.map(u=>u.map(c=>l++))}let o=[];i.forEach(l=>l.forEach(u=>o.push(u)));let a=[];return s.forEach(l=>{let u=l.map(h=>o[h]),c=Yx.fromPoints(u);a=a.concat(Yx.toSides(c))}),Yx.create(a)};FM.exports=SK});var Xx=G((aUe,YM)=>{var io=st(),IK=rt(),{isNumberArray:zM}=yr(),BK=r=>{let e={center:[0,0],size:[2,2]},{center:t,size:n}=Object.assign({},e,r);if(!zM(t,2))throw new Error("center must be an array of X and Y values");if(!zM(n,2))throw new Error("size must be an array of X and Y values");if(!n.every(a=>a>0))throw new Error("size values must be greater than zero");let i=[n[0]/2,n[1]/2],s=[i[0],-i[1]],o=[io.subtract(io.create(),t,i),io.add(io.create(),t,s),io.add(io.create(),t,i),io.subtract(io.create(),t,s)];return IK.fromPoints(o)};YM.exports=BK});var HM=G((lUe,jM)=>{var{EPS:Yf,TAU:oc}=bt(),Vx=st(),dr=Ye(),AK=nt(),yl=xt(),{sin:TK,cos:CK}=Mr(),{isGT:MK,isGTE:NK,isNumberArray:XM}=yr(),VM=(r,e,t,n,i,s)=>{let o=oc/4*i/n,a=CK(o),l=TK(o),u=n-i,c=t*a,h=e[2]-(t-t*l);s||(h=t-t*l-e[2]),c=c>Yf?c:0;let f=dr.add(dr.create(),r,[e[0]-t,e[1]-t,h]),d=dr.add(dr.create(),r,[t-e[0],e[1]-t,h]),m=dr.add(dr.create(),r,[t-e[0],t-e[1],h]),p=dr.add(dr.create(),r,[e[0]-t,t-e[1],h]),g=[],b=[],v=[],w=[];for(let P=0;P<=u;P++){let _=u>0?oc/4*P/u:0,B=Vx.fromAngleRadians(Vx.create(),_);Vx.scale(B,B,c);let I=dr.fromVec2(dr.create(),B);g.push(dr.add(dr.create(),f,I)),dr.rotateZ(I,I,[0,0,0],oc/4),b.push(dr.add(dr.create(),d,I)),dr.rotateZ(I,I,[0,0,0],oc/4),v.push(dr.add(dr.create(),m,I)),dr.rotateZ(I,I,[0,0,0],oc/4),w.push(dr.add(dr.create(),p,I))}return s?[g,b,v,w]:(g.reverse(),b.reverse(),v.reverse(),w.reverse(),[w,v,b,g])},WM=(r,e)=>{let t=[];for(let n=0;n<r.length;n++){let i=r[n],s=e[n];for(let o=0;o<i.length-1;o++)t.push(yl.create([i[o],i[o+1],s[o]])),o<s.length-1&&t.push(yl.create([s[o],i[o+1],s[o+1]]))}return t},$M=(r,e)=>{let t=[];for(let n=0;n<r.length;n++){let i=r[n],s=e[n],o=i[i.length-1],a=s[s.length-1],l=(n+1)%r.length;i=r[l],s=e[l];let u=i[0],c=s[0];t.push(yl.create([o,u,c,a]))}return t},RK=(r,e)=>{r=[r[3],r[2],r[1],r[0]],r=r.map(s=>s.slice().reverse());let t=[];r.forEach(s=>{s.forEach(o=>t.push(o))});let n=[];e.forEach(s=>{s.forEach(o=>n.push(o))});let i=[];for(let s=0;s<n.length;s++){let o=(s+1)%n.length;i.push(yl.create([t[s],t[o],n[o],n[s]]))}return i},LK=r=>{let e={center:[0,0,0],size:[2,2,2],roundRadius:.2,segments:32},{center:t,size:n,roundRadius:i,segments:s}=Object.assign({},e,r);if(!XM(t,3))throw new Error("center must be an array of X, Y and Z values");if(!XM(n,3))throw new Error("size must be an array of X, Y and Z values");if(!n.every(u=>u>0))throw new Error("size values must be greater than zero");if(!MK(i,0))throw new Error("roundRadius must be greater than zero");if(!NK(s,4))throw new Error("segments must be four or more");if(n=n.map(u=>u/2),i>n[0]-Yf||i>n[1]-Yf||i>n[2]-Yf)throw new Error("roundRadius must be smaller then the radius of all dimensions");s=Math.floor(s/4);let o=null,a=null,l=[];for(let u=0;u<=s;u++){let c=VM(t,n,i,s,u,!0),h=VM(t,n,i,s,u,!1);if(u===0&&(l=l.concat(RK(h,c))),o&&(l=l.concat(WM(o,c),$M(o,c))),a&&(l=l.concat(WM(a,h),$M(a,h))),u===s){let f=c.map(d=>d[0]);l.push(yl.create(f)),f=h.map(d=>d[0]),l.push(yl.create(f))}o=c,a=h}return AK.create(l)};jM.exports=LK});var t5=G((uUe,e5)=>{var{EPS:ZM,TAU:KM}=bt(),Re=Ye(),OK=nt(),kK=xt(),{sin:QM,cos:JM}=Mr(),{isGT:Wx,isGTE:UK,isNumberArray:DK}=yr(),GK=r=>{let e={center:[0,0,0],height:2,radius:1,roundRadius:.2,segments:32},{center:t,height:n,radius:i,roundRadius:s,segments:o}=Object.assign({},e,r);if(!DK(t,3))throw new Error("center must be an array of X, Y and Z values");if(!Wx(n,0))throw new Error("height must be greater then zero");if(!Wx(i,0))throw new Error("radius must be greater then zero");if(!Wx(s,0))throw new Error("roundRadius must be greater then zero");if(s>i-ZM)throw new Error("roundRadius must be smaller then the radius");if(!UK(o,4))throw new Error("segments must be four or more");let a=[0,0,-(n/2)],l=[0,0,n/2],u=Re.subtract(Re.create(),l,a),c=Re.length(u);if(2*s>c-ZM)throw new Error("height must be larger than twice roundRadius");let h;Math.abs(u[0])>Math.abs(u[1])?h=Re.fromValues(0,1,0):h=Re.fromValues(1,0,0);let f=Re.scale(Re.create(),Re.normalize(Re.create(),u),s),d=Re.scale(Re.create(),Re.normalize(Re.create(),Re.cross(Re.create(),f,h)),i),m=Re.scale(Re.create(),Re.normalize(Re.create(),Re.cross(Re.create(),d,f)),i);Re.add(a,a,f),Re.subtract(l,l,f);let p=Math.floor(.25*o),g=B=>{let I=B.map(C=>Re.add(C,C,t));return kK.create(I)},b=[],v=Re.create(),w=Re.create(),P;for(let B=0;B<=o;B++){let I=KM*B/o,C=Re.add(Re.create(),Re.scale(v,d,JM(I)),Re.scale(w,m,QM(I)));if(B>0){let N=[];N.push(Re.add(Re.create(),a,C)),N.push(Re.add(Re.create(),a,P)),N.push(Re.add(Re.create(),l,P)),N.push(Re.add(Re.create(),l,C)),b.push(g(N));let A,M;for(let S=0;S<=p;S++){let $=KM/4*S/p,H=JM($),K=QM($);if(S>0){N=[];let F;F=Re.add(Re.create(),a,Re.subtract(v,Re.scale(v,P,A),Re.scale(w,f,M))),N.push(F),F=Re.add(Re.create(),a,Re.subtract(v,Re.scale(v,C,A),Re.scale(w,f,M))),N.push(F),S<p&&(F=Re.add(Re.create(),a,Re.subtract(v,Re.scale(v,C,H),Re.scale(w,f,K))),N.push(F)),F=Re.add(Re.create(),a,Re.subtract(v,Re.scale(v,P,H),Re.scale(w,f,K))),N.push(F),b.push(g(N)),N=[],F=Re.add(Re.create(),Re.scale(v,P,A),Re.scale(w,f,M)),Re.add(F,F,l),N.push(F),F=Re.add(Re.create(),Re.scale(v,C,A),Re.scale(w,f,M)),Re.add(F,F,l),N.push(F),S<p&&(F=Re.add(Re.create(),Re.scale(v,C,H),Re.scale(w,f,K)),Re.add(F,F,l),N.push(F)),F=Re.add(Re.create(),Re.scale(v,P,H),Re.scale(w,f,K)),Re.add(F,F,l),N.push(F),N.reverse(),b.push(g(N))}A=H,M=K}}P=C}return OK.create(b)};e5.exports=GK});var s5=G((cUe,i5)=>{var{EPS:r5,TAU:Xf}=bt(),$t=st(),FK=rt(),{isGT:qK,isGTE:zK,isNumberArray:n5}=yr(),YK=r=>{let e={center:[0,0],size:[2,2],roundRadius:.2,segments:32},{center:t,size:n,roundRadius:i,segments:s}=Object.assign({},e,r);if(!n5(t,2))throw new Error("center must be an array of X and Y values");if(!n5(n,2))throw new Error("size must be an array of X and Y values");if(!n.every(p=>p>0))throw new Error("size values must be greater than zero");if(!qK(i,0))throw new Error("roundRadius must be greater than zero");if(!zK(s,4))throw new Error("segments must be four or more");if(n=n.map(p=>p/2),i>n[0]-r5||i>n[1]-r5)throw new Error("roundRadius must be smaller then the radius of all dimensions");let o=Math.floor(s/4),a=$t.add($t.create(),t,[n[0]-i,n[1]-i]),l=$t.add($t.create(),t,[i-n[0],n[1]-i]),u=$t.add($t.create(),t,[i-n[0],i-n[1]]),c=$t.add($t.create(),t,[n[0]-i,i-n[1]]),h=[],f=[],d=[],m=[];for(let p=0;p<=o;p++){let g=Xf/4*p/o,b=$t.fromAngleRadians($t.create(),g);$t.scale(b,b,i),h.push($t.add($t.create(),a,b)),$t.rotate(b,b,$t.create(),Xf/4),f.push($t.add($t.create(),l,b)),$t.rotate(b,b,$t.create(),Xf/4),d.push($t.add($t.create(),u,b)),$t.rotate(b,b,$t.create(),Xf/4),m.push($t.add($t.create(),c,b))}return FK.fromPoints(h.concat(f,d,m))};i5.exports=YK});var $x=G((hUe,o5)=>{var XK=qx(),{isGT:VK}=yr(),WK=r=>{let e={center:[0,0,0],radius:1,segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]},{center:t,radius:n,segments:i,axes:s}=Object.assign({},e,r);if(!VK(n,0))throw new Error("radius must be greater than zero");return n=[n,n,n],XK({center:t,radius:n,segments:i,axes:s})};o5.exports=WK});var l5=G((dUe,a5)=>{var $K=Xx(),{isGT:jK}=yr(),HK=r=>{let e={center:[0,0],size:2},{center:t,size:n}=Object.assign({},e,r);if(!jK(n,0))throw new Error("size must be greater than zero");return n=[n,n],$K({center:t,size:n})};a5.exports=HK});var d5=G((fUe,h5)=>{var{TAU:u5}=bt(),ac=st(),ZK=rt(),{isGT:KK,isGTE:Vf,isNumberArray:QK}=yr(),JK=(r,e)=>r>0&&e>1&&e<r/2?Math.cos(Math.PI*e/r)/Math.cos(Math.PI*(e-1)/r):0,c5=(r,e,t,n)=>{let i=u5/r,s=[];for(let o=0;o<r;o++){let a=ac.fromAngleRadians(ac.create(),i*o+t);ac.scale(a,a,e),ac.add(a,n,a),s.push(a)}return s},eQ=r=>{let e={center:[0,0],vertices:5,outerRadius:1,innerRadius:0,density:2,startAngle:0},{center:t,vertices:n,outerRadius:i,innerRadius:s,density:o,startAngle:a}=Object.assign({},e,r);if(!QK(t,2))throw new Error("center must be an array of X and Y values");if(!Vf(n,2))throw new Error("vertices must be two or more");if(!KK(i,0))throw new Error("outerRadius must be greater than zero");if(!Vf(s,0))throw new Error("innerRadius must be greater than zero");if(!Vf(a,0))throw new Error("startAngle must be greater than zero");if(n=Math.floor(n),o=Math.floor(o),a=a%u5,s===0){if(!Vf(o,2))throw new Error("density must be two or more");s=i*JK(n,o)}let l=ac.clone(t),u=c5(n,i,a,l),c=c5(n,s,a+Math.PI/n,l),h=[];for(let f=0;f<n;f++)h.push(u[f]),h.push(c[f]);return ZK.fromPoints(h)};h5.exports=eQ});var vl=G((pUe,b5)=>{var tQ=Ke(),f5=Gt(),p5=pi(),m5=rt(),g5=nt(),x5=kt(),Wf=(r,...e)=>{let t={origin:[0,0,0],normal:[0,0,1]},{origin:n,normal:i}=Object.assign({},t,r);if(e=tQ(e),e.length===0)throw new Error("wrong number of arguments");let s=p5.fromNormalAndPoint(p5.create(),i,n);if(Number.isNaN(s[0]))throw new Error("the given origin and normal do not define a proper plane");let o=f5.mirrorByPlane(f5.create(),s),a=e.map(l=>x5.isA(l)?x5.transform(o,l):m5.isA(l)?m5.transform(o,l):g5.isA(l)?g5.transform(o,l):l);return a.length===1?a[0]:a},rQ=(...r)=>Wf({normal:[1,0,0]},r),nQ=(...r)=>Wf({normal:[0,1,0]},r),iQ=(...r)=>Wf({normal:[0,0,1]},r);b5.exports={mirror:Wf,mirrorX:rQ,mirrorY:nQ,mirrorZ:iQ}});var jx=G((mUe,v5)=>{var y5=pi(),Zo=Ye(),sQ=r=>{let e=r.edges;if(e.length<3)throw new Error("slices must have 3 or more edges to calculate a plane");let t=e.reduce((o,a)=>Zo.add(Zo.create(),o,a[0]),Zo.create());Zo.scale(t,t,1/e.length);let n,i=0;e.forEach(o=>{if(!Zo.equals(o[0],o[1])){let a=Zo.squaredDistance(t,o[0]);a>i&&(n=o,i=a)}});let s=e.find(o=>Zo.equals(o[1],n[0]));return y5.fromPoints(y5.create(),s[0],n[0],n[1])};v5.exports=sQ});var so=G((gUe,w5)=>{var oQ=r=>(r||(r=[]),{edges:r});w5.exports=oQ});var P5=G((xUe,_5)=>{var aQ=so(),E5=Ye(),lQ=(...r)=>{let e,t;return r.length===1?(e=aQ(),t=r[0]):(e=r[0],t=r[1]),e.edges=t.edges.map(n=>[E5.clone(n[0]),E5.clone(n[1])]),e};_5.exports=lQ});var I5=G((bUe,S5)=>{var uQ=Ye(),cQ=(r,e)=>{let t=r.edges,n=e.edges;return t.length!==n.length?!1:t.reduce((s,o,a)=>{let l=n[a],u=uQ.squaredDistance(o[0],l[0]);return s&&u<Number.EPSILON},!0)};S5.exports=cQ});var A5=G((yUe,B5)=>{var $f=Ye(),hQ=so(),dQ=r=>{if(!Array.isArray(r))throw new Error("the given points must be an array");if(r.length<3)throw new Error("the given points must contain THREE or more points");let e=[],t=r[r.length-1];return r.forEach(n=>{n.length===2&&e.push([$f.fromVec2($f.create(),t),$f.fromVec2($f.create(),n)]),n.length===3&&e.push([t,n]),t=n}),hQ(e)};B5.exports=dQ});var C5=G((vUe,T5)=>{var jf=Ye(),fQ=so(),pQ=r=>{if(!Array.isArray(r))throw new Error("the given sides must be an array");let e=[];return r.forEach(t=>{e.push([jf.fromVec2(jf.create(),t[0]),jf.fromVec2(jf.create(),t[1])])}),fQ(e)};T5.exports=pQ});var N5=G((wUe,M5)=>{var mQ=r=>!!(r&&typeof r=="object"&&"edges"in r&&Array.isArray(r.edges));M5.exports=mQ});var L5=G((EUe,R5)=>{var gQ=so(),xQ=(...r)=>{let e,t;return r.length===1?(e=gQ(),t=r[0]):(e=r[0],t=r[1]),e.edges=t.edges.map(n=>[n[1],n[0]]),e};R5.exports=xQ});var k5=G((_Ue,O5)=>{var bQ=r=>r.edges;O5.exports=bQ});var D5=G((PUe,U5)=>{var yQ=(r,e)=>{let t,n,i,s,o,a=1;do{n=r,r=null;let l=null;for(o=0;n;){o++,i=n;let u=0;for(t=0;t<a&&(u++,i=i.nextZ,!!i);t++);let c=a;for(;u>0||c>0&&i;)u!==0&&(c===0||!i||e(n)<=e(i))?(s=n,n=n.nextZ,u--):(s=i,i=i.nextZ,c--),l?l.nextZ=s:r=s,s.prevZ=l,l=s;n=i}l.nextZ=null,a*=2}while(o>1);return r};U5.exports=yQ});var Hx=G((SUe,G5)=>{var vQ=D5(),Hf=class{constructor(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}},wQ=(r,e,t,n)=>{let i=new Hf(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i},EQ=r=>{r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)};G5.exports={Node:Hf,insertNode:wQ,removeNode:EQ,sortLinked:vQ}});var Zf=G((IUe,F5)=>{var _Q=(r,e,t,n,i,s,o,a)=>(i-o)*(e-a)-(r-o)*(s-a)>=0&&(r-o)*(n-a)-(t-o)*(e-a)>=0&&(t-o)*(s-a)-(i-o)*(n-a)>=0,PQ=(r,e,t)=>(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y);F5.exports={area:PQ,pointInTriangle:_Q}});var Zx=G((BUe,V5)=>{var{Node:q5,insertNode:z5,removeNode:Kf}=Hx(),{area:dn}=Zf(),SQ=(r,e,t,n,i)=>{let s;if(i===MQ(r,e,t,n)>0)for(let o=e;o<t;o+=n)s=z5(o,r[o],r[o+1],s);else for(let o=t-n;o>=e;o-=n)s=z5(o,r[o],r[o+1],s);return s&&Jf(s,s.next)&&(Kf(s),s=s.next),s},Y5=(r,e)=>{if(!r)return r;e||(e=r);let t=r,n;do if(n=!1,!t.steiner&&(Jf(t,t.next)||dn(t.prev,t,t.next)===0)){if(Kf(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e},IQ=(r,e,t)=>{let n=r;do{let i=n.prev,s=n.next.next;!Jf(i,s)&&X5(i,n,n.next,s)&&lc(i,s)&&lc(s,i)&&(e.push(i.i/t),e.push(n.i/t),e.push(s.i/t),Kf(n),Kf(n.next),n=r=s),n=n.next}while(n!==r);return Y5(n)},BQ=(r,e)=>{let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&X5(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1},lc=(r,e)=>dn(r.prev,r,r.next)<0?dn(r,e,r.next)>=0&&dn(r,r.prev,e)>=0:dn(r,e,r.prev)<0||dn(r,r.next,e)<0,AQ=(r,e)=>{let t=r,n=!1,i=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n},TQ=(r,e)=>{let t=new q5(r.i,r.x,r.y),n=new q5(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n},CQ=(r,e)=>r.next.i!==e.i&&r.prev.i!==e.i&&!BQ(r,e)&&(lc(r,e)&&lc(e,r)&&AQ(r,e)&&(dn(r.prev,r,e.prev)||dn(r,e.prev,e))||Jf(r,e)&&dn(r.prev,r,r.next)>0&&dn(e.prev,e,e.next)>0),X5=(r,e,t,n)=>{let i=Math.sign(dn(r,e,t)),s=Math.sign(dn(r,e,n)),o=Math.sign(dn(t,n,r)),a=Math.sign(dn(t,n,e));return!!(i!==s&&o!==a||i===0&&Qf(r,t,e)||s===0&&Qf(r,n,e)||o===0&&Qf(t,r,n)||a===0&&Qf(t,e,n))},Qf=(r,e,t)=>e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y),MQ=(r,e,t,n)=>{let i=0;for(let s=e,o=t-n;s<t;s+=n)i+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return i},Jf=(r,e)=>r.x===e.x&&r.y===e.y;V5.exports={cureLocalIntersections:IQ,filterPoints:Y5,isValidDiagonal:CQ,linkedPolygon:SQ,locallyInside:lc,splitPolygon:TQ}});var j5=G((AUe,$5)=>{var{filterPoints:Kx,linkedPolygon:NQ,locallyInside:RQ,splitPolygon:LQ}=Zx(),{area:W5,pointInTriangle:OQ}=Zf(),kQ=(r,e,t,n)=>{let i=[];for(let s=0,o=e.length;s<o;s++){let a=e[s]*n,l=s<o-1?e[s+1]*n:r.length,u=NQ(r,a,l,n,!1);u===u.next&&(u.steiner=!0),i.push(FQ(u))}i.sort((s,o)=>s.x-o.x);for(let s=0;s<i.length;s++)t=UQ(i[s],t),t=Kx(t,t.next);return t},UQ=(r,e)=>{let t=DQ(r,e);if(!t)return e;let n=LQ(t,r),i=Kx(t,t.next);return Kx(n,n.next),e===t?i:e},DQ=(r,e)=>{let t=e,n=r.x,i=r.y,s=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){let h=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=n&&h>s){if(s=h,h===n){if(i===t.y)return t;if(i===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(n===s)return o;let a=o,l=o.x,u=o.y,c=1/0;t=o;do{if(n>=t.x&&t.x>=l&&n!==t.x&&OQ(i<u?n:s,i,l,u,i<u?s:n,i,t.x,t.y)){let h=Math.abs(i-t.y)/(n-t.x);RQ(t,r)&&(h<c||h===c&&(t.x>o.x||t.x===o.x&&GQ(o,t)))&&(o=t,c=h)}t=t.next}while(t!==a);return o},GQ=(r,e)=>W5(r.prev,r,e.prev)<0&&W5(e.next,r,r.next)<0,FQ=r=>{let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t};$5.exports=kQ});var Z5=G((TUe,H5)=>{var qQ=j5(),{removeNode:zQ,sortLinked:YQ}=Hx(),{cureLocalIntersections:XQ,filterPoints:ep,isValidDiagonal:VQ,linkedPolygon:WQ,splitPolygon:$Q}=Zx(),{area:Ko,pointInTriangle:uc}=Zf(),jQ=(r,e,t=2)=>{let n=e&&e.length,i=n?e[0]*t:r.length,s=WQ(r,0,i,t,!0),o=[];if(!s||s.next===s.prev)return o;let a,l,u,c,h;if(n&&(s=qQ(r,e,s,t)),r.length>80*t){a=u=r[0],l=c=r[1];for(let f=t;f<i;f+=t){let d=r[f],m=r[f+1];d<a&&(a=d),m<l&&(l=m),d>u&&(u=d),m>c&&(c=m)}h=Math.max(u-a,c-l),h=h!==0?1/h:0}return cc(s,o,t,a,l,h),o},cc=(r,e,t,n,i,s,o)=>{if(!r)return;!o&&s&&QQ(r,n,i,s);let a=r,l,u;for(;r.prev!==r.next;){if(l=r.prev,u=r.next,s?ZQ(r,n,i,s):HQ(r)){e.push(l.i/t),e.push(r.i/t),e.push(u.i/t),zQ(r),r=u.next,a=u.next;continue}if(r=u,r===a){o?o===1?(r=XQ(ep(r),e,t),cc(r,e,t,n,i,s,2)):o===2&&KQ(r,e,t,n,i,s):cc(ep(r),e,t,n,i,s,1);break}}},HQ=r=>{let e=r.prev,t=r,n=r.next;if(Ko(e,t,n)>=0)return!1;let i=r.next.next;for(;i!==r.prev;){if(uc(e.x,e.y,t.x,t.y,n.x,n.y,i.x,i.y)&&Ko(i.prev,i,i.next)>=0)return!1;i=i.next}return!0},ZQ=(r,e,t,n)=>{let i=r.prev,s=r,o=r.next;if(Ko(i,s,o)>=0)return!1;let a=i.x<s.x?i.x<o.x?i.x:o.x:s.x<o.x?s.x:o.x,l=i.y<s.y?i.y<o.y?i.y:o.y:s.y<o.y?s.y:o.y,u=i.x>s.x?i.x>o.x?i.x:o.x:s.x>o.x?s.x:o.x,c=i.y>s.y?i.y>o.y?i.y:o.y:s.y>o.y?s.y:o.y,h=Qx(a,l,e,t,n),f=Qx(u,c,e,t,n),d=r.prevZ,m=r.nextZ;for(;d&&d.z>=h&&m&&m.z<=f;){if(d!==r.prev&&d!==r.next&&uc(i.x,i.y,s.x,s.y,o.x,o.y,d.x,d.y)&&Ko(d.prev,d,d.next)>=0||(d=d.prevZ,m!==r.prev&&m!==r.next&&uc(i.x,i.y,s.x,s.y,o.x,o.y,m.x,m.y)&&Ko(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;d&&d.z>=h;){if(d!==r.prev&&d!==r.next&&uc(i.x,i.y,s.x,s.y,o.x,o.y,d.x,d.y)&&Ko(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;m&&m.z<=f;){if(m!==r.prev&&m!==r.next&&uc(i.x,i.y,s.x,s.y,o.x,o.y,m.x,m.y)&&Ko(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0},KQ=(r,e,t,n,i,s)=>{let o=r;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&VQ(o,a)){let l=$Q(o,a);o=ep(o,o.next),l=ep(l,l.next),cc(o,e,t,n,i,s),cc(l,e,t,n,i,s);return}a=a.next}o=o.next}while(o!==r)},QQ=(r,e,t,n)=>{let i=r;do i.z===null&&(i.z=Qx(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,YQ(i,s=>s.z)},Qx=(r,e,t,n,i)=>(r=32767*(r-t)*i,e=32767*(e-n)*i,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1);H5.exports=jQ});var Q5=G((CUe,K5)=>{var{area:JQ}=dl(),{toOutlines:eJ}=rt(),{arePointsInside:tJ}=Lf(),rJ=r=>{let e=eJ(r),t=[],n=[];e.forEach((o,a)=>{let l=JQ(o);l<0?n.push(a):l>0&&t.push(a)});let i=[],s=[];return t.forEach((o,a)=>{let l=e[o];i[a]=[],n.forEach((u,c)=>{let h=e[u];tJ([h[0]],{vertices:l})&&(i[a].push(u),s[c]||(s[c]=[]),s[c].push(a))})}),n.forEach((o,a)=>{if(s[a]&&s[a].length>1){let l=nJ(s[a],u=>i[u].length);s[a].forEach((u,c)=>{c!==l&&(i[u]=i[u].filter(h=>h!==o))})}}),i.map((o,a)=>({solid:e[t[a]],holes:o.map(l=>e[l])}))},nJ=(r,e)=>{let t,n;return r.forEach((i,s)=>{let o=e(i);(n===void 0||o<n)&&(t=s,n=o)}),t};K5.exports=rJ});var tN=G((MUe,eN)=>{var iJ=rt(),J5=pi(),sJ=st(),Ur=Ye(),oJ=jx(),aJ=Q5(),Jx=class{constructor(e){this.plane=oJ(e);let t=Ur.orthogonal(Ur.create(),this.plane),n=Ur.cross(Ur.create(),this.plane,t);this.v=Ur.normalize(n,n),this.u=Ur.cross(Ur.create(),this.v,this.plane),this.basisMap=new Map;let i=e.edges.map(o=>o.map(a=>this.to2D(a))),s=iJ.create(i);this.roots=aJ(s)}to2D(e){let t=sJ.fromValues(Ur.dot(e,this.u),Ur.dot(e,this.v));return this.basisMap.set(t,e),t}to3D(e){let t=this.basisMap.get(e);if(t)return t;{console.log("Warning: point not in original slice");let n=Ur.scale(Ur.create(),this.u,e[0]),i=Ur.scale(Ur.create(),this.v,e[1]),s=Ur.scale(Ur.create(),J5,J5[3]),o=Ur.add(n,n,s);return Ur.add(i,i,o)}}};eN.exports=Jx});var nN=G((NUe,rN)=>{var lJ=xt(),uJ=Z5(),cJ=tN(),hJ=r=>{let e=new cJ(r),t=[];return e.roots.forEach(({solid:n,holes:i})=>{let s=n.length,o=[];i.forEach((h,f)=>{o.push(s),s+=h.length});let a=[n,...i].flat(),l=a.flat(),u=h=>e.to3D(a[h]),c=uJ(l,o);for(let h=0;h<c.length;h+=3){let f=c.slice(h,h+3).map(u);t.push(lJ.fromPointsAndPlane(f,e.plane))}}),t};rN.exports=hJ});var oN=G((RUe,sN)=>{var iN=Ye(),dJ=r=>r.reduce((e,t)=>e+=`[${iN.toString(t[0])}, ${iN.toString(t[1])}], `,""),fJ=r=>`[${dJ(r.edges)}]`;sN.exports=fJ});var lN=G((LUe,aN)=>{var tp=Ye(),pJ=so(),mJ=(r,e)=>{let t=e.edges.map(n=>[tp.transform(tp.create(),n[0],r),tp.transform(tp.create(),n[1],r)]);return pJ(t)};aN.exports=mJ});var wl=G((OUe,uN)=>{uN.exports={calculatePlane:jx(),clone:P5(),create:so(),equals:I5(),fromPoints:A5(),fromSides:C5(),isA:N5(),reverse:L5(),toEdges:k5(),toPolygons:nN(),toString:oN(),transform:lN()}});var dN=G((kUe,hN)=>{var cN=Ye(),gJ=so(),xJ=r=>{if(!r.edges)return r;let e=r.edges,t=new Map,n=new Map;e=e.filter(o=>!cN.equals(o[0],o[1])),e.forEach(o=>{let a=o[0].toString(),l=o[1].toString();t.set(a,o[0]),t.set(l,o[1]),n.set(a,(n.get(a)||0)+1),n.set(l,(n.get(l)||0)-1)});let i=[],s=[];return n.forEach((o,a)=>{o<0&&i.push(a),o>0&&s.push(a)}),i.forEach(o=>{let a=t.get(o),l=1/0,u;s.forEach(c=>{let h=t.get(c),f=cN.distance(a,h);f<l&&(l=f,u=h)}),console.warn(`slice.repair: repairing vertex gap ${a} to ${u} distance ${l}`),e=e.map(c=>c[0].toString()===o?[u,c[1]]:c[1].toString()===o?[c[0],u]:c)}),gJ(e)};hN.exports=xJ});var bN=G((UUe,xN)=>{var{EPS:fN}=bt(),El=Ye(),rp=xt(),pN=wl(),e1=(r,e)=>r===e?r:r<e?e1(e,r):e===1?1:e===0?r:e1(e,r%e),bJ=(r,e)=>r*e/e1(r,e),mN=(r,e)=>{let t=r/e.length;if(t===1)return e;let n=El.fromValues(t,t,t),i=[];return e.forEach(s=>{let o=El.subtract(El.create(),s[1],s[0]);El.divide(o,o,n);let a=s[0];for(let l=1;l<=t;++l){let u=El.add(El.create(),a,o);i.push([a,u]),a=u}}),i},gN=fN*fN/2*Math.sin(Math.PI/3),yJ=(r,e)=>{let t=pN.toEdges(r),n=pN.toEdges(e);if(t.length!==n.length){let s=bJ(t.length,n.length);s!==t.length&&(t=mN(s,t)),s!==n.length&&(n=mN(s,n))}let i=[];return t.forEach((s,o)=>{let a=n[o],l=rp.create([s[0],s[1],a[1]]),u=rp.measureArea(l);Number.isFinite(u)&&u>gN&&i.push(l);let c=rp.create([s[0],a[1],a[0]]),h=rp.measureArea(c);Number.isFinite(h)&&h>gN&&i.push(c)}),i};xN.exports=yJ});var np=G((DUe,EN)=>{var yN=Gt(),vN=rt(),vJ=nt(),t1=xt(),oo=wl(),wJ=dN(),wN=bN(),EJ=(r,e,t)=>{let n=null;return vN.isA(t)&&(n=oo.fromSides(vN.toSides(t))),t1.isA(t)&&(n=oo.fromPoints(t1.toPoints(t))),r===0||r===1?oo.transform(yN.fromTranslation(yN.create(),[0,0,r]),n):null},_J=(r,e)=>{let t={numberOfSlices:2,capStart:!0,capEnd:!0,close:!1,repair:!0,callback:EJ},{numberOfSlices:n,capStart:i,capEnd:s,close:o,repair:a,callback:l}=Object.assign({},t,r);if(n<2)throw new Error("numberOfSlices must be 2 or more");a&&(e=wJ(e));let u=n-1,c=null,h=null,f=null,d=[];for(let m=0;m<n;m++){let p=l(m/u,m,e);if(p){if(!oo.isA(p))throw new Error("the callback function must return slice objects");if(oo.toEdges(p).length===0)throw new Error("the callback function must return slices with one or more edges");f&&(d=d.concat(wN(f,p))),m===0&&(c=p),m===n-1&&(h=p),f=p}}if(s){let m=oo.toPolygons(h);d=d.concat(m)}if(i){let m=oo.toPolygons(c).map(t1.invert);d=d.concat(m)}return!i&&!s&&o&&!oo.equals(h,c)&&(d=d.concat(wN(h,c))),vJ.create(d)};EN.exports=_J});var n1=G((GUe,_N)=>{var{TAU:An}=bt(),hc=Gt(),{mirrorX:PJ}=vl(),dc=rt(),r1=wl(),SJ=np(),IJ=(r,e)=>{let t={segments:12,startAngle:0,angle:An,overflow:"cap"},{segments:n,startAngle:i,angle:s,overflow:o}=Object.assign({},t,r);if(n<3)throw new Error("segments must be greater then 3");i=Math.abs(i)>An?i%An:i,s=Math.abs(s)>An?s%An:s;let a=i+s;if(a=Math.abs(a)>An?a%An:a,a<i){let v=i;i=a,a=v}let l=a-i;if(l<=0&&(l=An),Math.abs(l)<An){let v=An/n;n=Math.floor(Math.abs(l)/v),Math.abs(l)>n*v&&n++}let u=dc.toSides(e);if(u.length===0)throw new Error("the given geometry cannot be empty");let c=u.filter(v=>v[0][0]<0),h=u.filter(v=>v[0][0]>=0);c.length>0&&h.length>0&&o==="cap"&&(c.length>h.length?(u=u.map(v=>{let w=v[0],P=v[1];return w=[Math.min(w[0],0),w[1]],P=[Math.min(P[0],0),P[1]],[w,P]}),e=dc.reverse(dc.create(u)),e=PJ(e)):h.length>=c.length&&(u=u.map(v=>{let w=v[0],P=v[1];return w=[Math.max(w[0],0),w[1]],P=[Math.max(P[0],0),P[1]],[w,P]}),e=dc.create(u)));let d=l/n,m=Math.abs(l)<An,p=r1.fromSides(dc.toSides(e));r1.reverse(p,p);let g=hc.create(),b=(v,w,P)=>{let _=d*w+i;return l===An&&w===n&&(_=i),hc.multiply(g,hc.fromZRotation(g,_),hc.fromXRotation(hc.create(),An/4)),r1.transform(g,P)};return r={numberOfSlices:n+1,capStart:m,capEnd:m,close:!m,callback:b},SJ(r,p)};_N.exports=IJ});var _l=G((FUe,AN)=>{var BJ=Ke(),PN=Gt(),SN=rt(),IN=nt(),BN=kt(),ip=(r,...e)=>{if(!Array.isArray(r))throw new Error("angles must be an array");if(e=BJ(e),e.length===0)throw new Error("wrong number of arguments");for(r=r.slice();r.length<3;)r.push(0);let t=r[2],n=r[1],i=r[0],s=PN.fromTaitBryanRotation(PN.create(),t,n,i),o=e.map(a=>BN.isA(a)?BN.transform(s,a):SN.isA(a)?SN.transform(s,a):IN.isA(a)?IN.transform(s,a):a);return o.length===1?o[0]:o},AJ=(r,...e)=>ip([r,0,0],e),TJ=(r,...e)=>ip([0,r,0],e),CJ=(r,...e)=>ip([0,0,r],e);AN.exports={rotate:ip,rotateX:AJ,rotateY:TJ,rotateZ:CJ}});var ao=G((qUe,RN)=>{var MJ=Ke(),TN=Gt(),CN=rt(),MN=nt(),NN=kt(),sp=(r,...e)=>{if(!Array.isArray(r))throw new Error("offset must be an array");if(e=MJ(e),e.length===0)throw new Error("wrong number of arguments");for(r=r.slice();r.length<3;)r.push(0);let t=TN.fromTranslation(TN.create(),r),n=e.map(i=>NN.isA(i)?NN.transform(t,i):CN.isA(i)?CN.transform(t,i):MN.isA(i)?MN.transform(t,i):i);return n.length===1?n[0]:n},NJ=(r,...e)=>sp([r,0,0],e),RJ=(r,...e)=>sp([0,r,0],e),LJ=(r,...e)=>sp([0,0,r],e);RN.exports={translate:sp,translateX:NJ,translateY:RJ,translateZ:LJ}});var ON=G((zUe,LN)=>{var{TAU:OJ}=bt(),kJ=n1(),{rotate:UJ}=_l(),{translate:DJ}=ao(),GJ=kx(),{isGT:i1,isGTE:s1}=yr(),FJ=r=>{let e={innerRadius:1,innerSegments:32,outerRadius:4,outerSegments:32,innerRotation:0,startAngle:0,outerRotation:OJ},{innerRadius:t,innerSegments:n,outerRadius:i,outerSegments:s,innerRotation:o,startAngle:a,outerRotation:l}=Object.assign({},e,r);if(!i1(t,0))throw new Error("innerRadius must be greater than zero");if(!s1(n,3))throw new Error("innerSegments must be three or more");if(!i1(i,0))throw new Error("outerRadius must be greater than zero");if(!s1(s,3))throw new Error("outerSegments must be three or more");if(!s1(a,0))throw new Error("startAngle must be positive");if(!i1(l,0))throw new Error("outerRotation must be greater than zero");if(t>=i)throw new Error("inner circle is two large to rotate about the outer circle");let u=GJ({radius:t,segments:n});return o!==0&&(u=UJ([0,0,o],u)),u=DJ([i,0],u),kJ({startAngle:a,angle:l,segments:s},u)};LN.exports=FJ});var UN=G((YUe,kN)=>{var{NEPS:Pl}=bt(),fc=st(),qJ=rt(),{isNumberArray:zJ}=yr(),o1=(r,e,t)=>Math.acos((r*r+e*e-t*t)/(2*r*e)),YJ=(r,e,t)=>e>Pl?Math.sqrt(r*r+t*t-2*r*t*Math.cos(e)):Math.sqrt((r-t)*(r-t)+r*t*e*e*(1-e*e/12)),XJ=r=>{if(Math.abs(r[0]+r[1]+r[2]-Math.PI)>Pl)throw new Error("AAA triangles require angles that sum to PI");let t=r[0],n=r[1],i=Math.PI-t-n,s=1,o=s/Math.sin(i)*Math.sin(t),a=s/Math.sin(i)*Math.sin(n);return Sl(t,n,i,o,a,s)},VJ=r=>{let e=r[0],t=r[1],n=Math.PI+Pl-e-t;if(n<Pl)throw new Error("AAS triangles require angles that sum to PI");let i=r[2],s=i/Math.sin(e)*Math.sin(t),o=i/Math.sin(e)*Math.sin(n);return Sl(e,t,n,i,s,o)},WJ=r=>{let e=r[0],t=r[2],n=Math.PI+Pl-e-t;if(n<Pl)throw new Error("ASA triangles require angles that sum to PI");let i=r[1],s=i/Math.sin(n)*Math.sin(e),o=i/Math.sin(n)*Math.sin(t);return Sl(e,t,n,s,o,i)},$J=r=>{let e=r[0],t=r[1],n=r[2],i=YJ(e,t,n),s=o1(i,e,n),o=Math.PI-s-t;return Sl(s,t,o,n,i,e)},jJ=r=>{let e=r[0],t=r[1],n=r[2],i=Math.asin(t*Math.sin(n)/e),s=Math.PI-i-n,o=e/Math.sin(n)*Math.sin(s);return Sl(i,s,n,t,o,e)},HJ=r=>{let e=r[1],t=r[2],n=r[0];if(e+t<=n||t+n<=e||n+e<=t)throw new Error("SSS triangle is incorrect, as the longest side is longer than the sum of the other sides");let i=o1(t,n,e),s=o1(n,e,t),o=Math.PI-i-s;return Sl(i,s,o,e,t,n)},Sl=(r,e,t,n,i,s)=>{let o=fc.fromValues(0,0),a=fc.fromValues(s,0),l=fc.fromValues(n,0);return fc.add(l,fc.rotate(l,l,[0,0],Math.PI-e),a),qJ.fromPoints([o,a,l])},ZJ=r=>{let e={type:"SSS",values:[1,1,1]},{type:t,values:n}=Object.assign({},e,r);if(typeof t!="string")throw new Error("triangle type must be a string");if(t=t.toUpperCase(),!((t[0]==="A"||t[0]==="S")&&(t[1]==="A"||t[1]==="S")&&(t[2]==="A"||t[2]==="S")))throw new Error("triangle type must contain three letters; A or S");if(!zJ(n,3))throw new Error("triangle values must contain three values");if(!n.every(i=>i>0))throw new Error("triangle values must be greater than zero");switch(t){case"AAA":return XJ(n);case"AAS":return VJ(n);case"ASA":return WJ(n);case"SAS":return $J(n);case"SSA":return jJ(n);case"SSS":return HJ(n);default:throw new Error("invalid triangle type, try again")}};kN.exports=ZJ});var GN=G((XUe,DN)=>{DN.exports={arc:fM(),circle:kx(),cube:wM(),cuboid:Ux(),cylinder:SM(),cylinderElliptic:Fx(),ellipse:Ox(),ellipsoid:qx(),geodesicSphere:UM(),line:GM(),polygon:qM(),polyhedron:zx(),rectangle:Xx(),roundedCuboid:HM(),roundedCylinder:t5(),roundedRectangle:s5(),sphere:$x(),square:l5(),star:d5(),torus:ON(),triangle:UN()}});var qN=G((VUe,FN)=>{FN.exports={height:14,32:[16],33:[10,5,21,5,7,void 0,5,2,4,1,5,0,6,1,5,2],34:[16,4,21,4,14,void 0,12,21,12,14],35:[21,11,25,4,-7,void 0,17,25,10,-7,void 0,4,12,18,12,void 0,3,6,17,6],36:[20,8,25,8,-4,void 0,12,25,12,-4,void 0,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],37:[24,21,21,3,0,void 0,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,void 0,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7],38:[26,23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2],39:[10,5,19,4,20,5,21,6,20,6,18,5,16,4,15],40:[14,11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7],41:[14,3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7],42:[16,8,21,8,9,void 0,3,18,13,12,void 0,13,18,3,12],43:[26,13,18,13,0,void 0,4,9,22,9],44:[10,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],45:[26,4,9,22,9],46:[10,5,2,4,1,5,0,6,1,5,2],47:[22,20,25,2,-7],48:[20,9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21],49:[20,6,17,8,18,11,21,11,0],50:[20,4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0],51:[20,5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],52:[20,13,21,3,7,18,7,void 0,13,21,13,0],53:[20,15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],54:[20,16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7],55:[20,17,21,7,0,void 0,3,21,17,21],56:[20,8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21],57:[20,16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3],58:[10,5,14,4,13,5,12,6,13,5,14,void 0,5,2,4,1,5,0,6,1,5,2],59:[10,5,14,4,13,5,12,6,13,5,14,void 0,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],60:[24,20,18,4,9,20,0],61:[26,4,12,22,12,void 0,4,6,22,6],62:[24,4,18,20,9,4,0],63:[18,3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,void 0,9,2,8,1,9,0,10,1,9,2],64:[27,18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,void 0,12,16,10,14,9,11,9,8,10,6,11,5,void 0,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,void 0,19,16,18,8,18,6,19,5],65:[18,9,21,1,0,void 0,9,21,17,0,void 0,4,7,14,7],66:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,void 0,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0],67:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5],68:[21,4,21,4,0,void 0,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0],69:[19,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11,void 0,4,0,17,0],70:[18,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11],71:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,void 0,13,8,18,8],72:[22,4,21,4,0,void 0,18,21,18,0,void 0,4,11,18,11],73:[8,4,21,4,0],74:[16,12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7],75:[21,4,21,4,0,void 0,18,21,4,7,void 0,9,12,18,0],76:[17,4,21,4,0,void 0,4,0,16,0],77:[24,4,21,4,0,void 0,4,21,12,0,void 0,20,21,12,0,void 0,20,21,20,0],78:[22,4,21,4,0,void 0,4,21,18,0,void 0,18,21,18,0],79:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21],80:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10],81:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,void 0,12,4,18,-2],82:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,void 0,11,11,18,0],83:[20,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],84:[16,8,21,8,0,void 0,1,21,15,21],85:[22,4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21],86:[18,1,21,9,0,void 0,17,21,9,0],87:[24,2,21,7,0,void 0,12,21,7,0,void 0,12,21,17,0,void 0,22,21,17,0],88:[20,3,21,17,0,void 0,17,21,3,0],89:[18,1,21,9,11,9,0,void 0,17,21,9,11],90:[20,17,21,3,0,void 0,3,21,17,21,void 0,3,0,17,0],91:[14,4,25,4,-7,void 0,5,25,5,-7,void 0,4,25,11,25,void 0,4,-7,11,-7],92:[14,0,21,14,-3],93:[14,9,25,9,-7,void 0,10,25,10,-7,void 0,3,25,10,25,void 0,3,-7,10,-7],94:[16,6,15,8,18,10,15,void 0,3,12,8,17,13,12,void 0,8,17,8,0],95:[16,0,-2,16,-2],96:[10,6,21,5,20,4,18,4,16,5,15,6,16,5,17],97:[19,15,14,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],98:[19,4,21,4,0,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],99:[18,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],100:[19,15,21,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],101:[18,3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],102:[12,10,21,8,21,6,20,5,17,5,0,void 0,2,14,9,14],103:[19,15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],104:[19,4,21,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],105:[8,3,21,4,20,5,21,4,22,3,21,void 0,4,14,4,0],106:[10,5,21,6,20,7,21,6,22,5,21,void 0,6,14,6,-3,5,-6,3,-7,1,-7],107:[17,4,21,4,0,void 0,14,14,4,4,void 0,8,8,15,0],108:[8,4,21,4,0],109:[30,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0,void 0,15,10,18,13,20,14,23,14,25,13,26,10,26,0],110:[19,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],111:[19,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14],112:[19,4,14,4,-7,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],113:[19,15,14,15,-7,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],114:[13,4,14,4,0,void 0,4,8,5,11,7,13,9,14,12,14],115:[17,14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3],116:[12,5,21,5,4,6,1,8,0,10,0,void 0,2,14,9,14],117:[19,4,14,4,4,5,1,7,0,10,0,12,1,15,4,void 0,15,14,15,0],118:[16,2,14,8,0,void 0,14,14,8,0],119:[22,3,14,7,0,void 0,11,14,7,0,void 0,11,14,15,0,void 0,19,14,15,0],120:[17,3,14,14,0,void 0,14,14,3,0],121:[16,2,14,8,0,void 0,14,14,8,0,6,-4,4,-6,2,-7,1,-7],122:[17,14,14,3,0,void 0,3,14,14,14,void 0,3,0,14,0],123:[14,9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,void 0,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,void 0,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7],124:[8,4,25,4,-7],125:[14,5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,void 0,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,void 0,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7],126:[24,3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,void 0,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]}});var a1=G((WUe,zN)=>{var KJ=qN(),QJ={xOffset:0,yOffset:0,input:"?",align:"left",font:KJ,height:14,lineSpacing:2.142857142857143,letterSpacing:1,extrudeOffset:0},JJ=(r,e)=>{!e&&typeof r=="string"&&(r={input:r}),r=r||{};let t=Object.assign({},QJ,r);return t.input=e||t.input,t};zN.exports=JJ});var l1=G(($Ue,YN)=>{var eee=a1(),tee=(r,e)=>{let{xOffset:t,yOffset:n,input:i,font:s,height:o,extrudeOffset:a}=eee(r,e),l=i.charCodeAt(0);(!l||!s[l])&&(l=63);let u=[].concat(s[l]),c=(o-a)/s.height,h=a/2,f=u.shift()*c,d=[],m=[];for(let p=0,g=u.length;p<g;p+=2){let b=c*u[p]+t,v=c*u[p+1]+n+h;if(u[p]!==void 0){m.push([b,v]);continue}d.push(m),m=[],p--}return m.length&&d.push(m),{width:f,height:o,segments:d}};YN.exports=tee});var WN=G((jUe,VN)=>{var ree=l1(),nee=a1(),XN=(r,e)=>{let{x:t,y:n}=Object.assign({x:0,y:0},r||{}),i=e.segments,s=null,o=null;for(let a=0,l=i.length;a<l;a++){s=i[a];for(let u=0,c=s.length;u<c;u++)o=s[u],s[u]=[o[0]+t,o[1]+n]}return e},iee=(r,e)=>{let{xOffset:t,yOffset:n,input:i,font:s,height:o,align:a,extrudeOffset:l,lineSpacing:u,letterSpacing:c}=nee(r,e),[h,f]=[t,n],d,m,p,g,b,v,w={width:0,segments:[]},P=[],_=[],B=0,I=h,C=()=>{P.push(w),B=Math.max(B,w.width),w={width:0,segments:[]}};for(d=0,m=i.length;d<m;d++){if(p=i[d],g=ree({xOffset:h,yOffset:f,font:s,height:o,extrudeOffset:l},p),p===`
`){h=I,f-=g.height*u,C();continue}b=g.width*c,w.width+=b,h+=b,p!==" "&&(w.segments=w.segments.concat(g.segments))}for(w.segments.length&&C(),d=0,m=P.length;d<m;d++)w=P[d],B>w.width&&(v=B-w.width,a==="right"?w=XN({x:v},w):a==="center"&&(w=XN({x:v/2},w))),_=_.concat(w.segments);return _};VN.exports=iee});var jN=G((HUe,$N)=>{$N.exports={vectorChar:l1(),vectorText:WN()}});var Il=G((ZUe,HN)=>{var see=rt(),oee=nt(),aee=kt(),lee=r=>{let e;for(let t of r){let n=0;if(see.isA(t)&&(n=1),oee.isA(t)&&(n=2),aee.isA(t)&&(n=3),e&&n!==e)return!1;e=n}return!0};HN.exports=lee});var KN=G((KUe,ZN)=>{var uee=r=>r*.017453292519943295;ZN.exports=uee});var u1=G((QUe,QN)=>{var cee=(r,e)=>r-e;QN.exports=cee});var eR=G((JUe,JN)=>{var hee=(r,e,t)=>{let n=0,i=r.length;for(;i>n;){let s=Math.floor((n+i)/2),o=r[s];t(e,o)>0?n=s+1:i=s}r.splice(n,0,e)};JN.exports=hee});var nR=G((eDe,rR)=>{var{TAU:tR}=bt(),dee=(r,e,t)=>{let n=e>0?r*tR/e:0,i=t>0?tR/t:0;return Math.ceil(Math.max(n,i,4))};rR.exports=dee});var sR=G((tDe,iR)=>{var fee=r=>r*57.29577951308232;iR.exports=fee});var c1=G((rDe,oR)=>{oR.exports={areAllShapesTheSameType:Il(),degToRad:KN(),flatten:Ke(),fnNumberSort:u1(),insertSorted:eR(),radiusToSegments:nR(),radToDeg:sR()}});var op=G((nDe,lR)=>{var aR=st(),pee=rt(),mee=(r,e)=>{if(e.vertices.length<4)return null;let t=[],n=e.vertices.filter((o,a)=>o[2]>0?(t.push(a),!0):!1);if(n.length!==2)throw new Error("Assertion failed: fromFakePolygon: not enough points found");let i=n.map(o=>{let a=Math.round(o[0]/r)*r+0,l=Math.round(o[1]/r)*r+0;return aR.fromValues(a,l)});if(aR.equals(i[0],i[1]))return null;let s=t[1]-t[0];if(s===1||s===3)s===1&&i.reverse();else throw new Error("Assertion failed: fromFakePolygon: unknown index ordering");return i},gee=(r,e)=>{let t=e.map(n=>mee(r,n)).filter(n=>n!==null);return pee.create(t)};lR.exports=gee});var ap=G((iDe,uR)=>{var lo=Ye(),xee=rt(),bee=nt(),yee=xt(),vee=(r,e,t)=>{let n=[lo.fromVec2(lo.create(),t[0],r),lo.fromVec2(lo.create(),t[1],r),lo.fromVec2(lo.create(),t[1],e),lo.fromVec2(lo.create(),t[0],e)];return yee.create(n)},wee=(r,e)=>{let n=xee.toSides(e).map(s=>vee(r.z0,r.z1,s));return bee.create(n)};uR.exports=wee});var dR=G((sDe,hR)=>{var cR=Gt(),Eee=st(),vr=Ye(),Qo=function(r,e){arguments.length<2&&(e=vr.orthogonal(vr.create(),r)),this.v=vr.normalize(vr.create(),vr.cross(vr.create(),r,e)),this.u=vr.cross(vr.create(),this.v,r),this.plane=r,this.planeorigin=vr.scale(vr.create(),r,r[3])};Qo.GetCartesian=function(r,e){let t=r+"/"+e,n,i;if(t==="X/Y")n=[0,0,1],i=[1,0,0];else if(t==="Y/-X")n=[0,0,1],i=[0,1,0];else if(t==="-X/-Y")n=[0,0,1],i=[-1,0,0];else if(t==="-Y/X")n=[0,0,1],i=[0,-1,0];else if(t==="-X/Y")n=[0,0,-1],i=[-1,0,0];else if(t==="-Y/-X")n=[0,0,-1],i=[0,-1,0];else if(t==="X/-Y")n=[0,0,-1],i=[1,0,0];else if(t==="Y/X")n=[0,0,-1],i=[0,1,0];else if(t==="X/Z")n=[0,-1,0],i=[1,0,0];else if(t==="Z/-X")n=[0,-1,0],i=[0,0,1];else if(t==="-X/-Z")n=[0,-1,0],i=[-1,0,0];else if(t==="-Z/X")n=[0,-1,0],i=[0,0,-1];else if(t==="-X/Z")n=[0,1,0],i=[-1,0,0];else if(t==="-Z/-X")n=[0,1,0],i=[0,0,-1];else if(t==="X/-Z")n=[0,1,0],i=[1,0,0];else if(t==="Z/X")n=[0,1,0],i=[0,0,1];else if(t==="Y/Z")n=[1,0,0],i=[0,1,0];else if(t==="Z/-Y")n=[1,0,0],i=[0,0,1];else if(t==="-Y/-Z")n=[1,0,0],i=[0,-1,0];else if(t==="-Z/Y")n=[1,0,0],i=[0,0,-1];else if(t==="-Y/Z")n=[-1,0,0],i=[0,-1,0];else if(t==="-Z/-Y")n=[-1,0,0],i=[0,0,-1];else if(t==="Y/-Z")n=[-1,0,0],i=[0,1,0];else if(t==="Z/Y")n=[-1,0,0],i=[0,0,1];else throw new Error("OrthoNormalBasis.GetCartesian: invalid combination of axis identifiers. Should pass two string arguments from [X,Y,Z,-X,-Y,-Z], being two different axes.");return new Qo(new Plane(new Vector3D(n),0),new Vector3D(i))},Qo.Z0Plane=function(){let r=new Plane(new Vector3D([0,0,1]),0);return new Qo(r,new Vector3D([1,0,0]))},Qo.prototype={getProjectionMatrix:function(){return cR.fromValues(this.u[0],this.v[0],this.plane[0],0,this.u[1],this.v[1],this.plane[1],0,this.u[2],this.v[2],this.plane[2],0,0,0,-this.plane[3],1)},getInverseProjectionMatrix:function(){let r=vr.scale(vr.create(),this.plane,this.plane[3]);return cR.fromValues(this.u[0],this.u[1],this.u[2],0,this.v[0],this.v[1],this.v[2],0,this.plane[0],this.plane[1],this.plane[2],0,r[0],r[1],r[2],1)},to2D:function(r){return Eee.fromValues(vr.dot(r,this.u),vr.dot(r,this.v))},to3D:function(r){let e=vr.scale(vr.create(),this.u,r[0]),t=vr.scale(vr.create(),this.v,r[1]),n=vr.add(e,e,this.planeorigin);return vr.add(t,t,n)},line3Dto2D:function(r){let e=r.point,t=r.direction.plus(e),n=this.to2D(e),i=this.to2D(t);return Line2D.fromPoints(n,i)},line2Dto3D:function(r){let e=r.origin(),t=r.direction().plus(e),n=this.to3D(e),i=this.to3D(t);return Line3D.fromPoints(n,i)},transform:function(r){let e=this.plane.transform(r),t=this.u.transform(r),n=new Vector3D(0,0,0).transform(r),i=t.minus(n);return new Qo(e,i)}},hR.exports=Qo});var mR=G((oDe,pR)=>{var{EPS:bs}=bt(),uo=Df(),mi=st(),_ee=dR(),Bl=vx(),{insertSorted:Pee,fnNumberSort:See}=c1(),fR=xt(),Iee=r=>{if(r.length<2)return r;let e=[],t=r.length,n=fR.plane(r[0]),i=new _ee(n),s=[],o=[],a=new Map,l=new Map,u=new Map,c=10/bs;for(let m=0;m<t;m++){let p=r[m],g=[],b=p.vertices.length,v=-1;if(b>0){let w,P;for(let _=0;_<b;_++){let B=i.to2D(p.vertices[_]),I=Math.floor(B[1]*c),C;u.has(I)?C=u.get(I):u.has(I+1)?C=u.get(I+1):u.has(I-1)?C=u.get(I-1):(C=B[1],u.set(I,B[1])),B=mi.fromValues(B[0],C),g.push(B);let N=B[1];(_===0||N<w)&&(w=N,v=_),(_===0||N>P)&&(P=N);let A=l.get(N);A||(A={},l.set(N,A)),A[m]=!0}if(w>=P)g=[],b=0,v=-1;else{let _=a.get(w);_||(_=[],a.set(w,_)),_.push(m)}}g.reverse(),v=b-v-1,s.push(g),o.push(v)}let h=[];l.forEach((m,p)=>h.push(p)),h.sort(See);let f=[],d=[];for(let m=0;m<h.length;m++){let p=[],g=h[m],b=l.get(g);for(let w=0;w<f.length;++w){let P=f[w],_=P.polygonindex;if(b[_]){let B=s[_],I=B.length,C=P.leftvertexindex,N=P.rightvertexindex;for(;;){let M=C+1;if(M>=I&&(M=0),B[M][1]!==g)break;C=M}let A=N-1;if(A<0&&(A=I-1),B[A][1]===g&&(N=A),C!==P.leftvertexindex&&C===N)f.splice(w,1),--w;else{P.leftvertexindex=C,P.rightvertexindex=N,P.topleft=B[C],P.topright=B[N];let M=C+1;M>=I&&(M=0),P.bottomleft=B[M];let S=N-1;S<0&&(S=I-1),P.bottomright=B[S]}}}let v;if(m>=h.length-1)f=[],v=null;else{v=Number(h[m+1]);let w=.5*(g+v),P=a.get(g);for(let _ in P){let B=P[_],I=s[B],C=I.length,N=o[B],A=N;for(;;){let K=A+1;if(K>=C&&(K=0),I[K][1]!==g||K===N)break;A=K}let M=N;for(;;){let K=M-1;if(K<0&&(K=C-1),I[K][1]!==g||K===A)break;M=K}let S=A+1;S>=C&&(S=0);let $=M-1;$<0&&($=C-1);let H={polygonindex:B,leftvertexindex:A,rightvertexindex:M,topleft:I[A],topright:I[M],bottomleft:I[S],bottomright:I[$]};Pee(f,H,(K,F)=>{let z=Bl(K.topleft,K.bottomleft,w),L=Bl(F.topleft,F.bottomleft,w);return z>L?1:z<L?-1:0})}}for(let w in f){let P=f[w],_=Bl(P.topleft,P.bottomleft,g),B=mi.fromValues(_,g);_=Bl(P.topright,P.bottomright,g);let I=mi.fromValues(_,g);_=Bl(P.topleft,P.bottomleft,v);let C=mi.fromValues(_,v);_=Bl(P.topright,P.bottomright,v);let N=mi.fromValues(_,v),A={topleft:B,topright:I,bottomleft:C,bottomright:N,leftline:uo.fromPoints(uo.create(),B,C),rightline:uo.fromPoints(uo.create(),N,I)};if(p.length>0){let M=p[p.length-1],S=mi.distance(A.topleft,M.topright),$=mi.distance(A.bottomleft,M.bottomright);S<bs&&$<bs&&(A.topleft=M.topleft,A.leftline=M.leftline,A.bottomleft=M.bottomleft,p.splice(p.length-1,1))}p.push(A)}if(m>0){let w=new Set,P=new Set;for(let _=0;_<p.length;_++){let B=p[_];for(let I=0;I<d.length;I++)if(!P.has(I)){let C=d[I];if(mi.distance(C.bottomleft,B.topleft)<bs&&mi.distance(C.bottomright,B.topright)<bs){P.add(I);let N=uo.direction(B.leftline),A=uo.direction(C.leftline),M=N[0]-A[0],S=uo.direction(B.rightline),$=uo.direction(C.rightline),H=S[0]-$[0],K=Math.abs(M)<bs,F=Math.abs(H)<bs,z=K||M>=0,L=F||H>=0;z&&L&&(B.outpolygon=C.outpolygon,B.leftlinecontinues=K,B.rightlinecontinues=F,w.add(I));break}}}for(let _=0;_<d.length;_++)if(!w.has(_)){let B=d[_];B.outpolygon.rightpoints.push(B.bottomright),mi.distance(B.bottomright,B.bottomleft)>bs&&B.outpolygon.leftpoints.push(B.bottomleft),B.outpolygon.leftpoints.reverse();let C=B.outpolygon.rightpoints.concat(B.outpolygon.leftpoints).map(A=>i.to3D(A)),N=fR.fromPointsAndPlane(C,n);N.vertices.length&&e.push(N)}}for(let w=0;w<p.length;w++){let P=p[w];P.outpolygon?(P.leftlinecontinues||P.outpolygon.leftpoints.push(P.topleft),P.rightlinecontinues||P.outpolygon.rightpoints.push(P.topright)):(P.outpolygon={leftpoints:[],rightpoints:[]},P.outpolygon.leftpoints.push(P.topleft),mi.distance(P.topleft,P.topright)>bs&&P.outpolygon.rightpoints.push(P.topright))}d=p}return e};pR.exports=Iee});var pc=G((aDe,bR)=>{var gR=nt(),xR=xt(),Bee=ic(),Aee=mR(),Tee=(r,e)=>Math.abs(r[3]-e[3])<15e-8?Bee(r,e):!1,Cee=r=>{if(r.isRetesselated)return r;let e=gR.toPolygons(r),t=[];e.forEach(s=>{let o=t.find(a=>Tee(a[0],xR.plane(s)));o?o[1].push(s):t.push([xR.plane(s),[s]])});let n=[];t.forEach(s=>{let o=s[1],a=Aee(o);n=n.concat(a)});let i=gR.create(n);return i.isRetesselated=!0,i};bR.exports=Cee});var lp=G((lDe,vR)=>{var{EPS:Al}=bt(),yR=to(),Mee=(r,e)=>{if(r.polygons.length===0||e.polygons.length===0)return!1;let t=yR(r),n=t[0],i=t[1],s=yR(e),o=s[0],a=s[1];return!(o[0]-i[0]>Al||n[0]-a[0]>Al||o[1]-i[1]>Al||n[1]-a[1]>Al||o[2]-i[2]>Al||n[2]-a[2]>Al)};vR.exports=Mee});var _R=G((uDe,ER)=>{var wR=pi(),Nee=xt(),Tl=class{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygontreenodes=[],this.parent=e}invert(){let e=[this],t;for(let n=0;n<e.length;n++){t=e[n],t.plane&&(t.plane=wR.flip(wR.create(),t.plane)),t.front&&e.push(t.front),t.back&&e.push(t.back);let i=t.front;t.front=t.back,t.back=i}}clipPolygons(e,t){let n={node:this,polygontreenodes:e},i,s=[];do{if(i=n.node,e=n.polygontreenodes,i.plane){let o=i.plane,a=[],l=[],u=t?a:l,c=e.length;for(let f=0;f<c;f++){let d=e[f];d.isRemoved()||d.splitByPlane(o,u,a,l,a)}i.front&&l.length>0&&s.push({node:i.front,polygontreenodes:l});let h=a.length;if(i.back&&h>0)s.push({node:i.back,polygontreenodes:a});else for(let f=0;f<h;f++)a[f].remove()}n=s.pop()}while(n!==void 0)}clipTo(e,t){let n=this,i=[];do n.polygontreenodes.length>0&&e.rootnode.clipPolygons(n.polygontreenodes,t),n.front&&i.push(n.front),n.back&&i.push(n.back),n=i.pop();while(n!==void 0)}addPolygonTreeNodes(e){let t={node:this,polygontreenodes:e},n=[];do{let i=t.node,s=t.polygontreenodes;if(s.length===0){t=n.pop();continue}if(!i.plane){let u=0;u=Math.floor(s.length/2);let c=s[u].getPolygon();i.plane=Nee.plane(c)}let o=[],a=[],l=s.length;for(let u=0;u<l;++u)s[u].splitByPlane(i.plane,i.polygontreenodes,a,o,a);o.length>0&&(i.front||(i.front=new Tl(i)),l===o.length&&a.length===0?i.front.polygontreenodes=o:n.push({node:i.front,polygontreenodes:o})),a.length>0&&(i.back||(i.back=new Tl(i)),l===a.length&&o.length===0?i.back.polygontreenodes=a:n.push({node:i.back,polygontreenodes:a})),t=n.pop()}while(t!==void 0)}};ER.exports=Tl});var SR=G((cDe,PR)=>{var Cl=Ye(),Ree=(r,e,t)=>{let n=Cl.subtract(Cl.create(),t,e),i=(r[3]-Cl.dot(r,e))/Cl.dot(r,n);return Number.isNaN(i)&&(i=0),i>1&&(i=1),i<0&&(i=0),Cl.scale(n,n,i),Cl.add(n,e,n),n};PR.exports=Ree});var BR=G((hDe,IR)=>{var{EPS:up}=bt(),Lee=pi(),cp=Ye(),h1=xt(),Oee=SR(),kee=(r,e)=>{let t={type:null,front:null,back:null},n=e.vertices,i=n.length,s=h1.plane(e);if(Lee.equals(s,r))t.type=0;else{let o=!1,a=!1,l=[],u=-up;for(let c=0;c<i;c++){let h=cp.dot(r,n[c])-r[3],f=h<u;l.push(f),h>up&&(o=!0),h<u&&(a=!0)}if(!o&&!a){let c=cp.dot(r,s);t.type=c>=0?0:1}else if(!a)t.type=2;else if(!o)t.type=3;else{t.type=4;let c=[],h=[],f=l[0];for(let m=0;m<i;m++){let p=n[m],g=m+1;g>=i&&(g=0);let b=l[g];if(f===b)f?h.push(p):c.push(p);else{let v=n[g],w=Oee(r,p,v);f?(h.push(p),h.push(w),c.push(w)):(c.push(p),c.push(w),h.push(w))}f=b}let d=up*up;if(h.length>=3){let m=h[h.length-1];for(let p=0;p<h.length;p++){let g=h[p];cp.squaredDistance(g,m)<d&&(h.splice(p,1),p--),m=g}}if(c.length>=3){let m=c[c.length-1];for(let p=0;p<c.length;p++){let g=c[p];cp.squaredDistance(g,m)<d&&(c.splice(p,1),p--),m=g}}c.length>=3&&(t.front=h1.fromPointsAndPlane(c,s)),h.length>=3&&(t.back=h1.fromPointsAndPlane(h,s))}}return t};IR.exports=kee});var CR=G((dDe,TR)=>{var{EPS:Uee}=bt(),Dee=Ye(),AR=xt(),Gee=BR(),mc=class{constructor(e,t){this.parent=e,this.children=[],this.polygon=t,this.removed=!1}addPolygons(e){if(!this.isRootNode())throw new Error("Assertion failed");let t=this;e.forEach(n=>{t.addChild(n)})}remove(){if(!this.removed){this.removed=!0,this.polygon=null;let e=this.parent.children,t=e.indexOf(this);if(t<0)throw new Error("Assertion failed");e.splice(t,1),this.parent.recursivelyInvalidatePolygon()}}isRemoved(){return this.removed}isRootNode(){return!this.parent}invert(){if(!this.isRootNode())throw new Error("Assertion failed");this.invertSub()}getPolygon(){if(!this.polygon)throw new Error("Assertion failed");return this.polygon}getPolygons(e){let t=[this],n=[t],i,s,o,a;for(i=0;i<n.length;++i)for(t=n[i],s=0,o=t.length;s<o;s++)a=t[s],a.polygon?e.push(a.polygon):a.children.length>0&&n.push(a.children)}splitByPlane(e,t,n,i,s){if(this.children.length){let o=[this.children],a,l,u,c,h;for(a=0;a<o.length;a++)for(h=o[a],l=0,u=h.length;l<u;l++)c=h[l],c.children.length>0?o.push(c.children):c._splitByPlane(e,t,n,i,s)}else this._splitByPlane(e,t,n,i,s)}_splitByPlane(e,t,n,i,s){let o=this.polygon;if(o){let a=AR.measureBoundingSphere(o),l=a[3]+Uee,u=a,c=Dee.dot(e,u)-e[3];if(c>l)i.push(this);else if(c<-l)s.push(this);else{let h=Gee(e,o);switch(h.type){case 0:t.push(this);break;case 1:n.push(this);break;case 2:i.push(this);break;case 3:s.push(this);break;case 4:if(h.front){let f=this.addChild(h.front);i.push(f)}if(h.back){let f=this.addChild(h.back);s.push(f)}break}}}}addChild(e){let t=new mc(this,e);return this.children.push(t),t}invertSub(){let e=[this],t=[e],n,i,s,o;for(n=0;n<t.length;n++)for(e=t[n],i=0,s=e.length;i<s;i++)o=e[i],o.polygon&&(o.polygon=AR.invert(o.polygon)),o.children.length>0&&t.push(o.children)}recursivelyInvalidatePolygon(){this.polygon=null,this.parent&&this.parent.recursivelyInvalidatePolygon()}clear(){let e=[this],t=[e];for(let n=0;n<t.length;++n){e=t[n];let i=e.length;for(let s=0;s<i;s++){let o=e[s];o.polygon&&(o.polygon=null),o.parent&&(o.parent=null),o.children.length>0&&t.push(o.children),o.children=[]}}}toString(){let e="",t=[this],n=[t],i,s,o,a;for(i=0;i<n.length;++i){t=n[i];let l=" ".repeat(i);for(s=0,o=t.length;s<o;s++)a=t[s],e+=`${l}PolygonTreeNode (${a.isRootNode()}): ${a.children.length}`,a.polygon?e+=`
 ${l}polygon: ${a.polygon.vertices}
`:e+=`
`,a.children.length>0&&n.push(a.children)}return e}};TR.exports=mc});var NR=G((fDe,MR)=>{var Fee=_R(),qee=CR(),d1=class{constructor(e){this.polygonTree=new qee,this.rootnode=new Fee(null),e&&this.addPolygons(e)}invert(){this.polygonTree.invert(),this.rootnode.invert()}clipTo(e,t=!1){this.rootnode.clipTo(e,t)}allPolygons(){let e=[];return this.polygonTree.getPolygons(e),e}addPolygons(e){let t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=this.polygonTree.addChild(e[n]);this.rootnode.addPolygonTreeNodes(t)}clear(){this.polygonTree.clear()}toString(){return"Tree: "+this.polygonTree.toString("")}};MR.exports=d1});var hp=G((pDe,RR)=>{RR.exports={Tree:NR()}});var kR=G((mDe,OR)=>{var dp=nt(),zee=lp(),{Tree:LR}=hp(),Yee=(r,e)=>{if(!zee(r,e))return dp.create();let t=new LR(dp.toPolygons(r)),n=new LR(dp.toPolygons(e));t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.addPolygons(n.allPolygons()),t.invert();let i=t.allPolygons();return dp.create(i)};OR.exports=Yee});var f1=G((gDe,UR)=>{var Xee=Ke(),Vee=pc(),Wee=kR(),$ee=(...r)=>{r=Xee(r);let e=r.shift();return r.forEach(t=>{e=Wee(e,t)}),e=Vee(e),e};UR.exports=$ee});var GR=G((xDe,DR)=>{var jee=Ke(),Hee=nt(),Zee=gs(),Kee=op(),Qee=ap(),Jee=f1(),ete=(...r)=>{r=jee(r);let e=r.map(i=>Qee({z0:-1,z1:1},i)),t=Jee(e),n=Zee(t);return Kee(n,Hee.toPolygons(t))};DR.exports=ete});var qR=G((bDe,FR)=>{var tte=Ke(),rte=Il(),nte=rt(),ite=nt(),ste=GR(),ote=f1(),ate=(...r)=>{if(r=tte(r),r.length===0)throw new Error("wrong number of arguments");if(!rte(r))throw new Error("only intersect of the types are supported");let e=r[0];return nte.isA(e)?ste(r):ite.isA(e)?ote(r):e};FR.exports=ate});var XR=G((yDe,YR)=>{var p1=Ye(),lte=gs(),zR=nt(),ute=r=>r.sort((e,t)=>e-t).filter((e,t,n)=>!t||e!==n[t-1]),cte=(r,e,t)=>{let n=`${e}`,i=r.get(n);i===void 0?r.set(n,[t]):i.push(t)},hte=(r,e)=>{let t=`${e}`;return r.get(t)},dte=r=>{let e=lte(r),t=zR.toPolygons(r),n=t.length,i=new Map,s=p1.create();t.forEach((c,h)=>{c.vertices.forEach(f=>{cte(i,p1.snap(s,f,e),h)})});let o=t.map(c=>{let h=[];return c.vertices.forEach(f=>{h=h.concat(hte(i,p1.snap(s,f,e)))}),{e:1,d:ute(h)}});i.clear();let a=0,l=o.length;for(let c=0;c<l;c++){let h=o[c];if(h.e>0){let f=new Array(n);f[c]=!0;do a=0,f.forEach((d,m)=>{let p=o[m];if(p.e>0){p.e=-1;for(let g=0;g<p.d.length;g++)f[p.d[g]]=!0;a++}});while(a>0);h.indexes=f}}let u=[];for(let c=0;c<l;c++)if(o[c].indexes){let h=[];o[c].indexes.forEach((f,d)=>h.push(t[d])),u.push(zR.create(h))}return u};YR.exports=dte});var WR=G((vDe,VR)=>{var fte=Ke(),pte=nt(),mte=XR(),gte=(...r)=>{if(r=fte(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>pte.isA(t)?mte(t):t);return e.length===1?e[0]:e};VR.exports=gte});var HR=G((wDe,jR)=>{var fp=nt(),xte=lp(),{Tree:$R}=hp(),bte=(r,e)=>{if(!xte(r,e))return fp.clone(r);let t=new $R(fp.toPolygons(r)),n=new $R(fp.toPolygons(e));t.invert(),t.clipTo(n),n.clipTo(t,!0),t.addPolygons(n.allPolygons()),t.invert();let i=t.allPolygons();return fp.create(i)};jR.exports=bte});var m1=G((EDe,ZR)=>{var yte=Ke(),vte=pc(),wte=HR(),Ete=(...r)=>{r=yte(r);let e=r.shift();return r.forEach(t=>{e=wte(e,t)}),e=vte(e),e};ZR.exports=Ete});var QR=G((_De,KR)=>{var _te=Ke(),Pte=nt(),Ste=gs(),Ite=op(),Bte=ap(),Ate=m1(),Tte=(...r)=>{r=_te(r);let e=r.map(i=>Bte({z0:-1,z1:1},i)),t=Ate(e),n=Ste(t);return Ite(n,Pte.toPolygons(t))};KR.exports=Tte});var eL=G((PDe,JR)=>{var Cte=Ke(),Mte=Il(),Nte=rt(),Rte=nt(),Lte=QR(),Ote=m1(),kte=(...r)=>{if(r=Cte(r),r.length===0)throw new Error("wrong number of arguments");if(!Mte(r))throw new Error("only subtract of the types are supported");let e=r[0];return Nte.isA(e)?Lte(r):Rte.isA(e)?Ote(r):e};JR.exports=kte});var g1=G((SDe,rL)=>{var Ml=nt(),Ute=lp(),{Tree:tL}=hp(),Dte=(r,e)=>{if(!Ute(r,e))return Gte(r,e);let t=new tL(Ml.toPolygons(r)),n=new tL(Ml.toPolygons(e));t.clipTo(n,!1),n.clipTo(t),n.invert(),n.clipTo(t),n.invert();let i=t.allPolygons().concat(n.allPolygons());return Ml.create(i)},Gte=(r,e)=>{let t=Ml.toPolygons(r);return t=t.concat(Ml.toPolygons(e)),Ml.create(t)};rL.exports=Dte});var x1=G((IDe,nL)=>{var Fte=Ke(),qte=pc(),zte=g1(),Yte=(...r)=>{r=Fte(r);let e;for(e=1;e<r.length;e+=2)r.push(zte(r[e-1],r[e]));let t=r[e-1];return t=qte(t),t};nL.exports=Yte});var b1=G((BDe,iL)=>{var Xte=Ke(),Vte=nt(),Wte=gs(),$te=op(),jte=ap(),Hte=x1(),Zte=(...r)=>{r=Xte(r);let e=r.map(i=>jte({z0:-1,z1:1},i)),t=Hte(e),n=Wte(t);return $te(n,Vte.toPolygons(t))};iL.exports=Zte});var pp=G((ADe,sL)=>{var Kte=Ke(),Qte=Il(),Jte=rt(),ere=nt(),tre=b1(),rre=x1(),nre=(...r)=>{if(r=Kte(r),r.length===0)throw new Error("wrong number of arguments");if(!Qte(r))throw new Error("only unions of the same type are supported");let e=r[0];return Jte.isA(e)?tre(r):ere.isA(e)?rre(r):e};sL.exports=nre});var aL=G((TDe,oL)=>{oL.exports={intersect:qR(),scission:WR(),subtract:eL(),union:pp()}});var xc=G((CDe,uL)=>{var{EPS:ire,TAU:sre}=bt(),lL=wx(),gc=Df(),tr=st(),ore=tc(),are=(r,e)=>{let t={delta:1,corners:"edge",closed:!1,segments:16},{delta:n,corners:i,closed:s,segments:o}=Object.assign({},t,r);if(Math.abs(n)<ire)return e;let a=r.closed?ore(e):1;a===0&&(a=1);let l=a>0&&n>=0||a<0&&n<0;n=Math.abs(n);let u=null,c=[],h=[],f=tr.create(),d=e.length;for(let m=0;m<d;m++){let p=(m+1)%d,g=e[m],b=e[p];l?tr.subtract(f,g,b):tr.subtract(f,b,g),tr.normal(f,f),tr.normalize(f,f),tr.scale(f,f,n);let v=tr.add(tr.create(),g,f),w=tr.add(tr.create(),b,f),P=[v,w];if(u!=null&&(s||!s&&p!==0)){let _=lL(u[0],u[1],P[0],P[1]);_?(c.pop(),P[0]=_):h.push({c:g,s0:u,s1:P})}u=[v,w],!(p===0&&!s)&&(c.push(P[0]),c.push(P[1]))}if(s&&u!=null){let m=c[0],p=c[1],g=lL(u[0],u[1],m,p);if(g)c[0]=g,c.pop();else{let b=e[0],v=[m,p];h.push({c:b,s0:u,s1:v})}}if(i==="edge"){let m=new Map;c.forEach((b,v)=>m.set(b,v));let p=gc.create(),g=gc.create();h.forEach(b=>{gc.fromPoints(p,b.s0[0],b.s0[1]),gc.fromPoints(g,b.s1[0],b.s1[1]);let v=gc.intersectPointOfLines(p,g);if(Number.isFinite(v[0])&&Number.isFinite(v[1])){let w=b.s0[1],P=m.get(w);c[P]=v,c[(P+1)%c.length]=void 0}else{let w=b.s1[0],P=m.get(w);c[P]=void 0}}),c=c.filter(b=>b!==void 0)}if(i==="round"){let m=Math.floor(o/4),p=tr.create();h.forEach(g=>{let b=tr.angle(tr.subtract(p,g.s1[0],g.c));if(b-=tr.angle(tr.subtract(p,g.s0[1],g.c)),l&&b<0&&(b=b+Math.PI,b<0&&(b=b+Math.PI)),!l&&b>0&&(b=b-Math.PI,b>0&&(b=b-Math.PI)),b!==0){m=Math.floor(o*(Math.abs(b)/sre));let v=b/m,w=tr.angle(tr.subtract(p,g.s0[1],g.c)),P=[];for(let _=1;_<m;_++){let B=w+v*_,I=tr.fromAngleRadians(tr.create(),B);tr.scale(I,I,n),tr.add(I,I,g.c),P.push(I)}if(P.length>0){let _=g.s0[1],B=c.findIndex(I=>tr.equals(_,I));B=(B+1)%c.length,c.splice(B,0,...P)}}else{let v=g.s1[0],w=c.findIndex(P=>tr.equals(v,P));c.splice(w,1)}})}return c};uL.exports=are});var hL=G((MDe,cL)=>{var mp=rt(),lre=xc(),ure=(r,e)=>{let t={delta:1,corners:"edge",segments:16},{delta:n,corners:i,segments:s}=Object.assign({},t,r);if(!(i==="edge"||i==="chamfer"||i==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');let l=mp.toOutlines(e).map(u=>(r={delta:n,corners:i,closed:!0,segments:s},lre(r,u))).reduce((u,c)=>u.concat(mp.toSides(mp.fromPoints(c))),[]);return mp.create(l)};cL.exports=ure});var pL=G((NDe,fL)=>{var dL=Gt(),cre=Ye(),hre=nt(),bc=xt(),dre=(r,e)=>{cre.dot(bc.plane(e),r)>0&&(e=bc.invert(e));let n=[e],i=bc.transform(dL.fromTranslation(dL.create(),r),e),s=e.vertices.length;for(let o=0;o<s;o++){let a=o<s-1?o+1:0,l=bc.create([e.vertices[o],i.vertices[o],i.vertices[a],e.vertices[a]]);n.push(l)}return n.push(bc.invert(i)),hre.create(n)};fL.exports=dre});var xL=G((RDe,gL)=>{var{EPS:fre,TAU:y1}=bt(),mL=Gt(),Yt=Ye(),pre=u1(),v1=nt(),Jo=xt(),mre=$x(),gre=pc(),w1=g1(),xre=pL(),bre=(r,e,t)=>{let n=e.toString();if(r.has(n))r.get(n)[1].push(t);else{let i=[e,[t]];r.set(n,i)}},yre=(r,e,t)=>{let n=e[0].toString(),i=e[1].toString(),s=n<i?`${n},${i}`:`${i},${n}`;if(r.has(s))r.get(s)[1].push(t);else{let o=[e,[t]];r.set(s,o)}},E1=(r,e)=>{r.findIndex(n=>n===e)<0&&r.push(e)},vre=(r,e)=>{let t={delta:1,segments:12},{delta:n,segments:i}=Object.assign({},t,r),s=v1.create(),o=new Map,a=new Map,l=Yt.create(),u=Yt.create();return v1.toPolygons(e).forEach((h,f)=>{let d=Yt.scale(Yt.create(),Jo.plane(h),2*n),m=Jo.transform(mL.fromTranslation(mL.create(),Yt.scale(Yt.create(),d,-.5)),h),p=xre(d,m);s=w1(s,p);let g=h.vertices;for(let b=0;b<g.length;b++){bre(o,g[b],Jo.plane(h));let v=(b+1)%g.length,w=[g[b],g[v]];yre(a,w,Jo.plane(h))}}),a.forEach(h=>{let f=h[0],d=h[1],m=f[0],p=f[1],g=Yt.subtract(Yt.create(),p,m);Yt.normalize(g,g);let b=d[0],v=Yt.cross(Yt.create(),b,g),w=[];for(let M=0;M<i;M++)E1(w,M*y1/i);for(let M=0,S=d.length;M<S;M++){let $=d[M],H=Yt.dot(v,$),K=Yt.dot(b,$),F=Math.atan2(H,K);F<0&&(F+=y1),E1(w,F),F=Math.atan2(-H,-K),F<0&&(F+=y1),E1(w,F)}w=w.sort(pre);let P=w.length,_,B,I=[],C=[],N=[];for(let M=-1;M<P;M++){let S=w[M<0?M+P:M],$=Math.sin(S),H=Math.cos(S);Yt.scale(l,b,H*n),Yt.scale(u,v,$*n),Yt.add(l,l,u);let K=Yt.add(Yt.create(),m,l),F=Yt.add(Yt.create(),p,l),z=!1;if(M>=0&&Yt.distance(K,_)<fre&&(z=!0),!z){if(M>=0){I.push(K),C.push(F);let L=[B,F,K,_],k=Jo.create(L);N.push(k)}_=K,B=F}}C.reverse(),N.push(Jo.create(I)),N.push(Jo.create(C));let A=v1.create(N);s=w1(s,A)}),o.forEach(h=>{let f=h[0],d=h[1],m=d[0],p=null,g=0;for(let P=1;P<d.length;P++){let _=d[P],B=Yt.cross(l,m,_),I=Yt.length(B);I>.05&&I>g&&(g=I,p=_)}p||(p=Yt.orthogonal(l,m));let b=Yt.cross(l,m,p);Yt.normalize(b,b);let v=Yt.cross(u,b,m),w=mre({center:[f[0],f[1],f[2]],radius:n,segments:i,axes:[m,b,v]});s=w1(s,w)}),gre(s)};gL.exports=vre});var yL=G((LDe,bL)=>{var wre=nt(),Ere=pp(),_re=xL(),Pre=(r,e)=>{let t={delta:1,corners:"round",segments:12},{delta:n,corners:i,segments:s}=Object.assign({},t,r);if(i!=="round")throw new Error('corners must be "round" for 3D geometries');if(wre.toPolygons(e).length===0)throw new Error("the given geometry cannot be empty");r={delta:n,corners:i,segments:s};let a=_re(r,e);return Ere(e,a)};bL.exports=Pre});var EL=G((ODe,wL)=>{var Sre=tc(),fn=st(),Nl=rt(),yc=kt(),vL=xc(),Ire=r=>{let{external:e,internal:t}=r;Sre(e)<0?e=e.reverse():t=t.reverse();let n=yc.fromPoints({closed:!0},e),i=yc.fromPoints({closed:!0},t),s=Nl.toSides(Nl.fromPoints(yc.toPoints(n))),o=Nl.toSides(Nl.fromPoints(yc.toPoints(i)));return s.push(...o),Nl.create(s)},Bre=(r,e,t,n)=>{let{points:i,external:s,internal:o}=r,a=Math.floor(e/2),l=[],u=[];if(t==="round"&&a>0){let h=Math.PI/a,f=i[i.length-1],d=fn.angle(fn.subtract(fn.create(),s[s.length-1],f)),m=i[0],p=fn.angle(fn.subtract(fn.create(),o[0],m));for(let g=1;g<a;g++){let b=d+h*g,v=fn.fromAngleRadians(fn.create(),b);fn.scale(v,v,n),fn.add(v,v,f),l.push(v),b=p+h*g,v=fn.fromAngleRadians(fn.create(),b),fn.scale(v,v,n),fn.add(v,v,m),u.push(v)}}let c=[];return c.push(...s,...l,...o.reverse(),...u),Nl.fromPoints(c)},Are=(r,e)=>{r=Object.assign({},{delta:1,corners:"edge",segments:16},r);let{delta:n,corners:i,segments:s}=r;if(n<=0)throw new Error("the given delta must be positive for paths");if(!(i==="edge"||i==="chamfer"||i==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');let o=e.isClosed,a=yc.toPoints(e);if(a.length===0)throw new Error("the given geometry cannot be empty");let l={points:a,external:vL({delta:n,corners:i,segments:s,closed:o},a),internal:vL({delta:-n,corners:i,segments:s,closed:o},a)};return e.isClosed?Ire(l):Bre(l,s,i,n)};wL.exports=Are});var gp=G((kDe,_L)=>{var Tre=Ke(),Cre=rt(),Mre=nt(),Nre=kt(),Rre=hL(),Lre=yL(),Ore=EL(),kre=(r,...e)=>{if(e=Tre(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>Nre.isA(n)?Ore(r,n):Cre.isA(n)?Rre(r,n):Mre.isA(n)?Lre(r,n):n);return t.length===1?t[0]:t};_L.exports=kre});var IL=G((UDe,SL)=>{var xp=rt(),PL=Lf(),Ure=xc(),Dre=(r,e)=>{let t={delta:1,corners:"edge",segments:0},{delta:n,corners:i,segments:s}=Object.assign({},t,r);if(!(i==="edge"||i==="chamfer"||i==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');let o=xp.toOutlines(e),l=o.map(u=>(r={delta:o.reduce((f,d)=>f+PL.arePointsInside(u,PL.create(d)),0)%2===0?n:-n,corners:i,closed:!0,segments:s},Ure(r,u))).reduce((u,c)=>u.concat(xp.toSides(xp.fromPoints(c))),[]);return xp.create(l)};SL.exports=Dre});var TL=G((DDe,AL)=>{var BL=kt(),Gre=xc(),Fre=(r,e)=>{let t={delta:1,corners:"edge",closed:e.isClosed,segments:16},{delta:n,corners:i,closed:s,segments:o}=Object.assign({},t,r);if(!(i==="edge"||i==="chamfer"||i==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');r={delta:n,corners:i,closed:s,segments:o};let a=Gre(r,BL.toPoints(e));return BL.fromPoints({closed:s},a)};AL.exports=Fre});var ML=G((GDe,CL)=>{var qre=Ke(),zre=rt(),Yre=kt(),Xre=IL(),Vre=TL(),Wre=(r,...e)=>{if(e=qre(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>Yre.isA(n)?Vre(r,n):zre.isA(n)?Xre(r,n):n);return t.length===1?t[0]:t};CL.exports=Wre});var RL=G((FDe,NL)=>{NL.exports={expand:gp(),offset:ML()}});var wc=G((qDe,LL)=>{var vc=Gt(),_1=Ye(),$re=rt(),P1=wl(),jre=np(),Hre=(r,e)=>{let t={offset:[0,0,1],twistAngle:0,twistSteps:12,repair:!0},{offset:n,twistAngle:i,twistSteps:s,repair:o}=Object.assign({},t,r);if(s<1)throw new Error("twistSteps must be 1 or more");i===0&&(s=1);let a=_1.clone(n),l=$re.toSides(e);if(l.length===0)throw new Error("the given geometry cannot be empty");let u=P1.fromSides(l);a[2]<0&&P1.reverse(u,u);let c=vc.create(),h=(f,d,m)=>{let p=d/s*i,g=_1.scale(_1.create(),a,d/s);return vc.multiply(c,vc.fromZRotation(c,p),vc.fromTranslation(vc.create(),g)),P1.transform(c,m)};return r={numberOfSlices:s+1,capStart:!0,capEnd:!0,repair:o,callback:h},jre(r,u)};LL.exports=Hre});var kL=G((zDe,OL)=>{var Zre=rt(),Kre=kt(),Qre=wc(),Jre=(r,e)=>{if(!e.isClosed)throw new Error("extruded path must be closed");let t=Kre.toPoints(e),n=Zre.fromPoints(t);return Qre(r,n)};OL.exports=Jre});var DL=G((YDe,UL)=>{var ene=Ke(),tne=rt(),rne=kt(),nne=wc(),ine=kL(),sne=(r,...e)=>{let t={height:1,twistAngle:0,twistSteps:1,repair:!0},{height:n,twistAngle:i,twistSteps:s,repair:o}=Object.assign({},t,r);if(e=ene(e),e.length===0)throw new Error("wrong number of arguments");r={offset:[0,0,n],twistAngle:i,twistSteps:s,repair:o};let a=e.map(l=>rne.isA(l)?ine(r,l):tne.isA(l)?nne(r,l):l);return a.length===1?a[0]:a};UL.exports=sne});var qL=G((XDe,FL)=>{var one=kt(),ane=gp(),lne=wc(),une=(r,e)=>{let t={size:1,height:1},{size:n,height:i}=Object.assign({},t,r);if(r.delta=n,r.offset=[0,0,i],one.toPoints(e).length===0)throw new Error("the given geometry cannot be empty");let o=ane(r,e);return lne(r,o)};FL.exports=une});var YL=G((VDe,zL)=>{var{area:cne}=dl(),S1=rt(),hne=kt(),dne=gp(),fne=wc(),pne=(r,e)=>{let t={size:1,height:1},{size:n,height:i}=Object.assign({},t,r);r.delta=n,r.offset=[0,0,i];let s=S1.toOutlines(e);if(s.length===0)throw new Error("the given geometry cannot be empty");let a=s.map(u=>(cne(u)<0&&u.reverse(),dne(r,hne.fromPoints({closed:!0},u)))).reduce((u,c)=>u.concat(S1.toSides(c)),[]),l=S1.create(a);return fne(r,l)};zL.exports=pne});var VL=G((WDe,XL)=>{var mne=Ke(),gne=rt(),xne=kt(),bne=qL(),yne=YL(),vne=(r,...e)=>{let t={size:1,height:1},{size:n,height:i}=Object.assign({},t,r);if(e=mne(e),e.length===0)throw new Error("wrong number of arguments");if(n<=0)throw new Error("size must be positive");if(i<=0)throw new Error("height must be positive");let s=e.map(o=>xne.isA(o)?bne(r,o):gne.isA(o)?yne(r,o):o);return s.length===1?s[0]:s};XL.exports=vne});var KL=G(($De,ZL)=>{var wne=Ke(),WL=ic(),I1=pi(),$L=Gt(),jL=rt(),HL=nt(),Rl=xt(),Ene=gs(),_ne=b1(),Pne=(r,e)=>{let t=I1.fromNormalAndPoint(I1.create(),r.axis,r.origin);if(Number.isNaN(t[0])||Number.isNaN(t[1])||Number.isNaN(t[2])||Number.isNaN(t[3]))throw new Error("project: invalid axis or origin");let n=Ene(e),i=n*n*Math.sqrt(3)/4;if(n===0)return jL.create();let s=HL.toPolygons(e),o=[];for(let l=0;l<s.length;l++){let u=s[l].vertices.map(f=>I1.projectionOfPoint(t,f)),c=Rl.create(u),h=Rl.plane(c);!WL(t,h)||Rl.measureArea(c)<i||o.push(c)}if(!WL(t,[0,0,1])){let l=$L.fromVectorRotation($L.create(),t,[0,0,1]);o=o.map(u=>Rl.transform(l,u))}o=o.sort((l,u)=>Rl.measureArea(u)-Rl.measureArea(l));let a=o.map(l=>jL.fromPoints(l.vertices));return _ne(a)},Sne=(r,...e)=>{let t={axis:[0,0,1],origin:[0,0,0]},{axis:n,origin:i}=Object.assign({},t,r);if(e=wne(e),e.length===0)throw new Error("wrong number of arguments");r={axis:n,origin:i};let s=e.map(o=>HL.isA(o)?Pne(r,o):o);return s.length===1?s[0]:s};ZL.exports=Sne});var JL=G((jDe,QL)=>{QL.exports={extrudeFromSlices:np(),extrudeLinear:DL(),extrudeRectangular:VL(),extrudeRotate:n1(),project:KL(),slice:wl()}});var B1=G((HDe,tO)=>{var eO=st(),Ine=r=>{let e=eO.fromValues(1/0,1/0);r.forEach(i=>{(i[1]<e[1]||i[1]===e[1]&&i[0]<e[0])&&(e=i)});let t=[];r.forEach(i=>{let s=Ane(i[1]-e[1],i[0]-e[0]),o=eO.squaredDistance(i,e);t.push({point:i,angle:s,distSq:o})}),t.sort((i,s)=>i.angle<s.angle?-1:i.angle>s.angle?1:i.distSq<s.distSq?-1:i.distSq>s.distSq?1:0);let n=[];return t.forEach(i=>{let s=n.length;for(;s>1&&Bne(n[s-2],n[s-1],i.point)<=Number.EPSILON;)n.pop(),s=n.length;n.push(i.point)}),n},Bne=(r,e,t)=>(e[0]-r[0])*(t[1]-r[1])-(e[1]-r[1])*(t[0]-r[0]),Ane=(r,e)=>r===0&&e===0?-1/0:-e/r;tO.exports=Ine});var bp=G((ZDe,sO)=>{var rO=rt(),nO=nt(),iO=kt(),Tne=r=>{let e=new Set,t=[],n=i=>{let s=i.toString();e.has(s)||(t.push(i),e.add(s))};return r.forEach(i=>{rO.isA(i)?rO.toPoints(i).forEach(n):nO.isA(i)?nO.toPoints(i).forEach(s=>s.forEach(n)):iO.isA(i)&&iO.toPoints(i).forEach(n)}),t};sO.exports=Tne});var aO=G((KDe,oO)=>{var Cne=Ke(),Mne=kt(),Nne=B1(),Rne=bp(),Lne=(...r)=>{r=Cne(r);let e=Rne(r),t=Nne(e);return Mne.fromPoints({closed:!0},t)};oO.exports=Lne});var cO=G((QDe,uO)=>{var One=Ke(),lO=rt(),kne=B1(),Une=bp(),Dne=(...r)=>{r=One(r);let e=Une(r),t=kne(e);return t.length<3?lO.create():lO.fromPoints(t)};uO.exports=Dne});var pO=G((JDe,fO)=>{var Gne=cl(),hO=Wu(),dO=k0(),Fne=(r,e,t)=>{let n=[],i=[],s=[];hO(n,t,e),hO(i,r,e);let o=dO(Gne(s,i,n)),a=dO(n);if(a===0)throw Error("a and b are the same point");return o/a},qne=(r,e,t)=>Math.sqrt(Fne(r,e,t));fO.exports=qne});var xO=G((e6e,gO)=>{var zne=cl(),Yne=Bf(),mO=Wu(),Xne=(r,e,t,n)=>{let i=[0,0,0];return mO(r,e,t),mO(i,t,n),zne(r,r,i),Yne(r,r)};gO.exports=Xne});var yO=G((t6e,bO)=>{var A1=class{constructor(){this.head=null,this.tail=null}clear(){this.head=this.tail=null}insertBefore(e,t){t.prev=e.prev,t.next=e,t.prev?t.prev.next=t:this.head=t,e.prev=t}insertAfter(e,t){t.prev=e,t.next=e.next,t.next?t.next.prev=t:this.tail=t,e.next=t}add(e){this.head?this.tail.next=e:this.head=e,e.prev=this.tail,e.next=null,this.tail=e}addAll(e){for(this.head?this.tail.next=e:this.head=e,e.prev=this.tail;e.next;)e=e.next;this.tail=e}remove(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev}removeChain(e,t){e.prev?e.prev.next=t.next:this.head=t.next,t.next?t.next.prev=e.prev:this.tail=e.prev}first(){return this.head}isEmpty(){return!this.head}};bO.exports=A1});var wO=G((r6e,vO)=>{var T1=class{constructor(e,t){this.point=e,this.index=t,this.next=null,this.prev=null,this.face=null}};vO.exports=T1});var _O=G((n6e,EO)=>{var Vne=C0(),Wne=O0(),C1=class{constructor(e,t){this.vertex=e,this.face=t,this.next=null,this.prev=null,this.opposite=null}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){return this.tail()?Vne(this.tail().point,this.head().point):-1}lengthSquared(){return this.tail()?Wne(this.tail().point,this.head().point):-1}setOpposite(e){this.opposite=e,e.opposite=this}};EO.exports=C1});var IO=G((i6e,SO)=>{var M1=A0(),$ne=T0(),jne=cl(),N1=Xu(),Hne=M0(),Zne=Bf(),yp=L0(),R1=Wu(),L1=_O(),PO=0,Kne=1,O1=2,Ec=class{constructor(){this.normal=[],this.centroid=[],this.offset=0,this.outside=null,this.mark=PO,this.edge=null,this.nVertices=0}getEdge(e){if(typeof e!="number")throw Error("requires a number");let t=this.edge;for(;e>0;)t=t.next,e-=1;for(;e<0;)t=t.prev,e+=1;return t}computeNormal(){let e=this.edge,t=e.next,n=t.next,i=R1([],t.head().point,e.head().point),s=[],o=[];for(this.nVertices=2,this.normal=[0,0,0];n!==e;)$ne(o,i),R1(i,n.head().point,e.head().point),M1(this.normal,this.normal,jne(s,o,i)),n=n.next,this.nVertices+=1;this.area=Hne(this.normal),this.normal=yp(this.normal,this.normal,1/this.area)}computeNormalMinArea(e){if(this.computeNormal(),this.area<e){let t,n=0,i=this.edge;do{let c=i.lengthSquared();c>n&&(t=i,n=c),i=i.next}while(i!==this.edge);let s=t.tail().point,o=t.head().point,a=R1([],o,s),l=Math.sqrt(n);yp(a,a,1/l);let u=N1(this.normal,a);yp(a,a,-u),M1(this.normal,this.normal,a),Zne(this.normal,this.normal)}}computeCentroid(){this.centroid=[0,0,0];let e=this.edge;do M1(this.centroid,this.centroid,e.head().point),e=e.next;while(e!==this.edge);yp(this.centroid,this.centroid,1/this.nVertices)}computeNormalAndCentroid(e){typeof e<"u"?this.computeNormalMinArea(e):this.computeNormal(),this.computeCentroid(),this.offset=N1(this.normal,this.centroid)}distanceToPlane(e){return N1(this.normal,e)-this.offset}connectHalfEdges(e,t){let n;if(e.opposite.face===t.opposite.face){let i=t.opposite.face,s;e===this.edge&&(this.edge=t),i.nVertices===3?(s=t.opposite.prev.opposite,i.mark=O1,n=i):(s=t.opposite.next,i.edge===s.prev&&(i.edge=s),s.prev=s.prev.prev,s.prev.next=s),t.prev=e.prev,t.prev.next=t,t.setOpposite(s),i.computeNormalAndCentroid()}else e.next=t,t.prev=e;return n}mergeAdjacentFaces(e,t){let n=e.opposite,i=n.face;t.push(i),i.mark=O1;let s=e.prev,o=e.next,a=n.prev,l=n.next;for(;s.opposite.face===i;)s=s.prev,l=l.next;for(;o.opposite.face===i;)o=o.next,a=a.prev;let u;for(u=l;u!==a.next;u=u.next)u.face=this;this.edge=o;let c;return c=this.connectHalfEdges(a,o),c&&t.push(c),c=this.connectHalfEdges(s,l),c&&t.push(c),this.computeNormalAndCentroid(),t}collectIndices(){let e=[],t=this.edge;do e.push(t.head().index),t=t.next;while(t!==this.edge);return e}static createTriangle(e,t,n,i=0){let s=new Ec,o=new L1(e,s),a=new L1(t,s),l=new L1(n,s);return o.next=l.prev=a,a.next=o.prev=l,l.next=a.prev=o,s.edge=o,s.computeNormalAndCentroid(i),s}};SO.exports={VISIBLE:PO,NON_CONVEX:Kne,DELETED:O1,Face:Ec}});var MO=G((s6e,CO)=>{var k1=Xu(),Qne=pO(),Jne=xO(),BO=yO(),eie=wO(),{Face:ys,VISIBLE:Ll,NON_CONVEX:AO,DELETED:tie}=IO(),rie=1,TO=2,U1=class{constructor(e){if(!Array.isArray(e))throw TypeError("input is not a valid array");if(e.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.nFaces=0,this.nPoints=e.length,this.faces=[],this.newFaces=[],this.claimed=new BO,this.unclaimed=new BO,this.vertices=[];for(let t=0;t<e.length;t+=1)this.vertices.push(new eie(e[t],t));this.discardedFaces=[],this.vertexPointIndices=[]}addVertexToFace(e,t){e.face=t,t.outside?this.claimed.insertBefore(t.outside,e):this.claimed.add(e),t.outside=e}removeVertexFromFace(e,t){e===t.outside&&(e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.claimed.remove(e)}removeAllVerticesFromFace(e){if(e.outside){let t=e.outside;for(;t.next&&t.next.face===e;)t=t.next;return this.claimed.removeChain(e.outside,t),t.next=null,e.outside}}deleteFaceVertices(e,t){let n=this.removeAllVerticesFromFace(e);if(n)if(!t)this.unclaimed.addAll(n);else{let i;for(let s=n;s;s=i)i=s.next,t.distanceToPlane(s.point)>this.tolerance?this.addVertexToFace(s,t):this.unclaimed.add(s)}}resolveUnclaimedPoints(e){let t=this.unclaimed.first();for(let n=t;n;n=t){t=n.next;let i=this.tolerance,s;for(let o=0;o<e.length;o+=1){let a=e[o];if(a.mark===Ll){let l=a.distanceToPlane(n.point);if(l>i&&(i=l,s=a),i>1e3*this.tolerance)break}}s&&this.addVertexToFace(n,s)}}computeExtremes(){let e=[],t=[],n=[],i=[],s,o;for(s=0;s<3;s+=1)n[s]=i[s]=this.vertices[0];for(s=0;s<3;s+=1)e[s]=t[s]=this.vertices[0].point[s];for(s=1;s<this.vertices.length;s+=1){let a=this.vertices[s],l=a.point;for(o=0;o<3;o+=1)l[o]<e[o]&&(e[o]=l[o],n[o]=a);for(o=0;o<3;o+=1)l[o]>t[o]&&(t[o]=l[o],i[o]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e[0]),Math.abs(t[0]))+Math.max(Math.abs(e[1]),Math.abs(t[1]))+Math.max(Math.abs(e[2]),Math.abs(t[2]))),[n,i]}createInitialSimplex(){let e=this.vertices,[t,n]=this.computeExtremes(),i,s,o,a,l=0,u=0;for(o=0;o<3;o+=1){let p=n[o].point[o]-t[o].point[o];p>l&&(l=p,u=o)}let c=t[u],h=n[u];for(l=0,o=0;o<this.vertices.length;o+=1){let p=this.vertices[o];if(p!==c&&p!==h){let g=Qne(p.point,c.point,h.point);g>l&&(l=g,i=p)}}let f=Jne([],c.point,h.point,i.point),d=k1(c.point,f);for(l=-1,o=0;o<this.vertices.length;o+=1){let p=this.vertices[o];if(p!==c&&p!==h&&p!==i){let g=Math.abs(k1(f,p.point)-d);g>l&&(l=g,s=p)}}let m=[];if(k1(s.point,f)-d<0)for(m.push(ys.createTriangle(c,h,i),ys.createTriangle(s,h,c),ys.createTriangle(s,i,h),ys.createTriangle(s,c,i)),o=0;o<3;o+=1){let p=(o+1)%3;m[o+1].getEdge(2).setOpposite(m[0].getEdge(p)),m[o+1].getEdge(1).setOpposite(m[p+1].getEdge(0))}else for(m.push(ys.createTriangle(c,i,h),ys.createTriangle(s,c,h),ys.createTriangle(s,h,i),ys.createTriangle(s,i,c)),o=0;o<3;o+=1){let p=(o+1)%3;m[o+1].getEdge(2).setOpposite(m[0].getEdge((3-o)%3)),m[o+1].getEdge(0).setOpposite(m[p+1].getEdge(1))}for(o=0;o<4;o+=1)this.faces.push(m[o]);for(o=0;o<e.length;o+=1){let p=e[o];if(p!==c&&p!==h&&p!==i&&p!==s){l=this.tolerance;let g;for(a=0;a<4;a+=1){let b=m[a].distanceToPlane(p.point);b>l&&(l=b,g=m[a])}g&&this.addVertexToFace(p,g)}}}reindexFaceAndVertices(){let e=[];for(let t=0;t<this.faces.length;t+=1){let n=this.faces[t];n.mark===Ll&&e.push(n)}this.faces=e}collectFaces(e){let t=[];for(let n=0;n<this.faces.length;n+=1){if(this.faces[n].mark!==Ll)throw Error("attempt to include a destroyed face in the hull");let i=this.faces[n].collectIndices();if(e)t.push(i);else for(let s=0;s<i.length-2;s+=1)t.push([i[0],i[s+1],i[s+2]])}return t}nextVertexToAdd(){if(!this.claimed.isEmpty()){let e,t,n=0,i=this.claimed.first().face;for(t=i.outside;t&&t.face===i;t=t.next){let s=i.distanceToPlane(t.point);s>n&&(n=s,e=t)}return e}}computeHorizon(e,t,n,i){this.deleteFaceVertices(n),n.mark=tie;let s;t?s=t.next:s=t=n.getEdge(0);do{let o=s.opposite,a=o.face;a.mark===Ll&&(a.distanceToPlane(e)>this.tolerance?this.computeHorizon(e,o,a,i):i.push(s)),s=s.next}while(s!==t)}addAdjoiningFace(e,t){let n=ys.createTriangle(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setOpposite(t.opposite),n.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let n,i;for(let s=0;s<t.length;s+=1){let o=t[s],a=this.addAdjoiningFace(e,o);n?a.next.setOpposite(i):n=a,this.newFaces.push(a.face),i=a}n.next.setOpposite(i)}oppositeFaceDistance(e){return e.face.distanceToPlane(e.opposite.face.centroid)}doAdjacentMerge(e,t){let n=e.edge,i=!0,s=0;do{if(s>=e.nVertices)throw Error("merge recursion limit exceeded");let o=n.opposite.face,a=!1;if(t===TO?(this.oppositeFaceDistance(n)>-this.tolerance||this.oppositeFaceDistance(n.opposite)>-this.tolerance)&&(a=!0):e.area>o.area?this.oppositeFaceDistance(n)>-this.tolerance?a=!0:this.oppositeFaceDistance(n.opposite)>-this.tolerance&&(i=!1):this.oppositeFaceDistance(n.opposite)>-this.tolerance?a=!0:this.oppositeFaceDistance(n)>-this.tolerance&&(i=!1),a){let l=e.mergeAdjacentFaces(n,[]);for(let u=0;u<l.length;u+=1)this.deleteFaceVertices(l[u],e);return!0}n=n.next,s+=1}while(n!==e.edge);return i||(e.mark=AO),!1}addVertexToHull(e){let t=[];this.unclaimed.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t);for(let n=0;n<this.newFaces.length;n+=1){let i=this.newFaces[n];if(i.mark===Ll)for(;this.doAdjacentMerge(i,rie););}for(let n=0;n<this.newFaces.length;n+=1){let i=this.newFaces[n];if(i.mark===AO)for(i.mark=Ll;this.doAdjacentMerge(i,TO););}this.resolveUnclaimedPoints(this.newFaces)}build(){let e;for(this.createInitialSimplex();e=this.nextVertexToAdd();)this.addVertexToHull(e);this.reindexFaceAndVertices()}};CO.exports=U1});var RO=G((o6e,NO)=>{var nie=MO(),iie=(r,e={})=>{let t=new nie(r);return t.build(),t.collectFaces(e.skipTriangulation)};NO.exports=iie});var OO=G((a6e,LO)=>{var sie=Ke(),oie=nt(),aie=xt(),lie=RO(),uie=bp(),cie=(...r)=>{if(r=sie(r),r.length===1)return r[0];let e=uie(r),n=lie(e,{skipTriangulation:!0}).map(i=>{let s=i.map(o=>e[o]);return aie.create(s)});return oie.create(n)};LO.exports=cie});var D1=G((l6e,kO)=>{var hie=Ke(),die=Il(),fie=rt(),pie=nt(),mie=kt(),gie=aO(),xie=cO(),bie=OO(),yie=(...r)=>{if(r=hie(r),r.length===0)throw new Error("wrong number of arguments");if(!die(r))throw new Error("only hulls of the same type are supported");let e=r[0];return mie.isA(e)?gie(r):fie.isA(e)?xie(r):pie.isA(e)?bie(r):e};kO.exports=yie});var DO=G((u6e,UO)=>{var vie=Ke(),wie=pp(),Eie=D1(),_ie=(...r)=>{if(r=vie(r),r.length<2)throw new Error("wrong number of arguments");let e=[];for(let t=1;t<r.length;t++)e.push(Eie(r[t-1],r[t]));return wie(e)};UO.exports=_ie});var FO=G((c6e,GO)=>{GO.exports={hull:D1(),hullChain:DO()}});var F1=G((h6e,zO)=>{var G1=Ye(),qO=xt(),Pie=(r,e)=>{let t=Math.abs(qO.measureArea(e));return Number.isFinite(t)&&t>r},Sie=(r,e)=>{let t=e.map(i=>{let s=i.vertices.map(l=>G1.snap(G1.create(),l,r)),o=[];for(let l=0;l<s.length;l++){let u=(l+1)%s.length;G1.equals(s[l],s[u])||o.push(s[l])}let a=qO.create(o);return i.color&&(a.color=i.color),a}),n=r*r*Math.sqrt(3)/4;return t=t.filter(i=>Pie(n,i)),t};zO.exports=Sie});var VO=G((d6e,XO)=>{var Iie=ic(),Ol=Ye(),vp=xt(),Bie=r=>{let e=vp.toPoints(r),t=[];for(let n=0;n<e.length;n++){let i=(n+1)%e.length,s={v1:e[n],v2:e[i]};t.push(s)}for(let n=0;n<t.length;n++){let i=(n+1)%e.length;t[n].next=t[i],t[i].prev=t[n]}return t},Aie=(r,e)=>{let t=`${e.v1}:${e.v2}`;r.set(t,e)},q1=(r,e)=>{let t=`${e.v1}:${e.v2}`;r.delete(t)},Tie=(r,e)=>{let t=`${e.v2}:${e.v1}`;return r.get(t)},Cie=(r,e,t)=>{let n=r.prev.v1,i=r.prev.v2,s=e.next.v2,o=YO(n,i,s,t);n=e.prev.v1,i=e.prev.v2,s=r.next.v2;let a=YO(n,i,s,t);return[o,a]},Mie=Ol.create(),Nie=Ol.create(),YO=(r,e,t,n)=>{let i=Ol.subtract(Mie,e,r),s=Ol.subtract(Nie,t,e);return Ol.cross(i,i,s),Ol.dot(i,n)},Rie=r=>{let e,t=[];for(;r.next;){let n=r.next;t.push(r.v1),r.v1=null,r.v2=null,r.next=null,r.prev=null,r=n}return t.length>0&&(e=vp.create(t)),e},Lie=r=>{if(r.length<2)return r;let e=r[0].plane,t=r.slice(),n=new Map;for(;t.length>0;){let s=t.shift(),o=Bie(s);for(let a=0;a<o.length;a++){let l=o[a],u=Tie(n,l);if(u){let c=Cie(l,u,e);if(c[0]>=0&&c[1]>=0){let h=u.next,f=l.next;l.prev.next=u.next,l.next.prev=u.prev,u.prev.next=l.next,u.next.prev=l.prev,l.v1=null,l.v2=null,l.next=null,l.prev=null,q1(n,u),u.v1=null,u.v2=null,u.next=null,u.prev=null;let d=(m,p,g)=>{let b={v1:g.v1,v2:p.v2,next:p.next,prev:g.prev};g.prev.next=b,p.next.prev=b,q1(m,p),p.v1=null,p.v2=null,p.next=null,p.prev=null,q1(m,g),g.v1=null,g.v2=null,g.next=null,g.prev=null};c[0]===0&&d(n,h,h.prev),c[1]===0&&d(n,f,f.prev)}}else l.next&&Aie(n,l)}}let i=[];return n.forEach(s=>{let o=Rie(s);o&&i.push(o)}),n.clear(),i},Oie=(r,e)=>Math.abs(r[3]-e[3])<15e-8?Iie(r,e):!1,kie=(r,e)=>{let t=[];e.forEach(i=>{let s=t.find(o=>Oie(o[0],vp.plane(i)));s?s[1].push(i):t.push([vp.plane(i),[i]])});let n=[];return t.forEach(i=>{let s=i[1],o=Lie(s);n=n.concat(o)}),n};XO.exports=kie});var HO=G((f6e,jO)=>{var WO=bt(),Gi=Ye(),Uie=xt(),co=!1,Xr=r=>`${r}`,$O=(r,e,t,n,i,s)=>{let o=Xr(n),a=Xr(i);if(co&&o===a)throw new Error("assert failed");let l=`${o}/${a}`,u=`${a}/${o}`;if(r.has(u))return wp(r,e,t,i,n,null),null;let c={vertex0:n,vertex1:i,polygonindex:s};return r.has(l)?r.get(l).push(c):r.set(l,[c]),e.has(o)?e.get(o).push(l):e.set(o,[l]),t.has(a)?t.get(a).push(l):t.set(a,[l]),l},wp=(r,e,t,n,i,s)=>{let o=Xr(n),a=Xr(i),l=`${o}/${a}`;if(co&&!r.has(l))throw new Error("assert failed");let u=-1,c=r.get(l);for(let h=0;h<c.length;h++){let f=c[h],d=Xr(f.vertex0);if(d===o&&(d=Xr(f.vertex1),d===a&&!(s!==null&&f.polygonindex!==s))){u=h;break}}if(co&&u<0)throw new Error("assert failed");if(c.splice(u,1),c.length===0&&r.delete(l),u=e.get(o).indexOf(l),co&&u<0)throw new Error("assert failed");if(e.get(o).splice(u,1),e.get(o).length===0&&e.delete(o),u=t.get(a).indexOf(l),co&&u<0)throw new Error("assert failed");t.get(a).splice(u,1),t.get(a).length===0&&t.delete(a)},Die=r=>{let e=new Map;for(let t=0;t<r.length;t++){let n=r[t],i=n.vertices.length;if(i>=3){let s=n.vertices[0],o=Xr(s);for(let a=0;a<i;a++){let l=a+1;l===i&&(l=0);let u=n.vertices[l],c=Xr(u),h=`${o}/${c}`,f=`${c}/${o}`;if(e.has(f)){let d=e.get(f);d.splice(-1,1),d.length===0&&e.delete(f)}else{let d={vertex0:s,vertex1:u,polygonindex:t};e.has(h)?e.get(h).push(d):e.set(h,[d])}s=u,o=c}}else console.warn("warning: invalid polygon found during insertTjunctions")}if(e.size>0){let t=new Map,n=new Map,i=new Map;for(let[o,a]of e)i.set(o,!0),a.forEach(l=>{let u=Xr(l.vertex0),c=Xr(l.vertex1);t.has(u)?t.get(u).push(o):t.set(u,[o]),n.has(c)?n.get(c).push(o):n.set(c,[o])});let s=r.slice(0);for(;e.size!==0;){for(let a of e.keys())i.set(a,!0);let o=!1;for(;;){let a=Array.from(i.keys());if(a.length===0)break;let l=a[0],u=!0;if(e.has(l)){let c=e.get(l);if(co&&c.length===0)throw new Error("assert failed");let h=c[0];for(let f=0;f<2;f++){let d=f===0?h.vertex0:h.vertex1,m=f===0?h.vertex1:h.vertex0,p=Xr(d),g=Xr(m),b=[];f===0?n.has(p)&&(b=n.get(p)):t.has(p)&&(b=t.get(p));for(let v=0;v<b.length;v++){let w=b[v],P=e.get(w)[0],_=f===0?P.vertex0:P.vertex1,B=f===0?P.vertex1:P.vertex0,I=Xr(_),C=Xr(B);if(co&&C!==p)throw new Error("assert failed");if(I===g){wp(e,t,n,d,m,null),wp(e,t,n,m,d,null),u=!1,f=2,o=!0;break}else{let N=d,A=m,M=_,S=Gi.subtract(Gi.create(),M,N),$=Gi.dot(Gi.subtract(Gi.create(),A,N),S)/Gi.dot(S,S);if($>0&&$<1){let H=Gi.scale(Gi.create(),S,$);if(Gi.add(H,H,N),Gi.squaredDistance(H,A)<WO.EPS*WO.EPS){let F=P.polygonindex,z=s[F],L=Xr(P.vertex1),k=-1;for(let oe=0;oe<z.vertices.length;oe++)if(Xr(z.vertices[oe])===L){k=oe;break}if(co&&k<0)throw new Error("assert failed");let O=z.vertices.slice(0);O.splice(k,0,m);let ie=Uie.create(O);s[F]=ie,wp(e,t,n,P.vertex0,P.vertex1,F);let W=$O(e,t,n,P.vertex0,m,F),Q=$O(e,t,n,m,P.vertex1,F);W!==null&&i.set(W,!0),Q!==null&&i.set(Q,!0),u=!1,f=2,o=!0;break}}}}}}u&&i.delete(l)}if(!o)break}r=s}return e.clear(),r};jO.exports=Die});var KO=G((p6e,ZO)=>{var z1=Ye(),Y1=xt(),Gie=(r,e,t)=>{let n=e.vertices.length;if(n>3){if(n>4){let o=[0,0,0];e.vertices.forEach(a=>z1.add(o,o,a)),z1.snap(o,z1.divide(o,o,[n,n,n]),r);for(let a=0;a<n;a++){let l=Y1.create([o,e.vertices[a],e.vertices[(a+1)%n]]);e.color&&(l.color=e.color),t.push(l)}return}let i=Y1.create([e.vertices[0],e.vertices[1],e.vertices[2]]),s=Y1.create([e.vertices[0],e.vertices[2],e.vertices[3]]);e.color&&(i.color=e.color,s.color=e.color),t.push(i,s);return}t.push(e)},Fie=(r,e)=>{let t=[];return e.forEach(n=>{Gie(r,n,t)}),t};ZO.exports=Fie});var e4=G((m6e,JO)=>{var qie=Ke(),zie=gs(),Yie=rt(),QO=nt(),Xie=kt(),Vie=F1(),Wie=VO(),$ie=HO(),jie=KO(),Hie=(r,e)=>e,Zie=(r,e)=>e,Kie=(r,e)=>{let t={snap:!1,simplify:!1,triangulate:!1},{snap:n,simplify:i,triangulate:s}=Object.assign({},t,r),o=zie(e),a=QO.toPolygons(e);n&&(a=Vie(o,a)),i&&(a=Wie(o,a)),s&&(a=$ie(a),a=jie(o,a));let l=Object.assign({},e);return l.polygons=a,l},Qie=(r,...e)=>{if(e=qie(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>{if(Xie.isA(n))return Hie(r,n);if(Yie.isA(n))return Zie(r,n);if(QO.isA(n))return Kie(r,n);throw new Error("invalid geometry")});return t.length===1?t[0]:t};JO.exports=Qie});var r4=G((g6e,t4)=>{var Jie=Ke(),ea=st(),X1=rt(),V1=nt(),W1=kt(),$1=gs(),ese=F1(),tse=r=>{let e=$1(r),n=W1.toPoints(r).map(i=>ea.snap(ea.create(),i,e));return W1.create(n)},rse=r=>{let e=$1(r),n=X1.toSides(r).map(i=>[ea.snap(ea.create(),i[0],e),ea.snap(ea.create(),i[1],e)]);return n=n.filter(i=>!ea.equals(i[0],i[1])),X1.create(n)},nse=r=>{let e=$1(r),t=V1.toPolygons(r),n=ese(e,t);return V1.create(n)},ise=(...r)=>{if(r=Jie(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>W1.isA(t)?tse(t):X1.isA(t)?rse(t):V1.isA(t)?nse(t):t);return e.length===1?e[0]:e};t4.exports=ise});var i4=G((x6e,n4)=>{n4.exports={generalize:e4(),snap:r4()}});var o4=G((b6e,s4)=>{var sse=(r,e,t)=>{for(r=r.slice();r.length<t;)r.push(e);return r};s4.exports=sse});var h4=G((y6e,c4)=>{var ose=Ke(),a4=o4(),l4=qf(),{translate:ase}=ao(),lse=r=>{if(!Array.isArray(r.modes)||r.modes.length>3)throw new Error("align(): modes must be an array of length <= 3");if(r.modes=a4(r.modes,"none",3),r.modes.filter(e=>["center","max","min","none"].includes(e)).length!==3)throw new Error('align(): all modes must be one of "center", "max" or "min"');if(!Array.isArray(r.relativeTo)||r.relativeTo.length>3)throw new Error("align(): relativeTo must be an array of length <= 3");if(r.relativeTo=a4(r.relativeTo,0,3),r.relativeTo.filter(e=>Number.isFinite(e)||e==null).length!==3)throw new Error("align(): all relativeTo values must be a number, or null.");if(typeof r.grouped!="boolean")throw new Error("align(): grouped must be a boolean value.");return r},use=(r,e,t)=>{for(let n=0;n<3;n++)r[n]==null&&(e[n]==="center"?r[n]=(t[0][n]+t[1][n])/2:e[n]==="max"?r[n]=t[1][n]:e[n]==="min"&&(r[n]=t[0][n]));return r},u4=(r,e,t)=>{let n=l4(r),i=[0,0,0];for(let s=0;s<3;s++)e[s]==="center"?i[s]=t[s]-(n[0][s]+n[1][s])/2:e[s]==="max"?i[s]=t[s]-n[1][s]:e[s]==="min"&&(i[s]=t[s]-n[0][s]);return ase(i,r)},cse=(r,...e)=>{r=Object.assign({},{modes:["center","center","min"],relativeTo:[0,0,0],grouped:!1},r),r=lse(r);let{modes:n,relativeTo:i,grouped:s}=r;if(e=ose(e),e.length===0)throw new Error("align(): No geometries were provided to act upon");if(i.filter(o=>o==null).length){let o=l4(e);i=use(i,n,o)}return s?e=u4(e,n,i):e=e.map(o=>u4(o,n,i)),e.length===1?e[0]:e};c4.exports=cse});var _c=G((v6e,d4)=>{var hse=Ke(),dse=rt(),fse=nt(),pse=kt(),mse=to(),{translate:gse}=ao(),j1=(r,e)=>{let t={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:n,relativeTo:i}=Object.assign({},t,r),s=mse(e),o=[0,0,0];return n[0]&&(o[0]=i[0]-(s[0][0]+(s[1][0]-s[0][0])/2)),n[1]&&(o[1]=i[1]-(s[0][1]+(s[1][1]-s[0][1])/2)),n[2]&&(o[2]=i[2]-(s[0][2]+(s[1][2]-s[0][2])/2)),gse(o,e)},Ep=(r,...e)=>{let t={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:n,relativeTo:i}=Object.assign({},t,r);if(e=hse(e),e.length===0)throw new Error("wrong number of arguments");if(i.length!==3)throw new Error("relativeTo must be an array of length 3");r={axes:n,relativeTo:i};let s=e.map(o=>pse.isA(o)||dse.isA(o)||fse.isA(o)?j1(r,o):o);return s.length===1?s[0]:s},xse=(...r)=>Ep({axes:[!0,!1,!1]},r),bse=(...r)=>Ep({axes:[!1,!0,!1]},r),yse=(...r)=>Ep({axes:[!1,!1,!0]},r);d4.exports={center:Ep,centerX:xse,centerY:bse,centerZ:yse}});var Pc=G((w6e,x4)=>{var vse=Ke(),f4=Gt(),p4=rt(),m4=nt(),g4=kt(),_p=(r,...e)=>{if(!Array.isArray(r))throw new Error("factors must be an array");if(e=vse(e),e.length===0)throw new Error("wrong number of arguments");for(r=r.slice();r.length<3;)r.push(1);if(r[0]<=0||r[1]<=0||r[2]<=0)throw new Error("factors must be positive");let t=f4.fromScaling(f4.create(),r),n=e.map(i=>g4.isA(i)?g4.transform(t,i):p4.isA(i)?p4.transform(t,i):m4.isA(i)?m4.transform(t,i):i);return n.length===1?n[0]:n},wse=(r,...e)=>_p([r,1,1],e),Ese=(r,...e)=>_p([1,r,1],e),_se=(r,...e)=>_p([1,1,r],e);x4.exports={scale:_p,scaleX:wse,scaleY:Ese,scaleZ:_se}});var E4=G((E6e,w4)=>{var Pse=Ke(),b4=rt(),y4=nt(),v4=kt(),Sse=(r,...e)=>{if(e=Pse(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>v4.isA(n)?v4.transform(r,n):b4.isA(n)?b4.transform(r,n):y4.isA(n)?y4.transform(r,n):n);return t.length===1?t[0]:t};w4.exports=Sse});var P4=G((_6e,_4)=>{_4.exports={align:h4(),center:_c().center,centerX:_c().centerX,centerY:_c().centerY,centerZ:_c().centerZ,mirror:vl().mirror,mirrorX:vl().mirrorX,mirrorY:vl().mirrorY,mirrorZ:vl().mirrorZ,rotate:_l().rotate,rotateX:_l().rotateX,rotateY:_l().rotateY,rotateZ:_l().rotateZ,scale:Pc().scale,scaleX:Pc().scaleX,scaleY:Pc().scaleY,scaleZ:Pc().scaleZ,transform:E4(),translate:ao().translate,translateX:ao().translateX,translateY:ao().translateY,translateZ:ao().translateZ}});var I4=G((P6e,S4)=>{S4.exports={colors:YA(),curves:rT(),geometries:Of(),maths:IC(),measurements:uM(),primitives:GN(),text:jN(),utils:c1(),booleans:aL(),expansions:RL(),extrusions:JL(),hulls:FO(),modifiers:i4(),transforms:P4()}});var M4=G((S6e,Q1)=>{"use strict";Q1.exports=Pp,Q1.exports.default=Pp;function Pp(r,e,t){t=t||2;var n=e&&e.length,i=n?e[0]*t:r.length,s=B4(r,0,i,t,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,u,c,h,f,d;if(n&&(s=Cse(r,e,s,t)),r.length>80*t){a=u=r[0],l=c=r[1];for(var m=t;m<i;m+=t)h=r[m],f=r[m+1],h<a&&(a=h),f<l&&(l=f),h>u&&(u=h),f>c&&(c=f);d=Math.max(u-a,c-l),d=d!==0?32767/d:0}return Sc(s,o,t,a,l,d,0),o}function B4(r,e,t,n,i){var s,o;if(i===K1(r,e,t,n)>0)for(s=e;s<t;s+=n)o=C4(s,r[s],r[s+1],o);else for(s=t-n;s>=e;s-=n)o=C4(s,r[s],r[s+1],o);return o&&Sp(o,o.next)&&(Bc(o),o=o.next),o}function ta(r,e){if(!r)return r;e||(e=r);var t=r,n;do if(n=!1,!t.steiner&&(Sp(t,t.next)||rr(t.prev,t,t.next)===0)){if(Bc(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Sc(r,e,t,n,i,s,o){if(!!r){!o&&s&&Ose(r,n,i,s);for(var a=r,l,u;r.prev!==r.next;){if(l=r.prev,u=r.next,s?Bse(r,n,i,s):Ise(r)){e.push(l.i/t|0),e.push(r.i/t|0),e.push(u.i/t|0),Bc(r),r=u.next,a=u.next;continue}if(r=u,r===a){o?o===1?(r=Ase(ta(r),e,t),Sc(r,e,t,n,i,s,2)):o===2&&Tse(r,e,t,n,i,s):Sc(ta(r),e,t,n,i,s,1);break}}}}function Ise(r){var e=r.prev,t=r,n=r.next;if(rr(e,t,n)>=0)return!1;for(var i=e.x,s=t.x,o=n.x,a=e.y,l=t.y,u=n.y,c=i<s?i<o?i:o:s<o?s:o,h=a<l?a<u?a:u:l<u?l:u,f=i>s?i>o?i:o:s>o?s:o,d=a>l?a>u?a:u:l>u?l:u,m=n.next;m!==e;){if(m.x>=c&&m.x<=f&&m.y>=h&&m.y<=d&&kl(i,a,s,l,o,u,m.x,m.y)&&rr(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Bse(r,e,t,n){var i=r.prev,s=r,o=r.next;if(rr(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,u=o.x,c=i.y,h=s.y,f=o.y,d=a<l?a<u?a:u:l<u?l:u,m=c<h?c<f?c:f:h<f?h:f,p=a>l?a>u?a:u:l>u?l:u,g=c>h?c>f?c:f:h>f?h:f,b=H1(d,m,e,t,n),v=H1(p,g,e,t,n),w=r.prevZ,P=r.nextZ;w&&w.z>=b&&P&&P.z<=v;){if(w.x>=d&&w.x<=p&&w.y>=m&&w.y<=g&&w!==i&&w!==o&&kl(a,c,l,h,u,f,w.x,w.y)&&rr(w.prev,w,w.next)>=0||(w=w.prevZ,P.x>=d&&P.x<=p&&P.y>=m&&P.y<=g&&P!==i&&P!==o&&kl(a,c,l,h,u,f,P.x,P.y)&&rr(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;w&&w.z>=b;){if(w.x>=d&&w.x<=p&&w.y>=m&&w.y<=g&&w!==i&&w!==o&&kl(a,c,l,h,u,f,w.x,w.y)&&rr(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;P&&P.z<=v;){if(P.x>=d&&P.x<=p&&P.y>=m&&P.y<=g&&P!==i&&P!==o&&kl(a,c,l,h,u,f,P.x,P.y)&&rr(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function Ase(r,e,t){var n=r;do{var i=n.prev,s=n.next.next;!Sp(i,s)&&A4(i,n,n.next,s)&&Ic(i,s)&&Ic(s,i)&&(e.push(i.i/t|0),e.push(n.i/t|0),e.push(s.i/t|0),Bc(n),Bc(n.next),n=r=s),n=n.next}while(n!==r);return ta(n)}function Tse(r,e,t,n,i,s){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&Dse(o,a)){var l=T4(o,a);o=ta(o,o.next),l=ta(l,l.next),Sc(o,e,t,n,i,s,0),Sc(l,e,t,n,i,s,0);return}a=a.next}o=o.next}while(o!==r)}function Cse(r,e,t,n){var i=[],s,o,a,l,u;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:r.length,u=B4(r,a,l,n,!1),u===u.next&&(u.steiner=!0),i.push(Use(u));for(i.sort(Mse),s=0;s<i.length;s++)t=Nse(i[s],t);return t}function Mse(r,e){return r.x-e.x}function Nse(r,e){var t=Rse(r,e);if(!t)return e;var n=T4(t,r);return ta(n,n.next),ta(t,t.next)}function Rse(r,e){var t=e,n=r.x,i=r.y,s=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var a=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=n&&a>s&&(s=a,o=t.x<t.next.x?t:t.next,a===n))return o}t=t.next}while(t!==e);if(!o)return null;var l=o,u=o.x,c=o.y,h=1/0,f;t=o;do n>=t.x&&t.x>=u&&n!==t.x&&kl(i<c?n:s,i,u,c,i<c?s:n,i,t.x,t.y)&&(f=Math.abs(i-t.y)/(n-t.x),Ic(t,r)&&(f<h||f===h&&(t.x>o.x||t.x===o.x&&Lse(o,t)))&&(o=t,h=f)),t=t.next;while(t!==l);return o}function Lse(r,e){return rr(r.prev,r,e.prev)<0&&rr(e.next,r,r.next)<0}function Ose(r,e,t,n){var i=r;do i.z===0&&(i.z=H1(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,kse(i)}function kse(r){var e,t,n,i,s,o,a,l,u=1;do{for(t=r,r=null,s=null,o=0;t;){for(o++,n=t,a=0,e=0;e<u&&(a++,n=n.nextZ,!!n);e++);for(l=u;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,a--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:r=i,i.prevZ=s,s=i;t=n}s.nextZ=null,u*=2}while(o>1);return r}function H1(r,e,t,n,i){return r=(r-t)*i|0,e=(e-n)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function Use(r){var e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function kl(r,e,t,n,i,s,o,a){return(i-o)*(e-a)>=(r-o)*(s-a)&&(r-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(i-o)*(n-a)}function Dse(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!Gse(r,e)&&(Ic(r,e)&&Ic(e,r)&&Fse(r,e)&&(rr(r.prev,r,e.prev)||rr(r,e.prev,e))||Sp(r,e)&&rr(r.prev,r,r.next)>0&&rr(e.prev,e,e.next)>0)}function rr(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Sp(r,e){return r.x===e.x&&r.y===e.y}function A4(r,e,t,n){var i=Bp(rr(r,e,t)),s=Bp(rr(r,e,n)),o=Bp(rr(t,n,r)),a=Bp(rr(t,n,e));return!!(i!==s&&o!==a||i===0&&Ip(r,t,e)||s===0&&Ip(r,n,e)||o===0&&Ip(t,r,n)||a===0&&Ip(t,e,n))}function Ip(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Bp(r){return r>0?1:r<0?-1:0}function Gse(r,e){var t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&A4(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function Ic(r,e){return rr(r.prev,r,r.next)<0?rr(r,e,r.next)>=0&&rr(r,r.prev,e)>=0:rr(r,e,r.prev)<0||rr(r,r.next,e)<0}function Fse(r,e){var t=r,n=!1,i=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n}function T4(r,e){var t=new Z1(r.i,r.x,r.y),n=new Z1(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function C4(r,e,t,n){var i=new Z1(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Bc(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Z1(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Pp.deviation=function(r,e,t,n){var i=e&&e.length,s=i?e[0]*t:r.length,o=Math.abs(K1(r,0,s,t));if(i)for(var a=0,l=e.length;a<l;a++){var u=e[a]*t,c=a<l-1?e[a+1]*t:r.length;o-=Math.abs(K1(r,u,c,t))}var h=0;for(a=0;a<n.length;a+=3){var f=n[a]*t,d=n[a+1]*t,m=n[a+2]*t;h+=Math.abs((r[f]-r[m])*(r[d+1]-r[f+1])-(r[f]-r[d])*(r[m+1]-r[f+1]))}return o===0&&h===0?0:Math.abs((h-o)/o)};function K1(r,e,t,n){for(var i=0,s=e,o=t-n;s<t;s+=n)i+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return i}Pp.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},n=0,i=0;i<r.length;i++){for(var s=0;s<r[i].length;s++)for(var o=0;o<e;o++)t.vertices.push(r[i][s][o]);i>0&&(n+=r[i-1].length,t.holes.push(n))}return t}});var Ia,Er,mt,sr,Ba,Ot,Bt,es,cr,Et,Is,oi,be,ai,hr,Bs,gD=Object.create,Hb=Object.defineProperty,xD=Object.getOwnPropertyDescriptor,bD=Object.getOwnPropertyNames,yD=Object.getPrototypeOf,vD=Object.prototype.hasOwnProperty,wD=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ED=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of bD(e))!vD.call(r,i)&&i!==t&&Hb(r,i,{get:()=>e[i],enumerable:!(n=xD(e,i))||n.enumerable});return r},_D=(r,e,t)=>(t=r!=null?gD(yD(r)):{},ED(e||!r||!r.__esModule?Hb(t,"default",{value:r,enumerable:!0}):t,r)),PD=wD((r,e)=>{"use strict";e.exports=t,e.exports.default=t;function t(L,k,O){O=O||2;var ie=k&&k.length,W=ie?k[0]*O:L.length,Q=n(L,0,W,O,!0),oe=[];if(!Q||Q.next===Q.prev)return oe;var we,xe,ge,Le,Ne,Ve,ht;if(ie&&(Q=c(L,k,Q,O)),L.length>80*O){we=ge=L[0],xe=Le=L[1];for(var R=O;R<W;R+=O)Ne=L[R],Ve=L[R+1],Ne<we&&(we=Ne),Ve<xe&&(xe=Ve),Ne>ge&&(ge=Ne),Ve>Le&&(Le=Ve);ht=Math.max(ge-we,Le-xe),ht=ht!==0?32767/ht:0}return s(Q,oe,O,we,xe,ht,0),oe}function n(L,k,O,ie,W){var Q,oe;if(W===z(L,k,O,ie)>0)for(Q=k;Q<O;Q+=ie)oe=H(Q,L[Q],L[Q+1],oe);else for(Q=O-ie;Q>=k;Q-=ie)oe=H(Q,L[Q],L[Q+1],oe);return oe&&B(oe,oe.next)&&(K(oe),oe=oe.next),oe}function i(L,k){if(!L)return L;k||(k=L);var O=L,ie;do if(ie=!1,!O.steiner&&(B(O,O.next)||_(O.prev,O,O.next)===0)){if(K(O),O=k=O.prev,O===O.next)break;ie=!0}else O=O.next;while(ie||O!==k);return k}function s(L,k,O,ie,W,Q,oe){if(L){!oe&&Q&&p(L,ie,W,Q);for(var we=L,xe,ge;L.prev!==L.next;){if(xe=L.prev,ge=L.next,Q?a(L,ie,W,Q):o(L)){k.push(xe.i/O|0),k.push(L.i/O|0),k.push(ge.i/O|0),K(L),L=ge.next,we=ge.next;continue}if(L=ge,L===we){oe?oe===1?(L=l(i(L),k,O),s(L,k,O,ie,W,Q,2)):oe===2&&u(L,k,O,ie,W,Q):s(i(L),k,O,ie,W,Q,1);break}}}}function o(L){var k=L.prev,O=L,ie=L.next;if(_(k,O,ie)>=0)return!1;for(var W=k.x,Q=O.x,oe=ie.x,we=k.y,xe=O.y,ge=ie.y,Le=W<Q?W<oe?W:oe:Q<oe?Q:oe,Ne=we<xe?we<ge?we:ge:xe<ge?xe:ge,Ve=W>Q?W>oe?W:oe:Q>oe?Q:oe,ht=we>xe?we>ge?we:ge:xe>ge?xe:ge,R=ie.next;R!==k;){if(R.x>=Le&&R.x<=Ve&&R.y>=Ne&&R.y<=ht&&w(W,we,Q,xe,oe,ge,R.x,R.y)&&_(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function a(L,k,O,ie){var W=L.prev,Q=L,oe=L.next;if(_(W,Q,oe)>=0)return!1;for(var we=W.x,xe=Q.x,ge=oe.x,Le=W.y,Ne=Q.y,Ve=oe.y,ht=we<xe?we<ge?we:ge:xe<ge?xe:ge,R=Le<Ne?Le<Ve?Le:Ve:Ne<Ve?Ne:Ve,pe=we>xe?we>ge?we:ge:xe>ge?xe:ge,he=Le>Ne?Le>Ve?Le:Ve:Ne>Ve?Ne:Ve,J=b(ht,R,k,O,ie),Z=b(pe,he,k,O,ie),se=L.prevZ,de=L.nextZ;se&&se.z>=J&&de&&de.z<=Z;){if(se.x>=ht&&se.x<=pe&&se.y>=R&&se.y<=he&&se!==W&&se!==oe&&w(we,Le,xe,Ne,ge,Ve,se.x,se.y)&&_(se.prev,se,se.next)>=0||(se=se.prevZ,de.x>=ht&&de.x<=pe&&de.y>=R&&de.y<=he&&de!==W&&de!==oe&&w(we,Le,xe,Ne,ge,Ve,de.x,de.y)&&_(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;se&&se.z>=J;){if(se.x>=ht&&se.x<=pe&&se.y>=R&&se.y<=he&&se!==W&&se!==oe&&w(we,Le,xe,Ne,ge,Ve,se.x,se.y)&&_(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;de&&de.z<=Z;){if(de.x>=ht&&de.x<=pe&&de.y>=R&&de.y<=he&&de!==W&&de!==oe&&w(we,Le,xe,Ne,ge,Ve,de.x,de.y)&&_(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function l(L,k,O){var ie=L;do{var W=ie.prev,Q=ie.next.next;!B(W,Q)&&I(W,ie,ie.next,Q)&&M(W,Q)&&M(Q,W)&&(k.push(W.i/O|0),k.push(ie.i/O|0),k.push(Q.i/O|0),K(ie),K(ie.next),ie=L=Q),ie=ie.next}while(ie!==L);return i(ie)}function u(L,k,O,ie,W,Q){var oe=L;do{for(var we=oe.next.next;we!==oe.prev;){if(oe.i!==we.i&&P(oe,we)){var xe=$(oe,we);oe=i(oe,oe.next),xe=i(xe,xe.next),s(oe,k,O,ie,W,Q,0),s(xe,k,O,ie,W,Q,0);return}we=we.next}oe=oe.next}while(oe!==L)}function c(L,k,O,ie){var W=[],Q,oe,we,xe,ge;for(Q=0,oe=k.length;Q<oe;Q++)we=k[Q]*ie,xe=Q<oe-1?k[Q+1]*ie:L.length,ge=n(L,we,xe,ie,!1),ge===ge.next&&(ge.steiner=!0),W.push(v(ge));for(W.sort(h),Q=0;Q<W.length;Q++)O=f(W[Q],O);return O}function h(L,k){return L.x-k.x}function f(L,k){var O=d(L,k);if(!O)return k;var ie=$(O,L);return i(ie,ie.next),i(O,O.next)}function d(L,k){var O=k,ie=L.x,W=L.y,Q=-1/0,oe;do{if(W<=O.y&&W>=O.next.y&&O.next.y!==O.y){var we=O.x+(W-O.y)*(O.next.x-O.x)/(O.next.y-O.y);if(we<=ie&&we>Q&&(Q=we,oe=O.x<O.next.x?O:O.next,we===ie))return oe}O=O.next}while(O!==k);if(!oe)return null;var xe=oe,ge=oe.x,Le=oe.y,Ne=1/0,Ve;O=oe;do ie>=O.x&&O.x>=ge&&ie!==O.x&&w(W<Le?ie:Q,W,ge,Le,W<Le?Q:ie,W,O.x,O.y)&&(Ve=Math.abs(W-O.y)/(ie-O.x),M(O,L)&&(Ve<Ne||Ve===Ne&&(O.x>oe.x||O.x===oe.x&&m(oe,O)))&&(oe=O,Ne=Ve)),O=O.next;while(O!==xe);return oe}function m(L,k){return _(L.prev,L,k.prev)<0&&_(k.next,L,L.next)<0}function p(L,k,O,ie){var W=L;do W.z===0&&(W.z=b(W.x,W.y,k,O,ie)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==L);W.prevZ.nextZ=null,W.prevZ=null,g(W)}function g(L){var k,O,ie,W,Q,oe,we,xe,ge=1;do{for(O=L,L=null,Q=null,oe=0;O;){for(oe++,ie=O,we=0,k=0;k<ge&&(we++,ie=ie.nextZ,!!ie);k++);for(xe=ge;we>0||xe>0&&ie;)we!==0&&(xe===0||!ie||O.z<=ie.z)?(W=O,O=O.nextZ,we--):(W=ie,ie=ie.nextZ,xe--),Q?Q.nextZ=W:L=W,W.prevZ=Q,Q=W;O=ie}Q.nextZ=null,ge*=2}while(oe>1);return L}function b(L,k,O,ie,W){return L=(L-O)*W|0,k=(k-ie)*W|0,L=(L|L<<8)&16711935,L=(L|L<<4)&252645135,L=(L|L<<2)&858993459,L=(L|L<<1)&1431655765,k=(k|k<<8)&16711935,k=(k|k<<4)&252645135,k=(k|k<<2)&858993459,k=(k|k<<1)&1431655765,L|k<<1}function v(L){var k=L,O=L;do(k.x<O.x||k.x===O.x&&k.y<O.y)&&(O=k),k=k.next;while(k!==L);return O}function w(L,k,O,ie,W,Q,oe,we){return(W-oe)*(k-we)>=(L-oe)*(Q-we)&&(L-oe)*(ie-we)>=(O-oe)*(k-we)&&(O-oe)*(Q-we)>=(W-oe)*(ie-we)}function P(L,k){return L.next.i!==k.i&&L.prev.i!==k.i&&!A(L,k)&&(M(L,k)&&M(k,L)&&S(L,k)&&(_(L.prev,L,k.prev)||_(L,k.prev,k))||B(L,k)&&_(L.prev,L,L.next)>0&&_(k.prev,k,k.next)>0)}function _(L,k,O){return(k.y-L.y)*(O.x-k.x)-(k.x-L.x)*(O.y-k.y)}function B(L,k){return L.x===k.x&&L.y===k.y}function I(L,k,O,ie){var W=N(_(L,k,O)),Q=N(_(L,k,ie)),oe=N(_(O,ie,L)),we=N(_(O,ie,k));return!!(W!==Q&&oe!==we||W===0&&C(L,O,k)||Q===0&&C(L,ie,k)||oe===0&&C(O,L,ie)||we===0&&C(O,k,ie))}function C(L,k,O){return k.x<=Math.max(L.x,O.x)&&k.x>=Math.min(L.x,O.x)&&k.y<=Math.max(L.y,O.y)&&k.y>=Math.min(L.y,O.y)}function N(L){return L>0?1:L<0?-1:0}function A(L,k){var O=L;do{if(O.i!==L.i&&O.next.i!==L.i&&O.i!==k.i&&O.next.i!==k.i&&I(O,O.next,L,k))return!0;O=O.next}while(O!==L);return!1}function M(L,k){return _(L.prev,L,L.next)<0?_(L,k,L.next)>=0&&_(L,L.prev,k)>=0:_(L,k,L.prev)<0||_(L,L.next,k)<0}function S(L,k){var O=L,ie=!1,W=(L.x+k.x)/2,Q=(L.y+k.y)/2;do O.y>Q!=O.next.y>Q&&O.next.y!==O.y&&W<(O.next.x-O.x)*(Q-O.y)/(O.next.y-O.y)+O.x&&(ie=!ie),O=O.next;while(O!==L);return ie}function $(L,k){var O=new F(L.i,L.x,L.y),ie=new F(k.i,k.x,k.y),W=L.next,Q=k.prev;return L.next=k,k.prev=L,O.next=W,W.prev=O,ie.next=O,O.prev=ie,Q.next=ie,ie.prev=Q,ie}function H(L,k,O,ie){var W=new F(L,k,O);return ie?(W.next=ie.next,W.prev=ie,ie.next.prev=W,ie.next=W):(W.prev=W,W.next=W),W}function K(L){L.next.prev=L.prev,L.prev.next=L.next,L.prevZ&&(L.prevZ.nextZ=L.nextZ),L.nextZ&&(L.nextZ.prevZ=L.prevZ)}function F(L,k,O){this.i=L,this.x=k,this.y=O,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}t.deviation=function(L,k,O,ie){var W=k&&k.length,Q=W?k[0]*O:L.length,oe=Math.abs(z(L,0,Q,O));if(W)for(var we=0,xe=k.length;we<xe;we++){var ge=k[we]*O,Le=we<xe-1?k[we+1]*O:L.length;oe-=Math.abs(z(L,ge,Le,O))}var Ne=0;for(we=0;we<ie.length;we+=3){var Ve=ie[we]*O,ht=ie[we+1]*O,R=ie[we+2]*O;Ne+=Math.abs((L[Ve]-L[R])*(L[ht+1]-L[Ve+1])-(L[Ve]-L[ht])*(L[R+1]-L[Ve+1]))}return oe===0&&Ne===0?0:Math.abs((Ne-oe)/oe)};function z(L,k,O,ie){for(var W=0,Q=k,oe=O-ie;Q<O;Q+=ie)W+=(L[oe]-L[Q])*(L[Q+1]+L[oe+1]),oe=Q;return W}t.flatten=function(L){for(var k=L[0][0].length,O={vertices:[],holes:[],dimensions:k},ie=0,W=0;W<L.length;W++){for(var Q=0;Q<L[W].length;Q++)for(var oe=0;oe<k;oe++)O.vertices.push(L[W][Q][oe]);W>0&&(ie+=L[W-1].length,O.holes.push(ie))}return O}}),tm=new ArrayBuffer(8),oa=new Float64Array(tm),aa=new Uint32Array(tm),qc=new Uint16Array(tm),rm=ArrayBuffer;try{rm=self.HTMLImageElement||rm}catch{}function Zb(r){if(typeof r!="object"||r===null||r instanceof Date||r instanceof ArrayBuffer||r instanceof Blob||r instanceof FormData||r instanceof Function||r instanceof Uint8ClampedArray||r instanceof rm)return r;if(Array.isArray(r))return r.map(Zb);{let e={};for(let t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=Zb(r[t]));return e}}function uoe(r,e){return SD(r,e,()=>[])}function SD(r,e,t){let n=r[e];return n!==void 0||(n=t(e),r[e]=n),n}function coe(r,e){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(e(void 0,r[t],t)===!1)return}else{let t=0;for(let n in r)if(r.hasOwnProperty(n)){let i=r[n];if(e(n,i,t)===!1)return;t++}}}var ID=Object.prototype.hasOwnProperty;async function hoe(r,e){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(await e(void 0,r[t],t)===!1)return}else{let t=0;for(let n in r)if(ID.call(r,n)){let i=r[n];if(await e(n,i,t)===!1)return;t++}}}function doe(r,e,t){return typeof r=="string"&&(/https?:/.test(r)||(r=location.origin+r)),Promise.race([fetch(r,e),new Promise((n,i)=>setTimeout(i,t))])}function foe(r,e){let t=0,n=0;return(...i)=>{let s=++t;setTimeout(()=>{let o=performance.now();if(s===t||o-n>=r){try{e(...i)}catch(a){console.log(a)}n=o}},Math.max(0,r-(performance.now()-n)))}}function poe(r,e){let t=r.length,n=0;for(;n<t;){let i=r.indexOf(`
`,n);i<0&&(i=t);let s=r.substring(n,i);try{if(e(s)===!1)return}catch(o){console.error(o)}n=i+1}}function moe(r){let e=null;return()=>(e===null&&(e=r()),e)}var nm=0;function goe(){nm===0&&(nm=Date.now()-performance.now());let r=new Array,e=nm+performance.now();oa[0]=e,r.push(aa[1].toString(16)),oa[0]=Math.random(),r.push(qc[3].toString(16));let t=qc[2].toString(16);r.push("4"+t.substr(0,3)),oa[0]=e;let n=aa[0].toString(16)+aa[1].toString(16);return r.push("0"+n.substr(0,3)),r.push(n.substr(3)),r.join("-")}var xoe=class{constructor(r){this.resources=r,this.idle=[]}acquire(r){this.resources>0?(this.resources--,r()):this.idle.push(r)}acquire1(r){return this.resources>0?(this.resources--,r()):this.acquireSync().then(r)}acquireSync(){return new Promise(r=>{this.acquire(r)})}release(){let r=this.idle.shift();r?Promise.resolve().then(r):this.resources++}getWaitingNum(){return this.idle.length}};function boe(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function yoe(r,e,t){let n=r.length+e-1;for(let i=0;i<n;i++){let s=new Array;for(let o=i-e+1;o<=i;o++)s.push(r[o]);if(t(s)===!1)break}}function voe(){let r=new Date,e=r.getFullYear(),t=r.getMonth()+1,n=r.getDate(),i=r.getHours(),s=r.getMinutes(),o=r.getSeconds(),a=r.getMilliseconds();return"["+e+"-"+(t<10?"0"+t:t)+"-"+(n<10?"0"+n:n)+" "+(i<10?"0"+i:i)+":"+(s<10?"0"+s:s)+":"+(o<10?"0"+o:o)+"."+(a<100?a<10?"00"+a:"0"+a:a)+"] "}async function woe(r){let e=typeof r=="string"?new TextEncoder().encode(r):r,t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(n=>n.toString(16).padStart(2,"0")).join("")}var zc=null;function Xi(r,e,t=0,n=r.length){i(r,null,e,t,n);function i(o,a,l,u,c){let h,f,d,m;if(u<c-1){let p=c-u;if(p>50)a===null&&(a=new Array(p+1)),s(o,a,l,u,(u+c)/2|0,c);else{h=o[u],f=u,d=u,m=c;let g=f+1;for(;g<m;){if(d!=m){if(m=m+-1,l(h,o[m])<=0)continue;o[d]=o[m],d=m;continue}if(l(h,o[g])>=0){f=g,g=f+1;continue}o[d]=o[g],f=g,d=g,g=f+1}o[d]=h,i(o,a,l,u,d),i(o,a,l,d+1,c)}}}function s(o,a,l,u,c,h){i(o,a,l,u,c),i(o,a,l,c,h);for(var f=u,d=c,m=0,p=o[f],g=o[d];f<c&&d<h;){var b=l(p,g);isNaN(b)?(a[m++]=g,g=o[++d]):(b<=0&&(a[m++]=p,p=o[++f]),b>=0&&(a[m++]=g,g=o[++d]))}for(;f<c;f++)a[m++]=o[f];for(;d<h;d++)a[m++]=o[d];for(f=u,d=0;d<m;f++,d++)o[f]=a[d]}}var Sr=class{static repeat(r,e){let t=new Array(e);for(;e-- >0;)t[e]=r;return t.join("")}static lpad(r,e,t){let n=t-r.length;return n>0?this.repeat(e,n)+r:r}static rpad(r,e,t){let n=t-r.length;return n>0?r+this.repeat(e,n):r}static strHashcode(r){if(r.length>0){let e=0;for(let t=0;t<r.length;t++)e=31*e+r.charCodeAt(t)|0;return e}else return 0}static arraycopy(r,e,t,n,i){if(r.length>=e+i&&t.length>=n+i)for(;i-- >0;)t[n++]=r[e++];else throw new Error("arraycopy out of range")}static undefAsNull(r){return null}static reverse(r,e){for(let t=0,n=r.length-1;n>=0;t++,n--)e[t]=r[n];return e}static sortAsc(r,e){return r-e}static xmlDecode(r){let e=r.length,t=new Array,n=-1;for(let i=0;i<e;i++){let s=r.charAt(i);if(n>=0){if(s===";"){let o=r.substring(n+1,i);switch(o){case"lt":t.push("<");break;case"gt":t.push(">");break;case"quot":t.push('"');break;case"apos":t.push("'");break;case"amp":t.push("&");break;default:if(o.charAt(0)==="#"){let a=parseInt(o.substring(1));t.push(String.fromCharCode(a))}else t.push("&"+o+";")}n=-1}}else s==="&"?n=i:t.push(s)}return n>=0&&t.push(r.substring(n)),t.join("")}static addAll(r,e){for(let t of e)r.push(t)}static addAllSet(r,e){for(let t of e)r.add(t)}static contains(r,e){for(let t of r)if(t.equals(e))return!0;return!1}static equals(r,e){if(r.length==e.length){for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}else return!1}static remove(r,e){let t=0,n=r.length;for(let i=0;i<n;i++)r[i]===e&&(r.splice(i,1),i--,n--,t++);return t}static getUrlVars(){for(var r={},e=location.href.slice(location.href.indexOf("?")+1).split("&"),t=0;t<e.length;t++){var n=e[t].split("=");r[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return r}static prefix(){if(!zc){let r=this.getUrlVars().version;r?zc="/analyzer/v"+r:zc="/analyzer"}return zc}static add2objS(r,e,t){if(e in r)return r[e];{let n=t(e);return r[e]=n,n}}static downloadFile(r,e){let t=document.createElement("a"),n=URL.createObjectURL(e);t.download=r,t.href=n,t.click(),URL.revokeObjectURL(n)}static uuid(){let r=new Array;oa[0]=new Date().getTime(),r.push(aa[1].toString(16)),oa[0]=Math.random(),r.push(qc[3].toString(16));let e=qc[2].toString(16);r.push("4"+e.substr(0,3)),oa[0]=performance.now();let t=aa[0].toString(16)+aa[1].toString(16);return r.push("0"+t.substr(0,3)),r.push(t.substr(3)),r.join("-")}static funcCopy(r){return(0,eval)("("+r.toString()+")")}static NVL(...r){for(let e of r)if(e!==null)return e;return null}static isSingle(r){return Array.from(new Set(r)).length===r.length}},BD=[1,10,100,1e3];function Eoe(r){return typeof r=="number"&&!isNaN(r)}var Yc=0,go=0;function Kb(r,e,t){return Yc=Math.abs(r-e),t>=5&&Yc>1e-5||isNaN(t)&&Yc>1e-8?!1:Yc<1e-13?!0:(go=Math.min(Qb(r),Qb(e)),go<10&&(go=10),isNaN(t)||(go=Math.min(go,t)),Jb(r,go)===Jb(e,go))}var Xc=0,Vc=0;function Qb(r){return Xc=0,Vc=0,r>0?Xc=r-Math.floor(r):Xc=r-Math.ceil(r),Vc=(Xc.toString()||"").length,Vc>2?Vc-2:0}function Jb(r,e,t){if(typeof r!="number"&&(r=+r),isNaN(r))return NaN;if(e=e|0,e<=0||!r&&!t)return Math.round(r);var n=BD[e]||Math.pow(10,e)||10;if(t){var i=r<0?"-":"";for(r=r<0?-r:r,r=Math.round(r*n)+"";r.length<=e;)r="0"+r;return r=r.slice(0,-e)+"."+r.slice(-e),parseFloat(i+r)}else return Math.round(r*n+1e-10)/n}var AD=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.PERCENT=1]="PERCENT",r[r.LEFT_PAD0=2]="LEFT_PAD0",r))(AD||{}),TD=/(\.?0+)$/,la=class{static format(r,...e){return this.format1(r,e)}static format1(r,e){let t=this._format(r,e);if(typeof t=="string")return t;throw new Error(this.format("Invalid state on (%d) %s",t,r))}static _format(r,e){let t=[],n=0,i=0,s,o=0,a=0;for(let l=0;l<r.length;l++){let u=r.charAt(l),c=u.charCodeAt(0);switch(n){case 0:c===37?n=1:t.push(u);break;case 1:switch(c){case 100:if(s=e[i++],typeof s=="number")t.push(s.toFixed(0)),n=0;else return l;break;case 102:if(s=e[i++],typeof s=="number")t.push(s.toString()),n=0;else return l;break;case 120:if(s=e[i++],typeof s=="number")t.push((s|0).toString(16)),n=0;else return l;break;case 88:if(s=e[i++],typeof s=="number")t.push((s|0).toString(16).toUpperCase()),n=0;else return l;break;case 115:case 99:s=e[i++],t.push(s===null?"null":s.toString()),n=0;break;case 48:o=l+1,a=-1,n=2;break;case 37:t.push("%"),n=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a=l;break;case 120:if(a>=o){let h=parseInt(r.substring(o,a+1));if(s=e[i++],typeof s=="number")t.push(Sr.lpad((s|0).toString(16),"0",h)),n=0;else return l}else return l;break;case 88:if(a>=o){let h=parseInt(r.substring(o,a+1));if(s=e[i++],typeof s=="number")t.push(Sr.lpad((s|0).toString(16).toUpperCase(),"0",h)),n=0;else return l}else return l;break;default:return l}break;default:return l}}return t.join("")}static startsWith(r,e){return r.length>=e.length?r.substring(0,e.length)===e:!1}static endsWith(r,e){return r.length>=e.length?r.substring(r.length-e.length)===e:!1}static split(r,e){let t=new Array,n=0;for(;;){let i=r.exec(e);if(i!==null){let s=r.lastIndex-i[0].length;t.push(e.substring(n,s)),n=r.lastIndex}else{let s=e.substring(n);at.nullOrEmpty(s)||t.push(s);break}}return t}static fmtNumber(r){return r.toFixed(5).replace(TD,"")}},at=class{static rgb(r){if(0<=r&&r<=255)return r;throw new Error(la.format("RGB should not nagative and not over 255(0xFF): %X",r))}static normal(r){if(isFinite(r))return r;throw new Error(la.format("%f is not permitted",r))}static positiveOr0(r){if(r>=0)return r;throw new Error(la.format("%f must >= 0",r))}static positive(r){if(r>0)return r;throw new Error(la.format("%f must > 0",r))}static notnull(r){if(r!=null)return r;throw new Error("invalid null value")}static mustnull(r){if(r===null)return null;throw new Error("value must be null")}static notEmpty(r){if(r==null||r.length===0)throw new Error("invalid empty string");return r}static nullOrEmpty(r){return r==null||r.length===0}static notNullOrUndef(r){if(r!=null)return r;throw new Error("null or undefined is not permitted")}},ae=(Ia=class{static regular(e){return Math.round(e*this.precision)/this.precision}static eq(e,t){return Math.abs(e-t)<=this.eps}static neq(e,t){return Math.abs(e-t)>this.eps}static less(e,t){return e-t<-this.eps}static lesseq(e,t){return e-t<=this.eps}static greater(e,t){return e-t>this.eps}static greatereq(e,t){return e-t>=-this.eps}static sqrt(e){return Math.abs(e)<=1e-10?0:Math.sqrt(e)}static sortAsc(e,t){return e-t}static sortDesc(e,t){return t-e}},(()=>{Ia.eps=1e-8})(),(()=>{Ia.precision=1e8})(),Ia);function ua(r,e){Wc(r.iterator(),e)}function Wc(r,e){let t=0;for(;r.hasNext();){let n=r.next();e(t++,n)}}var CD=class{constructor(r){this.lst=r}iterator(){return new ey(this.lst)}},ey=class{constructor(r){this.idx=-1,this.lst=r}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function _oe(r){return new CD(r)}function $c(r){return new ey(r)}var Xe=(Er=class{static toDegrees(e){return e*180/Math.PI}static toRadians(e){return e/180*Math.PI}static regularD(e){return e=e%360,e=e<0?360+e:e,e===360?0:e}static regular(e){return e=e%Er.PIx2,e=e<0?Er.PIx2+e:e,e===Er.PIx2?0:e}static toQuarterBase(e){return Er.regular((e+Er.PI_4)/Er.PI_2*Er.PI_2)}static toQuarterBaseD(e){return Er.regularD(((e+45)/90|0)*90)}static transformD(e,t){return Er.toDegrees(Er.transform(Er.toRadians(e),t))}static transform(e,t){let n=Math.cos(e),i=Math.sin(e),s=new q(t.data[6],t.data[7]),o=new q(n,i).multiply3(t);return Er.regular(o.angle(s))}},(()=>{Er.PIx2=Math.PI*2})(),(()=>{Er.PI_2=Math.PI/2})(),(()=>{Er.PI_4=Math.PI/4})(),Er),Wt=class{static dotProd1(r,e,t,n){return r*t+e*n}static dotProd2(r,e,t,n,i,s){return this.dotProd1(t-r,n-e,i-t,s-n)}static dotProd3(r,e,t){return this.dotProd2(r.x,r.y,e.x,e.y,t.x,t.y)}static crossProd1(r,e,t,n){return r*n-e*t}static crossProd2(r,e,t,n,i,s){return this.crossProd1(t-r,n-e,i-t,s-n)}static crossProd3(r,e,t){return this.crossProd2(r.x,r.y,e.x,e.y,t.x,t.y)}static distance2(r,e,t,n){let i=t-r,s=n-e;return i*i+s*s}static distance1(r,e,t,n){return this.hypot(t-r,n-e)}static distance1p(r,e){return this.distance1(r.x,r.y,e.x,e.y)}static hypot(r,e){if(r=Math.abs(r),e=Math.abs(e),e>r){var t=e;e=r,r=t}if(r===0)return e;var n=e/r;return r*Math.sqrt(1+n*n)}},ty=new ArrayBuffer(16),ry=new Float64Array(ty),jc=new Int32Array(ty),q=(mt=class{static sortByXAsc(e,t){return e.x-t.x}static sortByYAsc(e,t){return e.y-t.y}static sortByXYAsc(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y-t.y}static caculateAngle(e,t){let n=Math.cos(e),i=Math.sin(e),s=n*t.data[0]+i*t.data[4],o=n*t.data[1]+i*t.data[5],a=new mt(s,o).normalize();return Math.atan2(a.y,a.x)}static normal(e,t,n){let i=t.sub(e),s=n.sub(t);return i.cross(s)}static getVector2(e){return new mt(Math.cos(e),Math.sin(e))}static getCrossPoint1(e,t,n,i){if(e.equals1(t)||n.equals1(i)||ae.eq(1,Math.abs(t.sub(e).normalize().dot(i.sub(n).normalize()))))return null;let s=t.y-e.y,o=e.x-t.x,a=t.x*e.y-e.x*t.y,l=i.y-n.y,u=n.x-i.x,c=i.x*n.y-n.x*i.y,h=s*u-l*o;return new mt((c*o-a*u)/h,(a*l-c*s)/h)}static getCrossPoint2(e,t,n,i){return this.getCrossPoint1(e,e.add(t),n,n.add(i))}constructor(e,t){this.x=at.normal(e),this.y=at.normal(t)}get hashed(){return this._hashed==null&&(ry[0]=this.x,ry[1]=this.y,this._hashed=jc[0]^jc[1]^jc[2]^jc[3]),this._hashed}dot(e){return this.x*e.x+this.y*e.y}length(){return Math.sqrt(this.dot(this))}getCos(){return this.x/this.length()}sub(e){var t=this.x-e.x,n=this.y-e.y;return new mt(t,n)}add(e){var t=this.x+e.x,n=this.y+e.y;return new mt(t,n)}div(e){return new mt(this.x/e,this.y/e)}add1(e,t){return new mt(this.x+e,this.y+t)}mul(e){return new mt(this.x*e,this.y*e)}cross(e){return this.x*e.y-this.y*e.x}getSin(){return this.y/this.length()}angle2(e){let t=this.y-e.y,n=this.x-e.x;return t=Math.abs(t-0)<10**-4?0:t,n=Math.abs(n-0)<10**-4?0:n,Math.atan2(t,n)}angleD2(e){return Xe.toDegrees(this.angle2(e))}angle(e){return Math.atan2(this.y-e.y,this.x-e.x)}angleX(e=mt.ORIGIN){let t=this.angle(e);return t<0&&(t=Math.PI*2+t),t}angleD(e){return Xe.toDegrees(this.angle(e))}distance1(e){let t=e.x-this.x,n=e.y-this.y;return Wt.hypot(t,n)}distance2(e){let t=e.x-this.x,n=e.y-this.y;return t*t+n*n}rotateD(e,t){return this.rotate(e,Xe.toRadians(t))}rotate(e,t){let n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y,a=s*n+o*-i,l=s*i+o*n;return e.add1(a,l)}multiply3(e){let t=this.x*e.data[0]+this.y*e.data[3]+e.data[6],n=this.x*e.data[1]+this.y*e.data[4]+e.data[7];return new mt(t,n)}multiply4(e){let t=this.x*e.data[0]+this.y*e.data[4]+e.data[12],n=this.x*e.data[1]+this.y*e.data[5]+e.data[13];return new mt(t,n)}hashCode(){return this.hashed}equals(e,t){return e instanceof mt?Kb(e.x,this.x,t)&&Kb(e.y,this.y,t):!1}equals1(e){return e?ae.eq(this.x,e.x)&&ae.eq(this.y,e.y):!1}equals2(e,t){return e instanceof mt?Math.abs(this.x-e.x)<=t&&Math.abs(this.y-e.y)<=t:!1}similarEquals(e,t=.5){return Math.abs(this.x*.1-e.x*.1)<=t&&Math.abs(this.y*.1-e.y*.1)<=t}toString(){return"Vector [X="+this.x+", Y="+this.y+"]"}bbox(){let e=this.x,t=this.y;return new ye(e,e,t,t)}normalize(){if(this.x===0&&this.y===0)return new mt(0,0);let e=this.x/this.length(),t=this.y/this.length();return new mt(e,t)}regular(e=1e-4){let t=Math.round(1/e);return new mt(Math.round(this.x*t)/t,Math.round(this.y*t)/t)}round(e=4){let t=10**(e|0);return new mt(Math.round(this.x*t)/t,Math.round(this.y*t)/t)}mirrorX(e=mt.ORIGIN){return new mt(this.x,2*e.y-this.y)}mirrorY(e=mt.ORIGIN){return new mt(2*e.x-this.x,this.y)}mirrorCenter(e=mt.ORIGIN){return new mt(2*e.x-this.x,2*e.y-this.y)}clone(){return new mt(this.x,this.y)}mirror(e=mt.ORIGIN){return new mt(2*e.x-this.x,2*e.y-this.y)}pointOnRays(e,t){let n=Xe.toRadians(e);return new mt(this.x+Math.cos(n)*t,this.y+Math.sin(n)*t)}pointOnRays2(e,t){let n=e.angle(this);return new mt(this.x+Math.cos(n)*t,this.y+Math.sin(n)*t)}scale(e){return new mt(this.x*e,this.y*e)}},(()=>{mt.ORIGIN=new mt(0,0)})(),(()=>{mt.X_UNIT_VECTOR=new mt(1,0)})(),(()=>{mt.Y_UNIT_VECTOR=new mt(0,1)})(),mt),ny=(r=>(r[r.LEFT=0]="LEFT",r[r.CENTER=1]="CENTER",r[r.RIGHT=2]="RIGHT",r))(ny||{}),iy=(r=>(r[r.TOP=0]="TOP",r[r.CENTER=1]="CENTER",r[r.BOTTOM=2]="BOTTOM",r))(iy||{}),bi=(sr=class{constructor(e,t){this.horizontal=e,this.vertical=t}},(()=>{sr.LT=new sr(0,0)})(),(()=>{sr.LC=new sr(0,1)})(),(()=>{sr.LB=new sr(0,2)})(),(()=>{sr.CT=new sr(1,0)})(),(()=>{sr.CC=new sr(1,1)})(),(()=>{sr.CB=new sr(1,2)})(),(()=>{sr.RT=new sr(2,0)})(),(()=>{sr.RC=new sr(2,1)})(),(()=>{sr.RB=new sr(2,2)})(),sr),MD=(r=>(r[r.INNER=0]="INNER",r[r.OUTER=1]="OUTER",r[r.SEPARATED=2]="SEPARATED",r[r.INTERSECTED=3]="INTERSECTED",r[r.EQ=4]="EQ",r[r.INSIDE_TOUCHED=5]="INSIDE_TOUCHED",r[r.OUTSIDE_TOUCHED=6]="OUTSIDE_TOUCHED",r))(MD||{}),Oe=class{constructor(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}ext1(r){return this.minX=Math.min(this.minX,r.minX),this.maxX=Math.max(this.maxX,r.maxX),this.minY=Math.min(this.minY,r.minY),this.maxY=Math.max(this.maxY,r.maxY),this}ext2(r){return this.minX=Math.min(this.minX,r.x),this.maxX=Math.max(this.maxX,r.x),this.minY=Math.min(this.minY,r.y),this.maxY=Math.max(this.maxY,r.y),this}ext3(r){for(let e=0;e<r.length;e++){let t=r[e];this.ext2(t)}return this}ext4(r){return ua(r,(e,t)=>(this.ext2(t),!0)),this}ext5(r,e,t,n){return this.minX=Math.min(this.minX,r),this.maxX=Math.max(this.maxX,e),this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,n),this}ext6(r,e){return this.minX=Math.min(this.minX,r),this.maxX=Math.max(this.maxX,r),this.minY=Math.min(this.minY,e),this.maxY=Math.max(this.maxY,e),this}ext7(r){if(r<0){let e=r*2;if(e<this.minX-this.maxX||e<this.minY-this.maxY)throw new Error("")}return this.minX-=r,this.maxX+=r,this.minY-=r,this.maxY+=r,this}ext8(r){let e=[];for(let t=0;t<r.length;t+=2)e.push(new q(r[t],r[t+1]));return this.ext3(e)}ext9(r,e,t,n){return this.minX=Math.min(this.minX,r),this.maxX=Math.max(this.maxX,r+t),this.minY=Math.min(this.minY,e),this.maxY=Math.max(this.maxY,e+n),this}ext10({x:r,y:e,width:t,height:n}){return this.ext9(r,e,t,n)}valid(){return isFinite(this.minX)&&isFinite(this.maxX)&&isFinite(this.minY)&&isFinite(this.maxY)}clear(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}build(){return new ye(this.minX,this.maxX,this.minY,this.maxY)}build1(){return this.valid()?new ye(this.minX,this.maxX,this.minY,this.maxY):new ye(0,0,0,0)}},ql=new Float64Array(4),ye=class ri{static extendRect({x:e,y:t,width:n,height:i}){return new ri(e,e+n,t,t+i)}static extend1(e,t){if(e===null)return new ri(t.x,t.x,t.y,t.y);{let n=Math.min(e.minX,t.x),i=Math.max(e.maxX,t.x),s=Math.min(e.minY,t.y),o=Math.max(e.maxY,t.y);return new ri(n,i,s,o)}}static extend2(e,t){if(e){let n=Math.min(e.minX,t.minX),i=Math.max(e.maxX,t.maxX),s=Math.min(e.minY,t.minY),o=Math.max(e.maxY,t.maxY);return new ri(n,i,s,o)}else return t}static extend3(e,t){let n=Math.min(e.x,t.x),i=Math.max(e.x,t.x),s=Math.min(e.y,t.y),o=Math.max(e.y,t.y);return new ri(n,i,s,o)}static extend4(e,t,n){let i=e.add1(-t/2,-n/2),s=e.add1(t/2,n/2);return ri.extend3(i,s)}constructor(e,t,n,i){if(this.minX=at.normal(e),this.maxX=at.normal(t),this.minY=at.normal(n),this.maxY=at.normal(i),e>t||n>i)throw new Error(`min > max is not permitted: [${e}, ${t}, ${n}, ${i}]`)}get data(){return ql[0]=this.minX,ql[1]=this.maxX,ql[2]=this.minY,ql[3]=this.maxY,ql}isContains(e){return this.isContains1(e.x,e.y)}points(){return[this.LL(),this.LR(),this.UR(),this.UL(),this.LL()]}isContains1(e,t){return this.isContainsX(e)&&this.isContainsY(t)}isContains2(e,t){return this.isContainsX1(e)&&this.isContainsY1(t)}isContainsX(e){return e>=this.minX&&e<=this.maxX}isContainsX1(e){return ae.greatereq(e,this.minX)&&ae.lesseq(e,this.maxX)}isContainsY(e){return e>=this.minY&&e<=this.maxY}isContainsY1(e){return ae.greatereq(e,this.minY)&&ae.lesseq(e,this.maxY)}isIntersect(e){let t=Math.max(this.minX,e.minX),n=Math.min(this.maxX,e.maxX);if(t>n)return!1;let i=Math.max(this.minY,e.minY),s=Math.min(this.maxY,e.maxY);return!(i>s)}extendOfSize(e){return at.positiveOr0(this.maxX-this.minX+e*2),at.positiveOr0(this.maxY-this.minY+e*2),new ri(this.minX-e,this.maxX+e,this.minY-e,this.maxY+e)}isInside(e){return this.minX>=e.minX&&this.maxX<=e.maxX&&this.minY>=e.minY&&this.maxY<=e.maxY}isContainsBBox(e){return this.maxX>=e.maxX&&this.minX<=e.minX&&this.maxY>=e.maxY&&this.minY<=e.minY}isContainsBBox1(e){return ae.greatereq(this.maxX,e.maxX)&&ae.lesseq(this.minX,e.minX)&&ae.greatereq(this.maxY,e.maxY)&&ae.lesseq(this.minY,e.minY)}intersection1(e){let t=Math.max(this.minX,e.minX),n=Math.min(this.maxX,e.maxX);if(ae.greater(t,n))return null;t>n&&(n=t);let i=Math.max(this.minY,e.minY),s=Math.min(this.maxY,e.maxY);return ae.greater(i,s)?null:(i>s&&(s=i),new ri(t,n,i,s))}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}UL(){return new q(this.minX,this.maxY)}UR(){return new q(this.maxX,this.maxY)}LL(){return new q(this.minX,this.minY)}LR(){return new q(this.maxX,this.minY)}center(){return new q(this.maxX-(this.maxX-this.minX)/2,this.maxY-(this.maxY-this.minY)/2)}area(){return this.width()*this.height()}transform(e){let t=new Oe;return t.ext2(this.LL().multiply3(e)),t.ext2(this.LR().multiply3(e)),t.ext2(this.UR().multiply3(e)),t.ext2(this.UL().multiply3(e)),t.build()}transform4(e){let t=new Oe;return t.ext2(this.LL().multiply4(e)),t.ext2(this.LR().multiply4(e)),t.ext2(this.UR().multiply4(e)),t.ext2(this.UL().multiply4(e)),t.build()}isSeparated(e){if(e==null||e==null)return!1;let t;this.minX>=e.minX?t=this.minX:t=e.minX;let n;if(this.maxX<=e.maxX?n=this.maxX:n=e.maxX,t>n)return!0;{let i;this.minY>=e.minY?i=this.minY:i=e.minY;let s;return this.maxY<=e.maxY?s=this.maxY:s=e.maxY,i>s}}relation(e){let t=0,n=0,i;this.minX>e.minX?(t++,i=this.minX):this.minX===e.minX?i=this.minX:(n++,i=e.minX);let s;if(this.maxX<e.maxX?(t++,s=this.maxX):this.maxX===e.maxX?s=this.maxX:(n++,s=e.maxX),i>s)return 2;{let o;this.minY>e.minY?(t++,o=this.minY):this.minY===e.minY?o=this.minY:(n++,o=e.minY);let a;return this.maxY<e.maxY?(t++,a=this.maxY):this.maxY===e.maxY?a=this.maxY:(n++,a=e.maxY),o>a?2:t===4?0:n===4?1:t===0&&n===0?4:i===s||o===a?6:t!==n?5:3}}zoom(e){let t=this.width(),n=this.height(),i=this.center();return e!=0&&(t/=e/2,n/=e/2),new ri(i.x-t,i.x+t,i.y-t,i.y+t)}toString(){return"BBox [minX="+this.minX+", maxX="+this.maxX+", minY="+this.minY+", maxY="+this.maxY+"]"}equals(e){return this.minY==e.minY&&this.minX==e.minX&&this.maxX==e.maxX&&this.maxY==e.maxY}extendSize(e,t){return Object.is(void 0,t)&&(t=e),ri.extend4(this.center(),this.width()+e,this.height()+t)}positionOnBBox(e,t=0){let n=this.center(),i=this.width()*t/2,s=this.height()*t/2,o=e.x-n.x,a=e.y-n.y;return o>i?a>s?bi.RT:a<-s?bi.RB:bi.RC:o<-i?a>s?bi.LT:a<-s?bi.LB:bi.LC:a>s?bi.CT:a<-s?bi.CB:bi.CC}bbox(){return this}},vn=class pt{static mul(e,t,n,i,s,o){let a=0,l=0;for(let u=0;u<e;u++){for(let c=0;c<n;c++){let h=c,f=0;for(let d=0;d<t;d++)f+=i[l+d]*s[h],h+=n;o[a++]=f}l+=t}}constructor(e,t,n){this.m=at.normal(e),this.n=at.normal(t);let i=e*t;if(n.length===i){for(let s=0;s<n.length;s++)at.normal(n[s]);this.data=n}else throw new Error("invalid matrix size")}mul(e){if(this.n===e.m){let t=new Array(this.m*e.n);return pt.mul(this.m,this.n,e.n,this.data,e.data,t),new pt(this.m,e.n,t)}else throw new Error("m !== p")}toString(){let e=[];e.push("Matrix ("),e.push(this.m.toString()),e.push(" x "),e.push(this.n.toString()),e.push(")");let t=0;for(let n=0;n<this.m;n++)for(let i=0;i<this.n;i++){let s=this.data[t++].toString();i===0?(e.push(`
`),e.push("	"),e.push(s)):(e.push(", "),e.push(s))}return e.join("")}static on(e,t,n){return e*t+n}initExpandMatrix(e){let t=this.m,n=this.n,i=n*2,s=new Array(t*i);for(let o=0;o<t;o++)for(let a=0;a<i;a++)a<n?s[pt.on(i,o,a)]=e[pt.on(n,o,a)]:a===t+o?s[pt.on(i,o,a)]=1:s[pt.on(i,o,a)]=0;return s}inverseMatrix(e,t,n){for(let i=0;i<t;i++){let s=e[pt.on(n,i,i)];for(let o=0;o<n;o++)e[pt.on(n,i,o)]/=s}return e}getMatrixRank(e,t,n){let i=Math.min(t,n);for(let s=0;s<t;s++){if(e[pt.on(n,s,s)]===0){let o=new Array(n),a;for(a=s;a<t;a++)if(e[pt.on(n,a,s)]!==0){Sr.arraycopy(e,pt.on(n,a,0),o,0,n),Sr.arraycopy(e,pt.on(n,s,0),e,pt.on(n,a,0),n),Sr.arraycopy(o,0,e,pt.on(n,s,0),n);break}a>=t&&(i-=1)}if(!(i<t))for(let o=0;o<t;o++){if(o===s)continue;let a=e[pt.on(n,o,s)]/e[pt.on(n,s,s)];for(let l=0;l<n;l++)e[pt.on(n,o,l)]-=e[pt.on(n,s,l)]*a}}return i}getInverseMatrix(){if(this.m!==this.n)throw new Error("The matrix is an "+this.m+"x"+this.n+" order matrix, non-square matrix, please check!");function e(o){return ae.lesseq(Math.abs(o),0)}let t=this.initExpandMatrix(this.data.slice(0)),n=this.n*2;function i(o,a){for(let l=0;l<n;l++){let u=t[pt.on(n,o,l)];t[pt.on(n,o,l)]=t[pt.on(n,a,l)],t[pt.on(n,a,l)]=u}}for(let o=0;o<this.m;o++){let a=Math.abs(t[pt.on(n,o,o)]),l=o;if(e(t[pt.on(n,o,o)]))for(let c=o+1;c<this.m;c++){if(e(t[pt.on(n,c,o)])){Math.abs(t[pt.on(n,c,o)])>a&&(a=Math.abs(t[pt.on(n,c,o)]),l=c);continue}i(o,c);break}if(e(t[pt.on(n,o,o)])){if(a===0)throw new Error("The matrix is a non-full rank matrix, please check!");console.warn("The matrix may be a non-full rank matrix, please check!"),l!==o&&i(o,l)}let u=1/t[pt.on(n,o,o)];for(let c=0;c<n;c++)t[pt.on(n,o,c)]*=u;for(let c=0;c<this.m;c++){if(o===c)continue;let h=t[pt.on(n,c,o)];for(let f=o;f<n;f++)t[pt.on(n,c,f)]-=t[pt.on(n,o,f)]*h}}let s=[];for(let o=0;o<this.m;o++)for(let a=this.n;a<n;a++)s[pt.on(this.n,o,a-this.n)]=t[pt.on(n,o,a)];return new pt(this.m,this.n,s)}getTransposeMatrix(){let e=new Array(this.data.length);for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++)e[n*this.n+t]=this.data[t*this.m+n];return new pt(this.n,this.m,e)}hashCode(){let e=0;for(let t of this.data)e+=t;return e}equals(e){return this===e?!0:e===null?!1:e instanceof pt?!(this.m!=e.m||this.n!=e.n||!Sr.equals(this.data,e.data)):!1}},ND=(r=>(r[r.MIL=1]="MIL",r[r.INCH=1e3]="INCH",r[r.FT=12e3]="FT",r[r.YARD=36e3]="YARD",r[r.MILE=6336e4]="MILE",r[r.KM=3937007874e-2]="KM",r[r.M=39370]="M",r[r.DM=3937]="DM",r[r.CM=393.7]="CM",r[r.MM=39.37]="MM",r[r.UM=.039]="UM",r[r.NM=394e-7]="NM",r[r.PT=13.88888888888889]="PT",r[r.PX72=13.88888888888889]="PX72",r[r.PX96=10.416666666666666]="PX96",r[r.PX100=10]="PX100",r[r.LTSPICE=6.25]="LTSPICE",r[r.PX1=.1]="PX1",r[r.PX001=.001]="PX001",r))(ND||{}),RD=(r=>(r.MIL="mil",r.INCH="inch",r.FT="ft",r.YARD="yard",r.MILE="mile",r.KM="km",r.M="m",r.DM="dm",r.CM="cm",r.MM="mm",r.UM="um",r.NM="nm",r.PT="pt",r.PX72="px(72)",r.PX96="px(96)",r.PX100="px(100)",r))(RD||{}),im={mil:1,inch:1e3,ft:12e3,yard:36e3,mile:6336e4,km:3937007874e-2,dm:3937,mm:39.37,um:.039,nm:394e-7,pt:13.88888888888889,"px(72)":13.88888888888889,"px(96)":10.416666666666666,"px(100)":10},LD=(()=>{let r={};for(let e in im)r[im[e]]=e;return r})();function Poe(r,e){return LD[r]||e}function Soe(r,e){return im[r]||e}var Ioe=(Ba=class{constructor(e,t){this.ratio=e/t}wrap(e){return e*this.ratio}static convert(e,t,n){return e*t/n}},(()=>{Ba.ASIS=new Ba(1,1)})(),Ba),zl=class{conversion(r,e,t){if(r===e)return t;let n=r+2+e;return this[n](t)}conversion1(r,e,t){let n=r+2+e,i=this[n](t);return e=="mil"?Math.round(i*10)/10:Math.round(i*1e3)/1e3}mil2mil(r){return r}mil2mm(r){return r*.0254}mil2cm(r){return r*.00254}mil2inch(r){return r/1e3}mm2mm(r){return r}mm2mil(r){let e=Math.pow(10,5);return Math.round(r*39.37007874015748*e)/e}mm2cm(r){return r/10}mm2inch(r){let e=Math.pow(10,8);return Math.round(r*.03937007874015748*e)/e}cm2mil(r){let e=Math.pow(10,6);return Math.round(r*393.7007874015748*e)/e}cm2mm(r){return r*10}cm2inch(r){let e=Math.pow(10,7);return Math.round(r*.3937007874015748*e)/e}inch2mil(r){return r*1e3}inch2mm(r){return r*25.4}inch2cm(r){return r*2.54}};zl.prototype["px(100)2mil"]=r=>r*10,zl.prototype["px(100)2mm"]=r=>r*.254,zl.prototype["mil2px(100)"]=r=>r/10,zl.prototype["mm2px(100)"]=r=>{let e=Math.pow(10,5);return Math.round(r*3.937007874015748*e)/e};var Hc=null,sm=new ArrayBuffer(8),om=new Float64Array(sm),am=new Uint32Array(sm),sy=new Uint16Array(sm);function Boe(r,e,t=0,n=r.length){i(r,null,e,t,n);function i(o,a,l,u,c){let h,f,d,m;if(u<c-1){let p=c-u;if(p>50)a===null&&(a=new Array(p+1)),s(o,a,l,u,(u+c)/2|0,c);else{h=o[u],f=u,d=u,m=c;let g=f+1;for(;g<m;){if(d!=m){if(m=m+-1,l(h,o[m])<=0)continue;o[d]=o[m],d=m;continue}if(l(h,o[g])>=0){f=g,g=f+1;continue}o[d]=o[g],f=g,d=g,g=f+1}o[d]=h,i(o,a,l,u,d),i(o,a,l,d+1,c)}}}function s(o,a,l,u,c,h){i(o,a,l,u,c),i(o,a,l,c,h);for(var f=u,d=c,m=0,p=o[f],g=o[d];f<c&&d<h;){var b=l(p,g);isNaN(b)?(a[m++]=g,g=o[++d]):(b<=0&&(a[m++]=p,p=o[++f]),b>=0&&(a[m++]=g,g=o[++d]))}for(;f<c;f++)a[m++]=o[f];for(;d<h;d++)a[m++]=o[d];for(f=u,d=0;d<m;f++,d++)o[f]=a[d]}}var oy=class{static repeat(r,e){let t=new Array(e);for(;e-- >0;)t[e]=r;return t.join("")}static lpad(r,e,t){let n=t-r.length;return n>0?this.repeat(e,n)+r:r}static rpad(r,e,t){let n=t-r.length;return n>0?r+this.repeat(e,n):r}static strHashcode(r){if(r.length>0){let e=0;for(let t=0;t<r.length;t++)e=31*e+r.charCodeAt(t)|0;return e}else return 0}static arraycopy(r,e,t,n,i){if(r.length>=e+i&&t.length>=n+i)for(;i-- >0;)t[n++]=r[e++];else throw new Error("arraycopy out of range")}static undefAsNull(r){return null}static reverse(r,e){for(let t=0,n=r.length-1;n>=0;t++,n--)e[t]=r[n];return e}static sortAsc(r,e){return r-e}static xmlDecode(r){let e=r.length,t=new Array,n=-1;for(let i=0;i<e;i++){let s=r.charAt(i);if(n>=0){if(s===";"){let o=r.substring(n+1,i);switch(o){case"lt":t.push("<");break;case"gt":t.push(">");break;case"quot":t.push('"');break;case"apos":t.push("'");break;case"amp":t.push("&");break;default:if(o.charAt(0)==="#"){let a=parseInt(o.substring(1));t.push(String.fromCharCode(a))}else t.push("&"+o+";")}n=-1}}else s==="&"?n=i:t.push(s)}return n>=0&&t.push(r.substring(n)),t.join("")}static addAll(r,e){for(let t of e)r.push(t)}static addAllSet(r,e){for(let t of e)r.add(t)}static contains(r,e){for(let t of r)if(t.equals(e))return!0;return!1}static equals(r,e){if(r.length==e.length){for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}else return!1}static remove(r,e){let t=0,n=r.length;for(let i=0;i<n;i++)r[i]===e&&(r.splice(i,1),i--,n--,t++);return t}static getUrlVars(){for(var r={},e=location.href.slice(location.href.indexOf("?")+1).split("&"),t=0;t<e.length;t++){var n=e[t].split("=");r[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return r}static prefix(){if(!Hc){let r=this.getUrlVars().version;r?Hc="/analyzer/v"+r:Hc="/analyzer"}return Hc}static add2objS(r,e,t){if(e in r)return r[e];{let n=t(e);return r[e]=n,n}}static downloadFile(r,e){let t=document.createElement("a"),n=URL.createObjectURL(e);t.download=r,t.href=n,t.click(),URL.revokeObjectURL(n)}static uuid(){let r=new Array;om[0]=new Date().getTime(),r.push(am[1].toString(16)),om[0]=Math.random(),r.push(sy[3].toString(16));let e=sy[2].toString(16);r.push("4"+e.substr(0,3)),om[0]=performance.now();let t=am[0].toString(16)+am[1].toString(16);return r.push("0"+t.substr(0,3)),r.push(t.substr(3)),r.join("-")}static funcCopy(r){return(0,eval)("("+r.toString()+")")}static NVL(...r){for(let e of r)if(e!==null)return e;return null}static isSingle(r){return Array.from(new Set(r)).length===r.length}},OD=[1,10,100,1e3];function Zc(r){return typeof r=="number"&&!isNaN(r)}function Aoe(r){return new zl().conversion("mm","mil",r)}function Toe(r,e,t){if(Zc(e)&&Zc(e)&&e>t)throw new Error("error params: min > max");return Zc(e)&&r<e?{check:!1,value:e}:Zc(t)&&r>t?{check:!1,value:t}:{check:!0,value:r}}var Kc=0,xo=0;function Coe(r,e,t){return Kc=Math.abs(r-e),t>=5&&Kc>1e-5||isNaN(t)&&Kc>1e-8?!1:Kc<1e-13?!0:(xo=Math.min(ay(r),ay(e)),xo<10&&(xo=10),isNaN(t)||(xo=Math.min(xo,t)),ly(r,xo)===ly(e,xo))}var Qc=0,Jc=0;function ay(r){return Qc=0,Jc=0,r>0?Qc=r-Math.floor(r):Qc=r-Math.ceil(r),Jc=(Qc.toString()||"").length,Jc>2?Jc-2:0}function ly(r,e,t){if(typeof r!="number"&&(r=+r),isNaN(r))return NaN;if(e=e|0,e<=0||!r&&!t)return Math.round(r);var n=OD[e]||Math.pow(10,e)||10;if(t){var i=r<0?"-":"";for(r=r<0?-r:r,r=Math.round(r*n)+"";r.length<=e;)r="0"+r;return r=r.slice(0,-e)+"."+r.slice(-e),parseFloat(i+r)}else return Math.round(r*n+1e-10)/n}var Moe=class{constructor(r){this.resources=r,this.idle=[]}acquire(r){this.resources>0?(this.resources--,r()):this.idle.push(r)}acquire1(r){return this.resources>0?(this.resources--,r()):this.acquireSync().then(r)}acquireSync(){return new Promise(r=>{this.acquire(r)})}release(){let r=this.idle.shift();r?Promise.resolve().then(r):this.resources++}getWaitingNum(){return this.idle.length}},kD=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.PERCENT=1]="PERCENT",r[r.LEFT_PAD0=2]="LEFT_PAD0",r))(kD||{}),UD=/(\.?0+)$/,ca=class{static format(r,...e){return this.format1(r,e)}static format1(r,e){let t=this._format(r,e);if(typeof t=="string")return t;throw new Error(this.format("Invalid state on (%d) %s",t,r))}static _format(r,e){let t=[],n=0,i=0,s,o=0,a=0;for(let l=0;l<r.length;l++){let u=r.charAt(l),c=u.charCodeAt(0);switch(n){case 0:c===37?n=1:t.push(u);break;case 1:switch(c){case 100:if(s=e[i++],typeof s=="number")t.push(s.toFixed(0)),n=0;else return l;break;case 102:if(s=e[i++],typeof s=="number")t.push(s.toString()),n=0;else return l;break;case 120:if(s=e[i++],typeof s=="number")t.push((s|0).toString(16)),n=0;else return l;break;case 88:if(s=e[i++],typeof s=="number")t.push((s|0).toString(16).toUpperCase()),n=0;else return l;break;case 115:case 99:s=e[i++],t.push(s===null?"null":s.toString()),n=0;break;case 48:o=l+1,a=-1,n=2;break;case 37:t.push("%"),n=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a=l;break;case 120:if(a>=o){let h=parseInt(r.substring(o,a+1));if(s=e[i++],typeof s=="number")t.push(oy.lpad((s|0).toString(16),"0",h)),n=0;else return l}else return l;break;case 88:if(a>=o){let h=parseInt(r.substring(o,a+1));if(s=e[i++],typeof s=="number")t.push(oy.lpad((s|0).toString(16).toUpperCase(),"0",h)),n=0;else return l}else return l;break;default:return l}break;default:return l}}return t.join("")}static startsWith(r,e){return r.length>=e.length?r.substring(0,e.length)===e:!1}static endsWith(r,e){return r.length>=e.length?r.substring(r.length-e.length)===e:!1}static split(r,e){let t=new Array,n=0;for(;;){let i=r.exec(e);if(i!==null){let s=r.lastIndex-i[0].length;t.push(e.substring(n,s)),n=r.lastIndex}else{let s=e.substring(n);uy.nullOrEmpty(s)||t.push(s);break}}return t}static fmtNumber(r){return r.toFixed(5).replace(UD,"")}},uy=class{static rgb(r){if(0<=r&&r<=255)return r;throw new Error(ca.format("RGB should not nagative and not over 255(0xFF): %X",r))}static normal(r){if(isFinite(r))return r;throw new Error(ca.format("%f is not permitted",r))}static positiveOr0(r){if(r>=0)return r;throw new Error(ca.format("%f must >= 0",r))}static positive(r){if(r>0)return r;throw new Error(ca.format("%f must > 0",r))}static notnull(r){if(r!=null)return r;throw new Error("invalid null value")}static mustnull(r){if(r===null)return null;throw new Error("value must be null")}static notEmpty(r){if(r==null||r.length===0)throw new Error("invalid empty string");return r}static nullOrEmpty(r){return r==null||r.length===0}static notNullOrUndef(r){if(r!=null)return r;throw new Error("null or undefined is not permitted")}},DD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Qe=(Ot=class extends vn{static translate(e,t,n){return new Ot([1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1])}static translate1(e){return new Ot([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1])}static rotateX(e){let t=Math.cos(e),n=Math.sin(e);return new Ot([1,0,0,0,0,t,n,0,0,-n,t,0,0,0,0,1])}static rotateY(e){let t=Math.cos(e),n=Math.sin(e);return new Ot([t,0,-n,0,0,1,0,0,n,0,t,0,0,0,0,1])}static rotateZ(e){let t=Math.cos(e),n=Math.sin(e);return new Ot([t,n,0,0,-n,t,0,0,0,0,1,0,0,0,0,1])}static rotateAxis(e,t){e=e.normalize();let n=e.x,i=e.y,s=e.z,o=Math.sin(t),a=Math.cos(t);return new Ot([n*n*(1-a)+a,n*i*(1-a)+s*o,n*s*(1-a)-i*o,0,n*i*(1-a)-s*o,i*i*(1-a)+a,i*s*(1-a)+n*o,0,n*s*(1-a)+i*o,i*s*(1-a)-n*o,s*s*(1-a)+a,0,0,0,0,1])}static scale(e,t=e,n=e){return new Ot([e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1])}static flipX(){return new Ot([1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])}static flipY(){return new Ot([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static rotateZForPoint(e,t){return e.equals1(q.ORIGIN)?Ot.rotateZ(t):Ot.translate(-e.x,-e.y,0).rotateZ(t).translate1(e.x,e.y,0)}static getMatrix4(e,t,n,i){let s=Math.cos(t),o=Math.sin(t),a=n*(e.x*s-e.y*o)+i.x,l=e.x*o+e.y*s+i.y,u=[n*s,o,0,0,-o*n,s,0,0,0,0,1,0,a,l,0,1];return new Ot(u)}constructor(e=DD){super(4,4,e)}translate(e){return this.multiply4(Ot.translate1(e))}translate1(e,t,n){return this.multiply4(Ot.translate(e,t,n))}rotateX(e){return this.multiply4(Ot.rotateX(e))}rotateY(e){return this.multiply4(Ot.rotateY(e))}rotateZ(e){return this.multiply4(Ot.rotateZ(e))}scale(e,t=e,n=e){return this.multiply4(Ot.scale(e,t,n))}scale1(e){return this.multiply4(Ot.scale(e.x,e.y,e.z))}setOrigin(e,t,n){return Ot.translate(-e,-t,-n).multiply4(this).translate1(e,t,n)}setOrigin1(e){return this.setOrigin(e.x,e.y,e.z)}multiply4(e){let t=new Array(16);return vn.mul(4,4,4,this.data,e.data,t),new Ot(t)}getInverseMatrix(){let e=super.getInverseMatrix();return new Ot(e.data)}getTransposeMatrix(){let e=super.getTransposeMatrix();return new Ot(e.data)}inverse(){let e=this.getInverseMatrix();return new Ot(e.data)}toMatrix3(){let e=this.data;return new qe([e[0],e[1],0,e[4],e[5],0,e[12],e[13],1])}},(()=>{Ot.ORIGIN=new Ot})(),Ot);function Yl(r){return uy.normal(parseFloat(r))}var GD=[1,0,0,0,1,0,0,0,1],qe=(Bt=class extends vn{static translate(e,t){return new Bt([1,0,0,0,1,0,e,t,1])}static translate1(e){return this.translate(e.x,e.y)}static rotate(e){let t=Math.cos(e),n=Math.sin(e);return new Bt([t,n,0,-n,t,0,0,0,1])}static rotateD(e){return this.rotate(Xe.toRadians(e))}static scale(e,t=e){return new Bt([e,0,0,0,t,0,0,0,1])}static scale1(e,t){return new Bt([e,0,0,0,t,0,0,0,1])}static toDOMMatrix(e){let[t,n,,i,s,,o,a]=e.data;return`matrix(${[t,n,i,s,o,a].join(",")})`}static svgTrasform(e){let t=e.split(" "),n=null;return t.forEach(i=>{i=i.trim();let s=i.trim().replace(")","").split("("),o=s[0],a=s[1].split(",");switch(o){case"translate":let l=Yl(a[0]),u=Yl(a[1]);n=n?n.translate(l,u):Bt.translate(l,u);break;case"rotate":let c=Yl(a[0]),h=Yl(a[1]),f=Yl(a[2]);n=n?n.setOrigin(h,f):Bt.translate(h,f),n=n.rotateD(c);break;default:return}}),n}constructor(e=GD){super(3,3,e);let t=e[0],n=e[3],i=e[1],s=e[4];this.iScale=Math.sqrt(t*t+i*i),this.jScale=Math.sqrt(n*n+s*s)}isMirrored(){return this.det()<0}multiply3(e){let t=new Array(9);return vn.mul(3,3,3,this.data,e.data,t),new Bt(t)}translate(e,t){return this.multiply3(Bt.translate(e,t))}translate1(e){return this.multiply3(Bt.translate1(e))}scale(e,t=e){return this.multiply3(Bt.scale(e,t))}scale1(e,t){return this.multiply3(Bt.scale1(e,t))}det(){return this.data[0]*this.data[4]-this.data[3]*this.data[1]}invert(){let e=this.getInverseMatrix();return new Bt(e.data)}rotateD(e){return this.multiply3(Bt.rotateD(e))}rotate(e){return this.multiply3(Bt.rotate(e))}resetOffset(){let e=this.data;return new Bt([e[0],e[1],0,e[3],e[4],0,0,0,1])}setOrigin(e,t){return Bt.translate(-e,-t).multiply3(this).translate(e,t)}setOrigin1(e){return this.setOrigin(e.x,e.y)}getInverseMatrix(){return new Bt(super.getInverseMatrix().data)}getTransposeMatrix(){let e=super.getTransposeMatrix();return new Bt(e.data)}toMatrix4(){let e=this.data;return new Qe([e[0],e[1],0,e[2],e[3],e[4],0,e[5],0,0,1,0,e[6],e[7],0,e[8]])}scaleNum(e){return!e||isNaN(e)?e:e*this.iScale}},(()=>{Bt.ORIGIN=new Bt})(),(()=>{Bt.MIRROR_Y=new Bt([1,0,0,0,-1,0,0,0,1])})(),(()=>{Bt.MIRROR_X=new Bt([-1,0,0,0,1,0,0,0,1])})(),(()=>{Bt.ROT_90=new Bt([0,1,0,-1,0,0,0,0,1])})(),(()=>{Bt.ROT_N90=new Bt([0,-1,0,1,0,0,0,0,1])})(),Bt),ts=(r=>(r[r.BUTT=0]="BUTT",r[r.ROUND=1]="ROUND",r[r.SQUARE=2]="SQUARE",r))(ts||{}),yt=(r=>(r[r.CW=0]="CW",r[r.CCW=1]="CCW",r))(yt||{}),Xl=class{},Ji=class nu{constructor(e,t,n){this.p1=e,this.p2=t,this.p3=n}barycentre(){return nu.barycentre(this.p1,this.p2,this.p3)}incentre(){return nu.incentre(this.p1,this.p2,this.p3)}static barycentre(e,t,n){let i=e.x+t.x+n.x,s=e.y+t.y+n.y;return new q(i/3,s/3)}static incentre(e,t,n){let i=t.sub(n).length(),s=e.sub(n).length(),o=e.sub(t).length(),a=i+s+o,l=i*e.x+s*t.x+o*n.x,u=i*e.y+s*t.y+o*n.y;return new q(l/a,u/a)}area(){return nu.area(this.p1,this.p2,this.p3)}static area(e,t,n){return this.area2(e.x,e.y,t.x,t.y,n.x,n.y)/2}static area2(e,t,n,i,s,o){return Math.abs(Wt.crossProd2(e,t,n,i,s,o))}scale(e,t){let n=qe.translate(-e.x,-e.y).scale(t).translate1(e),i=this.p1.multiply3(n),s=this.p2.multiply3(n),o=this.p3.multiply3(n);return new nu(i,s,o)}scaleOnBarycentre(e){return this.scale(this.barycentre(),e)}scaleOnIncentre(e){return this.scale(this.incentre(),e)}extend(e){let t=this.incentre(),n=this.p1.add(this.p2).sub(t).scale(1/2),i=n.length(),s=q.ORIGIN.pointOnRays2(n,i+e).length()/i;return this.scaleOnIncentre(s)}container(e){let t=this.p3.sub(this.p1),n=this.p2.sub(this.p1),i=e.sub(this.p1),s=t.dot(t),o=t.dot(n),a=t.dot(i),l=n.dot(n),u=n.dot(i),c=1/(s*l-o*o),h=(l*a-o*u)*c;if(h<0||h>1)return!1;let f=(s*u-o*a)*c;return f<0||f>1?!1:h+f<=1}};function eh(){return{minDistance:Number.POSITIVE_INFINITY,start:null,end:null}}var yi=class Ss{static getMinDistanceWithoutCross(e,t){let n=eh();return Ss.minLine(e,t,n),n.minDistance}static getMinDistance(e,t){return bn(e,t)?0:this.getMinDistanceWithoutCross(e,t)}static getMinLineWithCross(e,t){let n=eh();return Ss.minLine(e,t,n),new Y(n.start,n.end)}static getMinLine(e,t){return Ss.intersection(e,t)||this.getMinLineWithCross(e,t)}static getMinDistanceFromPoint(e,t){let n=eh();if(t instanceof Y)this.point2LineMinLine(n,t,e);else if(t instanceof re)this.point2ArcMinDistance(e,t,n);else throw new Error("not support");return n.minDistance}constructor(e,t){if(this.pt1=e,this.pt2=t,this.minline=Ss.intersection(e,t),this.minline)this.minDistance=0;else{let n=eh();Ss.minLine(e,t,n),this.minline=new Y(n.start,n.end),this.minDistance=n.minDistance}}getDistance(){return this.minDistance}getLine(){return this.minline}static intersection(e,t){let n=bn(e,t);if(n===0)return;let i=new Array;for(let s=0;s<n;s+=2){let o=new q(V[s],V[s+1]);i.push(o)}return i.length>1?new Y(i[0],i[1]):new Y(i[0],i[0])}static minLine(e,t,n){if(e instanceof Y&&t instanceof Y)return this.minDistanceForLines(e,t,n);if(e instanceof re&&t instanceof Y)return this.minDistanceForLineAndArc(e,t,n);if(e instanceof Y&&t instanceof re)return this.minDistanceForLineAndArc(t,e,n);if(e instanceof re&&t instanceof re)return this.minDistanceForArcs(e,t,n);throw new Error("not support")}static minDistanceForLines(e,t,n){[e.start(),e.end(),t.start(),t.end()].forEach((i,s)=>{s<2?this.point2LineMinLine(n,t,i):this.point2LineMinLine(n,e,i)})}static minDistanceForLineAndArc(e,t,n){this.point2LineMinLine(n,t,e.start()),this.point2LineMinLine(n,t,e.svgEnd);let i=Ss.foot(t,e.center);t.bbox().extendOfSize(1e-8).isContains(i)&&this.point2ArcMinLine(n,e,i),this.point2ArcMinLine(n,e,t.start()),this.point2ArcMinLine(n,e,t.end())}static minDistanceForArcs(e,t,n){this.concentricArc(e,t,n),Qn(e,t.center)&&Qn(t,e.center)?this.shortestLineForArcs(e,t,n):(this.point2ArcMinDistance(t.start(),e,n),this.point2ArcMinDistance(t.svgEnd,e,n),this.point2ArcMinDistance(e.start(),t,n),this.point2ArcMinDistance(e.svgEnd,t,n))}static minLineForArcAndLine(e,t,n){let i=e.pointOn(n.angleD(e.center)),s=e.pointOn(e.center.angleD(n));this.arcShortestLine(e,t,n,i),this.arcShortestLine(e,t,n,s)}static arcInnerLineFootSegment(e,t,n){let i=n.distance1(e.center);if(i!==0){let s=e.rx*(n.y-e.center.y)/i+e.center.y,o=e.rx*(n.x-e.center.x)/i+e.center.x;i=e.rx-i,i<t.minDistance&&(t.minDistance=i,t.start=new q(o,s),t.end=n)}else i=e.rx-i,i<t.minDistance&&(t.minDistance=i,t.start=e.start(),t.end=n)}static shortestLineForArcs(e,t,n){let i=e.center.angleD(t.center),s=t.center.angleD(e.center),o=e.pointOn(i),a=e.pointOn(s),l=t.pointOn(i),u=t.pointOn(s);Qn(e,o)&&(this.arcShortestLine(t,n,o,l),this.arcShortestLine(t,n,o,u)),Qn(e,a)&&(this.arcShortestLine(t,n,a,l),this.arcShortestLine(t,n,a,u)),this.shortestLineForArcs1(e,t,n)}static shortestLineForArcs1(e,t,n){let i=t.start().sub(e.center).normalize(),s=t.end().sub(e.center).normalize(),o=e.start().sub(t.center).normalize(),a=e.end().sub(t.center).normalize(),l=e.center.add(i.mul(e.rx)),u=e.center.add(s.mul(e.rx)),c=t.center.add(o.mul(t.rx)),h=t.center.add(a.mul(t.rx));Qn(e,l)&&ae.greater(t.start().distance2(e.center),0)&&this.arcShortestLine(e,n,t.start(),l),Qn(e,u)&&ae.greater(t.end().distance2(e.center),0)&&this.arcShortestLine(e,n,t.end(),u),Qn(t,c)&&ae.greater(e.start().distance2(t.center),0)&&this.arcShortestLine(t,n,e.start(),c),Qn(t,h)&&ae.greater(e.end().distance2(t.center),0)&&this.arcShortestLine(t,n,e.end(),h)}static concentricArc(e,t,n){if(!(e.center.distance1(t.center)<1e-5&&e.rx===t.rx&&e.ry===t.ry))return;let i=e.start().distance1(t.svgEnd);i<n.minDistance&&(n.minDistance=i,n.start=e.start(),n.end=t.svgEnd),i=t.start().distance1(e.svgEnd),i<n.minDistance&&(n.minDistance=i,n.start=t.start(),n.end=e.svgEnd)}static point2ArcMinDistance(e,t,n){if(Qn(t,e)){let i=t.pointOn(e.angleD(t.center)),s=t.pointOn(t.center.angleD(e));this.arcShortestLine(t,n,e,i),this.arcShortestLine(t,n,e,s)}else this.minLineSegment(n,t.start(),e),this.minLineSegment(n,t.svgEnd,e)}static point2ArcMinLine(e,t,n){if(Qn(t,n)){let i=n.distance1(t.center);i>t.rx||i>t.ry?this.minLineForArcAndLine(t,e,n):this.arcInnerLineFootSegment(t,e,n)}}static point2LineMinLine(e,t,n){let i=Ss.foot(t,n);t.bbox().extendOfSize(1e-8).isContains(i)?this.minLineSegment(e,i,n):(this.minLineSegment(e,t.start(),n),this.minLineSegment(e,t.end(),n))}static minLineSegment(e,t,n){let i=t.distance1(n);i<e.minDistance&&(e.minDistance=i,e.start=t,e.end=n)}static arcShortestLine(e,t,n,i){if(!Qn(e,i))return;let s=n.distance1(i);s<t.minDistance&&(t.minDistance=s,t.start=n,t.end=i)}static foot(e,t){if(e.isPoint())return e.start();if(!ae.eq(e.b,0)&&!ae.eq(e.a,0)){let n=(e.b*e.b*t.x-e.a*e.b*t.y-e.a*e.c)/(e.b*e.b+e.a*e.a),i=(-e.a*e.b*t.x+e.a*e.a*t.y-e.b*e.c)/(e.b*e.b+e.a*e.a);return new q(n,i)}else return ae.eq(e.b,0)&&!ae.eq(e.a,0)?new q(e.start().x,t.y):!ae.eq(e.b,0)&&ae.eq(e.a,0)?new q(t.x,e.start().y):t}};function Qn(r,e){if(ae.eq(r.sweepAngle,360))return!0;let t=Xe.regularD(e.angleD(r.center));return r.sweepAngle>0?(ae.less(t,r.startAngle)&&(t+=360),ae.greatereq(r.endAngle(),t)):(ae.greater(t,r.startAngle)&&(t-=360),ae.lesseq(r.endAngle(),t))}var Noe={0:0,90:1,180:0,270:-1},Roe={0:1,90:0,180:-1,270:0},cy=[1,10,100,1e3],hy="http://www.w3.org/2000/svg",dy="http://www.w3.org/1999/xlink",fy="http://www.w3.org/XML/1998/namespace",py="https://easyeda.com/",Loe=function(){var r={svg:hy,xlink:dy,xml:fy,c:py};return r[hy]="svg",r[dy]="xlink",r[fy]="xml",r[py]="c",r}(),Ooe=0,koe=1,Uoe=2,Doe=10,Goe=11,Foe=1,qoe=6,zoe=7,Yoe=16,Xoe=17,Voe=8,Woe=9,$oe=18,joe=19,Hoe=4,Zoe=12,Koe=13,Qoe=5,Joe=14,eae=15,tae=2,rae=3,nae=0,iae={A4L:{W:1169,H:827},A4P:{W:827,H:1169},A3L:{W:1654,H:1169},A3P:{W:1169,H:1654},A2L:{W:2339,H:1654},A2P:{W:1654,H:2339},A1L:{W:3311,H:2339},A1P:{W:2339,H:3311}},Jt=function(){var r={RATLINES:9,MODEL3D:19,ALL:11,TOPSILKLAYER:3,TOPLAYER:1,TOPPASTERLAYER:5,TOPSOLDERLAYER:7,LIBBODY:99,PADSURFACE:100,BOARDOUTLINE:10,DOCUMENT:12,TOPASSEMBLY:13,MECHANICAL:15,TOPCOMPONENT:16,SUBSTRATE:18},e;for(e=21;e<53;e++)r["INNER"+(e-20)]=e;for(r.BOTTOMSILKLAYER=4,r.BOTTOMLAYER=2,r.BOTTOMPASTERLAYER=6,r.BOTTOMSOLDERLAYER=8,r.BOTTOMASSEMBLY=14,r.BOTTOMCOMPONENT=17,e=53;e<85;e++)r["BOARD"+(e-52)]=e;return r}(),sae=function(){var r={COPPERAREA:[1,2,21,22,23,24],PLANEZONE:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,99],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],DIMENSION:[3,4,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11,99,100],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15],SHEET:[12,13,14,15]};r["3D"]=function(){for(var i=[16,19,3,7,5,1],s=21;s<52;s++)i.push(s+32,s);return i.push(2,6,8,4,17),i}();var e,t,n;for(e in r)if(r.hasOwnProperty(e)&&(n=r[e],n.indexOf(21)>0&&n.indexOf(25)===-1))for(t=25;t<=52;t++)n.push(t);return r}(),wr=function(){var r={1:"TopLayer",2:"BottomLayer",3:"TopSilkLayer",4:"BottomSilkLayer",5:"TopPasteMaskLayer",6:"BottomPasteMaskLayer",7:"TopSolderMaskLayer",8:"BottomSolderMaskLayer",9:"Ratlines",10:"BoardOutLine",11:"Multi-Layer",12:"Document",13:"TopAssembly",14:"BottomAssembly",15:"Mechanical",16:"TopComponents",17:"BottomComponents",18:"Substrate",19:"3DModel",99:"ComponentShapeLayer",100:"LeadShapeLayer"},e;for(e=21;e<53;e++)r[e]="Inner"+(e-20);for(e=53;e<85;e++)r[e]="Substrate"+(e-52);return r}(),oae=function(){var r=[],e=[];for(var t in Jt)if(Jt.hasOwnProperty(t)){if(t.match(/^BOARD\d+/))continue;r.push(Jt[t])}r.sort(),e.sort();var n={},i,s={21:"#999966",22:"#008000",23:"#00FF00",24:"#BC8E00",25:"#70DBFA",26:"#00CC66",27:"#9966FF",28:"#800080",29:"#008080",30:"#15935F",31:"#000080",32:"#00B400",33:"#2E4756",34:"#99842F",35:"#FFFFAA",36:"#99842F",37:"#2E4756",38:"#3535FF",39:"#8000BC",40:"#43AE5F",41:"#C3ECCE",42:"#728978",43:"#39503F",44:"#0C715D",45:"#5A8A80",46:"#2B937E",47:"#23999D",48:"#45B4E3",49:"#215DA1",50:"#4564D7",51:"#6969E9",52:"#9069E9"};r.forEach(function(a){switch(a){case Jt.TOPLAYER:i={name:wr[a],color:"#FF0000",darkColor:"#CC0000",visible:!0,active:!0,config:!0};break;case Jt.BOTTOMLAYER:i={name:wr[a],color:"#0000FF",darkColor:"#000080",visible:!0,active:!1,config:!0};break;case Jt.TOPSILKLAYER:i={name:wr[a],color:"#FFCC00",darkColor:"#806600",visible:!0,active:!1,config:!0};break;case Jt.BOTTOMSILKLAYER:i={name:wr[a],color:"#66CC33",darkColor:"#33661A",visible:!0,active:!1,config:!0};break;case Jt.TOPPASTERLAYER:i={name:wr[a],color:"#808080",darkColor:"#666666",visible:!0,active:!1,config:!0};break;case Jt.BOTTOMPASTERLAYER:i={name:wr[a],color:"#800000",darkColor:"#660000",visible:!0,active:!1,config:!0};break;case Jt.TOPSOLDERLAYER:i={name:wr[a],color:"#800080",darkColor:"#660066",visible:!0,active:!1,transparency:.3,config:!0};break;case Jt.BOTTOMSOLDERLAYER:i={name:wr[a],color:"#AA00FF",darkColor:"#8800CC",visible:!0,active:!1,transparency:.3,config:!0};break;case Jt.RATLINES:i={name:wr[a],color:"#6464FF",darkColor:"#5050CC",visible:!1,active:!1,config:!0};break;case Jt.BOARDOUTLINE:i={name:wr[a],color:"#FF00FF",darkColor:"#CC00CC",visible:!0,active:!1,config:!0};break;case Jt.ALL:i={name:wr[a],color:"#C0C0C0",darkColor:"#999999",visible:!0,active:!1,config:!0};break;case Jt.DOCUMENT:i={name:wr[a],color:"#FFFFFF",darkColor:"#CCCCCC",visible:!0,active:!1,config:!0};break;case Jt.TOPASSEMBLY:i={name:wr[a],color:"#33CC99",darkColor:"#33AA99",visible:!1,active:!1,config:!1};break;case Jt.BOTTOMASSEMBLY:i={name:wr[a],color:"#5555FF",darkColor:"#8888FF",visible:!1,active:!1,config:!1};break;case Jt.MECHANICAL:i={name:wr[a],color:"#F022F0",darkColor:"#F088F0",visible:!1,active:!1,config:!1};break;case Jt.MODEL3D:i={name:wr[a],color:"#66CCFF",visible:!1,active:!1,config:!1};break;case Jt.LIBBODY:i={name:wr[a],color:"#00CCCC",visible:!1,active:!1,config:!1};break;case Jt.PADSURFACE:i={name:wr[a],color:"#CC9999",visible:!1,active:!1,config:!1};break;default:a>=Jt.INNER1&&a<=Jt.INNER32?i={name:wr[a],color:s[a],darkColor:o(s[a]),visible:!1,active:!1,config:!1}:i=null;break}i&&(n[a]=i)}),n.Hole={config:!0,name:"Hole",darkColor:"#222222",color:"#222222"},n.DRCError={config:!0,name:"DRCError",color:"#FAD609",darkColor:"#FAD609"};function o(a){if(typeof a!="string"||!a.match(/#?([\da-f]{6})/i))return a;var l=parseInt(RegExp.$1,16),u=.5,c=Math.min(255,Math.round((l>>16)*u)),h=Math.min(255,Math.round((l>>8&255)*u)),f=Math.min(255,Math.round((l&255)*u)),d=((c<<16)+(h<<8)+f).toString(16);return"#"+("00000"+d).substr(-6).toUpperCase()}return n}(),my={BLANK:0,SCH:1,PART:2,PCB:3,FOOTPRINT:4,PRJ:5,SUBPART:6,SPICESYMBOL:7,SUBCKT:8,NETLIST:9,WAVEFORM:10,SCHLIB3D:11,PHOTOVIEW:12,SCHMODULE:13,PCBMODULE:14,VIEW3D:15,PCBLIB3D:16,BLOCK_SYMBOL:17,NETFLAG:18,NETPORT:19,SHEET_SYMBOL:20,NONEELEC_SYMBOL:21,SHORT_SYMBOL:22,FOOTPRINTVIEW:23,CNCPRINTVIEW:24,PCB2D:31,PCB3D:32},aae=function(){var r={};for(let e in my)r[my[e]]=e;return r}(),lae={PRJ:"1",BOARDS:"2",BOARD:"3",BLOCKS:"4",BLOCK:"5",SCH:"6",SHEET:"7",SYMBOLS:"8",SYMBOL:"9",NETS:"10",NET:"11",WIRE:"13",BLOCK_SYMBOL:"12",BUS:"14",SYMBOLCOLLECT:"15",NETCLASS:"16",NETCOLLECT:"17",NETTREENODE:"18",REUSEBLOCKS:"19",REUSEBLOCK:"20",NETPORTS:"23",NETPORT:"24",NETFLAGS:"25",NETFLAG:"26",SHORTSYMBOLS:"27",SHORTSYMBOL:"28",NONEELECSYMBOLS:"29",NONEELECSYMBOL:"30",PRIMITIVES:"31",PRIMITIVE:"32",PCB:"101",ALLNETROOT:"106",ObjectRoot:"objectRoot",Object:"object",TrackNet:"trackNet",CopperLayer:"copperLayer",Copper:"copper",Group:"group",ComponentClassification:"componentClassification",Nets:"nets",Net:"net",NetClasses:"netClasses",NetClass:"netClass",RatlineNets:"ratlineNets",RatlineNet:"ratlineNet",Ratline:"ratline",Differentials:"differentials",Differential:"differential",EqualLengthGroups:"equalLengthGroups",EqualLengthGroup:"equalLengthGroup",PadsPairGroups:"PadsPairGroups",PadsPairGroup:"padsPairGroup",PadsPair:"padsPair",NetComponents:"netComponents",Errors:"errors",ErrorType:"errorType",ErrorObjType:"errorObjType"},uae="~",cae="^^",hae="#@$",dae="`",fae="#sheet#",pae=["Unknow","LCSC","Digi-Key","Mouser","Element14","RS-Online"],mae=200,gae={lists:[{title:"Created",newtitle:{en:"My Libraries",cn:"\u6211\u7684\u4E2A\u4EBA\u5E93"},docType:2,tags:["All"],nickname:"Created",uuid:"c45b67d5dd2241f380ca7836744c1044"},{title:"Favorite",newtitle:{en:"My Favorites",cn:"\u6211\u7684\u6536\u85CF\u5E93"},docType:2,tags:["All"],nickname:"Favorite",uuid:"c45b67d5dd2241f380ca7836744c1044"},{nickname:"\u6D4B\u8BD5\u7528\u4F8B",uuid:"ca1608a600764e02aca5152493eba223",title:"\u6D4B\u8BD5\u7528\u4F8B",docType:2,tags:["All","1231"]}]},xae={},lm=Math.PI*2,th=Math.PI/2,bae=Math.sin(Math.PI/180);function bo(r,e,t){if(typeof r!="number"&&(r=+r),isNaN(r))return NaN;if(e=e|0,e<=0||!r&&!t)return Math.round(r);var n=cy[e]||Math.pow(10,e)||10;if(t){var i=r<0?"-":"";for(r=r<0?-r:r,r=Math.round(r*n)+"";r.length<=e;)r="0"+r;return r=r.slice(0,-e)+"."+r.slice(-e),parseFloat(i+r)}else return Math.round(r*n+1e-10)/n}function gy(r){let e=0;r>0?e=r-Math.floor(r):e=r-Math.ceil(r);let t=(e.toString()||"").length;return t>2?t-2:0}function yae(r,e,t){if(t>=5&&Math.abs(r-e)>1e-5)return!1;let n=Math.min(gy(r),gy(e));return n<10&&(n=10),isNaN(t)||(n=Math.min(n,t)),bo(r,n)===bo(e,n)}function vae(r,e){typeof r=="string"&&(r=parseFloat(r));let t=Math.pow(10,e);return Math.round(r*t)/t}function wae(r,e){if(!r||typeof r!="string")return"";var t=/\d+\.\d{12,}/g,n=cy[e]||Math.pow(10,e)||10;return r.replace(t,function(i){return(Math.round(parseFloat(i)*n+1e-10)/n).toString()})}function Eae(r,e,t,n,i,s){if(t>i){var o=t;t=i,i=o}if(n>s){var a=n;n=s,s=a}return r>=t&&r<=i&&e>=n&&e<=s}function _ae(r){var e=[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}];return e}function Pae(r,e){var t=Math.max(r.x+r.width,e.x+e.width),n=Math.max(r.y+r.height,e.y+e.height),i=Math.min(r.x,e.x),s=Math.min(r.y,e.y);return{x:i,y:s,width:t-i,height:n-s}}function Sae(r,e){return e.x<r.x+r.width&&e.x+e.width>r.x&&e.y<r.y+r.height&&e.y+e.height>r.y}function Vl(r,e,t,n){var i=r.x,s=r.y,o=e.x,a=e.y,l=t.x,u=t.y,c=o-i,h=a-s,f=c*c+h*h,d=((l-i)*c+(u-s)*h)/f;if((d>1||d<0)&&n)return null;var m=i+d*c,p=s+d*h;return{x:m,y:p}}function Iae(r,e,t,n){var i=r.x,s=r.y,o=e.x,a=e.y,l=t.x,u=t.y,c=o-i,h=a-s,f=c*c+h*h;n===void 0&&(n=0);var d=((l-i)*c+(u-s)*h)/f;if(!(d>=1+n)&&!(d<=0)){var m=i+d*c,p=s+d*h,g=m-l,b=p-u,v={point:{x:m,y:p},distance2:g*g+b*b};return v}}function Bae(r,e,t){var n=r.x,i=r.y,s=e.x,o=e.y,a=t.x,l=t.y,u=s-n,c=o-i,h=u*u+c*c;if(h===0)return(a-n)*(a-n)+(l-i)*(l-i);var f=((a-n)*u+(l-i)*c)/h,d=n+f*u,m=i+f*c,p=d-a,g=m-l;return p*p+g*g}function Aae(r,e,t,n){var i=r.x,s=r.y,o=e.x,a=e.y,l=t.x,u=t.y,c=n.x,h=n.y,f=o-i,d=a-s,m=l-c,p=u-h,g=d*m-f*p;if(!g)return null;var b=(f*m*(u-s)-l*f*p+i*d*m)/g,v=(d*p*(l-i)-u*d*m+s*f*p)/-g;return{x:b,y:v}}function Tae(r,e,t,n){function i(p,g){return p.x==g.x&&p.y==g.y}var s=i(r,t)||i(r,n)?r:i(e,t)||i(e,n)?e:null;if(s)return{x:s.x,y:s.y};var o,a,l,u,c,h,f,d,m;return o=e.x-r.x,a=e.y-r.y,l=n.x-t.x,u=n.y-t.y,f=l*a-u*o,f===0?!1:(d=t.x-r.x,m=t.y-r.y,h=(o*m-a*d)/f,c=(l*m-u*d)/f,h>=0&&h<=1&&c>=0&&c<=1?{x:r.x+c*o,y:r.y+c*a}:!1)}function FD(r,e,t){if(!e)return null;var n,i=e.length,s=null,o=e[0].x,a=e[0].y,l=o,u=a,c=r.x,h=r.y,f,d;for(n=1;n<i;n++)f=e[n].x,d=e[n].y,o>f&&(o=f),a>d&&(a=d),l<f&&(l=f),u<d&&(u=d);if(c<o-t||h<a-t||c>l+t||h>u+t)return null;for(n=1;n<i;n++)if(s=Wl(r,e[n-1],e[n]),s.d<t)return s;return null}function Wl(r,e,t){var n,i=+e.x,s=+e.y,o=+t.x,a=+t.y,l=+r.x,u=+r.y,c=o-i,h=a-s,f=l-i,d=u-s,m,p,g,b,v,w;return c===0&&h===0?{d:Math.sqrt(f*f+d*d),point:{x:i,y:s}}:(n=(f*c+d*h)/(c*c+h*h),n<0?{d:Math.sqrt(f*f+d*d),point:{x:i,y:s}}:n>1?(m=l-o,p=u-a,{d:Math.sqrt(m*m+p*p),point:{x:o,y:a}}):(v=i+n*c,w=s+n*h,g=l-v,b=u-w,{d:Math.sqrt(g*g+b*b),point:{x:v,y:w}}))}function Cae(r,e,t,n){var i=t-r,s=n-e,o=Math.atan2(s,i);return o=o<0?o+Math.PI+Math.PI:o,o}function qD(r,e,t,n){var i=r-t,s=e-n;return i*i+s*s}function ir(r,e,t,n){return Math.sqrt(qD(r,e,t,n))}function xy(r,e,t){var n=Math.sin(t),i=Math.cos(t),s=r[0]-e[0],o=r[1]-e[1];return[s*i-o*n+e[0],o*i+s*n+e[1]]}function Mae(r,e,t){return t=+t,xy(r,e,t*Math.PI/180)}function Nae(r,e,t){return t=+t,t===null?r:(typeof t=="string"?t=-parseInt(t):t=-t,xy(r,e,t*Math.PI/180))}function Rae(r){return r<0?(360+r%360)%360:r>=360?r%360:r}function um(r,e,t){var n=r-e;return t||(t=1e-10),(n>0?n:-n)<t}function Lae(r,e){let t=r.x-e.x,n=r.y-e.y;return(t>0?t:-t)<.001&&(n>0?n:-n)<.001}function Oae(r,e){var t=r-e;return(t>0?t:-t)<.1}function kae(r,e){var t=r.x-e.x,n=r.y-e.y;return(t>0?t:-t)<.1&&(n>0?n:-n)<.1}function Uae(r,e,t,n,i){var s=FD({x:t,y:n},r,i+.5*e),o=null,a;return s&&[].forEach.call(r,function(l,u){if(!o&&r[u+1]){var c=hm(s.point,l,r[u+1]);c&&(o=Vl(l,r[u+1],{x:t,y:n}),a=ir(t,n,o.x,o.y))}}),o&&{point:o,d:a}}function Dae(r,e,t,n,i){return Math.pow(r-t,2)+Math.pow(e-n,2)<=Math.pow(i,2)}function Gae(r,e){typeof r=="string"&&(r={x:+r.split(" ")[0],y:+r.split(" ")[1]});for(var t=r.x,n=r.y,i=!1,s=0,o=e.length,a=o-1;s<o;a=s,s++){typeof e[s]=="string"&&(e[s]={x:+e[s].split(" ")[0],y:+e[s].split(" ")[1]});var l=e[s].x,u=e[s].y,c=e[a].x,h=e[a].y;if(l==t&&u==n||c==t&&h==n)return!0;if(u<n&&h>=n||u>=n&&h<n){var f=l+(n-u)*(c-l)/(h-u);if(f==t)return!0;f>t&&(i=!i)}}return i}function zD(r,e,t,n,i,s){if(e===0){var o=s*s-(t/r+n)*(t/r+n);return o>=0?[{x:-t/r,y:i+Math.sqrt(o)},{x:-t/r,y:i-Math.sqrt(o)}]:[]}var a,l,u,c,h,f,d,m;h=r*r+e*e,f=2*r*t-2*n*e*e+2*i*r*e,d=t*t+2*i*t*e+e*e*(n*n+i*i-s*s);var p=jD(h,f,d);return h=p.a,f=p.b,d=p.c,m=f*f-4*h*d,m<-.001?[]:(m<0&&(m=0),m=Math.sqrt(m),a=(-f+m)/(2*h),l=(-f-m)/(2*h),Math.abs(e)<.1?(u=Math.sqrt(s*s-Math.pow(a-n,2))+i,Math.abs(r*a+e*u+t-0)>.001?(u=-Math.sqrt(s*s-Math.pow(a-n,2))+i,c=Math.sqrt(s*s-Math.pow(l-n,2))+i):c=-Math.sqrt(s*s-Math.pow(l-n,2))+i):(u=-(r*a+t)/e,c=-(r*l+t)/e),[{x:a,y:u},{x:l,y:c}])}function by(r,e,t,n,i){var s=1e-4,o={x:t,y:n};if(Math.abs(r.x-e.x)<s&&Math.abs(r.y-e.y)<s)return(r.x-t)*(r.x-t)+(r.y-n)*(r.y-n)<s?[{x:r.x,y:e.y}]:[];var a=Vl(r,e,o),l=ir(t,n,a.x,a.y);if(l-i>s)return[];if(Math.abs(l-i)<s)return[a];if(l<s)var u=Math.atan2(e.y-r.y,e.x-r.x)+Math.PI/2;else u=Math.atan2(n-a.y,t-a.x);var c=Ln(a,u),h=Ln(o,u),f=Math.sqrt(i*i-l*l),d={x:c.x,y:c.y+f},m={x:c.x,y:c.y-f},p=Ln(d,-u),g=Ln(m,-u);return[p,g]}function cm(r,e,t,n,i){var s=[];return by(r,e,t,n,i).forEach(function(o){hm({x:o.x,y:o.y},r,e)&&s.push({x:o.x,y:o.y})}),s}function hm(r,e,t){var n=c(r)&&c(e)&&c(t);if(!n)return console.warn("Bad arguments"),null;var i=e.x-t.x>0?e.x:t.x,s=e.y-t.y>0?e.y:t.y,o=e.x-t.x>0?t.x:e.x,a=e.y-t.y>0?t.y:e.y,l=r.x,u=r.y;return l<=i+.001&&l>=o-.001&&u<=s+.001&&u>=a-.001;function c(h){return h?(h.x=Number(h.x),h.y=Number(h.y),isNaN(h.x)||isNaN(h.y)?(console.warn("Can not convert to Number, NaN found"),!1):!0):(console.warn("Empty input!"),!1)}}function YD(r,e,t,n=.5){var i=h(r)&&h(e)&&h(t);if(!i)return console.warn("Bad arguments"),null;var s=e.x-t.x>0?e.x:t.x,o=e.y-t.y>0?e.y:t.y,a=e.x-t.x>0?t.x:e.x,l=e.y-t.y>0?t.y:e.y,u=r.x,c=r.y;return u<=s+.001+n&&u>=a-.001-n&&c<=o+.001+n&&c>=l-.001-n;function h(f){return f?(f.x=Number(f.x),f.y=Number(f.y),isNaN(f.x)||isNaN(f.y)?(console.warn("Can not convert to Number, NaN found"),!1):!0):(console.warn("Empty input!"),!1)}}function Fae(r,e,t,n,i,s){if(t===void 0)throw new Error("getLinesIntersection(): c1 can`t be undefined");return r*i===n*e?null:{x:(e*s-i*t)/(r*i-n*e),y:(r*s-n*t)/(e*n-i*r)}}function Ln(r,e){var t=Math.cos(e),n=Math.sin(e);return{x:r.x*t+r.y*n,y:r.y*t-r.x*n}}function qae(r,e,t){return{x:r.x+e,y:r.y+t}}function zae(r,e){return{a:r.y-e.y,b:e.x-r.x,c:r.x*e.y-e.x*r.y}}function XD(r,e,t,n){if(e||t)return Math.abs(e*r.x+t*r.y+n)/Math.sqrt(e*e+t*t)}function VD(r,e,t,n,i,s,o){o===void 0&&(o=.001);var a,l,u,c,h,f,d,m;if(Math.abs(e-i)>o){var p=(r*r-n*n+e*e-i*i+s*s-t*t)/(2*(e-i)),g=(r-n)/(e-i);if(a=1+g*g,l=-2*(r+(p-e)*g),u=r*r+Math.pow(p-e,2)-t*t,m=l*l-4*a*u,m>.001)c=(-l+Math.sqrt(m))/(2*a),h=(-l-Math.sqrt(m))/(2*a),f=p-g*c,d=p-g*h;else if(Math.abs(m)<.001)c=-l/(2*a),h=c,f=p-g*c,d=f;else return null}else if(Math.abs(r-n)>o)if(c=(r*r-n*n+s*s-t*t)/(2*(r-n)),h=c,a=1,l=-2*e,u=e*e-t*t+(c-r)*(c-r),m=l*l-4*a*u,m>.001)f=(-l+Math.sqrt(m))/(2*a),d=(-l-Math.sqrt(m))/(2*a);else if(m>-.001)f=-l/(2*a),d=f;else return null;else return null;return[{x:c,y:f},{x:h,y:d}]}function Yae(r,e,t){var n=Math.atan2(e.y,e.x)-Math.atan2(r.y,r.x);return t&&(n>Math.PI&&(n-=2*Math.PI),n<-Math.PI&&(n+=2*Math.PI)),n}function Xae(r,e,t){var n=(e.x-r.x)*(t.y-r.y)-(e.y-r.y)*(t.x-r.x);if(n>0)return"\u987A\u65F6\u9488";if(n<0)return"\u9006\u65F6\u9488";if(n===0)return"\u5171\u7EBF"}function WD(r,e,t){var n=Math.min,i=Math.max;return n(e.x,t.x)<=r.x&&r.x<=i(e.x,t.x)&&n(e.y,t.y)<=r.y&&r.y<=i(e.y,t.y)&&(r.x-e.x)*(t.y-e.y)==(t.x-e.x)*(r.y-e.y)}function Vae(r,e){if(!e||!e.length)return!1;for(var t=e.length,n=0;n<t-1;n++)if(WD(r,e[n],e[n+1]))return!0;return!1}function Wae(r,e){return r.x==e.x&&r.y==e.y}function $ae(r,e){return Math.sqrt((r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y))}function jae(r){var e;return r.match(/,/)?e=r.trim().split(","):e=r.trim().split(" "),e.map(function(t,n,i){return n%2===0?{x:Number(t),y:Number(i[n+1])}:void 0}).filter(function(t){return t!==void 0})}function Hae(r,e){return!r||!r.length?"":(e===void 0&&(e=3),e=Number(e),[].reduce.call(r,function(t,n){return t+=bo(n.x,e)+" "+bo(n.y,e)+" "},"").trim())}function Zae(r,e,t){return!r||!r.length?[]:r.map(function(n){return{x:bo(n.x*e,t||0),y:bo(n.y*e,t||0)}})}function $D(r,e,t,n,i){i||(i=0);var s=(r.x-t.x)*(e.y-t.y)-(r.y-t.y)*(e.x-t.x),o=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x);if(s*o>=i)return!1;var a=(t.x-r.x)*(n.y-r.y)-(t.y-r.y)*(n.x-r.x),l=a+s-o;if(a*l>=i)return!1;var u=a/(o-s),c=u*(e.x-r.x),h=u*(e.y-r.y);return{x:r.x+c,y:r.y+h}}function Kae(r,e){var t=.001,n=yo(r),i=yo(e);if(!n||!i)return null;var s=ha(n),o=ha(i);if(!s||!o)return console.warn("Bad arc arguments!"),null;var a=ir(s.x,s.y,n.M.x,n.M.y),l=ir(o.x,o.y,i.M.x,i.M.y);let u=VD(s.x,s.y,a,o.x,o.y,l);return u?(u=u.filter(function(c){return!!(Kr(n,c,s)&&Kr(i,c,o))}),u.length>0?u.length===2&&Math.abs(u[0].x-u[1].x)<t&&Math.abs(u[0].y-u[1].y)<t?[u[0]]:u:null):null}function yo(r){if(r=r.trim(),r[0]!=="M")return null;var e=r.slice(1).split("A");if(e.length!==2)return console.warn("Cannot handle multi arc!"),null;var t=e[0].trim().split(",").reduce(function(i,s){return i.concat(s.trim().split(" "))},[]),n=e[1].trim().split(",").reduce(function(i,s){return i.concat(s.trim().split(" "))},[]);return n.length!==7?(console.warn("Bad Arc arguments!"),null):n[0]!==n[1]?(console.warn("Eclipse is not supported"),null):{M:{x:Number(t[0]),y:Number(t[1])},A:{rx:Number(n[0]),ry:Number(n[1]),rotation:Number(n[2]),largeArc:Number(n[3]),clockwise:Number(n[4]),x:Number(n[5]),y:Number(n[6])}}}function ha(r){typeof r=="string"&&(r=yo(r));var e=r.M,t=r.A,n=r.A.rx,i=Math.atan2(t.y-e.y,t.x-e.x),s=Ln(e,i),o=Ln(t,i),a=ir(s.x,s.y,o.x,o.y)/2;n<a&&(n=a);var l=Math.sqrt(n*n-a*a),u=r.A.largeArc===r.A.clockwise?1:-1,c={x:s.x+a,y:s.y-l*u};return Ln(c,-i)}function Kr(r,e,t,n){n===void 0&&(n=.001),typeof r=="string"&&(r=yo(r)),t||(t=ha(r));var i=Math.atan2(e.y-t.y,e.x-t.x),s=Math.atan2(r.M.y-t.y,r.M.x-t.x),o=Math.atan2(r.A.y-t.y,r.A.x-t.x);if(Math.abs(s-i)<n||Math.abs(s-i)>Math.PI*2-n||Math.abs(o-i)<n)return!0;var a=Math.abs(s-o)>Math.PI==r.A.largeArc>0;return Math.abs(Math.abs(s-o)-Math.PI)<n&&(a=(s<=0&&o>=0)==(r.A.clockwise===1)),s>=o&&s>=i&&i>=o||s<=o&&s<=i&&i<=o?a:!a}function Qae(r,e,t,n){var i,s,o,a,l,u,c,h={x:null,y:null},f={x:null,y:null},d=null;return d=$D(r,e,t,n),d?{d:0,point:d}:(d=Wl(r,t,n),l=d.d,a=1/0,l<a&&(a=l,h.x=d.point.x,h.y=d.point.y,f=r),d=Wl(e,t,n),l=d.d,l<a&&(a=l,h.x=d.point.x,h.y=d.point.y,f=e),d=Wl(t,r,e),l=d.d,l<a&&(a=l,h.x=d.point.x,h.y=d.point.y,f=t),d=Wl(n,r,e),l=d.d,l<a&&(a=l,h.x=d.point.x,h.y=d.point.y,f=n),{d:a,nearP1:h,nearP2:f})}function Jae(r,e,t,n){if(!(r&&e&&t&&n))return console.warn("Bad arguments!"),null;var i=Math.atan2(e.y-r.y,e.x-r.x);i<0&&(i+=Math.PI);var s=Math.atan2(n.y-t.y,n.x-t.x);return s<0&&(s+=Math.PI),Math.abs(s-i)}function dm(r,e,t){if(t=Number(t),!r||!e||isNaN(t))return console.warn("Bad arguments!"),null;if(r.x===e.x&&r.y===e.y)return console.warn("The input points should not be the same!"),null;var n=Math.atan2(e.y-r.y,e.x-r.x),i=Ln(r,n),s=Ln(e,n),o=s.x-i.x>0?1:-1,a={x:i.x+o*t,y:i.y};return Ln(a,-n)}function ele(r,e,t){var n=Math.atan2(e.y-r.y,e.x-r.x),i=Ln(r,n),s=Ln(t,n);return s.x>=i.x}function tle(r){var e=[];if(r){var t=r.replace(/[MLZz,]/g," ").trim().split(/\s+/),n;t.length%2!==0&&console.warn("Error occured in transforming path: odd length found!"),t.forEach(function(i,s){let o=Number(i);isNaN(o)&&console.warn("Error occured in transforming path :NaN found in "+i+"! Probably because input argument is not a simple path."),s%2===0?n={x:o}:(n.y=o,e.push(n))})}return e}function rle(r){if(!r.length)return[];for(var e=[],t={},n=0;n<r.length;n++){var i=typeof r[n]+r[n];t[i]||(e.push(r[n]),t[i]=!0)}return e}function nle(r,e){if(!e&&r.clockwise!==void 0)return r.clockwise;for(var t=0,n=1,i=r.length;n<i;n++)t+=(r[n].x-r[n-1].x)*(r[n].y+r[n-1].y);return t+=(r[0].x-r[i-1].x)*(r[0].y+r[i-1].y),r.clockwise=t<0}function jD(r,e,t){var n=[r,e,t],i=s(n);return{a:r/i,b:e/i,c:t/i};function s(o){o=o.filter(function(c){return c!=0}).sort(function(c,h){return Math.abs(c)-Math.abs(h)});var a=u(o[o.length-1]),l=u(o[0]);if(a-l>10)return o.shift(),s(o);if(a<=0&&l<=0||l>=1)return o[0];return 1;function u(c){if(Math.abs(c)>=1){var h=Math.abs(c).toString();return h.indexOf("e")>=0?+h.split(/e/)[1]+1:h.split(".")[0].length}else return h=Math.abs(c).toString(),h.indexOf("e-")>=0?-h.split(/e-/)[1]+1:-h.match(/\.0*/g)[0].length-1}}}function ile(r,e,t){e=e||1,t=t||32;var n="",i=e,s=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];r&&(i=Math.round(Math.random()*(t-e))+e);for(var o=0;o<i;o++){let a=Math.round(Math.random()*(s.length-1));n+=s[a]}return n}function sle(r,e,t,n){n===void 0&&(n=1e-4),typeof r=="string"&&(r=yo(r)),t||(t=ha(r));var i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))/ir(t.x,t.y,r.M.x,r.M.y)-1;return!!(Math.abs(i)<n&&Kr(r,e,t))}function ole(r,e){var t=1e-4;typeof r=="string"&&(r=yo(r));var n,i,s,o,a,l,u,c,h,f,d,m=ha(r),p=ir(m.x,m.y,r.M.x,r.M.y),g=r.M,b={x:r.A.x,y:r.A.y},v={x:b.x-m.x||0,y:-(b.y-m.y)||0},w={x:g.x-m.x||0,y:-(g.y-m.y)||0};if(e.x==g.x&&e.y==g.y)var P="startPoint";else e.x==b.x&&e.y==b.y?P="endPoint":P="other";if(n=m.y-e.y,i=e.x-m.x,s=m.x*e.y-m.y*e.x,o=-i,a=n,l=-o*m.x-a*m.y,u=zD(o,a,l,m.x,m.y,p),u.length==2){c=u[0],h=u[1];var _={x:h.x-c.x,y:-(h.y-c.y)};P=="endPoint"?f=Math.atan2(_.y,_.x)-Math.atan2(w.y,w.x):f=Math.atan2(_.y,_.x)-Math.atan2(v.y,v.x),f>=Math.PI?f=2*Math.PI-f:f<=-Math.PI?f+=2*Math.PI:f>-Math.PI&&f<0&&(f=-f);var B={x:c.x-h.x,y:-(c.y-h.y)};P=="endPoint"?d=Math.atan2(B.y,B.x)-Math.atan2(w.y,w.x):d=Math.atan2(B.y,B.x)-Math.atan2(v.y,v.x),d>=Math.PI?d=2*Math.PI-d:d<=-Math.PI?d+=2*Math.PI:d>-Math.PI&&d<0&&(d=-d);var I=+r.A.largeArc==1,C=Math.abs(f-d)<t;if(P=="endPoint")if(C){if(Kr(r,h,m))return B;if(Kr(r,c,m))return _}else{if(f<d&&!I||f>d&&I)return B;if(f<d&&I||f>d&&!I)return _}else if(P=="startPoint")if(C){if(Kr(r,h,m))return _;if(Kr(r,c,m))return B}else{if(f<d&&!I||f>d&&I)return _;if(f<d&&I||f>d&&!I)return B}}}function ale(r,e,t){var n=.001;if(typeof r=="string"&&(r=yo(r)),!r||!e||!t)return null;if(r.A.rx!==r.A.ry)return console.warn("Eclipse is not supported."),null;var i=ha(r),s=by(e,t,i.x,i.y,r.A.rx);return s=s.filter(function(o){return!!Kr(r,o,i)}),s.length===0?null:s.length===2&&Math.abs(s[0].x-s[1].x)<n&&Math.abs(s[0].y-s[1].y)<n?[s[0]]:s}function lle(r,e,t,n){var i=+e.y-+r.y,s=+e.x-+r.x,o=Math.sqrt(i*i+s*s),a,l;if(Math.abs(r.x-e.x)<1e-12&&Math.abs(r.y-e.y)<1e-12){var u=Math.atan2(n,1);l=Math.cos(u)*t,a=Math.sin(u)*t}else if(n==="none"||n==1/0||n==-1/0){let h=i>0?t:-t;a=i+h,l=0}else if(o===0)l=Math.sqrt(t*t/(n*n+1)),a=l*n;else{var c=o+t;a=i*c/o,l=s*c/o}return{x:+r.x+l,y:+r.y+a}}function ule(r,e,t,n){function i(l,u,c,h){return l*h-u*c}var s=i(e.x-r.x,t.x-n.x,e.y-r.y,t.y-n.y);if(s<=1e-6&&s>=-1e-6)return!1;var o=i(t.x-r.x,t.x-n.x,t.y-r.y,t.y-n.y)/s;if(o>1||o<0)return!1;var a=i(e.x-r.x,t.x-r.x,e.y-r.y,t.y-r.y)/s;return!(a>1||a<0)}function HD(r,e,t,n,i,s){var o=(i-t)*(r-t)+(s-n)*(e-n),a=(i-t)*(i-t)+(s-n)*(s-n),l=o/a,u=t+(i-t)*l,c=n+(s-n)*l;return o<=0?Math.sqrt((r-t)*(r-t)+(e-n)*(e-n)):o>=a?Math.sqrt((r-i)*(r-i)+(e-s)*(e-s)):Math.sqrt((r-u)*(r-u)+(c-e)*(c-e))}function cle(r,e,t,n,i,s){var o={x:i.cx,y:i.cy},a={x:r,y:e},l={x:t,y:n},u=!0,c=i.rx,h={x:+s[0],y:+s[1]},f={x:+s[7],y:+s[8]},d=ir(o.x,o.y,r,e),m=ir(o.x,o.y,t,n),p={A:{clockwise:+s[6],largeArc:+s[5],rotation:+s[4],rx:+s[3],ry:+s[2],x:+s[7],y:+s[8]},M:{x:+s[0],y:+s[1]}},g=0,b=0,v=0,w=0,P=0,_=0,B=0,I=0,C=0,N=[],A=Vl(a,l,o,u);if(A)if(ir(A.x,A.y,o.x,o.y)>c){var M=cm(A,o,o.x,o.y,c)[0];Kr(p,M,o)&&(g=ir(A.x,A.y,M.x,M.y),N.push(g))}else M=dm(o,A,c),M&&Kr(p,M,o)&&(g=ir(A.x,A.y,M.x,M.y),N.push(g));var S=Vl(a,l,h,u);S&&(b=ir(S.x,S.y,h.x,h.y),N.push(b));var $=Vl(a,l,f,u);if($&&(v=ir($.x,$.y,f.x,f.y),N.push(v)),d>c){var H=cm(a,o,o.x,o.y,c)[0];Kr(p,H,o)&&(w=ir(H.x,H.y,a.x,a.y),N.push(w))}else H=dm(o,a,c),Kr(p,H,o)&&(w=ir(H.x,H.y,a.x,a.y),N.push(w));return m>c?(H=cm(l,o,o.x,o.y,c)[0],Kr(p,H,o)&&(P=ir(H.x,H.y,l.x,l.y),N.push(P))):(H=dm(o,l,c),Kr(p,H,o)&&(P=ir(H.x,H.y,l.x,l.y),N.push(P))),_=ir(a.x,a.y,h.x,h.y),B=ir(a.x,a.y,f.x,f.y),I=ir(l.x,l.y,h.x,h.y),C=ir(l.x,l.y,f.x,f.y),N.push(_,B,I,C),Math.min.apply(null,N)}function hle(r,e,t){var n=t.y-e.y,i=e.x-t.x,s=t.x*e.y-e.x*t.y;return XD(r,n,i,s)}function dle(r){return{x:Math.round(r.x*1e4),y:Math.round(r.y*1e4)}}function fle(r,e){if(!e||!e.length)return r;let t=e.indexOf(r);if(t>=0)return e[t];t=0;let n=1/0;return e.forEach((i,s)=>{n>Math.abs(i-r)&&(t=s)}),e[t]}function ZD(r,e,t){return hm(r,e,t)?um((r.x-e.x)*(t.y-e.y),(t.x-e.x)*(r.y-e.y),.001):!1}var $l=1e-4,V=new Float64Array(100);function bn(r,e){if(r instanceof Y&&e instanceof Y)return vi(r,e);if(r instanceof re&&e instanceof Y)return pm(r,e);if(r instanceof Y&&e instanceof re)return pm(e,r);if(r instanceof re&&e instanceof re)return Py(r,e);if(r instanceof Ae&&e instanceof Ae)return rh(r,e);if(r instanceof Ae&&e instanceof Y)return rh(r,new Ae([e.start(),e.end()]));if(r instanceof Y&&e instanceof Ae)return rh(new Ae([r.start(),r.end()]),e);if(r instanceof Ae&&e instanceof re)return Cy(e,r);if(r instanceof re&&e instanceof Ae)return Cy(r,e);throw new Error("not supported operation")}function ple(r,e){let t=r.primitives,n=e.primitives,i=t.length>n.length?n:t,s=t.length>n.length?t:n,o=!1;return i.some(a=>(s.some(l=>(o=bn(a,l)>0,o)),o)),o}function mle(r,e){if(r instanceof Y)return yy(r,e);if(r instanceof re)return vy(r,e);if(r instanceof Ae)return fm(r,e);throw new Error("not supported operation")}function yy(r,e){let t=r.bbox();if(t.isContainsY1(e)){let n=new Y(new q(t.minX-1,e),new q(t.maxX+1,e));return vi(n,r)>0?1:0}else return 0}function vy(r,e){if(r.rx===r.ry){let t=r.bbox();if(t.isContainsY1(e)){let n=new Y(new q(t.minX-1,e),new q(t.maxX+1,e));return jl(r,n)>0?1:0}else return 0}else throw new Error("not supported operation")}function gle(r,e){if(r.rx===r.ry){let t=r.bbox();if(t.isContainsY1(e)){let n=new Y(new q(t.minX-1,e),new q(t.maxX+1,e)),i=jl(r,n);return i>0?i:0}else return 0}else throw new Error("not supported operation")}function fm(r,e){let t=r.bbox();return t.isContainsY1(e)&&rh(new Ae([new q(t.minX-1,e),new q(t.maxX+1,e)]),r)>0?1:0}function wy(r,e,t){return isFinite(e)&&isFinite(t)?r.isContains2(e,t):!1}function KD(r,e){let t=e.length(),n=Wt.crossProd3(e.start(),e.end(),r.start())/t,i=Wt.crossProd3(e.start(),e.end(),r.end())/t;return Math.abs(n)<1e-8||Math.abs(i)<1e-8||n*i<0}function vi(r,e){let t=r.bbox().intersection1(e.bbox());if(!t)return 0;if(r.isPoint())if(e.isPoint()){let n=t.center();return V[0]=n.x,V[1]=n.y,2}else return Ey(e,r,t);else{if(e.isPoint())return Ey(r,e,t);{let n=function(w,P){t.isContains2(w,P)&&(V[v++]=w,V[v++]=P)};if(!KD(r,e))return 0;let i=r.start().x,s=r.start().y,o=r.end().x,a=r.end().y,l=e.start().x,u=e.start().y,c=e.end().x,h=e.end().y,f=e.length(),d=Wt.crossProd2(i,s,l,u,c,h)/f,m=Wt.crossProd2(o,a,l,u,c,h)/f;if(d*m>0&&!ae.eq(d,0)&&!ae.eq(m,0))return 0;let p=r.length(),g=Wt.crossProd2(l,u,i,s,o,a)/p,b=Wt.crossProd2(c,h,i,s,o,a)/p;if(g*b>0&&!ae.eq(g,0)&&!ae.eq(b,0))return 0;let v=0;if(ae.eq(d,0)&&ae.eq(m,0)){let w=t.UL(),P=t.UR(),_=t.LL(),B=t.LR();if(ae.eq(t.width(),0))ae.eq(t.height(),0)?(V[v++]=w.x,V[v++]=w.y):(V[v++]=w.x,V[v++]=w.y,V[v++]=_.x,V[v++]=_.y);else if(ae.eq(t.height(),0))V[v++]=w.x,V[v++]=w.y,V[v++]=P.x,V[v++]=P.y;else{let I=Ji.area2(w.x,w.y,l,u,c,h),C=Ji.area2(P.x,P.y,l,u,c,h);I<C?(V[v++]=w.x,V[v++]=w.y,V[v++]=B.x,V[v++]=B.y):(V[v++]=P.x,V[v++]=P.y,V[v++]=_.x,V[v++]=_.y)}}else if(ae.eq(d,0))n(i,s);else if(ae.eq(m,0))n(o,a);else{let w=Math.abs(d/(d-m));n(i+(o-i)*w,s+(a-s)*w)}return v}}}function Ey(r,e,t){let n=e.start(),i=e.end(),s=Wt.crossProd3(r.start(),r.end(),e.start()),o=Wt.crossProd3(r.start(),r.end(),e.end());if(s*o<0){let a=t.center();return V[0]=a.x,V[1]=a.y,2}else if(Math.abs(s)<Math.abs(o)){if(ae.eq(s/r.length(),0))return V[0]=n.x,V[1]=n.y,2}else if(ae.eq(o/r.length(),0))return V[0]=i.x,V[1]=i.y,2;return 0}function xle(r,e){return r.bbox().extendOfSize(1e-8).isContains(e)?r.isPoint()?e.equals1(r.start())?(V[0]=e.x,V[1]=e.y,2):0:ae.eq(Ji.area2(r.start().x,r.start().y,r.end().x,r.end().y,e.x,e.y),0)?(V[0]=e.x,V[1]=e.y,2):0:0}function QD(r,e,t,n=.5){let i=Ty(r,e,t);i.d<=n&&(r=i.point);let s=e.distance1(t),o=e.distance1(r),a=t.distance1(r);return!!um(o+a,s,.001)}function jl(r,e){let t=r.bbox().intersection1(e.bbox());if(t!=null){t=t.extendOfSize($l);let n=r.center.x,i=r.center.y,s=r.rx,o=r.rx2,a=e.start().x,l=e.start().y,u=e.end().x,c=e.end().y,h=r.center.distance1(e.start()),f=r.center.distance1(e.end()),d=ae.eq(h,s)?0:h>s?1:-1,m=ae.eq(f,s)?0:f>s?1:-1,p=0;if(d===-1&&m===-1)return 0;if(d===0&&m===0)V[p++]=a,V[p++]=l,V[p++]=u,V[p++]=c;else if(d===1&&m===1){let g=yi.foot(e,r.center),b=g.distance1(r.center);if(ae.greater(b,s))return 0;if(ae.eq(b,s))ae.eq(e.distance2(r.start()),0)?(V[p++]=r.start().x,V[p++]=r.start().y,V[p++]=r.start().x,V[p++]=r.start().y):ae.eq(e.distance2(r.end()),0)?(V[p++]=r.end().x,V[p++]=r.end().y,V[p++]=r.end().x,V[p++]=r.end().y):(V[p++]=g.x,V[p++]=g.y,V[p++]=g.x,V[p++]=g.y);else{p=_y(n,i,a,l,u,c,p,g);let v=V[p-2],w=V[p-1];p-=2;let P=Wt.distance1(n,i,v,w);if(ae.eq(P,s))V[p++]=v,V[p++]=w,V[p++]=v,V[p++]=w;else if(P<s)p=Ir(o,n,i,a,l,v,w,p),p=Ir(o,n,i,v,w,u,c,p);else return 0}}else if(d===-1||m===-1)p=Ir(o,n,i,a,l,u,c,p);else{let g=yi.foot(e,r.center),b=g.distance1(r.center);if(ae.eq(b,s)){let v=function(_){return wy(t,_.x,_.y)&&jt(r,_)},w=r.start(),P=r.end();if(d===0){let _=e.start();if(v(_))return V[p++]=_.x,V[p++]=_.y,V[p++]=_.x,V[p++]=_.y,p;if(v(g))return V[p++]=g.x,V[p++]=g.y,V[p++]=g.x,V[p++]=g.y,p;if(ae.eq(e.distance2(w),0)&&v(w))return V[p++]=w.x,V[p++]=w.y,V[p++]=w.x,V[p++]=w.y,p;if(ae.eq(e.distance2(P),0)&&v(P))return V[p++]=P.x,V[p++]=P.y,V[p++]=P.x,V[p++]=P.y,p;if(h<=s)p=Ir(o,n,i,g.x,g.y,u,c,p),p===2&&(V[p++]=V[0],V[p++]=V[1]);else if(b<s){if(p=Ir(o,n,i,g.x,g.y,u,c,p),p===2&&v(new q(V[0],V[1])))return V[p++]=V[0],V[p++]=V[1],p;p=Ir(o,n,i,g.x,g.y,a,l,0),p===2&&(V[p++]=V[0],V[p++]=V[1])}}else{let _=e.end();if(v(_))return V[p++]=_.x,V[p++]=_.y,V[p++]=_.x,V[p++]=_.y,p;if(v(g))return V[p++]=g.x,V[p++]=g.y,V[p++]=g.x,V[p++]=g.y,p;if(ae.eq(e.distance2(w),0)&&v(w))return V[p++]=w.x,V[p++]=w.y,V[p++]=w.x,V[p++]=w.y,p;if(ae.eq(e.distance2(P),0)&&v(P))return V[p++]=P.x,V[p++]=P.y,V[p++]=P.x,V[p++]=P.y,p;if(f<=s)p=Ir(o,n,i,g.x,g.y,a,l,p),p===2&&(V[p++]=V[0],V[p++]=V[1]);else if(b<s){if(p=Ir(o,n,i,g.x,g.y,a,l,p),p===2&&v(new q(V[0],V[1])))return V[p++]=V[0],V[p++]=V[1],p;p=Ir(o,n,i,g.x,g.y,u,c,0),p===2&&(V[p++]=V[0],V[p++]=V[1])}}}else if(d===0){let v=e.start();V[p++]=v.x,V[p++]=v.y,(a-g.x)*(u-g.x)+(l-g.y)*(c-g.y)<0&&(p=Ir(o,n,i,g.x,g.y,u,c,p))}else{let v=e.end();V[p++]=v.x,V[p++]=v.y,(a-g.x)*(u-g.x)+(l-g.y)*(c-g.y)<0&&(p=Ir(o,n,i,g.x,g.y,a,l,p))}}if(p>0){let g=0;for(let b=0;b<p;b+=2){let v=V[b],w=V[b+1];isFinite(v)&&isFinite(w)&&wy(t,v,w)&&jt(r,new q(v,w))&&(V[g++]=v,V[g++]=w)}return g}else return 0}else return 0}function JD(r,e){if(r.bbox()){let t=r.center.x,n=r.center.y,i=r.rx2,s=e.start().x,o=e.start().y,a=e.end().x,l=e.end().y,u=r.center.distance2(e.start()),c=r.center.distance2(e.end()),h=ae.eq(u,i)?0:u>i?1:-1,f=ae.eq(c,i)?0:c>i?1:-1,d=0;if(h===-1&&f===-1)return 0;if(h===0&&f===0)V[d++]=s,V[d++]=o,V[d++]=a,V[d++]=l;else if(h===1&&f===1){let m=yi.foot(e,r.center),p=m.distance2(r.center);if(ae.greater(p,i))return 0;if(ae.eq(p,i)){let g=m.distance2(r.start()),b=m.distance2(r.end());ae.eq(g,0)?(V[d++]=r.start().x,V[d++]=r.start().y):ae.eq(b,0)?(V[d++]=r.end().x,V[d++]=r.end().y):(V[d++]=m.x,V[d++]=m.y)}else{d=_y(t,n,s,o,a,l,d,m);let g=V[d-2],b=V[d-1],v=Wt.distance2(t,n,g,b);if(d-=2,ae.eq(v,i))V[d++]=g,V[d++]=b;else if(v<i)d=Ir(i,t,n,s,o,g,b,d),d=Ir(i,t,n,g,b,a,l,d);else return 0}}else if(h===-1||f===-1)d=Ir(i,t,n,s,o,a,l,d);else{let m=yi.foot(e,r.center);h===0?(V[d++]=e.start().x,V[d++]=e.start().y,ae.neq(m.distance2(e.start()),0)&&(s-m.x)*(a-m.x)+(o-m.y)*(l-m.y)<0&&(d=Ir(i,t,n,m.x,m.y,a,l,d))):(V[d++]=e.end().x,V[d++]=e.end().y,ae.neq(m.distance2(e.end()),0)&&(s-m.x)*(a-m.x)+(o-m.y)*(l-m.y)<0&&(d=Ir(i,t,n,m.x,m.y,s,o,d)))}if(d>0){let m=0;for(let p=0;p<d;p+=2){let g=V[p],b=V[p+1];isFinite(g)&&isFinite(b)&&(V[m++]=g,V[m++]=b)}return m}else return 0}else return 0}function Ir(r,e,t,n,i,s,o,a){if(i==o){let w=r-(i-t)*(i-t);if(ae.greater(w,0)){let P=Math.sqrt(w),_=e-P,B=e+P,I=Math.min(n,s),C=Math.max(n,s);return _>=I&&_<=C&&(V[a++]=_,V[a++]=i),B>=I&&B<=C&&(V[a++]=B,V[a++]=i),a}}let l=Wt.distance2(n,i,e,t)-r;if(l===0)return V[a++]=n,V[a++]=i,a;let u=Wt.distance2(s,o,e,t)-r;if(u===0)return V[a++]=s,V[a++]=o,a;let c=n,h=i,f=s,d=o,m=NaN,p=NaN,g=Number.POSITIVE_INFINITY,b=0;for(;g!==0;){b++;let w=Math.max(Math.min(Math.abs(l)/(Math.abs(l)+Math.abs(u)),.75),.25);if(m=c+(f-c)*w,p=h+(d-h)*w,c===m&&h===p||f===m&&d===p){Math.abs(l)>Math.abs(u)?(m=f,p=d,g=u):(m=c,p=h,g=l);break}else g=Wt.distance2(m,p,e,t)-r,g<0&&l>u||g>0&&l<u?(f=m,d=p,u=g):(c=m,h=p,l=g)}let v=Math.sqrt(r)-Wt.distance1(m,p,e,t);return(ae.eq(0,g)||ae.eq(0,v))&&(V[a++]=m,V[a++]=p),a}function _y(r,e,t,n,i,s,o,a){let l=Wt.dotProd2(t,n,i,s,r,e),u=Wt.dotProd2(i,s,t,n,r,e);if(l>=0)return V[o++]=i,V[o++]=s,o;if(u>=0)return V[o++]=t,V[o++]=n,o;if(Wt.crossProd2(t,n,i,s,r,e)==0)return V[o++]=r,V[o++]=e,o;{let c=NaN,h=NaN,f=t,d=n,m=i,p=s,g=Wt.distance2(t,n,r,e),b=Wt.distance2(i,s,r,e),v=Number.POSITIVE_INFINITY,w=0;for(;v>0&&(w++,c=f+(m-f)*.5,h=d+(p-d)*.5,!(g==b||f==c&&d==h||m==c&&p==h));){v=Wt.distance2(c,h,r,e);let P=Wt.dotProd2(f,d,c,h,r,e);if(P==0)break;P<0?(m=c,p=h,b=v):(f=c,d=h,g=v)}return Wt.distance2(c,h,r,e)<Wt.distance2(a.x,a.y,r,e)?(V[o++]=c,V[o++]=h):(V[o++]=a.x,V[o++]=a.y),o}}function pm(r,e){if(r.rx===r.ry)return jl(r,e);throw new Error("not supported")}function e6(r,e){if(r.rx===r.ry)return JD(r,e);throw new Error("not supported")}function Py(r,e){if(r.bbox().intersection1(e.bbox())!=null){if(r.rx===r.ry&&e.rx===e.ry)return t6(r,e);throw new Error("not supported operation")}return 0}function t6(r,e){let t=r.center.x,n=r.center.y,i=e.center.x,s=e.center.y,o=r.rx,a=e.rx,l=r.rx2,u=e.rx2,c=r.center.distance1(e.center),h=Math.abs(o-a),f=o+a;if(ae.greater(c,f)||ae.less(c,h))return 0;if(ae.eq(h+c,0)){let d=0,m;return jt(r,e.start())&&(V[d]=e.start().x,V[d+1]=e.start().y,d+=2,m=e.start()),jt(r,e.end())&&(V[d]=e.end().x,V[d+1]=e.end().y,d+=2,m=e.end()),d===0?(jt(e,r.start())&&(V[d]=r.start().x,V[d+1]=r.start().y,d+=2),jt(e,r.end())&&(V[d]=r.end().x,V[d+1]=r.end().y,d+=2)):d===2&&(!m.equals1(r.start())&&jt(e,r.start())&&(V[d]=r.start().x,V[d+1]=r.start().y,d+=2),!m.equals1(r.end())&&jt(e,r.end())&&(V[d]=r.end().x,V[d+1]=r.end().y,d+=2)),d}else if(ae.eq(c,f)){if(Sy(r,e))return 4;let d=new Y(r.center,e.center),m=jl(e,d);return m=Iy(r,m),m!==0?m:(m=jl(r,d),Iy(e,m))}else if(ae.eq(c,h)){if(Sy(r,e))return 4;if(o>a){let d=(o-a)/o;return V[0]=t+(i-t)/d,V[1]=n+(s-n)/d,By(r,e,2)}else{let d=(a-o)/a;return V[0]=i+(t-i)/d,V[1]=s+(n-s)/d,By(r,e,2)}}else{let d=(r.center.distance2(e.center)-u+l)/(c*2)/c,m=(i-t)*d+t,p=(s-n)*d+n,g=i-t,b=s-n,v=Math.max(o,a),w,P,_,B;if(Math.abs(g)<Math.abs(b)){let A=g/-b,M=p-A*m;w=m-v,P=A*w+M,_=m+v,B=A*_+M}else{let A=b/-g,M=m-A*p;P=p-v,w=A*P+M,B=p+v,_=A*B+M}let I=Ir(l,t,n,w,P,m,p,0);if(I=Ir(l,t,n,m,p,_,B,I),I!==4)throw new Error("cnt !== 4");let C=new q(V[0],V[1]),N=new q(V[2],V[3]);if(jt(r,C)&&jt(e,C))return jt(r,N)&&jt(e,N)?4:Es(r.start(),e,N,C)?(V[2]=r.start().x,V[3]=r.start().y,4):Es(r.end(),e,N,C)?(V[2]=r.end().x,V[3]=r.end().y,4):Es(e.start(),r,N,C)?(V[2]=e.start().x,V[3]=e.start().y,4):Es(e.end(),r,N,C)?(V[2]=e.end().x,V[3]=e.end().y,4):2;if(jt(r,N)&&jt(e,N))return Es(r.start(),e,C,N)?(V[0]=r.start().x,V[1]=r.start().y,4):Es(r.end(),e,C,N)?(V[0]=r.end().x,V[1]=r.end().y,4):Es(e.start(),r,C,N)?(V[0]=e.start().x,V[1]=e.start().y,4):Es(e.end(),r,C,N)?(V[0]=e.end().x,V[1]=e.end().y,4):(V[0]=V[2],V[1]=V[3],2);{let A=function(H,K){if(ae.eq(H.distance1(K.center),K.rx)&&jt(K,H)){if(H.distance2(C)<H.distance2(N)){if(M)return;M=!0}else{if(S)return;S=!0}V[$++]=H.x,V[$++]=H.y}},M=!1,S=!1,$=0;return A(r.start(),e),A(r.end(),e),A(e.start(),r),A(e.end(),r),$}}}function Es(r,e,t,n){return ae.eq(r.distance1(e.center),e.rx)&&jt(e,r)&&r.distance2(t)<r.distance2(n)}function Sy(r,e){return ae.eq(e.start().distance1(r.center),r.rx)&&jt(r,e.start())?(V[0]=e.start().x,V[1]=e.start().y,V[2]=e.start().x,V[3]=e.start().y,!0):ae.eq(e.end().distance1(r.center),r.rx)&&jt(r,e.end())?(V[0]=e.end().x,V[1]=e.end().y,V[2]=e.end().x,V[3]=e.end().y,!0):ae.eq(r.start().distance1(e.center),e.rx)&&jt(e,r.start())?(V[0]=r.start().x,V[1]=r.start().y,V[2]=r.start().x,V[3]=r.start().y,!0):ae.eq(r.end().distance1(e.center),e.rx)&&jt(e,r.end())?(V[0]=r.end().x,V[1]=r.end().y,V[2]=r.end().x,V[3]=r.end().y,!0):!1}function Iy(r,e){if(e===0)return 0;let t=V[0],n=V[1];return jt(r,new q(t,n))?(V[0]=t,V[1]=n,V[2]=t,V[3]=n,4):0}function By(r,e,t){if(t===0)return 0;let n=V[0],i=V[1],s=new q(n,i);return jt(r,s)&&jt(e,s)?(V[0]=n,V[1]=i,V[2]=n,V[3]=i,4):0}function da(r,e){return Math.abs(r-e)<=1e-6}function jt(r,e){let t=r.bbox();if(e.x-t.minX>-$l&&e.x-t.maxX<$l&&e.y-t.minY>-$l&&e.y-t.maxY<$l){let n=Xe.regularD(e.angleD(r.center));return da(n,r.startAngle)||da(n,r.startAngle+360)||da(n,r.startAngle-360)||da(n,r.endAngle())||da(n,r.endAngle()+360)||da(n,r.endAngle()-360)?!0:r.sweepAngle>0?(ae.less(n,r.startAngle)&&(n+=360),ae.greatereq(r.endAngle(),n)):(ae.greater(n,r.startAngle)&&(n-=360),ae.lesseq(r.endAngle(),n))}else return!1}function ble(r,e){return e.primitives.some(t=>QD(r,t.start(),t.end()))}function yle(r,e,t,n=.5){return YD(r,e,t)?Wt.crossProd3(r,e,t)<Math.sin(Math.PI/180):!1}function vle(r){let e=[];r.points(1,t=>{e.push(t)});for(let t=0;t<r.primitives.length;t++){let n=r.primitives[t],i=r.primitives[t+1];for(;i&&Ay([n.start(),n.end()],[i.start(),i.end()]);)t++,n=r.primitives[t],i=r.primitives[t+1];return t==r.primitives.length-1}}function Ay(r,e){let t=r[1].x-r[0].x,n=r[1].y-r[0].y,i=e[1].x-e[0].x,s=e[1].y-e[0].y;if(t===0&&i!==0||t!==0&&i===0)return!1;if(t===0&&i===0)return!0;let o=n/t,a=s/i;return um(o,a,Math.sin(Math.PI/180))}function Ty(r,e,t){var n,i=+e.x,s=+e.y,o=+t.x,a=+t.y,l=+r.x,u=+r.y,c=o-i,h=a-s,f=l-i,d=u-s,m,p,g,b,v,w;return c===0&&h===0?{d:Math.sqrt(f*f+d*d),point:new q(i,s)}:(n=(f*c+d*h)/(c*c+h*h),n<0?{d:Math.sqrt(f*f+d*d),point:new q(i,s)}:n>1?(m=l-o,p=u-a,{d:Math.sqrt(m*m+p*p),point:new q(o,a)}):(v=i+n*c,w=s+n*h,g=l-v,b=u-w,{d:Math.sqrt(g*g+b*b),point:new q(v,w)}))}function r6(r,e,t,n){function i(p,g,b){return p instanceof q&&g instanceof q?Math.abs(p.x-g.x)<=b&&Math.abs(p.y-g.y)<=b:!1}var s=i(r,t,.5)||i(r,n,.5)?r:i(e,t,.5)||i(e,n,.5)?e:null;if(s)return!1;var o,a,l,u,c,h,f,d,m;return o=e.x-r.x,a=e.y-r.y,l=n.x-t.x,u=n.y-t.y,f=l*a-u*o,f===0?!1:(d=t.x-r.x,m=t.y-r.y,h=(o*m-a*d)/f,c=(l*m-u*d)/f,h>=0&&h<=1&&c>=0&&c<=1?new q(r.x+c*o,r.y+c*a):!1)}function Jn(r,e){if(!r||!e||r.length!=e.length)return!1;let t="equals1";return!r.some((n,i)=>{let s=e[i],o=!1;return n&&s&&typeof n=="object"&&typeof s=="object"?typeof n[t]=="function"&&i6(n,s)?o=!n[t].call(n,s):o=!(n===s||n.toString()===s.toString()):typeof n=="number"&&typeof s=="number"?o=!(n6(n,s)||Number.isNaN(n)&&Number.isNaN(s)):o=n!==s,o})}function n6(r,e,t=5){return Math.abs(r-e)*Math.pow(10,t)<1}function i6(r,e){return!r||!e||typeof r!="object"||typeof e!="object"?r===e:r.constructor===e.constructor}function wle(r,e){return new Y(r,e)}function Ele(r){let e=[];for(let t=0;t<r.primitives.length;t++){let n=r.primitives[t];for(let i=t+1;i<r.primitives.length;i++){let s=r.primitives[i],o=r6(n.start().mul(.1),n.end().mul(.1),s.start().mul(.1),s.end().mul(.1));o&&e.push(o.mul(10))}}return e}function _le(r,e,t,n){var i=e.y-r.y,s=r.x-e.x,o=i*r.x+s*r.y,a=n.y-t.y,l=t.x-n.x,u=a*t.x+l*t.y,c=i*l-a*s;if(c==0)return null;var h=(l*o-s*u)/c,f=(i*u-a*o)/c;return new q(h,f)}function Ple(r,e,t){isNaN(t)&&(t=.001);let n=r.center,i=r.start(),s=r.rx,o=r.ry;var a=Math.atan2(e.y-n.y,e.x-n.x),l=Math.atan2(i.y-n.y,i.x-n.x),u=Math.atan2(o-n.y,s-n.x);if(Math.abs(l-a)<t||Math.abs(l-a)>Math.PI*2-t||Math.abs(u-a)<t)return!0;var c=Math.abs(l-u)>Math.PI===r.isLarge();return Math.abs(Math.abs(l-u)-Math.PI)<t&&(c=(l<=0&&u>=0)==!r.isCCW),l>=u&&l>=a&&a>=u||l<=u&&l<=a&&a<=u?c:!c}var Ze=new Float64Array(100);function rh(r,e){if(r.bbox().extendOfSize(ae.eps).isSeparated(e.bbox()))return 0;let t=[[r,e]],n=(r.controls.length-1)*(e.controls.length-1)*8,i=0,s=Number.POSITIVE_INFINITY;for(;t.length!==0;){let o=function(F){M=Math.min(M,F),S=Math.max(S,F)},a=function(F,z){let L=vi(F,z);if(L===0)throw new Error("cnt === 0");for(let k=0;k<L;k+=2)o(V[k])};if(i>n){for(let F=i-2;F>=2;F-=2)for(let z=F-2;z>=0;z-=2)if(ae.eq(Ze[F],Ze[z])&&ae.eq(Ze[F+1],Ze[z+1])){Ze[z]=(Ze[F]+Ze[z])/2,Ze[z+1]=(Ze[F+1]+Ze[z+1])/2;for(let L=i-3;L>=F;L--)Ze[L]=Ze[L+2];i-=2;break}if(i>n){i=0;let F=e.start(),z=new Float64Array(8);r.getPercent(F)!==null&&(z[i++]=F.x,z[i++]=F.y);let L=e.end();r.getPercent(L)!==null&&(z[i++]=L.x,z[i++]=L.y);let k=r.start();e.getPercent(k)!==null&&(z[i++]=k.x,z[i++]=k.y);let O=r.end();return e.getPercent(O)!==null&&(z[i++]=O.x,z[i++]=O.y),V.set(z),i}}let[l,u]=t.pop(),c=l.controls,h=u.controls;if(c.length===2&&h.length===2){let F=vi(new Y(c[0],c[1]),new Y(h[0],h[1]));for(let z=0;z<F;z++)Ze[i++]=V[z];continue}let f=c[0],d=c[c.length-1];f.equals1(d)&&(d=f.add1(1,0));let m=d.y-f.y,p=f.x-d.x,g=-m*f.x-p*f.y,b=Math.sqrt(1/(m**2+p**2));m*=b,p*=b,g*=b;let v=Number.POSITIVE_INFINITY,w=Number.NEGATIVE_INFINITY;if(c.forEach(F=>{let z=m*F.x+p*F.y+g;z<v&&(v=z),z>w&&(w=z)}),ae.eq(v,w)){if(u.controls.length===2){let F=vi(new Y(l.start(),l.end()),new Y(u.start(),u.end()));for(let z=0;z<F;z++)Ze[i++]=V[z];if(F!==0)continue}l=new Ae([c[0],c[c.length-1]]),c=l.controls}let P=h.map(F=>{let z=m*F.x+p*F.y+g,L=Math.abs(z);return L<s&&(s=L),z}),_=0;for(let F of P){if(ae.less(F,v))_=_|1;else if(ae.greater(F,w))_=_|2;else{_=3;break}if(_===3)break}if(_!==3)continue;let B=0,I=0,C=d.x-f.x,N=d.y-f.y,A=Math.sqrt(1/(C**2+N**2));C*=A,N*=A;for(let F=1;F<c.length;F++){let z=c[F],L=(z.x-f.x)*C+(z.y-f.y)*N;L<B?B=L:L>I&&(I=L)}_=0;for(let F of h){let z=(F.x-f.x)*C+(F.y-f.y)*N;if(ae.less(z,B))_=_|1;else if(ae.greater(z,I))_=_|2;else{_=3;break}if(_===3)break}if(_!==3)continue;let M=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY;s/=2,s<=ae.eps&&(s=ae.eps),v-=s,w+=s,P.forEach((F,z)=>{F>=v&&F<=w&&o(z/(P.length-1))});let $=new Y(new q(0,v),new q(1,v)),H=new Y(new q(0,w),new q(1,w));for(let F=0;F<P.length-1;F++){let z=new q(F/(P.length-1),P[F]),L=z.y<v?1:z.y>w?2:3;for(let k=0;k<P.length;k++){let O=new q(k/(P.length-1),P[k]),ie=O.y<v?1:O.y>w?2:3;L!==ie&&(L===1?ie===2?(a(new Y(z,O),$),a(new Y(z,O),H)):a(new Y(z,O),$):L===2?ie===1?(a(new Y(z,O),$),a(new Y(z,O),H)):a(new Y(z,O),H):ie===1?a(new Y(z,O),$):a(new Y(z,O),H))}}M!==0&&(u=u.clip(M)[1]),S!==1&&(u=u.clip((S-M)/(1-M))[0]);let K=u.bbox();if(ae.eq(K.minX,K.maxX)&&ae.eq(K.minY,K.maxY)){_=0;for(let F of u.controls){let z=(F.x-f.x)*C+(F.y-f.y)*N;if(ae.less(z,B))_=_|1;else if(ae.greater(z,I))_=_|2;else{_=3;break}if(_===3)break}if(_===3){let F=new q((K.minX+K.maxX)/2,(K.minY+K.maxY)/2);l.getPercent(F)&&(Ze[i++]=F.x,Ze[i++]=F.y)}continue}if(S-M>.8){let[F,z]=u.clip(.5);t.push([F,l]),t.push([z,l])}else t.push([u,l])}for(let o=0;o<i;o++)V[o]=Ze[o];return i}function s6(r,e){if(r.bbox().extendOfSize(ae.eps).isSeparated(e.bbox()))return{cnt:0};let t=[[r,e]],n=(r.controls.length-1)*(e.controls.length-1)*8,i=0,s=Number.POSITIVE_INFINITY;for(;t.length!==0;){let o=function(F){M=Math.min(M,F),S=Math.max(S,F)},a=function(F,z){let L=vi(F,z);if(L===0)throw new Error("cnt === 0");for(let k=0;k<L;k+=2)o(V[k])};if(i>n){for(let F=i-2;F>=2;F-=2)for(let z=F-2;z>=0;z-=2)if(ae.eq(Ze[F],Ze[z])&&ae.eq(Ze[F+1],Ze[z+1])){Ze[z]=(Ze[F]+Ze[z])/2,Ze[z+1]=(Ze[F+1]+Ze[z+1])/2;for(let L=i-3;L>=F;L--)Ze[L]=Ze[L+2];i-=2;break}if(i>n){i=0;let F=new Float64Array(8),z=e.end(),L=0;r.getPercent(z)!==null&&(F[i++]=z.x,F[i++]=z.y,L=2);let k=r.end();return e.getPercent(k)!==null&&(F[i++]=k.x,F[i++]=k.y,L=L===0?1:3),V.set(F),{havOverlap:L,cnt:i}}}let[l,u]=t.pop(),c=l.controls,h=u.controls;if(c.length===2&&h.length===2){let F=vi(new Y(c[0],c[1]),new Y(h[0],h[1]));for(let z=0;z<F;z++)Ze[i++]=V[z];continue}let f=c[0],d=c[c.length-1];f.equals1(d)&&(d=f.add1(1,0));let m=d.y-f.y,p=f.x-d.x,g=-m*f.x-p*f.y,b=Math.sqrt(1/(m**2+p**2));m*=b,p*=b,g*=b;let v=Number.POSITIVE_INFINITY,w=Number.NEGATIVE_INFINITY;if(c.forEach(F=>{let z=m*F.x+p*F.y+g;z<v&&(v=z),z>w&&(w=z)}),ae.eq(v,w)){if(u.controls.length===2){let F=vi(new Y(l.start(),l.end()),new Y(u.start(),u.end()));for(let z=0;z<F;z++)Ze[i++]=V[z];if(F!==0)continue}l=new Ae([c[0],c[c.length-1]]),c=l.controls}let P=h.map(F=>{let z=m*F.x+p*F.y+g,L=Math.abs(z);return L<s&&(s=L),z}),_=0;for(let F of P){if(ae.less(F,v))_=_|1;else if(ae.greater(F,w))_=_|2;else{_=3;break}if(_===3)break}if(_!==3)continue;let B=0,I=0,C=d.x-f.x,N=d.y-f.y,A=Math.sqrt(1/(C**2+N**2));C*=A,N*=A;for(let F=1;F<c.length;F++){let z=c[F],L=(z.x-f.x)*C+(z.y-f.y)*N;L<B?B=L:L>I&&(I=L)}_=0;for(let F of h){let z=(F.x-f.x)*C+(F.y-f.y)*N;if(ae.less(z,B))_=_|1;else if(ae.greater(z,I))_=_|2;else{_=3;break}if(_===3)break}if(_!==3)continue;let M=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY;s/=2,s<=ae.eps&&(s=ae.eps),v-=s,w+=s,P.forEach((F,z)=>{F>=v&&F<=w&&o(z/(P.length-1))});let $=new Y(new q(0,v),new q(1,v)),H=new Y(new q(0,w),new q(1,w));for(let F=0;F<P.length-1;F++){let z=new q(F/(P.length-1),P[F]),L=z.y<v?1:z.y>w?2:3;for(let k=0;k<P.length;k++){let O=new q(k/(P.length-1),P[k]),ie=O.y<v?1:O.y>w?2:3;L!==ie&&(L===1?ie===2?(a(new Y(z,O),$),a(new Y(z,O),H)):a(new Y(z,O),$):L===2?ie===1?(a(new Y(z,O),$),a(new Y(z,O),H)):a(new Y(z,O),H):ie===1?a(new Y(z,O),$):a(new Y(z,O),H))}}M!==0&&(u=u.clip(M)[1]),S!==1&&(u=u.clip((S-M)/(1-M))[0]);let K=u.bbox();if(ae.eq(K.minX,K.maxX)&&ae.eq(K.minY,K.maxY)){_=0;for(let F of u.controls){let z=(F.x-f.x)*C+(F.y-f.y)*N;if(ae.less(z,B))_=_|1;else if(ae.greater(z,I))_=_|2;else{_=3;break}if(_===3)break}if(_===3){let F=new q((K.minX+K.maxX)/2,(K.minY+K.maxY)/2);l.getPercent(F)&&(Ze[i++]=F.x,Ze[i++]=F.y)}continue}if(S-M>.8){let[F,z]=u.clip(.5);t.push([F,l]),t.push([z,l])}else t.push([u,l])}for(let o=0;o<i;o++)V[o]=Ze[o];return{cnt:i}}var o6=class{constructor(r=ae.eps){this.eps=r}eq(r,e){return Math.abs(r-e)<=this.eps}setEps(r){this.eps=r}},Hl=new o6;function Cy(r,e){if(r.bbox().extendOfSize(ae.eps).isSeparated(e.bbox()))return 0;let t=[[r,e]],n=(e.controls.length-1)*16,i=0;for(;t.length!==0;){if(i>n){let o=function(){for(let u=0;u<i;u+=2)for(let c=u+2;c<i;c+=2)if(!(Hl.eq(Ze[u],Ze[c])&&Hl.eq(Ze[u+1],Ze[c+1]))){l(Ze[c],Ze[c+1],a);break}function l(u,c,h){let f=!1;for(let d=0;d<h.length;d+=2)if(Hl.eq(u,h[d])&&Hl.eq(c,h[d+1])){f=!0;break}f||h.push(u,c)}},a=[Ze[0],Ze[1]];if(o(),a.length>=100&&(Hl.setEps(.001),a=[Ze[0],Ze[1]],o(),a.length>=100))throw new Error("clearSamePoint()");i=a.length,a.forEach((l,u)=>Ze[u]=l)}let s=t.pop();if(s[0]instanceof re){let o=function(H){N=Math.min(N,H),A=Math.max(A,H)},a=function(H,K){let F=vi(H,K);if(F===0)throw new Error("cnt === 0");for(let z=0;z<F;z+=2)o(V[z])},[l,u]=s,c=u.controls;if(c.length===2){let H=pm(l,new Y(c[0],c[1]));for(let K=0;K<H;K++)Ze[i++]=V[K];continue}let h=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,d,m,p,g,b;if(Math.abs(l.sweepAngle)>359){let H=l.rx;d=l.center.add1(H,0),m=l.center.add1(-H,0),h=-H,f=H,p=0,g=1,b=-l.center.y}else{d=l.start(),m=l.end(),p=m.y-d.y,g=d.x-m.x,b=-p*d.x-g*d.y;let H=Math.sqrt(1/(p**2+g**2));p*=H,g*=H,b*=H;let K=p*l.center.x+g*l.center.y+b;l.isCCW?(f=l.rx+K,h=0):(h=K-l.rx,f=0)}let v=c.map(H=>p*H.x+g*H.y+b),w=0;for(let H of v){if(ae.less(H,h))w=w|1;else if(ae.greater(H,f))w=w|2;else{w=3;break}if(w===3)break}if(w!==3)continue;let P=0,_=0,B=m.x-d.x,I=m.y-d.y,C=Math.sqrt(1/(B**2+I**2));if(B*=C,I*=C,Math.abs(l.sweepAngle)<=180)P=0,_=(m.x-d.x)*B+(m.y-d.y)*I;else throw new Error("not support");w=0;for(let H of c){let K=(H.x-d.x)*B+(H.y-d.y)*I;if(ae.less(K,P))w=w|1;else if(ae.greater(K,_))w=w|2;else{w=3;break}if(w===3)break}if(w!==3)continue;let N=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY;h-=ae.eps,f+=ae.eps,v.forEach((H,K)=>{H>=h&&H<=f&&o(K/(v.length-1))});let M=new Y(new q(0,h),new q(1,h)),S=new Y(new q(0,f),new q(1,f));for(let H=0;H<v.length-1;H++){let K=new q(H/(v.length-1),v[H]),F=K.y<h?1:K.y>f?2:3;for(let z=0;z<v.length;z++){let L=new q(z/(v.length-1),v[z]),k=L.y<h?1:L.y>f?2:3;F!==k&&(F===1?k===2?(a(new Y(K,L),M),a(new Y(K,L),S)):a(new Y(K,L),M):F===2?k===1?(a(new Y(K,L),M),a(new Y(K,L),S)):a(new Y(K,L),S):k===1?a(new Y(K,L),M):a(new Y(K,L),S))}}N!==0&&(u=u.clip(N)[1]),A!==1&&(u=u.clip((A-N)/(1-N))[0]);let $=u.bbox();if(ae.eq($.minX,$.maxX)&&ae.eq($.minY,$.maxY)){w=0;for(let H of u.controls){let K=(H.x-d.x)*B+(H.y-d.y)*I;if(ae.less(K,P))w=w|1;else if(ae.greater(K,_))w=w|2;else{w=3;break}if(w===3)break}w===3&&(Ze[i++]=($.minX+$.maxX)/2,Ze[i++]=($.minY+$.maxY)/2);continue}A-N>.8?u.clip(.5).forEach(H=>t.push([H,l])):t.push([u,l])}else{let[o,a]=s;t.push([re.build3(a.center,a.startAngle,a.sweepAngle/2,a.rx,a.ry),o]),t.push([re.build3(a.center,a.startAngle+a.sweepAngle/2,a.sweepAngle/2,a.rx,a.ry),o])}}for(let s=0;s<i;s++)V[s]=Ze[s];return i}var a6=class{static getSweep(r){if(r.length>2){let e=0,t=r.length;for(let s=0;s<t-1;s++){let o=r[s],a=r[s+1];e+=(a.x+o.x)*(a.y-o.y)}let n=r[0],i=r[t-1];return e+=(n.x+i.x)*(n.y-i.y),e>0}else throw new Error("Unable to determine the direction of rotation!")}static isClose(r){return!!(r.primitives.length>0&&r.primitives[0].start().equals1(r.primitives[r.primitives.length-1].end()))}};function l6(r){let e=r.primitives,t=e[0],n=t instanceof re?t.sweepAngle%360:null;if(e.length===1&&t instanceof re&&(ae.eq(n,0)||ae.eq(Math.abs(n),360)))return!!t.isCCW;let i=new Array;return r.points(.1,s=>{i.push(s)}),a6.getSweep(i)}var u6=class{static zoomCorner(r,e){let t=new Array,n=new Array,i=new Array;return this.getPanPrimitive(r,t,i,e),this.rearrange(t,i),this.processStart(t,i),this.getResult(t,i,n,e),n.length>0?Ce.build2(n):null}static zoomPolygon(r,e){let t=new Array,n=new Array,i=new Array;return l6(r)&&(r=r.reverse().asClose()),this.getPanPrimitive(r,t,i,e),this.rearrange(t,i),this.processStart(t,i),this.getResult(t,i,n,e),n.length>0?Ce.build2(n):null}static zoomLines(r,e){return this.zoomPolygon(Ce.build2(r.primitives.concat(r.reverse().primitives)),e/2)}static getPanPrimitive(r,e,t,n){let i=r.primitives;for(let s of i){let o=this.panDistance(s,n);o!==void 0&&(e.push(o),t.push(s))}}static rearrange(r,e){let t=r.length,n=0;for(let o=0;o<t;o++){let a=e[o],l=r[o],u=o==t-1?r[0]:r[o+1];if(!(l instanceof re&&u instanceof re)&&!this.isCW(l.end(),u.start(),a.end())){if(bn(l,u)!=0){n=o==t-1?0:o+1;break}}else{n=o;break}}let i=this.start4Index(e,n),s=this.start4Index(r,n);e.length=0,r.length=0,i.forEach(o=>{e.push(o)}),s.forEach(o=>{r.push(o)})}static processStart(r,e){let t=r.length;if(t>2){let n=r[t-1],i=r[0],s=e[t-1];if(!(n instanceof re&&i instanceof re)&&!this.isCW(n.end(),i.start(),s.end())){let o=bn(n,i);for(let a=0;a<o;a+=2){let l=new q(V[a],V[a+1]);r[t-1]=this.generatePrimitive(n,n.start(),l),r[0]=this.generatePrimitive(i,l,i.end())}}}}static getResult(r,e,t,n){let i=r.length;for(let s=0;s<i;s++){let o=e[s],a=s===i-1?e[0]:e[s+1],l=s==i-1?0:s+1,u=l==i-1?e[0]:e[l+1],c=r[s],h=s==i-1?r[0]:r[s+1],f=l==i-1?r[0]:r[l+1];if(!(c instanceof re&&h instanceof re)&&!this.isCW(c.end(),h.start(),o.end())){let m=this.add(r,t,s,c,h,0);m=this.update(r,t,s,h,m);let p=this.generateArc(a,u,h,f,n);if(m=this.add(r,t,s,c,p,m),m=this.update(r,t,s,p,m),m>0)continue}t.push(c);let d=this.generateArc(o,a,c,h,n);d!==void 0&&t.push(d)}}static generateArc(r,e,t,n,i){if(i>0){let s=r.end(),o=e.start(),a=t.end(),l=n.start();if(a.distance2(l)>1e-8)if(s.equals(o)){let u=a.angleD(s),c=l.angleD(s);return re.build2(s,u,c,i,i,0)}else{let u=a.angleD(s),c=l.angleD(s),h=a.angleD(o),f=l.angleD(o),d=re.build2(s,u,c,i,i,0),m=re.build2(o,h,f,i,i,0);return d.pointOn(d.endAngle()).equals1(l)?d:m.pointOn(m.endAngle()).equals1(l)?m:d}}}static updateNews(r,e,t,n){let i=r.length,s=e==i-1?0:e+1;r[s]=this.generatePrimitive(t,n,t.end())}static add(r,e,t,n,i,s){if(s>0)return s;if(n!=null&&i!=null){let o=bn(n,i);for(let a=0;a<o;a+=2){let l=new q(V[a],V[a+1]);e.push(this.generatePrimitive(n,n.start(),l)),this.updateNews(r,t,i,l);break}return o}else return 0}static update(r,e,t,n,i){if(i>0)return i;let s=e.length;if(s>0&&n!=null){let o=e[s-1],a=bn(o,n);for(let l=0;l<a;l+=2){let u=new q(V[l],V[l+1]);e[s-1]=this.generatePrimitive(o,o.start(),u),this.updateNews(r,t,n,u)}return a}else return 0}static generatePrimitive(r,e,t){if(r instanceof Y)return new Y(e,t);if(r instanceof re){let n=r,i=e.angleD(n.center),s=t.angleD(n.center);return re.build2(n.center,i,s,n.rx,n.ry,n.sweep())}else throw new Error("not supported operation")}static start4Index(r,e){let t=r.length,n=new Array;for(let i=e;i<t;i++)n.push(r[i]);for(let i=0;i<e;i++)n.push(r[i]);return n}static isCW(r,e,t){let n=new Y(t,r),i=new Y(t,e),s=n.end().x-n.start().x,o=n.end().y-n.start().y,a=i.end().x-i.start().x,l=i.end().y-i.start().y;return!(s*l-o*a>0)}static panDistance(r,e){if(r instanceof Y){if(r.isPoint())return;{let t=r.panDistance(e);return t.length()>1e-5?t:void 0}}else if(r instanceof re){let t=r;if(t.sweepAngle>0){if(t.rx-e<=0||t.ry-e<=0)return}else if(t.sweepAngle<0&&(t.rx+e<=0||t.ry+e<=0))return;return t=t.panDistance(e),t.start().distance1(t.end())>1e-5||ae.eq(Math.abs(t.sweepAngle),360)?t:void 0}else throw new Error("not supported operation")}},ke=.001,Dr=ke**2;function Ge(r,e){return r.distance2(e)<Dr}function Vi(r,e){return Math.abs(r-e)<=1e-4}function Sle(r,e){return Math.abs(r-e)<=ke}function Ile(r,e){return Math.abs(r-e)<=Dr}function Ble(r,e){return r-e<-ke}function Ale(r,e){return r-e>ke}function c6(r,e){if(r instanceof Y)return new Y(r.start(),e);if(r instanceof re)return re.build2(r.center,r.startAngle,e.angleD(r.center),r.rx,r.ry,r.isCCW?1:0);if(r instanceof Ae)return r.clip(r.getPercent(e,ke))[0];throw new Error("not supported operation")}function wi(r,e=Xe.toRadians(r.startAngle)){return r.isCCW?e+=th:e-=th,new q(Math.cos(e),Math.sin(e))}function nh(r,e=0){let t=r.controls;if(e===0){let n=t[0],i=t.slice(1).find(s=>!(s.x===n.x&&s.y===n.y));if(!i)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return i.sub(n)}else if(e===1){let n=t[t.length-1],i=t.slice(0,-1).reverse().find(s=>!(s.x===n.x&&s.y===n.y));if(!i)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return n.sub(i)}if(t.length===3){let[n,i,s]=t;return i.sub(n).mul(2*(1-e)).add(s.sub(i).mul(2*e)).normalize()}else{let[n,i,s,o]=t;return i.sub(n).mul(3*(1-e)**2).add(s.sub(i).mul(6*(1-e)*e)).add(o.sub(s).mul(3*e**2)).normalize()}}function _s(r,e,t){let n=r.slice(1).findIndex(s=>!(s.x===e.x&&s.y===e.y)),i=r[n+1];if(t&&(t.getPercent(i,ke)!==null||new Y(t.start(),t.end()).distance(i)<=ke)&&(i=r[n+2]),!i)throw Error("getSecondPoint(controls: readonly Vector2[])");return i}function et(r,e){if(r instanceof Y)return r.end().sub(r.start()).normalize();if(r instanceof re)return(e?wi(r,e.angle(r.center)):wi(r)).normalize();if(r instanceof Ae)if(r.controls.length===2){let[t,n]=r.controls;if(Ge(t,n))throw Error("equalsPP(p0, p1)");return n.sub(t).normalize()}else return(e?nh(r,r.getPercent(e,ke)):nh(r)).normalize();else throw new Error("not support")}function h6(r,e,t){let n=[],i=e**2-4*r*t;if(i>=0){let s=-e/(2*r),o=Math.sqrt(i)/(2*r),a=s+o;if(n.push(a),i>0){let l=s-o;n.push(l)}}return n}function d6(r,e,t,n,i=0,s=1){let o=[],a=r*Math.pow(i,3)+e*Math.pow(i,2)+t*i+n,l=r*Math.pow(s,3)+e*Math.pow(s,2)+t*s+n,u,c;if(a*l<0)for(;Math.abs(i-s)>ke;)if(u=(i+s)/2,c=r*Math.pow(u,3)+e*Math.pow(u,2)+t*u+n,Math.abs(c)<ke){o.push(u);break}else a*c<0?s=u:l*c<0&&(i=u);else a*l===0&&(a===0&&o.push(i),l===0&&o.push(s));return o}function Tle(r){let e=r.controls;if(e.length!==3)throw Error("bezier.controls !== 3");let[t,n,i]=e;return{a:t.sub(n.mul(2)).add(i),b:n.sub(t)}}function Cle(r){let e=r.controls;if(e.length!==4)throw Error("beizer.controls.length !== 4");let[t,n,i,s]=e;return{a:s.sub(t).add(n.sub(i).mul(3)),b:t.sub(n.mul(2)).add(i).mul(2),c:n.sub(t)}}function mm(r){return ae.greater(r,0)&&ae.less(r,1)}function ih(r,e,t,n){let i=r[n]-2*e[n]+t[n],s=e[n]-r[n];if(i===0)return[];let o=-s/i,a=[];return mm(o)&&a.push(o),a}function sh(r,e,t,n,i){let s,o,a=-r[i]+3*e[i]-3*t[i]+n[i],l=2*(r[i]-2*e[i]+t[i]),u=e[i]-r[i],c=l**2-4*a*u;if(ae.lesseq(c,0))s=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;else{let f=Math.sqrt(c);s=(-l-f)/(2*a),o=(-l+f)/(2*a);let d=a*2;if(ae.lesseq(s,1)&&ae.greatereq(s,0)){let m=Number.NEGATIVE_INFINITY;for(;ae.neq(s,m);){m=s;let p=d*s+l;s=-(a*s**2+l*s+u-p*s)/p}}if(ae.lesseq(o,1)&&ae.greatereq(o,0)){let m=Number.NEGATIVE_INFINITY;for(;ae.neq(o,m);){m=o;let p=d*o+l;o=-(a*o**2+l*o+u-p*o)/p}}}let h=[];return mm(o)&&h.push(o),mm(s)&&h.push(s),h}function f6(r,e){if(r.controls.length===2){let[a,l]=r.controls;Ge(a,l)||e.push(new Y(a,l));return}let t,n;if(r.controls.length===3){let[a,l,u]=r.controls;t=ih(a,l,u,"x"),n=ih(a,l,u,"y")}else{let[a,l,u,c]=r.controls;t=sh(a,l,u,c,"x"),n=sh(a,l,u,c,"y")}t.sort((a,l)=>l-a),n.sort((a,l)=>l-a);let i=t.pop()||1,s=n.pop()||1,o=0;for(;i!==1||s!==1;)if(ae.eq(i,s))i=t.pop()||1,s=n.pop()||1;else if(i<s){let[a,l]=r.clip((i-o)/(1-o));o=i,e.push(a),r=l,i=t.pop()||1}else{let[a,l]=r.clip((s-o)/(1-o));o=s,e.push(a),r=l,s=n.pop()||1}e.push(r)}var p6=1e-5,m6=1,Ae=class qr extends Xl{constructor(e){if(super(),this._startToEndL=null,e.length<2)throw new Error("Bezier needs at least 2 endpoints");this.controls=e.slice()}get startToEndL(){return this._startToEndL===null&&(this._startToEndL=new Y(this.start(),this.end())),this._startToEndL}build1(e){let t=[];return ua(e,(n,i)=>(t.push(i),!0)),new qr(t)}start(){return this.controls[0]}end(){return this.controls[this.controls.length-1]}static pointOn(e,t){if(t.length<1)throw new Error("bezier must have at least 1 point");if(t.length===1)return t[0];{let n=new Array(t.length-1);for(let i=1;i<t.length;i++){let s=t[i-1],o=t[i],a=(o.x-s.x)*e,l=(o.y-s.y)*e;n[i-1]=s.add1(a,l)}return qr.pointOn(e,n)}}clip1(e,t,n,i){if(n.push(t[0]),i.push(t[t.length-1]),t.length<2)throw new Error("bezier clip must have at least 2 point");if(t.length===2){let s=t[0],o=t[1],a=(o.x-s.x)*e,l=(o.y-s.y)*e,u=s.add1(a,l);n.push(u),i.push(u)}else{let s=new Array(t.length-1);for(let o=1;o<t.length;o++){let a=t[o-1],l=t[o],u=(l.x-a.x)*e,c=(l.y-a.y)*e;s[o-1]=a.add1(u,c)}this.clip1(e,s,n,i)}}clip(e){let t=[],n=[];return this.clip1(e,this.controls,t,n),[new qr(t),new qr(n.reverse())]}greater(e,t,n){return e-t>n}less(e,t,n){return e-t<-n}eq(e,t,n){return Math.abs(e-t)<=n}eqPP(e,t,n){return!e||!t?!1:this.eq(e.x,t.x,n)&&this.eq(e.y,t.y,n)}isInRange(e,t=ae.eps){let n=this.controls.map(s=>s.y-e.y),i=0;for(let s of n){if(this.less(s,0,t))i=i|1;else if(this.greater(s,0,t))i=i|2;else{i=3;break}if(i===3)break}if(i!==3)return!1;i=0;for(let s of this.controls){let o=s.x-e.x;if(this.less(o,0,t))i=i|1;else if(this.greater(o,0,t))i=i|2;else{i=3;break}if(i===3)break}return i===3}getPercent(e,t=ae.eps){if(!this.isInRange(e,t))return null;let n=Number.POSITIVE_INFINITY,i=[[this,0,1]];for(;i.length!==0;){let s=function(g){c=Math.min(c,g),h=Math.max(h,g)},o=function(g,b){let v=vi(g,b);if(v===0)throw new Error("cnt === 0");for(let w=0;w<v;w+=2)s(V[w])},[a,l,u]=i.pop();if(this.eqPP(a.start(),e,t))return l;if(this.eqPP(a.end(),e,t))return u;let c=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,f=a.controls.map(g=>g.y-e.y);n=f.reduce((g,b)=>{let v=Math.abs(b);return v<g?v:g},n),n/=2,n<=t&&(n=t),f.forEach((g,b)=>{this.eq(g,0,t)&&s(b/(f.length-1))});let d=new Y(new q(0,-n),new q(1,-n)),m=new Y(new q(0,n),new q(1,n));for(let g=0;g<f.length-1;g++){let b=new q(g/(f.length-1),f[g]),v=this.less(b.y,0,t)?1:this.greater(b.y,0,t)?2:3;for(let w=0;w<f.length;w++){let P=new q(w/(f.length-1),f[w]),_=this.less(P.y,0,t)?1:this.greater(P.y,0,t)?2:3;v!==_&&(v===1?_===2?(o(new Y(b,P),d),o(new Y(b,P),m)):o(new Y(b,P),d):v===2?_===1?(o(new Y(b,P),d),o(new Y(b,P),m)):o(new Y(b,P),m):_===1?o(new Y(b,P),d):o(new Y(b,P),m))}}if(!isFinite(c)){if(Math.max(...f.map(g=>Math.abs(g)))<t*4)return(l+u)/2;continue}if(c!==0&&(a=a.clip(c)[1],l=(u-l)*c+l),h!==1){let g=(h-c)/(1-c);a=a.clip(g)[0],u=(u-l)*g+l}if(!a.isInRange(e,t))continue;let p=a.controls.reduce((g,b)=>g.ext2(b),new Oe).build1();if(this.eq(p.minX,p.maxX,t)&&this.eq(p.minY,p.maxY,t))return(l+u)/2;if(h-c>.8){let[g,b]=a.clip(.5);g.isInRange(e,t)?(i.push([g,l,(l+u)/2]),b.isInRange(e,t)&&i.push([b,(l+u)/2,u])):i.push([b,(l+u)/2,u])}else i.push([a,l,u])}return null}toBezier(){return this}toString(){return"Bezier ["+this.controls.join(" ")+"]"}bbox(){return this._bbox||(this._bbox=new Oe().ext3(this.points(.1)).build1()),this._bbox}bboxWithControls(){return this._bbox_controls||(this._bbox_controls=new Oe().ext3(this.controls).build()),this._bbox_controls}multiply3(e){let t=new Array(this.controls.length);for(let n=0;n<this.controls.length;n++){let i=this.controls[n];t[n]=i.multiply3(e)}return new qr(t)}stroke(e,t,n){let i=u6.zoomLines(Ce.build4(this.points(m6)),e);return n===0?i:i.reverse()}points(e){let t=[];return this.getBezierPoints(e,n=>t.push(n)),t}getBezierPoints(e,t){if(this.controls.length===2){t(this.start()),t(this.end());return}let n=[this];for(t(this.start());n.length!==0;){let s=n.pop(),o=new Y(s.start(),s.end());if(i(s.controls,o)<=e)t(s.end());else{let[a,l]=s.clip(.5);n.push(l,a)}}function i(s,o){let a=o.start(),l=o.end();a.equals1(l)&&(l=a.add1(1,0));let u=l.y-a.y,c=a.x-l.x,h=-u*a.x-c*a.y,f=Math.sqrt(1/(u**2+c**2));u*=f,c*=f,h*=f;let d=s.map(m=>Math.abs(u*m.x+c*m.y+h));return Math.max(...d)}}getBezierPoints3(e,t){if(this.controls.length===2){t(this.start()),t(this.end());return}let n=e*e,i=this.controls[0],s=.5;for(;s>p6&&!(i.distance2(qr.pointOn(s,this.controls))<=n);s*=.5);let o=Math.ceil(1/s);s=1/o,t(i);let a=0;for(let l=1;l<o;l++)a+=s,t(qr.pointOn(a,this.controls));t(this.end())}getPointsBySlope(e){if(this.controls.length===4)return this.getPointsBySlope4(e);throw new Error("Currently, only 4 control points are supported!")}getPointsBySlope4(e){let[t,n,i,s]=this.controls,o=-3*t.x+9*n.x-9*i.x+3*s.x,a=6*t.x-12*n.x+6*i.x,l=-3*t.x+3*n.x,u=[];if(Number.isFinite(e)){let c=-3*t.y+9*n.y-9*i.y+3*s.y,h=6*t.y-12*n.y+6*i.y,f=-3*t.y+3*n.y,d=c-o*e,m=h-a*e,p=f-l*e,g=-m/(2*d),b=Math.sqrt(m**2-4*d*p)/(2*d),v=g+b;v>=0&&v<=1&&u.push(qr.pointOn(v,this.controls));let w=g-b;w>=0&&w<=1&&u.push(qr.pointOn(w,this.controls))}else{let c=-a/(2*o),h=Math.sqrt(a**2-4*o*l)/(2*o),f=c+h;f>=0&&f<=1&&u.push(qr.pointOn(f,this.controls));let d=c-h;d>=0&&d<=1&&u.push(qr.pointOn(d,this.controls))}return u}buildConverxHull(e=ae.eps){let t=[...this.controls],n=[],i=t[0],s=1;do{let o=t[s%t.length];this.eqPP(i,o,e)||n.push(new Y(i,o)),i=o,s++}while(i!==t[0]);if(n.length===0)throw Error("buildConverxHull(diff = DoubleKit.eps)");return Ce.build7(n).asClose()}getExtremePoints(e){if(!e)return o(this.controls);let t=e.start(),n=e.end(),i=n.x-t.x,s=n.y-t.y;if(Math.abs(i)<=ae.eps||Math.abs(s)<=ae.eps)return o(this.controls);{let a=s/i;if(this.controls.length===3){t.equals1(n)&&(n=t.add1(1,0));let l=n.y-t.y,u=t.x-n.x,c=-l*t.x-u*t.y,h=Math.sqrt(1/(l**2+u**2));l*=h,u*=h,c*=h;let f=this.controls.map(p=>l*p.x+u*p.y+c),d=f[0]-2*f[1]+f[2],m=f[1]-f[0]-a/2;if(d!==0){let p=-m/d;if(ae.greater(p,0)&&ae.less(p,1))return[qr.pointOn(p,this.controls)]}}else if(this.controls.length===4)return this.getPointsBySlope(a)}return[];function o(a){let l,u;if(a.length===3){let[d,m,p]=a;l=ih(d,m,p,"x"),u=ih(d,m,p,"y")}else if(a.length===4){let[d,m,p,g]=a;l=sh(d,m,p,g,"x"),u=sh(d,m,p,g,"y")}l.sort((d,m)=>m-d),u.sort((d,m)=>m-d);let c=l.pop()||1,h=u.pop()||1,f=[];for(;c!==1||h!==1;)ae.eq(c,h)?(c=l.pop()||1,h=u.pop()||1):c<h?(f.push(qr.pointOn(c,a)),c=l.pop()||1):(f.push(qr.pointOn(h,a)),h=u.pop()||1);return f}}getToLineMaxDis2(e){let t=this.getExtremePoints(e),n=e.distance2(this.start()),i=e.distance2(this.end()),s=Math.max(n,i);return t.forEach(a=>o(e.distance2(a))),s;function o(a){s=Math.max(s,a)}}getToLineMinAndMaxDis_Controls(e){let t=e.start(),n=e.end();e.start().equals1(e.end())&&(n=t.add1(1,0));let i=n.y-t.y,s=t.x-n.x,o=-i*t.x-s*t.y,a=Math.sqrt(1/(i**2+s**2));i*=a,s*=a,o*=a;let l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;return this.controls.forEach(c=>{let h=i*c.x+s*c.y+o;h<l&&(l=h),h>u&&(u=h)}),{minDis:l,maxDis:u}}getPercentInLine(e){let t=[],n=[],i=this.controls,s=e.start(),o=e.end(),a=o.y-s.y,l=s.x-o.x,u=-a*s.x-l*s.y,c=Math.sqrt(1/(a**2+l**2));if(a*=c,l*=c,u*=c,a**2+l**2<=0)return t;if(i.length===3){let[h,f,d]=i,m=a*(h.x-2*f.x+d.x)+l*(h.y-2*f.y+d.y),p=2*(a*(f.x-h.x)+l*(f.y-h.y)),g=a*h.x+l*h.y+u;n=h6(m,p,g)}else if(i.length===4){let[h,f,d,m]=i,p=m.sub(d.mul(3)).add(f.mul(3)).sub(h),g=h.sub(f.mul(2)).add(d).mul(3),b=f.sub(h).mul(3),v=h,w=a*p.x+l*p.y,P=a*g.x+l*g.y,_=a*b.x+l*b.y,B=a*v.x+l*v.y+u,I=Math.sqrt(1/(w**2+P**2));w*=I,P*=I,_*=I,B*=I,n=d6(w,P,_,B)}else throw Error("not support getBeizerPointInLine");return n.forEach(h=>{h>=0&&h<=1&&t.push(h)}),t}reverse(){return new qr(this.controls.slice().reverse())}},My=(es=class{constructor(){this.textCache=new Map,this.numCache=new Array(20),this.boxCache=new Array(4),this.textOffsetCache=new Array(9),this.BuildLineCache=new Array(7),this.BuildTrackCache=new Array(7),this.BuildViaCache=new Array(11),this.BuildBoxCache=new Array(10),this.BuildArcCache=new Array(10),this.BuildArcTrackCache=new Array(10),this.BuildTextCache=new Array(7),this.BuildPadStyleCache=new Array(4),this.BuildPadCache=new Array(12),this.ARRAY1=new Array(1),this.ARRAY2=new Array(2),this.ARRAY3=new Array(3),this.ARRAY4=new Array(4),this.ARRAY5=new Array(5),this.ARRAY6=new Array(6),this.ARRAY7=new Array(7),this.ARRAY8=new Array(8),this.ARRAY9=new Array(9),this.ARRAY10=new Array(10),this.ARRAY11=new Array(11),this.ARRAY12=new Array(12),this.textOffsetCache[0]=q.ORIGIN,this.textOffsetCache[1]=new q(0,-.5),this.textOffsetCache[2]=new q(0,-1),this.textOffsetCache[3]=new q(-.5,0),this.textOffsetCache[4]=new q(-.5,-.5),this.textOffsetCache[5]=new q(-.5,-1),this.textOffsetCache[6]=new q(-1,0),this.textOffsetCache[7]=new q(-1,-.5),this.textOffsetCache[8]=new q(-1,-1)}static getCache(){return es.instance==null&&(es.instance=new es),es.instance}},(()=>{es.instance=null})(),es),Y=class _o extends Xl{constructor(e,t){super(),this._a=null,this._b=null,this._c=null,this.__bbox=null,this._hashed=null,this._direct=null,this._start=e,this._end=t}get a(){return this._a===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._a}get b(){return this._b===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._b}get c(){return this._c===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._c}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}get direct(){return this._direct==null&&(this._direct=this._end.sub(this._start).normalize()),this._direct}cutLine(e){if(ae.eq(this.distance(e),0)){let t=new _o(this._start,e);return t._a=this._a,t._b=this._b,t._c=this._c,t}return new _o(this._start,e)}get midPoint(){return this._start.add(this._end).mul(.5)}toBezier(){return new Ae([this._start,this._end])}_hashCode(){let e=31,t=1;return t=e*t+this._start.hashCode(),t=e*t+this._end.hashCode(),t}start(){return this._start}end(){return this._end}center(){let e=this.start(),t=this.end();return e.add(t).mul(.5)}panDistance(e){let t=this._end.x-this._start.x,n=this._end.y-this._start.y,i=this.length();t=t*e/i,n=-n*e/i;let s=new q(this._start.x+n,this._start.y+t),o=new q(this._end.x+n,this._end.y+t);return new _o(s,o)}isPoint(){return this._start.distance2(this._end)<=1e-8}length(){return this._start.distance1(this._end)}toString(){return"Line [start="+this._start+", end="+this._end+"]"}bbox(){if(this.__bbox==null){let e=My.getCache().boxCache;e[0]=Math.min(this._start.x,this._end.x),e[1]=Math.max(this._start.x,this._end.x),e[2]=Math.min(this._start.y,this._end.y),e[3]=Math.max(this._start.y,this._end.y),this.__bbox=new ye(e[0],e[1],e[2],e[3])}return this.__bbox}multiply3(e){return new _o(this._start.multiply3(e),this._end.multiply3(e))}hashCode(){return this.hashed}equals(e){let t=e;return this.hashed===t.hashed&&this._start.equals(t._start)&&this._end.equals(t._end)}equals1(e){let t=e;return this.hashed===t.hashed&&this._start.equals1(t._start)&&this._end.equals1(t._end)}equals2(e){let t=[this.start(),this.end()],n=[e.start(),e.end()];return Jn(t,n)||Jn(t,n.reverse())}stroke(e,t,n){let i,s,o;this._end.x<this._start.x?(s=this._start.x-this._end.x,o=this._start.y-this._end.y,i=this._end):(s=this._end.x-this._start.x,o=this._end.y-this._start.y,i=this._start);let a=Math.sqrt(s*s+o*o),l=e/2,u,c,h;t===2?(c=-l,h=a+l):(c=0,h=a),t===0||t===2?n===0?u=Ce.build5([c,-l,c,l,h,l,h,-l]):u=Ce.build5([c,l,c,-l,h,-l,h,l]):n===0?u=Ce.build2([re.build3(new q(c,0),-90,-180,l,l),re.build3(new q(h,0),90,-180,l,l)]):u=Ce.build2([re.build3(new q(c,0),90,180,l,l),re.build3(new q(h,0),-90,180,l,l)]);let f=Math.atan2(o,s),d=qe.rotate(f).translate1(i);return u.asClose().multiply3(d)}points(e){return[this._start,this._end]}mirrorY(e){return new _o(this.start().mirrorY(e),this.end().mirrorY(e))}reverse(){return new _o(this._end,this._start)}inArea(e,t,n){let i=e.x,s=e.y,o=this._start,a=this._end,l=n==1,u=i-o.x,c=s-o.y,h=i-a.x,f=s-a.y,d=a.x-o.x,m=a.y-o.y,p=new q(-m,d).normalize(),g=d+p.x*t/2,b=m+p.y*t/2,v=g*g+b*b,w=u*u+c*c,P=h*h+f*f,_=Math.abs(u*m-c*d)/2,B=Math.sqrt(d*d+m*m)*t/4;if(_<=B&&w<=v&&P<=v){if(l)return!0;{let I=new q(i,s).sub(a).normalize(),C=new q(i,s).sub(o).normalize(),N=new q(p.x,p.y).cross(I),A=new q(p.x,p.y).cross(C);return N>=0&&A<=0}}else if(l){let I=t/2;return w<=I*I?!0:P<=I*I}else return!1}isParallel(e,t=!1){let n=ae.eq(Math.abs(this.direct.cross(e.direct)),0),i=!t||ae.greatereq(this.direct.dot(e.direct),0);return n&&i}distance2(e){return(this.a*e.x+this.b*e.y+this.c)**2/(this.a**2+this.b**2)}distance2ForPP(e){let{x:t,y:n}=e,{x:i,y:s}=this.start(),{x:o,y:a}=this.end();return((t-i)*(a-s)-(n-s)*(o-i))**2/((a-s)**2+(o-i)**2)}distance(e){return Math.abs(this.a*e.x+this.b*e.y+this.c)/Math.sqrt(this.a**2+this.b**2)}};function Mle(r,e=.05){if(r.length<3)return r.slice();let t=r[0],n=[t];for(let l=1;l<r.length;l++){let u=r[l];t.equals1(u)||n.push(u),t=u}if(t!==n[n.length-1]&&(n.length!==1&&n.pop(),n.push(t)),e<0)return n;let i=n[1],s=i.sub(n[0]).normalize(),o=0,a=[n[0]];for(let l=2;l<n.length;l++){let u=n[l],c=u.sub(i).normalize();o+=Math.acos(Math.min(1,Math.max(-1,s.dot(c)))),o>e&&(a.push(i),o=0),i=u,s=c}return a.push(i),a}function g6(r,e=.05){if(r.length<3)return r.slice();let t=r.slice(0,1),n=(s,o,a)=>HD(s.x,s.y,o.x,o.y,a.x,a.y);for(;;){t=r.slice(0,1);for(let s=1;s<r.length-1;s+=2)n(r[s],r[s-1],r[s+1])>e&&t.push(r[s]),t.push(r[s+1]);if(t.at(-1).equals1(r.at(-1))||t.push(r.at(-1)),r.length==t.length)break;r=t}let i=r[r.length-1];return t.push(i),t}var x6=_D(PD());function b6(r){if(r instanceof Y)r=new Y(r.end(),r.start());else if(r instanceof re)r=r.exchangeSweep();else if(r instanceof Ae)r=new Ae(r.controls.slice().reverse());else throw new Error("bug");return r}function y6(r){if(r.length>2){let e=r[0],t=new Array;t.push(e);for(let n=1,i=r.length;n<i;n++){let s=r[n],o=!1;if(n+1<i){let a=s.sub(e).normalize(),l=r[n+1].sub(e).normalize(),u=a.cross(l);Math.abs(u)<.01&&(o=!0)}o||(t.push(s),e=s)}return t}else return r}var v6=class{constructor(){this.fac=new Oe,this.length=0,this.box=null,this.pt=null,this.i=0}calcBBox(r){for(this.fac.clear(),this.length=r.length,this.box=null,this.pt=null,this.i=0;this.i<this.length;this.i++)this.pt=r[this.i],this.box=this.pt.bbox(),this.fac.ext1(this.box);return this.fac.build1()}},w6=new v6,Ce=class Ht{constructor(e,t){this.__bbox=null,this.primitives=e,this.__bbox=t}static calcBBox(e){return w6.calcBBox(e)}static build1(e){let t=[],n=null;return Wc(e,(i,s)=>{let o=s.start();return n!==null&&!o.equals(n)&&t.push(new Y(n,o)),t.push(s),n=s.end(),!0}),t.length===0&&n!=null&&t.push(new Y(n,n)),new Ht(t)}static build2(e){return Ht.build1($c(e))}static build3(e){let t=[],n=null;return Wc(e,(i,s)=>(n!==null&&t.push(new Y(n,s)),n=s,!0)),new Ht(t)}static build4(e){return this.build3($c(e))}static build5(e){let t=[];for(let n=0;n<e.length;n+=2)t.push(new q(e[n],e[n+1]));return this.build4(t)}static build6(e){return Ht.build4([e.LL(),e.LR(),e.UR(),e.UL(),e.LL()])}static build7(e){return new Ht(e)}static build8(e){let t=new q(e[0],e[1]),n,i=[],s,o=(a,l)=>a.length==l&&a.every(u=>typeof u=="number");for(let a=2;a<e.length;)switch(typeof e[a]=="string"?s=e[a]:a-=1,s){case"ARC":{let l=e.slice(a+1,a+4);if(!o(l,3))throw new Error("invalid rawData");let u=l[0];n=new q(l[1],l[2]),i.push(re.build5(t,n,u)),t=n,a+=4;break}case"L":{let l=e.slice(a+1,a+3);if(!o(l,2))throw new Error("invalid rawData");n=new q(l[0],l[1]),i.push(new Y(t,n)),t=n,a+=3;break}case"C":{let l=e.slice(a+1,a+7);if(!o(l,7))throw new Error("invalid rawData");let u=new q(l[0],l[1]),c=new q(l[2],l[3]);n=new q(l[4],l[5]),i.push(new Ae([t,u,c,n])),t=n,a+=7;break}default:throw new Error("invalid rawData")}return Ht.build2(i)}static buildBBox(e,t=0){return t===1?Ht.build5([e.minX,e.minY,e.maxX,e.minY,e.maxX,e.maxY,e.minX,e.maxY,e.minX,e.minY]):Ht.build5([e.minX,e.minY,e.minX,e.maxY,e.maxX,e.maxY,e.maxX,e.minY,e.minX,e.minY])}static triangulate(e,t,n=1){if(e.length===1){let l=new Array;e[0].asClose().points2(n,f=>l.push(f));let u,c=l[0],h=[];for(let f=0;f<l.length-2;f+=2){let d=l[f+1],m=l[f+2],p=d.sub(c).normalize().cross(m.sub(c).normalize());if(ae.neq(p,0)){if(u===!0){if(p<0){h.length=0;break}}else if(u===!1){if(p>0){h.length=0;break}}else u=p>0;h.push(c),h.push(d),h.push(m)}l.push(c),c=m}if(h.length!==0){for(let f=0;f<h.length;f+=3)t(h[f],h[f+1],h[f+2]);return}}let i=[],s=[];e.forEach(l=>{i.length!==0&&s.push(i.length/2),l.asClose().points2(n,u=>i.push(u.x,u.y))});let o=x6.default(i,s),a=[];for(let l=1;l<i.length;l+=2)a.push(new q(i[l-1],i[l]));for(let l=0;l<o.length;l+=3)t(a[o[l]],a[o[l+1]],a[o[l+2]])}lines(e,t){let n=new Array;this.points(e,s=>n.push(s));let i=n[0];for(let s=1;s<n.length;s++){let o=n[s];t(i),t(o),i=o}}triangles(e,t){Ht.triangulate([this],(...n)=>{n.forEach(i=>t(i))},e)}mirror(){let e=[];return this.primitives.forEach(t=>{if(t instanceof Y)t=new Y(t.start().mirror(),t.end().mirror());else if(t instanceof re)t=t.mirror();else if(t instanceof Ae){let n=t.controls.map(i=>i.mirror());t=new Ae(n)}else throw new Error("bug");e.push(t)}),new Ht(e,this.__bbox)}getPoints(e){let t=[];for(let n of this.primitives)for(let i of n.points(e))t.push(i);return t}round(e=4){let t=this.primitives.slice();for(let n=0;n<t.length;n++){let i=t[n];if(i instanceof Y){let s=i.start().round(e),o=i.end().round(e);t[n]=new Y(s,o)}else if(i instanceof Ae){let s=i.controls.map(o=>o.round(e));t[n]=new Ae(s)}else if(i instanceof re){let s=i.start().round(e),o=i.end().round(e),a=i.sweepAngle;t[n]=re.build5(s,o,a)}}return new Ht(t,this.__bbox)}simplify(e=.05){let t=[],n=!1,i=[],s=this.closed();if(this.primitives.length<=1)return Ht.build2(this.primitives);let o=()=>{if(i.length>2){let l=g6(i,e);for(let u=1;u<l.length;u++)t.push(new Y(l[u-1],l[u]))}else t.push(new Y(i[0],i[1]));i.length=0,n=!1};for(let l=0;l<this.primitives.length;l++){let u=this.primitives[l];u instanceof Y?(n?i.push(u.end()):(i.length=0,i.push(u.start(),u.end()),n=!0),l===this.primitives.length-1&&o()):(n&&o(),t.push(u))}let a=new Ht(t,this.__bbox);return s&&!a.closed()&&(a=a.asClose()),a}hasBackLine(){let{primitives:e}=this,t;for(let n=0;n<e.length;n++){let i=e[n];if(i instanceof Y){if(i.end().equals1(i.start()))continue;if(t&&(i.end().equals1(t.start())||ZD(i.end(),t.start(),t.end())))return!0;t=i}else t=null}return!1}area(e){let t=null,n=null,i=0;return this.points(e,s=>{n?i+=(s.x+n.x)*(s.y-n.y):t=s,n=s}),i+=(t.x+n.x)*(t.y-n.y),i/2}closed(e){return this.primitives.length===0?!1:this.start().equals(this.end(),e)}asClose(){let e=this.primitives[0],t=this.primitives[this.primitives.length-1],n=e.start(),i=t.end();if(n.equals(i))return this;{let s=new Array;return Sr.addAll(s,this.primitives),s.push(new Y(i,n)),Ht.build2(s)}}closeEndpoint(){let e=this.primitives[0],t=this.primitives[this.primitives.length-1],n=e.start(),i=t.end();if(n.equals1(i))return this;{let s=new Array;return Sr.addAll(s,this.primitives),s.push(new Y(i,n)),new Ht(s)}}reverse(){let e=new Array(this.primitives.length);for(let t=0,n=this.primitives.length-1;n>=0;t++,n--){let i=this.primitives[n];if(i instanceof Y)i=new Y(i.end(),i.start());else if(i instanceof re)i=i.exchangeSweep();else if(i instanceof Ae)i=new Ae(i.controls.slice().reverse());else throw new Error("bug");e[t]=i}return new Ht(e,this.__bbox)}reverse1(){let e=new Array(this.primitives.length);for(let t=0,n=this.primitives.length-1;n>=0;t++,n--){let i=this.primitives[n];if(i instanceof Y)i=new Y(i.end(),i.start());else if(i instanceof re)i=i.exchangeSweep1();else if(i instanceof Ae)i=new Ae(i.controls.slice().reverse());else throw new Error("bug");e[t]=i}return new Ht(e,this.__bbox)}mirrorY(e){let t=[];return this.primitives.forEach(n=>{if(n instanceof Y)n=n.mirrorY(e);else if(n instanceof re)n=n.mirrorY(e);else if(n instanceof Ae){let i=n.controls.map(s=>s.mirrorY(e));n=new Ae(i)}else throw new Error("bug");t.push(n)}),new Ht(t,this.__bbox)}points(e,t){if(this.primitives.length!==0){for(let n=0;n<this.primitives.length-1;n++){let i=this.primitives[n].points(e);i.pop(),i.forEach(s=>t(s))}this.primitives[this.primitives.length-1].points(e).forEach(n=>t(n))}}points1(e,t){if(this.primitives.length===0)return;for(let i=0;i<this.primitives.length-1;i++){let s=this.primitives[i],o=s instanceof re?s.points1(e):s.points(e);o.pop(),o.forEach(a=>t(a))}let n=this.primitives[this.primitives.length-1];(n instanceof re?n.points1(e):n.points(e)).forEach(i=>t(i))}points2(e,t){if(this.primitives.length===0)return;for(let i=0;i<this.primitives.length-1;i++){let s=this.primitives[i],o=s instanceof re?s.points2():s.points(e);o.pop(),o.forEach(a=>t(a))}let n=this.primitives[this.primitives.length-1];(n instanceof re?n.points2():n.points(e)).forEach(i=>t(i))}multiply3(e){let t=new Array(this.primitives.length);for(let n=0;n<this.primitives.length;n++)t[n]=this.primitives[n].multiply3(e);return Ht.build7(t)}bbox(){return this.__bbox==null&&(this.__bbox=Ht.calcBBox(this.primitives)),this.__bbox}start(){return this.primitives.length!==0?this.primitives[0].start():null}end(){return this.primitives.length!==0?this.primitives[this.primitives.length-1].end():null}isClose(e){if(this.primitives.length<=1&&!(this.primitives[0]instanceof re))return!1;{let t=this.primitives[0],n=this.primitives[this.primitives.length-1];return t.start().equals(n.end(),e)}}isEqual(e){if(e instanceof Ht&&e.primitives.length==this.primitives.length){let t=e.primitives.length;for(let n=0;n<t;n++){let i=e.primitives[n],s=this.primitives[n];if(JSON.stringify(i)!=JSON.stringify(s))return!1}return!0}return!1}equals(e){if(!e)return!1;let t=this.primitives,n=e.primitives;if(t.length!=n.length)return!1;if(e.isClose()){let i=0;for(;i<t.length;){let s=t.slice(i).concat(t.slice(0,i));if(Jn(s,n)||Jn(s.reverse(),n))return!0;i++}return!1}else return Jn(this.primitives,e.primitives)}clone(){return Ht.build2(this.primitives)}putItem(e,t){if(!e)return!1;if(e instanceof Ht)return this.mergePolyline(e,t);let n=this.start();if(!n){this.primitives.push(e),this.__bbox=e.bbox();return}let i=this.end();if(n.equals(i,t))return!1;let s=e.start(),o=e.end(),a=!1,l=!1;if(n.equals(s,t))a=!0,l=!1;else if(n.equals(o,t))a=!1,l=!1;else if(i.equals(s,t))a=!1,l=!0;else if(i.equals(o,t))a=!0,l=!0;else return!1;return l?this.primitives.push(a?e.reverse():e):this.primitives.unshift(a?e.reverse():e),this.__bbox=ye.extend2(this.__bbox,e.bbox()),!0}mergePolyline(e,t,n=0){if(!e)return!1;let i=this.start();if(!i){this.primitives.push(...e.primitives),this.__bbox=e.bbox();return}let s=this.end();if(i.equals(s,t))return!1;let o=e.start(),a=e.end(),l=!1,u=!1;if(i.equals(o,t))l=!0,u=!1;else if(i.equals(a,t))l=!1,u=!1;else if(s.equals(o,t))l=!1,u=!0;else if(s.equals(a,t))l=!0,u=!0;else return!1;let c=l?e.reverse():e;return u?this.primitives.push(...c.primitives):this.primitives.unshift(...c.primitives),this.__bbox=ye.extend2(this.__bbox,e.bbox()),!0}deDuplicationPoint(e){let t=this.primitives[this.primitives.length-1].start(),n=this.primitives[this.primitives.length-1].end(),i=e.primitives[0].start(),s=e.primitives[0].end();if(this.primitives[this.primitives.length-1]instanceof Y&&e.primitives[0]instanceof Y&&Ay([t,n],[i,s])){this.primitives.pop(),e.primitives.shift();let o=[];o.push(new Y(t,s)),this.primitives.push(...o)}}getMaxBBoxHeightByVec(e){let t=e.normalize(),n=-1/0,i=1/0;if(this.primitives.forEach(o=>{let a=o.start().dot(t),l=o.end().dot(t);if(s(a),s(l),o instanceof re){let u=e.angleD(q.ORIGIN);if(o.angleIsInArc(u)){let c=o.pointOn(u).dot(t);s(c)}if(o.angleIsInArc(u+180)){let c=o.pointOn(u-180).dot(t);s(c)}}}),n-i<=0)throw new Error("getMaxBBoxHeightByVec");return n-i;function s(o){o>n&&(n=o),o<i&&(i=o)}}getWindingNum(e){let t=this.end(),n=0,{x:i,y:s}=e;for(let a of this.primitives){if(t.y>s?a.bbox().minY>s:a.bbox().maxY<=s){t=a.end();continue}if(a instanceof re&&(a.isCCW?Math.floor(a.startAngle/90)+1!==Math.ceil(a.endAngle()/90):Math.ceil(a.startAngle/90)-1!==Math.floor(a.endAngle()/90))){let l=a.startAngle,u=a.endAngle();if(a.sweepAngle>0){let c=90;for(;c<=u;)c>l&&(o(re.build3(a.center,l,c-l,a.rx,a.ry)),l=c),c+=90;l<u&&o(re.build3(a.center,l,u-l,a.rx,a.ry))}else{let c=270;for(;c>=u;)c<l&&(o(re.build3(a.center,l,c-l,a.rx,a.ry)),l=c),c-=90;l>u&&o(re.build3(a.center,l,u-l,a.rx,a.ry))}}else o(a)}return n;function o(a){let l=a.start(),u=a.end();if(t.y>s!=l.y>s&&(t.x>i?l.x>i?n+=l.y>t.y?1:-1:t.y>l.y?(t.x-i)*(l.y-s)-(t.y-s)*(l.x-i)<0&&n--:(t.x-i)*(l.y-s)-(t.y-s)*(l.x-i)>0&&n++:l.x>i&&(t.y>l.y?(t.x-i)*(l.y-s)-(t.y-s)*(l.x-i)<0&&n--:(t.x-i)*(l.y-s)-(t.y-s)*(l.x-i)>0&&n++)),l.y>s!=u.y>s){if(l.x>i)if(u.x>i)n+=u.y>l.y?1:-1;else if(a instanceof Y)l.y>u.y?(l.x-i)*(u.y-s)-(l.y-s)*(u.x-i)<0&&n--:(l.x-i)*(u.y-s)-(l.y-s)*(u.x-i)>0&&n++;else if(a instanceof re){let{center:c,isCCW:h,rx2:f}=a,d=(c.x-i)**2+(c.y-s)**2;l.y>u.y?(h?d>f:d<f)&&n--:(h?d<f:d>f)&&n++}else if(a instanceof Ae){if(fm(a,s)===0)throw new Error("no inters");V[0]>i&&(n+=u.y>l.y?1:-1)}else throw new Error("not support!");else if(u.x>i)if(a instanceof Y)l.y>u.y?(l.x-i)*(u.y-s)-(l.y-s)*(u.x-i)<0&&n--:(l.x-i)*(u.y-s)-(l.y-s)*(u.x-i)>0&&n++;else if(a instanceof re){let{center:c,isCCW:h,rx2:f}=a,d=(c.x-i)**2+(c.y-s)**2;l.y>u.y?(h?d>f:d<f)&&n--:(h?d<f:d>f)&&n++}else if(a instanceof Ae){if(fm(a,s)===0)throw new Error("no inters");V[0]>i&&(n+=u.y>l.y?1:-1)}else throw new Error("not support!")}t=u}}},oh=Math.PI*2,Nle=Math.PI,Rle=Math.PI/2,Lle=Math.sin(Math.PI/180),Ole=.5,kle=6.75,E6=4,re=class Tt extends Xl{constructor(e,t,n,i,s){super(),this._rx2=null,this._ry2=null,this._svgEnd=null,this._hashed=null,this.__bbox=null,this.rx=e,this.ry=t,this.center=n,this.startAngle=i,this.sweepAngle=s,this._start=q.ORIGIN,this._end=q.ORIGIN,this._start=this.pointOn(i),this._end=this.pointOn(i+s)}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}hashCode(){return this.hashed}_hashCode(){let e=31,t=1;return t=e*t+new q(this.rx,this.rx).hashCode(),t=e*t+this.center.hashCode(),t=e*t+new q(this.startAngle,this.sweepAngle).hashCode(),t}get rx2(){return this._rx2==null&&(this._rx2=this.rx*this.rx),this._rx2}get ry2(){return this._ry2==null&&(this._ry2=this.ry*this.ry),this._ry2}get svgEnd(){return this._svgEnd==null&&(this._svgEnd=this.getSvgEnd(this.startAngle,this.sweepAngle,this._start,this._end)),this._svgEnd}getSvgEnd(e,t,n,i){let s=t>=0?-.01:.01,o=e+t;for(;(t>=0&&o>e||t<0&&o<e)&&n.distance2(i)<2e-4;)s*=2,o+=s,i=this.pointOn(o);return i}static build1(e,t,n,i,s,o){at.positive(n),at.positive(i);let a=e.equals(t);if(a)return new Tt(n,i,e,0,s?360:0);{let l=e.x,u=-e.y,c=t.x,h=-t.y,f=o===0,d=(l-c)/2,m=(u-h)/2,p=Math.cos(0),g=Math.sin(0),b=p*d+g*m,v=-g*d+p*m;n=Math.abs(n),i=Math.abs(i);let w=n*n,P=i*i,_=b*b,B=v*v,I=s===f?-1:1,C=(w*P-w*B-P*_)/(w*B+P*_);C=C<0?0:C;let N=I*Math.sqrt(C),A=N*(n*v/i),M=N*-(i*b/n),S=(l+c)/2,$=(u+h)/2,H=S+(p*A-g*M),K=$+(g*A+p*M),F=(b-A)/n,z=(v-M)/i,L=(-b-A)/n,k=(-v-M)/i,O,ie;ie=Math.sqrt(F*F+z*z),O=F,I=z<0?-1:1;let W=Xe.toDegrees(I*Math.acos(O/ie));ie=Math.sqrt((F*F+z*z)*(L*L+k*k)),O=F*L+z*k,I=F*k-z*L<0?-1:1;let Q=O/ie,oe;Q<-1?oe=Math.acos(-1):Q>1?oe=Math.acos(1):oe=Math.acos(Q);let we=Xe.toDegrees(I*oe);!f&&we>0?we-=360:f&&we<0&&(we+=360),at.normal(W),at.normal(we);let xe=d*d/w+m*m/P,ge=e.distance1(t)/2;n<ge&&i<ge&&(n*=Math.sqrt(xe),i*=Math.sqrt(xe));let Le=a?0:Xe.regularD(-W),Ne=a?s?360:0:-we;return new Tt(n,i,new q(H,-K),Le,Ne)}}static build2(e,t,n,i,s,o){at.positive(i),at.positive(s),at.normal(t),at.normal(n);let a;return t===n?(t=Xe.regularD(t),n=Xe.regularD(n),a=0):(t=Xe.regularD(t),n=Xe.regularD(n),o===1?n<=t&&(n+=360):n>=t&&(t+=360),a=n-t),new Tt(i,s,e,Xe.regularD(t),a)}static build3(e,t,n,i,s){return at.positive(i),at.positive(s),at.normal(n),new Tt(i,s,e,Xe.regularD(t),n)}static build4(e,t,n,i,s,o){let a=e.angleD(n),l=t.angleD(n);return Tt.build2(n,a,l,i,s,o)}static build5(e,t,n){n=Xe.toRadians(n);let i=t.sub(e),s=new q(-i.y,i.x).normalize(),o=Math.abs(n)/2,a;if(o!=0)a=i.length()/2/Math.sin(o);else throw new Error("Can't represent circle!!!");let l=s.rotate(q.ORIGIN,o),u,c;n>0?(u=1,c=t.add(l.scale(a))):(u=0,c=e.sub(l.scale(a)));let h=Xe.toDegrees(e.angle(c)),f=Xe.toDegrees(t.angle(c));return Tt.build2(c,h,f,a,a,u)}static buildCircle(e,t,n=0){return Tt.build2(e,0,360,t,t,n)}start(){return this._start}end(){return this._end}isLarge(){return Math.abs(this.sweepAngle)>180}sweep(){return this.sweepAngle>=0?1:0}get isCCW(){return this.sweepAngle>=0}endAngle(){return this.startAngle+this.sweepAngle}pointOn(e){e=Xe.regularD(e);let t=this.rx,n=this.ry;if(e===0)return this.center.add1(t,0);if(e===90)return this.center.add1(0,n);if(e===180)return this.center.add1(-t,0);if(e===270)return this.center.add1(0,-n);{let i=this.rx2,s=this.ry2,o=Math.tan(Xe.toRadians(e)),a=o*o,l=Math.sqrt(i*s/(i+s/a)),u=Math.sqrt(i*s/(s+i*a));return e>90&&e<270&&(u=-u),e>180&&e<360&&(l=-l),isNaN(u)&&(u=0),isNaN(l)&&(l=0),this.center.add1(u,l)}}exchangeSweep(){return Tt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,this.rx,this.ry)}exchangeSweepAndStart(){return Tt.build1(this.end(),this.start(),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}exchangeSweep1(){return Tt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle+.01,this.rx,this.ry)}mirrorY(e){let t=this.start(),n=this.end();return t.equals(n)?Tt.build3(this.center.mirrorY(),0,360,this.rx,this.ry):Tt.build1(t.mirrorY(e),n.mirrorY(e),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}mirror(e=q.ORIGIN){let t=this.start(),n=this.end();return t.equals(n)?Tt.build3(this.center.mirror(e),0,360,this.rx,this.ry):Tt.build1(t.mirror(e),n.mirror(e),this.rx,this.ry,this.isLarge(),this.sweep())}sectorArea(){return Math.abs(this.sweepAngle)/360*Math.PI*this.rx*this.ry}area(){let e=Ji.area(this.center,this._start,this.pointOn(this.endAngle()));return this.sectorArea()-e}multiply3(e){let t;e.isMirrored()?t=-this.sweepAngle:t=this.sweepAngle;let n;return e.equals(qe.ROT_90)?n=Xe.regularD(this.startAngle+90):e.equals(qe.ROT_N90)?n=Xe.regularD(this.startAngle-90):n=Xe.transformD(this.startAngle,e),Tt.build3(this.center.multiply3(e),n,t,e.iScale*this.rx,e.iScale*this.ry)}angleIsInArc(e){return e=Xe.regularD(e),this.sweepAngle>0?(e<this.startAngle&&(e+=360),this.endAngle()>e):(e>this.startAngle&&(e-=360),this.endAngle()<e)}toBezier(){if(Math.abs(this.sweepAngle)>90)throw new Error("not support!");let e=this.start(),t=this.end(),n=Xe.toRadians(this.sweepAngle)/2,i=4/3*(1-Math.cos(n))/Math.sin(n)*this.rx;return new Ae([e,e.add(new q(i,0).multiply3(qe.rotateD(this.startAngle+90))),t.add(new q(i,0).multiply3(qe.rotateD(this.endAngle()-90))),t])}toBezier2(){let e=[];n(this,90);let t=[];return e.forEach(i=>t.push(i.toBezier())),t;function n(i,s){if(Math.abs(i.sweepAngle)>s){let o=i.sweepAngle/2;n(Tt.build3(i.center,i.startAngle,o,i.rx,i.ry),s),n(Tt.build3(i.center,i.startAngle+o,o,i.rx,i.ry),s)}else e.push(i)}}buildBBox(){let e=My.getCache().boxCache,t=this.startAngle+this.sweepAngle;if(e[0]=Math.min(this._start.x,this._end.x),e[1]=Math.max(this._start.x,this._end.x),e[2]=Math.min(this._start.y,this._end.y),e[3]=Math.max(this._start.y,this._end.y),this.sweepAngle>0){let n=0;for(;n<t;){if(n>this.startAngle){let i=this.pointOn(n);e[0]=Math.min(e[0],i.x),e[1]=Math.max(e[1],i.x),e[2]=Math.min(e[2],i.y),e[3]=Math.max(e[3],i.y)}n+=90}}else if(this.sweepAngle<0){let n=360;for(;n>t;){if(n<this.startAngle){let i=this.pointOn(n);e[0]=Math.min(e[0],i.x),e[1]=Math.max(e[1],i.x),e[2]=Math.min(e[2],i.y),e[3]=Math.max(e[3],i.y)}n-=90}}return new ye(e[0],e[1],e[2],e[3])}bbox(){return this.__bbox==null&&(this.__bbox=this.buildBBox()),this.__bbox}length(){return Math.abs(this.rx*this.sweepAngle*Math.PI/180)}toString(){return la.format("Arc [start=%s, end=%s, rx=%s, ry=%s, center=%s, startAngle=%s, sweepAngle=%s]",this._start,this._end,this.rx,this.ry,this.center,this.startAngle,this.sweepAngle)}stroke(e,t,n){let i=e/2,s=this.rx+i,o=this.ry+i,a=this.rx-i,l=this.ry-i,u=new qe;a<0&&(a=-a,u=u.multiply3(qe.MIRROR_Y)),l<0&&(l=-l,u=u.multiply3(qe.MIRROR_X)),a===0&&(a=.001),l===0&&(l=.001),u=u.setOrigin1(this.center);let c,h;switch(n===this.sweep()?(c=Tt.build3(this.center,this.startAngle,this.sweepAngle,s,o),h=Tt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,a,l)):(c=Tt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,s,o),h=Tt.build3(this.center,this.startAngle,this.sweepAngle,a,l)),h=h.multiply3(u),t){case 1:{let f=n===1?180:-180,d=n===this.sweep()?this.pointOn(this.endAngle()):this.pointOn(this.startAngle),m=n===this.sweep()?this.pointOn(this.startAngle):this.pointOn(this.endAngle()),p=c.pointOn(c.endAngle()).angleD(d),g=h.pointOn(h.endAngle()).angleD(m);return Ce.build2([c,Tt.build3(d,p,f,i,i),h,Tt.build3(m,g,f,i,i)])}default:return Ce.build2([c,h])}}points2(){let e=Math.ceil(Math.abs(this.sweepAngle)/E6),t=this.sweepAngle/e,n=[this._start];for(let i=1;i<e;i++)n.push(this.pointOn(this.startAngle+t*i));return n.push(this._end),n}points1(e){let t=Math.max(this.rx,this.ry);if(t<=e)return[this.start(),this.svgEnd];let n=(t-e)/t,i=Math.ceil(Math.abs(this.sweepAngle/Xe.toDegrees(Math.acos(n))/2)),s=new Array(i+1),o=this.sweepAngle/i,a=this.startAngle;for(let l=0;l<=i;l++,a+=o)s[l]=this.pointOn(a);return s}points(e){let t=Math.max(this.rx,this.ry);if(e=Math.abs(e),t<=e)return[this.start(),this.svgEnd];e=Math.max(e,t*1e-5),e=Math.min(e,t*(1-Math.SQRT1_2));let n=(t-e)/t,i=Math.ceil(Math.abs(this.sweepAngle/Xe.toDegrees(Math.acos(n))/2));i=Math.max(i,2);let s=new Array(i+1),o=this.sweepAngle/i,a=this.startAngle+o;s[0]=this.start();for(let l=1;l<i;l++,a+=o)s[l]=this.pointOn(a);return s[i]=this.end(),s}panDistance(e){return this.sweepAngle>0?new Tt(this.rx-e,this.ry-e,this.center,this.startAngle,this.sweepAngle):new Tt(this.rx+e,this.ry+e,this.center,this.startAngle,this.sweepAngle)}panDistance1(e){if(this.sweepAngle>0){let t=this.rx-e;return t<0?(t=Math.abs(t),Tt.build3(this.center,this.startAngle-180,this.sweepAngle,t,t)):new Tt(t,t,this.center,this.startAngle,this.sweepAngle)}else{let t=this.rx+e;return t<0?(t=Math.abs(t),Tt.build3(this.center,this.startAngle-180,this.sweepAngle,t,t)):new Tt(t,t,this.center,this.startAngle,this.sweepAngle)}}get bulge(){let e=Math.abs(bo(this.sweepAngle,3))/180*Math.PI;return Math.tan(e/4)}get midPoint(){let e=Xe.toRadians(this.startAngle),t=Xe.toRadians(this.endAngle()),n=this.sweep(),i=this.center,s=this.rx;if(n==1)if(t>e){let o=(t-e)/2+e;return i.add(new q(Math.cos(o),Math.sin(o)).mul(s))}else{if(t==e)return i.add(new q(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(s));{let o=(t+oh-e)/2+e;return i.add(new q(Math.cos(o),Math.sin(o)).mul(s))}}else if(t>e){let o=(e+oh-t)/2+t;return i.add(new q(Math.cos(o),Math.sin(o)).mul(s))}else{if(t==e)return i.add(new q(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(s));{let o=(e-t)/2+t;return i.add(new q(Math.cos(o),Math.sin(o)).mul(s))}}}get svgPathData(){return[{type:"M",values:[this._start.x,this._start.y]},{type:"A",values:[this.rx,this.ry,0,this.isLarge()?1:0,this.isCCW,this._end.x,this._end.y]}]}equals(e){let t=Xe.regularD(this.startAngle),n=Xe.regularD(this.sweepAngle),i=Xe.regularD(e.startAngle),s=Xe.regularD(e.sweepAngle);return Jn([this.rx,this.ry,this.center,Math.abs(n)],[e.rx,e.ry,e.center,Math.abs(s)])&&(Jn([n,t],[s,i])||Jn([Xe.regularD(t+n)],[i]))}equals1(e){let t=Xe.regularD(this.startAngle),n=Xe.regularD(this.sweepAngle),i=Xe.regularD(e.startAngle),s=Xe.regularD(e.sweepAngle);return Jn([this.rx,this.ry,this.center,Math.abs(n)],[e.rx,e.ry,e.center,Math.abs(s)])&&(Jn([n,t],[s,i])||Jn([Xe.regularD(t+n)],[i]))}inArea(e,t){let n=e.x,i=e.y,s=this.center,o=this.rx,a=Xe.toRadians(this.startAngle);this.sweep()==0&&(a=Xe.toRadians(this.endAngle()));let l=Xe.toRadians(this.endAngle());this.sweep()==0&&(l=Xe.toRadians(this.startAngle));let u=o-t/2,c=o+t/2;var h=n-s.x,f=i-s.y,d=Math.atan2(f,h);if(d<0&&(d+=oh),a<=l&&d>=a&&d<=l||a>l&&(d>=a&&d<=oh||d>=0&&d<=l)||a==l){var m=Math.sqrt(h*h+f*f);return m<=c&&m>=u}else{var m=(c+u)/2,p=new q(s.x+Math.cos(a)*m,s.y+Math.sin(a)*m),g=new q(s.x+Math.cos(l)*m,s.y+Math.sin(l)*m),b=n-p.x,v=i-p.y,w=n-g.x,P=i-g.y;return b*b+v*v<=t*t/4?!0:w*w+P*P<=t*t/4}}isCircle(){return(ae.eq(Math.abs(this.sweepAngle),360)||this._start.equals1(this._end))&&this.rx==this.ry}reverse(){return Tt.build3(this.center,this.endAngle(),-this.sweepAngle,this.rx,this.ry)}getAngle(){let e=Math.PI*2;return this.sweep()==1?(this.endAngle()-this.startAngle+e)%e:(this.startAngle-this.endAngle()+e)%e}isValid(){return this.rx>0&&this.ry>0}},Ny=new ArrayBuffer(24),gm=new Float64Array(Ny),fa=new Int32Array(Ny),me=(cr=class{static normal(e,t,n){let i=t.sub(e),s=n.sub(t);return i.cross(s)}constructor(e,t,n){this.x=at.normal(e),this.y=at.normal(t),this.z=at.normal(n),gm[0]=e,gm[1]=t,gm[2]=n,this.hashed=fa[0]^fa[1]^fa[2]^fa[3]^fa[4]^fa[5]}isZeroVector(){return this.x===0&&this.y===0&&this.z===0}hashCode(){return this.hashed}equals(e){return e instanceof cr?e.x===this.x&&e.y===this.y&&e.z===this.z:!1}cross(e){return new cr(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){var e=this.length();return new cr(this.x/e,this.y/e,this.z/e)}sub(e){return new cr(this.x-e.x,this.y-e.y,this.z-e.z)}add(e){return new cr(this.x+e.x,this.y+e.y,this.z+e.z)}scale(e){return new cr(this.x*e,this.y*e,this.z*e)}neg(){return new cr(-this.x,-this.y,-this.z)}multiply4(e){var t=this.x*e.data[0]+this.y*e.data[4]+this.z*e.data[8]+e.data[12],n=this.x*e.data[1]+this.y*e.data[5]+this.z*e.data[9]+e.data[13],i=this.x*e.data[2]+this.y*e.data[6]+this.z*e.data[10]+e.data[14],s=this.x*e.data[3]+this.y*e.data[7]+this.z*e.data[11]+e.data[15];return s!=0?new cr(t/s,n/s,i/s):new cr(t,n,i)}rotate(e,t){return this.multiply4(Qe.rotateAxis(e,t))}toVector2(){return new q(this.x,this.y)}},(()=>{cr.ORIGIN=new cr(0,0,0)})(),(()=>{cr.X_UNIT_VECTOR=new cr(1,0,0)})(),(()=>{cr.Y_UNIT_VECTOR=new cr(0,1,0)})(),(()=>{cr.Z_UNIT_VECTOR=new cr(0,0,1)})(),cr),zr=class{constructor(){this.clear()}clear(){this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.minZ=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.maxZ=Number.NEGATIVE_INFINITY}ext1(r,e,t,n,i,s){if(r<=n&&e<=i&&t<=s)this.minX=Math.min(this.minX,r),this.minY=Math.min(this.minY,e),this.minZ=Math.min(this.minZ,t),this.maxX=Math.max(this.maxX,n),this.maxY=Math.max(this.maxY,i),this.maxZ=Math.max(this.maxZ,s);else throw new Error("min > max is not permitted");return this}ext2(r,e,t){return this.minX=Math.min(this.minX,r),this.minY=Math.min(this.minY,e),this.minZ=Math.min(this.minZ,t),this.maxX=Math.max(this.maxX,r),this.maxY=Math.max(this.maxY,e),this.maxZ=Math.max(this.maxZ,t),this}ext3(r){return this.ext2(r.x,r.y,r.z)}ext4(r){return this.ext1(r.minX,r.minY,r.minZ,r.maxX,r.maxY,r.maxZ)}ext5(r,e){return this.minX=Math.min(this.minX,r),this.minY=Math.min(this.minY,e),this.maxX=Math.max(this.maxX,r),this.maxY=Math.max(this.maxY,e),this}ext6(r){return this.minZ=Math.min(this.minZ,r),this.maxZ=Math.max(this.maxZ,r),this}ext7(r){return this.minX=Math.min(this.minX,r.minX),this.minY=Math.min(this.minY,r.minY),this.maxX=Math.max(this.maxX,r.maxX),this.maxY=Math.max(this.maxY,r.maxY),this}isValid(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.minZ)&&isFinite(this.maxX)&&isFinite(this.maxY)&&isFinite(this.maxZ)}build(){return new wn(this.minX,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)}},wn=class{constructor(r,e,t,n,i,s){if(r<=n&&e<=i&&t<=s)this.minX=at.normal(r),this.minY=at.normal(e),this.minZ=at.normal(t),this.maxX=at.normal(n),this.maxY=at.normal(i),this.maxZ=at.normal(s);else throw new Error("min > max is not permitted")}center(){return new me((this.minX+this.maxX)/2,(this.minY+this.maxY)/2,(this.minZ+this.maxZ)/2)}transform(r){let e=new zr;for(let t of this.getVertexes())e.ext3(t.multiply4(r));return e.build()}isContains(r){return!(r.x<this.minX||r.y<this.minY||r.z<this.minZ||r.x>this.maxX||r.y>this.maxY||r.z>this.maxZ)}getVertexes(){return[new me(this.minX,this.minY,this.minZ),new me(this.minX,this.minY,this.maxZ),new me(this.minX,this.maxY,this.minZ),new me(this.minX,this.maxY,this.maxZ),new me(this.maxX,this.minY,this.minZ),new me(this.maxX,this.minY,this.maxZ),new me(this.maxX,this.maxY,this.minZ),new me(this.maxX,this.maxY,this.maxZ)]}toBBox2(){return new ye(this.minX,this.maxX,this.minY,this.maxY)}},lt=class _a{static build(e){return e instanceof Ce?new _a([new Zt([e])]):e instanceof Zt?new _a([e]):e}static buildByPolygon(e){return e?new _a([e]):new _a([])}static buildByStroke(e,t,n=1,i){return this.buildByPolygon(Zt.buildByStroke(e,t,n,i))}static buildCircle(e,t){return this.buildByPolygon(Zt.buildCircle(e,t))}static buildRect(e){return this.buildByPolygon(Zt.buildRect(e))}static buildBBox(e){return this.buildByPolygon(Zt.buildBBox(e))}constructor(e){this.items=e.slice()}multiply3(e){return new _a(this.items.map(t=>t.multiply3(e)))}bbox(){return this._bbox||(this._bbox=this.items.reduce((e,t)=>e.ext1(t.bbox()),new Oe).build1()),this._bbox}toPolylineGroups(){return this.items.map(e=>e.toPolylineGroup())}},it=(Et=class{static isHexFormate(e){return!e||typeof e!="string"?!1:/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)}static of1(e){return this.of2(e>>16&255,e>>8&255,e&255)}static of2(e,t,n,i=255){return new Et(e/255,t/255,n/255,i/255)}static of3(e){e.startsWith("#")&&(e=e.substr(1));let t=e.length;if(t==3)return new Et(parseInt(e[0],16)/15,parseInt(e[1],16)/15,parseInt(e[2],16)/15);if(t==6)return new Et(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255);if(t==8)return new Et(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255,parseInt(e.substr(6,2),16)/255);throw new Error("invalid color string")}static of4(e){let t=parseInt(e.r*255+"").toString(16),n=parseInt(e.g*255+"").toString(16),i=parseInt(e.b*255+"").toString(16);return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),("#"+t+n+i).toUpperCase()}static of5(e,t){if(e.startsWith("#")&&(e=e.substr(1)),e.length==3)return new Et(parseInt(e[0],16)/15,parseInt(e[1],16)/15,parseInt(e[2],16)/15,t);if(e.length==6)return new Et(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255,t);throw new Error("invalid color string")}static of6(e,t){return new Et(e.r,e.g,e.b,t)}static of7(e){return e==null?null:Et.of3(e)}constructor(e,t,n,i=1){this.r=at.positiveOr0(e),this.g=at.positiveOr0(t),this.b=at.positiveOr0(n),this.alpha=i}hashCode(){return this.r+this.g+this.b+this.alpha}equals(e,t=!1){let n=this.r===e.r&&this.g===e.g&&this.b===e.b;return t?n:n&&this.alpha===e.alpha}add(e,t,n,i){return new Et(Math.max(0,Math.min(1,this.r+e)),Math.max(0,Math.min(1,this.g+t)),Math.max(0,Math.min(1,this.b+n)),Math.max(0,Math.min(1,this.alpha+i)))}mul(e){return new Et(Math.max(0,Math.min(1,this.r*e)),Math.max(0,Math.min(1,this.g*e)),Math.max(0,Math.min(1,this.b*e)),this.alpha)}mul1(e){return new Et(Math.max(0,this.r*e),Math.max(0,this.g*e),Math.max(0,this.b*e),this.alpha)}getData(){return[this.r,this.g,this.b,this.alpha]}toString(){let e=(this.r*255).toString(16),t=(this.g*255).toString(16),n=(this.b*255).toString(16);return e.length<2&&(e="0"+e),t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),"#"+e.substr(0,2)+t.substr(0,2)+n.substr(0,2)}toString1(){let e=(this.r*255).toString(16),t=(this.g*255).toString(16),n=(this.b*255).toString(16),i=(this.alpha*255).toString(16);return e.length<2&&(e="0"+e),t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),"#"+e.substr(0,2)+t.substr(0,2)+n.substr(0,2)+i.substr(0,2)}toRGBA(){let e=this.r*255,t=this.g*255,n=this.b*255;return[e,t,n,this.alpha]}toRGBAString(){let e=this.r*255,t=this.g*255,n=this.b*255;return`rgba(${e},${t},${n},${this.alpha})`}isWHITE(){return this.r===1&&this.g===1&&this.b===1&&this.alpha===1}},(()=>{Et.WHITE=new Et(1,1,1,1)})(),(()=>{Et.BLACK=new Et(0,0,0,1)})(),(()=>{Et.RED=new Et(1,0,0,1)})(),(()=>{Et.GREEN=new Et(0,1,0,1)})(),(()=>{Et.BLUE=new Et(0,0,1,1)})(),(()=>{Et.Gray=Et.of3("#9966ff")})(),(()=>{Et.Silver=Et.of3("#D2D2D2")})(),(()=>{Et.Golden=Et.of3("#DCAA14")})(),(()=>{Et.Pink=Et.of3("#ffaec9")})(),Et),_6=0,Zl=class Lm{constructor(e,t){this.inters=[],this.shape=e,this.start=e.start(),this.end=e.end(),t&&(this.id=_6++)}reverse(){this.shape=this.shape.reverse();let e=this.start;this.start=this.end,this.end=e}getCenterPoint(e=this.end){let{x:t,y:n}=this.start,{x:i,y:s}=e;if(this.shape instanceof re){let o=this.shape.rx,a=new q((t+i)/2,(n+s)/2),l=this.shape.center,u;return a.x!==l.x||a.y!==l.y?(u=a.angle(l),Math.abs(this.shape.sweepAngle)>180&&(u+=u>=0?-180:180)):u=(this.shape.startAngle+this.shape.endAngle())/2,new q(l.x+Math.cos(u)*o,l.y+Math.sin(u)*o)}else{if(this.shape instanceof Y)return new q((t+i)/2,(n+s)/2);if(this.shape instanceof Ae){let o=this.shape.getPercent(e,ke);return Ae.pointOn(o/2,this.shape.controls)}else throw Error("not support")}}static finalAngle(e,t,n){let i=e.cross(t)>0,s=Math.acos(Math.min(1,Math.max(-1,e.dot(t)/t.length())));return(n?!i:i)&&(s=lm-s),s}sortInters(){if(this.shape instanceof re){let e=this.shape.center,t=this.shape.start().sub(e).normalize(),n=this.shape.isCCW;this.inters.sort((i,s)=>{let o=i.coord.sub(e),a=s.coord.sub(e);return Lm.finalAngle(t,o,n)-Lm.finalAngle(t,a,n)<=0?-1:1})}else if(this.shape instanceof Y){let e=this.start,t=this.end,n=new q(t.x+(e.x-t.x)*2,t.y+(e.y-t.y)*2);this.inters.sort((i,s)=>i.coord.distance2(n)-s.coord.distance2(n)<=0?-1:1)}else if(this.shape instanceof Ae){let e=this.shape;this.inters.sort((t,n)=>e.getPercent(t.coord,ke)-e.getPercent(n.coord,ke)<=0?-1:1)}else throw Error("not support the primitive type");this.inters.forEach((e,t)=>e.setIndex(t))}getStart(){return this.start}getEnd(){return this.end}getShape(){return this.shape}connect(e){this.nextSide=e,e.prevSide=this}static returnPolygonList(e){let t=[];return e.forEach(n=>{let i=[];n.forEach((s,o)=>{let a=[];s.forEach(l=>{a.push(l.shape)}),i.push(Ce.build7(a))}),t.push(new Zt(i))}),t}addInter(e){this.inters.push(e)}static returnPolygonGroup(e){let t=[];return e.forEach(n=>{let i=[];n.forEach((s,o)=>{let a=[];s.forEach(l=>{a.push(l.shape)}),i.push(Ce.build7(a))}),t.push(new Zt(i))}),new lt(t)}static rebuild(e,t,n){if(e instanceof Y||t.distance2(n)<1e-6)return new Y(t,n);if(e instanceof re)return re.build2(e.center,t.angleD(e.center),n.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);if(e instanceof Ae){let i=e.getPercent(t,ke),s=e.clip(i)[1];return s.clip(s.getPercent(n,ke))[0]}else throw new Error("not supported operation")}static returnPolyline(e){return Ce.build7(e.map(t=>t.shape))}bbox(){return this.shape.bbox()}},P6=(r=>(r[r.END1=0]="END1",r[r.END2=1]="END2",r[r.END12=2]="END12",r[r.LEFT1=3]="LEFT1",r[r.LEFT2=4]="LEFT2",r))(P6||{});function ei(r,e,t){if(r instanceof re&&e instanceof re)return B6(r,e);if(r instanceof re&&e instanceof Y)return qy(r,e);if(r instanceof Y&&e instanceof re)return Oy(r,e);if(r instanceof Y&&e instanceof Y)return vo(r,e);if(r instanceof Ae&&e instanceof Y)return r.controls.length===2||$i(r)?vo(new Y(r.start(),r.end()),e):Ly(r,e);if(r instanceof Y&&e instanceof Ae)return e.controls.length===2||$i(e)?vo(r,new Y(e.start(),e.end())):ym(r,e);if(r instanceof re&&e instanceof Ae)return e.controls.length===2||$i(e)?qy(r,new Y(e.start(),e.end())):S6(r,e);if(r instanceof Ae&&e instanceof re)return r.controls.length===2||$i(r)?Oy(new Y(r.start(),r.end()),e):I6(r,e);if(r instanceof Ae&&e instanceof Ae)return bm(r,e);throw new Error("not support")}function pa(r,e){return et(r,e.start()).dot(et(e,e.start()))<=0?!1:ei(r,e)<=2}function xm(r,e){let t=e.getPercent(r.end(),ke);if(t===null)return!1;if(t===0)return!0;let n=e.clip(t)[0],i=r.buildConverxHull(ke),s=n.buildConverxHull(ke),o=u(i),a=u(s);return l(o,a);function l(c,h){let f=new Map([[0,1],[1,0],[2,2],[3,4],[4,3]]),d=c[0],m=h[0];if(!d||!m)throw Error("isAllOverlap(sides1: PackSide[], sides2: PackSide[])");let p=!0;do{let g=d.getShape(),b=m.getShape();if(g instanceof Y&&b instanceof Y){let v=p?vo(g,b):f.get(vo(b,g));if(v===0)d=d.nextSide,p=!1;else if(v===1)m=m.nextSide,p=!0;else if(v===2)d=d.nextSide,m=m.nextSide,p=!0;else return!1}else throw Error("not support")}while(d!==c[0].prevSide&&m!==h[0].prevSide);return!0}function u(c){let h=c.primitives.map(d=>new Zl(d)),f=h[h.length-1];return h.forEach(d=>{f.connect(d),f=d}),h}}function Ule(r,e){let t=r.end().distance2(e.center);if(t>(e.rx+ke)**2||t<(e.rx-ke)**2||!(Ge(r.end(),e.end())||ah(e,r.end())))return!1;let n=T6(e.center,r);if(n<=(e.rx+ke)**2&&n>=(e.rx-ke)**2)return!0}function Ry(r,e){let t=r.end().distance2(e.center);if(t>(e.rx+ke)**2||t<(e.rx-ke)**2||!(Ge(r.end(),e.end())||ah(e,r.end())))return!1;if(r.center.equals1(e.center))return!0;let n=r.center.distance1(e.center),i=Math.abs(r.rx-e.rx);if(n>Math.min(r.rx,e.rx)){let s=r.center.angleD(e.center);return r.rx>e.rx?!(n+i>ke&&Ei(r,s))&&!(n-i>ke&&r.rx+e.rx-n>ke&&Ei(r,s+180)):!(n-i>ke&&Ei(r,s))&&!(r.rx+e.rx-n>ke&&Ei(r,s+180))}else{if(n+i<=ke)return!0;let s=r.rx>e.rx?r.center.angleD(e.center):e.center.angleD(r.center);return Ei(r,s)?!1:n-i<=ke?!0:!Ei(r,s+180)}}function S6(r,e){let t=r.toBezier2(),n,i=0;for(let s=t.length;i<s;i++){let o=t[i];if(n=bm(o,e),n!==0)break}return n===2&&i!==t.length-1?1:n}function I6(r,e){let t=e.toBezier2(),n,i=0;for(let s=t.length;i<s;i++){let o=t[i];if(n=bm(r,o),n!==1)break}return n===2&&i!==t.length-1?0:n}function bm(r,e){if(r.controls.length===2||$i(r))return e.controls.length===2||$i(e)?vo(new Y(r.start(),e.end()),new Y(e.start(),e.end())):ym(new Y(e.start(),r.end()),e);if(e.controls.length===2||$i(e))return Ly(vm(r,e.start()),new Y(e.start(),e.end()));let t=vm(r,e.start());if($i(t))return ym(new Y(e.start(),r.end()),e);let n=xm(t,e),i=xm(e,t);if(!n&&!i){let s=s6(t,e);if(s.havOverlap){let o=s.havOverlap!==2,a=s.havOverlap!==1;return Wi(r,e,o,a)}else{let o=function(){for(let h=0;h<u;h+=2)V[h]=c[h],V[h+1]=c[h+1]},a,l,u=s.cnt,c=new Array(u).fill(0).map((h,f)=>V[f]);for(let h=0;h<u;h+=2){let f=new q(V[h],V[h+1]),d=t.getPercent(f,ke),m=e.getPercent(f,ke);if(d===0||m===0)continue;let p=d===1?t:t.clip(d)[0],g=m===1?e:e.clip(m)[0];if(xm(p,g)){a=t.end(),l=e.end();break}o()}return(!a||!l)&&(a=_s(t.controls,t.controls[0],e),l=_s(e.controls,t.controls[0],t)),a.sub(t.controls[0]).cross(l.sub(t.controls[0]))>0?4:3}}return Wi(r,e,n,i)}function Ly(r,e){let t=vm(r,e.start());if($i(t))return vo(new Y(t.start(),t.end()),e);let n=Uy(t,e),{isIn:i,bezierIsInLeft:s}=ky(e,t);if(!n&&!i){if(s!==void 0)return s?3:4;let o=null,a=r.getPercent(e.start(),ke)+.01;for(let l=a>1?1:a;l<=1;){let u=Ae.pointOn(l,r.controls);if(ma(e,u)>Dr){o=u;break}l+=.01,l>1&&(l=1)}if(!o)throw Error("!end1 && !end2 not result");return e.direct.cross(o.sub(e.start()))<0?4:3}return Wi(t,e,n,i)}function ym(r,e){let{isIn:t,bezierIsInLeft:n}=ky(r,e),i=Uy(e,r);if(!t&&!i){if(n!==void 0)return n?4:3;let s=null;for(let o=.01;o<=1;){let a=Ae.pointOn(o,e.controls);if(ma(r,a)>Dr){s=a;break}o+=.01,o>1&&(o=1)}if(!s)throw Error("!end1 && !end2 not result");return r.direct.cross(s.sub(r.start()))<0?3:4}return Wi(e,r,t,i)}function B6(r,e){let t=Ry(Fy(r,e.start()),e),n=Ry(e,r);if(!t&&!n){let i=wi(e);if(r.center.sub(e.start()).dot(e.center.sub(e.start()))>0){if(r.rx===e.rx)return r.isCCW?i.dot(r.center.sub(e.center))<0?3:4:i.dot(r.center.sub(e.center))>0?3:4;let s,o;return r.rx>e.rx?(s=r,o=e):(s=e,o=r),i.dot(o.center.sub(s.center))>0&&o.rx+o.center.distance1(s.center)-s.rx>ke?r.isCCW?r.rx>e.rx?3:4:r.rx<e.rx?3:4:r.isCCW?r.rx<e.rx?3:4:r.rx>e.rx?3:4}else return r.rx+e.rx-r.center.distance1(e.center)>ke&&i.dot(r.center.sub(e.center))>0?e.isCCW?3:4:r.isCCW?3:4}return Wi(r,e,t,n)}function Oy(r,e){let t=yi.foot(r,e.center),n=r.end().distance2(e.center),i=r.end().sub(r.start()),s=n<=(e.rx+ke)**2&&n>=(e.rx-ke)**2&&(i.dot(t.sub(e.start()))<=0||r.start().distance2(r.end())<=r.start().distance2(t)||t.distance2(e.center)>=(e.rx-ke)**2)&&(Ge(r.end(),e.end())||ah(e,r.end())),o=Dy(e,r);if(!s&&!o){let a=r.distance2(e.center);return a<=Dr?i.cross(wi(e))>0?4:3:r.distance2(e.start())>Dr?r.direct.cross(e.start().sub(r.start()))*r.direct.cross(e.center.sub(r.start()))>0?i.cross(e.center.sub(r.start()))>0?4:3:i.cross(e.center.sub(r.start()))<0?4:3:i.dot(t.sub(e.start()))>0&&a<(e.rx-ke)**2?i.cross(e.center.sub(r.start()))<0?4:3:i.cross(e.center.sub(r.start()))>0?4:3}return Wi(e,r,s,o)}function Ei(r,e){return e=Xe.regularD(e),r.sweepAngle>0?(e<r.startAngle&&(e+=360),r.endAngle()>e):(e>r.startAngle&&(e-=360),r.endAngle()<e)}function ah(r,e){return Ge(r.end(),e)||Ge(r.start(),e)||Ei(r,e.angleD(r.center))}function Dle(r,e){let t=r.getPercent(e,ke);return Ge(r.start(),e)||Ge(r.end(),e)||t!==0&&!t}function ky(r,e){let t=r.panDistance(ke),n=r.panDistance(-ke),i=zy(e,t),s=zy(e,n);if(!i.length&&!s.length)return{isIn:e.getPercent(r.end(),ke)!==null};let o=[...i,...s].sort((c,h)=>c.t-h.t),a=new Y(n.start(),t.start()),l=[];for(let c=0,h=o.length;c<h;c++){let f=o[c];if(l.push(f),a.distance(f.interP)>r.length()+ke)break;if(l.length===2){let d=(l[1].t*10+l.shift().t*10)/20,m=Ae.pointOn(d,e.controls);if(r.distance2(m)>Dr)return{isIn:!1,bezierIsInLeft:r.direct.cross(m.sub(r.start()))>0}}}let u=l.length?a.distance(l[0].interP)>=r.length()+ke:!0;return{isIn:u,bezierIsInLeft:u?void 0:r.direct.cross(l[0].interP.sub(r.start()))>0}}function Uy(r,e){if(ma(e,r.end())>Dr||r.getToLineMaxDis2(e)>Dr)return!1;let t=A6(e,Dr);return r.getToLineMaxDis2(t)<=(e.length()+ke)**2}function Dy(r,e){let t=e.end().angleD(e.start()),n=ma(e,r.end());if(n>Dr)return!1;if(Ei(r,t+90)){if(yi.foot(e,r.center).distance1(r.pointOn(t+90))>r.rx)return!1;n=Math.max(n,(r.rx-e.distance(r.center))**2)}if(Ei(r,t-90)){if(yi.foot(e,r.center).distance1(r.pointOn(t-90))>r.rx)return!1;n=Math.max(n,(r.rx-e.distance(r.center))**2)}return n<=Dr&&(Ge(r.end(),e.end())||wm(e,r.end()))}var Gy=(ke*2)**2;function Fy(r,e){if(Ge(r.end(),e))return re.build3(r.center,r.endAngle(),0,r.rx,r.ry);if(r.start().distance2(e)<Gy)return r;let t=Xe.regularD(e.angleD(r.center));if(!Ei(r,t))throw new Error("!angleIsInArc(arc, angle)");return re.build2(r.center,t,r.endAngle(),r.rx,r.ry,r.isCCW?1:0)}function vm(r,e){if(Ge(r.end(),e))return new Ae([e,e]);if(r.start().distance2(e)<Gy)return r;let t=r.getPercent(e,ke);if(t===null)throw new Error("!cutBezier(bezier: Bezier, p: Vector2)");return r.clip(t)[1]}function qy(r,e){let t=Dy(Fy(r,e.start()),e),n=e.end().distance2(r.center),i=yi.foot(e,r.center),s=e.end().sub(e.start()),o=n<=(r.rx+ke)**2&&n>=(r.rx-ke)**2&&(s.dot(i.sub(e.start()))<=0||e.start().distance2(e.end())<=e.start().distance2(i)||i.distance2(r.center)>=(r.rx-ke)**2)&&(Ge(r.end(),e.end())||ah(r,e.end()));if(!t&&!o){let a=e.distance2(r.center);return a<=Dr?s.cross(wi(r,e.start().angle(r.center)))>0?3:4:s.dot(i.sub(e.start()))>0&&a<(r.rx-ke)**2?s.cross(r.center.sub(e.start()))>0?4:3:s.cross(r.center.sub(e.start()))<0?4:3}return Wi(e,r,t,o)}function vo(r,e){if(Ge(r.end(),e.end()))return Wi(r,e,!0,!0);let t=ma(e,r.end())<=Dr&&wm(e,r.end()),n=ma(r,e.end())<=Dr&&wm(r,e.end());return!t&&!n?r.end().sub(r.start()).cross(e.end().sub(r.start()))>0?4:3:Wi(r,e,t,n)}function wm(r,e){return yi.foot(r,e).distance2(r.start())<r.end().distance2(r.start())}function Wi(r,e,t,n){if(t)return n&&Ge(r.end(),e.end())?2:0;if(n)return 1;throw new Error("!end1 && !end2")}function ma(r,e){return(r.a*e.x+r.b*e.y+r.c)**2/(r.a**2+r.b**2)}function A6(r,e){let t=r.panDistance(e),n=r.panDistance(-e);return new Y(n.start(),t.start())}function Gle(r,e){let t=e.controls,n=1/0;for(let i=0;i<=1;i+=.01){let s=Ae.pointOn(i,t).distance1(r);s<n&&(n=s)}return n}function T6(r,e){return 0}function $i(r){let e=r.start(),t=r.end();e.equals1(t)&&(t=e.add1(1,0));let n=t.y-e.y,i=e.x-t.x,s=-n*e.x-i*e.y,o=Math.sqrt(1/(n**2+i**2));n*=o,i*=o,s*=o;let a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return r.controls.forEach(u=>{let c=n*u.x+i*u.y+s;c<a&&(a=c),c>l&&(l=c)}),ae.eq(a,l)}function zy(r,e){let t=bn(r,e),n=[],i=new Array(t).fill(0).map((o,a)=>V[a]);for(let o=0;o<t;o+=2){let a=new q(V[o],V[o+1]),l=r.getPercent(a);n.push({interP:a,t:l}),s()}function s(){for(let o=0;o<t;o+=2)V[o]=i[o],V[o+1]=i[o+1]}return n}function si(r,e=.01,t=270){let n=e**2,i=r.end(),s=[],o=[];r.primitives.forEach(p=>{let g=p.start(),b=p.end();if(f(i,g)||o.push(new Y(i,g)),wo(p,e)){o.push(null);return}if(p instanceof Y)o.push(p);else if(p instanceof re&&p.rx===p.ry)d(p,o);else if(p instanceof Ae){let v=[];f6(p,v),v.forEach(w=>{let P=w.start(),_=w.end();f(P,_)||o.push(w)})}else throw new Error("not support!");i=b});let a=o.length;if(o.forEach((p,g)=>{if(p)s.push(p);else{let b,v;g===a-1&&(b=s[0],v=s[s.length-1]);let w=(g+1)%a;if(b=b!=null?b:o[w],b){let P=g,_=!1;for(;v=v!=null?v:o[(--P+a)%a],v!==b;)if(v){_=!0;break}if(_){if(b.start().equals1(v.end()))return;if(et(v,v.end()).dot(et(b,b.start()))<0){if(!f(v.end(),b.start())){let N=new Y(v.end(),b.start());s.push(N);return}let{rebuildPrevPt:B,rebuildNextPt:I,rebuildLinkLine:C}=Yy(v,new Y(v.end(),b.start()),b);B&&I&&(B!==v?(o[(P+a)%a]=B,s[s.length-1]&&(s[s.length-1]=B)):I!==b&&(o[(g+1)%a]=I,s[0]===b&&(s[0]=I)),s.push(C))}}}}}),s.length===0)return null;f(i,s[0].start())||s.push(new Y(i,s[0].start()));let l=s[s.length-1];if(s.length===1)return l instanceof re?Ce.build7([re.build2(l.center,0,180,l.rx,l.ry,l.sweep()),re.build2(l.center,180,360,l.rx,l.ry,l.sweep())]):l instanceof Ae?Ce.build7(l.clip(.5)):null;let u=s.map(p=>new C6(p)),c=u[u.length-1];for(u.forEach(p=>{p.connect(c),c=p});!c.isVisited;){let p=function(){c.next.connect(b),c=c.next,c.isConnected=!1,c.isVisited=!1},g=function(){c.connect(b.prev),c.isConnected=!1},b=c.prev;if(c===b)break;let v=c.pt,w=b.pt,P=w.end();if(!c.isConnected&&!P.equals(v.start())){let _=function(I){c.isConnected=!0,c.pt=v=I,c.next.isVisited=!1},B=function(I){c.isConnected=!0,b.pt=I,b.isVisited=!1,c=b};if(v instanceof Y)if(f(P,v.end())){p();continue}else _(new Y(P,v.end()));else if(w instanceof Y){f(w.start(),v.start())?g():B(new Y(w.start(),v.start()));continue}else if(v instanceof Ae)if(f(P,v.end())&&!(v.controls.length!==2&&v.getToLineMaxDis2(v.startToEndL)>=n)){p();continue}else _(new Ae([P,...v.controls.slice(1)]));else if(w instanceof Ae)f(w.start(),v.start())&&!(w.controls.length!==2&&w.getToLineMaxDis2(w.startToEndL)>=n)?g():B(new Ae([...w.controls.slice(0,-1),v.start()]));else if(v instanceof re&&w instanceof re)if(Math.abs(Math.abs(v.sweepAngle)-180)<Math.abs(Math.abs(w.sweepAngle)-180)){let I=re.build5(P,v.end(),v.sweepAngle);if(f(I.start(),I.end())&&!(I.rx>=e&&Math.abs(I.sweepAngle)>180)){p();continue}else _(I)}else{let I=re.build5(w.start(),v.start(),w.sweepAngle);f(I.start(),I.end())&&!(I.rx>=e&&Math.abs(I.sweepAngle)>180)?g():B(I);continue}else throw new Error("not support")}if(et(v,v.start()).dot(et(w,w.end()))<0){let _=function(C,N,A,M){if(c.next===b){c=null;return}let{rebuildLinkLine:S,rebuildPrevPt:$,rebuildNextPt:H}=Yy(C,N,A);!!$&&!!H&&(M.pt=S,$!==C&&(b.prev.pt=$),H!==A&&(c.next.pt=H))},B=function(){c.next===b?c=null:(c.next.connect(b.prev),c=c.next,c.isConnected=!1,c.isVisited=!1)},I=ei(w.reverse(),v);if(I===0){let C=Xy(v,w.start(),v.end());if(m(C)){let N=b.prev.pt,A=c.next.pt;if(et(A,A.start()).dot(et(N,N.end()))>=0){if(B(),!c)break;continue}if(_(N,C instanceof Y?C:new Y(C.start(),C.end()),A,c),!c)break}else c.pt=C;g();continue}else if(I===1){let C=Xy(w,w.start(),v.end());if(m(C)){let N=b.prev.pt,A=c.next.pt;if(et(A,A.start()).dot(et(N,N.end()))>=0){if(B(),!c)break;continue}if(_(N,C instanceof Y?C:new Y(C.start(),C.end()),A,b),!c)break}else b.pt=C;p();continue}else if(I===2){if(B(),!c)break;continue}}c.isVisited=!0,c=c.next}if(!c)return null;s.length=0;let h=c;for(s.push(c.pt),c=c.next;c!==h;)s.push(c.pt),c=c.next;if(s.length===1){let p=s[0];return p instanceof re?(f(p.start(),p.end())?s[0]=re.buildCircle(p.center,p.rx,p.sweep()):s.push(new Y(p.end(),p.start())),Ce.build7(s)):p instanceof Ae?(f(p.start(),p.end())||s.push(new Y(p.end(),p.start())),Ce.build7(s)):null}if(r=Ce.build7(s),Math.abs(r.area(.1))<n)return null;return r;function f(p,g){return p.distance2(g)<n}function d(p,g){if(Math.abs(p.sweepAngle)>t){let b=p.sweepAngle/2;d(re.build3(p.center,p.startAngle,b,p.rx,p.ry),g),d(re.build3(p.center,p.startAngle+b,b,p.rx,p.ry),g)}else g.push(p)}function m(p){return p.start().distance2(p.end())<n&&!(p instanceof re&&p.rx>=e&&Math.abs(p.sweepAngle)>180||p instanceof Ae&&p.controls.length!==2&&p.getToLineMaxDis2(new Y(p.start().add1(1,0),p.end()))>=n)}}function wo(r,e){if(!r)return!0;let t=r.start(),n=r.end();if(t.distance2(n)<e**2)if(r instanceof re){if(!(r.rx>=e&&Math.abs(r.sweepAngle)>180))return!0}else if(r instanceof Ae){if(!(r.controls.length!==2&&r.getToLineMaxDis2(new Y(r.start().add1(1,0),r.end()))>=e))return!0}else return!0;return!1}function ga(r){if(r.direct.x===0&&r.direct.y===0)throw Error("getEndOfExtendLine(line: Line, distance: number)");let e={x:r.direct.normalize().x*ke,y:r.direct.normalize().y*ke},t=r.end();return new q(t.x+e.x,t.y+e.y)}function Yy(r,e,t){if(r instanceof Y){let n=ga(e.reverse());e=new Y(n,e.end());let i=new Y(r.start(),n);r=wo(i,ke)?null:i}else if(t instanceof Y){let n=ga(e);e=new Y(e.start(),n);let i=new Y(n,t.end());t=wo(i,ke)?null:i}else if(r instanceof Ae){let n=ga(e.reverse());e=new Y(n,e.end());let i=new Ae([...r.controls.slice(0,-1),n]);r=wo(i,ke)?null:i}else if(t instanceof Ae){let n=ga(e);e=new Y(e.start(),n);let i=new Ae([n,...t.controls.slice(1)]);t=wo(i,ke)?null:i}else if(r instanceof re&&t instanceof re)if(Math.abs(Math.abs(r.sweepAngle)-180)<Math.abs(Math.abs(t.sweepAngle)-180)){let n=ga(e.reverse());e=new Y(n,e.end());let i=re.build5(r.start(),n,r.sweepAngle);r=wo(i,ke)?null:i}else{let n=ga(e);e=new Y(e.start(),n);let i=re.build5(n,t.end(),t.sweepAngle);t=wo(i,ke)?null:i}else throw new Error("not supported");return{rebuildPrevPt:r,rebuildNextPt:t,rebuildLinkLine:e}}function Xy(r,e,t){if(r instanceof Y||e.distance2(t)<=Dr)return new Y(e,t);if(r instanceof re)return re.build2(r.center,e.angleD(r.center),t.angleD(r.center),r.rx,r.ry,r.isCCW?1:0);if(r instanceof Ae){let n=r.getPercent(e,ke),i=r.getPercent(t,ke);return r.clip(n)[1].clip((i-n)/(1-n))[0]}else throw new Error("not supported operation")}var C6=class{constructor(r){this.pt=r}connect(r){this.prev=r,r.next=this}};function Vy(r){let e=xa(),t=si(r);return Gr.preprocessPolyline+=ji(e),t}var Gr={addDocShapes2RTree:0,getPour:0,prepare:0,getSinglePourLayerPolyline:0,combindOutlines:0,mergeSameNet:0,run:0,end:0,deSelfIntersection:0,changeDirect:0,extend:0,preprocessPolyline:0,runBoolean:0,IntersectionSeeker:0,BooleanTools:0,totalBool:0};function xa(){return{timeIndex:Object.assign({},Gr),start:performance.now()}}function Wy(r){return Object.values(r).reduce((e,t)=>e+t,0)}function ji(r){return performance.now()-r.start-(Wy(Gr)-Wy(r.timeIndex))}function M6(r){let e={};for(let t of Object.keys(Gr))e[t]=Gr[t]-r.timeIndex[t];return e}var lh=new Error("list is empty"),uh=class{constructor(r,e){this.prev=null,this.next=null,this.parent=r,this.item=e}insertAfter(r){r.next=this.next,this.next=r,r.prev=this,r.next!==null&&(r.next.prev=r)}insertBefore(r){r.prev=this.prev,this.prev=r,r.next=this,r.prev!==null&&(r.prev.next=r)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(r){this.item=r}},N6=class{constructor(r){this._next=r}hasNext(){return this._next!==null}next(){let r=this._next;if(r!==null)return this._next=r.next,r.item;throw new Error("iterator is null")}},R6=class{constructor(r){this._next=r}hasNext(){return this._next!==null}next(){let r=this._next;if(r!==null)return this._next=r.next,r;throw new Error("iterator is null")}},L6=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(r){return this.addLast(r)}push(r){return this.addLast(r)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let r=this.first;if(r===null)throw lh;return this.remove(r),r.item}removeLast(){let r=this.last;if(r===null)throw lh;return this.remove(r),r.item}addLast(r){if(this.first===null||this.last===null){let e=new uh(this,r);return this.first=e,this.last=e,this.cnt++,e}else return this.insertAfter(this.last,r)}addFirst(r){if(this.first===null||this.last===null){let e=new uh(this,r);return this.first=e,this.last=e,this.cnt++,e}else return this.insertBefore(this.first,r)}getFirst(){if(this.first===null)throw lh;return this.first.item}getLast(){if(this.last===null)throw lh;return this.last.item}insertAfter(r,e){let t=new uh(this,e);return r.insertAfter(t),r===this.last&&(this.last=t),this.cnt++,t}insertBefore(r,e){let t=new uh(this,e);return r.insertBefore(t),r===this.first&&(this.first=t),this.cnt++,t}remove(r){r.remove(),r===this.first&&(this.first=r.next),r===this.last&&(this.last=r.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new N6(this.first)}listIterator(){return new R6(this.first)}toArray(){let r=new Array,e=this.first;for(;e!=null;)r.push(e.item),e=e.next;return r}};function Em(r,e){O6(r.iterator(),e)}function O6(r,e){let t=0;for(;r.hasNext();){let n=r.next();e(t++,n)}}var k6=class{constructor(r){this.lst=r}iterator(){return new $y(this.lst)}},$y=class{constructor(r){this.idx=-1,this.lst=r}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function Fle(r){return new k6(r)}function qle(r){return new $y(r)}var ch=new Error("list is empty"),hh=class{constructor(r,e){this.prev=null,this.next=null,this.parent=r,this.item=e}insertAfter(r){r.next=this.next,this.next=r,r.prev=this,r.next!==null&&(r.next.prev=r)}insertBefore(r){r.prev=this.prev,this.prev=r,r.next=this,r.prev!==null&&(r.prev.next=r)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(r){this.item=r}},U6=class{constructor(r){this._next=r}hasNext(){return this._next!==null}next(){let r=this._next;if(r!==null)return this._next=r.next,r.item;throw new Error("iterator is null")}},D6=class{constructor(r){this._next=r}hasNext(){return this._next!==null}next(){let r=this._next;if(r!==null)return this._next=r.next,r;throw new Error("iterator is null")}},Eo=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(r){return this.addLast(r)}push(r){return this.addLast(r)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let r=this.first;if(r===null)throw ch;return this.remove(r),r.item}removeLast(){let r=this.last;if(r===null)throw ch;return this.remove(r),r.item}addLast(r){return this.first===null||this.last===null?(this.first=new hh(this,r),this.last=this.first,this.cnt=1,this.first):this.insertAfter(this.last,r)}addFirst(r){if(this.first===null||this.last===null){let e=new hh(this,r);return this.first=e,this.last=e,this.cnt++,e}else return this.insertBefore(this.first,r)}getFirst(){if(this.first===null)throw ch;return this.first.item}getLast(){if(this.last===null)throw ch;return this.last.item}insertAfter(r,e){let t=new hh(this,e);return r.insertAfter(t),r===this.last&&(this.last=t),this.cnt++,t}insertBefore(r,e){let t=new hh(this,e);return r.insertBefore(t),r===this.first&&(this.first=t),this.cnt++,t}remove(r){r.remove(),r===this.first&&(this.first=r.next),r===this.last&&(this.last=r.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new U6(this.first)}listIterator(){return new D6(this.first)}toArray(){let r=new Array(this.cnt),e=this.first,t=0;for(;e!=null;)r[t]=e.item,e=e.next,t++;return r}};function _m(r){throw new Error("")}var dh=class{constructor(r,e){this.node1=null,this.node2=null,this.key=r,this.value=e}},G6=class{constructor(r){this.itors=r}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().key}},F6=class{constructor(r){this.itors=r}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().value}},fh=class{constructor(){this.innerList=new Eo,this.innerMap={}}replace(r,e){r.node1!==null&&(r.node1.set(e),e.node1=r.node1),r.node2!==null&&(r.node2.set(e),e.node2=r.node2)}clear(){this.innerList.clear();for(let r in this.innerMap)delete this.innerMap[r]}put(r,e){let t=r.hashCode(),n=new dh(r,e),i=this.innerMap[t];if(i===void 0)return n.node1=this.innerList.add(n),this.innerMap[t]=n,null;if(i instanceof dh){if(i.key.equals(r))return this.innerMap[t]=n,this.replace(i,n),i.value;{n.node1=this.innerList.add(n);let s=new Eo;return i.node2=s.add(i),n.node2=s.add(n),this.innerMap[t]=s,null}}if(i instanceof Eo){let s=null;return Em(i,(o,a)=>a.key.equals(r)?(this.replace(a,n),s=a.value,!1):!0),s===null?(n.node1=this.innerList.add(n),n.node2=i.push(n),null):s}return _m(i)}get(r){let e=r.hashCode(),t=this.innerMap[e];if(t===void 0)return null;if(t instanceof dh)return t.key.equals(r)?t.value:null;if(t instanceof Eo){let n=null;return Em(t,(i,s)=>s.key.equals(r)?(n=s.value,!1):!0),n}return _m(t)}containsKey(r){return this.get(r)!==null}delete(r){r.node1!==null&&r.node1.parent.remove(r.node1),r.node2===null?delete this.innerMap[r.key.hashCode()]:r.node2.parent.remove(r.node2)}remove(r){let e=r.hashCode(),t=this.innerMap[e];if(t===void 0)return null;if(t instanceof dh)return t.key.equals(r)?(this.delete(t),t.value):null;if(t instanceof Eo){let n=null;return Em(t,(i,s)=>s.key.equals(r)?(n=s.value,this.delete(s),!1):!0),n}return _m(t)}computeIfAbsent(r,e){let t=this.get(r);if(t===null){let n=e(r);return this.put(r,n),n}else return t}size(){return this.innerList.size()}isEmpty(){return this.innerList.size()===0}keys(){return new G6(this.innerList.iterator())}values(){return new F6(this.innerList.iterator())}entries(){return this.innerList.iterator()}},q6=class{constructor(){this.points=[],this.lines=[],this.arcs=[],this.beziers=[],this.listText=[],this.fonts=[]}addPt(r,e=!0){if(r instanceof Y)this.lines.push(r);else if(r instanceof re)this.arcs.push(r);else if(r instanceof Ae)this.beziers.push(r);else throw new Error("not support");e&&this.points.push(r.start())}addPoint(r){this.points.push(r)}addText(r,e,t=1,n=.1,i=!0){this.listText.push({pos:r,str:e,size:t,width:n}),i&&this.points.push(r)}addPly(r,e=!0){r.primitives.forEach(t=>this.addPt(t,e))}build(){let r=[],e=[],t=[],n=[],i=[],s=[];return this.points.forEach(o=>r.push(o.x,o.y)),this.lines.forEach(o=>e.push(o.start().x,o.start().y,o.end().x,o.end().y)),this.arcs.forEach(o=>t.push(o.center.x,o.center.y,o.rx,Xe.toRadians(o.startAngle),Xe.toRadians(o.endAngle()),o.sweep())),this.beziers.forEach(o=>{o.controls.forEach(a=>{n.push(a.x,a.y)}),n.push("end")}),this.listText.forEach(o=>i.push(o.pos.x,o.pos.y,o.str,o.width,o.size)),this.fonts.forEach(o=>s.push(o)),{points:r,lines:e,arcs:t,texts:i,beziers:n,fonts:s}}},ba=class{constructor(r){this.map=new fh,this.bus=r}initColor(r){return this.map.computeIfAbsent(r,()=>new q6)}draw(){let r={},e=this.map.entries();for(;e.hasNext();){let t=e.next();r[t.key.toString()]=t.value.build()}this.bus.publish("/debug/draw",r)}clear(){this.map.clear()}},Pm=class Om{constructor(e,t,n,i,s){this.inters=[],this.allInterIsInvalid=!0,this.isVisit=!1,this.sides=e,this.isGroup1=n,this.isOutside=i,this.finalIsOutside=i,this.polyline=t,s&&(this.polygon=s),e.forEach(o=>o.outline=this)}static build(e,t,n,i,s){let o=e.primitives.map(l=>new Zl(l,i)),a=o[o.length-1];return o.forEach(l=>{a.connect(l),a=l}),s?new Om(o,e,t,n,s):new Om(o,e,t,n)}setFinalIsOutSide(e){this.finalIsOutside=e}startAndEndIsSameOutsideFlag(){return this.isOutside===this.finalIsOutside}get hasInter(){return!!this.interOutlines}isAllInterIsInvalid(){return this.allInterIsInvalid}setAllInterIsInvalidToFalse(){this.allInterIsInvalid=!1}resetVisited(){this.isVisit=!1}intersect(e,t){if(!(e.interOutlines&&e.interOutlines===this.interOutlines))if(e.interOutlines)if(this.interOutlines){let n,i;this.interOutlines.length>e.interOutlines.length?(n=this.interOutlines,i=e.interOutlines):(n=e.interOutlines,i=this.interOutlines),i.forEach(s=>{n.push(s),s.interOutlines=n}),t.delete(i)}else e.interOutlines.push(this),this.interOutlines=e.interOutlines;else this.interOutlines?(this.interOutlines.push(e),e.interOutlines=this.interOutlines):(e.interOutlines=this.interOutlines=[this,e],t.add(this.interOutlines))}isContain(e){if(!this.polyline.bbox().extendOfSize(ke).isContainsBBox(e.polyline.bbox()))return!1;let t=e.polyline.primitives[0].start();if(e.hasInter&&e.isAllInterIsInvalid()){let n=e.inters[0];n.getBindedInter().side.outline!==this?t=n.side.getCenterPoint():t=n.side.getCenterPoint(n.coord)}return!!this.polyline.getWindingNum(t)}isInternally(e){return!!this.polyline.getWindingNum(e)}isEqual(e){return this.polyline===e.polyline}bbox(){return this.polyline.bbox()}reverse(){this.sides.reverse();let e=this.sides[this.sides.length-1];this.sides.forEach(t=>{t.reverse(),e.connect(t),e=t})}returnPolyline(){let e=this.sides.map(n=>n.getShape()),t=this.polyline.primitives;if(this.sides.length===t.length){let n=new Set(t);if(!e.some(i=>!n.has(i)))return this.polyline}return Ce.build7(e)}};function z6(r,e){let t=r.bbox(),n=e.bbox(),i=(t.minY+t.maxY)/2,s=(n.minY+n.maxY)/2;return i-s}function Y6(r,e){let t=r.bbox(),n=e.bbox(),i=(t.minX+t.maxX)/2,s=(n.minX+n.maxX)/2;return i-s}var ya=class{constructor(r){if(this.__bbox=null,typeof r<"u")if(r instanceof Array){this.__items=[];for(let e of r)this.add(e)}else this.__items=r,this.__bbox=r.bbox();else this.__items=[]}add(r){if(this.__items instanceof Array)this.__items.push(r),this.__bbox=ye.extend2(this.__bbox,r.bbox());else throw new Error("can't insert multiple item into leaf node")}items(){return this.__items}bbox(){if(this.__bbox!==null)return this.__bbox;throw new Error("bug")}},ph=class{constructor(r){this.changed=!1,this.root=new ya,this.capacity=r,this.capacity2=r*r,this.itemList=[]}size(){return this.itemList.length}items(){return this.flushWhenNeed(),this.itemList}add(r){this.itemList.push(r),this.changed=!0}remove(r){Sr.remove(this.itemList,r),this.changed=!0}clear(){this.changed=!1,this.root=new ya,this.itemList.length=0}flushWhenNeed(){if(this.changed){let r=new Array;for(let e of this.itemList)r.push(new ya(e));for(;;){let e=this.organize(r);if(e.length>1)r=e;else break}this.root=new ya(r),this.changed=!1}}organize(r){Xi(r,Y6,0,r.length);let e=r.length,t=[];for(let n=0;n<e;)if(n+this.capacity2<=e){let i=n+this.capacity2;Xi(r,z6,n,i);for(let s=n;s<i;s+=this.capacity){let o=new ya(r.slice(s,s+this.capacity));t.push(o)}n=n+this.capacity*this.capacity}else{let i=new ya(r.slice(n,n+this.capacity));t.push(i),n=n+this.capacity}return t}search(r){this.flushWhenNeed();let e=[],t=[];for(t.push(this.root);;){let n=t.shift();if(typeof n<"u"){let i=n.items();if(i instanceof Array){for(let s of i)if(!r.isSeparated(s.bbox())){let o=s.items();o instanceof Array?t.push(s):e.push(o)}}else r.isSeparated(n.bbox())||e.push(i)}else break}return e}walker(r){this.flushWhenNeed(),this._walker(this.root,0,r)}_walker(r,e,t){this.flushWhenNeed();let n=r.items();if(n instanceof Array)for(let i of n)this._walker(i,e+1,t);else t(n,e)}bbox(){return this.flushWhenNeed(),this.root.bbox()}},X6=(r=>(r[r.DEBUG=0]="DEBUG",r[r.INFO=1]="INFO",r[r.WARNING=2]="WARNING",r[r.ERROR=3]="ERROR",r[r.DUMMY=4]="DUMMY",r))(X6||{});function V6(r){switch(r){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var W6=(r,e)=>{r===3?console.error(e):console.log(e)},$6=(r,e)=>ca.format("%s %s: %s",new Date,V6(r),e),Sm=(Is=class{constructor(e,t=W6,n=$6){this.debug=!1,this.level=e,this.writer=t,this.fmt=n}static mix(...e){let t=4;for(let n of e)n.level<t&&(t=n.level);return new Is(t,(n,i)=>{for(let s of e)s.write1(n,i)},(n,i)=>i)}wrap(e=null,t=null){let n=e===null?this.fmt:(s,o)=>(o=e(s,o),this.fmt(s,o)),i=t===null?this.writer:(s,o)=>{t(s,o),this.writer(s,o)};return new Is(this.level,i,n)}chain(e){return e.wrap(this.fmt.bind(this),this.writer.bind(this))}include(e){return this.level<=e}write3(e,t,n){this.include(e)&&this.writer(e,this.fmt(e,ca.format(t,...n)))}write2(e,t){this.include(e)&&(t instanceof Error?this.writer(e,this.fmt(e,t.stack)):this.writer(e,this.fmt(e,t.toString())))}write1(e,t){this.include(e)&&this.writer(e,this.fmt(e,t))}debug3(e,...t){this.write3(0,e,t)}debug2(e){this.write2(0,e)}debug1(e){this.write1(0,e)}info3(e,...t){this.write3(1,e,t)}info2(e){this.write2(1,e)}info1(e){this.write1(1,e)}warning3(e,...t){this.write3(2,e,t)}warning2(e){this.write2(2,e)}warning1(e){this.write1(2,e)}error3(e,...t){this.write3(3,e,t)}error2(e){this.write2(3,e)}error1(e){this.write1(3,e)}},(()=>{Is.DUMMY=new Is(4)})(),Is),jy=!1,Hy=class{onRTreeBBox(r){}onResultSide(r){}onOriginSide(r){}onSplitedSide(r){}onDebugSide(r){}onSweep(r,e,t,n,i,s){}onIntersect(r,e,t){}onSegment(r,e,t,n,i,s){}onSegment1(r,e,t){if(jy){let n=new q(r.getX(t),t),i=new q(e.getX(t),t);this.onSegment(n,r.weight,r,i,e.weight,e)}else this.onSegment(r.start,r.weight,r,e.end,e.weight,e)}onSweep1(r,e,t){if(jy){let n=new q(r.getX(t),t),i=new q(e.getX(t),t);this.onSweep(n,r.weight,r,i,e.weight,e)}else this.onSweep(r.start,r.weight,r,e.end,e.weight,e)}},Zy=class extends Hy{constructor(r){super(),this.plGrps=new Array,this.debug=r}onPolylineGroup(r,e){this.plGrps.push(r)}},Kl=class{constructor(r){this.cache={},this.levels=r,this.result=new Array(r),this.weights=new Array(r),this.maxIdx=r-1,this.rule=this.decide.bind(this);let e=1;for(let t=0;t<r;t++)this.weights[t]=e,e*=50}weight(r){return this.weights[r]}decide(r){r=Math.abs(r);let e=this.cache[r];if(e===void 0){let t=r;for(let n=this.maxIdx;n>=0;n--){let i=this.weights[n],s=r/i|0,o=r%i;o>(i/2|0)?(r=i-o,s++):r=o,this.result[n]=s>0}e=this.decide1(this.result),this.cache[t]=e}return e}},Ky=r=>r!==0,j6=r=>r>0,zle=r=>r<0,Yle=r=>r%2!==0,H6=new class extends Kl{decide1(r){return r[0]||r[1]}}(2),Z6=new class extends Kl{decide1(r){return r[0]&&!r[1]}}(2),K6=new class extends Kl{decide1(r){return r[0]&&r[1]}}(2),Q6=new class extends Kl{decide1(r){return r[0]&&!r[1]||!r[0]&&r[1]}}(2),J6=(r=>(r[r.UNMARKED=0]="UNMARKED",r[r.INSIDE=1]="INSIDE",r[r.OUTSIDE=2]="OUTSIDE",r[r.INVALID=3]="INVALID",r))(J6||{}),va=class Pa{constructor(e,t,n,i,s,o,a){this.inters=[],this.connect=new Array,this.previous=null,this.next=null,this.finalGrp=-1,this.trans=NaN,this.outsideWeight=0,this.insideWeight=0,this.invalidWeight=0,this._confidence=0,this._confidence_y=NaN,this._x=NaN,this._x_y=NaN,this.status=0,this.bo=e,this.shape=t,this.baseWeight=n,i.y>s.y?this.weight=-n:i.y==s.y?this.weight=0:this.weight=n,this.start=i,this.end=s,this.polyGrp=o,this.polyIndex=a,this._bbox=new Oe().ext1(t.bbox()).ext2(i).ext2(s).build1(),this.inters.push(i),this.inters.push(s);let l=31,u=1;u=l*u+this.polyGrp,u=l*u+this.polyIndex,this._hashcode=u}static rebuild(e,t,n){if(e instanceof Y||t.distance2(n)<1e-6)return new Y(t,n);if(e instanceof re){let i=e,s=e.bbox().center().x,o;t.y>n.y?o=s>i.center.x?0:1:o=s>i.center.x?1:0;let a=t.angleD(i.center),l=n.angleD(i.center);return re.build2(i.center,a,l,i.rx,i.ry,o)}else throw new Error("not supported operation")}updateBbox(){this._bbox=new Oe().ext2(this.start).ext2(this.end).build1()}is(e,t){return e===this.polyGrp&&t===this.polyIndex}confidence(e){if(this._confidence_y!=e){let t=this._bbox.height();if(t!==0)if(Math.abs(e-this._bbox.maxY)>5e-4&&Math.abs(e-this._bbox.minY)>5e-4){let n=1-Math.abs(2*e-this._bbox.maxY-this._bbox.minY)/t;this._confidence=n*1e4|0}else this._confidence=0;else this._confidence=1;this._confidence_y=e}return this._confidence}needCountWeight(){return this.outsideWeight+this.insideWeight+this.invalidWeight<5e3}revokeOutside(e){let t=this.confidence(e);return this.outsideWeight-=t,this.invalidWeight+=t,t}revokeInside(e){let t=this.confidence(e);return this.insideWeight-=t,this.invalidWeight+=t,t}setOutside(e){let t=this.confidence(e);return this.outsideWeight+=t,t}setInside(e){let t=this.confidence(e);return this.insideWeight+=t,t}setInvalid(e){let t=this.confidence(e);return this.invalidWeight+=t,t}prevNot0(){let e=this.previous;for(;e!=null&&e!=this;){if(e.weight!=0)return e;e=e.previous}return null}nextNot0(){let e=this.next;for(;e!=null&&e!=this;){if(e.weight!=0)return e;e=e.next}return null}getX(e){if(this.bo!==null)return(this._x_y!=e||isNaN(this._x))&&(eG(this,e)>0?this._x=V[0]:this._x=NaN,this._x_y=e),this._x;throw new Error("not supported operation")}voteStatus(){return this.outsideWeight>this.insideWeight&&this.outsideWeight>this.invalidWeight?2:this.insideWeight>this.outsideWeight&&this.insideWeight>this.invalidWeight?1:this.invalidWeight>this.outsideWeight&&this.invalidWeight>this.insideWeight?3:0}reverse(e){if(e===2)if(this.start.y>this.end.y){let t=Pa.rebuild(this.shape,this.end,this.start),n=new Pa(this.bo,t,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return Sr.addAll(n.connect,this.connect),n}else return this;else if(e===1)if(this.start.y<this.end.y){let t=Pa.rebuild(this.shape,this.end,this.start),n=new Pa(this.bo,t,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return Sr.addAll(n.connect,this.connect),n}else return this;return this}isNeedScan(e){return this.needCountWeight()&&this.confidence(e)>0}hashCode(){return this._hashcode}equals(e){return e instanceof Pa?!(this.polyGrp!==e.polyGrp||this.polyIndex!==e.polyIndex):!1}bbox(){return this._bbox}toString(){return la.format("(%d,%d,%d) (%d,%d,%d) %s %s",this.polyGrp,this.polyIndex,this.weight,this.outsideWeight,this.invalidWeight,this.insideWeight,this.start,this.end)}},wa=class{constructor(){this.innerMap=new fh}add(r){return this.innerMap.put(r,!0)!==!0}remove(r){this.innerMap.remove(r)}contains(r){return this.innerMap.get(r)===!0}iterator(){return this.innerMap.keys()}addAll(r){let e=r.iterator();for(;e.hasNext();)this.add(e.next())}size(){return this.innerMap.size()}clear(){let r=this.iterator();for(;r.hasNext();){let e=r.next();this.remove(e)}}},Qy=Sr.funcCopy(Xi);function eG(r,e){let t=0;if(Math.abs(r.start.y-e)<=1e-4)V[t++]=r.start.x;else if(Math.abs(r.end.y-e)<=1e-4)V[t++]=r.end.x;else if(r.shape instanceof Y)t=yy(r.shape,e);else if(r.shape instanceof re)t=vy(r.shape,e);else throw new Error("not supported operation");return t}var mh=class{constructor(r,e,t,n){this.sides=new Array,this.loader=r,this.loader.bo=this,this.logger=t,this.rule=e,this.event=n}static sortByBBoxMinY(r,e){return r.bbox().minY-e.bbox().minY}static sortByBBoxAreaDesc(r,e){return e.bbox().area()-r.bbox().area()}addPolyline(r,e=1,t=.01,n=!0){for(let i of this.loader.buildGroup(r,e,t,n))this.sides.push(i),this.event.onOriginSide(i)}buildRTree(){let r=new ph(10);for(let e of this.sides)r.add(e);return r}fillValidSides(r,e,t){for(let n of e)isFinite(n.getX(t))&&r.push(n)}getSortedEndpointsLineAsc(r){let e=new Array;for(let i of r)i.needCountWeight()&&(e.push(i.start),e.push(i.end));Qy(e,q.sortByYAsc,0,e.length);let t=new Array,n=Number.NEGATIVE_INFINITY;for(let i of e){let s=i.y;s>n&&(t.push(s),n=s)}return t}splitSides(r,e,t){let n=r.start,i=r.end,s=new q(i.x+(n.x-i.x)*2,i.y+(n.y-i.y)*2);Qy(r.inters,(a,l)=>a.distance2(s)-l.distance2(s),0,r.inters.length);let o=null;for(let a of r.inters)if(o==null)a.equals(n)&&(o=a);else if(!a.equals(o)){let l=va.rebuild(r.shape,o,a);l instanceof re&&Math.abs(l.sweepAngle)>190&&(l=new Y(o,a));let u=new va(this,l,r.baseWeight,o,a,r.polyGrp,t++);if(e.push(u),u.updateBbox(),a.equals(i))break;o=a}return t}splitSidesByInters(){let r=new Array;for(let e of this.sides)if(e.polyIndex==0){let t=0,n=null,i=null;do{let s=new Array;t=this.splitSides(e,s,t);for(let o of s)n!=null?(n.next=o,o.previous=n):i=o,n=o,this.event.onSplitedSide(o),r.push(o);if(e.next===null)throw new Error("not supported operation");e=e.next}while(e.polyIndex!==0);i!=null&&n!=null&&(i.previous=n,n.next=i)}this.sides.length=0;for(let e of r)this.sides.push(e)}seekIntersection(){if(this.sides.length>0){let r=this.buildRTree(),e=new wa;for(let t of this.sides){e.add(t);let n=t.bbox().extendOfSize(1e-5),i=t.shape instanceof Y;for(let s of r.search(n))if(!e.contains(s)){let o=s.shape instanceof Y;if(!(i&&o&&t.next!==null&&t.previous!==null&&(t.next.equals(s)||t.previous.equals(s)))){let a=bn(t.shape,s.shape);for(let l=0;l<a;l+=2){let u=new q(V[l],V[l+1]);t.inters.push(u),s.inters.push(u),this.event.onIntersect(u,t,s)}}}}}}},tG=class w2{constructor(e){this.sides=new wa,this.others=new wa,this.id=e}add(e){this.sides.add(e),e.finalGrp=this.id;for(let t of e.connect)this.others.add(t)}polyline(){let e=new Array;return ua(this.sides,(t,n)=>(e.push(n.shape),!0)),Ce.build2(e).asClose()}hashCode(){return this.id}equals(e){return e!=null&&e instanceof w2?this.id===e.id:!1}},Jy=class{constructor(r){this.bo=null,this.sides=new Array,this.polyGrp=0,this.polyIndex=0,this.prevSide=null,this.firstSide=null,this.noWeight0=r}completeGroup(r){this.prevSide!=null&&this.firstSide!=null&&!this.prevSide.end.equals(this.firstSide.start)&&this.addSide(new Y(this.prevSide.end,this.firstSide.start),r);let e=new Array,t=null,n=null;for(let i of this.sides)(!this.noWeight0||i.weight!==0)&&(t!=null?(t.next=i,i.previous=t):n=i,t=i,e.push(i));return t!=null&&n!=null&&(n.previous=t,t.next=n),this.polyGrp++,this.sides.length=0,this.prevSide=null,this.firstSide=null,this.polyIndex=0,e}buildGroup(r,e,t,n=!0){for(let i of r.primitives)if(i instanceof Y)this.addSide(i,e);else if(n&&i instanceof re&&i.rx===i.ry)this.addArc(i,e);else{let s=null;for(let o of i.points(t))s!=null&&this.addSide(new Y(s,o),e),s=o}return this.completeGroup(e)}addArc(r,e){let t=r.sweepAngle,n=Xe.regularD(r.startAngle),i=n+t;if(t>0){let s=90;for(;s<=i;)s>n&&(this.addSide(re.build3(r.center,n,s-n,r.rx,r.ry),e),n=s),s+=90;n<i&&this.addSide(re.build3(r.center,n,i-n,r.rx,r.ry),e)}else if(t<0){let s=270;for(;s>=i;)s<n&&(this.addSide(re.build3(r.center,n,s-n,r.rx,r.ry),e),n=s),s-=90;n>i&&this.addSide(re.build3(r.center,n,i-n,r.rx,r.ry),e)}}addSide(r,e){if(r.start().equals(r.end()))return;let t=r.start(),n;this.prevSide!=null?(this.prevSide.end.equals(t)||this.addSide(new Y(this.prevSide.end,t),e),n=new va(this.bo,r,e,r.start(),r.end(),this.polyGrp,this.polyIndex++)):(n=new va(this.bo,r,e,r.start(),r.end(),this.polyGrp,this.polyIndex++),this.firstSide=n),this.prevSide=n,this.sides.push(n)}},e2=class{constructor(r,e,t){this.eps=new Array,this.curWeight=0,this.start=null,this.last=null,this.prevStart=null,this.prevEnd=null,this.y=t,this.rule=r,this.bo=e,this.event=e.event}onEp(r){this.tuningWeight(r),this.start===null?this.rule(this.curWeight)?this.in(r):r.setInvalid(this.y):this.rule(this.curWeight)?r.setInvalid(this.y):this.out(r,this.start),this.last!==null&&this.event.onSweep1(this.last,r,this.y),this.last=r}in(r){this.prevEnd!=null&&this.onSameX(r,this.prevEnd)?(this.start=this.prevStart,this.prevStart=null,this.prevEnd.revokeInside(this.y),this.prevEnd=null):(this.start=r,this.start.setOutside(this.y))}out(r,e){if(this.onSameX(e,r))e.revokeOutside(this.y);else{if(r.setInside(this.y)>0&&e.confidence(this.y)>0){let t=e.voteStatus(),n=r.voteStatus();this.isValid(t)&&this.isValid(n)?t==2&&n==1&&(r.connect.push(e),e.connect.push(r)):(r.connect.push(e),e.connect.push(r))}this.event.onSegment1(e,r,this.y),this.eps.push(e),this.eps.push(r),this.prevStart=e,this.prevEnd=r}this.start=null}isValid(r){return r==1||r==2}onSameX(r,e){return r.bbox().isIntersect(e.bbox())&&ae.eq(r.getX(this.y),e.getX(this.y))}tuningWeight(r){this.curWeight+=r.weight;let e=r.nextNot0(),t=r.prevNot0();e!=null&&r.weight===e.weight&&e.trans===this.y&&(this.curWeight-=r.weight),t!=null&&r.weight===t.weight&&t.trans===this.y&&(this.curWeight-=r.weight),r.trans=this.y}},gh=new Error,t2=new class extends Kl{decide1(r){return r[0]&&r[1]}}(2),rG=new class extends Hy{onPolylineGroup(r,e){throw gh}onSegment(r,e,t,n,i,s){throw gh}},nG=class{constructor(r,e){this.rtree=r,this.level=e}},iG=class E2 extends mh{static isIntersect(e,t,n=Sm.DUMMY){let i=new E2(n),s=i.createGroup1(e.items),o=i.createGroup2(t.items);return s.rtree.itemList.length==0||o.rtree.itemList.length==0?!1:i.isIntersect(s,o)}constructor(e){super(new Jy(!1),t2.rule,e,rG)}createGroup1(e){return this.createGroup(e,0)}createGroup2(e){return this.createGroup(e,1)}createGroup(e,t){let n=t2.weight(t);for(let s of e)this.addPolyline(s,n);let i=this.buildRTree();return this.sides.length=0,new nG(i,t)}isIntersect(e,t){if(e.level!==t.level){let n=e.rtree.bbox().intersection1(t.rtree.bbox());if(n!==null){try{this.inters(e,t);let i=(n.minY+n.maxY)/2;this.sweep(e,t,i)}catch(i){if(i===gh)return!0;throw i}return!1}else return!1}else throw new Error("inersection detection should not in same group")}inters(e,t){if(e.rtree.size()>t.rtree.size()){let n=e;e=t,t=n}for(let n of e.rtree.items()){n.trans=NaN;let i=n.bbox().extendOfSize(1e-5);for(let s of t.rtree.search(i))if(s.trans=NaN,bn(n.shape,s.shape)>0)throw gh}}sweep(e,t,n){let i=ye.extend2(e.rtree.bbox(),t.rtree.bbox()).extendOfSize(1e-5),s=new Array;this.fillValidSides(s,e.rtree.search(i),n),this.fillValidSides(s,t.rtree.search(i),n),Xi(s,(a,l)=>a.getX(n)-l.getX(n),0,s.length);let o=new e2(this.rule,this,n);for(let a of s)o.onEp(a)}},Po=class Qi{constructor(e){this.items=new Array(e.length),Sr.arraycopy(e,0,this.items,0,e.length),this.__bbox=this.calcBBox()}static build1(e){let t=[];return Wc(e,(n,i)=>(t.push(i),!0)),new Qi(t)}static build2(e){let t=e.map(n=>Ce.build8(n));return new Qi(t)}static combinePolylineGroupArr(e){let t=[];for(let n of e)t=t.concat(n.items);return new Qi(t)}calcBBox(){let e=new Oe;for(let t=0;t<this.items.length;t++)e.ext1(this.items[t].bbox());return e.build1()}multiply3(e){let t=new Array(this.items.length);for(let n=0;n<t.length;n++)t[n]=this.items[n].multiply3(e);return new Qi(t)}bbox(){return this.__bbox}asClose(){return this.items.forEach(e=>e.asClose()),this}mirrorY(e){return this.items.forEach(t=>t.mirrorY(e)),this}closeEndpoint(){return this.items.forEach(e=>e.closeEndpoint()),this}get primitives(){return this.items.map(e=>e.primitives).flat(2)}isEqual(e){return e instanceof Qi?this.items.every(t=>e.items.some(n=>n.isEqual(t))):!1}getOutMostPolyline(){return this.items.reduce((e,t)=>t.bbox().area()>e.bbox().area()?t:e,this.items[0])}getOutline(){let e=this.items;if(e.length===1)return{outline:e,hole:new Array};let t=new Set,n=new Set;for(let i=0,s=e.length;i<s;i++){let o=e[i];if(!t.has(o)&&!n.has(o)){i+1>=s&&t.add(o);for(let a=i+1;a<s;a++){let l=e[a];if(!t.has(l)&&!n.has(l)){if(!o.bbox().isInside(l.bbox().extendOfSize(1e-4))&&!l.bbox().isInside(o.bbox().extendOfSize(1e-4)))continue;iG.isIntersect(new Qi([o]),new Qi([l]))&&(o.bbox().area()>l.bbox().area()?(t.add(o),n.add(l)):(t.add(l),n.add(o)))}}!t.has(o)&&!n.has(o)&&t.add(o)}}return{outline:[...t],hole:[...n]}}round(e=4){let t=this.items.map(n=>n.round(e));return new Qi(t)}},sG=Sr.funcCopy(Xi),oG=Sr.funcCopy(Xi),aG=Sr.funcCopy(Xi);function lG(r){return new Array}function Im(r,e){let t=new Zy(!1),n=new r2(r,Sm.DUMMY,t);for(let i of e)n.addPolyline(i);return n.simplify(),t.plGrps}function Xle(r,e){r=r.asClose();let t=Im(Ky,[r]),n=[];for(let i of t)Sr.addAll(n,i.items);if(e>0){for(let i of r.primitives)i instanceof Y&&i.length()<1e-4||n.push(i.stroke(e*2,1,0));return Im(Ky,n)}else if(e<0){e=-e;for(let i of r.primitives)n.push(i.stroke(e*2,1,1));return Im(j6,n)}else return t}var r2=class extends mh{constructor(r,e,t){super(new Jy(!1),r,e,t),this.finalSides=new Array,this.sideGroups={},this.vecSides=new Array,this.scanY=NaN,this.curNetIndex=0,this.curIndex=-1,this.scanLines=0}sweep(r,e,t){this.scanY=NaN,this.scanLines=0,sG(e,mh.sortByBBoxMinY,0,e.length);let n=new Eo;this.curNetIndex=0;let i=Number.POSITIVE_INFINITY;for(let s of r)s>i&&this.scan(n,(i+s)/2,e),i=s;this.getAllMarkPrimitive(t,e),this.logger.debug3("scan %s %d",t,this.scanLines)}simplify(){this.seekIntersection(),this.splitSidesByInters(),this.sweep(this.getSortedEndpointsLineAsc(this.sides),this.sides,!1),this.flipSides(),this.sweep(this.getSortedEndpointsLineAsc(this.vecSides),this.vecSides,!0),this.connectSides(),this.fillResult()}addPolyline(r,e=1,t=.01,n=!0){super.addPolyline(r,e,t,n)}scan(r,e,t){if(this.scanY==e)return;this.scanY=e;let n=!1,i=r.listIterator();for(;i.hasNext();){let s=i.next(),o=s.item;ae.less(o.bbox().maxY,e)?r.remove(s):!n&&o.isNeedScan(e)&&(n=!0)}for(;this.curNetIndex<t.length;){let s=t[this.curNetIndex];if(ae.less(s.bbox().minY,e))ae.greatereq(s.bbox().maxY,e)&&(this.add2AET(r,s),!n&&s.isNeedScan(e)&&(n=!0)),this.curNetIndex++;else break}if(n){this.scanLines++;let s=new e2(this.rule,this,e),o=r.iterator();for(;o.hasNext();){let a=o.next();s.onEp(a)}}}add2AET(r,e){let t=e.bbox().minX,n=e.bbox().maxX,i=e.bbox().minY,s=e.bbox().maxY,o=r.listIterator(),a=null;for(;o.hasNext();){let l,u=o.next(),c=u.item,h=c.bbox().minX,f=c.bbox().maxX;if(n<=h)l=-1;else if(f<=t)l=1;else{let m=c.bbox().minY,p=c.bbox().maxY,g=Math.max(i,m),b=Math.min(s,p);l=this.compareBySweep(e,c,(g+b)/2)}let d=c.shape;if(d instanceof Y&&d.length()<.001&&a==null&&l<0){a=u;continue}if(a!=null&&l<0){r.insertBefore(a,e);return}if(l<0){r.insertBefore(u,e);return}else a=null}r.add(e)}getLineAngle(r){let e=r.start().angle(r.end());return e<0&&(e+=Math.PI),e}getArcAngle(r,e){let t=Math.asin((e-r.center.y)/r.rx);return r.startAngle>90&&r.startAngle<270&&(t=-t),t<0&&(t+=Math.PI),(t+Math.PI/2)%Math.PI}compareArcLine(r,e,t){let n=this.getArcAngle(r,t),i=this.getLineAngle(e);return ae.eq(n,i)?-r.sweepAngle:i-n}compareBySweep(r,e,t){let n=r.getX(t);if(!isFinite(n))return 0;let i=e.getX(t);if(!isFinite(i))return 0;if(!ae.eq(n,i))return n-i;if(r.shape instanceof Y)return e.shape instanceof Y?this.getLineAngle(e.shape)-this.getLineAngle(r.shape):-this.compareArcLine(e.shape,r.shape,t);if(e.shape instanceof Y)return this.compareArcLine(r.shape,e.shape,t);{let s=r.shape,o=e.shape,a=this.getArcAngle(s,t),l=this.getArcAngle(o,t);return ae.eq(a,l)?s.sweepAngle*o.sweepAngle<=0?s.sweepAngle<=0?1:-1:s.sweepAngle>0?s.rx-o.rx:o.rx-s.rx:l-a}}getAllMarkPrimitive(r,e){for(let t of e)if(t.status===0&&t.bbox().height()!=0){let n=t.voteStatus();if(n===2||n===1){t.status=n;let i=t.reverse(n);if(r){this.event.onResultSide(i);let s=i.shape.multiply3(qe.ROT_N90),o=i.start.multiply3(qe.ROT_N90),a=i.end.multiply3(qe.ROT_N90);i=new va(this,s,i.baseWeight,o,a,i.polyGrp,i.polyIndex)}this.finalSides.push(i),this.event.onResultSide(i)}}}flipSides(){for(let r of this.sides)if(r.polyIndex==0){let e=null,t=null;do{let n=r.shape.multiply3(qe.ROT_90),i=r.start.multiply3(qe.ROT_90),s=r.end.multiply3(qe.ROT_90),o=new va(this,n,r.baseWeight,i,s,r.polyGrp,r.polyIndex);if(o.outsideWeight=r.outsideWeight,o.insideWeight=r.insideWeight,o.invalidWeight=r.invalidWeight,o.status=r.status,e!=null?(e.next=o,o.previous=e):t=o,this.vecSides.push(o),this.event.onSplitedSide(o),e=o,r.next!==null)r=r.next;else break}while(r.polyIndex!=0);t!=null&&(t.previous=e,e.next=t)}}canBeEnd(r,e){if(r.size()==1){let t=r.getFirst().shape;if(t instanceof re){if(e&&t.rx<=e)return!1}else if(t instanceof Y&&e&&t.length()<=e)return!1}return!0}connectSides(){let r=new fh,e=new ph(10);for(let s of this.finalSides)r.computeIfAbsent(s.start,lG).push(s),e.add(s.start);let t=0,n=new wa,i=new Array;for(let s of this.finalSides)if(!n.contains(s)){let o=new wa,a=s.start,l=new Eo;l.add(s),n.add(s);let u=s.end;for(;l.size()>0;)if(this.isStart(a,u)&&this.canBeEnd(l,.01)){l.size()>1&&this.fillSideGroups(l,t++);break}else{let c=r.get(u),h=this.findNext(n,c);if(h==null&&(u=this.findNeigber(u,o,e,.01),u!==null&&(c=r.get(u),h=this.findNext(n,c))),h!=null)l.add(h),n.add(h),u=h.end;else if(u!=null?o.add(u):(i.length==0&&l.size()>1&&this.logger.warning3("unable to connect at %s",l.getLast()),i.push(l.removeLast())),l.size()>0)u=l.getLast().end;else break}}}fillSideGroups(r,e){let t=new tG(e);ua(r,(n,i)=>(t.add(i),!0)),this.sideGroups[t.id]=t}isStart(r,e){return r.distance2(e)<=1e-4}findNext(r,e){if(e!=null){for(let t of e)if(!r.contains(t))return t}return null}fillResult(){let r=0,e=new fh;for(let n in this.sideGroups){let i=this.sideGroups[n];ua(i.sides,(s,o)=>(o.polyGrp!=-2&&e.put(o,o),!0))}let t=new wa;for(let n in this.sideGroups){let i=this.sideGroups[n];if(t.add(i)){let s=0,o=new Array;for(o.push(i);s<o.length;){let l=o[s],u=new Array;ua(l.others,(h,f)=>{let d=e.get(f);return d!=null&&u.push(d.finalGrp),!0}),oG(u,Sr.sortAsc,0,u.length);let c=l.id;for(let h of u)if(h!=c&&h!=l.id){let f=this.sideGroups[h];t.add(f)&&o.push(f),c=h}s++}let a=new Array;for(let l of o)a.push(l.polyline());aG(a,mh.sortByBBoxAreaDesc,0,a.length),this.event.onPolylineGroup(new Po(a),r++)}}}findNeigber(r,e,t,n){let i=n*n,s=Number.MAX_VALUE,o=null;for(let a of t.search(r.bbox().extendOfSize(n)))if(!e.contains(a)){let l=r.distance2(a);l<s&&(s=l,o=a)}return s<i?o:null}},uG=class extends r2{constructor(r,e,t,n,i,s){super(r.rule,Sm.DUMMY,e),this.sideGroup1=[],this.sideGroup2=[],this.group1=t,this.group2=n,this.seeker=i,this.addGroup(t,r.weight(0),this.sideGroup1),this.addGroup(n,r.weight(1),this.sideGroup2),this.bus=s}addGroup(r,e,t){if(!r)debugger;r.items.forEach(n=>{let i=[];n.items.forEach(s=>{let o=this.sides.length;this.addPolyline(s,e),i.push(this.sides.slice(o))}),t.push(i)})}seekIntersection(){this.seeker.seek(this.group1,this.group2,(r,e,t,n,i,s)=>{let o=this.sideGroup1[r][e][t],a=this.sideGroup2[n][i][s],l=bn(o.shape,a.shape);for(let u=0;u<l;u+=2){let c=new q(V[u],V[u+1]);o.inters.push(c),a.inters.push(c),this.event.onIntersect(c,o,a)}return l},this.bus)}},cG=class extends Zy{constructor(r){super(!!r),r&&(this.drawDebug=new ba(r),this.blueDrawing=this.drawDebug.initColor(it.BLUE),this.greenDrawing=this.drawDebug.initColor(it.GREEN),this.redDrawing=this.drawDebug.initColor(it.RED))}onOriginSide(r){super.onOriginSide(r),this.debug&&this.blueDrawing.addPt(r.shape)}onPolylineGroup(r,e){super.onPolylineGroup(r,e),this.debug&&r.items.forEach(t=>this.greenDrawing.addPly(t))}draw(){this.drawDebug.draw()}};function xh(r,e,t,n,i){let s=xa(),o=new cG(i);new uG(r,o,e,t,n,i).simplify();let a=[];o.plGrps.forEach(u=>{let c=u.items.map(h=>Vy(h));c[0]&&a.push(new Zt(c.filter(h=>h)))});let l=new lt(a);return Gr.BooleanTools+=ji(s),l}var bh=!0,Ql={intersect(r,e,t,n){try{return ru.intersect(r,e,t,n)}catch(i){if(bh)throw i;return console.error(i),xh(K6,r,e,t,n)}},union(r,e,t,n){try{return ru.union(r,e,t,n)}catch(i){if(bh)throw i;return console.error(i),xh(H6,r,e,t,n)}},diff(r,e,t,n){try{return ru.diff(r,e,t,n)}catch(i){if(bh)throw i;return console.error(i),xh(Z6,r,e,t,n)}},xor(r,e,t,n){return ru.xor(r,e,t,n);try{return ru.xor(r,e,t,n)}catch(i){if(bh)throw i;return console.error(i),xh(Q6,r,e,t,n)}}},hG=(oi=class{static printf(){}static addIntersect(e){ne.CalIntersectNum+=e.calIntersectNum,ne.IntersectNum+=e.intersectNum}},(()=>{oi.T0=0})(),(()=>{oi.T1=0})(),(()=>{oi.T2=0})(),(()=>{oi.T3=0})(),(()=>{oi.T4=0})(),(()=>{oi.T5=0})(),(()=>{oi.T6=0})(),oi),tt=class ni{static getPolyTypeLine(e){let t=[];if(e instanceof Ce)for(let n of e.primitives)t.push(n);else if(e instanceof Zt)for(let n of e.items)if(n instanceof Ce)for(let i of n.primitives)t.push(i);else{let i=this.getPolyTypeLine(n);for(let s of i)t.push(s)}else if(e instanceof lt)for(let n of e.items){let i=this.getPolyTypeLine(n);for(let s of i)t.push(s)}return t}static getPolyGroupAreaRate(e){let t=e.bbox().area(),n=0;for(let i of e.items){let s=i.getOutMostPolyline(),o=Math.abs(s.area(.01))/t;n+=o}return n}static getPolyTypePolyLine(e){let t=[];if(e instanceof Ce)t.push(e);else if(e instanceof Zt)for(let n of e.items)if(n instanceof Ce)t.push(n);else{let i=this.getPolyTypePolyLine(n);for(let s of i)t.push(s)}else if(e instanceof lt)for(let n of e.items){let i=this.getPolyTypePolyLine(n);for(let s of i)t.push(s)}return t}static BresenhamLine(e,t,n,i){let s=[],o=Math.abs(n-e),a=Math.abs(i-t),l=e<n?1:-1,u=t<i?1:-1,c=o-a;for(s.push([e,t]);e!==n||t!==i;){let h=c*2;h>-a&&(c-=a,e+=l),h<o&&(c+=o,t+=u),s.push([e,t])}return s}static sampleArc(e){let t=60,n=Math.ceil(Math.abs(e.endAngle()-e.startAngle)/t),i=[],s=e.endAngle()>=e.startAngle?1:-1;for(let o=0;o<=n;o++){let a=(e.startAngle+(o+0)*t*s)/180*Math.PI,l=(e.startAngle+(o+1)*t*s)/180*Math.PI,u=e.center.add(new q(Math.cos(a),Math.sin(a)).mul(e.rx)),c=e.center.add(new q(Math.cos(l),Math.sin(l)).mul(e.rx));i.push(new Y(u,c))}return i}static createGrid(e,t){let n={},i=[];for(let o of e){let a=o.bbox();if(a.area()<=ne.GridSize**2&&a.width()<=ne.GridSize&&a.height()<=ne.GridSize){let l=Math.floor((o.bbox().center().x-ne.StartGrid.x)/ne.GridSize),u=Math.floor((o.bbox().center().y-ne.StartGrid.y)/ne.GridSize),c=`${l}_${u}`;n[c]=1;continue}if(o instanceof re){let l=o,u=this.sampleArc(l);for(let c of u)i.push(c)}else i.push(o)}let s=o=>{let a=o.start().sub(ne.StartGrid),l=o.end().sub(ne.StartGrid),u=Math.floor(a.x/t),c=Math.floor(a.y/t),h=Math.floor(l.x/t),f=Math.floor(l.y/t),d=ni.BresenhamLine(u,c,h,f);for(let m of d){let p=`${m[0]}_${m[1]}`;n[p]=1}};for(let o of i)s(o);return n}static evaluateCostSingle(e,t){if(e.length<=0||t.length<=0)return 0;let n={ScoreCalEdge:1,ScoreUnionArea:1,ScoreIntersectArea:1},i={ScoreCalEdge:1,ScoreUnionArea:1,ScoreIntersectArea:1},s=e[0].bbox();for(let d=1;d<e.length;d++)s=ye.extend2(s,e[d].bbox());let o=t[0].bbox();for(let d=1;d<t.length;d++)o=ye.extend2(o,t[d].bbox());if(!s||!o)return 1;let a=ye.extend2(s,o),l=s.intersection1(o);if(!l||!a)return 1;n.ScoreUnionArea=a.area()/(1e3*1e3),n.ScoreIntersectArea=1-l.area()/a.area();let u=0,c=0;for(let d of e){let m=ni.getPolyTypeLine(d);u+=m.length}for(let d of t){let m=ni.getPolyTypeLine(d);c+=m.length}n.ScoreCalEdge=u*c/4e5;let h=0;for(let d of Object.values(i))h+=d;let f=0;for(let d of Object.keys(n)){let m=i[d]/h;f+=n[d]*m}return f}static evaluateCostNodeListGrid(e,t){if(e.length<=0)return 0;let n=e[0].getNodeBBox();for(let l=1;l<e.length;l++)n=ye.extend2(n,e[l].getNodeBBox());let i=t.getNodeBBox();if(!n.isIntersect(i))return 0;let s=0,o=t.getGridInfo(),a={};for(let l of e){let u=l.getGridInfo();if(u.length<=o.length)for(let c of Object.keys(u))c in a||c in o&&(a[c]=1,s+=1);else for(let c of Object.keys(o))c in a||c in u&&(a[c]=1,s+=1)}return s}static evaluateCostNodeListBBox(e,t){if(e.length<=0)return 0;let n=e[0].getNodeBBox();for(let a=0;a<e.length;a++)n=ye.extend2(n,e[a].getNodeBBox());let i=t.getNodeBBox(),s=n.intersection1(i);if(!s)return 0;let o=n.area()+i.area()-s.area();return 1-s.area()/o}static evaluateCostNodeListCombo(e,t){if(e.length<=0)return 0;let n={ScoreUnionArea:{name:"\u5E76\u96C6\u533A\u57DF",score:1,weight:1},ScoreIntersectArea:{name:"\u4EA4\u96C6\u6BD4\u4F8B",score:1,weight:1},ScoreLineNumCal:{name:"\u63A5\u89E6\u8FB9",score:1,weight:1}},i=e[0].getNodeBBox();for(let m=0;m<e.length;m++)i=ye.extend2(i,e[m].getNodeBBox());let s=t.getNodeBBox(),o=i.intersection1(s);if(!o)return 0;let a=0,l=0,u=0,c=0;for(let m of e){let p=ni.getPolyTypeLine(m.polygon);for(let g of p)l+=1,o.isIntersect(g.bbox())&&(a+=1)}let h=ni.getPolyTypeLine(t.polygon);c=h.length;for(let m of h)o.isIntersect(m.bbox())&&(u+=1);let f=i.area()+s.area()-o.area();n.ScoreIntersectArea.score=1-o.area()/f;let d=1-(a+u)/(l+c);return l+c}static getListBBox(e){if(e.length<=0)return;let t=new Oe;for(let n of e){let i=ni.getSingleBBox(n);t.ext1(i)}return t.build1()}static getSingleBBox(e){if(e instanceof Array){let t=new Oe,n=ni.getListBBox(e.slice(1));return t.ext1(n),t.build1()}else return e.bbox()}static getListPolyTypeLine(e){if(e.length<=0)return[];let t=[];for(let n of e){let i=ni.getSinglePolyTypeLine(n);t=t.concat(i)}return t}static getSinglePolyTypeLine(e){return e instanceof Array?ni.getListPolyTypeLine(e.slice(1)):ni.getPolyTypeLine(e)}static evaluateCostNodeBoolChildByBBox(e,t,n=void 0){if(!e||!t)return 0;let i=e.intersection1(t);if(!i)return 0;let s=ye.extend2(e,t);if(n)Math.min(1-i.area()/e.area(),1-i.area()/t.area(),1-i.area()/s.area())*.5+(1-s.area()/n.area())*.5;else return Math.min(1-i.area()/e.area(),1-i.area()/t.area(),1-i.area()/s.area())}static evaluateCostNodeBoolChildByCombo(e,t,n,i){return n.length+i.length}static doDrawRule(e,t=ne.PrintStart){if(e.length<2)return[t,t,t];let n=5,i=10,s=e[0],o=ne.translate(s),a=[],l=t.y,u=t.x,c=t.x;t=t.add(new q(0,-i));for(let d=1;d<e.length;d++){let m=e[d];if(m instanceof Array){t=t.add(new q(n,0));let p=this.doDrawRule(m,t);a.push(p[0]),p[1].x<=u&&(u=p[1].x),p[2].x>=c&&(c=p[2].x),t=new q(p[2].x+n,t.y)}else m.name||(m.name=ne.getPolyTypeKey(),ne.drawText(m.bbox().UL(),m.name)),a.push(t.clone()),t.x<=u&&(u=t.x),t.x>=c&&(c=t.x),ne.drawText(t,m.name),t=t.add(new q(n,0))}let h=0;for(let d of a)h+=d.x;let f=new q(h/a.length,t.y+i);ne.drawText(f,"N:"+o);for(let d of a){let m=new Y(d,f),p=new Array;p.push(m);let g=Ce.build1($c(p));ne.drawPolyType(g,it.GREEN)}return[f,new q(u,l),new q(c,l)]}static drawRule(e,t=ne.PrintStart,n=!1,i){ne.clearDrawing(),this.doDrawRule(e,t),n&&this.doDrawRulePolygon(e,i),ne.getDebug().draw()}static doDrawRulePolygon(e,t){let n=e[0];for(let i=1;i<e.length;i++){let s=e[i];if(s instanceof Array)this.doDrawRulePolygon(s,t);else{let o=t;n===2&&i===1&&(o=it.RED),s.name&&ne.drawText(s.bbox().UL(),s.name,o),ne.drawPolyType(s,o)}}}static getRulePolygonName(e){let t=[];return this.doGetRulePolygonName(e,t),t.sort((n,i)=>parseInt(n.split("P")[1])-parseInt(i.split("P")[1])),t}static doGetRulePolygonName(e,t){for(let n=1;n<e.length;n++){let i=e[n];i instanceof Array?this.doGetRulePolygonName(i,t):(i.name||(i.name=ne.getPolyTypeKey()),t.push(i.name))}}static getRulePolygonTypeByName(e,t){for(let n=1;n<e.length;n++){let i=e[n];if(i instanceof Array){let s=this.getRulePolygonTypeByName(i,t);if(s)return s}else if(i.name===t)return i}}static IsOneBBoxPointInPolygonType(e,t){for(let n=0;n<4;n++){let i;switch(n){case 0:i=e.LL();break;case 1:i=e.UR();break;case 2:i=e.LR();break;case 3:i=e.UL();break;default:break}for(let s of t.items)if(s.getOutMostPolyline().getWindingNum(i))return!0}return!1}static IsCenterBBoxPointInPolygonType(e,t){let n=e.center();for(let i of t.items)if(i.getOutMostPolyline().getWindingNum(n))return!0;return!1}static IsAllPointInPolygonType(e,t){if(!t||!e)return!1;for(let n of e.items){let i=n.items;for(let s of i)for(let o of s.primitives)for(let a of t.items)if(!a.getOutMostPolyline().getWindingNum(o.start()))return!1}return!0}static KeepBBoxPolygonGroup(e,t){let n=t.bbox().intersection1(e);if(!n)return!1;for(let i of t.items)for(let s of i.items)for(let o of s.primitives)if(n.isIntersect(o.bbox()))return!0;return!!this.IsCenterBBoxPointInPolygonType(e,t)}},n2=class Sh{constructor(){this.listChild=[],this.name=ne.getArrangeNodeKey()}isLeaf(){return this.listChild.length>0&&!(this.listChild[0]instanceof Sh)}getResult(){if(this.listChild.length<=0)return[];if(this.listChild[0]instanceof Sh){let e=[];for(let t of this.listChild){let n=t.getResult();n instanceof Array&&n.length<=0||e.push(n)}return e}else return this.listChild.length===1?this.listChild[0]:this.listChild}getFlatChild(){if(this.listChild.length<=0)return[];let e=[];for(let t of this.listChild)if(t instanceof Sh){let n=t.getFlatChild();if(n.length<=0)continue;e=e.concat(n)}else e.push(t);return e}addChild(e){this.listChild.indexOf(e)<0&&this.listChild.push(e)}},i2=class{constructor(r="None"){this.m_listFinalNode=[],this.m_dictSolution={},this.m_nIteration=0,this.m_strName=r}initOption(r){this.m_funSearchChild=r.funSearchChild,this.m_funGetCurValue=r.funGetValue,this.m_funCalCombineCost=r.funCalCombineCost,this.m_funCalTotal=r.funCalTotal,this.m_funGetBox=r.funGetBBox}run(){this.m_nIteration=0;let r=performance.now();for(let e=0;e<ne.IterationNum;e++){if(this.m_nIteration+=1,performance.now()-r>=ne.IterationMilliSecond){console.warn("\u9000\u51FA\u8FED\u4EE3\uFF1A\u8D85\u8FC7\u8FED\u4EE3\u65F6\u95F4");break}this.onIteration()}return ne.IterationNum>1&&this.m_nIteration>=ne.IterationNum&&console.warn("\u8D85\u8FC7\u8FED\u4EE3\u6B21\u6570",ne.IterationNum),this.getResult(this.m_listFinalNode)}runOnce(){return this.onIteration(),this.getResult(this.m_listFinalNode)}getResult(r){let e=[];for(let t of r){let n=t.getResult();n instanceof Array&&n.length<=0||e.push(n)}return e}},dG=class extends n2{},yh=class _2 extends i2{constructor(){super(...arguments),this.m_bConfig=!1,this.m_nTemperature=0,this.m_nCoolingRate=0}init(e){this.m_listFinalNode=[];for(let t of e){let n=new dG;n.addChild(t),this.m_listFinalNode.push(n)}}config(e){this.m_nTemperature=e.temperature,this.m_nCoolingRate=e.coolingRate,this.m_bConfig=!0}onIteration(){if(!this.m_bConfig)throw new Error("\u5C1A\u672A\u8FDB\u884C\u521D\u59CB\u5316");let e=this.m_listFinalNode.length,t=[...this.m_listFinalNode];this.m_listFinalNode=t;let n=this.m_funCalTotal(this.getResult(t)),i=n,s=[...this.m_listFinalNode],o=[];for(;this.m_nTemperature>1;){ne.TotalCalNum+=1;let a=[...t],l=Math.floor(Math.random()*e),u=Math.floor(Math.random()*e),c=a[l];a[l]=a[u],a[u]=c;let h=this.getResult(a),f=this.m_funCalTotal(h);if(_2.acceptanceProbability(n,f,this.m_nTemperature)>Math.random()){if(ne.UseConvergence){let d=Math.abs(f-n);o.push(d)}t=[...a],n=f}if(n<=i&&(s=[...t],i=n),this.m_nTemperature*=1-this.m_nCoolingRate,ne.UseConvergence&&(o.length>ne.Convergence&&o.splice(0,1),o.length>=ne.Convergence)){let d=!0;for(let m of o)m>=ne.MinDelta&&(d=!1);if(d)break}}this.m_listFinalNode=s}static optimize(e,t,n,i){let s=e.length,o=[...e],a=i(o),l=a,u=[...o],c=[];for(;t>1;){ne.TotalCalNum+=1;let h=[...o],f=Math.floor(Math.random()*s),d=Math.floor(Math.random()*s),m=h[f];h[f]=h[d],h[d]=m;let p=i(h);if(this.acceptanceProbability(a,p,t)>Math.random()&&(o=[...h],a=p),a<l){if(u=[...o],ne.UseConvergence){let g=Math.abs(l-a);if(c.push(g),c.length>ne.Convergence&&c.splice(0,1),c.length>=ne.Convergence){let b=!0;for(let v of c)v>=ne.MinDelta&&(b=!1);if(b)break}}l=a}t*=1-n}return u}static acceptanceProbability(e,t,n){return t<e?1:Math.exp((e-t)/n)}},ne=(be=class{static getSAOptimizer(){return be.SAOptimizer||(be.SAOptimizer=new yh),be.SAOptimizer}static reset(){be.TotalNodeNum=0,be.TotalCalNum=0,be.CalIntersectNum=0,be.IntersectNum=0,be.dictValue={},be.dictShowTime={}}static formatTimeIndex(e){return JSON.stringify({\u89C4\u5212\u65F6\u95F4:e.runBoolean,\u6C42\u4EA4\u65F6\u95F4:e.IntersectionSeeker,\u5E03\u5C14\u8FD0\u7B97\u65F6\u95F4:e.BooleanTools,\u603B\u65F6\u95F4:e.totalBool})}static print(){if(be.Record&&console.log(this.formatTimeIndex(Gr)),!!be.LogTime){switch(console.log("\u4E24\u8FB9\u8BA1\u7B97\u4EA4\u70B9\u6B21\u6570\uFF1A"+be.CalIntersectNum),console.log("\u4EA4\u70B9\u6570\u91CF\uFF1A"+be.IntersectNum),be.OptimizeType){case"Force":console.log("\u66B4\u529B\u4F18\u5316\u8282\u70B9\u6570\uFF1A"+be.TotalNodeNum),console.log("\u66B4\u529B\u4F18\u5316\u5E73\u5747\u6B21\u6570\uFF1A"+Math.ceil(be.TotalCalNum/be.TotalNodeNum));break;case"SA":console.log("\u968F\u673A\u4F18\u5316\u8282\u70B9\u6570\uFF1A"+be.TotalNodeNum),console.log("\u968F\u673A\u4F18\u5316\u5E73\u5747\u6B21\u6570\uFF1A"+Math.ceil(be.TotalCalNum/be.TotalNodeNum));break;default:break}if(be.addMarkTime("\u5E03\u5C14\u5168\u90E8\u65F6\u95F4",be.getMarkTime("\u5168\u5C40\u89C4\u5212\u65F6\u95F4")+Gr.IntersectionSeeker+Gr.BooleanTools),be.LogTime)for(let e of Object.keys(this.dictShowTime))console.log(e,this.formatTime(this.dictShowTime[e]));hG.printf()}}static addEvaluateValue(e,t,n){be.dictValue[e]===void 0&&(be.dictValue[e]={}),be.dictValue[e][t]===void 0&&(be.dictValue[e][t]=0);let i=be.dictValue[e][t]+n;be.dictValue[e][t]=i/2}static getDebug(){return be.drawDebug||(be.drawDebug=new ba(be.curBus)),be.drawDebug}static getDrawing(e=it.GREEN){return this.getDebug().initColor(e)}static clearDrawing(){be.getDebug().clear()}static drawText(e,t,n=it.GREEN){be.getDrawing(n).addText(e,t,1.5,.1,!0)}static drawBBox(e,t=it.GREEN){if(!e)return;let n=be.getDrawing(t),i=new Y(e.UL(),e.UR()),s=new Y(e.UR(),e.LR()),o=new Y(e.LR(),e.LL()),a=new Y(e.LL(),e.UL());n.addPt(i),n.addPt(s),n.addPt(o),n.addPt(a)}static drawPolyType(e,t){let n=be.getDrawing(t);if(e instanceof Ce)n.addPly(e);else if(e instanceof Zt)for(let i of e.items)i instanceof Ce?n.addPly(i):this.drawPolyType(i,t);else if(e instanceof lt)for(let i of e.items)this.drawPolyType(i,t)}static getPolyTypeKey(){return this.IncreasePoly+=1,"P"+be.IncreasePoly}static getNodeKey(){return this.IncreaseNode+=1,"N"+be.IncreaseNode}static getTreeKey(){return this.IncreaseTree+=1,"T"+be.IncreaseTree}static getArrangeNodeKey(){return this.IncreaseArrangeNode+=1,"A"+be.IncreaseArrangeNode}static getOptimizeKey(){return this.IncreaseOptimizeNode+=1,"O"+be.IncreaseOptimizeNode}static getMarkTime(e){return e in be.dictShowTime?be.dictShowTime[e]:0}static addMarkTime(e,t){be.LogTime&&(e in be.dictShowTime||(be.dictShowTime[e]=0),be.dictShowTime[e]+=t)}static markStart(e){be.LogTime&&(this.dictMarkTime[e]=performance.now())}static formatTime(e){let t=Math.floor(e/1e3),n=Math.floor(e%1e3);return t>0?`${t}s${n}ms`:`${e.toFixed(3)}ms`}static markEnd(e){if(!be.LogTime)return;if(!(e in this.dictMarkTime)){console.error("\u6CA1\u6709\u8BB0\u5F55\u5F00\u59CB",e);return}let t=performance.now()-this.dictMarkTime[e];return delete this.dictMarkTime[e],t}static translate(e){switch(e){case 0:return"\u2229";case 2:return"-";case 1:return"U";case 3:return"X";default:break}}static calculateDispersion(e){if(e.length<=0)return 0;let t=i=>{let s=0,o=0,a=0,l=0;for(let u of i)for(let c of u.primitives)a+=1,o+=c.start().x,s+=c.start().y;o=o/a,s=s/a;for(let u of i)for(let c of u.primitives){let h=o-c.start().x,f=s-c.start().y;l+=Math.sqrt(h*h+f*f)}return l/a},n=[];for(let i of e)n=n.concat(tt.getPolyTypePolyLine(i));return t(n)}static evaluateCostMulti(e,t){if(e.length<=0)return{calEdge:0,intersectAreaRate:0,lastEdge:0};if(t.length<=0)return{calEdge:0,intersectArea:0,lastEdge:0};let n=e[0].bbox();for(let d=1;d<e.length;d++)n=ye.extend2(n,e[d].bbox());let i=t[0].bbox();for(let d=1;d<t.length;d++)i=ye.extend2(i,t[d].bbox());let s=0,o=0,a=[];for(let d of e){let m=tt.getPolyTypeLine(d);s+=m.length;for(let p of m)a.push(p.bbox())}let l=[];for(let d of t){let m=tt.getPolyTypeLine(d);o+=m.length;for(let p of m)l.push(p.bbox())}let u=ye.extend2(n,i),c=[],h=0;for(let d of a)i.isContainsBBox(d)&&c.push(d),i.isIntersect(d)||(h+=1);for(let d of l)n.isContainsBBox(d)&&c.push(d),i.isIntersect(d)||(h+=1);if(c.length<=0)return{calEdge:0,intersectAreaRate:0,lastEdge:h};let f=c[0];for(let d=1;d<c.length;d++)f=ye.extend2(f,c[d]);return{calEdge:s*o,intersectAreaRate:f.area()/u.area(),lastEdge:h}}static clamp(e,t,n){return Math.max(t,Math.min(e,n))}static getPolygonValue(e){if(e.length<=0)return 0;let t=be.calculateDispersion(e),n=e[0].bbox(),i=0;for(let s of e){n=ye.extend2(n,s.bbox());let o=tt.getPolyTypeLine(s);i+=o.length}return n.area()*.3+i*.3+t*.3}},(()=>{be.UseRunArrange=!0})(),(()=>{be.UseOptimizeSplit=!0})(),(()=>{be.UseRandomOptimize=!1})(),(()=>{be.LocalBestThread=4})(),(()=>{be.HandleDiff=!0})(),(()=>{be.Record=!0})(),(()=>{be.UseClass=!1})(),(()=>{be.AutoPair=!0})(),(()=>{be.OcTreeSplitStep=4})(),(()=>{be.KDTreeSplitStep=4})(),(()=>{be.SplitType="OcTree"})(),(()=>{be.UnionSplitType="Raw"})(),(()=>{be.UnionSplitGridSize=8})(),(()=>{be.OptimizeType="PredictCalculate"})(),(()=>{be.EvaluateType="Combo"})(),(()=>{be.UseConvergence=!0})(),(()=>{be.OnlyBBoxTouch=!0})(),(()=>{be.NoOptimizePureTreeNode=!0})(),(()=>{be.Temperature=100})(),(()=>{be.CoolingRate=.3})(),(()=>{be.MinDelta=be.EvaluateType==="BBox"?.1*be.LocalBestThread:2})(),(()=>{be.Convergence=3})(),(()=>{be.IterationNum=1})(),(()=>{be.IterationMilliSecond=2e4})(),(()=>{be.EvaluateRaw=!1})(),(()=>{be.Evaluate=!1})(),(()=>{be.ExtendRate=4})(),(()=>{be.LogEmpire=!1})(),(()=>{be.GridSize=8})(),(()=>{be.StartGrid=new q(-1e4,-1e4)})(),(()=>{be.AttractG=1e3})(),(()=>{be.AreaRate=0})(),(()=>{be.Debug=!1})(),(()=>{be.DrawSeek=!1})(),(()=>{be.DrawLogBBox=!1})(),(()=>{be.DrawBoolTree=!1})(),(()=>{be.DrawRect=!1})(),(()=>{be.DrawAttract=!1})(),(()=>{be.DrawGrid=!1})(),(()=>{be.DrawBoolTreeBBox=!1})(),(()=>{be.DrawSplitRect=!1})(),(()=>{be.LogRule=!1})(),(()=>{be.LogTree=!1})(),(()=>{be.LogTime=!1})(),(()=>{be.LogCalRules=!1})(),(()=>{be.CalIntersectNum=0})(),(()=>{be.IntersectNum=0})(),(()=>{be.TotalCalNum=0})(),(()=>{be.TotalNodeNum=0})(),(()=>{be.dictValue={}})(),(()=>{be.IncreasePoly=0})(),(()=>{be.IncreaseNode=0})(),(()=>{be.IncreaseTree=0})(),(()=>{be.IncreaseArrangeNode=0})(),(()=>{be.IncreaseOptimizeNode=0})(),(()=>{be.PrintGrid=5})(),(()=>{be.PrintStart=new q(150,-200)})(),(()=>{be.dictMarkTime={}})(),(()=>{be.dictShowTime={}})(),be),s2=class{constructor(r){this.palette=new ba(r)}drawing(){this.palette.draw()}drew(){this.palette.draw(),this.clear()}clear(){this.palette.clear()}drawPt(r,e){this.palette.initColor(e).addPt(r),this.drawing()}drawPtArr(r,e){let t=this.palette.initColor(e);r.forEach(n=>{t.addPt(n)}),this.drawing()}drawPolyLine(r,e){this.palette.initColor(e).addPly(r),this.drawing()}drawPolyLineArr(r,e){r.forEach(t=>{this.drawPolyLine(t,e)}),this.drawing()}drawPolygon(r,e){let t=this.palette.initColor(e);r.items.forEach(n=>{t.addPly(n)}),this.drawing()}drawPolygonArr(r,e){r.forEach(t=>{this.drawPolygon(t,e)}),this.drawing()}drawGroup(r,e){let t=this.palette.initColor(e);r.items.forEach(n=>{n.items.forEach(i=>{t.addPly(i)})}),this.drawing()}drawText(r,e,t){this.palette.initColor(t).addText(r,e,1.5,.1,!0),this.drawing()}drawGroupArr(r,e){r.forEach(t=>{this.drawGroup(t,e)}),this.drawing()}drawRect(r,e){this.drawPt(new Y(new q(r.maxX,r.maxY),new q(r.maxX,r.minY)),e),this.drawPt(new Y(new q(r.maxX,r.maxY),new q(r.minX,r.maxY)),e),this.drawPt(new Y(new q(r.minX,r.minY),new q(r.maxX,r.minY)),e),this.drawPt(new Y(new q(r.minX,r.minY),new q(r.minX,r.maxY)),e),this.drawing()}drawBbox(r,e){this.drawPt(new Y(new q(r.maxX,r.maxY),new q(r.maxX,r.minY)),e),this.drawPt(new Y(new q(r.maxX,r.maxY),new q(r.minX,r.maxY)),e),this.drawPt(new Y(new q(r.minX,r.minY),new q(r.maxX,r.minY)),e),this.drawPt(new Y(new q(r.minX,r.minY),new q(r.minX,r.maxY)),e),this.drawing()}drawPtArrBbox(r,e){let t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER;for(let o=0;o<r.length-1;o++)t=Math.max(t,r[o].bbox().maxX),n=Math.min(n,r[o].bbox().minX),i=Math.max(i,r[o].bbox().maxY),s=Math.min(s,r[o].bbox().minY);this.drawBbox(new ye(n,t,s,i),e)}drawGridSpace(r,e){for(let t=0;t<r.getGrid().length;t++)if(r.getGrid()[t]!==void 0)for(let n=0;n<r.getGrid()[t].length;n++)r.getGrid()[t][n]!==void 0&&this.drawRect(r.getGridRect(t,n),e);this.drawing()}drawGridSpaceAll(r,e){for(let t=0;t<r.getRows();t++)for(let n=0;n<r.getCols();n++)this.drawRect(r.getGridRect(t,n),e);this.drawing()}drawPoint(r,e){this.palette.initColor(e).addPoint(r),this.drawing()}},Vle,Wle,fG=class{init(r){}seek(r,e,t,n){if(ne.DrawSeek){let f=new s2(n);r.name&&f.drawText(r.bbox().UL(),r.name,it.GREEN),e.name&&f.drawText(e.bbox().UL(),e.name,it.BLUE),f.drawGroup(r,it.GREEN),f.drawGroup(e,it.BLUE);debugger;f.clear()}let i=r.bbox().extendOfSize(5e-6).intersection1(e.bbox().extendOfSize(5e-6));if(!i)return;let s=xa(),o=[];for(let f=0,d=r.items.length;f<d;f++){let m=r.items[f];if(i.isIntersect(m.bbox()))for(let p=0,g=m.items.length;p<g;p++){let b=m.items[p];if(i.isIntersect(b.bbox()))for(let v=0,w=b.primitives.length;v<w;v++){let P=b.primitives[v].bbox();i.isIntersect(P)&&o.push({bbox:P,polygonIndex:f,polylineIndex:p,ptIndex:v})}}}let a=o.length;if(a===0){Gr.IntersectionSeeker+=ji(s);return}let l=[];for(let f=0,d=e.items.length;f<d;f++){let m=e.items[f];if(i.isIntersect(m.bbox()))for(let p=0,g=m.items.length;p<g;p++){let b=m.items[p];if(i.isIntersect(b.bbox()))for(let v=0,w=b.primitives.length;v<w;v++){let P=b.primitives[v].bbox();i.isIntersect(P)&&l.push({bbox:P,polygonIndex:f,polylineIndex:p,ptIndex:v})}}}let u=l.length;if(u===0){Gr.IntersectionSeeker+=ji(s);return}if(a<5||u<5){for(let f=0,d=o.length;f<d;f++)for(let m=0,p=l.length;m<p;m++)if(o[f].bbox.isIntersect(l[m].bbox.extendOfSize(1e-5))){let g=o[f],b=l[m];ne.IntersectNum+=t(g.polygonIndex,g.polylineIndex,g.ptIndex,b.polygonIndex,b.polylineIndex,b.ptIndex)}Gr.IntersectionSeeker+=ji(s);return}o.sort((f,d)=>f.bbox.minX-d.bbox.minX),l.sort((f,d)=>f.bbox.minX-d.bbox.minX);let c=0,h=0;for(;c<a&&h<u;)if(o[c].bbox.minX<l[h].bbox.minX){let f=o[c],d=f.bbox;for(let m=h;m<u;m++){let p=l[m],g=p.bbox;if(g.minX>d.maxX+1e-5)break;(d.minY<g.minY?g.minY:d.minY)<(d.maxY<g.maxY?d.maxY:g.maxY)+1e-5&&(ne.IntersectNum+=t(f.polygonIndex,f.polylineIndex,f.ptIndex,p.polygonIndex,p.polylineIndex,p.ptIndex))}c++}else{let f=l[h],d=f.bbox;for(let m=c;m<a;m++){let p=o[m],g=p.bbox;if(g.minX>d.maxX+1e-5)break;(g.minY<d.minY?d.minY:g.minY)<(g.maxY<d.maxY?g.maxY:d.maxY)+1e-5&&(ne.IntersectNum+=t(p.polygonIndex,p.polylineIndex,p.ptIndex,f.polygonIndex,f.polylineIndex,f.ptIndex))}h++}Gr.IntersectionSeeker+=ji(s)}};function pG(r,e){let t=r.bbox(),n=e.bbox(),i=(t.minY+t.maxY)/2,s=(n.minY+n.maxY)/2;return i-s}function mG(r,e){let t=r.bbox(),n=e.bbox(),i=(t.minX+t.maxX)/2,s=(n.minX+n.maxX)/2;return i-s}var Jl=class kn{constructor(e,t){if(this.childs=new Array,this._bbox=null,this.parent=null,this.capacity=e,typeof t<"u"&&Array.isArray(t))for(let n of t)this.insert(n)}bbox(){return at.notnull(this._bbox)}itor(e,t){for(let n of this.childs)n instanceof kn?n.itor(e+1,t):t(n,e)}debug(e){for(let t of this.childs)console.log(e,t.bbox(),t instanceof kn?"+":"-"),t instanceof kn&&t.debug(e+" |--")}insert(e){let t=this.childs,n=e.bbox();if(!(e instanceof kn))for(let i=0;i<t.length;i++){let s=t[i];if(s instanceof kn&&n.isInside(s.bbox())){s.insert(e),this._bbox=ye.extend2(this._bbox,n);return}}e instanceof kn&&(e.parent=this),t.length<=this.capacity?t.push(e):(t.push(e),this.splitNode()),this._bbox=ye.extend2(this._bbox,n)}remove(e){if(e instanceof kn&&e.childs.length>0)throw new Error;let t=this.childs,n=e.bbox(),i=new Array;for(let s=0;s<t.length;s++){let o=t[s];if(o===e)return t.splice(s,1),t.length>0?(this.updateBBox(),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox()):this.parent!==null?(this.parent.remove(this),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox()):this._bbox=null,1;o instanceof kn&&n.isInside(o.bbox())&&i.push(o)}if(e instanceof kn)throw new Error;for(let s of i){let o=s.remove(e);if(o===1)return this.childs.length>0&&this.updateBBox(),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox(),1;if(o!==0)throw new Error}return 0}recycle(){this.childs.length=0}updateBBox(){let e=new Oe;for(let t of this.childs)e.ext1(t.bbox());this._bbox=e.build1()}splitNode(){let e=this.childs,t=e.length,n=-1,i=-1,s=Number.NEGATIVE_INFINITY;for(let u=0;u<t;u++){let c=e[u];for(let h=u+1;h<t;h++){let f=e[h],d=ye.extend2(c.bbox(),f.bbox()).area();d>s&&(s=d,n=u,i=h)}}let o=this.asNode(e[n]),a=this.asNode(e[i]);for(let u=0;u<t;u++)if(u!==n&&u!==i){let c=e[u],h=c.bbox(),f=ye.extend2(o._bbox,h).area(),d=ye.extend2(a._bbox,h).area();f<d?o.insert(c):a.insert(c)}e.length=0;let l=this.parent;l!==null&&l.childs.length<this.capacity?(o.parent=l,a.parent=l,l.childs.push(o),l.childs.push(a),l.remove(this),l.updateBBox()):(o.parent=this,a.parent=this,e.push(o),e.push(a),this.updateBBox()),this.childs.length>0&&this.updateBBox(),o.updateBBox(),a.updateBBox()}asNode(e){if(e instanceof kn)return e;{let t=new kn(this.capacity);return t.insert(e),t}}},o2=.5,a2=1e5,vh=class{constructor(r){this.items=new Set,this.changeList=new Set,this.deadList=new Set,this.changed=!1,this.capacity=r,this.capacity2=r*r,this.root=new Jl(r)}itor(r){this.root.itor(0,r)}size(){return this.items.size}search(r){this.flushWhenNeed();let e=[],t=[];for(t.push(this.root);;){let n=t.shift();if(n!==void 0)for(let i of n.childs)r.isSeparated(i.bbox())||(i instanceof Jl?t.push(i):e.push(i));else break}return e}insert(r){this.items.add(r),this.changeList.add(r),this.changed=!0}remove(r){this.items.delete(r),this.deadList.add(r),this.changed=!0}bbox(){return this.flushWhenNeed(),this.root.bbox()}flushDeleteWhenNeed(){if(this.changed){let r=this.deadList.size,e=1;if(this.items.size>0&&(e=r/this.items.size),e>o2||r>a2)this.fullRefresh(),this.deadList.clear(),this.changeList.clear(),this.changed=!1;else{for(let t of this.deadList)this.root.remove(t);this.deadList.clear(),this.changed=this.changeList.size>0}}}flushWhenNeed(){if(this.changed){let r=this.changeList.size+this.deadList.size,e=1;if(this.items.size>0&&(e=r/this.items.size),e>o2||r>a2)this.fullRefresh();else{for(let t of this.deadList)this.root.remove(t);for(let t of this.changeList)this.items.has(t)&&this.root.insert(t)}this.deadList.clear(),this.changeList.clear(),this.changed=!1}}debug(){this.root.debug("")}recycle(){this.items.clear(),this.changeList.clear(),this.deadList.clear(),this.root.recycle(),this.changed=!1}fullRefresh(){let r=new Array;for(let e of this.items)r.push(e);for(;;){let e=this.organize(r);if(e.length>1)r=e;else break}this.root.recycle(),this.root=new Jl(this.capacity,r)}organize(r){Xi(r,mG,0,r.length);let e=r.length,t=[];for(let n=0;n<e;)if(n+this.capacity2<=e){let i=n+this.capacity2;Xi(r,pG,n,i);for(let s=n;s<i;s+=this.capacity){let o=new Jl(this.capacity,r.slice(s,s+this.capacity));t.push(o)}n=n+this.capacity*this.capacity}else{let i=new Jl(this.capacity,r.slice(n,n+this.capacity));t.push(i),n=n+this.capacity}return t}},Bm=class Ih{constructor(){this.listChild=[],this.name=ne.getArrangeNodeKey()}isLeaf(){return this.listChild.length>0&&!(this.listChild[0]instanceof Ih)}getResult(){if(this.listChild.length<=0)return[];if(this.listChild[0]instanceof Ih){let e=[];for(let t of this.listChild){let n=t.getResult();n instanceof Array&&n.length<=0||e.push(n)}return e}else return this.listChild.length===1?this.listChild[0]:this.listChild}getFlatChild(){if(this.listChild.length<=0)return[];let e=[];for(let t of this.listChild)if(t instanceof Ih){let n=t.getFlatChild();if(n.length<=0)continue;e=e.concat(n)}else e.push(t);return e}addChild(e){this.listChild.indexOf(e)<0&&this.listChild.push(e)}},Am=class{constructor(r,e){this.m_dictCurNode={},this.m_dictContains={},this.m_nIteration=0,this.m_strName=r,this.m_funSearchChild=e.funSearchChild,this.m_funGetCurValue=e.funGetValue,this.m_funCalCombineCost=e.funCalCombineCost,this.m_funCalTotal=e.funCalTotal,this.m_funGetBox=e.funGetBBox}recordContains(r,e){r in this.m_dictContains||(this.m_dictContains[r]={}),this.m_dictContains[r][e.name]=e}deleteContains(r){for(let e of Object.keys(this.m_dictContains))delete this.m_dictContains[e][r.name]}run(){this.m_nIteration=0;let r=performance.now();for(let e=0;e<ne.IterationNum;e++){if(this.m_nIteration+=1,performance.now()-r>=ne.IterationMilliSecond){console.warn("\u9000\u51FA\u8FED\u4EE3\uFF1A\u8D85\u8FC7\u8FED\u4EE3\u65F6\u95F4");break}this.onIteration()}return ne.IterationNum>1&&this.m_nIteration>=ne.IterationNum&&console.warn("\u8D85\u8FC7\u8FED\u4EE3\u6B21\u6570",ne.IterationNum),this.getResult()}runOnce(){return this.onIteration(),this.getResult()}combineToNode(r,e,t){r&&e?(t.addChild(r),t.addChild(e)):console.error(r==null?void 0:r.name,e==null?void 0:e.name,this.m_dictCurNode,r,e),this.deleteContains(r),this.deleteContains(e),delete this.m_dictCurNode[r.name],delete this.m_dictCurNode[e.name],this.m_dictCurNode[t.name]=t;let n=t.getFlatChild();for(let i of n)this.recordContains(i,t)}combineToFirst(r,e){if(r&&e){let n=e.getFlatChild();for(let i of n)r.listChild.indexOf(i)<0&&r.listChild.push(i)}else console.error(r==null?void 0:r.name,e==null?void 0:e.name,this.m_dictCurNode,r,e);this.deleteContains(e),delete this.m_dictCurNode[e.name];let t=r.getFlatChild();for(let n of t)this.recordContains(n,r)}getResult(){let r=[];for(let e of Object.values(this.m_dictCurNode)){let t=e.getResult();t instanceof Array&&t.length<=0||r.push(t)}return r}},l2=class extends Bm{constructor(){super(...arguments),this.speed=new q(0,0)}move(r){this.bBox&&(this.bBox=new ye(this.bBox.minX+r.x,this.bBox.maxX+r.x,this.bBox.minY+r.y,this.bBox.maxY+r.y))}},gG=class extends Am{constructor(){super(...arguments),this.m_dictCombine={}}init(r){for(let e of r){let t=new l2;t.addChild(e),this.recordContains(e,t),this.m_dictCurNode[t.name]=t}}onIteration(){this.doAllNode()}doAllNode(){let r=[];for(let e of Object.values(this.m_dictCurNode)){if(e.name in this.m_dictCombine)continue;let t=e.getFlatChild(),n=this.m_funSearchChild(t);if(n.length<=0)continue;e.bBox||(e.bBox=this.m_funGetBox(t));for(let h of n){let f=this.m_dictContains[h];if(!f)continue;let d=Object.values(f);if(!(d.length<=0))for(let m of d)r.indexOf(m)<0&&r.push(m)}let i=new q(0,0),s=Math.min(e.bBox.width(),e.bBox.height())/Math.max(e.bBox.width(),e.bBox.height()),o=1/e.bBox.area()*s,a;for(let h of r){if(h.name===e.name||h.name in this.m_dictCombine)continue;h.bBox||(h.bBox=this.m_funGetBox(h.getFlatChild()));let f=Math.min(h.bBox.width(),h.bBox.height())/Math.max(h.bBox.width(),h.bBox.height());if(a=new l2,h.bBox.intersection1(e.bBox)&&s>=ne.AreaRate&&f>=ne.AreaRate){this.combineToNode(e,h,a),a.bBox=ye.extend2(e.bBox,h.bBox),this.m_dictCombine[e.name]=e,this.m_dictCombine[h.name]=e;break}let d=h.bBox.center().sub(e.bBox.center()),m=1/h.bBox.area()*f,p=o+m,g=ne.AttractG*(p/d.length());if(g)try{i=i.add(d.normalize().mul(g))}catch{}}if(a&&ne.DrawAttract&&ne.drawBBox(a.bBox),e.name in this.m_dictCombine||!o)continue;let l=i.mul(1/o),u=.016;e.speed=e.speed.add(l.mul(u));let c=e.speed.mul(u);e.move(c),ne.DrawAttract&&ne.drawBBox(e.bBox)}}},u2=class extends Bm{},xG=(ai=class extends Am{constructor(){super(...arguments),this.m_dictSeparate={}}static getEmpireKey(){return ai.IncreaseEmpire+=1,"E"+ai.IncreaseEmpire}init(e){for(let t of e){let n=new u2;n.addChild(t),this.recordContains(t,n),this.m_dictCurNode[n.name]=n}}onIteration(){if(ai.Debug&&console.log("\u5F00\u59CB\u4F18\u5316\u524D",this.m_dictCurNode),Object.keys(this.m_dictCurNode).length<=1){console.warn("\u9000\u51FA\u8FED\u4EE3\uFF1A\u53EA\u67091\u4E2A\u5E1D\u56FD");return}let e={};for(let o of Object.keys(this.m_dictCurNode)){let a=this.m_dictCurNode[o],l=a.value;l===void 0&&(l=this.m_funGetCurValue(a.getResult()),a.value=l),e[l]||(e[l]=[]),e[l].push(o)}let t=Object.keys(e);t.sort((o,a)=>parseInt(o)-parseInt(a));let n=t[0],i=e[n];if(i.length<=0){ne.LogEmpire&&console.warn("\u9000\u51FA\u8FED\u4EE3\uFF1A\u6CA1\u6709\u6B96\u6C11\u5730");return}let s=[];for(let o of i)s.push(this.m_dictCurNode[o]);for(let o of s){if(o.name in this.m_dictSeparate)continue;let a=2**32,l="None",u=[],c=o.getFlatChild(),h=this.m_funSearchChild(c);h.length<=0&&(this.m_dictSeparate[o.name]=1),ne.LogEmpire&&console.log("\u5904\u7406\u6B96\u6C11\u5730",o,c,h);for(let p of h){let g=this.m_dictContains[p];if(!g)continue;let b=Object.values(g);if(!(b.length<=0))for(let v of b)u.indexOf(v)<0&&u.push(v)}ai.Debug&&console.log("\u641C\u7D22\u90BB\u5C45",h,this.m_dictContains,"\u5F85\u6D4B\u8BD5\u5E1D\u56FD\u90BB\u5C45",u);for(let p of u){if(p.name===o.name)continue;let g=this.m_funCalCombineCost(o.getResult(),p.getResult());g<=a&&(a=g,l=p.name)}if(l==="None")continue;let f=this.m_dictCurNode[l],d=new u2;f&&o?(d.addChild(f),d.addChild(o)):console.error(l,this.m_dictCurNode,f,o),this.deleteContains(f),this.deleteContains(o),delete this.m_dictCurNode[f.name],delete this.m_dictCurNode[o.name],ai.Debug&&console.log("\u5408\u5E76\u533A\u5757",l,o.name,"\u521B\u5EFA\u5E1D\u56FD",d.name),this.m_dictCurNode[d.name]=d;let m=d.getFlatChild();for(let p of m)this.recordContains(p,d)}}},(()=>{ai.IncreaseEmpire=0})(),(()=>{ai.Debug=!1})(),ai),c2=class extends Bm{},bG=class extends Am{constructor(){super(...arguments),this.m_dictHandle={}}init(r){for(let e of r){let t=new c2;t.addChild(e),this.recordContains(e,t),this.m_dictCurNode[t.name]=t}}onIteration(){this.m_dictHandle={};let r=!1;for(let e=0;e<1e4;e++)if(r=this.doCurrentNode(),r)return}markHandle(r,e){this.m_dictHandle[r.name]=1}doCurrentNode(){let r=!1,e=[],t=Object.values(this.m_dictCurNode);for(let n of t){if(n.name in this.m_dictHandle)continue;let i=n.getFlatChild();if(i.length>=ne.LocalBestThread){this.markHandle(n,"\u5DF2\u7ECF\u8FBE\u5230\u6700\u5927\u6570\u91CF");continue}let s=this.m_funSearchChild(i);if(s.length<=0){this.markHandle(n,"\u65E0\u6CD5\u548C\u5468\u56F4\u5408\u5E76");continue}n.bBox||(n.bBox=this.m_funGetBox(i));for(let a of s){let l=this.m_dictContains[a];if(!l){this.markHandle(n,"\u65E0\u6CD5\u548C\u5468\u56F4\u5408\u5E76");continue}let u=Object.values(l);if(u.length<=0){this.markHandle(n,"\u65E0\u6CD5\u548C\u5468\u56F4\u5408\u5E76");continue}for(let c of u)e.indexOf(c)<0&&e.push(c)}let o=!1;for(let a of e){if(a.name===n.name||a.name in this.m_dictHandle||a.getFlatChild().length>=ne.LocalBestThread)continue;a.bBox||(a.bBox=this.m_funGetBox(a.getFlatChild()));let l=Math.min(n.bBox.width(),n.bBox.height())/Math.max(n.bBox.width(),n.bBox.height()),u=Math.min(a.bBox.width(),a.bBox.height())/Math.max(a.bBox.width(),a.bBox.height());if(n.bBox.intersection1(a.bBox)&&l>=ne.AreaRate&&u>=ne.AreaRate){if(o=!0,this.markHandle(a,"\u5408\u5E76\u5230\u4E86\u5F53\u524D\u8282\u70B9"),a.isLeaf())this.combineToFirst(n,a),n.bBox=ye.extend2(n.bBox,a.bBox),i.length>ne.LocalBestThread&&this.markHandle(n,"\u5DF2\u7ECF\u8FBE\u5230\u6700\u5927\u6570\u91CF");else{let c=new c2;this.combineToNode(n,a,c),c.bBox=ye.extend2(n.bBox,a.bBox)}r=!0;break}}if(!o){this.markHandle(n,"\u5468\u56F4\u6CA1\u6709\u63A5\u89E6\u70B9");continue}}return r}},yG=class extends n2{},wh=class km extends i2{static permute(e){let t=[];function n(i,s){if(i===s)t.push([...e]);else for(let o=i;o<=s;o++)[e[i],e[o]]=[e[o],e[i]],n(i+1,s),[e[i],e[o]]=[e[o],e[i]]}return n(0,e.length-1),t}static permuteNum(e){let t=[];function n(i,s){if(i===s)t.push([...e]);else for(let o=i;o<=s;o++)[e[i],e[o]]=[e[o],e[i]],n(i+1,s),[e[i],e[o]]=[e[o],e[i]]}return n(0,e.length-1),t}static permuteString(e){let t=[];function n(i,s){if(i===s)t.push([...e]);else for(let o=i;o<=s;o++)[e[i],e[o]]=[e[o],e[i]],n(i+1,s),[e[i],e[o]]=[e[o],e[i]]}return n(0,e.length-1),t}static shuffleTime(e,t){if(e.length<=4)return this.permuteString(e);let n=[];for(let i=0;i<t;i++)n.push(this.shuffle(e));return n}static shuffle(e){let t=[...e],n=t.length;for(let i=n-1;i>0;i--){let s=Math.floor(Math.random()*(i+1));[t[i],t[s]]=[t[s],t[i]]}return t}init(e){let t=[];for(let i of e){let s=new yG;s.addChild(i),t.push(s)}let n=km.permute(t);for(let i of n)this.m_dictSolution[ne.getOptimizeKey()]=i}onIteration(){let e=4294967296;for(let t of Object.values(this.m_dictSolution)){ne.TotalCalNum+=1;let n=this.getResult(t),i=this.m_funCalTotal(n);i<=e&&(e=i,this.m_listFinalNode=t)}}static optimize(e,t){let n=4294967296,i=km.permute(e),s=e;for(let o of i){ne.TotalCalNum+=1;let a=t(o);a<=n&&(n=a,s=o)}return s}},vG=class{constructor(r,e){this.index=r,this._bbox=e}bbox(){return this._bbox}},wG=class P2{constructor(e,t,n){this.dictChild={},this.listItem=[],this.bBox=null,this.parent=null,this.capacity=e,this.maxLevel=t,this.bBox=n}split(){if(this.listItem.length<=0||this.listItem.length<=this.capacity||this.level>=this.maxLevel)return;let e=this.bBox.center(),t=this.bBox.width(),n=this.bBox.height(),i=(s,o)=>{let a=e.add(new q(t/2*s,n/2*o)),l=Math.min(a.x,e.x),u=Math.min(a.y,e.y),c=Math.max(a.x,e.x),h=Math.max(a.y,e.y),f=new ye(l,c,u,h),d=new P2(this.capacity,this.maxLevel,f);d.level=this.level+1,d.parent=this;let m=s+"_"+o;this.dictChild[m]=d};for(let s of this.listItem){let o=s.bbox().center().sub(e),a=o.x/Math.abs(o.x),l=o.y/Math.abs(o.y);a||(a=-1,Math.random()>.5&&(a=1)),l||(l=-1,Math.random()>.5&&(l=1));let u=a+"_"+l;u in this.dictChild||i(a,l),this.dictChild[u].insert([s])}for(let s of Object.values(this.dictChild))s.split();this.listItem=[]}insert(e){for(let t of e)this.listItem.push(t)}},h2=class Sa{constructor(e){this.capacity=e}build(e){let t=e[0].bbox();for(let n=1;n<e.length;n++){let i=e[n];t=ye.extend2(t,i.bbox())}this.root=new wG(this.capacity,100,t),this.root.level=1,this.root.insert(e),this.root.split()}static createNode(e,t,n){let i=e.UL(),s=e.width()/t,o=e.height()/t,a=~~(n/t),l=n-a*t,u=i.x+l*s,c=i.y-(a+1)*o,h=u+s,f=c+o;return new ye(u,h,c,f)}static ocTreeSplitNode(e,t,n,i,s=2){if(e.length<=n)return e;let o=[],a=s**2,l=new Array(a),u=new Array(a);for(let d=0;d<a;d++)l[d]=new Array(e.length),u[d]=0;let c=t.UL(),h=t.width()/s,f=t.height()/s;for(let d of e){let m=i(d).center(),p=~~((m.x-c.x)/h),g=~~((c.y-m.y)/f)*s+p;try{l[g][u[g]]=d,u[g]+=1}catch{o.push(d)}}for(let d=0;d<l.length;d++){let m=u[d];if(m<=0)continue;let p=l[d].slice(0,m);if(p.length===e.length)return e;let g=Sa.createNode(t,s,d),b=Sa.ocTreeSplitNode(p,g,n,i,s);if(b.length===e.length)return e;o.push(b)}return o}static ocTreeSplitNodeMinIntersect(e,t,n,i){let s=[];if(e.length<=n)return e;let o=3,a=t.LL(),l=t.UR(),u=t.width()/(o+1),c=t.height()/(o+1),h=-(2**32),f=[],d=[];for(let m=1;m<=o;m++)for(let p=1;p<=o;p++){let g=a.x+u*m,b=a.y+c*p,v=[[],[],[],[]],w=new Array(4),P=new Array(4);P[0]=new ye(a.x,g,b,l.y),P[1]=new ye(g,l.x,b,l.y),P[2]=new ye(a.x,g,a.y,b),P[3]=new ye(g,l.x,a.y,b);for(let C of e){let N=i(C).center(),A=-1,M=-1;N.x===g?A=Math.random()>=.5?1:-1:N.x>g?A=1:N.x<g&&(A=-1),N.y===b?M=Math.random()>=.5?1:-1:N.y>b?M=1:N.y<b&&(M=-1),A===1&&M===1?v[1].push(C):A===1&&M===-1?v[3].push(C):A===-1&&M===-1?v[2].push(C):A===-1&&M===1&&v[0].push(C)}for(let C=0;C<4;C++){let N=v[C];if(N.length<=0)continue;let A=new Oe;for(let M of N)A.ext1(i(M));w[C]=A.build1()}let _=0,B=0;for(let C of w)C&&(_+=C.area());B=_;let I=(C,N)=>{if(!w[C]||!w[N])return 0;let A=w[C].intersection1(w[N]);return A?A.area():0};B-=I(0,1),B-=I(0,2),B-=I(0,3),B-=I(1,2),B-=I(1,3),B-=I(2,3),B/_>=h&&(f=v,d=P)}for(let m=0;m<f.length;m++){let p=f[m];if(p.length<=0)continue;let g=d[m],b;if(p.length===e.length?b=Sa.ocTreeSplitNode(p,g,n,i):b=Sa.ocTreeSplitNodeMinIntersect(p,g,n,i),b.length===e.length)return e;s.push(b)}return s}static ocTreeSplit(e,t,n,i){return Sa.ocTreeSplitNode(e,t,n,i,ne.OcTreeSplitStep)}},d2=class{constructor(r){this.bheap=new Array,this.count=0,this.comp=r}size(){return this.count}add(r){this.count>0?this.siftUp(this.count,r):this.bheap[0]=r,this.count++}remove(r){let e=this.bheap.indexOf(r);e>-1&&(this.bheap.splice(e,1),this.count--),this.count<0&&(this.count=0)}poll(){for(;;)if(this.count>0){this.count--;let r=this.bheap[0];return this.count>0&&this.siftDown(0,this.bheap[this.count]),r}else return null}siftUp(r,e){for(;r>0;){let t=r-1>>>1,n=this.bheap[t];if(this.comp(e,n)>=0)break;this.bheap[r]=n,r=t}this.bheap[r]=e}siftDown(r,e){let t=this.count>>>1;for(;r<t;){let n=(r<<1)+1,i=this.bheap[n],s=n+1;if(s<this.count){let o=this.bheap[s];this.comp(i,o)>0&&(n=s,i=o)}if(this.comp(e,i)<=0)break;this.bheap[r]=i,r=n}this.bheap[r]=e}},f2=class Bh{static createNode(e,t,n,i){let s=e.UL();if(n){let o=e.width()/t,a=s.x+i*o,l=a+o;return new ye(a,l,e.minY,e.maxY)}else{let o=e.height()/t,a=s.y-(i+1)*o,l=a+o;return new ye(e.minX,e.maxX,a,l)}}static kdTreeSplitNode(e,t,n,i,s,o,a=2){if(e.length<=n)return e;let l=[],u=a,c=new Array(u),h=new Array(u);for(let d=0;d<u;d++)h[d]=new Array(e.length),c[d]=0;let f=t.UL();if(i){let d=t.width()/a;for(let m of e){let p=~~((s(m).center().x-f.x)/d);try{h[p][c[p]]=m,c[p]+=1}catch{l.push(m)}}}else{let d=t.height()/a;for(let m of e){let p=s(m).center(),g=~~((f.y-p.y)/d);try{h[g][c[g]]=m,c[g]+=1}catch{l.push(m)}}}for(let d=0;d<h.length;d++){let m=c[d];if(m<=0)continue;let p=h[d].slice(0,m);if(p.length===e.length)return e;let g=Bh.createNode(t,a,i,d),b=Bh.kdTreeSplitNode(p,g,n,i,s,o,a);if(b.length===e.length)return e;l.push(b)}return l}static kdTreeSplit(e,t,n,i,s,o){return Bh.kdTreeSplitNode(e,t,n,i,s,o,ne.KDTreeSplitStep)}},EG=(hr=class{static getGridId(e,t){return`${e}_${t}`}static getVecGrid(e){let t=e.split("_");return new q(parseInt(t[0]),parseInt(t[1]))}static initGrid(e,t){hr.dictGridKey2Group={},hr.dictGroupKey2Grid={};let n=ne.UnionSplitGridSize,i=new Oe;for(let o of e){let a=t(o);i.ext1(a)}let s=i.build1();hr.posStart=s.UL();for(let o of e){let a=t(o),l=~~((a.minX-hr.posStart.x)/n),u=~~((a.maxX-hr.posStart.x)/n),c=~~((hr.posStart.y-a.minY)/n),h=~~((hr.posStart.y-a.maxY)/n),f=[];for(let d=l;d<=u;d++)for(let m=h;m<=c;m++){let p=hr.getGridId(d,m);f.push(p),p in this.dictGridKey2Group||(this.dictGridKey2Group[p]=[]),this.dictGridKey2Group[p].push(o)}this.dictGroupKey2Grid[o.toString()]=f}}static filterTotalContain(e,t){let n=Object.keys(hr.dictGroupKey2Grid),i={},s={};return[]}static release(){hr.dictGridKey2Group={},hr.dictGroupKey2Grid={}}static getGroupConnect(e,t,n){if(e in t)return;t[e]=1,n.push(e);let i=hr.dictGroupKey2Grid[e];for(let s of i){let o=hr.dictGridKey2Group[s];for(let a of o)a in t||hr.getGroupConnect(a,t,n)}}static gridSplit(e,t){hr.initGrid(e,t);let n=[],i={};for(let s of e){let o=[];this.getGroupConnect(s,i,o),o.length>0&&n.push(o)}return n}},(()=>{hr.dictGroupKey2Grid={}})(),(()=>{hr.dictGridKey2Group={}})(),hr),Ea=class{constructor(r,e){this.index=r,this._bbox=e}bbox(){return this._bbox}},$le=class{constructor(r,e){this.index=r,this._bbox=e}bbox(){return this._bbox}},jle=class extends vG{},_G=class Qr{constructor(e,t=""){this.listChild=[],this.row=0,this.column=0,this.listWidth=[],this.lineNum=0,this.dictGridInfo={},this.dictCostSave={},this.getArrangePolygonType=(n,i)=>{let s=[];for(let o of n)if(Array.isArray(o)){let a=this.getArrangePolygonType(o,i);s=s.concat(a)}else try{let a=i[o].getAllPolygonType();s=s.concat(a)}catch{console.error("\u8F93\u5165\u9519\u8BEF, \u53EF\u80FD\u6CA1\u6709\u4ECE\u4F18\u5316\u8282\u70B9\u4E2D\u62FFgetResult")}return s},this.tree=e,this.name=ne.getNodeKey()}setPolygon(e){this.polygon=e,this.polygon.name=ne.getPolyTypeKey()}setParent(e,t=!1){if(e!==this){this.parent=e,t||(this.operator=e.operator,e.listChild.push(this),this.dictTotalInfo=e.dictTotalInfo),this.row=e.row+1;for(let n of this.listChild)n!==this&&n.parent!==this&&n.setParent(this,!0)}}readToNode(e){if(e.length<1)return;let t=e[0];switch(t!==void 0&&(this.operator=t),t){case 0:case 1:case 3:case 2:let n=e.slice(1,e.length);if(n.length<=0)return;for(let i of n){let s=new Qr(this.tree);s.setParent(this),Array.isArray(i)?s.readToNode(i):(s.polygon=i,s.polygon.name=ne.getPolyTypeKey(),s.operator=this.operator)}break;default:throw new Error("\u4E0D\u652F\u6301\u5F53\u524D\u5E03\u5C14\u8FD0\u7B97:"+t)}}getTotalWidth(){let e=0;for(let t of this.listWidth)e+=t;return e}updateWidth(){function e(n){if(!n)return 1;n.listWidth=[];for(let i of n.listChild)n.listWidth.push(e(i));return Math.max(n.getTotalWidth(),1)}e(this);function t(n){if(!n)return 0;if(n.parent){let i=n.parent.listChild.indexOf(n),s=n.parent.column-n.parent.getTotalWidth()/2;for(let o=0;o<i;o++)s+=n.parent.listWidth[o];s+=n.getTotalWidth()/2,n.column=s}for(let i of n.listChild)t(i)}t(this)}static getNodeListPolygonType(e){let t=[];for(let n of e){let i=n.getAllPolygonType();for(let s of i)t.push(s)}return t}getAllPolygonType(){if(this.polygon)return[this.polygon];let e=[];for(let t of this.listChild)e=e.concat(t.getAllPolygonType());return e}evaluateMultiDimension(){let e={};for(let t of this.listChild){let n=t.evaluateMultiDimension();for(let i of Object.keys(n)){e[i]===void 0&&(e[i]=0);let s=e[i]+n[i];e[i]=s}}if(this.operator===1){let t=[];for(let n=0;n<this.listChild.length;n++){let i=this.listChild[n],s=Qr.getNodeListPolygonType(t),o=Qr.getNodeListPolygonType([i]),a=[];for(let u of t)a.push(u.name);let l=ne.evaluateCostMulti(s,o);t.push(i);for(let u of Object.keys(l)){e[u]===void 0&&(e[u]=0);let c=e[u]+l[u];e[u]=c}}}return e}evaluateSingleDimension(){let e=0;for(let t of this.listChild){let n=t.evaluateSingleDimension();e+=n}if(this.operator===1){let t=[];for(let n=0;n<this.listChild.length;n++){let i=this.listChild[n],s=Qr.getNodeListPolygonType(t),o=Qr.getNodeListPolygonType([i]),a=[];for(let u of t)a.push(u.name);let l=tt.evaluateCostSingle(s,o);t.push(i),e+=l}}return e}getTotalInfo(){if(this.dictTotalInfo)return this.dictTotalInfo;let e=this.getAllPolygonType();if(e.length<=0)this.dictTotalInfo={name:this.name,area:0,avgArea:0,polygonTypeNum:0,lineNum:0,avgLineNum:0};else{let t=e[0].bbox(),n=0;for(let i=0;i<e.length;i++){i>=1&&(t=ye.extend2(t,e[i].bbox()));let s=tt.getPolyTypeLine(e[i]);n+=s.length}this.dictTotalInfo={name:this.name,area:t.area(),avgArea:t.area()/e.length,polygonTypeNum:e.length,lineNum:n,avgLineNum:n/e.length}}return this.dictTotalInfo}getGridInfo(e=ne.GridSize){if(Object.keys(this.dictGridInfo).length>0)return this.dictGridInfo;if(ne.markStart("\u7F51\u683C"+this.name),this.polygon){let t=tt.getPolyTypeLine(this.polygon);if(this.dictGridInfo=tt.createGrid(t,e),ne.DrawGrid)for(let n of Object.keys(this.dictGridInfo)){let i=n.split("_"),s=parseInt(i[0]),o=parseInt(i[1]),a=ne.StartGrid.x+e*s,l=ne.StartGrid.y+e*o;ne.drawBBox(new ye(a-e/2,a+e/2,l-e/2,l+e/2))}}else for(let t of this.listChild){let n=t.getGridInfo(e);for(let i of Object.keys(n))this.dictGridInfo[i]=n[i]}return ne.addMarkTime("\u521D\u59CB\u5316\u7F51\u683C",ne.markEnd("\u7F51\u683C"+this.name)),this.dictGridInfo}getNodeBBox(){if(this.bBox)return this.bBox;if(this.polygon)return this.bBox=this.polygon.bbox(),this.polygon.bbox();if(!this.listChild||this.listChild.length<=0)return;let e=new Oe;this.listChild[0].getNodeBBox();for(let t=0;t<this.listChild.length;t++)e.ext1(this.listChild[t].getNodeBBox());return this.bBox=e.build1(),this.bBox}getNodeLineNum(){if(this.lineNum)return this.lineNum;if(this.polygon)return this.lineNum=tt.getPolyTypeLine(this.polygon).length,this.lineNum;if(!this.listChild||this.listChild.length<=0)return 0;this.lineNum=0;for(let e=1;e<this.listChild.length;e++)this.lineNum+=this.listChild[e].getNodeLineNum();return this.lineNum}getPos(e){return new q(this.column*ne.PrintGrid,-this.row*ne.PrintGrid).add(e)}print(e){if(this.polygon&&(ne.DrawRect&&ne.drawPolyType(this.polygon,it.GREEN),ne.DrawRect&&ne.drawText(this.polygon.bbox().UL(),this.polygon.name)),ne.DrawBoolTree){ne.DrawBoolTreeBBox&&(ne.drawBBox(this.getNodeBBox()),ne.drawText(this.getNodeBBox().UL(),this.name));let t=this.name+" "+ne.translate(this.operator);this.polygon&&(t+=this.polygon.name);let n=this.getPos(e);if(ne.drawText(n,t),this.parent){let i=this.parent.getPos(e),s=new Y(i,n),o=new Array;o.push(s);let a=Ce.build1($c(o));ne.drawPolyType(a,it.GREEN)}}for(let t of this.listChild)t.print(e)}optimizeSplit(){if(this.operator===2&&this.listChild.length>2){let e=this.listChild[0],t=this.listChild.slice(1),n=new Qr(this.tree,"\u51CF\u64CD\u4F5C\u53F3\u8282\u70B9");n.operator=1;for(let i of t)i.setParent(n);this.listChild=[],e.setParent(this),n.setParent(this)}if(this.listChild.length>ne.LocalBestThread)switch(ne.SplitType){case"RTree":this.RTreeSplit();break;case"OcTree":this.OcTreeSplit();break;case"KDTree":this.KDTreeSplit();break;default:break}for(let e of this.listChild)e.optimizeSplit()}optimizeRandom(e){for(let t of this.listChild)t.optimizeRandom(e);if(ne.NoOptimizePureTreeNode){let t=!1;for(let n of this.listChild)if(n.polygon){t=!0;break}if(!t)return}if(this.operator===1)switch(ne.TotalNodeNum+=1,ne.OptimizeType){case"Force":this.optimizeByForce();break;case"SA":this.optimizeBySA();break;case"Calculate":this.optimizeByCalculate(e);break;case"SACalculate":this.optimizeBySACalculate(e);break;default:break}}optimizeByForce(){let e=[],t=[],n=this.listChild;if(n.length>1)for(let o=0;o<n.length;o++){let a=n[o],l=!1;for(let u of n)if(a.name!==u.name&&a.getNodeBBox().isIntersect(u.getNodeBBox())){l=!0;break}l?e.push(o):t.push(o)}else for(let o=0;o<n.length;o++)e.push(o);let i=o=>{let a=o.join("_");if(a in this.dictCostSave)return this.dictCostSave[a];let l=0,u=[],c="";for(let h=0;h<o.length;h++){let f=o[h];h===0?c+=f:c=c+"_"+f;let d=n[f];if(c in this.dictCostSave)l+=this.dictCostSave[c];else{let m=0;switch(ne.EvaluateType){case"BBox":m=tt.evaluateCostNodeListBBox(u,d);break;case"Grid":m=tt.evaluateCostNodeListGrid(u,d);break;case"Combo":m=tt.evaluateCostNodeListCombo(u,d);break;default:break}this.dictCostSave[c]=m,l+=m}u.push(d)}return this.dictCostSave[a]=l,l},s=wh.optimize(e,i);this.listChild=[];for(let o of s)this.listChild.push(n[o]);for(let o of t)this.listChild.push(n[o])}optimizeBySA(){let e=[],t=[],n=this.listChild;if(n.length>1)for(let s=0;s<n.length;s++){let o=n[s],a=!1;for(let l of n)if(o.name!==l.name&&o.getNodeBBox().isIntersect(l.getNodeBBox())){a=!0;break}a?e.push(s):t.push(s)}else for(let s=0;s<n.length;s++)e.push(s);this.listChild=[];let i=s=>{let o=s.join("_");if(o in this.dictCostSave)return this.dictCostSave[o];let a=0,l=[],u="";for(let c=0;c<s.length;c++){let h=s[c];c===0?u+=h:u=u+"_"+h;let f=n[h];if(u in this.dictCostSave)a+=this.dictCostSave[u];else{let d=0;switch(ne.EvaluateType){case"BBox":d=tt.evaluateCostNodeListBBox(l,f);break;case"Grid":d=tt.evaluateCostNodeListGrid(l,f);break;case"Combo":d=tt.evaluateCostNodeListCombo(l,f);break;default:break}this.dictCostSave[u]=d,a+=d}l.push(f)}return this.dictCostSave[o]=a,a};if(e.length>=3){let s;if(e.length===3||e.length===4)s=wh.optimize(e,i);else{let o=ne.Temperature,a=ne.CoolingRate;s=yh.optimize(e,o,a,i)}for(let o of s)this.listChild.push(n[o]);for(let o of t)this.listChild.push(n[o])}else this.listChild=n}optimizeByCalculate(e){if(this.polygon)return;let t=new d2((i,s)=>{let o=tt.getPolyTypeLine(i.polygon).length,a=tt.getPolyTypeLine(s.polygon).length;return o-a});for(let i of this.listChild)i.polygon?t.add(i):console.error("\u5B58\u5728\u6811\u8282\u70B9");if(t.size()<=0){console.error("\u5168\u662F\u6811\u8282\u70B9");return}for(;t.size()>1;){let i=t.poll(),s=t.poll(),o=[1,i.polygon,s.polygon],a=On(o,e);if(!a)return;a.name=ne.getPolyTypeKey();let l=new Qr(this.tree);l.setParent(this),l.polygon=a,t.add(l)}let n=t.poll();this.listChild=[],this.polygon=n.polygon}optimizeBySACalculate(e){if(this.polygon)return;for(let i of this.listChild)i.polygon||console.error("\u5B58\u5728\u6811\u8282\u70B9");this.optimizeBySA();let t=this.getSimplifyRules(),n=On(t,e);n.name=ne.getPolyTypeKey(),this.listChild=[],this.polygon=n}getListChildName(){let e=[];for(let t of this.listChild)e.push(t.name);return e.join(",")}RTreeSplit(){if(this.operator!==1)return;if(!this.rTreeLocalBest){this.rTreeLocalBest=new vh(ne.LocalBestThread);for(let s=0;s<this.listChild.length;s++){let o=this.listChild[s];this.rTreeLocalBest.insert(new Ea(s,o.getNodeBBox()))}this.rTreeLocalBest.flushWhenNeed()}let e=s=>{if(ne.drawBBox(s.bbox()),!(s instanceof Ea)&&s.childs)for(let o of s.childs)e(o)};ne.DrawSplitRect&&e(this.rTreeLocalBest.root);let t={},n=this.listChild,i=(s,o)=>{if(!(!s.childs||s.childs.length<=0))if(s.childs[0]instanceof Ea){let a=[];for(let l of s.childs){let u=l;if(u.index in t)continue;t[u.index]=1;let c=n[u.index];a.push(c)}for(let l of a)l.setParent(o)}else for(let a of s.childs){let l=new Qr(o.tree,"\u5B50\u8282\u70B9");l.setParent(o),i(a,l)}};this.listChild=[],i(this.rTreeLocalBest.root,this)}OcTreeSplit(){if(this.operator!==1)return;let e=this.listChild;{let t=[];for(let s=0;s<e.length;s++)t.push(s);let n=h2.ocTreeSplit(t,this.getNodeBBox(),ne.LocalBestThread,s=>e[s].getNodeBBox()),i=(s,o)=>{if(!(s&&s.length<=0))for(let a of s)if(Array.isArray(a)){let l=new Qr(o.tree,"\u5B50\u8282\u70B9");l.setParent(o),i(a,l)}else e[a].setParent(o)};this.listChild=[],i(n,this)}}KDTreeSplit(){if(this.operator!==1)return;let e=this.listChild,t=[];for(let s=0;s<e.length;s++)t.push(s);let n=f2.kdTreeSplit(t,this.getNodeBBox(),ne.LocalBestThread,!0,s=>e[s].getNodeBBox(),s=>""),i=(s,o)=>{if(!(s&&s.length<=0))for(let a of s)if(Array.isArray(a)){let l=new Qr(o.tree,"\u5B50\u8282\u70B9");l.setParent(o),i(a,l)}else e[a].setParent(o)};this.listChild=[],i(n,this)}EmpireSplit(){let e=this.listChild;this.listChild=[];let t=h=>{let f=[];for(let d of h)if(Array.isArray(d)){let m=t(d);f=f.concat(m)}else{let m=e[d].getAllPolygonType();f=f.concat(m)}return f},n=(h,f)=>{let d=t(h),m=t(f);return tt.evaluateCostSingle(d,m)},i=h=>{let f=t(h);return ne.getPolygonValue(f)},s="\u5EFA\u6811"+this.name;ne.markStart(s),this.rTreeLocalBest=new vh(ne.LocalBestThread);for(let h=0;h<e.length;h++){let f=e[h];this.rTreeLocalBest.insert(new Ea(h,f.getNodeBBox()))}this.rTreeLocalBest.flushWhenNeed(),ne.markEnd(s);let o=[];for(let h=0;h<e.length;h++)o.push(h);let a=h=>{let f=[];for(let b of h){let v=e[b];v||console.error("\u4E0D\u662F\u5B50\u8282\u70B9",b),f=f.concat(v.getAllPolygonType())}if(f.length<=0)return[];let d=f[0].bbox();for(let b=1;b<f.length;b++)d=ye.extend2(d,f[b].bbox());let m=d.extendOfSize(Math.min(d.width()*ne.ExtendRate,d.height()*ne.ExtendRate)),p=this.rTreeLocalBest.search(m),g=[];for(let b of p)g.push(b.index);return p.length<=1?[]:g},l=new xG(this.name,{funSearchChild:a,funGetValue:i,funCalCombineCost:n});l.init(o);let u=l.run(),c=(h,f)=>{for(let d of h)if(Array.isArray(d)){if(d.length<=0)continue;let m=new Qr(this.tree);m.setParent(f),c(d,m)}else e[d].setParent(f)};c(u,this)}AttractSplit(){let e=this.name+"\u5F15\u529B\u62C6\u5206";ne.markStart(e);let t=this.listChild;this.listChild=[];let n=d=>{let m=[];for(let p of d)if(Array.isArray(p)){let g=n(p);m=m.concat(g)}else{let g=t[p].getAllPolygonType();m=m.concat(g)}return m},i=(d,m)=>{let p=n(d),g=n(m);return tt.evaluateCostSingle(p,g)},s=d=>{let m=n(d);return ne.getPolygonValue(m)},o="\u5EFA\u6811"+this.name;ne.markStart(o),this.rTreeLocalBest=new vh(ne.LocalBestThread);for(let d=0;d<t.length;d++){let m=t[d];this.rTreeLocalBest.insert(new Ea(d,m.getNodeBBox()))}this.rTreeLocalBest.flushWhenNeed(),ne.markEnd(o);let a=d=>{let m=[];for(let w of d){let P=t[w];P||console.error("\u4E0D\u662F\u5B50\u8282\u70B9",w),m=m.concat(P.getAllPolygonType())}if(m.length<=0)return[];let p=m[0].bbox();for(let w=1;w<m.length;w++)p=ye.extend2(p,m[w].bbox());let g=p.extendOfSize(Math.min(p.width()*ne.ExtendRate,p.height()*ne.ExtendRate)),b=this.rTreeLocalBest.search(g),v=[];for(let w of b)v.push(w.index);return b.length<=1?[]:v},l=[];for(let d=0;d<t.length;d++)l.push(d);let u=d=>{let m=[];for(let g of d){let b=t[g];b||console.error("\u4E0D\u662F\u5B50\u8282\u70B9",g),m=m.concat(b.getAllPolygonType())}if(m.length<=0)return[];let p=m[0].bbox();for(let g=1;g<m.length;g++)p=ye.extend2(p,m[g].bbox());return p},c=new gG(this.name,{funSearchChild:a,funGetValue:s,funCalCombineCost:i,funGetBBox:u});c.init(l);let h=c.run(),f=(d,m)=>{for(let p of d)if(Array.isArray(p)){if(p.length<=0)continue;let g=new Qr(this.tree);g.setParent(m),f(p,g)}else t[p].setParent(m)};f(h,this),ne.markEnd(e)}BBoxSplit(){let e=this.name+"BBox";this.listChild.sort((u,c)=>u.getNodeBBox().center().x-c.getNodeBBox().center().x);let t=this.listChild;this.listChild=[];let n="\u5EFA\u6811"+this.name;ne.markStart(n),this.rTreeLocalBest=new vh(ne.LocalBestThread);for(let u=0;u<t.length;u++){let c=t[u];this.rTreeLocalBest.insert(new Ea(u,c.getNodeBBox()))}this.rTreeLocalBest.flushWhenNeed(),ne.markEnd(n),ne.markStart(e);let i=[];for(let u=0;u<t.length;u++)i.push(u);let s=u=>{let c=[];for(let p of u){let g=t[p];g||console.error("\u4E0D\u662F\u5B50\u8282\u70B9",p),c=c.concat(g.getAllPolygonType())}if(c.length<=0)return[];let h=c[0].bbox();for(let p=1;p<c.length;p++)h=ye.extend2(h,c[p].bbox());let f=h.extendOfSize(Math.min(h.width()*ne.ExtendRate,h.height()*ne.ExtendRate)),d=this.rTreeLocalBest.search(f),m=[];for(let p of d)m.push(p.index);return d.length<=1?[]:m},o=u=>{let c=[];for(let f of u){let d=t[f];d||console.error("\u4E0D\u662F\u5B50\u8282\u70B9",f),c=c.concat(d.getAllPolygonType())}if(c.length<=0)return[];let h=c[0].bbox();for(let f=1;f<c.length;f++)h=ye.extend2(h,c[f].bbox());return h},a=new bG(this.name,{funSearchChild:s,funGetBBox:o});a.init(i);let l=a.runOnce();this.readArrangeResult(l,this,t),ne.markEnd(e)}getArrangeGridInfo(e,t,n){if(e.length<=0)return{};let i={};for(let s of e)if(Array.isArray(s)){let o=this.getArrangeGridInfo(s,t,n);for(let a of Object.keys(o))i[a]=t}else{let o=n[s];if(!o)console.error("\u8F93\u5165\u9519\u8BEF, \u53EF\u80FD\u6CA1\u6709\u4ECE\u4F18\u5316\u8282\u70B9\u4E2D\u62FFgetResult");else{let a=performance.now(),l=o.getGridInfo();ne.addMarkTime("\u8282\u70B9\u83B7\u53D6\u7F51\u683C",performance.now()-a);let u=performance.now();for(let c in Object.keys(l))i[c]=t;ne.addMarkTime("\u8BBE\u7F6Ekey",performance.now()-u),ne.addMarkTime("\u8282\u70B9\u83B7\u53D6\u7F51\u683C\u603B\u65F6\u95F4",performance.now()-a)}}return i}readArrangeResult(e,t,n){for(let i of e)if(Array.isArray(i)){if(i.length<=0)continue;let s=new Qr(this.tree);s.setParent(t),this.readArrangeResult(i,s,n)}else n[i].setParent(t)}getSimplifyRules(){if(this.listChild.length<=0)return this.polygon?[this.operator,this.polygon]:[this.operator];{let e=[];for(let t of this.listChild)e.push(t.getSimplifyRules());return[this.operator,...e]}}},PG=class S2{static fromRules(e){ne.LogRule&&console.warn("\u5E03\u5C14\u8FD0\u7B97\u8868\u8FBE\u5F0F",e);let t=new S2;return t.root=new _G(t),t.root.readToNode(e),t}print(e,t){this.root.updateWidth(),t.print(e),ne.DrawBoolTree&&ne.LogTree&&console.log("\u5E03\u5C14\u8FD0\u7B97\u6811",this)}getSimplifyRules(e){let t=500;if(ne.DrawBoolTree&&this.print(ne.PrintStart.add(new q(0,0)),this.root),ne.EvaluateRaw){ne.markStart("\u539F\u59CB\u8BC4\u4F30");let o=this.root.evaluateMultiDimension();for(let a of Object.keys(o))ne.addEvaluateValue("\u539F\u59CB\u8BC4\u4F30",a,o[a]);ne.markEnd("\u539F\u59CB\u8BC4\u4F30")}ne.UseOptimizeSplit&&(ne.markStart("\u62C6\u5206\u8282\u70B9"),this.root.optimizeSplit(),ne.DrawBoolTree&&this.print(ne.PrintStart.add(new q(t,0)),this.root),ne.addMarkTime("\u5206\u6CBB\u65F6\u95F4",ne.markEnd("\u62C6\u5206\u8282\u70B9"))),ne.UseRandomOptimize&&(ne.markStart("\u968F\u673A\u4F18\u5316"),this.root.optimizeRandom(e),ne.addMarkTime("\u968F\u673A\u4F18\u5316\u603B\u65F6\u95F4",ne.markEnd("\u968F\u673A\u4F18\u5316")),ne.DrawBoolTree&&this.print(ne.PrintStart.add(new q(t*2,0)),this.root));let n=this.root.getSimplifyRules(),i=200,s=new q(0,-i);return ne.PrintStart=ne.PrintStart.add(s),n}},SG=class Si{static getPolygonType(e){let t=[];for(let n of e)if(Array.isArray(n)){let i=Si.getPolygonType(n.slice(1));for(let s of i)t.push(s)}else t.push(n);return t}static simplifyRules(e,t){return ne.UseOptimizeSplit&&(ne.markStart("\u62C6\u5206\u8282\u70B9"),e=this.optimizeSplit(e,t),ne.addMarkTime("\u5206\u6CBB\u65F6\u95F4",ne.markEnd("\u62C6\u5206\u8282\u70B9"))),ne.UseRandomOptimize&&(ne.markStart("\u968F\u673A\u4F18\u5316"),e=this.optimizeRandom(e,t),ne.addMarkTime("\u968F\u673A\u4F18\u5316\u603B\u65F6\u95F4",ne.markEnd("\u968F\u673A\u4F18\u5316"))),e}static OcTreeOptimizeSplit(e){let t=e[0];if(t!==1||e.length<=ne.LocalBestThread+1)return e;let n=e.slice(1),i=new Array(n.length);for(let u=1;u<e.length;u++)i[u-1]=u;let s=tt.getListBBox(n),o=h2.ocTreeSplit(i,s,ne.LocalBestThread,u=>{let c=e[u];return tt.getSingleBBox(c)}),a=(u,c)=>{if(!(u.length<=0))for(let h of u)if(Array.isArray(h)){let f=[c[0]];a(h,f),c.push(f)}else{let f=e[h];c.push(f)}},l=[t];return a(o,l),l}static KDTreeOptimizeSplit(e,t){let n=e[0];if(n!==1||e.length<=2)return e;let i=e.slice(1),s=new Array(i.length);for(let c=1;c<e.length;c++)s[c-1]=c;let o=tt.getListBBox(i),a=f2.kdTreeSplit(s,o,2,t,c=>{let h=e[c];return tt.getSingleBBox(h)},c=>e[c].name),l=(c,h)=>{if(!(c.length<=0))for(let f of c)if(Array.isArray(f)){let d=[h[0]];l(f,d),h.push(d)}else{let d=e[f];h.push(d)}},u=[n];return l(a,u),u}static optimizeSplit(e,t){let n=e[0];if(n===2){if(ne.HandleDiff){let s=e[1],o;if(Array.isArray(s)){let a=this.optimizeSplit(s,t);if(a.length<=1)return[2];o=On(a,t)}else o=On([2,s],t);if(e.length>3){let a;a=[1];for(let l=2;l<e.length;l++){let u=e[l];if(Array.isArray(u)){let c=tt.getListBBox([...u.slice(1)]);tt.KeepBBoxPolygonGroup(c,o)&&a.push(u)}else tt.KeepBBoxPolygonGroup(u.bbox(),o)&&a.push(u)}return a.length<=1?[2,o]:(a=this.optimizeSplit(a,t),a.length>1?[2,o,...a.slice(1)]:[2,o])}else{let a=e[2];if(Array.isArray(a)&&a[0]===1&&a.length>2){let l=a.slice(1);return this.optimizeSplit([2,o,...l],t)}}}else if(e.slice(1).length>2){let s=e[1],o=e.slice(2),a=this.optimizeSplit([1,...o],t);return a.length>1?[2,s,...a.slice(1)]:s}}else if(n===1){let s=[1],o=[],a=[],l=[];if(e.length-1>ne.LocalBestThread){let u=!1;for(let c=1;c<e.length;c++){let h=e[c];if(!Array.isArray(h)){u=!0;break}}if(u)if(ne.UnionSplitType==="Grid"){let c=e.length;for(let h=1;h<e.length;h++){let f=e[h];if(Array.isArray(f))s.push(f);else{let d=f.bbox(),m=d.width(),p=d.height(),g=6;m>p&&m/p>=g?o.push(f):p>m&&p/m>=g?a.push(f):Math.abs(m-p)<=.1?f.items[0].items.length===1&&f.items[0].items[0].primitives.length===4?s.push(f):l.push(f):s.push(f)}}if(s.length>ne.LocalBestThread&&(s=Si.OcTreeOptimizeSplit(s)),s.length===c)e=s;else if(o.length===c-1)e=[1,...o];else if(a.length===c-1)e=[1,...a];else if(l.length===c-1)e=[1,...l];else{e=[1],s.length>1&&e.push(s);let h=On(e,t,!0);if(e=[1,h],o.length>0){for(let d of o)e.push(d);e=[1,On(e,t,!1)]}a.length>0&&(e.push(...a),h=On(e,t,!1),e=[1,h]),a.length>0&&(e.push(...a),h=On(e,t,!1),e=[1,h])}}else if(ne.UnionSplitType==="Connect"){let c=new Array(e.length-1);for(let f=1;f<e.length;f++)c[f-1]=f;let h=EG.gridSplit(c,f=>{let d=e[f];return tt.getSingleBBox(d)});if(h.length>1){let f=new Array(h.length+1);f[0]=1;for(let d=0;d<h.length;d++){let m=h[d],p=new Array(m.length+1);p[0]=1;for(let g=0;g<m.length;g++){let b=m[g];p[g+1]=e[b]}p=Si.OcTreeOptimizeSplit(p),f[d+1]=p}return e=f,e}}else ne.UnionSplitType==="Raw"?e=Si.OcTreeOptimizeSplit(e):ne.UnionSplitType}}else if(n===0&&e.length<=2)return[0];let i=[n];for(let s=1;s<e.length;s++){let o=e[s];if(Array.isArray(o)){let a=this.optimizeSplit(o,t);if(a.length<=1)continue;i.push(a)}else i.push(o)}return i}static optimizeBySA(e){let t=e[0];if(e.length<=2)return e;let n={},i={},s={},o,a=f=>{let d=f.join("_");if(d in n)return n[d];let m=0;if(ne.AutoPair){let p=new Array(f.length);for(let g=0;g<f.length;g++)p[g]=f[g];for(;p.length>1;){let g=0,b=[];p.length%2===1?(b.push(p[0]),g=1):g=0;for(let v=g;v<p.length;v+=2){let w=`${p[v]}_${p[v+1]}`,P=0;if(w in n)P=n[w];else if(ne.EvaluateType==="BBox"){P=tt.evaluateCostNodeBoolChildByBBox(s[p[v]],s[p[v+1]],o);let _=ye.extend2(s[p[v]],s[p[v+1]]);s[w]=_,n[w]=P}else ne.EvaluateType==="Combo"&&(P=i[p[v]]*i[p[v+1]],i[w]=P,n[w]=P);m=P+m,b.push(w)}p=b}n[d]=m}else{let p=new Array(f.length);for(let g=0;g<f.length;g++)p[g]=f[g];for(;p.length>1;){let g=`${p[0]}_${p[1]}`,b=0;if(ne.EvaluateType==="BBox"){b=tt.evaluateCostNodeBoolChildByBBox(s[p[0]],s[p[1]]);let v=ye.extend2(s[p[0]],s[p[1]]);s[g]=v,n[g]=b}else ne.EvaluateType==="Combo"&&(b=i[p[0]]*i[p[1]],i[g]=b,n[g]=b);if(m=b+m,p.length===2)break;p=[g,...p.slice(2)]}n[d]=m}return n[d]},l=f=>{if(ne.EvaluateType==="BBox")for(let d=0;d<f.length;d++){let m=e[f[d]],p=tt.getSingleBBox(m);o?o=ye.extend2(o,p):o=p,s[f[d].toString()]=p}else if(ne.EvaluateType==="Combo")for(let d=0;d<f.length;d++){let m=e[f[d]],p=tt.getSinglePolyTypeLine(m);i[f[d].toString()]=p.length}},u=[t],c=ne.Temperature,h=ne.CoolingRate;if(ne.OnlyBBoxTouch){let f=[],d=[];if(e.length>1){for(let m=1;m<e.length;m++){let p=e[m],g=!1;for(let b=1;b<e.length;b++){let v=e[b];if(p===v)continue;let w=tt.getSingleBBox(p),P=tt.getSingleBBox(v);if(w.isIntersect(P)){g=!0;break}}g?f.push(m):d.push(m)}if(f.length>0&&d.length>0){let m=[t],p=[t];for(let g of f)m.push(e[g]);for(let g of d)p.push(e[g]);return this.optimizeBySA([t,m,p])}}else for(let m=1;m<e.length;m++)f.push(m);if(f.length>2){l(f);let m=yh.optimize(f,c,h,a);for(let p of m)u.push(e[p]);for(let p of d)u.push(e[p])}else u=e}else{let f=new Array(e.length-1);for(let m=0;m<e.length;m++)m!==0&&(f[m-1]=m);l(f);let d=yh.optimize(f,c,h,a);for(let m of d)u.push(e[m])}return u}static optimizeByForce(e){let t=e[0];if(e.length<=2)return e;let n={},i={},s={},o,a=f=>{let d=f.join("_");if(d in n)return n[d];let m=0;if(ne.AutoPair){let p=new Array(f.length);for(let g=0;g<f.length;g++)p[g]=f[g];for(;p.length>1;){let g=0,b=[];p.length%2===1?(b.push(p[0]),g=1):g=0;for(let v=g;v<p.length;v+=2){let w=`${p[v]}_${p[v+1]}`,P=0;if(w in n)P=n[w];else if(ne.EvaluateType==="BBox"){P=tt.evaluateCostNodeBoolChildByBBox(s[p[v]],s[p[v+1]],o);let _=ye.extend2(s[p[v]],s[p[v+1]]);s[w]=_,n[w]=P}else ne.EvaluateType==="Combo"&&(P=i[p[v]]*i[p[v+1]],i[w]=P,n[w]=P);m=P+m,b.push(w)}p=b}n[d]=m}else{let p=new Array(f.length);for(let g=0;g<f.length;g++)p[g]=f[g];for(;p.length>1;){let g=`${p[0]}_${p[1]}`,b=0;if(ne.EvaluateType==="BBox"){b=tt.evaluateCostNodeBoolChildByBBox(s[p[0]],s[p[1]]);let v=ye.extend2(s[p[0]],s[p[1]]);s[g]=v,n[g]=b}else ne.EvaluateType==="Combo"&&(b=i[p[0]]*i[p[1]],i[g]=b,n[g]=b);if(m=b+m,p.length===2)break;p=[g,...p.slice(2)]}n[d]=m}return n[d]},l=f=>{if(ne.EvaluateType==="BBox")for(let d=0;d<f.length;d++){let m=e[f[d]],p=tt.getSingleBBox(m);o?o=ye.extend2(o,p):o=p,s[f[d].toString()]=p}else if(ne.EvaluateType==="Combo")for(let d=0;d<f.length;d++){let m=e[f[d]],p=tt.getSinglePolyTypeLine(m);i[f[d].toString()]=p.length}},u=[t],c=new Array(e.length-1);for(let f=0;f<e.length;f++)f!==0&&(c[f-1]=f);l(c);let h=wh.optimize(c,a);for(let f of h)u.push(e[f]);return u}static optimizeByCalculate(e,t){let n=e[0];if(e.length<=2)return e;let i=new d2((o,a)=>{let l=tt.getSinglePolyTypeLine(o).length,u=tt.getSinglePolyTypeLine(a).length;return l-u});for(let o=1;o<e.length;o++){let a=e[o];if(Array.isArray(a)){let l=this.optimizeByCalculate(a,t);i.add(l)}else i.add(a)}for(;i.size()>1;){let o=i.poll(),a=i.poll(),l=On([n,o,a],t);if(!l)return;i.add(l)}let s=i.poll();return[n,s]}static optimizeByPredictCalculate(e,t){let n=e[0];if(e.length<=2)return e;let i={},s={},o={},a,l=h=>{let f=h.join("_");if(f in i)return i[f];let d=0;if(ne.AutoPair){let m=new Array(h.length);for(let p=0;p<h.length;p++)m[p]=h[p];for(;m.length>1;){let p=0,g=[];m.length%2===1?(g.push(m[0]),p=1):p=0;for(let b=p;b<m.length;b+=2){let v=`${m[b]}_${m[b+1]}`,w=0;if(v in i)w=i[v];else if(ne.EvaluateType==="BBox"){if(o[m[b]]){if(!o[m[b+1]])throw console.error(o),new Error(m[b+1])}else throw console.error(o),new Error(m[b]);w=tt.evaluateCostNodeBoolChildByBBox(o[m[b]],o[m[b+1]],a);let P=ye.extend2(o[m[b]],o[m[b+1]]);o[v]=P,i[v]=w}else ne.EvaluateType==="Combo"&&(w=s[m[b]]*s[m[b+1]],s[v]=w,i[v]=w);d=w+d,g.push(v)}m=g}i[f]=d}else{let m=new Array(h.length);for(let p=0;p<h.length;p++)m[p]=h[p];for(;m.length>1;){let p=`${m[0]}_${m[1]}`,g=0;if(ne.EvaluateType==="BBox"){g=tt.evaluateCostNodeBoolChildByBBox(o[m[0]],o[m[1]]);let b=ye.extend2(o[m[0]],o[m[1]]);o[p]=b,i[p]=g}else ne.EvaluateType==="Combo"&&(g=s[m[0]]*s[m[1]],s[p]=g,i[p]=g);if(d=g+d,m.length===2)break;m=[p,...m.slice(2)]}i[f]=d}return i[f]},u=[],c={};for(let h=1;h<e.length;h++){u.push(h.toString());let f=e[h],d=tt.getSingleBBox(f);c[h.toString()]=f,o[h.toString()]=d,a?a=ye.extend2(a,d):a=d}for(;u.length>1;){let h=wh.permuteString(u),f=h[0],d=l(f);for(let g=1;g<h.length;g++){let b=h[g],v=l(b);v<=d&&(d=v,f=b)}let m=0,p=[];f.length%2===1?(p.push(f[0].toString()),m=1):m=0;for(let g=m;g<f.length;g+=2){let b=`${f[g]}_${f[g+1]}`;if(!(b in c)){let v=[n,c[f[g]],c[f[g+1]]];ne.DrawSeek&&new s2(t).drawBbox(a,it.RED);let w=On(v,t);c[b]=w,o[b]=tt.getSingleBBox(w)}p.push(b)}u=p}return[n,c[u[0]]]}static optimizeRandom(e,t){let n=e[0],i=e.slice(1),s=[n];for(let o of i)if(Array.isArray(o)){let a=Si.optimizeRandom(o,t);s.push(a)}else s.push(o);if(ne.NoOptimizePureTreeNode){let o=!0;for(let a of i)if(Array.isArray(a)){o=!1;break}if(!o)return s}if(n===1)switch(ne.TotalNodeNum+=1,ne.OptimizeType){case"Force":s=Si.optimizeByForce(s);break;case"SA":s=Si.optimizeBySA(s);break;case"Calculate":s=Si.optimizeByCalculate(s,t);break;case"PredictCalculate":s=Si.optimizeByPredictCalculate(s,t);break;default:break}return s}},li=(r=>(r[r.INTERSECT=0]="INTERSECT",r[r.UNION=1]="UNION",r[r.DIFF=2]="DIFF",r[r.XOR=3]="XOR",r))(li||{}),Tm=new ye(466,476,-509,-501);function IG(r){for(let e=1;e<r.length;e++){let t=r[e];if(Array.isArray(t)){if(IG(t))return!0}else if(t instanceof Ce){if(Tm.isContainsBBox(t.bbox()))return!0}else if(t instanceof Zt){for(let n of t.items)if(Tm.isContainsBBox(n.bbox()))return!0}else for(let n of t.items)for(let i of n.items)if(Tm.isContainsBBox(i.bbox()))return!0}return!1}function eu(r){let e=r[0],t=[e];switch(e){case 0:for(let i=1;i<r.length;i++){let s=r[i];if(Array.isArray(s)&&(s=eu(s),!s))return null;t.push(s)}break;case 1:case 3:for(let i=1;i<r.length;i++){let s=r[i];Array.isArray(s)&&(s=eu(s),!s)||t.push(s)}break;case 2:let n=r[1];if(Array.isArray(n)&&(n=eu(n),!n))return null;t.push(n);for(let i=2;i<r.length;i++){let s=r[i];Array.isArray(s)&&(s=eu(s),!s)||t.push(s)}break;default:throw new Error("not support boolean rule!")}return t.length===1?null:t}function Cm(r,e,t){return Array.isArray(r)?p2(r,e,t):r}function Mm(r,e,t,n,i=!0){if(i)for(;r.length>1;){let s,o=[];for(r.length%2===1?(o.push(r[0]),s=1):s=0;s<r.length;s+=2)o.push(e(r[s],r[s+1],t,n));r=o}else for(;r.length>1;){if(r.length===2)return e(r[0],r[1],t,n);r=[e(r[0],r[1],t,n),...r.slice(2)]}return r[0]}function p2(r,e,t,n=!0){let i=[];for(let s=1;s<r.length;s++)i.push(Cm(r[s],e,t));switch(r[0]){case 0:return Mm(i,Ql.intersect,e,t);case 1:return Mm(i,Ql.union,e,t);case 2:let s=Mm(i.slice(1),Ql.union,e,t);return s?Ql.diff(i[0],s,e,t):i[0];case 3:let o=Cm(r[1],e,t);for(let a=2;a<r.length;a++)o=Ql.xor(o,Cm(r[a],e,t),e,t);return o;default:throw new Error("not support boolean rule! "+r[0])}}function m2(r){let e=[r[0]];for(let t=1;t<r.length;t++){let n=r[t];if(Array.isArray(n)){let i=m2(n);Array.isArray(i)?i.length>1&&e.push(i):e.push(i)}else if(n instanceof Ce){let i=Vy(n);i&&e.push(lt.build(i))}else n instanceof Zt?e.push(lt.build(n)):e.push(n)}return e}function So(r,e){if(ne.curBus=e,r=m2(r),ne.Debug){tt.drawRule(r,new q(0,-1500),!0,it.Gray),ne.getDebug().draw();debugger}ne.markStart("runBoolean");let t;if(ne.UseRunArrange)if(ne.UseClass){ne.markStart("BoolTree");let n=PG.fromRules(r);ne.addMarkTime("\u7FFB\u8BD1\u65F6\u95F4",ne.markEnd("BoolTree")),t=n.getSimplifyRules(e)}else t=SG.simplifyRules(r,e);else t=eu(r);if(t.length<=1)return new lt([]);if(ne.Debug){tt.drawRule(t,new q(0,-1500),!0,it.BLUE),ne.getDebug().draw();debugger;ne.LogCalRules&&console.warn("\u6700\u7EC8\u8BA1\u7B97\u5E03\u5C14\u8868\u8FBE\u5F0F",t),ne.addMarkTime("\u5168\u5C40\u89C4\u5212\u65F6\u95F4",ne.markEnd("runBoolean"));let n=On(t,e);n.name=ne.getPolyTypeKey(),ne.getDebug().clear(),tt.drawRule(t,new q(0,-1500),!1,it.BLUE),ne.drawPolyType(n,it.GREEN),ne.drawText(new q(0,-1400),"\u7ED3\u679CPolygon:"+n.items.length.toString(),it.GREEN),ne.getDebug().draw();debugger;return n}else return On(t,e)}function On(r,e,t=!0){if(!r||r.length===1)return new lt([]);let n=r,i=new fG,s=[];function o(a){for(let l=1;l<a.length;l++){let u=a[l];Array.isArray(u)?o(u):s.push(u)}}return o(n),i.init(s),p2(n,i,e,t)}function g2(r,e,t){let n=[];return r.forEach(i=>i.forEach(s=>{if(s.hasInter&&!s.isAllInterIsInvalid())return;let o=s.bbox(),a=e.search(o.extendOfSize(ke)).filter(l=>l.bbox().extendOfSize(ke).isContainsBBox(o)).sort((l,u)=>l.bbox().area()-u.bbox().area());for(let l of a)if(l.isContain(s)){let u=t(!s.isOutside,l.isOutside),c=t(s.isOutside,l.isOutside);u!==c&&(n.push(s),s.setFinalIsOutSide(!u));return}t(s.isOutside,!1)!==t(!s.isOutside,!1)&&n.push(s)})),n}function BG(r,e,t){let n;switch(t){case 0:n=(a,l)=>a&&l;break;case 1:n=(a,l)=>a||l;break;case 2:n=(a,l)=>a&&!l;break;case 3:n=(a,l)=>a&&!l||!a&&l;break;default:throw Error("not support the rule")}let i=new ph(10),s=new ph(10);r.forEach(a=>a.forEach(l=>i.add(l))),e.forEach(a=>a.forEach(l=>s.add(l)));let o=g2(r,s,n);return g2(e,i,(a,l)=>n(l,a)).forEach(a=>o.push(a)),o}var AG=class{constructor(r){this.roots=[],this.nodes=r.sort((e,t)=>e.bbox().minX-t.bbox().minX).map(e=>new TG(e)),this.nodes.forEach((e,t)=>{e.visit()&&(this.roots.push(e),this.build(t))})}build(r){let e=this.nodes[r];for(let t=r+1,n=this.nodes.length;t<n;t++){let i=this.nodes[t];if(e.key.bbox().maxX<i.key.bbox().minX)break;i.getIsVisit()||e.isContain(i)&&(i.visit(),e.addChild(i),this.build(t))}}getPolygons(){let r=[];return this.roots.forEach(e=>e.getPolygons().forEach(t=>r.push(t))),r}},TG=class{constructor(r){this.children=[],this.isVisit=!1,this.key=r}getIsVisit(){return this.isVisit}isContain(r){return this.key.isContain(r.key)}addChild(r){this.children.push(r)}getPolygons(){let r=[];return this.getPolylineList(r),r.map(e=>{let t=e[0].polygon;if(t&&t.items.length===e.length){let n=e.map(s=>s.returnPolyline()),i=new Set(t.items);return n.some(s=>!i.has(s))?new Zt(n):t}else return new Zt(e.map(n=>n.returnPolyline()))})}getPolylineList(r,e){e?(e.push(this.key),e=null):(e=[this.key],r.push(e)),this.children.forEach(t=>t.getPolylineList(r,e))}visit(){return this.isVisit?!1:(this.isVisit=!0,!0)}};function Fr(r,e,t,n){function i(){if(!n)return;let c=n.initColor(it.Golden);c.addPt(s),c.addPoint(s.end()),n.initColor(it.RED).addPt(o),n.draw();debugger}let s=r.getShape(),o=t?e.getShape():e.getShape().reverse(),a=et(s,o.start()),l=et(o),u=a.cross(l);if(Vi(u,0)||Vi(Math.abs(a.dot(l)),1))if(s instanceof Y)if(o instanceof Y){if(ae.eq(u,0)&&(a.dot(l)>0?!Ge(s.end(),o.start()):!Ge(s.start(),o.start())))throw i(),new Error("line and line");return u<0}else{if(o instanceof re)return a.cross(o.center.sub(s.start()))<0;if(o instanceof Ae){let c=o.getExtremePoints(s),h=c.length?c[0]:_s(o.controls,s.start());return a.cross(h.sub(s.start()))<0}else throw new Error("not support")}else if(s instanceof re){if(o instanceof Y)return s.isCCW;if(o instanceof re){if(o.center.equals1(s.center)&&(a.dot(l)>0?!Ge(s.end(),o.start())&&s.end().sub(o.start()).dot(l)>0:!Ge(s.start(),o.start())&&s.start().sub(o.start()).dot(l)>0))throw i(),new Error("arc and arc");return o.rx>=s.rx||o.center.distance2(s.center)>s.rx2?s.isCCW:!s.isCCW}else throw new Error("not support")}else if(s instanceof Ae)if(o instanceof Y){let c=s.getPercent(o.start(),ke),h=s.clip(c)[1],f=h.getExtremePoints(o);return(f.length?f[0]:_s(h.controls,o.start())).sub(o.start()).cross(l)<0}else if(o instanceof Ae){let c=s.getPercent(o.start(),ke),h=s.clip(c)[1],f=h.getExtremePoints(new Y(o.start(),o.end())),d=o.getExtremePoints(new Y(h.start(),h.end())),m=f.length?f[0]:_s(h.controls,o.start()),p=d.length?d[0]:_s(o.controls,o.start()),g=m.sub(o.start()),b=p.sub(o.start());return g.cross(b)<0}else throw Error("not support");else throw new Error("not support");else return u<0}function _i(r,e,t,n,i){let s=r.getShape(),o=e.getShape(),a=s instanceof re?wi(s,Xe.toRadians(s.endAngle())):s instanceof Ae?nh(s,1):s.end().sub(s.start()).normalize(),l=et(o),u=a.dot(l);if(Vi(u,-1))return Fr(r,e,!0,i)?Fr(r,t,n,i)&&Fr(e,t,n,i):Fr(r,t,n,i)||Fr(e,t,n,i);{let c=a.scale(-1).angle(q.ORIGIN),h=l.angle(q.ORIGIN);c>h&&(c-=lm);let f=(c+h)/2,d=new q(Math.cos(f),Math.sin(f)),m=n?t.getShape():t.getShape().reverse(),p=et(m);return d.cross(p)<0?Fr(r,t,n,i):Fr(e,t,n,i)}}var CG=(r=>(r[r.NOT_IN=0]="NOT_IN",r[r.IS_IN=1]="IS_IN",r[r.IS_OVERLAP=2]="IS_OVERLAP",r))(CG||{}),MG=(r=>(r[r.AllClear=0]="AllClear",r[r.MapClear=1]="MapClear",r))(MG||{}),Pi;function yn(r,e,t,n,i,s=t.side===e,o=!0,a){let l=new Map;return Pi=i,x2(b2(r,e,o,a,l,t,s,n),t,s,n,0)}function Hi(r,e,t,n,i,s,o=n.side===t){Pi=i;let a=y2(r,e,t,new Map,n,o,s),l=a instanceof Array?-1:1;return x2(a,n,o,s,l)}function x2(r,e,t,n,i){for(;r instanceof Array;)i++,r.length===4?r=y2(...r,e,t,n):r=b2(...r,e,t,n);return{...r,existOverlap:i>0}}function b2(r,e,t,n,i,s,o,a){if(Eh===-1){a.initColor(it.RED).addPt(r.getShape()),a.initColor(it.Golden).addPt(e.getShape()),a.draw();debugger}let l=r.getShape(),u=o?e.getShape().reverse():e.getShape(),c=(l instanceof re?wi(l,t?u.start().angle(l.center):n?Xe.toRadians(l.endAngle()):void 0):l instanceof Ae?et(l,t?u.start():n?l.end():l.start()):l.end().sub(l.start())).normalize(),h=(u instanceof re?wi(u,t?void 0:(n?l.end():l.start()).angle(u.center)):u instanceof Ae?et(u,t?void 0:n?l.end():l.start()):u.end().sub(u.start())).normalize();if(n===void 0){let d=c.dot(h);if(Vi(d,0))return{state:Fr(r,e,!o,a)?1:0,inter:Zi(r,e,s,o,t,n,i)};n=d<0}else if(n?c.dot(h)>0:c.dot(h)<0)if(t){let d,m=n?l.reverse():l,p=!0;if(l instanceof Y&&Ge(yi.foot(l,u.start()),n?l.end():l.start()))p=!1;else if(l instanceof re||l instanceof Ae){let g=ei(u,c6(m,u.start()).reverse());g!==3&&g!==4&&(p=!1)}return p?d=Fr(r,e,!o,a)?1:0:n?d=_i(r,r.nextSide,e,!o,a)?1:0:d=_i(r.prevSide,r,e,!o,a)?1:0,{state:d,inter:Zi(r,e,s,o,t,n,i)}}else return n?{state:Fr(r,r.nextSide,!0,a)?0:1,inter:Zi(r,e,s,o,t,n,i),isReversed:!0}:{state:Fr(r.prevSide,r,!0,a)?0:1,inter:Zi(r,e,s,o,t,n,i),isReversed:!0};let f;if(t?f=ei(n?l.reverse():l,u):(f=ei(u,n?l.reverse():l),f===0||f===1?f=f===0?1:0:(f===3||f===4)&&(f=f===3?4:3)),f===1||f===2){let d=o?e.prevSide:e,m=d.inters,p=d.getEnd();for(let g=m.length-1;g>=0;g--){let b=m[g];if(!(d.getShape()instanceof Ae)&&!Ge(p,b.coord))break;if(b===s)return{state:2,inter:Zi(r,e,s,o,t,n,i)}}}if(f===3||f===4)return{state:f===(n?4:3)?1:0,inter:Zi(r,e,s,o,t,n,i)};if(i.has(r)?i.get(r).mapSideList.push(e):i.set(r,{sideIsReversed:n,mapSideList:[e]}),i.has(e)?i.get(e).mapSideList.push(r):i.set(e,{sideIsReversed:o,mapSideList:[r]}),f===2)return n?[r.prevSide,r,o?e.prevSide:e.nextSide,i]:[r,r.nextSide,o?e.prevSide:e.nextSide,i];if(f===0)return[n?r.prevSide:r.nextSide,e,!1,n,i];if(f===1)return[r,o?e.prevSide:e.nextSide,!0,n,i];throw Error("not support")}function Zi(r,e,t,n,i,s,o){let a=r.getShape(),l=n?e.getShape().reverse():e.getShape(),u=n;if(!i){let d=e;e=r,r=d,n=s,t=t.getBindedInter()}let c=d=>!(i?s:u)&&Ge(d,r.prevSide.getEnd())?r.prevSide:r;if(n){let d=e.inters;for(let m=0;m<d.length;m++){let p=d[m];if(p.isInvalid&&s===void 0)continue;if(p===t&&Ge(l.start(),t.coord))return i?p:p.getBindedInter();let g=p.getBindedInter().side,b=c(p.coord);if(g===b&&h(p))return f(p)}for(;;){e=e.nextSide;let m=e.inters;for(let p=0;p<m.length;p++){let g=m[p];if(g===t)return i?g:g.getBindedInter();if(o.has(e)){if(Ge(g.coord,g.getBindedInter().side.getEnd())){let b=g.getBindedInter().side;if(e.getEnd().sub(e.getStart()).normalize().dot(b.getEnd().sub(b.getStart()))<0){if(o.get(e).mapSideList.includes(g.getBindedInter().side.nextSide))return f(g);continue}}if(o.get(e).mapSideList.includes(g.getBindedInter().side))return f(g)}else if(g.side===t.side&&h(g))return f(g)}}}else{let d=e.inters;for(let m=d.length-1;m>=0;m--){let p=d[m];if(p.isInvalid&&s===void 0)continue;if(p===t&&Ge(l.start(),t.coord))return i?p:p.getBindedInter();let g=p.getBindedInter().side,b=c(p.coord);if(g===b&&h(p))return f(p)}for(;;){e=e.prevSide;let m=e.inters;for(let p=m.length-1;p>=0;p--){let g=m[p];if(g===t)return i?g:g.getBindedInter();if(o.has(e)){if(Ge(g.coord,g.getBindedInter().side.getEnd())){let b=g.getBindedInter().side;if(e.getEnd().sub(e.getStart()).normalize().dot(b.getEnd().sub(b.getStart()))<0){if(o.get(e).mapSideList.includes(g.getBindedInter().side.nextSide))return f(g);continue}}if(o.get(e).mapSideList.includes(g.getBindedInter().side))return f(g)}else if(g.side===t.side&&h(g))return f(g)}}}function h(d){if(d.isInvalid||d.getBindedInter().side!==(Ge(d.coord,r.prevSide.getEnd())?r.prevSide:r))return!1;let m;if(i){if(Ge(d.coord,l.start()))return!0;m=ei(s?a.reverse():a,p(l))}else{if(Ge(d.coord,s?a.end():a.start()))return!0;m=ei(l,p(s?a.reverse():a))}return m===2||m===1;function p(g){if(g instanceof Y)return g.cutLine(d.coord);if(g instanceof re)return re.build2(g.center,g.startAngle,d.coord.angleD(g.center),g.rx,g.ry,g.isCCW?1:0);if(g instanceof Ae)return g.clip(g.getPercent(d.coord,ke))[0];throw new Error("not supported operation")}}function f(d){let m=t.getBindedInter(),p=t.side,g=m.side,b=t===d,v=t;if(n){let w=t.getIndex()-1;for(;p;){let P=p.inters;for(;w>=0;w--)if(t=P[w],t===d){b||(t.setIsInvalid(),t.isDealed(),v=t),p=null;break}else if(Pi===0)!t.isInvalid&&(!Ge(t.coord,d.coord)||t.side===d.side&&t.getBindedInter().side===d.getBindedInter().side)&&(t.setIsInvalid(),t.isDealed(),v=t);else if(Pi===1){let _=t.getBindedInter().side;o.has(p)&&o.get(p).mapSideList.includes(_)&&(t.setIsInvalid(),t.isDealed(),v=t)}p=p==null?void 0:p.prevSide,w=(p==null?void 0:p.inters.length)-1}}else{let w=t.getIndex()+1;for(;p;){let P=p.inters;for(;w<P.length;w++)if(t=P[w],t===d){b||(t.setIsInvalid(),t.isDealed(),v=t),p=null;break}else if(Pi===0)!t.isInvalid&&(!Ge(t.coord,d.coord)||t.side===d.side&&t.getBindedInter().side===d.getBindedInter().side)&&(t.setIsInvalid(),t.isDealed(),v=t);else if(Pi===1){let _=t.getBindedInter().side;o.has(p)&&o.get(p).mapSideList.includes(_)&&(t.setIsInvalid(),t.isDealed(),v=t)}p=p==null?void 0:p.nextSide,w=0}}if(Pi===0)if(i?o.has(g)?o.get(g).sideIsReversed:s:u){let w=m.getIndex()-1;for(;g;){let P=o.has(g),_=g.inters;for(;w>=0;w--){if(m=_[w],m===d.getBindedInter()){g=null;break}m.isInvalid||!P||(!Ge(m.coord,d.getBindedInter().coord)||t.side===d.side&&t.getBindedInter().side===d.getBindedInter().side)&&(m.setIsInvalid(),m.isDealed())}g=g==null?void 0:g.prevSide,w=(g==null?void 0:g.inters.length)-1}}else{let w=m.getIndex()+1;for(;g;){let P=g.inters,_=o.has(g);for(;w<P.length;w++){if(m=P[w],m===d.getBindedInter()){g=null;break}m.isInvalid||!_||(!Ge(m.coord,d.getBindedInter().coord)||t.side===d.side&&t.getBindedInter().side===d.getBindedInter().side)&&(m.setIsInvalid(),m.isDealed())}g=g==null?void 0:g.nextSide,w=0}}return i?v:v.getBindedInter()}}function y2(r,e,t,n,i,s,o){let a=r.getShape(),l=e.getShape(),u=s?t.getShape().reverse():t.getShape(),c=(a instanceof re?wi(a,u.start().angle(a.center)):a instanceof Ae?et(a,u.start()):a.end().sub(a.start())).normalize(),h=(l instanceof re?wi(l,u.start().angle(l.center)):l instanceof Ae?et(l,u.start()):l.end().sub(l.start())).normalize(),f=c.dot(h);if(Vi(f,-1)){let d=s?t.getShape().reverse():t.getShape(),m=et(d).normalize();if(c.add(h.scale(-1)).normalize().dot(m)>-.9)return{state:Fr(r,e,!0,o)?0:1,inter:Zi(e,t,i,s,!0,!1,n)};{let p=yn(r,t,i,o,Pi,s);return p.state===2?p:Fr(r,e,!0,o)?p.state===0||p.inter!==i?p:yn(e,t,i,o,Pi,s):p.state===1||p.inter!==i?p:yn(e,t,i,o,Pi,s)}}else{let d=c.scale(-1).angle(q.ORIGIN),m=h.angle(q.ORIGIN);d>m&&(d-=lm);let p=(d+m)/2,g=new q(Math.cos(p),Math.sin(p)),b=et(u).normalize();return g.cross(b)<=0?c.scale(-1).dot(b)<0?{state:_i(r,e,t,!s,o)?1:0,inter:Zi(r,t,i,s,!0,void 0,n)}:[r,t,!0,void 0,n]:h.dot(b)<=0?{state:_i(r,e,t,!s,o)?1:0,inter:Zi(e,t,i,s,!0,void 0,n)}:[e,t,!0,void 0,n]}}function ti(r,e,t,n){function i(){if(!n)return;let c=n.initColor(it.Golden),h=n.initColor(it.RED);c.addPt(s),c.addPoint(s.end()),h.addPt(o),n.draw();debugger}let s=r.getShape(),o=e.getShape(),a=et(s,t),l=et(o,t),u=a.cross(l);if(Vi(u,0))if(s instanceof Y)if(o instanceof Y){if(ae.eq(u,0)&&(a.dot(l)>0?!Ge(s.end(),o.start()):!Ge(s.start(),o.start())))throw i(),new Error("line and line");return u<0}else{if(o instanceof re)return a.cross(o.center.sub(t))<0;if(o instanceof Ae){let c=o.getExtremePoints(s),h=c.length?c[0]:_s(o.controls,s.start());return a.cross(h.sub(s.start()))<0}else throw new Error("not support")}else if(s instanceof re){if(o instanceof Y)return s.isCCW;if(o instanceof re){if(o.center.equals1(s.center)&&(a.dot(l)>0?!Ge(s.end(),o.start())&&s.end().sub(o.start()).dot(l)>0:!Ge(s.start(),o.start())&&s.start().sub(o.start()).dot(l)>0))throw i(),new Error("arc and arc");return o.rx>=s.rx||o.center.distance2(s.center)>s.rx2?s.isCCW:!s.isCCW}else throw new Error("not support")}else if(s instanceof Ae)if(o instanceof Y){let c=s.getPercent(t,ke),h=s.clip(c)[1],f=h.getExtremePoints(o);return(f.length?f[0]:_s(h.controls,o.start())).sub(o.start()).cross(l)<0}else throw new Error("not support");else throw new Error("not support");else return u<0}function Hle(r,e,t,n,i){let s=r.getShape(),o=e.getShape(),a=et(s,n),l=et(o,n),u=a.dot(l);if(Vi(u,1)){let c=t.getShape(),h=et(c,n);return a.dot(h)<0?ti(r,t,n,i):ti(e,t,n,i)}else return Vi(u,-1)?ti(r,e,n,i)?ti(r,t,n,i)&&ti(e,t,n,i):ti(r,t,n,i)||ti(e,t,n,i):a.cross(l)>0?ti(r,t,n,i)||ti(e,t,n,i):ti(r,t,n,i)&&ti(e,t,n,i)}var Eh=0;function NG(r,e,t,n){let i=e.getBindedInter(),s=e.side,o=i.side,a=s.getShape(),l=o.getShape();if(n&&(Eh++,Eh===-1)){n.initColor(it.RED).addPt(a),n.initColor(it.Golden).addPt(l),n.draw();debugger}let u=0;if(r===-1){let B=Hi(s,s.nextSide,o,i,u,n),I=B.state!==0;if(B.state===2){let N=et(a,e.coord).add(et(s.nextSide.getShape(),e.coord)).normalize(),A=et(l,e.coord).add(et(o.nextSide.getShape(),e.coord)).normalize();return _(I,N.dot(A)>0)}let C=Hi(s,s.nextSide,o.nextSide,i,u,n);return B.state!==C.state?(P(B,C),1):_(I,B.state!==Hi(o,o.nextSide,s,e,u,n).state,B.inter,C.inter)}if(r===1){let B=yn(s,o,i,n,u),I=B.state!==0;if(B.state===2)return _(I,et(a,e.coord).dot(et(l,e.coord))>0);let C;if(B.isReversed&&B.existOverlap&&Ge(B.inter.coord,o.getEnd())&&B.inter.getBindedInter().side!==s){let M=B.inter.getBindedInter().side;M===s.nextSide?C={state:_i(s,M,o.nextSide,!0,n)?1:0,inter:i}:M===s.prevSide?C={state:_i(M,s,o.nextSide,!0,n)?1:0,inter:i}:C=yn(s,o.nextSide,i,n,u)}else C=yn(s,o.nextSide,i,n,u);if(B.state!==C.state)return P(B,C),1;let N=et(l,e.coord),A=et(o.nextSide.getShape(),e.coord);if(Vi(N.dot(A),-1)){let M=Fr(o,o.nextSide,!0,n);return _(I,B.state!==yn(o.nextSide,s,e,n,u,M?!I:I,!1,!1).state,B.inter,C.inter)}else{let M=et(a,e.coord);return _(I,N.add(A).dot(M)>0,B.inter,C.inter)}}if(!(a instanceof Ae||l instanceof Ae))return 1;let c=et(a,e.coord),h=et(l,e.coord),f,d;if(l instanceof Y)f=new Y(e.coord,l.start()),d=new Y(e.coord,l.end());else if(l instanceof re){let B=e.coord.angleD(l.center);f=re.build2(l.center,B,l.startAngle,l.rx,l.ry,l.isCCW?0:1),d=re.build2(l.center,B,l.endAngle(),l.rx,l.ry,l.isCCW?1:0)}else if(l instanceof Ae){let B=l.getPercent(e.coord,ke);[f,d]=l.clip(B),f=f.reverse()}else throw new Error("not support");let m=c.dot(h)>0,p,g;m?(p=ei(a.reverse(),f),g=ei(a,d)):(p=ei(a,f),g=ei(a.reverse(),d));let b;p===0?b=yn(m?s.prevSide:s.nextSide,o,i,n,u,!0,!1,m):p===1?b=yn(s,o.prevSide,i,n,u,!0,!0,m):p===2?m?b=Hi(s.prevSide,s,o.prevSide,i,u,n,!0):b=Hi(s,s.nextSide,o.prevSide,i,u,n,!0):m?p===3?b={inter:i,state:0}:b={inter:i,state:1}:p===3?b={inter:i,state:1}:b={inter:i,state:0};let v=b.state!==0;if(b.state===2)return _(v,m);let w;if(g===0?w=yn(m?s.nextSide:s.prevSide,o,i,n,u,!1,!1,!m):g===1?w=yn(s,o.nextSide,i,n,u,!1,!0,!m):g===2?m?w=Hi(s,s.nextSide,o.nextSide,i,u,n,!1):w=Hi(s.prevSide,s,o.nextSide,i,u,n,!1):m?g===3?w={inter:i,state:1}:w={inter:i,state:0}:g===3?w={inter:i,state:0}:w={inter:i,state:1},b.state===w.state)return b.inter===w.inter?(e.setIsInvalid(),0):_(v,m,b.inter,w.inter);return P(b,w),1;function P(B,I){let C=B.state!==0;if(B.inter===I.inter){e.setOutToIn(C);return}let N=[];if(r===-1){let M=et(a,e.coord),S=et(s.nextSide.getShape(),e.coord),$=et(l,e.coord),H=et(o.nextSide.getShape(),e.coord);N.push(M.dot($)),N.push(M.dot(H)),N.push(S.dot($)),N.push(S.dot(H))}else{let M=et(a,e.coord);N.push(et(l,e.coord).dot(M)),N.push(et(o.nextSide.getShape(),e.coord).dot(M))}if(N.reduce((M,S)=>Math.abs(M)>Math.abs(S)?M:S,0)>0)if(t===1||t===0||t===2||t===3)e.setOutToIn(C);else throw new Error("not support");else if(t===1)A(!C);else if(t===0||t===2||t===3)A(C);else throw new Error("not support");function A(M){e.setIsInvalid();let S=(M?B:I).inter;delete S.isInvalid,delete S.getBindedInter().isInvalid,S.setOutToIn(!C)}}function _(B,I,C,N){if(C===N){let A=new Ki(e.coord,s,n),M=new Ki(e.coord,o,n);return A.bind(M),I?s.inters.splice(e.getIndex(),0,A):s.inters.splice(e.getIndex()+1,0,A),o.inters.splice(e.getBindedInter().getIndex(),0,M),A.setOutToIn(B),e.setOutToIn(!B),A.isDealed(),s.inters.forEach((S,$)=>S.setIndex($)),o.inters.forEach((S,$)=>S.setIndex($)),2}else{let A=function(){let M=C.getBindedInter(),S=N.getBindedInter();delete C.isInvalid,delete M.isInvalid,delete N.isInvalid,delete S.isInvalid,C.setOutToIn(!B),N.setOutToIn(B),$(C,N,!0),$(N,C,!1),$(M,S,I),$(S,M,!I);function $(H,K,F){let{judge:z,changeNum:L}=O(),k=H.getIndex();for(let ie=k+L,W=H.side.inters;z(ie);ie+=L){if(W[ie].isInvalid)continue;if(!Ge(W[ie].coord,H.coord))break;W[ie].setIndex(k),W[k].setIndex(ie);let Q=W[ie];W[ie]=W[k],W[k]=Q,k=ie}function O(){let ie=H.side===K.side;if(F){let W=ie?K.getIndex():H.side.inters.length;return{judge:Q=>Q<W,changeNum:1}}else{let W=ie?K.getIndex()+1:0;return{judge:Q=>Q>=W,changeNum:-1}}}}};if(e.setIsInvalid(),I){if(t===1||t===0||t===2||t===3)return A(),2;throw new Error("not support")}else{if(t===1)return B?0:(A(),2);if(t===0||t===2||t===3)return B?(A(),2):0;throw new Error("not support")}}}}var tu=0;function _h(r,e,t,n,i){let s=xa(),o=[],a=[],l=[],u=new Set,c;if(i&&(c=new ba(i),tu++,tu===-1)){c.clear();let P=c.initColor(it.GREEN),_=c.initColor(it.WHITE),B=c.initColor(it.BLUE),I=c.initColor(it.Gray);e.items.forEach(C=>C.items.forEach((N,A)=>{A>0?_.addPly(N):P.addPly(N)})),t.items.forEach(C=>C.items.forEach((N,A)=>{A>0?I.addPly(N):B.addPly(N)})),c.draw();debugger}let h=e.items.length!==0&&t.items.length!==0?e.bbox().extendOfSize(ke).intersection1(t.bbox()):null;if(h){let P=[],_=[];switch(r){case 0:{e.items.forEach(B=>{B.bbox().isIntersect(h)&&P.push(B)}),t.items.forEach(B=>{B.bbox().isIntersect(h)&&_.push(B)});break}case 1:case 3:{e.items.forEach(B=>{B.bbox().isIntersect(h)?P.push(B):o.push(B)}),t.items.forEach(B=>{B.bbox().isIntersect(h)?_.push(B):o.push(B)});break}case 2:{e.items.forEach(B=>{B.bbox().isIntersect(h)?P.push(B):o.push(B)}),t.items.forEach(B=>{B.bbox().isIntersect(h)&&_.push(B)});break}default:throw new Error("not support")}P.length!==e.items.length&&(e=new lt(P)),_.length!==t.items.length&&(t=new lt(_))}else{switch(r){case 0:break;case 1:case 3:{e.items.forEach(P=>o.push(P)),t.items.forEach(P=>o.push(P));break}case 2:{e.items.forEach(P=>o.push(P));break}default:throw new Error("not support")}e=new lt([]),t=new lt([])}v(e,a,!0),v(t,l,!1);let f=r===2||r===3?(P,_)=>Ge(P.getEnd(),_)?P.nextSide:P:(P,_)=>Ge(P.prevSide.getEnd(),_)?P.prevSide:P,d=(P,_,B)=>{if(Ge(P.getEnd(),B)){if(P.inters.findIndex(I=>I.getBindedInter().side===_&&Ge(I.coord,P.getEnd()))===-1)return new Ki(B,P,c)}else return new Ki(B,P,c)},m=r===2||r===3?(P,_,B)=>{if(Ge(P.getStart(),B)){if(P.inters.findIndex(I=>I.getBindedInter().side===_&&Ge(I.coord,P.getStart()))===-1)return new Ki(B,P,c)}else return new Ki(B,P,c)}:d;n.seek(e,t,(P,_,B,I,C,N)=>{let A=a[P][_],M=l[I][C],S=A.sides[B],$=M.sides[N],H=bn(S.getShape(),$.getShape());if((S.getShape()instanceof Ae||$.getShape()instanceof Ae)&&H>=4){if(S.getShape()instanceof re||$.getShape()instanceof re){let F=function(L,k){let O=!1;for(let ie=0;ie<k.length;ie+=2)Ge(new q(k[ie],k[ie+1]),L)&&(O=!0);O||k.push(L.x,L.y)},z=[V[0],V[1]];for(let L=0;L<H;L+=2){let k=new q(V[L],V[L+1]);for(let O=L+2;O<H;O+=2){let ie=new q(V[O],V[O+1]);if(!Ge(k,ie)){F(ie,z);break}}}H=z.length,z.forEach((L,k)=>V[k]=L)}else for(let F=H-2;F>=2;F-=2)for(let z=F-2;z>=0;z-=2)if(Ge(new q(V[F],V[F+1]),new q(V[z],V[z+1]))){V[z]=(V[F]+V[z])/2,V[z+1]=(V[F+1]+V[z+1])/2;for(let L=H-3;L>=F;L--)V[L]=V[L+2];H-=2;break}}let K=0;if(H===4){let F=function(k){return Ge(S.getEnd(),k)||Ge(S.prevSide.getEnd(),k)||Ge($.prevSide.getEnd(),k)||Ge($.getEnd(),k)},z=new q(V[0],V[1]),L=()=>{let k=new Ki(z,S,c),O=new Ki(z,$,c);k.bind(O),k.setIsInvalid(),k.isDealed(),A.inters.push(k),M.inters.push(O)};if(V[0]===V[2]&&V[1]===V[3])if(F(z))K=2;else{L();return}}for(;K<H;K+=2){let F=new q(V[K],V[K+1]),z=S,L=$;if(Ge(z.prevSide.getEnd(),F)&&(z=z.prevSide),L=f(L,F),S!==z&&$!==L){let O=r===2||r===3?$.getEnd():L.getEnd();z.getEnd().distance1(F)<O.distance1(F)?(F=z.getEnd(),Ge(O,F)||(L=$)):(F=O,Ge(z.getEnd(),F)||(z=S))}let k=d(z,L,F);if(k){let O=m(L,z,F);O&&(z.addInter(k),A.inters.push(k),L.addInter(O),M.inters.push(O),k.bind(O),A.intersect(M,u))}}return H},i);let p=w(),g=BG(a,l,r);g.forEach(P=>!P.startAndEndIsSameOutsideFlag()&&P.reverse()),new AG(p.concat(g)).getPolygons().forEach(P=>o.push(P));let b=new lt(o);if(c){if(tu===-1){let P=c.initColor(it.RED),_=c.initColor(it.Golden);o.forEach(B=>{P.addPly(B.items[0]),B.items.slice(1).forEach(I=>_.addPly(I))}),c.draw();debugger;throw new Error}b.id=tu}return Gr.BooleanTools+=ji(s),b;function v(P,_,B){P.items.forEach(I=>{let C=[];C.push(Pm.build(I.items[0],B,!0,c,I)),I.items.slice(1).forEach(N=>{C.push(Pm.build(N,B,!1,c))}),_.push(C)})}function w(){let P=[];return u.forEach(B=>{r===2||r===3?B.forEach(C=>{C.isGroup1||C.reverse(),C.sides.forEach(N=>N.sortInters())}):B.forEach(C=>C.sides.forEach(N=>N.sortInters())),B.forEach(C=>{C.inters.forEach(N=>{if(N.dealed)return;let A=N.side,M=N.getBindedInter().side,S;Ge(A.getEnd(),N.coord)&&Ge(M.getEnd(),N.coord)?S=-1:Ge(A.getEnd(),N.coord)?(S=1,N=N.getBindedInter()):Ge(M.getEnd(),N.coord)&&(S=1);let $=NG(S,N,r,c);N.isDealed(),$&&(C.setAllInterIsInvalidToFalse(),M.outline.setAllInterIsInvalidToFalse())})}),I(B),r===3&&(B.forEach(C=>{C.reverse(),C.sides.forEach(N=>{N.sortInters(),N.inters.forEach(A=>{A.resetVisitStatus()})})}),I(B));function I(C){C.forEach(N=>{N.inters.forEach(A=>{if(A.isInvalid||A.getVisited())return;let M=A.findStartInter(),S=_(r)?M.run():M.getBindedInter().run(),$=N.polyline.primitives;if(S){if($.length===S.primitives.length){let H=new Set($);if(!S.primitives.some(K=>!H.has(K))){P.push(N);return}}P.push(Pm.build(S,!0,!0,c))}})})}}),P;function _(B){switch(B){case 0:case 2:case 3:return!0;case 1:return!1;default:throw Error("not support the rule")}}}}var ru={intersect(r,e,t,n){return _h(0,r,e,t,n)},union(r,e,t,n){return _h(1,r,e,t,n)},diff(r,e,t,n){return _h(2,r,e,t,n)},xor(r,e,t,n){return _h(3,r,e,t,n)}},RG=0,Ki=class{constructor(r,e,t){this.coord=r,this.side=e,t&&(this.id=RG++,this.drawDebug=t)}resetVisitStatus(){this.visited=!1,this.bindedInter.visited=!1}isDealed(){this.dealed=!0,this.getBindedInter().dealed=!0}setOutToIn(r){this.outToIn=r,this.bindedInter.outToIn=!r}setIsInvalid(){this.isInvalid=!0,this.getBindedInter().isInvalid=!0}getBindedInter(){return this.bindedInter}bind(r){this.bindedInter=r,r.bindedInter=this}setIndex(r){this.index=r}isSorted(){return this.index!==void 0}getIndex(){return this.index}getVisited(){return this.visited}visitSelf(){this.visited=!0}visit(){this.visited=!0,this.bindedInter.visited=!0}getPrevPoint(){let r=this.getIndex(),e=this.side.getStart();return r&&(e=this.side.inters[r-1].coord),e}getTangent(){let r=this.side.getShape();if(r instanceof Y)return r.end().sub(r.start());if(r instanceof re){let e=this.coord.angle(r.center);return r.isCCW?e+=th:e-=th,new q(Math.cos(e),Math.sin(e))}else{if(r instanceof Ae)return nh(r,r.getPercent(this.coord,ke));throw new Error("not support")}}findStartInter(){return this.outToIn===void 0?this.getTangent().cross(this.bindedInter.getTangent())>0?this:this.bindedInter:this.outToIn?this:this.bindedInter}run(){let r=[],e=this,t;if(this.drawDebug){Nm++;let n=Nm===-1,i=this.drawDebug.initColor(it.RED);if(n){this.drawDebug.draw();debugger}t=s=>{if(r.push(s),n){i.addPt(r[r.length-1]),this.drawDebug.draw();debugger}}}else t=n=>r.push(n);for(;!e.visited;){let n=function(a,l){ae.eq(a.distance2(l),0)||t(Zl.rebuild(s.getShape(),a,l))};e.visit();let i=e.getIndex(),s=e.side,o=s.inters[i+1];for(;o!=null&&o.isInvalid;)o=s.inters[o.getIndex()+1];if(o)n(e.coord,o.coord),e=o.bindedInter;else{for(n(e.coord,s.getEnd()),s=s.nextSide,e=null;;){for(let a of s.inters)if(!a.isInvalid){e=a.bindedInter;break}if(e)break;t(s.getShape()),s=s.nextSide}ae.eq(s.getEnd().distance2(e.coord),0)?t(s.getShape()):n(s.getStart(),e.coord)}}if(e!==this)throw this.drawDebug&&console.log(JSON.stringify({runId:Nm,handleId:Eh,boolId:tu})),new Error("inter !== this");return si(Ce.build7(r))}},Nm=0,Ph=0;function su(r,e){let t=r.primitives[0];if(r.primitives.length===1&&t instanceof re&&Math.abs(t.sweepAngle)===360)return[r];let n=xa();Ph++;let i,s=FG(r);if(s.length===0)return[];let o=kG(s);if(Ph===-1){i=new ba(e);let u=i.initColor(it.BLUE);s.forEach(h=>u.addPt(h.getShape()));let c=i.initColor(it.GREEN);o.forEach(h=>c.addPoint(h.coord)),i.draw();debugger;throw new Error}if(o.length===0)return[Ce.build7(s.map(u=>u.getShape()))];UG(o),DG(o,i);let{result:a,allIsInvalid:l}=LG(o,i);if(l)return[Ce.build7(s.map(u=>u.getShape()))];if(a.length===0)throw console.log("=====deSelfIntersection=====",Ph),new Error("result.length === 0");if(i)throw a.forEach(u=>{i.initColor(it.WHITE).addPly(u),i.draw();debugger}),new Error;return Gr.deSelfIntersection+=ji(n),a}function LG(r,e){let t=[],n=0;return r.forEach(i=>{if(i.getVisited()||i.isInvalid){n++;return}let s=[],o=i,a;if(e){debugger;let u=e.initColor(it.RED);a=c=>{s.push(c),u.addPt(s[s.length-1]),e.draw();debugger}}else a=u=>s.push(u);for(;!o.getVisited();){let u=function(d,m){ae.eq(d.distance2(m),0)||a(v2(h.getShape(),d,m))};o.visitSelf();let c=o.getIndex(),h=o.side,f=h.inters[c+1];for(;f!=null&&f.isInvalid;)f=h.inters[f.getIndex()+1];if(f)u(o.coord,f.coord),o=f.getBindedInter();else{for(u(o.coord,h.getEnd()),h=h.nextSide,o=null;;){for(let d of h.inters)if(!d.isInvalid){o=d.getBindedInter();break}if(o)break;a(h.getShape()),h=h.nextSide}ae.eq(h.getEnd().distance2(o.coord),0)?a(h.getShape()):u(h.getStart(),o.coord)}}if(o!==i)throw console.log("=====deSelfIntersection=====",Ph),new Error("inter !== inter0");let l=si(Ce.build7(s));l&&t.push(l)}),{allIsInvalid:n===r.length,result:t}}function OG(r){return{next(){return r.hasNext()?{value:r.next()}:{done:!0,value:void 0}},[Symbol.iterator](){return this}}}function kG(r){let e=[],t=new L6;for(let n of r.slice().sort((i,s)=>i.bbox().minY-s.bbox().minY)){for(let i of OG(t.listIterator())){let s=i.item;if(s.bbox().maxY<n.bbox().minY)t.remove(i);else{let o=function(f,d){let m=new Ki(d,f,null);return f.inters.push(m),e.push(m),m},a=function(f,d){let m=f.getEnd(),p=new q(V[0],V[1]),g=new q(V[2],V[3]),b=m.distance2(p)>m.distance2(g)?p:g,v=f.prevSide;o(Ge(v.getEnd(),b)?v:f,b).bind(o(d,b))},l=s.getShape(),u=n.getShape(),c=bn(l,u),h=c===4&&V[0]===V[2]&&V[1]===V[3];if(h&&(c-=2),s.nextSide===n)s.prevSide!==n&&c===4&&a(s,n);else if(s.prevSide===n)c===4&&a(n,s);else if(c!==0){let f=function(m,p){let g=m.prevSide;return o(Ge(g.getEnd(),p)?g:m,p)},d=new q(V[0],V[1]);if(h&&!Ge(d,s.prevSide.getEnd())&&!Ge(d,n.prevSide.getEnd())&&et(l,d).dot(et(u,d))>0)continue;for(let m=0;m<c;m+=2){let p=new q(V[m],V[m+1]);f(s,p).bind(f(n,p))}}}}t.add(n)}return e.forEach(n=>{n.getIndex()===void 0&&n.side.sortInters()}),e}function UG(r){r.forEach(e=>{let t=e.side.getEnd();if(e.isInvalid||!Ge(e.coord,t))return;let n=e.side.inters,i=e.getBindedInter().side;for(let s=n.length-1;s>=0;s--){let o=n[s];if(!Ge(o.coord,t))break;o!==e&&o.getBindedInter().side===i&&o.setIsInvalid()}})}function DG(r,e){r.forEach(t=>{if(t.isInvalid||t.dealed)return;let n=t.side,i=t.getBindedInter().side,s;Ge(n.getEnd(),t.coord)&&Ge(i.getEnd(),t.coord)?s=-1:Ge(n.getEnd(),t.coord)?n.nextSide!==i&&(s=1,t=t.getBindedInter()):Ge(i.getEnd(),t.coord)&&i.nextSide!==n&&(s=1),GG(s,t,e),t.isDealed()})}function GG(r,e,t){let n=e.getBindedInter(),i=e.side,s=n.side,o=i.getShape(),a=s.getShape(),l=1;if(r===-1){if(pa(o.reverse(),a.reverse())||pa(i.nextSide.getShape(),s.nextSide.getShape())){let c=Hi(i,i.nextSide,s,n,l,t);if(c.state===2)throw new Error("info1.state === InState.IS_OVERLAP");let h=Hi(i,i.nextSide,s.nextSide,n,l,t);c.state===h.state&&u(c,h)}else if(!(pa(o.reverse(),s.nextSide.getShape())||pa(i.nextSide.getShape(),a.reverse()))){let c=_i(i,i.nextSide,s,!1,t);c===_i(i,i.nextSide,s.nextSide,!0,t)&&c!==_i(s,s.nextSide,i.nextSide,!0,t)&&e.setIsInvalid()}}else if(r===1){let c=function(h,f){return et(h,f.start()).dot(et(f,f.start()))>0};if(pa(o.reverse(),a.reverse())||pa(o,s.nextSide.getShape())){let h=yn(i,s,n,t,l);if(h.state===2)throw new Error("info1.state === InState.IS_OVERLAP");let f=yn(i,s.nextSide,n,t,l);h.state===f.state&&u(h,f)}else if(c(o.reverse(),a.reverse())&&c(o,s.nextSide.getShape())){let h=Fr(i,s,!1,t);h===Fr(i,s.nextSide,!0,t)&&h!==_i(s,s.nextSide,new Zl(v2(o,e.coord,o.end()),t),!0,t)&&e.setIsInvalid()}}function u(c,h){c.inter.setIsInvalid(),h.inter.setIsInvalid(),e.setIsInvalid()}}function v2(r,e,t){if(r instanceof Y||e.distance2(t)<1e-6)return new Y(e,t);if(r instanceof re)return re.build2(r.center,e.angleD(r.center),t.angleD(r.center),r.rx,r.ry,r.sweep());if(r instanceof Ae){let n=r.getPercent(e,ke),i=r.getPercent(t,ke);return r.clip(n)[1].clip((i-n)/(1-n))[0]}else throw new Error("not supported operation")}function FG(r){let e=si(r);if(!e)return[];let t=e.primitives.map(i=>new Zl(i,null)),n=t[t.length-1];return t.forEach(i=>{n.connect(i),n=i}),t}var rs=(Bs=class{static clearData(e){this.originalPrimitive=[],this.offsetPrimitive=[],this.rawOffsetPrimitive=[],this.offsetDistance=0,this.testI++,this.testI===0?this.drawDebug=new ba(e):delete this.drawDebug}static createRawOffsetEdge(){if(this.drawDebug){let e=this.drawDebug.initColor(it.WHITE);this.originalPrimitive.forEach(t=>e.addPt(t)),this.drawDebug.draw();debugger}for(let e=0;e<this.originalPrimitive.length;e+=1){let t=this.originalPrimitive[e];this.offsetPrimitive.push({index:e,offsetEdge:this.createOffsetEdge(t)})}if(this.drawDebug){let e=this.drawDebug.initColor(it.Golden);this.offsetPrimitive.forEach(t=>e.addPt(t.offsetEdge)),this.drawDebug.draw();debugger}if(this.offsetPrimitive.length>1)for(let e=0;e<this.offsetPrimitive.length;e+=1)if(e===this.offsetPrimitive.length-1){this.connectPrimitive(this.offsetPrimitive[e],this.offsetPrimitive[0]);let t=this.rawOffsetPrimitive[0],n;t instanceof re?n=re.build4(this.offsetPrimitive[0].offsetEdge.start(),t.end(),t.center,t.rx,t.ry,t.sweep()):n=new Y(this.offsetPrimitive[0].offsetEdge.start(),t.end()),this.rawOffsetPrimitive.shift(),this.rawOffsetPrimitive.unshift(n)}else this.connectPrimitive(this.offsetPrimitive[e],this.offsetPrimitive[e+1]);else this.rawOffsetPrimitive=[]}static getExtendPolyLine(e,t,n){if(e=si(e),!e.primitives.length)return[];if(this.clearData(n),this.originalPrimitive=e.primitives,this.isExpansion=t>0,this.offsetDistance=t,this.createRawOffsetEdge(),this.drawDebug){let s=this.drawDebug.initColor(it.BLUE);this.rawOffsetPrimitive.forEach(o=>s.addPt(o)),this.drawDebug.draw();debugger}let i=this.createClippingEdge(n);if(this.drawDebug){let s=this.drawDebug.initColor(it.RED);i.forEach(o=>s.addPly(o)),this.drawDebug.draw();debugger}if(!this.isExpansion&&i.length&&(i=this.getValidityPrimitive(i)),this.drawDebug){let s=this.drawDebug.initColor(it.GREEN);i.forEach(o=>s.addPly(o)),this.drawDebug.draw();debugger;throw new Error}return i}static getValidityPrimitive(e){let t=[],n=Math.abs(this.offsetDistance);for(let i=0;i<e.length;i+=1){let s=!0,o=e[i].primitives;e:for(let a=0;a<o.length;a+=1){let l=o[a],u;if(l instanceof re)u=l.midPoint;else if(l instanceof Y)u=l.start();else throw new Error("not support!");for(let c=0;c<this.originalPrimitive.length;c+=1){let h=this.originalPrimitive[c],f;if(h instanceof re?f=this.pointArcClosest(u,h):f=Ty(u,h.start(),h.end()).d,n-f>.01){s=!1;break e}}}s&&t.push(e[i])}return t}static getInters(e){let t=[];for(let n=0;n<e;n+=2)t.push(new q(V[n],V[n+1]));return t}static pointArcClosest(e,t){let n=t.center;if(e.equals1(t.center))return t.rx;if(t.inArea(e,0)){let o=e.sub(n);return Math.abs(o.length()-t.rx)}let i=e.distance2(t.start()),s=e.distance2(t.end());return ae.less(i,s)?Math.sqrt(i):Math.sqrt(s)}static createClippingEdge(e){let t=[],n=[],i=su(Ce.build2(this.rawOffsetPrimitive),e);i.forEach(o=>{let a=o.area(.01);t.push(a)});let s=Math.min(...t.filter(o=>o<0));for(let o=0;o<t.length;o+=1){let a=t[o];ae.eq(a,0)||(!this.isExpansion&&a<0||this.isExpansion&&(a<0&&t[o]===s||a>0))&&n.push(i[o])}return n}static createOffsetEdge(e){if(e instanceof re)return e.panDistance1(this.offsetDistance);if(e instanceof Y)return e.panDistance(this.offsetDistance);throw new Error("not support!")}static connectPrimitive(e,t){e.offsetEdge instanceof Y&&t.offsetEdge instanceof Y?this.lineToLineConnect(e,t):e.offsetEdge instanceof re&&t.offsetEdge instanceof re?this.arcToArcConnect(e,t):e.offsetEdge instanceof Y&&t.offsetEdge instanceof re?this.lineToArcConnect(e,t):this.arcToLineConnect(e,t)}static isFalseIntersection(e){return e>1||e<0}static lineToLineConnect(e,t){let n=e.offsetEdge,i=t.offsetEdge,s=t.index,o=this.originalPrimitive[s].start();if(n.isParallel(i))n.bbox().intersection1(i.bbox())?this.rawOffsetPrimitive.push(n):this.lineToLineUseArcToConnect(o,n,i);else{let a=this.getLineToLineT(n,i),l=a[0],u=a[1];if(this.isFalseIntersection(l)||this.isFalseIntersection(u))l>1&&this.isFalseIntersection(u)?this.lineToLineUseArcToConnect(o,n,i):this.useLineToConnect(n,i);else if(!this.isFalseIntersection(l)&&!this.isFalseIntersection(u)){let c=n.end().sub(n.start()),h=n.start().add(c.mul(l)),f=new Y(n.start(),h);this.rawOffsetPrimitive.push(f);let d=new Y(h,i.end());this.updateNextOffsetPrimitive(s,d)}}}static updateNextOffsetPrimitive(e,t){this.offsetPrimitive[e].offsetEdge=t}static useLineToConnect(e,t){this.rawOffsetPrimitive.push(e);let n=new Y(e.end(),t.start());this.rawOffsetPrimitive.push(n)}static lineToLineUseArcToConnect(e,t,n){let i=this.getSweep(e,t),s=this.getSweepAngel(t.end(),n.start(),e,i);if(s===0){this.useLineToConnect(t,n);return}this.rawOffsetPrimitive.push(t);let o=re.build5(t.end(),n.start(),s);this.rawOffsetPrimitive.push(o)}static getSweep(e,t,n){let i=null,s=n||n===0?this.originalPrimitive[n]:t;if(s instanceof re){let o=s.center.sub(s.end()).normalize();s.isCCW?i=new q(o.y,-o.x):i=new q(-o.y,o.x)}else i=t.end().sub(t.start()).normalize();return e.sub(t.end()).normalize().cross(i)>0?0:1}static getLineToLineT(e,t){let n=e.end().sub(e.start()),i=t.end().sub(t.start()),s=n.cross(i),o=t.start().sub(e.start()),a=e.start().sub(t.start()),l=o.cross(i)/s,u=a.cross(n)/-s;return[l,u]}static lineToArcConnect(e,t){let n=e.offsetEdge,i=t.offsetEdge,s=e.index,o=t.index,a=this.getLineJoinArcScalarAndIntersectionNum(n,i),l=this.originalPrimitive[o].start();if(a.intersectionNum===0)this.lineAndArcUseArcConnect(l,n,i,s);else if(a.intersectionNum===1){let u=a.points[0];this.lineAndArcConnectionDetail(n,i,a.t[0],u,l,s,o)}else if(a.intersectionNum===2){let u=a.points[0],c=a.points[1],h=u.distance2(l),f=c.distance2(l);this.lineAndArcConnectionDetail(n,i,h<f?a.t[0]:a.t[1],h<f?u:c,l,s,o)}}static lineAndArcConnectionDetail(e,t,n,i,s,o,a){let l=this.isTrueArcIntersection(t,i);if(!this.isFalseIntersection(n)&&l){let u=new Y(e.start(),i);this.rawOffsetPrimitive.push(u);let c;!t.center.equals1(i)||t.sweepAngle>1e-4?(c=re.build4(i,t.end(),t.center,t.rx,t.ry,t.sweep()),c instanceof re&&c.sweepAngle===0&&(c=new Y(c.start(),c.end()))):c=new Y(t.center,i),this.updateNextOffsetPrimitive(a,c)}else l?this.useLineToConnect(e,t):this.lineAndArcUseArcConnect(s,e,t,o)}static lineAndArcUseArcConnect(e,t,n,i){let s=this.getSweep(e,t,i),o=this.getSweepAngel(t.end(),n.start(),e,s);if(o===0){this.useLineToConnect(t,n);return}let a=re.build5(t.end(),n.start(),o);this.rawOffsetPrimitive.push(t),this.rawOffsetPrimitive.push(a)}static arcToLineConnectionDetail(e,t,n,i,s,o,a){let l=this.isTrueArcIntersection(e,i);if(!this.isFalseIntersection(n)&&l){let u;e.center.equals1(i)?u=new Y(e.center,i):Math.abs(e.sweepAngle)<1e-4?u=new Y(e.start(),i):(u=re.build4(e.start(),i,e.center,e.rx,e.ry,e.sweep()),u instanceof re&&u.sweepAngle===0&&(u=new Y(u.start(),u.end()))),this.rawOffsetPrimitive.push(u);let c=new Y(i,t.end());this.updateNextOffsetPrimitive(a,c)}else l?this.useLineToConnect(e,t):this.lineAndArcUseArcConnect(s,e,t,o)}static isTrueArcIntersection(e,t){return jt(e,t)}static getSweepAngel(e,t,n,i){let s=e.angleD(n),o=t.angleD(n),a;return s===o?a=0:(s=Xe.regularD(s),o=Xe.regularD(o),i===1?o<=s&&(o+=360):o>=s&&(s+=360),a=o-s),a}static getLineJoinArcScalarAndIntersectionNum(e,t){let n={t:[],intersectionNum:0,points:[]},i=e6(t,e);if(i){n.intersectionNum=i/2;for(let s=0;s<i-1;s+=2){let o=new q(V[s],V[s+1]);n.points.push(o),o.sub(e.start()).x<1e-4||o.sub(e.start()).y<1e-4?n.t.push(0):n.t.push(o.sub(e.start()).x/e.end().sub(e.start()).x)}}else n.intersectionNum=0;return n}static arcToLineConnect(e,t){let n=e.offsetEdge,i=t.offsetEdge,s=e.index,o=t.index,a=this.getLineJoinArcScalarAndIntersectionNum(i,n),l=this.originalPrimitive[o].start();if(a.intersectionNum===0)this.lineAndArcUseArcConnect(l,n,i,s);else if(a.intersectionNum===1){let u=a.points[0];this.arcToLineConnectionDetail(n,i,a.t[0],u,l,s,o)}else if(a.intersectionNum===2){let u=a.points[0],c=a.points[1],h=u.distance2(l),f=c.distance2(l);this.arcToLineConnectionDetail(n,i,h<f?a.t[0]:a.t[1],h<f?u:c,l,s,o)}}static rxChangeStatus(e){return e===1?!this.isExpansion:this.isExpansion}static arcToArcConnect(e,t){let n=e.offsetEdge,i=t.offsetEdge,s=Py(n,i);if(s){let o=this.getInters(s),a;if(o.length===2){let c=this.originalPrimitive[t.index].start(),h=o[0],f=o[1],d=h.distance2(c),m=f.distance2(c);d<m?a=h:a=f}else a=o[0];let l,u;a.equals1(n.center)?l=new Y(n.center,a):Math.abs(n.sweepAngle)<1e-4?l=new Y(n.start(),a):(l=re.build4(n.start(),a,n.center,n.rx,n.ry,n.sweep()),l instanceof re&&l.sweepAngle===0&&(l=new Y(l.start(),l.end()))),this.rawOffsetPrimitive.push(l),a.equals1(i.center)?u=new Y(a,i.center):Math.abs(i.sweepAngle)<1e-4?u=new Y(a,i.end()):(u=re.build4(a,i.end(),i.center,i.rx,i.ry,i.sweep()),u instanceof re&&u.sweepAngle===0&&(u=new Y(u.start(),u.end()))),this.updateNextOffsetPrimitive(t.index,u)}else{let o=this.originalPrimitive[e.index],a=this.originalPrimitive[t.index],l=this.rxChangeStatus(o.sweep()),u=this.rxChangeStatus(a.sweep()),c=this.originalPrimitive[t.index].start(),h=this.getSweep(c,n,e.index),f=Math.abs(this.offsetDistance),d=re.build2(c,l?o.endAngle():o.endAngle()+180,u?a.startAngle:a.startAngle+180,f,f,h);this.rawOffsetPrimitive.push(n),this.rawOffsetPrimitive.push(d)}}},(()=>{Bs.originalPrimitive=[]})(),(()=>{Bs.offsetPrimitive=[]})(),(()=>{Bs.rawOffsetPrimitive=[]})(),(()=>{Bs.testI=0})(),Bs),ui=class iu extends Xl{constructor(e,t,n,i,s,o){if(super(),t<0||n<0)throw new Error("The width and height of rect can't be less than 0!");this.leftUpPoint=e,this.width=t,this.height=n,this.angle=i,this.isCCW=s,this.radius=Math.min(Math.max(o,0),t/2,n/2)}get radiusRatio(){return this.radius/Math.min(this.width,this.height)}start(){return this.leftUpPoint.add(new q(this.radius,0).multiply3(qe.rotateD(this.angle)))}end(){return this.start()}getLeftPoint(){return this.leftUpPoint.add(new q(0,-this.height/2).multiply3(qe.rotateD(this.angle)))}getRightPoint(){return this.leftUpPoint.add(new q(this.width,-this.height/2).multiply3(qe.rotateD(this.angle)))}extend(e){return new iu(this.leftUpPoint.add(new q(-e,e).rotateD(q.ORIGIN,this.angle)),this.width+e*2,this.height+e*2,this.angle,this.isCCW,this.radius+e)}bbox(){let e=qe.rotateD(this.angle),{leftUpPoint:t,width:n,height:i,radius:s}=this,o=t.add(new q(s,-s).multiply3(e)),a=t.add(new q(s,s-i).multiply3(e)),l=t.add(new q(n-s,-s).multiply3(e)),u=t.add(new q(n-s,s-i).multiply3(e));return new ye(Math.min(o.x,a.x,l.x,u.x)-s,Math.max(o.x,a.x,l.x,u.x)+s,Math.min(o.y,a.y,l.y,u.y)-s,Math.max(o.y,a.y,l.y,u.y)+s)}toPolyline(){let e=[],{leftUpPoint:t,width:n,height:i,radius:s}=this;if(s===0){let a=q.ORIGIN,l=new q(n,0),u=new q(n,-i),c=new q(0,-i);e.push(new Y(a,l),new Y(l,u),new Y(u,c),new Y(c,a))}else{let a=new q(0,-s),l=new q(s,0),u=new q(n-s,0),c=new q(n,-s),h=new q(n,s-i),f=new q(n-s,-i),d=new q(s,-i),m=new q(0,s-i);e.push(re.build1(a,l,s,s,!1,0),new Y(l,u),re.build1(u,c,s,s,!1,0),new Y(c,h),re.build1(h,f,s,s,!1,0),new Y(f,d),re.build1(d,m,s,s,!1,0),new Y(m,a))}e=e.filter(a=>!a.start().equals1(a.end())),this.isCCW&&(e.forEach((a,l)=>e[l]=a.reverse()),e.reverse());let o=qe.rotateD(this.angle).translate1(t);return Ce.build2(e.map(a=>a.multiply3(o)))}center(){return this.leftUpPoint.add1(this.width/2,this.height/2).rotateD(this.leftUpPoint,this.angle)}multiply3(e){let t=this.leftUpPoint.multiply3(e),n=new q(this.width,0).multiply3(qe.rotateD(this.angle)).multiply3(e),i=new q(0,-this.height).multiply3(qe.rotateD(this.angle)).multiply3(e);return e.isMirrored()?new iu(t,i.length(),n.length(),i.angleD(q.ORIGIN),this.isCCW===1?0:1,this.radius*n.length()/this.width):new iu(t,n.length(),i.length(),n.angleD(q.ORIGIN),this.isCCW,this.radius*n.length()/this.width)}reverse(){return new iu(this.leftUpPoint,this.width,this.height,this.angle,this.isCCW===1?0:1,this.radius)}stroke(e,t,n){let i=this.stroke1(e,t,n);if(i.length===1)return i[0];{let[s,o]=i;return Ce.build2(s.primitives.concat(new Y(s.primitives[0].start(),o.primitives[0].start()),o.primitives,new Y(o.primitives[0].start(),s.primitives[0].start())))}}stroke1(e,t,n){let i=n===this.isCCW?this:this.reverse(),s=e/2,o=Math.min(i.width,i.height)/2,a=i.extend(s).toPolyline();return o<=s?[a]:[a,i.extend(-s).toPolyline().reverse()]}points(e){let t=this.toPolyline(),n=[];return t.points(e,i=>n.push(i)),n}toBezier(){throw new Error("Method not implemented.")}},qG=.01,Zt=class ii{static simplify(e){return e=si(e),e?new ii([e]):null}static buildByStroke(e,t,n=1,i){if(e instanceof re&&(e.rx<t/2+qG||Math.abs(e.sweepAngle)>180&&ae.lesseq(e.start().distance1(e.end()),t))){let s=su(e.stroke(t,n,0),i);if(s.length===0)return null;if(s.length===1)return new ii(s);let o=[null],a=Number.POSITIVE_INFINITY;return s.forEach(l=>{let u=l.area(.1);u<0?u<a&&(o[0]=l,a=u):o.push(l)}),new ii(o)}else if(e instanceof ui){let s=e.stroke1(t,n,0).map(o=>si(o));return s[0]?s[1]?new ii(s):new ii([s[0]]):null}return this.simplify(e.stroke(t,n,0))}static buildCircle(e,t){return this.simplify(Ce.build7([re.buildCircle(e,t,0)]))}static buildRect(e){return this.simplify(e.toPolyline())}static buildBBox(e){return this.simplify(Ce.buildBBox(e,0))}constructor(e){this.items=e.slice()}multiply3(e){return new ii(this.items.map(t=>t.multiply3(e)))}bbox(){return this.items[0].bbox()}isEqual(e){return e instanceof ii?this.items.every(t=>e.items.some(n=>n.isEqual(t))):!1}getOutMostPolyline(){return this.items[0]}extend(e,t){if(this.items.length!==1)throw new Error("this.items.length !== 1");if(e===0)return new lt([this]);let n=this.items[0],i=[];for(let c of n.primitives)if(c instanceof Y)i.push(c);else if(c instanceof re&&c.rx===c.ry)o(c);else if(c instanceof Ae)s(c);else throw new Error("not support!");n=Ce.build7(i);function s(c){let h=c.points(.1);for(let f=0;f<h.length-1;f++){let d=h[f],m=h[f+1];i.push(new Y(d,m))}}function o(c){if(Math.abs(c.sweepAngle)>270){let h=c.sweepAngle/2;o(re.build3(c.center,c.startAngle,h,c.rx,c.ry)),o(re.build3(c.center,c.startAngle+h,h,c.rx,c.ry))}else i.push(c)}let a=[],l=[];rs.getExtendPolyLine(n,e,t).forEach(c=>{(c.area(.1)>0?l:a).push(c)});let u;if(a.length===1)l.forEach(c=>a.push(c)),u=new lt([new ii(a)]);else if(a.length===0)console.warn("outlines.length === 0"),u=new lt([]);else if(l.length===0)u=new lt(a.map(c=>new ii([c])));else{let c=a.map(h=>[h]);l.forEach(h=>{let f=[],d=h.bbox();if(c.forEach(m=>{m[0].bbox().isContainsBBox1(d)&&f.push(m)}),f.length===1)f[0].push(h);else{if(f.length===0)throw new Error("inPlsArr.length === 0");for(let m of f.sort((p,g)=>p[0].bbox().area()-g[0].bbox().area()))if(m[0].getWindingNum(h.start())===-1){m.push(h);break}}}),u=new lt(c.map(h=>new ii(h)))}return u}toPolylineGroup(){return new Po(this.items)}},zG=class Ah extends re{constructor(e,t,n,i,s){super(e,t,n,i,s)}static build2(e,t,n,i,s,o){at.positive(i),at.positive(s),at.normal(t),at.normal(n);let a;return t===n?(t=Xe.regularD(t),n=Xe.regularD(n),a=0):(t=Xe.regularD(t),n=Xe.regularD(n),o===1?n<=t&&(n+=360):n>=t&&(t+=360),a=n-t),new Ah(i,s,e,t,a)}static build3(e,t,n,i,s){return at.positive(i),at.positive(s),at.normal(n),new Ah(i,s,e,Xe.regularD(t),n)}static build4(e,t,n,i,s,o){let a=e.angleD(n),l=t.angleD(n);return Ah.build2(n,a,l,i,s,o)}},YG=class{constructor(r=4096){this.byteOffset=0,this.view=new DataView(new ArrayBuffer(r))}getFloat32(r,e){return this.view.getFloat32(r,e)}getFloat64(r,e){return this.view.getFloat64(r,e)}getInt8(r){return this.view.getInt8(r)}getInt16(r,e){return this.view.getInt16(r,e)}getInt32(r,e){return this.view.getInt32(r,e)}getUint8(r){return this.view.getUint8(r)}getUint16(r,e){return this.view.getUint16(r,e)}getUint32(r,e){return this.view.getUint32(r,e)}setFloat32(r,e,t){this.view.setFloat32(r,e,t)}setFloat64(r,e,t){this.view.setFloat64(r,e,t)}setInt8(r,e){this.view.setInt8(r,e)}setInt16(r,e,t){this.view.setInt16(r,e,t)}setInt32(r,e,t){this.view.setInt32(r,e,t)}setUint8(r,e){this.view.setUint8(r,e)}setUint16(r,e,t){this.view.setUint16(r,e,t)}setUint32(r,e,t){this.view.setUint32(r,e,t)}ext(r){let e=this.byteOffset;if(this.byteOffset+=r,this.byteOffset<=this.view.buffer.byteLength)return e;let t=new Uint8Array(this.view.buffer.byteLength*2);return t.set(new Uint8Array(this.view.buffer)),this.view=new DataView(t.buffer),e}pushFloat32(r,e){let t=this.ext(4);this.view.setFloat32(t,r,e)}pushFloat64(r,e){let t=this.ext(8);this.view.setFloat64(t,r,e)}pushInt8(r){let e=this.ext(1);this.view.setInt8(e,r)}pushInt16(r,e){let t=this.ext(2);this.view.setInt16(t,r,e)}pushInt32(r,e){let t=this.ext(4);this.view.setInt32(t,r,e)}pushUint8(r){let e=this.ext(1);this.view.setUint8(e,r)}pushUint16(r,e){let t=this.ext(2);this.view.setUint16(t,r,e)}pushUint32(r,e){let t=this.ext(4);this.view.setUint32(t,r,e)}build(){return this.view.buffer.slice(0,this.byteOffset)}},Ps=!0,XG=(r=>(r[r.POLYGON=1]="POLYGON",r[r.POLYLINE=2]="POLYLINE",r[r.LINE=3]="LINE",r[r.ARC=4]="ARC",r[r.BEZIER2=5]="BEZIER2",r[r.BEZIER3=6]="BEZIER3",r[r.BOOLEAN_OUTPUT=7]="BOOLEAN_OUTPUT",r[r.BOOLEAN_INTERSECTION=8]="BOOLEAN_INTERSECTION",r[r.BOOLEAN_UNION=9]="BOOLEAN_UNION",r[r.BOOLEAN_DIFF=10]="BOOLEAN_DIFF",r[r.BOOLEAN_RESULT=11]="BOOLEAN_RESULT",r[r.LINES=12]="LINES",r[r.ARCS=13]="ARCS",r[r.BEZIER2S=14]="BEZIER2S",r[r.BEZIER3S=15]="BEZIER3S",r[r.CIRCLE_CW=16]="CIRCLE_CW",r[r.CIRCLE_CCW=17]="CIRCLE_CCW",r[r.POLYGON_GROUP=18]="POLYGON_GROUP",r))(XG||{}),Rm=class{constructor(){this.builder=new YG,this.containerIndex=0,this.resultIndex=0,this.info={lineNum:0,arcNum:0,circleNum:0,plyNum:0}}pushContainer(r){this.builder.pushUint8(r)}pushUint32(r){this.builder.pushUint32(r,Ps)}pushFloat64(r){this.builder.pushFloat64(r,Ps)}pushPoint(r){this.builder.pushFloat64(r.x,Ps),this.builder.pushFloat64(r.y,Ps)}polylineEncode(r){this.info.plyNum++;let e=r.primitives;if(this.pushUint32(e.length),e.length===1){let t=e[0];if(!(t instanceof re)||t.rx!==t.ry||!ae.eq(Math.abs(t.sweepAngle),360))throw new Error("!(arc instanceof Arc) || arc.rx !== arc.ry || !DoubleKit.eq(Math.abs(arc.sweepAngle), 360)");this.info.circleNum++,this.pushPoint(t.center),this.pushContainer(t.isCCW?17:16),this.pushFloat64(t.rx);return}this.pushPoint(e[0].start()),e.forEach(t=>{if(t instanceof Y)this.info.lineNum++,this.pushContainer(3),this.pushPoint(t.end());else if(t instanceof re&&t.rx===t.ry&&!ae.eq(Math.abs(t.sweepAngle),360))this.info.arcNum++,this.pushContainer(4),this.pushFloat64(Xe.toRadians(t.sweepAngle)),this.pushPoint(t.end());else throw new Error("not support!")})}polygonEncode(r){if(r instanceof Ce)this.pushContainer(2),this.polylineEncode(r);else{if(r.items.length===1)return this.polygonEncode(r.items[0]);if(r instanceof Zt){this.pushContainer(1),this.pushUint32(r.items.length-1),this.polylineEncode(r.items[0]);for(let e=1;e<r.items.length;e++)this.pushContainer(2),this.polylineEncode(r.items[e])}else if(r instanceof lt)this.pushContainer(18),this.pushUint32(r.items.length),r.items.forEach(e=>this.polygonEncode(e)),this.containerIndex-=r.items.length;else throw new Error("not support")}return this.containerIndex++}rulesEncode(r,e=!0){let t=new Uint32Array(r.length-1);for(let n=1;n<r.length;n++){let i=r[n];i instanceof Array?t[n-1]=this.rulesEncode(i,!1):t[n-1]=this.polygonEncode(i)}switch(r[0]){case 0:this.pushContainer(8);break;case 1:this.pushContainer(9);break;case 2:this.pushContainer(10);break;default:throw new Error("not support boolean rule!")}return this.pushUint32(t.length),t.forEach(n=>this.pushUint32(n)),e&&this.pushContainer(7),this.containerIndex++}resultEncode(r,e=this.resultIndex++){this.pushContainer(11),this.pushUint32(e),this.pushUint32(r.items.length),r.items.forEach(t=>this.polygonEncode(t))}build(){return this.builder.build()}};function Io(r){let e=[],t=[],n=[],i=new DataView(r),s=0;for(;s<r.byteLength;){let d=function(m){let p=a(),g=[m];for(let b=0;b<p;b++)g.push(n[a()]);n.push(g)};switch(o()){case 1:n.push(h());break;case 2:n.push(c());break;case 18:n.push(f());break;case 8:d(0);break;case 9:d(1);break;case 10:d(2);break;case 7:for(let b=n.length-1;b>=0;b--){let v=n[b];if(v instanceof Array){e.push(v);break}}break;case 11:let m=a(),p=a(),g=[];for(let b=0;b<p;b++)switch(o()){case 1:g.push(h());break;case 2:g.push(new Zt([c()]));break;case 18:f().items.forEach(v=>g.push(v));break;default:throw new Error(`not support container type at ${s-1}: ${i.getUint8(s-1)}`)}t.push({group:new lt(g),index:m});break;default:throw new Error(`not support container type at ${s-1}: ${i.getUint8(s-1)}`)}}return{rulesArr:e,results:t};function o(){return i.getUint8(s++)}function a(){let d=i.getUint32(s,Ps);return s+=4,d}function l(){let d=new q(i.getFloat64(s,Ps),i.getFloat64(s+8,Ps));return s+=16,d}function u(){let d=i.getFloat64(s,Ps);return s+=8,d}function c(){let d=a(),m=l();if(d===1){let g=o();if(g===17||g===16)return Ce.build7([re.buildCircle(m,u(),g===17?1:0)]);s--}let p=[];for(let g=0;g<d;g++){let b;switch(o()){case 3:b=l(),p.push(new Y(m,b));break;case 4:let v=u();b=l(),p.push(re.build5(m,b,Xe.toDegrees(v)));break;default:throw new Error(`not support container type at ${s-1}: ${i.getUint8(s-1)}`)}m=b}return Ce.build7(p)}function h(){let d=a(),m=[c()];for(let p=0;p<d;p++){if(o()!==2)throw new Error(`not support container type at ${s-1}: ${i.getUint8(s-1)}`);m.push(c())}return new Zt(m)}function f(){let d=a(),m=[];for(let p=0;p<d;p++){let g=o();if(g===2)m.push(new Zt([c()]));else if(g===1)m.push(h());else throw new Error(`not support container type at ${s-1}: ${i.getUint8(s-1)}`)}return new lt(m)}}function ou(r){let e=new Rm;for(let t of r)t instanceof lt?e.resultEncode(t):e.resultEncode(t.group,t.index);return console.log("booleanResultEncode",e.info),e.build()}function Th(r){let e=new Rm;for(let t of r)e.rulesEncode(t);return console.log("booleanRulesEncode",e.info),e.build()}function Aa(r,e){VG(r.iterator(),e)}function VG(r,e){let t=0;for(;r.hasNext();){let n=r.next();e(t++,n)}}var Um=class{constructor(e){this.lst=e}iterator(){return new Ch(this.lst)}},Ch=class{constructor(e){this.idx=-1;this.lst=e}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function wce(r){return new Um(r)}function I2(r){return new Ch(r)}var Mh=new Error("list is empty"),Ta=class{constructor(e,t){this.prev=null;this.next=null;this.parent=e,this.item=t}insertAfter(e){e.next=this.next,this.next=e,e.prev=this,e.next!==null&&(e.next.prev=e)}insertBefore(e){e.prev=this.prev,this.prev=e,e.next=this,e.prev!==null&&(e.prev.next=e)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(e){this.item=e}},Dm=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e.item;throw new Error("iterator is null")}},Gm=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e;throw new Error("iterator is null")}},Un=class{constructor(){this.first=null;this.last=null;this.cnt=0}add(e){return this.addLast(e)}push(e){return this.addLast(e)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let e=this.first;if(e===null)throw Mh;return this.remove(e),e.item}removeLast(){let e=this.last;if(e===null)throw Mh;return this.remove(e),e.item}addLast(e){if(this.first===null||this.last===null){let t=new Ta(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertAfter(this.last,e)}addFirst(e){if(this.first===null||this.last===null){let t=new Ta(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertBefore(this.first,e)}getFirst(){if(this.first===null)throw Mh;return this.first.item}getLast(){if(this.last===null)throw Mh;return this.last.item}insertAfter(e,t){let n=new Ta(this,t);return e.insertAfter(n),e===this.last&&(this.last=n),this.cnt++,n}insertBefore(e,t){let n=new Ta(this,t);return e.insertBefore(n),e===this.first&&(this.first=n),this.cnt++,n}remove(e){e.remove(),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new Dm(this.first)}listIterator(){return new Gm(this.first)}toArray(){let e=new Array,t=this.first;for(;t!=null;)e.push(t.item),t=t.next;return e}};function Nh(r){throw new Error("")}var Ca=class{constructor(e,t){this.node1=null;this.node2=null;this.key=e,this.value=t}},Fm=class{constructor(e){this.itors=e}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().key}},qm=class{constructor(e){this.itors=e}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().value}},Jr=class{constructor(){this.innerList=new Un;this.innerMap={}}replace(e,t){e.node1!==null&&(e.node1.set(t),t.node1=e.node1),e.node2!==null&&(e.node2.set(t),t.node2=e.node2)}clear(){this.innerList.clear();for(let e in this.innerMap)delete this.innerMap[e]}put(e,t){let n=e.hashCode(),i=new Ca(e,t),s=this.innerMap[n];if(s===void 0)return i.node1=this.innerList.add(i),this.innerMap[n]=i,null;if(s instanceof Ca){if(s.key.equals(e))return this.innerMap[n]=i,this.replace(s,i),s.value;{i.node1=this.innerList.add(i);let o=new Un;return s.node2=o.add(s),i.node2=o.add(i),this.innerMap[n]=o,null}}if(s instanceof Un){let o=null;return Aa(s,(a,l)=>l.key.equals(e)?(this.replace(l,i),o=l.value,!1):!0),o===null?(i.node1=this.innerList.add(i),i.node2=s.push(i),null):o}return Nh(s)}get(e){let t=e.hashCode(),n=this.innerMap[t];if(n===void 0)return null;if(n instanceof Ca)return n.key.equals(e)?n.value:null;if(n instanceof Un){let i=null;return Aa(n,(s,o)=>o.key.equals(e)?(i=o.value,!1):!0),i}return Nh(n)}containsKey(e){return this.get(e)!==null}delete(e){e.node1!==null&&e.node1.parent.remove(e.node1),e.node2===null?delete this.innerMap[e.key.hashCode()]:e.node2.parent.remove(e.node2)}remove(e){let t=e.hashCode(),n=this.innerMap[t];if(n===void 0)return null;if(n instanceof Ca)return n.key.equals(e)?(this.delete(n),n.value):null;if(n instanceof Un){let i=null;return Aa(n,(s,o)=>o.key.equals(e)?(i=o.value,this.delete(o),!1):!0),i}return Nh(n)}computeIfAbsent(e,t){let n=this.get(e);if(n===null){let i=t(e);return this.put(e,i),i}else return n}size(){return this.innerList.size()}isEmpty(){return this.innerList.size()===0}keys(){return new Fm(this.innerList.iterator())}values(){return new qm(this.innerList.iterator())}entries(){return this.innerList.iterator()}};var As=class{constructor(e){this.bheap=new Array;this.count=0;this.comp=e}size(){return this.count}add(e){this.count>0?this.siftUp(this.count,e):this.bheap[0]=e,this.count++}poll(){if(this.count>0){this.count--;let e=this.bheap[0];return this.count>0&&this.siftDown(0,this.bheap[this.count]),e}else return null}siftUp(e,t){for(;e>0;){let n=e-1>>>1,i=this.bheap[n];if(this.comp(t,i)>=0)break;this.bheap[e]=i,e=n}this.bheap[e]=t}siftDown(e,t){let n=this.count>>>1;for(;e<n;){let i=(e<<1)+1,s=this.bheap[i],o=i+1;if(o<this.count){let a=this.bheap[o];this.comp(s,a)>0&&(i=o,s=a)}if(this.comp(t,s)<=0)break;this.bheap[e]=s,e=i}this.bheap[e]=t}};var A2=(n=>(n[n.MAX_COST=0]="MAX_COST",n[n.NODE_PAIR_RATE=1]="NODE_PAIR_RATE",n[n.NODE_RATE=2]="NODE_RATE",n))(A2||{});function zm(r,e,t){let n=new Ma(r,e);if(!t.vertexNodePairMap.containsKey(n)){let i=new Vm(n.node1,n.node2,t);t.vertexNodePairMap.put(n,i),t.vertexNodePairPriorityQueue.add(i)}}function au(r,e){let t=e.get(r);return t||(t=new Xm(r),e.put(r,t)),t}function Ym(r,e){if(r.m===e.m&&r.n===e.n){let t=new Array(r.m*r.n);for(let n=0;n<t.length;n++)t[n]=r.data[n]+e.data[n];return new vn(r.m,e.n,t)}else throw new Error("Two matrices have different dimensions!")}var Xm=class{constructor(e){this.costMatrix=new vn(4,4,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);this.indexSetDict={};this.adjaNodeSet=new Set;this.isBorder=!1;this.vertex=e}isBorderNode(){return this.isBorder}determineBorder(){let e=Object.keys(this.indexSetDict);this.isBorder=e.length>1?!0:this.indexSetDict[e[0]].size<this.adjaNodeSet.size}getAdjaNodeSet(){return this.adjaNodeSet}addAdjaNode(e){this.adjaNodeSet.add(e)}delAdjaNode(e){this.adjaNodeSet.delete(e)}getCostMatrix(){return this.costMatrix}addCostMatrix(e){this.costMatrix=Ym(this.costMatrix,e)}getIndexSetDict(){return this.indexSetDict}addIndexes(e,t){this.indexSetDict[e]||(this.indexSetDict[e]=new Set);for(let n of t)this.indexSetDict[e].add(n)}},Ma=class{constructor(e,t){this.node1=e,this.node2=t}hashCode(){return Math.ceil(8192*(this.node1.vertex.x+this.node1.vertex.y+this.node1.vertex.z))+Math.ceil(8192*(this.node2.vertex.x+this.node2.vertex.y+this.node2.vertex.z))}equals(e){return this.node1===e.node1&&this.node2===e.node2||this.node1===e.node2&&this.node2===e.node1}},Vm=class{constructor(e,t,n){this.node1=e,this.node2=t,this.globalData=n,this.contractResult=this.calContractResult(),this.discarded=!1}calCost(e,t){let n=[t.x,t.y,t.z,1];return Math.max(0,new vn(1,4,n).mul(e).mul(new vn(4,1,n)).data[0])}isFlipped(e,t,n){let i=Array.from(e.getAdjaNodeSet());for(let s=0;s<i.length-1;s++)if(i[s]!==n){for(let o=s+1;o<i.length;o++)if(i[o]!==n&&me.normal(e.vertex,i[s].vertex,i[o].vertex).dot(me.normal(t,i[s].vertex,i[o].vertex))<0)return!0}return!1}calContractResult(){if(this.node1.isBorderNode()&&this.node2.isBorderNode())return{newVertex:null,cost:Number.POSITIVE_INFINITY};let e=Ym(this.node1.getCostMatrix(),this.node2.getCostMatrix());if(this.node1.isBorderNode())return this.isFlipped(this.node2,this.node1.vertex,this.node1)?{newVertex:null,cost:Number.POSITIVE_INFINITY}:{newVertex:this.node1.vertex,cost:this.calCost(e,this.node1.vertex)};if(this.node2.isBorderNode())return this.isFlipped(this.node1,this.node2.vertex,this.node2)?{newVertex:null,cost:Number.POSITIVE_INFINITY}:{newVertex:this.node2.vertex,cost:this.calCost(e,this.node2.vertex)};let t=[e.data.slice(0,4),e.data.slice(4,8),e.data.slice(8,12)];for(let o=0;o<3;o++){for(let a=o;a<3;a++)if(t[a][o]!==0){let l=t[a];t[a]=t[o],t[o]=l}if(t[o][o]!==0)for(let a=o+1;a<3;a++){let l=t[a][o]/t[o][o];for(let u=o;u<4;u++)t[a][u]-=t[o][u]*l}}let n=this.node1.vertex.add(this.node2.vertex).scale(.5),i=[n.x,n.y,n.z];for(let o=2;o>=0;o--){if(t[o][o]===0)continue;let a=-t[o][3];for(let l=2;l>o;l--)a-=i[l]*t[o][l];i[o]=a/t[o][o]}let s=new me(i[0],i[1],i[2]);return!this.globalData.originalBBox.isContains(s)||this.isFlipped(this.node1,s,this.node2)||this.isFlipped(this.node2,s,this.node1)?{newVertex:null,cost:Number.POSITIVE_INFINITY}:{newVertex:s,cost:this.calCost(e,s)}}dealNewNode(e,t){if(t===e)return;this.globalData.vertexNodeMap.remove(e.vertex),t.addCostMatrix(e.getCostMatrix());let n=e.getIndexSetDict();for(let i in n)t.addIndexes(Number(i),n[i])}reconnectNode(e,t){t!==e&&e.getAdjaNodeSet().forEach(n=>{this.globalData.vertexNodePairMap.remove(new Ma(e,n)).discard(),n.delAdjaNode(e),n!==t&&(n.addAdjaNode(t),t.addAdjaNode(n),zm(t,n,this.globalData)),n.getAdjaNodeSet().forEach(i=>{i!==t&&(this.globalData.vertexNodePairMap.remove(new Ma(n,i)).discard(),zm(n,i,this.globalData))})})}contract(){this.globalData.vertexNodePairMap.remove(new Ma(this.node1,this.node2)).discard(),this.node1.delAdjaNode(this.node2),this.node2.delAdjaNode(this.node1);let e=au(this.contractResult.newVertex,this.globalData.vertexNodeMap);this.dealNewNode(this.node1,e),this.dealNewNode(this.node2,e),this.reconnectNode(this.node1,e),this.reconnectNode(this.node2,e)}isDiscarded(){return this.discarded}discard(){this.discarded=!0}};function B2(r){let e=new Array;for(let t=0;t<r.length;t+=3)me.normal(r[t],r[t+1],r[t+2]).isZeroVector()||e.push(r[t],r[t+1],r[t+2]);return e}function WG(r){let e=new Array(r.length/3);for(let t=0;t<e.length;t++){let n=me.normal(r[t*3],r[t*3+1],r[t*3+2]).normalize(),i=[n.x,n.y,n.z,-r[t*3].x*n.x-r[t*3].y*n.y-r[t*3].z*n.z];e[t]=new vn(4,1,i).mul(new vn(1,4,i))}return e}function T2(r,e=0,t=.5){if(r.forEach(a=>{if(a.length%3!==0)throw new Error("The length of vertexes is not a multiple of 3!")}),r.length===0)return[];if(e===0){let a=new zr;for(let u of r)for(let c of u)a.ext3(c);let l=a.build();t=((l.maxX-l.minX)**2+(l.maxY-l.minY)**2+(l.maxZ-l.minZ)**2)*t**2}let n=[];r.forEach(a=>{n.push(B2(a))});let i=new Jr;JG(n,i);let s=new Jr,o=new As((a,l)=>a.contractResult.cost-l.contractResult.cost);return jG(n,i),$G(i),KG(i,s,o),HG(i,s,o,e,t),ZG(i,n),n.forEach((a,l)=>n[l]=B2(a)),n}function $G(r){let e=r.values();for(;e.hasNext();)e.next().determineBorder()}function jG(r,e){r.forEach(t=>{for(let n=0;n<t.length;n+=3){let i=[au(t[n],e),au(t[n+1],e),au(t[n+2],e)];i[0].addAdjaNode(i[1]),i[0].addAdjaNode(i[2]),i[1].addAdjaNode(i[0]),i[1].addAdjaNode(i[2]),i[2].addAdjaNode(i[0]),i[2].addAdjaNode(i[1])}})}function HG(r,e,t,n,i){let s=r.size(),o=e.size(),a=t.poll();for(;a&&Number.isFinite(a.contractResult.cost);){if(n===0){if(a.contractResult.cost>=i)return}else if(n===1){if(1-e.size()/o>=i)return}else if(n===2&&1-r.size()/s>=i)return;for(a.contract();a&&a.isDiscarded();)a=t.poll()}}function ZG(r,e){let t=r.values();for(;t.hasNext();){let n=t.next(),i=n.getIndexSetDict();for(let s in i)i[s].forEach(o=>e[s][o]=n.vertex)}}function KG(r,e,t){let n={vertexNodeMap:r,vertexNodePairMap:e,vertexNodePairPriorityQueue:t,originalBBox:QG(r)},i=r.values();for(;i.hasNext();){let s=i.next();s.getAdjaNodeSet().forEach(o=>zm(s,o,n))}}function QG(r){let e=r.values(),t=new zr;for(;e.hasNext();){let n=e.next().vertex;t.ext3(n)}return t.build()}function JG(r,e){let t={},n={};r.forEach((i,s)=>{t[s]=WG(i),n[s]=eF(i)});for(let i=0;i<r.length;i++){let s=n[i].entries();for(;s.hasNext();){let o=s.next(),a=new vn(4,4,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let u of o.value)a=Ym(a,t[i][Math.floor(u/3)]);let l=au(o.key,e);l.addIndexes(i,o.value),l.addCostMatrix(a)}}}function eF(r){let e=new Jr;for(let t=0;t<r.length;t++)e.containsKey(r[t])?e.get(r[t]).add(t):e.put(r[t],new Set([t]));return e}function Kce(r){let e=new Array;for(let t=0;t<r.length;t+=3){let n=me.normal(r[t],r[t+1],r[t+2]),i=n.length()===0?n:n.normalize();e.push(i,i,i)}return e}function Na(r,e=Math.PI/5){let t=new Array(r.length/3);for(let o=0;o<t.length;o++)t[o]=me.normal(r[o*3],r[o*3+1],r[o*3+2]);let n=new Jr;for(let o=0;o<r.length;o+=3)for(let a=0;a<3;a++)n.containsKey(r[o+a])?n.get(r[o+a]).push(t[o/3]):n.put(r[o+a],[t[o/3]]);let i=new Array(r.length),s=Math.cos(e);for(let o=0;o<i.length;o+=3)for(let a=0;a<3;a++)i[o+a]=tF(t[o/3],n.get(r[o+a]),s);return i}function tF(r,e,t){let n=new Array(e.length);for(let s=0;s<n.length;s++)n[s]=e[s].scale(rF(r,e[s],t));let i=new me(0,0,0);for(let s of n)i=i.add(s);return i}function rF(r,e,t){return r.isZeroVector()||e.isZeroVector()?1:nF(r,e)<=t?0:1}function nF(r,e){return Math.max(-1,Math.min(1,(r.x*e.x+r.y*e.y+r.z*e.z)/(r.length()*e.length())))}var C2=new ArrayBuffer(8*4),Rh=new Float64Array(C2),iF=new Int32Array(C2),qt=class{static of(e){return new qt(e>>16&255,e>>8&255,e&255)}static of1(e){return this.of2(e>>16&255,e>>8&255,e&255)}static of2(e,t,n,i=255){return new qt(e/255,t/255,n/255,i/255)}static of3(e){if(e.startsWith("#")&&(e=e.substr(1)),e.length==3)return new qt(parseInt(e[0],16)/15,parseInt(e[1],16)/15,parseInt(e[2],16)/15);if(e.length==6)return new qt(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255);throw new Error("invalid color string")}static of4(e){let t=parseInt(e.r*255+"").toString(16),n=parseInt(e.g*255+"").toString(16),i=parseInt(e.b*255+"").toString(16);return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),("#"+t+n+i).toUpperCase()}static of5(e,t){if(e.startsWith("#")&&(e=e.substr(1)),e.length==3)return new qt(parseInt(e[0],16)/15,parseInt(e[1],16)/15,parseInt(e[2],16)/15,t);if(e.length==6)return new qt(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255,t);throw new Error(`invalid color string: ${e!==void 0?e:"undefined"}`)}static of6(e,t){return new qt(e.r,e.g,e.b,t)}clone(){return new qt(this.r,this.g,this.b)}constructor(e,t,n,i=1){if(e<0||e>1||t<0||t>1||n<0||n>1||i<0||i>1)throw new Error("r, g, b, and alpha must be between 0 and 1!");this.r=e,this.g=t,this.b=n,this.alpha=i,Rh[0]=e,Rh[1]=t,Rh[2]=n,Rh[3]=i;let s=0;for(let o=0;o<8;o++)s^=iF[o];this.hashed=s}hashCode(){return this.hashed}equals(e){return e instanceof qt?e.r===this.r&&e.g===this.g&&e.b===this.b&&e.alpha===this.alpha:!1}add(e,t,n,i){return new qt(Math.max(0,Math.min(1,this.r+e)),Math.max(0,Math.min(1,this.g+t)),Math.max(0,Math.min(1,this.b+n)),Math.max(0,Math.min(1,this.alpha+i)))}mul(e){return new qt(Math.max(0,Math.min(1,this.r*e)),Math.max(0,Math.min(1,this.g*e)),Math.max(0,Math.min(1,this.b*e)),this.alpha)}getData(){return[this.r,this.g,this.b,this.alpha]}getDataObj(){return{r:this.r,g:this.g,b:this.b,a:this.alpha}}toString(){let e=(this.r*255).toString(16),t=(this.g*255).toString(16),n=(this.b*255).toString(16);return e.length<2&&(e="0"+e),t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),"#"+e.substr(0,2)+t.substr(0,2)+n.substr(0,2)}toRGBA(){let e=this.r*255,t=this.g*255,n=this.b*255;return[e,t,n,this.alpha]}isWHITE(){return this.r===1&&this.g===1&&this.b===1&&this.alpha===1}},Fe=qt;Fe.WHITE=new qt(1,1,1,1),Fe.BLACK=new qt(0,0,0,1),Fe.RED=new qt(1,0,0,1),Fe.GREEN=new qt(0,1,0,1),Fe.BLUE=new qt(0,0,1,1),Fe.YELLOW=new qt(1,1,0,1),Fe.PURPLE=new qt(1,0,1,1),Fe.CYAN=new qt(0,1,1,1),Fe.Gray=qt.of3("#9966ff"),Fe.LightGray=qt.of3("#d9d9d9"),Fe.Silver=qt.of3("#c0c0c0"),Fe.Golden=qt.of3("#d9d919"),Fe.ZERO=new qt(0,0,0,0),Fe.ORANGE=qt.of3("#ffa500");var fr=(s=>(s[s.USE_COLOR=0]="USE_COLOR",s[s.USE_MATERIAL=1]="USE_MATERIAL",s[s.RELY_ON_OTHER=2]="RELY_ON_OTHER",s[s.FORCE_TO_USE_SINGLE_COLOR=3]="FORCE_TO_USE_SINGLE_COLOR",s[s.WIREFRAME=4]="WIREFRAME",s))(fr||{}),Ts=class{constructor(e,t,n){this.outMatrixParamMap=new Map;e&&(this.color=e),t&&(this.material=t),n&&(this.className=n)}getMaterial(){return this.material}setMaterial(e){this.material=e}getColor(){return this.color}setColor(e){this.color=e}updateMatrixs(e){for(let t of e.entries())this.outMatrixParamMap.has(t[0])?(this.outMatrixParamMap.set(t[1],this.outMatrixParamMap.get(t[0])),this.outMatrixParamMap.delete(t[0])):this.outMatrixParamMap.set(t[1],{visible:!0,color:Fe.BLACK,drawn:!0})}preDraw(){for(let e of this.outMatrixParamMap.values())e.drawn=!1}markDrawn(e){this.outMatrixParamMap.get(e).drawn=!0}hadDrawn(e){return this.outMatrixParamMap.get(e).drawn}removeOutMatrixs(e){for(let t of e)this.outMatrixParamMap.delete(t);this.outMatrixParamMap.size===0&&this.clear()}setOutMatrixVisible(e,t){this.outMatrixParamMap.get(t).visible=e}setSingleColor(e,t){this.outMatrixParamMap.get(t).color=e}getSingleColor(e){return this.outMatrixParamMap.get(e).color}};var che=5,Ii=class{constructor(e,t,n=Float32Array,i=e.STATIC_DRAW,s=null){this.gl=e,this.size=t,this.usage=i,this.arrayConstructor=n,s?(this.updateAllData=s,this.updateSubDataMap=new Map):this.modify=!1}vertexAttribPointer(e,t){let n=this.gl;if((this.updateAllData?this.updateSubDataMap.size===0:!this.modify)&&!this.buffer){n.vertexAttrib4f(e,0,0,0,0),n.disableVertexAttribArray(e);return}this.updateData(n.ARRAY_BUFFER),n.vertexAttribPointer(e,t,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,null)}updateData(e){let t=this.gl,n=this.buffer;if(this.buffer||(this.buffer=t.createBuffer()),t.bindBuffer(e,this.buffer),this.updateAllData){if(this.updateSubDataMap.size===5||!n)this.data=new this.arrayConstructor(this.size),this.updateAllData(),t.bufferData(e,this.data,this.usage),delete this.data,delete this.modify,this.updateSubDataMap.clear();else if(this.updateSubDataMap.size!==0){let i=this.arrayConstructor===Uint16Array?2:4;for(let[s,o]of this.updateSubDataMap)t.bufferSubData(e,i*s,new this.arrayConstructor(o));this.updateSubDataMap.clear()}}else this.modify&&(t.bufferData(e,this.data,this.usage),this.modify=!1)}bindElementBuffer(){this.updateData(this.gl.ELEMENT_ARRAY_BUFFER)}bufferSubData(e,t){this.updateAllData?this.data?(this.data.set(t,e),this.modify=!0):this.updateSubDataMap.size<5&&this.updateSubDataMap.set(e,t):(this.data||(this.data=new this.arrayConstructor(this.size)),this.data.set(t,e),this.modify=!0)}drop(){this.gl.deleteBuffer(this.buffer),delete this.buffer,this.updateAllData||(this.modify=!0)}getSize(){return this.size}};var en=3*2**12;function _t(r,e){return r&&(()=>{for(let t of r)t&&e(t)})}var Ra=class{constructor(e,t,n,i,s,o=null){this.bboxFac2=new Oe;this._vertexes3D=[null,null,null,null];this.needUpdataVertexes3D=!1;this.leafNum=1;this.renderer=e,this.program=t,this.createObjs=n,this.createBuffer=i,this.createSubtree=s,this.parent=o,this.objs=n(),this.buffer=i(this.renderer,this.objs),this.elementBuffer=new Ii(this.renderer.gl,en,Uint16Array)}addSubtreeNum(){this.leafNum++;let e=this.parent;for(;e;)e.leafNum++,e=e.parent}get vertexes3D(){if(this.needUpdataVertexes3D){let e=this.bboxFac2.build();this._vertexes3D[0]=new me(e.minX,e.minY,0),this._vertexes3D[1]=new me(e.minX,e.maxY,0),this._vertexes3D[2]=new me(e.maxX,e.minY,0),this._vertexes3D[3]=new me(e.maxX,e.maxY,0),this.needUpdataVertexes3D=!1}return this._vertexes3D}split(){let e=this.bboxFac2.build(),t,n;e.width()>e.height()?(t="maxX",n="minX"):(t="maxY",n="minY");let i=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(let a of this.objs){let l=a.bbox();l[t]>i&&(i=l[t]),l[n]<s&&(s=l[n])}this.subtree1=this.createSubtree(this),this.subtree2=this.createSubtree(this),this.addSubtreeNum();let o=s+i;for(let a of this.objs){let l=a.bbox();l[n]+l[t]<o?this.subtree1.addObj(a):this.subtree2.addObj(a)}this.buffer.drop(),this.buffer=null,this.elementBuffer.drop(),this.elementBuffer=null,this.objs=null}addToSubtree0(e){if(this.subtree1.leafNum*4<this.subtree2.leafNum)this.subtree1.addObj(e);else if(this.subtree2.leafNum*4<this.subtree1.leafNum)this.subtree2.addObj(e);else{let t=e.bbox().center();t.distance2(this.subtree1.bboxFac2.build().center())<t.distance2(this.subtree2.bboxFac2.build().center())?this.subtree1.addObj(e):this.subtree2.addObj(e)}}addToSubtree(e){return this.bboxFac2.ext1(e.bbox()),this.needUpdataVertexes3D=!0,this.objs?!1:(this.addToSubtree0(e),!0)}renderIter(e,t,n,i){if(this.isEmpty())return;let s=new zr;this.vertexes3D.forEach(a=>s.ext3(a.multiply4(e)));let o=s.build();if(!(o.minX+t.x>1||o.maxX+t.x<-1||o.minY+t.y>1||o.maxY+t.y<-1)){if(this.buffer){this.buffer.isEmpty()||i(this);return}n.push(this.subtree1),n.push(this.subtree2)}}renderCb(e){e.program.render(e.buffer,e.elementBuffer)}render(e,t){let n=new Array;this.renderIter(e,t,n,this.renderCb);let i=n.pop();for(;i;)i.renderIter(e,t,n,this.renderCb),i=n.pop()}clearIter(e){this.buffer?(this.buffer.drop(),this.elementBuffer.drop()):(e.push(this.subtree1),e.push(this.subtree2))}clear(){let e=new Array;this.clearIter(e);let t=e.pop();for(;t;)t.clearIter(e),t=e.pop();this.subtree1=null,this.subtree2=null,this.objs=this.createObjs(),this.bboxFac2.clear(),this.buffer=this.createBuffer(this.renderer,this.objs),this.elementBuffer=new Ii(this.renderer.gl,en,Uint16Array),this._vertexes3D[0]=null,this._vertexes3D[1]=null,this._vertexes3D[2]=null,this._vertexes3D[3]=null}trim(){if(!this.parent)return;this.buffer.drop(),this.elementBuffer.drop();let e=this.parent.subtree1===this?this.parent.subtree2:this.parent.subtree1;this.parent.subtree1=e.subtree1,this.parent.subtree2=e.subtree2,this.parent.objs=e.objs,this.parent.bboxFac2=e.bboxFac2,this.parent.buffer=e.buffer,this.parent.elementBuffer=e.elementBuffer,this.parent._vertexes3D=e.vertexes3D}getBuffer(){return this.buffer}getElementBuffer(){return this.elementBuffer}getBBox(){try{return this.bboxFac2.build()}catch{return null}}isEmpty(){return this.buffer&&this.buffer.isEmpty()}};var Dn=class extends Ra{constructor(e,t,n,i=null){super(e,t,()=>new Array,n,s=>new Dn(e,t,n,s),i)}addObj(e){if(this.addToSubtree(e))return;if(!this.buffer.hasNEmpty(1)){this.split(),this.subtree1.isEmpty()?this.subtree1.addObj(e):this.subtree2.isEmpty()?this.subtree2.addObj(e):this.addObj(e);return}let t=this.buffer.getNEmpty(1)[0];this.objs[t]=e,e.enterBuffer(t,this)}remove(e,t){let n=e.getId();this.buffer.remove(n),this.elementBuffer.bufferSubData(n*t,new Float32Array(t)),this.objs[n]=null,this.buffer.isEmpty()&&this.trim()}};var Lh=null,Wm=new ArrayBuffer(8),La=new Float64Array(Wm),Oa=new Uint32Array(Wm),Oh=new Uint16Array(Wm);function En(r,e,t,n){i(r,null,e,t,n);function i(o,a,l,u,c){let h,f,d,m;if(u<c-1){let p=c-u;if(p>50)a===null&&(a=new Array(p+1)),s(o,a,l,u,(u+c)/2|0,c);else{h=o[u],f=u,d=u,m=c;let g=f+1;for(;g<m;){if(d!=m){if(m=m+-1,l(h,o[m])<=0)continue;o[d]=o[m],d=m;continue}if(l(h,o[g])>=0){f=g,g=f+1;continue}o[d]=o[g],f=g,d=g,g=f+1}o[d]=h,i(o,a,l,u,d),i(o,a,l,d+1,c)}}}function s(o,a,l,u,c,h){i(o,a,l,u,c),i(o,a,l,c,h);for(var f=u,d=c,m=0,p=o[f],g=o[d];f<c&&d<h;){var b=l(p,g);isNaN(b)?(a[m++]=g,g=o[++d]):(b<=0&&(a[m++]=p,p=o[++f]),b>=0&&(a[m++]=g,g=o[++d]))}for(;f<c;f++)a[m++]=o[f];for(;d<h;d++)a[m++]=o[d];for(f=u,d=0;d<m;f++,d++)o[f]=a[d]}}var pr=class{static repeat(e,t){let n=new Array(t);for(;t-- >0;)n[t]=e;return n.join("")}static lpad(e,t,n){let i=n-e.length;if(i>0){return this.repeat(t,i)+e}else return e}static rpad(e,t,n){let i=n-e.length;if(i>0){return e+this.repeat(t,i)}else return e}static strHashcode(e){if(e.length>0){let t=0;for(let n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0;return t}else return 0}static arraycopy(e,t,n,i,s){if(e.length>=t+s&&n.length>=i+s)for(;s-- >0;)n[i++]=e[t++];else throw new Error("arraycopy out of range")}static undefAsNull(e){return typeof e>"u",null}static reverse(e,t){for(let n=0,i=e.length-1;i>=0;n++,i--)t[n]=e[i];return t}static sortAsc(e,t){return e-t}static xmlDecode(e){let t=e.length,n=new Array,i=-1;for(let s=0;s<t;s++){let o=e.charAt(s);if(i>=0){if(o===";"){let a=e.substring(i+1,s);switch(a){case"lt":n.push("<");break;case"gt":n.push(">");break;case"quot":n.push('"');break;case"apos":n.push("'");break;case"amp":n.push("&");break;default:if(a.charAt(0)==="#"){let l=parseInt(a.substring(1));n.push(String.fromCharCode(l))}else n.push("&"+a+";")}i=-1}}else o==="&"?i=s:n.push(o)}return i>=0&&n.push(e.substring(i)),n.join("")}static addAll(e,t){for(let n of t)e.push(n)}static contains(e,t){for(let n of e)if(n.equals(t))return!0;return!1}static equals(e,t){if(e.length==t.length){for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}else return!1}static remove(e,t){let n=0,i=e.length;for(let s=0;s<i;s++)e[s]===t&&(e.splice(s,1),s--,i--,n++);return n}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),n=0;n<t.length;n++){var i=t[n].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}static prefix(){if(!Lh){let e=this.getUrlVars().version;e?Lh="/analyzer/v"+e:Lh="/analyzer"}return Lh}static add2objS(e,t,n){if(t in e)return e[t];{let i=n(t);return e[t]=i,i}}static downloadFile(e,t){let n=document.createElement("a"),i=URL.createObjectURL(t);n.download=e,n.href=i,n.click(),URL.revokeObjectURL(i)}static uuid(){let e=new Array;La[0]=new Date().getTime(),e.push(Oa[1].toString(16)),La[0]=Math.random(),e.push(Oh[3].toString(16));let t=Oh[2].toString(16);e.push("4"+t.substr(0,3)),La[0]=performance.now();let n=Oa[0].toString(16)+Oa[1].toString(16);return e.push("0"+n.substr(0,3)),e.push(n.substr(3)),e.join("-")}static funcCopy(e){return self.eval("("+e.toString()+")")}static NVL(...e){for(let t of e)if(t!==null)return t;return null}static getFileType(e){var t=e.lastIndexOf(".");return t!=-1?e.substring(t+1,e.length).toLowerCase():""}static string2Uint8Array(e){let t=[];for(let n=0,i=e.length;n<i;++n)t.push(e.charCodeAt(n));return new Uint8Array(t)}},$m=ArrayBuffer;try{$m=self.HTMLImageElement||$m}catch{}function M2(r){if(typeof r!="object"||r===null||r instanceof Date||r instanceof ArrayBuffer||r instanceof Blob||r instanceof $m)return r;if(Array.isArray(r))return r.map(M2);{let e={};for(let t in r)r.hasOwnProperty(t)&&(e[t]=M2(r[t]));return e}}function R2(r,e){return sF(r,e,()=>[])}function sF(r,e,t){let n=r[e];return n!==void 0||(n=t(e),r[e]=n),n}function Cs(r,e){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(e(void 0,r[t],t)===!1)return}else{let t=0;for(let n in r)if(r.hasOwnProperty(n)){let i=r[n];if(e(n,i,t)===!1)return;t++}}}var oF=Object.prototype.hasOwnProperty;async function L2(r,e){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(await e(void 0,r[t],t)===!1)return}else{let t=0;for(let n in r)if(oF.call(r,n)){let i=r[n];if(await e(n,i,t)===!1)return;t++}}}function Xhe(r,e){let t=0,n=0;return(...i)=>{let s=++t;setTimeout(()=>{let o=performance.now();if(s===t||o-n>=r){try{e(...i)}catch(a){console.log(a)}n=o}},Math.max(0,r-(performance.now()-n)))}}async function ka(r,e,t=()=>{}){let n=r.length,i=0;for(;i<n;){let s=r.indexOf(`
`,i);s<0&&(s=n);let o=r.substring(i,s);try{if(e(o)===!1)return}catch(l){console.error(l)}i=s+1;let a=t();a instanceof Promise&&await a}}function Ua(r){let e=!0,t;return()=>((e||t===""||t===" "||t===null||t===void 0||t==="null"||t==="undefined"||t==="NaN")&&(e=!1,t=r()),t)}var jm=0;function kh(){jm===0&&(jm=Date.now()-performance.now());let r=new Array,e=jm+performance.now();La[0]=e,r.push(Oa[1].toString(16)),La[0]=Math.random(),r.push(Oh[3].toString(16));let t=Oh[2].toString(16);r.push("4"+t.substr(0,3)),La[0]=e;let n=Oa[0].toString(16)+Oa[1].toString(16);return r.push("0"+n.substr(0,3)),r.push(n.substr(3)),r.join("-")}var Bo=class{constructor(e){this.resources=e,this.idle=[]}acquire(e){this.resources>0?(this.resources--,e()):this.idle.push(e)}acquireSync(){return new Promise(e=>{this.acquire(e)})}release(){let e=this.idle.shift();e?Promise.resolve().then(e):this.resources++}};function Gn(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function Vhe(r,e,t){let n=r.length+e-1;for(let i=0;i<n;i++){let s=new Array;for(let o=i-e+1;o<=i;o++)s.push(r[o]);if(t(s)===!1)break}}function Whe(){let r=new Date,e=r.getFullYear(),t=r.getMonth()+1,n=r.getDate(),i=r.getHours(),s=r.getMinutes(),o=r.getSeconds(),a=r.getMilliseconds();return"["+e+"-"+(t<10?"0"+t:t)+"-"+(n<10?"0"+n:n)+" "+(i<10?"0"+i:i)+":"+(s<10?"0"+s:s)+":"+(o<10?"0"+o:o)+"."+(a<100?a<10?"00"+a:"0"+a:a)+"] "}async function O2(r){let e=typeof r=="string"?new TextEncoder().encode(r):r,t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(s=>s.toString(16).padStart(2,"0")).join("")}var ns=new Uint8Array(123);for(let r=25;r>=0;--r)ns[48+r]=52+r,ns[65+r]=r,ns[97+r]=26+r;ns[43]=62,ns[47]=63;function $he(r){for(var e,t,n=0,i=0,s=r.length,o=new Uint8Array((s*3>>2)-(r[s-2]=="="?1:0)-(r[s-1]=="="?1:0));n<s;n+=4,i+=3)e=ns[r.charCodeAt(n+1)],t=ns[r.charCodeAt(n+2)],o[i]=ns[r.charCodeAt(n)]<<2|e>>4,o[i+1]=e<<4|t>>2,o[i+2]=t<<6|ns[r.charCodeAt(n+3)];return o}function jhe(r,e){if(!r||Object.prototype.toString.call(r)!="[object Date]")return;function t(i,s){let o=-Math.round(i.getTimezoneOffset()/15)*15,a=~~(o/60),l=~~o%60,u="+";return o<0&&(u="-"),u+("00"+a).slice(-2)+s+("00"+l).slice(-2)}let n={"M+":r.getMonth()+1,"d+":r.getDate(),"h+":r.getHours(),"m+":r.getMinutes(),"s+":r.getSeconds(),S:r.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(/y+/,i=>(r.getFullYear()+"").slice(i.length==2?-2:0))),/(Z+)/.test(e)&&(e=e.replace(/Z+/,i=>t(r,i.length==1?":":"")));for(let i of Object.keys(n)){let s=new RegExp(i);s.test(e)&&(e=e.replace(s,o=>o.length==1?n[i]:("00"+n[i]).slice(-2)))}return e}function Hhe(r,e,...t){e=Object.assign({color:"#75de75","font-style":"italic","background-color":"#333",padding:"2px","font-size":"16px"},e),r.startsWith("%c")||(r="%c "+r+" "),console.log(r,JSON.stringify(e).replace(/["{}]/g,"").replace(/,/g,";"),...t)}var N2=new Bo(5);async function ci(r,e,t){typeof r=="string"&&(/https?:/.test(r)||(r=location.origin+r)),await N2.acquireSync();try{let n=!1,i=new Promise((o,a)=>setTimeout(()=>{n=!0,a()},t)),s=(async()=>{let o=await fetch(r,e);return n&&o.body.cancel(),o})();return await Promise.race([s,i])}finally{N2.release()}}var aF=(n=>(n[n.UNKNOWN=0]="UNKNOWN",n[n.PERCENT=1]="PERCENT",n[n.LEFT_PAD0=2]="LEFT_PAD0",n))(aF||{}),lF=/(\.?0+)$/,_n=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let n=this._format(e,t);if(typeof n=="string")return n;throw new Error(this.format("Invalid state on (%d) %s",n,e))}static _format(e,t){let n=[],i=0,s=0,o,a=0,l=0;for(let u=0;u<e.length;u++){let c=e.charAt(u),h=c.charCodeAt(0);switch(i){case 0:h===37?i=1:n.push(c);break;case 1:switch(h){case 100:if(o=t[s++],typeof o=="number")n.push(o.toFixed(0)),i=0;else return u;break;case 102:if(o=t[s++],typeof o=="number")n.push(o.toString()),i=0;else return u;break;case 120:if(o=t[s++],typeof o=="number")n.push((o|0).toString(16)),i=0;else return u;break;case 88:if(o=t[s++],typeof o=="number")n.push((o|0).toString(16).toUpperCase()),i=0;else return u;break;case 115:case 99:o=t[s++],n.push(o===null?"null":o.toString()),i=0;break;case 48:a=u+1,l=-1,i=2;break;case 37:n.push("%"),i=0;break;default:return u}break;case 2:switch(h){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:l=u;break;case 120:if(l>=a){let f=parseInt(e.substring(a,l+1));if(o=t[s++],typeof o=="number")n.push(pr.lpad((o|0).toString(16),"0",f)),i=0;else return u}else return u;break;case 88:if(l>=a){let f=parseInt(e.substring(a,l+1));if(o=t[s++],typeof o=="number")n.push(pr.lpad((o|0).toString(16).toUpperCase(),"0",f)),i=0;else return u}else return u;break;default:return u}break;default:return u}}return n.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static split(e,t){let n=new Array,i=0;for(;;){let s=e.exec(t);if(s!==null){let o=e.lastIndex-s[0].length;n.push(t.substring(i,o)),i=e.lastIndex}else{let o=t.substring(i);Ms.nullOrEmpty(o)||n.push(o);break}}return n}static fmtNumber(e){return e.toFixed(5).replace(lF,"")}};var Ms=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error(_n.format("RGB should not nagative and not over 255(0xFF): %X",e))}static normal(e){if(isFinite(e))return e;throw new Error(_n.format("%f is not permitted",e))}static positiveOr0(e){if(e>=0)return e;throw new Error(_n.format("%f must >= 0",e))}static positive(e){if(e>0)return e;throw new Error(_n.format("%f must > 0",e))}static notnull(e){if(e!=null)return e;throw new Error("invalid null value")}static mustnull(e){if(e===null)return null;throw new Error("value must be null")}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e}static nullOrEmpty(e){return e==null||e.length===0}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted")}};var Vr=class{constructor(e){this.childs=new Array;this._bbox=null;this.parent=null;this.capacity=e}bbox(){return Ms.notnull(this._bbox)}itor(e,t){for(let n of this.childs)n instanceof Vr?n.itor(e+1,t):t(n,e)}debug(e){for(let t of this.childs)console.log(e,t.bbox(),t instanceof Vr?"+":"-"),t instanceof Vr&&t.debug(e+" |--")}insert(e){let t=this.childs,n=e.bbox();for(let i=0;i<t.length;i++){let s=t[i];if(s instanceof Vr&&n.isInside(s.bbox())){s.insert(e),this._bbox=ye.extend2(this._bbox,n);return}}e instanceof Vr&&(e.parent=this),t.length<=this.capacity?t.push(e):(t.push(e),this.splitNode()),this._bbox=ye.extend2(this._bbox,n)}remove(e){if(e instanceof Vr&&e.childs.length>0)throw new Error;let t=this.childs,n=e.bbox(),i=new Array;for(let s=0;s<t.length;s++){let o=t[s];if(o===e)return t.splice(s,1),t.length>0?(this.updateBBox(),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox()):this.parent!==null?(this.parent.remove(this),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox()):this._bbox=null,1;o instanceof Vr&&n.isInside(o.bbox())&&i.push(o)}if(e instanceof Vr)throw new Error;for(let s of i){let o=s.remove(e);if(o===1)return this.childs.length>0&&this.updateBBox(),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox(),1;if(o!==0)throw new Error}return 0}updateBBox(){let e=new Oe;for(let t of this.childs)e.ext1(t.bbox());this._bbox=e.build()}splitNode(){let e=this.childs,t=e.length,n=-1,i=-1,s=Number.NEGATIVE_INFINITY;for(let u=0;u<t;u++){let c=e[u];for(let h=u+1;h<t;h++){let f=e[h],d=ye.extend2(c.bbox(),f.bbox()).area();d>s&&(s=d,n=u,i=h)}}let o=this.asNode(e[n]),a=this.asNode(e[i]);for(let u=0;u<t;u++)if(u!==n&&u!==i){let c=e[u],h=c.bbox(),f=ye.extend2(o._bbox,h).area(),d=ye.extend2(a._bbox,h).area();f<d?o.insert(c):a.insert(c)}e.length=0;let l=this.parent;l!==null&&l.childs.length<this.capacity?(o.parent=l,a.parent=l,l.childs.push(o),l.childs.push(a),l.remove(this),l.updateBBox()):(o.parent=this,a.parent=this,e.push(o),e.push(a),this.updateBBox()),this.childs.length>0&&this.updateBBox(),o.updateBBox(),a.updateBBox()}asNode(e){if(e instanceof Vr)return e;{let t=new Vr(this.capacity);return t.insert(e),t}}},Bi=class{constructor(e){this.items=new Set;this.root=new Vr(e)}itor(e){this.root.itor(0,e)}search(e){let t=[],n=[];for(n.push(this.root);;){let i=n.shift();if(i!==void 0)for(let s of i.childs)e.isSeparated(s.bbox())||(s instanceof Vr?n.push(s):t.push(s));else break}return t}insert(e){this.items.add(e),this.root.insert(e)}remove(e){return this.items.delete(e),this.root.remove(e)}bbox(){return this.root.bbox()}debug(){this.root.debug("")}};var lu=class{constructor(e,t,n,i,s){this.unitSize=t,this.size=n,this.long=i;let o=e.gl;i?(this.buffer=new Ii(o,n*this.unitSize,Uint32Array,o.STATIC_DRAW,s),this.setVertexIds=(a,l)=>{this.buffer.bufferSubData(a*this.unitSize,new Uint32Array(l))}):(this.buffer=new Ii(o,n*this.unitSize,Uint16Array,o.STATIC_DRAW,s),this.setVertexIds=(a,l)=>{this.buffer.bufferSubData(a*this.unitSize,new Uint16Array(l))})}getSize(){return this.size*this.unitSize}remove(e){this.setVertexIds(e,new Array(this.unitSize).fill(0))}drop(){this.buffer.drop()}};var dde=4294967295,fde=0;function uF(r){let e=r.toString(2),t=32-e.length;return t>0?"0".repeat(t)+e:e}var Fn=class{constructor(e,t=null){this.marked=0;this.emptyStart=0;this.max=-1;this.size=e,this.index=new Uint32Array(Math.ceil(e/32)),t&&(this.index.set(t.index),this.marked=t.marked,this.emptyStart=t.emptyStart)}extSize(e){return new Fn(e,this)}isEmpty(){return this.marked===0}getMarked(){return this.marked}getChunk(e){return this.index[e]}isUsed(e){let t=e/32|0,n=this.index[t];return n===4294967295?!0:n===0?!1:(n>>31-e&1)===1}markUsed(e){let t=e/32|0,n=this.index[t],i=1<<31-e;(n&i)===0&&(this.index[t]=n|i,this.marked++),e>this.max&&(this.max=e)}markRemove(e){let t=e/32|0,n=this.index[t],i=1<<31-e;(n&i)!==0&&(this.index[t]=n&(4294967295^i),this.marked--,e<this.emptyStart&&(this.emptyStart=e))}reset(){this.index.fill(0),this.marked=0,this.emptyStart=0,this.max=-1}findEmpty(e=1){if(this.size-this.marked<e)return-1;let t=this.index,n=-1,i=!1;for(let s=Math.floor(this.emptyStart/32);s<t.length;s++){let o=t[s];if(o===0){if(n===-1){if(n=s*32,i||(this.emptyStart=n,i=!0),e<=32)return n}else if((s+1)*32-n>=e)return n}else if(o!==4294967295)for(let a=31;a>=0;a--)if((o>>a&1)===0){let l=s*32+31-a;if(n===-1&&(n=l,i||(this.emptyStart=n,i=!0)),l-n+1>=e)return n}else n=-1;else n=-1}return-1}hasNEmpty(e=1){return this.size-this.marked>=e}findNEmpty(e=1){let t=[];if(this.size-this.marked<e)return t;if(this.size-this.max-1>=e){let i=this.max+e;for(let s=this.max+1;s<=i;s++)t.push(s);return t}let n=this.index;for(let i=Math.floor(this.emptyStart/32);i<n.length;i++){if(this.marked+t.length===i*32){for(let o=i*32;t.length!==e;o++)t.push(o);return this.emptyStart=t[0],t}let s=n[i];if(s===0){let o=i*32;if(t.indexOf(o)==-1){if(t.push(o),t.length>=e)return this.emptyStart=t[0],t;{let a=e-t.length;if(a<32){for(let l=0;l<a;l++)t.push(o+l+1);return this.emptyStart=t[0],t}else for(let l=0;l<31;l++)t.push(o+l+1)}}}else if(s!==4294967295){for(let o=31;o>=0;o--)if((s>>o&1)===0){let a=i*32+31-o;if(t.indexOf(a)==-1&&(t.push(a),t.length==e))return this.emptyStart=t[0],t}}}return this.emptyStart=t.length===0?this.size:t[0],[]}debug(){let e=[],t=this.index;for(let n=0;n<t.length;n++)e.push(uF(t[n]));console.log(e.join(" "))}};var yde=4,tn=class{constructor(e,t,n,i){this.buffers=new Array;this.index=new Fn(t),this.unitSizes=n;let s=e.gl;n.forEach((o,a)=>this.buffers.push(new Ii(s,t*o,Float32Array,s.STATIC_DRAW,i[a])))}getBuffer(e){return this.buffers[e]}setData(e,t,n){this.buffers[e].bufferSubData(t*this.unitSizes[e],n)}getSize(){return this.index.size}isEmpty(){return this.index.isEmpty()}hasNEmpty(e){return this.index.hasNEmpty(e)}getNEmpty(e){let t=this.index.findNEmpty(e);for(let n of t)this.index.markUsed(n);return t}remove(e){this.index.markRemove(e);for(let t=0;t<this.unitSizes.length;t++)this.buffers[t].bufferSubData(e*this.unitSizes[t],new Float32Array(this.unitSizes[t]))}drop(){for(let e of this.buffers)e.drop();this.buffers.length=0,this.index.reset()}};var Da=`
    precision highp float;
    precision highp int;

    uniform mat4 u_matrix;
	uniform mat4 u_MVPmatrix;
	uniform vec2 u_viewOffset;

	attribute float a_order;
	
	void calPosition(vec4 position) {
		gl_Position = u_MVPmatrix * u_matrix * position;
		gl_Position.xy += u_viewOffset * gl_Position.w;
		gl_Position.z = a_order / ${2**21}.0 * gl_Position.w;
	}
`,Uh=`
    precision highp float;
    precision highp int;
`,U2=1,Ga=[U2],Ao={order:0},Pt=[0,1,2],Dt=[0,1,2,3],er=[0,1,2,2,3,0],Ns=class{constructor(e,t,n){this.attrSettings=[];this.disabledAttrLocs=new Set;this.renderer=e,this.program=e.createProgram(t,n),this.u_matrixLoc=e.getUniformLoc(this.program,"u_matrix"),this.u_MVPmatrixLoc=e.getUniformLoc(this.program,"u_MVPmatrix"),this.u_viewOffsetLoc=e.getUniformLoc(this.program,"u_viewOffset"),this.addAttrSetting("a_order",Ao.order,U2)}addAttrSetting(e,t,n){let i=this.renderer.getAttrLoc(this.program,e);return this.attrSettings.push({loc:i,bufferIndex:t,unitSize:n}),i}enable(e){this.disabledAttrLocs.delete(e)}disable(e){this.disabledAttrLocs.add(e)}transBaseCameraData(e){let t=this.renderer.gl;t.useProgram(this.program),t.uniformMatrix4fv(this.u_MVPmatrixLoc,!1,new Float32Array(e.getRenderMatrix().data))}transMatrixData(e){let t=this.renderer.gl;t.useProgram(this.program),t.uniformMatrix4fv(this.u_matrixLoc,!1,new Float32Array(e.data))}transViewOffset(e,t){let n=this.renderer.gl;n.useProgram(this.program),n.uniform2fv(this.u_viewOffsetLoc,[e,t])}renderCb(e,t){let n=this.renderer.gl;n.useProgram(this.program);for(let i of this.attrSettings)n.enableVertexAttribArray(i.loc),e.getBuffer(i.bufferIndex).vertexAttribPointer(i.loc,i.unitSize);for(let i of this.disabledAttrLocs)n.disableVertexAttribArray(i);t();for(let i of this.attrSettings)n.disableVertexAttribArray(i.loc)}};var cF=Da+`
    attribute vec3 a_position; // [x, y, style]

    void main() {
        if (a_position.z == 0.0) {
            return;
		}
		calPosition(vec4(a_position.xy, 0, 1));
		gl_PointSize = 1.0;
    }
`,hF="void main() {gl_FragColor = vec4(0, 0, 0, 1);}",D2=3,F2=[...Ga,D2],Hm=Object.assign({position:1},Ao);function Dh(r,e){return new Fa(r,en/3,e)}var G2=class extends Ns{constructor(t){super(t,cF,hF);this.addAttrSetting("a_position",Hm.position,D2)}transRenderMode(t){this.renderMode=t}render(t){this.renderCb(t,()=>{let n=this.renderer.gl;this.renderMode===4?(t.lineElementBuffer.buffer.bindElementBuffer(),n.drawElements(n.LINES,t.lineElementBuffer.getSize(),t.lineElementBuffer.long?n.UNSIGNED_INT:n.UNSIGNED_SHORT,0)):(t.triangleElementBuffer.buffer.bindElementBuffer(),n.drawElements(n.TRIANGLES,t.triangleElementBuffer.getSize(),t.triangleElementBuffer.long?n.UNSIGNED_INT:n.UNSIGNED_SHORT,0))})}renderPoints(t){this.renderCb(t,()=>{let n=this.renderer.gl;n.drawArrays(n.POINTS,0,t.getSize())})}renderOne(t,n=this.renderMode){let i=this.renderMode;this.transRenderMode(n);let s=t.getInLeaf().getBuffer(),o=t.getStartId(),a=t.getPointNum();this.renderCb(s,()=>{let l=this.renderer.gl;this.renderMode===4?(s.lineElementBuffer.buffer.bindElementBuffer(),l.drawElements(l.LINES,a*2,s.lineElementBuffer.long?l.UNSIGNED_INT:l.UNSIGNED_SHORT,o*2*(s.lineElementBuffer.long?4:2))):(s.triangleElementBuffer.buffer.bindElementBuffer(),l.drawElements(l.TRIANGLES,a*3,s.triangleElementBuffer.long?l.UNSIGNED_INT:l.UNSIGNED_SHORT,o*3*(s.triangleElementBuffer.long?4:2)))}),this.transRenderMode(i)}};var Fa=class extends tn{constructor(t,n,i){super(t,n,F2,[()=>{},_t(i,o=>o.updatePosition())]);let s=n>2**16;this.triangleElementBuffer=new lu(t,3,n,s,_t(i,o=>o.updateTriangleElementBuffer())),this.lineElementBuffer=new lu(t,2,n,s,_t(i,o=>o.updateLineElementBuffer()))}remove(t){super.remove(t),this.triangleElementBuffer.remove(t),this.lineElementBuffer.remove(t)}drop(){super.drop(),this.triangleElementBuffer.drop(),this.lineElementBuffer.drop()}};var Rs=class extends Ra{constructor(e,t,n,i=null){super(e,t,()=>new Set,n,s=>new Rs(e,t,n,s),i)}addObj(e){if(this.addToSubtree(e))return;let t=e.getPointNum();if(!this.buffer.hasNEmpty(t))if(this.objs.size===0)this.buffer.drop(),this.buffer=new Fa(this.renderer,t,this.objs);else{this.split(),this.subtree1.isEmpty()?this.subtree1.addObj(e):this.subtree2.isEmpty()?this.subtree2.addObj(e):this.addObj(e);return}let n=this.buffer.getNEmpty(t);e.enterBuffer(n,this),this.objs.add(e)}remove(e){this.objs.delete(e),this.buffer.isEmpty()&&this.trim()}renderPointsCb(e){e.program.renderPoints(e.buffer)}renderPoints(e,t){let n=new Array;this.renderIter(e,t,n,this.renderPointsCb);let i=n.pop();for(;i;)i.renderIter(e,t,n,this.renderPointsCb),i=n.pop()}};var qn=class{constructor(e,t,n){this.inLeaf=null;this.id=-1;this.style=1;this._bbox=e,t&&(this.color=t),typeof n=="number"&&(this.order=n)}getInLeaf(){return this.inLeaf}render(){this.inLeaf.program.renderOne(this)}bbox(){return this._bbox}isRemoved(){return this.inLeaf===null}remove(e){this.inLeaf!==null&&(this.inLeaf.remove(this,e),this.inLeaf=null,this.id=-1)}getId(){return this.id}setData(e,t,n){let i=[];for(let s=0;s<t;s++)i.push(...n);this.inLeaf.getBuffer().setData(e,this.id,i)}updateColorOrder(){this.order!==void 0&&this.updateOrder(),this.color&&this.updateColor()}getColor(){return this.color}getOrder(){return this.order}};var Os=Da+`
	uniform int u_renderMode;
	uniform mat4 u_MVmatrix;
	uniform vec3 u_eyePosition;
	
    uniform float u_px_length;

	attribute vec4 a_color;
	attribute float a_index;

	varying vec3 v_normal;
	varying vec3 v_surfaceToEye;
    varying vec4 v_color;
	
	void preMaterial(vec4 position) {
		mat4 matrix = u_MVmatrix * u_matrix;
		v_normal = mat3(matrix) * vec3(0, 0, 1);
		vec4 pos = matrix * position;
		v_surfaceToEye = u_eyePosition - pos.xyz / pos.w;
	}
	
	void calParm(vec2 pos) {
		vec4 position = vec4(pos, 0, 1);
		calPosition(position);
		v_color = a_color;

        if(u_renderMode == 1) {
            preMaterial(position);
        }
	}
`,ks=Uh+`
	uniform int u_renderMode;

	uniform vec4 u_color;

	uniform vec3 u_ambientFactor;
	uniform vec3 u_diffuseFactor;
	uniform vec3 u_specularFactor;
	uniform float u_shininess;
	uniform float u_alpha;
	uniform float u_shadingRate;

	uniform vec3 u_ambientLightColor;
	uniform vec3 u_directLightDir;
	uniform vec3 u_directLightColor;

    uniform float u_px_length;

	uniform bool u_transparent;

	varying vec3 v_normal;
	varying vec3 v_surfaceToEye;
    varying vec4 v_color;

	void renderUseMaterial(vec3 ambientFactor, vec3 diffuseFactor, vec3 specularFactor, float alpha) {
		vec3 ambient = ambientFactor * u_ambientLightColor;
	
		vec3 normal = normalize(v_normal);
		vec3 directLightDir = normalize(u_directLightDir);
		vec3 diffuse = abs(dot(normal , directLightDir)) * diffuseFactor * u_directLightColor;
	
		vec3 reflect = -2.0 * normal * dot(directLightDir, normal) + directLightDir;
		vec3 surfaceToEye = normalize(v_surfaceToEye);
		float lightToEyeFactor = abs(dot(reflect, surfaceToEye));
		vec3 specular = specularFactor * u_directLightColor * pow(lightToEyeFactor, 300.0) * u_shininess * 0.1;
	
		gl_FragColor.rgb = ambient + diffuse + specular;
		gl_FragColor.a = alpha;
	}

	void calColor() {
		if(u_renderMode == 1) {
			if(v_color.r + v_color.g + v_color.b + v_color.a == 0.0) {
				renderUseMaterial(u_ambientFactor, u_diffuseFactor, u_specularFactor, u_alpha);
			// varying \u53D8\u91CF\u63D2\u503C\u6709\u8BEF\u5DEE\uFF0C\u56E0\u6B64\u4E0D\u4F7F\u7528\u662F\u5426\u7B49\u4E8E 1 \u5224\u65AD\u662F\u5426\u900F\u660E
			} else if((u_transparent && v_color.a < 0.999) || (!u_transparent && v_color.a > 0.999)){
				renderUseMaterial(vec3(0), v_color.rgb, vec3(0), v_color.a);
			} else {
				discard;
			}
        } else {
			if(v_color.r + v_color.g + v_color.b + v_color.a == 0.0) {
				gl_FragColor = u_color;
			} else if((u_transparent && v_color.a < 0.999) || (!u_transparent && v_color.a > 0.999)){
				gl_FragColor = v_color;
			} else {
				discard;
			}
		}
		gl_FragColor.a *= u_shadingRate;
	}
`;function Ls(r){return new Float32Array([r.r,r.g,r.b])}var q2=4,z2=1,Us=[...Ga,z2,q2],Ai=Object.assign({index:1,color:2},Ao),Ti=class extends Ns{constructor(t,n,i){super(t,n,i);this.u_renderModeLoc=t.getUniformLoc(this.program,"u_renderMode"),this.u_colorLoc=t.getUniformLoc(this.program,"u_color"),this.u_MVmatrixLoc=t.getUniformLoc(this.program,"u_MVmatrix"),this.u_eyePositionLoc=t.getUniformLoc(this.program,"u_eyePosition"),this.u_ambientFactorLoc=t.getUniformLoc(this.program,"u_ambientFactor"),this.u_diffuseFactorLoc=t.getUniformLoc(this.program,"u_diffuseFactor"),this.u_specularFactorLoc=t.getUniformLoc(this.program,"u_specularFactor"),this.u_shininessLoc=t.getUniformLoc(this.program,"u_shininess"),this.u_alphaLoc=t.getUniformLoc(this.program,"u_alpha"),this.u_shadingRateLoc=t.getUniformLoc(this.program,"u_shadingRate"),this.u_ambientLightColorLoc=t.getUniformLoc(this.program,"u_ambientLightColor"),this.u_directLightDirLoc=t.getUniformLoc(this.program,"u_directLightDir"),this.u_directLightColorLoc=t.getUniformLoc(this.program,"u_directLightColor"),this.u_pxLengthLoc=t.getUniformLoc(this.program,"u_px_length"),this.u_transparentLoc=t.getUniformLoc(this.program,"u_transparent"),this.addAttrSetting("a_index",Ai.index,z2),this.a_colorLoc=this.addAttrSetting("a_color",Ai.color,q2)}transSceneData(t,n){this.transBaseCameraData(n);let i=this.renderer.gl;i.useProgram(this.program),i.uniformMatrix4fv(this.u_MVmatrixLoc,!1,new Float32Array(n.getViewMatrix().data)),i.uniform3fv(this.u_ambientLightColorLoc,Ls(t.ambientLight.color)),i.uniform3fv(this.u_directLightColorLoc,Ls(t.directionalLight.color));let s=t.directionalLight.direction();i.uniform3fv(this.u_directLightDirLoc,new Float32Array([s.x,s.y,s.z]));let o=n.getRelativePosition();i.uniform3fv(this.u_eyePositionLoc,new Float32Array([o.x,o.y,o.z]))}transPlaneData(t,n,i,s){let o=this.renderer.gl;if(o.useProgram(this.program),o.uniform1f(this.u_pxLengthLoc,i),o.uniform1f(this.u_shadingRateLoc,s),t.isColorful?this.enable(this.a_colorLoc):this.disable(this.a_colorLoc),n)o.uniform4fv(this.u_colorLoc,[n.r,n.g,n.b,n.alpha]);else{let a=t.getMaterial();if(!a)return;o.uniform3fv(this.u_ambientFactorLoc,Ls(a.ambient)),o.uniform3fv(this.u_diffuseFactorLoc,Ls(a.diffuse)),o.uniform3fv(this.u_specularFactorLoc,Ls(a.specular)),o.uniform1f(this.u_shininessLoc,a.shininess),o.uniform1f(this.u_alphaLoc,a.alpha)}}transRenderMode(t){let n=this.renderer.gl;n.useProgram(this.program),n.uniform1i(this.u_renderModeLoc,t===0||t===3?0:t===1?1:t===4?2:-1)}transTransparent(t){let n=this.renderer.gl;n.useProgram(this.program),n.uniform1i(this.u_transparentLoc,t?1:0)}};var dF=Os+`
    attribute vec4 a_position12;
    attribute vec4 a_position34;
	attribute float a_style;

    //value == refer?1.0:0.0;
    float getValue(float value,float refer){
        return step(abs(sign(value - refer)),0.0);
    }

    void main() {
        if (a_style == 0.0) {
            return;
        }
		if(u_renderMode == 2){
			if(a_index == 0.0) {
				calParm(a_position12.xy + normalize(a_position12.xy - a_position12.zw) * u_px_length + normalize(a_position12.xy - a_position34.zw) * u_px_length);
			} else if(a_index == 1.0) {
				calParm(a_position12.zw + normalize(a_position12.zw - a_position34.xy) * u_px_length + normalize(a_position12.zw - a_position12.xy) * u_px_length);
			} else if(a_index == 2.0) {
				calParm(a_position34.xy + normalize(a_position34.xy - a_position34.zw) * u_px_length + normalize(a_position34.xy - a_position12.zw) * u_px_length);
			} else {
				calParm(a_position34.zw + normalize(a_position34.zw - a_position12.xy) * u_px_length + normalize(a_position34.zw - a_position34.xy) * u_px_length);
			}
		}else {
			calParm(a_position12.xy * getValue(0.0, a_index) + a_position12.zw * getValue(1.0, a_index) + a_position34.xy * getValue(2.0, a_index) + a_position34.zw * getValue(3.0, a_index));
		}
	}
`,fF=ks+`
    void main() {
		calColor();
    }
`,Y2=4,X2=4,V2=1,Wr=Object.assign({position12:3,position34:4,style:5},Ai);function $2(r,e,t=en/er.length){return new tn(r,t,[...Us,Y2,X2,V2].map(n=>n*Dt.length),[_t(e,n=>n.updateOrder()),_t(e,n=>n.updateIndex()),_t(e,n=>n.updateColor()),_t(e,n=>n.updatePosition12()),_t(e,n=>n.updatePosition34()),_t(e,n=>n.updateStyle())])}var W2=class extends Ti{constructor(e){super(e,dF,fF),this.addAttrSetting("a_position12",Wr.position12,Y2),this.addAttrSetting("a_position34",Wr.position34,X2),this.addAttrSetting("a_style",Wr.style,V2)}render(e,t){this.renderCb(e,()=>{let n=this.renderer.gl;t.bindElementBuffer(),n.drawElements(n.TRIANGLES,t.getSize(),n.UNSIGNED_SHORT,0)})}renderOne(e){let t=e.getInLeaf();this.renderCb(t.getBuffer(),()=>{let n=this.renderer.gl;t.getElementBuffer().bindElementBuffer(),n.drawElements(n.TRIANGLES,er.length,n.UNSIGNED_SHORT,e.getId()*er.length*2)})}};var zn=class extends qn{constructor(t,n,i,s,o,a,l){super(o,a,l);this.point1=t,this.point2=n,this.point3=i,this.point4=s}static build(t,n,i){let s=t.reduce((o,a)=>o.ext2(a),new Oe).build();return new zn(s.LL(),s.LR(),s.UR(),s.UL(),s,n,i)}static enterBBoxBuffer(t,n,i=0){let s=t.LL(),o=t.LR(),a=t.UR(),l=t.UL(),u=[s.x,s.y,o.x,o.y],c=[a.x,a.y,l.x,l.y];n.setData(Wr.position12,i,[...u,...u,...u,...u]),n.setData(Wr.position34,i,[...c,...c,...c,...c]),n.setData(Wr.style,i,[1,1,1,1]),n.setData(Wr.index,i,[0,1,2,3])}enterBuffer(t,n){this.id=t,this.inLeaf=n,this.updatePosition12(),this.updatePosition34(),this.updateStyle(),this.updateIndex(),this.inLeaf.getElementBuffer().bufferSubData(t*er.length,er.map(i=>t*Dt.length+i)),this.updateColorOrder()}updateIndex(){this.inLeaf.getBuffer().setData(Wr.index,this.id,Dt)}updatePosition12(){this.setData(Wr.position12,Dt.length,[this.point1.x,this.point1.y,this.point2.x,this.point2.y])}updatePosition34(){this.setData(Wr.position34,Dt.length,[this.point3.x,this.point3.y,this.point4.x,this.point4.y])}updateStyle(){this.setData(Wr.style,Dt.length,[this.style])}updateOrder(){this.setData(Wr.order,Dt.length,[this.order||0])}updateColor(){let t=this.color;t?this.setData(Wr.color,Dt.length,[t.r,t.g,t.b,t.alpha]):this.setData(Wr.color,Dt.length,[0,0,0,0])}};var Gh=class{constructor(e){this.managerIndexs=[];this.ableInter=!0;this.scene=e}forEachManagerIndex(e){this.managerIndexs.forEach(e)}newManagerIndex(){let e={rtree:this.ableInter?null:new Bi(10),polygonManager:new Rs(this.scene.renderer,this.scene.polygonProgram,Dh),quadManager:this.ableInter?null:new Dn(this.scene.renderer,this.scene.quadProgram,$2)};return this.managerIndexs.push(e),e}getManagerIndex(e){let t=e.bbox();for(let n of this.managerIndexs)if(this.ableInter||n.rtree.search(t).length===0)return n;return this.newManagerIndex()}isEmpty(){return this.managerIndexs.length===0}renderUsingStencil(e,t,n,i,s){let o=e.renderer;o.enterStencilConfig();let a=o.gl;if(t===4)for(let l of this.managerIndexs)a.stencilOp(a.KEEP,a.INCR,a.INCR),a.stencilFunc(a.NOTEQUAL,0,127),a.colorMask(!1,!1,!1,!1),o.setDepthMask(!1),l.polygonManager.render(n,i),a.stencilOp(a.KEEP,a.REPLACE,a.REPLACE),a.stencilFunc(a.NOTEQUAL,64,63),a.colorMask(!0,!0,!0,!0),o.setDepthMask(!0),this.ableInter?(zn.enterBBoxBuffer(l.polygonManager.getBBox(),e.quadBuffer),e.quadProgram.render(e.quadBuffer,e.quadElementBuffer)):(l.quadManager.render(n,i),s&&(a.colorMask(!1,!1,!1,!1),e.fullScreenProgram.render(),a.colorMask(!0,!0,!0,!0)));else for(let l of this.managerIndexs)a.stencilOpSeparate(a.FRONT,a.KEEP,a.INCR_WRAP,a.INCR_WRAP),a.stencilOpSeparate(a.BACK,a.KEEP,a.DECR_WRAP,a.DECR_WRAP),a.stencilFunc(a.NOTEQUAL,0,127),a.colorMask(!1,!1,!1,!1),o.setDepthMask(!1),l.polygonManager.render(n,i),a.stencilOp(a.KEEP,a.REPLACE,a.REPLACE),a.stencilFunc(a.NOTEQUAL,64,63),a.colorMask(!0,!0,!0,!0),o.setDepthMask(!0),this.ableInter?(zn.enterBBoxBuffer(l.polygonManager.getBBox(),e.quadBuffer),e.quadProgram.render(e.quadBuffer,e.quadElementBuffer)):(l.quadManager.render(n,i),s&&(a.colorMask(!1,!1,!1,!1),e.fullScreenProgram.render(),a.colorMask(!0,!0,!0,!0)));o.leaveStencilConfig()}renderPointsUsingStencil(e,t,n,i){if(t!==0&&t!==4)return;let s=e.renderer;s.enterStencilConfig();let o=s.gl;for(let a of this.managerIndexs)o.stencilFunc(o.EQUAL,64,255),o.stencilOp(o.KEEP,o.INVERT,o.INVERT),o.colorMask(!1,!1,!1,!1),e.renderer.setDepthMask(!1),a.polygonManager.renderPoints(n,i),o.stencilFunc(o.EQUAL,191,255),o.stencilOp(o.KEEP,o.INVERT,o.INVERT),o.colorMask(!0,!0,!0,!0),e.renderer.setDepthMask(!0),this.ableInter?(zn.enterBBoxBuffer(a.polygonManager.getBBox(),e.quadBuffer),e.quadProgram.render(e.quadBuffer,e.quadElementBuffer)):a.quadManager.render(n,i);s.leaveStencilConfig()}drawStencil(e,t){this.forEachManagerIndex(n=>n.polygonManager.render(e,t))}clear(){this.forEachManagerIndex(e=>{var t;e.polygonManager.clear(),(t=e.quadManager)==null||t.clear()}),this.managerIndexs.length=0}};var Fh=class extends Dn{renderIter(e,t,n){if(this.isEmpty())return;let i=new zr;this.vertexes3D.forEach(o=>i.ext3(o.multiply4(e)));let s=i.build();if(!(s.minX+t.x>1||s.maxX+t.x<-1||s.minY+t.y>1||s.maxY+t.y<-1)){if(this.buffer){for(let o of this.objs)o.render();return}n.push(this.subtree1),n.push(this.subtree2)}}};var pF=Da+`
	uniform int u_renderMode;
	uniform mat4 u_MVmatrix;
	uniform vec3 u_eyePosition;

	attribute vec4 a_leftPosition;  // [downx, downy, upx, upy]
	attribute vec4 a_rightPosition;  // [downx, downy, upx, upy]
	attribute float a_index;

	varying vec3 v_normal;
	varying vec3 v_surfaceToEye;
	
    varying vec2 v_texCoord;

	void preMaterial(vec4 position) {
		mat4 matrix = u_MVmatrix * u_matrix;
		v_normal = mat3(matrix) * vec3(0, 0, 1);
		vec4 pos = matrix * position;
		v_surfaceToEye = u_eyePosition - pos.xyz / pos.w;
	}
	
	void calParm(vec2 pos) {
		vec4 position = vec4(pos, 0, 1);
		calPosition(position);
		
        if(u_renderMode == 1) {
            preMaterial(position);
        }
	}

    void main(){
        vec2 position;
		if(a_index == 0.0){
            position = a_leftPosition.xy;
			v_texCoord = vec2(0, 1);
        }else if(a_index == 1.0){
            position = a_rightPosition.xy;
			v_texCoord = vec2(1, 1);
        }else if(a_index == 2.0){
            position = a_rightPosition.zw;
			v_texCoord = vec2(1, 0);
        }else if(a_index == 3.0){
            position = a_leftPosition.zw;
			v_texCoord = vec2(0, 0);
        }

        calParm(position);
    }
`,mF=Uh+`
	uniform sampler2D u_texture;

	uniform int u_renderMode;

	uniform float u_shininess;

	uniform vec3 u_ambientLightColor;
	uniform vec3 u_directLightDir;
	uniform vec3 u_directLightColor;

	uniform float u_alpha;

	uniform bool u_transparent;

	varying vec3 v_normal;
	varying vec3 v_surfaceToEye;
    varying vec2 v_texCoord;

	void renderUseMaterial(vec3 ambientFactor, vec3 diffuseFactor, vec3 specularFactor, float alpha) {
		vec3 ambient = ambientFactor * u_ambientLightColor;
	
		vec3 normal = normalize(v_normal);
		vec3 directLightDir = normalize(u_directLightDir);
		vec3 diffuse = abs(dot(normal , directLightDir)) * diffuseFactor * u_directLightColor;
	
		vec3 reflect = -2.0 * normal * dot(directLightDir, normal) + directLightDir;
		vec3 surfaceToEye = normalize(v_surfaceToEye);
		float lightToEyeFactor = abs(dot(reflect, surfaceToEye));
		vec3 specular = specularFactor * u_directLightColor * pow(lightToEyeFactor, 300.0) * u_shininess * 0.1;
	
		gl_FragColor.rgb = ambient + diffuse + specular;
		gl_FragColor.a = alpha;
	}

    void main() {
        gl_FragColor = texture2D(u_texture, v_texCoord);
		float alpha = gl_FragColor.a * u_alpha;
		gl_FragColor.a = alpha;
		if(u_renderMode == 1) {
			if(alpha > 0.001 && ((u_transparent && alpha < 0.999) || (!u_transparent && alpha > 0.999))){
				renderUseMaterial(gl_FragColor.rgb, gl_FragColor.rgb, gl_FragColor.rgb, alpha);
			} else {
				discard;
			}
        } else if(alpha < 0.001){
			discard;
		}
    }
`,j2=1,H2=4,Z2=4,Ds=Object.assign({index:1,leftPosition:2,rightPosition:3},Ao);function Q2(r,e){return new tn(r,en/er.length,[...Ga,j2,H2,Z2].map(t=>t*Dt.length),[_t(e,t=>t.updateOrder()),_t(e,t=>t.updateIndex()),_t(e,t=>t.updateLeftPosition()),_t(e,t=>t.updateRightPosition())])}var K2=class extends Ns{constructor(t){super(t,pF,mF);this.addAttrSetting("a_index",Ds.index,j2),this.addAttrSetting("a_leftPosition",Ds.leftPosition,H2),this.addAttrSetting("a_rightPosition",Ds.rightPosition,Z2),this.u_textureLoc=t.getUniformLoc(this.program,"u_texture"),this.u_renderModeLoc=t.getUniformLoc(this.program,"u_renderMode"),this.u_MVmatrixLoc=t.getUniformLoc(this.program,"u_MVmatrix"),this.u_eyePositionLoc=t.getUniformLoc(this.program,"u_eyePosition"),this.u_shininessLoc=t.getUniformLoc(this.program,"u_shininess"),this.u_ambientLightColorLoc=t.getUniformLoc(this.program,"u_ambientLightColor"),this.u_directLightDirLoc=t.getUniformLoc(this.program,"u_directLightDir"),this.u_directLightColorLoc=t.getUniformLoc(this.program,"u_directLightColor"),this.u_alphaLoc=t.getUniformLoc(this.program,"u_alpha"),this.u_transparentLoc=t.getUniformLoc(this.program,"u_transparent")}transSceneData(t,n){this.transBaseCameraData(n);let i=this.renderer.gl;i.useProgram(this.program),i.uniformMatrix4fv(this.u_MVmatrixLoc,!1,new Float32Array(n.getViewMatrix().data)),i.uniform3fv(this.u_ambientLightColorLoc,Ls(t.ambientLight.color)),i.uniform3fv(this.u_directLightColorLoc,Ls(t.directionalLight.color));let s=t.directionalLight.direction();i.uniform3fv(this.u_directLightDirLoc,new Float32Array([s.x,s.y,s.z]));let o=n.getRelativePosition();i.uniform3fv(this.u_eyePositionLoc,new Float32Array([o.x,o.y,o.z]))}transPlaneData(t){let n=t.getMaterial();if(!n)return;let i=this.renderer.gl;i.useProgram(this.program),i.uniform1f(this.u_shininessLoc,n.shininess)}transRenderMode(t){let n=this.renderer.gl;n.useProgram(this.program),n.uniform1i(this.u_renderModeLoc,t===0||t===3?0:t===1?1:t===4?2:-1)}transAlpha(t){let n=this.renderer.gl;n.useProgram(this.program),n.uniform1f(this.u_alphaLoc,t)}render(t,n,i,s){this.renderCb(t,()=>{let o=this.renderer.gl;n.bindElementBuffer(),o.uniform1i(this.u_textureLoc,0),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,s),o.drawElements(o.TRIANGLES,er.length,o.UNSIGNED_SHORT,i*er.length*2)})}renderOne(t){let n=t.getInLeaf();this.render(n.getBuffer(),n.getElementBuffer(),t.getId(),t.getTexture())}transTransparent(t){let n=this.renderer.gl;n.useProgram(this.program),n.uniform1i(this.u_transparentLoc,t?1:0)}};var uu=class extends qn{constructor(t,n,i,s,o,a,l,u){super([t,n,i,s].reduce((h,f)=>h.ext2(f),new Oe).build(),null,u);this.ldPoint=t,this.luPoint=n,this.rdPoint=i,this.ruPoint=s,this.mask=o,this.alpha=a,this.scene=l;let c=l.renderer.gl;this.texture=l.renderer.createRGBATexture(new ImageData(new Uint8ClampedArray([0,0,0,255]),1,1),c.LINEAR,c.LINEAR,c.CLAMP_TO_EDGE,c.CLAMP_TO_EDGE)}updateLeftPosition(){this.setData(Ds.leftPosition,Dt.length,[this.ldPoint.x,this.ldPoint.y,this.luPoint.x,this.luPoint.y])}updateRightPosition(){this.setData(Ds.rightPosition,Dt.length,[this.rdPoint.x,this.rdPoint.y,this.ruPoint.x,this.ruPoint.y])}setImageSource(t){let n=this.scene.renderer.gl;n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t),n.bindTexture(n.TEXTURE_2D,null)}setTexture(t){let n=this.scene.renderer,i=n.gl,s=n.createRGBATexture(t,i.LINEAR,i.LINEAR,i.CLAMP_TO_EDGE,i.CLAMP_TO_EDGE);this.scene.renderer.gl.deleteTexture(this.texture),this.texture=s}getTexture(){return this.texture}enterBuffer(t,n){this.id=t,this.inLeaf=n,this.updateLeftPosition(),this.updateRightPosition(),this.updateIndex(),this.inLeaf.getElementBuffer().bufferSubData(t*er.length,er.map(i=>t*Dt.length+i)),this.updateColorOrder()}render(t=void 0,n=!1){let i=this.inLeaf.program;if(i.transAlpha(this.alpha),!this.mask){i.render(this.inLeaf.getBuffer(),this.inLeaf.getElementBuffer(),this.id,this.texture);return}let s=this.scene.renderer,o=s.gl,a=s.getColorWriteMask();if(!a[0]||!a[1]||!a[2]||!a[3])throw new Error("not support!");t===4?this.mask.render(4):(s.enterStencilConfig(),o.stencilOpSeparate(o.FRONT,o.KEEP,o.INCR_WRAP,o.INCR_WRAP),o.stencilOpSeparate(o.BACK,o.KEEP,o.DECR_WRAP,o.DECR_WRAP),o.stencilFunc(o.NOTEQUAL,0,127),o.colorMask(!1,!1,!1,!1),s.setDepthMask(!1),this.mask.render(0),o.stencilOp(o.KEEP,o.REPLACE,o.REPLACE),o.stencilFunc(o.NOTEQUAL,64,63),o.colorMask(!0,!0,!0,!0),s.setDepthMask(!n),i.render(this.inLeaf.getBuffer(),this.inLeaf.getElementBuffer(),this.id,this.texture),o.colorMask(!1,!1,!1,!1),this.scene.fullScreenProgram.render(),o.colorMask(!0,!0,!0,!0),s.leaveStencilConfig())}updateOrder(){this.setData(Ds.order,Dt.length,[this.order])}updateColor(){throw new Error("texture can't call updateColor!")}updateIndex(){this.inLeaf.getBuffer().setData(Ds.index,this.id,Dt)}};var qa=class{constructor(e,t){this.inLeaf=null;this.vertexIdsArr=[];this.style=1;this.outlines=e,this.quad=t}getColor(){return this.quad.getColor()}getOrder(){return this.quad.getOrder()}bbox(){return this.quad.bbox()}isRemoved(){return this.inLeaf===null}getPointNum(){return this.outlines.reduce((e,t)=>e+t.length,0)}getInLeaf(){return this.inLeaf}getStartId(){return this.vertexIdsArr[0][0]}enterBuffer(e,t){this.vertexIdsArr.length=0;let n=0;for(let i of this.outlines)this.vertexIdsArr.push(e.slice(n,n+=i.length));this.inLeaf=t,this.updatePosition(),this.updateTriangleElementBuffer(),this.updateLineElementBuffer()}idIterator(){let e=0,t=0,n=this.vertexIdsArr[e++];return()=>(t<n.length||(n=this.vertexIdsArr[e++],t=0),n[t++])}updatePosition(){let e=this.inLeaf.getBuffer(),t=this.idIterator();for(let n of this.outlines)for(let i of n)e.setData(Hm.position,t(),[i.x,i.y,this.style])}updateTriangleElementBuffer(){let e=this.inLeaf.getBuffer(),t=this.idIterator(),n=this.getTriangleIds();for(let i=0;i<n.length;i+=3)e.triangleElementBuffer.setVertexIds(t(),[n[i],n[i+1],n[i+2]])}updateLineElementBuffer(){let e=this.inLeaf.getBuffer(),t=this.idIterator(),n=this.getLineIds();for(let i=0;i<n.length;i+=2)e.lineElementBuffer.setVertexIds(t(),[n[i],n[i+1]])}getLineIds(){let e=new Array;for(let t of this.vertexIdsArr)for(let n=0;n<t.length-1;n++)e.push(t[n],t[n+1]);return e}getTriangleIds(){let e=[];for(let t of this.vertexIdsArr){let n=t.slice();for(let i=0;i<n.length-2;i+=2)e.push(n[i]),e.push(n[i+1]),e.push(n[i+2]),n.push(n[i])}return e}getVertexNum(){return this.outlines.reduce((e,t)=>e+t.length,0)*3}remove(){let e=this.inLeaf.getBuffer();for(let t of this.vertexIdsArr)for(let n of t)e.remove(n),e.triangleElementBuffer.remove(n),e.lineElementBuffer.remove(n);throw this.inLeaf.remove(this),this.inLeaf=null,new Error("render will be wrong!")}render(e=void 0){this.inLeaf.program.renderOne(this,e)}};var gF=Os+`
	attribute vec4 a_center; // [x, y, radius, style]

	varying vec4 v_center;
    varying vec2 v_position;

    void main(){
        if(a_center[3] == 0.0 || a_center.z < 0.0){
            return;
		}
		v_center = a_center;

        float sq = sqrt(3.0);
		vec2 position = a_center.xy;
		float radius = a_center.z < u_px_length / 2.0 ? u_px_length / 2.0 : a_center.z;
		v_center.z = radius;
        if(a_index == 0.0){
            position.x += radius * (-sq);
            position.y += radius * (-1.0);
        }else if(a_index == 1.0){
            position.x += radius * (sq);
            position.y += radius * (-1.0);
        }else{
            position.y += radius * (2.0);
		}
		
        calParm(position);
		v_position = position;
    }
`,xF=ks+`
    varying vec4 v_center;
	varying vec2 v_position;

    void main(){
		float dis = length(v_position.xy - v_center.xy);
		if(dis > v_center.z){
			discard;
		}
		if(u_renderMode == 2 && dis < v_center.z - u_px_length){
			discard;
		}
		
        calColor();
    }
`,J2=4,To=Object.assign({center:3},Ai);function tv(r,e){return new tn(r,en/Pt.length,[...Us,J2].map(t=>t*Pt.length),[_t(e,t=>t.updateOrder()),_t(e,t=>t.updateIndex()),_t(e,t=>t.updateColor()),_t(e,t=>t.updateCenterRadiusStyle())])}var ev=class extends Ti{constructor(e){super(e,gF,xF),this.addAttrSetting("a_center",To.center,J2)}render(e){this.renderCb(e,()=>{let t=this.renderer.gl;t.drawArrays(t.TRIANGLES,0,e.getSize()*Pt.length)})}renderOne(e){this.renderCb(e.getInLeaf().getBuffer(),()=>{let t=this.renderer.gl;t.drawArrays(t.TRIANGLES,e.getId()*Pt.length,Pt.length)})}};var qh=class extends qn{constructor(t,n,i,s){super(new ye(t.x-n,t.x+n,t.y-n,t.y+n),i,s);this.center=t,this.radius=n}updateCenterRadiusStyle(){this.setData(To.center,Pt.length,[this.center.x,this.center.y,this.radius,this.style])}updateOrder(){this.setData(To.order,Pt.length,[this.order||0])}updateColor(){let t=this.color;t?this.setData(To.color,Pt.length,[t.r,t.g,t.b,t.alpha]):this.setData(To.color,Pt.length,[0,0,0,0])}updateIndex(){this.inLeaf.getBuffer().setData(To.index,this.id,Pt)}enterBuffer(t,n){this.id=t,this.inLeaf=n,this.updateCenterRadiusStyle(),this.updateIndex(),this.inLeaf.getElementBuffer().bufferSubData(t*Pt.length,Pt.map(i=>t*Pt.length+i)),this.updateColorOrder()}getCenter(){return this.center}setCenter(t){return this.center=t,this.update(),this}getRadius(){return this.radius}setRadius(t){return this.radius=t,this.update(),this}transform(t){this.setCenter(this.center.multiply4(t))}update(){if(this.inLeaf===null)throw new Error("");this.updateCenterRadiusStyle()}};var or=Math.PI*2,zh=Math.PI/2,Jme=Math.sin(Math.PI/180),bF=[1,10,100,1e3];function ege(r,e,t){if(typeof r!="number"&&(r=+r),isNaN(r))return NaN;if(e=e|0,e<=0||!r&&!t)return Math.round(r);let n=bF[e]||Math.pow(10,e)||10;if(t){let i=r<0?"-":"";for(r=r<0?-r:r,r=Math.round(r*n)+"";r.length<=e;)r="0"+r;return r=r.slice(0,-e)+"."+r.slice(-e),parseFloat(i+r)}else return Math.round(r*n+1e-10)/n}var yF=Os+`
    attribute vec4 a_center; // [cx, cy, rmax, rmin]
    attribute vec4 a_param; // [startAngle, endAngle, sweepAngle, style]

    varying float R;
    varying float r;
    varying vec2 v_center;
    varying vec4 v_param;
    varying vec2 v_position;
    
    void main(){
        if(a_param[3] == 0.0){
            return;
        }

        R = a_center[2];
        r = a_center[3];
        float width = R - r;
        if(width < 0.0 || r < 0.0){
            return;
        }
        v_center = a_center.xy;
        v_param = a_param;

        if(width < u_px_length){
            width = u_px_length;
            float radius = (R + r) / 2.0;
            float halfPxLength = u_px_length / 2.0;
            R = radius + halfPxLength;
            r = radius - halfPxLength;
        }

        float PI = 3.1415926535897932384626433832795;
        vec2 position = a_center.xy;
        float radius = R;
        if(a_param[2] < PI){
            float startAngle = a_param[0];
            float endAngle = a_param[1];
            vec2 center = a_center.xy;
            vec2 startPointR = center + vec2(cos(startAngle), sin(startAngle)) * r;
            vec2 endPointR = center + vec2(cos(endAngle), sin(endAngle)) * r;
            position.xy = (startPointR + endPointR) / 2.0;
            radius = length(startPointR - endPointR) / 2.0 + width;
        }

        if(a_index == 0.0){
            position.x += radius * (-sqrt(3.0));
            position.y += radius * (-1.0);
        }else if(a_index == 1.0){
            position.x += radius * (sqrt(3.0));
            position.y += radius * (-1.0);
        }else{
            position.y += radius * (2.0);
        }

        calParm(position);
        v_position = position;
    }
`,vF=ks+`
    varying float R;
    varying float r;
    varying vec2 v_center;
    varying vec4 v_param;
    varying vec2 v_position;

    void main(){
        float d = length(v_position - v_center.xy);
        if(d > R || d < r){
            discard;
        }
        
        float PI = 3.1415926535897932384626433832795;
        vec2 direct = v_position - v_center;
        float startAngle = v_param[0];
        vec2 startDir = vec2(cos(startAngle), sin(startAngle));
        float startZ = startDir.x * direct.y - startDir.y * direct.x;
        float endAngle = v_param[1];
        vec2 endDir = vec2(cos(endAngle), sin(endAngle));
        float endZ = endDir.x * direct.y - endDir.y * direct.x;

        float angle = v_param[2];
        if((angle < PI && (startZ < 0.0 || endZ > 0.0)) || (angle >= PI && (startZ < 0.0 && endZ > 0.0))){
            float pointRadius = (R - r) / 2.0;
            float radius = (R + r) / 2.0;
            vec2 startCenter = v_center + startDir * radius;
            float startDis = length(v_position - startCenter);
            vec2 endCenter = v_center + endDir * radius;
            float endDis = length(v_position - endCenter);
            if(startDis > pointRadius && endDis > pointRadius){
                discard;
            }
            if(u_renderMode == 2 && (startDis < pointRadius - u_px_length || endDis < pointRadius - u_px_length)){
                discard;
            } 
        }else if(u_renderMode == 2 && d < R - u_px_length && d > r + u_px_length){
            discard;
        }
        
        calColor();
    }
`,rv=4,nv=4,is=Object.assign({center:3,param:4},Ai);function sv(r,e){return new tn(r,en/Pt.length,[...Us,rv,nv].map(t=>t*Pt.length),[_t(e,t=>t.updateOrder()),_t(e,t=>t.updateIndex()),_t(e,t=>t.updateColor()),_t(e,t=>t.updateCenterRadius()),_t(e,t=>t.updateParam())])}var iv=class extends Ti{constructor(e){super(e,yF,vF),this.addAttrSetting("a_center",is.center,rv),this.addAttrSetting("a_param",is.param,nv)}render(e){this.renderCb(e,()=>{let t=this.renderer.gl;t.drawArrays(t.TRIANGLES,0,e.getSize()*Pt.length)})}renderOne(e){this.renderCb(e.getInLeaf().getBuffer(),()=>{let t=this.renderer.gl;t.drawArrays(t.TRIANGLES,e.getId()*Pt.length,Pt.length)})}};var za=class extends qn{constructor(t,n,i,s,o,a,l){super(za.getBBox(t,n,i,s,o),a,l);this.center=t,this.radius=n,this.width=i,this.startAngle=s,this.endAngle=o}static getBBox(t,n,i,s,o){o=s>o?o+Math.ceil((s-o)/or)*or:o-Math.floor((o-s)/or)*or;let a=new Oe;a.ext2(q.X_UNIT_VECTOR.multiply3(qe.rotate(s))),a.ext2(q.X_UNIT_VECTOR.multiply3(qe.rotate(o)));for(let c=Math.ceil(s/zh)*zh;c<o;c+=zh)a.ext2(q.X_UNIT_VECTOR.multiply3(qe.rotate(c)));let l=a.build(),u=i/2;return new ye(l.minX*n+t.x-u,l.maxX*n+t.x+u,l.minY*n+t.y-u,l.maxY*n+t.y+u)}setParam(t,n,i){this.setData(is.param,Pt.length,[t,n,n>t?n-t:n-t+or,i])}updateOrder(){this.setData(is.order,Pt.length,[this.order||0])}updateColor(){let t=this.color;t?this.setData(is.color,Pt.length,[t.r,t.g,t.b,t.alpha]):this.setData(is.color,Pt.length,[0,0,0,0])}updateIndex(){this.inLeaf.getBuffer().setData(is.index,this.id,Pt)}enterBuffer(t,n){this.id=t,this.inLeaf=n,this.updateCenterRadius(),this.setParam(this.startAngle,this.endAngle,this.style),this.updateIndex(),this.inLeaf.getElementBuffer().bufferSubData(t*Pt.length,Pt.map(i=>t*Pt.length+i)),this.updateColorOrder()}getCenter(){return this.center}setCenter(t){return this.center=t,this.updateCenterRadius(),this}getRadius(){return this.radius}setRadius(t){return this.radius=t,this.updateCenterRadius(),this}getWidth(){return this.width}setWidth(t){return this.width=t,this.updateCenterRadius(),this}getStartAngle(){return this.startAngle}getStart(){let t=new q(Math.cos(this.getStartAngle()),Math.sin(this.getStartAngle()));return this.center.add(t.scale(this.radius))}getEnd(){let t=new q(Math.cos(this.getEndAngle()),Math.sin(this.getEndAngle()));return this.center.add(t.scale(this.radius))}setStartAngle(t){return t%=or,t<0&&(t+=or),this.startAngle=t,this.updateParam(),this}getEndAngle(){return this.endAngle}setEndAngle(t){return t%=or,t<0&&(t+=or),this.endAngle=t,this.updateParam(),this}getSweepAngle(){return(this.endAngle-this.startAngle+or)%or}transform(t){let n=this.center.add(new q(Math.cos(this.startAngle)*this.radius,Math.sin(this.startAngle)*this.radius)),i=this.center.add(new q(Math.cos(this.endAngle)*this.radius,Math.sin(this.endAngle)*this.radius)),s=this.getSweepAngle(),o=this.startAngle+s/2,a=this.center.add(new q(Math.cos(o)*this.radius,Math.sin(o)*this.radius)),l=this.center.multiply4(t),u=n.multiply4(t),c=i.multiply4(t),h=a.multiply4(t),f=u.sub(l),d=c.sub(l),m=Math.atan2(f.y,f.x),p=Math.atan2(d.y,d.x);m<0&&(m+=or),p<0&&(p+=or),this.setCenter(l);let g=h.sub(u),b=c.sub(h);this.startAngle=m,this.endAngle=p,g.cross(b)>=0?(this.startAngle=m,this.endAngle=p):(this.startAngle=p,this.endAngle=m),this.updateParam()}updateCenterRadius(){if(this.inLeaf===null)throw new Error("");this.setData(is.center,Pt.length,[this.center.x,this.center.y,this.radius+this.width/2,Math.max(this.radius-this.width/2,0)])}updateParam(){if(this.inLeaf===null)throw new Error("");this.setParam(this.startAngle,this.endAngle,this.style)}};var wF=Os+`
    attribute vec4 a_endpoints;
    attribute vec4 a_param;

    varying vec4 v_position;
    varying vec4 v_endpoints;
    varying float v_halfWidth;

    void main(){
        if(a_param[0] == 0.0){
            return;
        }
        v_endpoints = a_endpoints;

        if(a_param[1] < u_px_length){
            v_halfWidth = u_px_length / 2.0;
        }else{
            v_halfWidth = a_param[1] / 2.0;
        }
        vec2 direct;
        if(a_endpoints.xy == a_endpoints.zw){
            direct = vec2(1, 0);
        }else{
            direct = normalize(a_endpoints.zw - a_endpoints.xy);
        }
        vec2 vertical = vec2(-direct.y, direct.x);
        vec2 h_offset = vertical * v_halfWidth; // \u7528\u4E8E\u8BA1\u7B97\u5782\u76F4\u65B9\u5411\u843D\u70B9
        vec2 v_offset = direct * v_halfWidth * a_param[2]; // \u7528\u4E8E\u8BA1\u7B97\u6A2A\u5411\u6269\u5C55
        vec2 position;
        if(a_index == 0.0){
            position = a_endpoints.xy - h_offset - v_offset;
        }else if(a_index == 1.0){
            position = a_endpoints.zw - h_offset + v_offset;
        }else if(a_index == 2.0){
            position = a_endpoints.zw + h_offset + v_offset;
        }else if(a_index == 3.0){
            position = a_endpoints.xy + h_offset - v_offset;
        }

        calParm(position);
        v_position = vec4(position.xy, a_param.zw);
    }
`,EF=ks+`
    varying vec4 v_position;
    varying vec4 v_endpoints;
    varying float v_halfWidth;

    void main(){
        vec2 direct = v_endpoints.zw - v_endpoints.xy;
        float len = length(direct);
        if(len == 0.0){
            direct = vec2(1, 0);
        }else{
            direct = normalize(direct);
        }
        // WebGL \u7740\u8272\u5668\u63D2\u503C\u6709\u95EE\u9898\uFF0C\u5728\u5706\u89D2\u65F6\u6B64\u503C\u4E0D\u7CBE\u786E\u7B49\u4E8E 1.0
        if(abs(v_position.z - 1.0) < 0.0001){
            vec2 dir = v_position.xy - v_endpoints.xy;
            float l = dot(dir, direct);
            if(l < 0.0){
                float dis = length(dir);
                if(dis > v_halfWidth){
                    discard;
                }
                if(u_renderMode == 2 && dis < v_halfWidth - u_px_length){
                    discard;
                }
            }else if(l > len){
                float dis = length(v_position.xy - v_endpoints.zw);
                if(dis > v_halfWidth){
                    discard;
                }
                if(u_renderMode == 2 && dis < v_halfWidth - u_px_length){
                    discard;
                }
            }else if(u_renderMode == 2 && abs(dot(vec2(-direct.y, direct.x), dir)) < v_halfWidth - u_px_length){
                discard;
            }
        }else {
            float radius = v_position.w;
            vec2 center = (v_endpoints.xy + v_endpoints.zw) * 0.5;
            vec2 crood = v_position.xy - center;
            float x = abs(dot(direct,crood));
            float y = abs(crood.x * direct.y - crood.y * direct.x);
            float xEdge = len * 0.5 - radius;
            float yEdge = v_halfWidth - radius;
            if(x < xEdge || y < yEdge){
                if(u_renderMode == 2 && x < len * 0.5 - u_px_length && y < v_halfWidth - u_px_length){
                    discard;
                }
            }else {
                float deltaX = x - xEdge;
                float deltaY = y - yEdge;
                float dis = length(vec2(deltaX,deltaY));
                if(dis > radius || (u_renderMode == 2 && dis < radius - u_px_length)){
                    discard;
                }
            }
        }
		
        calColor();
    }
`,ov=4,av=4,ss=Object.assign({endpoints:3,param:4},Ai);function uv(r,e){return new tn(r,en/er.length,[...Us,ov,av].map(t=>t*Dt.length),[_t(e,t=>t.updateOrder()),_t(e,t=>t.updateIndex()),_t(e,t=>t.updateColor()),_t(e,t=>t.updateEndpointsBuffer()),_t(e,t=>t.updateParamBuffer())])}var lv=class extends Ti{constructor(e){super(e,wF,EF),this.addAttrSetting("a_endpoints",ss.endpoints,ov),this.addAttrSetting("a_param",ss.param,av)}render(e,t){this.renderCb(e,()=>{let n=this.renderer.gl;t.bindElementBuffer(),n.drawElements(n.TRIANGLES,t.getSize(),n.UNSIGNED_SHORT,0)})}renderOne(e){let t=e.getInLeaf();this.renderCb(t.getBuffer(),()=>{let n=this.renderer.gl;t.getElementBuffer().bindElementBuffer(),n.drawElements(n.TRIANGLES,er.length,n.UNSIGNED_SHORT,e.getId()*er.length*2)})}};var Ya=class extends qn{constructor(t,n,i,s,o,a,l){super(Ya.getBBox(t,n,i),a,l);this.start=t,this.end=n,this.width=i,this.isRound=s,this.radius=o}static getBBox(t,n,i){let s=new Oe;return s.ext2(t),s.ext2(n),s.ext7(i/2),s.build()}updateEndpointsBuffer(){this.setData(ss.endpoints,Dt.length,[this.start.x,this.start.y,this.end.x,this.end.y])}updateParamBuffer(){this.setData(ss.param,Dt.length,[this.style,this.width,this.isRound?1:0,this.radius])}updateOrder(){this.setData(ss.order,Dt.length,[this.order||0])}updateColor(){let t=this.color;t?this.setData(ss.color,Dt.length,[t.r,t.g,t.b,t.alpha]):this.setData(ss.color,Dt.length,[0,0,0,0])}updateIndex(){this.inLeaf.getBuffer().setData(ss.index,this.id,Dt)}enterBuffer(t,n){this.id=t,this.inLeaf=n,this.updateEndpointsBuffer(),this.updateParamBuffer(),this.updateIndex(),this.inLeaf.getElementBuffer().bufferSubData(t*er.length,er.map(i=>t*Dt.length+i)),this.updateColorOrder()}getCenter(){return this.start.add(this.end).scale(.5)}getStart(){return this.start}setStart(t,n=!0){return this.start=t,n&&this.updateEndpointsBuffer(),this}getEnd(){return this.end}setEnd(t,n=!0){return this.end=t,n&&this.updateEndpointsBuffer(),this}getWidth(){return this.width}setWidth(t){return this.width=t,this.updateParamBuffer(),this}length(){return this.getStart().distance1(this.getEnd())}modifyLenght4Center(t){let n=this.getCenter(),i=this.end.sub(this.start).normalize(),s=n.sub(i.scale(t/2)),o=n.add(i.scale(t/2));this.setStart(s),this.setEnd(o)}transform(t){this.setStart(this.start.multiply4(t),!1),this.setEnd(this.end.multiply4(t))}};var rn=class{static toDegrees(e){return e*180/Math.PI}static toRadians(e){return e/180*Math.PI}static regularD(e){return e=e%360,e=e<0?360+e:e,e===360?0:e}static regular(e){return e=e%rn.PIx2,e=e<0?rn.PIx2+e:e,e===rn.PIx2?0:e}static toQuarterBase(e){return rn.regular((e+rn.PI_4)/rn.PI_2*rn.PI_2)}static toQuarterBaseD(e){return rn.regularD(((e+45)/90|0)*90)}static transformD(e,t){return rn.toDegrees(rn.transform(rn.toRadians(e),t))}static transform(e,t){let n=Math.cos(e),i=Math.sin(e),s=new q(t.data[6],t.data[7]),o=new q(n,i).multiply3(t);return rn.regular(o.angle(s))}},ut=rn;ut.PIx2=Math.PI*2,ut.PI_2=Math.PI/2,ut.PI_4=Math.PI/4;var Yh=class extends Ts{constructor(t,n,i=null,s=null){super(n,i,s);this.interPlanes=[this];this.subPlanes=[];this.parts=[{matrix:qe.ORIGIN,plane:this}];this.dictOutMatrixRenderCfg={};this.transparentObjs=[];this.isColorful=!1;this.renderTexture=!0;this.alwaysUpdateBBox=!0;this.scene=t,this.lineManager=new Dn(t.renderer,t.lineProgram,uv),this.arcManager=new Dn(t.renderer,t.arcProgram,sv),this.circleManager=new Dn(t.renderer,t.circleProgram,tv),this.polygonManager=new Gh(t),this.textureManager=new Fh(t.renderer,t.textureProgram,Q2),this.textureMaskManager=new Rs(t.renderer,t.polygonProgram,Dh)}isEmpty(){return this.lineManager.isEmpty()&&this.arcManager.isEmpty()&&this.circleManager.isEmpty()&&this.polygonManager.isEmpty()&&this.textureManager.isEmpty()}clear(){this.lineManager.clear(),this.arcManager.clear(),this.circleManager.clear(),this.polygonManager.clear(),this.textureManager.clear()}createL(t,n,i,s,o,a,l){let u=new Ya(t,n,i,s,o,a,l);return this.lineManager.addObj(u),a&&a.alpha!==1&&this.transparentObjs.push(u),u}createLine(t,n,i,s,o){return this.createL(t,n,i,!0,0,s,o)}removeLine(t){t.remove(er.length)}addLine(t){this.lineManager.addObj(t)}removeArc(t){t.remove(Pt.length)}addArc(t){this.arcManager.addObj(t)}createRect(t,n,i){return this.createL(t.getLeftPoint(),t.getRightPoint(),t.height,!1,t.radius,n,i),0}createArc(t,n,i,s,o,a,l){let u=s+o;if(o<0){let h=u;u=s,s=h}s=ut.toRadians(s),s%=or,s<0&&(s+=or),u=ut.toRadians(u),u%=or,u<0&&(u+=or);let c=new za(t,n,i,s,u,a,l);return this.arcManager.addObj(c),a&&a.alpha!==1&&this.transparentObjs.push(c),c}createCircle(t,n,i,s){let o=new qh(t,n,i,s);return this.circleManager.addObj(o),i&&i.alpha!==1&&this.transparentObjs.push(o),0}createPolygon(t,n,i,s){let o=[];for(let c of t){let h=[];c.points2(n,m=>h.push(m));let f=h[0],d=h[h.length-1];(f.x!==d.x||f.y!==d.y)&&h.push(f),o.push(h)}let a=zn.build(o.flat(),i,s),l=new qa(o,a),u=this.polygonManager.getManagerIndex(a);return u.polygonManager.addObj(l),u.rtree&&(u.rtree.insert(a),u.quadManager.addObj(a)),i&&i.alpha!==1&&this.transparentObjs.push(l),[0]}addOutMatrixRenderCfg(t,n){let i=t.getSelfAsOutToChildMatrix();for(let s of i){let o=this.outMatrixParamMap.get(s);!o||(n.visible=o.visible,this.dictOutMatrixRenderCfg[s.toString()]=n)}}removeOutMatrixRenderCfg(t,n){let i=t.getSelfAsOutToChildMatrix();for(let s of i)!this.outMatrixParamMap.get(s)||delete this.dictOutMatrixRenderCfg[s.toString()]}setPolygonAbleInter(t){this.polygonManager.ableInter=t}createTexture(t,n,i,s,o,a,l){let u=o?new qa(o,zn.build(o.flat(),null,l)):null;u&&this.textureMaskManager.addObj(u);let c=new uu(t,n,i,s,u,a,this.scene,l);return this.textureManager.addObj(c),this.transparentObjs.push(c),c}removePt(t){throw new Error("not support")}sortTransparentObjs(){this.transparentObjs.sort((t,n)=>t.getOrder()-n.getOrder())}getPxLength(t,n){let i=t.getCurrentCamera(),s;if(i.isOrthCamera())s=i.getPxLength();else{let o=this.getBBox(),l=(o?o.center():i.getTarget()).multiply4(n),u=i.getTarget().sub(l).dot(i.getTar2Pos().normalize());s=i.getPxLength()*(u/i.getTar2Pos().length()+1)}return s*=2,s}transPlaneData(t,n,i,s){let o=n===0||n===4?this.getColor():n===3?this.outMatrixParamMap.get(i).color:null,a=this.getPxLength(t,i);t.arcProgram.transPlaneData(this,o,a,s),t.lineProgram.transPlaneData(this,o,a,s),t.circleProgram.transPlaneData(this,o,a,s),t.quadProgram.transPlaneData(this,o,a,s),t.textureProgram.transPlaneData(this)}transRenderMode(t,n){t.arcProgram.transRenderMode(n),t.lineProgram.transRenderMode(n),t.circleProgram.transRenderMode(n),t.polygonProgram.transRenderMode(n),t.quadProgram.transRenderMode(n),t.textureProgram.transRenderMode(n)}transTransparent(t,n){t.arcProgram.transTransparent(n),t.lineProgram.transTransparent(n),t.circleProgram.transTransparent(n),t.quadProgram.transTransparent(n),t.textureProgram.transTransparent(n)}getMutualStencilPlane(t){let n=new Set(this.interPlanes);for(let i of t.interPlanes)if(n.has(i))return i;return null}hasInterPlane(t){return this.interPlanes.indexOf(t)!==-1}drawStencil(t,n){this.transPlaneData(t,0,n,1),this.transRenderMode(t,0),this.transTransparent(t,!1);let i=n.multiply4(t.getCurrentCamera().getRenderMatrix()),s=t.getViewOffset(),o=t.renderer.gl;o.enable(o.STENCIL_TEST),o.colorMask(!1,!1,!1,!1),t.renderer.setDepthMask(!1),this.drawPassStencil(t,n,i,s,this.renderTexture),o.colorMask(!0,!0,!0,!0),t.renderer.setDepthMask(!0),o.disable(o.STENCIL_TEST)}draw(t,n,i,s,o=1){let a=this.outMatrixParamMap.get(n);if(a){if(a.drawn)return;a.drawn=!0}if(this.interPlanes.length===0||!this.isColorful&&(i===1&&this.getMaterial().alpha===0||(i===0||i===4)&&this.getColor().alpha===0)||this.noDrawing)return;if(i===4&&(this.subPlanes.length!==0||this.interPlanes.length!==1||this.interPlanes[0]!==this))throw new Error("Wireframe mode can only be used to draw the plane itself!");this.transPlaneData(t,i,n,o),this.transRenderMode(t,0),this.transTransparent(t,!1);let l=n.multiply4(t.getCurrentCamera().getRenderMatrix()),u=t.getViewOffset(),c=t.renderer,h=c.gl;h.enable(h.STENCIL_TEST),h.colorMask(!1,!1,!1,!1),c.setDepthMask(!1);let f=this.interPlanes.slice(),d=this.subPlanes.slice(),m=this.dictOutMatrixRenderCfg[n.toString()];if(m)if(m.replacePlane){d=m.listSubPlane;for(let p of m.listInterPlane)p&&f.push(p)}else{for(let p of m.listSubPlane)p&&d.push(p);for(let p of m.listInterPlane)p&&f.push(p)}if(s)h.stencilFunc(h.NOTEQUAL,64,128),h.stencilOp(h.KEEP,h.REPLACE,h.REPLACE),t.fullScreenProgram.render(),f=f.filter(p=>p!==s);else if(f.length===1){h.clearStencil(64),h.clear(h.STENCIL_BUFFER_BIT),d.forEach(p=>p.drawNotPassStencil(t,n,l,u,this.renderTexture)),f[0].renderUsingStencil(t,i,n,l,u,this.renderTexture);return}else f.pop().drawPassStencil(t,n,l,u,this.renderTexture);if(d.forEach(p=>p.drawNotPassStencil(t,n,l,u,this.renderTexture)),f.length===0)this.renderBBoxUsingStencil(t,i,n,this.getBBox());else{for(let p=1;p<f.length;p++)f[p].drawInterStencil(t,n,l,u,this.renderTexture);f[0].renderUsingStencil(t,i,n,l,u,this.renderTexture)}}getBBox2(){let t=new Oe;for(let n of this.parts){let{plane:i,matrix:s}=n;for(let o of[i.lineManager,i.arcManager,i.circleManager,i.textureManager]){let a=o.getBBox();a&&t.ext1(a.transform(s))}i.polygonManager.forEachManagerIndex(o=>t.ext1(o.polygonManager.getBBox().transform(s)))}return t.valid()?t.build():null}getUnPanelBBox(){let t=new Oe,{plane:n,matrix:i}=this.parts[0];for(let s of[n.lineManager,n.arcManager,n.circleManager,n.textureManager]){let o=s.getBBox();o&&t.ext1(o.transform(i))}return n.polygonManager.forEachManagerIndex(s=>t.ext1(s.polygonManager.getBBox().transform(i))),t.valid()?t.build():null}setAlwaysUpdateBBox(t){this.alwaysUpdateBBox=t}getBBox(){return this.alwaysUpdateBBox?this.updateBBox():this.bBox||this.updateBBox(),this.bBox}updateBBox(){try{let t=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(let o of this.interPlanes){let a=o.getBBox2();t=Math.max(a.minX,t),i=Math.min(a.maxX,i),n=Math.max(a.minY,n),s=Math.min(a.maxY,s)}return this.bBox=new wn(t,n,0,i,s,0),this.bBox}catch{return this.bBox=null,this.bBox}}addPart(t,n){this.parts.push({matrix:t,plane:n})}setRenderProcess(t=[this],n=[]){this.interPlanes=t.filter(i=>i),this.subPlanes=n.filter(i=>i&&!i.isEmpty())}addRenderProcess(t=[this],n=[]){for(let i of t)this.interPlanes.indexOf(i)<=-1&&this.interPlanes.push(i);for(let i of n)this.subPlanes.indexOf(i)<=-1&&this.subPlanes.push(i)}removeRenderProcess(t=[this],n=[]){for(let i of t){let s=this.interPlanes.indexOf(i);s>=0&&this.interPlanes.splice(s,1)}for(let i of n){let s=this.subPlanes.indexOf(i);s>=0&&this.subPlanes.splice(s,1)}}isBoard(t){return this.interPlanes.length===1&&this.interPlanes[0].className==="board"&&this.subPlanes.length===0&&t!==4&&(t!==1||this.getMaterial().alpha===1)}ableCover(t){let n=new Set(t.interPlanes);for(let i of this.interPlanes)if(!n.has(i))return!1;return!0}renderGeneralObj(t,n,i,s){for(let o of this.parts){let a=o.matrix.toMatrix4(),l=a.multiply4(n);t.arcProgram.transMatrixData(l),t.lineProgram.transMatrixData(l),t.circleProgram.transMatrixData(l);let u=o.plane,c=a.multiply4(i);u.lineManager.render(c,s),u.arcManager.render(c,s),u.circleManager.render(c,s)}}renderPolygon(t,n,i,s){for(let o of this.parts){let a=o.matrix.toMatrix4();t.polygonProgram.transMatrixData(a.multiply4(n)),o.plane.polygonManager.drawStencil(a.multiply4(i),s)}}renderUsingStencil(t,n,i,s,o,a){this.transRenderMode(t,n);let l=t.renderer.gl;if(l.colorMask(!0,!0,!0,!0),l.stencilFunc(l.EQUAL,64,255),l.stencilOp(l.KEEP,l.KEEP,l.KEEP),t.renderer.setDepthMask(!0),this.renderGeneralObj(t,i,s,o),a&&n!==4)for(let c of this.parts){let h=c.matrix.toMatrix4(),f=h.multiply4(i);t.polygonProgram.transMatrixData(f),t.textureProgram.transMatrixData(f),c.plane.textureManager.render(h.multiply4(s),o)}for(let c of this.parts){let h=c.matrix.toMatrix4(),f=h.multiply4(i);t.polygonProgram.transMatrixData(f),t.quadProgram.transMatrixData(f),c.plane.polygonManager.renderUsingStencil(t,n,h.multiply4(s),o,this.transparentObjs.length!==0)}if(this.transparentObjs.length!==0){t.renderer.setDepthMask(!1),this.transTransparent(t,!0);for(let c of this.parts){let h=c.matrix.toMatrix4().multiply4(i);t.arcProgram.transMatrixData(h),t.lineProgram.transMatrixData(h),t.circleProgram.transMatrixData(h),t.textureProgram.transMatrixData(h),t.polygonProgram.transMatrixData(h),t.quadProgram.transMatrixData(h),this.transparentObjs.forEach(f=>{f instanceof qa?(l.stencilOpSeparate(l.FRONT,l.KEEP,l.INCR_WRAP,l.INCR_WRAP),l.stencilOpSeparate(l.BACK,l.KEEP,l.DECR_WRAP,l.DECR_WRAP),l.stencilFunc(l.NOTEQUAL,0,127),l.colorMask(!1,!1,!1,!1),f.render(),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),l.stencilFunc(l.NOTEQUAL,64,63),l.colorMask(!0,!0,!0,!0),f.quad.render(),l.stencilFunc(l.EQUAL,64,255),l.stencilOp(l.KEEP,l.KEEP,l.KEEP)):f instanceof uu?a&&f.render(n,!0):f.render()})}t.renderer.setDepthMask(!0)}else for(let c of this.parts){let h=c.matrix.toMatrix4(),f=h.multiply4(i);t.polygonProgram.transMatrixData(f),t.quadProgram.transMatrixData(f),c.plane.polygonManager.renderPointsUsingStencil(t,n,h.multiply4(s),o)}if(l.disable(l.STENCIL_TEST),!(this.whiteCoverLayer||this.blackCoverLayer||this.boardCoverLayer)||this.isEmpty()||n!==0)return;let u=this.scene.renderer.getBlenderParam();l.blendFuncSeparate(l.ZERO,l.ONE,l.ZERO,l.ONE_MINUS_SRC_ALPHA),l.blendEquation(l.FUNC_ADD),this.whiteCoverLayer&&this.whiteCoverLayer[1].getVisible()&&this.isUpper(i,this.whiteCoverLayer[1].getMatrix())&&(l.clear(l.DEPTH_BUFFER_BIT),this.whiteCoverLayer[0].draw(t,i,0,null,.8)),this.blackCoverLayer&&this.blackCoverLayer[1].getVisible()&&this.isUpper(i,this.blackCoverLayer[1].getMatrix())&&(l.clear(l.DEPTH_BUFFER_BIT),this.blackCoverLayer[0].draw(t,i,0,null,1)),l.blendFuncSeparate(...u.slice(0,4)),l.blendEquationSeparate(...u.slice(4,6))}isUpper(t,n){return me.ORIGIN.multiply4(t).z>me.ORIGIN.multiply4(n).z}renderBBoxUsingStencil(t,n,i,s){this.transRenderMode(t,n),t.quadProgram.transMatrixData(i);let o=t.renderer.gl;o.colorMask(!0,!0,!0,!0),t.renderer.setDepthMask(!0),o.stencilFunc(o.EQUAL,64,255),o.stencilOp(o.KEEP,o.KEEP,o.KEEP),zn.enterBBoxBuffer(new ye(s.minX,s.maxX,s.minY,s.maxY),t.quadBuffer),t.quadProgram.render(t.quadBuffer,t.quadElementBuffer),o.disable(o.STENCIL_TEST)}drawPassStencil(t,n,i,s,o){let l=t.renderer.gl;l.clearStencil(0),l.clear(l.STENCIL_BUFFER_BIT),l.stencilFunc(l.ALWAYS,64,255),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),this.renderGeneralObj(t,n,i,s),l.stencilFunc(l.NOTEQUAL,64,255),l.stencilOpSeparate(l.FRONT,l.KEEP,l.INCR_WRAP,l.INCR_WRAP),l.stencilOpSeparate(l.BACK,l.KEEP,l.DECR_WRAP,l.DECR_WRAP),this.renderPolygon(t,n,i,s),l.stencilFunc(l.NOTEQUAL,64,63),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),t.fullScreenProgram.render()}drawNotPassStencil(t,n,i,s,o){let l=t.renderer.gl;l.stencilFunc(l.NOTEQUAL,128,127),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),this.renderGeneralObj(t,n,i,s),l.stencilFunc(l.NOTEQUAL,0,127),l.stencilOpSeparate(l.FRONT,l.KEEP,l.INCR_WRAP,l.INCR_WRAP),l.stencilOpSeparate(l.BACK,l.KEEP,l.DECR_WRAP,l.DECR_WRAP),this.renderPolygon(t,n,i,s),l.stencilFunc(l.NOTEQUAL,128,63),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),t.fullScreenProgram.render()}drawInterStencil(t,n,i,s,o){let l=t.renderer.gl;l.stencilFunc(l.NOTEQUAL,0,127),l.stencilOpSeparate(l.FRONT,l.KEEP,l.INCR_WRAP,l.INCR_WRAP),l.stencilOpSeparate(l.BACK,l.KEEP,l.DECR_WRAP,l.DECR_WRAP),this.renderPolygon(t,n,i,s),l.stencilFunc(l.EQUAL,64,255),l.stencilOp(l.KEEP,l.INCR_WRAP,l.INCR_WRAP),this.renderGeneralObj(t,n,i,s),l.stencilFunc(l.EQUAL,192,127),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),t.fullScreenProgram.render(),l.stencilFunc(l.EQUAL,128,128),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),t.fullScreenProgram.render(),l.stencilFunc(l.NOTEQUAL,64,63),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),t.fullScreenProgram.render()}};var nn=`
    struct Camera {
        mvpMatrix: mat4x4<f32>,
        mvMatrix: mat4x4<f32>,
        invMatrix: mat4x4<f32>,
        pos: vec3<f32>,
        isOrth: f32,
        vec: vec3<f32>,
		borderZ: f32,
    }
`,Xh=56;function cv(r,e,t){zt.set(e.getRenderMatrix().data),zt.set(e.getViewMatrix().data,16),zt.set(e.getInverseMatrix().data,32);let n=e.getPostion();zt[48]=n.x,zt[49]=n.y,zt[50]=n.z,zt[51]=e.isOrthCamera()?1:0;let i=e.getTar2Pos().scale(-1);zt[52]=i.x,zt[53]=i.y,zt[54]=i.z,zt[55]=t===Number.NEGATIVE_INFINITY?-1:e.getBorderZ(t),r.write(0,zt,0,Xh)}var hv=`
	struct ColorMaterial {
		color: vec4<f32>,
		ambientFactor: vec3<f32>,
		shininess: f32,
		diffuseFactor: vec3<f32>,
		alpha: f32,
		specularFactor: vec3<f32>,
	}
`,cu=15;function Vh(r,e,t){if(e?zt.set(e.getData()):zt.set(new Float32Array(4)),t){let n=t.ambient;zt[4]=n.r,zt[5]=n.g,zt[6]=n.b,zt[7]=t.shininess;let i=t.diffuse;zt[8]=i.r,zt[9]=i.g,zt[10]=i.b,zt[11]=t.alpha;let s=t.specular;zt[12]=s.r,zt[13]=s.g,zt[14]=s.b}else zt.set(new Float32Array(cu-4),4);r.write(0,zt,0,cu)}var zt=new Float32Array(Math.max(Xh,cu));var vt=class extends Ts{constructor(t,n,i=null,s=null){super(n,i,s);this.listInstanceMatrix=[Qe.ORIGIN];this.m_bBox=void 0;this.elements=t,t.incOut()}clear(){var t,n,i;this.elements.decOut((t=this.renderer)==null?void 0:t.gl),(n=this.colorMaterialBuf)==null||n.destroy(),(i=this.bindGroup)==null||i.destroy(),delete this.renderer,delete this.gpu}addInstanceMatrix(t){this.listInstanceMatrix.push(t)}isOutOfRange(t,n,i){let s=new zr;n.forEach(f=>s.ext3(f.multiply4(t)));let o=s.build(),a=o.maxX-o.minX,l=o.maxY-o.minY,u=2/this.renderer.width(),c=2/this.renderer.height(),h=2;return a<=u*h||l<=c*h?!0:!(o.minX+i.x<1&&o.maxX+i.x>-1&&o.minY+i.y<1&&o.maxY+i.y>-1)}setMaterial(t){super.setMaterial(t),this.gpu&&Vh(this.colorMaterialBuf,this.getColor(),this.getMaterial())}setColor(t){super.setColor(t),this.gpu&&Vh(this.colorMaterialBuf,this.getColor(),this.getMaterial())}drawGPU(t,n){this.gpu||(this.gpu=t.gpu,this.colorMaterialBuf=t.gpu.createDynamicBuffer(cu,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),Vh(this.colorMaterialBuf,this.getColor(),this.getMaterial()),this.bindGroup=t.meshProgram.createDynamicBindGroup(this.colorMaterialBuf));let i=t.getCurrentCamera().getRenderMatrix(),s=this.elements.getBBox().getVertexes(),o=t.getViewOffset(),a=[];for(let u=n.length-1;u>=0;u--){let c=n[u],h=this.outMatrixParamMap.get(c.matrix),f=c.renderMode;!h.drawn&&!this.isOutOfRange(c.matrix.multiply4(i),s,o)&&(f===3?h.color:f===0?this.getColor():this.getMaterial()).alpha!==0&&a.push(c),h.drawn=!0}if(a.length===0)return;let l=new Set(a.map(u=>u.renderMode));for(let u of l)t.meshProgram.render(u,this.elements,this.bindGroup,a.filter(c=>c.renderMode===u))}draw(t,n){let i=t.renderer;this.renderer||(this.renderer=i);let s=t.getCurrentCamera().getRenderMatrix(),o=this.getBBox().getVertexes(),a=t.getViewOffset(),l=[];for(let d=n.length-1;d>=0;d--){let m=n[d],p=this.outMatrixParamMap.get(m.matrix),g=m.renderMode,b=this.isOutOfRange(m.matrix.multiply4(s),o,a);!p.drawn&&!b&&(g===3?p.color:g===0?this.getColor():this.getMaterial()).alpha!==0&&l.push(m),p.drawn=!0}if(l.length===0)return;let u=i.gl,c=[];for(let d=0;d<4;d++)c.push(i.createBuffer());let h,f=new Set(l.map(d=>d.renderMode));for(let d of f){let m=l.filter(g=>g.renderMode===d),p=[[],[],[],[]];for(let g of m)for(let b of this.listInstanceMatrix)for(let v=0;v<4;v++){let w=b.multiply4(g.matrix);p[v].push(...w.data.slice(v*4,(v+1)*4))}for(let g=0;g<4;g++)u.bindBuffer(u.ARRAY_BUFFER,c[g]),u.bufferData(u.ARRAY_BUFFER,new Float32Array(p[g]),u.STATIC_DRAW);if(d===0||d===3){let g=[];for(let b of m){let v=b.color;g.push(v.r,v.g,v.b,v.alpha)}h||(h=i.createBuffer()),u.bindBuffer(u.ARRAY_BUFFER,h),u.bufferData(u.ARRAY_BUFFER,new Float32Array(g),u.STATIC_DRAW)}t.generalProgram.render(d,this.elements,c,m.length*this.listInstanceMatrix.length,h,this.getMaterial())}for(let d of c)u.deleteBuffer(d);u.deleteBuffer(h)}getBBox(){if(this.m_bBox)return this.m_bBox;if(this.listInstanceMatrix.length===1)this.m_bBox=this.elements.getBBox();else{let t=this.elements.getBBox(),n=new zr,i=new me(t.minX,t.minY,t.minZ),s=new me(t.maxX,t.maxY,t.maxZ);n.ext3(i),n.ext3(s);for(let o of this.listInstanceMatrix)n.ext3(i.multiply4(o)),n.ext3(s.multiply4(o));this.m_bBox=n.build()}return this.m_bBox}};function fv(r,e,t,n,i,s,o,a,l,u,c=1){let h=new Fe(r,e,t),f=new Fe(n,i,s),d=new Fe(o,a,l);return new Pn(h,f,d,u*5,c)}var dv=new ArrayBuffer(8*5),hu=new Float64Array(dv),_F=new Int32Array(dv),Pn=class{constructor(e,t,n,i,s){if(s<0||s>1)throw new Error("alpha must between 0 and 1");this.ambient=e,this.diffuse=t,this.specular=n,this.shininess=Ms.positiveOr0(i),this.alpha=s,hu[0]=e.hashCode(),hu[1]=t.hashCode(),hu[2]=n.hashCode(),hu[3]=i,hu[4]=s;let o=0;for(let a=0;a<10;a++)o^=_F[a];this.hashed=o}hashCode(){return this.hashed}equals(e){return e instanceof Pn?e.ambient.equals(this.ambient)&&e.diffuse.equals(this.diffuse)&&e.specular.equals(this.specular)&&e.shininess===this.shininess&&e.alpha===this.alpha:!1}};var xv=10,ft=10,ar=2**4-1<<ft,Co=2**ft-1,Ct=1<<ft+4,Mt=1<<ft+5,Br=(l=>(l[l.CIRCLE=0]="CIRCLE",l[l.LINE=1]="LINE",l[l.ARC=2]="ARC",l[l.TRIANGLE=3]="TRIANGLE",l[l.RECT=4]="RECT",l[l.CUTED_CIRCLE=5]="CUTED_CIRCLE",l[l.TYPE_NUM=6]="TYPE_NUM",l[l.TEXTURE=7]="TEXTURE",l))(Br||{});function pv(r){return(r&ar)>>ft}var mv=new Float64Array(6),gv=[];function Yn(r,e){mv[r]=e.length,gv[r]=e.getBBox}var du={getPtLength(r,e){let t=r[e];return mv[pv(t)]+((t&Ct)===0?0:1)+((t&Mt)===0?0:1)},getBBox(r,e){return gv[pv(r[e])](r,e)}};var Zm=class{constructor(){this.length=7}create(e,t,n,i,s,o,a,l){let u=[e+(2<<ft),t.x,t.y,n,i,s,o];return typeof a=="number"&&(u[0]+=Ct,u.push(a)),typeof l=="number"&&(u[0]+=Mt,u.push(l)),u}getBBox(e,t){let n=e[t+1],i=e[t+2],s=e[t+3],o=e[t+4],a=e[t+5],l=a+e[t+6],u=new Oe;u.ext2(q.X_UNIT_VECTOR.multiply3(qe.rotate(a))),u.ext2(q.X_UNIT_VECTOR.multiply3(qe.rotate(l)));for(let f=Math.ceil(a/(Math.PI/2))*(Math.PI/2);f<l;f+=Math.PI/2)u.ext2(q.X_UNIT_VECTOR.multiply3(qe.rotate(f)));let c=u.build(),h=o/2;return new ye(c.minX*s+n-h,c.maxX*s+n+h,c.minY*s+i-h,c.maxY*s+i+h)}},sn=new Zm;Yn(2,sn);var Km=class{constructor(){this.length=4}create(e,t,n,i,s){let o=[e+(0<<ft),t.x,t.y,n];return typeof i=="number"&&(o[0]+=Ct,o.push(i)),typeof s=="number"&&(o[0]+=Mt,o.push(s)),o}getBBox(e,t){let n=e[t+1],i=e[t+2],s=e[t+3];return new ye(n-s,n+s,i-s,i+s)}},on=new Km;Yn(0,on);var Qm=class{constructor(){this.length=6}create(e,t,n,i,s,o){let a=[e+(1<<ft),t.x,t.y,n.x,n.y,i];return typeof s=="number"&&(a[0]+=Ct,a.push(s)),typeof o=="number"&&(a[0]+=Mt,a.push(o)),a}getBBox(e,t){let n=e[t+1],i=e[t+2],s=e[t+3],o=e[t+4],a=e[t+5],l=new Oe;return l.ext6(n,i),l.ext6(s,o),l.ext7(a/2),l.build()}},an=new Qm;Yn(1,an);var Jm=class{constructor(){this.length=7}create(e,t,n,i,s,o){let a=[e+(3<<ft),t.x,t.y,n.x,n.y,i.x,i.y];return typeof s=="number"&&(a[0]+=Ct,a.push(s)),typeof o=="number"&&(a[0]+=Mt,a.push(o)),a}getBBox(e,t){let n=e[t+1],i=e[t+2],s=e[t+3],o=e[t+4],a=e[t+5],l=e[t+6];return new ye(Math.min(n,s,a),Math.max(n,s,a),Math.min(i,o,l),Math.max(i,o,l))}},_r=new Jm;Yn(3,_r);var PF=typeof document<"u"&&(document.getElementById("webgpu-canvas")||document.getElementById("root")),mr=new URLSearchParams(typeof window>"u"?"":window.location.search),SF=Number(mr.get("circleNum"))||2e4,IF=Number(mr.get("layerNum"))||1,BF=Number(mr.get("circleR"))||.01,Wh=Number(mr.get("canvasW")),$h=Number(mr.get("canvasH")),AF=mr.get("entry"),u1e=mr.get("mode"),Ar=Number(mr.get("maxPtNumInARtree"))||2e7,fu=Number(mr.get("copyNumX"))||1,jh=Number(mr.get("copyNumY"))||fu,pu=Number(mr.get("copyOffsetX"))||0,Hh=Number(mr.get("copyOffsetY"))||pu,TF=Boolean(JSON.parse(mr.get("renderWhenChange"))),CF=Boolean(JSON.parse(mr.get("loopRenderMode"))),eg=Number(mr.get("maxGpuThreadNum"))||1024,tg=Number(mr.get("minFps"))||30,Xa=Number(mr.get("capacity"))||64,MF=Boolean(JSON.parse(mr.get("autoLoadData"))),Gs=Number(mr.get("maxDynamicPtNum"))||4e4,rg=Number(mr.get("texScale"))||1,NF=4e7,c1e=NF,ct=4,ng=2**30/ct,h1e=ng/2,Sn=2**(2**7-1),d1e=2**31-1;PF&&console.log({circleNum:SF,layerNum:IF,circleR:BF,canvasW:Wh,canvasH:$h,entry:AF,maxPtNumInARtree:Ar,copyNumX:fu,copyNumY:jh,copyOffsetX:pu,copyOffsetY:Hh,renderWhenChange:TF,loopRenderMode:CF,maxGpuThreadNum:eg,minFps:tg,capacity:Xa,autoLoadData:MF,maxDynamicPtNum:Gs,texScale:rg});async function f1e(r,e=()=>""){let t=[],n=[],i=performance.now();async function s(){n.push(performance.now()-i),i=performance.now(),await r(),t.push(performance.now()-i),n.length===30&&(console.log("frame fps",1e3/(n.reduce((a,l)=>a+l,0)/n.length),"virtual fps",1e3/(t.reduce((a,l)=>a+l,0)/t.length),e()),n.length=0,t.length=0),o&&(o=requestAnimationFrame(s))}let o=requestAnimationFrame(s);window.addEventListener("keydown",a=>{a.key==="Escape"&&(o?(cancelAnimationFrame(o),o=0):o=requestAnimationFrame(s))})}function p1e(r,e,t,n,i,s){return r=32767*(r-t)*i,e=32767*(e-n)*s,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}async function bv(){if(!navigator.gpu)return;let r=await navigator.gpu.requestAdapter(),e={};for(let n in r.limits){let i=r.limits[n];typeof i=="number"&&(e[n]=i)}let t=await r.requestDevice({requiredLimits:e,requiredFeatures:r.features});return console.log(t.limits,Array.from(r.features)),t}function yv(r,e){return new Array(r).fill("").map((t,n)=>e(n)).join("")}var ig=class{constructor(){this.length=6}create(e,t,n,i,s,o,a){let l=[e+(5<<ft),t.x,t.y,n,i,s];return typeof o=="number"&&(l[0]+=Ct,l.push(o)),typeof a=="number"&&(l[0]+=Mt,l.push(a)),l}getBBox(e,t){let n=e[t+1],i=e[t+2],s=e[t+3],o=e[t+4],a=o+e[t+5],l=new Oe;if(l.ext2(q.X_UNIT_VECTOR.multiply3(qe.rotate(o))),l.ext2(q.X_UNIT_VECTOR.multiply3(qe.rotate(a))),o<a)for(let c=Math.ceil(o/(Math.PI/2))*(Math.PI/2);c<a;c+=Math.PI/2)l.ext2(q.X_UNIT_VECTOR.multiply3(qe.rotate(c)));else for(let c=Math.floor(o/(Math.PI/2))*(Math.PI/2);c>a;c-=Math.PI/2)l.ext2(q.X_UNIT_VECTOR.multiply3(qe.rotate(c)));let u=l.build();return new ye(u.minX*s+n,u.maxX*s+n,u.minY*s+i,u.maxY*s+i)}},$r=new ig;Yn(5,$r);var sg=class{constructor(){this.length=8}create(e,t,n,i,s,o,a,l,u){let c=[e+(4<<ft),t.x,t.y,n,i,s,o,a];return typeof l=="number"&&(c[0]+=Ct,c.push(l)),typeof u=="number"&&(c[0]+=Mt,c.push(u)),c}getBBox(e,t){let n=new q(e[t+1],e[t+2]),i=e[t+3],s=e[t+4],o=e[t+5],a=e[t+7],l=qe.rotateD(o),u=n.add(new q(a,-a).multiply3(l)),c=n.add(new q(a,a-s).multiply3(l)),h=n.add(new q(i-a,-a).multiply3(l)),f=n.add(new q(i-a,a-s).multiply3(l));return new ye(Math.min(u.x,c.x,h.x,f.x)-a,Math.max(u.x,c.x,h.x,f.x)+a,Math.min(u.y,c.y,h.y,f.y)-a,Math.max(u.y,c.y,h.y,f.y)+a)}},ln=new sg;Yn(4,ln);function og(r){return 2**Math.floor(Math.log2(r.limits.maxComputeWorkgroupStorageSize/ct/4))}function RF(r){let e=r.limits.maxComputeWorkgroupSizeX,t=og(r);return`
	struct BBox {
		minX: f32,
		maxX: f32,
		minY: f32,
		maxY: f32,
	}

	struct Params {
		groupOffsetX: u32,
		step: u32,
	}

    @binding(0) @group(0) var<uniform> params: Params;
	@binding(1) @group(0) var<storage, read_write> bboxs: array<BBox>;

	var<workgroup> localBBoxs: array<BBox, ${t}>;

	fn selectU(a: u32, b: u32, condition: bool) -> u32 {
		return select(a, b, condition);
	}

	fn ceilU(a: u32, b: u32) -> u32 {
		return a / b + selectU(1, 0, a % b == 0);
	}

	@compute @workgroup_size(${e})
    fn buildBBoxByBBoxs(
		@builtin(local_invocation_id) locCoord : vec3<u32>,
        @builtin(workgroup_id) groupId : vec3<u32>,
    ) {
		let bboxStep2 = params.step * 2;
		let bboxNum = arrayLength(&bboxs);
		let groupX = params.groupOffsetX + groupId.x;
		let groupStart = groupX * ${t} * bboxStep2;
		let groupEnd = select(min((groupX + 1) * ${t} * bboxStep2, bboxNum), bboxNum, (groupX + 1) * bboxStep2 >= ${2**32/t});
		let threadStart = select(groupStart + locCoord.x * bboxStep2, groupEnd, locCoord.x >= ceilU(groupEnd - groupStart, bboxStep2));
		let add = select(${e} * bboxStep2, groupEnd - threadStart, bboxStep2 >= ${2**32/e});
		for (var i = threadStart; i < groupEnd; i += add) {
			let nextI = i + params.step;
			let localBBoxIndex = (i - groupStart) / bboxStep2;
			if (nextI < groupEnd) {
				localBBoxs[localBBoxIndex].minX = min(bboxs[i].minX, bboxs[nextI].minX);
				localBBoxs[localBBoxIndex].maxX = max(bboxs[i].maxX, bboxs[nextI].maxX);
				localBBoxs[localBBoxIndex].minY = min(bboxs[i].minY, bboxs[nextI].minY);
				localBBoxs[localBBoxIndex].maxY = max(bboxs[i].maxY, bboxs[nextI].maxY);
			} else {
				localBBoxs[localBBoxIndex].minX = bboxs[i].minX;
				localBBoxs[localBBoxIndex].maxX = bboxs[i].maxX;
				localBBoxs[localBBoxIndex].minY = bboxs[i].minY;
				localBBoxs[localBBoxIndex].maxY = bboxs[i].maxY;
			}
		}

		workgroupBarrier();

		let num = ceilU(groupEnd - groupStart, bboxStep2);
		var step: u32 = 1;
		while (step < num) {
			let threadStep = step * 2 * ${e};
			for (var i = locCoord.x * step * 2 + step; i < num; i += threadStep) {
				let lastI = i - step;
				localBBoxs[lastI].minX = min(localBBoxs[i].minX, localBBoxs[lastI].minX);
				localBBoxs[lastI].maxX = max(localBBoxs[i].maxX, localBBoxs[lastI].maxX);
				localBBoxs[lastI].minY = min(localBBoxs[i].minY, localBBoxs[lastI].minY);
				localBBoxs[lastI].maxY = max(localBBoxs[i].maxY, localBBoxs[lastI].maxY);
			}
			step *= 2;
			workgroupBarrier();
		}

		if (locCoord.x == 0) {
			bboxs[groupStart].minX = localBBoxs[0].minX;
			bboxs[groupStart].maxX = localBBoxs[0].maxX;
			bboxs[groupStart].minY = localBBoxs[0].minY;
			bboxs[groupStart].maxY = localBBoxs[0].maxY;
		}
	}
`}var Zh,vv,wv,Kh;function LF(r){if(Zh)return;let t=r.device.createShaderModule({code:RF(r)});Zh=r.createComputePipeline(t,"buildBBoxByBBoxs"),vv=r.createStaticBuffer(new Uint32Array(new Array(1024).fill(0).map((o,a)=>a*r.limits.maxComputeWorkgroupsPerDimension)),GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST);let n=og(r)*2,i=1,s=[];for(;i<Number.MAX_SAFE_INTEGER;)s.push(i),i*=n;wv=r.createStaticBuffer(new Uint32Array(s),GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),Kh=r.createDynamicBuffer(2,GPUBufferUsage.UNIFORM|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST)}function Ev(r,e){LF(r);let t=og(r)*2,n=1,i=0,s=r.device.createCommandEncoder(),o=e.getSize()/4,a=r.createBindGroup(Zh.getBindGroupLayout(0),0,Kh,1,e);for(;n<o;){r.copyBufferToBuffer(wv,i++,Kh,1,1,s);let l=Math.ceil(o/n);r.runComputePass(s,Zh,a,(l%t===1?Math.floor:Math.ceil)(l/t)*r.limits.maxComputeWorkgroupSizeX,u=>r.copyBufferToBuffer(vv,u,Kh,0,1,s)),n*=t}return r.submit(s),e.read(0,4).then(l=>{let u=new Float32Array(l);return new ye(u[0],u[1],u[2],u[3])})}function OF(r){return`
	struct BBox {
		minX: f32,
		maxX: f32,
		minY: f32,
		maxY: f32,
	}

	struct Params {
		coordXOffset: u32,
	}

	struct IdStartIndex {
		id: u32,
		startIndex: u32,
	}

	struct InfoStartIndexs {
		ptNum: atomic<u32>,
		nextStartIndex: atomic<u32>,
        idStartIndexs: array<IdStartIndex>,
	}

	struct InfoStartIndexsR {
		ptNum: u32,
		nextStartIndex: u32,
        idStartIndexs: array<IdStartIndex>,
	}

    @binding(0) @group(0) var<uniform> params: Params;
	@binding(1) @group(0) var<storage, read_write> infoStartIndexs: InfoStartIndexsR;
	@binding(2) @group(0) var<storage, read_write> pts: array<f32>;
	@binding(3) @group(0) var<storage, read_write> bboxs: array<BBox>;

	@compute @workgroup_size(${r.limits.maxComputeWorkgroupSizeX})
    fn buildBBoxs(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let coordX = params.coordXOffset + coord.x;
		if (coordX >= infoStartIndexs.ptNum) {
			return;
		}

		let startIndex = infoStartIndexs.idStartIndexs[coordX].startIndex;
		let type0 = (u32(pts[startIndex]) & ${ar}) >> ${ft};
		if (type0 == ${0}) {
			bboxs[coordX].minX = pts[startIndex + 1] - pts[startIndex + 3];
			bboxs[coordX].maxX = pts[startIndex + 1] + pts[startIndex + 3];
			bboxs[coordX].minY = pts[startIndex + 2] - pts[startIndex + 3];
			bboxs[coordX].maxY = pts[startIndex + 2] + pts[startIndex + 3];
		} else if (type0 == ${1}) {
			bboxs[coordX].minX = min(pts[startIndex + 1], pts[startIndex + 3]) - pts[startIndex + 5] / 2.0;
			bboxs[coordX].maxX = max(pts[startIndex + 1], pts[startIndex + 3]) + pts[startIndex + 5] / 2.0;
			bboxs[coordX].minY = min(pts[startIndex + 2], pts[startIndex + 4]) - pts[startIndex + 5] / 2.0;
			bboxs[coordX].maxY = max(pts[startIndex + 2], pts[startIndex + 4]) + pts[startIndex + 5] / 2.0;
		} else if (type0 == ${2}) {
			let centerX = pts[startIndex + 1];
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let width2 = pts[startIndex + 4] / 2;
			let startAngle = pts[startIndex + 5];
			let endAngle = startAngle + pts[startIndex + 6];
			var x = cos(startAngle);
			var y = sin(startAngle);
			var minX = x;
			var maxX = x;
			var minY = y;
			var maxY = y;
			x = cos(endAngle);
			y = sin(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			minY = min(minY, y);
			maxY = max(maxY, y);
			for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
				x = cos(angle);
				y = sin(angle);
				minX = min(minX, x);
				maxX = max(maxX, x);
				minY = min(minY, y);
				maxY = max(maxY, y);
			}
			bboxs[coordX].minX = minX * radius - width2 + centerX;
			bboxs[coordX].maxX = maxX * radius + width2 + centerX;
			bboxs[coordX].minY = minY * radius - width2 + centerY;
			bboxs[coordX].maxY = maxY * radius + width2 + centerY;
		} else if (type0 == ${3}) {
			bboxs[coordX].minX = min(min(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]);
			bboxs[coordX].maxX = max(max(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]);
			bboxs[coordX].minY = min(min(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]);
			bboxs[coordX].maxY = max(max(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]);
		} else if (type0 == ${4}) {
			let leftUpPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]);
			let width = pts[startIndex + 3];
			let height = pts[startIndex + 4];
			let angle = radians(pts[startIndex + 5]);
			let radius = pts[startIndex + 7];

			let cos0 = cos(angle);
			let sin0 = sin(angle);
			let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0);

			let luPoint = leftUpPoint + mat0 * vec2(radius, -radius);
			let ldPoint = leftUpPoint + mat0 * vec2(radius, radius - height);
			let ruPoint = leftUpPoint + mat0 * vec2(width - radius, -radius);
			let rdPoint = leftUpPoint + mat0 * vec2(width - radius, radius - height);
			
			bboxs[coordX].minX = min(min(luPoint.x, ldPoint.x), min(ruPoint.x, rdPoint.x)) - radius;
			bboxs[coordX].maxX = max(max(luPoint.x, ldPoint.x), max(ruPoint.x, rdPoint.x)) + radius;
			bboxs[coordX].minY = min(min(luPoint.y, ldPoint.y), min(ruPoint.y, rdPoint.y)) - radius;
			bboxs[coordX].maxY = max(max(luPoint.y, ldPoint.y), max(ruPoint.y, rdPoint.y)) + radius;
		} else if (type0 == ${5}) {
			let centerX = pts[startIndex + 1];
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 4];
			let endAngle = startAngle + pts[startIndex + 5];
			var x = cos(startAngle);
			var y = sin(startAngle);
			var minX = x;
			var maxX = x;
			var minY = y;
			var maxY = y;
			x = cos(endAngle);
			y = sin(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			minY = min(minY, y);
			maxY = max(maxY, y);
			if (startAngle < endAngle) {
				for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
					x = cos(angle);
					y = sin(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			} else {
				for (var angle = floor(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle > endAngle; angle -= ${Math.PI/2}) {
					x = cos(angle);
					y = sin(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			}
			bboxs[coordX].minX = minX * radius + centerX;
			bboxs[coordX].maxX = maxX * radius + centerX;
			bboxs[coordX].minY = minY * radius + centerY;
			bboxs[coordX].maxY = maxY * radius + centerY;
		}
	}
`}var Qh,ag;async function Jh(r,e,t,n){if(n===0)return null;let i=r.device;Qh||(Qh=r.createComputePipeline(i.createShaderModule({code:OF(r)}),"buildBBoxs"),ag=r.createDynamicBuffer(1,GPUBufferUsage.UNIFORM|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST));let s=r.createDynamicBuffer(n*4,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),o=r.createBindGroup(Qh.getBindGroupLayout(0),0,ag,1,e,2,t,3,s),a=i.createCommandEncoder();r.runComputePass(a,Qh,o,n,u=>r.copyBufferToBuffer(r.coordXOffsetBuf,u,ag,0,1,a)),r.submit(a);let l=await Ev(r,s);return s.destroy(),l}var os=2;function _v(r,e){return`
	let num = ${e} + addiNum;
    if(${r}){
		let index = atomicAdd(&infoStartIndexs0.ptNum, 1);
		if(index < ${Ar}){
			infoStartIndexs0.idStartIndexs[index].id = infoStartIndexs.idStartIndexs[coordX].id;
			let startIndex0 = atomicAdd(&infoStartIndexs0.nextStartIndex, num);
			infoStartIndexs0.idStartIndexs[index].startIndex = startIndex0;
			for(var i: u32 = 0; i < num; i++){
				pts0[startIndex0 + i] = pts[startIndex + i];
			}
			return;
		}
    }else{
		let index = atomicAdd(&infoStartIndexs1.ptNum, 1);
		if(index < ${Ar}){
			infoStartIndexs1.idStartIndexs[index].id = infoStartIndexs.idStartIndexs[coordX].id;
			let startIndex1 = atomicAdd(&infoStartIndexs1.nextStartIndex, num);
			infoStartIndexs1.idStartIndexs[index].startIndex = startIndex1;
			for(var i: u32 = 0; i < num; i++){
				pts1[startIndex1 + i] = pts[startIndex + i];
			}
			return;
		}
    }
	let index = atomicAdd(&remainInfoStartIndexs.ptNum, 1);
	remainInfoStartIndexs.idStartIndexs[index].id = infoStartIndexs.idStartIndexs[coordX].id;
	let remainStartIndex = atomicAdd(&remainInfoStartIndexs.nextStartIndex, num);
	remainInfoStartIndexs.idStartIndexs[index].startIndex = remainStartIndex;
	for(var i: u32 = 0; i < num; i++){
		remainPts[remainStartIndex + i] = pts[startIndex + i];
	}
`}function Xn(r,e){return _v(`${r} < params.mid2`,e)}function Va(r){return _v("distance2(xy, params.xy0) < distance2(xy, params.xy1)",r)}function kF(r){let e=r.limits.maxComputeWorkgroupSizeX;return`
	struct Params {
		coordXOffset: u32,
        mid2: f32,
		xy0: vec2<f32>,
		minX0: f32,
		maxX0: f32,
		minY0: f32,
		maxY0: f32,
		xy1: vec2<f32>,
		minX1: f32,
		maxX1: f32,
		minY1: f32,
		maxY1: f32,
	}

	struct IdStartIndex {
		id: u32,
		startIndex: u32,
	}

	struct InfoStartIndexs {
		ptNum: atomic<u32>,
		nextStartIndex: atomic<u32>,
        idStartIndexs: array<IdStartIndex>,
	}

	struct InfoStartIndexsR {
		ptNum: u32,
		nextStartIndex: u32,
        idStartIndexs: array<IdStartIndex>,
	}

    @binding(0) @group(0) var<uniform> params: Params;
	@binding(1) @group(0) var<storage, read_write> infoStartIndexs: InfoStartIndexsR;
	@binding(2) @group(0) var<storage, read_write> pts: array<f32>;

	@binding(4) @group(0) var<storage, read_write> infoStartIndexs0: InfoStartIndexs;
	@binding(5) @group(0) var<storage, read_write> pts0: array<f32>;
	@binding(6) @group(0) var<storage, read_write> infoStartIndexs1: InfoStartIndexs;
	@binding(7) @group(0) var<storage, read_write> pts1: array<f32>;
	@binding(8) @group(0) var<storage, read_write> remainInfoStartIndexs: InfoStartIndexs;
	@binding(9) @group(0) var<storage, read_write> remainPts: array<f32>;

	fn distance2(p1: vec2<f32>, p2: vec2<f32>) -> f32 {
		let x = p1.x - p2.x;
		let y = p1.y - p2.y;
		return x * x + y * y;
	}

	fn selectU(a: u32, b: u32, condition: bool) -> u32 {
		return select(a, b, condition);
	}

    @compute @workgroup_size(${e})
    fn splitByX(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let coordX = params.coordXOffset + coord.x;
		if (coordX >= infoStartIndexs.ptNum) {
			return;
		}

		let startIndex = infoStartIndexs.idStartIndexs[coordX].startIndex;
		let head = u32(pts[startIndex]);
		let type0 = (head & ${ar}) >> ${ft};
		let addiNum = selectU(1, 0, (head & ${Ct}) == 0) + selectU(1, 0, (head & ${Mt}) == 0);
		if (type0 == ${0}) {
            ${Xn("pts[startIndex + 1] * 2",on.length)}
		} else if (type0 == ${1}) {
            ${Xn("min(pts[startIndex + 1], pts[startIndex + 3]) + max(pts[startIndex + 1], pts[startIndex + 3])",an.length)}
		} else if (type0 == ${2}) {
			let centerX = pts[startIndex + 1];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 5];
			let endAngle = startAngle + pts[startIndex + 6];
			var x = cos(startAngle);
			var minX = x;
			var maxX = x;
			x = cos(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
				x = cos(angle);
				minX = min(minX, x);
				maxX = max(maxX, x);
			}
            ${Xn("minX * radius + centerX + maxX * radius + centerX",sn.length)}
		} else if (type0 == ${3}) {
            ${Xn("min(min(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]) + max(max(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5])",_r.length)}
		} else if (type0 == ${4}) {
			let leftUpPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]);
			let width = pts[startIndex + 3];
			let height = pts[startIndex + 4];
			let angle = radians(pts[startIndex + 5]);
			let radius = pts[startIndex + 7];

			let cos0 = cos(angle);
			let sin0 = sin(angle);
			let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0);

			let luPoint = leftUpPoint + mat0 * vec2(radius, -radius);
			let ldPoint = leftUpPoint + mat0 * vec2(radius, radius - height);
			let ruPoint = leftUpPoint + mat0 * vec2(width - radius, -radius);
			let rdPoint = leftUpPoint + mat0 * vec2(width - radius, radius - height);
            ${Xn("min(min(luPoint.x, ldPoint.x), min(ruPoint.x, rdPoint.x)) + max(max(luPoint.x, ldPoint.x), max(ruPoint.x, rdPoint.x))",ln.length)}
		} else if (type0 == ${5}) {
			let centerX = pts[startIndex + 1];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 4];
			let endAngle = startAngle + pts[startIndex + 5];
			var x = cos(startAngle);
			var minX = x;
			var maxX = x;
			x = cos(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			if (startAngle < endAngle) {
				for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
					x = cos(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
				}
			} else {
				for (var angle = floor(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle > endAngle; angle -= ${Math.PI/2}) {
					x = cos(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
				}
			}
            ${Xn("minX * radius + centerX + maxX * radius + centerX",$r.length)}
		}
	}

    @compute @workgroup_size(${e})
    fn splitByY(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let coordX = params.coordXOffset + coord.x;
		if (coordX >= infoStartIndexs.ptNum) {
			return;
		}

		let startIndex = infoStartIndexs.idStartIndexs[coordX].startIndex;
		let head = u32(pts[startIndex]);
		let type0 = (head & ${ar}) >> ${ft};
		let addiNum = selectU(1, 0, (head & ${Ct}) == 0) + selectU(1, 0, (head & ${Mt}) == 0);
		if (type0 == ${0}) {
            ${Xn("pts[startIndex + 2] * 2",on.length)}
		} else if (type0 == ${1}) {
            ${Xn("min(pts[startIndex + 2], pts[startIndex + 4]) + max(pts[startIndex + 2], pts[startIndex + 4])",an.length)}
		} else if (type0 == ${2}) {
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 5];
			let endAngle = startAngle + pts[startIndex + 6];
			var y = sin(startAngle);
			var minY = y;
			var maxY = y;
			y = sin(endAngle);
			minY = min(minY, y);
			maxY = max(maxY, y);
			for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
				y = sin(angle);
				minY = min(minY, y);
				maxY = max(maxY, y);
			}
            ${Xn("minY * radius + centerY + maxY * radius + centerY",sn.length)}
		} else if (type0 == ${3}) {
            ${Xn("min(min(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]) + max(max(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6])",_r.length)}
		} else if (type0 == ${4}) {
			let leftUpPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]);
			let width = pts[startIndex + 3];
			let height = pts[startIndex + 4];
			let angle = radians(pts[startIndex + 5]);
			let radius = pts[startIndex + 7];

			let cos0 = cos(angle);
			let sin0 = sin(angle);
			let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0);

			let luPoint = leftUpPoint + mat0 * vec2(radius, -radius);
			let ldPoint = leftUpPoint + mat0 * vec2(radius, radius - height);
			let ruPoint = leftUpPoint + mat0 * vec2(width - radius, -radius);
			let rdPoint = leftUpPoint + mat0 * vec2(width - radius, radius - height);
            ${Xn("min(min(luPoint.y, ldPoint.y), min(ruPoint.y, rdPoint.y)) + max(max(luPoint.y, ldPoint.y), max(ruPoint.y, rdPoint.y))",ln.length)}
		} else if (type0 == ${5}) {
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 4];
			let endAngle = startAngle + pts[startIndex + 5];
			var y = sin(startAngle);
			var minY = y;
			var maxY = y;
			y = sin(endAngle);
			minY = min(minY, y);
			maxY = max(maxY, y);
			if (startAngle < endAngle) {
				for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
					y = sin(angle);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			} else {
				for (var angle = floor(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle > endAngle; angle -= ${Math.PI/2}) {
					y = sin(angle);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			}
            ${Xn("minY * radius + centerY + maxY * radius + centerY",$r.length)}
		}
	}

	@compute @workgroup_size(${e})
    fn splitByBBox(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let coordX = params.coordXOffset + coord.x;
		if (coordX >= infoStartIndexs.ptNum) {
			return;
		}

		let startIndex = infoStartIndexs.idStartIndexs[coordX].startIndex;
		let head = u32(pts[startIndex]);
		let type0 = (head & ${ar}) >> ${ft};
		let addiNum = selectU(1, 0, (head & ${Ct}) == 0) + selectU(1, 0, (head & ${Mt}) == 0);
		var xy: vec2<f32>;
		if (type0 == ${0}) {
			xy = vec2(pts[startIndex + 1], pts[startIndex + 2]);
			${Va(on.length)}
		} else if (type0 == ${1}) {
			xy = vec2((min(pts[startIndex + 1], pts[startIndex + 3]) + max(pts[startIndex + 1], pts[startIndex + 3])) / 2,
				(min(pts[startIndex + 2], pts[startIndex + 4]) + max(pts[startIndex + 2], pts[startIndex + 4])) / 2);
			${Va(an.length)}
		} else if (type0 == ${2}) {
			let centerX = pts[startIndex + 1];
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 5];
			let endAngle = startAngle + pts[startIndex + 6];
			var x = cos(startAngle);
			var y = sin(startAngle);
			var minX = x;
			var maxX = x;
			var minY = y;
			var maxY = y;
			x = cos(endAngle);
			y = sin(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			minY = min(minY, y);
			maxY = max(maxY, y);
			for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
				x = cos(angle);
				y = sin(angle);
				minX = min(minX, x);
				maxX = max(maxX, x);
				minY = min(minY, y);
				maxY = max(maxY, y);
			}
			xy = vec2((minX * radius + centerX + maxX * radius + centerX) / 2, (minY * radius + centerY + maxY * radius + centerY) / 2);
			${Va(sn.length)}
		} else if (type0 == ${3}) {
			xy = vec2((min(min(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]) + max(max(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5])) / 2,
				(min(min(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]) + max(max(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6])) / 2);
			${Va(_r.length)}
		} else if (type0 == ${4}) {
			let leftUpPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]);
			let width = pts[startIndex + 3];
			let height = pts[startIndex + 4];
			let angle = radians(pts[startIndex + 5]);
			let radius = pts[startIndex + 7];

			let cos0 = cos(angle);
			let sin0 = sin(angle);
			let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0);

			let luPoint = leftUpPoint + mat0 * vec2(radius, -radius);
			let ldPoint = leftUpPoint + mat0 * vec2(radius, radius - height);
			let ruPoint = leftUpPoint + mat0 * vec2(width - radius, -radius);
			let rdPoint = leftUpPoint + mat0 * vec2(width - radius, radius - height);

			xy = vec2((min(min(luPoint.x, ldPoint.x), min(ruPoint.x, rdPoint.x)) + max(max(luPoint.x, ldPoint.x), max(ruPoint.x, rdPoint.x))) / 2,
				(min(min(luPoint.y, ldPoint.y), min(ruPoint.y, rdPoint.y)) + max(max(luPoint.y, ldPoint.y), max(ruPoint.y, rdPoint.y))) / 2);
			${Va(ln.length)}
		} else if (type0 == ${5}) {
			let centerX = pts[startIndex + 1];
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 4];
			let endAngle = startAngle + pts[startIndex + 5];
			var x = cos(startAngle);
			var y = sin(startAngle);
			var minX = x;
			var maxX = x;
			var minY = y;
			var maxY = y;
			x = cos(endAngle);
			y = sin(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			minY = min(minY, y);
			maxY = max(maxY, y);
			if (startAngle < endAngle) {
				for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
					x = cos(angle);
					y = sin(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			} else {
				for (var angle = floor(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle > endAngle; angle -= ${Math.PI/2}) {
					x = cos(angle);
					y = sin(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			}
			xy = vec2((minX * radius + centerX + maxX * radius + centerX) / 2, (minY * radius + centerY + maxY * radius + centerY) / 2);
			${Va($r.length)}
		}
	}
`}var mu;function UF(r){if(mu)return;let t=r.device.createShaderModule({code:kF(r)});mu={splitByX:r.createComputePipeline(t,"splitByX"),splitByY:r.createComputePipeline(t,"splitByY"),splitByBBox:r.createComputePipeline(t,"splitByBBox")}}async function Pv(r,e,t,n,i,s,o,a,l,u){UF(r);let c=r.device,h,f=r.createDynamicBuffer(14,GPUBufferUsage.UNIFORM|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST);if(i&&a)r.writeBuffer(f,2,new Float32Array([i.center().x,i.center().y,i.minX,i.maxX,i.minY,i.maxY,a.center().x,a.center().y,a.minX,a.maxX,a.minY,a.maxY])),h=mu.splitByBBox;else{let _=await Jh(r,t,n,e);_.width()>_.height()?(r.writeBuffer(f,1,new Float32Array([_.minX+_.maxX])),h=mu.splitByX):(r.writeBuffer(f,1,new Float32Array([_.minY+_.maxY])),h=mu.splitByY)}let d=r.createDynamicBuffer(t.getSize(),t.usage),m=r.createDynamicBuffer(n.getSize(),n.usage),p=r.createBindGroup(h.getBindGroupLayout(0),0,f,1,t,2,n,4,s,5,o,6,l,7,u,8,d,9,m),g=c.createCommandEncoder();r.runComputePass(g,h,p,t.getSize(),_=>r.copyBufferToBuffer(r.coordXOffsetBuf,_,f,0,1,g)),r.submit(g),f.destroy();let[b,v,w]=await Promise.all([d.read(0,2),s.read(0,2),l.read(0,2)]).then(_=>_.map(B=>new Uint32Array(B)));if((v[0]===0||w[0]===0)&&console.warn("info0[0] === 0 || info1[0] === 0"),b[0]===0)t.write(0,new Uint32Array([0,0]));else{let _=c.createCommandEncoder();r.copyBufferToBuffer(d,0,t,0,b[0]*2+os,_),r.copyBufferToBuffer(m,0,n,0,b[1],_),r.submit(_)}d.destroy(),m.destroy();let P=await Promise.all([Jh(r,s,o,v[0]),Jh(r,l,u,w[0])]);return[{ptNum:b[0],nextStartIndex:b[1]},{bbox:P[0],ptNum:v[0],nextStartIndex:v[1]},{bbox:P[1],ptNum:w[0],nextStartIndex:w[1]}]}function ed(r,e,t){let n=r.startsWith("filter1"),i=r.endsWith("End");return`
	@compute @workgroup_size(${t})
    fn ${r}(
		@builtin(global_invocation_id) coord: vec3<u32>,
    ) {
		if(coord.x ${n?"":"+ uniforms.coordXOffset"} >= uniforms.inNum){
			return;
		}
		let node = nodes[${n?"coord.x + uniforms.filterStart":"inIndexs[coord.x + uniforms.coordXOffset]"}];
		var p0 = camera.mvpMatrix * vec4(node.minX, node.minY, uniforms.minZ, 1);
		var p1 = camera.mvpMatrix * vec4(node.minX, node.maxY, uniforms.minZ, 1);
		var p2 = camera.mvpMatrix * vec4(node.maxX, node.minY, uniforms.minZ, 1);
		var p3 = camera.mvpMatrix * vec4(node.maxX, node.maxY, uniforms.minZ, 1);
		var p4 = camera.mvpMatrix * vec4(node.minX, node.minY, uniforms.maxZ, 1);
		var p5 = camera.mvpMatrix * vec4(node.minX, node.maxY, uniforms.maxZ, 1);
		var p6 = camera.mvpMatrix * vec4(node.maxX, node.minY, uniforms.maxZ, 1);
		var p7 = camera.mvpMatrix * vec4(node.maxX, node.maxY, uniforms.maxZ, 1);
		${yv(8,s=>`p${s}.x/=p${s}.w;p${s}.y/=p${s}.w;p${s}.z/=p${s}.w;`)}
		if(min(min(min(p0.x, p1.x), min(p2.x, p3.x)), min(min(p4.x, p5.x), min(p6.x, p7.x))) >= 1 || 
			max(max(max(p0.x, p1.x), max(p2.x, p3.x)), max(max(p4.x, p5.x), max(p6.x, p7.x))) <= -1 ||
			min(min(min(p0.y, p1.y), min(p2.y, p3.y)), min(min(p4.y, p5.y), min(p6.y, p7.y))) >= 1 || 
			max(max(max(p0.y, p1.y), max(p2.y, p3.y)), max(max(p4.y, p5.y), max(p6.y, p7.y))) <= -1 ||
			select(
				((p0.z <= 0 || p0.z > 1) && (p1.z <= 0 || p1.z > 1) && (p2.z <= 0 || p2.z > 1) && (p3.z <= 0 || p3.z > 1) &&
				(p4.z <= 0 || p4.z > 1) && (p5.z <= 0 || p5.z > 1) && (p6.z <= 0 || p6.z > 1) && (p7.z <= 0 || p7.z > 1)) ||
				((p0.z <= camera.borderZ && p0.z > 0) && (p1.z <= camera.borderZ && p1.z > 0) && (p2.z <= camera.borderZ && p2.z > 0) && (p3.z <= camera.borderZ && p3.z > 0) &&
				(p4.z <= camera.borderZ && p4.z > 0) && (p5.z <= camera.borderZ && p5.z > 0) && (p6.z <= camera.borderZ && p6.z > 0) && (p7.z <= camera.borderZ && p7.z > 0)),
				min(min(min(p0.z, p1.z), min(p2.z, p3.z)), min(min(p4.z, p5.z), min(p6.z, p7.z))) >= 1 ||
				max(max(max(p0.z, p1.z), max(p2.z, p3.z)), max(max(p4.z, p5.z), max(p6.z, p7.z))) <= 0,
				camera.isOrth != 0
			)
		) {
			return;
		}

		var num: u32 = 0;
		for(var i = 0; i < ${e}; i++) {
			if(node.childIndexs[i] != 0){
				num++;
			}
		}

		var index = atomicAdd(&nextIndex, num);
		for(var i = 0; i < ${e}; i++) {
			let childIndex = node.childIndexs[i];
			if(childIndex != 0){
				outIndexs[index] = ${i?"-childIndex - 1":"childIndex"};
				index++;
			}
		}
	}`}var Sv=5;function DF(r,e){let t=e.limits.maxComputeWorkgroupSizeX;return`
	struct Uniforms {
		filterStart: u32,
		minZ: f32,
		maxZ: f32,
		inNum: u32,

		// 4
		coordXOffset: u32,
    }

    struct Node {
        minX: f32,
        maxX: f32,
        minY: f32,
        maxY: f32,
		childIndexs: array<i32, ${r}>,
    }

	${nn}

	@binding(0) @group(0) var<uniform> uniforms: Uniforms;
    @binding(1) @group(0) var<storage, read_write> nextIndex: atomic<u32>;
	@binding(2) @group(0) var<storage, read> nodes: array<Node>;
	@binding(3) @group(0) var<storage, read> inIndexs: array<i32>;
	@binding(4) @group(0) var<storage, read_write> outIndexs: array<i32>;
	@binding(6) @group(0) var<uniform> camera: Camera;

	${ed("filter1",r,t)}
	${ed("filter1End",r,t)}

	${ed("filter2",r,t)}
	${ed("filter2End",r,t)}

	fn selectU(a: u32, b: u32, condition: bool) -> u32 {
		return select(a, b, condition);
	}

	@binding(5) @group(0) var<storage, read_write> workgroupCount: vec3<u32>;

	@compute @workgroup_size(1)
    fn calWorkgroupCountX() {
		let x = uniforms.inNum / ${t} + selectU(1, 0, uniforms.inNum % ${t} == 0);
		workgroupCount.x = select(0, min(x - uniforms.coordXOffset / ${t}, ${e.limits.maxComputeWorkgroupsPerDimension}), x > uniforms.coordXOffset / ${t});
	}
`}var td=class{constructor(e,t){this.scene=e;let n=e.gpu;this.gpu=n;let i=n.device;this.capacity=t,this.uniformsBuf=n.createDynamicBuffer(Sv,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM),this.indirectBuffer=n.createDynamicBuffer(3,GPUBufferUsage.COPY_DST|GPUBufferUsage.INDIRECT|GPUBufferUsage.STORAGE),this.indirectBuffer.write(0,new Uint32Array([0,1,1])),this.indexsBuf2=new Array(2).fill("").map(()=>n.createDynamicBuffer(Ar,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC));let s=i.createShaderModule({code:DF(t,n)});this.nextIndexsBuf=n.createDynamicBuffer(1,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),this.filter1Pipeline=n.createComputePipeline(s,"filter1"),this.filter1EndPipeline=n.createComputePipeline(s,"filter1End"),this.filter2Pipeline=n.createComputePipeline(s,"filter2"),this.filter2EndPipeline=n.createComputePipeline(s,"filter2End"),this.calWorkgroupCountXPipeline=n.createComputePipeline(s,"calWorkgroupCountX"),this.filter1Layout=this.filter1Pipeline.getBindGroupLayout(0),this.filter1EndLayout=this.filter1EndPipeline.getBindGroupLayout(0),this.filter2Layout=this.filter2Pipeline.getBindGroupLayout(0),this.filter2EndLayout=this.filter2EndPipeline.getBindGroupLayout(0),this.calWorkgroupCountXBindGroup=n.createBindGroup(this.calWorkgroupCountXPipeline.getBindGroupLayout(0),0,this.uniformsBuf,5,this.indirectBuffer)}createFilterRenderBindGroups(e,t,n){let i=this.indexsBuf2;return{filter1BindGroup2:i.map((s,o)=>this.createFilter1BindGroup(t,i[(o+1)%2])),filter1EndBindGroup2:i.map((s,o)=>this.createFilter1EndBindGroup(t,i[(o+1)%2])),filter2BindGroup2:i.map((s,o)=>this.createFilter2BindGroup(t,s,i[(o+1)%2])),filter2EndBindGroup2:i.map((s,o)=>this.createFilter2EndBindGroup(t,s,i[(o+1)%2])),filterPtBindGroup2:i.map((s,o)=>this.scene.filterPtProgram.createDynamicBindGroup(e,s,n)),renderBindGroup:this.scene.renderPtProgram.createDynamicBindGroup(e,n)}}createFilter1BindGroup(e,t){return this.gpu.createBindGroup(this.filter1Layout,0,this.uniformsBuf,1,this.nextIndexsBuf,2,e,4,t,6,this.scene.cameraBuf)}createFilter1EndBindGroup(e,t){return this.gpu.createBindGroup(this.filter1EndLayout,0,this.uniformsBuf,1,this.nextIndexsBuf,2,e,4,t,6,this.scene.cameraBuf)}createFilter2BindGroup(e,t,n){return this.gpu.createBindGroup(this.filter2Layout,0,this.uniformsBuf,1,this.nextIndexsBuf,2,e,3,t,4,n,6,this.scene.cameraBuf)}createFilter2EndBindGroup(e,t,n){return this.gpu.createBindGroup(this.filter2EndLayout,0,this.uniformsBuf,1,this.nextIndexsBuf,2,e,3,t,4,n,6,this.scene.cameraBuf)}calWorkgroupCountX(e){this.gpu.runComputePass(e,this.calWorkgroupCountXPipeline,this.calWorkgroupCountXBindGroup,1)}filter(e,t,n,i,s){let o=new Uint32Array(Sv),a=new Float32Array(o.buffer);o[0]=e.startNodeIndex,a[1]=t,a[2]=n,o[3]=e.nodeNum,this.scene.addData(o,this.uniformsBuf);let l=this.gpu.limits.maxComputeWorkgroupsPerDimension,u=this.scene.commandEncoder;for(let c=0;c<i;c++)if(c===0)this.nextIndexsBuf.clear(u),c===i-1?this.gpu.runComputePass(u,this.filter1EndPipeline,s.filter1EndBindGroup2[c%2],e.nodeNum):this.gpu.runComputePass(u,this.filter1Pipeline,s.filter1BindGroup2[c%2],e.nodeNum);else{this.gpu.copyBufferToBuffer(this.nextIndexsBuf,0,this.uniformsBuf,3,1,u),this.nextIndexsBuf.clear(u);let h=Math.ceil(e.nodeNum*this.capacity**c/this.gpu.limits.maxComputeWorkgroupSizeX);for(let f=0;f<h;f+=l)this.gpu.copyBufferToBuffer(this.gpu.coordXOffsetBuf,f/l,this.uniformsBuf,4,1,u),this.calWorkgroupCountX(u),c===i-1?this.gpu.runComputePassIndirect(u,this.filter2EndPipeline,s.filter2EndBindGroup2[c%2],this.indirectBuffer):this.gpu.runComputePassIndirect(u,this.filter2Pipeline,s.filter2BindGroup2[c%2],this.indirectBuffer)}return this.nextIndexsBuf}};var Gbe=4096,rd=class{constructor(){this.group=new ze(2,!0);this.groupHighLight=new ze(3,!0);this.cameraSet=new Set;this.needRenderAll=!0}getCameraSet(){return this.cameraSet}addCamera(e){this.cameraSet.add(e)}delCamera(e){this.cameraSet.delete(e),this.needRenderAll=!0}};var Ci=class{constructor(e,t,n,i,s){this.gpu=e,this.buffer=e.createBuffer(t,n,i,s)}get usage(){return this.buffer.usage}getSize(){return this.buffer.size/ct}getBuffer(){return this.buffer}read(e=0,t=this.getSize()){return this.gpu.readBuffer(this,e,t)}destroy(){this.gpu.bufferSize-=this.getSize(),this.buffer.destroy(),delete this.buffer}};var Fs=class extends Ci{constructor(t,n,i,s){super(t,n,i,!1,s);this.listeners=new Set}setSize(t){t!==this.getSize()&&this.setBuffer(this.gpu.createBuffer(t,this.buffer.usage,!1,this.buffer.label))}extSize(t){if(t<=this.getSize())return;let n=this.gpu.createDynamicBuffer(t,this.buffer.usage,this.buffer.label);this.gpu.copyBufferToBuffer(this,0,n,0,this.getSize()),this.setBuffer(n.buffer)}trim(t){if(this.getSize()===t)return;if(this.getSize()<t)throw new Error("this.getSize() < size32");let n=this.gpu.createDynamicBuffer(t,this.buffer.usage,this.buffer.label);this.gpu.copyBufferToBuffer(this,0,n,0,t),this.setBuffer(n.buffer)}setBuffer(t){this.gpu.bufferSize-=this.getSize(),this.buffer.destroy(),this.buffer=t,this.listeners.forEach(n=>n(this.buffer))}molt(t){let n=this.gpu.createDynamicBuffer(0,this.buffer.usage,this.buffer.label);return n.setBuffer(this.buffer),this.buffer=this.gpu.createBuffer(t,this.buffer.usage,!1,this.buffer.label),this.listeners.forEach(i=>i(this.buffer)),n}setDynamicBuffer(t){this.setBuffer(t.buffer),delete t.buffer}clear(t,n=0,i=this.getSize()-n){t.clearBuffer(this.buffer,n*ct,i*ct)}addListener(t){this.listeners.add(t)}delListener(t){this.listeners.delete(t)}write(t,n,i=0,s){this.gpu.writeBuffer(this,t,n,i,s)}};var Vn=class{constructor(e,t,n,i,s){this.listeners=new Set;this.gpu=e,this.format=i,this.usage=s,this._texture=e.device.createTexture({size:[t,n],format:i,usage:s}),this._view=this._texture.createView()}get texture(){return this._texture}get view(){return this._view}get width(){return this._texture.width}get height(){return this._texture.height}updateSize(e,t){e===this.width&&t===this.height||(this._texture.destroy(),this._texture=this.gpu.device.createTexture({size:[e,t],format:this.format,usage:this.usage}),this._view=this._texture.createView(),this.listeners.forEach(n=>n(this._view)))}extSize(e,t,n,i){let s=this.gpu.device.createTexture({size:[this.width+e+n,this.height+t+i],format:this.format,usage:this.usage});this.gpu.run(o=>o.copyTextureToTexture({texture:this._texture},{texture:s,origin:{x:e,y:t}},this._texture)),this._texture.destroy(),this._texture=s,this._view=this._texture.createView(),this.listeners.forEach(o=>o(this._view))}addListener(e){this.listeners.add(e)}delListener(e){this.listeners.delete(e)}destroy(){this._texture.destroy(),delete this._texture}};var nd=class{constructor(e,t,...n){this.bufferListeners=[];this.gpu=e,this.layout=t,this.entries=[];for(let i=1;i<n.length;i+=2){let s=n[i-1],o=n[i];if(o instanceof Ci){let a={buffer:o.getBuffer()};if(this.entries.push({binding:s,resource:a}),o instanceof Fs){let l=u=>{if(u.size===0)throw new Error("buffer.size === 0");a.buffer=u,this.updateBindGroup()};o.addListener(l),this.bufferListeners.push([o,l])}}else if(o instanceof Vn){let a=this.entries.push({binding:s,resource:o.view})-1,l=u=>{this.entries[a].resource=u,this.updateBindGroup()};o.addListener(l),this.bufferListeners.push([o,l])}else this.entries.push({binding:s,resource:o})}this.updateBindGroup()}updateBindGroup(){this.bindGroup=this.gpu.device.createBindGroup({layout:this.layout,entries:this.entries})}getBindGroup(){return this.bindGroup}destroy(){this.bufferListeners.forEach(([e,t])=>e.delListener(t)),delete this.bindGroup}};var id=class extends Ci{constructor(e,t,n,i){super(e,t.length,n,!0,i),new Uint32Array(this.buffer.getMappedRange()).set(t),this.buffer.unmap()}};var Wa=class{constructor(e){this.presentationFormat=navigator.gpu.getPreferredCanvasFormat();this.tempBufIndex={};this.bufferSize=0;this.device=e,this.coordXOffsetBuf=this.createStaticBuffer(new Uint32Array(1024).map((t,n)=>n*e.limits.maxComputeWorkgroupsPerDimension*e.limits.maxComputeWorkgroupSizeX),GPUBufferUsage.COPY_SRC),this.numBuf=this.createStaticBuffer(new Uint32Array(1024).map((t,n)=>n),GPUBufferUsage.COPY_SRC),e.features.has("texture-compression-bc")?this.textureCompression="bc":e.features.has("texture-compression-etc2")?this.textureCompression="etc2":e.features.has("texture-compression-astc")&&(this.textureCompression="astc")}static async build(){let e=await bv();return new Wa(e)}get limits(){return this.device.limits}get features(){return this.device.features}getTempBuf(e){return e=2**Math.ceil(Math.log2(e)),this.tempBufIndex[e]||(this.tempBufIndex[e]=this.createDynamicBuffer(e,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)),this.tempBufIndex[e]}createBuffer(e,t,n,i){return this.bufferSize+=e,this.device.createBuffer({size:e*ct,usage:t,mappedAtCreation:n,label:i})}createDynamicBuffer(e,t,n){return new Fs(this,e,t,n)}createStaticBuffer(e,t,n){return new id(this,e,t,n)}createComputePipeline(e,t,n="auto",i,s){return this.device.createComputePipeline({layout:n,compute:{module:e,entryPoint:t,constants:i},label:s})}submit(...e){this.device.queue.submit(e.map(t=>t.finish()))}copyBufferToBuffer(e,t,n,i,s,o){if(t+s>e.getSize()||i+s>n.getSize())throw new Error("sourceOffset32 + size32 > source.getSize() || destinationOffset32 + size32 > destination.getSize()");if(o)o.copyBufferToBuffer(e.getBuffer(),t*ct,n.getBuffer(),i*ct,s*ct);else{let a=this.device.createCommandEncoder();a.copyBufferToBuffer(e.getBuffer(),t*ct,n.getBuffer(),i*ct,s*ct),this.submit(a)}}writeBuffer(e,t,n,i=0,s){if(s===void 0&&(s=Math.min(e.getSize()-t,n.byteLength/ct-i)),t+s>e.getSize()||(i+s)*ct>n.byteLength)throw new Error("bufferOffset32 + size32 > buffer.getSize() || (dataOffset32 + size32) * BYTES32 > data.byteLength");this.device.queue.writeBuffer(e.getBuffer(),t*ct,n instanceof ArrayBuffer?n:n.buffer,i*ct,s*ct)}runComputePass(e,t,n,i,s=o=>{if(o!==0)throw new Error("i !== 0")}){let{maxComputeWorkgroupsPerDimension:o,maxComputeWorkgroupSizeX:a}=this.limits,l=Math.ceil(i/a);for(let u=0;u<l;u+=o){s(u/o);let c=e.beginComputePass();c.setPipeline(t),c.setBindGroup(0,n),c.dispatchWorkgroups(Math.min(l-u,o)),c.end()}}run(e){let t=this.device.createCommandEncoder();e(t),this.submit(t)}runComputePassIndirect(e,t,n,i,s=0){let o=e.beginComputePass();o.setPipeline(t),o.setBindGroup(0,n),o.dispatchWorkgroupsIndirect(i.getBuffer(),s),o.end()}createBindGroup(e,...t){let n=[];for(let i=1;i<t.length;i+=2){let s=t[i];n.push({binding:t[i-1],resource:s instanceof Ci?{buffer:s.getBuffer()}:s})}return this.device.createBindGroup({layout:e,entries:n})}createDynamicBindGroup(e,...t){return new nd(this,e,...t)}clearColorView(e,t,n=t,i=t,s=1){let o=this.device.createCommandEncoder();o.beginRenderPass({colorAttachments:[{view:e,clearValue:{r:t,g:n,b:i,a:s},loadOp:"clear",storeOp:"store"}]}).end(),this.submit(o)}clearDepthView(e,t=0){let n=this.device.createCommandEncoder();n.beginRenderPass({colorAttachments:[],depthStencilAttachment:{view:e,depthClearValue:t,depthLoadOp:"clear",depthStoreOp:"store"}}).end(),this.submit(n)}async readBuffer(e,t=0,n=e.getSize()){let i=this.createDynamicBuffer(n-t,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);this.copyBufferToBuffer(e,t,i,0,n-t),await i.getBuffer().mapAsync(GPUMapMode.READ);let s=i.getBuffer().getMappedRange().slice(0);return i.getBuffer().unmap(),i.destroy(),s}};var Iv=42;function $a(r="output.position"){return`
	output.Position = camera.mvpMatrix * uniforms.matrix * vec4(${r}, 0, 1);
	output.Position.z = order / ${2**23} * output.Position.w;
	if(uniforms.renderMode == 1){
		let matrix = camera.mvMatrix * uniforms.matrix;
		output.normal = mat3x3(vec3(matrix[0].xyz), vec3(matrix[1].xyz), vec3(matrix[2].xyz)) * vec3<f32>(0, 0, 1);
		let pos = matrix * vec4(${r}, 0, 1);
		output.surfaceToEye = vec3(0, 0, length(camera.pos)) - pos.xyz / pos.w;
	}`}var ja=`
	if(uniforms.renderMode == 0 || uniforms.renderMode == 2){
		if(colorIndex > 0.5){
			return colors[u32(colorIndex + 0.5)];
		}
		return uniforms.color;
	}

	const ambientLightColor = vec3(0.1, 0.1, 0.1);
	const directLightColor = vec3<f32>(1, 1, 1);
	const directLightDir0 = vec3<f32>(0, 0, 1);

	var ambientFactor: vec3<f32>;
	var diffuseFactor: vec3<f32>;
	var specularFactor: vec3<f32>;
	if(colorIndex < 0.5) {
		ambientFactor = uniforms.ambientFactor;
		diffuseFactor = uniforms.diffuseFactor;
		specularFactor = uniforms.specularFactor;
	} else {
		ambientFactor = colors[u32(colorIndex + 0.5)].rgb;
		diffuseFactor = ambientFactor;
		specularFactor = ambientFactor;
	}

	var ambient = ambientFactor * ambientLightColor;

	var normal0 = normalize(normal);
	var directLightDir = normalize(directLightDir0);
	var diffuse = abs(dot(normal0 , directLightDir)) * diffuseFactor * directLightColor;

	var reflect = -2.0 * normal0 * dot(directLightDir, normal0) + directLightDir;
	var surfaceToEye0 = normalize(surfaceToEye);
	var lightToEyeFactor = abs(dot(reflect, surfaceToEye0));
	var specular = specularFactor * directLightColor * pow(lightToEyeFactor, 300.0) * uniforms.shininess * 0.1;

	return vec4(ambient + diffuse + specular, uniforms.alpha);
`,GF=`
	struct Uniforms {
        matrix: mat4x4<f32>,

		// 16
		color: vec4<f32>,			// \u9876\u70B9\u989C\u8272

		// 20
        ambientFactor: vec3<f32>,	// \u73AF\u5883\u5149\u56E0\u5B50

		// 24
        diffuseFactor: vec3<f32>,	// \u6F2B\u53CD\u5C04\u56E0\u5B50

		// 28
        specularFactor: vec3<f32>,	// \u955C\u9762\u53CD\u5C04\u56E0\u5B50
        shininess: f32,				// \u6750\u6599\u5149\u6CFD\u5EA6

		// 32
        alpha: f32,					// \u6750\u6599alpha\u503C
		pxLength: f32,				// \u5355\u4F4D\u50CF\u7D20\u957F\u5EA6
		renderMode: u32,			// \u6E32\u67D3\u6A21\u5F0F(\u6750\u8D28:1|\u7EBF\u6846:2|others:0)
		isNormal: u32,				// ?

		// 36
		circleOffset: u32,			// 
		lineOffset: u32,			// 
		arcOffset: u32,				// 
		triangleOffset: u32,		// 

		// 40
		rectOffset: u32,			//
		cutedCircleOffset: u32,		//
    }

	${nn}

	@binding(0) @group(0) var<uniform> camera: Camera;
	@binding(1) @group(0) var<uniform> uniforms: Uniforms;
    @binding(2) @group(0) var<storage, read> indexsR: array<i32>;
	@binding(3) @group(0) var<storage, read> pts: array<f32>;
	@binding(4) @group(0) var<storage, read> colors: array<vec4<f32>>;

    struct CircleOutput {
        @builtin(position) Position: vec4<f32>,
        @location(0) position: vec2<f32>,
        @location(1) r: f32,
		@location(2) normal: vec3<f32>,
		@location(3) surfaceToEye: vec3<f32>,
		@location(4) colorIndex: f32,
    }
	
    @vertex
    fn circleVert(
        @builtin(vertex_index) vIndex: u32,
        @builtin(instance_index) iIndex: u32,
    ) -> CircleOutput {
		let startIndex = indexsR[iIndex + uniforms.circleOffset];
        var output: CircleOutput;
		let head = u32(pts[startIndex]);
		let center = vec2(pts[startIndex + 1], pts[startIndex + 2]);
        output.r = max(pts[startIndex + 3], uniforms.pxLength / 2);
		var index = startIndex + 4;
		var order: f32;
		if((head & ${Ct}) != 0){
			order = pts[index];
			index++;
		}
		if((head & ${Mt}) != 0){
			output.colorIndex = pts[index];
		}
        var sq = sqrt(3.0);
		if(vIndex == 0){
            output.position = center + vec2(-output.r * sq, -output.r);
        }else if(vIndex == 1){
            output.position = center + vec2(output.r * sq, -output.r);
        }else{
            output.position = center + vec2(0, 2 * output.r);
		}
		${$a()}
		output.position -= center;
        return output;
    }

    @fragment
    fn circleFrag(
        @builtin(position) Position : vec4<f32>,
        @location(0) position: vec2<f32>,
        @location(1) r: f32,
		@location(2) normal: vec3<f32>,
		@location(3) surfaceToEye: vec3<f32>,
		@location(4) colorIndex: f32,
    ) -> @location(0) vec4<f32> {
        if((uniforms.isNormal != 0 && Position.z <= camera.borderZ) || length(position) > r){
            discard;
        }
		if(uniforms.renderMode == 2 && length(position) < r - uniforms.pxLength){
			discard;
		}
		${ja}
    }

    struct LineOutput {
        @builtin(position) Position: vec4<f32>,
        @location(0) position: vec2<f32>,
        @location(1) start: vec2<f32>,
        @location(2) end: vec2<f32>,
        @location(3) halfWidth: f32,
		@location(4) normal: vec3<f32>,
		@location(5) surfaceToEye: vec3<f32>,
		@location(6) colorIndex: f32,
    }

    @vertex
    fn lineVert(
        @builtin(vertex_index) vIndex: u32,
        @builtin(instance_index) iIndex: u32,
    ) -> LineOutput {
		let startIndex = indexsR[iIndex + uniforms.lineOffset];
        var output: LineOutput;
		let head = u32(pts[startIndex]);
		output.start = vec2(pts[startIndex + 1], pts[startIndex + 2]);
		output.end = vec2(pts[startIndex + 3], pts[startIndex + 4]);
		output.halfWidth = max(pts[startIndex + 5], uniforms.pxLength) / 2;
		var index = startIndex + 6;
		var order: f32;
		if((head & ${Ct}) != 0){
			order = pts[index];
			index++;
		}
		if((head & ${Mt}) != 0){
			output.colorIndex = pts[index];
		}
		var direct: vec2<f32>;
        if(all(output.start == output.end)){
            direct = vec2(1, 0);
        }else{
            direct = normalize(output.end - output.start);
        }
        let vertical = vec2(-direct.y, direct.x);
        let h_offset = vertical * output.halfWidth; // \u7528\u4E8E\u8BA1\u7B97\u5782\u76F4\u65B9\u5411\u843D\u70B9
        let v_offset = direct * output.halfWidth; // \u7528\u4E8E\u8BA1\u7B97\u6A2A\u5411\u6269\u5C55
        if(vIndex == 0 || vIndex == 5){
            output.position = output.start - h_offset - v_offset;
        }else if(vIndex == 1){
            output.position = output.end - h_offset + v_offset;
        }else if(vIndex == 2 || vIndex == 3){
            output.position = output.end + h_offset + v_offset;
        }else if(vIndex == 4){
            output.position = output.start + h_offset - v_offset;
        }
		${$a()}
        return output;
    }

    @fragment
    fn lineFrag(
        @builtin(position) Position : vec4<f32>,
        @location(0) position: vec2<f32>,
        @location(1) start: vec2<f32>,
        @location(2) end: vec2<f32>,
        @location(3) halfWidth: f32,
		@location(4) normal: vec3<f32>,
		@location(5) surfaceToEye: vec3<f32>,
		@location(6) colorIndex: f32,
    ) -> @location(0) vec4<f32> {
		if(uniforms.isNormal != 0 && Position.z <= camera.borderZ){
			discard;
		}
        var direct = end - start;
        let len = length(direct);
        if(len == 0){
            direct = vec2(1, 0);
        }else{
            direct = normalize(direct);
        }
		let dir = position - start;
		let l = dot(dir, direct);
		if(l < 0.0){
			let dis = length(dir);
			if(dis > halfWidth){
				discard;
			}
			if(uniforms.renderMode == 2 && dis < halfWidth - uniforms.pxLength){
				discard;
			}
		}else if(l > len){
			let dis = length(position - end);
			if(length(position - end) > halfWidth){
				discard;
			}
			if(uniforms.renderMode == 2 && dis < halfWidth - uniforms.pxLength){
				discard;
			}
		} else if (uniforms.renderMode == 2 && abs(dot(vec2(-direct.y, direct.x), dir)) < halfWidth - uniforms.pxLength){
			discard;
		}

		${ja}
    }

    struct ArcOutput {
        @builtin(position) Position: vec4<f32>,
        @location(0) R: f32,
        @location(1) r: f32,
        @location(2) center: vec2<f32>,
        @location(3) startAngle: f32,
        @location(4) endAngle: f32,
        @location(5) position: vec2<f32>,
		@location(6) normal: vec3<f32>,
		@location(7) surfaceToEye: vec3<f32>,
		@location(8) colorIndex: f32,
    }

    @vertex
    fn arcVert(
        @builtin(vertex_index) vIndex: u32,
        @builtin(instance_index) iIndex: u32,
    ) -> ArcOutput {
		let startIndex = indexsR[iIndex + uniforms.arcOffset];
        var output: ArcOutput;
		let head = u32(pts[startIndex]);
		output.center = vec2(pts[startIndex + 1], pts[startIndex + 2]);
		let r = pts[startIndex + 3];
		let width = max(pts[startIndex + 4], uniforms.pxLength);
		output.startAngle = pts[startIndex + 5];
		let angle = pts[startIndex + 6];
		var index = startIndex + 7;
		var order: f32;
		if((head & ${Ct}) != 0){
			order = pts[index];
			index++;
		}
		if((head & ${Mt}) != 0){
			output.colorIndex = pts[index];
		}
		output.endAngle = output.startAngle + angle;
		output.R = r + width / 2;
		output.r = r - width / 2;

        output.position = output.center;
        var radius = output.R;
        if(angle < ${Math.PI}){
            let startPointR = output.center + vec2(cos(output.startAngle), sin(output.startAngle)) * output.r;
            let endPointR = output.center + vec2(cos(output.endAngle), sin(output.endAngle)) * output.r;
            output.position = (startPointR + endPointR) / 2.0;
            radius = length(startPointR - endPointR) / 2.0 + width;
        }

        if(vIndex == 0){
            output.position.x += radius * (-sqrt(3.0));
            output.position.y += radius * (-1.0);
        }else if(vIndex == 1){
            output.position.x += radius * (sqrt(3.0));
            output.position.y += radius * (-1.0);
        }else{
            output.position.y += radius * (2.0);
        }
		${$a()}
        return output;
    }

    @fragment
    fn arcFrag(
        @builtin(position) Position : vec4<f32>,
        @location(0) R: f32,
        @location(1) r: f32,
        @location(2) center: vec2<f32>,
        @location(3) startAngle: f32,
        @location(4) endAngle: f32,
        @location(5) position: vec2<f32>,
		@location(6) normal: vec3<f32>,
		@location(7) surfaceToEye: vec3<f32>,
		@location(8) colorIndex: f32,
    ) -> @location(0) vec4<f32> {
		if(uniforms.isNormal != 0 && Position.z <= camera.borderZ){
			discard;
		}
        let d = length(position - center);
        if(d > R || d < r){
            discard;
        }

        let direct = position - center;
        let startDir = vec2(cos(startAngle), sin(startAngle));
        let startZ = startDir.x * direct.y - startDir.y * direct.x;
        let endDir = vec2(cos(endAngle), sin(endAngle));
        let endZ = endDir.x * direct.y - endDir.y * direct.x;

        let angle = endAngle - startAngle;
        if((angle < ${Math.PI} && (startZ < 0.0 || endZ > 0.0)) || (angle >= ${Math.PI} && (startZ < 0.0 && endZ > 0.0))){
            let pointRadius = (R - r) / 2.0;
            let radius = (R + r) / 2.0;
            let startCenter = center + startDir * radius;
            let startDis = length(position - startCenter);
            let endCenter = center + endDir * radius;
            let endDis = length(position - endCenter);
            if(startDis > pointRadius && endDis > pointRadius){
                discard;
            }
			if(uniforms.renderMode == 2 && (startDis < pointRadius - uniforms.pxLength || endDis < pointRadius - uniforms.pxLength)){
                discard;
            } 
        } else if(uniforms.renderMode == 2 && d < R - uniforms.pxLength && d > r + uniforms.pxLength){
            discard;
        }
		${ja}
    }

	struct TriangleOutput {
        @builtin(position) Position: vec4<f32>,
		@location(1) normal: vec3<f32>,
		@location(2) surfaceToEye: vec3<f32>,
		@location(3) colorIndex: f32,
		@location(4) p1: vec2<f32>,
		@location(5) p2: vec2<f32>,
		@location(6) p3: vec2<f32>,
		@location(7) position: vec2<f32>,
    }

    @vertex
    fn triangleVert(
        @builtin(vertex_index) vIndex: u32,
        @builtin(instance_index) iIndex: u32,
    ) -> TriangleOutput {
		let startIndex = indexsR[iIndex + uniforms.triangleOffset];
		let head = u32(pts[startIndex]);
		var output: TriangleOutput;
		var p1: vec2<f32> = vec2(pts[startIndex + 1], pts[startIndex + 2]);
		var p2: vec2<f32> = vec2(pts[startIndex + 3], pts[startIndex + 4]);
		var p3: vec2<f32> = vec2(pts[startIndex + 5], pts[startIndex + 6]);
		var position: vec2<f32>;
        if(vIndex == 0){
			position = p1;
        }else if(vIndex == 1){
			position = p2;
        }else{
			position = p3;
        }
		var index = startIndex + 7;
		var order: f32;
		if((head & ${Ct}) != 0){
			order = pts[index];
			index++;
		}
		if((head & ${Mt}) != 0){
			output.colorIndex = pts[index];
		}

		output.p1 = p1;
		output.p2 = p2;
		output.p3 = p3;
		output.position = position;
		${$a("position")}
		return output;
    }

	@fragment
    fn triangleFrag(
        @builtin(position) Position : vec4<f32>,
		@location(1) normal: vec3<f32>,
		@location(2) surfaceToEye: vec3<f32>,
		@location(3) colorIndex: f32,
		@location(4) p1: vec2<f32>,
		@location(5) p2: vec2<f32>,
		@location(6) p3: vec2<f32>,
		@location(7) position: vec2<f32>,
    ) -> @location(0) vec4<f32> {
		if(uniforms.isNormal != 0 && Position.z <= camera.borderZ){
            discard;
        }

		// [todo]
		// if(uniforms.renderMode == 2){
		// 	// \u6269\u5C55\u5BBD\u5EA6
		// 	let ext = -uniforms.pxLength;

		// 	// \u4E09\u89D2\u5F62\u5185\u5FC3
		// 	let l_1 = length(p2 - p3);
		// 	let l_2 = length(p1 - p3);
		// 	let l_3 = length(p1 - p2);
		// 	let d = l_1 + l_2 + l_3;
		// 	let x = l_1 * p1.x + l_2 * p2.x + l_3 * p3.x;
		// 	let y = l_1 * p1.y + l_2 * p2.y + l_3 * p3.y;
		// 	let center = vec2(x / d, y / d);

		// 	// \u7F29\u653E\u6BD4\u4F8B
		// 	let center_p1_p2 = (p1 + p2 - center) / 2;
		// 	let len_old = length(center_p1_p2);
		// 	let new_center_p1_p2 = normalize(center_p1_p2) * (len_old + ext);
		// 	let radio = length(new_center_p1_p2) / len_old;
			
		// 	// \u65B0\u5750\u6807
		// 	let v1 = p1 - center;
		// 	let v2 = p2 - center;
		// 	let v3 = p3 - center;
		// 	let new_p1 = v1 * radio + center;
		// 	let new_p2 = v2 * radio + center;
		// 	let new_p3 = v3 * radio + center;

		// 	// \u5224\u65AD\u70B9\u662F\u5426\u5728\u4E09\u89D2\u5F62\u5185
		// 	let n0 = new_p3 - new_p1;
		// 	let n1 = new_p2 - new_p1;
		// 	let n2 = position - new_p1;
		// 	let dot00 = dot(n0, n0);
		// 	let dot01 = dot(n0, n1);
		// 	let dot02 = dot(n0, n2);
		// 	let dot11 = dot(n1, n1);
		// 	let dot12 = dot(n1, n2);

		// 	let inverDeno = 1 / (dot00 * dot11 - dot01 * dot01) ;
		// 	let u = (dot11 * dot02 - dot01 * dot12) * inverDeno ;
		// 	if(u < 0 || u > 1) {
		// 		// if u out of range
		// 		// pass
		// 	} else {
		// 		let v = (dot00 * dot12 - dot01 * dot02) * inverDeno ;
		// 		if(v < 0 || v > 1) {
		// 			// pass
		// 		} else if(u + v < 1.0) {
		// 			discard;
		// 		}
		// 	}
			
		// }
		${ja}
    }

    struct RectOutput {
        @builtin(position) Position: vec4<f32>,
        @location(0) position: vec2<f32>,
        @location(1) start: vec2<f32>,
        @location(2) end: vec2<f32>,
        @location(3) halfWidth: f32,
        @location(4) radius: f32,
		@location(5) normal: vec3<f32>,
		@location(6) surfaceToEye: vec3<f32>,
		@location(7) colorIndex: f32,
    }

    @vertex
    fn rectVert(
        @builtin(vertex_index) vIndex: u32,
        @builtin(instance_index) iIndex: u32,
    ) -> RectOutput {
		let startIndex = indexsR[iIndex + uniforms.rectOffset];
        var output: RectOutput;
		let head = u32(pts[startIndex]);
		let luPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]);
		let width = pts[startIndex + 3];
		let height = pts[startIndex + 4];
		let angle = radians(pts[startIndex + 5]);
		output.radius = pts[startIndex + 7];
		var index = startIndex + 8;
		var order: f32;
		if((head & ${Ct}) != 0){
			order = pts[index];
			index++;
		}
		if((head & ${Mt}) != 0){
			output.colorIndex = pts[index];
		}

		output.halfWidth = max(height, uniforms.pxLength) / 2;

		let cos0 = cos(angle);
		let sin0 = sin(angle);
		let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0);
		output.start = luPoint + mat0 * vec2(0, -output.halfWidth);
		output.end = luPoint + mat0 * vec2(width, -output.halfWidth);

		let direct = normalize(output.end - output.start);
        let vertical = vec2(-direct.y, direct.x);
        let h_offset = vec2(vertical * output.halfWidth); // \u7528\u4E8E\u8BA1\u7B97\u5782\u76F4\u65B9\u5411\u843D\u70B9
        if(vIndex == 0 || vIndex == 5){
            output.position = output.start - h_offset;
        }else if(vIndex == 1){
            output.position = output.end - h_offset;
        }else if(vIndex == 2 || vIndex == 3){
            output.position = output.end + h_offset;
        }else if(vIndex == 4){
            output.position = output.start + h_offset;
        }
		${$a()}
        return output;
    }

    @fragment
    fn rectFrag(
        @builtin(position) Position : vec4<f32>,
        @location(0) position: vec2<f32>,
        @location(1) start: vec2<f32>,
        @location(2) end: vec2<f32>,
        @location(3) halfWidth: f32,
        @location(4) radius: f32,
		@location(5) normal: vec3<f32>,
		@location(6) surfaceToEye: vec3<f32>,
		@location(7) colorIndex: f32,
    ) -> @location(0) vec4<f32> {
		if(uniforms.isNormal != 0 && Position.z <= camera.borderZ){
			discard;
		}
        var direct = end - start;
        let len = length(direct);
        if(len == 0){
            direct = vec2(1, 0);
        }else{
            direct = normalize(direct);
        }
		
		// [todo]
		// if(uniforms.renderMode == 2){
		// 	// discard;
		// }

		let center = (start + end) * 0.5;
		let crood = start - center;
		let x = abs(dot(direct,crood));
		let y = abs(crood.x * direct.y - crood.y * direct.x);
		let xEdge = len * 0.5 - radius;
		let yEdge = halfWidth - radius;
		if(x > xEdge && y > yEdge){
			let deltaX = x - xEdge;
			let deltaY = y - yEdge;
			let dis = length(vec2(deltaX,deltaY));
			if(dis > radius){
				discard;
			}
		}
		${ja}
    }

    struct CutedCircleOutput {
        @builtin(position) Position: vec4<f32>,
        @location(0) r: f32,
        @location(1) center: vec2<f32>,
        @location(2) startAngle: f32,
        @location(3) endAngle: f32,
        @location(4) position: vec2<f32>,
		@location(5) normal: vec3<f32>,
		@location(6) surfaceToEye: vec3<f32>,
		@location(7) colorIndex: f32,
    }

    @vertex
    fn cutedCircleVert(
        @builtin(vertex_index) vIndex: u32,
        @builtin(instance_index) iIndex: u32,
    ) -> CutedCircleOutput {
		let startIndex = indexsR[iIndex + uniforms.cutedCircleOffset];
        var output: CutedCircleOutput;
		let head = u32(pts[startIndex]);
		output.center = vec2(pts[startIndex + 1], pts[startIndex + 2]);
		output.r = pts[startIndex + 3];
		output.startAngle = pts[startIndex + 4];
		let angle = pts[startIndex + 5];
		var index = startIndex + 6;
		var order: f32;
		if((head & ${Ct}) != 0){
			order = pts[index];
			index++;
		}
		if((head & ${Mt}) != 0){
			output.colorIndex = pts[index];
		}
		output.endAngle = output.startAngle + angle;

        output.position = output.center;
        var radius = output.r;
        if(abs(angle) < ${Math.PI}){
            let startPointR = output.center + vec2(cos(output.startAngle), sin(output.startAngle)) * output.r;
            let endPointR = output.center + vec2(cos(output.endAngle), sin(output.endAngle)) * output.r;
            output.position = (startPointR + endPointR) / 2.0;
            radius = length(startPointR - endPointR) / 2.0;
        }

		if(angle > 0){
			if(vIndex == 0){
				output.position.x += radius * (-sqrt(3.0));
				output.position.y += radius * (-1.0);
			}else if(vIndex == 1){
				output.position.x += radius * (sqrt(3.0));
				output.position.y += radius * (-1.0);
			}else{
				output.position.y += radius * (2.0);
			}
		} else {
			if(vIndex == 0){
				output.position.x += radius * (sqrt(3.0));
				output.position.y += radius * (-1.0);
			}else if(vIndex == 1){
				output.position.x += radius * (-sqrt(3.0));
				output.position.y += radius * (-1.0);
			}else{
				output.position.y += radius * (2.0);
			}
		}
		${$a()}
        return output;
    }

    @fragment
    fn cutedCircleFrag(
        @builtin(position) Position : vec4<f32>,
        @location(0) r: f32,
        @location(1) center: vec2<f32>,
        @location(2) startAngle: f32,
        @location(3) endAngle: f32,
        @location(4) position: vec2<f32>,
		@location(5) normal: vec3<f32>,
		@location(6) surfaceToEye: vec3<f32>,
		@location(7) colorIndex: f32,
    ) -> @location(0) vec4<f32> {
		if((uniforms.isNormal != 0 && Position.z <= camera.borderZ) || length(position - center) > r){
            discard;
        }

		let start = center + vec2(cos(startAngle), sin(startAngle)) * r;
		let end = center + vec2(cos(endAngle), sin(endAngle)) * r;
		let a = end.y - start.y;
		let b = start.x - end.x;
		let c = -a * start.x - b * start.y;

		let midAngle = (startAngle + endAngle) / 2;
		let mid = center + vec2(cos(midAngle), sin(midAngle)) * r;
		if(abs(endAngle - startAngle) < ${Math.PI*2-1e-4} && (a * mid.x + b * mid.y + c) * (a * position.x + b * position.y + c) < 0){
			discard;
		}
		${ja}
    }
`,sd=class{constructor(e){this.afterDraw={render:(e,t,n,i,s)=>{if(e.isColorful){{this.gpu.copyBufferToBuffer(n,i+3,this.indirectBuffer,1,1,this.scene.commandEncoder);let o=this.scene.commandEncoder.beginRenderPass(this.desc);o.setStencilReference(64),o.setPipeline(this.trianglePipeline),o.setBindGroup(0,t),o.drawIndirect(this.indirectBuffer.getBuffer(),0),o.end()}{this.gpu.copyBufferToBuffer(n,i+5,this.indirectBuffer,1,1,this.scene.commandEncoder);let o=this.scene.commandEncoder.beginRenderPass(this.desc);o.setStencilReference(64),o.setPipeline(this.cutedCirclePipeline),o.setBindGroup(0,t),o.drawIndirect(this.indirectBuffer.getBuffer(),0),o.end()}}else{let o=s.getBBox2();this.scene.addData(new Uint32Array(1),this.uniformsBuf,39),this.scene.addData(new Uint32Array(new Float32Array(_r.create(0,o.LL(),o.UL(),o.LR()).concat(_r.create(0,o.UR(),o.UL(),o.LR()))).buffer),this.bboxPtsBuf);let a=this.scene.commandEncoder.beginRenderPass(this.desc);a.setStencilReference(64),a.setPipeline(this.trianglePipeline),a.setBindGroup(0,this.bboxBindGroup.getBindGroup()),a.draw(3,2),a.end()}},drawPassStencil:()=>this.scene.drawStencilProgram.draw(!1,64,63),drawNotPassStencil:()=>this.scene.drawStencilProgram.draw(!1,128,63)};this.scene=e;let t=e.gpu;this.gpu=t;let n=t.device;this.uniformsBuf=t.createDynamicBuffer(Iv,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM),this.indirectBuffer=t.createDynamicBuffer(8,GPUBufferUsage.COPY_DST|GPUBufferUsage.INDIRECT|GPUBufferUsage.STORAGE),this.indirectBuffer.write(0,new Uint32Array([3,0,0,0,6,0,0,0])),this.desc={colorAttachments:[{view:e.planeProgram.colorTexture.view,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:e.planeProgram.depthStencilTexture.view,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"}},e.planeProgram.colorTexture.addListener(a=>this.desc.colorAttachments[0].view=a),e.planeProgram.depthStencilTexture.addListener(a=>this.desc.depthStencilAttachment.view=a),this.layout=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:3,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:4,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]});let i=n.createShaderModule({code:GF}),s=n.createPipelineLayout({bindGroupLayouts:[this.layout]}),o=(a,l,u,c)=>["circle","line","arc","triangle","rect","cutedCircle"].map(h=>h==="triangle"||h==="cutedCircle"?n.createRenderPipeline({layout:s,vertex:{module:i,entryPoint:`${h}Vert`},fragment:{module:i,entryPoint:`${h}Frag`,targets:[{format:e.planeProgram.colorTexture.format,writeMask:0}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.planeProgram.depthStencilTexture.format,depthWriteEnabled:!1,stencilReadMask:c,stencilFront:{compare:"not-equal",passOp:"increment-wrap"},stencilBack:{compare:"not-equal",passOp:"decrement-wrap"}}}):n.createRenderPipeline({layout:s,vertex:{module:i,entryPoint:`${h}Vert`},fragment:{module:i,entryPoint:`${h}Frag`,targets:[{format:e.planeProgram.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}},writeMask:a?15:0}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.planeProgram.depthStencilTexture.format,depthWriteEnabled:a,depthCompare:"less",stencilReadMask:l,stencilFront:u,stencilBack:u}}));this.renderPipelines=o(!0,255,{compare:"equal"},127),this.drawNotPassStencilPipelines=o(!1,127,{compare:"not-equal",passOp:"replace"},127),this.drawPassStencilPipelines=o(!1,255,{compare:"always",passOp:"replace"},255),this.drawInterStencilPipelines=o(!1,255,{compare:"equal",passOp:"increment-wrap"},127),this.bboxPtsBuf=t.createDynamicBuffer(_r.length*2,GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE),this.bboxBindGroup=this.createDynamicBindGroup(this.bboxPtsBuf,t.createStaticBuffer(new Uint32Array([0,_r.length]),GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE)),this.trianglePipeline=n.createRenderPipeline({layout:s,vertex:{module:i,entryPoint:"triangleVert"},fragment:{module:i,entryPoint:"triangleFrag",targets:[{format:e.planeProgram.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.planeProgram.depthStencilTexture.format,depthWriteEnabled:!0,stencilReadMask:63,stencilFront:{compare:"not-equal",passOp:"replace"},stencilBack:{compare:"not-equal",passOp:"replace"}}}),this.cutedCirclePipeline=n.createRenderPipeline({layout:s,vertex:{module:i,entryPoint:"cutedCircleVert"},fragment:{module:i,entryPoint:"cutedCircleFrag",targets:[{format:e.planeProgram.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.planeProgram.depthStencilTexture.format,depthWriteEnabled:!0,stencilReadMask:63,stencilFront:{compare:"not-equal",passOp:"replace"},stencilBack:{compare:"not-equal",passOp:"replace"}}})}createBindGroup(e,t){return this.gpu.createBindGroup(this.layout,0,this.scene.cameraBuf,1,this.uniformsBuf,2,t,3,e,4,this.scene.colorsBuf)}createDynamicBindGroup(e,t){return this.gpu.createDynamicBindGroup(this.layout,0,this.scene.cameraBuf,1,this.uniformsBuf,2,t,3,e,4,this.scene.colorsBuf)}draw0(e,t,n,i,s,o){let a=t===1||t===4?4:0;this.gpu.copyBufferToBuffer(n,i+t,this.indirectBuffer,a+1,1,this.scene.commandEncoder);let l=this.scene.commandEncoder.beginRenderPass(this.desc);l.setPipeline(s[t]),l.setBindGroup(0,e),l.setStencilReference(o),l.drawIndirect(this.indirectBuffer.getBuffer(),a*ct),l.end()}render(e,t,n,i){t===3||t===5?this.draw0(e,t,n,i,this.renderPipelines,0):this.draw0(e,t,n,i,this.renderPipelines,64)}drawPassStencil(e,t,n,i){this.draw0(e,t,n,i,this.drawPassStencilPipelines,64)}drawNotPassStencil(e,t,n,i){t===3||t===5?this.draw0(e,t,n,i,this.drawNotPassStencilPipelines,0):this.draw0(e,t,n,i,this.drawNotPassStencilPipelines,128)}drawInterStencil(e,t,n,i){this.draw0(e,t,n,i,this.drawInterStencilPipelines,t===3||t===5?0:64)}draw(e,t,n,i,s,o,a,l,u,c,h="render"){let f=new Uint32Array(Iv),d=new Float32Array(f.buffer);d.set(e.data),n.getColor()&&d.set(n.getColor().getData(),16),n.getMaterial()&&(d.set(n.getMaterial().ambient.getData(),20),d.set(n.getMaterial().diffuse.getData(),24),d.set(n.getMaterial().specular.getData(),28),d[31]=n.getMaterial().shininess,d[32]=n.getMaterial().alpha),d[33]=c.getPxLength(t,e),f[34]=i===1?1:i===4?2:0,f[35]=c.isNormal()?1:0,f.set(s.slice(u,u+6),36),this.scene.addData(f,this.uniformsBuf),h==="drawInterStencil"?(o.forEach((m,p)=>{m&&(p===3||p===5)&&this[h](a,p,l,u)}),o.forEach((m,p)=>{m&&(p===3||p===5||this[h](a,p,l,u))})):(o.forEach((m,p)=>{m&&(p===3||p===5||this[h](a,p,l,u))}),o.forEach((m,p)=>{m&&(p===3||p===5)&&this[h](a,p,l,u)}),this.afterDraw[h](n,a,l,u,c))}};var Bv=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n)}return r}}("struct Uniforms { coordXOffset: u32, texWidth: u32, offsetX: u32, offsetY: u32, width: u32, height: u32, } @binding(0) @group(0) var<uniform> uniforms: Uniforms; @binding(1) @group(0) var depthTexture: texture_depth_2d; @binding(2) @group(0) var<storage, read_write> buf_out: array<u32>; @compute @workgroup_size($MAX_COMPUTE_WORKGROUP_SIZE_X) fn extract( @builtin(global_invocation_id) coord: vec3<u32>, ) { let coordX = coord.x + uniforms.coordXOffset; let y = coordX * 32 / uniforms.width; if(y >= uniforms.height) { return; } var x = coordX * 32 - y * uniforms.width; var num: u32 = 0; for(var i: u32 = 0; i < 32; i++){ if(textureLoad(depthTexture, vec2<i32>(i32(x + i), i32(y)), 0) != 0){ num |= (0x80000000u >> i); } } buf_out[((y + uniforms.offsetY) * uniforms.texWidth + x + uniforms.offsetX) / 32] = num; }");var Av=6,od=class{constructor(e){this.scene=e;let t=e.gpu;this.gpu=t;let n=t.device;this.uniformsBuf=t.createDynamicBuffer(Av,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);let i=n.createShaderModule({code:Bv({MAX_COMPUTE_WORKGROUP_SIZE_X:t.limits.maxComputeWorkgroupSizeX})});this.pipeline=t.createComputePipeline(i,"extract"),this.layout=this.pipeline.getBindGroupLayout(0)}extract(e,t,n,i,s,o,a){let l=new Uint32Array(Av);l[1]=n,l[2]=i,l[3]=s,l[4]=o,l[5]=a,this.scene.addData(l,this.uniformsBuf),this.gpu.runComputePass(this.scene.commandEncoder,this.pipeline,this.gpu.createBindGroup(this.layout,0,this.uniformsBuf,1,e,2,t),o*a/32,u=>this.scene.gpu.copyBufferToBuffer(this.scene.gpu.coordXOffsetBuf,u,this.uniformsBuf,0,1,this.scene.commandEncoder))}};var Tv=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n)}return r}}("struct Uniforms { matrix: mat4x4<f32>, color: vec4<f32>, ambientFactor: vec3<f32>, diffuseFactor: vec3<f32>, specularFactor: vec3<f32>, shininess: f32, alpha: f32, renderMode: u32, pxLength: f32, } struct Tex { originX: f32, originY: f32, width: u32, height: u32, pxLength: f32, } $CAMERA_STRUCT_WGSL @binding(0) @group(0) var<uniform> uniforms: Uniforms; @binding(1) @group(0) var<uniform> tex: Tex; @binding(2) @group(0) var<uniform> camera: Camera; @binding(3) @group(0) var<storage, read> bufR: array<u32>; struct Output { @builtin(position) Position: vec4<f32>, @location(1) normal: vec3<f32>, @location(2) surfaceToEye: vec3<f32>, } @vertex fn vert( @builtin(vertex_index) vIndex: u32, ) -> Output { let width = max(f32(tex.width) * tex.pxLength, uniforms.pxLength); let height = max(f32(tex.height) * tex.pxLength, uniforms.pxLength); var pos: vec4<f32>; if(vIndex == 0 || vIndex == 5){ pos = vec4(tex.originX, tex.originY - height, 0, 1); } else if(vIndex == 1){ pos = vec4(tex.originX, tex.originY, 0, 1); } else if(vIndex == 2 || vIndex == 3){ pos = vec4(tex.originX + width, tex.originY, 0, 1); } else { pos = vec4(tex.originX + width, tex.originY - height, 0, 1); } var output: Output; output.Position = camera.mvpMatrix * uniforms.matrix * pos; if(uniforms.renderMode == 1){ let matrix = camera.mvMatrix * uniforms.matrix; output.normal = mat3x3(vec3(matrix[0].xyz), vec3(matrix[1].xyz), vec3(matrix[2].xyz)) * vec3<f32>(0, 0, 1); pos = uniforms.matrix * pos; output.surfaceToEye = vec3(0, 0, length(camera.pos)) - pos.xyz / pos.w; } return output; } fn calColor(normal: vec3<f32>, surfaceToEye: vec3<f32>) -> vec4<f32> { if(uniforms.renderMode == 0 || uniforms.renderMode == 2){ return uniforms.color; }else{ const ambientLightColor = vec3(0.1, 0.1, 0.1); const directLightColor = vec3<f32>(1, 1, 1); const directLightDir0 = vec3<f32>(0, 0, 1); var ambient = uniforms.ambientFactor * ambientLightColor; var normal0 = normalize(normal); var directLightDir = normalize(directLightDir0); var diffuse = abs(dot(normal0 , directLightDir)) * uniforms.diffuseFactor * directLightColor; var reflect = -2.0 * normal0 * dot(directLightDir, normal0) + directLightDir; var surfaceToEye0 = normalize(surfaceToEye); var lightToEyeFactor = abs(dot(reflect, surfaceToEye0)); var specular = uniforms.specularFactor * directLightColor * pow(lightToEyeFactor, 300.0) * uniforms.shininess * 0.1; return vec4(ambient + diffuse + specular, uniforms.alpha); } } @fragment fn frag( @builtin(position) Position : vec4<f32>, @location(1) normal: vec3<f32>, @location(2) surfaceToEye: vec3<f32>, ) -> @location(0) vec4<f32> { if(Position.z > camera.borderZ){ discard; } let x = floor(Position.x); let y = floor(Position.y); var p0: vec2<f32>; var p1: vec2<f32>; var p2: vec2<f32>; var p3: vec2<f32>; let z = (uniforms.matrix * vec4<f32>(0, 0, 0, 1)).z; if(camera.isOrth == 0){ var vec = (camera.invMatrix * vec4<f32>(x, y, 0, 1)).xyz - camera.pos; p0 = camera.pos.xy + vec.xy * (z - camera.pos.z) / vec.z; vec = (camera.invMatrix * vec4<f32>(x, y + 1, 0, 1)).xyz - camera.pos; p1 = camera.pos.xy + vec.xy * (z - camera.pos.z) / vec.z; vec = (camera.invMatrix * vec4<f32>(x + 1, y, 0, 1)).xyz - camera.pos; p2 = camera.pos.xy + vec.xy * (z - camera.pos.z) / vec.z; vec = (camera.invMatrix * vec4<f32>(x + 1, y + 1, 0, 1)).xyz - camera.pos; p3 = camera.pos.xy + vec.xy * (z - camera.pos.z) / vec.z; }else { var startPos = (camera.invMatrix * vec4<f32>(x, y, 0, 1)).xyz; p0 = startPos.xy + camera.vec.xy * (z - startPos.z) / camera.vec.z; startPos = (camera.invMatrix * vec4<f32>(x, y + 1, 0, 1)).xyz; p1 = startPos.xy + camera.vec.xy * (z - startPos.z) / camera.vec.z; startPos = (camera.invMatrix * vec4<f32>(x + 1, y, 0, 1)).xyz; p2 = startPos.xy + camera.vec.xy * (z - startPos.z) / camera.vec.z; startPos = (camera.invMatrix * vec4<f32>(x + 1, y + 1, 0, 1)).xyz; p3 = startPos.xy + camera.vec.xy * (z - startPos.z) / camera.vec.z; } p0 = vec2(p0.x - tex.originX, tex.originY - p0.y) / tex.pxLength; p1 = vec2(p1.x - tex.originX, tex.originY - p1.y) / tex.pxLength; p2 = vec2(p2.x - tex.originX, tex.originY - p2.y) / tex.pxLength; p3 = vec2(p3.x - tex.originX, tex.originY - p3.y) / tex.pxLength; let minX = max(round(min(min(p0.x, p1.x), min(p2.x, p3.x))), 0); let maxX = min(round(max(max(p0.x, p1.x), max(p2.x, p3.x))), f32(tex.width) - 1); let minY = max(round(min(min(p0.y, p1.y), min(p2.y, p3.y))), 0); let maxY = min(round(max(max(p0.y, p1.y), max(p2.y, p3.y))), f32(tex.height) - 1); if(maxX < 0 || minX >= f32(tex.width) || minX > maxX || maxY < 0 || minY >= f32(tex.height) || minY > maxY){ discard; } var minXU = u32(minX); var maxXU = u32(maxX); let minYU = u32(minY); let maxYU = u32(maxY); if((minXU & 0x1f) != 0){ let mask = select( 0xffffffffu >> (minXU & 0x1f), (0xffffffffu >> (minXU & 0x1f)) & (0xffffffffu << (31 - (maxXU & 0x1f))), (minXU >> 5) == (maxXU >> 5) ); for(var y = minYU; y <= maxYU; y++){ if((bufR[(y * tex.width + minXU) >> 5] & mask) != 0){ return calColor(normal, surfaceToEye); } } minXU = ((minXU >> 5) + 1) << 5; } let endXU = (maxXU + 1) & 0xffffffe0u; for(; minXU < endXU; minXU += 32){ for(var y = minYU; y <= maxYU; y++){ if(bufR[(y * tex.width + minXU) >> 5] != 0){ return calColor(normal, surfaceToEye); } } } if(minXU <= maxXU){ let mask = 0xffffffffu << (31 - (maxXU & 0x1f)); for(var y = minYU; y <= maxYU; y++){ if((bufR[(y * tex.width + minXU) >> 5] & mask) != 0){ return calColor(normal, surfaceToEye); } } } discard; }");var Cv=35,Mv=5,ad=class{constructor(e){this.scene=e;let t=e.gpu;this.gpu=t;let n=t.device;this.uniformsBuf=t.createDynamicBuffer(Cv,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM),this.texBuf=t.createDynamicBuffer(Mv,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM),this.layout=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}},{binding:2,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}},{binding:3,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]});let i=n.createPipelineLayout({bindGroupLayouts:[this.layout]}),s=n.createShaderModule({code:Tv({CAMERA_STRUCT_WGSL:nn})}),o=(a,l,u)=>n.createRenderPipeline({layout:i,vertex:{module:s,entryPoint:"vert"},fragment:{module:s,entryPoint:"frag",targets:[{format:e.planeProgram.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}},writeMask:a?15:0}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.planeProgram.depthStencilTexture.format,depthWriteEnabled:a,stencilReadMask:l,stencilFront:u,stencilBack:u}});this.renderPipeline=o(!0,255,{compare:"equal"}),this.drawNotPassStencilPipeline=o(!1,127,{compare:"not-equal",passOp:"replace"}),this.drawPassStencilPipeline=o(!1,255,{compare:"always",passOp:"replace"}),this.drawInterStencilPipeline=o(!1,255,{compare:"equal",passOp:"increment-wrap"}),this.desc={colorAttachments:[{view:e.planeProgram.colorTexture.view,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:e.planeProgram.depthStencilTexture.view,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"}},e.planeProgram.colorTexture.addListener(a=>this.desc.colorAttachments[0].view=a),e.planeProgram.depthStencilTexture.addListener(a=>this.desc.depthStencilAttachment.view=a)}createDynamicBindGroup(e){return this.gpu.createDynamicBindGroup(this.layout,0,this.uniformsBuf,1,this.texBuf,2,this.scene.cameraBuf,3,e)}draw0(e,t,n){let i=this.scene.commandEncoder.beginRenderPass(this.desc);i.setPipeline(t),i.setBindGroup(0,e),i.setStencilReference(n),i.draw(6,1,0,0),i.end()}render(e){this.draw0(e,this.renderPipeline,64)}drawPassStencil(e){this.draw0(e,this.drawPassStencilPipeline,64)}drawNotPassStencil(e){this.draw0(e,this.drawNotPassStencilPipeline,128)}drawInterStencil(e){this.draw0(e,this.drawInterStencilPipeline,64)}draw(e,t,n,i,s,o,a,l,u,c,h,f){if(o%32!==0)throw new Error("texWidth % 32 !== 0");if(t.isOrthCamera()){if(t.getScale()>c)return}else{let d=i.getBBox2(),m=e.multiply4(t.getRenderMatrix()),p=new me(d.minX,d.minY,0).multiply4(m).z,g=new me(d.minX,d.maxY,0).multiply4(m).z,b=new me(d.maxX,d.minY,0).multiply4(m).z,v=new me(d.maxX,d.maxY,0).multiply4(m).z,w=t.getBorderZ(c);if((p>w||p<=0)&&(g>w||g<=0)&&(b>w||b<=0)&&(v>w||v<=0))return}{let d=new Uint32Array(Cv),m=new Float32Array(d.buffer);m.set(e.data),n.getColor()&&m.set(n.getColor().getData(),16),n.getMaterial()&&(m.set(n.getMaterial().ambient.getData(),20),m.set(n.getMaterial().diffuse.getData(),24),m.set(n.getMaterial().specular.getData(),28),m[31]=n.getMaterial().shininess,m[32]=n.getMaterial().alpha),d[33]=s===1?1:s===4?2:0,m[34]=t.getPxLength(),this.scene.addData(d,this.uniformsBuf)}{let d=new Uint32Array(Mv),m=new Float32Array(d.buffer);m[0]=u.minX,m[1]=u.maxY,d[2]=o,d[3]=a,m[4]=l,this.scene.addData(d,this.texBuf)}this[f](h)}};var Nv=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n)}return r}}("struct BBox { minX: f32, maxX: f32, minY: f32, maxY: f32, } struct Uniforms { coordXOffset: u32, ptNum: u32, planeStep: u32, isNormal: u32, } struct Plane { color: vec4<f32>, z: f32, visible: f32, order: f32, } $CAMERA_STRUCT_WGSL @binding(0) @group(0) var<uniform> uniforms: Uniforms; @binding(1) @group(0) var<storage, read> pts: array<f32>; @binding(2) @group(0) var<storage, read_write> indexs: array<i32>; @binding(3) @group(0) var<storage, read_write> nextIndexsA: array<atomic<u32>>; @binding(3) @group(0) var<storage, read> nextIndexs: array<u32>; @binding(4) @group(0) var<storage, read> inIndexs: array<i32>; @binding(5) @group(0) var<storage, read> filterPtIndexs: array<u32>; @binding(6) @group(0) var<storage, read> matrixs: array<mat4x4<f32>>; @binding(9) @group(0) var<uniform> camera: Camera; @binding(7) @group(0) var<storage, read_write> workgroupCount: vec3<u32>; fn selectU(a: u32, b: u32, condition: bool) -> u32 { return select(a, b, condition); } @compute @workgroup_size(1) fn calWorkgroupCountX() { let x = uniforms.ptNum / $MAX_COMPUTE_WORKGROUP_SIZE_X + selectU(1, 0, uniforms.ptNum % $MAX_COMPUTE_WORKGROUP_SIZE_X == 0); workgroupCount.x = select(0, min(x - uniforms.coordXOffset / $MAX_COMPUTE_WORKGROUP_SIZE_X, $MAX_COMPUTE_WORKGROUP_PER_DIMENSION), x > uniforms.coordXOffset / $MAX_COMPUTE_WORKGROUP_SIZE_X); } @compute @workgroup_size($MAX_COMPUTE_WORKGROUP_SIZE_X) fn filterPt( @builtin(global_invocation_id) coord: vec3<u32>, ) { if(coord.x + uniforms.coordXOffset >= uniforms.ptNum){ return; } let startIndex = inIndexs[coord.x + uniforms.coordXOffset]; if(startIndex < 0){ return; } let head = u32(pts[startIndex]); let type0 = (head & $PT_TYPE_MASK) >> $PT_TYPE_SHIFT; let planeId = head & $PLANE_ID_MASK; let start = filterPtIndexs[planeId]; let end = filterPtIndexs[planeId + 1]; if(start >= end){ return; } var bbox: BBox; if (type0 == $PT_TYPE_CIRCLE) { bbox.minX = pts[startIndex + 1] - pts[startIndex + 3]; bbox.maxX = pts[startIndex + 1] + pts[startIndex + 3]; bbox.minY = pts[startIndex + 2] - pts[startIndex + 3]; bbox.maxY = pts[startIndex + 2] + pts[startIndex + 3]; } else if (type0 == $PT_TYPE_LINE) { bbox.minX = min(pts[startIndex + 1], pts[startIndex + 3]) - pts[startIndex + 5] / 2.0; bbox.maxX = max(pts[startIndex + 1], pts[startIndex + 3]) + pts[startIndex + 5] / 2.0; bbox.minY = min(pts[startIndex + 2], pts[startIndex + 4]) - pts[startIndex + 5] / 2.0; bbox.maxY = max(pts[startIndex + 2], pts[startIndex + 4]) + pts[startIndex + 5] / 2.0; } else if (type0 == $PT_TYPE_ARC) { let centerX = pts[startIndex + 1]; let centerY = pts[startIndex + 2]; let radius = pts[startIndex + 3]; let width2 = pts[startIndex + 4] / 2; let startAngle = pts[startIndex + 5]; let endAngle = startAngle + pts[startIndex + 6]; var x = cos(startAngle); var y = sin(startAngle); bbox.minX = x; bbox.maxX = x; bbox.minY = y; bbox.maxY = y; x = cos(endAngle); y = sin(endAngle); bbox.minX = min(bbox.minX, x); bbox.maxX = max(bbox.maxX, x); bbox.minY = min(bbox.minY, y); bbox.maxY = max(bbox.maxY, y); for (var angle = ceil(startAngle / 1.5707963267948966) * 1.5707963267948966; angle < endAngle; angle += 1.5707963267948966) { x = cos(angle); y = sin(angle); bbox.minX = min(bbox.minX, x); bbox.maxX = max(bbox.maxX, x); bbox.minY = min(bbox.minY, y); bbox.maxY = max(bbox.maxY, y); } bbox.minX = bbox.minX * radius - width2 + centerX; bbox.maxX = bbox.maxX * radius + width2 + centerX; bbox.minY = bbox.minY * radius - width2 + centerY; bbox.maxY = bbox.maxY * radius + width2 + centerY; } else if (type0 == $PT_TYPE_TRIANGLE) { bbox.minX = min(min(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]); bbox.maxX = max(max(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]); bbox.minY = min(min(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]); bbox.maxY = max(max(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]); } else if (type0 == $PT_TYPE_RECT) { let leftUpPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]); let width = pts[startIndex + 3]; let height = pts[startIndex + 4]; let angle = radians(pts[startIndex + 5]); let radius = pts[startIndex + 7]; let cos0 = cos(angle); let sin0 = sin(angle); let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0); let luPoint = leftUpPoint + mat0 * vec2(radius, -radius); let ldPoint = leftUpPoint + mat0 * vec2(radius, radius - height); let ruPoint = leftUpPoint + mat0 * vec2(width - radius, -radius); let rdPoint = leftUpPoint + mat0 * vec2(width - radius, radius - height); bbox.minX = min(min(luPoint.x, ldPoint.x), min(ruPoint.x, rdPoint.x)) - radius; bbox.maxX = max(max(luPoint.x, ldPoint.x), max(ruPoint.x, rdPoint.x)) + radius; bbox.minY = min(min(luPoint.y, ldPoint.y), min(ruPoint.y, rdPoint.y)) - radius; bbox.maxY = max(max(luPoint.y, ldPoint.y), max(ruPoint.y, rdPoint.y)) + radius; } else if (type0 == $PT_TYPE_CUTED_CIRCLE) { let centerX = pts[startIndex + 1]; let centerY = pts[startIndex + 2]; let radius = pts[startIndex + 3]; let startAngle = pts[startIndex + 4]; let endAngle = startAngle + pts[startIndex + 5]; var x = cos(startAngle); var y = sin(startAngle); bbox.minX = x; bbox.maxX = x; bbox.minY = y; bbox.maxY = y; x = cos(endAngle); y = sin(endAngle); bbox.minX = min(bbox.minX, x); bbox.maxX = max(bbox.maxX, x); bbox.minY = min(bbox.minY, y); bbox.maxY = max(bbox.maxY, y); if(startAngle < endAngle) { for (var angle = ceil(startAngle / 1.5707963267948966) * 1.5707963267948966; angle < endAngle; angle += 1.5707963267948966) { x = cos(angle); y = sin(angle); bbox.minX = min(bbox.minX, x); bbox.maxX = max(bbox.maxX, x); bbox.minY = min(bbox.minY, y); bbox.maxY = max(bbox.maxY, y); } } else { for (var angle = floor(startAngle / 1.5707963267948966) * 1.5707963267948966; angle > endAngle; angle -= 1.5707963267948966) { x = cos(angle); y = sin(angle); bbox.minX = min(bbox.minX, x); bbox.maxX = max(bbox.maxX, x); bbox.minY = min(bbox.minY, y); bbox.maxY = max(bbox.maxY, y); } } bbox.minX = bbox.minX * radius + centerX; bbox.maxX = bbox.maxX * radius + centerX; bbox.minY = bbox.minY * radius + centerY; bbox.maxY = bbox.maxY * radius + centerY; } for(var i = start; i < end; i++){ let matrix = matrixs[i]; var p0 = camera.mvpMatrix * matrix * vec4(bbox.minX, bbox.minY, 0, 1); var p1 = camera.mvpMatrix * matrix * vec4(bbox.minX, bbox.maxY, 0, 1); var p2 = camera.mvpMatrix * matrix * vec4(bbox.maxX, bbox.minY, 0, 1); var p3 = camera.mvpMatrix * matrix * vec4(bbox.maxX, bbox.maxY, 0, 1); p0.x /= p0.w; p0.y /= p0.w; p0.z /= p0.w; p1.x /= p1.w; p1.y /= p1.w; p1.z /= p1.w; p2.x /= p2.w; p2.y /= p2.w; p2.z /= p2.w; p3.x /= p3.w; p3.y /= p3.w; p3.z /= p3.w; if(min(min(p0.x, p1.x), min(p2.x, p3.x)) >= 1 || max(max(p0.x, p1.x), max(p2.x, p3.x)) <= -1 || min(min(p0.y, p1.y), min(p2.y, p3.y)) >= 1 || max(max(p0.y, p1.y), max(p2.y, p3.y)) <= -1 || select( ((p0.z <= 0 || p0.z > 1) && (p1.z <= 0 || p1.z > 1) && (p2.z <= 0 || p2.z > 1) && (p3.z <= 0 || p3.z > 1)) || (uniforms.isNormal != 0 && ((p0.z <= camera.borderZ && p0.z > 0) && (p1.z <= camera.borderZ && p1.z > 0) && (p2.z <= camera.borderZ && p2.z > 0) && (p3.z <= camera.borderZ && p3.z > 0)) ), min(min(p0.z, p1.z), min(p2.z, p3.z)) >= 1 || max(max(p0.z, p1.z), max(p2.z, p3.z)) <= 0, camera.isOrth != 0 ) ) { continue; } indexs[atomicAdd(&nextIndexsA[uniforms.planeStep * i * $PT_TYPE_NUM + type0], 1)] = startIndex; } } @binding(8) @group(0) var<storage, read_write> nextIndexs1: array<u32>; @compute @workgroup_size($MAX_COMPUTE_WORKGROUP_SIZE_X) fn subNextIndexs( @builtin(global_invocation_id) coord: vec3<u32>, ) { nextIndexs1[coord.x] = nextIndexs[coord.x] - nextIndexs1[coord.x]; }");var Rv=4;function FF(r){return Nv({MAX_COMPUTE_WORKGROUP_SIZE_X:r.limits.maxComputeWorkgroupSizeX,MAX_COMPUTE_WORKGROUP_PER_DIMENSION:r.limits.maxComputeWorkgroupsPerDimension,PT_TYPE_CIRCLE:0,PT_TYPE_LINE:1,PT_TYPE_ARC:2,PT_TYPE_TRIANGLE:3,PT_TYPE_RECT:4,PT_TYPE_CUTED_CIRCLE:5,PT_TYPE_NUM:6,PI:Math.PI,CAMERA_STRUCT_WGSL:nn,PT_TYPE_MASK:ar,PT_TYPE_SHIFT:ft,PLANE_ID_MASK:Co})}var ld=class{constructor(e){this.scene=e;let t=e.gpu;this.gpu=t;let n=t.device;this.uniformsBuf=t.createDynamicBuffer(Rv,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM),this.matrixsBuf=t.createDynamicBuffer(as*16,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),this.filterPtIndexsBuf=t.createDynamicBuffer(as+1,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),this.indirectBuffer=t.createDynamicBuffer(3,GPUBufferUsage.COPY_DST|GPUBufferUsage.INDIRECT|GPUBufferUsage.STORAGE),this.indirectBuffer.write(0,new Uint32Array([0,1,1])),this.nextIndexsBuf2=new Array(2).fill("").map(s=>t.createDynamicBuffer(6*as,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC|GPUBufferUsage.INDIRECT));let i=n.createShaderModule({code:FF(t)});this.filterPtPipeline=t.createComputePipeline(i,"filterPt"),this.calWorkgroupCountXPipeline=t.createComputePipeline(i,"calWorkgroupCountX"),this.subNextIndexsPipeline=t.createComputePipeline(i,"subNextIndexs"),this.filterPtLayout=this.filterPtPipeline.getBindGroupLayout(0),this.calWorkgroupCountXBindGroup=t.createBindGroup(this.calWorkgroupCountXPipeline.getBindGroupLayout(0),0,this.uniformsBuf,7,this.indirectBuffer),this.subNextIndexsBindGroup=t.createBindGroup(this.subNextIndexsPipeline.getBindGroupLayout(0),3,this.nextIndexsBuf2[0],8,this.nextIndexsBuf2[1])}createBindGroup(e,t,n){return this.gpu.createBindGroup(this.filterPtLayout,0,this.uniformsBuf,1,e,2,n,3,this.nextIndexsBuf2[0],4,t,5,this.filterPtIndexsBuf,6,this.matrixsBuf,9,this.scene.cameraBuf)}createDynamicBindGroup(e,t,n){return this.gpu.createDynamicBindGroup(this.filterPtLayout,0,this.uniformsBuf,1,e,2,n,3,this.nextIndexsBuf2[0],4,t,5,this.filterPtIndexsBuf,6,this.matrixsBuf,9,this.scene.cameraBuf)}filter(e,t,n,i,s,o,a,l,u){var b;let c=new Uint32Array(o.length+1),h=new Float32Array(o.reduce((v,w)=>v+w.length,0)*16),f=0;for(let v=1;v<o.length;v++)(b=o[v])==null||b.forEach(w=>h.set(w.data,f++*16)),c[v+1]=f;this.scene.addData(c,this.filterPtIndexsBuf),this.scene.addData(new Uint32Array(h.buffer),this.matrixsBuf),this.scene.addData(a,this.nextIndexsBuf2[1]);let d=new Uint32Array(Rv);d[2]=t,d[3]=u?1:0;let m=this.scene.commandEncoder;e instanceof Fs?(this.scene.addData(d,this.uniformsBuf),this.gpu.copyBufferToBuffer(e,0,this.uniformsBuf,1,1,m)):(d[1]=e,this.scene.addData(d,this.uniformsBuf)),this.filterPtIndexsBuf.clear(m,c.length),this.gpu.copyBufferToBuffer(this.nextIndexsBuf2[1],0,this.nextIndexsBuf2[0],0,n,m);let p=Math.ceil(i/this.gpu.limits.maxComputeWorkgroupSizeX),g=this.gpu.limits.maxComputeWorkgroupsPerDimension;for(let v=0;v<p;v+=g)this.gpu.copyBufferToBuffer(this.gpu.coordXOffsetBuf,v/g,this.uniformsBuf,0,1,m),this.gpu.runComputePass(m,this.calWorkgroupCountXPipeline,this.calWorkgroupCountXBindGroup,1),this.gpu.runComputePassIndirect(m,this.filterPtPipeline,s,this.indirectBuffer);this.gpu.runComputePass(m,this.subNextIndexsPipeline,this.subNextIndexsBindGroup,n),this.gpu.copyBufferToBuffer(this.nextIndexsBuf2[1],0,l,0,n,m)}};var Lv=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n)}return r}}("@vertex fn fullVert(@builtin(vertex_index) vIndex : u32) -> @builtin(position) vec4<f32> { var pos = array<vec2<f32>, 6>( vec2<f32>( 1.0, 1.0), vec2<f32>( 1.0, -1.0), vec2<f32>(-1.0, -1.0), vec2<f32>( 1.0, 1.0), vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 1.0) ); return vec4<f32>(pos[vIndex], 0.5, 1.0); }");var ud=class{constructor(e){this.equalPipelineIndex={};this.notEqualPipelineIndex={};this.scene=e;let t=e.gpu;this.gpu=t,this.desc={colorAttachments:[],depthStencilAttachment:{view:this.scene.planeProgram.depthStencilTexture.view,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"}},this.scene.planeProgram.depthStencilTexture.addListener(n=>this.desc.depthStencilAttachment.view=n),this.module=this.gpu.device.createShaderModule({code:Lv({})})}getPipeline(e,t){let n=t?this.equalPipelineIndex:this.notEqualPipelineIndex;return n[e]||(n[e]=this.gpu.device.createRenderPipeline({layout:"auto",vertex:{module:this.module,entryPoint:"fullVert"},primitive:{topology:"triangle-list"},depthStencil:{format:this.scene.planeProgram.depthStencilTexture.format,depthWriteEnabled:!1,depthCompare:"always",stencilWriteMask:255,stencilReadMask:e,stencilFront:{compare:t?"equal":"not-equal",passOp:"replace"},stencilBack:{compare:t?"equal":"not-equal",passOp:"replace"}}})),n[e]}draw(e,t,n){let i=this.scene.commandEncoder.beginRenderPass(this.desc);i.setPipeline(this.getPipeline(n,e)),i.setStencilReference(t),i.draw(6),i.end()}};var cd=class{constructor(e,t=null){this.outNum=0;if(t&&e.length!==t.length)throw new Error("The length of vertexes and normals is not equal!");if(e.length===0)throw new Error("The length of vertexes can't be 0!");e instanceof Float32Array?(this.vertexes=e,this.vertexNum=e.length/3):(this.vertexes=this.createArray(e),this.vertexNum=e.length),t instanceof Float32Array?this.normals=t:t&&(this.normals=this.createArray(t))}hasNormals(){return!!this.normals}iterVertexes(e){for(let t=0;t<this.vertexes.length;t+=3)e(new me(this.vertexes[t],this.vertexes[t+1],this.vertexes[t+2]))}iterVertexesNormals(e,t){for(let n=0;n<this.vertexes.length;n+=3)e(new me(this.vertexes[n],this.vertexes[n+1],this.vertexes[n+2])),t(new me(this.normals[n],this.normals[n+1],this.normals[n+2]))}getBuffer(e){if(!this.vertexsNormalsBuffer){let t=new Float32Array(this.vertexes.length*2);for(let n=0,i=0;i<this.vertexes.length;i+=3,n+=6)t[n]=this.vertexes[i],t[n+1]=this.vertexes[i+1],t[n+2]=this.vertexes[i+2];if(this.normals)for(let n=3,i=0;i<this.normals.length;i+=3,n+=6)t[n]=this.normals[i],t[n+1]=this.normals[i+1],t[n+2]=this.normals[i+2];this.vertexsNormalsBuffer=e.createStaticBuffer(new Uint32Array(t.buffer),GPUBufferUsage.VERTEX),delete this.vertexes,delete this.normals}return this.vertexsNormalsBuffer}createArray(e){let t=new Float32Array(e.length*3),n=0;for(let i of e)t[n++]=i.x,t[n++]=i.y,t[n++]=i.z;return t}incOut(){this.outNum++}decOut(e){var t;this.outNum--,this.outNum===0&&(e?(e.deleteBuffer(this.vertexsBuffer),this.vertexsBuffer=null,e.deleteBuffer(this.normalsBuffer),this.normalsBuffer=null):((t=this.vertexsNormalsBuffer)==null||t.destroy(),this.vertexsNormalsBuffer=null))}bindVertexesBuffer(e,t){let n=e.gl;this.vertexsBuffer?n.bindBuffer(n.ARRAY_BUFFER,this.vertexsBuffer):(this.vertexsBuffer=e.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexsBuffer),n.bufferData(n.ARRAY_BUFFER,this.vertexes,n.STATIC_DRAW),delete this.vertexes),n.vertexAttribPointer(t,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,null)}bindNormalsBuffer(e,t){let n=e.gl;this.normalsBuffer?n.bindBuffer(n.ARRAY_BUFFER,this.normalsBuffer):(this.normalsBuffer=e.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.normalsBuffer),n.bufferData(n.ARRAY_BUFFER,this.normals,n.STATIC_DRAW),delete this.normals),n.vertexAttribPointer(t,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,null)}getBBox(){if(!this.bbox){let e=new zr;for(let t=0;t<this.vertexes.length;t+=3)e.ext2(this.vertexes[t],this.vertexes[t+1],this.vertexes[t+2]);this.bbox=e.build()}return this.bbox}},Ha=class extends cd{constructor(e,t=null){if(super(e,t),!Number.isInteger(this.vertexes.length/6))throw new Error("The length of vertexs is not a multiple of 2!")}},gr=class extends cd{constructor(e,t=null){if(super(e,t),!Number.isInteger(this.vertexes.length/9))throw new Error("The length of vertexs is not a multiple of 3!")}};var Ov=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n)}return r}}("$CAMERA_STRUCT_WGSL @binding(0) @group(0) var<uniform> camera : Camera; @binding(1) @group(0) var<storage, read> matrixs : array<mat4x4<f32>>; struct VertexOutput { @builtin(position) Position : vec4<f32>, @location(0) normal : vec3<f32>, @location(1) surfaceToEye: vec3<f32>, } @vertex fn vert( @builtin(instance_index) iIndex: u32, @location(0) position : vec4<f32>, @location(1) normal : vec3<f32>, ) -> VertexOutput { var output : VertexOutput; output.Position = camera.mvpMatrix * matrixs[iIndex] * position; let matrix0 = camera.mvMatrix * matrixs[iIndex]; output.normal = mat3x3(matrix0[0].xyz, matrix0[1].xyz, matrix0[2].xyz) * normal; var pos = matrix0 * position; output.surfaceToEye = vec3(0, 0, length(camera.pos)) - pos.xyz / pos.w; return output; } $COLOR_MATERIAL_STRUCT_WGSL @binding(2) @group(0) var<uniform> colorMaterial: ColorMaterial; @binding(3) @group(0) var<uniform> renderMode: u32; @fragment fn frag( @location(0) normal : vec3<f32>, @location(1) surfaceToEye: vec3<f32>, ) -> @location(0) vec4<f32> { if(renderMode == 0){ return colorMaterial.color; } const ambientLightColor = vec3(0.1, 0.1, 0.1); const directLightColor = vec3<f32>(1, 1, 1); const directLightDir0 = vec3<f32>(0, 0, 1); var ambient = colorMaterial.ambientFactor * ambientLightColor; var normal0 = normalize(normal); var directLightDir = normalize(directLightDir0); var diffuse = abs(dot(normal0 , directLightDir)) * colorMaterial.diffuseFactor * directLightColor; var reflect = -2.0 * normal0 * dot(directLightDir, normal0) + directLightDir; var surfaceToEye0 = normalize(surfaceToEye); var lightToEyeFactor = abs(dot(reflect, surfaceToEye0)); var specular = colorMaterial.specularFactor * directLightColor * pow(lightToEyeFactor, 300.0) * colorMaterial.shininess * 0.1; return vec4(ambient + diffuse + specular, colorMaterial.alpha); }");var hd=class{constructor(e){this.scene=e;let t=e.gpu;this.gpu=t;let n=t.device,i=n.createShaderModule({code:Ov({CAMERA_STRUCT_WGSL:nn,COLOR_MATERIAL_STRUCT_WGSL:hv})});this.layout=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{}},{binding:3,visibility:GPUShaderStage.FRAGMENT,buffer:{}}]});let s=o=>n.createRenderPipeline({layout:n.createPipelineLayout({bindGroupLayouts:[this.layout]}),vertex:{module:i,entryPoint:"vert",buffers:[{arrayStride:6*ct,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:3*ct,format:"float32x3"}]}]},fragment:{module:i,entryPoint:"frag",targets:[{format:e.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:o?"triangle-list":"line-list"},depthStencil:{format:e.depthTexture.format,depthWriteEnabled:!0,depthCompare:"greater"}});this.trianglePipeline=s(!0),this.linePipeline=s(!1),this.matrixBuf=t.createDynamicBuffer(4*4,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST),this.renderModeBuf=t.createDynamicBuffer(1,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),this.desc={colorAttachments:[{view:e.colorTexture.view,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:e.depthTexture.view,depthLoadOp:"load",depthStoreOp:"store"}},e.colorTexture.addListener(o=>this.desc.colorAttachments[0].view=o),e.depthTexture.addListener(o=>this.desc.depthStencilAttachment.view=o)}createDynamicBindGroup(e){return this.gpu.createDynamicBindGroup(this.layout,0,this.scene.cameraBuf,1,this.matrixBuf,2,e,3,this.renderModeBuf)}render(e,t,n,i){let s=new Float32Array(i.length*16);this.matrixBuf.getSize()<s.length&&this.matrixBuf.setSize(s.length),i.forEach((l,u)=>s.set(l.matrix.data,u*16)),this.gpu.writeBuffer(this.matrixBuf,0,s);let o=this.gpu.device.createCommandEncoder();this.gpu.copyBufferToBuffer(this.gpu.numBuf,e===1||e===4?1:0,this.renderModeBuf,0,1,o);let a=o.beginRenderPass(this.desc);a.setPipeline(t instanceof gr&&e!==4?this.trianglePipeline:this.linePipeline),a.setBindGroup(0,n.getBindGroup()),a.setVertexBuffer(0,t.getBuffer(this.gpu).getBuffer()),a.draw(t.vertexNum,i.length,0,0),a.end(),this.gpu.device.queue.submit([o.finish()])}};var kv=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n)}return r}}("struct Uniforms { matrix : mat4x4<f32>, } $Camera @group(0) @binding(0) var<uniform> uniforms : Uniforms; @group(0) @binding(1) var<uniform> camera: Camera; @group(0) @binding(2) var u_Sampler: sampler; @group(0) @binding(3) var u_Texture: texture_2d<f32>; struct VertexOutput { @builtin(position) Position : vec4<f32>, @location(0) uv : vec2<f32>, } @vertex fn v_main( @location(0) position: vec2<f32>, @location(1) uv: vec2<f32>, ) -> VertexOutput { var output : VertexOutput; output.Position = camera.mvpMatrix * uniforms.matrix * vec4(position, 0.0, 1.0); output.uv = uv; return output; } @fragment fn f_main( @location(0) uv: vec2<f32>, ) -> @location(0) vec4<f32> { return textureSample(u_Texture, u_Sampler, uv); }");var lg=4,dd=class{constructor(e){this.vertexStrideLen=4;this.scene=e;let t=e.gpu;this.gpu=t,this.device=t.device,this.pipeline=this.createPipeline(),this.renderDesc=this.createRenderDesc(),e.planeProgram.colorTexture.addListener(n=>this.renderDesc.colorAttachments[0].view=n),e.planeProgram.depthStencilTexture.addListener(n=>this.renderDesc.depthStencilAttachment.view=n),this.uniformBuffer=this.createUniformBuffer(),this.sampler=this.createSampler()}createPipeline(){let e=this.device,t=kv({Camera:nn}),n=navigator.gpu.getPreferredCanvasFormat(),i=0;return e.createRenderPipeline({layout:"auto",vertex:{module:e.createShaderModule({code:t}),entryPoint:"v_main",buffers:[{arrayStride:this.vertexStrideLen*lg,attributes:[{shaderLocation:0,offset:i,format:"float32x2"},{shaderLocation:1,offset:i+=2*lg,format:"float32x2"}]}]},fragment:{module:e.createShaderModule({code:t}),entryPoint:"f_main",targets:[{format:n,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list",cullMode:"back"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}})}createRenderDesc(){let e=this.scene;return{colorAttachments:[{view:e.planeProgram.colorTexture.view,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:e.planeProgram.depthStencilTexture.view,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store",depthClearValue:1}}}createUniformBuffer(){return this.device.createBuffer({size:16*lg,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}updateUniformBuffer(e){let t=this.uniformBuffer,n=new Float32Array(e.data);return this.device.queue.writeBuffer(t,0,n.buffer,n.byteOffset,n.byteLength),t}createSampler(){return this.device.createSampler({magFilter:"linear",minFilter:"linear"})}createUniformBindGroup(e){return this.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:this.scene.cameraBuf.getBuffer()}},{binding:2,resource:this.sampler},{binding:3,resource:e.createView()}]})}createVerticesBuffer(e){let t=this.device.createBuffer({size:e.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0});return new Float32Array(t.getMappedRange()).set(e),t.unmap(),t}createVertexArray(e){let t=[e.rdPoint.x,e.rdPoint.y,1,1,e.ldPoint.x,e.ldPoint.y,0,1,e.luPoint.x,e.luPoint.y,0,0,e.ruPoint.x,e.ruPoint.y,1,0,e.rdPoint.x,e.rdPoint.y,1,1,e.luPoint.x,e.luPoint.y,0,0];return new Float32Array(t)}render(e){let t=this.device;this.updateUniformBuffer(e.matrix);let n=t.createCommandEncoder(),i=n.beginRenderPass(this.renderDesc);i.setPipeline(this.pipeline);let s=e.texture;i.setBindGroup(0,this.createUniformBindGroup(s.gpuTexture));let o=this.createVertexArray({ldPoint:s.ldPoint,luPoint:s.luPoint,rdPoint:s.rdPoint,ruPoint:s.ruPoint});i.setVertexBuffer(0,this.createVerticesBuffer(o)),i.draw(o.length/this.vertexStrideLen,1,0,0),i.end(),t.queue.submit([n.finish()])}};var qF=`
	struct Uniforms {
        matrix: mat4x4<f32>,
        viewOffset: vec2<f32>,
    }


	@binding(0) @group(0) var<uniform> uniforms: Uniforms;
    @binding(1) @group(0) var tex_in : texture_2d<f32>;

    @vertex
    fn vert(
        @location(0) position : vec2<f32>,
    ) -> @builtin(position) vec4<f32> {
		var pos = uniforms.matrix * vec4(position, 0, 1);
        pos.x += uniforms.viewOffset.x * pos.w;
        pos.y += uniforms.viewOffset.y * pos.w;
        return pos;
    }

    @fragment
    fn frag(
        @builtin(position) coord: vec4<f32>,
    ) -> @location(0) vec4<f32> {
        let color = textureLoad(tex_in, vec2<i32>(coord.xy), 0);
        if(color.a == 0){
            discard;
        }
        return color;
    }
`,fd=class{constructor(e,t,n){this.scene=e;let i=e.gpu;this.uniformsBuf=i.createDynamicBuffer(18,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),this.positionBuf=i.createDynamicBuffer(12,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST);let{device:s}=i;this.depthStencilTexture=new Vn(i,t,n,"depth24plus-stencil8",GPUTextureUsage.RENDER_ATTACHMENT),this.colorTexture=new Vn(i,t,n,"rgba8unorm",GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_SRC);let o=s.createShaderModule({code:qF});this.pipeline=s.createRenderPipeline({layout:"auto",vertex:{module:o,entryPoint:"vert",buffers:[{arrayStride:2*ct,attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]}]},fragment:{module:o,entryPoint:"frag",targets:[{format:e.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.depthTexture.format,depthWriteEnabled:!0}}),this.bindGroup=i.createDynamicBindGroup(this.pipeline.getBindGroupLayout(0),0,this.uniformsBuf,1,this.colorTexture),this.clearDesc={colorAttachments:[{view:this.colorTexture.view,clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthStencilTexture.view,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilClearValue:64,stencilLoadOp:"clear",stencilStoreOp:"store"}},this.colorTexture.addListener(a=>this.clearDesc.colorAttachments[0].view=a),this.depthStencilTexture.addListener(a=>this.clearDesc.depthStencilAttachment.view=a),this.desc={colorAttachments:[{view:e.colorTexture.view,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:e.depthTexture.view,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"}},e.colorTexture.addListener(a=>this.desc.colorAttachments[0].view=a),e.depthTexture.addListener(a=>this.desc.depthStencilAttachment.view=a)}resize(e,t){this.depthStencilTexture.updateSize(e,t),this.colorTexture.updateSize(e,t)}transViewOffset(e,t){this.scene.addData(new Uint32Array(new Float32Array([e,t]).buffer),this.uniformsBuf,16)}render(e,t,n,i){this.scene.commandEncoder.beginRenderPass(this.clearDesc).end(),e();let s=t.getBBox();if(!s)return;let o=t.getPxLength(n,i);this.scene.addData(new Uint32Array(new Float32Array([s.minX-o,s.minY-o,s.minX-o,s.maxY+o,s.maxX+o,s.minY-o,s.maxX+o,s.maxY+o,s.minX-o,s.maxY+o,s.maxX+o,s.minY-o]).buffer),this.positionBuf),this.scene.addData(new Uint32Array(new Float32Array(i.multiply4(n.getRenderMatrix()).data).buffer),this.uniformsBuf);let a=this.scene.commandEncoder.beginRenderPass(this.desc);a.setPipeline(this.pipeline),a.setBindGroup(0,this.bindGroup.getBindGroup()),a.setVertexBuffer(0,this.positionBuf.getBuffer()),a.draw(6),a.end()}};var zF=`
	struct Uniforms {
        matrix: mat4x4<f32>,
        pos0: vec2<f32>,
        pos1: vec2<f32>,
        pos2: vec2<f32>,
        pos3: vec2<f32>,
		shininess: f32,
		alpha: f32,
		renderMode: f32,
    }

	${nn}

	@binding(0) @group(0) var<uniform> camera: Camera;
	@binding(1) @group(0) var<uniform> uniforms: Uniforms;
    @binding(2) @group(0) var samp: sampler;
    @binding(3) @group(0) var tex: texture_2d<f32>;

    struct Output {
        @builtin(position) Position: vec4<f32>,
        @location(0) uv: vec2<f32>,
		@location(1) normal: vec3<f32>,
		@location(2) surfaceToEye: vec3<f32>,
    }

    @vertex
    fn vert(
        @builtin(vertex_index) vIndex: u32,
    ) -> Output {
        var output: Output;
		var pos: vec4<f32>;
        if(vIndex == 0 || vIndex == 5) {
            pos = vec4(uniforms.pos0, 0, 1);
            output.uv = vec2<f32>(0, 1);
        } else if(vIndex == 1) {
            pos = vec4(uniforms.pos1, 0, 1);
            output.uv = vec2<f32>(0, 0);
        } else if(vIndex == 2 || vIndex == 3) {
            pos = vec4(uniforms.pos2, 0, 1);
            output.uv = vec2<f32>(1, 0);
        } else {
            pos = vec4(uniforms.pos3, 0, 1);
            output.uv = vec2<f32>(1, 1);
        }
		output.Position = camera.mvpMatrix * uniforms.matrix * pos;
		if(uniforms.renderMode == 1){
			let matrix = camera.mvMatrix * uniforms.matrix;
			output.normal = mat3x3(vec3(matrix[0].xyz), vec3(matrix[1].xyz), vec3(matrix[2].xyz)) * vec3<f32>(0, 0, 1);
			pos = uniforms.matrix * pos;
			output.surfaceToEye = vec3(0, 0, length(camera.pos)) - pos.xyz / pos.w;
		}
        return output;
    }

    @fragment
    fn frag(
        @builtin(position) Position : vec4<f32>,
        @location(0) uv: vec2<f32>,
		@location(1) normal: vec3<f32>,
		@location(2) surfaceToEye: vec3<f32>,
    ) -> @location(0) vec4<f32> {
        let color = textureSample(tex, samp, uv);
        if(color.a == 0 || Position.z > camera.borderZ){
            discard;
        }
		if(uniforms.renderMode == 0 || uniforms.renderMode == 2){
			return color;
		}

		const ambientLightColor = vec3(0.1, 0.1, 0.1);
		const directLightColor = vec3<f32>(1, 1, 1);
		const directLightDir0 = vec3<f32>(0, 0, 1);

		var ambient = color.rgb * ambientLightColor;

		var normal0 = normalize(normal);
		var directLightDir = normalize(directLightDir0);
		var diffuse = abs(dot(normal0 , directLightDir)) * color.rgb * directLightColor;

		var reflect = -2.0 * normal0 * dot(directLightDir, normal0) + directLightDir;
		var surfaceToEye0 = normalize(surfaceToEye);
		var lightToEyeFactor = abs(dot(reflect, surfaceToEye0));
		var specular = color.rgb * directLightColor * pow(lightToEyeFactor, 300.0) * uniforms.shininess * 0.1;

		return vec4(ambient + diffuse + specular, uniforms.alpha);
    }
`,pd=class{constructor(e){this.scene=e;let t=e.gpu;this.uniformsBuf=t.createDynamicBuffer(27,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST);let{device:n}=t,i=n.createShaderModule({code:zF});this.pipeline=n.createRenderPipeline({layout:"auto",vertex:{module:i,entryPoint:"vert"},fragment:{module:i,entryPoint:"frag",targets:[{format:e.planeProgram.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.planeProgram.depthStencilTexture.format,depthWriteEnabled:!0}}),this.desc={colorAttachments:[{view:e.planeProgram.colorTexture.view,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:e.planeProgram.depthStencilTexture.view,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"}},e.planeProgram.colorTexture.addListener(s=>this.desc.colorAttachments[0].view=s),e.planeProgram.depthStencilTexture.addListener(s=>this.desc.depthStencilAttachment.view=s)}createDynamicBindGroup(e){return this.scene.gpu.createDynamicBindGroup(this.pipeline.getBindGroupLayout(0),0,this.scene.cameraBuf,1,this.uniformsBuf,2,this.scene.gpu.device.createSampler({magFilter:"nearest",minFilter:"nearest"}),3,e)}render(e,t,n,i,s){let{bbox:o}=e.pBufInfo;if(t.isOrthCamera()){if(t.getScale()>i)return}else{let l=n.multiply4(t.getRenderMatrix()),u=new me(o.minX,o.minY,0).multiply4(l).z,c=new me(o.minX,o.maxY,0).multiply4(l).z,h=new me(o.maxX,o.minY,0).multiply4(l).z,f=new me(o.maxX,o.maxY,0).multiply4(l).z,d=t.getBorderZ(i);if((u>d||u<=0)&&(c>d||c<=0)&&(h>d||h<=0)&&(f>d||f<=0))return}this.scene.addData(new Uint32Array(new Float32Array(n.data.concat(o.minX,o.minY,o.minX,o.maxY,o.maxX,o.maxY,o.maxX,o.minY,e.getMaterial().shininess,e.getMaterial().alpha,s===1?1:s===4?2:0)).buffer),this.uniformsBuf);let a=this.scene.commandEncoder.beginRenderPass(this.desc);a.setPipeline(this.pipeline),a.setBindGroup(0,e.pBufInfo.bindGroup.getBindGroup()),a.draw(6),a.end()}};var Uv=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n)}return r}}("struct Uniforms { matrix: mat4x4<f32>, color: vec4<f32>, ruleColor: vec4<f32>, position: vec2<f32>, } @binding(0) @group(0) var<uniform> uniforms: Uniforms; struct Output { @builtin(position) Position: vec4<f32>, @location(0) position: vec4<f32>, @location(1) curr: vec4<f32>, } @vertex fn vert( @location(0) position: vec2<f32>, ) -> Output { var output: Output; output.Position = vec4(position, 0, 1); if(abs(position.x) > 1.0){ if(position.x > 0.0){ output.Position.x = 1.0 - 18.0 * uniforms.matrix[0][0]; }else{ output.Position.x = -1.0 + 18.0 * uniforms.matrix[0][0]; } }else if(abs(position.y) > 1.0){ if(position.y > 0.0){ output.Position.y = 1.0 - 18.0 * uniforms.matrix[1][1]; }else{ output.Position.y = -1.0 + 18.0 * uniforms.matrix[1][1]; } } output.curr = vec4(output.Position.xy, 1.0 - 18.0 * uniforms.matrix[1][1], -1.0 + 18.0 * uniforms.matrix[0][0]); let pos = vec4(uniforms.position, 0, 1) * uniforms.matrix; let piexl_x = uniforms.matrix[0][0] / 2.0; let piexl_y = uniforms.matrix[1][1] / 2.0; output.position = vec4(pos.x - piexl_x, pos.x + piexl_x, pos.y - piexl_y, pos.y + piexl_y); return output; } @fragment fn frag( @builtin(position) Position: vec4<f32>, @location(0) position: vec4<f32>, @location(1) curr: vec4<f32>, ) -> @location(0) vec4<f32> { return select( uniforms.color, uniforms.ruleColor, (curr.x >= position[0] && curr.x <= position[1] && curr.y > curr.z) || (curr.y >= position[2] && curr.y <= position[3] && curr.x < curr.w) ); }");var Dv=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n)}return r}}("struct Uniforms { matrix: mat4x4<f32>, color: vec4<f32>, } @binding(0) @group(0) var<uniform> uniforms: Uniforms; @vertex fn vert( @location(0) position: vec3<f32>, ) -> @builtin(position) vec4<f32> { var matrix = uniforms.matrix; if(position.z == 1){ matrix[0][0] = 1; matrix[3][0] = 0; } else { matrix[1][1] = 1; matrix[3][1] = 0; } return matrix * vec4(position.xy, 0, 1); } @fragment fn frag() -> @location(0) vec4<f32> { return uniforms.color; }");var qs=(g=>(g[g.MIL=1]="MIL",g[g.INCH=1e3]="INCH",g[g.FT=12e3]="FT",g[g.YARD=36e3]="YARD",g[g.MILE=6336e4]="MILE",g[g.KM=3937007874e-2]="KM",g[g.M=39370]="M",g[g.DM=3937]="DM",g[g.CM=393.7]="CM",g[g.MM=39.37]="MM",g[g.UM=.039]="UM",g[g.NM=394e-7]="NM",g[g.PT=13.88888888888889]="PT",g[g.PX72=13.88888888888889]="PX72",g[g.PX96=10.416666666666666]="PX96",g[g.PX100=10]="PX100",g))(qs||{}),ug=(g=>(g.MIL="mil",g.INCH="inch",g.FT="ft",g.YARD="yard",g.MILE="mile",g.KM="km",g.M="m",g.DM="dm",g.CM="cm",g.MM="mm",g.UM="um",g.NM="nm",g.PT="pt",g.PX72="px(72)",g.PX96="px(96)",g.PX100="px(100)",g))(ug||{}),cg=class{constructor(e,t){this.ratio=e/t}wrap(e){return e*this.ratio}static convert(e,t,n){return e*t/n}},Yr=cg;Yr.ASIS=new cg(1,1);var md=class{conversion(e,t,n){let i=e+2+t;return this[i](n)}conversion1(e,t,n){let i=e+2+t,s=this[i](n);return t=="mil"?Math.round(s*10)/10:Math.round(s*1e3)/1e3}mil2mil(e){return e}mil2mm(e){return e*.0254}mil2cm(e){return e*.00254}mil2inch(e){return e/1e3}mm2mm(e){return e}mm2mil(e){let t=Math.pow(10,5);return Math.round(e*39.37007874015748*t)/t}mm2cm(e){return e/10}mm2inch(e){let t=Math.pow(10,8);return Math.round(e*.03937007874015748*t)/t}cm2mil(e){let t=Math.pow(10,6);return Math.round(e*3.937007874015748*t)/t}cm2mm(e){return e*10}cm2inch(e){let t=Math.pow(10,7);return Math.round(e*.3937007874015748*t)/t}inch2mil(e){return e*1e3}inch2mm(e){return e*25.4}inch2cm(e){return e*2.54}};var gd=class{constructor(e){this.backgroundColor=Fe.WHITE;this.scaleColor=Fe.BLACK;this.scale=1;this.ratio=5;this.spacing=2;this.unit="mil";this.origin=q.ORIGIN;this.scene=e;let t=e.gpu,n=t.device;this.desc={colorAttachments:[{view:e.colorTexture.view,loadOp:"load",storeOp:"store"}]},e.colorTexture.addListener(a=>this.desc.colorAttachments[0].view=a),this.backgroundUniformsBuf=t.createDynamicBuffer(26,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);let i=18;this.backgroundPosBuf=t.createStaticBuffer(new Uint32Array(new Float32Array([-1,-1,-i,-1,-i,1,-1,-1,-i,1,-1,1,-1,i,1,i,1,1,-1,i,1,1,-1,1]).buffer),GPUBufferUsage.VERTEX),this.backgroundArrayCount=this.backgroundPosBuf.getSize()/2;let s=n.createShaderModule({code:Uv({})});this.backgroundPipeline=n.createRenderPipeline({layout:"auto",vertex:{module:s,entryPoint:"vert",buffers:[{arrayStride:2*ct,attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]}]},fragment:{module:s,entryPoint:"frag",targets:[{format:e.colorTexture.format}]},primitive:{topology:"triangle-list"}}),this.backgroundBindGroup=t.createBindGroup(this.backgroundPipeline.getBindGroupLayout(0),0,this.backgroundUniformsBuf),this.scaleUniformsBuf=t.createDynamicBuffer(26,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM),this.scalePosBuf=t.createDynamicBuffer(1,GPUBufferUsage.COPY_DST|GPUBufferUsage.VERTEX),this.updateScalePosBuf();let o=n.createShaderModule({code:Dv({})});this.scalePipeline=n.createRenderPipeline({layout:"auto",vertex:{module:o,entryPoint:"vert",buffers:[{arrayStride:3*ct,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},fragment:{module:o,entryPoint:"frag",targets:[{format:e.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"line-list"}}),this.scaleBindGroup=t.createDynamicBindGroup(this.scalePipeline.getBindGroupLayout(0),0,this.scaleUniformsBuf)}setBackgroundColor(e){this.backgroundColor=e}getBackgroundColor(){return this.backgroundColor}updateScalePosBuf(){this.deltaX=1-36/this.scene.canvas.width,this.deltaY=1-36/this.scene.canvas.height;let e=[],t=0,n=0,i=this.scene.canvas.width/2,s=this.scene.canvas.height/2,o=(1-this.deltaY)/2;for(let l=0;l<i;l+=this.spacing)t=this.fillVertical(e,l,o,t,n),n+=1;n=0;for(let l=0;l>-i;l-=this.spacing)t=this.fillVertical(e,l,o,t,n),n+=1;n=0;let a=(1-this.deltaX)/2;for(let l=0;l<s;l+=this.spacing)t=this.fillHorizontal(e,l,a,t,n),n+=1;n=0;for(let l=0;l>-s;l-=this.spacing)t=this.fillHorizontal(e,l,a,t,n),n+=1;this.scalePosBuf.setSize(e.length),this.scalePosBuf.write(0,new Float32Array(e)),this.scaleArrayCount=e.length/3}fillVertical(e,t,n,i,s){let o=s%5,a=s%10;return e[i++]=t,e[i++]=this.deltaY,e[i++]=0,e[i++]=t,a==0?e[i++]=this.deltaY+n*2:o==0?e[i++]=this.deltaY+n:e[i++]=this.deltaY+n*.5,e[i++]=0,i}fillHorizontal(e,t,n,i,s){let o=s%5;return s%10==0?e[i++]=-this.deltaX-n*2:o==0?e[i++]=-this.deltaX-n:e[i++]=-this.deltaX-n*.5,e[i++]=t,e[i++]=1,e[i++]=-this.deltaX,e[i++]=t,e[i++]=1,i}autoSize(){this.updateScalePosBuf()}get spacing10(){return this.spacing*this.ratio*this.scale*10}modifyUnit(e){if(e!=this.unit){let t=new md;e!="mil"?this.scale=t.conversion(e,"mil",1)/100:this.scale=1,this.scale,this.unit=e}}autoScale(e){let t=e.getViewMatrix().multiply4(Qe.scale(e.getScale(),e.getScale(),1)),n=Math.sqrt(t.data[0]*t.data[0]+t.data[1]*t.data[1]),i=0,s=n;for(;;)if(s>=1){if(s=s/10,s<1)break;i++}else if(s=s*10,i--,s>=1)break;let o=n/Math.pow(10,i);o>=1&&o<2?n=n/Math.pow(10,i):o>=2&&o<5?n=n/(2*Math.pow(10,i)):n=n/(5*Math.pow(10,i));let a=this.origin.multiply4(e.getViewMatrix().multiply4(Qe.scale(e.getScale(),e.getScale(),1))),l=this.spacing10*n,u=this.spacing10*n,c=a.x%l,h=a.y%u;return Qe.scale(n*this.ratio*this.scale,n*this.ratio*this.scale,1).translate1(c,h,0).multiply4(e.getProjectMatrix().multiply4(Qe.scale(1/e.getScale(),1/e.getScale(),1))).data}setScaleColor(e){this.scaleColor=e}getScaleColor(){return this.scaleColor}getScaleRenderColor(){return this.scene.getAntialias()?this.scaleColor:new Fe(this.scaleColor.r,this.scaleColor.g,this.scaleColor.b,this.scaleColor.alpha*.7)}render(){let e=this.scene.getCurrentCamera();{let t=this.getScaleRenderColor();this.scene.addData(new Uint32Array(new Float32Array(e.getProjectMatrix().multiply4(Qe.scale(1/e.getScale(),1/e.getScale(),1)).data.concat(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.alpha,t.r,t.g,t.b,t.alpha,this.scene.screenPosition.x,this.scene.screenPosition.y)).buffer),this.backgroundUniformsBuf);let n=this.scene.commandEncoder.beginRenderPass(this.desc);n.setPipeline(this.backgroundPipeline),n.setBindGroup(0,this.backgroundBindGroup),n.setVertexBuffer(0,this.backgroundPosBuf.getBuffer()),n.draw(this.backgroundArrayCount),n.end()}{let t=this.getScaleRenderColor();this.scene.addData(new Uint32Array(new Float32Array(this.autoScale(e).concat(t.r,t.g,t.b,t.alpha)).buffer),this.scaleUniformsBuf);let n=this.scene.commandEncoder.beginRenderPass(this.desc);n.setPipeline(this.scalePipeline),n.setBindGroup(0,this.scaleBindGroup.getBindGroup()),n.setVertexBuffer(0,this.scalePosBuf.getBuffer()),n.draw(this.scaleArrayCount),n.end()}}};var as=1024,xd=class extends rd{constructor(t,n,i){super();this.planeIdMap=new Fn(as);this.dataU=new Uint32Array(2**20);this.dataOffset=0;this.normalPlaneSet=new Set;this.normalPlaneRenderDatas=[];this.preDrawNormalPlaneDatas=[];this.lock=new Bo(1);this.colorMap=new Jr;this.caledTexScale=!1;this.texScale=rg;this.texPxLength=1/this.texScale;this.removingPtNum=0;this.noResize=!1;this.screenPosition=q.ORIGIN;this.renderWhenChange=!0;this.virtualTimes=[];this.frameTimes=[];this.startTime=performance.now();this.canvas=i,this.gpu=new Wa(t),this.normalBuilder=new Za(this.gpu,Xa),this.planeIdMap.markUsed(0),this.context=i.getContext("webgpu"),this.context.configure({device:t,format:"rgba8unorm",alphaMode:"opaque",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST}),this.depthTexture=new Vn(this.gpu,i.width,i.height,"depth24plus",GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING),this.colorTexture=new Vn(this.gpu,i.width,i.height,"rgba8unorm",GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_SRC),this.cameraBuf=this.gpu.createDynamicBuffer(Xh,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),this.dataBuf=this.gpu.createDynamicBuffer(this.dataU.length,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.normalFilteredStartIndexsBuf=this.gpu.createDynamicBuffer(1,GPUBufferUsage.STORAGE),this.normalFilteredPtNumsBuf=this.gpu.createDynamicBuffer(1,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.colorsBuf=this.gpu.createDynamicBuffer(4,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.clearDesc={colorAttachments:[{view:this.colorTexture.view,clearValue:{r:.8,g:.8,b:.8,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTexture.view,depthClearValue:0,depthLoadOp:"clear",depthStoreOp:"store"}},this.colorTexture.addListener(a=>this.clearDesc.colorAttachments[0].view=a),this.depthTexture.addListener(a=>this.clearDesc.depthStencilAttachment.view=a),this.planeProgram=new fd(this,i.width,i.height),this.drawStencilProgram=new ud(this),this.renderPtProgram=new sd(this),this.extractBitBufferProgram=new od(this),this.renderBitBufferProgram=new ad(this),this.filterPtProgram=new ld(this),this.filterNodeProgram=new td(this,Xa),this.renderTexProgram=new pd(this),this.meshProgram=new hd(this),this.textureProgram=new dd(this),this.rulerProgram=new gd(this);let{startIndexsBuf:s,ptsBuf:o}=this.normalBuilder.update();this.normalFilterBindGroup=this.filterPtProgram.createDynamicBindGroup(o,s,this.normalFilteredStartIndexsBuf),this.normalRenderBindGroup=this.renderPtProgram.createDynamicBindGroup(o,this.normalFilteredStartIndexsBuf),window.addEventListener("keydown",a=>{a.key==="Escape"&&(this.renderWhenChange=!this.renderWhenChange)}),this.resize(),this.install(n)}install(t){t.rpcService("/engine/scene/setBackgroundColor",n=>{this.backgroudColor=Fe.of5(...n)}),t.rpcService("/engine/scene/setCoordSys",n=>{this.needRenderAll=!0}),t.rpcService("/engine/scene/setGridType",n=>{this.needRenderAll=!0}),t.rpcService("/engine/scene/setGridPattern",n=>{this.needRenderAll=!0}),t.rpcService("/engine/scene/setGridColor",n=>{this.needRenderAll=!0}),t.rpcService("/engine/scene/setGridDelta",n=>{this.needRenderAll=!0}),t.rpcService("/engine/scene/setPolarDelta",n=>{this.needRenderAll=!0}),t.rpcService("/engine/scene/setPolarRadius",n=>{this.needRenderAll=!0}),t.rpcService("/engine/scene/setPolarAngle",n=>{this.needRenderAll=!0}),t.rpcService("/engine/scene/setOpenRuler",n=>{this.openRuler=n,this.needRenderAll=!0}),t.rpcService("/engine/scene/setUnit",n=>{this.modifyUnit(n),this.needRenderAll=!0})}getAntialias(){return!1}logAllTexSize(){let t=0;this.normalPlaneSet.forEach(n=>{n.pBufInfo.buf?t+=n.pBufInfo.buf.getSize():n.pBufInfo.texture&&(t+=n.pBufInfo.texture.width*n.pBufInfo.texture.height)}),console.log("allTexSize:",t*ct/2**30)}getColorIndex(t){if(!!t)return this.colorMap.computeIfAbsent(t,()=>{let n=this.colorMap.size()+1;return n*4>=this.colorsBuf.getSize()&&this.colorsBuf.extSize(this.colorsBuf.getSize()*2),this.colorsBuf.write(n*4,new Float32Array([t.r,t.g,t.b,t.alpha])),n})}getPlaneId(){let t=this.planeIdMap.findEmpty();return this.planeIdMap.markUsed(t),t}releasePlaneId(t){this.planeIdMap.markRemove(t)}initCommandEncoder(){this.dataOffset=0,this.commandEncoder=this.gpu.device.createCommandEncoder()}addData(t,n,i=0){if(this.dataOffset+t.length>this.dataU.length){if(t.length>this.dataU.length)throw new Error("data.length > this.dataU.length");this.submitCommandEncoder(),this.initCommandEncoder()}this.dataU.set(t,this.dataOffset),this.gpu.copyBufferToBuffer(this.dataBuf,this.dataOffset,n,i,t.length,this.commandEncoder),this.dataOffset+=t.length}submitCommandEncoder(){this.gpu.writeBuffer(this.dataBuf,0,this.dataU,0,this.dataOffset),this.gpu.submit(this.commandEncoder)}getCurrentCamera(){return this.currentCamera}getViewOffset(){return q.ORIGIN}addNormalPlane(t){this.normalPlaneSet.add(t)}delNormalPlane(t){this.normalPlaneSet.delete(t)}turnSimpleModeOnOrOff(t){}setSampling(t){}clearTexture(){this.commandEncoder.beginRenderPass(this.clearDesc).end()}copyColorToCanvas(){let t=this.gpu.device.createCommandEncoder();t.copyTextureToTexture({texture:this.colorTexture.texture},{texture:this.context.getCurrentTexture()},this.colorTexture),this.gpu.submit(t)}renderNormalPlanesTest(t,n=Array.from(this.normalPlaneSet),i=()=>{}){var a;let s=[],o=[];if(n.forEach(l=>{s[l.getId()]=[Qe.ORIGIN],o[l.getId()]={staticData:[]}}),this.updateCameraBuf(t,Number.NEGATIVE_INFINITY),this.initCommandEncoder(),this.normalPlaneRenderDatas.forEach(l=>{let u=t.getRenderMatrix(),c=new Oe;[l.bbox.LL(),l.bbox.LR(),l.bbox.UL(),l.bbox.UR()].forEach(b=>{let v=new me(b.x,b.y,0).multiply4(u);c.ext6(v.x,v.y)});let h=c.build();if(h.minX>=1||h.maxX<=-1||h.minY>=1||h.maxY<=-1)return;let f=this.filter(0,0,s,l);if(!f)return;let{ptNumsArr:d,filterRenderBindGroups:m,filteredPtNumsBuf:p}=l,g=0;s.forEach((b,v)=>{b.forEach(w=>{o[v].staticData.push({nextIndexs:f,index:g,ptNums:d.slice(v*6,(v+1)*6),renderBindGroup:m.renderBindGroup,filteredPtNumsBuf:p}),g+=6})})}),this.normalPtNumsArr){let l=new Uint32Array(s.reduce((h,f)=>h+f.length,0)*6),u=0,c=0;for(let h=1;h<s.length;h++)(a=s[h])==null||a.forEach(f=>{var d;(d=this.normalPtNumsArr.slice(h*6,(h+1)*6))==null||d.forEach((m,p)=>{l[c+p]=u,u+=m}),c+=6});u!==0&&(this.normalFilteredStartIndexsBuf.setSize(u),this.normalFilteredPtNumsBuf.setSize(l.length),this.filterPtProgram.filter(this.normalBuilder.getIdsLengthInBuf(),1,l.length,this.normalBuilder.getIdsLengthInBuf(),this.normalFilterBindGroup.getBindGroup(),s,l,this.normalFilteredPtNumsBuf,!0),c=0,s.forEach((h,f)=>{h.forEach(d=>{o[f].dynamicData={nextIndexs:l,index:c,ptNums:this.normalPtNumsArr.slice(f*6,(f+1)*6)},c+=6})}))}this.clearTexture(),n.forEach(l=>{this.planeProgram.render(()=>{let u=o[l.getId()];u.staticData.forEach(c=>{this.renderPtProgram.draw(Qe.ORIGIN,t,l,0,c.nextIndexs,c.ptNums,c.renderBindGroup.getBindGroup(),c.filteredPtNumsBuf,c.index,l,"render")}),u.dynamicData&&this.renderPtProgram.draw(Qe.ORIGIN,t,l,0,u.dynamicData.nextIndexs,u.dynamicData.ptNums,this.normalRenderBindGroup.getBindGroup(),this.normalFilteredPtNumsBuf,u.dynamicData.index,l,"render")},l,t,Qe.ORIGIN)}),i(),this.submitCommandEncoder()}async calTexScalePxLength(t){if(this.caledTexScale)return;this.caledTexScale=!0,this.normalPlaneSet.forEach(s=>s.clearPBuf()),this.resize(2048,1024),this.noResize=!0;let n=this.currentCamera.copy();n.setCameraType(!0),n.setCameraDirect(!0),n.adapt(new wn(t.minX,t.minY,0,t.maxX,t.maxY,0));let i=n.getScale();for(n.setScale(i*100),this.renderNormalPlanesTest(n),await this.gpu.device.queue.onSubmittedWorkDone(),n.setScale(i);;){let s=performance.now();this.renderNormalPlanesTest(n),this.copyColorToCanvas(),await this.gpu.device.queue.onSubmittedWorkDone();let o=performance.now()-s;if(console.log("render time:",o),o<=1e3/tg){this.texScale=n.getScale(),this.texPxLength=n.getPxLength(),this.noResize=!1,this.resize(),console.log("scale times:",this.texScale/i);return}n.setScale(n.getScale()*1.1)}}async build(){if(!this.normalBuilder.isChange())return;console.log("normal ptNum:",this.normalBuilder.getPtNum());let t=await this.normalBuilder.build();if(t instanceof Uint32Array){this.normalPtNumsArr=t;return}delete this.normalPtNumsArr,this.normalPlaneRenderDatas.forEach(a=>{a.filteredStartIndexsBuf.destroy(),a.filteredPtNumsBuf.destroy(),a.filterRenderBindGroups.filterPtBindGroup2.forEach(l=>l.destroy()),a.filterRenderBindGroups.renderBindGroup.destroy()}),this.normalPlaneRenderDatas.length=0;let{rtreeIndex:n,bbox:i}=t,s=this.gpu;n.forEach(a=>{let l=s.createDynamicBuffer(a.ptNum,GPUBufferUsage.STORAGE),u=this.filterNodeProgram.createFilterRenderBindGroups(a.ptsBuf,a.nodesBuf,l),c=a.nodeRanges,h,f;for(let d=0;d<c.length;d++)if(c[d].nodeNum<=eg){f=d+1,h=c[d];break}this.normalPlaneRenderDatas.push({filterRenderBindGroups:u,idsBuf:a.idsBuf,nodesBuf:a.nodesBuf,ptsBuf:a.ptsBuf,nodeRange:h,levelNum:f,bbox:a.bbox,ptNumsArr:a.ptNumsArr,filteredStartIndexsBuf:l,filteredPtNumsBuf:s.createDynamicBuffer(a.ptNumsArr.length,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)})});let o={idsSize:this.normalPlaneRenderDatas.reduce((a,l)=>a+l.idsBuf.getSize(),0)*ct/2**30,ptsSize:this.normalPlaneRenderDatas.reduce((a,l)=>a+l.ptsBuf.getSize(),0)*ct/2**30,nodesSize:this.normalPlaneRenderDatas.reduce((a,l)=>a+l.nodesBuf.getSize(),0)*ct/2**30,filteredStartIndexsSize:this.normalPlaneRenderDatas.reduce((a,l)=>a+l.filteredStartIndexsBuf.getSize(),0)*ct/2**30,filteredPtNumsSize:this.normalPlaneRenderDatas.reduce((a,l)=>a+l.filteredPtNumsBuf.getSize(),0)*ct/2**30};console.log("bufferSize",s.bufferSize*ct/2**30,o,"totalSize:",Object.values(o).reduce((a,l)=>a+l,0)),await this.calTexScalePxLength(i)}preDrawNormalPlanes(t,n){var f;this.preDrawNormalPlaneDatas.length=0,this.updateCameraBuf(t);let i=t.getBorderZ(this.texScale);if(this.normalPlaneSet.size===0||i>=1)return;let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;n.forEach(d=>{for(let m of d[0].interPlanes)if(m.isNormal()&&!m.isEmpty()){let p=me.ORIGIN.multiply4(d[1]).z;s=Math.min(s,p),o=Math.max(o,p);return}for(let m of d[0].subPlanes)if(m.isNormal()&&!m.isEmpty()){let p=me.ORIGIN.multiply4(d[1]).z;s=Math.min(s,p),o=Math.max(o,p);return}});let a=[],{preDrawNormalPlaneDatas:l}=this;if(n.forEach(d=>{function m(g){if(g.isEmpty()||!g.isNormal())return;let b=g.getBBox2(),v=p.multiply4(t.getRenderMatrix()),w=[new me(b.minX,b.minY,0).multiply4(v),new me(b.minX,b.maxY,0).multiply4(v),new me(b.maxX,b.minY,0).multiply4(v),new me(b.maxX,b.maxY,0).multiply4(v)];if(w[0].x<=-1&&w[1].x<=-1&&w[2].x<=-1&&w[3].x<=-1||w[0].x>=1&&w[1].x>=1&&w[2].x>=1&&w[3].x>=1||w[0].y<=-1&&w[1].y<=-1&&w[2].y<=-1&&w[3].y<=-1||w[0].y>=1&&w[1].y>=1&&w[2].y>=1&&w[3].y>=1||w[0].z<=i&&w[1].z<=i&&w[2].z<=i&&w[3].z<=i)return;a[g.getId()]||(a[g.getId()]=[]),a[g.getId()].push(p);let P=l[g.getId()];P||(P=new Jr,l[g.getId()]=P),P.get(p)||P.put(p,{staticData:[]})}let p=d[1];d[0].interPlanes.forEach(g=>m(g)),d[0].subPlanes.forEach(g=>m(g))}),a.length===0||(this.normalPlaneRenderDatas.forEach(d=>{let m=t.getRenderMatrix(),p=new Oe;new wn(d.bbox.minX,d.bbox.minY,s,d.bbox.maxX,d.bbox.maxY,o).getVertexes().forEach(B=>{let I=new me(B.x,B.y,B.z).multiply4(m);p.ext6(I.x,I.y)});let g=p.build();if(g.minX>=1||g.maxX<=-1||g.minY>=1||g.maxY<=-1)return;let b=this.filter(s,o,a,d);if(!b)return;let{ptNumsArr:v,filterRenderBindGroups:w,filteredPtNumsBuf:P}=d,_=0;a.forEach((B,I)=>{B.forEach(C=>{l[I].get(C).staticData.push({nextIndexs:b,index:_,ptNums:v.slice(I*6,(I+1)*6),renderBindGroup:w.renderBindGroup,filteredPtNumsBuf:P}),_+=6})})}),!this.normalPtNumsArr))return;let u=new Uint32Array(a.reduce((d,m)=>d+m.length,0)*6),c=0,h=0;for(let d=1;d<a.length;d++)(f=a[d])==null||f.forEach(m=>{var p;(p=this.normalPtNumsArr.slice(d*6,(d+1)*6))==null||p.forEach((g,b)=>{u[h+b]=c,c+=g}),h+=6});c!==0&&(this.normalFilteredStartIndexsBuf.setSize(c),this.normalFilteredPtNumsBuf.setSize(u.length),this.filterPtProgram.filter(this.normalBuilder.getIdsLengthInBuf(),1,u.length,this.normalBuilder.getIdsLengthInBuf(),this.normalFilterBindGroup.getBindGroup(),a,u,this.normalFilteredPtNumsBuf,!0),h=0,a.forEach((d,m)=>{d.forEach(p=>{l[m].get(p).dynamicData={nextIndexs:u,index:h,ptNums:this.normalPtNumsArr.slice(m*6,(m+1)*6)},h+=6})}))}afterDraw(t){t==="drawInterStencil"&&(this.drawStencilProgram.draw(!0,192,127),this.drawStencilProgram.draw(!0,128,128),this.drawStencilProgram.draw(!1,64,63))}renderNormalPlane(t,n,i,s,o){var l;if(t.isEmpty())return;let a=(l=this.preDrawNormalPlaneDatas[t.getId()])==null?void 0:l.get(n);a&&(a.staticData.forEach(u=>{this.renderPtProgram.draw(n,this.currentCamera,i,s,u.nextIndexs,u.ptNums,u.renderBindGroup.getBindGroup(),u.filteredPtNumsBuf,u.index,t,o)}),a.dynamicData&&this.renderPtProgram.draw(n,this.currentCamera,i,s,a.dynamicData.nextIndexs,a.dynamicData.ptNums,this.normalRenderBindGroup.getBindGroup(),this.normalFilteredPtNumsBuf,a.dynamicData.index,t,o)),t.pBufInfo.bbox&&(t.pBufInfo.buf?this.renderBitBufferProgram.draw(n,this.currentCamera,i,t,s,t.pBufInfo.width,t.pBufInfo.height,this.texPxLength,t.pBufInfo.bbox,this.texScale,t.pBufInfo.bindGroup.getBindGroup(),o):this.renderTexProgram.render(t,this.currentCamera,n,this.texScale,s)),this.afterDraw(o)}filterPtRender(t,n,i,s,o,a,l,u,c,h){let f=0,d=new Uint32Array(6);for(let p=1;p<6;p++)d[p]=f+=s[p-1];let m=this.gpu.getTempBuf(d.length);this.filterPtProgram.filter(l,0,d.length,l,o,u,d,m,!1),this.renderPtProgram.draw(u[c.getId()][0],t,n,i,d,s,a,m,0,c,h),this.afterDraw(h)}filter(t,n,i,s){var p;let{filterRenderBindGroups:o,nodeRange:a,levelNum:l,ptNumsArr:u,filteredPtNumsBuf:c}=s,h=this.filterNodeProgram.filter(a,t,n,l,o),f=new Uint32Array(i.reduce((g,b)=>g+b.length,0)*6),d=0,m=0;for(let g=1;g<i.length;g++)(p=i[g])==null||p.forEach(b=>{u.slice(g*6,(g+1)*6).forEach((v,w)=>{f[m+w]=d,d+=v}),m+=6});if(d!==0)return s.filteredStartIndexsBuf.setSize(d),c.setSize(f.length),this.filterPtProgram.filter(h,1,f.length,Math.min(a.nodeNum*Xa**l,Ar),o.filterPtBindGroup2[l%2].getBindGroup(),i,f,c,!0),f}updateCameraBuf(t,n=this.texScale){cv(this.cameraBuf,t,n)}async render(t=2,n=null){let i=Array.from(this.cameraSet)[0];if(!i||!i.isChangedFromLastRender()&&!n&&this.renderWhenChange&&!this.needRenderAll)return;this.needRenderAll=!1,await this.lock.acquireSync(),this.frameTimes.push(performance.now()-this.startTime),this.startTime=performance.now(),this.currentCamera=i,i.adjustAxis(),this.group.preDraw();let s=[];if(this.group.getPlaneGPUMatrixRenderModes(t).forEach(a=>{a[0].getBBox()?s.push(a):a[0].markDrawn(a[1])}),i.isOrthCamera())i.getTar2Pos().z<0?s.sort((a,l)=>{let u=a[0].getBBox().transform(a[1]),c=l[0].getBBox().transform(l[1]);return c.minZ+c.maxZ-(u.minZ+u.maxZ)}):s.sort((a,l)=>{let u=a[0].getBBox().transform(a[1]),c=l[0].getBBox().transform(l[1]);return u.minZ+u.maxZ-(c.minZ+c.maxZ)});else{let a=i.getZ();s.sort((l,u)=>{let c=l[0].getBBox().transform(l[1]),h=u[0].getBBox().transform(u[1]);return Math.abs(a-(h.minZ+h.maxZ)/2)-Math.abs(a-(c.minZ+c.maxZ)/2)})}for(;this.removingPtNum!==0;)await new Promise(a=>setTimeout(a,0));await this.build(),this.normalPlaneSet.forEach(a=>a.updatePBuf()),this.resize(),this.initCommandEncoder(),this.clearTexture(),this.preDrawNormalPlanes(i,s),s.forEach(a=>this.planeProgram.render(()=>a[0].draw(i,a[1],a[2]),a[0],i,a[1])),this.submitCommandEncoder();let o=this.group.getMeshMap(t);for(let[a,l]of o.entries())a.drawGPU(this,l);this.openRuler&&(this.initCommandEncoder(),this.rulerProgram.render(),this.submitCommandEncoder()),this.copyColorToCanvas(),await this.gpu.device.queue.onSubmittedWorkDone(),i.rendered(),this.lock.release(),this.virtualTimes.push(performance.now()-this.startTime),this.frameTimes.length===30&&(console.log("frame fps",1e3/(this.frameTimes.reduce((a,l)=>a+l,0)/this.frameTimes.length),"virtual fps",1e3/(this.virtualTimes.reduce((a,l)=>a+l,0)/this.virtualTimes.length)),this.frameTimes.length=0,this.virtualTimes.length=0)}setScreenPosition(t){this.screenPosition=t,this.openRuler&&(this.needRenderAll=!0)}getSingleColor(t,n){return new Uint8Array(4)}getCanvas(){return this.canvas}resize(t,n){if(!this.noResize){if(!t||!n)if(Wh&&$h)t=Wh,n=$h;else{let i=window.devicePixelRatio;/android|iphone|symbian|windows phone|ipad|ipod/i.test(navigator.userAgent)&&(i*=window.outerWidth/window.innerWidth),t=this.canvas.clientWidth*i,n=this.canvas.clientHeight*i,(t===0||n===0)&&(t=1,n=1)}this.canvas.width===t&&this.canvas.height===n||(this.canvas.width=t,this.canvas.height=n,this.colorTexture.updateSize(t,n),this.depthTexture.updateSize(t,n),this.cameraSet.forEach(i=>i.updateSize(t,n)),this.planeProgram.resize(t,n),this.rulerProgram.autoSize())}}isCoreGraphic(){return!0}get backgroudColor(){let t=this.clearDesc.colorAttachments[0].clearValue;return new Fe(t.r,t.g,t.b,t.a)}set backgroudColor(t){this.clearDesc.colorAttachments[0].clearValue={r:t.r,g:t.g,b:t.b,a:t.alpha},this.needRenderAll=!0}getImageData(t,n,i,s){throw new Error("not support")}captureToCanvas(t,n,i){throw new Error("not support")}createPlane(t,n,i,s){return new Ka(this,Xa,t,n,i,s)}modifyUnit(t){this.rulerProgram.modifyUnit(t)}};function YF(r){return`
    struct Uniforms {
		ptNum: u32,
		coordXOffset: u32,
    }

	struct IdStartIndex {
		id: u32,
		startIndex: u32,
	}

	struct InfoStartIndexsR {
		ptNum: u32,
		nextStartIndex: u32,
        idStartIndexs: array<IdStartIndex>,
	}

    @binding(0) @group(0) var<uniform> uniforms: Uniforms;
    @binding(1) @group(0) var<storage, read_write> infoStartIndexs: InfoStartIndexsR;
	@binding(2) @group(0) var<storage, read_write> pts: array<f32>;
	@binding(3) @group(0) var<storage, read_write> counts: array<atomic<u32>>;

    @compute @workgroup_size(${r.limits.maxComputeWorkgroupSizeX})
    fn countPrimitiveType(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let index = uniforms.coordXOffset + coord.x;
		if(index >= uniforms.ptNum){
			return;
		}

		let head = u32(pts[infoStartIndexs.idStartIndexs[index].startIndex]);
		atomicAdd(&counts[(head & ${Co}) * ${6} + ((head & ${ar}) >> ${ft})], 1);
	}
`}var bd;function Gv(r,e,t){bd||(bd=r.createComputePipeline(r.device.createShaderModule({code:YF(r)}),"countPrimitiveType"));let n=r.createDynamicBuffer(2,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),i=(e.getSize()-os)/2;n.write(0,new Uint32Array([i]));let s=r.createDynamicBuffer(6*as,GPUBufferUsage.COPY_SRC|GPUBufferUsage.STORAGE),o=r.createBindGroup(bd.getBindGroupLayout(0),0,n,1,e,2,t,3,s),a=r.device.createCommandEncoder();r.runComputePass(a,bd,o,i,u=>r.copyBufferToBuffer(r.coordXOffsetBuf,u,n,1,1,a)),r.submit(a);let l=s.read().then(u=>{let c=new Uint32Array(u);for(let h=c.length-1;h>=0;h--)if(c[h]!==0)return c.slice(0,h+1);throw new Error("no pt!")});return s.destroy(),n.destroy(),l}var Ed=30,_d=7,vd=32-_d,zv=2**vd-1,Qa=4;function yd(r){let{maxComputeWorkgroupStorageSize:e}=r.limits,t=2**Math.floor(Math.log2(e/ct/Qa)),n=Math.floor(e/ct/2);return{bboxNum:t,prefixNum:n}}function XF(r,e){let{bboxNum:t,prefixNum:n}=yd(r),{maxComputeWorkgroupSizeX:i}=r.limits;return`
	struct BBox {
		minX: f32,
		maxX: f32,
		minY: f32,
		maxY: f32,
		mortonCode: u32,
	}

	fn setMortonCode(i: u32) {
		// coords are transformed into non-negative 15-bit integer range
		let bbox = bboxs[i];
		// var x = u32(32767 * ((bbox.minX + bbox.maxX) / 2 - params.minX) * params.invSize);
		// var y = u32(32767 * ((bbox.minY + bbox.maxY) / 2 - params.minY) * params.invSize);
		var x = u32(32767 * ((bbox.minX + bbox.maxX) / 2 - params.minX) * params.invX);
		var y = u32(32767 * ((bbox.minY + bbox.maxY) / 2 - params.minY) * params.invY);

		x = (x | (x << 8)) & 0x00ff00ff;
		x = (x | (x << 4)) & 0x0f0f0f0f;
		x = (x | (x << 2)) & 0x33333333;
		x = (x | (x << 1)) & 0x55555555;

		y = (y | (y << 8)) & 0x00ff00ff;
		y = (y | (y << 4)) & 0x0f0f0f0f;
		y = (y | (y << 2)) & 0x33333333;
		y = (y | (y << 1)) & 0x55555555;

		bboxs[i].mortonCode = x | (y << 1);
	}

	struct Node {
		minX: f32,
		maxX: f32,
		minY: f32,
		maxY: f32,
		childIndexs: array<i32, ${e}>,
	}

	struct Unit {
		bboxStartIndex: u32,
		bboxEndIndex: u32,
	}

	struct Params {
		minX: f32,
		minY: f32,
		invSize: f32,
		bboxBaseIndex: i32,
		step: u32,
		shift: u32,
		srcNodeStartIndex: u32,
		srcNodeEndIndex: u32,
		dstNodeStartIndex: u32,
		maxLevel: u32,
		groupOffsetX: u32,
		invX: f32,
		invY: f32,
		shiftedResultId: u32,
	}

	struct IdStartIndex {
		id: u32,
		startIndex: u32,
	}

	struct InfoStartIndexsR {
		ptNum: u32,
		nextStartIndex: u32,
        idStartIndexs: array<IdStartIndex>,
	}

	@binding(11) @group(0) var<storage, read_write> infoStartIndexs: InfoStartIndexsR;
	@binding(12) @group(0) var<storage, read_write> sortedPts: array<f32>;
	@binding(0) @group(0) var<storage, read_write> pts: array<f32>;
	@binding(1) @group(0) var<storage, read_write> bboxs: array<BBox>;
	@binding(2) @group(0) var<storage, read_write> nodes: array<Node>;
	@binding(3) @group(0) var<storage, read_write> units: array<Unit>;
    @binding(4) @group(0) var<uniform> params: Params;
    @binding(4) @group(0) var<storage, read_write> paramsW: Params;

	@compute @workgroup_size(${i})
    fn buildBBoxs(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let coordX = params.groupOffsetX * ${i} + coord.x;
		if (coordX >= arrayLength(&bboxs)) {
			return;
		}

		let startIndex = infoStartIndexs.idStartIndexs[coordX].startIndex;
		let head = u32(pts[startIndex]);
        let type0 = (head & ${ar}) >> ${ft};
		bboxs[coordX].mortonCode = 0; // \u6B64\u884C\u4EE3\u7801\u662F\u591A\u4F59\u7684\uFF0C\u4F46\u662F\u6CA1\u6709\u53EF\u80FD\u4F1A\u5BFC\u81F4 bug
		if (type0 == ${0}) {
			bboxs[coordX].minX = pts[startIndex + 1] - pts[startIndex + 3];
			bboxs[coordX].maxX = pts[startIndex + 1] + pts[startIndex + 3];
			bboxs[coordX].minY = pts[startIndex + 2] - pts[startIndex + 3];
			bboxs[coordX].maxY = pts[startIndex + 2] + pts[startIndex + 3];
		} else if (type0 == ${1}) {
			bboxs[coordX].minX = min(pts[startIndex + 1], pts[startIndex + 3]) - pts[startIndex + 5] / 2.0;
			bboxs[coordX].maxX = max(pts[startIndex + 1], pts[startIndex + 3]) + pts[startIndex + 5] / 2.0;
			bboxs[coordX].minY = min(pts[startIndex + 2], pts[startIndex + 4]) - pts[startIndex + 5] / 2.0;
			bboxs[coordX].maxY = max(pts[startIndex + 2], pts[startIndex + 4]) + pts[startIndex + 5] / 2.0;
		} else if (type0 == ${2}) {
			let centerX = pts[startIndex + 1];
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let width2 = pts[startIndex + 4] / 2;
			let startAngle = pts[startIndex + 5];
			let endAngle = startAngle + pts[startIndex + 6];
			var x = cos(startAngle);
			var y = sin(startAngle);
			var minX = x;
			var maxX = x;
			var minY = y;
			var maxY = y;
			x = cos(endAngle);
			y = sin(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			minY = min(minY, y);
			maxY = max(maxY, y);
			for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
				x = cos(angle);
				y = sin(angle);
				minX = min(minX, x);
				maxX = max(maxX, x);
				minY = min(minY, y);
				maxY = max(maxY, y);
			}
			bboxs[coordX].minX = minX * radius - width2 + centerX;
			bboxs[coordX].maxX = maxX * radius + width2 + centerX;
			bboxs[coordX].minY = minY * radius - width2 + centerY;
			bboxs[coordX].maxY = maxY * radius + width2 + centerY;
		} else if (type0 == ${3}) {
			bboxs[coordX].minX = min(min(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]);
			bboxs[coordX].maxX = max(max(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]);
			bboxs[coordX].minY = min(min(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]);
			bboxs[coordX].maxY = max(max(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]);
		} else if (type0 == ${4}) {
			let leftUpPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]);
			let width = pts[startIndex + 3];
			let height = pts[startIndex + 4];
			let angle = radians(pts[startIndex + 5]);
			let radius = pts[startIndex + 7];

			let cos0 = cos(angle);
			let sin0 = sin(angle);
			let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0);

			let luPoint = leftUpPoint + mat0 * vec2(radius, -radius);
			let ldPoint = leftUpPoint + mat0 * vec2(radius, radius - height);
			let ruPoint = leftUpPoint + mat0 * vec2(width - radius, -radius);
			let rdPoint = leftUpPoint + mat0 * vec2(width - radius, radius - height);
			
			bboxs[coordX].minX = min(min(luPoint.x, ldPoint.x), min(ruPoint.x, rdPoint.x)) - radius;
			bboxs[coordX].maxX = max(max(luPoint.x, ldPoint.x), max(ruPoint.x, rdPoint.x)) + radius;
			bboxs[coordX].minY = min(min(luPoint.y, ldPoint.y), min(ruPoint.y, rdPoint.y)) - radius;
			bboxs[coordX].maxY = max(max(luPoint.y, ldPoint.y), max(ruPoint.y, rdPoint.y)) + radius;
		} else if (type0 == ${5}) {
			let centerX = pts[startIndex + 1];
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 4];
			let endAngle = startAngle + pts[startIndex + 5];
			var x = cos(startAngle);
			var y = sin(startAngle);
			var minX = x;
			var maxX = x;
			var minY = y;
			var maxY = y;
			x = cos(endAngle);
			y = sin(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			minY = min(minY, y);
			maxY = max(maxY, y);
			if (startAngle < endAngle) {
				for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
					x = cos(angle);
					y = sin(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			} else {
				for (var angle = floor(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle > endAngle; angle -= ${Math.PI/2}) {
					x = cos(angle);
					y = sin(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			}
			bboxs[coordX].minX = minX * radius + centerX;
			bboxs[coordX].maxX = maxX * radius + centerX;
			bboxs[coordX].minY = minY * radius + centerY;
			bboxs[coordX].maxY = maxY * radius + centerY;
		}
	}

	struct LocalBBox {
		minX: f32,
		maxX: f32,
		minY: f32,
		maxY: f32,
	}
	var<workgroup> localBBoxs: array<LocalBBox, ${t}>;

	fn selectU(a: u32, b: u32, condition: bool) -> u32 {
		return select(a, b, condition);
	}

	fn ceilU(a: u32, b: u32) -> u32 {
		return a / b + selectU(1, 0, a % b == 0);
	}

	fn ceilI(a: i32, b: i32) -> i32 {
		return a / b + select(1, 0, a % b == 0);
	}

	@compute @workgroup_size(${i})
    fn buildBBox(
		@builtin(local_invocation_id) locCoord : vec3<u32>,
        @builtin(workgroup_id) groupId : vec3<u32>,
    ) {
		let bboxStep2 = params.step * 2;
		let bboxNum = arrayLength(&bboxs);
		let groupX = params.groupOffsetX + groupId.x;
		let groupStart = groupX * ${t} * bboxStep2;
		let groupEnd = select(min((groupX + 1) * ${t} * bboxStep2, bboxNum), bboxNum, (groupX + 1) * bboxStep2 >= ${2**32/t});
		let threadStart = select(groupStart + locCoord.x * bboxStep2, groupEnd, locCoord.x >= ceilU(groupEnd - groupStart, bboxStep2));
		let add = select(${i} * bboxStep2, groupEnd - threadStart, bboxStep2 >= ${2**32/i});
		for (var i = threadStart; i < groupEnd; i += add) {
			let nextI = i + params.step;
			let localBBoxIndex = (i - groupStart) / bboxStep2;
			if (nextI < groupEnd) {
				localBBoxs[localBBoxIndex].minX = min(bboxs[i].minX, bboxs[nextI].minX);
				localBBoxs[localBBoxIndex].maxX = max(bboxs[i].maxX, bboxs[nextI].maxX);
				localBBoxs[localBBoxIndex].minY = min(bboxs[i].minY, bboxs[nextI].minY);
				localBBoxs[localBBoxIndex].maxY = max(bboxs[i].maxY, bboxs[nextI].maxY);
			} else {
				localBBoxs[localBBoxIndex].minX = bboxs[i].minX;
				localBBoxs[localBBoxIndex].maxX = bboxs[i].maxX;
				localBBoxs[localBBoxIndex].minY = bboxs[i].minY;
				localBBoxs[localBBoxIndex].maxY = bboxs[i].maxY;
			}
		}

		workgroupBarrier();

		let num = ceilU(groupEnd - groupStart, bboxStep2);
		var step: u32 = 1;
		while (step < num) {
			let threadStep = step * ${i*2};
			for (var i = locCoord.x * step * 2 + step; i < num; i += threadStep) {
				let lastI = i - step;
				localBBoxs[lastI].minX = min(localBBoxs[i].minX, localBBoxs[lastI].minX);
				localBBoxs[lastI].maxX = max(localBBoxs[i].maxX, localBBoxs[lastI].maxX);
				localBBoxs[lastI].minY = min(localBBoxs[i].minY, localBBoxs[lastI].minY);
				localBBoxs[lastI].maxY = max(localBBoxs[i].maxY, localBBoxs[lastI].maxY);
			}
			step *= 2;
			workgroupBarrier();
		}

		if (locCoord.x == 0) {
			bboxs[groupStart].minX = localBBoxs[0].minX;
			bboxs[groupStart].maxX = localBBoxs[0].maxX;
			bboxs[groupStart].minY = localBBoxs[0].minY;
			bboxs[groupStart].maxY = localBBoxs[0].maxY;
		}
	}

	@compute @workgroup_size(${i})
    fn calMortonCode(
        @builtin(global_invocation_id) coord : vec3<u32>,
    ) {
		let coordX = params.groupOffsetX * ${i} + coord.x;
		if(coordX >= arrayLength(&bboxs)){
			return;
		}

		setMortonCode(coordX);
	}
	
	
    @binding(5) @group(0) var<storage, read_write> sortedInfoStartIndexs: InfoStartIndexsR;
    @binding(6) @group(0) var<storage, read_write> sortedBBoxs: array<BBox>;
    @binding(7) @group(0) var<storage, read_write> statusArr: array<atomic<u32>>;
    @binding(8) @group(0) var<storage, read_write> counter: atomic<u32>;
	var<workgroup> prefixs: array<u32, ${n}>;
	var<workgroup> groupOrder: u32;

    @binding(9) @group(0) var<storage, read_write> prefixSums : array<u32>;

	fn reduce(locCoordX: u32) -> u32 {
		var step: u32 = 1;
		while(step < ${n}){
			let threadStep = step * ${i*2};
			for(var i = (locCoordX + 1) * step * 2 - 1; i < ${n}; i += threadStep){
				prefixs[i] = prefixs[i - step] + prefixs[i];
			}
			step *= 2;
			workgroupBarrier();
		}
		return step;
	}

	@compute @workgroup_size(${i})
    fn calPrefixSumByBBoxs(
		@builtin(local_invocation_id) locCoord : vec3<u32>,
        @builtin(workgroup_id) groupId : vec3<u32>,
    ) {
		let groupX = params.groupOffsetX + groupId.x;
		let groupStart = groupX * ${n} * 2;
		let threadStart = groupStart + locCoord.x * 2;
		let groupEnd = min((groupX + 1) * ${n} * 2, arrayLength(&bboxs));
		for(var i = threadStart; i < groupEnd; i += ${i*2}){
			prefixs[(i - groupStart) / 2] =
				select((((bboxs[i].mortonCode >> params.shift) & 1) ^ 1) + (((bboxs[i + 1].mortonCode >> params.shift) & 1) ^ 1),
				((bboxs[i].mortonCode >> params.shift) & 1) ^ 1, i + 1 == groupEnd);
		}
		workgroupBarrier();

		reduce(locCoord.x);
		if(locCoord.x == 0){
			prefixSums[groupX] = prefixs[${n-1}];
		}
	}

	@compute @workgroup_size(${i})
    fn calPrefixSumBySums(
		@builtin(local_invocation_id) locCoord : vec3<u32>,
        @builtin(workgroup_id) groupId : vec3<u32>,
    ) {
		let groupX = params.groupOffsetX + groupId.x;
		let step2 = params.step * 2;
		let groupStart = groupX * ${n} * step2;
		let groupEnd = min((groupX + 1) * ${n} * step2, arrayLength(&prefixSums));
		let threadStart = groupStart + locCoord.x * step2;
		for(var i = threadStart; i < groupEnd; i += ${i} * step2){
			let nextI = i + params.step;
			prefixs[(i - groupStart) / step2] = select(prefixSums[i] + prefixSums[nextI], prefixSums[i], nextI >= groupEnd);
		}
		workgroupBarrier();

		reduce(locCoord.x);
		if(locCoord.x == 0){
			prefixSums[groupStart] = prefixs[${n-1}];
		}
	}

	fn prefixScan(locCoordX: u32) -> u32 {
		var step = reduce(locCoordX);

		let aggregate = prefixs[${n-1}];
		if(groupOrder == 0){
			if(locCoordX == 0){
				atomicStore(&statusArr[groupOrder], 0x80000000 | aggregate);
			}
		}else if(locCoordX == 0){
			atomicStore(&statusArr[groupOrder], 0x40000000 | aggregate);
		}
		workgroupBarrier();

		prefixs[${n-1}] = 0;
		workgroupBarrier();

		while(step != 1){
			step /= 2;
			let threadStep = step * ${i*2};
			for(var i = (locCoordX + 1) * step * 2 - 1; i < ${n}; i += threadStep){
				let leftI = i - step;
				let cur = prefixs[i];
				prefixs[i] = cur + prefixs[leftI];
				prefixs[leftI] = cur;
			}
			workgroupBarrier();
		}

		if(groupOrder != 0 && locCoordX == 0){
			var preAggregate: u32 = 0;
			var prevIndex = groupOrder - 1;
			var prevStatus = atomicLoad(&statusArr[prevIndex]);
			while((prevStatus & 0x80000000) == 0){
				if((prevStatus & 0x40000000) != 0){
					preAggregate += (prevStatus & 0x3fffffff);
					prevIndex--;
				}
				prevStatus = atomicLoad(&statusArr[prevIndex]);
			}
			atomicStore(&statusArr[groupOrder], 0x80000000 | (aggregate + preAggregate + (prevStatus & 0x3fffffff)));
		}
		workgroupBarrier();

		return (atomicLoad(&statusArr[groupOrder]) & 0x3fffffff) - aggregate;
	}

	@compute @workgroup_size(${i})
    fn sort(
		@builtin(local_invocation_id) locCoord : vec3<u32>,
    ) {
		if(locCoord.x == 0){
			groupOrder = atomicAdd(&counter, 1);
		}
		workgroupBarrier();

		let groupStart = groupOrder * ${n};
		let threadStart = groupStart + locCoord.x;
		let bboxNum = arrayLength(&bboxs);
		let groupEnd = min((groupOrder + 1) * ${n}, bboxNum);
		for(var i = threadStart; i < groupEnd; i += ${i}){
			prefixs[i - groupStart] = ((bboxs[i].mortonCode >> params.shift) & 1) ^ 1;
		}
		workgroupBarrier();

		let groupExPrefix = prefixScan(locCoord.x);
		for(var i = threadStart; i < groupEnd; i += ${i}){
			let prefix = prefixs[i - groupStart] + groupExPrefix;
			let dstIndex = select(prefixSums[0] + i - prefix, prefix, ((bboxs[i].mortonCode >> params.shift) & 1) == 0);
			sortedBBoxs[dstIndex] = bboxs[i];
			sortedInfoStartIndexs.idStartIndexs[dstIndex] = infoStartIndexs.idStartIndexs[i];
		}
	}

	@compute @workgroup_size(${i})
    fn sortPts(
		@builtin(local_invocation_id) locCoord : vec3<u32>,
    ) {
		if(locCoord.x == 0){
			groupOrder = atomicAdd(&counter, 1);
		}
		workgroupBarrier();

		let groupStart = groupOrder * ${n};
		let threadStart = groupStart + locCoord.x;
		let objNum = arrayLength(&infoStartIndexs.idStartIndexs);
		let groupEnd = min((groupOrder + 1) * ${n}, objNum);
		for(var i = threadStart; i < groupEnd; i += ${i}){
			let startIndex = infoStartIndexs.idStartIndexs[i].startIndex;
			let head = u32(pts[startIndex]);
			let type0 = (head & ${ar}) >> ${ft};
			let addiNum = selectU(1, 0, (head & ${Ct}) == 0) + selectU(1, 0, (head & ${Mt}) == 0);
			if (type0 == ${0}) {
				prefixs[i - groupStart] = ${on.length} + addiNum;
			} else if (type0 == ${1}) {
				prefixs[i - groupStart] = ${an.length} + addiNum;
			} else if (type0 == ${2}) {
				prefixs[i - groupStart] = ${sn.length} + addiNum;
			} else if (type0 == ${3}) {
				prefixs[i - groupStart] = ${_r.length} + addiNum;
			} else if (type0 == ${4}) {
				prefixs[i - groupStart] = ${ln.length} + addiNum;
			} else if (type0 == ${5}) {
				prefixs[i - groupStart] = ${$r.length} + addiNum;
			}
		}
		workgroupBarrier();

		let groupExPrefix = prefixScan(locCoord.x);
		for(var i = threadStart; i < groupEnd; i += ${i}){
			let startIndex = infoStartIndexs.idStartIndexs[i].startIndex;
			let head = u32(pts[startIndex]);
			let type0 = (head & ${ar}) >> ${ft};
			var num = selectU(1, 0, (head & ${Ct}) == 0) + selectU(1, 0, (head & ${Mt}) == 0);
			if (type0 == ${0}) {
				num += ${on.length};
			} else if (type0 == ${1}) {
				num += ${an.length};
			} else if (type0 == ${2}) {
				num += ${sn.length};
			} else if (type0 == ${3}) {
				num += ${_r.length};
			} else if (type0 == ${4}) {
				num += ${ln.length};
			} else if (type0 == ${5}) {
				num += ${$r.length};
			}

			let prefix = prefixs[i - groupStart] + groupExPrefix;
			for(var j: u32 = 0; j < num; j++){
				sortedPts[prefix + j] = pts[startIndex + j];
			}
			infoStartIndexs.idStartIndexs[i].startIndex = prefix;
		}
	}

	@compute @workgroup_size(${i})
    fn calUnits(
		@builtin(global_invocation_id) coord : vec3<u32>,
    ) {
		let coordX = params.groupOffsetX * ${i} + coord.x;
		let nextI = coordX + 1;
		let bboxNum = arrayLength(&bboxs);
		if(nextI >= bboxNum){
			if(nextI == bboxNum){
				units[bboxs[coordX].mortonCode >> params.shift].bboxEndIndex = nextI;
			}
			return;
		}

		let left = bboxs[coordX].mortonCode >> params.shift;
		let right = bboxs[nextI].mortonCode >> params.shift;
		if(left != right) {
			units[left].bboxEndIndex = nextI;
			units[right].bboxStartIndex = nextI;
		}
	}

	@binding(10) @group(0) var<storage, read_write> groupNodeStartIndexs: array<u32>;
	@binding(13) @group(0) var<storage, read_write> ptIndexs: array<u32>;
	@binding(14) @group(0) var<storage, read_write> ids: array<u32>;

	@compute @workgroup_size(${i})
    fn buildNodesByGroups(
		@builtin(global_invocation_id) coord : vec3<u32>,
	) {
		if(coord.x >=  arrayLength(&units)){
			return;
		}

		let unit = units[coord.x];
		let nodeStartIndex = groupNodeStartIndexs[coord.x * params.maxLevel];
		let idOffset = (nodeStartIndex - groupNodeStartIndexs[0]) * ${e} - unit.bboxStartIndex;
		for(var i = unit.bboxStartIndex; i < unit.bboxEndIndex; i += ${e}){
			var node: Node;
			node.minX = ${Sn};
			node.maxX = ${-Sn};
			node.minY = ${Sn};
			node.maxY = ${-Sn};
			let end = min(i + ${e}, unit.bboxEndIndex);
			for(var j = i; j < end; j++){
				let bbox = bboxs[j];
				node.minX = min(node.minX, bbox.minX);
				node.maxX = max(node.maxX, bbox.maxX);
				node.minY = min(node.minY, bbox.minY);
				node.maxY = max(node.maxY, bbox.maxY);
				node.childIndexs[j - i] = -i32(infoStartIndexs.idStartIndexs[j].startIndex) - 1 - params.bboxBaseIndex;
				ptIndexs[infoStartIndexs.idStartIndexs[j].id] = params.shiftedResultId + idOffset + j;
				ids[idOffset + j] = infoStartIndexs.idStartIndexs[j].id;
			}
			nodes[nodeStartIndex + (i - unit.bboxStartIndex) / ${e}] = node;
		}
	
		var nodeNum = ceilU(unit.bboxEndIndex - unit.bboxStartIndex, ${e});
		let end = (coord.x + 1) * params.maxLevel;
		for(var i = coord.x * params.maxLevel + 1; i < end; i++) {
			let nodeStartIndex = groupNodeStartIndexs[i - 1];
			let nodeEndIndex = nodeStartIndex + nodeNum;
			var nodeIndex = i32(groupNodeStartIndexs[i]);
			for(var i = nodeStartIndex; i < nodeEndIndex; i += ${e}){
				var node: Node;
				node.minX = ${Sn};
				node.maxX = ${-Sn};
				node.minY = ${Sn};
				node.maxY = ${-Sn};
				let end = min(i + ${e}, nodeEndIndex);
				for(var j = i; j < end; j++){
					let node0 = nodes[j];
					node.minX = min(node.minX, node0.minX);
					node.maxX = max(node.maxX, node0.maxX);
					node.minY = min(node.minY, node0.minY);
					node.maxY = max(node.maxY, node0.maxY);
					node.childIndexs[j - i] = i32(j);
				}
				nodes[nodeIndex] = node;
				nodeIndex++;
			}
			nodeNum = ceilU(nodeNum, ${e});
		}
	}

	@compute @workgroup_size(${i})
    fn buildNodesByNodes(
		@builtin(global_invocation_id) coord : vec3<u32>,
    ) {
		let coordX = params.groupOffsetX * ${i} + coord.x;
		let start = i32(coordX * ${e} + params.srcNodeStartIndex);
		let end = min(start + ${e}, i32(params.srcNodeEndIndex));
		if(end <= start){
			return;
		}

		var node: Node;
		node.minX = ${Sn};
		node.maxX = ${-Sn};
		node.minY = ${Sn};
		node.maxY = ${-Sn};
		for(var i = start; i < end; i++){
			let node0 = nodes[i];
			node.minX = min(node.minX, node0.minX);
			node.maxX = max(node.maxX, node0.maxX);
			node.minY = min(node.minY, node0.minY);
			node.maxY = max(node.maxY, node0.maxY);
			node.childIndexs[i - start] = i;
		}
		nodes[coordX + params.dstNodeStartIndex] = node;
	}`}var hg={};function VF(r,e){if(!hg[e]){let t=r.device.createShaderModule({code:XF(r,e)});hg[e]={buildBBoxs:r.createComputePipeline(t,"buildBBoxs"),buildBBox:r.createComputePipeline(t,"buildBBox"),calMortonCode:r.createComputePipeline(t,"calMortonCode"),calPrefixSumByBBoxs:r.createComputePipeline(t,"calPrefixSumByBBoxs"),calPrefixSumBySums:r.createComputePipeline(t,"calPrefixSumBySums"),sortPts:r.createComputePipeline(t,"sortPts"),sort:r.createComputePipeline(t,"sort"),buildNodesByNodes:r.createComputePipeline(t,"buildNodesByNodes"),calUnits:r.createComputePipeline(t,"calUnits"),buildNodesByGroups:r.createComputePipeline(t,"buildNodesByGroups")}}return hg[e]}var dg,Fv,qv;function WF(r){if(dg)return;let{bboxNum:e,prefixNum:t}=yd(r),n=e*2,i=1,s=[];for(;i<Number.MAX_SAFE_INTEGER;)s.push(i),i*=n;dg=r.createStaticBuffer(new Uint32Array(s),GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST);let o=Math.ceil(Number.MAX_SAFE_INTEGER/t/2),a=1,l=[];for(;a<o;)l.push(a),a*=t*2;Fv=r.createStaticBuffer(new Uint32Array(l),GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),qv=r.createStaticBuffer(new Uint32Array(new Array(1024).fill(0).map((u,c)=>c*r.limits.maxComputeWorkgroupsPerDimension)),GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}var wd=class{constructor(e,t,n,i,s,o,a){this.nodeRanges=[];if(this.gpu=t,this.capacity=e,this.clear(),this.ptNum=n,this.infoStartIndexsBuf=i,this.ptsBuf=s,this.ptIndexsBuf=a,this.resultId=o.findEmpty(),this.resultId===-1)throw new Error("this.resultId === -1");o.markUsed(this.resultId),WF(t),this.pipelineDict=VF(t,e)}clear(){var e;this.changed=!0,(e=this.buildedNodesBuf)==null||e.destroy(),delete this.buildedNodesBuf,this.maxLevel=0,delete this.bbox}getTreeInfo(e){let t=0,n=0;do n++,e=Math.ceil(e/this.capacity),t+=e;while(e>1);return{nodeSum:t,level:n}}async build(){var o;if(!this.changed)return{resultId:this.resultId,ptNumsArr:this.ptNumsArr,nodesBuf:this.buildedNodesBuf,maxLevel:this.maxLevel,nodeRanges:this.nodeRanges.slice(),bbox:this.bbox,idsBuf:this.buildedIdsBuf};if(this.changed=!1,(o=this.buildedNodesBuf)==null||o.destroy(),this.bbox=null,this.ptNum===0)throw new Error("this.ptNum === 0");let{gpu:e}=this;await e.device.queue.onSubmittedWorkDone(),console.time("rtree.build"),this.ptNumsArr=await Gv(this.gpu,this.infoStartIndexsBuf,this.ptsBuf);let t=Qa+1,n=e.createDynamicBuffer(this.ptNum*t,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),i=e.createDynamicBuffer(14,GPUBufferUsage.UNIFORM|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST),s=e.createDynamicBuffer(1,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST);if(await this.buildBBoxs(this.ptsBuf,n,this.infoStartIndexsBuf,i),await this.buildBBox(n,i),this.calMortonCode(n,i),await this.sort(this.infoStartIndexsBuf,n,this.ptsBuf,i,s),this.ptNum<4e4)throw new Error("this.ptNum < 40000");return await this.buildGroupedNodes(n,this.infoStartIndexsBuf,i,s),n.destroy(),i.destroy(),s.destroy(),this.infoStartIndexsBuf.setSize(0),await e.device.queue.onSubmittedWorkDone(),console.timeEnd("rtree.build"),{resultId:this.resultId,ptNumsArr:this.ptNumsArr,nodesBuf:this.buildedNodesBuf,maxLevel:this.maxLevel,nodeRanges:this.nodeRanges.slice(),bbox:this.bbox,idsBuf:this.buildedIdsBuf}}dispatchWorkgroups(e,t,n,i,s,o=!0){this.gpu.runComputePass(i,t,n,e*this.gpu.limits.maxComputeWorkgroupSizeX,a=>{o&&this.gpu.copyBufferToBuffer(qv,a,s,10,1,i)})}async buildBBoxs(e,t,n,i){let s=this.gpu.device,o=this.gpu.createBindGroup(this.pipelineDict.buildBBoxs.getBindGroupLayout(0),0,e,1,t,4,i,11,n),a=s.createCommandEncoder();this.dispatchWorkgroups(Math.ceil(this.ptNum/this.gpu.limits.maxComputeWorkgroupSizeX),this.pipelineDict.buildBBoxs,o,a,i),s.queue.submit([a.finish()])}async buildBBox(e,t){let{gpu:n}=this,{device:i}=n,s=n.createDynamicBuffer(e.getSize(),GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),o=i.createCommandEncoder();n.copyBufferToBuffer(e,0,s,0,e.getSize(),o);let a=this.pipelineDict.buildBBox,l=n.createBindGroup(a.getBindGroupLayout(0),1,s,4,t),u=yd(n).bboxNum*2,c=1,h=0;for(;c<this.ptNum;){n.copyBufferToBuffer(dg,h++,t,4,1,o);let d=Math.ceil(this.ptNum/c);this.dispatchWorkgroups((d%u===1?Math.floor:Math.ceil)(d/u),a,l,o,t),c*=u}n.submit(o);let f=new Float32Array(await s.read(0,4));this.bbox=new ye(f[0],f[1],f[2],f[3]),t.write(0,new Float32Array([this.bbox.minX,this.bbox.minY,1/Math.max(this.bbox.maxX-this.bbox.minX,this.bbox.maxY-this.bbox.minY)])),t.write(11,new Float32Array([1/(this.bbox.maxX-this.bbox.minX),1/(this.bbox.maxY-this.bbox.minY)])),s.destroy()}calMortonCode(e,t){let{device:n}=this.gpu,i=this.pipelineDict.calMortonCode,s=this.gpu.createBindGroup(i.getBindGroupLayout(0),1,e,4,t),o=n.createCommandEncoder();this.dispatchWorkgroups(Math.ceil(this.ptNum/this.gpu.limits.maxComputeWorkgroupSizeX),i,s,o,t),n.queue.submit([o.finish()])}async sort(e,t,n,i,s){let{gpu:o}=this,{device:a}=o,{prefixNum:l}=yd(o),u=Math.ceil(this.ptNum/l),c=o.createDynamicBuffer(u,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST),h=o.createDynamicBuffer(e.getSize(),e.usage),f=o.createDynamicBuffer(t.getSize(),t.usage),d=o.createDynamicBuffer(Math.ceil(this.ptNum/l/2),GPUBufferUsage.STORAGE),m=o.createBindGroup(this.pipelineDict.calPrefixSumByBBoxs.getBindGroupLayout(0),1,t,4,i,9,d),p=o.createBindGroup(this.pipelineDict.calPrefixSumBySums.getBindGroupLayout(0),4,i,9,d),g=new Array(2).fill("").map((P,_)=>o.createBindGroup(this.pipelineDict.sort.getBindGroupLayout(0),11,_==0?e:h,1,_==0?t:f,4,i,5,_==0?h:e,6,_==0?f:t,7,c,8,s,9,d)),b=30,v=Math.ceil(this.ptNum/l/2),w=a.createCommandEncoder();for(let P=0;P<b;P++){P!==0&&c.clear(w),o.copyBufferToBuffer(o.numBuf,P,i,5,1,w),s.clear(w),this.dispatchWorkgroups(v,this.pipelineDict.calPrefixSumByBBoxs,m,w,i);let _=1,B=0;for(;_<v;)o.copyBufferToBuffer(Fv,B++,i,4,1,w),this.dispatchWorkgroups(Math.ceil(v/(_*=l*2)),this.pipelineDict.calPrefixSumBySums,p,w,i);this.dispatchWorkgroups(u,this.pipelineDict.sort,g[P%2],w,i,!1)}o.submit(w),await this.sortPts(c,n,e,u,i,s),c.destroy(),d.destroy(),h.destroy(),f.destroy()}async sortPts(e,t,n,i,s,o){if(this.ptNum>2e7)throw new Error("this.ptNum > 20000000");let{gpu:a}=this,l=a.createDynamicBuffer(t.getSize(),t.usage),u=a.device.createCommandEncoder();o.clear(u),e.clear(u);let c=a.createBindGroup(this.pipelineDict.sortPts.getBindGroupLayout(0),0,t,7,e,8,o,11,n,12,l);this.dispatchWorkgroups(i,this.pipelineDict.sortPts,c,u,s,!1),a.submit(u),this.ptsBuf.setDynamicBuffer(l)}async calUnits(e,t){let{gpu:n}=this,{device:i}=n,s=Math.ceil(Math.log2(Math.ceil(this.ptNum/2048))/2)*2,o=30-s;n.writeBuffer(t,5,new Uint32Array([o]));let a=2**s,l=n.createDynamicBuffer(2*a,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE);{let h=n.createBindGroup(this.pipelineDict.calUnits.getBindGroupLayout(0),1,e,3,l,4,t),f=i.createCommandEncoder();this.dispatchWorkgroups(Math.ceil(this.ptNum/n.limits.maxComputeWorkgroupSizeX),this.pipelineDict.calUnits,h,f,t),n.submit(f)}let u=new Uint32Array(await l.read());l.destroy();let c=[];for(let h=0;h<u.length;h+=2)u[h]!==u[h+1]&&c.push(u[h],u[h+1]);return{units:new Uint32Array(c),unitNum:c.length/2}}buildNodesByGroups(e,t,n,i,s,o,a,l){let{gpu:u}=this;this.buildedIdsBuf=u.createDynamicBuffer(this.nodeRanges[0].nodeNum*this.capacity,GPUBufferUsage.STORAGE);let c=u.createStaticBuffer(o,GPUBufferUsage.STORAGE);u.writeBuffer(a,13,new Uint32Array([this.resultId<<vd]));let h=u.device,f=u.createBindGroup(this.pipelineDict.buildNodesByGroups.getBindGroupLayout(0),1,t,2,n,3,i,4,a,10,c,11,s,13,this.ptIndexsBuf,14,this.buildedIdsBuf),d=h.createCommandEncoder();l.clear(d),this.dispatchWorkgroups(Math.ceil(e/u.limits.maxComputeWorkgroupSizeX),this.pipelineDict.buildNodesByGroups,f,d,a,!1),u.submit(d),c.destroy()}async buildGroupedNodes(e,t,n,i){let{gpu:s}=this,{units:o,unitNum:a}=await this.calUnits(e,n),l=s.createDynamicBuffer(o.length,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE);s.writeBuffer(l,0,o);let u=0,c=0,h;this.nodeRanges.length=0;{let b=[];for(let _=0;_<o.length;_+=2){let B=[],I=o[_+1]-o[_],C=0;do C++,I=Math.ceil(I/this.capacity),B.push(I);while(I>1);b.push(B),C>c&&(c=C)}h=new Uint32Array(c*a);let v=1;for(let _=0;_<c;_++){let B=v;for(let I=0;I<a;I++)h[I*c+_]=v,v+=b[I][_]||1;this.nodeRanges.push({startNodeIndex:B,nodeNum:v-B})}let{nodeSum:w,level:P}=this.getTreeInfo(a);u=v-1+w,this.maxLevel=c+P}s.writeBuffer(n,9,new Uint32Array([c])),this.buildedNodesBuf=s.createDynamicBuffer((this.capacity+Qa)*u,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.VERTEX),this.buildNodesByGroups(a,e,this.buildedNodesBuf,l,t,h,n,i);let f=a,d=h[c-1],m=d+f,p=[];do p.push(d,m,m===u?0:m),f=Math.ceil(f/this.capacity),d=m,m=d+f,this.nodeRanges.push({startNodeIndex:d===u?0:d,nodeNum:f});while(f!==1);let g=s.createDynamicBuffer(p.length,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST);s.writeBuffer(g,0,new Uint32Array(p));{let b=s.createBindGroup(this.pipelineDict.buildNodesByNodes.getBindGroupLayout(0),2,this.buildedNodesBuf,4,n),v=s.device.createCommandEncoder();for(let w=0;w<p.length;w+=3)s.copyBufferToBuffer(g,w,n,6,3,v),this.dispatchWorkgroups(Math.ceil((p[w+1]-p[w])/this.capacity/s.limits.maxComputeWorkgroupSizeX),this.pipelineDict.buildNodesByNodes,b,v,n);s.submit(v)}l.destroy(),g.destroy()}};function $F(r,e){return`
    struct Uniforms {
        startNodeIndex: u32,
        nodeNum: u32,
    }

    struct Node {
        minX: f32,
        maxX: f32,
        minY: f32,
        maxY: f32,
        childIndexs: array<i32, ${e}>,
    }

	struct IdStartIndex {
		id: u32,
		startIndex: i32,
	}

	struct InfoStartIndexs {
		ptNum: atomic<u32>,
		nextStartIndex: atomic<i32>,
        idStartIndexs: array<IdStartIndex>,
	}

    @binding(0) @group(0) var<uniform> uniforms: Uniforms;
	@binding(1) @group(0) var<storage, read> nodes: array<Node>;
	@binding(2) @group(0) var<storage, read> ids: array<u32>;
	@binding(3) @group(0) var<storage, read> ptsR: array<f32>;
	@binding(4) @group(0) var<storage, read_write> infoStartIndexs: InfoStartIndexs;
	@binding(5) @group(0) var<storage, read_write> pts: array<f32>;
    
    
	@compute @workgroup_size(${r.limits.maxComputeWorkgroupSizeX})
    fn extractInfoStartIndexs(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
        if(coord.x >= uniforms.nodeNum){
            return;
        }

        let childIndexs = nodes[coord.x + uniforms.startNodeIndex].childIndexs;
		let idOffset = coord.x * ${e};
        for(var i: u32 = 0; i < ${e}; i++){
            if(childIndexs[i] < 0) {
				let startIndex = -childIndexs[i] - 1;
				let head = u32(ptsR[startIndex]);
				let type0 = (head & ${ar}) >> ${ft};
				var ptLength = select(1, 0, (head & ${Ct}) == 0) + select(1, 0, (head & ${Mt}) == 0);
				if (type0 == ${0}) {
					ptLength += ${on.length};
				} else if (type0 == ${1}) {
					ptLength += ${an.length};
				} else if (type0 == ${2}) {
					ptLength += ${sn.length};
				} else if (type0 == ${3}) {
					ptLength += ${_r.length};
				} else if (type0 == ${4}) {
					ptLength += ${ln.length};
				} else if (type0 == ${5}) {
					ptLength += ${$r.length};
				}
				let index = atomicAdd(&infoStartIndexs.ptNum, 1);
				let startIndex0 = atomicAdd(&infoStartIndexs.nextStartIndex, ptLength);
				infoStartIndexs.idStartIndexs[index].id = ids[idOffset + i];
				infoStartIndexs.idStartIndexs[index].startIndex = startIndex0;
				for(var i = 0; i < ptLength; i++){
					pts[startIndex0 + i] = ptsR[startIndex + i];
				}
            }
        }
    }
    `}var fg={};function jF(r,e){if(!fg[e]){let t=r.device.createShaderModule({code:$F(r,e)});fg[e]=r.createComputePipeline(t,"extractInfoStartIndexs")}return fg[e]}function Yv(r,e,t,n,i,s,o,a){s.setSize(os+a*2),s.write(0,new Uint32Array([0,0]));let l=r.createDynamicBuffer(2,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST);l.write(0,new Uint32Array([n[0].startNodeIndex,n[0].nodeNum]));let u=r.createDynamicBuffer(o.getSize(),o.usage),c=jF(r,i);return r.run(h=>r.runComputePass(h,c,r.createBindGroup(c.getBindGroupLayout(0),0,l,1,e,2,t,3,o,4,s,5,u),n[0].nodeNum)),l.destroy(),o.setDynamicBuffer(u),s.read(0,2).then(h=>{let f=new Uint32Array(h);return s.trim(os+f[0]*2),o.trim(f[1]),{ptNum:f[0],nextStartIndex:f[1]}})}function HF(r){return`
	struct Params {
		coordXOffset: u32,
	}

	struct IdStartIndex {
		id: u32,
		startIndex: i32,
	}

	struct InfoStartIndexs {
		ptNum: atomic<u32>,
		nextStartIndex: atomic<i32>,
        idStartIndexs: array<IdStartIndex>,
	}

    @binding(0) @group(0) var<uniform> params: Params;
	@binding(1) @group(0) var<storage, read> ids: array<u32>;
	@binding(2) @group(0) var<storage, read> startIndexs: array<i32>;
	@binding(3) @group(0) var<storage, read> ptsR: array<f32>;
	@binding(4) @group(0) var<storage, read_write> infoStartIndexs: InfoStartIndexs;
	@binding(5) @group(0) var<storage, read_write> pts: array<f32>;

	@compute @workgroup_size(${r.limits.maxComputeWorkgroupSizeX})
    fn addPts(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let index = params.coordXOffset + coord.x;
		if(index >= arrayLength(&ids)){
			return;
		}

		let startIndex = startIndexs[index];
		if(startIndex < 0){
			return;
		}
		let head = u32(ptsR[startIndex]);
		let type0 = (head & ${ar}) >> ${ft};
		var ptLength = select(1, 0, (head & ${Ct}) == 0) + select(1, 0, (head & ${Mt}) == 0);
		if (type0 == ${0}) {
			ptLength += ${on.length};
		} else if (type0 == ${1}) {
			ptLength += ${an.length};
		} else if (type0 == ${2}) {
			ptLength += ${sn.length};
		} else if (type0 == ${3}) {
			ptLength += ${_r.length};
		} else if (type0 == ${4}) {
			ptLength += ${ln.length};
		} else if (type0 == ${5}) {
			ptLength += ${$r.length};
		}
		let index0 = atomicAdd(&infoStartIndexs.ptNum, 1);
		let startIndex0 = atomicAdd(&infoStartIndexs.nextStartIndex, ptLength);
		infoStartIndexs.idStartIndexs[index0].id = ids[index];
		infoStartIndexs.idStartIndexs[index0].startIndex = startIndex0;
		for(var i = 0; i < ptLength; i++){
			pts[startIndex0 + i] = ptsR[startIndex + i];
		}
	}
`}var Pd;function Xv(r,e,t,n,i,s){Pd||(Pd=r.createComputePipeline(r.device.createShaderModule({code:HF(r)}),"addPts"));let o=r.device,a=r.createDynamicBuffer(1,GPUBufferUsage.UNIFORM|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST),l=r.createBindGroup(Pd.getBindGroupLayout(0),0,a,1,e,2,t,3,n,4,i,5,s),u=o.createCommandEncoder();return r.runComputePass(u,Pd,l,e.getSize(),c=>r.copyBufferToBuffer(r.coordXOffsetBuf,c,a,0,1,u)),r.submit(u),a.destroy(),i.read(0,2).then(c=>{let h=new Uint32Array(c);return{ptNum:h[0],nextStartIndex:h[1]}})}var Mo=class{constructor(e,t,n=null){this.nextStartIndex=0;this.ptNum=0;this.fac=new Oe;this.changed=!0;if(this.gpu=e,this.capacity=t,this.parent=n,this.resultIdMap=(n==null?void 0:n.resultIdMap)||new Fn(2**_d),this.infoStartIndexsBuf=e.createDynamicBuffer(0,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.ptsBuf=e.createDynamicBuffer(0,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.initBuf(),!n){let i=2**(_d-(32-Ed));for(let s=0;s<i;s++)this.resultIdMap.markUsed(s)}}initBuf(){this.infoStartIndexsBuf.setSize(0),this.ptsBuf.setSize(0),this.nextStartIndex=0,this.ptNum=0}clear(){if(this.delBuildedResult(),this.parent){this.infoStartIndexsBuf.destroy(),this.ptsBuf.destroy(),this.child1&&(this.child1.clear(),this.child2.clear());return}this.initBuf(),this.fac.clear(),this.child1&&(this.child1.clear(),this.child2.clear(),delete this.child1,delete this.child2)}isChanged(){return this.changed}extBuffer(e,t){if(this.ptNum>=e)throw new Error("this.ptNum >= ptNum");this.infoStartIndexsBuf.extSize(os+e*2),this.ptsBuf.extSize(t||this.nextStartIndex+(e-this.ptNum)*8)}trimBuffer(){this.infoStartIndexsBuf.trim(os+this.ptNum*2),this.ptsBuf.trim(this.nextStartIndex)}ext(e){if(!e)return;let t=this;for(;t;)t.fac.ext1(e),t=t.parent}async extractBufs(){if(!this.buildedResult)return;let{ptNum:e,nextStartIndex:t}=await Yv(this.gpu,this.buildedResult.nodesBuf,this.buildedResult.idsBuf,this.buildedResult.nodeRanges,this.capacity,this.infoStartIndexsBuf,this.ptsBuf,this.ptNum);this.ptNum=e,this.nextStartIndex=t}delBuildedResult(){this.changed=!0,this.buildedResult&&(this.buildedResult.nodesBuf.destroy(),this.buildedResult.idsBuf.destroy(),this.resultIdMap.markRemove(this.buildedResult.resultId),delete this.buildedResult)}async split(e=!1){let t=this.gpu;this.child1?(await this.child1.extractBufs(),await this.child2.extractBufs()):(this.child1=new Mo(t,this.capacity,this),this.child2=new Mo(t,this.capacity,this)),this.child1.extBuffer(Math.min(this.child1.ptNum+this.ptNum,Ar)),this.child2.extBuffer(Math.min(this.child2.ptNum+this.ptNum,Ar));let[n,i,s]=await Pv(t,this.ptNum,this.infoStartIndexsBuf,this.ptsBuf,this.child1.fac.valid()?this.child1.fac.build():null,this.child1.infoStartIndexsBuf,this.child1.ptsBuf,this.child2.fac.valid()?this.child2.fac.build():null,this.child2.infoStartIndexsBuf,this.child2.ptsBuf);if(!this.child1.fac.valid()&&(i.ptNum===0||s.ptNum===0))throw new Error("!this.child1.fac.valid() && (result1.ptNum === 0 || result2.ptNum === 0)");this.ptNum=n.ptNum,this.nextStartIndex=n.nextStartIndex,this.trimBuffer(),this.child1.ptNum!==i.ptNum&&this.child1.delBuildedResult(),this.child1.buildedResult?this.child1.infoStartIndexsBuf.setSize(0):(this.child1.ext(i.bbox),this.child1.nextStartIndex=i.nextStartIndex,i.ptNum>Ar?(this.child1.ptNum=Ar,this.child1.infoStartIndexsBuf.write(0,new Uint32Array([Ar])),await this.child1.split()):this.child1.ptNum=i.ptNum,this.child1.trimBuffer()),this.child2.ptNum!==s.ptNum&&this.child2.delBuildedResult(),this.child2.buildedResult?this.child2.infoStartIndexsBuf.setSize(0):(this.child2.ext(s.bbox),this.child2.nextStartIndex=s.nextStartIndex,s.ptNum>Ar?(this.child2.ptNum=Ar,this.child2.infoStartIndexsBuf.write(0,new Uint32Array([Ar])),await this.child2.split()):this.child2.ptNum=s.ptNum,this.child2.trimBuffer()),e&&this.ptNum!==0&&await this.split(e)}async add(e,t,n){await this.extractBufs(),this.delBuildedResult(),this.extBuffer(this.ptNum+e.getSize(),this.nextStartIndex+n.getSize());let{ptNum:i,nextStartIndex:s}=await Xv(this.gpu,e,t,n,this.infoStartIndexsBuf,this.ptsBuf);for(this.nextStartIndex=s,this.ptNum=i,this.trimBuffer();this.ptNum>Ar;)await this.split()}async buildIter(e,t,n){this.child1?(this.ptNum&&await this.split(!0),e.push(this.child1),e.push(this.child2)):(this.changed&&(this.changed=!1,this.buildedResult={...await new wd(this.capacity,this.gpu,this.ptNum,this.infoStartIndexsBuf,this.ptsBuf,this.resultIdMap,n).build(),ptNum:this.ptNum},this.ext(this.buildedResult.bbox)),t[this.buildedResult.resultId]={...this.buildedResult,ptsBuf:this.ptsBuf})}async build(e){let t=[],n=[],i=this;for(;i;)await i.buildIter(n,t,e),i=n.pop();return{rtreeIndex:t,bbox:this.fac.build()}}};var Wn=Math.floor(ng/32/2)*32,Za=class{constructor(e,t){this.ptIndexsArr=[];this.blocks=[];this.noBuildedPtNumsArr=new Uint32Array(6*as);this.gpu=e,this.rtree=new Mo(this.gpu,t),this.capacity=t,this.nodeUnitNum=Qa+t,this.startIndexsBuf=e.createDynamicBuffer(1,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.ptsBuf=e.createDynamicBuffer(1,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.clear()}initBlock(){this.block={ptOffset:this.blocks.length*Gs,ids:new Uint32Array(4096),startIndexs:new Int32Array(4096),pts:new Float32Array(4096),nextPtIndex:0,nextStartIndex:0,deledIndex:Number.POSITIVE_INFINITY,deledNum:0,idsLengthInBuf:0},this.blocks.push(this.block)}clearNoBuildedData(){this.markUpdate(),this.blocks.length=0,this.initBlock(),this.block.nextPtIndex=1,this.block.startIndexs[0]=-1,this.startIndexsUpdateStartIndex=0,this.startIndexsUpdateEndIndex=1,this.noBuildedPtNumsArr.fill(0),this.startIndexsBuf.setSize(1),this.ptsBuf.setSize(1)}getNoBuildedPtNums(e){return this.noBuildedPtNumsArr.slice(e*6,(e+1)*6)}clear(){this.clearNoBuildedData(),this.ptIndexsArr.length=0,this.ptIndexsArr.push(new Uint32Array(4096)),this.indexMap=new Fn(4096),this.indexMap.markUsed(0),this.rtree.clear()}isChange(){return Number.isFinite(this.startIndexsUpdateStartIndex)}markUpdate(){this.startIndexsUpdateStartIndex=Number.POSITIVE_INFINITY,this.startIndexsUpdateEndIndex=Number.NEGATIVE_INFINITY,this.ptsUpdateStartIndex=Number.POSITIVE_INFINITY,this.ptsUpdateEndIndex=Number.NEGATIVE_INFINITY}modifyStartIndexsUpdateIndexs(e){this.startIndexsUpdateStartIndex=Math.min(this.startIndexsUpdateStartIndex,e),this.startIndexsUpdateEndIndex=Math.max(this.startIndexsUpdateEndIndex,e+1)}modifyPtsUpdateIndexs(e,t){this.ptsUpdateStartIndex=Math.min(this.ptsUpdateStartIndex,e),this.ptsUpdateEndIndex=Math.max(this.ptsUpdateEndIndex,e+t)}update0(e,t,n,i){!Number.isFinite(n)||(e.getSize()>i?e.trim(i):e.extSize(i),this.gpu.writeBuffer(e,n,t,n,i-n))}update(){if(this.blocks.length!==1)throw new Error("this.blocks.length !== 1");return this.update0(this.startIndexsBuf,this.block.startIndexs,this.startIndexsUpdateStartIndex,this.startIndexsUpdateEndIndex),this.update0(this.ptsBuf,this.block.pts,this.ptsUpdateStartIndex,this.ptsUpdateEndIndex),this.block.idsLengthInBuf=Math.max(this.block.idsLengthInBuf,this.startIndexsUpdateEndIndex),this.markUpdate(),{startIndexsBuf:this.startIndexsBuf,ptsBuf:this.ptsBuf}}addPt(e){let t=this.indexMap.findEmpty();if(t===-1){let s=this.ptIndexsArr[this.ptIndexsArr.length-1];if(s.length===Wn)this.ptIndexsArr.push(new Uint32Array(4096)),this.indexMap=this.indexMap.extSize(this.indexMap.size+4096);else{let o=new Uint32Array(Math.min(s.length*2,Wn));o.set(s),this.ptIndexsArr[this.ptIndexsArr.length-1]=o,this.indexMap=this.indexMap.extSize(this.indexMap.size+o.length-s.length)}t=this.indexMap.findEmpty()}if(this.indexMap.markUsed(t),this.block.nextPtIndex===Gs){this.block.pts=this.block.pts.slice(0,this.block.nextStartIndex);let s=0;for(let o of this.blocks)o.deledNum>s&&(this.block=o,s=o.deledNum);if(s!==0){this.block===this.blocks[0]&&(this.startIndexsUpdateStartIndex=Math.min(this.block.deledIndex,this.startIndexsUpdateStartIndex),this.ptsUpdateStartIndex=Math.min(this.block.deledStartIndex,this.ptsUpdateStartIndex)),this.block.nextPtIndex=this.block.deledIndex,this.block.nextStartIndex=this.block.deledStartIndex,this.block.deledIndex=Number.POSITIVE_INFINITY,this.block.deledNum=0,delete this.block.deledStartIndex;for(let o=this.block.nextPtIndex+1;o<Gs;o++){let a=this.block.startIndexs[o];if(a<0)continue;this.block.ids[this.block.nextPtIndex]=this.block.ids[o],this.block.startIndexs[this.block.nextPtIndex++]=this.block.nextStartIndex;let l=du.getPtLength(this.block.pts,a);this.block.pts.set(this.block.pts.slice(a,a+l),this.block.nextStartIndex),this.block.nextStartIndex+=l}this.block===this.blocks[0]&&(this.startIndexsUpdateEndIndex=this.block.nextPtIndex,this.ptsUpdateEndIndex=this.block.nextStartIndex)}else this.initBlock()}if(this.block.nextPtIndex===this.block.ids.length){let s=new Uint32Array(Math.min(this.block.nextPtIndex*2,Gs));s.set(this.block.ids),this.block.ids=s;let o=new Int32Array(s.length);o.set(this.block.startIndexs),this.block.startIndexs=o}let n=this.block.nextPtIndex++;this.block.ids[n]=t,this.ptIndexsArr[Math.floor(t/Wn)][t%Wn]=n+this.block.ptOffset;let i=this.block.nextStartIndex;if(this.block.nextStartIndex+=e.length,this.block.startIndexs[n]=i,i+e.length>this.block.pts.length){let s=new Float32Array(this.block.pts.length*2);s.set(this.block.pts),this.block.pts=s}return this.block.pts.set(e,i),this.noBuildedPtNumsArr[(e[0]&Co)*6+((e[0]&ar)>>ft)]++,this.block===this.blocks[0]&&(this.modifyStartIndexsUpdateIndexs(n),this.modifyPtsUpdateIndexs(i,e.length)),t}removePt(e){let t=this.ptIndexsArr[Math.floor(e/Wn)][e%Wn];if(t===0)throw new Error("pt does not exist!");if(this.ptIndexsArr[Math.floor(e/Wn)][e%Wn]=0,this.indexMap.markRemove(e),t>>Ed===0){let n=this.blocks[Math.floor(t/Gs)],i=t%Gs,s=n.startIndexs[i],o=n.pts[s];this.noBuildedPtNumsArr[(o&Co)*6+((o&ar)>>ft)]--,n.startIndexs[i]=-1,n.ids[i]=0,i<n.deledIndex&&(n.deledIndex=i,n.deledStartIndex=s),n.deledNum++,n===this.blocks[0]&&this.modifyStartIndexsUpdateIndexs(t)}else{let n=this.rtreeIndex[t>>vd],i=t&zv,s=(n.nodeRanges[0].startNodeIndex+Math.floor(i/this.capacity))*this.nodeUnitNum+Qa+i%this.capacity;return n.nodesBuf.read(s,s+1).then(o=>{n.nodesBuf.write(s,new Uint32Array(1));let a=-new Int32Array(o)[0]-1;return n.ptsBuf.read(a,Math.min(a+xv,n.ptsBuf.getSize())).then(l=>du.getBBox(new Float32Array(l),0))})}}getPtNum(){return this.indexMap.getMarked()}getIdsLengthInBuf(){return this.block.idsLengthInBuf}needBuild(){return this.blocks.length!==1}async build(){if(this.blocks.length===1)return this.update(),this.noBuildedPtNumsArr;let e;for(let o=this.noBuildedPtNumsArr.length-1;o>=0;o--)if(this.noBuildedPtNumsArr[o]!==0){e=Math.ceil(o/6);break}let t=new Uint32Array(e);for(let o=0;o<e;o++){let a=(o+1)*6,l=0;for(let u=o*6;u<a;u++)l+=this.noBuildedPtNumsArr[u];t[o]=l}this.update0(this.startIndexsBuf,this.blocks[0].startIndexs,this.startIndexsUpdateStartIndex,this.startIndexsUpdateEndIndex),this.update0(this.ptsBuf,this.blocks[0].pts,this.ptsUpdateStartIndex,this.ptsUpdateEndIndex);let n=this.gpu.createStaticBuffer(this.blocks[0].ids,GPUBufferUsage.STORAGE);await this.rtree.add(n,this.startIndexsBuf,this.ptsBuf),n.destroy(),this.startIndexsBuf.setSize(1),this.ptsBuf.setSize(1),delete this.blocks[0];for(let o=1;o<this.blocks.length;o++){let a=this.blocks[o],l=this.gpu.createDynamicBuffer(a.nextPtIndex,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST);l.write(0,a.ids,0,a.nextPtIndex);let u=this.gpu.createDynamicBuffer(a.nextPtIndex,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST);u.write(0,a.startIndexs,0,a.nextPtIndex);let c=this.gpu.createDynamicBuffer(a.nextStartIndex,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST);c.write(0,a.pts,0,a.nextStartIndex),await this.rtree.add(l,u,c),l.destroy(),u.destroy(),c.destroy(),delete this.blocks[o]}this.clearNoBuildedData();let i=this.gpu.createDynamicBuffer(this.ptIndexsArr.reduce((o,a)=>o+a.length,0),GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST);this.ptIndexsArr.forEach((o,a)=>{i.write(a*Wn,o),delete this.ptIndexsArr[a]});let s=await this.rtree.build(i);return this.rtreeIndex=s.rtreeIndex,await Promise.all(new Array(Math.ceil(i.getSize()/Wn)).fill(0).map((o,a)=>i.read(a*Wn,Math.min((a+1)*Wn,i.getSize())).then(l=>this.ptIndexsArr[a]=new Uint32Array(l)))),i.destroy(),Object.assign(s,{})}};var Sd=new me(-1,1,4),Vv=Sd.cross(new me(0,1,0)).cross(Sd).normalize(),pg=2,Wv=16,No=class{constructor(e,t,n,i,s,o,a){this.updateFlag=!0;this.changedFromLastRender=!0;this.isOrth=!1;this.needRender=!0;this.target=me.ORIGIN;this.tar2pos=Sd;this.up=Vv;this.scale=1;this.center=me.ORIGIN;this.radius=1;this.rotatable=!0;this.axisVisible=!1;this.bbox=n,this.axisGroup=i,this.updateSize(e,t),this.id=s,this.messageBus=o,this.isWebGPU=typeof a=="boolean"?a:a instanceof xd}markChange(){var e;this.updateFlag=!0,this.changedFromLastRender=!0,(e=this.messageBus)==null||e.publish("/engine/camera/update",{id:this.id,scale:this.scale})}getId(){return this.id}setAxisGroup(e){this.axisGroup=e,this.changedFromLastRender=!0}copy(e=this.bbox){let t=new No(0,0,e,this.axisGroup,null,null,this.isWebGPU);return t.width=this.width,t.height=this.height,t.isOrth=this.isOrth,t.target=this.target,t.tar2pos=this.tar2pos,t.up=this.up,t.scale=this.scale,t.center=this.center,t.radius=this.radius,t.rotatable=this.rotatable,t}isChangedFromLastRender(){return this.changedFromLastRender}setNeedRender(e){this.needRender=e,this.markChange()}getNeedRender(){return this.needRender}ableRender(){return this.needRender&&!(this.bbox.width()===0||this.bbox.height()===0||this.bbox.minX>=1||this.bbox.maxX<=-1||this.bbox.minY>=1||this.bbox.maxY<=-1)}rendered(){this.changedFromLastRender=!1}setObject(e,t){this.center=e,this.radius=t,this.tar2pos=this.tar2pos.normalize().scale(this.getOriginLength()),this.markChange()}setAxisVisible(e){this.axisVisible=e,this.changedFromLastRender=!0}adjustAxis(){var e,t;(e=this.axisGroup)==null||e.setVisible(this.axisVisible),(t=this.axisGroup)==null||t.setPosition(this.target)}getPostion(){return this.target.add(this.tar2pos)}getZ(){return this.target.z+this.tar2pos.z}getOriginLength(){return this.radius*pg}getUp(){return this.up}getRelativePosition(){return new me(0,0,this.tar2pos.length())}getTar2Pos(){return this.tar2pos}setRotatable(e){this.rotatable=e}setCameraDirect(e){this.tar2pos=new me(0,0,e?this.getOriginLength():-this.getOriginLength()),this.up=new me(0,1,0),this.markChange()}isOrthCamera(){return this.isOrth}getBorderZ(e){return this.isOrth?this.scale>e?-1:2:(pg-1)/(pg*(this.scale/e))}setCameraType(e){this.isOrth=e,this.markChange()}getTarget(){return this.target}setTarget(e){this.target=e,this.markChange()}reset(){this.rotatable&&(this.tar2pos=Sd.normalize().scale(this.getOriginLength())),this.target=this.center,this.up=Vv,this.scale=1,this.markChange()}rotateH(e){if(!this.rotatable)return;let t=this.up.scale(-1);this.tar2pos=this.tar2pos.rotate(t,e).normalize().scale(this.getOriginLength()),this.markChange()}rotateV(e){if(!this.rotatable)return;let t=this.tar2pos.cross(this.up);this.up=this.up.rotate(t,e).normalize(),this.tar2pos=this.tar2pos.rotate(t,e).normalize().scale(this.getOriginLength()),this.markChange()}rotateP(e){!this.rotatable||(this.up=this.up.rotate(this.tar2pos,e).normalize(),this.markChange())}rotateZTo(e){let t=this.rotatable;this.rotatable=!0,this.up=new me(0,1,0),this.rotateP(e),this.rotatable=t,this.markChange()}rotateTo(e){let t=this.rotatable;this.rotatable=!0,this.up=new me(0,0,1),this.tar2pos=new me(0,-this.getOriginLength(),0),this.rotateH(e.x),this.rotateV(e.y),this.rotateP(e.z),this.rotatable=t,this.markChange()}updateSize(e,t){this.width=e*this.bbox.width()/2,this.height=t*this.bbox.height()/2,this.markChange()}getWidth(){return this.width}getHeight(){return this.height}addOffset(e){let t=this.tar2pos.normalize(),n=this.up.cross(t).normalize(),i=t.cross(n).normalize();this.target=this.target.add(n.scale(e.x).add(i.scale(e.y)).add(t.scale(e.z))),this.markChange()}scaleAtPoint(e,t,n){t=(t-this.bbox.minX)/this.bbox.width()*2-1,n=(n-this.bbox.minY)/this.bbox.height()*2-1;let i=this.tar2pos.normalize(),s=this.up.cross(i).normalize(),o=i.cross(s).normalize(),a=s.scale(t*this.width/2/this.scale).add(o.scale(n*this.height/2/this.scale));this.scale=this.scale*e;let l=s.scale(t*this.width/2/this.scale).add(o.scale(n*this.height/2/this.scale));this.target=this.target.add(a).sub(l),this.markChange()}setScale(e){this.scale=e,this.markChange()}getScale(){return this.scale}getViewMatrix(){return this.update(),this.viewMatrix}getProjectMatrix(){return this.update(),this.projectMatrix}getRenderMatrix(){return this.update(),this.renderMatrix}is2D(){return!this.rotatable&&this.isOrth&&this.tar2pos.x===0&&this.tar2pos.y===0}getOffsetXY(e,t){let n=this.tar2pos,i=this.up.rotate(n,-Math.PI/2).normalize().scale(e);if(i=i.add(this.up.normalize().scale(t)),i.z!==0&&n.z!==0){let s=n.z/i.z;i=i.add(n.scale(-1/s))}return new q(i.x,i.y)}updateViewMatrix(){let e=this.tar2pos.normalize(),t=this.up.cross(e).normalize(),n=e.cross(t).normalize(),i;if(this.isOrth){let s=this.tar2pos.normalize().scale(this.tar2pos.length()-(this.getOriginLength()-this.radius)-this.radius*Wv*(this.isWebGPU?2:1));i=this.target.add(s)}else i=this.target.add(this.tar2pos);this.viewMatrix=new Qe([t.x,n.x,e.x,0,t.y,n.y,e.y,0,t.z,n.z,e.z,0,-i.dot(t),-i.dot(n),-i.dot(e),1])}getPxLength(){return 1/this.scale}updateProjectMatrix(){this.isOrth?this.projectMatrix=new Qe([2/this.width*this.scale,0,0,0,0,2/this.height*this.scale,0,0,0,0,(this.isWebGPU?.5:-1)/this.radius/Wv,0,0,0,0,1]):this.projectMatrix=new Qe([2*this.getOriginLength()*this.scale/this.width,0,0,0,0,2*this.getOriginLength()*this.scale/this.height,0,0,0,0,0,-1,0,0,(this.isWebGPU?1:-1)*(this.getOriginLength()-this.radius),0])}update(){this.updateFlag&&(this.updateViewMatrix(),this.updateProjectMatrix(),this.renderMatrix=this.viewMatrix.multiply4(this.projectMatrix),this.updateInvMatrix(),this.updateFlag=!1)}adapt(e){if(!e)return[0,0,0,0];this.setTarget(e.center());let t=this.getRenderMatrix(),n=e.getVertexes().map(c=>c.multiply4(t)),i=new Oe;for(let c of n)i.ext6(c.x,c.y);let s=i.build(),o=1/Math.max(-s.minX,s.maxX,-s.minY,s.maxY);this.setScale(this.getScale()*o),s=new ye(s.minX*o,s.maxX*o,s.minY*o,s.maxY*o);let a=this.bbox.width()/2*this.width,l=this.bbox.height()/2*this.height,u=s.center();return[u.x*a/2,u.y*l/2,a*s.width()/2,l*s.height()/2]}updateInvMatrix(){let e=this.tar2pos.normalize(),t=this.up.cross(e).normalize(),n=e.cross(t).normalize(),i=this.getPostion();this.invMatrix=Qe.translate(-this.width/2,-this.height/2,0).multiply4(Qe.flipX()).scale((this.isOrth?1:(this.getOriginLength()-this.radius)/this.getOriginLength())/this.scale).translate1(0,0,this.isOrth?this.radius:this.radius-this.getOriginLength()).multiply4(new Qe([t.x,t.y,t.z,0,n.x,n.y,n.z,0,e.x,e.y,e.z,0,i.x,i.y,i.z,1]))}getInverseMatrix(){return this.update(),this.invMatrix}};var Te=class{static regular(e){return Math.round(e*this.precision)/this.precision}static eq(e,t){return Math.abs(e-t)<=this.eps}static neq(e,t){return Math.abs(e-t)>this.eps}static less(e,t){return e-t<-this.eps}static lesseq(e,t){return e-t<this.eps}static greater(e,t){return e-t>this.eps}static greatereq(e,t){return e-t>-this.eps}static sqrt(e){return Math.abs(e)<=1e-10?0:Math.sqrt(e)}static sortAsc(e,t){return e-t}static sortDesc(e,t){return t-e}};Te.eps=1e-8,Te.precision=1e8;var Id=class{constructor(e,t,n,i,s,o){this.length=9;this.scene=e,this.data=this.create(t,n,i,s,o)}create(e,t,n,i,s){return[e+(7<<ft),t.x,t.y,n.x,n.y,i.x,i.y,s.x,s.y]}get ldPoint(){return new q(this.data[1],this.data[2])}get luPoint(){return new q(this.data[3],this.data[4])}get rdPoint(){return new q(this.data[5],this.data[6])}get ruPoint(){return new q(this.data[7],this.data[8])}getBaseBBox(){return ye.extend3(this.luPoint,this.rdPoint)}getBBox(e,t){return new ye(e[t+1],e[t+7],e[t+2],e[t+8])}async setTexture(e){await this.setImageSource(e)}async setImageSource(e){let t=this.scene.gpu.device,n=await createImageBitmap(e),i=t.createTexture({size:[n.width,n.height,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});t.queue.copyExternalImageToTexture({source:n},{texture:i},[n.width,n.height]),this.gpuTexture=i}};function ZF(r){return`
    struct Uniforms {
		coordXOffset: u32,
        width: u32,
        num: u32,
        extWidth: u32,
        offsetX: u32,
        offsetY: u32,
    }

    @binding(0) @group(0) var<uniform> uniforms: Uniforms;
    @binding(1) @group(0) var<storage, read> pBufR: array<u32>;
    @binding(2) @group(0) var<storage, read_write> pBuf: array<u32>;

    @compute @workgroup_size(${r.limits.maxComputeWorkgroupSizeX})
    fn extPBuf(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let index = uniforms.coordXOffset + coord.x;
		if(index >= uniforms.num){
			return;
		}

        let y = index / uniforms.width;
        let x = index - y * uniforms.width;
        pBuf[(y + uniforms.offsetY) * uniforms.extWidth + x + uniforms.offsetX] = pBufR[y * uniforms.width + x];
	}
`}var Bd;function $v(r,e,t,n,i,s,o){Bd||(Bd=r.createComputePipeline(r.device.createShaderModule({code:ZF(r)}),"extPBuf"));let a=r.createStaticBuffer(new Uint32Array([0,t/32,e.getSize(),n/32,s/32,o]),GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),l=r.createDynamicBuffer(n*i/32,e.usage),u=r.createBindGroup(Bd.getBindGroupLayout(0),0,a,1,e,2,l),c=r.device.createCommandEncoder();r.runComputePass(c,Bd,u,e.getSize(),h=>r.copyBufferToBuffer(r.coordXOffsetBuf,h,a,0,1,c)),r.submit(c),a.destroy(),e.setDynamicBuffer(l)}function zs(r){for(let e=0;e<fu;e++)for(let t=0;t<jh;t++)r(e*pu,t*Hh)}var Ka=class extends Ts{constructor(t,n,i,s=null,o=null,a){super(i,s,o);this.bboxFac2=new Oe;this._isEmpty=!0;this.hasColorfulPt=!1;this.textures=[];this.interPlanes=[this];this.subPlanes=[];this.ptNum=0;this.getOrInitId=this.initId;this.scene=t,this._isNormal=a,this.builder=a?t.normalBuilder:new Za(t.gpu,n),this.pBufInfo={changedFac:new Oe}}initId(){return this._id=this.scene.getPlaneId(),this.setEmpty(!1),this._id}getId(){if(this._id===void 0)throw new Error("this._id === undefined");return this._id}isNormal(){return this._isNormal}updateMatrixs(t){if(super.updateMatrixs(t),!!this._isNormal)for(let n of t.values()){let i=me.ORIGIN.multiply4(n),s=new me(1,0,0).multiply4(n),o=new me(0,1,0).multiply4(n);if(i.x!==0||i.y!==0||s.x!==1||s.y!==0||o.x!==0||o.y!==1)throw new Error("oP.x !== 0 || oP.y !== 0 || xP.x !== 1 || xP.y !== 0 || yP.x !== 0 || yP.y !== 1")}}addPt(t,n){let i=du.getBBox(t,0);if(this.bboxFac2.ext1(i),this.pBufInfo.changedFac.ext1(i),!this.hasColorfulPt&&n){this.hasColorfulPt=!0;let{scene:o}=this;if(this.pBufInfo.texture=new Vn(o.gpu,this.pBufInfo.width||1,this.pBufInfo.height||1,"rgba8unorm",GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC),this.pBufInfo.buf){let{width:a,height:l,bbox:u,bindGroup:c}=this.pBufInfo,h=new No(a,l,new ye(-1,1,-1,1),new ze,"",null,!0);h.setCameraType(!0),h.setCameraDirect(!0),h.adapt(new wn(u.minX,u.minY,0,u.maxX,u.maxY,0)),o.updateCameraBuf(h),o.resize(a,l),o.initCommandEncoder(),o.renderBitBufferProgram.draw(Qe.ORIGIN,h,this,this,0,a,l,o.texPxLength,u,o.texScale,c.getBindGroup(),"render"),o.commandEncoder.copyTextureToTexture({texture:o.planeProgram.colorTexture.texture},{texture:this.pBufInfo.texture.texture},{width:a,height:l}),o.submitCommandEncoder(),o.resize(),c.destroy(),this.pBufInfo.buf.destroy(),delete this.pBufInfo.buf}this.pBufInfo.bindGroup=o.renderTexProgram.createDynamicBindGroup(this.pBufInfo.texture)}let s=this.builder.addPt(t);return this._isNormal&&this.scene.addNormalPlane(this),this.ptNum++,s}removePt(t){let n=this.builder.removePt(t);if(--this.ptNum===0&&this.setEmpty(!0),!(n instanceof Promise))return n;if(!this._isNormal)throw new Error("not support");this.scene.removingPtNum++,n.then(i=>{this.scene.removingPtNum--,this.pBufInfo.changedFac.ext1(i)})}clearPBuf(){var t,n;delete this.pBufInfo.bbox,delete this.pBufInfo.width,delete this.pBufInfo.height,(t=this.pBufInfo.buf)==null||t.setSize(1),(n=this.pBufInfo.texture)==null||n.updateSize(1,1),this.pBufInfo.changedFac.ext1(this.bboxFac2.build())}updatePBuf(){let{scene:t}=this,{changedFac:n}=this.pBufInfo;if(!n.valid())return;let i=n.build();n.clear(),i=new ye(i.minX-t.texPxLength,i.maxX+t.texPxLength,i.minY-t.texPxLength,i.maxY+t.texPxLength),!this.pBufInfo.texture&&!this.pBufInfo.buf&&(this.pBufInfo.buf=t.gpu.createDynamicBuffer(1,GPUBufferUsage.COPY_SRC|GPUBufferUsage.STORAGE),this.pBufInfo.bindGroup=t.renderBitBufferProgram.createDynamicBindGroup(this.pBufInfo.buf));let{buf:s,texture:o}=this.pBufInfo;if(this.pBufInfo.bbox){if(!this.pBufInfo.bbox.isContainsBBox1(i)){let{bbox:h,width:f,height:d}=this.pBufInfo,m=Math.ceil(Math.max(h.minX-i.minX,0)/t.texPxLength/32)*32,p=Math.ceil(Math.max(i.maxY-h.maxY,0)/t.texPxLength),g=Math.max(Math.ceil((i.maxX-h.minX)/t.texPxLength/32)*32,f),b=Math.max(Math.ceil((h.maxY-i.minY)/t.texPxLength),d);this.pBufInfo.width=g+m,this.pBufInfo.height=b+p,this.pBufInfo.bbox=new ye(h.minX-m*t.texPxLength,h.minX+g*t.texPxLength,h.maxY-b*t.texPxLength,h.maxY+p*t.texPxLength),s&&$v(t.gpu,s,f,g+m,b+p,m,p),o==null||o.extSize(m,p,g-f,b-d),t.logAllTexSize()}let{bbox:c}=this.pBufInfo;i=new ye(Math.max(c.minX,c.minX+Math.floor((i.minX-c.minX)/t.texPxLength/32)*32*t.texPxLength),Math.min(c.maxX,c.minX+Math.ceil((i.maxX-c.minX)/t.texPxLength/32)*32*t.texPxLength),Math.max(c.minY,c.maxY+Math.floor((i.minY-c.maxY)/t.texPxLength)*t.texPxLength),Math.min(c.maxY,c.maxY+Math.ceil((i.maxY-c.maxY)/t.texPxLength)*t.texPxLength))}else{let c=Math.ceil(i.width()/t.texPxLength/32)*32,h=Math.ceil(i.height()/t.texPxLength);i=new ye(i.minX,i.minX+c*t.texPxLength,i.minY,i.minY+h*t.texPxLength),this.pBufInfo.width=c,this.pBufInfo.height=h,this.pBufInfo.bbox=i,s==null||s.setSize(c*h/32),o==null||o.updateSize(c,h),t.logAllTexSize()}let{width:a,bbox:l}=this.pBufInfo,u=new No(Math.round(i.width()/t.texPxLength),Math.round(i.height()/t.texPxLength),new ye(-1,1,-1,1),new ze,"",null,!0);u.setCameraType(!0),u.setCameraDirect(!0),u.adapt(new wn(i.minX,i.minY,0,i.maxX,i.maxY,0)),t.resize(u.getWidth(),u.getHeight()),t.renderNormalPlanesTest(u,[this],()=>{s?t.extractBitBufferProgram.extract(t.depthTexture.view,s,a,Math.round((i.minX-l.minX)/t.texPxLength),Math.round((l.maxY-i.maxY)/t.texPxLength),t.colorTexture.width,t.colorTexture.height):t.commandEncoder.copyTextureToTexture({texture:t.planeProgram.colorTexture.texture},{texture:o.texture,origin:{x:Math.round((i.minX-l.minX)/t.texPxLength),y:Math.round((l.maxY-i.maxY)/t.texPxLength)}},t.planeProgram.colorTexture)})}createLine(t,n,i,s,o){return zs((a,l)=>{this.addPt(an.create(this.getOrInitId(),t.add1(a,l),n.add1(a,l),i,o,this.scene.getColorIndex(s)),s)}),0}createArc(t,n,i,s,o,a,l){return s=ut.toRadians(s),o=ut.toRadians(o),o<0&&(s=s+o,o=-o),s%=or,s<0&&(s+=or),zs((u,c)=>{this.addPt(sn.create(this.getOrInitId(),t.add1(u,c),n,i,s,o,l,this.scene.getColorIndex(a)),a)}),0}createCircle(t,n,i,s){return zs((o,a)=>{this.addPt(on.create(this.getOrInitId(),t.add1(o,a),n,s,this.scene.getColorIndex(i)),i)}),0}createPolygon(t,n,i,s){let o=[];for(let u of t){let c=[],h,f,d,m,p,g,b=()=>{if(!!h){if(m>0)for(let _=0;_<m;_+=360)zs((B,I)=>{this.addPt($r.create(this.getOrInitId(),h.add1(B,I),f,ut.toRadians(d+_),ut.toRadians(Math.min(m-_,360)),s,this.scene.getColorIndex(i)),i)});else for(let _=0;_>m;_-=360)zs((B,I)=>{this.addPt($r.create(this.getOrInitId(),h.add1(B,I),f,ut.toRadians(d+_),ut.toRadians(Math.max(m-_,-360)),s,this.scene.getColorIndex(i)),i)});p.equals1(g)||c.push(new Y(p,g)),h=null}};if(u.primitives.forEach(_=>{if(_ instanceof re&&_.rx===_.ry){if(h){if(f===_.rx&&h.equals1(_.center)&&Te.eq(ut.regularD(d+m),ut.regularD(_.startAngle))){m+=_.sweepAngle,g=_.end();return}b()}h=_.center,f=_.rx,d=_.startAngle,m=_.sweepAngle,p=_.start(),g=_.end()}else b(),c.push(_)}),b(),c.length===0)continue;let v=[];for(Ce.build2(c).points2(n,_=>v.push(_));v.length!==0&&v[0].equals1(v[v.length-1]);)v.pop();if(v.length<3)continue;let w=v[0],P=[w];for(let _=1;_<v.length;_++){let B=v[_];w.equals1(B)||(P.push(B),w=B)}P.length>=3&&o.push(P)}for(let u of o){let c=u.slice();for(let h=0;h<c.length-2;h+=2)zs((f,d)=>{this.addPt(_r.create(this.getOrInitId(),c[h].add1(f,d),c[h+1].add1(f,d),c[h+2].add1(f,d),s,this.scene.getColorIndex(i)),i)}),c.push(c[h])}let a=new Oe;t.forEach(u=>a.ext1(u.bbox()));let l=a.build();return this.bboxFac2.ext5(l.minX,l.maxX+(fu-1)*pu,l.minY,l.maxY+(jh-1)*Hh),[0]}createRect(t,n,i){return zs((s,o)=>{this.addPt(ln.create(this.getOrInitId(),t.leftUpPoint.add1(s,o),t.width,t.height,t.angle,t.isCCW,t.radius,i,this.scene.getColorIndex(n)),n)}),0}createTexture(t,n,i,s,o,a,l){let u=null;zs((h,f)=>{u=new Id(this.scene,this.getOrInitId(),t.add1(h,f),n.add1(h,f),i.add1(h,f),s.add1(h,f))}),this.textures.push(u);let c=u.getBaseBBox();return this.bboxFac2.ext1(c),u}setRenderProcess(t=[this],n=[]){this.interPlanes=t.filter(i=>i),this.subPlanes=n.filter(i=>i&&!i.isEmpty())}getPxLength(t,n){let i;if(t.isOrthCamera())i=t.getPxLength();else{let s=this.getBBox(),a=(s?s.center():t.getTarget()).multiply4(n),l=t.getTarget().sub(a).dot(t.getTar2Pos().normalize());i=t.getPxLength()*(l/t.getTar2Pos().length()+1)}return i*=2,i}setPolygonAbleInter(t){}isEmpty(){return this._isEmpty}getBBox2(){return this.bboxFac2.valid()?this.bboxFac2.build():null}addPart(t,n){}sortTransparentObjs(){}setEmpty(t){var n,i,s;if(this._isEmpty=t,t){if(this.bboxFac2.clear(),this.scene.delNormalPlane(this),this.hasColorfulPt=!1,this._id===void 0)return;this.scene.releasePlaneId(this._id),delete this._id,this.getOrInitId=this.initId,(n=this.pBufInfo.bindGroup)==null||n.destroy(),delete this.pBufInfo.bindGroup,(i=this.pBufInfo.texture)==null||i.destroy(),delete this.pBufInfo.texture,(s=this.pBufInfo.buf)==null||s.destroy(),delete this.pBufInfo.buf,delete this.pBufInfo.width,delete this.pBufInfo.height,delete this.pBufInfo.bbox}else this._isNormal&&this.scene.addNormalPlane(this),this.getOrInitId=()=>this._id}clear(){this.builder.clear(),this.ptNum=0,this.setEmpty(!0)}getBBox(){try{let t=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(let o of this.interPlanes){if(o.isEmpty())continue;let a=o.getBBox2();a&&(t=Math.max(a.minX,t),i=Math.min(a.maxX,i),n=Math.max(a.minY,n),s=Math.min(a.maxY,s))}return new wn(t,n,0,i,s,0)}catch{return null}}drawSelf(t,n,i,s,o){if(this.isEmpty())return;if(this._isNormal){this.scene.renderNormalPlane(this,n,i,s,o);return}if(this.builder.isChange()){let{startIndexsBuf:l,ptsBuf:u}=this.builder.update(),c=this.scene.gpu.getTempBuf(this.builder.getIdsLengthInBuf());this.filterBindGroup=this.scene.filterPtProgram.createBindGroup(u,l,c),this.renderBindGroup=this.scene.renderPtProgram.createBindGroup(u,c),console.log(`ptNum of ${this.className} plane:`,this.builder.getPtNum())}let a=[];a[this.getId()]=[n],this.scene.filterPtRender(t,i,s,this.builder.getNoBuildedPtNums(this.getId()),this.filterBindGroup,this.renderBindGroup,this.builder.getIdsLengthInBuf(),a,this,o)}draw(t,n,i){this.subPlanes.forEach(s=>s.drawSelf(t,n,this,0,"drawNotPassStencil"));for(let s=1;s<this.interPlanes.length;s++)this.interPlanes[s].drawSelf(t,n,this,0,"drawInterStencil");this.interPlanes[0].drawSelf(t,n,this,i,"render"),this.isColorful&&this.textures.forEach(s=>{this.scene.textureProgram.render({matrix:n,texture:s})})}};var ze=class{constructor(e=2,t=!1){this.drawHighlight=!0;this.outSelfMatrixVisibleMap=new Map;this.contents=new Set;this.position=me.ORIGIN;this.scale=new me(1,1,1);this.rotation=me.ORIGIN;this.addiMatrix=Qe.ORIGIN;this.updateFlag=!1;this.visible=!0;this.hidden=!1;this.selfMatrix=this.addiMatrix;this.renderMode=e,t&&this.outSelfMatrixVisibleMap.set(Qe.ORIGIN,[new Qe,!0])}static clone(e,t){let n=new ze;return n.setPosition(e.position),n.setScale(e.scale),n.setRotation(e.rotation),n.setAddiMatrix(e.addiMatrix),n.setRenderMode(e.renderMode),n.setVisible(e.visible),n.setHidden(e.hidden),(t||e.contents).forEach(i=>n.add(i)),n}static cloneAttribute(e,t){t.setPosition(e.position),t.setScale(e.scale),t.setRotation(e.rotation),t.setAddiMatrix(e.addiMatrix),t.setRenderMode(e.renderMode),t.setVisible(e.visible),t.setHidden(e.hidden)}setRenderMode(e){this.renderMode=e}isEmpty(){for(let e of this.contents)if(e instanceof ze){if(!e.isEmpty())return!1}else return!1;return!0}setOutMatrixVisible(e,t){let n=this.outSelfMatrixVisibleMap.get(t);n[1]=e,e=e&&this.visible;for(let i of this.contents)i.setOutMatrixVisible(e,n[0])}setVisible(e){if(e!==this.visible){this.visible=e;for(let t of this.outSelfMatrixVisibleMap.values()){let n=t[1]&&this.visible;for(let i of this.contents)i.setOutMatrixVisible(n,t[0])}}}setMeshAlpha(e){Array.from(this.contents).forEach(t=>{if(t instanceof ze){let n=ze.clone(t);this.add(n),this.remove(t),n.setMeshAlpha(e)}else t instanceof vt&&t.getMaterial()&&t.getMaterial().alpha!=e&&(this.add(new vt(t.elements,t.getColor(),new Pn(t.getMaterial().ambient,t.getMaterial().diffuse,t.getMaterial().specular,t.getMaterial().shininess,e),t.className)),this.remove(t))})}getVisible(){return this.visible}setHidden(e){this.hidden=e}getPosition(){return this.position}getContents(){return this.contents}setPosition(e){return this.position=e,this.updateFlag=!0,this}getScale(){return this.scale}setScale(e){return this.scale=e,this.updateFlag=!0,this}getRotation(){return this.rotation}setRotation(e){return this.rotation=e,this.updateFlag=!0,this}getAddiMatrix(){return this.addiMatrix}setAddiMatrix(e){return this.addiMatrix=e,this.updateFlag=!0,this}getMatrix(){return this.updateFlag&&(this.selfMatrix=Qe.ORIGIN.rotateZ(this.rotation.z).rotateX(this.rotation.x).rotateY(this.rotation.y).scale(this.scale.x,this.scale.y,this.scale.z).translate(this.position).multiply4(this.addiMatrix),this.updateFlag=!1,this.update()),this.selfMatrix}getSelfAsOutToChildMatrix(){let e=[];for(let t of this.outSelfMatrixVisibleMap.values())e.push(t[0]);return e}add(e){this.contents.add(e);let t=new Map;for(let n of this.outSelfMatrixVisibleMap.values())t.set(new Qe,n[0]);e.updateMatrixs(t);for(let n of this.outSelfMatrixVisibleMap.values())e.setOutMatrixVisible(this.visible&&n[1],n[0]);return e}remove(e){if(!this.contents.has(e))return;this.contents.delete(e);let t=new Array;for(let n of this.outSelfMatrixVisibleMap.values())t.push(n[0]);e.removeOutMatrixs(t)}removeOutMatrixs(e){let t=new Array;for(let n of e)t.push(this.outSelfMatrixVisibleMap.get(n)[0]),this.outSelfMatrixVisibleMap.delete(n);for(let n of this.contents)n.removeOutMatrixs(t)}clear(){let e=new Array;for(let t of this.outSelfMatrixVisibleMap.values())e.push(t[0]);for(let t of this.contents)t.removeOutMatrixs(e);this.contents.clear()}getBBox(e=!1){if(this.hidden||e&&!this.visible)return null;let t=this.getMatrix(),n=new zr;for(let i of this.contents){let s=i.getBBox(e);s&&n.ext4(s.transform(t))}return n.isValid()?n.build():null}updateMatrixs(e){let t=new Map;for(let n of e.entries()){let i=this.getMatrix().multiply4(n[1]),s=!0,o=this.outSelfMatrixVisibleMap.get(n[0]);o?(s=o[1],t.set(o[0],i),this.outSelfMatrixVisibleMap.delete(n[0])):t.set(new Qe,i),this.outSelfMatrixVisibleMap.set(n[1],[i,s])}for(let n of this.contents)n.updateMatrixs(t)}setSingleColor(e,t=null){if(t){let n=this.outSelfMatrixVisibleMap.get(t)[0];for(let i of this.contents)i.setSingleColor(e,n)}else for(let n of this.contents)for(let i of this.outSelfMatrixVisibleMap.values())n.setSingleColor(e,i[0])}update(){let e=new Map;for(let t of this.outSelfMatrixVisibleMap.keys())e.set(t,t);this.updateMatrixs(e)}preDraw(){if(!!this.visible){this.getMatrix();for(let e of this.contents)e.preDraw()}}getPlaneGLMatrixRenderModes(e=2,t=Qe.ORIGIN){if(!this.visible)return[];e!==3&&this.renderMode!==2&&(e=this.renderMode);let n=this.outSelfMatrixVisibleMap.get(t)[0],i=[];for(let s of this.contents)if(s instanceof ze)for(let o of s.getPlaneGLMatrixRenderModes(e,n))i.push(o);else s instanceof Yh&&i.push([s,n,e]);return i}getPlaneGPUMatrixRenderModes(e=2,t=Qe.ORIGIN){if(!this.visible)return[];e!==3&&this.renderMode!==2&&(e=this.renderMode);let n=this.outSelfMatrixVisibleMap.get(t)[0],i=[];for(let s of this.contents)if(s instanceof ze)for(let o of s.getPlaneGPUMatrixRenderModes(e,n))i.push(o);else s instanceof Ka&&i.push([s,n,e]);return i}getMeshMap(e=2,t=Qe.ORIGIN,n=void 0){let i=new Map;if(!this.visible)return i;e!==3&&this.renderMode!==2&&(e=this.renderMode);let s=this.outSelfMatrixVisibleMap.get(t)[0];for(let o of this.contents)if(o instanceof ze){if(n!==void 0&&o.drawHighlight!==n)continue;for(let a of o.getMeshMap(e,s,n).entries()){let l=i.get(a[0]);l||(l=[],i.set(a[0],l)),a[1].forEach(u=>l.push(u))}}else if(o instanceof vt){let a=i.get(o);a||(a=[],i.set(o,a)),a.push({matrix:s,renderMode:e,color:e===0?o.getColor():e===3?o.getSingleColor(s):null})}return i}clearCaled(){this.contents.forEach(e=>{e instanceof ze?e.clearCaled():e instanceof vt&&delete e.caled})}calMeshMemory(e=!0){let t=0;return this.contents.forEach(n=>{var i,s;n instanceof ze?t+=n.calMeshMemory(!1):n instanceof vt&&!n.caled&&(t+=(((i=n.elements.vertexes)==null?void 0:i.length)||0)*4,t+=(((s=n.elements.normals)==null?void 0:s.length)||0)*4,n.caled=!0)}),e&&this.clearCaled(),t}};var Ad=class{constructor(e){this.ambient=null;this.diffuse=null;this.specular=null;this.d=0;this.name=e}},Ro=new Ad("__default__");Ro.ambient=[0,0,0],Ro.diffuse=[.5,.5,.5],Ro.specular=[0,0,0],Ro.d=1;function jv(r,e,t,n){let i=new Array,s=new Array,o=new Array,a=new Array,l=new Array,u=new Array;for(let c=0;c<r.length;c++){let h=r[c],f=e[c];i.push(h.x),s.push(h.y),o.push(h.z),a.push(f.x),l.push(f.y),u.push(f.z)}return{vertexXs:i,vertexYs:s,vertexZs:o,normalXs:a,normalYs:l,normalZs:u,group:n,material:{ambient:t.ambient,diffuse:t.diffuse,specular:t.specular,d:t.d}}}var mg=/(\d*)\/(\d*)\/(\d*)/;function Ja(r,e,t=0,n=()=>""){let i=new Date().getTime();r!=="None"&&console.log(`ObjDecode start [${r}]`);let s=new Array,o=new Array;s.push(null),o.push(null);let a={},l={},u=null,c="default";l.__default__={material:Ro,vs:[],ns:[],group:c};let h=l.__default__;ka(e,b);let f=new Array,d=new Array,m=new Array,p=new Array;for(let P in l){let{material:_,vs:B,ns:I,group:C}=l[P];B.length>0&&(f.push(B),d.push(I),m.push(_),p.push(C))}let g=new Array;if(t===0)for(let P=0;P<f.length;P++){let _=f[P],B=d[P];B||(B=Na(_,Math.PI/3)),g.push(jv(_,B,m[P],p[P]))}else{let P=T2(f,0,t);for(let _=0;_<P.length;_++)P[_].length!==0&&g.push(jv(P[_],Na(P[_],Math.PI/3),m[_],p[_]))}return r!=="None"&&console.log(`ObjDecode end [${r}] ${new Date().getTime()-i}`),g;function b(P){P=P.trim();let _=P.split(/\s+/),B=_.shift();switch(B){case"g":c=_[0]||"default";let I=c.split("/");I.length>1&&(c=I.slice(1).join("/"));let C=c+"_"+_.join(" ");C in l||(l[C]={vs:[],ns:[],material:a[_.join(" ")]||Ro,group:c},l[C].group=c),h=l[C];break;case"v":s.push(new me(parseFloat(_[0]),parseFloat(_[1]),parseFloat(_[2])));break;case"vn":o.push(new me(parseFloat(_[0]),parseFloat(_[1]),parseFloat(_[2])));break;case"vt":break;case"f":let N=mg.exec(_[0]);if(N){let M=v(N[1]),S=w(N[3]),{vs:$,ns:H}=h,K=mg.exec(_[1]),F=v(K[1]),z=w(K[3]),L=H!==null;L&&(!S||!z)&&(h.ns=null,L=!1);for(let k=2;k<_.length;k++){let O=mg.exec(_[k]),ie=v(O[1]),W=w(O[3]);$.push(M,F,ie),F=ie,L&&(W?(H.push(S,z,W),z=W):(h.ns=null,L=!1))}}else{let M=v(_[0]),{vs:S}=h;h.ns=null;let $=v(_[1]);for(let H=2;H<_.length;H++){let K=v(_[H]);S.push(M,$,K),$=K}}break;case"newmtl":case"endmtl":u&&u.ambient&&u.diffuse&&u.specular&&(a[u.name]=u,u=null),B==="newmtl"&&(u=new Ad(_.join(" ")),u.ambient=[0,0,0],u.diffuse=[0,0,0],u.specular=[0,0,0]);break;case"Ka":u&&(u.ambient=[parseFloat(_[0]),parseFloat(_[1]),parseFloat(_[2])]);break;case"Kd":u&&(u.diffuse=[parseFloat(_[0]),parseFloat(_[1]),parseFloat(_[2])]);break;case"Ks":u&&(u.specular=[parseFloat(_[0]),parseFloat(_[1]),parseFloat(_[2])]);break;case"d":u&&(u.d=parseFloat(_[0]));break;case"usemtl":let A=c+"_"+_.join(" ");A in l||(l[A]={vs:[],ns:[],material:a[_.join(" ")]||Ro,group:c},l[A].group=c),h=l[A];break;case"mtllib":{let M=n(_[0]);M&&(ka(M,b),b("endmtl"));break}case"#":break;default:P&&console.log("ignore",P)}}function v(P){let _=parseInt(P);return _>0?s[_]:s[s.length+_]}function w(P){let _=parseInt(P);return _>0?o[_]:o[o.length+_]}}function gg(r,e=1){let t=new ze;for(let n of r){let i=new Array,s=new Array,{vertexXs:o,vertexYs:a,vertexZs:l,normalXs:u,normalYs:c,normalZs:h,material:f}=n,d=new ze;d.name=n.group;for(let p=0;p<o.length;p++)i.push(new me(o[p],a[p],l[p])),s.push(new me(u[p],c[p],h[p]));let m=new vt(new gr(i,s),null,fv(f.ambient[0],f.ambient[1],f.ambient[2],f.diffuse[0],f.diffuse[1],f.diffuse[2],f.specular[0],f.specular[1],f.specular[2],1,e));d.add(m),t.add(d)}return t}function ls(r,e=0,t=()=>"",n=1){return gg(Ja("None",r,e,t),n)}async function t3e(r,e,t=1){let n={},i={};await r(async s=>{let{path:o,content:a}=s;console.log(o,a),o.endsWith(".mtl")?n[o]=new TextDecoder().decode(await a()):o.endsWith(".obj")&&(i[o]=new TextDecoder().decode(await a()))}),await L2(i,async(s,o)=>{let a=s.substring(0,s.lastIndexOf("/")+1),l=n[s.substring(0,s.length-3)+"mtl"],u=ls(o,0,c=>n[a+c]||l,t);if(e(s,u)===!1)return!1})}var C3e=4,M3e=0,N3e=1,R3e=2;function nl(r){let e=r.length;for(;--e>=0;)r[e]=0}var _8=0,ow=1,P8=2,S8=3,I8=258,Tg=29,xu=256,bu=xu+1+Tg,il=30,Cg=19,aw=2*bu+1,Oo=15,Mg=16,B8=7,Ng=256,lw=16,uw=17,cw=18,Rg=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Rd=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),A8=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),hw=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),T8=512,us=new Array((bu+2)*2);nl(us);var yu=new Array(il*2);nl(yu);var vu=new Array(T8);nl(vu);var wu=new Array(I8-S8+1);nl(wu);var Lg=new Array(Tg);nl(Lg);var Ld=new Array(il);nl(Ld);function Og(r,e,t,n,i){this.static_tree=r,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=i,this.has_stree=r&&r.length}var dw,fw,pw;function kg(r,e){this.dyn_tree=r,this.max_code=0,this.stat_desc=e}var mw=r=>r<256?vu[r]:vu[256+(r>>>7)],Eu=(r,e)=>{r.pending_buf[r.pending++]=e&255,r.pending_buf[r.pending++]=e>>>8&255},un=(r,e,t)=>{r.bi_valid>Mg-t?(r.bi_buf|=e<<r.bi_valid&65535,Eu(r,r.bi_buf),r.bi_buf=e>>Mg-r.bi_valid,r.bi_valid+=t-Mg):(r.bi_buf|=e<<r.bi_valid&65535,r.bi_valid+=t)},Mi=(r,e,t)=>{un(r,t[e*2],t[e*2+1])},gw=(r,e)=>{let t=0;do t|=r&1,r>>>=1,t<<=1;while(--e>0);return t>>>1},C8=r=>{r.bi_valid===16?(Eu(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)},M8=(r,e)=>{let t=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,l=e.stat_desc.max_length,u,c,h,f,d,m,p=0;for(f=0;f<=Oo;f++)r.bl_count[f]=0;for(t[r.heap[r.heap_max]*2+1]=0,u=r.heap_max+1;u<aw;u++)c=r.heap[u],f=t[t[c*2+1]*2+1]+1,f>l&&(f=l,p++),t[c*2+1]=f,!(c>n)&&(r.bl_count[f]++,d=0,c>=a&&(d=o[c-a]),m=t[c*2],r.opt_len+=m*(f+d),s&&(r.static_len+=m*(i[c*2+1]+d)));if(p!==0){do{for(f=l-1;r.bl_count[f]===0;)f--;r.bl_count[f]--,r.bl_count[f+1]+=2,r.bl_count[l]--,p-=2}while(p>0);for(f=l;f!==0;f--)for(c=r.bl_count[f];c!==0;)h=r.heap[--u],!(h>n)&&(t[h*2+1]!==f&&(r.opt_len+=(f-t[h*2+1])*t[h*2],t[h*2+1]=f),c--)}},xw=(r,e,t)=>{let n=new Array(Oo+1),i=0,s,o;for(s=1;s<=Oo;s++)n[s]=i=i+t[s-1]<<1;for(o=0;o<=e;o++){let a=r[o*2+1];a!==0&&(r[o*2]=gw(n[a]++,a))}},N8=()=>{let r,e,t,n,i,s=new Array(Oo+1);for(t=0,n=0;n<Tg-1;n++)for(Lg[n]=t,r=0;r<1<<Rg[n];r++)wu[t++]=n;for(wu[t-1]=n,i=0,n=0;n<16;n++)for(Ld[n]=i,r=0;r<1<<Rd[n];r++)vu[i++]=n;for(i>>=7;n<il;n++)for(Ld[n]=i<<7,r=0;r<1<<Rd[n]-7;r++)vu[256+i++]=n;for(e=0;e<=Oo;e++)s[e]=0;for(r=0;r<=143;)us[r*2+1]=8,r++,s[8]++;for(;r<=255;)us[r*2+1]=9,r++,s[9]++;for(;r<=279;)us[r*2+1]=7,r++,s[7]++;for(;r<=287;)us[r*2+1]=8,r++,s[8]++;for(xw(us,bu+1,s),r=0;r<il;r++)yu[r*2+1]=5,yu[r*2]=gw(r,5);dw=new Og(us,Rg,xu+1,bu,Oo),fw=new Og(yu,Rd,0,il,Oo),pw=new Og(new Array(0),A8,0,Cg,B8)},bw=r=>{let e;for(e=0;e<bu;e++)r.dyn_ltree[e*2]=0;for(e=0;e<il;e++)r.dyn_dtree[e*2]=0;for(e=0;e<Cg;e++)r.bl_tree[e*2]=0;r.dyn_ltree[Ng*2]=1,r.opt_len=r.static_len=0,r.last_lit=r.matches=0},yw=r=>{r.bi_valid>8?Eu(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},R8=(r,e,t,n)=>{yw(r),n&&(Eu(r,t),Eu(r,~t)),r.pending_buf.set(r.window.subarray(e,e+t),r.pending),r.pending+=t},vw=(r,e,t,n)=>{let i=e*2,s=t*2;return r[i]<r[s]||r[i]===r[s]&&n[e]<=n[t]},Ug=(r,e,t)=>{let n=r.heap[t],i=t<<1;for(;i<=r.heap_len&&(i<r.heap_len&&vw(e,r.heap[i+1],r.heap[i],r.depth)&&i++,!vw(e,n,r.heap[i],r.depth));)r.heap[t]=r.heap[i],t=i,i<<=1;r.heap[t]=n},ww=(r,e,t)=>{let n,i,s=0,o,a;if(r.last_lit!==0)do n=r.pending_buf[r.d_buf+s*2]<<8|r.pending_buf[r.d_buf+s*2+1],i=r.pending_buf[r.l_buf+s],s++,n===0?Mi(r,i,e):(o=wu[i],Mi(r,o+xu+1,e),a=Rg[o],a!==0&&(i-=Lg[o],un(r,i,a)),n--,o=mw(n),Mi(r,o,t),a=Rd[o],a!==0&&(n-=Ld[o],un(r,n,a)));while(s<r.last_lit);Mi(r,Ng,e)},Dg=(r,e)=>{let t=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems,o,a,l=-1,u;for(r.heap_len=0,r.heap_max=aw,o=0;o<s;o++)t[o*2]!==0?(r.heap[++r.heap_len]=l=o,r.depth[o]=0):t[o*2+1]=0;for(;r.heap_len<2;)u=r.heap[++r.heap_len]=l<2?++l:0,t[u*2]=1,r.depth[u]=0,r.opt_len--,i&&(r.static_len-=n[u*2+1]);for(e.max_code=l,o=r.heap_len>>1;o>=1;o--)Ug(r,t,o);u=s;do o=r.heap[1],r.heap[1]=r.heap[r.heap_len--],Ug(r,t,1),a=r.heap[1],r.heap[--r.heap_max]=o,r.heap[--r.heap_max]=a,t[u*2]=t[o*2]+t[a*2],r.depth[u]=(r.depth[o]>=r.depth[a]?r.depth[o]:r.depth[a])+1,t[o*2+1]=t[a*2+1]=u,r.heap[1]=u++,Ug(r,t,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],M8(r,e),xw(t,l,r.bl_count)},Ew=(r,e,t)=>{let n,i=-1,s,o=e[0*2+1],a=0,l=7,u=4;for(o===0&&(l=138,u=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)s=o,o=e[(n+1)*2+1],!(++a<l&&s===o)&&(a<u?r.bl_tree[s*2]+=a:s!==0?(s!==i&&r.bl_tree[s*2]++,r.bl_tree[lw*2]++):a<=10?r.bl_tree[uw*2]++:r.bl_tree[cw*2]++,a=0,i=s,o===0?(l=138,u=3):s===o?(l=6,u=3):(l=7,u=4))},_w=(r,e,t)=>{let n,i=-1,s,o=e[0*2+1],a=0,l=7,u=4;for(o===0&&(l=138,u=3),n=0;n<=t;n++)if(s=o,o=e[(n+1)*2+1],!(++a<l&&s===o)){if(a<u)do Mi(r,s,r.bl_tree);while(--a!==0);else s!==0?(s!==i&&(Mi(r,s,r.bl_tree),a--),Mi(r,lw,r.bl_tree),un(r,a-3,2)):a<=10?(Mi(r,uw,r.bl_tree),un(r,a-3,3)):(Mi(r,cw,r.bl_tree),un(r,a-11,7));a=0,i=s,o===0?(l=138,u=3):s===o?(l=6,u=3):(l=7,u=4)}},L8=r=>{let e;for(Ew(r,r.dyn_ltree,r.l_desc.max_code),Ew(r,r.dyn_dtree,r.d_desc.max_code),Dg(r,r.bl_desc),e=Cg-1;e>=3&&r.bl_tree[hw[e]*2+1]===0;e--);return r.opt_len+=3*(e+1)+5+5+4,e},O8=(r,e,t,n)=>{let i;for(un(r,e-257,5),un(r,t-1,5),un(r,n-4,4),i=0;i<n;i++)un(r,r.bl_tree[hw[i]*2+1],3);_w(r,r.dyn_ltree,e-1),_w(r,r.dyn_dtree,t-1)},k8=r=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&r.dyn_ltree[t*2]!==0)return 0;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return 1;for(t=32;t<xu;t++)if(r.dyn_ltree[t*2]!==0)return 1;return 0},Pw=!1,U8=r=>{Pw||(N8(),Pw=!0),r.l_desc=new kg(r.dyn_ltree,dw),r.d_desc=new kg(r.dyn_dtree,fw),r.bl_desc=new kg(r.bl_tree,pw),r.bi_buf=0,r.bi_valid=0,bw(r)},Sw=(r,e,t,n)=>{un(r,(_8<<1)+(n?1:0),3),R8(r,e,t,!0)},D8=r=>{un(r,ow<<1,3),Mi(r,Ng,us),C8(r)},G8=(r,e,t,n)=>{let i,s,o=0;r.level>0?(r.strm.data_type===2&&(r.strm.data_type=k8(r)),Dg(r,r.l_desc),Dg(r,r.d_desc),o=L8(r),i=r.opt_len+3+7>>>3,s=r.static_len+3+7>>>3,s<=i&&(i=s)):i=s=t+5,t+4<=i&&e!==-1?Sw(r,e,t,n):r.strategy===4||s===i?(un(r,(ow<<1)+(n?1:0),3),ww(r,us,yu)):(un(r,(P8<<1)+(n?1:0),3),O8(r,r.l_desc.max_code+1,r.d_desc.max_code+1,o+1),ww(r,r.dyn_ltree,r.dyn_dtree)),bw(r),n&&yw(r)},F8=(r,e,t)=>(r.pending_buf[r.d_buf+r.last_lit*2]=e>>>8&255,r.pending_buf[r.d_buf+r.last_lit*2+1]=e&255,r.pending_buf[r.l_buf+r.last_lit]=t&255,r.last_lit++,e===0?r.dyn_ltree[t*2]++:(r.matches++,e--,r.dyn_ltree[(wu[t]+xu+1)*2]++,r.dyn_dtree[mw(e)*2]++),r.last_lit===r.lit_bufsize-1),q8=U8,z8=Sw,Y8=G8,X8=F8,V8=D8,W8={_tr_init:q8,_tr_stored_block:z8,_tr_flush_block:Y8,_tr_tally:X8,_tr_align:V8},$8=(r,e,t,n)=>{let i=r&65535|0,s=r>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do i=i+e[n++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0},_u=$8,j8=()=>{let r,e=[];for(var t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e},H8=new Uint32Array(j8()),Z8=(r,e,t,n)=>{let i=H8,s=n+t;r^=-1;for(let o=n;o<s;o++)r=r>>>8^i[(r^e[o])&255];return r^-1},Tr=Z8,ko={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Uo={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:K8,_tr_stored_block:Q8,_tr_flush_block:J8,_tr_tally:Ys,_tr_align:eq}=W8,{Z_NO_FLUSH:Do,Z_PARTIAL_FLUSH:tq,Z_FULL_FLUSH:rq,Z_FINISH:Xs,Z_BLOCK:Iw,Z_OK:Ni,Z_STREAM_END:Bw,Z_STREAM_ERROR:$n,Z_DATA_ERROR:nq,Z_BUF_ERROR:Gg,Z_DEFAULT_COMPRESSION:iq,Z_FILTERED:sq,Z_HUFFMAN_ONLY:Od,Z_RLE:oq,Z_FIXED:aq,Z_DEFAULT_STRATEGY:lq,Z_UNKNOWN:uq,Z_DEFLATED:kd}=Uo,cq=9,hq=15,dq=8,fq=29,pq=256,Fg=pq+1+fq,mq=30,gq=19,xq=2*Fg+1,bq=15,wt=3,Vs=258,hi=Vs+wt+1,yq=32,Ud=42,qg=69,Dd=73,Gd=91,Fd=103,Go=113,Pu=666,Pr=1,Su=2,Fo=3,sl=4,vq=3,Ws=(r,e)=>(r.msg=ko[e],e),Aw=r=>(r<<1)-(r>4?9:0),$s=r=>{let e=r.length;for(;--e>=0;)r[e]=0},wq=(r,e,t)=>(e<<r.hash_shift^t)&r.hash_mask,js=wq,Hs=r=>{let e=r.state,t=e.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(r.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),r.next_out),r.next_out+=t,e.pending_out+=t,r.total_out+=t,r.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},Or=(r,e)=>{J8(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,e),r.block_start=r.strstart,Hs(r.strm)},At=(r,e)=>{r.pending_buf[r.pending++]=e},Iu=(r,e)=>{r.pending_buf[r.pending++]=e>>>8&255,r.pending_buf[r.pending++]=e&255},Eq=(r,e,t,n)=>{let i=r.avail_in;return i>n&&(i=n),i===0?0:(r.avail_in-=i,e.set(r.input.subarray(r.next_in,r.next_in+i),t),r.state.wrap===1?r.adler=_u(r.adler,e,i,t):r.state.wrap===2&&(r.adler=Tr(r.adler,e,i,t)),r.next_in+=i,r.total_in+=i,i)},Tw=(r,e)=>{let t=r.max_chain_length,n=r.strstart,i,s,o=r.prev_length,a=r.nice_match,l=r.strstart>r.w_size-hi?r.strstart-(r.w_size-hi):0,u=r.window,c=r.w_mask,h=r.prev,f=r.strstart+Vs,d=u[n+o-1],m=u[n+o];r.prev_length>=r.good_match&&(t>>=2),a>r.lookahead&&(a=r.lookahead);do if(i=e,!(u[i+o]!==m||u[i+o-1]!==d||u[i]!==u[n]||u[++i]!==u[n+1])){n+=2,i++;do;while(u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&n<f);if(s=Vs-(f-n),n=f-Vs,s>o){if(r.match_start=e,o=s,s>=a)break;d=u[n+o-1],m=u[n+o]}}while((e=h[e&c])>l&&--t!==0);return o<=r.lookahead?o:r.lookahead},qo=r=>{let e=r.w_size,t,n,i,s,o;do{if(s=r.window_size-r.lookahead-r.strstart,r.strstart>=e+(e-hi)){r.window.set(r.window.subarray(e,e+e),0),r.match_start-=e,r.strstart-=e,r.block_start-=e,n=r.hash_size,t=n;do i=r.head[--t],r.head[t]=i>=e?i-e:0;while(--n);n=e,t=n;do i=r.prev[--t],r.prev[t]=i>=e?i-e:0;while(--n);s+=e}if(r.strm.avail_in===0)break;if(n=Eq(r.strm,r.window,r.strstart+r.lookahead,s),r.lookahead+=n,r.lookahead+r.insert>=wt)for(o=r.strstart-r.insert,r.ins_h=r.window[o],r.ins_h=js(r,r.ins_h,r.window[o+1]);r.insert&&(r.ins_h=js(r,r.ins_h,r.window[o+wt-1]),r.prev[o&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=o,o++,r.insert--,!(r.lookahead+r.insert<wt)););}while(r.lookahead<hi&&r.strm.avail_in!==0)},_q=(r,e)=>{let t=65535;for(t>r.pending_buf_size-5&&(t=r.pending_buf_size-5);;){if(r.lookahead<=1){if(qo(r),r.lookahead===0&&e===Do)return Pr;if(r.lookahead===0)break}r.strstart+=r.lookahead,r.lookahead=0;let n=r.block_start+t;if((r.strstart===0||r.strstart>=n)&&(r.lookahead=r.strstart-n,r.strstart=n,Or(r,!1),r.strm.avail_out===0)||r.strstart-r.block_start>=r.w_size-hi&&(Or(r,!1),r.strm.avail_out===0))return Pr}return r.insert=0,e===Xs?(Or(r,!0),r.strm.avail_out===0?Fo:sl):(r.strstart>r.block_start&&(Or(r,!1),r.strm.avail_out===0),Pr)},zg=(r,e)=>{let t,n;for(;;){if(r.lookahead<hi){if(qo(r),r.lookahead<hi&&e===Do)return Pr;if(r.lookahead===0)break}if(t=0,r.lookahead>=wt&&(r.ins_h=js(r,r.ins_h,r.window[r.strstart+wt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-hi&&(r.match_length=Tw(r,t)),r.match_length>=wt)if(n=Ys(r,r.strstart-r.match_start,r.match_length-wt),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=wt){r.match_length--;do r.strstart++,r.ins_h=js(r,r.ins_h,r.window[r.strstart+wt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=js(r,r.ins_h,r.window[r.strstart+1]);else n=Ys(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(Or(r,!1),r.strm.avail_out===0))return Pr}return r.insert=r.strstart<wt-1?r.strstart:wt-1,e===Xs?(Or(r,!0),r.strm.avail_out===0?Fo:sl):r.last_lit&&(Or(r,!1),r.strm.avail_out===0)?Pr:Su},ol=(r,e)=>{let t,n,i;for(;;){if(r.lookahead<hi){if(qo(r),r.lookahead<hi&&e===Do)return Pr;if(r.lookahead===0)break}if(t=0,r.lookahead>=wt&&(r.ins_h=js(r,r.ins_h,r.window[r.strstart+wt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=wt-1,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-hi&&(r.match_length=Tw(r,t),r.match_length<=5&&(r.strategy===sq||r.match_length===wt&&r.strstart-r.match_start>4096)&&(r.match_length=wt-1)),r.prev_length>=wt&&r.match_length<=r.prev_length){i=r.strstart+r.lookahead-wt,n=Ys(r,r.strstart-1-r.prev_match,r.prev_length-wt),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=i&&(r.ins_h=js(r,r.ins_h,r.window[r.strstart+wt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=wt-1,r.strstart++,n&&(Or(r,!1),r.strm.avail_out===0))return Pr}else if(r.match_available){if(n=Ys(r,0,r.window[r.strstart-1]),n&&Or(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return Pr}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=Ys(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<wt-1?r.strstart:wt-1,e===Xs?(Or(r,!0),r.strm.avail_out===0?Fo:sl):r.last_lit&&(Or(r,!1),r.strm.avail_out===0)?Pr:Su},Pq=(r,e)=>{let t,n,i,s,o=r.window;for(;;){if(r.lookahead<=Vs){if(qo(r),r.lookahead<=Vs&&e===Do)return Pr;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=wt&&r.strstart>0&&(i=r.strstart-1,n=o[i],n===o[++i]&&n===o[++i]&&n===o[++i])){s=r.strstart+Vs;do;while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&i<s);r.match_length=Vs-(s-i),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=wt?(t=Ys(r,1,r.match_length-wt),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(t=Ys(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),t&&(Or(r,!1),r.strm.avail_out===0))return Pr}return r.insert=0,e===Xs?(Or(r,!0),r.strm.avail_out===0?Fo:sl):r.last_lit&&(Or(r,!1),r.strm.avail_out===0)?Pr:Su},Sq=(r,e)=>{let t;for(;;){if(r.lookahead===0&&(qo(r),r.lookahead===0)){if(e===Do)return Pr;break}if(r.match_length=0,t=Ys(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,t&&(Or(r,!1),r.strm.avail_out===0))return Pr}return r.insert=0,e===Xs?(Or(r,!0),r.strm.avail_out===0?Fo:sl):r.last_lit&&(Or(r,!1),r.strm.avail_out===0)?Pr:Su};function Ri(r,e,t,n,i){this.good_length=r,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=i}var Bu=[new Ri(0,0,0,0,_q),new Ri(4,4,8,4,zg),new Ri(4,5,16,8,zg),new Ri(4,6,32,32,zg),new Ri(4,4,16,16,ol),new Ri(8,16,32,32,ol),new Ri(8,16,128,128,ol),new Ri(8,32,128,256,ol),new Ri(32,128,258,1024,ol),new Ri(32,258,258,4096,ol)],Iq=r=>{r.window_size=2*r.w_size,$s(r.head),r.max_lazy_match=Bu[r.level].max_lazy,r.good_match=Bu[r.level].good_length,r.nice_match=Bu[r.level].nice_length,r.max_chain_length=Bu[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=wt-1,r.match_available=0,r.ins_h=0};function Bq(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=kd,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(xq*2),this.dyn_dtree=new Uint16Array((2*mq+1)*2),this.bl_tree=new Uint16Array((2*gq+1)*2),$s(this.dyn_ltree),$s(this.dyn_dtree),$s(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(bq+1),this.heap=new Uint16Array(2*Fg+1),$s(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Fg+1),$s(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Cw=r=>{if(!r||!r.state)return Ws(r,$n);r.total_in=r.total_out=0,r.data_type=uq;let e=r.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?Ud:Go,r.adler=e.wrap===2?0:1,e.last_flush=Do,K8(e),Ni},Mw=r=>{let e=Cw(r);return e===Ni&&Iq(r.state),e},Aq=(r,e)=>!r||!r.state||r.state.wrap!==2?$n:(r.state.gzhead=e,Ni),Nw=(r,e,t,n,i,s)=>{if(!r)return $n;let o=1;if(e===iq&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),i<1||i>cq||t!==kd||n<8||n>15||e<0||e>9||s<0||s>aq)return Ws(r,$n);n===8&&(n=9);let a=new Bq;return r.state=a,a.strm=r,a.wrap=o,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+wt-1)/wt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=(1+2)*a.lit_bufsize,a.level=e,a.strategy=s,a.method=t,Mw(r)},Tq=(r,e)=>Nw(r,e,kd,hq,dq,lq),Cq=(r,e)=>{let t,n;if(!r||!r.state||e>Iw||e<0)return r?Ws(r,$n):$n;let i=r.state;if(!r.output||!r.input&&r.avail_in!==0||i.status===Pu&&e!==Xs)return Ws(r,r.avail_out===0?Gg:$n);i.strm=r;let s=i.last_flush;if(i.last_flush=e,i.status===Ud)if(i.wrap===2)r.adler=0,At(i,31),At(i,139),At(i,8),i.gzhead?(At(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),At(i,i.gzhead.time&255),At(i,i.gzhead.time>>8&255),At(i,i.gzhead.time>>16&255),At(i,i.gzhead.time>>24&255),At(i,i.level===9?2:i.strategy>=Od||i.level<2?4:0),At(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(At(i,i.gzhead.extra.length&255),At(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(r.adler=Tr(r.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=qg):(At(i,0),At(i,0),At(i,0),At(i,0),At(i,0),At(i,i.level===9?2:i.strategy>=Od||i.level<2?4:0),At(i,vq),i.status=Go);else{let o=kd+(i.w_bits-8<<4)<<8,a=-1;i.strategy>=Od||i.level<2?a=0:i.level<6?a=1:i.level===6?a=2:a=3,o|=a<<6,i.strstart!==0&&(o|=yq),o+=31-o%31,i.status=Go,Iu(i,o),i.strstart!==0&&(Iu(i,r.adler>>>16),Iu(i,r.adler&65535)),r.adler=1}if(i.status===qg)if(i.gzhead.extra){for(t=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>t&&(r.adler=Tr(r.adler,i.pending_buf,i.pending-t,t)),Hs(r),t=i.pending,i.pending===i.pending_buf_size));)At(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>t&&(r.adler=Tr(r.adler,i.pending_buf,i.pending-t,t)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=Dd)}else i.status=Dd;if(i.status===Dd)if(i.gzhead.name){t=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>t&&(r.adler=Tr(r.adler,i.pending_buf,i.pending-t,t)),Hs(r),t=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.name.length?n=i.gzhead.name.charCodeAt(i.gzindex++)&255:n=0,At(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>t&&(r.adler=Tr(r.adler,i.pending_buf,i.pending-t,t)),n===0&&(i.gzindex=0,i.status=Gd)}else i.status=Gd;if(i.status===Gd)if(i.gzhead.comment){t=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>t&&(r.adler=Tr(r.adler,i.pending_buf,i.pending-t,t)),Hs(r),t=i.pending,i.pending===i.pending_buf_size)){n=1;break}i.gzindex<i.gzhead.comment.length?n=i.gzhead.comment.charCodeAt(i.gzindex++)&255:n=0,At(i,n)}while(n!==0);i.gzhead.hcrc&&i.pending>t&&(r.adler=Tr(r.adler,i.pending_buf,i.pending-t,t)),n===0&&(i.status=Fd)}else i.status=Fd;if(i.status===Fd&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Hs(r),i.pending+2<=i.pending_buf_size&&(At(i,r.adler&255),At(i,r.adler>>8&255),r.adler=0,i.status=Go)):i.status=Go),i.pending!==0){if(Hs(r),r.avail_out===0)return i.last_flush=-1,Ni}else if(r.avail_in===0&&Aw(e)<=Aw(s)&&e!==Xs)return Ws(r,Gg);if(i.status===Pu&&r.avail_in!==0)return Ws(r,Gg);if(r.avail_in!==0||i.lookahead!==0||e!==Do&&i.status!==Pu){let o=i.strategy===Od?Sq(i,e):i.strategy===oq?Pq(i,e):Bu[i.level].func(i,e);if((o===Fo||o===sl)&&(i.status=Pu),o===Pr||o===Fo)return r.avail_out===0&&(i.last_flush=-1),Ni;if(o===Su&&(e===tq?eq(i):e!==Iw&&(Q8(i,0,0,!1),e===rq&&($s(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),Hs(r),r.avail_out===0))return i.last_flush=-1,Ni}return e!==Xs?Ni:i.wrap<=0?Bw:(i.wrap===2?(At(i,r.adler&255),At(i,r.adler>>8&255),At(i,r.adler>>16&255),At(i,r.adler>>24&255),At(i,r.total_in&255),At(i,r.total_in>>8&255),At(i,r.total_in>>16&255),At(i,r.total_in>>24&255)):(Iu(i,r.adler>>>16),Iu(i,r.adler&65535)),Hs(r),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Ni:Bw)},Mq=r=>{if(!r||!r.state)return $n;let e=r.state.status;return e!==Ud&&e!==qg&&e!==Dd&&e!==Gd&&e!==Fd&&e!==Go&&e!==Pu?Ws(r,$n):(r.state=null,e===Go?Ws(r,nq):Ni)},Nq=(r,e)=>{let t=e.length;if(!r||!r.state)return $n;let n=r.state,i=n.wrap;if(i===2||i===1&&n.status!==Ud||n.lookahead)return $n;if(i===1&&(r.adler=_u(r.adler,e,t,0)),n.wrap=0,t>=n.w_size){i===0&&($s(n.head),n.strstart=0,n.block_start=0,n.insert=0);let l=new Uint8Array(n.w_size);l.set(e.subarray(t-n.w_size,t),0),e=l,t=n.w_size}let s=r.avail_in,o=r.next_in,a=r.input;for(r.avail_in=t,r.next_in=0,r.input=e,qo(n);n.lookahead>=wt;){let l=n.strstart,u=n.lookahead-(wt-1);do n.ins_h=js(n,n.ins_h,n.window[l+wt-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++;while(--u);n.strstart=l,n.lookahead=wt-1,qo(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=wt-1,n.match_available=0,r.next_in=o,r.input=a,r.avail_in=s,n.wrap=i,Ni},Rq=Tq,Lq=Nw,Oq=Mw,kq=Cw,Uq=Aq,Dq=Cq,Gq=Mq,Fq=Nq,qq="pako deflate (from Nodeca project)",Au={deflateInit:Rq,deflateInit2:Lq,deflateReset:Oq,deflateResetKeep:kq,deflateSetHeader:Uq,deflate:Dq,deflateEnd:Gq,deflateSetDictionary:Fq,deflateInfo:qq},zq=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),Yq=function(r){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(!!t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let n in t)zq(t,n)&&(r[n]=t[n])}}return r},Xq=r=>{let e=0;for(let n=0,i=r.length;n<i;n++)e+=r[n].length;let t=new Uint8Array(e);for(let n=0,i=0,s=r.length;n<s;n++){let o=r[n];t.set(o,i),i+=o.length}return t},qd={assign:Yq,flattenChunks:Xq},Rw=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Rw=!1}var Tu=new Uint8Array(256);for(let r=0;r<256;r++)Tu[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;Tu[254]=Tu[254]=1;var Vq=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let e,t,n,i,s,o=r.length,a=0;for(i=0;i<o;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<o&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<o&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|t&63):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|t&63):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|t&63);return e},Wq=(r,e)=>{if(e<65534&&r.subarray&&Rw)return String.fromCharCode.apply(null,r.length===e?r:r.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(r[n]);return t},$q=(r,e)=>{let t=e||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,e));let n,i,s=new Array(t*2);for(i=0,n=0;n<t;){let o=r[n++];if(o<128){s[i++]=o;continue}let a=Tu[o];if(a>4){s[i++]=65533,n+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&n<t;)o=o<<6|r[n++]&63,a--;if(a>1){s[i++]=65533;continue}o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|o&1023)}return Wq(s,i)},jq=(r,e)=>{e=e||r.length,e>r.length&&(e=r.length);let t=e-1;for(;t>=0&&(r[t]&192)===128;)t--;return t<0||t===0?e:t+Tu[r[t]]>e?t:e},Cu={string2buf:Vq,buf2string:$q,utf8border:jq};function Hq(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Lw=Hq,Ow=Object.prototype.toString,{Z_NO_FLUSH:Zq,Z_SYNC_FLUSH:Kq,Z_FULL_FLUSH:Qq,Z_FINISH:Jq,Z_OK:zd,Z_STREAM_END:ez,Z_DEFAULT_COMPRESSION:tz,Z_DEFAULT_STRATEGY:rz,Z_DEFLATED:nz}=Uo;function Mu(r){this.options=qd.assign({level:tz,method:nz,chunkSize:16384,windowBits:15,memLevel:8,strategy:rz},r||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Lw,this.strm.avail_out=0;let t=Au.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==zd)throw new Error(ko[t]);if(e.header&&Au.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=Cu.string2buf(e.dictionary):Ow.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=Au.deflateSetDictionary(this.strm,n),t!==zd)throw new Error(ko[t]);this._dict_set=!0}}Mu.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?Jq:Zq,typeof r=="string"?t.input=Cu.string2buf(r):Ow.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(s===Kq||s===Qq)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(i=Au.deflate(t,s),i===ez)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),i=Au.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===zd;if(t.avail_out===0){this.onData(t.output);continue}if(s>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0},Mu.prototype.onData=function(r){this.chunks.push(r)},Mu.prototype.onEnd=function(r){r===zd&&(this.result=qd.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function Yg(r,e){let t=new Mu(e);if(t.push(r,!0),t.err)throw t.msg||ko[t.err];return t.result}function iz(r,e){return e=e||{},e.raw=!0,Yg(r,e)}function sz(r,e){return e=e||{},e.gzip=!0,Yg(r,e)}var oz=Mu,az=Yg,lz=iz,uz=sz,cz=Uo,hz={Deflate:oz,deflate:az,deflateRaw:lz,gzip:uz,constants:cz},Yd=30,dz=12,fz=function(e,t){let n,i,s,o,a,l,u,c,h,f,d,m,p,g,b,v,w,P,_,B,I,C,N,A,M=e.state;n=e.next_in,N=e.input,i=n+(e.avail_in-5),s=e.next_out,A=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),l=M.dmax,u=M.wsize,c=M.whave,h=M.wnext,f=M.window,d=M.hold,m=M.bits,p=M.lencode,g=M.distcode,b=(1<<M.lenbits)-1,v=(1<<M.distbits)-1;e:do{m<15&&(d+=N[n++]<<m,m+=8,d+=N[n++]<<m,m+=8),w=p[d&b];t:for(;;){if(P=w>>>24,d>>>=P,m-=P,P=w>>>16&255,P===0)A[s++]=w&65535;else if(P&16){_=w&65535,P&=15,P&&(m<P&&(d+=N[n++]<<m,m+=8),_+=d&(1<<P)-1,d>>>=P,m-=P),m<15&&(d+=N[n++]<<m,m+=8,d+=N[n++]<<m,m+=8),w=g[d&v];r:for(;;){if(P=w>>>24,d>>>=P,m-=P,P=w>>>16&255,P&16){if(B=w&65535,P&=15,m<P&&(d+=N[n++]<<m,m+=8,m<P&&(d+=N[n++]<<m,m+=8)),B+=d&(1<<P)-1,B>l){e.msg="invalid distance too far back",M.mode=Yd;break e}if(d>>>=P,m-=P,P=s-o,B>P){if(P=B-P,P>c&&M.sane){e.msg="invalid distance too far back",M.mode=Yd;break e}if(I=0,C=f,h===0){if(I+=u-P,P<_){_-=P;do A[s++]=f[I++];while(--P);I=s-B,C=A}}else if(h<P){if(I+=u+h-P,P-=h,P<_){_-=P;do A[s++]=f[I++];while(--P);if(I=0,h<_){P=h,_-=P;do A[s++]=f[I++];while(--P);I=s-B,C=A}}}else if(I+=h-P,P<_){_-=P;do A[s++]=f[I++];while(--P);I=s-B,C=A}for(;_>2;)A[s++]=C[I++],A[s++]=C[I++],A[s++]=C[I++],_-=3;_&&(A[s++]=C[I++],_>1&&(A[s++]=C[I++]))}else{I=s-B;do A[s++]=A[I++],A[s++]=A[I++],A[s++]=A[I++],_-=3;while(_>2);_&&(A[s++]=A[I++],_>1&&(A[s++]=A[I++]))}}else if((P&64)===0){w=g[(w&65535)+(d&(1<<P)-1)];continue r}else{e.msg="invalid distance code",M.mode=Yd;break e}break}}else if((P&64)===0){w=p[(w&65535)+(d&(1<<P)-1)];continue t}else if(P&32){M.mode=dz;break e}else{e.msg="invalid literal/length code",M.mode=Yd;break e}break}}while(n<i&&s<a);_=m>>3,n-=_,m-=_<<3,d&=(1<<m)-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?5+(i-n):5-(n-i),e.avail_out=s<a?257+(a-s):257-(s-a),M.hold=d,M.bits=m},al=15,kw=852,Uw=592,Dw=0,Xg=1,Gw=2,pz=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),mz=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),gz=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),xz=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),bz=(r,e,t,n,i,s,o,a)=>{let l=a.bits,u=0,c=0,h=0,f=0,d=0,m=0,p=0,g=0,b=0,v=0,w,P,_,B,I,C=null,N=0,A,M=new Uint16Array(al+1),S=new Uint16Array(al+1),$=null,H=0,K,F,z;for(u=0;u<=al;u++)M[u]=0;for(c=0;c<n;c++)M[e[t+c]]++;for(d=l,f=al;f>=1&&M[f]===0;f--);if(d>f&&(d=f),f===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,a.bits=1,0;for(h=1;h<f&&M[h]===0;h++);for(d<h&&(d=h),g=1,u=1;u<=al;u++)if(g<<=1,g-=M[u],g<0)return-1;if(g>0&&(r===Dw||f!==1))return-1;for(S[1]=0,u=1;u<al;u++)S[u+1]=S[u]+M[u];for(c=0;c<n;c++)e[t+c]!==0&&(o[S[e[t+c]]++]=c);if(r===Dw?(C=$=o,A=19):r===Xg?(C=pz,N-=257,$=mz,H-=257,A=256):(C=gz,$=xz,A=-1),v=0,c=0,u=h,I=s,m=d,p=0,_=-1,b=1<<d,B=b-1,r===Xg&&b>kw||r===Gw&&b>Uw)return 1;for(;;){K=u-p,o[c]<A?(F=0,z=o[c]):o[c]>A?(F=$[H+o[c]],z=C[N+o[c]]):(F=32+64,z=0),w=1<<u-p,P=1<<m,h=P;do P-=w,i[I+(v>>p)+P]=K<<24|F<<16|z|0;while(P!==0);for(w=1<<u-1;v&w;)w>>=1;if(w!==0?(v&=w-1,v+=w):v=0,c++,--M[u]===0){if(u===f)break;u=e[t+o[c]]}if(u>d&&(v&B)!==_){for(p===0&&(p=d),I+=h,m=u-p,g=1<<m;m+p<f&&(g-=M[m+p],!(g<=0));)m++,g<<=1;if(b+=1<<m,r===Xg&&b>kw||r===Gw&&b>Uw)return 1;_=v&B,i[_]=d<<24|m<<16|I-s|0}}return v!==0&&(i[I+v]=u-p<<24|64<<16|0),a.bits=d,0},Nu=bz,yz=0,Fw=1,qw=2,{Z_FINISH:zw,Z_BLOCK:vz,Z_TREES:Xd,Z_OK:zo,Z_STREAM_END:wz,Z_NEED_DICT:Ez,Z_STREAM_ERROR:jn,Z_DATA_ERROR:Yw,Z_MEM_ERROR:Xw,Z_BUF_ERROR:_z,Z_DEFLATED:Vw}=Uo,Ww=1,$w=2,jw=3,Hw=4,Zw=5,Kw=6,Qw=7,Jw=8,eE=9,tE=10,Vd=11,cs=12,Vg=13,rE=14,Wg=15,nE=16,iE=17,sE=18,oE=19,Wd=20,$d=21,aE=22,lE=23,uE=24,cE=25,hE=26,$g=27,dE=28,fE=29,Kt=30,pE=31,Pz=32,Sz=852,Iz=592,Bz=15,Az=Bz,mE=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function Tz(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var gE=r=>{if(!r||!r.state)return jn;let e=r.state;return r.total_in=r.total_out=e.total=0,r.msg="",e.wrap&&(r.adler=e.wrap&1),e.mode=Ww,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(Sz),e.distcode=e.distdyn=new Int32Array(Iz),e.sane=1,e.back=-1,zo},xE=r=>{if(!r||!r.state)return jn;let e=r.state;return e.wsize=0,e.whave=0,e.wnext=0,gE(r)},bE=(r,e)=>{let t;if(!r||!r.state)return jn;let n=r.state;return e<0?(t=0,e=-e):(t=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?jn:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,xE(r))},yE=(r,e)=>{if(!r)return jn;let t=new Tz;r.state=t,t.window=null;let n=bE(r,e);return n!==zo&&(r.state=null),n},Cz=r=>yE(r,Az),vE=!0,jg,Hg,Mz=r=>{if(vE){jg=new Int32Array(512),Hg=new Int32Array(32);let e=0;for(;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for(Nu(Fw,r.lens,0,288,jg,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;Nu(qw,r.lens,0,32,Hg,0,r.work,{bits:5}),vE=!1}r.lencode=jg,r.lenbits=9,r.distcode=Hg,r.distbits=5},wE=(r,e,t,n)=>{let i,s=r.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(e.subarray(t-s.wsize,t),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>n&&(i=n),s.window.set(e.subarray(t-n,t-n+i),s.wnext),n-=i,n?(s.window.set(e.subarray(t-n,t),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},Nz=(r,e)=>{let t,n,i,s,o,a,l,u,c,h,f,d,m,p,g=0,b,v,w,P,_,B,I,C,N=new Uint8Array(4),A,M,S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!r||!r.state||!r.output||!r.input&&r.avail_in!==0)return jn;t=r.state,t.mode===cs&&(t.mode=Vg),o=r.next_out,i=r.output,l=r.avail_out,s=r.next_in,n=r.input,a=r.avail_in,u=t.hold,c=t.bits,h=a,f=l,C=zo;e:for(;;)switch(t.mode){case Ww:if(t.wrap===0){t.mode=Vg;break}for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(t.wrap&2&&u===35615){t.check=0,N[0]=u&255,N[1]=u>>>8&255,t.check=Tr(t.check,N,2,0),u=0,c=0,t.mode=$w;break}if(t.flags=0,t.head&&(t.head.done=!1),!(t.wrap&1)||(((u&255)<<8)+(u>>8))%31){r.msg="incorrect header check",t.mode=Kt;break}if((u&15)!==Vw){r.msg="unknown compression method",t.mode=Kt;break}if(u>>>=4,c-=4,I=(u&15)+8,t.wbits===0)t.wbits=I;else if(I>t.wbits){r.msg="invalid window size",t.mode=Kt;break}t.dmax=1<<t.wbits,r.adler=t.check=1,t.mode=u&512?tE:cs,u=0,c=0;break;case $w:for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(t.flags=u,(t.flags&255)!==Vw){r.msg="unknown compression method",t.mode=Kt;break}if(t.flags&57344){r.msg="unknown header flags set",t.mode=Kt;break}t.head&&(t.head.text=u>>8&1),t.flags&512&&(N[0]=u&255,N[1]=u>>>8&255,t.check=Tr(t.check,N,2,0)),u=0,c=0,t.mode=jw;case jw:for(;c<32;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}t.head&&(t.head.time=u),t.flags&512&&(N[0]=u&255,N[1]=u>>>8&255,N[2]=u>>>16&255,N[3]=u>>>24&255,t.check=Tr(t.check,N,4,0)),u=0,c=0,t.mode=Hw;case Hw:for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}t.head&&(t.head.xflags=u&255,t.head.os=u>>8),t.flags&512&&(N[0]=u&255,N[1]=u>>>8&255,t.check=Tr(t.check,N,2,0)),u=0,c=0,t.mode=Zw;case Zw:if(t.flags&1024){for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}t.length=u,t.head&&(t.head.extra_len=u),t.flags&512&&(N[0]=u&255,N[1]=u>>>8&255,t.check=Tr(t.check,N,2,0)),u=0,c=0}else t.head&&(t.head.extra=null);t.mode=Kw;case Kw:if(t.flags&1024&&(d=t.length,d>a&&(d=a),d&&(t.head&&(I=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(s,s+d),I)),t.flags&512&&(t.check=Tr(t.check,n,d,s)),a-=d,s+=d,t.length-=d),t.length))break e;t.length=0,t.mode=Qw;case Qw:if(t.flags&2048){if(a===0)break e;d=0;do I=n[s+d++],t.head&&I&&t.length<65536&&(t.head.name+=String.fromCharCode(I));while(I&&d<a);if(t.flags&512&&(t.check=Tr(t.check,n,d,s)),a-=d,s+=d,I)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=Jw;case Jw:if(t.flags&4096){if(a===0)break e;d=0;do I=n[s+d++],t.head&&I&&t.length<65536&&(t.head.comment+=String.fromCharCode(I));while(I&&d<a);if(t.flags&512&&(t.check=Tr(t.check,n,d,s)),a-=d,s+=d,I)break e}else t.head&&(t.head.comment=null);t.mode=eE;case eE:if(t.flags&512){for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(u!==(t.check&65535)){r.msg="header crc mismatch",t.mode=Kt;break}u=0,c=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=cs;break;case tE:for(;c<32;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}r.adler=t.check=mE(u),u=0,c=0,t.mode=Vd;case Vd:if(t.havedict===0)return r.next_out=o,r.avail_out=l,r.next_in=s,r.avail_in=a,t.hold=u,t.bits=c,Ez;r.adler=t.check=1,t.mode=cs;case cs:if(e===vz||e===Xd)break e;case Vg:if(t.last){u>>>=c&7,c-=c&7,t.mode=$g;break}for(;c<3;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}switch(t.last=u&1,u>>>=1,c-=1,u&3){case 0:t.mode=rE;break;case 1:if(Mz(t),t.mode=Wd,e===Xd){u>>>=2,c-=2;break e}break;case 2:t.mode=iE;break;case 3:r.msg="invalid block type",t.mode=Kt}u>>>=2,c-=2;break;case rE:for(u>>>=c&7,c-=c&7;c<32;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if((u&65535)!==(u>>>16^65535)){r.msg="invalid stored block lengths",t.mode=Kt;break}if(t.length=u&65535,u=0,c=0,t.mode=Wg,e===Xd)break e;case Wg:t.mode=nE;case nE:if(d=t.length,d){if(d>a&&(d=a),d>l&&(d=l),d===0)break e;i.set(n.subarray(s,s+d),o),a-=d,s+=d,l-=d,o+=d,t.length-=d;break}t.mode=cs;break;case iE:for(;c<14;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(t.nlen=(u&31)+257,u>>>=5,c-=5,t.ndist=(u&31)+1,u>>>=5,c-=5,t.ncode=(u&15)+4,u>>>=4,c-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=Kt;break}t.have=0,t.mode=sE;case sE:for(;t.have<t.ncode;){for(;c<3;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}t.lens[S[t.have++]]=u&7,u>>>=3,c-=3}for(;t.have<19;)t.lens[S[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,A={bits:t.lenbits},C=Nu(yz,t.lens,0,19,t.lencode,0,t.work,A),t.lenbits=A.bits,C){r.msg="invalid code lengths set",t.mode=Kt;break}t.have=0,t.mode=oE;case oE:for(;t.have<t.nlen+t.ndist;){for(;g=t.lencode[u&(1<<t.lenbits)-1],b=g>>>24,v=g>>>16&255,w=g&65535,!(b<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(w<16)u>>>=b,c-=b,t.lens[t.have++]=w;else{if(w===16){for(M=b+2;c<M;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(u>>>=b,c-=b,t.have===0){r.msg="invalid bit length repeat",t.mode=Kt;break}I=t.lens[t.have-1],d=3+(u&3),u>>>=2,c-=2}else if(w===17){for(M=b+3;c<M;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}u>>>=b,c-=b,I=0,d=3+(u&7),u>>>=3,c-=3}else{for(M=b+7;c<M;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}u>>>=b,c-=b,I=0,d=11+(u&127),u>>>=7,c-=7}if(t.have+d>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=Kt;break}for(;d--;)t.lens[t.have++]=I}}if(t.mode===Kt)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=Kt;break}if(t.lenbits=9,A={bits:t.lenbits},C=Nu(Fw,t.lens,0,t.nlen,t.lencode,0,t.work,A),t.lenbits=A.bits,C){r.msg="invalid literal/lengths set",t.mode=Kt;break}if(t.distbits=6,t.distcode=t.distdyn,A={bits:t.distbits},C=Nu(qw,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,A),t.distbits=A.bits,C){r.msg="invalid distances set",t.mode=Kt;break}if(t.mode=Wd,e===Xd)break e;case Wd:t.mode=$d;case $d:if(a>=6&&l>=258){r.next_out=o,r.avail_out=l,r.next_in=s,r.avail_in=a,t.hold=u,t.bits=c,fz(r,f),o=r.next_out,i=r.output,l=r.avail_out,s=r.next_in,n=r.input,a=r.avail_in,u=t.hold,c=t.bits,t.mode===cs&&(t.back=-1);break}for(t.back=0;g=t.lencode[u&(1<<t.lenbits)-1],b=g>>>24,v=g>>>16&255,w=g&65535,!(b<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(v&&(v&240)===0){for(P=b,_=v,B=w;g=t.lencode[B+((u&(1<<P+_)-1)>>P)],b=g>>>24,v=g>>>16&255,w=g&65535,!(P+b<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}u>>>=P,c-=P,t.back+=P}if(u>>>=b,c-=b,t.back+=b,t.length=w,v===0){t.mode=hE;break}if(v&32){t.back=-1,t.mode=cs;break}if(v&64){r.msg="invalid literal/length code",t.mode=Kt;break}t.extra=v&15,t.mode=aE;case aE:if(t.extra){for(M=t.extra;c<M;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}t.length+=u&(1<<t.extra)-1,u>>>=t.extra,c-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=lE;case lE:for(;g=t.distcode[u&(1<<t.distbits)-1],b=g>>>24,v=g>>>16&255,w=g&65535,!(b<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if((v&240)===0){for(P=b,_=v,B=w;g=t.distcode[B+((u&(1<<P+_)-1)>>P)],b=g>>>24,v=g>>>16&255,w=g&65535,!(P+b<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}u>>>=P,c-=P,t.back+=P}if(u>>>=b,c-=b,t.back+=b,v&64){r.msg="invalid distance code",t.mode=Kt;break}t.offset=w,t.extra=v&15,t.mode=uE;case uE:if(t.extra){for(M=t.extra;c<M;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}t.offset+=u&(1<<t.extra)-1,u>>>=t.extra,c-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=Kt;break}t.mode=cE;case cE:if(l===0)break e;if(d=f-l,t.offset>d){if(d=t.offset-d,d>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=Kt;break}d>t.wnext?(d-=t.wnext,m=t.wsize-d):m=t.wnext-d,d>t.length&&(d=t.length),p=t.window}else p=i,m=o-t.offset,d=t.length;d>l&&(d=l),l-=d,t.length-=d;do i[o++]=p[m++];while(--d);t.length===0&&(t.mode=$d);break;case hE:if(l===0)break e;i[o++]=t.length,l--,t.mode=$d;break;case $g:if(t.wrap){for(;c<32;){if(a===0)break e;a--,u|=n[s++]<<c,c+=8}if(f-=l,r.total_out+=f,t.total+=f,f&&(r.adler=t.check=t.flags?Tr(t.check,i,f,o-f):_u(t.check,i,f,o-f)),f=l,(t.flags?u:mE(u))!==t.check){r.msg="incorrect data check",t.mode=Kt;break}u=0,c=0}t.mode=dE;case dE:if(t.wrap&&t.flags){for(;c<32;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(u!==(t.total&4294967295)){r.msg="incorrect length check",t.mode=Kt;break}u=0,c=0}t.mode=fE;case fE:C=wz;break e;case Kt:C=Yw;break e;case pE:return Xw;case Pz:default:return jn}return r.next_out=o,r.avail_out=l,r.next_in=s,r.avail_in=a,t.hold=u,t.bits=c,(t.wsize||f!==r.avail_out&&t.mode<Kt&&(t.mode<$g||e!==zw))&&wE(r,r.output,r.next_out,f-r.avail_out),h-=r.avail_in,f-=r.avail_out,r.total_in+=h,r.total_out+=f,t.total+=f,t.wrap&&f&&(r.adler=t.check=t.flags?Tr(t.check,i,f,r.next_out-f):_u(t.check,i,f,r.next_out-f)),r.data_type=t.bits+(t.last?64:0)+(t.mode===cs?128:0)+(t.mode===Wd||t.mode===Wg?256:0),(h===0&&f===0||e===zw)&&C===zo&&(C=_z),C},Rz=r=>{if(!r||!r.state)return jn;let e=r.state;return e.window&&(e.window=null),r.state=null,zo},Lz=(r,e)=>{if(!r||!r.state)return jn;let t=r.state;return(t.wrap&2)===0?jn:(t.head=e,e.done=!1,zo)},Oz=(r,e)=>{let t=e.length,n,i,s;return!r||!r.state||(n=r.state,n.wrap!==0&&n.mode!==Vd)?jn:n.mode===Vd&&(i=1,i=_u(i,e,t,0),i!==n.check)?Yw:(s=wE(r,e,t,t),s?(n.mode=pE,Xw):(n.havedict=1,zo))},kz=xE,Uz=bE,Dz=gE,Gz=Cz,Fz=yE,qz=Nz,zz=Rz,Yz=Lz,Xz=Oz,Vz="pako inflate (from Nodeca project)",hs={inflateReset:kz,inflateReset2:Uz,inflateResetKeep:Dz,inflateInit:Gz,inflateInit2:Fz,inflate:qz,inflateEnd:zz,inflateGetHeader:Yz,inflateSetDictionary:Xz,inflateInfo:Vz};function Wz(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var $z=Wz,EE=Object.prototype.toString,{Z_NO_FLUSH:jz,Z_FINISH:Hz,Z_OK:Ru,Z_STREAM_END:Zg,Z_NEED_DICT:Kg,Z_STREAM_ERROR:Zz,Z_DATA_ERROR:_E,Z_MEM_ERROR:Kz}=Uo;function Lu(r){this.options=qd.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(r&&r.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Lw,this.strm.avail_out=0;let t=hs.inflateInit2(this.strm,e.windowBits);if(t!==Ru)throw new Error(ko[t]);if(this.header=new $z,hs.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Cu.string2buf(e.dictionary):EE.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=hs.inflateSetDictionary(this.strm,e.dictionary),t!==Ru)))throw new Error(ko[t])}Lu.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i=this.options.dictionary,s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?Hz:jz,EE.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),s=hs.inflate(t,o),s===Kg&&i&&(s=hs.inflateSetDictionary(t,i),s===Ru?s=hs.inflate(t,o):s===_E&&(s=Kg));t.avail_in>0&&s===Zg&&t.state.wrap>0&&r[t.next_in]!==0;)hs.inflateReset(t),s=hs.inflate(t,o);switch(s){case Zz:case _E:case Kg:case Kz:return this.onEnd(s),this.ended=!0,!1}if(a=t.avail_out,t.next_out&&(t.avail_out===0||s===Zg))if(this.options.to==="string"){let l=Cu.utf8border(t.output,t.next_out),u=t.next_out-l,c=Cu.buf2string(t.output,l);t.next_out=u,t.avail_out=n-u,u&&t.output.set(t.output.subarray(l,l+u),0),this.onData(c)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(s===Ru&&a===0)){if(s===Zg)return s=hs.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(t.avail_in===0)break}}return!0},Lu.prototype.onData=function(r){this.chunks.push(r)},Lu.prototype.onEnd=function(r){r===Ru&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=qd.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function Qg(r,e){let t=new Lu(e);if(t.push(r),t.err)throw t.msg||ko[t.err];return t.result}function Qz(r,e){return e=e||{},e.raw=!0,Qg(r,e)}var Jz=Lu,eY=Qg,tY=Qz,rY=Qg,nY=Uo,iY={Inflate:Jz,inflate:eY,inflateRaw:tY,ungzip:rY,constants:nY},{Deflate:sY,deflate:oY,deflateRaw:aY,gzip:lY}=hz,{Inflate:uY,inflate:cY,inflateRaw:hY,ungzip:dY}=iY,PE=sY,SE=oY,IE=aY,BE=lY,AE=uY,TE=cY,CE=hY,ME=dY,NE=Uo,Jg={Deflate:PE,deflate:SE,deflateRaw:IE,gzip:BE,Inflate:AE,inflate:TE,inflateRaw:CE,ungzip:ME,constants:NE};var ds=3e4,e0=Gn(),Ou=Ua(()=>{if(e0["META-engine-env"])return e0["META-engine-env"];if(e0.document){let r=document.querySelector('meta[name="engine-env"]');return r&&r.content||""}else return""});function t0(){switch(Ou()){case"editor":case"editor-pro":case"global-editor":case"global-editor-pro":return"";case"3rd-dev":return"https://dev.lceda.cn";case"3rd-pro-dev":return"https://devpro.lceda.cn";case"3rd-global":return"https://easyeda.com";case"3rd-china":return"https://lceda.cn";case"3rd-pro-china":return"https://pro.lceda.cn";default:return"http://localhost"}}function RE(){switch(Ou()){case"global-editor":case"global-editor-pro":case"3rd-global":return"https://modules.easyeda.com";case"private-editor-pro":return"/storage";default:return"https://modules.lceda.cn"}}function LE(r){let e=new URLSearchParams;return Ou()==="3rd-global"?(e.append("numbers",JSON.stringify(r)),ci(`${t0()}/api/components/searchByNumbers`,{method:"POST",body:e},ds)):(e.append("codes",r.join(",")),ci(`${t0()}/api/products/getPackageUuidByCodes?${e.toString()}`,{method:"GET"},ds))}function OE(r){let e=new URLSearchParams;return e.append("uuids",JSON.stringify(r)),ci(`${t0()}/api/components/searchByUuids`,{method:"POST",body:e},ds)}function kE(r){return ci(`${RE()}/3dmodel/${r}`,{method:"GET"},ds)}function UE(r){return ci(`${RE()}/qAxj6KHrDKw4blvCG8QJPs7Y/${r}`,{method:"GET"},ds)}function r0(r){let e=/^(.+)\|(.+)$/.exec(r);if(e){let t=new URLSearchParams;return t.append("fileName",e[1]),t.append("filePath",e[2]),ci(`/api/client/stepFileInfo?${t}`,{method:"GET"},ds)}else throw new Error(`invalid client module identity ${JSON.stringify(r)}`)}function DE(r){return ci(`${location.origin}/api/client/model/${r}/get`,{method:"GET"},ds)}async function GE(r,e){return ci(`${location.origin}/api/client/model/${r}/upload`,{method:"POST",body:e},ds)}var fY=(s=>(s.STEP2OBJ="/occapi/api/convert/step2obj",s.PCB2STEP="/occapi/api/convert/pcb2step",s.TCL2STEP="/occapi/api/convert/tcl2step",s.TCL2STL="/occapi/api/convert/tcl2stl",s.TCL2OBJ="/occapi/api/convert/tcl2obj",s))(fY||{});function U3e(r,e){let t=Jg.gzip(e);return ci(r,{method:"POST",cache:"no-cache",credentials:"same-origin",body:t},300*1e3)}function D3e(r){return ci(`/occapi/api/downloadTemp/${r}`,{method:"GET"},ds)}var Yo=Yi(gu()),jd=class{constructor(){this.uuid=kh();this.broadcastBus=Ua(()=>new Yo.BroadcastChannelMessageBus(this.uuid));this.messageBus=new Yo.MessageBus;if(typeof window<"u"){let e=window._MSG_BUS_=window._MSG_BUS_||new Yo.MessageBus;typeof BroadcastChannel<"u"&&(this.broadcastBus().subscribe("/worker/pcb2step/progress",t=>{e.publish("/worker/pcb2step/progress",t)}),this.broadcastBus().subscribe("/debug/draw",t=>{e.publish("/debug/draw",t)}))}}};function n0(r,e){/^https?:/.test(r)||(r=location.origin+r);let t=`
		self['META-engine-env'] = ${JSON.stringify(Ou())};
		self['BROAD_CAST_BUS_UUID'] = ${JSON.stringify(e)};
		console.log(${JSON.stringify(r)});
		try{
			importScripts(${JSON.stringify(r)});
		}catch(e){
			console.error(e);
		}
	
	`;return URL.createObjectURL(new Blob([t]))}var FE=class extends jd{constructor(t,n,i=1e4){super();this.tasks=new As((t,n)=>t.lastUpdate-n.lastUpdate);this.sem=new Bo(t),this.url=n;let s=()=>{let o=performance.now();for(;;){let a=this.tasks.poll();if(a)if(o-a.lastUpdate>i)a.bridge.discard();else{this.tasks.add(a);break}else break}setTimeout(s,1e3)};s()}async rpcCall(t,n,i=1e4){await this.sem.acquireSync();let s=this.next();try{return i>0?await s.bridge.rpcCall(t,n,i):await s.bridge.rpcCall(t,n)}finally{this.sem.release(),s.lastUpdate=performance.now(),this.tasks.add(s)}}async runOnce(t){await this.sem.acquireSync();let n=this.next();try{return await t(async(i,s)=>await n.bridge.rpcCall(i,s))}finally{this.sem.release(),n.bridge.discard()}}next(){return this.tasks.poll()||{bridge:new Yo.WorkerMessageBridge(this.messageBus,new Worker(n0(this.url,this.uuid))),lastUpdate:0}}},Li=class extends jd{constructor(){super(),Hd(this.messageBus,this.uuid)}rpcCall(e,t){return this.messageBus.rpcCall(e,t)}async runOnce(e){return await e(this.messageBus.rpcCall.bind(this.messageBus))}};var xr=class{};xr.LayerVisible=!1,xr.LayerCreate=!1,xr.UpdateLayerPhysics=!1,xr.LayerSetPos=!1,xr.LayerSetThickness=!1,xr.LayerInterfaceThickness=!1,xr.MarkDrawn=!1,xr.LoadModelType=!1,xr.DrawDebug=!0,xr.LayerSubstrate=!0;async function qE(r,e,t,n,i=1e4,s=!1){let o=!0;for(let a of r)if(a.items.length!==0){o=!1;break}if(o){for(let a of e)if(a.items.length!==0){o=!1;break}}if(o)return lt.buildBBox(t);if(s){let a=[li.UNION];r.forEach(u=>a.push(u));let l=[li.UNION];return e.forEach(u=>l.push(u)),await Zd([li.DIFF,a,l],n,i)}else{let a=[li.DIFF,lt.buildBBox(t.extendOfSize(100))];r.forEach(h=>a.push(h)),e.forEach(h=>a.push(h));let l=await Zd(a,n,i);if(l.items.length<=1)return console.warn(`outline not closed ${l.items.length}`),l;let u=Number.NEGATIVE_INFINITY,c;for(let h of l.items)h.bbox().area()>u&&(u=h.bbox().area(),c=h);return new lt(l.items.filter(h=>h!==c))}}async function aIe(r,e,t,n=1e4){if(!r||r.length===0)return[];let i=[],s=r.map(async o=>{let a=[li.DIFF,lt.buildBBox(e.extendOfSize(100))];o.forEach(d=>a.push(d));let l=await Zd(a,t,n);if(l.items.length<=1)return;let u=Number.NEGATIVE_INFINITY,c,h=Number.NEGATIVE_INFINITY,f;for(let d of l.items){let m=d.bbox().area();m>u?(h=u,f=c,u=m,c=d):m>h&&(h=m,f=d)}i.push(f)});return await Promise.all(s),i}function lIe(r,e,t,n=1e4){if(!e||e.length===0)return r;let i=[li.DIFF,r];return e.forEach(s=>i.push(s)),Zd(i,t,n)}async function Zd(r,e,t=1e4){xr.LayerSubstrate&&console.warn("/worker/runBoolean",t),console.log("pool",e instanceof Li,navigator.hardwareConcurrency);let n=(await e.rpcCall("/worker/runBoolean",Th([r]),300*1e3)).message;xr.LayerSubstrate&&console.warn("/worker/runBoolean",n.byteLength);let i=Io(n);return xr.LayerSubstrate&&console.warn("/worker/runBoolean decode",i),i.results[0].group}async function uIe(r,e,t){return Io(ou([So(Io(Th([r])).rulesArr[0])])).results[0].group}var i0=(oe=>(oe.ANALYSIS_OUT_LINE="ANALYSIS_OUT_LINE",oe.ANALYSIS_IN_LINE="ANALYSIS_IN_LINE",oe.ANALYSIS_HOLE_NPTH="ANALYSIS_HOLE_NPTH",oe.ANALYSIS_HOLE_PTH="ANALYSIS_HOLE_PTH",oe.ANALYSIS_TOP_PAD="ANALYSIS_TOP_PAD",oe.ANALYSIS_BOTTOM_PAD="ANALYSIS_BOTTOM_PAD",oe.ANALYSIS_PTH_FILL="ANALYSIS_PTH_FILL",oe.ANALYSIS_PTH_FILL_VIA="ANALYSIS_PTH_FILL_VIA",oe.ANALYSIS_PTH_NO_VIA="ANALYSIS_PTH_NO_VIA",oe.DETECT_OUTLINE="DETECT_OUTLINE",oe.OUTLINE="OUTLINE",oe.MULTI="MULTI",oe.TOP_ASSEMBLY="TOP_ASSEMBLY",oe.TOP_PASTE_MASK="TOP_PASTE_MASK",oe.TOP_SILK="TOP_SILK",oe.TOP_SPRAY="TOP_SPRAY",oe.TOP_SOLDER_MASK="TOP_SOLDER_MASK",oe.TOP="TOP",oe.SIGNAL="SIGNAL",oe.BOTTOM="BOTTOM",oe.BOT_SOLDER_MASK="BOT_SOLDER_MASK",oe.BOT_SPRAY="BOT_SPRAY",oe.BOT_SILK="BOT_SILK",oe.BOT_PASTE_MASK="BOT_PASTE_MASK",oe.BOT_ASSEMBLY="BOT_ASSEMBLY",oe.MECHANICAL="MECHANICAL",oe.DOCUMENT="DOCUMENT",oe.HOLE="HOLE",oe.SUBSTRATE="SUBSTRATE",oe.TOP_STIFFENER="TOP_STIFFENER",oe.BOTTOM_STIFFENER="BOTTOM_STIFFENER",oe.PRINT_LAYER="PRINT_LAYER",oe.WHITE_COVER_LAYER="WHITE_COVER_LAYER",oe.BLACK_COVER_LAYER="BLACK_COVER_LAYER",oe.BOARD_LAYER="BOARD_LAYER",oe.GLUE_LAYER="GLUE_LAYER",oe.LIGHT_LAYER="LIGHT_LAYER",oe.BUN_LAYER="BUN_LAYER",oe.TOP_QRCODE="TOP_QRCODE",oe.BOT_QRCODE="BOT_QRCODE",oe))(i0||{}),Kd=class{constructor(){this.typeConfigIndex={};this.multiOrderIndex={};this.typeOrder=0;this.buildOrder=0;this.electricalLayerIds=[];this.pushedBot=!1;this.groupIndex={};this.groupIndex["TOP_SILK"]=1,this.groupIndex["TOP_SPRAY"]=1,this.groupIndex["ANALYSIS_PTH_FILL_VIA"]=1,this.groupIndex["TOP_SOLDER_MASK"]=1,this.groupIndex["TOP"]=1,this.groupIndex["BOTTOM"]=2,this.groupIndex["BOT_SOLDER_MASK"]=2,this.groupIndex["BOT_SPRAY"]=2,this.groupIndex["BOT_SILK"]=2,this.initTypes()}setGroup(e){Object.assign(this.groupIndex,e);for(let t of Object.entries(this.groupIndex))t[1]===0&&delete this.groupIndex[t[0]];this.clear()}clear(){Object.keys(this.typeConfigIndex).forEach(e=>delete this.typeConfigIndex[e]),Object.keys(this.multiOrderIndex).forEach(e=>delete this.multiOrderIndex[e]),this.typeOrder=0,this.buildOrder=0,this.electricalLayerIds.length=0,this.pushedBot=!1,this.initTypes()}registType(e,t,n){this.typeConfigIndex[e]={type:e,group:t,material:n,typeOrder:this.typeOrder++}}buildLayerConfig(e,t,n,i){return t==="TOP"?this.electricalLayerIds.unshift(e):t==="SIGNAL"?this.pushedBot?this.electricalLayerIds.splice(this.electricalLayerIds.length-1,0,e):this.electricalLayerIds.push(e):t==="BOTTOM"&&(this.electricalLayerIds.push(e),this.pushedBot=!0),t in this.typeConfigIndex||this.registType(t,0,null),this.buildOrder++,{id:e,name:n,color:i,material:this.typeConfigIndex[t].material,buildOrder:this.buildOrder,thickness:0,typeConfig:this.typeConfigIndex[t]}}adjustMultiOrder(){let e=[],t=0;for(let i of Object.values(this.typeConfigIndex)){let s=i.type;s==="OUTLINE"?t++:s==="MULTI"?(t++,this.multiOrderIndex[s]=i.typeOrder):s.startsWith("MULTI-")&&e.push(i)}e.sort((i,s)=>i.typeOrder-s.typeOrder);for(let i of Object.values(this.typeConfigIndex)){let s=i.type;if(!(s==="MULTI"||s.startsWith("MULTI-")||s==="OUTLINE"))for(let o of e)o.typeOrder>i.typeOrder&&i.typeOrder++}let n=[];for(let i of e){let[s,o,a]=i.type.split("-"),l=Math.min(this.electricalLayerIds.indexOf(Number(o)),this.electricalLayerIds.indexOf(Number(a))),u=n[l];u||(u=[],n[l]=u),u.push(i)}for(let i of n)if(!!i)for(let s of i)s.typeOrder=t,this.multiOrderIndex[s.type]=t++}setMultiLoc(e){if(e)for(let t of Object.entries(this.multiOrderIndex))this.typeConfigIndex[t[0]].typeOrder=t[1];else{let t=this.typeOrder;for(let n of Object.entries(this.multiOrderIndex).sort((i,s)=>s[1]-i[1]).map(i=>i[0]))this.typeConfigIndex[n].typeOrder=t++}}initTypes(){this.registType("OUTLINE",this.groupIndex["OUTLINE"]||0,null),this.registType("MULTI",this.groupIndex["MULTI"]||0,null),this.registType("TOP_ASSEMBLY",this.groupIndex["TOP_ASSEMBLY"]||0,null),this.registType("TOP_PASTE_MASK",this.groupIndex["TOP_PASTE_MASK"]||0,"silver"),this.registType("TOP_QRCODE",this.groupIndex["TOP_QRCODE"]||0,"silk_white"),this.registType("TOP_SILK",this.groupIndex["TOP_SILK"]||0,"silk_white"),this.registType("TOP_SPRAY",this.groupIndex["TOP_SPRAY"]||0,"silver"),this.registType("ANALYSIS_PTH_FILL_VIA",this.groupIndex["ANALYSIS_PTH_FILL_VIA"]||0,"solder_mask_green_without_copper"),this.registType("TOP_STIFFENER",this.groupIndex["TOP_STIFFENER"]||0,null),this.registType("TOP_SOLDER_MASK",this.groupIndex["TOP_SOLDER_MASK"]||0,"solder_mask_green"),this.registType("TOP",this.groupIndex["TOP"]||0,"brass"),this.registType("SIGNAL",this.groupIndex["SIGNAL"]||0,"brass"),this.registType("BOTTOM",this.groupIndex["BOTTOM"]||0,"brass"),this.registType("BOT_SOLDER_MASK",this.groupIndex["BOT_SOLDER_MASK"]||0,"solder_mask_green"),this.registType("BOTTOM_STIFFENER",this.groupIndex["BOTTOM_STIFFENER"]||0,null),this.registType("BOT_SPRAY",this.groupIndex["BOT_SPRAY"]||0,"silver"),this.registType("BOT_SILK",this.groupIndex["BOT_SILK"]||0,"silk_white"),this.registType("BOT_QRCODE",this.groupIndex["BOT_QRCODE"]||0,"silk_white"),this.registType("BOT_PASTE_MASK",this.groupIndex["BOT_PASTE_MASK"]||0,"silver"),this.registType("BOT_ASSEMBLY",this.groupIndex["BOT_ASSEMBLY"]||0,null),this.registType("MECHANICAL",this.groupIndex["MECHANICAL"]||0,null),this.registType("DOCUMENT",this.groupIndex["DOCUMENT"]||0,null),this.registType("HOLE",this.groupIndex["HOLE"]||0,null),this.registType("SUBSTRATE",this.groupIndex["SUBSTRATE"]||0,"substrate_yellow"),this.registType("BUN_LAYER",this.groupIndex["BUN_LAYER"]||0,"silk_white"),this.registType("PRINT_LAYER",this.groupIndex["PRINT_LAYER"]||0,"silk_white"),this.registType("WHITE_COVER_LAYER",this.groupIndex["WHITE_COVER_LAYER"]||0,"silk_white"),this.registType("BLACK_COVER_LAYER",this.groupIndex["BLACK_COVER_LAYER"]||0,"silk_white"),this.registType("BOARD_LAYER",this.groupIndex["BOARD_LAYER"]||0,"substrate_yellow"),this.registType("GLUE_LAYER",this.groupIndex["GLUE_LAYER"]||0,"silk_white"),this.registType("LIGHT_LAYER",this.groupIndex["LIGHT_LAYER"]||0,"silk_white")}setPrintMethod(e){let t=this.typeConfigIndex["PRINT_LAYER"],n=this.typeConfigIndex["BOARD_LAYER"];if(e&&t.typeOrder<n.typeOrder||!e&&t.typeOrder>n.typeOrder)return;let i=this.typeConfigIndex["WHITE_COVER_LAYER"],s=this.typeConfigIndex["BLACK_COVER_LAYER"],o=this.typeConfigIndex["BUN_LAYER"],a=t.typeOrder,l=n.typeOrder,u=i.typeOrder,c=s.typeOrder,h=o.typeOrder;e?(o.typeOrder=l,t.typeOrder=h,i.typeOrder=a,s.typeOrder=u,n.typeOrder=c):(n.typeOrder=h,o.typeOrder=a,t.typeOrder=u,i.typeOrder=c,s.typeOrder=l)}};var zE=`v 0.5 0 0.5
v -0.5 0 0.5
v 0 0.5 0.5
v 0 -0.5 0.5
v 0 0 1
v 0 0 0

v 0.5 0.5 1
v 0.5 0 1
v 0.5 -0.5 1
v 0 -0.5 1
v -0.5 -0.5 1
v -0.5 0 1
v -0.5 0.5 1
v 0 0.5 1

v 0.5 0.5 0.5
v 0.5 -0.5 0.5
v -0.5 -0.5 0.5
v -0.5 0.5 0.5

v 0.5 0.5 0
v 0.5 0 0
v 0.5 -0.5 0
v 0 -0.5 0
v -0.5 -0.5 0
v -0.5 0 0
v -0.5 0.5 0
v 0 0.5 0

newmtl white
Ka 1 1 1
Kd 1 1 1
Ks 0 0 0
d 0.0
endmtl

usemtl white

f 1// 7// 8//
f 1// 15// 7//
f 1// 16// 21//
f 1// 21// 20//
f 2// 11// 12//
f 2// 17// 11//
f 2// 18// 25//
f 2// 25// 24//
f 3// 14// 7//
f 3// 7// 15//
f 3// 25// 18//
f 3// 26// 25//
f 4// 10// 11//
f 4// 11// 17//
f 4// 21// 16//
f 4// 22// 21//
f 5// 13// 12//
f 5// 14// 13//
f 5// 9// 8//
f 5// 10// 9//
f 6// 19// 20//
f 6// 26// 19//
f 6// 22// 23//
f 6// 23// 24//

newmtl black
Ka 0 0 0
Kd 0 0 0
Ks 0 0 0
d 0.0
endmtl

usemtl black

f 1// 8// 9//
f 1// 9// 16//
f 1// 19// 15//
f 1// 20// 19//
f 2// 12// 13//
f 2// 13// 18//
f 2// 23// 17//
f 2// 24// 23//
f 3// 13// 14//
f 3// 18// 13//
f 3// 15// 19//
f 3// 19// 26//
f 4// 9// 10//
f 4// 16// 9//
f 4// 17// 23//
f 4// 23// 22//
f 5// 8// 7//
f 5// 7// 14//
f 5// 11// 10//
f 5// 12// 11//
f 6// 20// 21//
f 6// 21// 22//
f 6// 24// 25//
f 6// 25// 26//`;var YE=`v 0.5 0.5 1
v -0.5 -0.5 1
v -0.5 0.5 1
v 0.5 0.5 0
v 0.5 -0.5 1
v 0.5 -0.5 0
v -0.5 -0.5 0
v -0.5 0.5 0

newmtl gray
Ka 0.4 0.4 0.4
Kd 0.4 0.4 0.4
Ks 0 0 0
d 0.0
endmtl

usemtl gray

f 1// 5// 6//
f 1// 6// 4//
f 2// 3// 8//
f 2// 8// 7//
f 1// 8// 3//
f 1// 4// 8//
f 2// 6// 5//
f 2// 7// 6//
f 3// 5// 1//
f 3// 2// 5//
f 4// 6// 7//
f 4// 7// 8//
`;var fs=class{constructor(e,t){this.cacheIndex=new Map;this.pending=new Array;this.ticket=0;this.loader=t,this.name=e+performance.now()}addCache(e,t){let n=null,i=new Promise(s=>{n=s,s(t)});this.cacheIndex.set(e,{promise:i,resolve:n})}keys(){return this.cacheIndex.keys()}fetch(e){var n;let t=(n=this.cacheIndex.get(e))==null?void 0:n.promise;if(!t){let i=null;t=new Promise(s=>{i=s}),this.cacheIndex.set(e,{promise:t,resolve:i}),this.addPending(e)}return t}clear(){this.cacheIndex.clear()}addPending(e){this.pending.push(e),this.ticket===0&&(this.ticket=1,Promise.resolve().then(()=>{this.ticket=0;let t=this.pending.slice();this.pending.length=0,this.loader(t,(n,i)=>{var s;(s=this.cacheIndex.get(n))==null||s.resolve(i)})}))}};var s0=Fe.YELLOW,Qd=new Fe(1,0,1),XE=1,ku=new ze,Zs=[new me(-.5,-.5,0),new me(-.5,.5,0),new me(.5,.5,0),new me(.5,-.5,0)],VE=[];for(let r=0;r<4;r++)VE.push(Zs[r],Zs[(r+1)%4]);ku.add(new vt(new Ha(VE,null),s0,null,"sub1")),ku.add(new vt(new gr([Zs[0],Zs[1],Zs[2],Zs[2],Zs[3],Zs[0]]),Fe.ZERO));var gY=new ze(void 0,!0);gY.add(ku);var di=class{constructor(e=0,t=0,n=0,i=0,s=0,o=0,a=""){this.componentShape=[];this.componentGroup=new ze(0);this.componentWireframeGroup=new ze(0);this.pinShape=[];this.pinGroup=new ze(0);this.pinWireframeGroup=new ze(0);this.polarityShape=[];this.polarityGroup=new ze(0);this.polarityWireframeGroup=new ze(0);this.padShape={};this.pad1Group=new ze(0);this.pad1WireframeGroup=new ze(0);this.holeShape=[];this.frameGroup=new ze(0);this.modelGroup=new ze;this.group=new ze;this.x=e,this.y=t,this.z=n,this.rx=i,this.ry=s,this.rz=o,this.uuid=a,this.group.add(this.modelGroup),this.group.add(this.componentGroup),this.group.add(this.componentWireframeGroup),this.group.add(this.pinGroup),this.group.add(this.pinWireframeGroup),this.group.add(this.polarityGroup),this.group.add(this.polarityWireframeGroup),this.group.add(this.pad1Group),this.group.add(this.pad1WireframeGroup),this.group.add(this.frameGroup),this.componentGroup.setVisible(!1),this.componentWireframeGroup.setVisible(!1),this.pinGroup.setVisible(!1),this.pinWireframeGroup.setVisible(!1),this.polarityGroup.setVisible(!1),this.polarityWireframeGroup.setVisible(!1),this.pad1Group.setVisible(!1),this.pad1WireframeGroup.setVisible(!1),this.frameGroup.setVisible(!1)}beAdd(e){e.add(this.group)}setModel(e){this.modelGroup.clear(),this.modelGroup.add(e)}getBBox(){return this.group.getBBox()}setVisible(e){this.group.setVisible(e)}gnrTriangles(e,t){let n=[];return t+=this.modelGroup.getBBox().maxZ,e.forEach(i=>i.triangles(XE,s=>n.push(new me(s.x,s.y,t)))),new gr(n)}gnrLines(e,t){let n=[];return t+=this.modelGroup.getBBox().maxZ,e.forEach(i=>i.lines(XE,s=>n.push(new me(s.x,s.y,t)))),new Ha(n)}gnrAll(){if(this.componentShape.length!==0&&(this.componentGroup.add(new vt(this.gnrTriangles(this.componentShape,di.componentZ),Fe.YELLOW)),this.componentWireframeGroup.add(new vt(this.gnrLines(this.componentShape,di.componentZ),Fe.YELLOW))),this.pinShape.length!==0&&(this.pinGroup.add(new vt(this.gnrTriangles(this.pinShape,di.pinZ),s0,null,"sub1")),this.pinWireframeGroup.add(new vt(this.gnrLines(this.pinShape,di.pinZ),s0,null,"sub1"))),this.polarityShape.length!==0&&(this.polarityGroup.add(new vt(this.gnrTriangles(this.polarityShape,di.polarityZ),Qd,null,"sub2")),this.polarityWireframeGroup.add(new vt(this.gnrLines(this.polarityShape,di.polarityZ),Qd,null,"sub2"))),this.padShape[1]&&this.padShape[1].length!==0&&(this.pad1Group.add(new vt(this.gnrTriangles(this.padShape[1],di.pad1Z),Qd,null,"sub2")),this.pad1WireframeGroup.add(new vt(this.gnrLines(this.padShape[1],di.pad1Z),Qd,null,"sub2"))),this.pinShape.length!==0||this.componentShape.length!==0){let e=this.getFrameBBox();this.frameGroup.add(ku);let t=e.center();this.frameGroup.setPosition(new me(t.x,t.y,this.modelGroup.getBBox().maxZ+di.frameZ)),this.frameGroup.setScale(new me(e.width(),e.height(),1))}}getFrameBBox(){let e=new Oe;for(let t of this.pinShape.concat(this.componentShape))e.ext1(t.bbox());try{return e.build()}catch{return}}getComponentBBox(){try{let e=new Oe;for(let t of this.componentShape)e.ext1(t.bbox());return e.build()}catch{return}}setFrameVisible(e){this.frameGroup.setVisible(e)}static setFrameColor(e){for(let t of ku.getContents())t.elements instanceof Ha&&t.setColor(e)}setModelVisible(e){this.modelGroup.setVisible(e)}setComponentVisible(e){this.componentGroup.setVisible(e)}setComponentColor(e){for(let t of this.componentGroup.getContents())t.setColor(e)}setComponentWireframeVisible(e){this.componentWireframeGroup.setVisible(e)}setComponentWireframeColor(e){for(let t of this.componentWireframeGroup.getContents())t.setColor(e)}setPinVisible(e){this.pinGroup.setVisible(e)}setPinColor(e){for(let t of this.pinGroup.getContents())t.setColor(e)}setPinWireframeVisible(e){this.pinWireframeGroup.setVisible(e)}setPinWireframeColor(e){for(let t of this.pinWireframeGroup.getContents())t.setColor(e)}setPolarityVisible(e){this.polarityGroup.setVisible(e)}setPolarityColor(e){for(let t of this.polarityGroup.getContents())t.setColor(e)}setPolarityWireframeVisible(e){this.polarityWireframeGroup.setVisible(e)}setPolarityWireframeColor(e){for(let t of this.polarityWireframeGroup.getContents())t.setColor(e)}setPad1Visible(e){this.pad1Group.setVisible(e)}setPad1Color(e){for(let t of this.pad1Group.getContents())t.setColor(e)}setPad1WireframeVisible(e){this.pad1WireframeGroup.setVisible(e)}setPad1WireframeColor(e){for(let t of this.pad1WireframeGroup.getContents())t.setColor(e)}},cn=di;cn.componentZ=4,cn.pinZ=4,cn.polarityZ=8,cn.pad1Z=12,cn.holeZ=0,cn.frameZ=4;var Jd=(o=>(o[o.TRACE=0]="TRACE",o[o.DEBUG=1]="DEBUG",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.DUMMY=5]="DUMMY",o))(Jd||{}),xY=(r,e)=>{switch(r){case 4:console.error(...e);break;case 3:console.warn(...e);break;case 2:console.info(...e);break;default:console.log(...e)}},bY=(r,e)=>e,In=class{constructor(e,t=xY,n=bY){this.level=e,this.writer=t,this.formatter=n}wrap(...e){return new In(this.level,this.writer,(t,n)=>{n=this.formatter(t,n);for(let i=e.length-1;i>=0;i--)n=e[i](t,n);return n})}shadow(...e){return new In(this.level,(t,n)=>{this.writer(t,n);for(let i of e)i(t,n)},this.formatter)}mix(...e){return new In(0,(t,n)=>{this.process(t,n);for(let i of e)i.process(t,n)},(t,n)=>n)}process(e,t){this.level<=e&&this.writer(e,this.formatter(e,t))}process1(e,t,n){this.level<=e&&this.writer(e,this.formatter(e,[_n.format(t,...n)]))}trace(...e){this.process(0,e)}trace1(e,...t){this.process1(0,e,t)}debug(...e){this.process(1,e)}debug1(e,...t){this.process1(1,e,t)}info(...e){this.process(2,e)}info1(e,...t){this.process1(2,e,t)}warn(...e){this.process(3,e)}warn1(e,...t){this.process1(3,e,t)}error(...e){this.process(4,e)}error1(e,...t){this.process1(4,e,t)}},jE=new In(5),yY=Date.now()-performance.now(),o0=new ArrayBuffer(10),vY=new Float64Array(o0,0,1),WE=new Uint8Array(o0),$E=-1,a0=0;function OIe(){let r=yY+performance.now();return vY[0]=r,r===$E?a0++:(a0=0,$E=r),WE[8]=Math.random()*1e3,WE[9]=a0,`X-LC-ID-${Buffer.from(o0).toString("base64")}`}function l0(r,e=.05){if(r.length<3)return r.slice();let t=r[0],n=[t];for(let l=1;l<r.length;l++){let u=r[l];t.equals1(u)||n.push(u),t=u}if(t!==n[n.length-1]&&(n.length!==1&&n.pop(),n.push(t)),e<0)return n;let i=n[1],s=i.sub(n[0]).normalize(),o=0,a=[n[0]];for(let l=2;l<n.length;l++){let u=n[l],c=u.sub(i).normalize();o+=Math.acos(Math.min(1,Math.max(-1,s.dot(c)))),o>e&&(a.push(i),o=0),i=u,s=c}return a.push(i),a}function ef(r,e,t=.01){let n=[],i=[];for(let h of r)if(h instanceof Y)n.length===0&&n.push(h.start()),n.push(h.end());else{let f=l0(n,t);n.length=0;let d=f[0];for(let m=1;m<f.length;m++){let p=f[m];i.push(new Y(d,p)),d=p}i.push(h)}let s=l0(n,t),o=s[0];for(let h=1;h<s.length;h++){let f=s[h];i.push(new Y(o,f)),o=f}let a=[],l,u=[];for(let h of i){if(!(h instanceof Y)){c(),u.push(h);continue}if(a.length===0){a.push(h.start(),h.end());continue}if(!h.start().equals1(a[a.length-1])){c(),a.push(h.start(),h.end());continue}a.push(h.end());let f=a[a.length-3],d=a[a.length-2],m=a[a.length-1],p=f.distance2(d)/m.distance2(d);if(p>4||p<.25){c(),a.push(h.start(),h.end());continue}let g=f.sub(d).normalize(),b=m.sub(d).normalize(),v=g.dot(b);if(Te.eq(v,-1)||v>-.95){c(),a.push(h.start(),h.end());continue}let w=g.cross(b);if(l&&l.sweepAngle*w>0){c(),a.push(h.start(),h.end());continue}let P=a[0];if(P.equals1(m)){l?(l=re.build3(l.center,0,-360,l.rx,l.rx),c()):(c(),a.push(h.start(),h.end()));continue}let _=P.add(m).scale(.5),B=P.sub(m),I=-B.y,C=B.x,N=0,A=0,M=0,S=0;for(let O of a)N+=O.x,A+=O.y,M+=O.x**2,S+=O.y**2;N/=a.length,A/=a.length,M/=a.length,S/=a.length;let $=P.x,H=P.y,K=2*I*(N-$)+2*C*(A-H);if(Te.eq(K,0)){c(),a.push(h.start(),h.end());continue}let F=(M-$**2-2*_.x*(N-$)+S-H**2-2*_.y*(A-H))/K,z=new q(_.x+F*I,_.y+F*C),L=P.distance1(z),k;for(let O of a){if(Math.abs(O.distance1(z)-L)>e||k&&Math.abs(O.add(k).scale(.5).distance1(z)-L)>e){c(),a.push(h.start(),h.end());break}k=O}a.length!==2&&(l=re.build2(z,P.angleD(z),a[a.length-1].angleD(z),L,L,w>0?yt.CW:yt.CCW))}return c(),u;function c(){l?(u.push(l),l=null,a.length=0):a.length!==0&&(u.push(new Y(a[0],a[1])),a.length=0)}}var wY=new In(4);async function tf(r,e,t,n=null,i){let s=new Yr(1,t).ratio,o=.5*s,a=1*s,l={},u=n?1/n.scale:1,c=qe.scale(u),h,f,d,m,p,g,b=new Set,v=[],w=B=>{switch(v[0]){case"POLY":{let I=v[2],C=v[4],N=v[5]*u,A=Xo(v[6]).map(M=>M.multiply3(c));if(A.length===0)break;if(b.has(C)){h&&_(),h=A,f=I,d=C,m=N,p=v[1],g=B,_();break}if(!h)h=A,f=I,d=C,m=N,p=v[1],g=B;else if(A[0].start().equals1(h[h.length-1].end())&&f===I&&d===C&&m===N)for(let M of A)h.push(M);else _(),h=A,f=I,d=C,m=N,p=v[1],g=B;break}case"POLYS":{let I=v[2],C=v[4],N=v[5]*u,A=v[6].map(M=>Ce.build2(Xo(M).map(S=>S.multiply3(c))));r.onPolys(C,v[1],A,N,I,B);break}case"FILL":{let I=v[2],C=v[4],N=v[7];HE(N,r,C,v[1],I,c,B);break}case"FPC_FILL":{let I=v[1],C=v[2],N=v[3],A=v[4],M=new Yr(39.37,1).ratio,S=v[5]*M,$=v[6];EY(r,I,{material:A,thickness:S}),HE($,r,N,I,C,c,B);break}}},P=B=>{if(B=B.trim(),!B)return;let I=JSON.parse(B);if(!Array.isArray(I))return;let C=I[0];if(v){let N;C==="PROP"&&I[1]===v[1]&&(N=I[2]?typeof I[3]=="number"?Fe.of5(I[2],I[3]):Fe.of3(I[2]):Fe.ZERO),w(N),v=null}if(C!=="PROP"){if(C==="POLY"||C==="POLYS"||C==="FILL"||C==="FPC_FILL"){v=I;return}switch(C){case"HEAD":{I[1].scale&&(n?(n.scale*=I[1].scale,n.scaleMatrix=qe.scale(n.scale)):(u*=I[1].scale,c=qe.scale(u))),r.onStart();break}case"LAYER":{let N=I[1],A=I[2],M=I[3],S=I[7]&&I[8]?Fe.of5(I[7],I[8]):Fe.ZERO;r.onLayerConfig(N,A,M,S),l[N]=A;break}case"LAYER_PHYS":{let N=I[1],A=I[2],M=I[3]*u;r.onLayerPhys(N,A,M);break}case"PANELIZE":{let N=I[1],A=Boolean(I[2]);r.onPanelize(new qe([N[0],N[3],0,N[1],N[4],0,N[2]*u,N[5]*u,1]),A);break}case"SILK_OPTS":{r.onSilkOpts(I[1],I[2]?Fe.of3(I[2]):Fe.ZERO,I[3]?Fe.of3(I[3]):Fe.ZERO),b.add(I[1]);break}case"PRINT_METHOD":{r.onPrintMethod(I[1]===1);break}case"TEXTURE":{let N=I[2],A=I[4],M=I[5].map(H=>H*u),S=I[7],$=I[8];r.onTexture(A,I[1],I[3],new q(M[0],M[1]),new q(M[2],M[3]),new q(M[4],M[5]),new q(M[6],M[7]),S&&_Y(S,c),typeof $=="number"?$:1,N);break}case"ITEM_ORDER":{r.onItemOrder(I[1]);break}case"COMPONENT":{let N=l[I[3]]==="TOP_ASSEMBLY",A=I[7],M=I[4]*u,S=I[5]*u,$=ut.toRadians(I[6]),H=new ze;H.setPosition(new me(M,S,0)),H.setRotation(new me(0,N?0:Math.PI,$)),A.x&&(A.x*=u),A.y&&(A.y*=u),A.z&&(A.z*=u),A.dx&&(A.dx*=u),A.dy&&(A.dy*=u),A.dz&&(A.dz*=u),A.outline&&(A.outline=A.outline.map(K=>K.map(F=>Ce.build2(Xo(F)).multiply3(c)))),r.onModel(I[1],N,H,A);break}case"SHELL":{let[N,A,M,S,$,H,K,F,z]=I;z.BottomHeight&&(z.BottomHeight*=u),z.TopInnerHeight&&(z.TopInnerHeight*=u),z.BottomInnerHeight&&(z.BottomInnerHeight*=u),r.onShellOutline(A,M,S,$*u,H*u,K*u,F.map(L=>Ce.build2(Xo(L)).multiply3(c)),z);break}case"CREASE":{let[N,A,M,S,$,H,K,F,z]=I;r.onCrease(A,new q($,H).multiply3(c),new q(K,F).multiply3(c),z,M);break}case"BOSS":{let[N,A,M,S,$,H,K,F,z,L,k]=I;r.onBoss(A,l[S]==="3D_SHELL_TOP",new q($,H).multiply3(c),K*u,F*u,z*u,L?L.map(O=>O*u):null,k?k.map(O=>O*u):null,M);break}case"SHELL_ENTITY":{let[N,A,M,S,$,H,K,F,z]=I,L=0,k=[];for(let O of z){let ie=Xo(O).map(Q=>Q.multiply3(c)),W=Ce.build2(ie);k.push(W),L+=W.area(.1)}r.onShellEntity(A,l[S]==="3D_SHELL_TOP",$,H,K*u,L<0?k:k.map(O=>O.reverse()),M);break}case"CONNECT":{r.onConnect(I[1],I[2]);break}default:wY.debug("ignore",I)}}};if(typeof e=="string")await ka(e,P,i);else for(let B of e)ka(await B(),P);v&&w(null),h&&_(),await r.onEnd();function _(){let B=l[d]==="OUTLINE"?a:o;ef(h,B).forEach(I=>r.onPrimitive(d,p,I,m,f,g)),h=null}}function HE(r,e,t,n,i,s,o){let a=0,l=new Array;for(let u of r){let c=Xo(u).map(h=>h.multiply3(s));if(c.length===1){let h=c[0];if(h instanceof re&&Math.abs(h.sweepAngle)>=360){e.onCircle(t,n,h.center,h.rx,i,o);continue}else if(h instanceof ui){e.onRect(t,n,h,i,o);continue}}if(c.length!==0){let h=Ce.build2(c);l.push(h),a+=h.area(.1)}}a<0?e.onPolygon(t,n,l,i,o):a>0&&e.onPolygon(t,n,l.map(u=>u.reverse()),i,o)}function EY(r,e,t){r.onPolygonCfg(e,t)}function Uu(r,e,t,n=!1){let i=new ze;i.add(r);let s=Qe.ORIGIN,o=r.getBBox();if(!o)return i;let a=e.dx||0,l=e.dy||0,u=e.dz||0,c=ut.toRadians(e.rx||0),h=ut.toRadians(e.ry||0),f=ut.toRadians(e.rz||0),d=e.x||0,m=e.y||0,p=e.z||0;if(n)if(Te.eq(c%Math.PI,0)&&Te.eq(h%Math.PI,0)){let g=a/(o.maxX-o.minX);isFinite(g)&&g>0&&(s=s.scale(g,1,1));let b=l/(o.maxY-o.minY);isFinite(b)&&b>0&&(s=s.scale(1,b,1)),s=s.rotateZ(f),s=s.translate1(d,m,0)}else{let g=new Oe,b=Qe.rotateZ(f).rotateX(c).rotateY(h).translate1(d,m,p);new wn(-a/2,-l/2,-u/2,a/2,l/2,u/2).getVertexes().forEach(w=>{w=w.multiply4(b),g.ext6(w.x,w.y)});let v=g.build();if(!Te.eq(v.area(),0)){s=s.scale(v.width()/(o.maxX-o.minX),v.height()/(o.maxY-o.minY),1);let w=v.center();s=s.translate1(w.x,w.y,0)}}else{let g=(o.maxX+o.minX)/2,b=(o.maxY+o.minY)/2,v=o.minZ;if(s=s.translate1(-g,-b,-v),t&&isFinite(e.scale)&&e.scale>0)s=s.scale(e.scale);else if(t){let w=new Array;w.push(a/(o.maxX-o.minX)),w.push(l/(o.maxY-o.minY)),w.push(u/(o.maxZ-o.minZ));let P=Math.min(...w.filter(_=>isFinite(_)&&_>0));isFinite(P)&&P>0&&(s=s.scale(P))}else{let w=a/(o.maxX-o.minX);isFinite(w)&&w>0&&(s=s.scale(w,1,1));let P=l/(o.maxY-o.minY);isFinite(P)&&P>0&&(s=s.scale(1,P,1));let _=u/(o.maxZ-o.minZ);isFinite(_)&&_>0&&(s=s.scale(1,1,_))}s=s.rotateZ(f).rotateX(c).rotateY(h),s=s.translate1(d,m,p)}return i.setAddiMatrix(s),i}function _Y(r,e){let t=0,n=new Array;for(let i of r){let s=Xo(i).map(o=>o.multiply3(e));if(s.length!==0){let o=Ce.build2(s);n.push(o),t+=o.area(.1)}}if(t<0)return n;if(t>0)return n.map(i=>i.reverse())}function Xo(r){let e=new Array,t=new Array,n=i;return r.forEach(h=>n(h)),e;function i(h){switch(h){case"CIRCLE":{if(t.length>0)throw new Error("CIRCLE should be standalone");n=a;break}case"R":{if(t.length>0)throw new Error("R should be standalone");n=l;break}case"L":{if(t.length!==2)throw new Error("L needs a pre x/y");n=u;break}case"ARC":{if(t.length!==2)throw new Error("ARC needs a pre x/y");n=c;break}case"Q":{if(t.length!==2)throw new Error("Q needs a pre x/y");n=s;break}case"C":{if(t.length!==2)throw new Error("C needs a pre x/y");n=o;break}default:if(typeof h=="number")t.push(h);else throw new Error(`unexpected ${h}`)}}function s(h){if(typeof h=="number"){if(t.push(h),t.length===6){let f=t.pop(),d=t.pop(),m=t.pop(),p=t.pop(),g=t.pop(),b=t.pop();e.push(new Ae([new q(b,g),new q(p,m),new q(d,f)])),t.push(d,f)}}else{if(t.length!==2)throw new Error("invalid Q");n=i,i(h)}}function o(h){if(typeof h=="number"){if(t.push(h),t.length===8){let f=t.pop(),d=t.pop(),m=t.pop(),p=t.pop(),g=t.pop(),b=t.pop(),v=t.pop(),w=t.pop();e.push(new Ae([new q(w,v),new q(b,g),new q(p,m),new q(d,f)])),t.push(d,f)}}else{if(t.length!==2)throw new Error("invalid C");n=i,i(h)}}function a(h){if(typeof h=="number"){if(t.push(h),t.length===3){let f=t[0],d=t[1],m=t[2];m>0&&e.push(re.build3(new q(f,d),0,-360,m,m)),t.length=0,n=i}}else throw new Error("invalid CIRCLE")}function l(h){if(typeof h=="number"){if(t.push(h),t.length===7){let f=t[0],d=t[1],m=t[2],p=t[3],g=t[4];e.push(new ui(new q(f,d),m,p,g,t[5],Math.min(m,p)/2*t[6])),t.length=0,n=i}}else throw new Error("invalid RECT")}function u(h){if(typeof h=="number"){if(t.push(h),t.length===4){let f=t.pop(),d=t.pop(),m=t.pop(),p=t.pop();e.push(new Y(new q(p,m),new q(d,f))),t.push(d,f)}}else{if(t.length!==2)throw new Error("invalid L");n=i,i(h)}}function c(h){if(typeof h=="number"){if(t.push(h),t.length===5){let f=t.pop(),d=t.pop(),m=t.pop(),p=t.pop(),g=t.pop();(g!==d||p!==f)&&m!==0&&e.push(re.build5(new q(g,p),new q(d,f),m)),t.push(d,f)}}else{if(t.length!==2)throw new Error("invalid Arc");n=i,i(h)}}}function Ks(r){let e=0;return r.primitives.reduce((t,n)=>(n instanceof Y?t.push(n):n instanceof re?Math.abs(n.sweepAngle)>=350?(t.push(re.build3(n.center,n.startAngle,n.sweepAngle/2,n.rx,n.ry)),t.push(re.build3(n.center,n.startAngle+n.sweepAngle/2,n.sweepAngle/2,n.rx,n.ry))):t.push(n):n.points(.1).reduce((i,s)=>(s.equals1(i)||t.push(new Y(i,s)),s)),t),[]).reduce((t,n)=>{if(n instanceof Y){switch(e){case 0:t.push(n.start().x,n.start().y,"L",n.end().x,n.end().y);break;case 1:t.push(n.end().x,n.end().y);break;default:t.push("L",n.end().x,n.end().y)}e=1}else if(n instanceof re){switch(e){case 0:t.push(n.start().x,n.start().y,"ARC",n.sweepAngle,n.end().x,n.end().y);break;case 2:t.push(n.sweepAngle,n.end().x,n.end().y);break;default:t.push("ARC",n.sweepAngle,n.end().x,n.end().y)}e=2}return t},[])}function ZE(r){return r===32||r===9||r===13||r===10}function _Be(r){return r===13||r===10}var rf=class{constructor(){this._line=1;this._col=0}line(){return this._line}col(){return this._col}_feed(e){return e===10?(this._col=0,this._line++):this._col++,this.feed(e)}parse(e){let t=e.length;for(let n=0;n<t;n++){let i=e.charCodeAt(n);if(!this._feed(i))return this}return this.finish(),this}};var u0=500,KE=String.fromCharCode,nf=class{constructor(){this.buffer=new Array}size(){return this.buffer.length}isEOF(){return!1}write(e){return this.buffer.push(e),1}writen1(e){return this.writen2(e,0,e.length)}writen2(e,t,n){let i=this.buffer;for(let s=0,o=t;s<n;s++,o++)i.push(e[o]);return n}writeAsync(e,t){t(this.write(e))}writenAsync1(e,t){t(this.writen1(e))}writenAsync2(e,t,n,i){i(this.writen2(e,t,n))}writeStr(e){let t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return this.writen1(n)}clear(){this.buffer.length=0}toString(){let e=this.buffer,t=e.length;if(t<=u0)return KE.apply(null,e);{let n=new Array;for(let i=0;i<e.length;i+=u0){let s=Math.min(t-i,u0),o=KE.apply(null,e.slice(i,i+s));n.push(o)}return n.join("")}}};var PY=(i=>(i[i.UNKNOW=0]="UNKNOW",i[i.IN_NUMBER=1]="IN_NUMBER",i[i.IN_NUMBER_E=2]="IN_NUMBER_E",i[i.IN_NUMBER_E_SIGNED=3]="IN_NUMBER_E_SIGNED",i))(PY||{}),SY=(C=>(C[C.UNKNOW=0]="UNKNOW",C[C.MOVE_X=1]="MOVE_X",C[C.MOVE_Y=2]="MOVE_Y",C[C.LINE_X=3]="LINE_X",C[C.LINE_Y=4]="LINE_Y",C[C.HORIZONTAL_X=5]="HORIZONTAL_X",C[C.VERTICAL_Y=6]="VERTICAL_Y",C[C.CUBIC_BEZIER_X1=7]="CUBIC_BEZIER_X1",C[C.CUBIC_BEZIER_Y1=8]="CUBIC_BEZIER_Y1",C[C.CUBIC_BEZIER_X2=9]="CUBIC_BEZIER_X2",C[C.CUBIC_BEZIER_Y2=10]="CUBIC_BEZIER_Y2",C[C.CUBIC_BEZIER_X=11]="CUBIC_BEZIER_X",C[C.CUBIC_BEZIER_Y=12]="CUBIC_BEZIER_Y",C[C.ARC_RX=13]="ARC_RX",C[C.ARC_RY=14]="ARC_RY",C[C.ARC_ROTATION=15]="ARC_ROTATION",C[C.ARC_LARGE=16]="ARC_LARGE",C[C.ARC_SWEEP=17]="ARC_SWEEP",C[C.ARC_X=18]="ARC_X",C[C.ARC_Y=19]="ARC_Y",C[C.QUADRATIC_BEZIER_X1=20]="QUADRATIC_BEZIER_X1",C[C.QUADRATIC_BEZIER_Y1=21]="QUADRATIC_BEZIER_Y1",C[C.QUADRATIC_BEZIER_X=22]="QUADRATIC_BEZIER_X",C[C.QUADRATIC_BEZIER_Y=23]="QUADRATIC_BEZIER_Y",C))(SY||{});function IY(r){return 97<=r&&r<=122||65<=r&&r<=90}function kr(r){let e=parseFloat(r);if(isFinite(e))return e;throw new Error("expect number")}var sf=class extends rf{constructor(t,n=!0,i=jE){super();this.buffer=new nf;this.group=new Array;this.subPartStart=q.ORIGIN;this.curPoint=q.ORIGIN;this.lexState=0;this.parseState=0;this.isAbsolute=!1;this.isLargeArc=!1;this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=Number.NaN;this.y=Number.NaN;this.rx=Number.NaN;this.ry=Number.NaN;this.rotation=Number.NaN;this.sweep=yt.CCW;this.logger=i,this.cb=t,this.yAxis=n?-1:1}on(t){return this.cb(t)}feed(t){switch(this.logger.debug1("%c|%s",t,this.lexState),this.lexState){case 0:return ZE(t)?!0:48<=t&&t<=57||t===45||t===46||t===43?(this.pushBuffer(t),this.lexState=1,!0):IY(t)?this.feedS(String.fromCharCode(t)):(this.logger.warn1("unknow letter %c",t),!0);case 1:return 48<=t&&t<=57||t===46?(this.pushBuffer(t),!0):t===101||t===69?(this.pushBuffer(t),this.lexState=2,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(t)):!1;case 2:return 48<=t&&t<=57?(this.pushBuffer(t),!0):t===45||t===43?(this.pushBuffer(t),this.lexState=3,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(t)):!1;case 3:return 48<=t&&t<=57?(this.pushBuffer(t),!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(t)):!1;default:return!0}}finish(){this.feed(32),this.tryNotify()}feedS(t){switch(this.logger.debug1("%s|%s|%s|%s",t,this.parseState,this.curPoint,this.subPartStart),this.parseState){case 0:switch(t){case"M":this.isAbsolute=!0,this.parseState=1;break;case"m":this.isAbsolute=!1,this.parseState=1;break;case"L":this.isAbsolute=!0,this.parseState=3;break;case"l":this.isAbsolute=!1,this.parseState=3;break;case"H":this.isAbsolute=!0,this.parseState=5;break;case"h":this.isAbsolute=!1,this.parseState=5;break;case"V":this.isAbsolute=!0,this.parseState=6;break;case"v":this.isAbsolute=!1,this.parseState=6;break;case"z":case"Z":{this.group.push(new Y(this.curPoint,this.subPartStart));let s=this.tryNotify();return this.curPoint=this.subPartStart,s}case"C":this.isAbsolute=!0,this.parseState=7;break;case"c":this.isAbsolute=!1,this.parseState=7;break;case"S":this.isAbsolute=!0,this.parseState=9;break;case"s":this.isAbsolute=!1,this.parseState=9;break;case"A":this.isAbsolute=!0,this.parseState=13;break;case"a":this.isAbsolute=!1,this.parseState=13;break;case"Q":this.isAbsolute=!0,this.parseState=20;break;case"q":this.isAbsolute=!1,this.parseState=20;break;default:this.logger.warn1("unknow",t)}return!0;case 1:let n=this.tryNotify();return this.x=kr(t),this.parseState=2,n;case 2:{this.y=this.yAxis*kr(t);let s;return this.isAbsolute?s=new q(this.x,this.y):s=this.curPoint.add1(this.x,this.y),this.curPoint=s,this.subPartStart=s,this.parseState=3,!0}case 3:return this.x=parseFloat(t),isFinite(this.x)?(this.parseState=4,!0):(this.parseState=0,this.feedS(t));case 4:{this.y=this.yAxis*kr(t);let s;return this.isAbsolute?s=new q(this.x,this.y):s=this.curPoint.add1(this.x,this.y),this.group.push(new Y(this.curPoint,s)),this.curPoint=s,this.parseState=3,!0}case 5:if(this.x=parseFloat(t),isFinite(this.x)){let s;return this.isAbsolute?s=new q(this.x,this.curPoint.y):s=this.curPoint.add1(this.x,0),this.group.push(new Y(this.curPoint,s)),this.curPoint=s,!0}else return this.parseState=0,this.feedS(t);case 6:if(this.y=parseFloat(t),isFinite(this.y)){this.y=this.yAxis*this.y;let s;return this.isAbsolute?s=new q(this.curPoint.x,this.y):s=this.curPoint.add1(0,this.y),this.group.push(new Y(this.curPoint,s)),this.curPoint=s,!0}else return this.parseState=0,this.feedS(t);case 7:let i=parseFloat(t);if(isFinite(i))return this.x1=i,this.parseState=8,!0;if(t=="S"){let s=this.curPoint.x-this.x2,o=this.curPoint.y-this.y2;return this.x1=this.x+s,this.y1=this.y+o,this.parseState=0,this.feedS(t)}else if(t=="s"){let s=this.x-this.x2,o=this.y-this.y2;return this.x1=s,this.y1=o,this.parseState=0,this.feedS(t)}else return this.x1=i,this.parseState=0,this.feedS(t);case 8:return this.y1=this.yAxis*kr(t),this.parseState=9,!0;case 9:return this.x2=kr(t),this.parseState=10,!0;case 10:return this.y2=this.yAxis*kr(t),this.parseState=11,!0;case 11:return this.x=kr(t),this.parseState=12,!0;case 12:{this.y=this.yAxis*kr(t);let s,o,a;return this.isAbsolute?(s=new q(this.x1,this.y1),o=new q(this.x2,this.y2),a=new q(this.x,this.y)):(s=this.curPoint.add1(this.x1,this.y1),o=this.curPoint.add1(this.x2,this.y2),a=this.curPoint.add1(this.x,this.y)),this.group.push(new Ae([this.curPoint,s,o,a])),this.curPoint=a,this.parseState=7,!0}case 13:return this.rx=parseFloat(t),isFinite(this.rx)?(this.parseState=14,!0):(this.parseState=0,this.feedS(t));case 14:return this.ry=kr(t),this.parseState=15,!0;case 15:return this.rotation=kr(t),this.parseState=16,!0;case 16:return this.isLargeArc=kr(t)===1,this.parseState=17,!0;case 17:return this.sweep=kr(t)===1?yt.CW:yt.CCW,this.parseState=18,!0;case 18:return this.x=kr(t),this.parseState=19,!0;case 19:{this.y=this.yAxis*kr(t);let s;return this.isAbsolute?s=new q(this.x,this.y):s=this.curPoint.add1(this.x,this.y),this.group.push(re.build1(this.curPoint,s,this.rx,this.ry,this.isLargeArc,this.sweep)),this.curPoint=s,this.parseState=13,!0}case 20:return this.x1=parseFloat(t),isFinite(this.x1)?(this.parseState=21,!0):(this.parseState=0,this.feedS(t));case 21:return this.y1=this.yAxis*kr(t),this.parseState=22,!0;case 22:return this.x=kr(t),this.parseState=23,!0;case 23:{this.y=this.yAxis*kr(t);let s,o;return this.isAbsolute?(s=new q(this.x1,this.y1),o=new q(this.x,this.y)):(s=this.curPoint.add1(this.x1,this.y1),o=this.curPoint.add1(this.x,this.y)),this.group.push(new Ae([this.curPoint,s,s,o])),this.curPoint=o,this.parseState=20,!0}default:return this.logger.warn1("unsupported parse state",this.parseState),!0}}pushBuffer(t){this.buffer.write(t)}getCleanBuffer(){let t=this.buffer.toString();return this.buffer.clear(),t}tryNotify(){if(this.group.length===0)return!0;{let t=Ce.build1(I2(this.group));return this.group.length=0,this.on(t)}}onException(t){throw t}};var BY=(o=>(o[o.TOP=1]="TOP",o[o.BOTTOM=2]="BOTTOM",o[o.DOCUMENT=12]="DOCUMENT",o[o.COMPONENT_SHAPE=99]="COMPONENT_SHAPE",o[o.PIN_SHAPE=100]="PIN_SHAPE",o[o.POLARITY_SHAPE=101]="POLARITY_SHAPE",o))(BY||{});function QE(r,e,t){var m,p;let n=new cn,i=0,s=0;n.dataStr=r;try{console.log(r),n.polarity=r.polarity==="1";let g=r.dataStr;n.tht=(p=(m=r.customData)==null?void 0:m.jlcPara)==null?void 0:p.assemblyProcess;{let b=g.canvas.split("~");i=parseFloat(b[16]||"0")*e,s=parseFloat(b[17]||"0")*e}for(let b of g.shape){let v=b.indexOf("~");if(v>=0)switch(b.substring(0,v)){case"SVGNODE":h(b);break;case"CIRCLE":c(b);break;case"SOLIDREGION":u(b);break;case"PAD":l(b);break;case"HOLE":o(b);break;case"TRACK":a(b);break}}}catch(g){console.error(g)}return n;function o(g){let b=g.split("~"),v=d(b[3]);n.holeShape.push(re.build3(new q(...f(b[1],b[2])),0,-360,v,v))}function a(g){let b=g.split("~"),v=parseInt(b[2]);if(v===99||v===100||v===12){let w=b[4].split(" "),P=d(b[1]),_=new q(...f(w[0],w[1]));for(let B=3;B<w.length;B+=2){let I=new q(...f(w[B-1],w[B])),C=new Y(_,I).stroke(P,ts.ROUND,yt.CCW);v===12?n.polarityShape.push(C):v===100?n.pinShape.push(C):v===99&&n.componentShape.push(C),_=I}}}function l(g){let b=g.split("~"),v=d(b[4]),w=d(b[5]),P=b[8],_=Math.max(Math.min(v,w)/2/3,1),B=re.build3(new q(...f(b[2],b[3])),0,-360,_,_);R2(n.padShape,P).push(Ce.build2([B]))}function u(g){let b=g.split("~"),v=parseInt(b[1]);if(v===99||v===100||v===12){let w=qe.scale(e).translate(-i,s);new sf(P=>{switch(P=P.multiply3(w),v){case 99:n.componentShape.push(P);break;case 100:n.pinShape.push(P);break;case 12:n.polarityShape.push(P);break}return!0}).parse(b[3])}}function c(g){let b=g.split("~"),v=d(b[3]),w=d(b[4]),P=v+w/2,_=re.build3(new q(...f(b[1],b[2])),0,-360,P,P),B=parseInt(b[5]);if(B===12)n.polarityShape.push(Ce.build2([_]));else if(B===100)n.pinShape.push(Ce.build2([_]));else if(B===101){let{x:I,y:C}=_.center,N;I>0&&C>=0?N=1:I<=0&&C>0?N=2:I<0&&C<=0?N=3:I>=0&&C<0?N=4:N=1,n.polarityMarkQuadrant=N,t&&n.group.setRotation(new me(0,0,ut.toRadians((t-N)*90)))}}function h(g){let b=JSON.parse(g.substring(8));console.log(b);let v=b.attrs;if(b.nodeType===1&&v.c_etype==="outline3D"){let w=v.c_origin.split(","),[P,_]=f(w[0],w[1]),B=d(v.z),I=new Oe;if(Cs(b.childNodes,(H,K)=>{let F=K.attrs.points.split(" ");for(let z=0;z<F.length;z+=2)I.ext6(...f(F[z],F[z+1]))}),I.valid()){let H=I.build().center();(Math.abs(H.x-P)>.1||Math.abs(H.y-_)>.1)&&(console.warn("fix 3d model x/y",v.uuid),P=H.x,_=H.y)}let C=v.c_rotation.split(",").map(H=>parseFloat(H)),N=C[0],A=C[1],M=C[2],S=d(v.c_width),$=d(v.c_height);Object.assign(n,{x:P,y:_,z:B,rx:N,ry:A,rz:M,dx:S,dy:$,uuid:v.uuid})}}function f(g,b){return[parseFloat(g)*e-i,-(parseFloat(b)*e-s)]}function d(g){return parseFloat(g)*e}}var c0=/^[^|]+\.ste?p\|[^|]+$/i,JE=(a=>(a[a.SUCCESS=0]="SUCCESS",a[a.ILLEGAL_UUID=1]="ILLEGAL_UUID",a[a.NOT_FOUND=2]="NOT_FOUND",a[a.TIMEOUT=3]="TIMEOUT",a[a.EMPTY_MODEL=4]="EMPTY_MODEL",a[a.NO_STEP=5]="NO_STEP",a[a.NO_NETWORK=6]="NO_NETWORK",a))(JE||{}),of=class{constructor(e,t,n){this.modelGnrs=new Array;this.simplifyCostRate=0;this.codePolarityMarkQuadrantDict={};this.fuuidPolarityMarkQuadrantDict={};let i=(n==null?void 0:n.loadModel)===void 0?!0:n.loadModel,s=(n==null?void 0:n.loadFootprint)===void 0?!0:n.loadFootprint;this.keepGroup=(n==null?void 0:n.keepGroup)||new ze(void 0,!0),this.logger=(n==null?void 0:n.logger)||new In(2),this.pool=t,this.unit=e;let o=new Yr(10,e).ratio;this.keepGroup.setVisible(!1),this.invisibleRect=new ze(0),this.invisibleRect.add(new vt(new gr([new me(-.5,-.5,.3),new me(-.5,.5,.3),new me(.5,-.5,.3),new me(.5,.5,.3),new me(.5,-.5,.3),new me(-.5,.5,.3)]),Fe.ZERO)),this.invisibleRect.setScale(new me(3,3,3).scale(o)),this.blackWhiteSquare=ls(zE),this.blackWhiteSquare.setScale(new me(3,3,3).scale(o)),this.grayCuboid=ls(YE),this.grayCuboid.setScale(new me(3,3,3).scale(o)),this.keepGroup.add(this.invisibleRect),this.keepGroup.add(this.blackWhiteSquare),this.keepGroup.add(this.grayCuboid),this.setDefaultModel(null),this.uuidModelCache=new fs("uuidModelCache",(l,u)=>{if(!i){l.forEach(c=>u(c,{model:this.defaultModel,modelStatus:c&&(c0.test(c)||c.length===32)?2:1}));return}l.forEach(async c=>{if(!c){u(c,{model:this.defaultModel,modelStatus:1});return}let h;if(c0.test(c)){let d;try{d=await r0(c)}catch(p){u(c,{model:this.defaultModel,modelStatus:p?6:3});return}if(d.status!==200){u(c,{model:this.defaultModel,modelStatus:2});return}let m=JSON.parse(await d.text()).result;h=(await this.pool.rpcCall("/worker/step2mesh",[m,this.simplifyCostRate])).message}else if(c.length===32){let d;try{d=await kE(c)}catch(p){u(c,{model:this.defaultModel,modelStatus:p?6:3});return}if(d.status!==200){u(c,{model:this.defaultModel,modelStatus:2});return}let m=await d.text();h=(await this.pool.rpcCall("/worker/objDecode",[c,m,this.simplifyCostRate],600*1e3)).message}else{u(c,{model:this.defaultModel,modelStatus:1});return}let f=gg(h);f.isEmpty()?u(c,{model:this.defaultModel,modelStatus:4}):(this.keepGroup.add(f),u(c,{model:f,modelStatus:0}))})}),this.uuidModelSourceCache=new fs("uuidModelSourceCache",async(l,u)=>{for(let c of l){if(!c){u(c,{buffer:null,modelStatus:1});return}if(c0.test(c)){let h;try{h=await r0(c)}catch(d){u(c,{buffer:null,modelStatus:d?6:3});return}if(h.status!==200){u(c,{buffer:null,modelStatus:2});return}let f=JSON.parse(await h.text()).result;u(c,{buffer:new TextEncoder().encode(f).buffer,modelStatus:0})}else if(c.length===32){let h;try{h=await UE(c)}catch(f){u(c,{buffer:null,modelStatus:f?6:3});return}if(h.status!==200){u(c,{buffer:null,modelStatus:2});return}u(c,{buffer:await h.arrayBuffer(),modelStatus:0})}else u(c,{buffer:null,modelStatus:1})}}),this.codeFuuidCache=new fs("codeFuuidCache",async(l,u)=>{var c,h;if(this.logger.info("codes",l),!s){l.forEach(f=>u(f,""));return}try{let d=await(await LE(l)).json();if(d.success){let m={};l.forEach(p=>m[p]=""),(c=d.result)!=null&&c.data?Cs((h=d.result)==null?void 0:h.data,(p,g)=>{m[g.code]=g.package_uuid}):Cs(d.result,(p,g)=>m[g.number]=g.puuid),Cs(m,(p,g)=>{this.fuuidPolarityMarkQuadrantDict[g]=this.codePolarityMarkQuadrantDict[p],u(p,g)})}else throw new Error(d)}catch(f){this.logger.error(f),l.forEach(d=>u(d,""))}}),this.fuuidMgnrCache=new fs("fuuidMgnrCache",async(l,u)=>{if(this.logger.info("footprints",l),!s){l.forEach(c=>{let h=new cn;this.modelGnrs.push(h),u(c,h)});return}try{let h=await(await OE(l)).json();if(h.success){let f={};l.forEach(d=>{f[d]=new cn}),Cs(h.result,(d,m)=>{f[m.uuid]=QE(m,o,this.fuuidPolarityMarkQuadrantDict[m.uuid])}),Cs(f,(d,m)=>{this.modelGnrs.push(m),u(d,m)})}else throw new Error(h)}catch(c){this.logger.error(c),l.forEach(h=>{let f=new cn;this.modelGnrs.push(f),u(h,f)})}});let a=(l,u,c,h,f,d=null)=>{let m=new ze,p=new Array,g=new Array;for(let P of l){let _=new Array;P.points2(.1,B=>{_.push(B)}),g.push(_)}g.forEach(P=>{let _=null;P.forEach(B=>{_&&p.push(new me(B.x,B.y,h),new me(B.x,B.y,f),new me(_.x,_.y,h),new me(_.x,_.y,h),new me(B.x,B.y,f),new me(_.x,_.y,f)),_=B})}),m.add(new vt(new gr(p,Na(p)),u,c,d));let b=new Array;g.forEach(P=>{let _=new Array;if(P.forEach(B=>_.push(B)),_.length>2)for(let B=0;B<_.length-2;B+=2)b.push(new me(_[B].x,_[B].y,h),new me(_[B+1].x,_[B+1].y,h),new me(_[B+2].x,_[B+2].y,h)),_.push(_[B])});let v=new vt(new gr(b,Na(b)),u,c,d);m.add(v);let w=new ze;return w.add(v),w.setPosition(new me(0,0,f-h)),m.add(w),m};this.fuuidModelCache=new fs("fuuidModelCache",(l,u)=>{for(let c of l)(async()=>{let h=await this.fuuidMgnrCache.fetch(c),f=await this.uuidModelCache.fetch(h.uuid);if(h.originModel=f.model,h.modelStatus=f.modelStatus,f.modelStatus!==0&&h.pinShape.length!==0&&h.componentShape.length!==0)try{let d=new ze;d.add(a(h.pinShape,null,new Pn(Fe.of2(196,196,196),Fe.of2(196,196,196),Fe.of2(157,157,157),.1,1),0,15)),d.add(a(h.componentShape,null,new Pn(Fe.of2(64,64,64),Fe.of2(64,64,64),Fe.of2(19,19,19),.1,1),5,35)),h.setModel(d)}catch{h.setModel(Uu(f.model,h,!1,f.model===this.invisibleRect))}else h.setModel(Uu(f.model,h,f.modelStatus===0,f.model===this.invisibleRect));h.gnrAll(),h.beAdd(this.keepGroup),h.setPolarityVisible(!0),h.setPad1Visible(!0),this.logger.info(h.uuid,"complete"),this.logger.debug(h.uuid,h),u(c,h)})()}),this.codeModelCache=new fs("codeModelCache",(l,u)=>{let c=[];for(let h of l)(async()=>{let f=await this.codeFuuidCache.fetch(h),d=await this.fuuidModelCache.fetch(f);d.modelStatus!==0&&c.push(h),u(h,d)})();c.length})}setDefaultModel(e){e==="invisible_rect"?this.defaultModel=this.invisibleRect:e==="gray_cuboid"?this.defaultModel=this.grayCuboid:this.defaultModel=this.blackWhiteSquare}getDefaultModel(e){return e==="invisible_rect"?this.invisibleRect:e==="gray_cuboid"?this.grayCuboid:e===void 0?this.defaultModel:this.blackWhiteSquare}forEach(e){this.modelGnrs.forEach(e)}setSimplifyCostRate(e){this.simplifyCostRate=e}clear(){this.uuidModelCache.clear(),this.codeFuuidCache.clear(),this.fuuidMgnrCache.clear(),this.fuuidModelCache.clear(),this.codeModelCache.clear();for(let e of this.keepGroup.getContents())e!==this.blackWhiteSquare&&e!==this.invisibleRect&&e!==this.grayCuboid&&this.keepGroup.remove(e);this.modelGnrs.length=0,Object.keys(this.codePolarityMarkQuadrantDict).forEach(e=>delete this.codePolarityMarkQuadrantDict[e]),Object.keys(this.fuuidPolarityMarkQuadrantDict).forEach(e=>delete this.fuuidPolarityMarkQuadrantDict[e])}getByModelUuid(e){return this.uuidModelCache.fetch(e)}async getOriginModelByFuuid(e){let t=await this.fuuidMgnrCache.fetch(e);return await this.uuidModelCache.fetch(t.uuid)}async getOriginModelByCode(e){let t=await this.codeFuuidCache.fetch(e),n=await this.fuuidMgnrCache.fetch(t);return await this.uuidModelCache.fetch(n.uuid)}getCodePolarityMarkQuadrant(e){return this.codePolarityMarkQuadrantDict[e]}async getByCode(e,t){if(/,/.test(e)&&(e=e.split(",")[0]),this.codePolarityMarkQuadrantDict[e]!==void 0&&this.codePolarityMarkQuadrantDict[e]!==t)throw new Error("The multi polarityMarkQuadrant is conflicting!");return(t===1||t===2||t===3||t===4)&&(this.codePolarityMarkQuadrantDict[e]=t),this.codeModelCache.fetch(e)}async getByPackageUUID(e,t){if(this.fuuidPolarityMarkQuadrantDict[e]!==void 0&&this.fuuidPolarityMarkQuadrantDict[e]!==t)throw new Error("The multi polarityMarkQuadrant is conflicting!");return(t===1||t===2||t===3||t===4)&&(this.fuuidPolarityMarkQuadrantDict[e]=t),this.fuuidModelCache.fetch(e)}addCodeFuuidCache(e,t){this.codeFuuidCache.addCache(e,t)}async getModelWithSource(e){let t=await this.uuidModelCache.fetch(e),n=await this.uuidModelSourceCache.fetch(e);return{model:t,source:n}}async getModelGnrByCode(e){let t=await this.codeFuuidCache.fetch(e);return await this.fuuidMgnrCache.fetch(t)}};function AY(r,e){let t=r.bbox(),n=e.bbox(),i=(t.minY+t.maxY)/2,s=(n.minY+n.maxY)/2;return i-s}function TY(r,e){let t=r.bbox(),n=e.bbox(),i=(t.minX+t.maxX)/2,s=(n.minX+n.maxX)/2;return i-s}var Qs=class{constructor(e){this.__bbox=null;if(typeof e<"u")if(e instanceof Array){this.__items=[];for(let t of e)this.add(t)}else this.__items=e,this.__bbox=e.bbox();else this.__items=[]}add(e){if(this.__items instanceof Array)this.__items.push(e),this.__bbox=ye.extend2(this.__bbox,e.bbox());else throw new Error("can't insert multiple item into leaf node")}items(){return this.__items}bbox(){if(this.__bbox!==null)return this.__bbox;throw new Error("bug")}},Hn=class{constructor(e){this.changed=!1;this.root=new Qs,this.capacity=e,this.capacity2=e*e,this.itemList=[]}size(){return this.itemList.length}items(){return this.flushWhenNeed(),this.itemList}add(e){this.itemList.push(e),this.changed=!0}remove(e){pr.remove(this.itemList,e),this.changed=!0}clear(){this.changed=!1,this.root=new Qs,this.itemList.length=0}flushWhenNeed(){if(this.changed){let e=new Array;for(let t of this.itemList)e.push(new Qs(t));for(;;){let t=this.organize(e);if(t.length>1)e=t;else break}this.root=new Qs(e),this.changed=!1}}organize(e){En(e,TY,0,e.length);let t=e.length,n=[];for(let i=0;i<t;)if(i+this.capacity2<=t){let s=i+this.capacity2;En(e,AY,i,s);for(let o=i;o<s;o+=this.capacity){let a=new Qs(e.slice(o,o+this.capacity));n.push(a)}i=i+this.capacity*this.capacity}else{let s=new Qs(e.slice(i,i+this.capacity));n.push(s),i=i+this.capacity}return n}search(e){this.flushWhenNeed();let t=[],n=[];for(n.push(this.root);;){let i=n.shift();if(typeof i<"u"){let s=i.items();if(s instanceof Array){for(let o of s)if(!e.isSeparated(o.bbox())){let a=o.items();a instanceof Array?n.push(o):t.push(a)}}else e.isSeparated(i.bbox())||t.push(s)}else break}return t}walker(e){this.flushWhenNeed(),this._walker(this.root,0,e)}_walker(e,t,n){this.flushWhenNeed();let i=e.items();if(i instanceof Array)for(let s of i)this._walker(s,t+1,n);else n(i,t)}bbox(){return this.flushWhenNeed(),this.root.bbox()}};var af=class{constructor(e,t,n,i){this.sides=new Array;this.loader=e,this.logger=n,this.rule=t,this.event=i}addPolyline(e,t=1){let n=this.loader.buildGroup(e,t);for(let i of n)this.sides.push(i),this.event.onOriginSide(i);return n}buildRTree(){let e=new Hn(10);for(let t of this.sides)e.add(t);return e}fillValidSides(e,t,n){for(let i of t)isFinite(i.getX(n))&&e.push(i)}};var Oi=class{constructor(e,t){this.minDistance=Number.MAX_VALUE;this.p=e,this.p1=t,this.intersection()?(this.minDistance=0,this.minline=new Y(q.ORIGIN,q.ORIGIN)):this.minline=this.minLine()}getDistance(){return this.minDistance}getLine(){return this.minline}intersection(){return Du(this.p,this.p1)>0}minLine(){if(this.p instanceof Y&&this.p1 instanceof Y){let e=this.p,t=this.p1;return this.minDistanceForLines(e,t,this.minline)}else if(this.p instanceof re&&this.p1 instanceof Y){let e=this.p,t=this.p1;return this.minDistanceForLineAndArc(e,t,this.minline)}else if(this.p instanceof Y&&this.p1 instanceof re){let e=this.p1,t=this.p;return this.minDistanceForLineAndArc(e,t,this.minline)}else if(this.p instanceof re&&this.p1 instanceof re){let e=this.p,t=this.p1;return this.minDistanceForArcs(e,t,this.minline)}return this.minline}minDistanceForLines(e,t,n){let i=[e.start(),e.end(),t.start(),t.end()];for(let s=0;s<i.length;s++)s<2?n=this.point2LineMinLine(n,t,i[s]):n=this.point2LineMinLine(n,e,i[s]);return n}minDistanceForLineAndArc(e,t,n){n=this.point2LineMinLine(n,t,e.start()),n=this.point2LineMinLine(n,t,e.svgEnd);let i=Oi.foot(t,e.center);return t.bbox().isContains(i)&&(n=this.point2ArcMinLine(n,e,i)),n=this.point2ArcMinLine(n,e,t.start()),n=this.point2ArcMinLine(n,e,t.end()),n}minDistanceForArcs(e,t,n){return n=this.concentricArc(e,t,n),Nt(e,t.center)&&Nt(t,e.center)?n=this.shortestLineForArcs(e,t,n):(n=this.point2ArcMinDistance(t.start(),e,n),n=this.point2ArcMinDistance(t.svgEnd,e,n),n=this.point2ArcMinDistance(e.start(),t,n),n=this.point2ArcMinDistance(e.svgEnd,t,n)),n}minLineForArcAndLine(e,t,n){let i=e.pointOn(n.angleD(e.center)),s=e.pointOn(e.center.angleD(n));return t=this.arcShortestLine(e,t,n,i),t=this.arcShortestLine(e,t,n,s),t}arcInnerLineFootSegment(e,t,n){let i=n.distance1(e.center);if(i!==0){let s=e.rx*(n.y-e.center.y)/i+e.center.y,o=e.rx*(n.x-e.center.x)/i+e.center.x,a=new Y(new q(o,s),n);i=e.rx-i,i<this.minDistance&&(this.minDistance=i,t=a)}else{let s=new Y(e.start(),n);i=e.rx-i,i<this.minDistance&&(this.minDistance=i,t=s)}return t}shortestLineForArcs(e,t,n){let i=e.center.angleD(t.center),s=t.center.angleD(e.center),o=e.pointOn(i),a=e.pointOn(s),l=t.pointOn(i),u=t.pointOn(s);return Nt(e,o)&&(n=this.arcShortestLine(t,n,o,l),n=this.arcShortestLine(t,n,o,u)),Nt(e,a)&&(n=this.arcShortestLine(t,n,a,l),n=this.arcShortestLine(t,n,a,u)),n}concentricArc(e,t,n){if(e.center.distance1(t.center)<1e-5&&e.rx===t.rx&&e.ry===t.ry){let i=new Y(e.start(),t.svgEnd);i.length()<this.minDistance&&(this.minDistance=i.length(),n=i),i=new Y(t.start(),e.svgEnd),i.length()<this.minDistance&&(this.minDistance=i.length(),n=i)}return n}point2ArcMinDistance(e,t,n){if(Nt(t,e)){let i=t.pointOn(e.angleD(t.center)),s=t.pointOn(t.center.angleD(e));n=this.arcShortestLine(t,n,e,i),n=this.arcShortestLine(t,n,e,s)}else n=this.minLineSegment(n,t.start(),e),n=this.minLineSegment(n,t.svgEnd,e);return n}point2ArcMinLine(e,t,n){if(Nt(t,n)){let i=n.distance1(t.center);i>t.rx||i>t.ry?e=this.minLineForArcAndLine(t,e,n):e=this.arcInnerLineFootSegment(t,e,n)}return e}point2LineMinLine(e,t,n){let i=Oi.foot(t,n);return t.bbox().isContains(i)?e=this.minLineSegment(e,i,n):(e=this.minLineSegment(e,t.start(),n),e=this.minLineSegment(e,t.end(),n)),e}minLineSegment(e,t,n){let i=t.distance1(n);return i<this.minDistance&&(this.minDistance=i,e=new Y(t,n)),e}arcShortestLine(e,t,n,i){if(Nt(e,i)){let s=new Y(n,i),o=s.length();o<this.minDistance&&(this.minDistance=o,t=s)}return t}static foot(e,t){if(e.isPoint())return e.start();if(e.b!==0&&e.a!==0){let n=(e.b*e.b*t.x-e.a*e.b*t.y-e.a*e.c)/(e.b*e.b+e.a*e.a),i=(-e.a*e.b*t.x+e.a*e.a*t.y-e.b*e.c)/(e.b*e.b+e.a*e.a);return new q(n,i)}else return e.b===0&&e.a!==0?new q(e.start().x,t.y):e.b!==0&&e.a===0?new q(t.x,e.start().y):t}};var lr=class{static dotProd1(e,t,n,i){return e*n+t*i}static dotProd2(e,t,n,i,s,o){return this.dotProd1(n-e,i-t,s-n,o-i)}static dotProd3(e,t,n){return this.dotProd2(e.x,e.y,t.x,t.y,n.x,n.y)}static crossProd1(e,t,n,i){return e*i-t*n}static crossProd2(e,t,n,i,s,o){return this.crossProd1(n-e,i-t,s-n,o-i)}static crossProd3(e,t,n){return this.crossProd2(e.x,e.y,t.x,t.y,n.x,n.y)}static distance2(e,t,n,i){let s=n-e,o=i-t;return s*s+o*o}static distance1(e,t,n,i){return this.hypot(n-e,i-t)}static distance1p(e,t){return this.distance1(e.x,e.y,t.x,t.y)}static hypot(e,t){if(e=Math.abs(e),t=Math.abs(t),t>e){var n=t;t=e,e=n}if(e===0)return t;var i=t/e;return e*Math.sqrt(1+i*i)}};var Gu=1e-4,ee=new Float64Array(100);function Du(r,e){if(r instanceof Y&&e instanceof Y)return ul(r,e);if(r instanceof re&&e instanceof Y)return lf(r,e);if(r instanceof Y&&e instanceof re)return lf(e,r);if(r instanceof re&&e instanceof re)return NY(r,e);throw new Error("not supported operation")}function xTe(r,e){let t=r.primitives,n=e.primitives,i=t.length>n.length?n:t,s=t.length>n.length?t:n,o=!1;return i.some(a=>(s.some(l=>(o=Du(a,l)>0,o)),o)),o}function bTe(r,e){if(r instanceof Y)return h0(r,e);if(r instanceof re)return d0(r,e);throw new Error("not supported operation")}function h0(r,e){let t=r.bbox();if(t.isContainsY1(e)){let n=new Y(new q(t.minX-1,e),new q(t.maxX+1,e));return ul(n,r)>0?1:0}else return 0}function d0(r,e){if(r.rx===r.ry){let t=r.bbox();if(t.isContainsY1(e)){let n=new Y(new q(t.minX-1,e),new q(t.maxX+1,e));return Fu(r,n)>0?1:0}else return 0}else throw new Error("not supported operation")}function yTe(r,e){if(r.rx===r.ry){let t=r.bbox();if(t.isContainsY1(e)){let n=new Y(new q(t.minX-1,e),new q(t.maxX+1,e)),i=Fu(r,n);return i>0?i:0}else return 0}else throw new Error("not supported operation")}function e_(r,e,t){return isFinite(e)&&isFinite(t)?r.isContains2(e,t):!1}function CY(r,e){let t=r.bbox().intersection1(e.bbox());if(t!=null){let n=lr.crossProd3(e.start(),e.end(),r.start()),i=lr.crossProd3(e.start(),e.end(),r.end());return Math.abs(n)<1e-8||Math.abs(i)<1e-8||n*i<0?t:null}else return null}function ul(r,e){if(r.isPoint())return t_(e,r.start());if(e.isPoint())return t_(r,e.start());{let t=CY(r,e);if(t!=null){let v=function(w,P){t.isContains2(w,P)&&(ee[b++]=w,ee[b++]=P)},n=r.start().x,i=r.start().y,s=r.end().x,o=r.end().y,a=e.start().x,l=e.start().y,u=e.end().x,c=e.end().y,h=e.length(),f=lr.crossProd2(n,i,a,l,u,c)/h,d=lr.crossProd2(s,o,a,l,u,c)/h;if(f*d>0&&!Te.eq(f,0)&&!Te.eq(d,0))return 0;let m=r.length(),p=lr.crossProd2(a,l,n,i,s,o)/m,g=lr.crossProd2(u,c,n,i,s,o)/m;if(p*g>0&&!Te.eq(p,0)&&!Te.eq(g,0))return 0;let b=0;if(Te.eq(f,0)&&Te.eq(d,0)){let w=t.UL(),P=t.UR(),_=t.LL(),B=t.LR();if(Te.eq(t.width(),0))Te.eq(t.height(),0)?(ee[b++]=w.x,ee[b++]=w.y):(ee[b++]=w.x,ee[b++]=w.y,ee[b++]=_.x,ee[b++]=_.y);else if(Te.eq(t.height(),0))ee[b++]=w.x,ee[b++]=w.y,ee[b++]=P.x,ee[b++]=P.y;else{let I=Ji.area2(w.x,w.y,a,l,u,c),C=Ji.area2(P.x,P.y,a,l,u,c);I<C?(ee[b++]=w.x,ee[b++]=w.y,ee[b++]=B.x,ee[b++]=B.y):(ee[b++]=P.x,ee[b++]=P.y,ee[b++]=_.x,ee[b++]=_.y)}}else if(Te.eq(f,0))v(n,i);else if(Te.eq(d,0))v(s,o);else{let w=Math.abs(f/(f-d));v(n+(s-n)*w,i+(o-i)*w)}return b}else return 0}}function t_(r,e){return r.bbox().extendOfSize(1e-8).isContains(e)?r.isPoint()?e.equals1(r.start())?(ee[0]=e.x,ee[1]=e.y,2):0:Te.eq(Ji.area2(r.start().x,r.start().y,r.end().x,r.end().y,e.x,e.y),0)?(ee[0]=e.x,ee[1]=e.y,2):0:0}function Fu(r,e){let t=r.bbox().intersection1(e.bbox());if(t!=null){t=t.extendOfSize(Gu);let n=r.center.x,i=r.center.y,s=r.rx,o=r.rx2,a=e.start().x,l=e.start().y,u=e.end().x,c=e.end().y,h=r.center.distance1(e.start()),f=r.center.distance1(e.end()),d=Te.eq(h,s)?0:h>s?1:-1,m=Te.eq(f,s)?0:f>s?1:-1,p=0;if(d===-1&&m===-1)return 0;if(d===0&&m===0)ee[p++]=a,ee[p++]=l,ee[p++]=u,ee[p++]=c;else if(d===1&&m===1){let g=Oi.foot(e,r.center),b=g.distance1(r.center);if(Te.greater(b,s))return 0;if(Te.eq(b,s))Te.eq(e.distance2(r.start()),0)?(ee[p++]=r.start().x,ee[p++]=r.start().y,ee[p++]=r.start().x,ee[p++]=r.start().y):Te.eq(e.distance2(r.end()),0)?(ee[p++]=r.end().x,ee[p++]=r.end().y,ee[p++]=r.end().x,ee[p++]=r.end().y):(ee[p++]=g.x,ee[p++]=g.y,ee[p++]=g.x,ee[p++]=g.y);else{p=r_(n,i,a,l,u,c,p);let v=ee[p-2],w=ee[p-1],P=lr.distance1(n,i,v,w);if(p-=2,Te.eq(P,s))ee[p++]=v,ee[p++]=w;else if(P<s)p=Cr(o,n,i,a,l,v,w,p),p=Cr(o,n,i,v,w,u,c,p);else return 0}}else if(d===-1||m===-1)p=Cr(o,n,i,a,l,u,c,p);else{let g=Oi.foot(e,r.center),b=g.distance1(r.center);if(Te.eq(b,s)){let v=function(w){return e_(t,w.x,w.y)&&Nt(r,w)};if(d===0){let w=e.start();if(v(w))return ee[p++]=w.x,ee[p++]=w.y,ee[p++]=w.x,ee[p++]=w.y,p;if(v(g))return ee[p++]=g.x,ee[p++]=g.y,ee[p++]=g.x,ee[p++]=g.y,p;if(h<=s)p=Cr(o,n,i,g.x,g.y,u,c,p),p===2&&(ee[p++]=ee[0],ee[p++]=ee[1]);else if(b<s){if(p=Cr(o,n,i,g.x,g.y,u,c,p),p===2&&v(new q(ee[0],ee[1])))return ee[p++]=ee[0],ee[p++]=ee[1],p;p=Cr(o,n,i,g.x,g.y,a,l,0),p===2&&(ee[p++]=ee[0],ee[p++]=ee[1])}}else{let w=e.end();if(v(w))return ee[p++]=w.x,ee[p++]=w.y,ee[p++]=w.x,ee[p++]=w.y,p;if(v(g))return ee[p++]=g.x,ee[p++]=g.y,ee[p++]=g.x,ee[p++]=g.y,p;if(f<=s)p=Cr(o,n,i,g.x,g.y,a,l,p),p===2&&(ee[p++]=ee[0],ee[p++]=ee[1]);else if(b<s){if(p=Cr(o,n,i,g.x,g.y,a,l,p),p===2&&v(new q(ee[0],ee[1])))return ee[p++]=ee[0],ee[p++]=ee[1],p;p=Cr(o,n,i,g.x,g.y,u,c,0),p===2&&(ee[p++]=ee[0],ee[p++]=ee[1])}}}else if(d===0){let v=e.start();ee[p++]=v.x,ee[p++]=v.y,(a-g.x)*(u-g.x)+(l-g.y)*(c-g.y)<0&&(p=Cr(o,n,i,g.x,g.y,u,c,p))}else{let v=e.end();ee[p++]=v.x,ee[p++]=v.y,(a-g.x)*(u-g.x)+(l-g.y)*(c-g.y)<0&&(p=Cr(o,n,i,g.x,g.y,a,l,p))}}if(p>0){let g=0;for(let b=0;b<p;b+=2){let v=ee[b],w=ee[b+1];isFinite(v)&&isFinite(w)&&e_(t,v,w)&&Nt(r,new q(v,w))&&(ee[g++]=v,ee[g++]=w)}return g}else return 0}else return 0}function MY(r,e){if(r.bbox()){let t=r.center.x,n=r.center.y,i=r.rx2,s=e.start().x,o=e.start().y,a=e.end().x,l=e.end().y,u=r.center.distance2(e.start()),c=r.center.distance2(e.end()),h=Te.eq(u,i)?0:u>i?1:-1,f=Te.eq(c,i)?0:c>i?1:-1,d=0;if(h===-1&&f===-1)return 0;if(h===0&&f===0)ee[d++]=s,ee[d++]=o,ee[d++]=a,ee[d++]=l;else if(h===1&&f===1){let m=Oi.foot(e,r.center),p=m.distance2(r.center);if(Te.greater(p,i))return 0;if(Te.eq(p,i)){let g=m.distance2(r.start()),b=m.distance2(r.end());Te.eq(g,0)?(ee[d++]=r.start().x,ee[d++]=r.start().y):Te.eq(b,0)?(ee[d++]=r.end().x,ee[d++]=r.end().y):(ee[d++]=m.x,ee[d++]=m.y)}else{d=r_(t,n,s,o,a,l,d);let g=ee[d-2],b=ee[d-1],v=lr.distance2(t,n,g,b);if(d-=2,Te.eq(v,i))ee[d++]=g,ee[d++]=b;else if(v<i)d=Cr(i,t,n,s,o,g,b,d),d=Cr(i,t,n,g,b,a,l,d);else return 0}}else if(h===-1||f===-1)d=Cr(i,t,n,s,o,a,l,d);else{let m=Oi.foot(e,r.center);h===0?(ee[d++]=e.start().x,ee[d++]=e.start().y,Te.neq(m.distance2(e.start()),0)&&(s-m.x)*(a-m.x)+(o-m.y)*(l-m.y)<0&&(d=Cr(i,t,n,m.x,m.y,a,l,d))):(ee[d++]=e.end().x,ee[d++]=e.end().y,Te.neq(m.distance2(e.end()),0)&&(s-m.x)*(a-m.x)+(o-m.y)*(l-m.y)<0&&(d=Cr(i,t,n,m.x,m.y,s,o,d)))}if(d>0){let m=0;for(let p=0;p<d;p+=2){let g=ee[p],b=ee[p+1];isFinite(g)&&isFinite(b)&&(ee[m++]=g,ee[m++]=b)}return m}else return 0}else return 0}function Cr(r,e,t,n,i,s,o,a){if(i==o){let w=r-(i-t)*(i-t);if(Te.greater(w,0)){let P=Math.sqrt(w),_=e-P,B=e+P,I=Math.min(n,s),C=Math.max(n,s);return _>=I&&_<=C&&(ee[a++]=_,ee[a++]=i),B>=I&&B<=C&&(ee[a++]=B,ee[a++]=i),a}}let l=lr.distance2(n,i,e,t)-r,u=lr.distance2(s,o,e,t)-r,c=n,h=i,f=s,d=o,m=NaN,p=NaN,g=Number.POSITIVE_INFINITY,b=0;for(;g!==0;){b++;let w=Math.max(Math.min(Math.abs(l)/(Math.abs(l)+Math.abs(u)),.75),.25);if(m=c+(f-c)*w,p=h+(d-h)*w,c===m&&h===p||f===m&&d===p){Math.abs(l)>Math.abs(u)?(m=f,p=d,g=u):(m=c,p=h,g=l);break}else g=lr.distance2(m,p,e,t)-r,g<0&&l>u||g>0&&l<u?(f=m,d=p,u=g):(c=m,h=p,l=g)}let v=Math.sqrt(r)-lr.distance1(m,p,e,t);return(Te.eq(0,g)||Te.eq(0,v))&&(ee[a++]=m,ee[a++]=p),a}function r_(r,e,t,n,i,s,o){if(lr.crossProd2(t,n,i,s,r,e)==0){let l=lr.dotProd2(t,n,i,s,r,e),u=lr.dotProd2(i,s,t,n,r,e);return l<0&&u<0?(ee[o++]=r,ee[o++]=e,o):l>=0?(ee[o++]=i,ee[o++]=s,o):(ee[o++]=t,ee[o++]=n,o)}else{let l=NaN,u=NaN,c=t,h=n,f=i,d=s,m=lr.distance2(t,n,r,e),p=lr.distance2(i,s,r,e),g=Number.POSITIVE_INFINITY,b=0;for(;g>0&&(b++,l=c+(f-c)*.5,u=h+(d-h)*.5,!(m==p||c==l&&h==u||f==l&&d==u));){g=lr.distance2(l,u,r,e);let v=lr.dotProd2(c,h,l,u,r,e);if(v==0)break;v<0?(f=l,d=u,p=g):(c=l,h=u,m=g)}return ee[o++]=l,ee[o++]=u,o}}function lf(r,e){if(r.rx===r.ry)return Fu(r,e);throw new Error("not supported")}function vTe(r,e){if(r.rx===r.ry)return MY(r,e);throw new Error("not supported")}function NY(r,e){if(r.bbox().intersection1(e.bbox())!=null){if(r.rx===r.ry&&e.rx===e.ry)return RY(r,e);throw new Error("not supported operation")}return 0}function RY(r,e){let t=r.center.x,n=r.center.y,i=e.center.x,s=e.center.y,o=r.rx,a=e.rx,l=r.rx2,u=e.rx2,c=r.center.distance1(e.center),h=Math.abs(o-a),f=o+a;if(Te.greater(c,f)||Te.less(c,h))return 0;if(Te.eq(c,f)){if(n_(r,e))return 4;let d=new Y(r.center,e.center),m=Fu(e,d);return m=i_(r,m),m!==0?m:(m=Fu(r,d),i_(e,m))}else if(Te.greater(h,0)&&Te.greater(c,0)&&Te.eq(c,h)){if(n_(r,e))return 4;if(o>a){let d=(o-a)/o;return ee[0]=t+(i-t)/d,ee[1]=n+(s-n)/d,s_(r,e,2)}else{let d=(a-o)/a;return ee[0]=i+(t-i)/d,ee[1]=s+(n-s)/d,s_(r,e,2)}}else if(Te.eq(h,0)&&Te.eq(c,0)){let d=0,m;return Nt(r,e.start())&&(ee[d]=e.start().x,ee[d+1]=e.start().y,d+=2,m=e.start()),Nt(r,e.end())&&(ee[d]=e.end().x,ee[d+1]=e.end().y,d+=2,m=e.end()),d===0?(Nt(e,r.start())&&(ee[d]=r.start().x,ee[d+1]=r.start().y,d+=2),Nt(e,r.end())&&(ee[d]=r.end().x,ee[d+1]=r.end().y,d+=2)):d===2&&(!m.equals1(r.start())&&Nt(e,r.start())&&(ee[d]=r.start().x,ee[d+1]=r.start().y,d+=2),!m.equals1(r.end())&&Nt(e,r.end())&&(ee[d]=r.end().x,ee[d+1]=r.end().y,d+=2)),d}else{let m=(r.center.distance2(e.center)-u+l)/(c*2)/c,p=(i-t)*m+t,g=(s-n)*m+n,b=i-t,v=s-n,w=Math.max(o,a),P,_,B,I;if(Math.abs(b)<Math.abs(v)){let M=b/-v,S=g-M*p;P=p-w,_=M*P+S,B=p+w,I=M*B+S}else{let M=v/-b,S=p-M*g;_=g-w,P=M*_+S,I=g+w,B=M*I+S}let C=Cr(l,t,n,P,_,p,g,0);if(C=Cr(l,t,n,p,g,B,I,C),C!==4)throw new Error("cnt !== 4");let N=new q(ee[0],ee[1]),A=new q(ee[2],ee[3]);if(Nt(r,N)&&Nt(e,N))return Nt(r,A)&&Nt(e,A)?4:Js(r.start(),e,A,N)?(ee[2]=r.start().x,ee[3]=r.start().y,4):Js(r.end(),e,A,N)?(ee[2]=r.end().x,ee[3]=r.end().y,4):Js(e.start(),r,A,N)?(ee[2]=e.start().x,ee[3]=e.start().y,4):Js(e.end(),r,A,N)?(ee[2]=e.end().x,ee[3]=e.end().y,4):2;if(Nt(r,A)&&Nt(e,A))return Js(r.start(),e,N,A)?(ee[0]=r.start().x,ee[1]=r.start().y,4):Js(r.end(),e,N,A)?(ee[0]=r.end().x,ee[1]=r.end().y,4):Js(e.start(),r,N,A)?(ee[0]=e.start().x,ee[1]=e.start().y,4):Js(e.end(),r,N,A)?(ee[0]=e.end().x,ee[1]=e.end().y,4):(ee[0]=ee[2],ee[1]=ee[3],2);{let H=function(K,F){if(!!(Te.eq(K.distance1(F.center),F.rx)&&Nt(F,K))){if(K.distance2(N)<K.distance2(A)){if(M)return;M=!0}else{if(S)return;S=!0}ee[$++]=K.x,ee[$++]=K.y}},M=!1,S=!1,$=0;return H(r.start(),e),H(r.end(),e),H(e.start(),r),H(e.end(),r),$}}}function Js(r,e,t,n){return Te.eq(r.distance1(e.center),e.rx)&&Nt(e,r)&&r.distance2(t)<r.distance2(n)}function n_(r,e){return Te.eq(e.start().distance1(r.center),r.rx)&&Nt(r,e.start())?(ee[0]=e.start().x,ee[1]=e.start().y,ee[2]=e.start().x,ee[3]=e.start().y,!0):Te.eq(e.end().distance1(r.center),r.rx)&&Nt(r,e.end())?(ee[0]=e.end().x,ee[1]=e.end().y,ee[2]=e.end().x,ee[3]=e.end().y,!0):Te.eq(r.start().distance1(e.center),e.rx)&&Nt(e,r.start())?(ee[0]=r.start().x,ee[1]=r.start().y,ee[2]=r.start().x,ee[3]=r.start().y,!0):Te.eq(r.end().distance1(e.center),e.rx)&&Nt(e,r.end())?(ee[0]=r.end().x,ee[1]=r.end().y,ee[2]=r.end().x,ee[3]=r.end().y,!0):!1}function i_(r,e){if(e===0)return 0;let t=ee[0],n=ee[1];return Nt(r,new q(t,n))?(ee[0]=t,ee[1]=n,ee[2]=t,ee[3]=n,4):0}function s_(r,e,t){if(t===0)return 0;let n=ee[0],i=ee[1],s=new q(n,i);return Nt(r,s)&&Nt(e,s)?(ee[0]=n,ee[1]=i,ee[2]=n,ee[3]=i,4):0}function ll(r,e){return Math.abs(r-e)<=1e-6}function Nt(r,e){let t=r.bbox();if(e.x-t.minX>-Gu&&e.x-t.maxX<Gu&&e.y-t.minY>-Gu&&e.y-t.maxY<Gu){let n=ut.regularD(e.angleD(r.center));return ll(n,r.startAngle)||ll(n,r.startAngle+360)||ll(n,r.startAngle-360)||ll(n,r.endAngle())||ll(n,r.endAngle()+360)||ll(n,r.endAngle()-360)?!0:r.sweepAngle>0?(Te.less(n,r.startAngle)&&(n+=360),Te.greatereq(r.endAngle(),n)):(Te.greater(n,r.startAngle)&&(n-=360),Te.lesseq(r.endAngle(),n))}else return!1}function wTe(r,e,t){var n,i=+e.x,s=+e.y,o=+t.x,a=+t.y,l=+r.x,u=+r.y,c=o-i,h=a-s,f=l-i,d=u-s,m,p,g,b,v,w;return c===0&&h===0?{d:Math.sqrt(f*f+d*d),point:new q(i,s)}:(n=(f*c+d*h)/(c*c+h*h),n<0?{d:Math.sqrt(f*f+d*d),point:new q(i,s)}:n>1?(m=l-o,p=u-a,{d:Math.sqrt(m*m+p*p),point:new q(o,a)}):(v=i+n*c,w=s+n*h,g=l-v,b=u-w,{d:Math.sqrt(g*g+b*b),point:new q(v,w)}))}function ETe(r,e,t,n){function i(p,g,b){return p instanceof q&&g instanceof q?Math.abs(p.x-g.x)<=b&&Math.abs(p.y-g.y)<=b:!1}var s=i(r,t,.5)||i(r,n,.5)?r:i(e,t,.5)||i(e,n,.5)?e:null;if(s)return!1;var o,a,l,u,c,h,f,d,m;return o=e.x-r.x,a=e.y-r.y,l=n.x-t.x,u=n.y-t.y,f=l*a-u*o,f===0?!1:(d=t.x-r.x,m=t.y-r.y,h=(o*m-a*d)/f,c=(l*m-u*d)/f,h>=0&&h<=1&&c>=0&&c<=1?new q(r.x+c*o,r.y+c*a):!1)}function _Te(r,e){if(!r||!e||r.length!=e.length)return!1;let t="equals1";return!r.some((i,s)=>{let o=e[s],a=!1;return i&&o&&typeof i=="object"&&typeof o=="object"?typeof i[t]=="function"&&OY(i,o)?a=!i[t].call(i,o):a=!(i===o||i.toString()===o.toString()):typeof i=="number"&&typeof o=="number"?a=!(LY(i,o)||Number.isNaN(i)&&Number.isNaN(o)):a=i!==o,a})}function LY(r,e,t=5){return Math.abs(r-e)*Math.pow(10,t)<1}function OY(r,e){return!r||!e||typeof r!="object"||typeof e!="object"?r===e:r.constructor===e.constructor}function PTe(r,e){return new Y(r,e)}function STe(r,e,t,n){var i=e.y-r.y,s=r.x-e.x,o=i*r.x+s*r.y,a=n.y-t.y,l=t.x-n.x,u=a*t.x+l*t.y,c=i*l-a*s;if(c==0)return null;var h=(l*o-s*u)/c,f=(i*u-a*o)/c;return new q(h,f)}function ITe(r,e,t){isNaN(t)&&(t=.001);let n=r.center,i=r.start(),s=r.rx,o=r.ry;var a=Math.atan2(e.y-n.y,e.x-n.x),l=Math.atan2(i.y-n.y,i.x-n.x),u=Math.atan2(o-n.y,s-n.x);if(Math.abs(l-a)<t||Math.abs(l-a)>Math.PI*2-t||Math.abs(u-a)<t)return!0;var c=Math.abs(l-u)>Math.PI===r.isLarge();return Math.abs(Math.abs(l-u)-Math.PI)<t&&(c=(l<=0&&u>=0)==!r.isCCW),l>=u&&l>=a&&a>=u||l<=u&&l<=a&&a<=u?c:!c}var uf=(n=>(n[n.VALID=0]="VALID",n[n.INVALID=1]="INVALID",n[n.UNMARKED=2]="UNMARKED",n))(uf||{}),ps=class{constructor(e){this._status=2;this.sides=[];this.connect=[];this.keepWeight=0;this.reverseWeight=0;this.invalidWeight=0;this.weight=e}get status(){return this._status}get start(){return this.sides[0].start}get end(){return this.sides[this.sides.length-1].end}mark(){if(this._status===2){if(this.invalidWeight>this.keepWeight&&this.invalidWeight>this.reverseWeight){this._status=1;return}if(this.keepWeight>this.reverseWeight&&this.keepWeight>this.invalidWeight){this._status=0;return}if(this.reverseWeight>this.keepWeight&&this.reverseWeight>this.invalidWeight){this._status=0,this.needReverse=!0;return}}}reverse(){let e=this.reverseWeight;this.reverseWeight=this.keepWeight,this.keepWeight=e;let t=[];for(;this.sides.length!==0;)t.push(this.sides.pop().reverse());for(let i of t)this.sides.push(i);this.startNode&&(this.startNode.outChainSet.delete(this),this.startNode.inChainSet.add(this),this.endNode.inChainSet.delete(this),this.endNode.outChainSet.add(this));let n=this.startNode;this.startNode=this.endNode,this.endNode=n}getStartTangent(){let e=this.sides[0].shape;return e instanceof re?e.start().sub(e.center).multiply3(e.isCCW?qe.ROT_90:qe.ROT_N90).normalize():e.end().sub(e.start()).normalize()}getEndTangent(){let e=this.sides[this.sides.length-1].shape;return e instanceof re?e.end().sub(e.center).multiply3(e.isCCW?qe.ROT_N90:qe.ROT_90).normalize():e.start().sub(e.end()).normalize()}bbox(){return this.sides.reduce((e,t)=>e.ext1(t.bbox()),new Oe).build()}getWindingNum(e){let t=this.end,n=0,{x:i,y:s}=e;for(let o of this.sides){let{start:a,end:l,shape:u}=o;if(t.y>s!=a.y>s&&(t.x>i?a.x>i?n+=a.y>t.y?1:-1:t.y>a.y?(t.x-i)*(a.y-s)-(t.y-s)*(a.x-i)<0&&n--:(t.x-i)*(a.y-s)-(t.y-s)*(a.x-i)>0&&n++:a.x>i&&(t.y>a.y?(t.x-i)*(a.y-s)-(t.y-s)*(a.x-i)<0&&n--:(t.x-i)*(a.y-s)-(t.y-s)*(a.x-i)>0&&n++)),a.y>s!=l.y>s){if(a.x>i)if(l.x>i)n+=l.y>a.y?1:-1;else if(u instanceof Y)a.y>l.y?(a.x-i)*(l.y-s)-(a.y-s)*(l.x-i)<0&&n--:(a.x-i)*(l.y-s)-(a.y-s)*(l.x-i)>0&&n++;else if(u instanceof re){let{center:c,isCCW:h,rx2:f}=u,d=(c.x-i)**2+(c.y-s)**2;a.y>l.y?(h?d>f:d<f)&&n--:(h?d<f:d>f)&&n++}else throw new Error("not support!");else if(l.x>i)if(u instanceof Y)a.y>l.y?(a.x-i)*(l.y-s)-(a.y-s)*(l.x-i)<0&&n--:(a.x-i)*(l.y-s)-(a.y-s)*(l.x-i)>0&&n++;else if(u instanceof re){let{center:c,isCCW:h,rx2:f}=u,d=(c.x-i)**2+(c.y-s)**2;a.y>l.y?(h?d>f:d<f)&&n--:(h?d<f:d>f)&&n++}else throw new Error("not support!")}t=l}return n}};function kY(r,e){let t=0;if(Math.abs(r.start.y-e)<=1e-4)ee[t++]=r.start.x;else if(Math.abs(r.end.y-e)<=1e-4)ee[t++]=r.end.x;else if(r.shape instanceof Y)t=h0(r.shape,e);else if(r.shape instanceof re)t=d0(r.shape,e);else throw new Error("not supported operation");return t}var o_=(i=>(i[i.UNMARKED=0]="UNMARKED",i[i.INSIDE=1]="INSIDE",i[i.OUTSIDE=2]="OUTSIDE",i[i.INVALID=3]="INVALID",i))(o_||{}),fi=class{constructor(e,t,n,i,s,o){this.inters=[];this._confidence=0;this._confidence_y=NaN;this._x=NaN;this._x_y=NaN;this.trans=NaN;this.previous=null;this.next=null;this.shape=e,t.y>n.y?this.weight=-o.weight:t.y==n.y?this.weight=0:this.weight=o.weight,this.start=t,this.end=n;let a=new Oe().ext1(e.bbox()).ext2(t).ext2(n).build();this.polyGrp=i,this.polyIndex=s,this._bbox=a,this.inters.push([t,null]),this.inters.push([n,null]),this.chain=o}static rebuild(e,t,n){if(e instanceof Y||t.distance2(n)<1e-6)return new Y(t,n);if(e instanceof re){let i=e,s=e.bbox().center().x,o;t.y>n.y?o=s>i.center.x?yt.CW:yt.CCW:o=s>i.center.x?yt.CCW:yt.CW;let a=t.angleD(i.center),l=n.angleD(i.center);return re.build2(i.center,a,l,i.rx,i.ry,o)}else throw new Error("not supported operation")}updateBbox(){this._bbox=new Oe().ext2(this.start).ext2(this.end).build()}confidence(e){if(this._confidence_y!=e){let t=this._bbox.height();if(t!==0)if(Math.abs(e-this._bbox.maxY)>5e-4&&Math.abs(e-this._bbox.minY)>5e-4){let n=1-Math.abs(2*e-this._bbox.maxY-this._bbox.minY)/t;this._confidence=n*1e4|0}else this._confidence=0;else this._confidence=1;this._confidence_y=e}return this._confidence}revokeOutside(e){let t=this.confidence(e);return this.start.y>this.end.y?this.chain.reverseWeight-=t:this.chain.keepWeight-=t,this.chain.invalidWeight+=t,t}revokeInside(e){let t=this.confidence(e);return this.start.y<this.end.y?this.chain.reverseWeight-=t:this.chain.keepWeight-=t,this.chain.invalidWeight+=t,t}setOutside(e){let t=this.confidence(e);return this.start.y>this.end.y?this.chain.reverseWeight+=t:this.chain.keepWeight+=t,t}setInside(e){let t=this.confidence(e);return this.start.y<this.end.y?this.chain.reverseWeight+=t:this.chain.keepWeight+=t,t}setInvalid(e){let t=this.confidence(e);return this.chain.invalidWeight+=t,t}prevNot0(){let e=this.previous;for(;e!=null&&e!=this;){if(e.weight!=0)return e;e=e.previous}return null}nextNot0(){let e=this.next;for(;e!=null&&e!=this;){if(e.weight!=0)return e;e=e.next}return null}getX(e){return(this._x_y!=e||isNaN(this._x))&&(kY(this,e)>0?this._x=ee[0]:this._x=NaN,this._x_y=e),this._x}voteStatus(){let{keepWeight:e,reverseWeight:t,invalidWeight:n,status:i}=this.chain;return i===1?3:i===0?(this.chain.needReverse?!(this.end.y>this.start.y):this.end.y>this.start.y)?2:1:e>n&&e>t?this.end.y>this.start.y?2:1:n>e&&n>t?3:t>n&&t>e?this.end.y<this.start.y?2:1:0}reverse(){this.shape=fi.rebuild(this.shape,this.end,this.start);let e=this.start;return this.start=this.end,this.end=e,this}isNeedScan(e){return this.chain.keepWeight+this.chain.reverseWeight+this.chain.invalidWeight<5e3&&this.confidence(e)>0&&this.chain.status===2}bbox(){return this._bbox}toString(){return _n.format("(%d,%d,%d) (%d,%d,%d) %s %s",this.polyGrp,this.polyIndex,this.weight,this.chain.keepWeight,this.chain.reverseWeight,this.chain.invalidWeight,this.start,this.end)}};var cf=class{constructor(e){this.polyGrp=0;this.polyIndex=0;this.prevSide=null;this.noWeight0=e}completeGroup(){this.prevSide&&!this.prevSide.end.equals1(this.curSideChain.start)&&this.addSide(new Y(this.prevSide.end,this.curSideChain.start));let e,t=null,n=null;return this.noWeight0?e=this.curSideChain.sides.filter(i=>i.weight===0?!1:(t!=null?(t.next=i,i.previous=t):n=i,t=i,!0)):(e=this.curSideChain.sides,e.forEach(i=>{t!=null?(t.next=i,i.previous=t):n=i,t=i})),t!=null&&n!=null&&(n.previous=t,t.next=n),this.polyGrp++,this.curSideChain=null,this.prevSide=null,this.polyIndex=0,e}buildGroup(e,t){this.curSideChain=new ps(t);for(let n of e.primitives)if(n instanceof Y)this.addSide(n);else if(n instanceof re&&n.rx===n.ry)this.addArc(n);else{let i=null;for(let s of n.points(1))i!=null&&this.addSide(new Y(i,s)),i=s}return this.completeGroup()}addArc(e){let t=e.sweepAngle,n=ut.regularD(e.startAngle),i=n+t;if(t>0){let s=90;for(;s<=i;)s>n&&(this.addSide(re.build3(e.center,n,s-n,e.rx,e.ry)),n=s),s+=90;n<i&&this.addSide(re.build3(e.center,n,i-n,e.rx,e.ry))}else if(t<0){let s=270;for(;s>=i;)s<n&&(this.addSide(re.build3(e.center,n,s-n,e.rx,e.ry)),n=s),s-=90;n>i&&this.addSide(re.build3(e.center,n,i-n,e.rx,e.ry))}}addSide(e){let t=e.start(),n=e.end();if(t.equals1(n))return;this.prevSide&&!this.prevSide.end.equals1(t)&&this.addSide(new Y(this.prevSide.end,t));let i=new fi(e,t,n,this.polyGrp,this.polyIndex++,this.curSideChain);this.curSideChain.sides.push(i),this.prevSide=i}};var hf=class{constructor(e,t,n,i=0){this.eps=new Array;this.start=null;this.last=null;this.prevStart=null;this.prevEnd=null;this.y=n,this.rule=e,this.event=t.event,this.curWeight=i,e(i)&&(this.start=void 0)}getCurWeight(){return this.curWeight}onEp(e){this.tuningWeight(e),this.start===null?this.rule(this.curWeight)?this.in(e):e.setInvalid(this.y):this.rule(this.curWeight)?e.setInvalid(this.y):this.out(e),this.last!==null&&this.event.onSweep1(this.last,e,this.y),this.last=e}in(e){this.prevEnd!=null&&this.onSameX(e,this.prevEnd)?(this.start=this.prevStart,this.prevStart=null,this.prevEnd.revokeInside(this.y),this.prevEnd=null):(this.start=e,this.start.setOutside(this.y))}connect(e){e.chain.connect.push(this.start.chain),this.start.chain.connect.push(e.chain)}out(e){if(this.start===void 0){e.setInside(this.y),this.start=null;return}if(this.onSameX(this.start,e))this.start.revokeOutside(this.y);else{if(e.setInside(this.y)>0&&this.start.confidence(this.y)>0){let t=this.start.voteStatus(),n=e.voteStatus();this.isValid(t)&&this.isValid(n)?t==2&&n==1&&this.connect(e):this.connect(e)}this.event.onSegment1(this.start,e,this.y),this.eps.push(this.start),this.eps.push(e),this.prevStart=this.start,this.prevEnd=e}this.start=null}isValid(e){return e==1||e==2}onSameX(e,t){return e.bbox().isIntersect(t.bbox())&&Te.eq(e.getX(this.y),t.getX(this.y))}tuningWeight(e){this.curWeight+=e.weight;let t=e.nextNot0(),n=e.prevNot0();t!=null&&e.weight===t.weight&&t.trans===this.y&&(this.curWeight-=e.weight),n!=null&&e.weight===n.weight&&n.trans===this.y&&(this.curWeight-=e.weight),e.trans=this.y}};var df=class{constructor(){this._inChainSet=new Set;this._outChainSet=new Set;this._mergedNode=this}get mergedNode(){for(;!this._mergedNode._inChainSet;)this._mergedNode=this._mergedNode._mergedNode;return this._mergedNode}get inChainSet(){return this.mergedNode._inChainSet}get outChainSet(){return this.mergedNode._outChainSet}getSortedChains(){let e=[];if(this.inChainSet.forEach(t=>{let n=t.sides[t.sides.length-1],i,s;n.shape instanceof re?(i=n.shape.exchangeSweep(),s=ut.regular(ut.toRadians(n.shape.endAngle()-(n.shape.isCCW?90:-90)))):(i=new Y(n.end,n.start),s=ut.regular(n.start.angle(n.end))),e.push({chain:t,isStart:!1,angle:s,shape:i})}),this.outChainSet.forEach(t=>{let n=t.sides[0];e.push({chain:t,isStart:!0,angle:n.shape instanceof re?ut.regular(ut.toRadians(n.shape.startAngle+(n.shape.isCCW?90:-90))):ut.regular(n.end.angle(n.start)),shape:n.shape})}),e.sort((t,n)=>t.angle-n.angle),Te.eq(e[0].angle+2*Math.PI,e[e.length-1].angle)){let t,n=e[0].angle;for(let i=1;i<e.length;i++){let s=e[i].angle;if(s-n>Te.eps*2){t=(n+s)/2;break}n=s}e.forEach(i=>i.angle=ut.regular(i.angle-t))}return e.sort((t,n)=>{if(!Te.eq(t.angle,n.angle))return t.angle-n.angle;let i=t.shape,s=n.shape;if(i instanceof re)return s instanceof re?i.isCCW?s.isCCW?s.rx-i.rx:1:s.isCCW?-1:i.rx-s.rx:i.sweepAngle;if(s instanceof re)return-s.sweepAngle;return console.log("=========",t,n,t.angle,n.angle,n.shape.end().sub(n.shape.start()).cross(t.shape.end().sub(n.shape.start()))),n.shape.end().sub(n.shape.start()).cross(t.shape.end().sub(n.shape.start()));return t.angle-n.angle}),e.map(t=>({chain:t.chain,isStart:t.isStart}))}merge(e){if(!e)return this._mergedNode;let t=this.mergedNode,n=e.mergedNode;if(t===n)return t;for(let i of n._inChainSet)t._inChainSet.add(i);for(let i of n._outChainSet)t._outChainSet.add(i);return delete n._inChainSet,delete n._outChainSet,n._mergedNode=t,t}};var ff=class{constructor(){this.chain=new ps(0);this.others=[]}add(e){this.chain.sides.push(...e.sides),e.finalGrp=this;for(let t of e.connect)this.others.push(t)}get polyline(){if(!this._polyline){let e=new Array;for(let t of this.chain.sides)e.push(t.shape);this._polyline=Ce.build2(e).asClose()}return this._polyline}bbox(){return this.polyline.bbox()}};var pf=class{constructor(e,t){this.chains=e,this.originChains=t,e.forEach(n=>n.block=this),this._bbox=t.reduce((n,i)=>n.ext1(i.bbox()),new Oe).build()}searchOriginChains(e){return this.originChainRTree||(this.originChainRTree=new Hn(10),this.originChains.forEach(t=>this.originChainRTree.add(t))),this.originChainRTree.search(e)}bbox(){return this._bbox}};var UY=pr.funcCopy(En),mf=class{constructor(e){this.parents=new Set;this.childrenRTree=new Bi(10);this.marked=!1;this.markedChildNum=0;this.item=e}bbox(){return this.item.bbox()}};function a_(r){let e=r.map(n=>new mf(n));UY(e,(n,i)=>i.bbox().area()-n.bbox().area(),0,e.length);let t=new mf(null);return e.forEach(n=>{let i=n.bbox(),s=[t],o=new Set;for(;s.length!==0;){let a=s.pop();if(o.has(a))continue;o.add(a);let l=a.childrenRTree.search(i),u=l.filter(c=>c.bbox().isContainsBBox(i));u.length===0?(l.filter(c=>i.isContainsBBox(c.bbox())).forEach(c=>{c.parents.delete(a),a.childrenRTree.remove(c),c.parents.add(n),n.childrenRTree.insert(c)}),a.childrenRTree.insert(n),n.parents.add(a)):s.push(...u)}}),t.childrenRTree.items.forEach(n=>n.parents.clear()),Array.from(t.childrenRTree.items)}var gf=.01,xf=1,DY=pr.funcCopy(En),GY=pr.funcCopy(En),FY=pr.funcCopy(En),qY=pr.funcCopy(En);function zY(r,e){return r.bbox().minY-e.bbox().minY}function YY(r,e){return r.bbox().area()-e.bbox().area()}var f0,l_={};function qu(r){l_[r]=(l_[r]||0)-f0+(f0=performance.now())}var XY=0,VY=0,WY=0,$Y=0,jY=0,HY=0,ZY=0,bf=class{constructor(e,t){this.vertex=e,this.node=t}bbox(){return this.vertex.bbox()}},yf=class extends af{constructor(t,n,i){super(new cf(!1),t,n,i);this.outSideGroups=[];this.inSideGroups=[];this.scanY=NaN;this.curNetIndex=0;this.scanLines=0;this.blockOriginChainsIndex=[];this.blockChainsIndex=[];this.blocks=[]}addPolyline(t,n=1){let i=super.addPolyline(t,n);return i.length!==0&&(i[0].chain.blockIndex=this.blockOriginChainsIndex.length,this.blockOriginChainsIndex.push([i[0].chain])),i}sweep(t,n,i,s,o){this.scanY=NaN,this.scanLines=0,GY(n,zY,0,n.length);let a=new Un;this.curNetIndex=0;let l=Number.POSITIVE_INFINITY;for(let u of t)u>l&&this.scan(a,(l+u)/2,n,i,s),l=u;for(let u of o)u.mark();ZY+=this.scanLines}simplify(){HY++,XY+=this.blockOriginChainsIndex.length,WY+=this.sides.length,f0=performance.now(),this.seekIntersection(),qu("seekIntersection"),this.splitSidesByInters(),this.blockChainsIndex.forEach(t=>{VY+=t.length,t.forEach(n=>$Y+=n.sides.length)}),qu("splitSidesByInters"),this.sweepBlocks(),jY+=this.blocks.length,qu("sweepBlocks"),this.connectSides(),qu("connectSides"),this.fillResult(),qu("fillResult")}sweepBlocks(){let t=new Set;this.blockChainsIndex.forEach((s,o)=>{let a=new pf(s,this.blockOriginChainsIndex[o]),l=a.bbox();if(l.width()<=gf||l.height()<=gf)return;this.blocks.push(a);let u=Number.NEGATIVE_INFINITY,c;s.forEach(h=>{h.sides.forEach(f=>{Math.abs(f.start.y-f.end.y)>u&&(u=Math.abs(f.start.y-f.end.y),c=f)})}),t.add(c.start.y),t.add(c.end.y)});let n=a_(this.blocks),i=[];for(;n.length!==0;){let s=n.pop();s.childrenRTree.items.size===0?i.push(s):n.push(...s.childrenRTree.items)}for(;i.length!==0;){let s=i.pop();if(s.marked)continue;let o=new Un;s.parents.forEach(h=>o.push(h));let a=s.item.chains[0].start,l=a.bbox(),u,c=0;for(;o.size()!==0&&!u;){let h=o.shift();for(let f of h.item.searchOriginChains(l)){let d=f.getWindingNum(a);d!==0&&(u=h,c-=d*f.weight)}h.parents.forEach(f=>o.push(f))}for(let h of s.parents)h.childrenRTree.remove(s),h.childrenRTree.items.size===h.markedChildNum&&i.push(h);s.parents.clear(),s.marked=!0,u?(s.item.startWeight=c,s.parents.add(u),u.childrenRTree.insert(s),u.markedChildNum++):(s.item.startWeight=0,n.push(s))}for(;n.length!==0;){let s=n.pop(),o=s.item.startWeight;for(let a of s.childrenRTree.items)a.item.startWeight+=o,n.push(a)}this.blocks.forEach((s,o)=>{let a=[];s.chains.forEach(l=>a.push(...l.sides)),this.sweep(this.getSortedEndpointsLineAsc(!1,s.chains),a,!1,s.startWeight,s.chains),this.sweep(this.getSortedEndpointsLineAsc(!0,s.chains),this.flipSides(a),!0,s.startWeight,s.chains)})}scan(t,n,i,s,o){if(this.scanY===n)return;this.scanY=n;let a=!1,l=t.listIterator();for(;l.hasNext();){let f=l.next(),d=f.item;Te.less(d.bbox().maxY,n)?t.remove(f):!a&&d.isNeedScan(n)&&(a=!0)}for(;this.curNetIndex<i.length;){let f=i[this.curNetIndex];if(Te.less(f.bbox().minY,n))Te.greatereq(f.bbox().maxY,n)&&(this.add2AET(t,f),!a&&f.isNeedScan(n)&&(a=!0)),this.curNetIndex++;else break}if(!a)return;this.scanLines++;let u=new hf(this.rule,this,n,o),c=t.iterator(),h=0;for(;c.hasNext();){let f=c.next(),d=u.getCurWeight();u.onEp(f),this.event.onScan(s,f,n,h++,d,u.getCurWeight())}}add2AET(t,n){let i=n.bbox().minX,s=n.bbox().maxX,o=n.bbox().minY,a=n.bbox().maxY,l=t.listIterator(),u=null;for(;l.hasNext();){let c,h=l.next(),f=h.item,d=f.bbox().minX,m=f.bbox().maxX;if(s<=d)c=-1;else if(m<=i)c=1;else{let g=f.bbox().minY,b=f.bbox().maxY,v=Math.max(o,g),w=Math.min(a,b);c=this.compareBySweep(n,f,(v+w)/2)}let p=f.shape;if(p instanceof Y&&p.length()<.001&&u==null&&c<0){u=h;continue}if(u!=null&&c<0){t.insertBefore(u,n);return}if(c<0){t.insertBefore(h,n);return}else u=null}t.add(n)}getLineAngle(t){let n=t.start().angle(t.end());return n<0&&(n+=Math.PI),n}getArcAngle(t,n){let i=Math.asin((n-t.center.y)/t.rx);return t.startAngle>90&&t.startAngle<270&&(i=-i),i<0&&(i+=Math.PI),(i+Math.PI/2)%Math.PI}compareArcLine(t,n,i){let s=this.getArcAngle(t,i),o=this.getLineAngle(n);return Te.eq(s,o)?-t.sweepAngle:o-s}compareBySweep(t,n,i){let s=t.getX(i);if(!isFinite(s))return 0;let o=n.getX(i);if(!isFinite(o))return 0;if(!Te.eq(s,o))return s-o;if(t.shape instanceof Y)return n.shape instanceof Y?this.getLineAngle(n.shape)-this.getLineAngle(t.shape):-this.compareArcLine(n.shape,t.shape,i);if(n.shape instanceof Y)return this.compareArcLine(t.shape,n.shape,i);{let a=t.shape,l=n.shape,u=this.getArcAngle(a,i),c=this.getArcAngle(l,i);return Te.eq(u,c)?a.sweepAngle*l.sweepAngle<=0?a.sweepAngle<=0?1:-1:a.sweepAngle>0?a.rx-l.rx:l.rx-a.rx:c-u}}flipSides(t){let n=[];for(let i of t){if(i.polyIndex!==0)continue;let s=null,o=null;do{let a=i.shape.multiply3(qe.ROT_90),l=i.start.multiply3(qe.ROT_90),u=i.end.multiply3(qe.ROT_90),c=new fi(a,l,u,i.polyGrp,i.polyIndex,i.chain);if(s!=null?(s.next=c,c.previous=s):o=c,n.push(c),this.event.onSplitedSide(c),s=c,i.next!==null)i=i.next;else break}while(i.polyIndex!=0);o!=null&&(o.previous=s,s.next=o)}return n}connectSides(){let t=[];this.blocks.forEach(n=>n.chains.forEach(i=>{if(i.needReverse===!0&&i.reverse(),i.sides.forEach(o=>this.event.onResultSide(o)),i.status===0?t.push(i):i.status===1&&i.startNode&&(i.startNode.outChainSet.delete(i),i.endNode.inChainSet.delete(i)),!i.startNode)return;let s=new Oe;for(let o of i.sides){s.ext1(o.bbox());let a=s.build();if(a.width()>gf||a.height()>gf)return}i.startNode.outChainSet.delete(i),i.endNode.inChainSet.delete(i),i.startNode.merge(i.endNode),i.status===0&&t.pop()}));{let n=new Hn(10);for(let i of t)!i.startNode||(i.startNode.inChainSet.size!==i.startNode.outChainSet.size&&n.add(new bf(i.start,i.startNode)),i.endNode.inChainSet.size!==i.endNode.outChainSet.size&&n.add(new bf(i.end,i.endNode)));for(let{vertex:i,node:s}of n.items())n.search(new ye(i.x-xf,i.x+xf,i.y-xf,i.y+xf)).forEach(o=>{o.vertex!==i&&s.merge(o.node)})}for(let n of t){let i=new Un;if(i.add(n),!n.startNode){this.fillSideGroups(i);continue}if(!n.startNode.outChainSet.has(n))continue;n.startNode.outChainSet.delete(n),n.endNode.inChainSet.delete(n);let s=n.startNode.outChainSet;for(;i.size()>0;){let o=i.getLast();if(o.endNode.outChainSet===s)break;let a=Number.POSITIVE_INFINITY,l,u=o.end;for(let c of o.endNode.outChainSet){if(c.status!==0)continue;let h=u.distance2(c.start);if(h<a&&(a=h,l=c,h===0))break}l?(i.add(l),l.startNode.outChainSet.delete(l),l.endNode.inChainSet.delete(l)):i.removeLast()}i.size()>0&&this.fillSideGroups(i)}}fillSideGroups(t){let n=new ff;Aa(t,(i,s)=>(n.add(s),!0)),n.polyline.area(.1)<0?this.outSideGroups.push(n):this.inSideGroups.push(n)}fillResult(){let t=0,n=new Hn(10),i=this.outSideGroups.map((s,o)=>{s.outIndex=o,n.add(s);let a=[];a.push(s);for(let l of a)if(l.isUsed!==!0){l.isUsed=!0;for(let u of l.others)u.finalGrp&&a.push(u.finalGrp)}return a.filter(l=>l.isUsed===!0?(l.isUsed=!1,!0):!1).map(l=>(l.isUsed=!0,l.polyline))});this.inSideGroups.map(s=>{if(s.isUsed===!0)return;let o=n.search(s.chain.start.bbox());qY(o,YY,0,o.length);for(let a of o)if(a.chain.getWindingNum(s.chain.start)!==0){i[a.outIndex].push(s.polyline);break}});for(let s of i)this.event.onPolylineGroup(new Po(s),t++)}getSortedEndpointsLineAsc(t,n){let i=t?"x":"y",s=new Set;for(let a of n){if(a.status!==2)continue;let l,u=Number.NEGATIVE_INFINITY;for(let c of a.sides)Math.abs(c.start[i]-c.end[i])>u&&(l=c,u=Math.abs(c.start[i]-c.end[i]));u!==0&&(s.add(l.start[i]),s.add(l.end[i]))}let o=Array.from(s);return FY(o,pr.sortAsc,0,o.length),o}splitSides(t,n,i,s){if(t.inters.length===2){let c=new fi(t.shape,t.start,t.end,t.polyGrp,i++,this.curChain);return c.updateBbox(),n.push(c),this.curChain.sides.push(c),i}let{start:o,end:a}=t,l=new q(a.x+(o.x-a.x)*2,a.y+(o.y-a.y)*2);DY(t.inters,(c,h)=>c[0].distance2(l)-h[0].distance2(l),0,t.inters.length);let u=null;for(let[c,h]of t.inters){if(!u)c.equals1(o)&&(u=c);else if(!c.equals1(u)){let f=fi.rebuild(t.shape,u,c);f instanceof re&&Math.abs(f.sweepAngle)>190&&(f=new Y(u,c));let d=new fi(f,u,c,t.polyGrp,i++,this.curChain);d.updateBbox(),n.push(d),this.curChain.sides.push(d),c.equals1(a)?u=null:u=c}!h||(this.curChain.sides.length===0?this.prevChain&&(h.inChainSet.add(this.prevChain),this.prevChain.endNode=h.merge(this.prevChain.endNode)):(this.prevChain=this.curChain,h.inChainSet.add(this.prevChain),this.prevChain.endNode=h.merge(this.prevChain.endNode),this.curChain=new ps(t.chain.weight),s.push(this.curChain)),h.outChainSet.add(this.curChain),this.curChain.startNode=h.merge(this.curChain.startNode))}return i}splitSidesByInters(){this.blockOriginChainsIndex.forEach((t,n)=>{let i=[];this.blockChainsIndex[n]=i;for(let s of t){this.curChain=new ps(s.weight),i.push(this.curChain);let o=this.curChain;this.prevChain=null;let a=0,l,u;for(let c of s.sides){let h=new Array;a=this.splitSides(c,h,a,i);for(let f of h)l!=null?(l.next=f,f.previous=l):u=f,l=f,this.event.onSplitedSide(f)}if(u.previous=l,l.next=u,o.startNode)this.curChain.sides.length===0?(i.pop(),this.curChain.startNode.outChainSet.delete(this.curChain),this.curChain.startNode.merge(o.startNode)):(o.startNode.inChainSet.add(this.curChain),this.curChain.endNode=o.startNode);else{if(o===this.curChain)continue;i.pop();for(let h of this.curChain.sides)h.chain=o;let c=this.curChain.sides.concat(o.sides);o.sides.length=0;for(let h of c)o.sides.push(h);this.curChain.startNode.outChainSet.delete(this.curChain),this.curChain.startNode.outChainSet.add(o),o.startNode=this.curChain.startNode}}})}seekIntersection(){let t=new Oe;this.sides.forEach(o=>t.ext1(o.bbox()));let n=t.build().LL();for(let o of this.sides){let a=o.bbox();o.oneDimStart=a.LL().distance2(n),o.oneDimEnd=a.UR().distance2(n)}this.sides.sort((o,a)=>o.oneDimStart-a.oneDimStart);let i=new Bi(10),s=new As((o,a)=>o.oneDimEnd-a.oneDimEnd);for(let o of this.sides){for(;;){let a=s.poll();if(a)if(o.oneDimStart<=a.oneDimEnd){s.add(a);break}else i.remove(a);else break}for(let a of i.search(o.bbox().extendOfSize(1e-5))){if(a===o.next&&a===o.previous)continue;let l=Du(o.shape,a.shape);if(l!==0){for(let u=l-2;u>=2;u-=2)for(let c=u-2;c>=0;c-=2)if(Te.eq(ee[u],ee[c])&&Te.eq(ee[u+1],ee[c+1])){ee[c]=(ee[u]+ee[c])/2,ee[c+1]=(ee[u+1]+ee[c+1])/2;for(let h=l-3;h>=u;h--)ee[h]=ee[h+2];l-=2;break}if(a===o.next){if(l<=2)continue;(ee[0]-a.start.x)**2+(ee[1]-a.start.y)**2<(ee[2]-a.start.x)**2+(ee[3]-a.start.y)**2&&(ee[0]=ee[2],ee[1]=ee[3]),l=2}else if(a===o.previous){if(l<=2)continue;(ee[0]-a.end.x)**2+(ee[1]-a.end.y)**2<(ee[2]-a.end.x)**2+(ee[3]-a.end.y)**2&&(ee[0]=ee[2],ee[1]=ee[3]),l=2}if(o.chain.blockIndex!==a.chain.blockIndex){let u,c;this.blockOriginChainsIndex[o.chain.blockIndex].length>this.blockOriginChainsIndex[a.chain.blockIndex].length?(u=o.chain.blockIndex,c=a.chain.blockIndex):(u=a.chain.blockIndex,c=o.chain.blockIndex);let h=this.blockOriginChainsIndex[u];for(let f of this.blockOriginChainsIndex[c])f.blockIndex=u,h.push(f);delete this.blockOriginChainsIndex[c]}for(let u=0;u<l;u+=2){let c=new q(ee[u],ee[u+1]),h=new df;o.inters.push([c,h]),a.inters.push([c,h]),this.event.onIntersect(c,o,a)}}}s.add(o),i.insert(o)}}};var u_=r=>r!==0,GMe=r=>r>0,FMe=r=>r<0,qMe=r=>r%2!==0;var c_=!1,vf=class{onRTreeBBox(e){}onResultSide(e){}onOriginSide(e){}onSplitedSide(e){}onDebugSide(e){}onSweep(e,t,n,i,s,o){}onIntersect(e,t,n){}onSegment(e,t,n,i,s,o){}onSegment1(e,t,n){if(c_){let i=new q(e.getX(n),n),s=new q(t.getX(n),n);this.onSegment(i,e.weight,e,s,t.weight,t)}else this.onSegment(e.start,e.weight,e,t.end,t.weight,t)}onSweep1(e,t,n){if(c_){let i=new q(e.getX(n),n),s=new q(t.getX(n),n);this.onSweep(i,e.weight,e,s,t.weight,t)}else this.onSweep(e.start,e.weight,e,t.end,t.weight,t)}onScan(e,t,n,i,s,o){}};var KY={"!":["1 -12 1 2","1 7 0 8 1 9 2 8 1 7"],'"':["0 -12 0 -5","8 -12 8 -5"],"#":["8 -16 1 16","14 -16 7 16","1 -3 15 -3","0 3 14 3"],$:["5 -16 5 13","9 -16 9 13","14 -9 12 -11 9 -12 5 -12 2 -11 0 -9 0 -7 1 -5 2 -4 4 -3 10 -1 12 0 13 1 14 3 14 6 12 8 9 9 5 9 2 8 0 6"],"%":["18 -12 0 9","5 -12 7 -10 7 -8 6 -6 4 -5 2 -5 0 -7 0 -9 1 -11 3 -12 5 -12 7 -11 10 -10 13 -10 16 -11 18 -12","14 2 12 3 11 5 11 7 13 9 15 9 17 8 18 6 18 4 16 2 14 2"],"&":["20 -3 20 -4 19 -5 18 -5 17 -4 16 -2 14 3 12 6 10 8 8 9 4 9 2 8 1 7 0 5 0 3 1 1 2 0 9 -4 10 -5 11 -7 11 -9 10 -11 8 -12 6 -11 5 -9 5 -7 6 -4 8 -1 13 6 15 8 17 9 19 9 20 8 20 7"],"'":["2 -15 2 -9"],"`":["2 -15 4 -9"],"(":["7 -16 5 -14 3 -11 1 -7 0 -2 0 2 1 7 3 11 5 14 7 16"],")":["0 -16 2 -14 4 -11 6 -7 7 -2 7 2 6 7 4 11 2 14 0 16"],"*":["5 -6 5 6","0 -3 10 3","10 -3 0 3"],"+":["9 -9 9 9","0 0 18 0"],",":["2 5 1 6 0 5 1 4 2 5 2 7 0 9"],"-":["0 0 18 0"],".":["1 4 0 5 1 6 2 5 1 4"],"/":["18 -16 0 16"],0:["6 -12 3 -11 1 -8 0 -3 0 0 1 5 3 8 6 9 8 9 11 8 13 5 14 0 14 -3 13 -8 11 -11 8 -12 6 -12"],1:["0 -8 2 -9 5 -12 5 9"],2:["1 -7 1 -8 2 -10 3 -11 5 -12 9 -12 11 -11 12 -10 13 -8 13 -6 12 -4 10 -1 0 9 14 9"],3:["2 -12 13 -12 7 -4 10 -4 12 -3 13 -2 14 1 14 3 13 6 11 8 8 9 5 9 2 8 1 7 0 5"],4:["10 -12 0 2 15 2","10 -12 10 9"],5:["12 -12 2 -12 1 -3 2 -4 5 -5 8 -5 11 -4 13 -2 14 1 14 3 13 6 11 8 8 9 5 9 2 8 1 7 0 5"],6:["12 -9 11 -11 8 -12 6 -12 3 -11 1 -8 0 -3 0 2 1 6 3 8 6 9 7 9 10 8 12 6 13 3 13 2 12 -1 10 -3 7 -4 6 -4 3 -3 1 -1 0 2"],7:["14 -12 4 9","0 -12 14 -12"],8:["5 -12 2 -11 1 -9 1 -7 2 -5 4 -4 8 -3 11 -2 13 0 14 2 14 5 13 7 12 8 9 9 5 9 2 8 1 7 0 5 0 2 1 0 3 -2 6 -3 10 -4 12 -5 13 -7 13 -9 12 -11 9 -12 5 -12"],9:["13 -5 12 -2 10 0 7 1 6 1 3 0 1 -2 0 -5 0 -6 1 -9 3 -11 6 -12 7 -12 10 -11 12 -9 13 -5 13 0 12 5 10 8 7 9 5 9 2 8 1 6"],":":["1 -3 0 -2 1 -1 2 -2 1 -3","1 4 0 5 1 6 2 5 1 4"],";":["1 -3 0 -2 1 -1 2 -2 1 -3","2 5 1 6 0 5 1 4 2 5 2 7 0 9"],"<":["16 -9 0 0 16 9"],"=":["0 -3 18 -3","0 3 18 3"],">":["0 -9 16 0 0 9"],"?":["0 -7 0 -8 1 -10 2 -11 4 -12 8 -12 10 -11 11 -10 12 -8 12 -6 11 -4 10 -3 6 -1 6 2","6 7 5 8 6 9 7 8 6 7"],"@":["15 -4 14 -6 12 -7 9 -7 7 -6 6 -5 5 -2 5 1 6 3 8 4 11 4 13 3 14 1","9 -7 7 -5 6 -2 6 1 7 3 8 4","15 -7 14 1 14 3 16 4 18 4 20 2 21 -1 21 -3 20 -6 19 -8 17 -10 15 -11 12 -12 9 -12 6 -11 4 -10 2 -8 1 -6 0 -3 0 0 1 3 2 5 4 7 6 8 9 9 12 9 15 8 17 7 18 6","16 -7 15 1 15 3 16 4"],A:["8 -12 0 9","8 -12 16 9","3 2 13 2"],B:["0 -12 0 9","0 -12 9 -12 12 -11 13 -10 14 -8 14 -6 13 -4 12 -3 9 -2","0 -2 9 -2 12 -1 13 0 14 2 14 5 13 7 12 8 9 9 0 9"],C:["15 -7 14 -9 12 -11 10 -12 6 -12 4 -11 2 -9 1 -7 0 -4 0 1 1 4 2 6 4 8 6 9 10 9 12 8 14 6 15 4"],D:["0 -12 0 9","0 -12 7 -12 10 -11 12 -9 13 -7 14 -4 14 1 13 4 12 6 10 8 7 9 0 9"],E:["0 -12 0 9","0 -12 13 -12","0 -2 8 -2","0 9 13 9"],F:["0 -12 0 9","0 -12 13 -12","0 -2 8 -2"],G:["15 -7 14 -9 12 -11 10 -12 6 -12 4 -11 2 -9 1 -7 0 -4 0 1 1 4 2 6 4 8 6 9 10 9 12 8 14 6 15 4 15 1","10 1 15 1"],H:["0 -12 0 9","14 -12 14 9","0 -2 14 -2"],I:["0 -12 0 9"],J:["10 -12 10 4 9 7 8 8 6 9 4 9 2 8 1 7 0 4 0 2"],K:["0 -12 0 9","14 -12 0 2","5 -3 14 9"],L:["0 -12 0 9","0 9 12 9"],M:["0 -12 0 9","0 -12 8 9","16 -12 8 9","16 -12 16 9"],N:["0 -12 0 9","0 -12 14 9","14 -12 14 9"],O:["6 -12 4 -11 2 -9 1 -7 0 -4 0 1 1 4 2 6 4 8 6 9 10 9 12 8 14 6 15 4 16 1 16 -4 15 -7 14 -9 12 -11 10 -12 6 -12"],P:["0 -12 0 9","0 -12 9 -12 12 -11 13 -10 14 -8 14 -5 13 -3 12 -2 9 -1 0 -1"],Q:["6 -12 4 -11 2 -9 1 -7 0 -4 0 1 1 4 2 6 4 8 6 9 10 9 12 8 14 6 15 4 16 1 16 -4 15 -7 14 -9 12 -11 10 -12 6 -12","9 5 15 11"],R:["0 -12 0 9","0 -12 9 -12 12 -11 13 -10 14 -8 14 -6 13 -4 12 -3 9 -2 0 -2","7 -2 14 9"],S:["14 -9 12 -11 9 -12 5 -12 2 -11 0 -9 0 -7 1 -5 2 -4 4 -3 10 -1 12 0 13 1 14 3 14 6 12 8 9 9 5 9 2 8 0 6"],T:["7 -12 7 9","0 -12 14 -12"],U:["0 -12 0 3 1 6 3 8 6 9 8 9 11 8 13 6 14 3 14 -12"],V:["0 -12 8 9","16 -12 8 9"],W:["0 -12 5 9","10 -12 5 9","10 -12 15 9","20 -12 15 9"],X:["0 -12 14 9","14 -12 0 9"],Y:["0 -12 8 -2 8 9","16 -12 8 -2"],Z:["14 -12 0 9","0 -12 14 -12","0 9 14 9"],"[":["0 -16 0 16","1 -16 1 16","0 -16 7 -16","0 16 7 16"],"\\":["0 -12 14 12"],"]":["6 -16 6 16","7 -16 7 16","0 -16 7 -16","0 16 7 16"],"^":["8 -14 0 0","8 -14 16 0"],_:["0 16 18 16"],a:["12 -5 12 9","12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"],b:["0 -12 0 9","0 -2 2 -4 4 -5 7 -5 9 -4 11 -2 12 1 12 3 11 6 9 8 7 9 4 9 2 8 0 6"],c:["12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"],d:["12 -12 12 9","12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"],e:["0 1 12 1 12 -1 11 -3 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"],f:["8 -12 6 -12 4 -11 3 -8 3 9","0 -5 7 -5"],g:["12 -5 12 11 11 14 10 15 8 16 5 16 3 15","12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"],h:["0 -12 0 9","0 -1 3 -4 5 -5 8 -5 10 -4 11 -1 11 9"],i:["0 -12 1 -11 2 -12 1 -13 0 -12","1 -5 1 9"],j:["4 -12 5 -11 6 -12 5 -13 4 -12","5 -5 5 12 4 15 2 16 0 16"],k:["0 -12 0 9","10 -5 0 5","4 1 11 9"],l:["0 -12 0 9"],m:["0 -5 0 9","0 -1 3 -4 5 -5 8 -5 10 -4 11 -1 11 9","11 -1 14 -4 16 -5 19 -5 21 -4 22 -1 22 9"],n:["0 -5 0 9","0 -1 3 -4 5 -5 8 -5 10 -4 11 -1 11 9"],o:["5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6 13 3 13 1 12 -2 10 -4 8 -5 5 -5"],p:["0 -5 0 16","0 -2 2 -4 4 -5 7 -5 9 -4 11 -2 12 1 12 3 11 6 9 8 7 9 4 9 2 8 0 6"],q:["12 -5 12 16","12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"],r:["0 -5 0 9","0 1 1 -2 3 -4 5 -5 8 -5"],s:["11 -2 10 -4 7 -5 4 -5 1 -4 0 -2 1 0 3 1 8 2 10 3 11 5 11 6 10 8 7 9 4 9 1 8 0 6"],t:["3 -12 3 5 4 8 6 9 8 9","0 -5 7 -5"],u:["0 -5 0 5 1 8 3 9 6 9 8 8 11 5","11 -5 11 9"],v:["0 -5 6 9","12 -5 6 9"],w:["0 -5 4 9","8 -5 4 9","8 -5 12 9","16 -5 12 9"],x:["0 -5 11 9","11 -5 0 9"],y:["1 -5 7 9","13 -5 7 9 5 13 3 15 1 16 0 16"],z:["11 -5 0 9","0 -5 11 -5","0 9 11 9"],"{":["5 -16 3 -15 2 -14 1 -12 1 -10 2 -8 3 -7 4 -5 4 -3 2 -1","3 -15 2 -13 2 -11 3 -9 4 -8 5 -6 5 -4 4 -2 0 0 4 2 5 4 5 6 4 8 3 9 2 11 2 13 3 15","2 1 4 3 4 5 3 7 2 8 1 10 1 12 2 14 3 15 5 16"],"|":["0 -16 0 16"],"}":["0 -16 2 -15 3 -14 4 -12 4 -10 3 -8 2 -7 1 -5 1 -3 3 -1","2 -15 3 -13 3 -11 2 -9 1 -8 0 -6 0 -4 1 -2 5 0 1 2 0 4 0 6 1 8 2 9 3 11 3 13 2 15","3 1 1 3 1 5 2 7 3 8 4 10 4 12 3 14 2 15 0 16"],"~":["0 3 0 1 1 -2 3 -3 5 -3 7 -2 11 1 13 2 15 2 17 1 18 -1","0 1 1 -1 3 -2 5 -2 7 -1 11 2 13 3 15 3 17 2 18 -1 18 -3"],"\xB0":["0 -11 -3 -8 0 -5 3 -8 0 -11"]};function QY(r,e=0){let t=KY[r],n=new Array;for(let i of t){let s=i.split(" "),o=new Array(s.length);for(let a=0;a<s.length;a+=2)o[a]=e+parseFloat(s[a]),o[a+1]=-parseFloat(s[a+1]);n.push(Ce.build5(o))}return new Po(n)}function h_(r,e){let t=new Array,n=e;for(let i of r){let s=QY(i,n);n+=s.bbox().width()+e,t.push(...s.items)}return t}var wf=class extends vf{constructor(t=null){super();if(this.scene=t,!t)return;let n=new ze(0);t.group.add(n),n.setPosition(new me(0,0,100)),this.redPlane=t.createPlane(Fe.RED),n.add(this.redPlane),n=new ze(0),t.group.add(n),n.setPosition(new me(0,0,104)),this.greenPlane=t.createPlane(Fe.GREEN),n.add(this.greenPlane),n=new ze(0),t.group.add(n),n.setPosition(new me(0,0,108)),this.bluePlane=t.createPlane(Fe.BLUE),n.add(this.bluePlane)}display(){}drawLines(t,n,i=0){if(t instanceof re&&t.rx===t.ry){n.createArc(t.center,t.rx,i,t.startAngle,t.sweepAngle);return}let s=t.points(1),o=s[0];for(let a=1;a<s.length;a++){let l=s[a];o.equals1(l)||n.createLine(o,l,i),o=l}}onPolylineGroup(t,n){if(!!this.scene)for(let i of t.items)i.primitives.forEach(s=>this.drawLines(s,this.bluePlane))}onRTreeBBox(t){if(!!this.scene)for(let n of Ce.build4([t.LL(),t.UL(),t.UR(),t.LR(),t.LL()]).primitives);}onSegment(t,n,i,s,o,a){this.scene}onIntersect(t,n,i){this.scene}onResultSide(t){!this.scene||t.chain.status===0&&this.drawLines(t.shape,this.greenPlane)}onOriginSide(t){!this.scene||(this.drawLines(t.shape,this.redPlane),this.redPlane.createCircle(t.end,.1))}onScan(t,n,i,s,o,a){if(!this.scene)return}onSplitedSide(t){this.scene}onDebugSide(t){!this.scene||(this.drawLines(t.shape,this.bluePlane),this.bluePlane.createCircle(t.end,.1))}onSweep(t,n,i,s,o,a){if(!this.scene)return;let l=_n.format("SW (%d,%d,%d) : (%d,%d,%d) : %s : %s",i.polyGrp,i.polyIndex,n,a.polyGrp,a.polyIndex,o,t,s)}};var Ef=class extends wf{constructor(t=null){super(t);this.plGrps=new Array}onPolylineGroup(t,n){super.onPolylineGroup(t,n),this.plGrps.push(t)}};function p0(r,e=null){let t=!1,n=[];if(r.forEach((i,s)=>{let o=su(i);o.forEach(a=>n.push(a)),(s===0?o.length!==1:o.length>1&&!t)&&(t=!0)}),n.length===0)return new lt([]);if(t||n[0].area(.1)>0)return zu(n,e);for(let i=1;i<n.length;i++)if(n[i].area(.1)<0)return zu(n,e);return new lt([new Zt(n)])}function zu(r,e=null){let t=new Ef(e),n=new yf(u_,new In(1),t);r.forEach(s=>n.addPolyline(s)),n.simplify();let i=[];return t.plGrps.map(s=>{let o=[si(s.items[0])];if(!!o[0]){for(let a=1;a<s.items.length;a++){let l=si(s.items[a]);l&&o.push(l)}i.push(new Zt(o))}}),new lt(i)}var _f=new Yr(1,10).ratio,JY=63;async function Pf(r,e,t,n=[]){let i=new Kd,s={},o=[["DOCTYPE","PREVIEW","1.0",...n]],a=[],l=[],u=[],c={},h=0,f=0,d=0,m=[],p=0,g={},b={},v={scale:.1,scaleMatrix:qe.scale(.1)},w=0;await tf({onStart:()=>{},onLayerConfig:(B,I,C,N)=>{let A=N.toString(),M=["LAYER",B,I,C,1,A,1,A,1];switch(s[B]={config:i.buildLayerConfig(B,I,C,N),line:M},o.push(M),I){case"OUTLINE":d=B;break;case"TOP_ASSEMBLY":h=B;break;case"BOT_ASSEMBLY":f=B;break}},onLayerPhys:(B,I,C)=>{s[B].config.material=I,s[B].config.thickness=C*v.scale,o.push(["LAYER_PHYS",B,I,C*v.scale,0,0])},onPanelize:()=>{},onSilkOpts:()=>{},onItemOrder:()=>{},onPolys:()=>{},onPolygonCfg:(B,I)=>{I.thickness&&(p=I.thickness*v.scale)},onPrimitive:(B,I,C,N,A)=>{let M=s[B].config.typeConfig.type;M.startsWith("MULTI")?o.push(["POLY",`e${w++}`,0,"",B,N*v.scale,Ks(Ce.build2([C.multiply3(v.scaleMatrix)])),0]):M==="OUTLINE"?u.push(lt.buildByStroke(C,N,ts.ROUND)):M==="DETECT_OUTLINE"?l.push(lt.buildByStroke(C,N,ts.ROUND)):M==="TOP"||M==="BOTTOM"||M==="TOP_SILK"||M==="BOT_SILK"?o.push(["POLY",`e${w++}`,0,"",B,N*v.scale,Ks(Ce.build2([C.multiply3(v.scaleMatrix)])),0]):M==="SIGNAL"&&(M in b||(b[M]=new Oe),b[M].ext1(C.bbox().extendOfSize(N)))},onCircle:(B,I,C,N,A)=>{let M=s[B].config.typeConfig.type;if(M.startsWith("MULTI"))if(C=C.multiply3(v.scaleMatrix),N*=v.scale,m.length<1)o.push(["FILL",`e${w++}`,0,"",B,0,0,[["CIRCLE",C.x,C.y,N]]]),m.push([C,N]);else{for(let S of m)if(S[1]===N&&C.distance2(S[0])<.04)return;o.push(["FILL",`e${w++}`,0,"",B,0,0,[["CIRCLE",C.x,C.y,N]]]),m.push([C,N])}else M==="OUTLINE"?u.push(lt.buildCircle(C,N)):M==="DETECT_OUTLINE"?l.push(lt.buildCircle(C,N)):M==="TOP_STIFFENER"||M==="BOTTOM_STIFFENER"?(C=C.multiply3(v.scaleMatrix),N*=v.scale,o.push(["FPC_FILL",`e${w++}`,0,"",B,p,0,[["CIRCLE",C.x,C.y,N]]])):M==="TOP"||M==="BOTTOM"||M==="TOP_SILK"||M==="BOT_SILK"?(C=C.multiply3(v.scaleMatrix),N*=v.scale,o.push(["FILL",`e${w++}`,0,"",B,0,0,[["CIRCLE",C.x,C.y,N]]])):M==="SIGNAL"&&(M in b||(b[M]=new Oe),b[M].ext1(lt.buildCircle(C,N).bbox()))},onRect:(B,I,C,N)=>{let A=s[B].config.typeConfig.type;A.startsWith("MULTI")?(C=C.multiply3(v.scaleMatrix),o.push(["FILL",`e${w++}`,0,"",B,0,0,[["R",C.leftUpPoint.x,C.leftUpPoint.y,C.width,C.height,C.angle,C.isCCW,C.radiusRatio]]])):A==="OUTLINE"?u.push(lt.buildRect(C)):A==="DETECT_OUTLINE"?l.push(lt.buildRect(C)):A==="TOP"||A==="BOTTOM"||A==="TOP_SILK"||A==="BOT_SILK"?(C=C.multiply3(v.scaleMatrix),o.push(["FILL",`e${w++}`,0,"",B,0,0,[["R",C.leftUpPoint.x,C.leftUpPoint.y,C.width,C.height,C.angle,C.isCCW,C.radiusRatio]]])):A==="SIGNAL"&&(A in b||(b[A]=new Oe),b[A].ext1(C.bbox()))},onPolygon:(B,I,C,N)=>{let A=s[B].config.typeConfig.type;if(A.startsWith("MULTI")){C=C.map(S=>S.multiply3(v.scaleMatrix));let M=C[0].bbox();M.area()>.01&&M.width()>.01&&M.height()>.01&&o.push(["FILL",`e${w++}`,0,"",B,0,0,C.map(S=>Ks(S))])}else A==="OUTLINE"?u.push(p0(C)):A==="DETECT_OUTLINE"?l.push(p0(C)):A==="TOP_STIFFENER"||A==="BOTTOM_STIFFENER"?(C=C.map(M=>M.multiply3(v.scaleMatrix)),zu(C).items.forEach(M=>o.push(["FPC_FILL",`e${w++}`,0,"",B,p,0,M.items.map(S=>Ks(S))]))):A==="TOP"||A==="BOTTOM"||A==="TOP_SILK"||A==="BOT_SILK"?(C=C.map(M=>M.multiply3(v.scaleMatrix)),zu(C).items.forEach(M=>{o.push(["FILL",`e${w++}`,0,"",B,0,0,M.items.map(S=>Ks(S))])})):A==="SIGNAL"&&(A in b||(b[A]=new Oe),C.forEach(M=>b[A].ext1(M.bbox())))},onTexture:()=>{},onShellOutline:()=>{},onCrease:()=>{},onShellEntity:()=>{},onBoss:()=>{},onConnect:()=>{},onEnd:()=>{},onPrintMethod:()=>{},onModel:(B,I,C,N)=>{let{scale:A,scaleMatrix:M}=v;C.setPosition(C.getPosition().scale(A)),N.x&&(N.x*=A),N.y&&(N.y*=A),N.z&&(N.z*=A),N.dx&&(N.dx*=A),N.dy&&(N.dy*=A),N.dz&&(N.dz*=A),N.uuid?a.push(e.getModelWithSource(N.uuid).then(async({model:S,source:$})=>{let H=C.getPosition(),K=C.getRotation(),F=d_(S.model,S.modelStatus!==0,N,M);if($.buffer){let z=new TextDecoder("ascii").decode($.buffer.slice(0,10));if(/^\s*iso-/im.test(z)){let L=N.uuid;c[L]||(c[L]=!0,await t(`${L}.step`,$.buffer))}}o.push(["COMPONENT",B,0,I?h:f,H.x,H.y,K.z/Math.PI*180,F,0]),g[B]=$.modelStatus!==2?$.modelStatus:S.modelStatus===0?5:S.modelStatus},console.warn)):N.Code&&N.Code!=="C00000"?a.push(e.getModelGnrByCode(N.Code).then(async S=>{delete N.Code,delete N.UniqueID,N.uuid=S.uuid,N.x=S.x,N.y=S.y,N.z=S.z,N.rx=S.rx,N.ry=S.ry,N.rz=S.rz,typeof S.dx=="number"&&(N.dx=S.dx),typeof S.dy=="number"&&(N.dy=S.dy),typeof S.dz=="number"&&(N.dz=S.dz),typeof S.scale=="number"&&(N.scale=S.scale),e.getModelWithSource(N.uuid).then(async({model:$,source:H})=>{let K=C.getPosition(),F=C.getRotation(),z=d_($.model,$.modelStatus!==0,N,M);if(H.buffer){let L=new TextDecoder("ascii").decode(H.buffer.slice(0,10));if(/^\s*iso-/im.test(L)){let k=N.uuid;c[k]||(c[k]=!0,await t(`${k}.step`,H.buffer))}}o.push(["COMPONENT",B,0,I?h:f,K.x,K.y,F.z/Math.PI*180,z,0]),g[B]=H.modelStatus!==2?H.modelStatus:$.modelStatus===0?5:$.modelStatus},console.warn)},console.warn)):g[B]=1}},r,1,v),_();let P=new Oe;return u.forEach(B=>P.ext1(B.bbox())),l.forEach(B=>P.ext1(B.bbox())),P.valid()&&(await qE(l.length?l:u,[],P.build(),new Li,void 0,l.length!==0)).items.forEach(I=>{Math.abs(I.items[0].area(_f))<=_f||o.push(["FILL",`e${w++}`,0,"",d,0,0,I.items.filter(C=>Math.abs(C.area(_f))>_f**2).map(C=>Ks(C.multiply3(v.scaleMatrix)))])}),await Promise.all(a),await t("pcb.json",o.map(B=>JSON.stringify(B)).join(`
`)),g;function _(){let B=Object.values(s).filter(z=>z.config.typeConfig.type==="SUBSTRATE").sort((z,L)=>z.config.buildOrder-L.config.buildOrder).map(z=>({id:z.config.id,thickness:z.config.thickness})),I=Object.values(s).filter(z=>{let L=z.config.typeConfig.type==="SIGNAL",k=b[z.config.typeConfig.type],O=k&&k.build().area()>1;return L&&O}).sort((z,L)=>z.config.buildOrder-L.config.buildOrder).slice(0,B.length-1),C=Object.values(s).filter(z=>{let L=z.config.typeConfig.type==="SIGNAL",k=b[z.config.typeConfig.type],O=k&&k.build().area()>1;return L&&O}).sort((z,L)=>z.config.buildOrder-L.config.buildOrder).length,N=JY/(C+1);for(let z of B)z.thickness===0&&(z.thickness=N);try{for(let z=B.length+1;z<C+2;z++)B.push({id:z,thickness:N});I.forEach((z,L)=>{let k=z.config.thickness;B[L].thickness+=k,B[L+1].thickness+=k})}catch(z){console.error("error222222",z)}let A=B[0],M=B[B.length-1],S,$;for(let z of Object.values(s).map(L=>L.config)){let L=z.typeConfig.type;if(L==="TOP"||L.startsWith("TOP_")){if(L==="TOP_STIFFENER")continue;L==="TOP"&&(S=z.id),A.thickness+=z.thickness}else if(L==="BOTTOM"||L.startsWith("BOT_")){if(L==="BOTTOM_STIFFENER")continue;L==="BOTTOM"&&($=z.id),M.thickness+=z.thickness}}let H=0,K=[H];for(let z=B.length-1;z>=0;z--)H+=B[z].thickness,K.push(H);let F=[$,...I.map(z=>z.config.id).reverse(),S].map(z=>`${z}`);Object.values(s).filter(z=>z.config.typeConfig.type.startsWith(`${"MULTI"}-`)).forEach(z=>{let L=z.config.typeConfig.type.split("-"),k=F.indexOf(L[1]),O=F.indexOf(L[2]),ie=Math.max(k,O),W=Math.min(k,O);z.line[2]=`${"MULTI"}-${K[W]}-${K[ie]}`,z.line[9]=K[W],z.line[10]=K[ie]-K[W]})}}function d_(r,e,t,n){var s;let i=e&&t.outline?Qe.scale(1,1,t.dz).data:Uu(r,t,!e).getMatrix().data;return{"3D Model":t.uuid,Footprint:t.Footprint,Designator:t.Designator,Device:t.Device,"3D Model Transform":[i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14]].join(","),outline:(s=t.outline)==null?void 0:s.map(o=>o.map(a=>Ks(a.multiply3(n))))}}var g0=Yi(g_());async function uX(r){let e=new g0.Occapi;return await e.init(),e.stp2Obj(r)}async function x_(r,e){let t=await O2(r),n="";try{let i=await DE(t);i.status===200&&(n=await i.text())}catch(i){console.error(i)}if(n)return Ja("None",n,e);{if(!/^\s*iso-/im.test(r.slice(0,10)))return;let i=await uX(r);try{await GE(t,i)}catch(s){console.error(s)}return Ja("None",i,e)}}async function b_(r,e,t,n){let i=new g0.Occapi(t);await i.init();let s,o=await Pf(r,e,async(a,l)=>{s=i.RECVAndGENStepModel(a,l)},n);return[s,o]}function GNe(r){let e=`
proc traversalWriteStep {shape_list shell} {
	set num 1
	foreach i $shape_list {
		global $i
		XNewDoc D
		XAddShape D $i
		XUpdateAssemblies D
		if {$shell == "top"} {
			WriteStep D topShell_$num.step a
		} else {
			WriteStep D botShell_$num.step a
		}
		unset D
		set num [expr $num +1]
	}
}
if {[info exist shell-top-union]} {
	set top_shape_list [explode shell-top-union]
	traversalWriteStep $top_shape_list top
}
if {[info exist shell-bot-union]} {
	set bot_shape_list [explode shell-bot-union]
	traversalWriteStep $bot_shape_list bottom
}
dall`;return`pload MODELING XDE OCAF
bfuzzyvalue 1e-3
`+r+e}function FNe(r){let e=`
proc traversalWriteStl {shape_list shell} {
	set num 1
	while {[llength $shape_list] > 0} {
		puts $num
		set shape1 [lindex $shape_list 0]
		global $shape1
		tcopy $shape1 exportShape
		set shape_list [lreplace $shape_list 0 0]

		for {set i 0} {$i < [llength $shape_list]} {incr i} {
			set shape2 [lindex $shape_list $i]
			global $shape2
			incmesh $shape1 0.1
			incmesh $shape2 0.1
			if {[LCProximity $shape1 $shape2]} {
				compound $shape2 $exportShape $exportShape
				set shape_list [lreplace $shape_list $i $i]
			}
		}
		incmesh $exportShape 0.01
		if {$shell == "top"} {
			set filename topShell_$num.stl
		} else {
			set filename botShell_$num.stl
		}
		writestl $exportShape $filename 0
		incr num
	}
}
if {[info exist shell-top-union]} {
	set top_shape_list [explode shell-top-union]
	traversalWriteStl $top_shape_list top
}
if {[info exist shell-bot-union]} {
	set bot_shape_list [explode shell-bot-union]
	traversalWriteStl $bot_shape_list bottom
}
dall`;return`pload MODELING XDE OCAF JLC
bfuzzyvalue 1e-3
`+r+e}function qNe(r){let e=`
if {[info exist shell-top-union]} {
	LCWriteObj shell-top-union topShell 1
}
if {[info exist shell-bot-union]} {
	LCWriteObj shell-bot-union botShell 1
}
dall`;return`pload MODELING XDE OCAF JLC
bfuzzyvalue 1e-3
`+r+e}function zNe(r,e,t){typeof t>"u"||t.byteLength>0&&r.file(e,t)}var cX=pr.funcCopy(En),HNe=pr.funcCopy(En),Yu=100,ZNe=[Math.PI/2,Math.PI*3/2],KNe=[0,Math.PI],QNe=[0,Math.PI/2,Math.PI,Math.PI*3/2],hX=(n=>(n[n.NoFlip=0]="NoFlip",n[n.FlipX=1]="FlipX",n[n.FlipY=2]="FlipY",n))(hX||{}),Sf=class{constructor(e){this._bbox=e}bbox(){return this._bbox}};function v_(r,e,t,n){console.time("alignModel");let i=new Hn(10),s=new Hn(10);for(let u=0;u<r.length;u+=4)i.add(new Sf(new ye(r[u],r[u+1],r[u+2],r[u+3])));for(let u=0;u<e.length;u+=4)s.add(new Sf(new ye(e[u],e[u+1],e[u+2],e[u+3])));let o=[],a=[];for(let u of Object.values(t))if(u.padCenters){let c=[];for(let h=0;h<u.padCenters.length;h+=2)c.push(new q(u.padCenters[h],u.padCenters[h+1]));u.padCenters=c,o.push(u)}for(let u of Object.values(n))if(u.padCenters){let c=[];for(let h=0;h<u.padCenters.length;h+=2)c.push(new q(u.padCenters[h],u.padCenters[h+1]));u.padCenters=c,a.push(u)}let l;if(i.itemList.length!==0&&o.length!==0&&(l=y_(i,o),x0(o,t,l),b0(i,o,l.matchedIndexs,l.usedPads,!0)),s.itemList.length!==0&&a.length!==0){let{matchedIndexs:u,usedPads:c}=dX(s,a,l);if(u.length>=Yu||u.length===a.length)x0(a,n,l),b0(s,a,u,c,!1);else{let h=y_(s,a);x0(a,n,h),b0(s,a,h.matchedIndexs,h.usedPads,!1)}}return o.forEach(u=>{delete u.padCenters,delete u.width,delete u.height}),a.forEach(u=>{delete u.padCenters,delete u.width,delete u.height}),console.timeEnd("alignModel"),Object.assign(t,n)}function dX(r,e,t){let n=[],i=[];if(!t)return{matchedIndexs:n,usedPads:i};let{flip:s,offset:o}=t,a=s===0?()=>o:s===1?(l,u)=>new q(-l*2+o.x,o.y):(l,u)=>new q(o.x,-u*2+o.y);return e.forEach(({padCenters:l,x:u,y:c},h)=>{let f=a(u,c),d=!0,m=[];for(let p of l)if(m.length===m.push(...r.search(p.add(f).bbox()))){d=!1;break}d&&(n.push(h),i.push(...m))}),{matchedIndexs:n,usedPads:i}}function x0(r,e,t){let{flip:n,offset:i}=t;n===0?(r.forEach(({padCenters:s})=>{s.forEach((o,a)=>s[a]=o.add(i))}),Object.values(e).forEach(s=>{s.x+=i.x,s.y+=i.y})):n===1?(r.forEach(({x:s,padCenters:o})=>{o.forEach((a,l)=>o[l]=a.add1(-s*2+i.x,i.y))}),Object.values(e).forEach(s=>{s.x=-s.x+i.x,s.y+=i.y})):(r.forEach(({y:s,padCenters:o})=>{o.forEach((a,l)=>o[l]=a.add1(i.x,-s*2+i.y))}),Object.values(e).forEach(s=>{s.x+=i.x,s.y=-s.y+i.y}))}function b0(r,e,t,n,i){t.reverse();let s=t.pop();e.forEach((o,a)=>{if(a===s){s=t.pop();return}if(o.tht==="THT")return;let{x:l,y:u,width:c,height:h,padCenters:f}=o;if(r.search(new ye(l-c*2,l+c*2,u-h*2,u+h*2)).filter(w=>!w.isUsed).length===0)return;let m=new q(o.x,o.y),p=-(2**31),g=[],b={},v=[0,Math.PI/2,Math.PI,Math.PI*3/2];for(let w of v){let P=0,_=qe.rotate(w).setOrigin(o.x,o.y),B=[],I=new Oe;for(let C of f){let N=C.multiply3(_).bbox().extendOfSize(.1);I.ext1(N);let A=r.search(N);if(A.length<=0)break;P+=1,B.push(...A)}if(B.length===f.length&&B.length===P){g=B;let C=new Oe;for(let S of g)C.ext1(S.bbox());let N=C.build().intersection1(I.build());if(!N)continue;let A=C.build().center().sub(m),M=N.area();M>=p&&(p=M,b.offsetX=A.x,b.offsetY=A.y,b.rot=i?w:-w,g.forEach(S=>{o.tht!=="THT"&&(S.isUsed=!0)}))}}Object.keys(b).length>0&&(o.x+=b.offsetX,o.y+=b.offsetY,o.rot+=b.rot)})}function y_(r,e){let t=e.map(u=>u.padCenters),n=[],i=[];if(t.forEach((u,c)=>{let h=!0,f=[];for(let d of u)if(f.length===f.push(...r.search(d.bbox()))){h=!1;break}h&&(n.push(c),f.forEach(d=>d.isUsed=!0),i.push(...f))}),n.length>=Yu||n.length===e.length)return{flip:0,offset:q.ORIGIN,matchedIndexs:n,usedPads:i};cX(e,(u,c)=>c.padCenters.length-u.padCenters.length,0,e.length);let s=y0(r,e.map(u=>u.padCenters));if(s.matchedIndexs.length>=Yu||s.matchedIndexs.length===e.length)return Object.assign(s,{flip:0});let o=y0(r,e.map(u=>{let{x:c}=u;return u.padCenters.map(h=>h.add1(-c*2,0))}));if(o.matchedIndexs.length>=Yu||o.matchedIndexs.length===e.length)return Object.assign(o,{flip:1});let a=y0(r,e.map(u=>{let{y:c}=u;return u.padCenters.map(h=>h.add1(0,-c*2))})),l=Math.max(s.matchedIndexs.length,o.matchedIndexs.length,a.matchedIndexs.length);return l===s.matchedIndexs.length?Object.assign(s,{flip:0}):l===o.matchedIndexs.length?Object.assign(o,{flip:1}):Object.assign(a,{flip:2})}function fX(r,e,t,n){let i=new Set;i.add([new Set([e]),e.bbox()]);for(let l of t){let u=[];for(let c of i){let[h,f]=c,d=n.search(new ye(f.minX+l.x,f.maxX+l.x,f.minY+l.y,f.maxY+l.y)).filter(g=>!h.has(g)&&!g.isUsed);if(d.length===0){i.delete(c);continue}let m=d[0];h.add(m);let p=m.bbox();c[1]=new ye(Math.max(f.minX,p.minX-l.x),Math.min(f.maxX,p.maxX-l.x),Math.max(f.minY,p.minY-l.y),Math.min(f.maxY,p.maxY-l.y));for(let g=1;g<d.length;g++){let b=d[g],v=new Set(h);v.add(b);let w=b.bbox();u.push([v,new ye(Math.max(f.minX,w.minX-l.x),Math.min(f.maxX,w.maxX-l.x),Math.max(f.minY,w.minY-l.y),Math.min(f.maxY,w.maxY-l.y))])}}if(u.forEach(c=>i.add(c)),i.size===0)break}if(i.size===0)return null;let s=Number.NEGATIVE_INFINITY,o,a;for(let[l,u]of i)u.area()>s&&(s=u.area(),o=u,a=l);return{offset:o.center().sub(r),usedPads:Array.from(a)}}function y0(r,e){let t=new Map,n,i,s,o=0;for(;o<e.length;o++){let a=e[o];if(a.length<=1&&t.size!==0)break;let l=!0;for(let[h,{matchedIndexs:f,usedPads:d}]of t){let m=!0,p=[];for(let g of a)if(p.length===p.push(...r.search(g.add(h).bbox()))){m=!1;break}if(m&&(l=!1,f.push(o),d.push(...p),f.length>=Yu)){n=f,i=d,s=h;break}}if(n)break;if(!l)continue;let u=a[0],c=[];for(let h=1;h<a.length;h++)c.push(a[h].sub(u));for(let h of r.itemList){let f=fX(u,h,c,r);f&&t.set(f.offset,{matchedIndexs:[o],usedPads:f.usedPads})}}if(!n){n=[],s=q.ORIGIN;for(let[a,{matchedIndexs:l,usedPads:u}]of t)l.length>n.length&&(n=l,i=u,s=a)}for(o++;o<e.length;o++){let a=e[o],l=!0,u=[];for(let c of a)if(u.length===u.push(...r.search(c.add(s).bbox()))){l=!1;break}l&&(n.push(o),i.push(...u))}return{offset:s,matchedIndexs:n,usedPads:i}}var Tn=!0;function N4(r){let e=[];o(r);let t=e.length/3,n=new ArrayBuffer(84+t*50),i=new DataView(n);i.setUint32(80,t,Tn);let s=84;for(let a=0;a<e.length;a+=3){let l=e[a],u=e[a+1],c=e[a+2],h=me.normal(l,u,c).normalize();i.setFloat32(s,h.x,Tn),i.setFloat32(s+4,h.y,Tn),i.setFloat32(s+8,h.z,Tn),i.setFloat32(s+12,l.x,Tn),i.setFloat32(s+16,l.y,Tn),i.setFloat32(s+20,l.z,Tn),i.setFloat32(s+24,u.x,Tn),i.setFloat32(s+28,u.y,Tn),i.setFloat32(s+32,u.z,Tn),i.setFloat32(s+36,c.x,Tn),i.setFloat32(s+40,c.y,Tn),i.setFloat32(s+44,c.z,Tn),s+=50}return new Blob([i.buffer],{type:"data/bin"});function o(a,l=Qe.ORIGIN){let u=a.getMatrix().multiply4(l);for(let c of a.getContents())if(c instanceof ze)o(c,u);else if(c instanceof vt){let h=c.elements;if(!(h instanceof gr))continue;h.iterVertexes(f=>e.push(f.multiply4(u)))}}}var Zn=Yi(I4()),L4=Yi(M4()),Ap=Yi(w0()),Ac=.01*new Yr(39.37,1).ratio,J1=(n=>(n[n.jscad=0]="jscad",n[n.drawexe=1]="drawexe",n[n.occshell=2]="occshell",n))(J1||{}),Tp=class{constructor(e){this.geoms={};this.drawCmds=[];this.debugCodes=[];this.shapes={};this.errList=[];this.cadEngine=e,Gn().OC&&(this.oc=Gn().OC)}deleteShape(e){try{this.shapes[e].delete(),delete this.shapes[e]}catch{console.error("repeat delete error:",e)}}clear(){switch(this.cadEngine){case 0:Object.keys(this.geoms).forEach(e=>delete this.geoms[e]),this.debugCodes.length=0;break;case 1:this.drawCmds.length=0;break;case 2:Object.keys(this.shapes).forEach(e=>{this.deleteShape(e)});break}}getTriangles(e){switch(this.cadEngine){case 0:return R4(this.geoms[e]);case 2:console.log("gnr triangel:",e);let t=new Array,n=new Array,i=this.oc.getTriangleData(this.shapes[e],.4,.4),s=i.vertexs(),o=i.normals(),a=i.indices();for(let l of a){let u=3*l;t.push(new me(s[u],s[u+1],s[u+2])),n.push(new me(o[u],o[u+1],o[u+2]))}return new gr(t,n)}}getStepByid(e){return this.getStepByShape(this.shapes[e])}getStepByShape(e){return new this.oc.importStep(e)}testDownloadStep(e){let t=new this.oc.importStep(e);console.log(new TextDecoder().decode(t))}async downloadStep(e=""){let t=new Ap.default,n=this.shapes["shell-top-union"],i=[];if(n){let a=new this.oc.TopoDS_Iterator_2(n,!0,!0);for(;a.More();)i.push(a.Value()),a.Next();if(i.length<=1){let l=this.getStepByShape(n);t.file(`3DShell_${e}_T.step`,new TextDecoder().decode(l))}else for(let l=0;l<i.length;l++){let u=this.getStepByShape(i[l]);t.file(`3DShell_${e}_T_${l+1}.step`,new TextDecoder().decode(u))}}let s=this.shapes["shell-bot-union"],o=[];if(s){let a=new this.oc.TopoDS_Iterator_2(s,!0,!0);for(;a.More();)o.push(a.Value()),a.Next();if(o.length<=1){let l=this.getStepByShape(s);t.file(`3DShell_${e}_B.step`,new TextDecoder().decode(l))}else for(let l=0;l<o.length;l++){let u=this.getStepByShape(o[l]);t.file(`3DShell_${e}_B_${l+1}.step`,new TextDecoder().decode(u))}}return await t.generateAsync({type:"blob"})}getStlByShape(e,t){let n=new TextDecoder;return new this.oc.importStl(e,t)}getObjByShape(e,t){let n=new TextDecoder;return new this.oc.importObj(e,t)}async downloadStl(e=""){let t=new Ap.default,n=[],i=this.shapes["shell-top-union"];if(i){let a=new this.oc.TopoDS_Iterator_2(i,!0,!0);for(;a.More();)n.push(a.Value()),a.Next();if(n.length<=1){let l=this.getStlByShape(i,.01);t.file(`3DShell_${e}_T.stl`,new TextDecoder().decode(l))}else{let l=1;for(let u=0;u<n.length;u++){let c=n.slice(u+1,n.length),h=new this.oc.BRep_Builder,f=new this.oc.TopoDS_Compound;h.MakeCompound(f),h.Add(f,n[u]);for(let m=0;m<c.length;m++)this.oc.shapeProximity(n[u],c[m])&&(h.Add(h,c[m]),n.splice(u+m,1),u--);let d=this.getStlByShape(f,.01);d.byteLength>0&&(t.file(`3DShell_${e}_T_${l}.stl`,new TextDecoder().decode(d)),l++)}}}let s=[],o=this.shapes["shell-bot-union"];if(o){let a=new this.oc.TopoDS_Iterator_2(o,!0,!0);for(;a.More();)s.push(a.Value()),a.Next();if(s.length<=1){let l=this.getStlByShape(o,.01);t.file(`3DShell_${e}_B.stl`,new TextDecoder().decode(l))}else{let l=1;for(let u=0;u<s.length;u++){let c=s.slice(u+1,s.length),h=new this.oc.BRep_Builder,f=new this.oc.TopoDS_Compound;h.MakeCompound(f),h.Add(f,s[u]);for(let m=0;m<c.length;m++)this.oc.shapeProximity(s[u],c[m])&&(h.Add(h,c[m]),s.splice(u+m,1),u--);let d=this.getStlByShape(f,.01);d.byteLength>0&&(t.file(`3DShell_${e}_B_${l}.stl`,new TextDecoder().decode(d)),l++)}}}return await t.generateAsync({type:"blob"})}async downloadObj(e=""){let t=new Ap.default,n=[],i=this.shapes["shell-top-union"];if(i){let a=new this.oc.TopoDS_Iterator_2(i,!0,!0);for(;a.More();)n.push(a.Value()),a.Next();if(n.length<=1){let l=this.getObjByShape(i,.01);t.file(`3DShell_${e}_T.obj`,new TextDecoder().decode(l))}else{let l=1;for(let u=0;u<n.length;u++){let c=n.slice(u+1,n.length),h=new this.oc.BRep_Builder,f=new this.oc.TopoDS_Compound;h.MakeCompound(f),h.Add(f,n[u]);for(let m=0;m<c.length;m++)this.oc.shapeProximity(n[u],c[m])&&(h.Add(h,c[m]),n.splice(u+m,1),u--);let d=this.getObjByShape(f,.01);d.byteLength>0&&(t.file(`3DShell_${e}_T_${l}.obj`,new TextDecoder().decode(d)),l++)}}}let s=[],o=this.shapes["shell-bot-union"];if(o){let a=new this.oc.TopoDS_Iterator_2(o,!0,!0);for(;a.More();)s.push(a.Value()),a.Next();if(s.length<=1){let l=this.getObjByShape(o,.01);t.file(`3DShell_${e}_B.obj`,new TextDecoder().decode(l))}else{let l=1;for(let u=0;u<s.length;u++){let c=s.slice(u+1,s.length),h=new this.oc.BRep_Builder,f=new this.oc.TopoDS_Compound;h.MakeCompound(f),h.Add(f,s[u]);for(let m=0;m<c.length;m++)this.oc.shapeProximity(s[u],c[m])&&(h.Add(h,c[m]),s.splice(u+m,1),u--);let d=this.getObjByShape(f,.01);d.byteLength>0&&(t.file(`3DShell_${e}_B_${l}.obj`,new TextDecoder().decode(d)),l++)}}}return await t.generateAsync({type:"blob"})}shapeRepair(e,t,n,i){let s=new this.oc.ShapeFix_Shape_1;s.Init(e),s.SetPrecision(t),s.SetMinTolerance(n),s.SetMaxTolerance(i),s.Perform(new this.oc.Message_ProgressRange_1);let o=s.Shape();return s.delete(),o}cylinder(e,t,n){switch(this.cadEngine){case 0:this.geoms[e]=Zn.primitives.cylinder({height:n,radius:t,center:[0,0,n/2],segments:t*(1-Math.SQRT1_2)>Ac?Math.ceil(Math.abs(Math.PI/Math.acos((t-Ac)/t))):4}),this.debugCodes.push(`let ${e} = primitives.cylinder({
					height,
					radius,
					center: [0, 0, height / 2],
					segments: radius > RESOLUTION ? Math.ceil(Math.abs(Math.PI / Math.acos((radius - RESOLUTION) / radius))) : 3,
				});`);break;case 1:this.drawCmds.push(["pcylinder",e,t,n]);break;case 2:console.log(`Cylinder radius(${t} height(${n}))`,e),this.shapes[e]=new this.oc.BRepPrimAPI_MakeCylinder_1(t,n).Shape();break}}makeEdge(e,t){let n=new this.oc.gp_Pnt_3(e.x,e.y,0),i=new this.oc.gp_Pnt_3(t.x,t.y,0),s=new this.oc.BRepBuilderAPI_MakeEdge_3(n,i),o=s.Edge();return n.delete(),i.delete(),s.delete(),o}makeArc(e,t,n,i,s){let o=new this.oc.gp_Pnt_3(e.x,e.y,0),a=new this.oc.gp_Pnt_3(t.x,t.y,0),l=new this.oc.gp_Pnt_3(n.x,n.y,0),u=new this.oc.gp_Dir_4(0,0,-1),c=new this.oc.gp_Ax2_3(l,u),h=new this.oc.gp_Circ_2(c,i),f;if(s>0){let d=e;e=t,t=d}try{let d=new this.oc.GC_MakeArcOfCircle_3(h,o,a,s>0);if(!d.IsDone())return d.delete(),!1;let m=new this.oc.Handle_Geom_Curve_2(d.Value().get());f=new this.oc.BRepBuilderAPI_MakeEdge_24(m).Edge(),m.delete()}catch(d){return console.error(d),!1}finally{o.delete(),a.delete(),l.delete(),u.delete(),c.delete(),h.delete()}return f}shapeIsValid(e){let t=new this.oc.BRepCheck_Analyzer(e,!0,!1),n=t.IsValid_2();return t.delete(),n}polygonCylinder(e,t,n){switch(t=t.asClose(),this.cadEngine){case 0:t.area(1)<0&&(t=t.reverse());let i=[],s=null;t.points1(Ac,f=>{s&&s.equals1(f)||(i.push(f.x,f.y),s=f)}),this.geoms[e]=qse(i,n),this.debugCodes.push(`let ${e} = csgExtrude(${JSON.stringify(i)}, ${n});`);break;case 1:let o=["profile",e],a=t.primitives[0].start();o.push("F",a.x,a.y);for(let f of t.primitives){let d=f.start();if(a.equals1(d)||(o.push("tt",d.x,d.y),a=d),f instanceof re&&f.rx===f.ry)o.push("rr",f.startAngle+90),o.push("c",f.rx,f.sweepAngle);else{let m=f.points(Ac);for(let p=1;p<m.length;p++){let g=m[p];o.push("tt",g.x,g.y)}}a=f.end()}this.drawCmds.push(o,["fixsmalledges",e,e,.01,1],["prism",e,e,0,0,n]);break;case 2:console.log("polygonCylinder:",e,t,n);let l=new this.oc.BRepBuilderAPI_MakeWire_1,u=t.primitives[0].start();for(let f=0;f<t.primitives.length;f++){let d=t.primitives[f],m=d.end();if(u.distance2(m)<.01&&!(d instanceof re)){if(f===t.primitives.length-1&&!t.primitives[0].start().equals1(u)){let b=this.makeEdge(u,t.primitives[0].start());l.Add_1(b)}continue}let p=d instanceof re?d.points2():d.points(Ac),g=u;for(let b=1;b<p.length;b++){let v=this.makeEdge(g,p[b]);l.Add_1(v),g=p[b]}if(u=m,f===t.primitives.length-1&&!t.primitives[0].start().equals1(m)){let b=this.makeEdge(m,t.primitives[0].start());l.Add_1(b)}}let c;try{let f=l.Wire();c=new this.oc.BRepBuilderAPI_MakeFace_15(f,!1)}catch(f){console.warn("polygonCylinder wire error ",f);let d=this.shapeRepair(l.Wire(),1e-7,.01,.01),m=this.oc.TopoDS.Wire_1(d);c=new this.oc.BRepBuilderAPI_MakeFace_15(m,!1)}let h=new this.oc.BRepPrimAPI_MakePrism_1(c.Shape(),new this.oc.gp_Vec_4(0,0,n),!1,!0).Shape();if(!this.shapeIsValid(h)){let f=this.shapeRepair(l.Wire(),.01,.01,.01),d=this.oc.TopoDS.Wire_1(f);c=new this.oc.BRepBuilderAPI_MakeFace_15(d,!1);let m=new this.oc.BRepPrimAPI_MakePrism_1(c.Shape(),new this.oc.gp_Vec_4(0,0,n),!1,!0).Shape();if(!this.shapeIsValid(m))throw`${e} shape error`}this.shapes[e]=h;break}}translate(e,t,n,i){switch(this.cadEngine){case 0:this.geoms[e]=Zn.transforms.translate([t,n,i],this.geoms[e]),this.debugCodes.push(`${e} = transforms.translate(${JSON.stringify([t,n,i])}, ${e});`);break;case 1:this.drawCmds.push(["ttranslate",e,t,n,i]);break;case 2:console.log("translate:",e);let s=new this.oc.gp_Trsf_1;s.SetTranslation_1(new this.oc.gp_Vec_4(t,n,i));let o=new this.oc.BRepBuilderAPI_Transform_2(this.shapes[e],s,!1);this.shapes[e]=o.Shape();break}}rotate(e,t,n,i,s,o,a,l){switch(this.cadEngine){case 0:this.geoms[e]=Zn.transforms.transform(Qe.rotateAxis(new me(s,o,a),ut.toRadians(l)).setOrigin(t,n,i).data,this.geoms[e]),this.debugCodes.push(`${e} = transforms.transform(
					<any>Matrix4.rotateAxis(new Vector3(${s}, ${o}, ${a}), Angle.toRadians(${l})).setOrigin(${t}, ${n}, ${i}).data,
					${e},
				);`);break;case 1:this.drawCmds.push(["trotate",e,t,n,i,s,o,a,l]);break;case 2:console.log("rotate:",e);let u=new this.oc.gp_Ax1_2(new this.oc.gp_Pnt_3(t,n,i),new this.oc.gp_Dir_2(new this.oc.gp_Vec_4(s,o,a))),c=new this.oc.gp_Trsf_1;c.SetRotation_1(u,l*Math.PI/180);let h=new this.oc.BRepBuilderAPI_Transform_2(this.shapes[e],c,!1);this.shapes[e]=h.Shape();break}}scale(e,t,n,i){switch(this.cadEngine){case 0:this.geoms[e]=Zn.transforms.scale([t,n,i],this.geoms[e]),this.debugCodes.push(`${e} = transforms.scale(${JSON.stringify([t,n,i])}, ${e});`);break;case 1:this.drawCmds.push(["scalexyz",e,e,t,n,i]);break;case 2:console.log("scale:",e);let s=new this.oc.gp_Mat_2(t,0,0,0,n,0,0,0,i),o=new this.oc.gp_GTrsf_1;o.SetVectorialPart(s);let a=new this.oc.BRepBuilderAPI_GTransform_2(this.shapes[e],o,!1);this.shapes[e]=a.Shape();break}}occBuilder(e,t){let n=new this.oc.TopTools_ListOfShape_1;for(let a=0;a<t.length;a++)n.Append_1(this.shapes[t[a]]);let i=new this.oc.BOPAlgo_Builder_1;i.SetArguments(n),i.SetFuzzyValue(.001),i.SetCheckInverted(!1);let s=+new Date;i.Perform(new this.oc.Message_ProgressRange_1);let o=+new Date;this.shapes[e]=i.Shape(),console.log("Builder\u7528\u65F6: ",o-s)}occFuse(e,t){let n=new this.oc.TopTools_ListOfShape_1;for(let o=1;o<t.length;o++)n.Append_1(this.shapes[t[o]]);let i=new this.oc.TopTools_ListOfShape_1;i.Append_1(this.shapes[t[0]]);let s=new this.oc.BRepAlgoAPI_Fuse_1;if(s.SetArguments(i),s.SetTools(n),s.SetToFillHistory(!1),s.Build(new this.oc.Message_ProgressRange_1),s.HasErrors()||s.HasWarnings()){if(s.delete(),t.length<=2&&t[1]!="temp")throw console.warn("occFuse fail:",t),this.errList.push({id:t[1],type:1,message:"\u5E03\u5C14\u5408\u5E76\u8BA1\u7B97\u9519\u8BEF"}),new Error("occFuse fail");return!1}return s.SimplifyResult(!0,!0,1e-12),this.shapeIsValid(s.Shape())?(this.shapes[e]=s.Shape(),!0):!1}union(e,t){if(t.length===0)throw new Error("ids.length === 0");if(t.length===1){this.copy(t[0],e);return}switch(this.cadEngine){case 0:this.geoms[e]=Zn.booleans.union(t.map(i=>this.geoms[i])),this.debugCodes.push(`${e} = booleans.union(${JSON.stringify(t)});`);break;case 1:this.drawCmds.push(["bclearobjects"],["bcleartools"],["baddobjects",t[0]]);let n=["baddtools"];for(let i=1;i<t.length;i++)n.push(t[i]);this.drawCmds.push(n,["bfillds"],["bbop",e,1]);break;case 2:if(console.log("union:",e,t),t.length>2&&(t[0]==="shell-top-union"||t[0]==="shell-bot-union"||t[0]==="botUnionShellBoss"||t[0]==="topUnionShellBoss"||t[0].includes("Top")||t[0].includes("Bot"))){let i=t.shift();if(!this.occFuse("temp",t)){this.occSingleFuse(e,t),this.deleteShape("temp");return}if(!this.occFuse(e,[i,"temp"])){this.occSingleFuse(e,t),this.deleteShape("temp");return}}else this.occFuse(e,t)&&this.occSingleFuse(e,t);break}}occSingleFuse(e,t){for(let n=1;n<t.length;n++)if(!this.occFuse(t[0],[t[0],t[n]]))throw console.warn("occFuse fail:",t[0],t[n]),this.errList.push({id:t[0]+" "+t[1],type:1,message:"\u5E03\u5C14\u5408\u5E76\u8BA1\u7B97\u9519\u8BEF"}),new Error("occFuse fail");this.shapes[e]=this.shapes[t[0]]}union2(e,t){if(t.length===0)throw new Error("ids.length === 0");if(t.length===1){this.copy(t[0],e);return}if(this.useDrawexe){this.drawCmds.push(["bclearobjects"],["bcleartools"],["baddobjects",t[0]]);let n=["baddtools"];for(let i=1;i<t.length;i++)n.push(t[i]);this.drawCmds.push(n,["bfillds"],["bbuild",e])}else this.geoms[e]=Zn.booleans.union(t.map(n=>this.geoms[n])),this.debugCodes.push(`${e} = booleans.union(${JSON.stringify(t)});`)}occCut(e,t,n,i,s){if(i){for(let o=1;o<t.length;o++){let a=new this.oc.TopTools_ListOfShape_1;a.Append_1(this.shapes[t[o]]);let l=new this.oc.TopTools_ListOfShape_1;l.Append_1(this.shapes[t[0]]);let u=new this.oc.BRepAlgoAPI_Cut_1;if(u.SetArguments(l),u.SetTools(a),u.SetFuzzyValue(n),u.SetCheckInverted(s),u.SetToFillHistory(!1),u.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),u.SetUseOBB(!0),u.Build(new this.oc.Message_ProgressRange_1),u.SimplifyResult(!0,!0,1e-12),a.delete(),l.delete(),u.HasErrors()||u.HasWarnings())throw u.delete(),console.warn("occCutSingle fail:",n,t[0],t[o]),this.errList.push({id:t[o],type:1,message:"\u5E03\u5C14\u5207\u9664\u8BA1\u7B97\u9519\u8BEF"}),new Error("occCutSingle fail");this.shapes[t[0]]&&this.shapes[t[0]].delete(),this.shapes[t[0]]=u.Shape(),u.delete()}return this.shapes[e]=this.shapes[t[0]],!0}else{let o=new this.oc.TopTools_ListOfShape_1;for(let u=1;u<t.length;u++)o.Append_1(this.shapes[t[u]]);let a=new this.oc.TopTools_ListOfShape_1;a.Append_1(this.shapes[t[0]]);let l=new this.oc.BRepAlgoAPI_Cut_1;return l.SetArguments(a),l.SetTools(o),l.SetFuzzyValue(n),l.SetCheckInverted(s),l.SetToFillHistory(!1),l.Build(new this.oc.Message_ProgressRange_1),a.delete(),o.delete(),l.HasErrors()||l.HasWarnings()?(console.warn("occCutGroup fail:",n,t),l.delete(),!1):(this.shapes[e]=l.Shape(),l.delete(),!0)}}occCutRetry(e,t){return!this.occCut(e,t,.01,!1,!1)&&!this.occCut(e,t,.01,!1,!0)&&!this.occCut(e,t,.001,!1,!0)&&!this.occCut(e,t,1e-5,!1,!0)&&!this.occCut(e,t,1e-6,!1,!0)&&!this.occCut(e,t,1e-6,!0,!0)?(console.error("occCut failure of all",e,t),!1):(this.shapeIsValid(this.shapes[e])||this.occCut(e,t,1e-6,!0,!0),!0)}subtract(e,t){switch(this.cadEngine){case 0:this.geoms[e]=Zn.booleans.subtract(t.map(n=>this.geoms[n])),this.debugCodes.push(`${e} = booleans.subtract(${JSON.stringify(t)});`);break;case 1:if(t.length<3)this.drawCmds.push(["bcut",e,t[0],t[1]]);else{for(let n=1;n<t.length;n+=5){this.drawCmds.push(["bclearobjects"],["bcleartools"],["baddobjects",t[0]]);let i=["baddtools"];i.push(t[n],t[n+1],t[n+2],t[n+3],t[n+4]),this.drawCmds.push(i,["bfillds"],["bbop",t[0],2])}this.drawCmds.push(["tcopy",t[0],e])}break;case 2:if(console.log("subtract",e,t),t.length<10){if(!this.occCutRetry(e,t)){let n=[];for(let i=1;i<t.length;i++)n.push(t[i]),(i%5===0||i===t.length-1)&&(n.unshift(t[0]),this.occCutRetry(e,n),n=[])}}else{let n=[];for(let i=1;i<t.length;i++)n.push(t[i]),(i%10===0||i===t.length-1)&&(n.unshift(t[0]),this.occCutRetry(e,n),console.log("cut step complete"),n=[])}break}}intersect(e,t,n){switch(this.cadEngine){case 0:this.geoms[e]=Zn.booleans.intersect(this.geoms[t],this.geoms[n]),this.debugCodes.push(`${e} = booleans.intersect(${t},${n});`);break;case 1:this.drawCmds.push(["bcommon",e,t,n]);break;case 2:console.log("intersect:",e,t,n);let i=new this.oc.BRepAlgoAPI_Common_3(this.shapes[t],this.shapes[n],new this.oc.Message_ProgressRange_1);this.shapes[e]=i.Shape();break}}copy(e,t,...n){n.unshift(e,t);for(let i=1;i<n.length;i+=2){let s=n[i];switch(this.cadEngine){case 0:this.geoms[s]=this.geoms[n[i-1]],this.debugCodes.push(`let ${s} = ${n[i-1]};`);break;case 1:this.drawCmds.push(["tcopy",n[i-1],s]);break;case 2:console.log("copy:",s,t,n);let o=new this.oc.BRepBuilderAPI_Copy_1;o.Perform(this.shapes[n[i-1]],!0,!1),this.shapes[s]=o.Shape();break}}}};function qse(r,e){var t=L4.default(r);let n=[],i=[];for(let o=1;o<r.length;o+=2){let a=r[o-1],l=r[o];n.push([a,l,0],[a,l,e])}for(let o=0;o<t.length;o+=3)i.push([t[o]*2,t[o+2]*2,t[o+1]*2]);for(let o=0;o<t.length;o+=3)i.push([t[o]*2+1,t[o+1]*2+1,t[o+2]*2+1]);let s=r.length-2;for(let o=0;o<s;o+=2)i.push([o,o+3,o+1],[o+3,o,o+2]);return Zn.primitives.polyhedron({points:n,faces:i})}function R4(r){let e=r.polygons,t=new Array,n=new Array,i=new Qe(r.transforms),s=i.toMatrix3().toMatrix4();for(let o=0;o<e.length;o++){let a=new Array;for(let c=0;c<e[o].vertices.length;c++)a.push(new me(...e[o].vertices[c]).multiply4(i));a[0].equals(a[a.length-1])&&a.pop();let l=e[o].plane,u=l&&l.reduce((c,h)=>c+h,0)!==0&&new me(l[0],l[1],l[2]).multiply4(s).normalize();if(!u){for(let c=2;c<a.length;c++)try{u=me.normal(a[0],a[c-1],a[c]).normalize()}catch{}if(!u)continue}for(let c=2;c<a.length;c++)t.push(a[0],a[c-1],a[c]),n.push(u,u,u)}return new gr(t,n)}function H6e(r,e){let t=new ze;t.add(new vt(R4(r),Fe.BLACK)),pr.downloadFile(e,N4(t))}function Z6e(r){let e="";for(let t of r.primitives)t instanceof re?e+=`Arc start: ${t.start().x} ${t.start().y} end: ${t.end().x} ${t.end().y} r: ${t.rx} sweepAngle: ${t.sweepAngle} centerX: ${t.center.x}
`:e+=`Line start: ${t.start().x} ${t.start().y} end: ${t.end().x} ${t.end().y}
`;console.log(e)}function eb(r){let e=new Jr,t=new Jr,n=new Jr,i=[],s=[],o=0,a=0,l=0,u=null;return c(r),[i.join(`
`),s.join(`
`)];function c(m,p=Qe.ORIGIN){let g=m.getMatrix().multiply4(p),b=g.data.slice();b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1;let v=new Qe(b);for(let w of m.getContents())if(w instanceof ze)c(w,g);else if(w instanceof vt){let P=w.elements;if(!(P instanceof gr))return;if(w.getMaterial()){let B=d(w.getMaterial());B!==u&&(s.push(`usemtl ${B}`),u=B)}let _=[];if(P.hasNormals()){let B=[];P.iterVertexesNormals(I=>_.push(I.multiply4(g)),I=>{if(B.push(I.multiply4(v)),_.length===3){if(!_[0].equals(_[1])&&!_[0].equals(_[2])&&!_[1].equals(_[2])){let C=h(_[0]),N=h(_[1]),A=h(_[2]),M=f(B[0]),S=f(B[1]),$=f(B[2]);s.push(`f ${C}//${M} ${N}//${S} ${A}//${$}`)}_.length=0,B.length=0}})}else P.iterVertexes(B=>{if(_.push(B.multiply4(g)),_.length===3){if(!_[0].equals(_[1])&&!_[0].equals(_[2])&&!_[1].equals(_[2])){let I=h(_[0]),C=h(_[1]),N=h(_[2]);s.push(`f ${I}// ${C}// ${N}//`)}_.length=0}})}}function h(m){return e.computeIfAbsent(m,()=>(s.push(`v ${m.x} ${m.y} ${m.z}`),++o))}function f(m){return m?t.computeIfAbsent(m,()=>(s.push(`vn ${m.x} ${m.y} ${m.z}`),++a)):""}function d(m){return n.computeIfAbsent(m,()=>{let{ambient:p,diffuse:g,specular:b}=m,v=`mtl${++l}`;return i.push(`newmtl ${v}`),i.push(`Ka ${p.r.toFixed(2)} ${p.g.toFixed(2)} ${p.b.toFixed(2)}`),i.push(`Kd ${g.r.toFixed(2)} ${g.g.toFixed(2)} ${g.b.toFixed(2)}`),i.push(`Ks ${b.r.toFixed(2)} ${b.g.toFixed(2)} ${b.b.toFixed(2)}`),i.push("endmtl"),v})}}var Cp=class{constructor(e=4096){this.byteOffset=0;this.view=new DataView(new ArrayBuffer(e))}getByteOffset(){return this.byteOffset}getFloat32(e,t){return this.view.getFloat32(e,t)}getFloat64(e,t){return this.view.getFloat64(e,t)}getInt8(e){return this.view.getInt8(e)}getInt16(e,t){return this.view.getInt16(e,t)}getInt32(e,t){return this.view.getInt32(e,t)}getUint8(e){return this.view.getUint8(e)}getUint16(e,t){return this.view.getUint16(e,t)}getUint32(e,t){return this.view.getUint32(e,t)}setFloat32(e,t,n){this.view.setFloat32(e,t,n)}setFloat64(e,t,n){this.view.setFloat64(e,t,n)}setInt8(e,t){this.view.setInt8(e,t)}setInt16(e,t,n){this.view.setInt16(e,t,n)}setInt32(e,t,n){this.view.setInt32(e,t,n)}setUint8(e,t){this.view.setUint8(e,t)}setUint16(e,t,n){this.view.setUint16(e,t,n)}setUint32(e,t,n){this.view.setUint32(e,t,n)}ext(e){let t=this.byteOffset;if(this.byteOffset+=e,this.byteOffset<=this.view.buffer.byteLength)return t;let n=new Uint8Array(this.view.buffer.byteLength*2);return n.set(new Uint8Array(this.view.buffer)),this.view=new DataView(n.buffer),t}pushFloat32(e,t){let n=this.ext(4);this.view.setFloat32(n,e,t)}pushFloat64(e,t){let n=this.ext(8);this.view.setFloat64(n,e,t)}pushInt8(e){let t=this.ext(1);this.view.setInt8(t,e)}pushInt16(e,t){let n=this.ext(2);this.view.setInt16(n,e,t)}pushInt32(e,t){let n=this.ext(4);this.view.setInt32(n,e,t)}pushUint8(e){let t=this.ext(1);this.view.setUint8(t,e)}pushUint16(e,t){let n=this.ext(2);this.view.setUint16(n,e,t)}pushUint32(e,t){let n=this.ext(4);this.view.setUint32(n,e,t)}build(){return this.view.buffer.slice(0,this.byteOffset)}};var Fi=!0,O4=(o=>(o[o.LINE=0]="LINE",o[o.ARC=1]="ARC",o[o.CIRCLE_CW=2]="CIRCLE_CW",o[o.CIRCLE_CCW=3]="CIRCLE_CCW",o[o.RECT_CW=4]="RECT_CW",o[o.RECT_CCW=5]="RECT_CCW",o))(O4||{});function tb(r){let e=new Cp;return r.forEach(a=>o(a)),e.build();function t(a){e.pushUint8(a)}function n(a){e.pushUint32(a,Fi)}function i(a){e.pushFloat64(a,Fi)}function s(a){e.pushFloat64(a.x,Fi),e.pushFloat64(a.y,Fi)}function o(a){let l=a.asClose().primitives,u=e.getByteOffset(),c=l.length;if(n(c),l.length===1){let h=l[0];if(h instanceof re){if(h.rx!==h.ry||!Te.eq(Math.abs(h.sweepAngle),360))throw new Error("pt.rx !== pt.ry || !DoubleKit.eq(Math.abs(pt.sweepAngle), 360)");s(h.center),t(h.isCCW?3:2),i(h.rx)}else if(h instanceof ui)s(h.leftUpPoint),t(h.isCCW?5:4),i(h.width),i(h.height),i(h.angle),i(h.radius);else throw new Error("not support!");return}s(l[0].start()),l.forEach(h=>{if(h instanceof Y)t(0),s(h.end());else if(h instanceof re&&h.rx===h.ry)if(Te.eq(Math.abs(h.sweepAngle),360)){let f=ut.toRadians(h.sweepAngle/2);t(1),i(f),s(h.pointOn(h.startAngle+h.sweepAngle/2)),t(1),i(f),s(h.end()),c++}else t(1),i(ut.toRadians(h.sweepAngle)),s(h.end());else throw new Error("not support!")}),e.setUint32(u,c,Fi)}}function rb(r){let e=[],t=new DataView(r),n=0;for(;n<r.byteLength;)e.push(l());return e;function i(){return t.getUint8(n++)}function s(){let u=t.getUint32(n,Fi);return n+=4,u}function o(){let u=new q(t.getFloat64(n,Fi),t.getFloat64(n+8,Fi));return n+=16,u}function a(){let u=t.getFloat64(n,Fi);return n+=8,u}function l(){let u=s(),c=o();if(u===1){let f=i();if(f===3||f===2)return Ce.build7([re.buildCircle(c,a(),f===3?yt.CCW:yt.CW)]);if(f===5||f===4)return Ce.build7([new ui(c,a(),a(),a(),f===5?yt.CCW:yt.CW,a())]);n--}let h=[];for(let f=0;f<u;f++){let d;switch(i()){case 0:d=o(),h.push(new Y(c,d));break;case 1:let m=a();d=o(),h.push(re.build5(c,d,ut.toDegrees(m)));break;default:throw new Error(`not support container type at ${n-1}: ${t.getUint8(n-1)}`)}c=d}return Ce.build2(h).asClose()}}var Mp=Yi(gu()),nb=class{constructor(e,t,n,i,s,o){this.cutWidth=Number.POSITIVE_INFINITY;this.startPoint=e,this.vec=t.normalize(),this.botWidth=n,this.topWidth=i,this.height=s,this.thickness=o;let a=new q(this.vec.y,-this.vec.x).scale(this.thickness/2),l=this.startPoint.add(this.vec.scale(Math.max(this.topWidth,this.botWidth)));this.line1=new Y(this.startPoint.add(a),l.add(a)),this.line2=new Y(this.startPoint.sub(a),l.sub(a)),this._bbox=ye.extend2(this.line1.bbox(),this.line2.bbox())}getHeightRange(e){if(this.botWidth<e||this.topWidth<e){if(ul(new Y(new q(this.botWidth,0),new q(this.topWidth,this.height)),new Y(new q(e,0),new q(e,this.height)))===0)throw new Error("cnt === 0");return this.botWidth<e?[ee[1],this.height]:[0,ee[1]]}return[0,this.height]}beCutByLine(e,t,n){if(ul(e,n)===0)return 0;let s=new q(ee[0],ee[1]),o=s.distance1(e.start());if(o>=this.cutWidth)return 0;let a=this.getHeightRange(o),l=t.getHeightRange(s.distance1(n.start()));return a[0]>=l[0]&&a[1]<=l[1]?o:0}beCut(e){if(Te.eq(this.vec.cross(e.vec),0))return!1;let t=this.beCutByLine(this.line1,e,e.line1);if(!t)return!1;let n=this.beCutByLine(this.line1,e,e.line2);if(!n)return!1;let i=this.beCutByLine(this.line2,e,e.line1);if(!i)return!1;let s=this.beCutByLine(this.line2,e,e.line2);return s?(this.cutWidth=Math.max(t,n,i,s),!0):!1}bbox(){return this._bbox}getCutWidth(){return this.cutWidth}},ib=new Pn(Fe.of1(13750737),Fe.of1(13750737),Fe.of1(13750737),.5,1),zse=new Pn(Fe.of1(13697024),Fe.of1(13697024),Fe.of1(13697024),.5,1),Yse=(n=>(n[n.Shell=4]="Shell",n[n.Boss=8]="Boss",n[n.Entity=16]="Entity",n))(Yse||{}),Xse=!1,ra=class{constructor(e,t){this.topGroup=new ze(1);this.botGroup=new ze(1);this.shellIndex={};this.creaseIndex={};this.needUpdateCreases=new Set;this.connectIndex={};this.shellInfoIndex={};this.needUpdateShells=new Set;this.bossInfoIndex={};this.needUpdateBosss=new Set;this.entityInfoIndex={};this.needUpdateEntities=new Set;this.shellHeight=0;this.botHeight=0;this.shellThickness=0;this.outShellIds=[];this.topOutShellIds=[];this.botOutShellIds=[];this.timeout=5*60*1e3;this.drawjs=new Tp(e),this.ONE_MIL=1;let n=new Yr(39.37,1).ratio;this.RAIL_WIDTH=1.6*n,this.RAIL_THICKNESS=1.5*n,this.COVER_THICKNESS=2*n,this.INNER_THICKNESS=1.5*n,this.GAP=.1*n,this.DEVIATION=this.ONE_MIL,this.broadcastBus=t}clear(){this.topGroup.clear(),this.botGroup.clear(),Object.keys(this.shellIndex).forEach(e=>delete this.shellIndex[e]),Object.keys(this.creaseIndex).forEach(e=>delete this.creaseIndex[e]),this.needUpdateCreases.clear(),Object.keys(this.connectIndex).forEach(e=>delete this.connectIndex[e]),Object.keys(this.shellInfoIndex).forEach(e=>delete this.shellInfoIndex[e]),this.needUpdateShells.clear(),Object.keys(this.bossInfoIndex).forEach(e=>delete this.bossInfoIndex[e]),this.needUpdateBosss.clear(),Object.keys(this.entityInfoIndex).forEach(e=>delete this.entityInfoIndex[e]),this.needUpdateEntities.clear(),this.shellHeight=0,this.botHeight=0,this.shellThickness=0,delete this.shellType,this.drawjs.clear(),this.outShellIds.length=0,this.topOutShellIds.length=0,this.botOutShellIds.length=0}setRenderMode(e){this.topGroup.setRenderMode(e),this.botGroup.setRenderMode(e)}initGroupIndex(e){this.shellIndex[e]&&Object.values(this.shellIndex[e]).forEach(n=>{this.topGroup.remove(n.group),this.botGroup.remove(n.group)});let t={};return this.shellIndex[e]=t,t}fitPly(e){return Ce.build2(ef(e.primitives,.1))}addShell(e,t,n,i,s,o,a,l){a=a.map(u=>this.fitPly(u)),this.shellInfoIndex[e]=[t,n,i,s,o,a,l],this.needUpdateShells.add(e)}addCrease(e,t,n,i,s){this.creaseIndex[e]=[t,n,i,s],this.needUpdateCreases.add(e)}addShellEntity(e,t,n,i,s,o,a){if(s===0||o[0].area(.01)>=0)return;o=o.map(u=>this.fitPly(u));let l=o[0].bbox();l.area()>.01&&l.width()>.1&&l.height()>.1&&(this.entityInfoIndex[e]=[t,n,i,s,o,a],this.needUpdateEntities.add(e))}addBoss(e,t,n,i,s,o,a,l,u){this.bossInfoIndex[e]=[t,n,i,s,o,a,l,u],this.needUpdateBosss.add(e)}addConnect(e,t){this.needUpdateCreases.add(e),t.forEach(n=>this.connectIndex[n]=e)}gnrShell(e,t,n,i,s,o,a,l){let u=this.initGroupIndex(e);if(n==="T&B"){let c=a[0],h=[li.UNION];c.primitives.forEach(C=>h.push(lt.buildByStroke(C,o,ts.ROUND)));let f=So(h);if(f.items.length===0){console.error("Shell generation failed!");return}let d=f.items[0].items.filter(C=>Math.abs(C.area(this.ONE_MIL))>this.ONE_MIL**2).map(C=>this.fitPly(C));if(d.length===1){console.error("Shell generation failed!");return}let m=l.BottomHeight;this.botHeight=m;let p=l.TopInnerHeight,g=l.BottomInnerHeight,b=i-m,v=Te.greatereq(m,o)?e+"Bot":null,w=Te.greatereq(b,o)?e+"Top":null;if(!v&&!w)return;v?(this.drawjs.polygonCylinder(v,d[0],m),w&&(this.drawjs.copy(v,w),this.drawjs.scale(w,1,1,b/m),this.drawjs.translate(w,0,0,m))):w&&(this.drawjs.polygonCylinder(w,d[0],b),this.drawjs.translate(w,0,0,m));let P=[v],_=[v],B=[w],I=[w];for(let C=1;C<d.length;C++){let N=d[C].reverse();if(v&&g||w&&p){if(rs.getExtendPolyLine(N,-(this.GAP+this.INNER_THICKNESS+this.GAP),this.broadcastBus&&null).forEach(A=>{if(v&&g){let M="topOutShell"+this.topOutShellIds.length;this.drawjs.polygonCylinder(M,A,i),this.topOutShellIds.push(M)}else{let M="botOutShell"+this.botOutShellIds.length;this.drawjs.polygonCylinder(M,A,i),this.botOutShellIds.push(M)}}),rs.getExtendPolyLine(N,-this.GAP,this.broadcastBus&&null).forEach(A=>{if(v&&g){let M="botOutShell"+this.botOutShellIds.length;this.drawjs.polygonCylinder(M,A,i),this.botOutShellIds.push(M)}else{let M="topOutShell"+this.topOutShellIds.length;this.drawjs.polygonCylinder(M,A,i),this.topOutShellIds.push(M)}}),v&&g){if(b-g-this.GAP>0){let A="topOutShell"+this.topOutShellIds.length;this.drawjs.polygonCylinder(A,N,b-g-this.GAP),this.drawjs.translate(A,0,0,m+g+this.GAP),this.topOutShellIds.push(A)}}else if(m-p-this.GAP>0){let A="botOutShell"+this.botOutShellIds.length;this.drawjs.polygonCylinder(A,N,m-p-this.GAP),this.botOutShellIds.push(A)}}else{let A="outShell"+this.outShellIds.length;this.drawjs.polygonCylinder(A,N,i),this.outShellIds.push(A)}if(v){if(g)rs.getExtendPolyLine(N,-this.GAP,this.broadcastBus&&null).forEach((A,M)=>{let S="botUnion"+C+"_"+M;this.drawjs.polygonCylinder(S,A,g+o*.5),this.drawjs.translate(S,0,0,m-o*.5),P.push(S)}),rs.getExtendPolyLine(N,-(this.GAP+this.INNER_THICKNESS),this.broadcastBus&&null).forEach((A,M)=>{let S="botSub"+C+"_"+M;this.drawjs.polygonCylinder(S,A,m+g+this.DEVIATION),this.drawjs.translate(S,0,0,o),_.push(S)});else if(i-o!==0){let A="botSub"+C;this.drawjs.polygonCylinder(A,N,i-o),this.drawjs.translate(A,0,0,o),_.push(A)}}if(w)if(p)rs.getExtendPolyLine(N,-this.GAP,this.broadcastBus&&null).forEach((A,M)=>{let S="topUnion"+C+"_"+M;this.drawjs.polygonCylinder(S,A,p+o*.5),this.drawjs.translate(S,0,0,m-p),B.push(S)}),rs.getExtendPolyLine(N,-(this.GAP+this.INNER_THICKNESS),this.broadcastBus&&null).forEach((A,M)=>{let S="topSub"+C+"_"+M;this.drawjs.polygonCylinder(S,A,b+p+this.DEVIATION),this.drawjs.translate(S,0,0,i-o-(b+p+this.DEVIATION)),I.push(S)});else{let A="topSub"+C;this.drawjs.polygonCylinder(A,N,b+p+this.DEVIATION),this.drawjs.translate(A,0,0,i-o-(b+p+this.DEVIATION)),I.push(A)}}P.length!==1&&this.drawjs.union(v,P),_.length!==1&&this.drawjs.subtract(v,_),B.length!==1&&this.drawjs.union(w,B),I.length!==1&&this.drawjs.subtract(w,I),v&&(u[v]={isTop:!1,status:4}),w&&(u[w]={isTop:!0,status:4})}else if(n==="DRAWER"){let c=a[0].primitives[0];if(Math.min(c.width,c.height)<=o){console.error("Shell generation failed!");return}let h=o/2,f="outShell"+this.outShellIds.length;this.drawjs.polygonCylinder(f,c.extend(-h).toPolyline(),i),this.outShellIds.push(f);let d=new q(...l.Direction),m=new ui(d.x===1?c.leftUpPoint:d.x===-1?c.leftUpPoint.add1(c.width,-c.height):d.y===1?c.leftUpPoint.add1(0,-c.height):c.leftUpPoint.add1(c.width,0),d.x!==0?c.width:c.height,d.x!==0?c.height:c.width,0,c.isCCW,c.radius),p=[],g=e+"Bot";this.drawjs.polygonCylinder(g,m.extend(h).toPolyline(),i);let b="sub1";this.drawjs.polygonCylinder(b,m.extend(-h).toPolyline(),i),this.drawjs.translate(b,0,0,o);let{leftUpPoint:v,width:w,height:P,radius:_}=m,B=w-Math.max(_-this.GAP,h),I=B-this.GAP,C="sub2";this.drawjs.polygonCylinder(C,Ce.build4([v.add1(Math.max(_,h),-h),v.add1(I,-h),v.add1(I,h+this.DEVIATION),v.add1(w+h+this.DEVIATION,h+this.DEVIATION),v.add1(w+h+this.DEVIATION,-P-h-this.DEVIATION),v.add1(I,-P-h-this.DEVIATION),v.add1(I,-P+h),v.add1(Math.max(_,h),-P+h),v.add1(Math.max(_,h),-h)]),i),this.drawjs.translate(C,0,0,i-this.RAIL_THICKNESS-this.COVER_THICKNESS-this.GAP*2),this.drawjs.subtract(g,[g,b,C]),u[g]={isTop:!1,status:4},p.push(g);let N=[];if(_>0){let xe=v.add1(I,0),ge=v.add1(_,0),Le=v.add1(0,-_),Ne=v.add1(0,_-P),Ve=v.add1(_,-P),ht=v.add1(I,-P);N.push(new Y(xe,ge),re.build1(ge,Le,_,_,!1,yt.CCW),new Y(Le,Ne),re.build1(Ne,Ve,_,_,!1,yt.CCW),new Y(Ve,ht))}else{let xe=v.add1(I,0),ge=v,Le=v.add1(0,-P),Ne=v.add1(I,-P);N.push(new Y(xe,ge),new Y(ge,Le),new Y(Le,Ne))}let A=N[0].start(),M=N[N.length-1].end(),S=h+this.RAIL_WIDTH;if(_>S){let xe=v.add1(I,-h-this.RAIL_WIDTH),ge=v.add1(_,-h-this.RAIL_WIDTH),Le=v.add1(S,-_),Ne=v.add1(S,_-P),Ve=v.add1(_,-P+S),ht=v.add1(I,-P+S),R=_-S;N.push(new Y(M,ht),new Y(ht,Ve),re.build1(Ve,Ne,R,R,!1,yt.CW),new Y(Ne,Le),re.build1(Le,ge,R,R,!1,yt.CW),new Y(ge,xe),new Y(xe,A))}else{let xe=v.add1(I,-h-this.RAIL_WIDTH),ge=v.add1(S,-S),Le=v.add1(S,-P+S),Ne=v.add1(I,-P+S);N.push(new Y(M,Ne),new Y(Ne,Le),new Y(Le,ge),new Y(ge,xe),new Y(xe,A))}let $=e+"Rail1";this.drawjs.polygonCylinder($,Ce.build2(N),this.RAIL_THICKNESS),this.drawjs.translate($,0,0,i-this.RAIL_THICKNESS),u[$]={isTop:!1,status:4},p.push($);let H=e+"Rail2";this.drawjs.copy($,H),this.drawjs.translate(H,0,0,-this.RAIL_THICKNESS-this.COVER_THICKNESS-this.GAP*2),u[H]={isTop:!1,status:4},p.push(H);let K=[],F=v.add1(B,-h-this.GAP-this.RAIL_WIDTH),z=v.add1(B,-P+h+this.GAP+this.RAIL_WIDTH),L=_+h;if(B<=w-_){let xe=new q(F.x,v.y+h),ge=v.add1(w-_,h),Le=v.add1(w+h,-_),Ne=v.add1(w+h,-P+_),Ve=ge.add1(0,-P-(ge.y-v.y)*2),ht=xe.add1(0,-P-(xe.y-v.y)*2);K.push(new Y(F,xe),new Y(xe,ge),re.build1(ge,Le,L,L,!1,yt.CW),new Y(Le,Ne),re.build1(Ne,Ve,L,L,!1,yt.CW),new Y(Ve,ht),new Y(ht,z))}else{if(lf(re.build1(v.add1(w-_,h),v.add1(w+h,-_),_+h,_+h,!1,yt.CW),new Y(v.add1(B,h),v.add1(B,0)))===0)throw new Error("cnt === 0");let ge=new q(ee[0],ee[1]),Le=v.add1(w+h,-_),Ne=v.add1(w+h,-P+_),Ve=ge.add1(0,-P-(ge.y-v.y)*2);K.push(new Y(F,ge),re.build1(ge,Le,L,L,!1,yt.CW),new Y(Le,Ne),re.build1(Ne,Ve,L,L,!1,yt.CW),new Y(Ve,z))}let k=h+this.RAIL_WIDTH+this.GAP,O=_-k;if(O>0){let xe=v.add1(_,-P+k),ge=v.add1(k,-P+_),Le=v.add1(k,-_),Ne=v.add1(_,-k);K.push(new Y(z,xe),re.build1(xe,ge,O,O,!1,yt.CW),new Y(ge,Le),re.build1(Le,Ne,O,O,!1,yt.CW),new Y(Ne,F))}else{let xe=v.add1(k,-P+k),ge=v.add1(k,-k);K.push(new Y(z,xe),new Y(xe,ge),new Y(ge,F))}let ie=e+"ThickCover";this.drawjs.polygonCylinder(ie,Ce.build2(K),this.COVER_THICKNESS+this.GAP+this.RAIL_THICKNESS),this.drawjs.translate(ie,0,0,i-this.RAIL_THICKNESS-this.GAP-this.COVER_THICKNESS),u[ie]={isTop:!0,status:4},p.push(ie);let W=e+"ThinCover",Q=h+this.GAP,oe=_-Q;if(oe>0){let xe=v.add1(w-_+h,-Q),ge=v.add1(_,-Q),Le=v.add1(Q,-_),Ne=v.add1(Q,-P+_),Ve=v.add1(_,-P+Q),ht=v.add1(w-_+h,-P+Q);this.drawjs.polygonCylinder(W,Ce.build2([new Y(xe,ge),re.build1(ge,Le,oe,oe,!1,yt.CCW),new Y(Le,Ne),re.build1(Ne,Ve,oe,oe,!1,yt.CCW),new Y(Ve,ht),new Y(ht,xe)]),this.COVER_THICKNESS)}else{let xe=v.add1(w-_+h,-Q),ge=v.add1(Q,-Q),Le=v.add1(Q,-P+Q),Ne=v.add1(w-_+h,-P+Q);this.drawjs.polygonCylinder(W,Ce.build2([new Y(xe,ge),new Y(ge,Le),new Y(Le,Ne),new Y(Ne,xe)]),this.COVER_THICKNESS)}this.drawjs.translate(W,0,0,i-this.RAIL_THICKNESS-this.GAP-this.COVER_THICKNESS),u[W]={isTop:!0,status:4},p.push(W);let we=d.angleD(q.ORIGIN);for(let xe of p)Te.eq(we,0)||this.drawjs.rotate(xe,v.x,v.y,0,0,0,1,we),Te.eq(c.angle,0)||this.drawjs.rotate(xe,c.leftUpPoint.x,c.leftUpPoint.y,0,0,0,1,c.angle)}this.shellHeight=i,this.shellThickness=o,this.shellType=n}gnrBoss(e,t,n,i,s,o,a,l,u){if(i<=0)return;let c=this.initGroupIndex(e);if(a&&i>s){let d=e+"Spigot",m=e+"Ext",[p,g]=a,b=p+s;i<p+s&&(b=i,p=i-s),this.drawjs.cylinder(d,g/2,p+this.DEVIATION),this.drawjs.cylinder(m,g/2+s,b),t?(this.drawjs.translate(d,n.x,n.y,this.shellHeight-p),this.drawjs.translate(m,n.x,n.y,this.shellHeight-b)):(this.drawjs.translate(d,n.x,n.y,-this.DEVIATION),this.drawjs.translate(m,n.x,n.y,0)),c[d]={isTop:t,subStatus:12},c[m]={isTop:t,status:8}}if(l){let[d,m,p,g]=l,b=this.shellType==="DRAWER"&&t?this.COVER_THICKNESS+this.GAP+this.RAIL_THICKNESS:this.shellThickness;if(i>b+p){let v=e+"Stiff1",w=n.add(new q(o/2,g/2+b));this.drawjs.polygonCylinder(v,Ce.build4([w,w.add(new q(0,i-b-p)),w.add(new q(0,i-b-p)).add(new q(d+s,0)),w.add(new q(m+s,0)),w]),g);let P=n.add(new q(o/2,g/2));t?(this.drawjs.rotate(v,P.x,P.y,0,1,0,0,-90),this.drawjs.translate(v,0,-g,this.shellHeight)):this.drawjs.rotate(v,P.x,P.y,0,1,0,0,90);let _=e+"Stiff2";this.drawjs.copy(v,_),this.drawjs.rotate(_,n.x,n.y,0,0,0,1,90);let B=e+"Stiff3";this.drawjs.copy(v,B),this.drawjs.rotate(B,n.x,n.y,0,0,0,1,180);let I=e+"Stiff4";this.drawjs.copy(v,I),this.drawjs.rotate(I,n.x,n.y,0,0,0,1,270),c[v]={isTop:t,status:8},c[_]={isTop:t,status:8},c[B]={isTop:t,status:8},c[I]={isTop:t,status:8}}}let h=e+"Cylinder";this.drawjs.cylinder(h,o/2+s,i);let f=e+"Hole";a?this.drawjs.cylinder(f,o/2,i+this.DEVIATION*2):i>this.shellThickness?this.drawjs.cylinder(f,o/2,i-this.shellThickness+this.DEVIATION):f=null,t?(this.drawjs.translate(h,n.x,n.y,this.shellHeight-i),f&&this.drawjs.translate(f,n.x,n.y,this.shellHeight-i-this.DEVIATION)):(this.drawjs.translate(h,n.x,n.y,0),a?this.drawjs.translate(f,n.x,n.y,-this.DEVIATION):f&&this.drawjs.translate(f,n.x,n.y,this.shellThickness)),c[h]={isTop:t,status:8},f&&(c[f]={isTop:t,subStatus:12,onlySubCurLayer:!0})}gnrShellEntity(e,t,n,i,s,o,a){if(this.connectIndex[e]&&!this.creaseIndex[this.connectIndex[e]])return;let l=n||this.drawjs.cadEngine===1?0:this.DEVIATION;s=s>0?Math.min(s,1e10):Math.max(s,-1e10);let u=this.initGroupIndex(e),c=o[0],h=c.primitives[0];if(c.primitives.length===1&&h instanceof re&&h.rx===h.ry&&Math.abs(h.sweepAngle)>=360?(this.drawjs.cylinder(e,h.rx,Math.abs(s)+2*l),this.drawjs.translate(e,h.center.x,h.center.y,0)):this.drawjs.polygonCylinder(e,c,Math.abs(s)+2*l),this.connectIndex[e]){let[f,d,m,p]=this.creaseIndex[this.connectIndex[e]],g=0;c.points1(this.DEVIATION,v=>g+=q.normal(v,f,d));let b=d.sub(f);s<0?this.drawjs.translate(e,0,0,s-l):this.drawjs.translate(e,0,0,-l),this.drawjs.rotate(e,f.x,f.y,0,b.x,b.y,0,g>0?m:-m)}else if(t)if(s<0){let f=this.shellType==="DRAWER"?this.COVER_THICKNESS+this.GAP+this.RAIL_THICKNESS:this.shellThickness;this.drawjs.translate(e,0,0,this.shellHeight-f-l)}else this.drawjs.translate(e,0,0,this.shellHeight-s-l);else s<0?this.drawjs.translate(e,0,0,this.shellThickness+s-l):this.drawjs.translate(e,0,0,-l);if(!n){u[e]={isTop:t,subStatus:i};return}if(!this.connectIndex[e])u[e]={isTop:t,status:16};else if(i===1)u[e]={isTop:!0,status:16};else if(i===2||this.shellType==="DRAWER"||this.shellHeight-this.botHeight<this.shellThickness)u[e]={isTop:!1,status:16};else if(this.botHeight<this.shellThickness)u[e]={isTop:!0,status:16};else{let[f,d,m,p]=this.creaseIndex[this.connectIndex[e]],g=d.sub(f).normalize(),b=!0,v;for(let w of o)if(w.points1(this.DEVIATION,P=>{if(!b)return;let _=P.sub(f).cross(g);v===void 0&&(v=_),(Math.abs(_)<this.botHeight||v*_<0)&&(b=!1)}),!b)break;u[e]={isTop:b,status:16}}}showAll(){var e,t;(e=this.topResultGroup)==null||e.setVisible(!1),(t=this.botResultGroup)==null||t.setVisible(!1);for(let n of Object.values(this.shellIndex))for(let i of Object.entries(n)){let[s,o]=i,{group:a,isTop:l,subStatus:u}=o;if(a){a.setVisible(!0),o.group.setHidden(!1);continue}a=new ze(u?1:4),a.add(new vt(this.drawjs.getTriangles(s),null,u?zse:ib)),o.group=a,l?this.topGroup.add(a):this.botGroup.add(a)}}gnrStiff(e){let t=e&&this.shellType==="DRAWER"?this.COVER_THICKNESS+this.GAP+this.RAIL_THICKNESS:this.shellThickness,n=Object.values(this.bossInfoIndex).filter(l=>l[0]===e&&l[6]&&l[2]>t+l[6][2]);if(n.length===0)return[];let i=new Bi(10);for(let[l,u,c,h,f,d,m,p]of n){let C=function(N,A){i.insert(new nb(N,A,B,I,_,P))},g=f/2,[b,v,w,P]=m,_=c-t-w,B=v+h,I=b+h;C(u.add1(g,0),new q(1,0)),C(u.add1(-g,0),new q(-1,0)),C(u.add1(0,g),new q(0,1)),C(u.add1(0,-g),new q(0,-1))}i.items.forEach(l=>i.search(l.bbox()).forEach(u=>l.beCut(u)));let s=0,o=[],a=e?"topStiff":"botStiff";return i.items.forEach(l=>{let u=a+s++;o.push(u);let{topWidth:c,botWidth:h,startPoint:f,vec:d,thickness:m,height:p}=l,g=l.getCutWidth(),b=f.add1(0,m/2);if(g>=Math.max(c,h))this.drawjs.polygonCylinder(u,Ce.build4([b,b.add1(0,t+p),b.add1(c,t+p),b.add1(h,t),b.add1(h,0),b]),m);else if(g<=Math.min(c,h))this.drawjs.polygonCylinder(u,Ce.build4([b,b.add1(0,t+p),b.add1(g,t+p),b.add1(g,t),b.add1(g,0),b]),m);else{if(ul(new Y(new q(h,0),new q(c,p)),new Y(new q(g,0),new q(g,p)))===0)throw new Error("cnt === 0");c<h?this.drawjs.polygonCylinder(u,Ce.build4([b,b.add1(0,t+p),b.add1(c,t+p),b.add1(g,t+ee[1]),b.add1(g,t),b.add1(g,0),b]),m):this.drawjs.polygonCylinder(u,Ce.build4([b,b.add1(0,t+p),b.add1(g,t+p),b.add1(g,t+ee[1]),b.add1(h,t),b.add1(h,0),b]),m)}let v=f.add1(0,m/2);e?(this.drawjs.rotate(u,v.x,v.y,0,1,0,0,-90),this.drawjs.translate(u,0,-m,this.shellHeight)):this.drawjs.rotate(u,v.x,v.y,0,1,0,0,90),this.drawjs.rotate(u,f.x,f.y,0,0,0,1,d.angleD(q.ORIGIN))}),o}subShells(e,t,n){e.length===0||t.length===0||(e[0]!==n&&this.drawjs.union(n,e),this.drawjs.subtract(n,[n,...t]),e.length=0,e.push(n))}gnrShellTopBotUnion(){if(Object.values(this.shellIndex).length===0)return;let e=[[],[]],t=[this.gnrStiff(!1),this.gnrStiff(!0)],n=[[],[]],i=[[],[]],s=[[],[]],o=[[],[]],a=[[],[]],l=[[],[]],u=[[],[]],c=[[],[]];for(let f of Object.values(this.shellIndex))for(let d of Object.entries(f)){let m=function(P){w?P[v?1:0].push(p):(P[0].push(p),P[1].push(p))},[p,{status:g,subStatus:b,isTop:v,onlySubCurLayer:w}]=d;g===4?e[v?1:0].push(p):g===8?!/Stiff/.test(p)&&t[v?1:0].push(p):g===16?n[v?1:0].push(p):b===4?m(i):b===12?m(s):b===20?m(o):b===28?m(a):b===8?m(l):b===24?m(u):b===16&&m(c)}if(this.subShells(e[1],i[1],"topUnionShell"),this.subShells(e[0],i[0],"botUnionShell"),this.subShells(t[1],l[1],"topUnionBoss"),this.subShells(t[0],l[0],"botUnionBoss"),this.subShells(n[1],c[1],"topUnionEntity"),this.subShells(n[0],c[0],"botUnionEntity"),Object.keys(this.shellInfoIndex).length!==0&&(t[0].length!==0||t[1].length!==0)){let f="outShellUnion";if(this.outShellIds.length!==0&&this.drawjs.union(f,this.outShellIds),t[1].length!==0)if(t[1][0]!=="topUnionBoss"&&(this.drawjs.union("topUnionBoss",t[1]),t[1].length=0,t[1].push("topUnionBoss")),this.topOutShellIds.length===0)this.outShellIds.length!==0&&this.drawjs.intersect("topUnionBoss","topUnionBoss",f);else{let d="topOutShellUnion";this.drawjs.union(d,this.topOutShellIds),this.drawjs.intersect("topUnionBoss","topUnionBoss",d)}if(t[0].length!==0)if(t[0][0]!=="botUnionBoss"&&(this.drawjs.union("botUnionBoss",t[0]),t[0].length=0,t[0].push("botUnionBoss")),this.botOutShellIds.length===0)this.outShellIds.length!==0&&this.drawjs.intersect("botUnionBoss","botUnionBoss",f);else{let d="botOutShellUnion";this.drawjs.union(d,this.botOutShellIds),this.drawjs.intersect("botUnionBoss","botUnionBoss",d)}}let h=f=>{let d=f?1:0,m=f?"top":"bot",p=s[d],g=o[d],b=u[d],v=e[d],w=t[d],P=n[d];(p.length!==0?1:0)+(g.length!==0?1:0)+(b.length!==0?1:0)>=2?(this.subShells(v,p.concat(g),`${m}UnionShell`),this.subShells(w,p.concat(b),`${m}UnionBoss`),this.subShells(P,g.concat(b),`${m}UnionEntity`)):p.length!==0?(v.push(...w),w.length=0,this.subShells(v,p,`${m}UnionShellBoss`)):g.length!==0?(v.push(...P),P.length=0,this.subShells(v,g,`${m}UnionShellEntity`)):b.length!==0&&(w.push(...P),P.length=0,this.subShells(w,b,`${m}UnionBossEntity`))};return h(!0),e[1].push(...t[1],...n[1]),this.subShells(e[1],a[1],"shell-top-union"),e[1].length!==0&&e[1][0]!=="shell-top-union"&&this.drawjs.union("shell-top-union",e[1]),h(!1),e[0].push(...t[0],...n[0]),this.subShells(e[0],a[0],"shell-bot-union"),e[0].length!==0&&e[0][0]!=="shell-bot-union"&&this.drawjs.union("shell-bot-union",e[0]),[e[1].length>0?"shell-top-union":null,e[0].length>0?"shell-bot-union":null]}extScissorBBox(){}async gnrResult(e=new Li,t=!0){var a,l;if(Object.values(this.shellIndex).length===0)return;if(this.drawjs.cadEngine===1||t===!1){this.gnrShellTopBotUnion();return}for(let u of Object.values(this.shellIndex))for(let c of Object.values(u))(a=c.group)==null||a.setVisible(!1),(l=c.group)==null||l.setHidden(!0);if(this.botResultGroup){this.topResultGroup.setVisible(!0),this.botResultGroup.setVisible(!0);return}this.topResultGroup=new ze,this.botResultGroup=new ze,this.topGroup.add(this.topResultGroup),this.botGroup.add(this.botResultGroup);let[n,i]=(await e.rpcCall("/worker/shell/quickGnrResult",this.enc(),this.timeout)).message;Xse&&e.rpcCall("/worker/shell/gnrResultDebug",this.enc(),Number.MAX_SAFE_INTEGER),n&&this.topResultGroup.add(ls(n)),i&&this.botResultGroup.add(ls(i)),this.occshellWorkerBridge&&this.occshellWorkerBridge.discard();let s=n0("https://modules.lceda.cn/smt-gl-engine/0.10.77.9b173ce3/worker.js",kh()),o=new Mp.MessageBus;this.occshellWorkerBridge=new Mp.WorkerMessageBridge(o,new Worker(s)),this.occshellWorkerBridge.rpcCall("/worker/shell/gnrResult",this.enc()).then(u=>{this.extScissorBBox();let[c,h]=u.message;this.topResultGroup.clear(),this.botResultGroup.clear(),c&&this.topResultGroup.add(ls(c)),h&&this.botResultGroup.add(ls(h)),this.extScissorBBox()})}end(){this.topGroup.remove(this.topResultGroup),this.topResultGroup=null,this.botGroup.remove(this.botResultGroup),this.botResultGroup=null;for(let e of Object.entries(this.connectIndex)){let[t,n]=e;this.needUpdateCreases.has(n)&&this.needUpdateEntities.add(t)}this.needUpdateCreases.clear();for(let e of this.needUpdateShells)this.gnrShell(e,...this.shellInfoIndex[e]);this.needUpdateShells.clear();for(let e of this.needUpdateBosss)this.gnrBoss(e,...this.bossInfoIndex[e]);this.needUpdateBosss.clear();for(let e of this.needUpdateEntities){let t=this.entityInfoIndex[e];t&&this.gnrShellEntity(e,...t)}this.needUpdateEntities.clear()}encVec(e){return[e.x,e.y]}decVec(e){return new q(e[0],e[1])}enc(){let e={connectIndex:this.connectIndex,creaseIndex:{},shellInfoIndex:{},bossInfoIndex:{},entityInfoIndex:{}};return Object.entries(this.creaseIndex).forEach(t=>{let[n,i]=t;e.creaseIndex[n]=i.slice(),e.creaseIndex[n][0]=this.encVec(i[0]),e.creaseIndex[n][1]=this.encVec(i[1])}),Object.entries(this.shellInfoIndex).forEach(t=>{let[n,i]=t;e.shellInfoIndex[n]=i.slice(),e.shellInfoIndex[n][5]=tb(i[5])}),Object.entries(this.bossInfoIndex).forEach(t=>{let[n,i]=t;e.bossInfoIndex[n]=i.slice(),e.bossInfoIndex[n][1]=this.encVec(i[1])}),Object.entries(this.entityInfoIndex).forEach(t=>{let[n,i]=t;e.entityInfoIndex[n]=i.slice(),e.entityInfoIndex[n][4]=tb(i[4])}),e}gnrResultInWorker(e){let{creaseIndex:t,connectIndex:n,shellInfoIndex:i,bossInfoIndex:s,entityInfoIndex:o}=e;Object.entries(t).forEach(c=>{let[h,f]=c;f[0]=this.decVec(f[0]),f[1]=this.decVec(f[1]),this.addCrease(h,...f)}),Object.entries(n).forEach(c=>{let[h,f]=c;this.addConnect(f,[h])}),Object.entries(i).forEach(c=>{let[h,f]=c;f[5]=rb(f[5]),this.addShell(h,...f)}),Object.entries(s).forEach(c=>{let[h,f]=c;f[1]=this.decVec(f[1]),this.addBoss(h,...f)}),Object.entries(o).forEach(c=>{let[h,f]=c;f[4]=rb(f[4]),this.addShellEntity(h,...f)}),this.end();let a=[null,null];if(Object.values(this.shellIndex).length===0)return a;let[l,u]=this.gnrShellTopBotUnion();if(l){let c=new ze;c.add(new vt(this.drawjs.getTriangles("shell-top-union"),null,ib)),a[0]=eb(c).join(`
`)}if(u){let c=new ze;c.add(new vt(this.drawjs.getTriangles("shell-bot-union"),null,ib)),a[1]=eb(c).join(`
`)}return this.clear(),a}};var k4={},sb=Gn(),Np=null;function ob(){return Np||(Np=new Promise((r,e)=>{try{let t="https://modules.lceda.cn/occShell/0.0.2/occShell.js";if(sb.importScripts)/^https?/.test(t)?importScripts(t):importScripts(location.origin+t),r();else if(sb.document){let n=document.createElement("script");n.src=t,n.onload=()=>{r()},n.onerror=e,n.onabort=e,document.head.appendChild(n)}}catch(t){e(t)}}).then(()=>sb.createOccshell(k4)).then(()=>k4).catch(r=>{throw Np=null,r})),Np}async function U4(r,e){await tf({onStart(){},onLayerConfig:()=>{},onLayerPhys:()=>{},onPanelize:()=>{},onSilkOpts:()=>{},onTexture:()=>{},onPrimitive:()=>{},onPolys:()=>{},onCircle:()=>{},onRect:()=>{},onPolygon:()=>{},onPolygonCfg:()=>{},onModel:()=>{},onItemOrder:()=>{},onPrintMethod:()=>{},onShellOutline:(s,o,a,l,u,c,h,f)=>e.addShell(s,o,a,l,u,c,h,f),onCrease:(s,o,a,l,u)=>e.addCrease(s,o,a,l,u),onShellEntity:(s,o,a,l,u,c,h)=>e.addShellEntity(s,o,a,l,u,c,h),onBoss:(s,o,a,l,u,c,h,f,d)=>e.addBoss(s,o,a,l,u,c,h,f,d),onConnect:(s,o)=>e.addConnect(s,o),onEnd:()=>e.end()},r,1,{scale:.1,scaleMatrix:qe.scale(.1)});let n=e.gnrShellTopBotUnion(),i=new Yr(1,39.37).ratio;n.forEach(s=>s&&e.drawjs.scale(s,i,i,i))}var D4=Yi(gu()),G4=Yi(w0());function Hd(r,e){let t=Ua(()=>new D4.BroadcastChannelMessageBus(e));r.rpcService("/worker/step2mesh",n=>x_(n[0],n[1])),r.rpcService("/worker/objDecode",n=>Ja(n[0],n[1],n[2])),r.rpcService("/worker/runBoolean",n=>{xr.LayerSubstrate&&console.warn("/worker/runBoolean start");let i=[So(Io(n).rulesArr[0])];xr.LayerSubstrate&&console.warn("bool result",i);let s=ou(i);return xr.LayerSubstrate&&console.warn("bool encode",s.byteLength),s}),r.rpcService("/worker/alignModel",n=>v_(...n)),r.rpcService("/worker/pcb2step",async n=>{let i=new of(39.37,new Li);if(n[1]===!0){let s=new G4.default,o=await Pf(n[0],i,async(a,l)=>{s.file(a,l)},n[2]);return{file:await s.generateAsync({type:"blob"}),statusIndex:o}}else{let[s,o]=await b_(n[0],i,async a=>{t().publish("/worker/pcb2step/progress",a)},n[2]);return{file:new Blob([s],{type:"text/plain"}),statusIndex:o}}}),r.rpcService("/worker/tcl2model",async n=>{if(Gn().OC===void 0){let s=await ob();Gn().OC=s}let i=new ra(2);try{switch(await U4(n[0],i),n[1]){case"STEP":return await i.drawjs.downloadStep(n[2]);case"STL":return await i.drawjs.downloadStl(n[2]);case"OBJ":return await i.drawjs.downloadObj(n[2])}}catch{return i.drawjs.errList}}),r.rpcService("/worker/shell/quickGnrResult",async n=>(console.log("/worker/shell/quickGnrResult"),new ra(0).gnrResultInWorker(n))),r.rpcService("/worker/shell/gnrResultDebug",async n=>new ra(0,t()).gnrResultInWorker(n)),r.rpcService("/worker/shell/gnrResult",async n=>{if(console.log("/worker/shell/gnrResult__________"),Gn().OC===void 0){let i=await ob();Gn().OC=i}return new ra(2).gnrResultInWorker(n)})}var Rp=Yi(gu()),F4=new Rp.MessageBus;new Rp.WorkerMessageBridge(F4,self),Hd(F4,self.BROAD_CAST_BUS_UUID),console.log("installed worker");})();
/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/
/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */
//!!  bug 
//# sourceMappingURL=https://modules.lceda.cn/smt-gl-engine/0.10.77.9b173ce3/worker.js.map

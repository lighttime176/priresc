"use strict";(()=>{var _class,_class2,_class3,_class4,_class5,_class6,_class7,_class8,_class9,_class10,_class11,_class12,_class13,_class14,_class15,_class16;var LU=Object.create;var tm=Object.defineProperty,OU=Object.defineProperties,kU=Object.getOwnPropertyDescriptor,UU=Object.getOwnPropertyDescriptors,DU=Object.getOwnPropertyNames,Rb=Object.getOwnPropertySymbols,GU=Object.getPrototypeOf,Lb=Object.prototype.hasOwnProperty,FU=Object.prototype.propertyIsEnumerable;var Le=Math.pow,Nb=(r,e,t)=>e in r?tm(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,rm=(r,e)=>{for(var t in e||(e={}))Lb.call(e,t)&&Nb(r,t,e[t]);if(Rb)for(var t of Rb(e))FU.call(e,t)&&Nb(r,t,e[t]);return r;},nm=(r,e)=>OU(r,UU(e));var Nl=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported');});var G=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var qU=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of DU(e))!Lb.call(r,i)&&i!==t&&tm(r,i,{get:()=>e[i],enumerable:!(n=kU(e,i))||n.enumerable});return r;};var ki=(r,e,t)=>(t=r!=null?LU(GU(r)):{},qU(e||!r||!r.__esModule?tm(t,"default",{value:r,enumerable:!0}):t,r));var Se=(r,e,t)=>new Promise((n,i)=>{var s=l=>{try{a(t.next(l));}catch(u){i(u);}},o=l=>{try{a(t.throw(l));}catch(u){i(u);}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(r,e)).next());});var fu=G((FSe,$w)=>{"use strict";var b0=Object.defineProperty,vF=Object.getOwnPropertyDescriptor,EF=Object.getOwnPropertyNames,PF=Object.prototype.hasOwnProperty,_F=(r,e)=>{for(var t in e)b0(r,t,{get:e[t],enumerable:!0});},SF=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of EF(e))!PF.call(r,i)&&i!==t&&b0(r,i,{get:()=>e[i],enumerable:!(n=vF(e,i))||n.enumerable});return r;},BF=r=>SF(b0({},"__esModule",{value:!0}),r),Uw={};_F(Uw,{BroadcastChannelMessageBus:()=>WF,MessageBus:()=>GF,MessageBus2:()=>XF,WindowMessageBridge:()=>DF,WorkerMessageBridge:()=>UF}),$w.exports=BF(Uw);var Rf=new Error("list is empty"),Nf=class{constructor(r,e){this.prev=null,this.next=null,this.parent=r,this.item=e;}insertAfter(r){r.next=this.next,this.next=r,r.prev=this,r.next!==null&&(r.next.prev=r);}insertBefore(r){r.prev=this.prev,this.prev=r,r.next=this,r.prev!==null&&(r.prev.next=r);}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev);}set(r){this.item=r;}},IF=class{constructor(r){this._next=r;}hasNext(){return this._next!==null;}next(){let r=this._next;if(r!==null)return this._next=r.next,r.item;throw new Error("iterator is null");}},AF=class{constructor(r){this._next=r;}hasNext(){return this._next!==null;}next(){let r=this._next;if(r!==null)return this._next=r.next,r;throw new Error("iterator is null");}},CF=class{constructor(){this.first=null,this.last=null,this.cnt=0;}add(r){return this.addLast(r);}push(r){return this.addLast(r);}pop(){return this.removeLast();}shift(){return this.removeFirst();}removeFirst(){let r=this.first;if(r===null)throw Rf;return this.remove(r),r.item;}removeLast(){let r=this.last;if(r===null)throw Rf;return this.remove(r),r.item;}addLast(r){if(this.first===null||this.last===null){let e=new Nf(this,r);return this.first=e,this.last=e,this.cnt++,e;}else return this.insertAfter(this.last,r);}addFirst(r){if(this.first===null||this.last===null){let e=new Nf(this,r);return this.first=e,this.last=e,this.cnt++,e;}else return this.insertBefore(this.first,r);}getFirst(){if(this.first===null)throw Rf;return this.first.item;}getLast(){if(this.last===null)throw Rf;return this.last.item;}insertAfter(r,e){let t=new Nf(this,e);return r.insertAfter(t),r===this.last&&(this.last=t),this.cnt++,t;}insertBefore(r,e){let t=new Nf(this,e);return r.insertBefore(t),r===this.first&&(this.first=t),this.cnt++,t;}remove(r){r.remove(),r===this.first&&(this.first=r.next),r===this.last&&(this.last=r.prev),this.cnt--;}size(){return this.cnt;}clear(){this.first=null,this.last=null,this.cnt=0;}iterator(){return new IF(this.first);}listIterator(){return new AF(this.first);}toArray(){let r=new Array(),e=this.first;for(;e!=null;)r.push(e.item),e=e.next;return r;}},y0=new ArrayBuffer(8),w0=new Float64Array(y0),v0=new Uint32Array(y0),Dw=new Uint16Array(y0),E0=ArrayBuffer;try{E0=self.HTMLImageElement||E0;}catch{}function Lf(r){if(typeof r!="object"||r===null||r instanceof Date||r instanceof ArrayBuffer||r instanceof Blob||r instanceof FormData||r instanceof Function||r instanceof Uint8ClampedArray||r instanceof E0)return r;if(Array.isArray(r))return r.map(Lf);{let e={};for(let t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=Lf(r[t]));return e;}}function P0(r,e){return MF(r,e,()=>[]);}function MF(r,e,t){let n=r[e];return n!==void 0||(n=t(e),r[e]=n),n;}function CSe(r,e){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(e(void 0,r[t],t)===!1)return;}else{let t=0;for(let n in r)if(r.hasOwnProperty(n)){let i=r[n];if(e(n,i,t)===!1)return;t++;}}}var TF=Object.prototype.hasOwnProperty;async function MSe(r,e){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if((await e(void 0,r[t],t))===!1)return;}else{let t=0;for(let n in r)if(TF.call(r,n)){let i=r[n];if((await e(n,i,t))===!1)return;t++;}}}function TSe(r,e,t){return typeof r=="string"&&(/https?:/.test(r)||(r=location.origin+r)),Promise.race([fetch(r,e),new Promise((n,i)=>setTimeout(i,t))]);}function RSe(r,e){let t=0,n=0;return(...i)=>{let s=++t;setTimeout(()=>{let o=performance.now();if(s===t||o-n>=r){try{e(...i);}catch(a){console.log(a);}n=o;}},Math.max(0,r-(performance.now()-n)));};}function NSe(r,e){let t=r.length,n=0;for(;n<t;){let i=r.indexOf(`
`,n);i<0&&(i=t);let s=r.substring(n,i);try{if(e(s)===!1)return;}catch(o){console.error(o);}n=i+1;}}function LSe(r){let e=null;return()=>(e===null&&(e=r()),e);}var _0=0;function OSe(){_0===0&&(_0=Date.now()-performance.now());let r=new Array(),e=_0+performance.now();w0[0]=e,r.push(v0[1].toString(16)),w0[0]=Math.random(),r.push(Dw[3].toString(16));let t=Dw[2].toString(16);r.push("4"+t.substr(0,3)),w0[0]=e;let n=v0[0].toString(16)+v0[1].toString(16);return r.push("0"+n.substr(0,3)),r.push(n.substr(3)),r.join("-");}var kSe=class{constructor(r){this.resources=r,this.idle=[];}acquire(r){this.resources>0?(this.resources--,r()):this.idle.push(r);}acquireSync(){return new Promise(r=>{this.acquire(r);});}release(){let r=this.idle.shift();r?r():this.resources++;}};function RF(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global;}function USe(r,e,t){let n=r.length+e-1;for(let i=0;i<n;i++){let s=new Array();for(let o=i-e+1;o<=i;o++)s.push(r[o]);if(t(s)===!1)break;}}function DSe(){let r=new Date(),e=r.getFullYear(),t=r.getMonth()+1,n=r.getDate(),i=r.getHours(),s=r.getMinutes(),o=r.getSeconds(),a=r.getMilliseconds();return"["+e+"-"+(t<10?"0"+t:t)+"-"+(n<10?"0"+n:n)+" "+(i<10?"0"+i:i)+":"+(s<10?"0"+s:s)+":"+(o<10?"0"+o:o)+"."+(a<100?a<10?"00"+a:"0"+a:a)+"] ";}async function GSe(r){let e=typeof r=="string"?new TextEncoder().encode(r):r,t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(n=>n.toString(16).padStart(2,"0")).join("");}function NF(r,e){let t=0,n=r.length;for(let i=0;i<n;i++)r[i]===e&&(r.splice(i,1),i--,n--,t++);return t;}var Gw=RF(),LF=Gw.WeakRef||(r=>r);function Va(r){if(r!=null){if(typeof r=="object")return new LF(r);console.error(r,r instanceof Object,typeof r);return;}}function Wa(r){return r===null||r===void 0?void 0:r.deref();}var S0;typeof window>"u"?S0=function(r){setTimeout(r,100);}:S0=Gw.requestAnimationFrame;var OF="_MSG_BUS_RPC_",Fw=5*60*1e3,Io=new CF();function qw(){let r=performance.now();for(;Io.size()>0;){let e=Io.getFirst();if(e.timeout<=r)Io.removeFirst(),e.reject(`RPC Call ${e.topic} Timed Out`);else break;}S0(qw);}qw();var kF=(r=>(r.PUBLISH="publish",r.SUBSCRIBE="subscribe",r.PUSH="push",r.PULL="pull",r))(kF||{}),zw=class{constructor(r){this.bus=r;}processRemoteMessage(r,e){let t=Va(e),n=r.topic,i=r.type,s=r.message;switch(i){case"pull":this.bus.pull(n,o=>{this.push(n,o,Wa(t));});break;case"subscribe":this.bus.subscribe(n,o=>{this.publish(n,o,Wa(t));});break;case"publish":this.bus.publish(n,s,this,Wa(t));break;case"push":this.bus.push(n,s,this,Wa(t));break;default:console.debug("unknown message type "+i);}}rpcCall(r,e,t,n){let i=Va(t);return new Promise((s,o)=>{let a=Io.push({timeout:performance.now()+n,reject:o,topic:r}),l=this.bus.uniqueRpcTopic(r);this.publish(r,{message:e,reply:l},Wa(i)),this.bus.pull(l,(u,c,h)=>{s({message:u,bridge:c,source:Va(h)}),Io.remove(a);});});}},UF=class extends zw{constructor(r,e){super(r),this.worker=e,e.onmessage=t=>{this.processRemoteMessage(t.data,void 0);};}publish(r,e){this.postMessage(r,"publish",e);}subscribe(r){this.postMessage(r,"subscribe",null);}push(r,e){this.postMessage(r,"push",e);}pull(r){this.postMessage(r,"pull",null);}rpcCall(r,e,t=Fw){return super.rpcCall(r,e,void 0,t);}postMessage(r,e,t){let n={topic:r,type:e,message:t};this.worker.postMessage(n);}discard(){this.worker.terminate();}},DF=class extends zw{constructor(r){super(r),window.addEventListener("message",e=>{this.processRemoteMessage(e.data,e.source);},!1);}publish(r,e,t){this.postMessage(r,"publish",e,t);}subscribe(r,e){if(e===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(r,"subscribe",null,e);}push(r,e,t){this.postMessage(r,"push",e,t);}pull(r,e){if(e===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(r,"pull",null,e);}postMessage(r,e,t,n){let i={topic:r,type:e,message:t};n&&n.postMessage(i,"*");}},Yw=class{constructor(r){this.isRunning=!0,this.callback=r;}cancel(){this.isRunning=!1;}running(){return this.isRunning;}execute(r,e,t,n){try{r=n?r:Lf(r),this.callback(r,e,t);}catch(i){console.error(i);}}},GF=class{constructor(r=!1){this.subscribed={},this.pulled={},this.pushed={},this.rpcTicket=0,this.unsafe=r;}uniqueRpcTopic(r){return r+OF+this.rpcTicket++;}publish(r,e,t,n){let i=this.subscribed[r];if(i){let s;for(let o of i)o.running()?o.execute(e,t,n,this.unsafe):(s=s||new Array(),s.push(o));if(s)for(let o of s)NF(i,o);}else console.debug("no sub on topic: "+r);}subscribe(r,e){let t=new Yw(e);return P0(this.subscribed,r).push(t),t;}push(r,e,t,n){let i=!1,s=this.pulled[r];if(s){for(;s.length>0;){let o=s.shift();if(o.running()){o.execute(e,t,n,this.unsafe),i=!0;break;}}s.length===0&&delete this.pulled[r];}i||P0(this.pushed,r).push({message:e,bridge:t,source:Va(n)});}pull(r,e){let t=new Yw(e),n=this.pushed[r];if(n){let i=n.shift();t.execute(i.message,i.bridge,Wa(i.source),this.unsafe),n.length===0&&delete this.pushed[r];}else P0(this.pulled,r).push(t);return t;}pullA(r){return new Promise(e=>{this.pull(r,(t,n,i)=>{e({message:t,bridge:n,source:Va(i)});});});}rpcService(r,e){this.subscribe(r,(t,n,i)=>{let{message:s,reply:o}=t;try{let a=e(s);a instanceof Promise?a.then(l=>{this.rpcReply(l,o,n,i);},l=>{console.error(l),this.rpcReply(void 0,o,n,i);}):this.rpcReply(a,o,n,i);}catch(a){console.error(a),this.rpcReply(void 0,o,n,i);}});}rpcCall(r,e,t=Fw){return new Promise((n,i)=>{let s=Io.push({timeout:performance.now()+t,reject:i,topic:r}),o=this.uniqueRpcTopic(r);this.publish(r,{message:e,reply:o}),this.pull(o,(a,l,u)=>{n({message:a,bridge:l,source:Va(u)}),Io.remove(s);});});}rpcReply(r,e,t,n){t?t.push(e,r,n):this.push(e,r);}},FF="_MSG_BUS_RPC_";function B0(r,e){let t=0,n=r.length;for(let i=0;i<n;i++)r[i]===e&&(r.splice(i,1),i--,n--,t++);return t;}function $a(r,e){return qF(r,e,()=>[]);}function qF(r,e,t){let n=r[e];return n!==void 0||(n=t(e),r[e]=n),n;}var Of=class{constructor(r,e){this.callback=r,this.unsafe=e,this.isRunning=!0;}cancel(){this.isRunning=!1;}running(){return this.isRunning;}async execute(r){try{r=this.unsafe?r:Lf(r),this.callback(r);}catch(e){console.error(e);}}},zF=Date.now()-performance.now(),Xw=new ArrayBuffer(10),YF=new Float64Array(Xw,0,1),I0=new Uint8Array(Xw),Vw=-1,A0=0;function C0(){let r=zF+performance.now();return YF[0]=r,r===Vw?A0++:(A0=0,Vw=r),I0[8]=Math.random()*1e3,I0[9]=A0,btoa(String.fromCharCode(...I0));}var Ww=class{constructor(r=C0()){this.uuid=r,this.rpcTicket=0;}subscribeOnce(r,e){let t=this.subscribe(r,n=>{t.cancel(),e(n);});return t;}pullA(r){return new Promise(e=>{this.pull(r,e);});}rpcService(r,e){let t=n=>{try{let{message:i,replyTopic:s}=n;try{let o=e(i);o instanceof Promise?o.then(a=>{this.publish(s,{success:!0,result:a});}).catch(a=>{console.error(a),this.publish(s,{success:!1,err:String(a)});}):this.publish(s,{success:!0,result:o});}catch(o){this.publish(s,{success:!1,err:String(o)});}}finally{this.pull(r,t);}};this.pull(r,t);}rpcCall(r,e,t=0){let n=new Promise((i,s)=>{let o=`${FF}-${r}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce(o,a=>{a.success?i(a.result):s(new Error(a.err));}),this.push(r,{message:e,replyTopic:o});});return t>0?Promise.race([n,new Promise((i,s)=>{setTimeout(s,t);})]):n;}},XF=class extends Ww{constructor(r=!1){super(),this.unsafe=r,this.subscribed={},this.pulled={},this.pushed={};}publish(r,e){let t=this.subscribed[r];if(t){let n;for(let i of t)i.running()?i.execute(e):(n=n||new Array(),n.push(i));if(n)for(let i of n)B0(t,i);}}subscribe(r,e){let t=new Of(e,this.unsafe);return $a(this.subscribed,r).push(t),t;}push(r,e){let t=!1,n=this.pulled[r];if(n){for(;n.length>0;){let i=n.shift();if(i&&i.running()){i.execute(e),t=!0;break;}}n.length===0&&delete this.pulled[r];}t||$a(this.pushed,r).push(e);}pull(r,e){let t=new Of(e,this.unsafe);return this.repull(r,t),t;}repull(r,e){let t=this.pushed[r];if(t){let n=t.shift();n&&(e.execute(n),t.length===0&&delete this.pushed[r]);}else $a(this.pulled,r).push(e);}},VF=class extends Ww{constructor(r=C0()){super(r),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0;}publish(r,e){console.debug("BC",this.uuid,"PUBLISH",r,e),this.broadcastPublish(r,e);}subscribe(r,e){console.debug("BC",this.uuid,"SUBSCRIBE",r);let t=new Of(e,!0);return $a(this.subscribed,r).push(t),t;}push(r,e){let t=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",r,`(${t})`,e),$a(this.pushed,r).push({id:t,message:e}),this.broadcastPushedHeadMessage(r);}pull(r,e){console.debug("BC",this.uuid,"PULL",r);let t=new Of(e,!0);return $a(this.pulled,r).push(t),this.broadcastWhoHas(r),t;}broadcastPushedHeadMessage(r){let e=this.pushed[r];e&&e[0]&&this.broadcastIHave(r,e[0].id);}onReceivedPublish(r,e,t){console.debug("BCMSG(",this.uuid,")","from",r,"PUBLISH",e,"message",t);let n=this.subscribed[e];if(n){let i;for(let s of n)s.running()?s.execute(t):(i=i||new Array(),i.push(s));if(i)for(let s of i)B0(n,s);n.length===0&&delete this.subscribed[e];}}onReceivedWhoHas(r,e){console.debug("BCMSG(",this.uuid,")","from",r,"WHOHAS",e),this.broadcastPushedHeadMessage(e);}onReceivedIHave(r,e,t){console.debug("BCMSG(",this.uuid,")","from",r,"IHAVE",e,"id",t);let n=this.pulled[e];if(n){let i;for(let s of n)if(s.running()){this.broadcastINeed(e,r,t);break;}else i=i||new Array(),i.push(s);if(i)for(let s of i)B0(n,s);n.length===0&&delete this.pulled[e];}}onReceivedINeed(r,e,t,n){if(console.debug("BCMSG(",this.uuid,")","from",r,"INEED",e,"source",t,"id",n),this.uuid===t){let i=this.pushed[e];if(i&&i[0]&&i[0].id===n){let{message:s}=i.shift();this.broadcastIGive(e,n,r,s),this.broadcastPushedHeadMessage(e),i.length===0&&delete this.pushed[e];}}}onReceivedIGive(r,e,t,n,i){console.debug("BCMSG(",this.uuid,")","from",r,"IGIVE",e,"id",t,"target",n,"message",i);let s=this.pulled[e];if(s&&this.uuid===n){let o=!1;for(;s.length>0;){let a=s.shift();if(a.running()){a.execute(i),o=!0;break;}}o||this.push(e,i),s.length===0&&delete this.pulled[e];}}},WF=class extends VF{constructor(r,e=C0()){super(e),this.bc=new BroadcastChannel(r),this.bc.onmessage=t=>{this.onMessage(t.data);};}onMessage(r){let{type:e,uuid:t,topic:n}=r;switch(e){case"PUBLISH":{let{message:i}=r;this.onReceivedPublish(t,n,i);break;}case"WHOHAS":{this.onReceivedWhoHas(t,n);break;}case"IHAVE":{let{id:i}=r;this.onReceivedIHave(t,n,i);break;}case"INEED":{let{source:i,id:s}=r;this.onReceivedINeed(t,n,i,s);break;}case"IGIVE":{let{target:i,id:s,message:o}=r;this.onReceivedIGive(t,n,s,i,o);break;}default:console.warn("unsupported",r);}}broadcastPublish(r,e){this.post({type:"PUBLISH",uuid:this.uuid,topic:r,message:e});}broadcastWhoHas(r){this.post({type:"WHOHAS",uuid:this.uuid,topic:r});}broadcastIHave(r,e){this.post({type:"IHAVE",uuid:this.uuid,topic:r,id:e});}broadcastINeed(r,e,t){this.post({type:"INEED",uuid:this.uuid,topic:r,source:e,id:t});}broadcastIGive(r,e,t,n){this.post({type:"IGIVE",uuid:this.uuid,topic:r,id:e,target:t,message:n});}post(r){this.bc.postMessage(r),Promise.resolve().then(()=>{this.onMessage(r);});}};});var iP=G((nRe,nP)=>{"use strict";var gg=Object.defineProperty,EY=Object.getOwnPropertyDescriptor,PY=Object.getOwnPropertyNames,_Y=Object.prototype.hasOwnProperty,SY=(r,e)=>{for(var t in e)gg(r,t,{get:e[t],enumerable:!0});},BY=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of PY(e))!_Y.call(r,i)&&i!==t&&gg(r,i,{get:()=>e[i],enumerable:!(n=EY(e,i))||n.enumerable});return r;},IY=r=>BY(gg({},"__esModule",{value:!0}),r),tP={};SY(tP,{Occapi:()=>MY}),nP.exports=IY(tP);var rP={},AY=(()=>{var r=rP.url;return function(e){e=e||{};var t=typeof e<"u"?e:{},n=Object.assign,i,s;t.ready=new Promise(function(x,w){i=x,s=w;});var o=n({},t),a=[],l="./this.program",u=(x,w)=>{throw w;},c=!0,h=!1,d="";function f(x){return t.locateFile?t.locateFile(x,d):d+x;}var p,m,g,b;(c||h)&&(h?d=self.location.href:typeof document<"u"&&document.currentScript&&(d=document.currentScript.src),r&&(d=r),d.indexOf("blob:")!==0?d=d.substr(0,d.replace(/[?#].*/,"").lastIndexOf("/")+1):d="",p=x=>{var w=new XMLHttpRequest();return w.open("GET",x,!1),w.send(null),w.responseText;},h&&(g=x=>{var w=new XMLHttpRequest();return w.open("GET",x,!1),w.responseType="arraybuffer",w.send(null),new Uint8Array(w.response);}),m=(x,w,_)=>{var A=new XMLHttpRequest();A.open("GET",x,!0),A.responseType="arraybuffer",A.onload=()=>{if(A.status==200||A.status==0&&A.response){w(A.response);return;}_();},A.onerror=_,A.send(null);},b=x=>document.title=x);var y=t.print||console.log.bind(console),v=t.printErr||console.warn.bind(console);n(t,o),o=null,t.arguments&&(a=t.arguments),t.thisProgram&&(l=t.thisProgram),t.quit&&(u=t.quit);function E(x){E.shown||(E.shown={}),E.shown[x]||(E.shown[x]=1,v(x));}var P=0,M=x=>{P=x;},I=()=>P,C;t.wasmBinary&&(C=t.wasmBinary);var L=t.noExitRuntime||!0,S,T=!1,B;function $(x,w){x||Ri(w);}function Z(x){var w=t["_"+x];return w;}function H(x,w,_,A,O){var z={string:function(Ge){var bt=0;if(Ge!=null&&Ge!==0){var yt=(Ge.length<<2)+1;bt=Rl(yt),ie(Ge,bt,yt);}return bt;},array:function(Ge){var bt=Rl(Ge.length);return R(Ge,bt),bt;}};function X(Ge){return w==="string"?D(Ge):w==="boolean"?Boolean(Ge):Ge;}var te=Z(x),ae=[],de=0;if(A)for(var Be=0;Be<A.length;Be++){var _e=z[_[Be]];_e?(de===0&&(de=lo()),ae[Be]=_e(A[Be])):ae[Be]=A[Be];}var ge=te.apply(null,ae);function Te(Ge){return de!==0&&uo(de),X(Ge);}return ge=Te(ge),ge;}function W(x,w,_,A){_=_||[];var O=_.every(function(X){return X==="number";}),z=w!=="string";return z&&O&&!A?Z(x):function(){return H(x,w,_,arguments,A);};}var Y=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function U(x,w,_){for(var A=w+_,O=w;x[O]&&!(O>=A);)++O;if(O-w>16&&x.subarray&&Y)return Y.decode(x.subarray(w,O));for(var z="";w<O;){var X=x[w++];if(!(X&128)){z+=String.fromCharCode(X);continue;}var te=x[w++]&63;if((X&224)==192){z+=String.fromCharCode((X&31)<<6|te);continue;}var ae=x[w++]&63;if((X&240)==224?X=(X&15)<<12|te<<6|ae:X=(X&7)<<18|te<<12|ae<<6|x[w++]&63,X<65536)z+=String.fromCharCode(X);else{var de=X-65536;z+=String.fromCharCode(55296|de>>10,56320|de&1023);}}return z;}function D(x,w){return x?U(re,x,w):"";}function k(x,w,_,A){if(!(A>0))return 0;for(var O=_,z=_+A-1,X=0;X<x.length;++X){var te=x.charCodeAt(X);if(te>=55296&&te<=57343){var ae=x.charCodeAt(++X);te=65536+((te&1023)<<10)|ae&1023;}if(te<=127){if(_>=z)break;w[_++]=te;}else if(te<=2047){if(_+1>=z)break;w[_++]=192|te>>6,w[_++]=128|te&63;}else if(te<=65535){if(_+2>=z)break;w[_++]=224|te>>12,w[_++]=128|te>>6&63,w[_++]=128|te&63;}else{if(_+3>=z)break;w[_++]=240|te>>18,w[_++]=128|te>>12&63,w[_++]=128|te>>6&63,w[_++]=128|te&63;}}return w[_]=0,_-O;}function ie(x,w,_){return k(x,re,w,_);}function se(x){for(var w=0,_=0;_<x.length;++_){var A=x.charCodeAt(_);A>=55296&&A<=57343&&(A=65536+((A&1023)<<10)|x.charCodeAt(++_)&1023),A<=127?++w:A<=2047?w+=2:A<=65535?w+=3:w+=4;}return w;}var oe=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function le(x,w){for(var _=x,A=_>>1,O=A+w/2;!(A>=O)&&ve[A];)++A;if(_=A<<1,_-x>32&&oe)return oe.decode(re.subarray(x,_));for(var z="",X=0;!(X>=w/2);++X){var te=he[x+X*2>>1];if(te==0)break;z+=String.fromCharCode(te);}return z;}function Ee(x,w,_){if(_===void 0&&(_=2147483647),_<2)return 0;_-=2;for(var A=w,O=_<x.length*2?_/2:x.length,z=0;z<O;++z){var X=x.charCodeAt(z);he[w>>1]=X,w+=2;}return he[w>>1]=0,w-A;}function be(x){return x.length*2;}function xe(x,w){for(var _=0,A="";!(_>=w/4);){var O=Q[x+_*4>>2];if(O==0)break;if(++_,O>=65536){var z=O-65536;A+=String.fromCharCode(55296|z>>10,56320|z&1023);}else A+=String.fromCharCode(O);}return A;}function Oe(x,w,_){if(_===void 0&&(_=2147483647),_<4)return 0;for(var A=w,O=A+_-4,z=0;z<x.length;++z){var X=x.charCodeAt(z);if(X>=55296&&X<=57343){var te=x.charCodeAt(++z);X=65536+((X&1023)<<10)|te&1023;}if(Q[w>>2]=X,w+=4,w+4>O)break;}return Q[w>>2]=0,w-A;}function Re(x){for(var w=0,_=0;_<x.length;++_){var A=x.charCodeAt(_);A>=55296&&A<=57343&&++_,w+=4;}return w;}function Ve(x){var w=se(x)+1,_=Oi(w);return _&&k(x,j,_,w),_;}function lt(x){var w=se(x)+1,_=Rl(w);return k(x,j,_,w),_;}function R(x,w){j.set(x,w);}function me(x,w,_){for(var A=0;A<x.length;++A)j[w++>>0]=x.charCodeAt(A);_||(j[w>>0]=0);}function fe(x,w){return x%w>0&&(x+=w-x%w),x;}var K,j,re,he,ve,Q,Pe,Ue,Ae;function Ze(x){K=x,t.HEAP8=j=new Int8Array(x),t.HEAP16=he=new Int16Array(x),t.HEAP32=Q=new Int32Array(x),t.HEAPU8=re=new Uint8Array(x),t.HEAPU16=ve=new Uint16Array(x),t.HEAPU32=Pe=new Uint32Array(x),t.HEAPF32=Ue=new Float32Array(x),t.HEAPF64=Ae=new Float64Array(x);}var Gt=t.INITIAL_MEMORY||16777216,xt,Gr=[],ds=[],Sn=[],ps=[],Qt=!1,io=!1,Cl=0;function hn(){return L||Cl>0;}function _c(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)so(t.preRun.shift());Ic(Gr);}function Up(){Qt=!0,!t.noFSInit&&!N.init.initialized&&N.init(),N.ignorePermissions=!1,ms.init(),Ic(ds);}function Dp(){Ic(Sn);}function Gp(){io=!0;}function Sc(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)CO(t.postRun.shift());Ic(ps);}function so(x){Gr.unshift(x);}function Ho(x){ds.unshift(x);}function CO(x){ps.unshift(x);}var oo=0,Fp=null,Ml=null;function fse(x){return x;}function qp(x){oo++,t.monitorRunDependencies&&t.monitorRunDependencies(oo);}function Bc(x){if(oo--,t.monitorRunDependencies&&t.monitorRunDependencies(oo),oo==0&&(Fp!==null&&(clearInterval(Fp),Fp=null),Ml)){var w=Ml;Ml=null,w();}}t.preloadedImages={},t.preloadedAudios={};function Ri(x){t.onAbort&&t.onAbort(x),x="Aborted("+x+")",v(x),T=!0,B=1,x+=". Build with -s ASSERTIONS=1 for more info.";var w=new WebAssembly.RuntimeError(x);throw s(w),w;}var MO="data:application/octet-stream;base64,";function lb(x){return x.startsWith(MO);}var Bn;t.locateFile?(Bn="occapi.wasm",lb(Bn)||(Bn=f(Bn))):Bn=new URL("occapi.wasm",rP.url).toString();function ub(x){try{if(x==Bn&&C)return new Uint8Array(C);if(g)return g(x);throw"both async and sync fetching of the wasm failed";}catch(w){Ri(w);}}function TO(){return!C&&(c||h)&&typeof fetch=="function"?fetch(Bn,{credentials:"same-origin"}).then(function(x){if(!x.ok)throw"failed to load wasm binary file at '"+Bn+"'";return x.arrayBuffer();}).catch(function(){return ub(Bn);}):Promise.resolve().then(function(){return ub(Bn);});}function RO(){var x={a:pU};function w(X,te){var ae=X.exports;t.asm=ae,S=t.asm.ea,Ze(S.buffer),xt=t.asm.ia,Ho(t.asm.fa),Bc("wasm-instantiate");}qp("wasm-instantiate");function _(X){w(X.instance);}function A(X){return TO().then(function(te){return WebAssembly.instantiate(te,x);}).then(function(te){return te;}).then(X,function(te){v("failed to asynchronously prepare wasm: "+te),Ri(te);});}function O(){return!C&&typeof WebAssembly.instantiateStreaming=="function"&&!lb(Bn)&&typeof fetch=="function"?fetch(Bn,{credentials:"same-origin"}).then(function(X){var te=WebAssembly.instantiateStreaming(X,x);return te.then(_,function(ae){return v("wasm streaming compile failed: "+ae),v("falling back to ArrayBuffer instantiation"),A(_);});}):A(_);}if(t.instantiateWasm)try{var z=t.instantiateWasm(x,w);return z;}catch(X){return v("Module.instantiateWasm callback failed with error: "+X),!1;}return O().catch(s),{};}var Ot,Fr;function NO(){return t.HEAP8.length;}function LO(x){t.exportProgress!=null&&t.exportProgress!=null&&t.exportProgress(x);}function Ic(x){for(;x.length>0;){var w=x.shift();if(typeof w=="function"){w(t);continue;}var _=w.func;typeof _=="number"?w.arg===void 0?Ni(_)():Ni(_)(w.arg):_(w.arg===void 0?null:w.arg);}}var Ac=[];function Ni(x){var w=Ac[x];return w||(x>=Ac.length&&(Ac.length=x+1),Ac[x]=w=xt.get(x)),w;}function zp(x){if(x instanceof Cb||x=="unwind")return B;u(1,x);}function OO(){var x=new Error();if(!x.stack){try{throw new Error();}catch(w){x=w;}if(!x.stack)return"(no stack trace available)";}return x.stack.toString();}function kO(x,w,_,A){Ri("Assertion failed: "+D(x)+", at: "+[w?D(w):"unknown filename",_,A?D(A):"unknown function"]);}var Mt={splitPath:function(x){var w=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return w.exec(x).slice(1);},normalizeArray:function(x,w){for(var _=0,A=x.length-1;A>=0;A--){var O=x[A];O==="."?x.splice(A,1):O===".."?(x.splice(A,1),_++):_&&(x.splice(A,1),_--);}if(w)for(;_;_--)x.unshift("..");return x;},normalize:function(x){var w=x.charAt(0)==="/",_=x.substr(-1)==="/";return x=Mt.normalizeArray(x.split("/").filter(function(A){return!!A;}),!w).join("/"),!x&&!w&&(x="."),x&&_&&(x+="/"),(w?"/":"")+x;},dirname:function(x){var w=Mt.splitPath(x),_=w[0],A=w[1];return!_&&!A?".":(A&&(A=A.substr(0,A.length-1)),_+A);},basename:function(x){if(x==="/")return"/";x=Mt.normalize(x),x=x.replace(/\/$/,"");var w=x.lastIndexOf("/");return w===-1?x:x.substr(w+1);},extname:function(x){return Mt.splitPath(x)[3];},join:function(){var x=Array.prototype.slice.call(arguments,0);return Mt.normalize(x.join("/"));},join2:function(x,w){return Mt.normalize(x+"/"+w);}};function UO(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var x=new Uint8Array(1);return function(){return crypto.getRandomValues(x),x[0];};}else return function(){Ri("randomDevice");};}var li={resolve:function(){for(var x="",w=!1,_=arguments.length-1;_>=-1&&!w;_--){var A=_>=0?arguments[_]:N.cwd();if(typeof A!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!A)return"";x=A+"/"+x,w=A.charAt(0)==="/";}return x=Mt.normalizeArray(x.split("/").filter(function(O){return!!O;}),!w).join("/"),(w?"/":"")+x||".";},relative:function(x,w){x=li.resolve(x).substr(1),w=li.resolve(w).substr(1);function _(de){for(var Be=0;Be<de.length&&de[Be]==="";Be++);for(var _e=de.length-1;_e>=0&&de[_e]==="";_e--);return Be>_e?[]:de.slice(Be,_e-Be+1);}for(var A=_(x.split("/")),O=_(w.split("/")),z=Math.min(A.length,O.length),X=z,te=0;te<z;te++)if(A[te]!==O[te]){X=te;break;}for(var ae=[],te=X;te<A.length;te++)ae.push("..");return ae=ae.concat(O.slice(X)),ae.join("/");}},ms={ttys:[],init:function(){},shutdown:function(){},register:function(x,w){ms.ttys[x]={input:[],output:[],ops:w},N.registerDevice(x,ms.stream_ops);},stream_ops:{open:function(x){var w=ms.ttys[x.node.rdev];if(!w)throw new N.ErrnoError(43);x.tty=w,x.seekable=!1;},close:function(x){x.tty.ops.flush(x.tty);},flush:function(x){x.tty.ops.flush(x.tty);},read:function(x,w,_,A,O){if(!x.tty||!x.tty.ops.get_char)throw new N.ErrnoError(60);for(var z=0,X=0;X<A;X++){var te;try{te=x.tty.ops.get_char(x.tty);}catch{throw new N.ErrnoError(29);}if(te===void 0&&z===0)throw new N.ErrnoError(6);if(te==null)break;z++,w[_+X]=te;}return z&&(x.node.timestamp=Date.now()),z;},write:function(x,w,_,A,O){if(!x.tty||!x.tty.ops.put_char)throw new N.ErrnoError(60);try{for(var z=0;z<A;z++)x.tty.ops.put_char(x.tty,w[_+z]);}catch{throw new N.ErrnoError(29);}return A&&(x.node.timestamp=Date.now()),z;}},default_tty_ops:{get_char:function(x){if(!x.input.length){var w=null;if(typeof window<"u"&&typeof window.prompt=="function"?(w=window.prompt("Input: "),w!==null&&(w+=`
`)):typeof readline=="function"&&(w=readline(),w!==null&&(w+=`
`)),!w)return null;x.input=Dc(w,!0);}return x.input.shift();},put_char:function(x,w){w===null||w===10?(y(U(x.output,0)),x.output=[]):w!=0&&x.output.push(w);},flush:function(x){x.output&&x.output.length>0&&(y(U(x.output,0)),x.output=[]);}},default_tty1_ops:{put_char:function(x,w){w===null||w===10?(v(U(x.output,0)),x.output=[]):w!=0&&x.output.push(w);},flush:function(x){x.output&&x.output.length>0&&(v(U(x.output,0)),x.output=[]);}}};function DO(x,w){re.fill(0,x,x+w);}function GO(x,w){return Math.ceil(x/w)*w;}function cb(x){x=GO(x,65536);var w=Ab(65536,x);return w?(DO(w,x),w):0;}var ut={ops_table:null,mount:function(x){return ut.createNode(null,"/",16895,0);},createNode:function(x,w,_,A){if(N.isBlkdev(_)||N.isFIFO(_))throw new N.ErrnoError(63);ut.ops_table||(ut.ops_table={dir:{node:{getattr:ut.node_ops.getattr,setattr:ut.node_ops.setattr,lookup:ut.node_ops.lookup,mknod:ut.node_ops.mknod,rename:ut.node_ops.rename,unlink:ut.node_ops.unlink,rmdir:ut.node_ops.rmdir,readdir:ut.node_ops.readdir,symlink:ut.node_ops.symlink},stream:{llseek:ut.stream_ops.llseek}},file:{node:{getattr:ut.node_ops.getattr,setattr:ut.node_ops.setattr},stream:{llseek:ut.stream_ops.llseek,read:ut.stream_ops.read,write:ut.stream_ops.write,allocate:ut.stream_ops.allocate,mmap:ut.stream_ops.mmap,msync:ut.stream_ops.msync}},link:{node:{getattr:ut.node_ops.getattr,setattr:ut.node_ops.setattr,readlink:ut.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ut.node_ops.getattr,setattr:ut.node_ops.setattr},stream:N.chrdev_stream_ops}});var O=N.createNode(x,w,_,A);return N.isDir(O.mode)?(O.node_ops=ut.ops_table.dir.node,O.stream_ops=ut.ops_table.dir.stream,O.contents={}):N.isFile(O.mode)?(O.node_ops=ut.ops_table.file.node,O.stream_ops=ut.ops_table.file.stream,O.usedBytes=0,O.contents=null):N.isLink(O.mode)?(O.node_ops=ut.ops_table.link.node,O.stream_ops=ut.ops_table.link.stream):N.isChrdev(O.mode)&&(O.node_ops=ut.ops_table.chrdev.node,O.stream_ops=ut.ops_table.chrdev.stream),O.timestamp=Date.now(),x&&(x.contents[w]=O,x.timestamp=O.timestamp),O;},getFileDataAsTypedArray:function(x){return x.contents?x.contents.subarray?x.contents.subarray(0,x.usedBytes):new Uint8Array(x.contents):new Uint8Array(0);},expandFileStorage:function(x,w){var _=x.contents?x.contents.length:0;if(!(_>=w)){var A=1024*1024;w=Math.max(w,_*(_<A?2:1.125)>>>0),_!=0&&(w=Math.max(w,256));var O=x.contents;x.contents=new Uint8Array(w),x.usedBytes>0&&x.contents.set(O.subarray(0,x.usedBytes),0);}},resizeFileStorage:function(x,w){if(x.usedBytes!=w)if(w==0)x.contents=null,x.usedBytes=0;else{var _=x.contents;x.contents=new Uint8Array(w),_&&x.contents.set(_.subarray(0,Math.min(w,x.usedBytes))),x.usedBytes=w;}},node_ops:{getattr:function(x){var w={};return w.dev=N.isChrdev(x.mode)?x.id:1,w.ino=x.id,w.mode=x.mode,w.nlink=1,w.uid=0,w.gid=0,w.rdev=x.rdev,N.isDir(x.mode)?w.size=4096:N.isFile(x.mode)?w.size=x.usedBytes:N.isLink(x.mode)?w.size=x.link.length:w.size=0,w.atime=new Date(x.timestamp),w.mtime=new Date(x.timestamp),w.ctime=new Date(x.timestamp),w.blksize=4096,w.blocks=Math.ceil(w.size/w.blksize),w;},setattr:function(x,w){w.mode!==void 0&&(x.mode=w.mode),w.timestamp!==void 0&&(x.timestamp=w.timestamp),w.size!==void 0&&ut.resizeFileStorage(x,w.size);},lookup:function(x,w){throw N.genericErrors[44];},mknod:function(x,w,_,A){return ut.createNode(x,w,_,A);},rename:function(x,w,_){if(N.isDir(x.mode)){var A;try{A=N.lookupNode(w,_);}catch{}if(A)for(var O in A.contents)throw new N.ErrnoError(55);}delete x.parent.contents[x.name],x.parent.timestamp=Date.now(),x.name=_,w.contents[_]=x,w.timestamp=x.parent.timestamp,x.parent=w;},unlink:function(x,w){delete x.contents[w],x.timestamp=Date.now();},rmdir:function(x,w){var _=N.lookupNode(x,w);for(var A in _.contents)throw new N.ErrnoError(55);delete x.contents[w],x.timestamp=Date.now();},readdir:function(x){var w=[".",".."];for(var _ in x.contents)!x.contents.hasOwnProperty(_)||w.push(_);return w;},symlink:function(x,w,_){var A=ut.createNode(x,w,41471,0);return A.link=_,A;},readlink:function(x){if(!N.isLink(x.mode))throw new N.ErrnoError(28);return x.link;}},stream_ops:{read:function(x,w,_,A,O){var z=x.node.contents;if(O>=x.node.usedBytes)return 0;var X=Math.min(x.node.usedBytes-O,A);if(X>8&&z.subarray)w.set(z.subarray(O,O+X),_);else for(var te=0;te<X;te++)w[_+te]=z[O+te];return X;},write:function(x,w,_,A,O,z){if(w.buffer===j.buffer&&(z=!1),!A)return 0;var X=x.node;if(X.timestamp=Date.now(),w.subarray&&(!X.contents||X.contents.subarray)){if(z)return X.contents=w.subarray(_,_+A),X.usedBytes=A,A;if(X.usedBytes===0&&O===0)return X.contents=w.slice(_,_+A),X.usedBytes=A,A;if(O+A<=X.usedBytes)return X.contents.set(w.subarray(_,_+A),O),A;}if(ut.expandFileStorage(X,O+A),X.contents.subarray&&w.subarray)X.contents.set(w.subarray(_,_+A),O);else for(var te=0;te<A;te++)X.contents[O+te]=w[_+te];return X.usedBytes=Math.max(X.usedBytes,O+A),A;},llseek:function(x,w,_){var A=w;if(_===1?A+=x.position:_===2&&N.isFile(x.node.mode)&&(A+=x.node.usedBytes),A<0)throw new N.ErrnoError(28);return A;},allocate:function(x,w,_){ut.expandFileStorage(x.node,w+_),x.node.usedBytes=Math.max(x.node.usedBytes,w+_);},mmap:function(x,w,_,A,O,z){if(w!==0)throw new N.ErrnoError(28);if(!N.isFile(x.node.mode))throw new N.ErrnoError(43);var X,te,ae=x.node.contents;if(!(z&2)&&ae.buffer===K)te=!1,X=ae.byteOffset;else{if((A>0||A+_<ae.length)&&(ae.subarray?ae=ae.subarray(A,A+_):ae=Array.prototype.slice.call(ae,A,A+_)),te=!0,X=cb(_),!X)throw new N.ErrnoError(48);j.set(ae,X);}return{ptr:X,allocated:te};},msync:function(x,w,_,A,O){if(!N.isFile(x.node.mode))throw new N.ErrnoError(43);if(O&2)return 0;var z=ut.stream_ops.write(x,w,0,A,_,!1);return 0;}}};function FO(x,w,_,A){var O=A?"":"al "+x;m(x,function(z){$(z,'Loading data file "'+x+'" failed (no arrayBuffer).'),w(new Uint8Array(z)),O&&Bc(O);},function(z){if(_)_();else throw'Loading data file "'+x+'" failed.';}),O&&qp(O);}var N={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(x,w={})=>{if(x=li.resolve(N.cwd(),x),!x)return{path:"",node:null};var _={follow_mount:!0,recurse_count:0};for(var A in _)w[A]===void 0&&(w[A]=_[A]);if(w.recurse_count>8)throw new N.ErrnoError(32);for(var O=Mt.normalizeArray(x.split("/").filter(ge=>!!ge),!1),z=N.root,X="/",te=0;te<O.length;te++){var ae=te===O.length-1;if(ae&&w.parent)break;if(z=N.lookupNode(z,O[te]),X=Mt.join2(X,O[te]),N.isMountpoint(z)&&(!ae||ae&&w.follow_mount)&&(z=z.mounted.root),!ae||w.follow)for(var de=0;N.isLink(z.mode);){var Be=N.readlink(X);X=li.resolve(Mt.dirname(X),Be);var _e=N.lookupPath(X,{recurse_count:w.recurse_count});if(z=_e.node,de++>40)throw new N.ErrnoError(32);}}return{path:X,node:z};},getPath:x=>{for(var w;;){if(N.isRoot(x)){var _=x.mount.mountpoint;return w?_[_.length-1]!=="/"?_+"/"+w:_+w:_;}w=w?x.name+"/"+w:x.name,x=x.parent;}},hashName:(x,w)=>{for(var _=0,A=0;A<w.length;A++)_=(_<<5)-_+w.charCodeAt(A)|0;return(x+_>>>0)%N.nameTable.length;},hashAddNode:x=>{var w=N.hashName(x.parent.id,x.name);x.name_next=N.nameTable[w],N.nameTable[w]=x;},hashRemoveNode:x=>{var w=N.hashName(x.parent.id,x.name);if(N.nameTable[w]===x)N.nameTable[w]=x.name_next;else for(var _=N.nameTable[w];_;){if(_.name_next===x){_.name_next=x.name_next;break;}_=_.name_next;}},lookupNode:(x,w)=>{var _=N.mayLookup(x);if(_)throw new N.ErrnoError(_,x);for(var A=N.hashName(x.id,w),O=N.nameTable[A];O;O=O.name_next){var z=O.name;if(O.parent.id===x.id&&z===w)return O;}return N.lookup(x,w);},createNode:(x,w,_,A)=>{var O=new N.FSNode(x,w,_,A);return N.hashAddNode(O),O;},destroyNode:x=>{N.hashRemoveNode(x);},isRoot:x=>x===x.parent,isMountpoint:x=>!!x.mounted,isFile:x=>(x&61440)===32768,isDir:x=>(x&61440)===16384,isLink:x=>(x&61440)===40960,isChrdev:x=>(x&61440)===8192,isBlkdev:x=>(x&61440)===24576,isFIFO:x=>(x&61440)===4096,isSocket:x=>(x&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:x=>{var w=N.flagModes[x];if(typeof w>"u")throw new Error("Unknown file open mode: "+x);return w;},flagsToPermissionString:x=>{var w=["r","w","rw"][x&3];return x&512&&(w+="w"),w;},nodePermissions:(x,w)=>N.ignorePermissions?0:w.includes("r")&&!(x.mode&292)||w.includes("w")&&!(x.mode&146)||w.includes("x")&&!(x.mode&73)?2:0,mayLookup:x=>{var w=N.nodePermissions(x,"x");return w||(x.node_ops.lookup?0:2);},mayCreate:(x,w)=>{try{var _=N.lookupNode(x,w);return 20;}catch{}return N.nodePermissions(x,"wx");},mayDelete:(x,w,_)=>{var A;try{A=N.lookupNode(x,w);}catch(z){return z.errno;}var O=N.nodePermissions(x,"wx");if(O)return O;if(_){if(!N.isDir(A.mode))return 54;if(N.isRoot(A)||N.getPath(A)===N.cwd())return 10;}else if(N.isDir(A.mode))return 31;return 0;},mayOpen:(x,w)=>x?N.isLink(x.mode)?32:N.isDir(x.mode)&&(N.flagsToPermissionString(w)!=="r"||w&512)?31:N.nodePermissions(x,N.flagsToPermissionString(w)):44,MAX_OPEN_FDS:4096,nextfd:(x=0,w=N.MAX_OPEN_FDS)=>{for(var _=x;_<=w;_++)if(!N.streams[_])return _;throw new N.ErrnoError(33);},getStream:x=>N.streams[x],createStream:(x,w,_)=>{N.FSStream||(N.FSStream=function(){},N.FSStream.prototype={object:{get:function(){return this.node;},set:function(X){this.node=X;}},isRead:{get:function(){return(this.flags&2097155)!==1;}},isWrite:{get:function(){return(this.flags&2097155)!==0;}},isAppend:{get:function(){return this.flags&1024;}}});var A=new N.FSStream();for(var O in x)A[O]=x[O];x=A;var z=N.nextfd(w,_);return x.fd=z,N.streams[z]=x,x;},closeStream:x=>{N.streams[x]=null;},chrdev_stream_ops:{open:x=>{var w=N.getDevice(x.node.rdev);x.stream_ops=w.stream_ops,x.stream_ops.open&&x.stream_ops.open(x);},llseek:()=>{throw new N.ErrnoError(70);}},major:x=>x>>8,minor:x=>x&255,makedev:(x,w)=>x<<8|w,registerDevice:(x,w)=>{N.devices[x]={stream_ops:w};},getDevice:x=>N.devices[x],getMounts:x=>{for(var w=[],_=[x];_.length;){var A=_.pop();w.push(A),_.push.apply(_,A.mounts);}return w;},syncfs:(x,w)=>{typeof x=="function"&&(w=x,x=!1),N.syncFSRequests++,N.syncFSRequests>1&&v("warning: "+N.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var _=N.getMounts(N.root.mount),A=0;function O(X){return N.syncFSRequests--,w(X);}function z(X){if(X)return z.errored?void 0:(z.errored=!0,O(X));++A>=_.length&&O(null);}_.forEach(X=>{if(!X.type.syncfs)return z(null);X.type.syncfs(X,x,z);});},mount:(x,w,_)=>{var A=_==="/",O=!_,z;if(A&&N.root)throw new N.ErrnoError(10);if(!A&&!O){var X=N.lookupPath(_,{follow_mount:!1});if(_=X.path,z=X.node,N.isMountpoint(z))throw new N.ErrnoError(10);if(!N.isDir(z.mode))throw new N.ErrnoError(54);}var te={type:x,opts:w,mountpoint:_,mounts:[]},ae=x.mount(te);return ae.mount=te,te.root=ae,A?N.root=ae:z&&(z.mounted=te,z.mount&&z.mount.mounts.push(te)),ae;},unmount:x=>{var w=N.lookupPath(x,{follow_mount:!1});if(!N.isMountpoint(w.node))throw new N.ErrnoError(28);var _=w.node,A=_.mounted,O=N.getMounts(A);Object.keys(N.nameTable).forEach(X=>{for(var te=N.nameTable[X];te;){var ae=te.name_next;O.includes(te.mount)&&N.destroyNode(te),te=ae;}}),_.mounted=null;var z=_.mount.mounts.indexOf(A);_.mount.mounts.splice(z,1);},lookup:(x,w)=>x.node_ops.lookup(x,w),mknod:(x,w,_)=>{var A=N.lookupPath(x,{parent:!0}),O=A.node,z=Mt.basename(x);if(!z||z==="."||z==="..")throw new N.ErrnoError(28);var X=N.mayCreate(O,z);if(X)throw new N.ErrnoError(X);if(!O.node_ops.mknod)throw new N.ErrnoError(63);return O.node_ops.mknod(O,z,w,_);},create:(x,w)=>(w=w!==void 0?w:438,w&=4095,w|=32768,N.mknod(x,w,0)),mkdir:(x,w)=>(w=w!==void 0?w:511,w&=1023,w|=16384,N.mknod(x,w,0)),mkdirTree:(x,w)=>{for(var _=x.split("/"),A="",O=0;O<_.length;++O)if(!!_[O]){A+="/"+_[O];try{N.mkdir(A,w);}catch(z){if(z.errno!=20)throw z;}}},mkdev:(x,w,_)=>(typeof _>"u"&&(_=w,w=438),w|=8192,N.mknod(x,w,_)),symlink:(x,w)=>{if(!li.resolve(x))throw new N.ErrnoError(44);var _=N.lookupPath(w,{parent:!0}),A=_.node;if(!A)throw new N.ErrnoError(44);var O=Mt.basename(w),z=N.mayCreate(A,O);if(z)throw new N.ErrnoError(z);if(!A.node_ops.symlink)throw new N.ErrnoError(63);return A.node_ops.symlink(A,O,x);},rename:(x,w)=>{var _=Mt.dirname(x),A=Mt.dirname(w),O=Mt.basename(x),z=Mt.basename(w),X,te,ae;if(X=N.lookupPath(x,{parent:!0}),te=X.node,X=N.lookupPath(w,{parent:!0}),ae=X.node,!te||!ae)throw new N.ErrnoError(44);if(te.mount!==ae.mount)throw new N.ErrnoError(75);var de=N.lookupNode(te,O),Be=li.relative(x,A);if(Be.charAt(0)!==".")throw new N.ErrnoError(28);if(Be=li.relative(w,_),Be.charAt(0)!==".")throw new N.ErrnoError(55);var _e;try{_e=N.lookupNode(ae,z);}catch{}if(de!==_e){var ge=N.isDir(de.mode),Te=N.mayDelete(te,O,ge);if(Te)throw new N.ErrnoError(Te);if(Te=_e?N.mayDelete(ae,z,ge):N.mayCreate(ae,z),Te)throw new N.ErrnoError(Te);if(!te.node_ops.rename)throw new N.ErrnoError(63);if(N.isMountpoint(de)||_e&&N.isMountpoint(_e))throw new N.ErrnoError(10);if(ae!==te&&(Te=N.nodePermissions(te,"w"),Te))throw new N.ErrnoError(Te);N.hashRemoveNode(de);try{te.node_ops.rename(de,ae,z);}catch(Ge){throw Ge;}finally{N.hashAddNode(de);}}},rmdir:x=>{var w=N.lookupPath(x,{parent:!0}),_=w.node,A=Mt.basename(x),O=N.lookupNode(_,A),z=N.mayDelete(_,A,!0);if(z)throw new N.ErrnoError(z);if(!_.node_ops.rmdir)throw new N.ErrnoError(63);if(N.isMountpoint(O))throw new N.ErrnoError(10);_.node_ops.rmdir(_,A),N.destroyNode(O);},readdir:x=>{var w=N.lookupPath(x,{follow:!0}),_=w.node;if(!_.node_ops.readdir)throw new N.ErrnoError(54);return _.node_ops.readdir(_);},unlink:x=>{var w=N.lookupPath(x,{parent:!0}),_=w.node;if(!_)throw new N.ErrnoError(44);var A=Mt.basename(x),O=N.lookupNode(_,A),z=N.mayDelete(_,A,!1);if(z)throw new N.ErrnoError(z);if(!_.node_ops.unlink)throw new N.ErrnoError(63);if(N.isMountpoint(O))throw new N.ErrnoError(10);_.node_ops.unlink(_,A),N.destroyNode(O);},readlink:x=>{var w=N.lookupPath(x),_=w.node;if(!_)throw new N.ErrnoError(44);if(!_.node_ops.readlink)throw new N.ErrnoError(28);return li.resolve(N.getPath(_.parent),_.node_ops.readlink(_));},stat:(x,w)=>{var _=N.lookupPath(x,{follow:!w}),A=_.node;if(!A)throw new N.ErrnoError(44);if(!A.node_ops.getattr)throw new N.ErrnoError(63);return A.node_ops.getattr(A);},lstat:x=>N.stat(x,!0),chmod:(x,w,_)=>{var A;if(typeof x=="string"){var O=N.lookupPath(x,{follow:!_});A=O.node;}else A=x;if(!A.node_ops.setattr)throw new N.ErrnoError(63);A.node_ops.setattr(A,{mode:w&4095|A.mode&-4096,timestamp:Date.now()});},lchmod:(x,w)=>{N.chmod(x,w,!0);},fchmod:(x,w)=>{var _=N.getStream(x);if(!_)throw new N.ErrnoError(8);N.chmod(_.node,w);},chown:(x,w,_,A)=>{var O;if(typeof x=="string"){var z=N.lookupPath(x,{follow:!A});O=z.node;}else O=x;if(!O.node_ops.setattr)throw new N.ErrnoError(63);O.node_ops.setattr(O,{timestamp:Date.now()});},lchown:(x,w,_)=>{N.chown(x,w,_,!0);},fchown:(x,w,_)=>{var A=N.getStream(x);if(!A)throw new N.ErrnoError(8);N.chown(A.node,w,_);},truncate:(x,w)=>{if(w<0)throw new N.ErrnoError(28);var _;if(typeof x=="string"){var A=N.lookupPath(x,{follow:!0});_=A.node;}else _=x;if(!_.node_ops.setattr)throw new N.ErrnoError(63);if(N.isDir(_.mode))throw new N.ErrnoError(31);if(!N.isFile(_.mode))throw new N.ErrnoError(28);var O=N.nodePermissions(_,"w");if(O)throw new N.ErrnoError(O);_.node_ops.setattr(_,{size:w,timestamp:Date.now()});},ftruncate:(x,w)=>{var _=N.getStream(x);if(!_)throw new N.ErrnoError(8);if((_.flags&2097155)===0)throw new N.ErrnoError(28);N.truncate(_.node,w);},utime:(x,w,_)=>{var A=N.lookupPath(x,{follow:!0}),O=A.node;O.node_ops.setattr(O,{timestamp:Math.max(w,_)});},open:(x,w,_,A,O)=>{if(x==="")throw new N.ErrnoError(44);w=typeof w=="string"?N.modeStringToFlags(w):w,_=typeof _>"u"?438:_,w&64?_=_&4095|32768:_=0;var z;if(typeof x=="object")z=x;else{x=Mt.normalize(x);try{var X=N.lookupPath(x,{follow:!(w&131072)});z=X.node;}catch{}}var te=!1;if(w&64)if(z){if(w&128)throw new N.ErrnoError(20);}else z=N.mknod(x,_,0),te=!0;if(!z)throw new N.ErrnoError(44);if(N.isChrdev(z.mode)&&(w&=-513),w&65536&&!N.isDir(z.mode))throw new N.ErrnoError(54);if(!te){var ae=N.mayOpen(z,w);if(ae)throw new N.ErrnoError(ae);}w&512&&N.truncate(z,0),w&=-131713;var de=N.createStream({node:z,path:N.getPath(z),flags:w,seekable:!0,position:0,stream_ops:z.stream_ops,ungotten:[],error:!1},A,O);return de.stream_ops.open&&de.stream_ops.open(de),t.logReadFiles&&!(w&1)&&(N.readFiles||(N.readFiles={}),x in N.readFiles||(N.readFiles[x]=1)),de;},close:x=>{if(N.isClosed(x))throw new N.ErrnoError(8);x.getdents&&(x.getdents=null);try{x.stream_ops.close&&x.stream_ops.close(x);}catch(w){throw w;}finally{N.closeStream(x.fd);}x.fd=null;},isClosed:x=>x.fd===null,llseek:(x,w,_)=>{if(N.isClosed(x))throw new N.ErrnoError(8);if(!x.seekable||!x.stream_ops.llseek)throw new N.ErrnoError(70);if(_!=0&&_!=1&&_!=2)throw new N.ErrnoError(28);return x.position=x.stream_ops.llseek(x,w,_),x.ungotten=[],x.position;},read:(x,w,_,A,O)=>{if(A<0||O<0)throw new N.ErrnoError(28);if(N.isClosed(x))throw new N.ErrnoError(8);if((x.flags&2097155)===1)throw new N.ErrnoError(8);if(N.isDir(x.node.mode))throw new N.ErrnoError(31);if(!x.stream_ops.read)throw new N.ErrnoError(28);var z=typeof O<"u";if(!z)O=x.position;else if(!x.seekable)throw new N.ErrnoError(70);var X=x.stream_ops.read(x,w,_,A,O);return z||(x.position+=X),X;},write:(x,w,_,A,O,z)=>{if(A<0||O<0)throw new N.ErrnoError(28);if(N.isClosed(x))throw new N.ErrnoError(8);if((x.flags&2097155)===0)throw new N.ErrnoError(8);if(N.isDir(x.node.mode))throw new N.ErrnoError(31);if(!x.stream_ops.write)throw new N.ErrnoError(28);x.seekable&&x.flags&1024&&N.llseek(x,0,2);var X=typeof O<"u";if(!X)O=x.position;else if(!x.seekable)throw new N.ErrnoError(70);var te=x.stream_ops.write(x,w,_,A,O,z);return X||(x.position+=te),te;},allocate:(x,w,_)=>{if(N.isClosed(x))throw new N.ErrnoError(8);if(w<0||_<=0)throw new N.ErrnoError(28);if((x.flags&2097155)===0)throw new N.ErrnoError(8);if(!N.isFile(x.node.mode)&&!N.isDir(x.node.mode))throw new N.ErrnoError(43);if(!x.stream_ops.allocate)throw new N.ErrnoError(138);x.stream_ops.allocate(x,w,_);},mmap:(x,w,_,A,O,z)=>{if((O&2)!==0&&(z&2)===0&&(x.flags&2097155)!==2)throw new N.ErrnoError(2);if((x.flags&2097155)===1)throw new N.ErrnoError(2);if(!x.stream_ops.mmap)throw new N.ErrnoError(43);return x.stream_ops.mmap(x,w,_,A,O,z);},msync:(x,w,_,A,O)=>!x||!x.stream_ops.msync?0:x.stream_ops.msync(x,w,_,A,O),munmap:x=>0,ioctl:(x,w,_)=>{if(!x.stream_ops.ioctl)throw new N.ErrnoError(59);return x.stream_ops.ioctl(x,w,_);},readFile:(x,w={})=>{if(w.flags=w.flags||0,w.encoding=w.encoding||"binary",w.encoding!=="utf8"&&w.encoding!=="binary")throw new Error('Invalid encoding type "'+w.encoding+'"');var _,A=N.open(x,w.flags),O=N.stat(x),z=O.size,X=new Uint8Array(z);return N.read(A,X,0,z,0),w.encoding==="utf8"?_=U(X,0):w.encoding==="binary"&&(_=X),N.close(A),_;},writeFile:(x,w,_={})=>{_.flags=_.flags||577;var A=N.open(x,_.flags,_.mode);if(typeof w=="string"){var O=new Uint8Array(se(w)+1),z=k(w,O,0,O.length);N.write(A,O,0,z,void 0,_.canOwn);}else if(ArrayBuffer.isView(w))N.write(A,w,0,w.byteLength,void 0,_.canOwn);else throw new Error("Unsupported data type");N.close(A);},cwd:()=>N.currentPath,chdir:x=>{var w=N.lookupPath(x,{follow:!0});if(w.node===null)throw new N.ErrnoError(44);if(!N.isDir(w.node.mode))throw new N.ErrnoError(54);var _=N.nodePermissions(w.node,"x");if(_)throw new N.ErrnoError(_);N.currentPath=w.path;},createDefaultDirectories:()=>{N.mkdir("/tmp"),N.mkdir("/home"),N.mkdir("/home/web_user");},createDefaultDevices:()=>{N.mkdir("/dev"),N.registerDevice(N.makedev(1,3),{read:()=>0,write:(w,_,A,O,z)=>O}),N.mkdev("/dev/null",N.makedev(1,3)),ms.register(N.makedev(5,0),ms.default_tty_ops),ms.register(N.makedev(6,0),ms.default_tty1_ops),N.mkdev("/dev/tty",N.makedev(5,0)),N.mkdev("/dev/tty1",N.makedev(6,0));var x=UO();N.createDevice("/dev","random",x),N.createDevice("/dev","urandom",x),N.mkdir("/dev/shm"),N.mkdir("/dev/shm/tmp");},createSpecialDirectories:()=>{N.mkdir("/proc");var x=N.mkdir("/proc/self");N.mkdir("/proc/self/fd"),N.mount({mount:()=>{var w=N.createNode(x,"fd",16895,73);return w.node_ops={lookup:(_,A)=>{var O=+A,z=N.getStream(O);if(!z)throw new N.ErrnoError(8);var X={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>z.path}};return X.parent=X,X;}},w;}},{},"/proc/self/fd");},createStandardStreams:()=>{t.stdin?N.createDevice("/dev","stdin",t.stdin):N.symlink("/dev/tty","/dev/stdin"),t.stdout?N.createDevice("/dev","stdout",null,t.stdout):N.symlink("/dev/tty","/dev/stdout"),t.stderr?N.createDevice("/dev","stderr",null,t.stderr):N.symlink("/dev/tty1","/dev/stderr");var x=N.open("/dev/stdin",0),w=N.open("/dev/stdout",1),_=N.open("/dev/stderr",1);},ensureErrnoError:()=>{N.ErrnoError||(N.ErrnoError=function(w,_){this.node=_,this.setErrno=function(A){this.errno=A;},this.setErrno(w),this.message="FS error";},N.ErrnoError.prototype=new Error(),N.ErrnoError.prototype.constructor=N.ErrnoError,[44].forEach(x=>{N.genericErrors[x]=new N.ErrnoError(x),N.genericErrors[x].stack="<generic error, no stack>";}));},staticInit:()=>{N.ensureErrnoError(),N.nameTable=new Array(4096),N.mount(ut,{},"/"),N.createDefaultDirectories(),N.createDefaultDevices(),N.createSpecialDirectories(),N.filesystems={MEMFS:ut};},init:(x,w,_)=>{N.init.initialized=!0,N.ensureErrnoError(),t.stdin=x||t.stdin,t.stdout=w||t.stdout,t.stderr=_||t.stderr,N.createStandardStreams();},quit:()=>{N.init.initialized=!1;for(var x=0;x<N.streams.length;x++){var w=N.streams[x];!w||N.close(w);}},getMode:(x,w)=>{var _=0;return x&&(_|=365),w&&(_|=146),_;},findObject:(x,w)=>{var _=N.analyzePath(x,w);return _.exists?_.object:null;},analyzePath:(x,w)=>{try{var _=N.lookupPath(x,{follow:!w});x=_.path;}catch{}var A={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var _=N.lookupPath(x,{parent:!0});A.parentExists=!0,A.parentPath=_.path,A.parentObject=_.node,A.name=Mt.basename(x),_=N.lookupPath(x,{follow:!w}),A.exists=!0,A.path=_.path,A.object=_.node,A.name=_.node.name,A.isRoot=_.path==="/";}catch(O){A.error=O.errno;}return A;},createPath:(x,w,_,A)=>{x=typeof x=="string"?x:N.getPath(x);for(var O=w.split("/").reverse();O.length;){var z=O.pop();if(!!z){var X=Mt.join2(x,z);try{N.mkdir(X);}catch{}x=X;}}return X;},createFile:(x,w,_,A,O)=>{var z=Mt.join2(typeof x=="string"?x:N.getPath(x),w),X=N.getMode(A,O);return N.create(z,X);},createDataFile:(x,w,_,A,O,z)=>{var X=w;x&&(x=typeof x=="string"?x:N.getPath(x),X=w?Mt.join2(x,w):x);var te=N.getMode(A,O),ae=N.create(X,te);if(_){if(typeof _=="string"){for(var de=new Array(_.length),Be=0,_e=_.length;Be<_e;++Be)de[Be]=_.charCodeAt(Be);_=de;}N.chmod(ae,te|146);var ge=N.open(ae,577);N.write(ge,_,0,_.length,0,z),N.close(ge),N.chmod(ae,te);}return ae;},createDevice:(x,w,_,A)=>{var O=Mt.join2(typeof x=="string"?x:N.getPath(x),w),z=N.getMode(!!_,!!A);N.createDevice.major||(N.createDevice.major=64);var X=N.makedev(N.createDevice.major++,0);return N.registerDevice(X,{open:te=>{te.seekable=!1;},close:te=>{A&&A.buffer&&A.buffer.length&&A(10);},read:(te,ae,de,Be,_e)=>{for(var ge=0,Te=0;Te<Be;Te++){var Ge;try{Ge=_();}catch{throw new N.ErrnoError(29);}if(Ge===void 0&&ge===0)throw new N.ErrnoError(6);if(Ge==null)break;ge++,ae[de+Te]=Ge;}return ge&&(te.node.timestamp=Date.now()),ge;},write:(te,ae,de,Be,_e)=>{for(var ge=0;ge<Be;ge++)try{A(ae[de+ge]);}catch{throw new N.ErrnoError(29);}return Be&&(te.node.timestamp=Date.now()),ge;}}),N.mkdev(O,z,X);},forceLoadFile:x=>{if(x.isDevice||x.isFolder||x.link||x.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(p)try{x.contents=Dc(p(x.url),!0),x.usedBytes=x.contents.length;}catch{throw new N.ErrnoError(29);}else throw new Error("Cannot load without read() or XMLHttpRequest.");},createLazyFile:(x,w,_,A,O)=>{function z(){this.lengthKnown=!1,this.chunks=[];}if(z.prototype.get=function(ge){if(!(ge>this.length-1||ge<0)){var Te=ge%this.chunkSize,Ge=ge/this.chunkSize|0;return this.getter(Ge)[Te];}},z.prototype.setDataGetter=function(ge){this.getter=ge;},z.prototype.cacheLength=function(){var ge=new XMLHttpRequest();if(ge.open("HEAD",_,!1),ge.send(null),!(ge.status>=200&&ge.status<300||ge.status===304))throw new Error("Couldn't load "+_+". Status: "+ge.status);var Te=Number(ge.getResponseHeader("Content-length")),Ge,bt=(Ge=ge.getResponseHeader("Accept-Ranges"))&&Ge==="bytes",yt=(Ge=ge.getResponseHeader("Content-Encoding"))&&Ge==="gzip",Wt=1024*1024;bt||(Wt=Te);var we=(_t,ft)=>{if(_t>ft)throw new Error("invalid range ("+_t+", "+ft+") or no bytes requested!");if(ft>Te-1)throw new Error("only "+Te+" bytes available! programmer error!");var St=new XMLHttpRequest();if(St.open("GET",_,!1),Te!==Wt&&St.setRequestHeader("Range","bytes="+_t+"-"+ft),typeof Uint8Array<"u"&&(St.responseType="arraybuffer"),St.overrideMimeType&&St.overrideMimeType("text/plain; charset=x-user-defined"),St.send(null),!(St.status>=200&&St.status<300||St.status===304))throw new Error("Couldn't load "+_+". Status: "+St.status);return St.response!==void 0?new Uint8Array(St.response||[]):Dc(St.responseText||"",!0);},je=this;je.setDataGetter(_t=>{var ft=_t*Wt,St=(_t+1)*Wt-1;if(St=Math.min(St,Te-1),typeof je.chunks[_t]>"u"&&(je.chunks[_t]=we(ft,St)),typeof je.chunks[_t]>"u")throw new Error("doXHR failed!");return je.chunks[_t];}),(yt||!Te)&&(Wt=Te=1,Te=this.getter(0).length,Wt=Te,y("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=Te,this._chunkSize=Wt,this.lengthKnown=!0;},typeof XMLHttpRequest<"u"){if(!h)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var X=new z();Object.defineProperties(X,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length;}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize;}}});var te={isDevice:!1,contents:X};}else var te={isDevice:!1,url:_};var ae=N.createFile(x,w,te,A,O);te.contents?ae.contents=te.contents:te.url&&(ae.contents=null,ae.url=te.url),Object.defineProperties(ae,{usedBytes:{get:function(){return this.contents.length;}}});var de={},Be=Object.keys(ae.stream_ops);return Be.forEach(_e=>{var ge=ae.stream_ops[_e];de[_e]=function(){return N.forceLoadFile(ae),ge.apply(null,arguments);};}),de.read=(_e,ge,Te,Ge,bt)=>{N.forceLoadFile(ae);var yt=_e.node.contents;if(bt>=yt.length)return 0;var Wt=Math.min(yt.length-bt,Ge);if(yt.slice)for(var we=0;we<Wt;we++)ge[Te+we]=yt[bt+we];else for(var we=0;we<Wt;we++)ge[Te+we]=yt.get(bt+we);return Wt;},ae.stream_ops=de,ae;},createPreloadedFile:(x,w,_,A,O,z,X,te,ae,de)=>{var Be=w?li.resolve(Mt.join2(x,w)):x,_e="cp "+Be;function ge(Te){function Ge(bt){de&&de(),te||N.createDataFile(x,w,bt,A,O,ae),z&&z(),Bc(_e);}ce.handledByPreloadPlugin(Te,Be,Ge,()=>{X&&X(),Bc(_e);})||Ge(Te);}qp(_e),typeof _=="string"?FO(_,Te=>ge(Te),X):ge(_);},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(x,w,_)=>{w=w||(()=>{}),_=_||(()=>{});var A=N.indexedDB();try{var O=A.open(N.DB_NAME(),N.DB_VERSION);}catch(z){return _(z);}O.onupgradeneeded=()=>{y("creating db");var z=O.result;z.createObjectStore(N.DB_STORE_NAME);},O.onsuccess=()=>{var z=O.result,X=z.transaction([N.DB_STORE_NAME],"readwrite"),te=X.objectStore(N.DB_STORE_NAME),ae=0,de=0,Be=x.length;function _e(){de==0?w():_();}x.forEach(ge=>{var Te=te.put(N.analyzePath(ge).object.contents,ge);Te.onsuccess=()=>{ae++,ae+de==Be&&_e();},Te.onerror=()=>{de++,ae+de==Be&&_e();};}),X.onerror=_;},O.onerror=_;},loadFilesFromDB:(x,w,_)=>{w=w||(()=>{}),_=_||(()=>{});var A=N.indexedDB();try{var O=A.open(N.DB_NAME(),N.DB_VERSION);}catch(z){return _(z);}O.onupgradeneeded=_,O.onsuccess=()=>{var z=O.result;try{var X=z.transaction([N.DB_STORE_NAME],"readonly");}catch(ge){_(ge);return;}var te=X.objectStore(N.DB_STORE_NAME),ae=0,de=0,Be=x.length;function _e(){de==0?w():_();}x.forEach(ge=>{var Te=te.get(ge);Te.onsuccess=()=>{N.analyzePath(ge).exists&&N.unlink(ge),N.createDataFile(Mt.dirname(ge),Mt.basename(ge),Te.result,!0,!0,!0),ae++,ae+de==Be&&_e();},Te.onerror=()=>{de++,ae+de==Be&&_e();};}),X.onerror=_;},O.onerror=_;}},pt={mappings:{},DEFAULT_POLLMASK:5,calculateAt:function(x,w,_){if(w[0]==="/")return w;var A;if(x===-100)A=N.cwd();else{var O=N.getStream(x);if(!O)throw new N.ErrnoError(8);A=O.path;}if(w.length==0){if(!_)throw new N.ErrnoError(44);return A;}return Mt.join2(A,w);},doStat:function(x,w,_){try{var A=x(w);}catch(O){if(O&&O.node&&Mt.normalize(w)!==Mt.normalize(N.getPath(O.node)))return-54;throw O;}return Q[_>>2]=A.dev,Q[_+4>>2]=0,Q[_+8>>2]=A.ino,Q[_+12>>2]=A.mode,Q[_+16>>2]=A.nlink,Q[_+20>>2]=A.uid,Q[_+24>>2]=A.gid,Q[_+28>>2]=A.rdev,Q[_+32>>2]=0,Fr=[A.size>>>0,(Ot=A.size,+Math.abs(Ot)>=1?Ot>0?(Math.min(+Math.floor(Ot/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ot-+(~~Ot>>>0))/4294967296)>>>0:0)],Q[_+40>>2]=Fr[0],Q[_+44>>2]=Fr[1],Q[_+48>>2]=4096,Q[_+52>>2]=A.blocks,Q[_+56>>2]=A.atime.getTime()/1e3|0,Q[_+60>>2]=0,Q[_+64>>2]=A.mtime.getTime()/1e3|0,Q[_+68>>2]=0,Q[_+72>>2]=A.ctime.getTime()/1e3|0,Q[_+76>>2]=0,Fr=[A.ino>>>0,(Ot=A.ino,+Math.abs(Ot)>=1?Ot>0?(Math.min(+Math.floor(Ot/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ot-+(~~Ot>>>0))/4294967296)>>>0:0)],Q[_+80>>2]=Fr[0],Q[_+84>>2]=Fr[1],0;},doMsync:function(x,w,_,A,O){var z=re.slice(x,x+_);N.msync(w,z,O,_,A);},doMkdir:function(x,w){return x=Mt.normalize(x),x[x.length-1]==="/"&&(x=x.substr(0,x.length-1)),N.mkdir(x,w,0),0;},doMknod:function(x,w,_){switch(w&61440){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28;}return N.mknod(x,w,_),0;},doReadlink:function(x,w,_){if(_<=0)return-28;var A=N.readlink(x),O=Math.min(_,se(A)),z=j[w+O];return ie(A,w,_+1),j[w+O]=z,O;},doAccess:function(x,w){if(w&-8)return-28;var _=N.lookupPath(x,{follow:!0}),A=_.node;if(!A)return-44;var O="";return w&4&&(O+="r"),w&2&&(O+="w"),w&1&&(O+="x"),O&&N.nodePermissions(A,O)?-2:0;},doDup:function(x,w,_){var A=N.getStream(_);return A&&N.close(A),N.open(x,w,0,_,_).fd;},doReadv:function(x,w,_,A){for(var O=0,z=0;z<_;z++){var X=Q[w+z*8>>2],te=Q[w+(z*8+4)>>2],ae=N.read(x,j,X,te,A);if(ae<0)return-1;if(O+=ae,ae<te)break;}return O;},doWritev:function(x,w,_,A){for(var O=0,z=0;z<_;z++){var X=Q[w+z*8>>2],te=Q[w+(z*8+4)>>2],ae=N.write(x,j,X,te,A);if(ae<0)return-1;O+=ae;}return O;},varargs:void 0,get:function(){pt.varargs+=4;var x=Q[pt.varargs-4>>2];return x;},getStr:function(x){var w=D(x);return w;},getStreamFromFD:function(x){var w=N.getStream(x);if(!w)throw new N.ErrnoError(8);return w;},get64:function(x,w){return x;}};function qO(x,w){try{return x=pt.getStr(x),pt.doAccess(x,w);}catch(_){if(typeof N>"u"||!(_ instanceof N.ErrnoError))throw _;return-_.errno;}}function zO(x,w){try{return x=pt.getStr(x),N.chmod(x,w),0;}catch(_){if(typeof N>"u"||!(_ instanceof N.ErrnoError))throw _;return-_.errno;}}function hb(x){return Q[Sb()>>2]=x,x;}function YO(x,w,_){pt.varargs=_;try{var A=pt.getStreamFromFD(x);switch(w){case 0:{var O=pt.get();if(O<0)return-28;var z;return z=N.open(A.path,A.flags,0,O),z.fd;}case 1:case 2:return 0;case 3:return A.flags;case 4:{var O=pt.get();return A.flags|=O,0;}case 5:{var O=pt.get(),X=0;return he[O+X>>1]=2,0;}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return hb(28),-1;default:return-28;}}catch(te){if(typeof N>"u"||!(te instanceof N.ErrnoError))throw te;return-te.errno;}}function XO(x,w){try{var _=pt.getStreamFromFD(x);return pt.doStat(N.stat,_.path,w);}catch(A){if(typeof N>"u"||!(A instanceof N.ErrnoError))throw A;return-A.errno;}}function VO(x,w,_,A){try{w=pt.getStr(w);var O=A&256,z=A&4096;return A=A&-4353,w=pt.calculateAt(x,w,z),pt.doStat(O?N.lstat:N.stat,w,_);}catch(X){if(typeof N>"u"||!(X instanceof N.ErrnoError))throw X;return-X.errno;}}function WO(x,w,_){try{var A=pt.getStreamFromFD(x);A.getdents||(A.getdents=N.readdir(A.path));for(var O=280,z=0,X=N.llseek(A,0,1),te=Math.floor(X/O);te<A.getdents.length&&z+O<=_;){var ae,de,Be=A.getdents[te];if(Be===".")ae=A.node.id,de=4;else if(Be===".."){var _e=N.lookupPath(A.path,{parent:!0});ae=_e.node.id,de=4;}else{var ge=N.lookupNode(A.node,Be);ae=ge.id,de=N.isChrdev(ge.mode)?2:N.isDir(ge.mode)?4:N.isLink(ge.mode)?10:8;}Fr=[ae>>>0,(Ot=ae,+Math.abs(Ot)>=1?Ot>0?(Math.min(+Math.floor(Ot/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ot-+(~~Ot>>>0))/4294967296)>>>0:0)],Q[w+z>>2]=Fr[0],Q[w+z+4>>2]=Fr[1],Fr=[(te+1)*O>>>0,(Ot=(te+1)*O,+Math.abs(Ot)>=1?Ot>0?(Math.min(+Math.floor(Ot/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ot-+(~~Ot>>>0))/4294967296)>>>0:0)],Q[w+z+8>>2]=Fr[0],Q[w+z+12>>2]=Fr[1],he[w+z+16>>1]=280,j[w+z+18>>0]=de,ie(Be,w+z+19,256),z+=O,te+=1;}return N.llseek(A,te*O,0),z;}catch(Te){if(typeof N>"u"||!(Te instanceof N.ErrnoError))throw Te;return-Te.errno;}}function $O(x,w,_){pt.varargs=_;try{var A=pt.getStreamFromFD(x);switch(w){case 21509:case 21505:return A.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return A.tty?0:-59;case 21519:{if(!A.tty)return-59;var O=pt.get();return Q[O>>2]=0,0;}case 21520:return A.tty?-28:-59;case 21531:{var O=pt.get();return N.ioctl(A,w,O);}case 21523:return A.tty?0:-59;case 21524:return A.tty?0:-59;default:Ri("bad ioctl syscall "+w);}}catch(z){if(typeof N>"u"||!(z instanceof N.ErrnoError))throw z;return-z.errno;}}function jO(x,w){try{return x=pt.getStr(x),pt.doStat(N.lstat,x,w);}catch(_){if(typeof N>"u"||!(_ instanceof N.ErrnoError))throw _;return-_.errno;}}function ZO(x,w){try{return x=pt.getStr(x),pt.doMkdir(x,w);}catch(_){if(typeof N>"u"||!(_ instanceof N.ErrnoError))throw _;return-_.errno;}}function HO(x,w,_,A,O,z){z<<=12;var X,te=!1;if((A&16)!==0&&x%65536!==0)return-28;if((A&32)!==0){if(X=cb(w),!X)return-48;te=!0;}else{var ae=N.getStream(O);if(!ae)return-8;var de=N.mmap(ae,x,w,z,_,A);X=de.ptr,te=de.allocated;}return pt.mappings[X]={malloc:X,len:w,allocated:te,fd:O,prot:_,flags:A,offset:z},X;}function KO(x,w,_,A,O,z){try{return HO(x,w,_,A,O,z);}catch(X){if(typeof N>"u"||!(X instanceof N.ErrnoError))throw X;return-X.errno;}}function QO(x,w){var _=pt.mappings[x];if(w===0||!_)return-28;if(w===_.len){var A=N.getStream(_.fd);A&&(_.prot&2&&pt.doMsync(x,A,w,_.flags,_.offset),N.munmap(A)),pt.mappings[x]=null,_.allocated&&ui(_.malloc);}return 0;}function JO(x,w){try{return QO(x,w);}catch(_){if(typeof N>"u"||!(_ instanceof N.ErrnoError))throw _;return-_.errno;}}function ek(x,w,_){pt.varargs=_;try{var A=pt.getStr(x),O=_?pt.get():0,z=N.open(A,w,O);return z.fd;}catch(X){if(typeof N>"u"||!(X instanceof N.ErrnoError))throw X;return-X.errno;}}function tk(x,w){try{return x=pt.getStr(x),pt.doStat(N.stat,x,w);}catch(_){if(typeof N>"u"||!(_ instanceof N.ErrnoError))throw _;return-_.errno;}}function rk(x,w){Ri("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking");}function nk(x,w){Ri("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking");}function ik(x,w,_,A,O){}function Yp(x){switch(x){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+x);}}function sk(){for(var x=new Array(256),w=0;w<256;++w)x[w]=String.fromCharCode(w);fb=x;}var fb=void 0;function Xn(x){for(var w="",_=x;re[_];)w+=fb[re[_++]];return w;}var Ko={},ao={},Cc={},ok=48,ak=57;function db(x){if(x===void 0)return"_unknown";x=x.replace(/[^a-zA-Z0-9_]/g,"$");var w=x.charCodeAt(0);return w>=ok&&w<=ak?"_"+x:x;}function pb(x,w){return x=db(x),new Function("body","return function "+x+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(w);}function Xp(x,w){var _=pb(w,function(A){this.name=w,this.message=A;var O=new Error(A).stack;O!==void 0&&(this.stack=this.toString()+`
`+O.replace(/^Error(:[^\n]*)?\n/,""));});return _.prototype=Object.create(x.prototype),_.prototype.constructor=_,_.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message;},_;}var mb=void 0;function fn(x){throw new mb(x);}var gb=void 0;function xb(x){throw new gb(x);}function lk(x,w,_){x.forEach(function(te){Cc[te]=w;});function A(te){var ae=_(te);ae.length!==x.length&&xb("Mismatched type converter count");for(var de=0;de<x.length;++de)Li(x[de],ae[de]);}var O=new Array(w.length),z=[],X=0;w.forEach(function(te,ae){ao.hasOwnProperty(te)?O[ae]=ao[te]:(z.push(te),Ko.hasOwnProperty(te)||(Ko[te]=[]),Ko[te].push(function(){O[ae]=ao[te],++X,X===z.length&&A(O);}));}),z.length===0&&A(O);}function Li(x,w,_={}){if(!("argPackAdvance"in w))throw new TypeError("registerType registeredInstance requires argPackAdvance");var A=w.name;if(x||fn('type "'+A+'" must have a positive integer typeid pointer'),ao.hasOwnProperty(x)){if(_.ignoreDuplicateRegistrations)return;fn("Cannot register type '"+A+"' twice");}if(ao[x]=w,delete Cc[x],Ko.hasOwnProperty(x)){var O=Ko[x];delete Ko[x],O.forEach(function(z){z();});}}function uk(x,w,_,A,O){var z=Yp(_);w=Xn(w),Li(x,{name:w,fromWireType:function(X){return!!X;},toWireType:function(X,te){return te?A:O;},argPackAdvance:8,readValueFromPointer:function(X){var te;if(_===1)te=j;else if(_===2)te=he;else if(_===4)te=Q;else throw new TypeError("Unknown boolean type size: "+w);return this.fromWireType(te[X>>z]);},destructorFunction:null});}var Vp=[],Vn=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function bb(x){x>4&&--Vn[x].refcount===0&&(Vn[x]=void 0,Vp.push(x));}function ck(){for(var x=0,w=5;w<Vn.length;++w)Vn[w]!==void 0&&++x;return x;}function hk(){for(var x=5;x<Vn.length;++x)if(Vn[x]!==void 0)return Vn[x];return null;}function fk(){t.count_emval_handles=ck,t.get_first_emval=hk;}var Wp={toValue:function(x){return x||fn("Cannot use deleted val. handle = "+x),Vn[x].value;},toHandle:function(x){switch(x){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var w=Vp.length?Vp.pop():Vn.length;return Vn[w]={refcount:1,value:x},w;}}}};function $p(x){return this.fromWireType(Pe[x>>2]);}function dk(x,w){w=Xn(w),Li(x,{name:w,fromWireType:function(_){var A=Wp.toValue(_);return bb(_),A;},toWireType:function(_,A){return Wp.toHandle(A);},argPackAdvance:8,readValueFromPointer:$p,destructorFunction:null});}function pk(x,w){switch(w){case 2:return function(_){return this.fromWireType(Ue[_>>2]);};case 3:return function(_){return this.fromWireType(Ae[_>>3]);};default:throw new TypeError("Unknown float type: "+x);}}function mk(x,w,_){var A=Yp(_);w=Xn(w),Li(x,{name:w,fromWireType:function(O){return O;},toWireType:function(O,z){return z;},argPackAdvance:8,readValueFromPointer:pk(w,A),destructorFunction:null});}function gk(x,w){if(!(x instanceof Function))throw new TypeError("new_ called with constructor type "+typeof x+" which is not a function");var _=pb(x.name||"unknownFunctionName",function(){});_.prototype=x.prototype;var A=new _(),O=x.apply(A,w);return O instanceof Object?O:A;}function xk(x){for(;x.length;){var w=x.pop(),_=x.pop();_(w);}}function bk(x,w,_,A,O){var z=w.length;z<2&&fn("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var X=w[1]!==null&&_!==null,te=!1,ae=1;ae<w.length;++ae)if(w[ae]!==null&&w[ae].destructorFunction===void 0){te=!0;break;}for(var de=w[0].name!=="void",Be="",_e="",ae=0;ae<z-2;++ae)Be+=(ae!==0?", ":"")+"arg"+ae,_e+=(ae!==0?", ":"")+"arg"+ae+"Wired";var ge="return function "+db(x)+"("+Be+`) {
if (arguments.length !== `+(z-2)+`) {
throwBindingError('function `+x+" called with ' + arguments.length + ' arguments, expected "+(z-2)+` args!');
}
`;te&&(ge+=`var destructors = [];
`);var Te=te?"destructors":"null",Ge=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],bt=[fn,A,O,xk,w[0],w[1]];X&&(ge+="var thisWired = classParam.toWireType("+Te+`, this);
`);for(var ae=0;ae<z-2;++ae)ge+="var arg"+ae+"Wired = argType"+ae+".toWireType("+Te+", arg"+ae+"); // "+w[ae+2].name+`
`,Ge.push("argType"+ae),bt.push(w[ae+2]);if(X&&(_e="thisWired"+(_e.length>0?", ":"")+_e),ge+=(de?"var rv = ":"")+"invoker(fn"+(_e.length>0?", ":"")+_e+`);
`,te)ge+=`runDestructors(destructors);
`;else for(var ae=X?1:2;ae<w.length;++ae){var yt=ae===1?"thisWired":"arg"+(ae-2)+"Wired";w[ae].destructorFunction!==null&&(ge+=yt+"_dtor("+yt+"); // "+w[ae].name+`
`,Ge.push(yt+"_dtor"),bt.push(w[ae].destructorFunction));}de&&(ge+=`var ret = retType.fromWireType(rv);
return ret;
`),ge+=`}
`,Ge.push(ge);var Wt=gk(Function,Ge).apply(null,bt);return Wt;}function yk(x,w,_){if(x[w].overloadTable===void 0){var A=x[w];x[w]=function(){return x[w].overloadTable.hasOwnProperty(arguments.length)||fn("Function '"+_+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+x[w].overloadTable+")!"),x[w].overloadTable[arguments.length].apply(this,arguments);},x[w].overloadTable=[],x[w].overloadTable[A.argCount]=A;}}function wk(x,w,_){t.hasOwnProperty(x)?((_===void 0||t[x].overloadTable!==void 0&&t[x].overloadTable[_]!==void 0)&&fn("Cannot register public name '"+x+"' twice"),yk(t,x,x),t.hasOwnProperty(_)&&fn("Cannot register multiple overloads of a function with the same number of arguments ("+_+")!"),t[x].overloadTable[_]=w):(t[x]=w,_!==void 0&&(t[x].numArguments=_));}function vk(x,w){for(var _=[],A=0;A<x;A++)_.push(Q[(w>>2)+A]);return _;}function Ek(x,w,_){t.hasOwnProperty(x)||xb("Replacing nonexistant public symbol"),t[x].overloadTable!==void 0&&_!==void 0?t[x].overloadTable[_]=w:(t[x]=w,t[x].argCount=_);}function Pk(x,w,_){var A=t["dynCall_"+x];return _&&_.length?A.apply(null,[w].concat(_)):A.call(null,w);}function _k(x,w,_){return x.includes("j")?Pk(x,w,_):Ni(w).apply(null,_);}function Sk(x,w){var _=[];return function(){_.length=arguments.length;for(var A=0;A<arguments.length;A++)_[A]=arguments[A];return _k(x,w,_);};}function Bk(x,w){x=Xn(x);function _(){return x.includes("j")?Sk(x,w):Ni(w);}var A=_();return typeof A!="function"&&fn("unknown function pointer with signature "+x+": "+w),A;}var yb=void 0;function wb(x){var w=Bb(x),_=Xn(w);return ui(w),_;}function Ik(x,w){var _=[],A={};function O(z){if(!A[z]&&!ao[z]){if(Cc[z]){Cc[z].forEach(O);return;}_.push(z),A[z]=!0;}}throw w.forEach(O),new yb(x+": "+_.map(wb).join([", "]));}function Ak(x,w,_,A,O,z){var X=vk(w,_);x=Xn(x),O=Bk(A,O),wk(x,function(){Ik("Cannot call "+x+" due to unbound types",X);},w-1),lk([],X,function(te){var ae=[te[0],null].concat(te.slice(1));return Ek(x,bk(x,ae,null,O,z),w-1),[];});}function Ck(x,w,_){switch(w){case 0:return _?function(O){return j[O];}:function(O){return re[O];};case 1:return _?function(O){return he[O>>1];}:function(O){return ve[O>>1];};case 2:return _?function(O){return Q[O>>2];}:function(O){return Pe[O>>2];};default:throw new TypeError("Unknown integer type: "+x);}}function Mk(x,w,_,A,O){w=Xn(w),O===-1&&(O=4294967295);var z=Yp(_),X=_e=>_e;if(A===0){var te=32-8*_;X=_e=>_e<<te>>>te;}var ae=w.includes("unsigned"),de=(_e,ge)=>{},Be;ae?Be=function(_e,ge){return de(ge,this.name),ge>>>0;}:Be=function(_e,ge){return de(ge,this.name),ge;},Li(x,{name:w,fromWireType:X,toWireType:Be,argPackAdvance:8,readValueFromPointer:Ck(w,z,A!==0),destructorFunction:null});}function Tk(x,w,_){var A=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],O=A[w];function z(X){X=X>>2;var te=Pe,ae=te[X],de=te[X+1];return new O(K,de,ae);}_=Xn(_),Li(x,{name:_,fromWireType:z,argPackAdvance:8,readValueFromPointer:z},{ignoreDuplicateRegistrations:!0});}function Rk(x,w){w=Xn(w);var _=w==="std::string";Li(x,{name:w,fromWireType:function(A){var O=Pe[A>>2],z;if(_)for(var X=A+4,te=0;te<=O;++te){var ae=A+4+te;if(te==O||re[ae]==0){var de=ae-X,Be=D(X,de);z===void 0?z=Be:(z+=String.fromCharCode(0),z+=Be),X=ae+1;}}else{for(var _e=new Array(O),te=0;te<O;++te)_e[te]=String.fromCharCode(re[A+4+te]);z=_e.join("");}return ui(A),z;},toWireType:function(A,O){O instanceof ArrayBuffer&&(O=new Uint8Array(O));var z,X=typeof O=="string";X||O instanceof Uint8Array||O instanceof Uint8ClampedArray||O instanceof Int8Array||fn("Cannot pass non-string to std::string"),_&&X?z=()=>se(O):z=()=>O.length;var te=z(),ae=Oi(4+te+1);if(Pe[ae>>2]=te,_&&X)ie(O,ae+4,te+1);else if(X)for(var de=0;de<te;++de){var Be=O.charCodeAt(de);Be>255&&(ui(ae),fn("String has UTF-16 code units that do not fit in 8 bits")),re[ae+4+de]=Be;}else for(var de=0;de<te;++de)re[ae+4+de]=O[de];return A!==null&&A.push(ui,ae),ae;},argPackAdvance:8,readValueFromPointer:$p,destructorFunction:function(A){ui(A);}});}function Nk(x,w,_){_=Xn(_);var A,O,z,X,te;w===2?(A=le,O=Ee,X=be,z=()=>ve,te=1):w===4&&(A=xe,O=Oe,X=Re,z=()=>Pe,te=2),Li(x,{name:_,fromWireType:function(ae){for(var de=Pe[ae>>2],Be=z(),_e,ge=ae+4,Te=0;Te<=de;++Te){var Ge=ae+4+Te*w;if(Te==de||Be[Ge>>te]==0){var bt=Ge-ge,yt=A(ge,bt);_e===void 0?_e=yt:(_e+=String.fromCharCode(0),_e+=yt),ge=Ge+w;}}return ui(ae),_e;},toWireType:function(ae,de){typeof de!="string"&&fn("Cannot pass non-string to C++ string type "+_);var Be=X(de),_e=Oi(4+Be+w);return Pe[_e>>2]=Be>>te,O(de,_e+4,Be+w),ae!==null&&ae.push(ui,_e),_e;},argPackAdvance:8,readValueFromPointer:$p,destructorFunction:function(ae){ui(ae);}});}function Lk(x,w){w=Xn(w),Li(x,{isVoid:!0,name:w,argPackAdvance:0,fromWireType:function(){},toWireType:function(_,A){}});}function Ok(){throw"longjmp";}function kk(x){x>4&&(Vn[x].refcount+=1);}function Uk(x,w){var _=ao[x];return _===void 0&&fn(w+" has unknown type "+wb(x)),_;}function Dk(x,w){x=Uk(x,"_emval_take_value");var _=x.readValueFromPointer(w);return Wp.toHandle(_);}function Gk(x,w){var _=new Date(Q[x>>2]*1e3);Q[w>>2]=_.getSeconds(),Q[w+4>>2]=_.getMinutes(),Q[w+8>>2]=_.getHours(),Q[w+12>>2]=_.getDate(),Q[w+16>>2]=_.getMonth(),Q[w+20>>2]=_.getFullYear()-1900,Q[w+24>>2]=_.getDay();var A=new Date(_.getFullYear(),0,1),O=(_.getTime()-A.getTime())/(1e3*60*60*24)|0;Q[w+28>>2]=O,Q[w+36>>2]=-(_.getTimezoneOffset()*60);var z=new Date(_.getFullYear(),6,1).getTimezoneOffset(),X=A.getTimezoneOffset(),te=(z!=X&&_.getTimezoneOffset()==Math.min(X,z))|0;Q[w+32>>2]=te;}function Fk(x,w,_){var A=new Date().getFullYear(),O=new Date(A,0,1),z=new Date(A,6,1),X=O.getTimezoneOffset(),te=z.getTimezoneOffset(),ae=Math.max(X,te);Q[x>>2]=ae*60,Q[w>>2]=Number(X!=te);function de(Ge){var bt=Ge.toTimeString().match(/\(([A-Za-z ]+)\)$/);return bt?bt[1]:"GMT";}var Be=de(O),_e=de(z),ge=Ve(Be),Te=Ve(_e);te<X?(Q[_>>2]=ge,Q[_+4>>2]=Te):(Q[_>>2]=Te,Q[_+4>>2]=ge);}function jp(x,w,_){jp.called||(jp.called=!0,Fk(x,w,_));}function qk(){Ri("");}var Mc;Mc=()=>performance.now();var zk=!0;function Yk(x,w){var _;if(x===0)_=Date.now();else if((x===1||x===4)&&zk)_=Mc();else return hb(28),-1;return Q[w>>2]=_/1e3|0,Q[w+4>>2]=_%1e3*1e3*1e3|0,0;}function Zp(x){if(!x||!x.callee||!x.callee.name)return[null,"",""];var w=x.callee.toString(),_=x.callee.name,A="(",O=!0;for(var z in x){var X=x[z];O||(A+=", "),O=!1,typeof X=="number"||typeof X=="string"?A+=X:A+="("+typeof X+")";}A+=")";var te=x.callee.caller;return x=te?te.arguments:[],O&&(A=""),[x,_,A];}function Xk(x){var w=OO(),_=w.lastIndexOf("_emscripten_log"),A=w.lastIndexOf("_emscripten_get_callstack"),O=w.indexOf(`
`,Math.max(_,A))+1;w=w.slice(O),x&32&&E("EM_LOG_DEMANGLE is deprecated; ignoring"),x&8&&typeof emscripten_source_map>"u"&&(E('Source map information is not available, emscripten_log with EM_LOG_C_STACK will be ignored. Build with "--pre-js $EMSCRIPTEN/src/emscripten-source-map.min.js" linker flag to add source map loading to code.'),x^=8,x|=16);var z=null;if(x&128)for(z=Zp(arguments);z[1].includes("_emscripten_");)z=Zp(z[0]);var X=w.split(`
`);w="";var te=new RegExp("\\s*(.*?)@(.*?):([0-9]+):([0-9]+)"),ae=new RegExp("\\s*(.*?)@(.*):(.*)(:(.*))?"),de=new RegExp("\\s*at (.*?) \\((.*):(.*):(.*)\\)");for(var Be in X){var _e=X[Be],ge="",Te="",Ge=0,bt=0,yt=de.exec(_e);if(yt&&yt.length==5)ge=yt[1],Te=yt[2],Ge=yt[3],bt=yt[4];else if(yt=te.exec(_e),yt||(yt=ae.exec(_e)),yt&&yt.length>=4)ge=yt[1],Te=yt[2],Ge=yt[3],bt=yt[4]|0;else{w+=_e+`
`;continue;}var Wt=!1;if(x&8){var we=emscripten_source_map.originalPositionFor({line:Ge,column:bt});Wt=we&&we.source,Wt&&(x&64&&(we.source=we.source.substring(we.source.replace(/\\/g,"/").lastIndexOf("/")+1)),w+="    at "+ge+" ("+we.source+":"+we.line+":"+we.column+`)
`);}(x&16||!Wt)&&(x&64&&(Te=Te.substring(Te.replace(/\\/g,"/").lastIndexOf("/")+1)),w+=(Wt?"     = "+ge:"    at "+ge)+" ("+Te+":"+Ge+":"+bt+`)
`),x&128&&z[0]&&(z[1]==ge&&z[2].length>0&&(w=w.replace(/\s+$/,""),w+=" with values: "+z[1]+z[2]+`
`),z=Zp(z[0]));}return w=w.replace(/\s+$/,""),w;}function Vk(x,w,_){var A=Xk(x);if(!w||_<=0)return se(A)+1;var O=ie(A,w,_);return O+1;}function Wk(){return 2147483648;}function Hp(x,w){if(ce.mainLoop.timingMode=x,ce.mainLoop.timingValue=w,!ce.mainLoop.func)return 1;if(ce.mainLoop.running||(ce.mainLoop.running=!0),x==0)ce.mainLoop.scheduler=function(){var X=Math.max(0,ce.mainLoop.tickStartTime+w-Mc())|0;setTimeout(ce.mainLoop.runner,X);},ce.mainLoop.method="timeout";else if(x==1)ce.mainLoop.scheduler=function(){ce.requestAnimationFrame(ce.mainLoop.runner);},ce.mainLoop.method="rAF";else if(x==2){if(typeof setImmediate>"u"){var _=[],A="setimmediate",O=function(z){(z.data===A||z.data.target===A)&&(z.stopPropagation(),_.shift()());};addEventListener("message",O,!0),setImmediate=function(X){_.push(X),h?(t.setImmediates===void 0&&(t.setImmediates=[]),t.setImmediates.push(X),postMessage({target:A})):postMessage(A,"*");};}ce.mainLoop.scheduler=function(){setImmediate(ce.mainLoop.runner);},ce.mainLoop.method="immediate";}return 0;}function vb(x){Mb(x);}function $k(){if(!hn())try{vb(B);}catch(x){zp(x);}}function jk(x,w,_,A,O){$(!ce.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),ce.mainLoop.func=x,ce.mainLoop.arg=A;var z=ce.mainLoop.currentlyRunningMainloop;function X(){return z<ce.mainLoop.currentlyRunningMainloop?($k(),!1):!0;}if(ce.mainLoop.running=!1,ce.mainLoop.runner=function(){if(!T){if(ce.mainLoop.queue.length>0){var ae=Date.now(),de=ce.mainLoop.queue.shift();if(de.func(de.arg),ce.mainLoop.remainingBlockers){var Be=ce.mainLoop.remainingBlockers,_e=Be%1==0?Be-1:Math.floor(Be);de.counted?ce.mainLoop.remainingBlockers=_e:(_e=_e+.5,ce.mainLoop.remainingBlockers=(8*Be+_e)/9);}if(y('main loop blocker "'+de.name+'" took '+(Date.now()-ae)+" ms"),ce.mainLoop.updateStatus(),!X())return;setTimeout(ce.mainLoop.runner,0);return;}if(!!X()){if(ce.mainLoop.currentFrameNumber=ce.mainLoop.currentFrameNumber+1|0,ce.mainLoop.timingMode==1&&ce.mainLoop.timingValue>1&&ce.mainLoop.currentFrameNumber%ce.mainLoop.timingValue!=0){ce.mainLoop.scheduler();return;}else ce.mainLoop.timingMode==0&&(ce.mainLoop.tickStartTime=Mc());ce.mainLoop.runIter(x),X()&&(typeof SDL=="object"&&SDL.audio&&SDL.audio.queueNewAudioData&&SDL.audio.queueNewAudioData(),ce.mainLoop.scheduler());}}},O||(w&&w>0?Hp(0,1e3/w):Hp(1,1),ce.mainLoop.scheduler()),_)throw"unwind";}function Kp(x,w){if(!(io||T)){if(w){x();return;}try{x();}catch(_){zp(_);}}}function Eb(x,w){return setTimeout(function(){Kp(x);},w);}var ce={mainLoop:{running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){ce.mainLoop.scheduler=null,ce.mainLoop.currentlyRunningMainloop++;},resume:function(){ce.mainLoop.currentlyRunningMainloop++;var x=ce.mainLoop.timingMode,w=ce.mainLoop.timingValue,_=ce.mainLoop.func;ce.mainLoop.func=null,jk(_,0,!1,ce.mainLoop.arg,!0),Hp(x,w),ce.mainLoop.scheduler();},updateStatus:function(){if(t.setStatus){var x=t.statusMessage||"Please wait...",w=ce.mainLoop.remainingBlockers,_=ce.mainLoop.expectedBlockers;w?w<_?t.setStatus(x+" ("+(_-w)+"/"+_+")"):t.setStatus(x):t.setStatus("");}},runIter:function(x){if(!T){if(t.preMainLoop){var w=t.preMainLoop();if(w===!1)return;}Kp(x),t.postMainLoop&&t.postMainLoop();}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(t.preloadPlugins||(t.preloadPlugins=[]),ce.initted)return;ce.initted=!0;try{new Blob(),ce.hasBlobConstructor=!0;}catch{ce.hasBlobConstructor=!1,y("warning: no blob constructor, cannot create blobs with mimetypes");}ce.BlobBuilder=typeof MozBlobBuilder<"u"?MozBlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:ce.hasBlobConstructor?null:y("warning: no BlobBuilder"),ce.URLObject=typeof window<"u"?window.URL?window.URL:window.webkitURL:void 0,!t.noImageDecoding&&typeof ce.URLObject>"u"&&(y("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),t.noImageDecoding=!0);var x={};x.canHandle=function(z){return!t.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(z);},x.handle=function(z,X,te,ae){var de=null;if(ce.hasBlobConstructor)try{de=new Blob([z],{type:ce.getMimetype(X)}),de.size!==z.length&&(de=new Blob([new Uint8Array(z).buffer],{type:ce.getMimetype(X)}));}catch(Te){E("Blob constructor present but fails: "+Te+"; falling back to blob builder");}if(!de){var Be=new ce.BlobBuilder();Be.append(new Uint8Array(z).buffer),de=Be.getBlob();}var _e=ce.URLObject.createObjectURL(de),ge=new Image();ge.onload=()=>{$(ge.complete,"Image "+X+" could not be decoded");var Te=document.createElement("canvas");Te.width=ge.width,Te.height=ge.height;var Ge=Te.getContext("2d");Ge.drawImage(ge,0,0),t.preloadedImages[X]=Te,ce.URLObject.revokeObjectURL(_e),te&&te(z);},ge.onerror=Te=>{y("Image "+_e+" could not be decoded"),ae&&ae();},ge.src=_e;},t.preloadPlugins.push(x);var w={};w.canHandle=function(z){return!t.noAudioDecoding&&z.substr(-4)in{".ogg":1,".wav":1,".mp3":1};},w.handle=function(z,X,te,ae){var de=!1;function Be(bt){de||(de=!0,t.preloadedAudios[X]=bt,te&&te(z));}function _e(){de||(de=!0,t.preloadedAudios[X]=new Audio(),ae&&ae());}if(ce.hasBlobConstructor){try{var ge=new Blob([z],{type:ce.getMimetype(X)});}catch{return _e();}var Te=ce.URLObject.createObjectURL(ge),Ge=new Audio();Ge.addEventListener("canplaythrough",function(){Be(Ge);},!1),Ge.onerror=function(yt){if(de)return;y("warning: browser could not fully decode audio "+X+", trying slower base64 approach");function Wt(we){for(var je="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_t="=",ft="",St=0,qr=0,Wn=0;Wn<we.length;Wn++)for(St=St<<8|we[Wn],qr+=8;qr>=6;){var NU=St>>qr-6&63;qr-=6,ft+=je[NU];}return qr==2?(ft+=je[(St&3)<<4],ft+=_t+_t):qr==4&&(ft+=je[(St&15)<<2],ft+=_t),ft;}Ge.src="data:audio/x-"+X.substr(-3)+";base64,"+Wt(z),Be(Ge);},Ge.src=Te,Eb(function(){Be(Ge);},1e4);}else return _e();},t.preloadPlugins.push(w);function _(){ce.pointerLock=document.pointerLockElement===t.canvas||document.mozPointerLockElement===t.canvas||document.webkitPointerLockElement===t.canvas||document.msPointerLockElement===t.canvas;}var A=t.canvas;A&&(A.requestPointerLock=A.requestPointerLock||A.mozRequestPointerLock||A.webkitRequestPointerLock||A.msRequestPointerLock||function(){},A.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},A.exitPointerLock=A.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",_,!1),document.addEventListener("mozpointerlockchange",_,!1),document.addEventListener("webkitpointerlockchange",_,!1),document.addEventListener("mspointerlockchange",_,!1),t.elementPointerLock&&A.addEventListener("click",function(O){!ce.pointerLock&&t.canvas.requestPointerLock&&(t.canvas.requestPointerLock(),O.preventDefault());},!1));},handledByPreloadPlugin:function(x,w,_,A){ce.init();var O=!1;return t.preloadPlugins.forEach(function(z){O||z.canHandle(w)&&(z.handle(x,w,_,A),O=!0);}),O;},createContext:function(x,w,_,A){if(w&&t.ctx&&x==t.canvas)return t.ctx;var O,z;if(w){var X={antialias:!1,alpha:!1,majorVersion:typeof WebGL2RenderingContext<"u"?2:1};if(A)for(var te in A)X[te]=A[te];typeof GL<"u"&&(z=GL.createContext(x,X),z&&(O=GL.getContext(z).GLctx));}else O=x.getContext("2d");return O?(_&&(w||$(typeof GLctx>"u","cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),t.ctx=O,w&&GL.makeContextCurrent(z),t.useWebGL=w,ce.moduleContextCreatedCallbacks.forEach(function(ae){ae();}),ce.init()),O):null;},destroyContext:function(x,w,_){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen:function(x,w){ce.lockPointer=x,ce.resizeCanvas=w,typeof ce.lockPointer>"u"&&(ce.lockPointer=!0),typeof ce.resizeCanvas>"u"&&(ce.resizeCanvas=!1);var _=t.canvas;function A(){ce.isFullscreen=!1;var z=_.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===z?(_.exitFullscreen=ce.exitFullscreen,ce.lockPointer&&_.requestPointerLock(),ce.isFullscreen=!0,ce.resizeCanvas?ce.setFullscreenCanvasSize():ce.updateCanvasDimensions(_)):(z.parentNode.insertBefore(_,z),z.parentNode.removeChild(z),ce.resizeCanvas?ce.setWindowedCanvasSize():ce.updateCanvasDimensions(_)),t.onFullScreen&&t.onFullScreen(ce.isFullscreen),t.onFullscreen&&t.onFullscreen(ce.isFullscreen);}ce.fullscreenHandlersInstalled||(ce.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",A,!1),document.addEventListener("mozfullscreenchange",A,!1),document.addEventListener("webkitfullscreenchange",A,!1),document.addEventListener("MSFullscreenChange",A,!1));var O=document.createElement("div");_.parentNode.insertBefore(O,_),O.appendChild(_),O.requestFullscreen=O.requestFullscreen||O.mozRequestFullScreen||O.msRequestFullscreen||(O.webkitRequestFullscreen?function(){O.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);}:null)||(O.webkitRequestFullScreen?function(){O.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);}:null),O.requestFullscreen();},exitFullscreen:function(){if(!ce.isFullscreen)return!1;var x=document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||function(){};return x.apply(document,[]),!0;},nextRAF:0,fakeRequestAnimationFrame:function(x){var w=Date.now();if(ce.nextRAF===0)ce.nextRAF=w+1e3/60;else for(;w+2>=ce.nextRAF;)ce.nextRAF+=1e3/60;var _=Math.max(ce.nextRAF-w,0);setTimeout(x,_);},requestAnimationFrame:function(x){if(typeof requestAnimationFrame=="function"){requestAnimationFrame(x);return;}var w=ce.fakeRequestAnimationFrame;w(x);},safeSetTimeout:function(x){return Eb(x);},safeRequestAnimationFrame:function(x){return ce.requestAnimationFrame(function(){Kp(x);});},getMimetype:function(x){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[x.substr(x.lastIndexOf(".")+1)];},getUserMedia:function(x){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(x);},getMovementX:function(x){return x.movementX||x.mozMovementX||x.webkitMovementX||0;},getMovementY:function(x){return x.movementY||x.mozMovementY||x.webkitMovementY||0;},getMouseWheelDelta:function(x){var w=0;switch(x.type){case"DOMMouseScroll":w=x.detail/3;break;case"mousewheel":w=x.wheelDelta/120;break;case"wheel":switch(w=x.deltaY,x.deltaMode){case 0:w/=100;break;case 1:w/=3;break;case 2:w*=80;break;default:throw"unrecognized mouse wheel delta mode: "+x.deltaMode;}break;default:throw"unrecognized mouse wheel event: "+x.type;}return w;},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(x){if(ce.pointerLock)x.type!="mousemove"&&"mozMovementX"in x?ce.mouseMovementX=ce.mouseMovementY=0:(ce.mouseMovementX=ce.getMovementX(x),ce.mouseMovementY=ce.getMovementY(x)),typeof SDL<"u"?(ce.mouseX=SDL.mouseX+ce.mouseMovementX,ce.mouseY=SDL.mouseY+ce.mouseMovementY):(ce.mouseX+=ce.mouseMovementX,ce.mouseY+=ce.mouseMovementY);else{var w=t.canvas.getBoundingClientRect(),_=t.canvas.width,A=t.canvas.height,O=typeof window.scrollX<"u"?window.scrollX:window.pageXOffset,z=typeof window.scrollY<"u"?window.scrollY:window.pageYOffset;if(x.type==="touchstart"||x.type==="touchend"||x.type==="touchmove"){var X=x.touch;if(X===void 0)return;var te=X.pageX-(O+w.left),ae=X.pageY-(z+w.top);te=te*(_/w.width),ae=ae*(A/w.height);var de={x:te,y:ae};if(x.type==="touchstart")ce.lastTouches[X.identifier]=de,ce.touches[X.identifier]=de;else if(x.type==="touchend"||x.type==="touchmove"){var Be=ce.touches[X.identifier];Be||(Be=de),ce.lastTouches[X.identifier]=Be,ce.touches[X.identifier]=de;}return;}var _e=x.pageX-(O+w.left),ge=x.pageY-(z+w.top);_e=_e*(_/w.width),ge=ge*(A/w.height),ce.mouseMovementX=_e-ce.mouseX,ce.mouseMovementY=ge-ce.mouseY,ce.mouseX=_e,ce.mouseY=ge;}},resizeListeners:[],updateResizeListeners:function(){var x=t.canvas;ce.resizeListeners.forEach(function(w){w(x.width,x.height);});},setCanvasSize:function(x,w,_){var A=t.canvas;ce.updateCanvasDimensions(A,x,w),_||ce.updateResizeListeners();},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize:function(){if(typeof SDL<"u"){var x=Pe[SDL.screen>>2];x=x|8388608,Q[SDL.screen>>2]=x;}ce.updateCanvasDimensions(t.canvas),ce.updateResizeListeners();},setWindowedCanvasSize:function(){if(typeof SDL<"u"){var x=Pe[SDL.screen>>2];x=x&-8388609,Q[SDL.screen>>2]=x;}ce.updateCanvasDimensions(t.canvas),ce.updateResizeListeners();},updateCanvasDimensions:function(x,w,_){w&&_?(x.widthNative=w,x.heightNative=_):(w=x.widthNative,_=x.heightNative);var A=w,O=_;if(t.forcedAspectRatio&&t.forcedAspectRatio>0&&(A/O<t.forcedAspectRatio?A=Math.round(O*t.forcedAspectRatio):O=Math.round(A/t.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===x.parentNode&&typeof screen<"u"){var z=Math.min(screen.width/A,screen.height/O);A=Math.round(A*z),O=Math.round(O*z);}ce.resizeCanvas?(x.width!=A&&(x.width=A),x.height!=O&&(x.height=O),typeof x.style<"u"&&(x.style.removeProperty("width"),x.style.removeProperty("height"))):(x.width!=w&&(x.width=w),x.height!=_&&(x.height=_),typeof x.style<"u"&&(A!=w||O!=_?(x.style.setProperty("width",A+"px","important"),x.style.setProperty("height",O+"px","important")):(x.style.removeProperty("width"),x.style.removeProperty("height"))));}};function Zk(x,w,_){(x|0)===x&&(x=D(x)),x=li.resolve(x);var A=t.preloadedImages[x];if(A){var O=A.getContext("2d"),z=O.getImageData(0,0,A.width,A.height),X=Oi(A.width*A.height*4);return re.set(z.data,X),Q[w>>2]=A.width,Q[_>>2]=A.height,X;}return 0;}function Hk(x,w,_){re.copyWithin(x,w,w+_);}function Kk(x){try{return S.grow(x-K.byteLength+65535>>>16),Ze(S.buffer),1;}catch{}}function Qk(x){var w=re.length;x=x>>>0;var _=2147483648;if(x>_)return!1;for(var A=1;A<=4;A*=2){var O=w*(1+.2/A);O=Math.min(O,x+100663296);var z=Math.min(_,fe(Math.max(x,O),65536)),X=Kk(z);if(X)return!0;}return!1;}var Qp={};function Jk(){return l||"./this.program";}function Tl(){if(!Tl.strings){var x=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",w={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:x,_:Jk()};for(var _ in Qp)Qp[_]===void 0?delete w[_]:w[_]=Qp[_];var A=[];for(var _ in w)A.push(_+"="+w[_]);Tl.strings=A;}return Tl.strings;}function eU(x,w){var _=0;return Tl().forEach(function(A,O){var z=w+_;Q[x+O*4>>2]=z,me(A,z),_+=A.length+1;}),0;}function tU(x,w){var _=Tl();Q[x>>2]=_.length;var A=0;return _.forEach(function(O){A+=O.length+1;}),Q[w>>2]=A,0;}function rU(x){try{var w=pt.getStreamFromFD(x);return N.close(w),0;}catch(_){if(typeof N>"u"||!(_ instanceof N.ErrnoError))throw _;return _.errno;}}function nU(x,w,_,A){try{var O=pt.getStreamFromFD(x),z=pt.doReadv(O,w,_);return Q[A>>2]=z,0;}catch(X){if(typeof N>"u"||!(X instanceof N.ErrnoError))throw X;return X.errno;}}function iU(x,w,_,A,O){try{var z=pt.getStreamFromFD(x),X=4294967296,te=_*X+(w>>>0),ae=9007199254740992;return te<=-ae||te>=ae?-61:(N.llseek(z,te,A),Fr=[z.position>>>0,(Ot=z.position,+Math.abs(Ot)>=1?Ot>0?(Math.min(+Math.floor(Ot/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ot-+(~~Ot>>>0))/4294967296)>>>0:0)],Q[O>>2]=Fr[0],Q[O+4>>2]=Fr[1],z.getdents&&te===0&&A===0&&(z.getdents=null),0);}catch(de){if(typeof N>"u"||!(de instanceof N.ErrnoError))throw de;return de.errno;}}function sU(x,w,_,A){try{var O=pt.getStreamFromFD(x),z=pt.doWritev(O,w,_);return Q[A>>2]=z,0;}catch(X){if(typeof N>"u"||!(X instanceof N.ErrnoError))throw X;return X.errno;}}function oU(){return I();}function Pb(x){for(var w=x.split("."),_=0;_<4;_++){var A=Number(w[_]);if(isNaN(A))return null;w[_]=A;}return(w[0]|w[1]<<8|w[2]<<16|w[3]<<24)>>>0;}function Tc(x){return parseInt(x);}function aU(x){var w,_,A,O,z=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,X=[];if(!z.test(x))return null;if(x==="::")return[0,0,0,0,0,0,0,0];for(x.startsWith("::")?x=x.replace("::","Z:"):x=x.replace("::",":Z:"),x.indexOf(".")>0?(x=x.replace(new RegExp("[.]","g"),":"),w=x.split(":"),w[w.length-4]=Tc(w[w.length-4])+Tc(w[w.length-3])*256,w[w.length-3]=Tc(w[w.length-2])+Tc(w[w.length-1])*256,w=w.slice(0,w.length-2)):w=x.split(":"),A=0,O=0,_=0;_<w.length;_++)if(typeof w[_]=="string"){if(w[_]==="Z"){for(O=0;O<8-w.length+1;O++)X[_+O]=0;A=O-1;}else X[_+A]=Ib(parseInt(w[_],16));}else X[_+A]=w[_];return[X[1]<<16|X[0],X[3]<<16|X[2],X[5]<<16|X[4],X[7]<<16|X[6]];}var gs={address_map:{id:1,addrs:{},names:{}},lookup_name:function(x){var w=Pb(x);if(w!==null||(w=aU(x),w!==null))return x;var _;if(gs.address_map.addrs[x])_=gs.address_map.addrs[x];else{var A=gs.address_map.id++;$(A<65535,"exceeded max address mappings of 65535"),_="172.29."+(A&255)+"."+(A&65280),gs.address_map.names[_]=x,gs.address_map.addrs[x]=_;}return _;},lookup_addr:function(x){return gs.address_map.names[x]?gs.address_map.names[x]:null;}};function lU(x){var w=Oi(20),_=Oi(x.length+1);ie(x,_,x.length+1),Q[w>>2]=_;var A=Oi(4);Q[A>>2]=0,Q[w+4>>2]=A;var O=2;Q[w+8>>2]=O,Q[w+12>>2]=4;var z=Oi(12);return Q[z>>2]=z+8,Q[z+4>>2]=0,Q[z+8>>2]=Pb(gs.lookup_name(x)),Q[w+16>>2]=z,w;}function uU(x){return lU(D(x));}function cU(x){var w=Date.now();return Q[x>>2]=w/1e3|0,Q[x+4>>2]=w%1e3*1e3|0,0;}function hU(x){M(x);}function Rc(x){return x%4===0&&(x%100!==0||x%400===0);}function Jp(x,w){for(var _=0,A=0;A<=w;_+=x[A++]);return _;}var Nc=[31,29,31,30,31,30,31,31,30,31,30,31],Lc=[31,28,31,30,31,30,31,31,30,31,30,31];function Oc(x,w){for(var _=new Date(x.getTime());w>0;){var A=Rc(_.getFullYear()),O=_.getMonth(),z=(A?Nc:Lc)[O];if(w>z-_.getDate())w-=z-_.getDate()+1,_.setDate(1),O<11?_.setMonth(O+1):(_.setMonth(0),_.setFullYear(_.getFullYear()+1));else return _.setDate(_.getDate()+w),_;}return _;}function fU(x,w,_,A){var O=Q[A+40>>2],z={tm_sec:Q[A>>2],tm_min:Q[A+4>>2],tm_hour:Q[A+8>>2],tm_mday:Q[A+12>>2],tm_mon:Q[A+16>>2],tm_year:Q[A+20>>2],tm_wday:Q[A+24>>2],tm_yday:Q[A+28>>2],tm_isdst:Q[A+32>>2],tm_gmtoff:Q[A+36>>2],tm_zone:O?D(O):""},X=D(_),te={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var ae in te)X=X.replace(new RegExp(ae,"g"),te[ae]);var de=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Be=["January","February","March","April","May","June","July","August","September","October","November","December"];function _e(we,je,_t){for(var ft=typeof we=="number"?we.toString():we||"";ft.length<je;)ft=_t[0]+ft;return ft;}function ge(we,je){return _e(we,je,"0");}function Te(we,je){function _t(St){return St<0?-1:St>0?1:0;}var ft;return(ft=_t(we.getFullYear()-je.getFullYear()))===0&&(ft=_t(we.getMonth()-je.getMonth()))===0&&(ft=_t(we.getDate()-je.getDate())),ft;}function Ge(we){switch(we.getDay()){case 0:return new Date(we.getFullYear()-1,11,29);case 1:return we;case 2:return new Date(we.getFullYear(),0,3);case 3:return new Date(we.getFullYear(),0,2);case 4:return new Date(we.getFullYear(),0,1);case 5:return new Date(we.getFullYear()-1,11,31);case 6:return new Date(we.getFullYear()-1,11,30);}}function bt(we){var je=Oc(new Date(we.tm_year+1900,0,1),we.tm_yday),_t=new Date(je.getFullYear(),0,4),ft=new Date(je.getFullYear()+1,0,4),St=Ge(_t),qr=Ge(ft);return Te(St,je)<=0?Te(qr,je)<=0?je.getFullYear()+1:je.getFullYear():je.getFullYear()-1;}var yt={"%a":function(we){return de[we.tm_wday].substring(0,3);},"%A":function(we){return de[we.tm_wday];},"%b":function(we){return Be[we.tm_mon].substring(0,3);},"%B":function(we){return Be[we.tm_mon];},"%C":function(we){var je=we.tm_year+1900;return ge(je/100|0,2);},"%d":function(we){return ge(we.tm_mday,2);},"%e":function(we){return _e(we.tm_mday,2," ");},"%g":function(we){return bt(we).toString().substring(2);},"%G":function(we){return bt(we);},"%H":function(we){return ge(we.tm_hour,2);},"%I":function(we){var je=we.tm_hour;return je==0?je=12:je>12&&(je-=12),ge(je,2);},"%j":function(we){return ge(we.tm_mday+Jp(Rc(we.tm_year+1900)?Nc:Lc,we.tm_mon-1),3);},"%m":function(we){return ge(we.tm_mon+1,2);},"%M":function(we){return ge(we.tm_min,2);},"%n":function(){return`
`;},"%p":function(we){return we.tm_hour>=0&&we.tm_hour<12?"AM":"PM";},"%S":function(we){return ge(we.tm_sec,2);},"%t":function(){return"	";},"%u":function(we){return we.tm_wday||7;},"%U":function(we){var je=new Date(we.tm_year+1900,0,1),_t=je.getDay()===0?je:Oc(je,7-je.getDay()),ft=new Date(we.tm_year+1900,we.tm_mon,we.tm_mday);if(Te(_t,ft)<0){var St=Jp(Rc(ft.getFullYear())?Nc:Lc,ft.getMonth()-1)-31,qr=31-_t.getDate(),Wn=qr+St+ft.getDate();return ge(Math.ceil(Wn/7),2);}return Te(_t,je)===0?"01":"00";},"%V":function(we){var je=new Date(we.tm_year+1900,0,4),_t=new Date(we.tm_year+1901,0,4),ft=Ge(je),St=Ge(_t),qr=Oc(new Date(we.tm_year+1900,0,1),we.tm_yday);if(Te(qr,ft)<0)return"53";if(Te(St,qr)<=0)return"01";var Wn;return ft.getFullYear()<we.tm_year+1900?Wn=we.tm_yday+32-ft.getDate():Wn=we.tm_yday+1-ft.getDate(),ge(Math.ceil(Wn/7),2);},"%w":function(we){return we.tm_wday;},"%W":function(we){var je=new Date(we.tm_year,0,1),_t=je.getDay()===1?je:Oc(je,je.getDay()===0?1:7-je.getDay()+1),ft=new Date(we.tm_year+1900,we.tm_mon,we.tm_mday);if(Te(_t,ft)<0){var St=Jp(Rc(ft.getFullYear())?Nc:Lc,ft.getMonth()-1)-31,qr=31-_t.getDate(),Wn=qr+St+ft.getDate();return ge(Math.ceil(Wn/7),2);}return Te(_t,je)===0?"01":"00";},"%y":function(we){return(we.tm_year+1900).toString().substring(2);},"%Y":function(we){return we.tm_year+1900;},"%z":function(we){var je=we.tm_gmtoff,_t=je>=0;return je=Math.abs(je)/60,je=je/60*100+je%60,(_t?"+":"-")+String("0000"+je).slice(-4);},"%Z":function(we){return we.tm_zone;},"%%":function(){return"%";}};for(var ae in yt)X.includes(ae)&&(X=X.replace(new RegExp(ae,"g"),yt[ae](z)));var Wt=Dc(X,!1);return Wt.length>w?0:(R(Wt,x),Wt.length-1);}function dU(x,w,_,A){return fU(x,w,_,A);}var _b=function(x,w,_,A){x||(x=this),this.parent=x,this.mount=x.mount,this.mounted=null,this.id=N.nextInode++,this.name=w,this.mode=_,this.node_ops={},this.stream_ops={},this.rdev=A;},kc=365,Uc=146;Object.defineProperties(_b.prototype,{read:{get:function(){return(this.mode&kc)===kc;},set:function(x){x?this.mode|=kc:this.mode&=~kc;}},write:{get:function(){return(this.mode&Uc)===Uc;},set:function(x){x?this.mode|=Uc:this.mode&=~Uc;}},isFolder:{get:function(){return N.isDir(this.mode);}},isDevice:{get:function(){return N.isChrdev(this.mode);}}}),N.FSNode=_b,N.staticInit(),sk(),mb=t.BindingError=Xp(Error,"BindingError"),gb=t.InternalError=Xp(Error,"InternalError"),fk(),yb=t.UnboundTypeError=Xp(Error,"UnboundTypeError"),t.requestFullscreen=function(w,_){ce.requestFullscreen(w,_);},t.requestAnimationFrame=function(w){ce.requestAnimationFrame(w);},t.setCanvasSize=function(w,_,A){ce.setCanvasSize(w,_,A);},t.pauseMainLoop=function(){ce.mainLoop.pause();},t.resumeMainLoop=function(){ce.mainLoop.resume();},t.getUserMedia=function(){ce.getUserMedia();},t.createContext=function(w,_,A,O){return ce.createContext(w,_,A,O);};function Dc(x,w,_){var A=_>0?_:se(x)+1,O=new Array(A),z=k(x,O,0,O.length);return w&&(O.length=z),O;}var pU={ca:NO,a:kO,S:qO,R:zO,l:YO,M:XO,K:VO,D:WO,T:$O,J:jO,G:ZO,F:KO,E:JO,p:ek,L:tk,r:rk,Q:nk,y:ik,V:uk,U:dk,u:mk,i:Ak,d:Mk,b:Tk,t:Rk,m:Nk,W:Lk,A:Ok,o:bb,q:kk,v:Dk,N:Gk,O:jp,j:qk,g:Yk,w:Vk,C:Wk,aa:Zk,P:Hk,B:Qk,H:eU,I:tU,da:vb,h:rU,s:nU,x:iU,k:sU,f:oU,ba:uU,c:cU,_:BU,Y:AU,Z:IU,X:CU,$:SU,n:LO,e:hU,z:dU},dse=RO(),mU=t.___wasm_call_ctors=function(){return(mU=t.___wasm_call_ctors=t.asm.fa).apply(null,arguments);},ui=t._free=function(){return(ui=t._free=t.asm.ga).apply(null,arguments);},gU=t._main=function(){return(gU=t._main=t.asm.ha).apply(null,arguments);},Sb=t.___errno_location=function(){return(Sb=t.___errno_location=t.asm.ja).apply(null,arguments);},Oi=t._malloc=function(){return(Oi=t._malloc=t.asm.ka).apply(null,arguments);},Bb=t.___getTypeName=function(){return(Bb=t.___getTypeName=t.asm.la).apply(null,arguments);},xU=t.___embind_register_native_and_builtin_types=function(){return(xU=t.___embind_register_native_and_builtin_types=t.asm.ma).apply(null,arguments);},Ib=t._htons=function(){return(Ib=t._htons=t.asm.na).apply(null,arguments);},Ab=t._memalign=function(){return(Ab=t._memalign=t.asm.oa).apply(null,arguments);},Qo=t._setThrew=function(){return(Qo=t._setThrew=t.asm.pa).apply(null,arguments);},lo=t.stackSave=function(){return(lo=t.stackSave=t.asm.qa).apply(null,arguments);},uo=t.stackRestore=function(){return(uo=t.stackRestore=t.asm.ra).apply(null,arguments);},Rl=t.stackAlloc=function(){return(Rl=t.stackAlloc=t.asm.sa).apply(null,arguments);},bU=t.dynCall_viijii=function(){return(bU=t.dynCall_viijii=t.asm.ta).apply(null,arguments);},yU=t.dynCall_viiiiji=function(){return(yU=t.dynCall_viiiiji=t.asm.ua).apply(null,arguments);},wU=t.dynCall_viiijj=function(){return(wU=t.dynCall_viiijj=t.asm.va).apply(null,arguments);},vU=t.dynCall_jiji=function(){return(vU=t.dynCall_jiji=t.asm.wa).apply(null,arguments);},EU=t.dynCall_iiiiij=function(){return(EU=t.dynCall_iiiiij=t.asm.xa).apply(null,arguments);},PU=t.dynCall_iiiiijj=function(){return(PU=t.dynCall_iiiiijj=t.asm.ya).apply(null,arguments);},_U=t.dynCall_iiiiiijj=function(){return(_U=t.dynCall_iiiiiijj=t.asm.za).apply(null,arguments);};function SU(x,w,_,A,O){var z=lo();try{Ni(x)(w,_,A,O);}catch(X){if(uo(z),X!==X+0&&X!=="longjmp")throw X;Qo(1,0);}}function BU(x,w,_){var A=lo();try{return Ni(x)(w,_);}catch(O){if(uo(A),O!==O+0&&O!=="longjmp")throw O;Qo(1,0);}}function IU(x,w,_,A,O){var z=lo();try{return Ni(x)(w,_,A,O);}catch(X){if(uo(z),X!==X+0&&X!=="longjmp")throw X;Qo(1,0);}}function AU(x,w,_,A){var O=lo();try{return Ni(x)(w,_,A);}catch(z){if(uo(O),z!==z+0&&z!=="longjmp")throw z;Qo(1,0);}}function CU(x,w){var _=lo();try{Ni(x)(w);}catch(A){if(uo(_),A!==A+0&&A!=="longjmp")throw A;Qo(1,0);}}t.ccall=H,t.cwrap=W,t.FS=N;var Gc;function Cb(x){this.name="ExitStatus",this.message="Program terminated with exit("+x+")",this.status=x;}var MU=!1;Ml=function x(){Gc||em(),Gc||(Ml=x);};function TU(x){var w=t._main;x=x||[];var _=x.length+1,A=Rl((_+1)*4);Q[A>>2]=lt(l);for(var O=1;O<_;O++)Q[(A>>2)+O]=lt(x[O-1]);Q[(A>>2)+_]=0;try{var z=w(_,A);return Mb(z,!0),z;}catch(X){return zp(X);}finally{MU=!0;}}function em(x){if(x=x||a,oo>0||(_c(),oo>0))return;function w(){Gc||(Gc=!0,t.calledRun=!0,!T&&(Up(),Dp(),i(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),Tb&&TU(x),Sc()));}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("");},1),w();},1)):w();}t.run=em;function Mb(x,w){B=x,hn()||Gp(),RU(x);}function RU(x){B=x,hn()||(t.onExit&&t.onExit(x),T=!0),u(x,new Cb(x));}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();var Tb=!0;return t.noInitialRun&&(Tb=!1),em(),e.ready;};})(),CY=AY,MY=class{constructor(r=null,e=""){this.cdnUrl="https://modules.lceda.cn/occapi/1.1.4.92f98762/",this.progressCallback=null,e&&(this.cdnUrl=e),/^https?:/.test(this.cdnUrl)||(this.cdnUrl=location.origin+this.cdnUrl),this.progressCallback=r;}async init(){let r=this;this.module=await CY({locateFile(e){return r.cdnUrl+e;},exportProgress:this.progressCallback});}string2Uint8Array(r){let e=[];for(let t=0,n=r.length;t<n;++t)e.push(r.charCodeAt(t));return new Uint8Array(e);}RECVAndGENStepModel(r,e){if(/\.stp$|\.step$/i.test(r)){let t=new Uint8Array(e),n=this.module._malloc(t.length);this.module.HEAPU8.set(t,n),this.module.stp2component(r,n,t.length);}else if(r==="pcb.json"){let t=new TextEncoder().encode(e),n=this.module._malloc(t.length);return this.module.HEAPU8.set(t,n),this.module.pcb2stp("pcb.json",n,t.length,!0);}}stp2Obj(r){let e="",t=this.string2Uint8Array(r),n=this.module._malloc(t.length);this.module.HEAPU8.set(t,n),this.module.stp2obj("source",n,t.length,!0);try{this.module.FS.readFile("source.mtl",{encoding:"utf8"}).split(/\r?\n/).forEach(o=>{o[0]==="#"||(o[0]==="N"&&o[1]==="s"?(e=e+o+`
`,e=e+`endmtl
`):e=e+o+`
`);});}catch(i){console.log("mtl file error: ",i);}try{this.module.FS.readFile("source.obj",{encoding:"utf8"}).split(/\r?\n/).forEach(o=>{o[0]==="#"||o.indexOf("mtllib")>-1||o.indexOf("g ")>-1||(e=e+o+`
`);});}catch(i){return console.error("mtl file error: ",i),null;}return e;}};});var Eg=G((uP,vg)=>{(function(r){typeof uP=="object"&&typeof vg<"u"?vg.exports=r():typeof define=="function"&&define.amd?define([],r):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).JSZip=r();})(function(){return function r(e,t,n){function i(a,l){if(!t[a]){if(!e[a]){var u=typeof Nl=="function"&&Nl;if(!l&&u)return u(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c;}var h=t[a]={exports:{}};e[a][0].call(h.exports,function(d){var f=e[a][1][d];return i(f||d);},h,h.exports,r,e,t,n);}return t[a].exports;}for(var s=typeof Nl=="function"&&Nl,o=0;o<n.length;o++)i(n[o]);return i;}({1:[function(r,e,t){"use strict";var n=r("./utils"),i=r("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.encode=function(o){for(var a,l,u,c,h,d,f,p=[],m=0,g=o.length,b=g,y=n.getTypeOf(o)!=="string";m<o.length;)b=g-m,u=y?(a=o[m++],l=m<g?o[m++]:0,m<g?o[m++]:0):(a=o.charCodeAt(m++),l=m<g?o.charCodeAt(m++):0,m<g?o.charCodeAt(m++):0),c=a>>2,h=(3&a)<<4|l>>4,d=1<b?(15&l)<<2|u>>6:64,f=2<b?63&u:64,p.push(s.charAt(c)+s.charAt(h)+s.charAt(d)+s.charAt(f));return p.join("");},t.decode=function(o){var a,l,u,c,h,d,f=0,p=0,m="data:";if(o.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");var g,b=3*(o=o.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(o.charAt(o.length-1)===s.charAt(64)&&b--,o.charAt(o.length-2)===s.charAt(64)&&b--,b%1!=0)throw new Error("Invalid base64 input, bad content length.");for(g=i.uint8array?new Uint8Array(0|b):new Array(0|b);f<o.length;)a=s.indexOf(o.charAt(f++))<<2|(c=s.indexOf(o.charAt(f++)))>>4,l=(15&c)<<4|(h=s.indexOf(o.charAt(f++)))>>2,u=(3&h)<<6|(d=s.indexOf(o.charAt(f++))),g[p++]=a,h!==64&&(g[p++]=l),d!==64&&(g[p++]=u);return g;};},{"./support":30,"./utils":32}],2:[function(r,e,t){"use strict";var n=r("./external"),i=r("./stream/DataWorker"),s=r("./stream/Crc32Probe"),o=r("./stream/DataLengthProbe");function a(l,u,c,h,d){this.compressedSize=l,this.uncompressedSize=u,this.crc32=c,this.compression=h,this.compressedContent=d;}a.prototype={getContentWorker:function(){var l=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),u=this;return l.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch");}),l;},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression);}},a.createWorkerFrom=function(l,u,c){return l.pipe(new s()).pipe(new o("uncompressedSize")).pipe(u.compressWorker(c)).pipe(new o("compressedSize")).withStreamInfo("compression",u);},e.exports=a;},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,e,t){"use strict";var n=r("./stream/GenericWorker");t.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression");},uncompressWorker:function(){return new n("STORE decompression");}},t.DEFLATE=r("./flate");},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,e,t){"use strict";var n=r("./utils"),i=function(){for(var s,o=[],a=0;a<256;a++){s=a;for(var l=0;l<8;l++)s=1&s?3988292384^s>>>1:s>>>1;o[a]=s;}return o;}();e.exports=function(s,o){return s!==void 0&&s.length?n.getTypeOf(s)!=="string"?function(a,l,u,c){var h=i,d=c+u;a^=-1;for(var f=c;f<d;f++)a=a>>>8^h[255&(a^l[f])];return-1^a;}(0|o,s,s.length,0):function(a,l,u,c){var h=i,d=c+u;a^=-1;for(var f=c;f<d;f++)a=a>>>8^h[255&(a^l.charCodeAt(f))];return-1^a;}(0|o,s,s.length,0):0;};},{"./utils":32}],5:[function(r,e,t){"use strict";t.base64=!1,t.binary=!1,t.dir=!1,t.createFolders=!0,t.date=null,t.compression=null,t.compressionOptions=null,t.comment=null,t.unixPermissions=null,t.dosPermissions=null;},{}],6:[function(r,e,t){"use strict";var n=null;n=typeof Promise<"u"?Promise:r("lie"),e.exports={Promise:n};},{lie:37}],7:[function(r,e,t){"use strict";var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",i=r("pako"),s=r("./utils"),o=r("./stream/GenericWorker"),a=n?"uint8array":"array";function l(u,c){o.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=c,this.meta={};}t.magic="\b\0",s.inherits(l,o),l.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(a,u.data),!1);},l.prototype.flush=function(){o.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0);},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null;},l.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(c){u.push({data:c,meta:u.meta});};},t.compressWorker=function(u){return new l("Deflate",u);},t.uncompressWorker=function(){return new l("Inflate",{});};},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,e,t){"use strict";function n(h,d){var f,p="";for(f=0;f<d;f++)p+=String.fromCharCode(255&h),h>>>=8;return p;}function i(h,d,f,p,m,g){var b,y,v=h.file,E=h.compression,P=g!==a.utf8encode,M=s.transformTo("string",g(v.name)),I=s.transformTo("string",a.utf8encode(v.name)),C=v.comment,L=s.transformTo("string",g(C)),S=s.transformTo("string",a.utf8encode(C)),T=I.length!==v.name.length,B=S.length!==C.length,$="",Z="",H="",W=v.dir,Y=v.date,U={crc32:0,compressedSize:0,uncompressedSize:0};d&&!f||(U.crc32=h.crc32,U.compressedSize=h.compressedSize,U.uncompressedSize=h.uncompressedSize);var D=0;d&&(D|=8),P||!T&&!B||(D|=2048);var k=0,ie=0;W&&(k|=16),m==="UNIX"?(ie=798,k|=function(oe,le){var Ee=oe;return oe||(Ee=le?16893:33204),(65535&Ee)<<16;}(v.unixPermissions,W)):(ie=20,k|=function(oe){return 63&(oe||0);}(v.dosPermissions)),b=Y.getUTCHours(),b<<=6,b|=Y.getUTCMinutes(),b<<=5,b|=Y.getUTCSeconds()/2,y=Y.getUTCFullYear()-1980,y<<=4,y|=Y.getUTCMonth()+1,y<<=5,y|=Y.getUTCDate(),T&&(Z=n(1,1)+n(l(M),4)+I,$+="up"+n(Z.length,2)+Z),B&&(H=n(1,1)+n(l(L),4)+S,$+="uc"+n(H.length,2)+H);var se="";return se+=`
\0`,se+=n(D,2),se+=E.magic,se+=n(b,2),se+=n(y,2),se+=n(U.crc32,4),se+=n(U.compressedSize,4),se+=n(U.uncompressedSize,4),se+=n(M.length,2),se+=n($.length,2),{fileRecord:u.LOCAL_FILE_HEADER+se+M+$,dirRecord:u.CENTRAL_FILE_HEADER+n(ie,2)+se+n(L.length,2)+"\0\0\0\0"+n(k,4)+n(p,4)+M+$+L};}var s=r("../utils"),o=r("../stream/GenericWorker"),a=r("../utf8"),l=r("../crc32"),u=r("../signature");function c(h,d,f,p){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=d,this.zipPlatform=f,this.encodeFileName=p,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[];}s.inherits(c,o),c.prototype.push=function(h){var d=h.meta.percent||0,f=this.entriesCount,p=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,o.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:f?(d+100*(f-p-1))/f:100}}));},c.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var d=this.streamFiles&&!h.file.dir;if(d){var f=i(h,d,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:f.fileRecord,meta:{percent:0}});}else this.accumulate=!0;},c.prototype.closedSource=function(h){this.accumulate=!1;var d=this.streamFiles&&!h.file.dir,f=i(h,d,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(f.dirRecord),d)this.push({data:function(p){return u.DATA_DESCRIPTOR+n(p.crc32,4)+n(p.compressedSize,4)+n(p.uncompressedSize,4);}(h),meta:{percent:100}});else for(this.push({data:f.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null;},c.prototype.flush=function(){for(var h=this.bytesWritten,d=0;d<this.dirRecords.length;d++)this.push({data:this.dirRecords[d],meta:{percent:100}});var f=this.bytesWritten-h,p=function(m,g,b,y,v){var E=s.transformTo("string",v(y));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(m,2)+n(m,2)+n(g,4)+n(b,4)+n(E.length,2)+E;}(this.dirRecords.length,f,h,this.zipComment,this.encodeFileName);this.push({data:p,meta:{percent:100}});},c.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume();},c.prototype.registerPrevious=function(h){this._sources.push(h);var d=this;return h.on("data",function(f){d.processChunk(f);}),h.on("end",function(){d.closedSource(d.previous.streamInfo),d._sources.length?d.prepareNextSource():d.end();}),h.on("error",function(f){d.error(f);}),this;},c.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0));},c.prototype.error=function(h){var d=this._sources;if(!o.prototype.error.call(this,h))return!1;for(var f=0;f<d.length;f++)try{d[f].error(h);}catch{}return!0;},c.prototype.lock=function(){o.prototype.lock.call(this);for(var h=this._sources,d=0;d<h.length;d++)h[d].lock();},e.exports=c;},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,e,t){"use strict";var n=r("../compressions"),i=r("./ZipFileWorker");t.generateWorker=function(s,o,a){var l=new i(o.streamFiles,a,o.platform,o.encodeFileName),u=0;try{s.forEach(function(c,h){u++;var d=function(g,b){var y=g||b,v=n[y];if(!v)throw new Error(y+" is not a valid compression method !");return v;}(h.options.compression,o.compression),f=h.options.compressionOptions||o.compressionOptions||{},p=h.dir,m=h.date;h._compressWorker(d,f).withStreamInfo("file",{name:c,dir:p,date:m,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(l);}),l.entriesCount=u;}catch(c){l.error(c);}return l;};},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,e,t){"use strict";function n(){if(!(this instanceof n))return new n();if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var i=new n();for(var s in this)typeof this[s]!="function"&&(i[s]=this[s]);return i;};}(n.prototype=r("./object")).loadAsync=r("./load"),n.support=r("./support"),n.defaults=r("./defaults"),n.version="3.10.1",n.loadAsync=function(i,s){return new n().loadAsync(i,s);},n.external=r("./external"),e.exports=n;},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,e,t){"use strict";var n=r("./utils"),i=r("./external"),s=r("./utf8"),o=r("./zipEntries"),a=r("./stream/Crc32Probe"),l=r("./nodejsUtils");function u(c){return new i.Promise(function(h,d){var f=c.decompressed.getContentWorker().pipe(new a());f.on("error",function(p){d(p);}).on("end",function(){f.streamInfo.crc32!==c.decompressed.crc32?d(new Error("Corrupted zip : CRC32 mismatch")):h();}).resume();});}e.exports=function(c,h){var d=this;return h=n.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),l.isNode&&l.isStream(c)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",c,!0,h.optimizedBinaryString,h.base64).then(function(f){var p=new o(h);return p.load(f),p;}).then(function(f){var p=[i.Promise.resolve(f)],m=f.files;if(h.checkCRC32)for(var g=0;g<m.length;g++)p.push(u(m[g]));return i.Promise.all(p);}).then(function(f){for(var p=f.shift(),m=p.files,g=0;g<m.length;g++){var b=m[g],y=b.fileNameStr,v=n.resolve(b.fileNameStr);d.file(v,b.decompressed,{binary:!0,optimizedBinaryString:!0,date:b.date,dir:b.dir,comment:b.fileCommentStr.length?b.fileCommentStr:null,unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions,createFolders:h.createFolders}),b.dir||(d.file(v).unsafeOriginalName=y);}return p.zipComment.length&&(d.comment=p.zipComment),d;});};},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,e,t){"use strict";var n=r("../utils"),i=r("../stream/GenericWorker");function s(o,a){i.call(this,"Nodejs stream input adapter for "+o),this._upstreamEnded=!1,this._bindStream(a);}n.inherits(s,i),s.prototype._bindStream=function(o){var a=this;(this._stream=o).pause(),o.on("data",function(l){a.push({data:l,meta:{percent:0}});}).on("error",function(l){a.isPaused?this.generatedError=l:a.error(l);}).on("end",function(){a.isPaused?a._upstreamEnded=!0:a.end();});},s.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0);},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0);},e.exports=s;},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,e,t){"use strict";var n=r("readable-stream").Readable;function i(s,o,a){n.call(this,o),this._helper=s;var l=this;s.on("data",function(u,c){l.push(u)||l._helper.pause(),a&&a(c);}).on("error",function(u){l.emit("error",u);}).on("end",function(){l.push(null);});}r("../utils").inherits(i,n),i.prototype._read=function(){this._helper.resume();},e.exports=i;},{"../utils":32,"readable-stream":16}],14:[function(r,e,t){"use strict";e.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,i){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,i);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,i);},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var i=new Buffer(n);return i.fill(0),i;},isBuffer:function(n){return Buffer.isBuffer(n);},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function";}};},{}],15:[function(r,e,t){"use strict";function n(v,E,P){var M,I=s.getTypeOf(E),C=s.extend(P||{},l);C.date=C.date||new Date(),C.compression!==null&&(C.compression=C.compression.toUpperCase()),typeof C.unixPermissions=="string"&&(C.unixPermissions=parseInt(C.unixPermissions,8)),C.unixPermissions&&16384&C.unixPermissions&&(C.dir=!0),C.dosPermissions&&16&C.dosPermissions&&(C.dir=!0),C.dir&&(v=m(v)),C.createFolders&&(M=p(v))&&g.call(this,M,!0);var L=I==="string"&&C.binary===!1&&C.base64===!1;P&&P.binary!==void 0||(C.binary=!L),(E instanceof u&&E.uncompressedSize===0||C.dir||!E||E.length===0)&&(C.base64=!1,C.binary=!0,E="",C.compression="STORE",I="string");var S=null;S=E instanceof u||E instanceof o?E:d.isNode&&d.isStream(E)?new f(v,E):s.prepareContent(v,E,C.binary,C.optimizedBinaryString,C.base64);var T=new c(v,S,C);this.files[v]=T;}var i=r("./utf8"),s=r("./utils"),o=r("./stream/GenericWorker"),a=r("./stream/StreamHelper"),l=r("./defaults"),u=r("./compressedObject"),c=r("./zipObject"),h=r("./generate"),d=r("./nodejsUtils"),f=r("./nodejs/NodejsStreamInputAdapter"),p=function(v){v.slice(-1)==="/"&&(v=v.substring(0,v.length-1));var E=v.lastIndexOf("/");return 0<E?v.substring(0,E):"";},m=function(v){return v.slice(-1)!=="/"&&(v+="/"),v;},g=function(v,E){return E=E!==void 0?E:l.createFolders,v=m(v),this.files[v]||n.call(this,v,null,{dir:!0,createFolders:E}),this.files[v];};function b(v){return Object.prototype.toString.call(v)==="[object RegExp]";}var y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},forEach:function(v){var E,P,M;for(E in this.files)M=this.files[E],(P=E.slice(this.root.length,E.length))&&E.slice(0,this.root.length)===this.root&&v(P,M);},filter:function(v){var E=[];return this.forEach(function(P,M){v(P,M)&&E.push(M);}),E;},file:function(v,E,P){if(arguments.length!==1)return v=this.root+v,n.call(this,v,E,P),this;if(b(v)){var M=v;return this.filter(function(C,L){return!L.dir&&M.test(C);});}var I=this.files[this.root+v];return I&&!I.dir?I:null;},folder:function(v){if(!v)return this;if(b(v))return this.filter(function(I,C){return C.dir&&v.test(I);});var E=this.root+v,P=g.call(this,E),M=this.clone();return M.root=P.name,M;},remove:function(v){v=this.root+v;var E=this.files[v];if(E||(v.slice(-1)!=="/"&&(v+="/"),E=this.files[v]),E&&!E.dir)delete this.files[v];else for(var P=this.filter(function(I,C){return C.name.slice(0,v.length)===v;}),M=0;M<P.length;M++)delete this.files[P[M].name];return this;},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},generateInternalStream:function(v){var E,P={};try{if((P=s.extend(v||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");s.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var M=P.comment||this.comment||"";E=h.generateWorker(this,P,M);}catch(I){(E=new o("error")).error(I);}return new a(E,P.type||"string",P.mimeType);},generateAsync:function(v,E){return this.generateInternalStream(v).accumulate(E);},generateNodeStream:function(v,E){return(v=v||{}).type||(v.type="nodebuffer"),this.generateInternalStream(v).toNodejsStream(E);}};e.exports=y;},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,e,t){"use strict";e.exports=r("stream");},{stream:void 0}],17:[function(r,e,t){"use strict";var n=r("./DataReader");function i(s){n.call(this,s);for(var o=0;o<this.data.length;o++)s[o]=255&s[o];}r("../utils").inherits(i,n),i.prototype.byteAt=function(s){return this.data[this.zero+s];},i.prototype.lastIndexOfSignature=function(s){for(var o=s.charCodeAt(0),a=s.charCodeAt(1),l=s.charCodeAt(2),u=s.charCodeAt(3),c=this.length-4;0<=c;--c)if(this.data[c]===o&&this.data[c+1]===a&&this.data[c+2]===l&&this.data[c+3]===u)return c-this.zero;return-1;},i.prototype.readAndCheckSignature=function(s){var o=s.charCodeAt(0),a=s.charCodeAt(1),l=s.charCodeAt(2),u=s.charCodeAt(3),c=this.readData(4);return o===c[0]&&a===c[1]&&l===c[2]&&u===c[3];},i.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var o=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,o;},e.exports=i;},{"../utils":32,"./DataReader":18}],18:[function(r,e,t){"use strict";var n=r("../utils");function i(s){this.data=s,this.length=s.length,this.index=0,this.zero=0;}i.prototype={checkOffset:function(s){this.checkIndex(this.index+s);},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?");},setIndex:function(s){this.checkIndex(s),this.index=s;},skip:function(s){this.setIndex(this.index+s);},byteAt:function(){},readInt:function(s){var o,a=0;for(this.checkOffset(s),o=this.index+s-1;o>=this.index;o--)a=(a<<8)+this.byteAt(o);return this.index+=s,a;},readString:function(s){return n.transformTo("string",this.readData(s));},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1));}},e.exports=i;},{"../utils":32}],19:[function(r,e,t){"use strict";var n=r("./Uint8ArrayReader");function i(s){n.call(this,s);}r("../utils").inherits(i,n),i.prototype.readData=function(s){this.checkOffset(s);var o=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,o;},e.exports=i;},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,e,t){"use strict";var n=r("./DataReader");function i(s){n.call(this,s);}r("../utils").inherits(i,n),i.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s);},i.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero;},i.prototype.readAndCheckSignature=function(s){return s===this.readData(4);},i.prototype.readData=function(s){this.checkOffset(s);var o=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,o;},e.exports=i;},{"../utils":32,"./DataReader":18}],21:[function(r,e,t){"use strict";var n=r("./ArrayReader");function i(s){n.call(this,s);}r("../utils").inherits(i,n),i.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var o=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,o;},e.exports=i;},{"../utils":32,"./ArrayReader":17}],22:[function(r,e,t){"use strict";var n=r("../utils"),i=r("../support"),s=r("./ArrayReader"),o=r("./StringReader"),a=r("./NodeBufferReader"),l=r("./Uint8ArrayReader");e.exports=function(u){var c=n.getTypeOf(u);return n.checkSupport(c),c!=="string"||i.uint8array?c==="nodebuffer"?new a(u):i.uint8array?new l(n.transformTo("uint8array",u)):new s(n.transformTo("array",u)):new o(u);};},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,e,t){"use strict";t.LOCAL_FILE_HEADER="PK",t.CENTRAL_FILE_HEADER="PK",t.CENTRAL_DIRECTORY_END="PK",t.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",t.ZIP64_CENTRAL_DIRECTORY_END="PK",t.DATA_DESCRIPTOR="PK\x07\b";},{}],24:[function(r,e,t){"use strict";var n=r("./GenericWorker"),i=r("../utils");function s(o){n.call(this,"ConvertWorker to "+o),this.destType=o;}i.inherits(s,n),s.prototype.processChunk=function(o){this.push({data:i.transformTo(this.destType,o.data),meta:o.meta});},e.exports=s;},{"../utils":32,"./GenericWorker":28}],25:[function(r,e,t){"use strict";var n=r("./GenericWorker"),i=r("../crc32");function s(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0);}r("../utils").inherits(s,n),s.prototype.processChunk=function(o){this.streamInfo.crc32=i(o.data,this.streamInfo.crc32||0),this.push(o);},e.exports=s;},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,e,t){"use strict";var n=r("../utils"),i=r("./GenericWorker");function s(o){i.call(this,"DataLengthProbe for "+o),this.propName=o,this.withStreamInfo(o,0);}n.inherits(s,i),s.prototype.processChunk=function(o){if(o){var a=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=a+o.data.length;}i.prototype.processChunk.call(this,o);},e.exports=s;},{"../utils":32,"./GenericWorker":28}],27:[function(r,e,t){"use strict";var n=r("../utils"),i=r("./GenericWorker");function s(o){i.call(this,"DataWorker");var a=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,o.then(function(l){a.dataIsReady=!0,a.data=l,a.max=l&&l.length||0,a.type=n.getTypeOf(l),a.isPaused||a._tickAndRepeat();},function(l){a.error(l);});}n.inherits(s,i),s.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null;},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0);},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0));},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var o=null,a=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":o=this.data.substring(this.index,a);break;case"uint8array":o=this.data.subarray(this.index,a);break;case"array":case"nodebuffer":o=this.data.slice(this.index,a);}return this.index=a,this.push({data:o,meta:{percent:this.max?this.index/this.max*100:0}});},e.exports=s;},{"../utils":32,"./GenericWorker":28}],28:[function(r,e,t){"use strict";function n(i){this.name=i||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null;}n.prototype={push:function(i){this.emit("data",i);},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0;}catch(i){this.emit("error",i);}return!0;},error:function(i){return!this.isFinished&&(this.isPaused?this.generatedError=i:(this.isFinished=!0,this.emit("error",i),this.previous&&this.previous.error(i),this.cleanUp()),!0);},on:function(i,s){return this._listeners[i].push(s),this;},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[];},emit:function(i,s){if(this._listeners[i])for(var o=0;o<this._listeners[i].length;o++)this._listeners[i][o].call(this,s);},pipe:function(i){return i.registerPrevious(this);},registerPrevious:function(i){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=i.streamInfo,this.mergeStreamInfo(),this.previous=i;var s=this;return i.on("data",function(o){s.processChunk(o);}),i.on("end",function(){s.end();}),i.on("error",function(o){s.error(o);}),this;},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0);},resume:function(){if(!this.isPaused||this.isFinished)return!1;var i=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),i=!0),this.previous&&this.previous.resume(),!i;},flush:function(){},processChunk:function(i){this.push(i);},withStreamInfo:function(i,s){return this.extraStreamInfo[i]=s,this.mergeStreamInfo(),this;},mergeStreamInfo:function(){for(var i in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,i)&&(this.streamInfo[i]=this.extraStreamInfo[i]);},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock();},toString:function(){var i="Worker "+this.name;return this.previous?this.previous+" -> "+i:i;}},e.exports=n;},{}],29:[function(r,e,t){"use strict";var n=r("../utils"),i=r("./ConvertWorker"),s=r("./GenericWorker"),o=r("../base64"),a=r("../support"),l=r("../external"),u=null;if(a.nodestream)try{u=r("../nodejs/NodejsStreamOutputAdapter");}catch{}function c(d,f){return new l.Promise(function(p,m){var g=[],b=d._internalType,y=d._outputType,v=d._mimeType;d.on("data",function(E,P){g.push(E),f&&f(P);}).on("error",function(E){g=[],m(E);}).on("end",function(){try{var E=function(P,M,I){switch(P){case"blob":return n.newBlob(n.transformTo("arraybuffer",M),I);case"base64":return o.encode(M);default:return n.transformTo(P,M);}}(y,function(P,M){var I,C=0,L=null,S=0;for(I=0;I<M.length;I++)S+=M[I].length;switch(P){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(L=new Uint8Array(S),I=0;I<M.length;I++)L.set(M[I],C),C+=M[I].length;return L;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+P+"'");}}(b,g),v);p(E);}catch(P){m(P);}g=[];}).resume();});}function h(d,f,p){var m=f;switch(f){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string";}try{this._internalType=m,this._outputType=f,this._mimeType=p,n.checkSupport(m),this._worker=d.pipe(new i(m)),d.lock();}catch(g){this._worker=new s("error"),this._worker.error(g);}}h.prototype={accumulate:function(d){return c(this,d);},on:function(d,f){var p=this;return d==="data"?this._worker.on(d,function(m){f.call(p,m.data,m.meta);}):this._worker.on(d,function(){n.delay(f,arguments,p);}),this;},resume:function(){return n.delay(this._worker.resume,[],this._worker),this;},pause:function(){return this._worker.pause(),this;},toNodejsStream:function(d){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},d);}},e.exports=h;},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,e,t){"use strict";if(t.base64=!0,t.array=!0,t.string=!0,t.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",t.nodebuffer=typeof Buffer<"u",t.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")t.blob=!1;else{var n=new ArrayBuffer(0);try{t.blob=new Blob([n],{type:"application/zip"}).size===0;}catch{try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder)();i.append(n),t.blob=i.getBlob("application/zip").size===0;}catch{t.blob=!1;}}}try{t.nodestream=!!r("readable-stream").Readable;}catch{t.nodestream=!1;}},{"readable-stream":16}],31:[function(r,e,t){"use strict";for(var n=r("./utils"),i=r("./support"),s=r("./nodejsUtils"),o=r("./stream/GenericWorker"),a=new Array(256),l=0;l<256;l++)a[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;a[254]=a[254]=1;function u(){o.call(this,"utf-8 decode"),this.leftOver=null;}function c(){o.call(this,"utf-8 encode");}t.utf8encode=function(h){return i.nodebuffer?s.newBufferFrom(h,"utf-8"):function(d){var f,p,m,g,b,y=d.length,v=0;for(g=0;g<y;g++)(64512&(p=d.charCodeAt(g)))==55296&&g+1<y&&(64512&(m=d.charCodeAt(g+1)))==56320&&(p=65536+(p-55296<<10)+(m-56320),g++),v+=p<128?1:p<2048?2:p<65536?3:4;for(f=i.uint8array?new Uint8Array(v):new Array(v),g=b=0;b<v;g++)(64512&(p=d.charCodeAt(g)))==55296&&g+1<y&&(64512&(m=d.charCodeAt(g+1)))==56320&&(p=65536+(p-55296<<10)+(m-56320),g++),p<128?f[b++]=p:(p<2048?f[b++]=192|p>>>6:(p<65536?f[b++]=224|p>>>12:(f[b++]=240|p>>>18,f[b++]=128|p>>>12&63),f[b++]=128|p>>>6&63),f[b++]=128|63&p);return f;}(h);},t.utf8decode=function(h){return i.nodebuffer?n.transformTo("nodebuffer",h).toString("utf-8"):function(d){var f,p,m,g,b=d.length,y=new Array(2*b);for(f=p=0;f<b;)if((m=d[f++])<128)y[p++]=m;else if(4<(g=a[m]))y[p++]=65533,f+=g-1;else{for(m&=g===2?31:g===3?15:7;1<g&&f<b;)m=m<<6|63&d[f++],g--;1<g?y[p++]=65533:m<65536?y[p++]=m:(m-=65536,y[p++]=55296|m>>10&1023,y[p++]=56320|1023&m);}return y.length!==p&&(y.subarray?y=y.subarray(0,p):y.length=p),n.applyFromCharCode(y);}(h=n.transformTo(i.uint8array?"uint8array":"array",h));},n.inherits(u,o),u.prototype.processChunk=function(h){var d=n.transformTo(i.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var f=d;(d=new Uint8Array(f.length+this.leftOver.length)).set(this.leftOver,0),d.set(f,this.leftOver.length);}else d=this.leftOver.concat(d);this.leftOver=null;}var p=function(g,b){var y;for((b=b||g.length)>g.length&&(b=g.length),y=b-1;0<=y&&(192&g[y])==128;)y--;return y<0||y===0?b:y+a[g[y]]>b?y:b;}(d),m=d;p!==d.length&&(i.uint8array?(m=d.subarray(0,p),this.leftOver=d.subarray(p,d.length)):(m=d.slice(0,p),this.leftOver=d.slice(p,d.length))),this.push({data:t.utf8decode(m),meta:h.meta});},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:t.utf8decode(this.leftOver),meta:{}}),this.leftOver=null);},t.Utf8DecodeWorker=u,n.inherits(c,o),c.prototype.processChunk=function(h){this.push({data:t.utf8encode(h.data),meta:h.meta});},t.Utf8EncodeWorker=c;},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,e,t){"use strict";var n=r("./support"),i=r("./base64"),s=r("./nodejsUtils"),o=r("./external");function a(f){return f;}function l(f,p){for(var m=0;m<f.length;++m)p[m]=255&f.charCodeAt(m);return p;}r("setimmediate"),t.newBlob=function(f,p){t.checkSupport("blob");try{return new Blob([f],{type:p});}catch{try{var m=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder)();return m.append(f),m.getBlob(p);}catch{throw new Error("Bug : can't construct the Blob.");}}};var u={stringifyByChunk:function(f,p,m){var g=[],b=0,y=f.length;if(y<=m)return String.fromCharCode.apply(null,f);for(;b<y;)p==="array"||p==="nodebuffer"?g.push(String.fromCharCode.apply(null,f.slice(b,Math.min(b+m,y)))):g.push(String.fromCharCode.apply(null,f.subarray(b,Math.min(b+m,y)))),b+=m;return g.join("");},stringifyByChar:function(f){for(var p="",m=0;m<f.length;m++)p+=String.fromCharCode(f[m]);return p;},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1;}catch{return!1;}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1;}catch{return!1;}}()}};function c(f){var p=65536,m=t.getTypeOf(f),g=!0;if(m==="uint8array"?g=u.applyCanBeUsed.uint8array:m==="nodebuffer"&&(g=u.applyCanBeUsed.nodebuffer),g)for(;1<p;)try{return u.stringifyByChunk(f,m,p);}catch{p=Math.floor(p/2);}return u.stringifyByChar(f);}function h(f,p){for(var m=0;m<f.length;m++)p[m]=f[m];return p;}t.applyFromCharCode=c;var d={};d.string={string:a,array:function(f){return l(f,new Array(f.length));},arraybuffer:function(f){return d.string.uint8array(f).buffer;},uint8array:function(f){return l(f,new Uint8Array(f.length));},nodebuffer:function(f){return l(f,s.allocBuffer(f.length));}},d.array={string:c,array:a,arraybuffer:function(f){return new Uint8Array(f).buffer;},uint8array:function(f){return new Uint8Array(f);},nodebuffer:function(f){return s.newBufferFrom(f);}},d.arraybuffer={string:function(f){return c(new Uint8Array(f));},array:function(f){return h(new Uint8Array(f),new Array(f.byteLength));},arraybuffer:a,uint8array:function(f){return new Uint8Array(f);},nodebuffer:function(f){return s.newBufferFrom(new Uint8Array(f));}},d.uint8array={string:c,array:function(f){return h(f,new Array(f.length));},arraybuffer:function(f){return f.buffer;},uint8array:a,nodebuffer:function(f){return s.newBufferFrom(f);}},d.nodebuffer={string:c,array:function(f){return h(f,new Array(f.length));},arraybuffer:function(f){return d.nodebuffer.uint8array(f).buffer;},uint8array:function(f){return h(f,new Uint8Array(f.length));},nodebuffer:a},t.transformTo=function(f,p){if(p=p||"",!f)return p;t.checkSupport(f);var m=t.getTypeOf(p);return d[m][f](p);},t.resolve=function(f){for(var p=f.split("/"),m=[],g=0;g<p.length;g++){var b=p[g];b==="."||b===""&&g!==0&&g!==p.length-1||(b===".."?m.pop():m.push(b));}return m.join("/");},t.getTypeOf=function(f){return typeof f=="string"?"string":Object.prototype.toString.call(f)==="[object Array]"?"array":n.nodebuffer&&s.isBuffer(f)?"nodebuffer":n.uint8array&&f instanceof Uint8Array?"uint8array":n.arraybuffer&&f instanceof ArrayBuffer?"arraybuffer":void 0;},t.checkSupport=function(f){if(!n[f.toLowerCase()])throw new Error(f+" is not supported by this platform");},t.MAX_VALUE_16BITS=65535,t.MAX_VALUE_32BITS=-1,t.pretty=function(f){var p,m,g="";for(m=0;m<(f||"").length;m++)g+="\\x"+((p=f.charCodeAt(m))<16?"0":"")+p.toString(16).toUpperCase();return g;},t.delay=function(f,p,m){setImmediate(function(){f.apply(m||null,p||[]);});},t.inherits=function(f,p){function m(){}m.prototype=p.prototype,f.prototype=new m();},t.extend=function(){var f,p,m={};for(f=0;f<arguments.length;f++)for(p in arguments[f])Object.prototype.hasOwnProperty.call(arguments[f],p)&&m[p]===void 0&&(m[p]=arguments[f][p]);return m;},t.prepareContent=function(f,p,m,g,b){return o.Promise.resolve(p).then(function(y){return n.blob&&(y instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(y))!==-1)&&typeof FileReader<"u"?new o.Promise(function(v,E){var P=new FileReader();P.onload=function(M){v(M.target.result);},P.onerror=function(M){E(M.target.error);},P.readAsArrayBuffer(y);}):y;}).then(function(y){var v=t.getTypeOf(y);return v?(v==="arraybuffer"?y=t.transformTo("uint8array",y):v==="string"&&(b?y=i.decode(y):m&&g!==!0&&(y=function(E){return l(E,n.uint8array?new Uint8Array(E.length):new Array(E.length));}(y))),y):o.Promise.reject(new Error("Can't read the data of '"+f+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"));});};},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,e,t){"use strict";var n=r("./reader/readerFor"),i=r("./utils"),s=r("./signature"),o=r("./zipEntry"),a=r("./support");function l(u){this.files=[],this.loadOptions=u;}l.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var c=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(c)+", expected "+i.pretty(u)+")");}},isSignature:function(u,c){var h=this.reader.index;this.reader.setIndex(u);var d=this.reader.readString(4)===c;return this.reader.setIndex(h),d;},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),c=a.uint8array?"uint8array":"array",h=i.transformTo(c,u);this.zipComment=this.loadOptions.decodeFileName(h);},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,c,h,d=this.zip64EndOfCentralSize-44;0<d;)u=this.reader.readInt(2),c=this.reader.readInt(4),h=this.reader.readData(c),this.zip64ExtensibleData[u]={id:u,length:c,value:h};},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported");},readLocalFiles:function(){var u,c;for(u=0;u<this.files.length;u++)c=this.files[u],this.reader.setIndex(c.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),c.readLocalPart(this.reader),c.handleUTF8(),c.processAttributes();},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(u=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length);},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var c=u;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral();}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var d=c-h;if(0<d)this.isSignature(c,s.CENTRAL_FILE_HEADER)||(this.reader.zero=d);else if(d<0)throw new Error("Corrupted zip: missing "+Math.abs(d)+" bytes.");},prepareReader:function(u){this.reader=n(u);},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles();}},e.exports=l;},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,e,t){"use strict";var n=r("./reader/readerFor"),i=r("./utils"),s=r("./compressedObject"),o=r("./crc32"),a=r("./utf8"),l=r("./compressions"),u=r("./support");function c(h,d){this.options=h,this.loadOptions=d;}c.prototype={isEncrypted:function(){return(1&this.bitFlag)==1;},useUTF8:function(){return(2048&this.bitFlag)==2048;},readLocalPart:function(h){var d,f;if(h.skip(22),this.fileNameLength=h.readInt(2),f=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(f),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((d=function(p){for(var m in l)if(Object.prototype.hasOwnProperty.call(l,m)&&l[m].magic===p)return l[m];return null;}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,d,h.readData(this.compressedSize));},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var d=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(d),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength);},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0);},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4));}},readExtraFields:function(h){var d,f,p,m=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<m;)d=h.readInt(2),f=h.readInt(2),p=h.readData(f),this.extraFields[d]={id:d,length:f,value:p};h.setIndex(m);},handleUTF8:function(){var h=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var d=this.findExtraFieldUnicodePath();if(d!==null)this.fileNameStr=d;else{var f=i.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(f);}var p=this.findExtraFieldUnicodeComment();if(p!==null)this.fileCommentStr=p;else{var m=i.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(m);}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var d=n(h.value);return d.readInt(1)!==1||o(this.fileName)!==d.readInt(4)?null:a.utf8decode(d.readData(h.length-5));}return null;},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var d=n(h.value);return d.readInt(1)!==1||o(this.fileComment)!==d.readInt(4)?null:a.utf8decode(d.readData(h.length-5));}return null;}},e.exports=c;},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,e,t){"use strict";function n(d,f,p){this.name=d,this.dir=p.dir,this.date=p.date,this.comment=p.comment,this.unixPermissions=p.unixPermissions,this.dosPermissions=p.dosPermissions,this._data=f,this._dataBinary=p.binary,this.options={compression:p.compression,compressionOptions:p.compressionOptions};}var i=r("./stream/StreamHelper"),s=r("./stream/DataWorker"),o=r("./utf8"),a=r("./compressedObject"),l=r("./stream/GenericWorker");n.prototype={internalStream:function(d){var f=null,p="string";try{if(!d)throw new Error("No output type specified.");var m=(p=d.toLowerCase())==="string"||p==="text";p!=="binarystring"&&p!=="text"||(p="string"),f=this._decompressWorker();var g=!this._dataBinary;g&&!m&&(f=f.pipe(new o.Utf8EncodeWorker())),!g&&m&&(f=f.pipe(new o.Utf8DecodeWorker()));}catch(b){(f=new l("error")).error(b);}return new i(f,p,"");},async:function(d,f){return this.internalStream(d).accumulate(f);},nodeStream:function(d,f){return this.internalStream(d||"nodebuffer").toNodejsStream(f);},_compressWorker:function(d,f){if(this._data instanceof a&&this._data.compression.magic===d.magic)return this._data.getCompressedWorker();var p=this._decompressWorker();return this._dataBinary||(p=p.pipe(new o.Utf8EncodeWorker())),a.createWorkerFrom(p,d,f);},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof l?this._data:new s(this._data);}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.");},h=0;h<u.length;h++)n.prototype[u[h]]=c;e.exports=n;},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,e,t){(function(n){"use strict";var i,s,o=n.MutationObserver||n.WebKitMutationObserver;if(o){var a=0,l=new o(d),u=n.document.createTextNode("");l.observe(u,{characterData:!0}),i=function(){u.data=a=++a%2;};}else if(n.setImmediate||n.MessageChannel===void 0)i="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var f=n.document.createElement("script");f.onreadystatechange=function(){d(),f.onreadystatechange=null,f.parentNode.removeChild(f),f=null;},n.document.documentElement.appendChild(f);}:function(){setTimeout(d,0);};else{var c=new n.MessageChannel();c.port1.onmessage=d,i=function(){c.port2.postMessage(0);};}var h=[];function d(){var f,p;s=!0;for(var m=h.length;m;){for(p=h,h=[],f=-1;++f<m;)p[f]();m=h.length;}s=!1;}e.exports=function(f){h.push(f)!==1||s||i();};}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{});},{}],37:[function(r,e,t){"use strict";var n=r("immediate");function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function u(m){if(typeof m!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,m!==i&&f(this,m);}function c(m,g,b){this.promise=m,typeof g=="function"&&(this.onFulfilled=g,this.callFulfilled=this.otherCallFulfilled),typeof b=="function"&&(this.onRejected=b,this.callRejected=this.otherCallRejected);}function h(m,g,b){n(function(){var y;try{y=g(b);}catch(v){return s.reject(m,v);}y===m?s.reject(m,new TypeError("Cannot resolve promise with itself")):s.resolve(m,y);});}function d(m){var g=m&&m.then;if(m&&(typeof m=="object"||typeof m=="function")&&typeof g=="function")return function(){g.apply(m,arguments);};}function f(m,g){var b=!1;function y(P){b||(b=!0,s.reject(m,P));}function v(P){b||(b=!0,s.resolve(m,P));}var E=p(function(){g(v,y);});E.status==="error"&&y(E.value);}function p(m,g){var b={};try{b.value=m(g),b.status="success";}catch(y){b.status="error",b.value=y;}return b;}(e.exports=u).prototype.finally=function(m){if(typeof m!="function")return this;var g=this.constructor;return this.then(function(b){return g.resolve(m()).then(function(){return b;});},function(b){return g.resolve(m()).then(function(){throw b;});});},u.prototype.catch=function(m){return this.then(null,m);},u.prototype.then=function(m,g){if(typeof m!="function"&&this.state===a||typeof g!="function"&&this.state===o)return this;var b=new this.constructor(i);return this.state!==l?h(b,this.state===a?m:g,this.outcome):this.queue.push(new c(b,m,g)),b;},c.prototype.callFulfilled=function(m){s.resolve(this.promise,m);},c.prototype.otherCallFulfilled=function(m){h(this.promise,this.onFulfilled,m);},c.prototype.callRejected=function(m){s.reject(this.promise,m);},c.prototype.otherCallRejected=function(m){h(this.promise,this.onRejected,m);},s.resolve=function(m,g){var b=p(d,g);if(b.status==="error")return s.reject(m,b.value);var y=b.value;if(y)f(m,y);else{m.state=a,m.outcome=g;for(var v=-1,E=m.queue.length;++v<E;)m.queue[v].callFulfilled(g);}return m;},s.reject=function(m,g){m.state=o,m.outcome=g;for(var b=-1,y=m.queue.length;++b<y;)m.queue[b].callRejected(g);return m;},u.resolve=function(m){return m instanceof this?m:s.resolve(new this(i),m);},u.reject=function(m){var g=new this(i);return s.reject(g,m);},u.all=function(m){var g=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=m.length,y=!1;if(!b)return this.resolve([]);for(var v=new Array(b),E=0,P=-1,M=new this(i);++P<b;)I(m[P],P);return M;function I(C,L){g.resolve(C).then(function(S){v[L]=S,++E!==b||y||(y=!0,s.resolve(M,v));},function(S){y||(y=!0,s.reject(M,S));});}},u.race=function(m){var g=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=m.length,y=!1;if(!b)return this.resolve([]);for(var v=-1,E=new this(i);++v<b;)P=m[v],g.resolve(P).then(function(M){y||(y=!0,s.resolve(E,M));},function(M){y||(y=!0,s.reject(E,M));});var P;return E;};},{immediate:36}],38:[function(r,e,t){"use strict";var n={};(0,r("./lib/utils/common").assign)(n,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),e.exports=n;},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,e,t){"use strict";var n=r("./zlib/deflate"),i=r("./utils/common"),s=r("./utils/strings"),o=r("./zlib/messages"),a=r("./zlib/zstream"),l=Object.prototype.toString,u=0,c=-1,h=0,d=8;function f(m){if(!(this instanceof f))return new f(m);this.options=i.assign({level:c,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},m||{});var g=this.options;g.raw&&0<g.windowBits?g.windowBits=-g.windowBits:g.gzip&&0<g.windowBits&&g.windowBits<16&&(g.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a(),this.strm.avail_out=0;var b=n.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(b!==u)throw new Error(o[b]);if(g.header&&n.deflateSetHeader(this.strm,g.header),g.dictionary){var y;if(y=typeof g.dictionary=="string"?s.string2buf(g.dictionary):l.call(g.dictionary)==="[object ArrayBuffer]"?new Uint8Array(g.dictionary):g.dictionary,(b=n.deflateSetDictionary(this.strm,y))!==u)throw new Error(o[b]);this._dict_set=!0;}}function p(m,g){var b=new f(g);if(b.push(m,!0),b.err)throw b.msg||o[b.err];return b.result;}f.prototype.push=function(m,g){var b,y,v=this.strm,E=this.options.chunkSize;if(this.ended)return!1;y=g===~~g?g:g===!0?4:0,typeof m=="string"?v.input=s.string2buf(m):l.call(m)==="[object ArrayBuffer]"?v.input=new Uint8Array(m):v.input=m,v.next_in=0,v.avail_in=v.input.length;do{if(v.avail_out===0&&(v.output=new i.Buf8(E),v.next_out=0,v.avail_out=E),(b=n.deflate(v,y))!==1&&b!==u)return this.onEnd(b),!(this.ended=!0);v.avail_out!==0&&(v.avail_in!==0||y!==4&&y!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(i.shrinkBuf(v.output,v.next_out))):this.onData(i.shrinkBuf(v.output,v.next_out)));}while((0<v.avail_in||v.avail_out===0)&&b!==1);return y===4?(b=n.deflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===u):y!==2||(this.onEnd(u),!(v.avail_out=0));},f.prototype.onData=function(m){this.chunks.push(m);},f.prototype.onEnd=function(m){m===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg;},t.Deflate=f,t.deflate=p,t.deflateRaw=function(m,g){return(g=g||{}).raw=!0,p(m,g);},t.gzip=function(m,g){return(g=g||{}).gzip=!0,p(m,g);};},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,e,t){"use strict";var n=r("./zlib/inflate"),i=r("./utils/common"),s=r("./utils/strings"),o=r("./zlib/constants"),a=r("./zlib/messages"),l=r("./zlib/zstream"),u=r("./zlib/gzheader"),c=Object.prototype.toString;function h(f){if(!(this instanceof h))return new h(f);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},f||{});var p=this.options;p.raw&&0<=p.windowBits&&p.windowBits<16&&(p.windowBits=-p.windowBits,p.windowBits===0&&(p.windowBits=-15)),!(0<=p.windowBits&&p.windowBits<16)||f&&f.windowBits||(p.windowBits+=32),15<p.windowBits&&p.windowBits<48&&(15&p.windowBits)==0&&(p.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l(),this.strm.avail_out=0;var m=n.inflateInit2(this.strm,p.windowBits);if(m!==o.Z_OK)throw new Error(a[m]);this.header=new u(),n.inflateGetHeader(this.strm,this.header);}function d(f,p){var m=new h(p);if(m.push(f,!0),m.err)throw m.msg||a[m.err];return m.result;}h.prototype.push=function(f,p){var m,g,b,y,v,E,P=this.strm,M=this.options.chunkSize,I=this.options.dictionary,C=!1;if(this.ended)return!1;g=p===~~p?p:p===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof f=="string"?P.input=s.binstring2buf(f):c.call(f)==="[object ArrayBuffer]"?P.input=new Uint8Array(f):P.input=f,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new i.Buf8(M),P.next_out=0,P.avail_out=M),(m=n.inflate(P,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&I&&(E=typeof I=="string"?s.string2buf(I):c.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,m=n.inflateSetDictionary(this.strm,E)),m===o.Z_BUF_ERROR&&C===!0&&(m=o.Z_OK,C=!1),m!==o.Z_STREAM_END&&m!==o.Z_OK)return this.onEnd(m),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&m!==o.Z_STREAM_END&&(P.avail_in!==0||g!==o.Z_FINISH&&g!==o.Z_SYNC_FLUSH)||(this.options.to==="string"?(b=s.utf8border(P.output,P.next_out),y=P.next_out-b,v=s.buf2string(P.output,b),P.next_out=y,P.avail_out=M-y,y&&i.arraySet(P.output,P.output,b,y,0),this.onData(v)):this.onData(i.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(C=!0);}while((0<P.avail_in||P.avail_out===0)&&m!==o.Z_STREAM_END);return m===o.Z_STREAM_END&&(g=o.Z_FINISH),g===o.Z_FINISH?(m=n.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===o.Z_OK):g!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(P.avail_out=0));},h.prototype.onData=function(f){this.chunks.push(f);},h.prototype.onEnd=function(f){f===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg;},t.Inflate=h,t.inflate=d,t.inflateRaw=function(f,p){return(p=p||{}).raw=!0,d(f,p);},t.ungzip=d;},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,e,t){"use strict";var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";t.assign=function(o){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var u in l)l.hasOwnProperty(u)&&(o[u]=l[u]);}}return o;},t.shrinkBuf=function(o,a){return o.length===a?o:o.subarray?o.subarray(0,a):(o.length=a,o);};var i={arraySet:function(o,a,l,u,c){if(a.subarray&&o.subarray)o.set(a.subarray(l,l+u),c);else for(var h=0;h<u;h++)o[c+h]=a[l+h];},flattenChunks:function(o){var a,l,u,c,h,d;for(a=u=0,l=o.length;a<l;a++)u+=o[a].length;for(d=new Uint8Array(u),a=c=0,l=o.length;a<l;a++)h=o[a],d.set(h,c),c+=h.length;return d;}},s={arraySet:function(o,a,l,u,c){for(var h=0;h<u;h++)o[c+h]=a[l+h];},flattenChunks:function(o){return[].concat.apply([],o);}};t.setTyped=function(o){o?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,s));},t.setTyped(n);},{}],42:[function(r,e,t){"use strict";var n=r("./common"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0]);}catch{i=!1;}try{String.fromCharCode.apply(null,new Uint8Array(1));}catch{s=!1;}for(var o=new n.Buf8(256),a=0;a<256;a++)o[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function l(u,c){if(c<65537&&(u.subarray&&s||!u.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(u,c));for(var h="",d=0;d<c;d++)h+=String.fromCharCode(u[d]);return h;}o[254]=o[254]=1,t.string2buf=function(u){var c,h,d,f,p,m=u.length,g=0;for(f=0;f<m;f++)(64512&(h=u.charCodeAt(f)))==55296&&f+1<m&&(64512&(d=u.charCodeAt(f+1)))==56320&&(h=65536+(h-55296<<10)+(d-56320),f++),g+=h<128?1:h<2048?2:h<65536?3:4;for(c=new n.Buf8(g),f=p=0;p<g;f++)(64512&(h=u.charCodeAt(f)))==55296&&f+1<m&&(64512&(d=u.charCodeAt(f+1)))==56320&&(h=65536+(h-55296<<10)+(d-56320),f++),h<128?c[p++]=h:(h<2048?c[p++]=192|h>>>6:(h<65536?c[p++]=224|h>>>12:(c[p++]=240|h>>>18,c[p++]=128|h>>>12&63),c[p++]=128|h>>>6&63),c[p++]=128|63&h);return c;},t.buf2binstring=function(u){return l(u,u.length);},t.binstring2buf=function(u){for(var c=new n.Buf8(u.length),h=0,d=c.length;h<d;h++)c[h]=u.charCodeAt(h);return c;},t.buf2string=function(u,c){var h,d,f,p,m=c||u.length,g=new Array(2*m);for(h=d=0;h<m;)if((f=u[h++])<128)g[d++]=f;else if(4<(p=o[f]))g[d++]=65533,h+=p-1;else{for(f&=p===2?31:p===3?15:7;1<p&&h<m;)f=f<<6|63&u[h++],p--;1<p?g[d++]=65533:f<65536?g[d++]=f:(f-=65536,g[d++]=55296|f>>10&1023,g[d++]=56320|1023&f);}return l(g,d);},t.utf8border=function(u,c){var h;for((c=c||u.length)>u.length&&(c=u.length),h=c-1;0<=h&&(192&u[h])==128;)h--;return h<0||h===0?c:h+o[u[h]]>c?h:c;};},{"./common":41}],43:[function(r,e,t){"use strict";e.exports=function(n,i,s,o){for(var a=65535&n|0,l=n>>>16&65535|0,u=0;s!==0;){for(s-=u=2e3<s?2e3:s;l=l+(a=a+i[o++]|0)|0,--u;);a%=65521,l%=65521;}return a|l<<16|0;};},{}],44:[function(r,e,t){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};},{}],45:[function(r,e,t){"use strict";var n=function(){for(var i,s=[],o=0;o<256;o++){i=o;for(var a=0;a<8;a++)i=1&i?3988292384^i>>>1:i>>>1;s[o]=i;}return s;}();e.exports=function(i,s,o,a){var l=n,u=a+o;i^=-1;for(var c=a;c<u;c++)i=i>>>8^l[255&(i^s[c])];return-1^i;};},{}],46:[function(r,e,t){"use strict";var n,i=r("../utils/common"),s=r("./trees"),o=r("./adler32"),a=r("./crc32"),l=r("./messages"),u=0,c=4,h=0,d=-2,f=-1,p=4,m=2,g=8,b=9,y=286,v=30,E=19,P=2*y+1,M=15,I=3,C=258,L=C+I+1,S=42,T=113,B=1,$=2,Z=3,H=4;function W(R,me){return R.msg=l[me],me;}function Y(R){return(R<<1)-(4<R?9:0);}function U(R){for(var me=R.length;0<=--me;)R[me]=0;}function D(R){var me=R.state,fe=me.pending;fe>R.avail_out&&(fe=R.avail_out),fe!==0&&(i.arraySet(R.output,me.pending_buf,me.pending_out,fe,R.next_out),R.next_out+=fe,me.pending_out+=fe,R.total_out+=fe,R.avail_out-=fe,me.pending-=fe,me.pending===0&&(me.pending_out=0));}function k(R,me){s._tr_flush_block(R,0<=R.block_start?R.block_start:-1,R.strstart-R.block_start,me),R.block_start=R.strstart,D(R.strm);}function ie(R,me){R.pending_buf[R.pending++]=me;}function se(R,me){R.pending_buf[R.pending++]=me>>>8&255,R.pending_buf[R.pending++]=255&me;}function oe(R,me){var fe,K,j=R.max_chain_length,re=R.strstart,he=R.prev_length,ve=R.nice_match,Q=R.strstart>R.w_size-L?R.strstart-(R.w_size-L):0,Pe=R.window,Ue=R.w_mask,Ae=R.prev,Ze=R.strstart+C,Gt=Pe[re+he-1],xt=Pe[re+he];R.prev_length>=R.good_match&&(j>>=2),ve>R.lookahead&&(ve=R.lookahead);do if(Pe[(fe=me)+he]===xt&&Pe[fe+he-1]===Gt&&Pe[fe]===Pe[re]&&Pe[++fe]===Pe[re+1]){re+=2,fe++;do;while(Pe[++re]===Pe[++fe]&&Pe[++re]===Pe[++fe]&&Pe[++re]===Pe[++fe]&&Pe[++re]===Pe[++fe]&&Pe[++re]===Pe[++fe]&&Pe[++re]===Pe[++fe]&&Pe[++re]===Pe[++fe]&&Pe[++re]===Pe[++fe]&&re<Ze);if(K=C-(Ze-re),re=Ze-C,he<K){if(R.match_start=me,ve<=(he=K))break;Gt=Pe[re+he-1],xt=Pe[re+he];}}while((me=Ae[me&Ue])>Q&&--j!=0);return he<=R.lookahead?he:R.lookahead;}function le(R){var me,fe,K,j,re,he,ve,Q,Pe,Ue,Ae=R.w_size;do{if(j=R.window_size-R.lookahead-R.strstart,R.strstart>=Ae+(Ae-L)){for(i.arraySet(R.window,R.window,Ae,Ae,0),R.match_start-=Ae,R.strstart-=Ae,R.block_start-=Ae,me=fe=R.hash_size;K=R.head[--me],R.head[me]=Ae<=K?K-Ae:0,--fe;);for(me=fe=Ae;K=R.prev[--me],R.prev[me]=Ae<=K?K-Ae:0,--fe;);j+=Ae;}if(R.strm.avail_in===0)break;if(he=R.strm,ve=R.window,Q=R.strstart+R.lookahead,Pe=j,Ue=void 0,Ue=he.avail_in,Pe<Ue&&(Ue=Pe),fe=Ue===0?0:(he.avail_in-=Ue,i.arraySet(ve,he.input,he.next_in,Ue,Q),he.state.wrap===1?he.adler=o(he.adler,ve,Ue,Q):he.state.wrap===2&&(he.adler=a(he.adler,ve,Ue,Q)),he.next_in+=Ue,he.total_in+=Ue,Ue),R.lookahead+=fe,R.lookahead+R.insert>=I)for(re=R.strstart-R.insert,R.ins_h=R.window[re],R.ins_h=(R.ins_h<<R.hash_shift^R.window[re+1])&R.hash_mask;R.insert&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[re+I-1])&R.hash_mask,R.prev[re&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=re,re++,R.insert--,!(R.lookahead+R.insert<I)););}while(R.lookahead<L&&R.strm.avail_in!==0);}function Ee(R,me){for(var fe,K;;){if(R.lookahead<L){if(le(R),R.lookahead<L&&me===u)return B;if(R.lookahead===0)break;}if(fe=0,R.lookahead>=I&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+I-1])&R.hash_mask,fe=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),fe!==0&&R.strstart-fe<=R.w_size-L&&(R.match_length=oe(R,fe)),R.match_length>=I){if(K=s._tr_tally(R,R.strstart-R.match_start,R.match_length-I),R.lookahead-=R.match_length,R.match_length<=R.max_lazy_match&&R.lookahead>=I){for(R.match_length--;R.strstart++,R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+I-1])&R.hash_mask,fe=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart,--R.match_length!=0;);R.strstart++;}else R.strstart+=R.match_length,R.match_length=0,R.ins_h=R.window[R.strstart],R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+1])&R.hash_mask;}else K=s._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++;if(K&&(k(R,!1),R.strm.avail_out===0))return B;}return R.insert=R.strstart<I-1?R.strstart:I-1,me===c?(k(R,!0),R.strm.avail_out===0?Z:H):R.last_lit&&(k(R,!1),R.strm.avail_out===0)?B:$;}function be(R,me){for(var fe,K,j;;){if(R.lookahead<L){if(le(R),R.lookahead<L&&me===u)return B;if(R.lookahead===0)break;}if(fe=0,R.lookahead>=I&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+I-1])&R.hash_mask,fe=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),R.prev_length=R.match_length,R.prev_match=R.match_start,R.match_length=I-1,fe!==0&&R.prev_length<R.max_lazy_match&&R.strstart-fe<=R.w_size-L&&(R.match_length=oe(R,fe),R.match_length<=5&&(R.strategy===1||R.match_length===I&&4096<R.strstart-R.match_start)&&(R.match_length=I-1)),R.prev_length>=I&&R.match_length<=R.prev_length){for(j=R.strstart+R.lookahead-I,K=s._tr_tally(R,R.strstart-1-R.prev_match,R.prev_length-I),R.lookahead-=R.prev_length-1,R.prev_length-=2;++R.strstart<=j&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+I-1])&R.hash_mask,fe=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),--R.prev_length!=0;);if(R.match_available=0,R.match_length=I-1,R.strstart++,K&&(k(R,!1),R.strm.avail_out===0))return B;}else if(R.match_available){if((K=s._tr_tally(R,0,R.window[R.strstart-1]))&&k(R,!1),R.strstart++,R.lookahead--,R.strm.avail_out===0)return B;}else R.match_available=1,R.strstart++,R.lookahead--;}return R.match_available&&(K=s._tr_tally(R,0,R.window[R.strstart-1]),R.match_available=0),R.insert=R.strstart<I-1?R.strstart:I-1,me===c?(k(R,!0),R.strm.avail_out===0?Z:H):R.last_lit&&(k(R,!1),R.strm.avail_out===0)?B:$;}function xe(R,me,fe,K,j){this.good_length=R,this.max_lazy=me,this.nice_length=fe,this.max_chain=K,this.func=j;}function Oe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*P),this.dyn_dtree=new i.Buf16(2*(2*v+1)),this.bl_tree=new i.Buf16(2*(2*E+1)),U(this.dyn_ltree),U(this.dyn_dtree),U(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(M+1),this.heap=new i.Buf16(2*y+1),U(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*y+1),U(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0;}function Re(R){var me;return R&&R.state?(R.total_in=R.total_out=0,R.data_type=m,(me=R.state).pending=0,me.pending_out=0,me.wrap<0&&(me.wrap=-me.wrap),me.status=me.wrap?S:T,R.adler=me.wrap===2?0:1,me.last_flush=u,s._tr_init(me),h):W(R,d);}function Ve(R){var me=Re(R);return me===h&&function(fe){fe.window_size=2*fe.w_size,U(fe.head),fe.max_lazy_match=n[fe.level].max_lazy,fe.good_match=n[fe.level].good_length,fe.nice_match=n[fe.level].nice_length,fe.max_chain_length=n[fe.level].max_chain,fe.strstart=0,fe.block_start=0,fe.lookahead=0,fe.insert=0,fe.match_length=fe.prev_length=I-1,fe.match_available=0,fe.ins_h=0;}(R.state),me;}function lt(R,me,fe,K,j,re){if(!R)return d;var he=1;if(me===f&&(me=6),K<0?(he=0,K=-K):15<K&&(he=2,K-=16),j<1||b<j||fe!==g||K<8||15<K||me<0||9<me||re<0||p<re)return W(R,d);K===8&&(K=9);var ve=new Oe();return(R.state=ve).strm=R,ve.wrap=he,ve.gzhead=null,ve.w_bits=K,ve.w_size=1<<ve.w_bits,ve.w_mask=ve.w_size-1,ve.hash_bits=j+7,ve.hash_size=1<<ve.hash_bits,ve.hash_mask=ve.hash_size-1,ve.hash_shift=~~((ve.hash_bits+I-1)/I),ve.window=new i.Buf8(2*ve.w_size),ve.head=new i.Buf16(ve.hash_size),ve.prev=new i.Buf16(ve.w_size),ve.lit_bufsize=1<<j+6,ve.pending_buf_size=4*ve.lit_bufsize,ve.pending_buf=new i.Buf8(ve.pending_buf_size),ve.d_buf=1*ve.lit_bufsize,ve.l_buf=3*ve.lit_bufsize,ve.level=me,ve.strategy=re,ve.method=fe,Ve(R);}n=[new xe(0,0,0,0,function(R,me){var fe=65535;for(fe>R.pending_buf_size-5&&(fe=R.pending_buf_size-5);;){if(R.lookahead<=1){if(le(R),R.lookahead===0&&me===u)return B;if(R.lookahead===0)break;}R.strstart+=R.lookahead,R.lookahead=0;var K=R.block_start+fe;if((R.strstart===0||R.strstart>=K)&&(R.lookahead=R.strstart-K,R.strstart=K,k(R,!1),R.strm.avail_out===0)||R.strstart-R.block_start>=R.w_size-L&&(k(R,!1),R.strm.avail_out===0))return B;}return R.insert=0,me===c?(k(R,!0),R.strm.avail_out===0?Z:H):(R.strstart>R.block_start&&(k(R,!1),R.strm.avail_out),B);}),new xe(4,4,8,4,Ee),new xe(4,5,16,8,Ee),new xe(4,6,32,32,Ee),new xe(4,4,16,16,be),new xe(8,16,32,32,be),new xe(8,16,128,128,be),new xe(8,32,128,256,be),new xe(32,128,258,1024,be),new xe(32,258,258,4096,be)],t.deflateInit=function(R,me){return lt(R,me,g,15,8,0);},t.deflateInit2=lt,t.deflateReset=Ve,t.deflateResetKeep=Re,t.deflateSetHeader=function(R,me){return R&&R.state?R.state.wrap!==2?d:(R.state.gzhead=me,h):d;},t.deflate=function(R,me){var fe,K,j,re;if(!R||!R.state||5<me||me<0)return R?W(R,d):d;if(K=R.state,!R.output||!R.input&&R.avail_in!==0||K.status===666&&me!==c)return W(R,R.avail_out===0?-5:d);if(K.strm=R,fe=K.last_flush,K.last_flush=me,K.status===S)if(K.wrap===2)R.adler=0,ie(K,31),ie(K,139),ie(K,8),K.gzhead?(ie(K,(K.gzhead.text?1:0)+(K.gzhead.hcrc?2:0)+(K.gzhead.extra?4:0)+(K.gzhead.name?8:0)+(K.gzhead.comment?16:0)),ie(K,255&K.gzhead.time),ie(K,K.gzhead.time>>8&255),ie(K,K.gzhead.time>>16&255),ie(K,K.gzhead.time>>24&255),ie(K,K.level===9?2:2<=K.strategy||K.level<2?4:0),ie(K,255&K.gzhead.os),K.gzhead.extra&&K.gzhead.extra.length&&(ie(K,255&K.gzhead.extra.length),ie(K,K.gzhead.extra.length>>8&255)),K.gzhead.hcrc&&(R.adler=a(R.adler,K.pending_buf,K.pending,0)),K.gzindex=0,K.status=69):(ie(K,0),ie(K,0),ie(K,0),ie(K,0),ie(K,0),ie(K,K.level===9?2:2<=K.strategy||K.level<2?4:0),ie(K,3),K.status=T);else{var he=g+(K.w_bits-8<<4)<<8;he|=(2<=K.strategy||K.level<2?0:K.level<6?1:K.level===6?2:3)<<6,K.strstart!==0&&(he|=32),he+=31-he%31,K.status=T,se(K,he),K.strstart!==0&&(se(K,R.adler>>>16),se(K,65535&R.adler)),R.adler=1;}if(K.status===69)if(K.gzhead.extra){for(j=K.pending;K.gzindex<(65535&K.gzhead.extra.length)&&(K.pending!==K.pending_buf_size||(K.gzhead.hcrc&&K.pending>j&&(R.adler=a(R.adler,K.pending_buf,K.pending-j,j)),D(R),j=K.pending,K.pending!==K.pending_buf_size));)ie(K,255&K.gzhead.extra[K.gzindex]),K.gzindex++;K.gzhead.hcrc&&K.pending>j&&(R.adler=a(R.adler,K.pending_buf,K.pending-j,j)),K.gzindex===K.gzhead.extra.length&&(K.gzindex=0,K.status=73);}else K.status=73;if(K.status===73)if(K.gzhead.name){j=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>j&&(R.adler=a(R.adler,K.pending_buf,K.pending-j,j)),D(R),j=K.pending,K.pending===K.pending_buf_size)){re=1;break;}re=K.gzindex<K.gzhead.name.length?255&K.gzhead.name.charCodeAt(K.gzindex++):0,ie(K,re);}while(re!==0);K.gzhead.hcrc&&K.pending>j&&(R.adler=a(R.adler,K.pending_buf,K.pending-j,j)),re===0&&(K.gzindex=0,K.status=91);}else K.status=91;if(K.status===91)if(K.gzhead.comment){j=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>j&&(R.adler=a(R.adler,K.pending_buf,K.pending-j,j)),D(R),j=K.pending,K.pending===K.pending_buf_size)){re=1;break;}re=K.gzindex<K.gzhead.comment.length?255&K.gzhead.comment.charCodeAt(K.gzindex++):0,ie(K,re);}while(re!==0);K.gzhead.hcrc&&K.pending>j&&(R.adler=a(R.adler,K.pending_buf,K.pending-j,j)),re===0&&(K.status=103);}else K.status=103;if(K.status===103&&(K.gzhead.hcrc?(K.pending+2>K.pending_buf_size&&D(R),K.pending+2<=K.pending_buf_size&&(ie(K,255&R.adler),ie(K,R.adler>>8&255),R.adler=0,K.status=T)):K.status=T),K.pending!==0){if(D(R),R.avail_out===0)return K.last_flush=-1,h;}else if(R.avail_in===0&&Y(me)<=Y(fe)&&me!==c)return W(R,-5);if(K.status===666&&R.avail_in!==0)return W(R,-5);if(R.avail_in!==0||K.lookahead!==0||me!==u&&K.status!==666){var ve=K.strategy===2?function(Q,Pe){for(var Ue;;){if(Q.lookahead===0&&(le(Q),Q.lookahead===0)){if(Pe===u)return B;break;}if(Q.match_length=0,Ue=s._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++,Ue&&(k(Q,!1),Q.strm.avail_out===0))return B;}return Q.insert=0,Pe===c?(k(Q,!0),Q.strm.avail_out===0?Z:H):Q.last_lit&&(k(Q,!1),Q.strm.avail_out===0)?B:$;}(K,me):K.strategy===3?function(Q,Pe){for(var Ue,Ae,Ze,Gt,xt=Q.window;;){if(Q.lookahead<=C){if(le(Q),Q.lookahead<=C&&Pe===u)return B;if(Q.lookahead===0)break;}if(Q.match_length=0,Q.lookahead>=I&&0<Q.strstart&&(Ae=xt[Ze=Q.strstart-1])===xt[++Ze]&&Ae===xt[++Ze]&&Ae===xt[++Ze]){Gt=Q.strstart+C;do;while(Ae===xt[++Ze]&&Ae===xt[++Ze]&&Ae===xt[++Ze]&&Ae===xt[++Ze]&&Ae===xt[++Ze]&&Ae===xt[++Ze]&&Ae===xt[++Ze]&&Ae===xt[++Ze]&&Ze<Gt);Q.match_length=C-(Gt-Ze),Q.match_length>Q.lookahead&&(Q.match_length=Q.lookahead);}if(Q.match_length>=I?(Ue=s._tr_tally(Q,1,Q.match_length-I),Q.lookahead-=Q.match_length,Q.strstart+=Q.match_length,Q.match_length=0):(Ue=s._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++),Ue&&(k(Q,!1),Q.strm.avail_out===0))return B;}return Q.insert=0,Pe===c?(k(Q,!0),Q.strm.avail_out===0?Z:H):Q.last_lit&&(k(Q,!1),Q.strm.avail_out===0)?B:$;}(K,me):n[K.level].func(K,me);if(ve!==Z&&ve!==H||(K.status=666),ve===B||ve===Z)return R.avail_out===0&&(K.last_flush=-1),h;if(ve===$&&(me===1?s._tr_align(K):me!==5&&(s._tr_stored_block(K,0,0,!1),me===3&&(U(K.head),K.lookahead===0&&(K.strstart=0,K.block_start=0,K.insert=0))),D(R),R.avail_out===0))return K.last_flush=-1,h;}return me!==c?h:K.wrap<=0?1:(K.wrap===2?(ie(K,255&R.adler),ie(K,R.adler>>8&255),ie(K,R.adler>>16&255),ie(K,R.adler>>24&255),ie(K,255&R.total_in),ie(K,R.total_in>>8&255),ie(K,R.total_in>>16&255),ie(K,R.total_in>>24&255)):(se(K,R.adler>>>16),se(K,65535&R.adler)),D(R),0<K.wrap&&(K.wrap=-K.wrap),K.pending!==0?h:1);},t.deflateEnd=function(R){var me;return R&&R.state?(me=R.state.status)!==S&&me!==69&&me!==73&&me!==91&&me!==103&&me!==T&&me!==666?W(R,d):(R.state=null,me===T?W(R,-3):h):d;},t.deflateSetDictionary=function(R,me){var fe,K,j,re,he,ve,Q,Pe,Ue=me.length;if(!R||!R.state||(re=(fe=R.state).wrap)===2||re===1&&fe.status!==S||fe.lookahead)return d;for(re===1&&(R.adler=o(R.adler,me,Ue,0)),fe.wrap=0,Ue>=fe.w_size&&(re===0&&(U(fe.head),fe.strstart=0,fe.block_start=0,fe.insert=0),Pe=new i.Buf8(fe.w_size),i.arraySet(Pe,me,Ue-fe.w_size,fe.w_size,0),me=Pe,Ue=fe.w_size),he=R.avail_in,ve=R.next_in,Q=R.input,R.avail_in=Ue,R.next_in=0,R.input=me,le(fe);fe.lookahead>=I;){for(K=fe.strstart,j=fe.lookahead-(I-1);fe.ins_h=(fe.ins_h<<fe.hash_shift^fe.window[K+I-1])&fe.hash_mask,fe.prev[K&fe.w_mask]=fe.head[fe.ins_h],fe.head[fe.ins_h]=K,K++,--j;);fe.strstart=K,fe.lookahead=I-1,le(fe);}return fe.strstart+=fe.lookahead,fe.block_start=fe.strstart,fe.insert=fe.lookahead,fe.lookahead=0,fe.match_length=fe.prev_length=I-1,fe.match_available=0,R.next_in=ve,R.input=Q,R.avail_in=he,fe.wrap=re,h;},t.deflateInfo="pako deflate (from Nodeca project)";},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,e,t){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1;};},{}],48:[function(r,e,t){"use strict";e.exports=function(n,i){var s,o,a,l,u,c,h,d,f,p,m,g,b,y,v,E,P,M,I,C,L,S,T,B,$;s=n.state,o=n.next_in,B=n.input,a=o+(n.avail_in-5),l=n.next_out,$=n.output,u=l-(i-n.avail_out),c=l+(n.avail_out-257),h=s.dmax,d=s.wsize,f=s.whave,p=s.wnext,m=s.window,g=s.hold,b=s.bits,y=s.lencode,v=s.distcode,E=(1<<s.lenbits)-1,P=(1<<s.distbits)-1;e:do{b<15&&(g+=B[o++]<<b,b+=8,g+=B[o++]<<b,b+=8),M=y[g&E];t:for(;;){if(g>>>=I=M>>>24,b-=I,(I=M>>>16&255)===0)$[l++]=65535&M;else{if(!(16&I)){if((64&I)==0){M=y[(65535&M)+(g&(1<<I)-1)];continue t;}if(32&I){s.mode=12;break e;}n.msg="invalid literal/length code",s.mode=30;break e;}C=65535&M,(I&=15)&&(b<I&&(g+=B[o++]<<b,b+=8),C+=g&(1<<I)-1,g>>>=I,b-=I),b<15&&(g+=B[o++]<<b,b+=8,g+=B[o++]<<b,b+=8),M=v[g&P];r:for(;;){if(g>>>=I=M>>>24,b-=I,!(16&(I=M>>>16&255))){if((64&I)==0){M=v[(65535&M)+(g&(1<<I)-1)];continue r;}n.msg="invalid distance code",s.mode=30;break e;}if(L=65535&M,b<(I&=15)&&(g+=B[o++]<<b,(b+=8)<I&&(g+=B[o++]<<b,b+=8)),h<(L+=g&(1<<I)-1)){n.msg="invalid distance too far back",s.mode=30;break e;}if(g>>>=I,b-=I,(I=l-u)<L){if(f<(I=L-I)&&s.sane){n.msg="invalid distance too far back",s.mode=30;break e;}if(T=m,(S=0)===p){if(S+=d-I,I<C){for(C-=I;$[l++]=m[S++],--I;);S=l-L,T=$;}}else if(p<I){if(S+=d+p-I,(I-=p)<C){for(C-=I;$[l++]=m[S++],--I;);if(S=0,p<C){for(C-=I=p;$[l++]=m[S++],--I;);S=l-L,T=$;}}}else if(S+=p-I,I<C){for(C-=I;$[l++]=m[S++],--I;);S=l-L,T=$;}for(;2<C;)$[l++]=T[S++],$[l++]=T[S++],$[l++]=T[S++],C-=3;C&&($[l++]=T[S++],1<C&&($[l++]=T[S++]));}else{for(S=l-L;$[l++]=$[S++],$[l++]=$[S++],$[l++]=$[S++],2<(C-=3););C&&($[l++]=$[S++],1<C&&($[l++]=$[S++]));}break;}}break;}}while(o<a&&l<c);o-=C=b>>3,g&=(1<<(b-=C<<3))-1,n.next_in=o,n.next_out=l,n.avail_in=o<a?a-o+5:5-(o-a),n.avail_out=l<c?c-l+257:257-(l-c),s.hold=g,s.bits=b;};},{}],49:[function(r,e,t){"use strict";var n=r("../utils/common"),i=r("./adler32"),s=r("./crc32"),o=r("./inffast"),a=r("./inftrees"),l=1,u=2,c=0,h=-2,d=1,f=852,p=592;function m(S){return(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24);}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0;}function b(S){var T;return S&&S.state?(T=S.state,S.total_in=S.total_out=T.total=0,S.msg="",T.wrap&&(S.adler=1&T.wrap),T.mode=d,T.last=0,T.havedict=0,T.dmax=32768,T.head=null,T.hold=0,T.bits=0,T.lencode=T.lendyn=new n.Buf32(f),T.distcode=T.distdyn=new n.Buf32(p),T.sane=1,T.back=-1,c):h;}function y(S){var T;return S&&S.state?((T=S.state).wsize=0,T.whave=0,T.wnext=0,b(S)):h;}function v(S,T){var B,$;return S&&S.state?($=S.state,T<0?(B=0,T=-T):(B=1+(T>>4),T<48&&(T&=15)),T&&(T<8||15<T)?h:($.window!==null&&$.wbits!==T&&($.window=null),$.wrap=B,$.wbits=T,y(S))):h;}function E(S,T){var B,$;return S?($=new g(),(S.state=$).window=null,(B=v(S,T))!==c&&(S.state=null),B):h;}var P,M,I=!0;function C(S){if(I){var T;for(P=new n.Buf32(512),M=new n.Buf32(32),T=0;T<144;)S.lens[T++]=8;for(;T<256;)S.lens[T++]=9;for(;T<280;)S.lens[T++]=7;for(;T<288;)S.lens[T++]=8;for(a(l,S.lens,0,288,P,0,S.work,{bits:9}),T=0;T<32;)S.lens[T++]=5;a(u,S.lens,0,32,M,0,S.work,{bits:5}),I=!1;}S.lencode=P,S.lenbits=9,S.distcode=M,S.distbits=5;}function L(S,T,B,$){var Z,H=S.state;return H.window===null&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new n.Buf8(H.wsize)),$>=H.wsize?(n.arraySet(H.window,T,B-H.wsize,H.wsize,0),H.wnext=0,H.whave=H.wsize):($<(Z=H.wsize-H.wnext)&&(Z=$),n.arraySet(H.window,T,B-$,Z,H.wnext),($-=Z)?(n.arraySet(H.window,T,B-$,$,0),H.wnext=$,H.whave=H.wsize):(H.wnext+=Z,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=Z))),0;}t.inflateReset=y,t.inflateReset2=v,t.inflateResetKeep=b,t.inflateInit=function(S){return E(S,15);},t.inflateInit2=E,t.inflate=function(S,T){var B,$,Z,H,W,Y,U,D,k,ie,se,oe,le,Ee,be,xe,Oe,Re,Ve,lt,R,me,fe,K,j=0,re=new n.Buf8(4),he=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!S||!S.state||!S.output||!S.input&&S.avail_in!==0)return h;(B=S.state).mode===12&&(B.mode=13),W=S.next_out,Z=S.output,U=S.avail_out,H=S.next_in,$=S.input,Y=S.avail_in,D=B.hold,k=B.bits,ie=Y,se=U,me=c;e:for(;;)switch(B.mode){case d:if(B.wrap===0){B.mode=13;break;}for(;k<16;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}if(2&B.wrap&&D===35615){re[B.check=0]=255&D,re[1]=D>>>8&255,B.check=s(B.check,re,2,0),k=D=0,B.mode=2;break;}if(B.flags=0,B.head&&(B.head.done=!1),!(1&B.wrap)||(((255&D)<<8)+(D>>8))%31){S.msg="incorrect header check",B.mode=30;break;}if((15&D)!=8){S.msg="unknown compression method",B.mode=30;break;}if(k-=4,R=8+(15&(D>>>=4)),B.wbits===0)B.wbits=R;else if(R>B.wbits){S.msg="invalid window size",B.mode=30;break;}B.dmax=1<<R,S.adler=B.check=1,B.mode=512&D?10:12,k=D=0;break;case 2:for(;k<16;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}if(B.flags=D,(255&B.flags)!=8){S.msg="unknown compression method",B.mode=30;break;}if(57344&B.flags){S.msg="unknown header flags set",B.mode=30;break;}B.head&&(B.head.text=D>>8&1),512&B.flags&&(re[0]=255&D,re[1]=D>>>8&255,B.check=s(B.check,re,2,0)),k=D=0,B.mode=3;case 3:for(;k<32;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}B.head&&(B.head.time=D),512&B.flags&&(re[0]=255&D,re[1]=D>>>8&255,re[2]=D>>>16&255,re[3]=D>>>24&255,B.check=s(B.check,re,4,0)),k=D=0,B.mode=4;case 4:for(;k<16;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}B.head&&(B.head.xflags=255&D,B.head.os=D>>8),512&B.flags&&(re[0]=255&D,re[1]=D>>>8&255,B.check=s(B.check,re,2,0)),k=D=0,B.mode=5;case 5:if(1024&B.flags){for(;k<16;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}B.length=D,B.head&&(B.head.extra_len=D),512&B.flags&&(re[0]=255&D,re[1]=D>>>8&255,B.check=s(B.check,re,2,0)),k=D=0;}else B.head&&(B.head.extra=null);B.mode=6;case 6:if(1024&B.flags&&(Y<(oe=B.length)&&(oe=Y),oe&&(B.head&&(R=B.head.extra_len-B.length,B.head.extra||(B.head.extra=new Array(B.head.extra_len)),n.arraySet(B.head.extra,$,H,oe,R)),512&B.flags&&(B.check=s(B.check,$,oe,H)),Y-=oe,H+=oe,B.length-=oe),B.length))break e;B.length=0,B.mode=7;case 7:if(2048&B.flags){if(Y===0)break e;for(oe=0;R=$[H+oe++],B.head&&R&&B.length<65536&&(B.head.name+=String.fromCharCode(R)),R&&oe<Y;);if(512&B.flags&&(B.check=s(B.check,$,oe,H)),Y-=oe,H+=oe,R)break e;}else B.head&&(B.head.name=null);B.length=0,B.mode=8;case 8:if(4096&B.flags){if(Y===0)break e;for(oe=0;R=$[H+oe++],B.head&&R&&B.length<65536&&(B.head.comment+=String.fromCharCode(R)),R&&oe<Y;);if(512&B.flags&&(B.check=s(B.check,$,oe,H)),Y-=oe,H+=oe,R)break e;}else B.head&&(B.head.comment=null);B.mode=9;case 9:if(512&B.flags){for(;k<16;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}if(D!==(65535&B.check)){S.msg="header crc mismatch",B.mode=30;break;}k=D=0;}B.head&&(B.head.hcrc=B.flags>>9&1,B.head.done=!0),S.adler=B.check=0,B.mode=12;break;case 10:for(;k<32;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}S.adler=B.check=m(D),k=D=0,B.mode=11;case 11:if(B.havedict===0)return S.next_out=W,S.avail_out=U,S.next_in=H,S.avail_in=Y,B.hold=D,B.bits=k,2;S.adler=B.check=1,B.mode=12;case 12:if(T===5||T===6)break e;case 13:if(B.last){D>>>=7&k,k-=7&k,B.mode=27;break;}for(;k<3;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}switch(B.last=1&D,k-=1,3&(D>>>=1)){case 0:B.mode=14;break;case 1:if(C(B),B.mode=20,T!==6)break;D>>>=2,k-=2;break e;case 2:B.mode=17;break;case 3:S.msg="invalid block type",B.mode=30;}D>>>=2,k-=2;break;case 14:for(D>>>=7&k,k-=7&k;k<32;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}if((65535&D)!=(D>>>16^65535)){S.msg="invalid stored block lengths",B.mode=30;break;}if(B.length=65535&D,k=D=0,B.mode=15,T===6)break e;case 15:B.mode=16;case 16:if(oe=B.length){if(Y<oe&&(oe=Y),U<oe&&(oe=U),oe===0)break e;n.arraySet(Z,$,H,oe,W),Y-=oe,H+=oe,U-=oe,W+=oe,B.length-=oe;break;}B.mode=12;break;case 17:for(;k<14;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}if(B.nlen=257+(31&D),D>>>=5,k-=5,B.ndist=1+(31&D),D>>>=5,k-=5,B.ncode=4+(15&D),D>>>=4,k-=4,286<B.nlen||30<B.ndist){S.msg="too many length or distance symbols",B.mode=30;break;}B.have=0,B.mode=18;case 18:for(;B.have<B.ncode;){for(;k<3;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}B.lens[he[B.have++]]=7&D,D>>>=3,k-=3;}for(;B.have<19;)B.lens[he[B.have++]]=0;if(B.lencode=B.lendyn,B.lenbits=7,fe={bits:B.lenbits},me=a(0,B.lens,0,19,B.lencode,0,B.work,fe),B.lenbits=fe.bits,me){S.msg="invalid code lengths set",B.mode=30;break;}B.have=0,B.mode=19;case 19:for(;B.have<B.nlen+B.ndist;){for(;xe=(j=B.lencode[D&(1<<B.lenbits)-1])>>>16&255,Oe=65535&j,!((be=j>>>24)<=k);){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}if(Oe<16)D>>>=be,k-=be,B.lens[B.have++]=Oe;else{if(Oe===16){for(K=be+2;k<K;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}if(D>>>=be,k-=be,B.have===0){S.msg="invalid bit length repeat",B.mode=30;break;}R=B.lens[B.have-1],oe=3+(3&D),D>>>=2,k-=2;}else if(Oe===17){for(K=be+3;k<K;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}k-=be,R=0,oe=3+(7&(D>>>=be)),D>>>=3,k-=3;}else{for(K=be+7;k<K;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}k-=be,R=0,oe=11+(127&(D>>>=be)),D>>>=7,k-=7;}if(B.have+oe>B.nlen+B.ndist){S.msg="invalid bit length repeat",B.mode=30;break;}for(;oe--;)B.lens[B.have++]=R;}}if(B.mode===30)break;if(B.lens[256]===0){S.msg="invalid code -- missing end-of-block",B.mode=30;break;}if(B.lenbits=9,fe={bits:B.lenbits},me=a(l,B.lens,0,B.nlen,B.lencode,0,B.work,fe),B.lenbits=fe.bits,me){S.msg="invalid literal/lengths set",B.mode=30;break;}if(B.distbits=6,B.distcode=B.distdyn,fe={bits:B.distbits},me=a(u,B.lens,B.nlen,B.ndist,B.distcode,0,B.work,fe),B.distbits=fe.bits,me){S.msg="invalid distances set",B.mode=30;break;}if(B.mode=20,T===6)break e;case 20:B.mode=21;case 21:if(6<=Y&&258<=U){S.next_out=W,S.avail_out=U,S.next_in=H,S.avail_in=Y,B.hold=D,B.bits=k,o(S,se),W=S.next_out,Z=S.output,U=S.avail_out,H=S.next_in,$=S.input,Y=S.avail_in,D=B.hold,k=B.bits,B.mode===12&&(B.back=-1);break;}for(B.back=0;xe=(j=B.lencode[D&(1<<B.lenbits)-1])>>>16&255,Oe=65535&j,!((be=j>>>24)<=k);){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}if(xe&&(240&xe)==0){for(Re=be,Ve=xe,lt=Oe;xe=(j=B.lencode[lt+((D&(1<<Re+Ve)-1)>>Re)])>>>16&255,Oe=65535&j,!(Re+(be=j>>>24)<=k);){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}D>>>=Re,k-=Re,B.back+=Re;}if(D>>>=be,k-=be,B.back+=be,B.length=Oe,xe===0){B.mode=26;break;}if(32&xe){B.back=-1,B.mode=12;break;}if(64&xe){S.msg="invalid literal/length code",B.mode=30;break;}B.extra=15&xe,B.mode=22;case 22:if(B.extra){for(K=B.extra;k<K;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}B.length+=D&(1<<B.extra)-1,D>>>=B.extra,k-=B.extra,B.back+=B.extra;}B.was=B.length,B.mode=23;case 23:for(;xe=(j=B.distcode[D&(1<<B.distbits)-1])>>>16&255,Oe=65535&j,!((be=j>>>24)<=k);){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}if((240&xe)==0){for(Re=be,Ve=xe,lt=Oe;xe=(j=B.distcode[lt+((D&(1<<Re+Ve)-1)>>Re)])>>>16&255,Oe=65535&j,!(Re+(be=j>>>24)<=k);){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}D>>>=Re,k-=Re,B.back+=Re;}if(D>>>=be,k-=be,B.back+=be,64&xe){S.msg="invalid distance code",B.mode=30;break;}B.offset=Oe,B.extra=15&xe,B.mode=24;case 24:if(B.extra){for(K=B.extra;k<K;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}B.offset+=D&(1<<B.extra)-1,D>>>=B.extra,k-=B.extra,B.back+=B.extra;}if(B.offset>B.dmax){S.msg="invalid distance too far back",B.mode=30;break;}B.mode=25;case 25:if(U===0)break e;if(oe=se-U,B.offset>oe){if((oe=B.offset-oe)>B.whave&&B.sane){S.msg="invalid distance too far back",B.mode=30;break;}le=oe>B.wnext?(oe-=B.wnext,B.wsize-oe):B.wnext-oe,oe>B.length&&(oe=B.length),Ee=B.window;}else Ee=Z,le=W-B.offset,oe=B.length;for(U<oe&&(oe=U),U-=oe,B.length-=oe;Z[W++]=Ee[le++],--oe;);B.length===0&&(B.mode=21);break;case 26:if(U===0)break e;Z[W++]=B.length,U--,B.mode=21;break;case 27:if(B.wrap){for(;k<32;){if(Y===0)break e;Y--,D|=$[H++]<<k,k+=8;}if(se-=U,S.total_out+=se,B.total+=se,se&&(S.adler=B.check=B.flags?s(B.check,Z,se,W-se):i(B.check,Z,se,W-se)),se=U,(B.flags?D:m(D))!==B.check){S.msg="incorrect data check",B.mode=30;break;}k=D=0;}B.mode=28;case 28:if(B.wrap&&B.flags){for(;k<32;){if(Y===0)break e;Y--,D+=$[H++]<<k,k+=8;}if(D!==(4294967295&B.total)){S.msg="incorrect length check",B.mode=30;break;}k=D=0;}B.mode=29;case 29:me=1;break e;case 30:me=-3;break e;case 31:return-4;case 32:default:return h;}return S.next_out=W,S.avail_out=U,S.next_in=H,S.avail_in=Y,B.hold=D,B.bits=k,(B.wsize||se!==S.avail_out&&B.mode<30&&(B.mode<27||T!==4))&&L(S,S.output,S.next_out,se-S.avail_out)?(B.mode=31,-4):(ie-=S.avail_in,se-=S.avail_out,S.total_in+=ie,S.total_out+=se,B.total+=se,B.wrap&&se&&(S.adler=B.check=B.flags?s(B.check,Z,se,S.next_out-se):i(B.check,Z,se,S.next_out-se)),S.data_type=B.bits+(B.last?64:0)+(B.mode===12?128:0)+(B.mode===20||B.mode===15?256:0),(ie==0&&se===0||T===4)&&me===c&&(me=-5),me);},t.inflateEnd=function(S){if(!S||!S.state)return h;var T=S.state;return T.window&&(T.window=null),S.state=null,c;},t.inflateGetHeader=function(S,T){var B;return S&&S.state?(2&(B=S.state).wrap)==0?h:((B.head=T).done=!1,c):h;},t.inflateSetDictionary=function(S,T){var B,$=T.length;return S&&S.state?(B=S.state).wrap!==0&&B.mode!==11?h:B.mode===11&&i(1,T,$,0)!==B.check?-3:L(S,T,$,$)?(B.mode=31,-4):(B.havedict=1,c):h;},t.inflateInfo="pako inflate (from Nodeca project)";},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,e,t){"use strict";var n=r("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(l,u,c,h,d,f,p,m){var g,b,y,v,E,P,M,I,C,L=m.bits,S=0,T=0,B=0,$=0,Z=0,H=0,W=0,Y=0,U=0,D=0,k=null,ie=0,se=new n.Buf16(16),oe=new n.Buf16(16),le=null,Ee=0;for(S=0;S<=15;S++)se[S]=0;for(T=0;T<h;T++)se[u[c+T]]++;for(Z=L,$=15;1<=$&&se[$]===0;$--);if($<Z&&(Z=$),$===0)return d[f++]=20971520,d[f++]=20971520,m.bits=1,0;for(B=1;B<$&&se[B]===0;B++);for(Z<B&&(Z=B),S=Y=1;S<=15;S++)if(Y<<=1,(Y-=se[S])<0)return-1;if(0<Y&&(l===0||$!==1))return-1;for(oe[1]=0,S=1;S<15;S++)oe[S+1]=oe[S]+se[S];for(T=0;T<h;T++)u[c+T]!==0&&(p[oe[u[c+T]]++]=T);if(P=l===0?(k=le=p,19):l===1?(k=i,ie-=257,le=s,Ee-=257,256):(k=o,le=a,-1),S=B,E=f,W=T=D=0,y=-1,v=(U=1<<(H=Z))-1,l===1&&852<U||l===2&&592<U)return 1;for(;;){for(M=S-W,C=p[T]<P?(I=0,p[T]):p[T]>P?(I=le[Ee+p[T]],k[ie+p[T]]):(I=96,0),g=1<<S-W,B=b=1<<H;d[E+(D>>W)+(b-=g)]=M<<24|I<<16|C|0,b!==0;);for(g=1<<S-1;D&g;)g>>=1;if(g!==0?(D&=g-1,D+=g):D=0,T++,--se[S]==0){if(S===$)break;S=u[c+p[T]];}if(Z<S&&(D&v)!==y){for(W===0&&(W=Z),E+=B,Y=1<<(H=S-W);H+W<$&&!((Y-=se[H+W])<=0);)H++,Y<<=1;if(U+=1<<H,l===1&&852<U||l===2&&592<U)return 1;d[y=D&v]=Z<<24|H<<16|E-f|0;}}return D!==0&&(d[E+D]=S-W<<24|64<<16|0),m.bits=Z,0;};},{"../utils/common":41}],51:[function(r,e,t){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};},{}],52:[function(r,e,t){"use strict";var n=r("../utils/common"),i=0,s=1;function o(j){for(var re=j.length;0<=--re;)j[re]=0;}var a=0,l=29,u=256,c=u+1+l,h=30,d=19,f=2*c+1,p=15,m=16,g=7,b=256,y=16,v=17,E=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],L=new Array(2*(c+2));o(L);var S=new Array(2*h);o(S);var T=new Array(512);o(T);var B=new Array(256);o(B);var $=new Array(l);o($);var Z,H,W,Y=new Array(h);function U(j,re,he,ve,Q){this.static_tree=j,this.extra_bits=re,this.extra_base=he,this.elems=ve,this.max_length=Q,this.has_stree=j&&j.length;}function D(j,re){this.dyn_tree=j,this.max_code=0,this.stat_desc=re;}function k(j){return j<256?T[j]:T[256+(j>>>7)];}function ie(j,re){j.pending_buf[j.pending++]=255&re,j.pending_buf[j.pending++]=re>>>8&255;}function se(j,re,he){j.bi_valid>m-he?(j.bi_buf|=re<<j.bi_valid&65535,ie(j,j.bi_buf),j.bi_buf=re>>m-j.bi_valid,j.bi_valid+=he-m):(j.bi_buf|=re<<j.bi_valid&65535,j.bi_valid+=he);}function oe(j,re,he){se(j,he[2*re],he[2*re+1]);}function le(j,re){for(var he=0;he|=1&j,j>>>=1,he<<=1,0<--re;);return he>>>1;}function Ee(j,re,he){var ve,Q,Pe=new Array(p+1),Ue=0;for(ve=1;ve<=p;ve++)Pe[ve]=Ue=Ue+he[ve-1]<<1;for(Q=0;Q<=re;Q++){var Ae=j[2*Q+1];Ae!==0&&(j[2*Q]=le(Pe[Ae]++,Ae));}}function be(j){var re;for(re=0;re<c;re++)j.dyn_ltree[2*re]=0;for(re=0;re<h;re++)j.dyn_dtree[2*re]=0;for(re=0;re<d;re++)j.bl_tree[2*re]=0;j.dyn_ltree[2*b]=1,j.opt_len=j.static_len=0,j.last_lit=j.matches=0;}function xe(j){8<j.bi_valid?ie(j,j.bi_buf):0<j.bi_valid&&(j.pending_buf[j.pending++]=j.bi_buf),j.bi_buf=0,j.bi_valid=0;}function Oe(j,re,he,ve){var Q=2*re,Pe=2*he;return j[Q]<j[Pe]||j[Q]===j[Pe]&&ve[re]<=ve[he];}function Re(j,re,he){for(var ve=j.heap[he],Q=he<<1;Q<=j.heap_len&&(Q<j.heap_len&&Oe(re,j.heap[Q+1],j.heap[Q],j.depth)&&Q++,!Oe(re,ve,j.heap[Q],j.depth));)j.heap[he]=j.heap[Q],he=Q,Q<<=1;j.heap[he]=ve;}function Ve(j,re,he){var ve,Q,Pe,Ue,Ae=0;if(j.last_lit!==0)for(;ve=j.pending_buf[j.d_buf+2*Ae]<<8|j.pending_buf[j.d_buf+2*Ae+1],Q=j.pending_buf[j.l_buf+Ae],Ae++,ve===0?oe(j,Q,re):(oe(j,(Pe=B[Q])+u+1,re),(Ue=P[Pe])!==0&&se(j,Q-=$[Pe],Ue),oe(j,Pe=k(--ve),he),(Ue=M[Pe])!==0&&se(j,ve-=Y[Pe],Ue)),Ae<j.last_lit;);oe(j,b,re);}function lt(j,re){var he,ve,Q,Pe=re.dyn_tree,Ue=re.stat_desc.static_tree,Ae=re.stat_desc.has_stree,Ze=re.stat_desc.elems,Gt=-1;for(j.heap_len=0,j.heap_max=f,he=0;he<Ze;he++)Pe[2*he]!==0?(j.heap[++j.heap_len]=Gt=he,j.depth[he]=0):Pe[2*he+1]=0;for(;j.heap_len<2;)Pe[2*(Q=j.heap[++j.heap_len]=Gt<2?++Gt:0)]=1,j.depth[Q]=0,j.opt_len--,Ae&&(j.static_len-=Ue[2*Q+1]);for(re.max_code=Gt,he=j.heap_len>>1;1<=he;he--)Re(j,Pe,he);for(Q=Ze;he=j.heap[1],j.heap[1]=j.heap[j.heap_len--],Re(j,Pe,1),ve=j.heap[1],j.heap[--j.heap_max]=he,j.heap[--j.heap_max]=ve,Pe[2*Q]=Pe[2*he]+Pe[2*ve],j.depth[Q]=(j.depth[he]>=j.depth[ve]?j.depth[he]:j.depth[ve])+1,Pe[2*he+1]=Pe[2*ve+1]=Q,j.heap[1]=Q++,Re(j,Pe,1),2<=j.heap_len;);j.heap[--j.heap_max]=j.heap[1],function(xt,Gr){var ds,Sn,ps,Qt,io,Cl,hn=Gr.dyn_tree,_c=Gr.max_code,Up=Gr.stat_desc.static_tree,Dp=Gr.stat_desc.has_stree,Gp=Gr.stat_desc.extra_bits,Sc=Gr.stat_desc.extra_base,so=Gr.stat_desc.max_length,Ho=0;for(Qt=0;Qt<=p;Qt++)xt.bl_count[Qt]=0;for(hn[2*xt.heap[xt.heap_max]+1]=0,ds=xt.heap_max+1;ds<f;ds++)so<(Qt=hn[2*hn[2*(Sn=xt.heap[ds])+1]+1]+1)&&(Qt=so,Ho++),hn[2*Sn+1]=Qt,_c<Sn||(xt.bl_count[Qt]++,io=0,Sc<=Sn&&(io=Gp[Sn-Sc]),Cl=hn[2*Sn],xt.opt_len+=Cl*(Qt+io),Dp&&(xt.static_len+=Cl*(Up[2*Sn+1]+io)));if(Ho!==0){do{for(Qt=so-1;xt.bl_count[Qt]===0;)Qt--;xt.bl_count[Qt]--,xt.bl_count[Qt+1]+=2,xt.bl_count[so]--,Ho-=2;}while(0<Ho);for(Qt=so;Qt!==0;Qt--)for(Sn=xt.bl_count[Qt];Sn!==0;)_c<(ps=xt.heap[--ds])||(hn[2*ps+1]!==Qt&&(xt.opt_len+=(Qt-hn[2*ps+1])*hn[2*ps],hn[2*ps+1]=Qt),Sn--);}}(j,re),Ee(Pe,Gt,j.bl_count);}function R(j,re,he){var ve,Q,Pe=-1,Ue=re[1],Ae=0,Ze=7,Gt=4;for(Ue===0&&(Ze=138,Gt=3),re[2*(he+1)+1]=65535,ve=0;ve<=he;ve++)Q=Ue,Ue=re[2*(ve+1)+1],++Ae<Ze&&Q===Ue||(Ae<Gt?j.bl_tree[2*Q]+=Ae:Q!==0?(Q!==Pe&&j.bl_tree[2*Q]++,j.bl_tree[2*y]++):Ae<=10?j.bl_tree[2*v]++:j.bl_tree[2*E]++,Pe=Q,Gt=(Ae=0)===Ue?(Ze=138,3):Q===Ue?(Ze=6,3):(Ze=7,4));}function me(j,re,he){var ve,Q,Pe=-1,Ue=re[1],Ae=0,Ze=7,Gt=4;for(Ue===0&&(Ze=138,Gt=3),ve=0;ve<=he;ve++)if(Q=Ue,Ue=re[2*(ve+1)+1],!(++Ae<Ze&&Q===Ue)){if(Ae<Gt)for(;oe(j,Q,j.bl_tree),--Ae!=0;);else Q!==0?(Q!==Pe&&(oe(j,Q,j.bl_tree),Ae--),oe(j,y,j.bl_tree),se(j,Ae-3,2)):Ae<=10?(oe(j,v,j.bl_tree),se(j,Ae-3,3)):(oe(j,E,j.bl_tree),se(j,Ae-11,7));Pe=Q,Gt=(Ae=0)===Ue?(Ze=138,3):Q===Ue?(Ze=6,3):(Ze=7,4);}}o(Y);var fe=!1;function K(j,re,he,ve){se(j,(a<<1)+(ve?1:0),3),function(Q,Pe,Ue,Ae){xe(Q),Ae&&(ie(Q,Ue),ie(Q,~Ue)),n.arraySet(Q.pending_buf,Q.window,Pe,Ue,Q.pending),Q.pending+=Ue;}(j,re,he,!0);}t._tr_init=function(j){fe||(function(){var re,he,ve,Q,Pe,Ue=new Array(p+1);for(Q=ve=0;Q<l-1;Q++)for($[Q]=ve,re=0;re<1<<P[Q];re++)B[ve++]=Q;for(B[ve-1]=Q,Q=Pe=0;Q<16;Q++)for(Y[Q]=Pe,re=0;re<1<<M[Q];re++)T[Pe++]=Q;for(Pe>>=7;Q<h;Q++)for(Y[Q]=Pe<<7,re=0;re<1<<M[Q]-7;re++)T[256+Pe++]=Q;for(he=0;he<=p;he++)Ue[he]=0;for(re=0;re<=143;)L[2*re+1]=8,re++,Ue[8]++;for(;re<=255;)L[2*re+1]=9,re++,Ue[9]++;for(;re<=279;)L[2*re+1]=7,re++,Ue[7]++;for(;re<=287;)L[2*re+1]=8,re++,Ue[8]++;for(Ee(L,c+1,Ue),re=0;re<h;re++)S[2*re+1]=5,S[2*re]=le(re,5);Z=new U(L,P,u+1,c,p),H=new U(S,M,0,h,p),W=new U(new Array(0),I,0,d,g);}(),fe=!0),j.l_desc=new D(j.dyn_ltree,Z),j.d_desc=new D(j.dyn_dtree,H),j.bl_desc=new D(j.bl_tree,W),j.bi_buf=0,j.bi_valid=0,be(j);},t._tr_stored_block=K,t._tr_flush_block=function(j,re,he,ve){var Q,Pe,Ue=0;0<j.level?(j.strm.data_type===2&&(j.strm.data_type=function(Ae){var Ze,Gt=4093624447;for(Ze=0;Ze<=31;Ze++,Gt>>>=1)if(1&Gt&&Ae.dyn_ltree[2*Ze]!==0)return i;if(Ae.dyn_ltree[18]!==0||Ae.dyn_ltree[20]!==0||Ae.dyn_ltree[26]!==0)return s;for(Ze=32;Ze<u;Ze++)if(Ae.dyn_ltree[2*Ze]!==0)return s;return i;}(j)),lt(j,j.l_desc),lt(j,j.d_desc),Ue=function(Ae){var Ze;for(R(Ae,Ae.dyn_ltree,Ae.l_desc.max_code),R(Ae,Ae.dyn_dtree,Ae.d_desc.max_code),lt(Ae,Ae.bl_desc),Ze=d-1;3<=Ze&&Ae.bl_tree[2*C[Ze]+1]===0;Ze--);return Ae.opt_len+=3*(Ze+1)+5+5+4,Ze;}(j),Q=j.opt_len+3+7>>>3,(Pe=j.static_len+3+7>>>3)<=Q&&(Q=Pe)):Q=Pe=he+5,he+4<=Q&&re!==-1?K(j,re,he,ve):j.strategy===4||Pe===Q?(se(j,2+(ve?1:0),3),Ve(j,L,S)):(se(j,4+(ve?1:0),3),function(Ae,Ze,Gt,xt){var Gr;for(se(Ae,Ze-257,5),se(Ae,Gt-1,5),se(Ae,xt-4,4),Gr=0;Gr<xt;Gr++)se(Ae,Ae.bl_tree[2*C[Gr]+1],3);me(Ae,Ae.dyn_ltree,Ze-1),me(Ae,Ae.dyn_dtree,Gt-1);}(j,j.l_desc.max_code+1,j.d_desc.max_code+1,Ue+1),Ve(j,j.dyn_ltree,j.dyn_dtree)),be(j),ve&&xe(j);},t._tr_tally=function(j,re,he){return j.pending_buf[j.d_buf+2*j.last_lit]=re>>>8&255,j.pending_buf[j.d_buf+2*j.last_lit+1]=255&re,j.pending_buf[j.l_buf+j.last_lit]=255&he,j.last_lit++,re===0?j.dyn_ltree[2*he]++:(j.matches++,re--,j.dyn_ltree[2*(B[he]+u+1)]++,j.dyn_dtree[2*k(re)]++),j.last_lit===j.lit_bufsize-1;},t._tr_align=function(j){se(j,2,3),oe(j,b,L),function(re){re.bi_valid===16?(ie(re,re.bi_buf),re.bi_buf=0,re.bi_valid=0):8<=re.bi_valid&&(re.pending_buf[re.pending++]=255&re.bi_buf,re.bi_buf>>=8,re.bi_valid-=8);}(j);};},{"../utils/common":41}],53:[function(r,e,t){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0;};},{}],54:[function(r,e,t){(function(n){(function(i,s){"use strict";if(!i.setImmediate){var o,a,l,u,c=1,h={},d=!1,f=i.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(i);p=p&&p.setTimeout?p:i,o={}.toString.call(i.process)==="[object process]"?function(y){process.nextTick(function(){g(y);});}:function(){if(i.postMessage&&!i.importScripts){var y=!0,v=i.onmessage;return i.onmessage=function(){y=!1;},i.postMessage("","*"),i.onmessage=v,y;}}()?(u="setImmediate$"+Math.random()+"$",i.addEventListener?i.addEventListener("message",b,!1):i.attachEvent("onmessage",b),function(y){i.postMessage(u+y,"*");}):i.MessageChannel?((l=new MessageChannel()).port1.onmessage=function(y){g(y.data);},function(y){l.port2.postMessage(y);}):f&&"onreadystatechange"in f.createElement("script")?(a=f.documentElement,function(y){var v=f.createElement("script");v.onreadystatechange=function(){g(y),v.onreadystatechange=null,a.removeChild(v),v=null;},a.appendChild(v);}):function(y){setTimeout(g,0,y);},p.setImmediate=function(y){typeof y!="function"&&(y=new Function(""+y));for(var v=new Array(arguments.length-1),E=0;E<v.length;E++)v[E]=arguments[E+1];var P={callback:y,args:v};return h[c]=P,o(c),c++;},p.clearImmediate=m;}function m(y){delete h[y];}function g(y){if(d)setTimeout(g,0,y);else{var v=h[y];if(v){d=!0;try{(function(E){var P=E.callback,M=E.args;switch(M.length){case 0:P();break;case 1:P(M[0]);break;case 2:P(M[0],M[1]);break;case 3:P(M[0],M[1],M[2]);break;default:P.apply(s,M);}})(v);}finally{m(y),d=!1;}}}}function b(y){y.source===i&&typeof y.data=="string"&&y.data.indexOf(u)===0&&g(+y.data.slice(u.length));}})(typeof self>"u"?n===void 0?this:n:self);}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{});},{}]},{},[10])(10);});});var Qe=G((NRe,hP)=>{var cP=r=>r.reduce((e,t)=>Array.isArray(t)?e.concat(cP(t)):e.concat(t),[]);hP.exports=cP;});var dP=G((LRe,fP)=>{var kY=r=>Object.assign({},r);fP.exports=kY;});var mP=G((ORe,pP)=>{var UY=(r,e,t)=>(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r[9]=e[9]+t[9],r[10]=e[10]+t[10],r[11]=e[11]+t[11],r[12]=e[12]+t[12],r[13]=e[13]+t[13],r[14]=e[14]+t[14],r[15]=e[15]+t[15],r);pP.exports=UY;});var Cd=G((kRe,gP)=>{var DY=()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];gP.exports=DY;});var bP=G((URe,xP)=>{var GY=Cd(),FY=r=>{let e=GY();return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e;};xP.exports=FY;});var Pg=G((DRe,yP)=>{var qY=(r,e)=>(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r);yP.exports=qY;});var vP=G((GRe,wP)=>{var zY=(r,e)=>{let t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],m=e[13],g=e[14],b=e[15],y=t*a-n*o,v=t*l-i*o,E=t*u-s*o,P=n*l-i*a,M=n*u-s*a,I=i*u-s*l,C=c*m-h*p,L=c*g-d*p,S=c*b-f*p,T=h*g-d*m,B=h*b-f*m,$=d*b-f*g,Z=y*$-v*B+E*T+P*S-M*L+I*C;return Z?(Z=1/Z,r[0]=(a*$-l*B+u*T)*Z,r[1]=(i*B-n*$-s*T)*Z,r[2]=(m*I-g*M+b*P)*Z,r[3]=(d*M-h*I-f*P)*Z,r[4]=(l*S-o*$-u*L)*Z,r[5]=(t*$-i*S+s*L)*Z,r[6]=(g*E-p*I-b*v)*Z,r[7]=(c*I-d*E+f*v)*Z,r[8]=(o*B-a*S+u*C)*Z,r[9]=(n*S-t*B-s*C)*Z,r[10]=(p*M-m*E+b*y)*Z,r[11]=(h*E-c*M-f*y)*Z,r[12]=(a*L-o*T-l*C)*Z,r[13]=(t*T-n*L+i*C)*Z,r[14]=(m*v-p*P-g*y)*Z,r[15]=(c*P-h*v+d*y)*Z,r):null;};wP.exports=zY;});var PP=G((FRe,EP)=>{var YY=(r,e)=>r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15];EP.exports=YY;});var wt=G((XRe,_P)=>{var qRe=1e5,zRe=1e-5,YRe=1e-13,XY=Math.PI*2;_P.exports={EPS:1e-5,NEPS:1e-13,TAU:XY,spatialResolution:1e5};});var Ir=G((VRe,BP)=>{var{NEPS:VY}=wt(),SP=r=>Math.abs(r)<VY?0:r,WY=r=>SP(Math.sin(r)),$Y=r=>SP(Math.cos(r));BP.exports={sin:WY,cos:$Y};});var _g=G((WRe,IP)=>{var jY=r=>(r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r);IP.exports=jY;});var Sg=G(($Re,AP)=>{var{EPS:ZY}=wt(),{sin:HY,cos:KY}=Ir(),QY=_g(),JY=(r,e,t)=>{let[n,i,s]=t,o=n*n+i*i+s*s;if(Math.abs(o)<ZY)return QY(r);let a=1/Math.sqrt(o);n*=a,i*=a,s*=a;let l=HY(e),u=KY(e),c=1-u;return r[0]=n*n*c+u,r[1]=i*n*c+s*l,r[2]=s*n*c-i*l,r[3]=0,r[4]=n*i*c-s*l,r[5]=i*i*c+u,r[6]=s*i*c+n*l,r[7]=0,r[8]=n*s*c+i*l,r[9]=i*s*c-n*l,r[10]=s*s*c+u,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r;};AP.exports=JY;});var MP=G((jRe,CP)=>{var eX=(r,e)=>(r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r);CP.exports=eX;});var RP=G((ZRe,TP)=>{var{sin:Bg,cos:Ig}=Ir(),tX=(r,e,t,n)=>{let i=Bg(e),s=Ig(e),o=Bg(t),a=Ig(t),l=Bg(n),u=Ig(n);return r[0]=a*s,r[1]=a*i,r[2]=-o,r[3]=0,r[4]=l*o*s-u*i,r[5]=u*s+l*o*i,r[6]=l*a,r[7]=0,r[8]=l*i+u*o*s,r[9]=u*o*i-l*s,r[10]=u*a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r;};TP.exports=tX;});var LP=G((HRe,NP)=>{var rX=(r,e)=>(r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r);NP.exports=rX;});var kP=G((KRe,OP)=>{var nX=Cd(),iX=(r,e,t,n,i,s,o,a,l,u,c,h,d,f,p,m)=>{let g=nX();return g[0]=r,g[1]=e,g[2]=t,g[3]=n,g[4]=i,g[5]=s,g[6]=o,g[7]=a,g[8]=l,g[9]=u,g[10]=c,g[11]=h,g[12]=d,g[13]=f,g[14]=p,g[15]=m,g;};OP.exports=iX;});var Ag=G((QRe,UP)=>{var sX=(r,e)=>(r[0]=Math.abs(e[0]),r[1]=Math.abs(e[1]),r[2]=Math.abs(e[2]),r);UP.exports=sX;});var Cg=G((JRe,DP)=>{var oX=(r,e,t)=>(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r);DP.exports=oX;});var Gu=G((eNe,GP)=>{var aX=(r,e)=>r[0]*e[0]+r[1]*e[1]+r[2]*e[2];GP.exports=aX;});var qP=G((tNe,FP)=>{var lX=Gu(),uX=(r,e)=>{let t=r[0],n=r[1],i=r[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(t*t+n*n+i*i),u=Math.sqrt(s*s+o*o+a*a),c=l*u,h=c&&lX(r,e)/c;return Math.acos(Math.min(Math.max(h,-1),1));};FP.exports=uX;});var Fu=G((rNe,zP)=>{var cX=()=>[0,0,0];zP.exports=cX;});var XP=G((nNe,YP)=>{var hX=Fu(),fX=r=>{let e=hX();return e[0]=r[0],e[1]=r[1],e[2]=r[2],e;};YP.exports=fX;});var Mg=G((iNe,VP)=>{var dX=(r,e)=>(r[0]=e[0],r[1]=e[1],r[2]=e[2],r);VP.exports=dX;});var tl=G((sNe,WP)=>{var pX=(r,e,t)=>{let n=e[0],i=e[1],s=e[2],o=t[0],a=t[1],l=t[2];return r[0]=i*l-s*a,r[1]=s*o-n*l,r[2]=n*a-i*o,r;};WP.exports=pX;});var Tg=G((oNe,$P)=>{var mX=(r,e)=>{let t=e[0]-r[0],n=e[1]-r[1],i=e[2]-r[2];return Math.sqrt(t*t+n*n+i*i);};$P.exports=mX;});var ZP=G((aNe,jP)=>{var gX=(r,e,t)=>(r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r);jP.exports=gX;});var KP=G((lNe,HP)=>{var xX=(r,e)=>r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2];HP.exports=xX;});var JP=G((uNe,QP)=>{var bX=(r,e)=>(r[0]=e,r[1]=e,r[2]=e,r);QP.exports=bX;});var t_=G((cNe,e_)=>{var yX=Fu(),wX=(r,e,t)=>{let n=yX();return n[0]=r,n[1]=e,n[2]=t,n;};e_.exports=wX;});var n_=G((hNe,r_)=>{var vX=(r,e,t=0)=>(r[0]=e[0],r[1]=e[1],r[2]=t,r);r_.exports=vX;});var Rg=G((fNe,i_)=>{var EX=r=>{let e=r[0],t=r[1],n=r[2];return Math.sqrt(e*e+t*t+n*n);};i_.exports=EX;});var o_=G((dNe,s_)=>{var PX=(r,e,t,n)=>(r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r[2]=e[2]+n*(t[2]-e[2]),r);s_.exports=PX;});var Ng=G((pNe,a_)=>{var _X=(r,e,t)=>(r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r);a_.exports=_X;});var Lg=G((mNe,l_)=>{var SX=(r,e,t)=>(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r);l_.exports=SX;});var c_=G((gNe,u_)=>{var BX=(r,e,t)=>(r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r);u_.exports=BX;});var f_=G((xNe,h_)=>{var IX=(r,e)=>(r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r);h_.exports=IX;});var Md=G((bNe,d_)=>{var AX=(r,e)=>{let t=e[0],n=e[1],i=e[2],s=t*t+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=t*s,r[1]=n*s,r[2]=i*s,r;};d_.exports=AX;});var m_=G((yNe,p_)=>{var CX=Ag(),MX=Fu(),TX=tl(),RX=(r,e)=>{let t=CX(MX(),e),n=0+(t[0]<t[1]&&t[0]<t[2]),i=0+(t[1]<=t[0]&&t[1]<t[2]),s=0+(t[2]<=t[0]&&t[2]<=t[1]);return TX(r,e,[n,i,s]);};p_.exports=RX;});var x_=G((wNe,g_)=>{var NX=(r,e,t,n)=>{let i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r;};g_.exports=NX;});var y_=G((vNe,b_)=>{var LX=(r,e,t,n)=>{let i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r;};b_.exports=LX;});var v_=G((ENe,w_)=>{var OX=(r,e,t,n)=>{let i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=e[2],r;};w_.exports=OX;});var Og=G((PNe,E_)=>{var kX=(r,e,t)=>(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r);E_.exports=kX;});var __=G((_Ne,P_)=>{var UX=(r,e,t)=>(r[0]=Math.round(e[0]/t)*t+0,r[1]=Math.round(e[1]/t)*t+0,r[2]=Math.round(e[2]/t)*t+0,r);P_.exports=UX;});var kg=G((SNe,S_)=>{var DX=(r,e)=>{let t=e[0]-r[0],n=e[1]-r[1],i=e[2]-r[2];return t*t+n*n+i*i;};S_.exports=DX;});var Ug=G((BNe,B_)=>{var GX=r=>{let e=r[0],t=r[1],n=r[2];return e*e+t*t+n*n;};B_.exports=GX;});var qu=G((INe,I_)=>{var FX=(r,e,t)=>(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r);I_.exports=FX;});var C_=G((ANe,A_)=>{var qX=r=>`[${r[0].toFixed(7)}, ${r[1].toFixed(7)}, ${r[2].toFixed(7)}]`;A_.exports=qX;});var T_=G((CNe,M_)=>{var zX=(r,e,t)=>{let n=e[0],i=e[1],s=e[2],o=t[3]*n+t[7]*i+t[11]*s+t[15];return o=o||1,r[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/o,r[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/o,r[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/o,r;};M_.exports=zX;});var Ye=G((MNe,R_)=>{R_.exports={abs:Ag(),add:Cg(),angle:qP(),clone:XP(),copy:Mg(),create:Fu(),cross:tl(),distance:Tg(),divide:ZP(),dot:Gu(),equals:KP(),fromScalar:JP(),fromValues:t_(),fromVec2:n_(),length:Rg(),lerp:o_(),max:Ng(),min:Lg(),multiply:c_(),negate:f_(),normalize:Md(),orthogonal:m_(),rotateX:x_(),rotateY:y_(),rotateZ:v_(),scale:Og(),snap:__(),squaredDistance:kg(),squaredLength:Ug(),subtract:qu(),toString:C_(),transform:T_()};});var L_=G((TNe,N_)=>{var $s=Ye(),YX=Sg(),XX=(r,e,t)=>{let n=$s.normalize($s.create(),e),i=$s.normalize($s.create(),t),s=$s.cross($s.create(),i,n),o=$s.dot(i,n);if(o===-1)return YX(r,Math.PI,$s.orthogonal(s,n));let a=1/(1+o);return r[0]=s[0]*s[0]*a+o,r[1]=s[1]*s[0]*a-s[2],r[2]=s[2]*s[0]*a+s[1],r[3]=0,r[4]=s[0]*s[1]*a+s[2],r[5]=s[1]*s[1]*a+o,r[6]=s[2]*s[1]*a-s[0],r[7]=0,r[8]=s[0]*s[2]*a-s[1],r[9]=s[1]*s[2]*a+s[0],r[10]=s[2]*s[2]*a+o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r;};N_.exports=XX;});var k_=G((RNe,O_)=>{var{sin:VX,cos:WX}=Ir(),$X=(r,e)=>{let t=VX(e),n=WX(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=t,r[7]=0,r[8]=0,r[9]=-t,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r;};O_.exports=$X;});var D_=G((NNe,U_)=>{var{sin:jX,cos:ZX}=Ir(),HX=(r,e)=>{let t=jX(e),n=ZX(e);return r[0]=n,r[1]=0,r[2]=-t,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=t,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r;};U_.exports=HX;});var F_=G((LNe,G_)=>{var{sin:KX,cos:QX}=Ir(),JX=(r,e)=>{let t=KX(e),n=QX(e);return r[0]=n,r[1]=t,r[2]=0,r[3]=0,r[4]=-t,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r;};G_.exports=JX;});var z_=G((ONe,q_)=>{var eV=r=>r[0]===1&&r[1]===0&&r[2]===0&&r[3]===0&&r[4]===0&&r[5]===1&&r[6]===0&&r[7]===0&&r[8]===0&&r[9]===0&&r[10]===1&&r[11]===0&&r[12]===0&&r[13]===0&&r[14]===0&&r[15]===1;q_.exports=eV;});var X_=G((kNe,Y_)=>{var tV=r=>ls(r[1])&&ls(r[2])&&ls(r[3])&&ls(r[4])&&ls(r[6])&&ls(r[7])&&ls(r[8])&&ls(r[9])&&ls(r[11])&&r[15]===1,ls=r=>Math.abs(r)<Number.EPSILON;Y_.exports=tV;});var W_=G((UNe,V_)=>{var rV=r=>{let e=r[4]*r[9]-r[8]*r[5],t=r[8]*r[1]-r[0]*r[9],n=r[0]*r[5]-r[4]*r[1];return e*r[2]+t*r[6]+n*r[10]<0;};V_.exports=rV;});var j_=G((DNe,$_)=>{var nV=(r,e)=>{let[t,n,i,s]=e;return r[0]=1-2*t*t,r[1]=-2*n*t,r[2]=-2*i*t,r[3]=0,r[4]=-2*t*n,r[5]=1-2*n*n,r[6]=-2*i*n,r[7]=0,r[8]=-2*t*i,r[9]=-2*n*i,r[10]=1-2*i*i,r[11]=0,r[12]=2*t*s,r[13]=2*n*s,r[14]=2*i*s,r[15]=1,r;};$_.exports=nV;});var H_=G((GNe,Z_)=>{var iV=(r,e,t)=>{let n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],m=e[12],g=e[13],b=e[14],y=e[15],v=t[0],E=t[1],P=t[2],M=t[3];return r[0]=v*n+E*a+P*h+M*m,r[1]=v*i+E*l+P*d+M*g,r[2]=v*s+E*u+P*f+M*b,r[3]=v*o+E*c+P*p+M*y,v=t[4],E=t[5],P=t[6],M=t[7],r[4]=v*n+E*a+P*h+M*m,r[5]=v*i+E*l+P*d+M*g,r[6]=v*s+E*u+P*f+M*b,r[7]=v*o+E*c+P*p+M*y,v=t[8],E=t[9],P=t[10],M=t[11],r[8]=v*n+E*a+P*h+M*m,r[9]=v*i+E*l+P*d+M*g,r[10]=v*s+E*u+P*f+M*b,r[11]=v*o+E*c+P*p+M*y,v=t[12],E=t[13],P=t[14],M=t[15],r[12]=v*n+E*a+P*h+M*m,r[13]=v*i+E*l+P*d+M*g,r[14]=v*s+E*u+P*f+M*b,r[15]=v*o+E*c+P*p+M*y,r;};Z_.exports=iV;});var Q_=G((FNe,K_)=>{var{EPS:sV}=wt(),{sin:oV,cos:aV}=Ir(),lV=Pg(),uV=(r,e,t,n)=>{let[i,s,o]=n,a=i*i+s*s+o*o;if(Math.abs(a)<sV)return lV(r,e);let l=1/Math.sqrt(a);i*=l,s*=l,o*=l;let u=oV(t),c=aV(t),h=1-c,d=e[0],f=e[1],p=e[2],m=e[3],g=e[4],b=e[5],y=e[6],v=e[7],E=e[8],P=e[9],M=e[10],I=e[11],C=i*i*h+c,L=s*i*h+o*u,S=o*i*h-s*u,T=i*s*h-o*u,B=s*s*h+c,$=o*s*h+i*u,Z=i*o*h+s*u,H=s*o*h-i*u,W=o*o*h+c;return r[0]=d*C+g*L+E*S,r[1]=f*C+b*L+P*S,r[2]=p*C+y*L+M*S,r[3]=m*C+v*L+I*S,r[4]=d*T+g*B+E*$,r[5]=f*T+b*B+P*$,r[6]=p*T+y*B+M*$,r[7]=m*T+v*B+I*$,r[8]=d*Z+g*H+E*W,r[9]=f*Z+b*H+P*W,r[10]=p*Z+y*H+M*W,r[11]=m*Z+v*H+I*W,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r;};K_.exports=uV;});var eS=G((qNe,J_)=>{var{sin:cV,cos:hV}=Ir(),fV=(r,e,t)=>{let n=cV(t),i=hV(t),s=e[4],o=e[5],a=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*i+u*n,r[5]=o*i+c*n,r[6]=a*i+h*n,r[7]=l*i+d*n,r[8]=u*i-s*n,r[9]=c*i-o*n,r[10]=h*i-a*n,r[11]=d*i-l*n,r;};J_.exports=fV;});var rS=G((zNe,tS)=>{var{sin:dV,cos:pV}=Ir(),mV=(r,e,t)=>{let n=dV(t),i=pV(t),s=e[0],o=e[1],a=e[2],l=e[3],u=e[8],c=e[9],h=e[10],d=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i-u*n,r[1]=o*i-c*n,r[2]=a*i-h*n,r[3]=l*i-d*n,r[8]=s*n+u*i,r[9]=o*n+c*i,r[10]=a*n+h*i,r[11]=l*n+d*i,r;};tS.exports=mV;});var iS=G((YNe,nS)=>{var{sin:gV,cos:xV}=Ir(),bV=(r,e,t)=>{let n=gV(t),i=xV(t),s=e[0],o=e[1],a=e[2],l=e[3],u=e[4],c=e[5],h=e[6],d=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i+u*n,r[1]=o*i+c*n,r[2]=a*i+h*n,r[3]=l*i+d*n,r[4]=u*i-s*n,r[5]=c*i-o*n,r[6]=h*i-a*n,r[7]=d*i-l*n,r;};nS.exports=bV;});var oS=G((XNe,sS)=>{var yV=(r,e,t)=>{let n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r;};sS.exports=yV;});var lS=G((VNe,aS)=>{var wV=(r,e,t)=>(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r[9]=e[9]-t[9],r[10]=e[10]-t[10],r[11]=e[11]-t[11],r[12]=e[12]-t[12],r[13]=e[13]-t[13],r[14]=e[14]-t[14],r[15]=e[15]-t[15],r);aS.exports=wV;});var cS=G((WNe,uS)=>{var vV=r=>r.map(e=>e.toFixed(7)).toString();uS.exports=vV;});var fS=G(($Ne,hS)=>{var EV=(r,e,t)=>{let n=t[0],i=t[1],s=t[2],o,a,l,u,c,h,d,f,p,m,g,b;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*s+e[12],r[13]=e[1]*n+e[5]*i+e[9]*s+e[13],r[14]=e[2]*n+e[6]*i+e[10]*s+e[14],r[15]=e[3]*n+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],u=e[3],c=e[4],h=e[5],d=e[6],f=e[7],p=e[8],m=e[9],g=e[10],b=e[11],r[0]=o,r[1]=a,r[2]=l,r[3]=u,r[4]=c,r[5]=h,r[6]=d,r[7]=f,r[8]=p,r[9]=m,r[10]=g,r[11]=b,r[12]=o*n+c*i+p*s+e[12],r[13]=a*n+h*i+m*s+e[13],r[14]=l*n+d*i+g*s+e[14],r[15]=u*n+f*i+b*s+e[15]),r;};hS.exports=EV;});var Dt=G((jNe,dS)=>{dS.exports={add:mP(),clone:bP(),copy:Pg(),create:Cd(),invert:vP(),equals:PP(),fromRotation:Sg(),fromScaling:MP(),fromTaitBryanRotation:RP(),fromTranslation:LP(),fromValues:kP(),fromVectorRotation:L_(),fromXRotation:k_(),fromYRotation:D_(),fromZRotation:F_(),identity:_g(),isIdentity:z_(),isOnlyTransformScale:X_(),isMirroring:W_(),mirrorByPlane:j_(),multiply:H_(),rotate:Q_(),rotateX:eS(),rotateY:rS(),rotateZ:iS(),scale:oS(),subtract:lS(),toString:cS(),translate:fS()};});var zu=G((ZNe,pS)=>{var PV=Dt(),_V=r=>(r===void 0&&(r=[]),{sides:r,transforms:PV.create()});pS.exports=_V;});var gS=G((HNe,mS)=>{var SV=(r,e)=>(r[0]=Math.abs(e[0]),r[1]=Math.abs(e[1]),r);mS.exports=SV;});var bS=G((KNe,xS)=>{var BV=(r,e,t)=>(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r);xS.exports=BV;});var Td=G((QNe,yS)=>{var IV=r=>Math.atan2(r[1],r[0]);yS.exports=IV;});var vS=G((JNe,wS)=>{wS.exports=Td();});var PS=G((eLe,ES)=>{var AV=Td(),CV=r=>AV(r)*57.29577951308232;ES.exports=CV;});var Yu=G((tLe,_S)=>{var MV=()=>[0,0];_S.exports=MV;});var BS=G((rLe,SS)=>{var TV=Yu(),RV=r=>{let e=TV();return e[0]=r[0],e[1]=r[1],e;};SS.exports=RV;});var AS=G((nLe,IS)=>{var NV=(r,e)=>(r[0]=e[0],r[1]=e[1],r);IS.exports=NV;});var MS=G((iLe,CS)=>{var LV=(r,e,t)=>(r[0]=0,r[1]=0,r[2]=e[0]*t[1]-e[1]*t[0],r);CS.exports=LV;});var RS=G((sLe,TS)=>{var OV=(r,e)=>{let t=e[0]-r[0],n=e[1]-r[1];return Math.sqrt(t*t+n*n);};TS.exports=OV;});var LS=G((oLe,NS)=>{var kV=(r,e,t)=>(r[0]=e[0]/t[0],r[1]=e[1]/t[1],r);NS.exports=kV;});var kS=G((aLe,OS)=>{var UV=(r,e)=>r[0]*e[0]+r[1]*e[1];OS.exports=UV;});var DS=G((lLe,US)=>{var DV=(r,e)=>r[0]===e[0]&&r[1]===e[1];US.exports=DV;});var Dg=G((uLe,GS)=>{var{sin:GV,cos:FV}=Ir(),qV=(r,e)=>(r[0]=FV(e),r[1]=GV(e),r);GS.exports=qV;});var qS=G((cLe,FS)=>{var zV=Dg(),YV=(r,e)=>zV(r,e*.017453292519943295);FS.exports=YV;});var YS=G((hLe,zS)=>{var XV=(r,e)=>(r[0]=e,r[1]=e,r);zS.exports=XV;});var VS=G((fLe,XS)=>{var VV=Yu(),WV=(r,e)=>{let t=VV();return t[0]=r,t[1]=e,t;};XS.exports=WV;});var $S=G((dLe,WS)=>{var $V=r=>Math.sqrt(r[0]*r[0]+r[1]*r[1]);WS.exports=$V;});var ZS=G((pLe,jS)=>{var jV=(r,e,t,n)=>{let i=e[0],s=e[1];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r;};jS.exports=jV;});var KS=G((mLe,HS)=>{var ZV=(r,e,t)=>(r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r);HS.exports=ZV;});var JS=G((gLe,QS)=>{var HV=(r,e,t)=>(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r);QS.exports=HV;});var t3=G((xLe,e3)=>{var KV=(r,e,t)=>(r[0]=e[0]*t[0],r[1]=e[1]*t[1],r);e3.exports=KV;});var n3=G((bLe,r3)=>{var QV=(r,e)=>(r[0]=-e[0],r[1]=-e[1],r);r3.exports=QV;});var Gg=G((yLe,i3)=>{var JV=(r,e,t,n)=>{let i=e[0]-t[0],s=e[1]-t[1],o=Math.cos(n),a=Math.sin(n);return r[0]=i*o-s*a+t[0],r[1]=i*a+s*o+t[1],r;};i3.exports=JV;});var o3=G((wLe,s3)=>{var{TAU:e9}=wt(),t9=Yu(),r9=Gg(),n9=(r,e)=>r9(r,e,t9(),e9/4);s3.exports=n9;});var l3=G((vLe,a3)=>{var i9=(r,e)=>{let t=e[0],n=e[1],i=t*t+n*n;return i>0&&(i=1/Math.sqrt(i)),r[0]=t*i,r[1]=n*i,r;};a3.exports=i9;});var c3=G((ELe,u3)=>{var s9=(r,e,t)=>(r[0]=e[0]*t,r[1]=e[1]*t,r);u3.exports=s9;});var f3=G((PLe,h3)=>{var o9=(r,e,t)=>(r[0]=Math.round(e[0]/t)*t+0,r[1]=Math.round(e[1]/t)*t+0,r);h3.exports=o9;});var p3=G((_Le,d3)=>{var a9=(r,e)=>{let t=e[0]-r[0],n=e[1]-r[1];return t*t+n*n;};d3.exports=a9;});var g3=G((SLe,m3)=>{var l9=r=>{let e=r[0],t=r[1];return e*e+t*t;};m3.exports=l9;});var b3=G((BLe,x3)=>{var u9=(r,e,t)=>(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r);x3.exports=u9;});var w3=G((ILe,y3)=>{var c9=r=>`[${r[0].toFixed(7)}, ${r[1].toFixed(7)}]`;y3.exports=c9;});var E3=G((ALe,v3)=>{var h9=(r,e,t)=>{let n=e[0],i=e[1];return r[0]=t[0]*n+t[4]*i+t[12],r[1]=t[1]*n+t[5]*i+t[13],r;};v3.exports=h9;});var it=G((CLe,P3)=>{P3.exports={abs:gS(),add:bS(),angle:vS(),angleDegrees:PS(),angleRadians:Td(),clone:BS(),copy:AS(),create:Yu(),cross:MS(),distance:RS(),divide:LS(),dot:kS(),equals:DS(),fromAngleDegrees:qS(),fromAngleRadians:Dg(),fromScalar:YS(),fromValues:VS(),length:$S(),lerp:ZS(),max:KS(),min:JS(),multiply:t3(),negate:n3(),normal:o3(),normalize:l3(),rotate:Gg(),scale:c3(),snap:f3(),squaredDistance:p3(),squaredLength:g3(),subtract:b3(),toString:w3(),transform:E3()};});var S3=G((MLe,_3)=>{var Fg=it(),f9=zu(),d9=r=>{if(!Array.isArray(r))throw new Error("the given points must be an array");let e=r.length;if(e<3)throw new Error("the given points must define a closed geometry with three or more points");Fg.equals(r[0],r[e-1])&&--e;let t=[],n=r[e-1];for(let i=0;i<e;i++){let s=r[i];t.push([Fg.clone(n),Fg.clone(s)]),n=s;}return f9(t);};_3.exports=d9;});var A3=G((TLe,I3)=>{var p9=Dt(),B3=it(),m9=zu(),g9=r=>{if(r[0]!==0)throw new Error("invalid compact binary data");let e=m9();e.transforms=p9.clone(r.slice(1,17));for(let t=21;t<r.length;t+=4){let n=B3.fromValues(r[t+0],r[t+1]),i=B3.fromValues(r[t+2],r[t+3]);e.sides.push([n,i]);}return r[17]>=0&&(e.color=[r[17],r[18],r[19],r[20]]),e;};I3.exports=g9;});var qg=G((RLe,C3)=>{var x9=r=>!!(r&&typeof r=="object"&&"sides"in r&&"transforms"in r&&Array.isArray(r.sides)&&"length"in r.transforms);C3.exports=x9;});var R3=G((NLe,T3)=>{var M3=Dt(),Rd=it(),b9=r=>(M3.isIdentity(r.transforms)||(r.sides=r.sides.map(e=>{let t=Rd.transform(Rd.create(),e[0],r.transforms),n=Rd.transform(Rd.create(),e[1],r.transforms);return[t,n];}),r.transforms=M3.create()),r);T3.exports=b9;});var rl=G((LLe,N3)=>{var y9=R3(),w9=r=>y9(r).sides;N3.exports=w9;});var O3=G((OLe,L3)=>{var v9=zu(),E9=rl(),P9=r=>{let t=E9(r).map(n=>[n[1],n[0]]);return t.reverse(),v9(t);};L3.exports=P9;});var zg=G((kLe,k3)=>{var Xu=it(),_9=rl(),S9=r=>{let e=new Map(),t=n=>{let i=n.toString();return e.has(i)?e.get(i):(e.set(i,n),n);};return r.map(n=>n.map(t));},B9=r=>{let e=new Map();return S9(r).forEach(n=>{e.has(n[0])?e.get(n[0]).push(n):e.set(n[0],[n]);}),e;},I9=r=>{let e=B9(_9(r)),t=[];for(;;){let n;for(let[o,a]of e){if(n=a.shift(),!n){e.delete(o);continue;}break;}if(n===void 0)break;let i=[],s=n[0];for(;;){i.push(n[0]);let o=n[1];if(o===s)break;let a=e.get(o);if(!a)throw new Error(`geometry is not closed at vertex ${o}`);let l=A9(n,a);a.length===0&&e.delete(o),n=l;}i.length>0&&i.push(i.shift()),t.push(i);}return e.clear(),t;},A9=(r,e)=>{if(e.length===1)return e.pop();let t=Xu.create(),n=Xu.angleDegrees(Xu.subtract(t,r[1],r[0])),i,s;e.forEach((a,l)=>{let c=Xu.angleDegrees(Xu.subtract(t,a[1],a[0]))-n;c<-180&&(c+=360),c>=180&&(c-=360),(s===void 0||c>i)&&(s=l,i=c);});let o=e[s];return e.splice(s,1),o;};k3.exports=I9;});var D3=G((ULe,U3)=>{var C9=rl(),M9=r=>{let t=C9(r).map(n=>n[0]);return t.length>0&&t.push(t.shift()),t;};U3.exports=M9;});var q3=G((DLe,F3)=>{var G3=it(),T9=rl(),R9=r=>{let e=T9(r),t="geom2 ("+e.length+` sides):
[
`;return e.forEach(n=>{t+="  ["+G3.toString(n[0])+", "+G3.toString(n[1])+`]
`;}),t+=`]
`,t;};F3.exports=R9;});var Y3=G((GLe,z3)=>{var N9=r=>{let e=r.sides,t=r.transforms,n=[-1,-1,-1,-1];r.color&&(n=r.color);let i=new Float32Array(1+16+4+e.length*4);i[0]=0,i[1]=t[0],i[2]=t[1],i[3]=t[2],i[4]=t[3],i[5]=t[4],i[6]=t[5],i[7]=t[6],i[8]=t[7],i[9]=t[8],i[10]=t[9],i[11]=t[10],i[12]=t[11],i[13]=t[12],i[14]=t[13],i[15]=t[14],i[16]=t[15],i[17]=n[0],i[18]=n[1],i[19]=n[2],i[20]=n[3];for(let s=0;s<e.length;s++){let o=s*4+21,a=e[s][0],l=e[s][1];i[o+0]=a[0],i[o+1]=a[1],i[o+2]=l[0],i[o+3]=l[1];}return i;};z3.exports=N9;});var W3=G((FLe,V3)=>{var X3=Dt(),L9=(r,e)=>{let t=X3.multiply(X3.create(),r,e.transforms);return Object.assign({},e,{transforms:t});};V3.exports=L9;});var j3=G((qLe,$3)=>{var O9=it(),k9=qg(),U9=zg(),D9=r=>{if(!k9(r))throw new Error("invalid geom2 structure");if(U9(r),r.sides.forEach(e=>{if(O9.equals(e[0],e[1]))throw new Error(`geom2 self-edge ${e[0]}`);}),!r.transforms.every(Number.isFinite))throw new Error(`geom2 invalid transforms ${r.transforms}`);};$3.exports=D9;});var tt=G((zLe,Z3)=>{Z3.exports={clone:dP(),create:zu(),fromPoints:S3(),fromCompactBinary:A3(),isA:qg(),reverse:O3(),toOutlines:zg(),toPoints:D3(),toSides:rl(),toString:q3(),toCompactBinary:Y3(),transform:W3(),validate:j3()};});var K3=G((YLe,H3)=>{var G9=r=>Object.assign({},r);H3.exports=G9;});var Vu=G((XLe,Q3)=>{var F9=Dt(),q9=r=>(r===void 0&&(r=[]),{polygons:r,transforms:F9.create()});Q3.exports=q9;});var Go=G((VLe,J3)=>{var z9=r=>((r===void 0||r.length<3)&&(r=[]),{vertices:r});J3.exports=z9;});var tB=G((WLe,eB)=>{var Y9=Go(),X9=Ye(),V9=(...r)=>{let e,t;return r.length===1?(e=Y9(),t=r[0]):(e=r[0],t=r[1]),e.vertices=t.vertices.map(n=>X9.clone(n)),e;};eB.exports=V9;});var nB=G(($Le,rB)=>{var W9=Ye(),$9=Go(),j9=r=>{let e=r.map(t=>W9.clone(t));return $9(e);};rB.exports=j9;});var sB=G((jLe,iB)=>{var Z9=Go(),H9=(r,e)=>{let t=Z9(r);return t.plane=e,t;};iB.exports=H9;});var Wu=G((ZLe,oB)=>{var K9=()=>[0,0,0,0];oB.exports=K9;});var Yg=G((HLe,aB)=>{var Q9=Wu(),J9=r=>{let e=Q9();return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e;};aB.exports=J9;});var Xg=G((KLe,lB)=>{var e7=(r,e)=>(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r);lB.exports=e7;});var Vg=G((QLe,uB)=>{var t7=(r,e)=>r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3];uB.exports=t7;});var Wg=G((JLe,cB)=>{var r7=(r,e)=>(r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r);cB.exports=r7;});var fB=G((e4e,hB)=>{var $g=Ye(),n7=(r,e,t)=>{let n=$g.normalize($g.create(),e),i=$g.dot(t,n);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=i,r;};hB.exports=n7;});var jg=G((t4e,dB)=>{var i7=Wu(),s7=(r,e,t,n)=>{let i=i7();return i[0]=r,i[1]=e,i[2]=t,i[3]=n,i;};dB.exports=s7;});var Zg=G((r4e,pB)=>{var Ii=Ye(),o7=(r,...e)=>{let t=e.length,n=Ii.create(),i=Ii.create(),s=o=>{let a=e[o],l=e[(o+1)%t],u=e[(o+2)%t];return Ii.subtract(n,l,a),Ii.subtract(i,u,a),Ii.cross(n,n,i),Ii.normalize(n,n),n;};return r[0]=0,r[1]=0,r[2]=0,t===3?Ii.copy(r,s(0)):(e.forEach((o,a)=>{Ii.add(r,r,s(a));}),Ii.normalize(r,r)),r[3]=Ii.dot(r,e[0]),r;};pB.exports=o7;});var gB=G((n4e,mB)=>{var{EPS:Hg}=wt(),Vr=Ye(),a7=(r,e,t,n)=>{let i=Vr.subtract(Vr.create(),t,e),s=Vr.subtract(Vr.create(),n,e);Vr.length(i)<Hg&&(i=Vr.orthogonal(i,s)),Vr.length(s)<Hg&&(s=Vr.orthogonal(s,i));let o=Vr.cross(Vr.create(),i,s);Vr.length(o)<Hg&&(s=Vr.orthogonal(s,i),o=Vr.cross(o,i,s)),o=Vr.normalize(o,o);let a=Vr.dot(o,e);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=a,r;};mB.exports=a7;});var bB=G((i4e,xB)=>{var l7=Ye(),u7=(r,e)=>{let t=e[0]*r[0]+e[1]*r[1]+e[2]*r[2]-r[3],n=e[0]-t*r[0],i=e[1]-t*r[1],s=e[2]-t*r[2];return l7.fromValues(n,i,s);};xB.exports=u7;});var Kg=G((s4e,yB)=>{var c7=Ye(),h7=(r,e)=>c7.dot(r,e)-r[3];yB.exports=h7;});var Qg=G((o4e,wB)=>{var f7=r=>`(${r[0].toFixed(9)}, ${r[1].toFixed(9)}, ${r[2].toFixed(9)}, ${r[3].toFixed(9)})`;wB.exports=f7;});var EB=G((a4e,vB)=>{var d7=Dt(),Wr=Ye(),p7=Zg(),m7=Wg(),g7=(r,e,t)=>{let n=d7.isMirroring(t),i=Wr.orthogonal(Wr.create(),e),s=Wr.cross(i,e,i),o=Wr.cross(Wr.create(),e,s),a=Wr.fromScalar(Wr.create(),e[3]);Wr.multiply(a,a,e);let l=Wr.add(Wr.create(),a,s),u=Wr.add(Wr.create(),a,o);return a=Wr.transform(a,a,t),l=Wr.transform(l,l,t),u=Wr.transform(u,u,t),p7(r,a,l,u),n&&m7(r,r),r;};vB.exports=g7;});var oi=G((l4e,PB)=>{PB.exports={clone:Yg(),copy:Xg(),create:Wu(),equals:Vg(),flip:Wg(),fromNormalAndPoint:fB(),fromValues:jg(),fromPoints:Zg(),fromPointsRandom:gB(),projectionOfPoint:bB(),signedDistanceToPoint:Kg(),toString:Qg(),transform:EB()};});var BB=G((u4e,SB)=>{var _B=oi(),x7=Go(),b7=r=>{let e=r.vertices.slice().reverse(),t=x7(e);return r.plane&&(t.plane=_B.flip(_B.create(),r.plane)),t;};SB.exports=b7;});var Jg=G((c4e,IB)=>{var y7=r=>!!(r&&typeof r=="object"&&"vertices"in r&&Array.isArray(r.vertices));IB.exports=y7;});var ex=G((h4e,CB)=>{var AB=oi(),Fo=Ye(),w7=r=>v7(r.vertices),v7=r=>{let e=r.length;if(e>2){let t=AB.fromPoints(AB.create(),...r),n=r[e-2],i=r[e-1];for(let s=0;s<e;s++){let o=r[s];if(!E7(n,i,o,t))return!1;n=i,i=o;}}return!0;},E7=(r,e,t,n)=>{let i=Fo.cross(Fo.create(),Fo.subtract(Fo.create(),e,r),Fo.subtract(Fo.create(),t,e));return Fo.dot(i,n)>=0;};CB.exports=w7;});var Nd=G((f4e,TB)=>{var MB=oi(),P7=r=>(r.plane||(r.plane=MB.fromPoints(MB.create(),...r.vertices)),r.plane);TB.exports=P7;});var tx=G((d4e,RB)=>{var _7=Nd(),S7=r=>{let e=r.vertices.length;if(e<3)return 0;let t=r.vertices,n=_7(r),i=Math.abs(n[0]),s=Math.abs(n[1]),o=Math.abs(n[2]);if(i+s+o===0)return 0;let a=3;i>s&&i>o?a=1:s>o&&(a=2);let l=0,u=0,c=1,h=2;switch(a){case 1:for(c=1;c<e;c++)u=c-1,h=(c+1)%e,l+=t[c][1]*(t[h][2]-t[u][2]);l+=t[0][1]*(t[1][2]-t[e-1][2]),l/=2*n[0];break;case 2:for(c=1;c<e;c++)u=c-1,h=(c+1)%e,l+=t[c][2]*(t[h][0]-t[u][0]);l+=t[0][2]*(t[1][0]-t[e-1][0]),l/=2*n[1];break;case 3:default:for(c=1;c<e;c++)u=c-1,h=(c+1)%e,l+=t[c][0]*(t[h][1]-t[u][1]);l+=t[0][0]*(t[1][1]-t[e-1][1]),l/=2*n[2];break;}return l;};RB.exports=S7;});var LB=G((p4e,NB)=>{var $u=Ye(),B7=r=>{let e=r.vertices,t=e.length,n=t===0?$u.create():$u.clone(e[0]),i=$u.clone(n);for(let s=1;s<t;s++)$u.min(n,n,e[s]),$u.max(i,i,e[s]);return[n,i];};NB.exports=B7;});var kB=G((m4e,OB)=>{var I7=(r,e)=>r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3];OB.exports=I7;});var DB=G((g4e,UB)=>{var A7=(r,e)=>(r[0]=e,r[1]=e,r[2]=e,r[3]=e,r);UB.exports=A7;});var FB=G((x4e,GB)=>{var C7=(r,e,t)=>{let[n,i,s,o]=e;return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*o,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*o,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*o,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*o,r;};GB.exports=C7;});var rx=G((b4e,qB)=>{qB.exports={clone:Yg(),copy:Xg(),create:Wu(),dot:kB(),equals:Vg(),fromScalar:DB(),fromValues:jg(),toString:Qg(),transform:FB()};});var XB=G((w4e,YB)=>{var y4e=Ye(),M7=rx(),zB=new WeakMap(),T7=r=>{let e=zB.get(r);if(e)return e;let t=r.vertices,n=M7.create();if(t.length===0)return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n;let i=t[0],s=i,o=i,a=i,l=i,u=i;t.forEach(f=>{i[0]>f[0]&&(i=f),s[1]>f[1]&&(s=f),o[2]>f[2]&&(o=f),a[0]<f[0]&&(a=f),l[1]<f[1]&&(l=f),u[2]<f[2]&&(u=f);}),n[0]=(i[0]+a[0])*.5,n[1]=(s[1]+l[1])*.5,n[2]=(o[2]+u[2])*.5;let c=n[0]-a[0],h=n[1]-l[1],d=n[2]-u[2];return n[3]=Math.sqrt(c*c+h*h+d*d),zB.set(r,n),n;};YB.exports=T7;});var WB=G((v4e,VB)=>{var nx=Ye(),R7=r=>{let e=0,t=r.vertices,n=nx.create();for(let i=0;i<t.length-2;i++)nx.cross(n,t[i+1],t[i+2]),e+=nx.dot(t[0],n);return e/=6,e;};VB.exports=R7;});var jB=G((E4e,$B)=>{var N7=r=>r.vertices;$B.exports=N7;});var HB=G((P4e,ZB)=>{var L7=Ye(),O7=r=>{let e="poly3: vertices: [";return r.vertices.forEach(t=>{e+=`${L7.toString(t)}, `;}),e+="]",e;};ZB.exports=O7;});var JB=G((_4e,QB)=>{var k7=Dt(),KB=Ye(),U7=Go(),D7=(r,e)=>{let t=e.vertices.map(n=>KB.transform(KB.create(),n,r));return k7.isMirroring(r)&&t.reverse(),U7(t);};QB.exports=D7;});var tI=G((S4e,eI)=>{var G7=Kg(),{NEPS:F7}=wt(),q7=Ye(),z7=Jg(),Y7=ex(),X7=tx(),V7=Nd(),W7=r=>{if(!z7(r))throw new Error("invalid poly3 structure");if(r.vertices.length<3)throw new Error(`poly3 not enough vertices ${r.vertices.length}`);if(X7(r)<=0)throw new Error("poly3 area must be greater than zero");for(let e=0;e<r.vertices.length;e++)if(q7.equals(r.vertices[e],r.vertices[(e+1)%r.vertices.length]))throw new Error(`poly3 duplicate vertex ${r.vertices[e]}`);if(!Y7(r))throw new Error("poly3 must be convex");if(r.vertices.forEach(e=>{if(!e.every(Number.isFinite))throw new Error(`poly3 invalid vertex ${e}`);}),r.vertices.length>3){let e=V7(r);r.vertices.forEach(t=>{let n=Math.abs(G7(e,t));if(n>F7)throw new Error(`poly3 must be coplanar: vertex ${t} distance ${n}`);});}};eI.exports=W7;});var gt=G((B4e,rI)=>{rI.exports={clone:tB(),create:Go(),fromPoints:nB(),fromPointsAndPlane:sB(),invert:BB(),isA:Jg(),isConvex:ex(),measureArea:tx(),measureBoundingBox:LB(),measureBoundingSphere:XB(),measureSignedVolume:WB(),plane:Nd(),toPoints:jB(),toString:HB(),transform:JB(),validate:tI()};});var iI=G((I4e,nI)=>{var $7=gt(),j7=Vu(),Z7=r=>{if(!Array.isArray(r))throw new Error("the given points must be an array");let e=r.map((n,i)=>$7.create(n));return j7(e);};nI.exports=Z7;});var oI=G((A4e,sI)=>{var H7=Ye(),K7=Dt(),Q7=gt(),J7=Vu(),eW=r=>{if(r[0]!==1)throw new Error("invalid compact binary data");let e=J7();e.transforms=K7.clone(r.slice(1,17));let t=r[21],n=22,i=r.length-t*3;for(;i<r.length;){let s=r[n];n++;let o=[];for(let a=0;a<s;a++)o.push(H7.fromValues(r[i],r[i+1],r[i+2])),i+=3;e.polygons.push(Q7.create(o));}return r[17]>=0&&(e.color=[r[17],r[18],r[19],r[20]]),e;};sI.exports=eW;});var uI=G((C4e,lI)=>{var aI=Dt(),tW=gt(),rW=r=>(aI.isIdentity(r.transforms)||(r.polygons=r.polygons.map(e=>tW.transform(r.transforms,e)),r.transforms=aI.create()),r);lI.exports=rW;});var ju=G((M4e,cI)=>{var nW=uI(),iW=r=>nW(r).polygons;cI.exports=iW;});var fI=G((T4e,hI)=>{var sW=gt(),oW=Vu(),aW=ju(),lW=r=>{let t=aW(r).map(n=>sW.invert(n));return oW(t);};hI.exports=lW;});var ix=G((R4e,dI)=>{var uW=r=>!!(r&&typeof r=="object"&&"polygons"in r&&"transforms"in r&&Array.isArray(r.polygons)&&"length"in r.transforms);dI.exports=uW;});var mI=G((N4e,pI)=>{var cW=gt(),hW=ju(),fW=r=>hW(r).map(n=>cW.toPoints(n));pI.exports=fW;});var xI=G((L4e,gI)=>{var dW=gt(),pW=ju(),mW=r=>{let e=pW(r),t="geom3 ("+e.length+` polygons):
`;return e.forEach(n=>{t+="  "+dW.toString(n)+`
`;}),t;};gI.exports=mW;});var yI=G((O4e,bI)=>{var gW=gt(),xW=r=>{let e=r.polygons,t=r.transforms,n=e.length,i=e.reduce((u,c)=>u+c.vertices.length,0),s=[-1,-1,-1,-1];r.color&&(s=r.color);let o=new Float32Array(1+16+4+1+n+i*3);o[0]=1,o[1]=t[0],o[2]=t[1],o[3]=t[2],o[4]=t[3],o[5]=t[4],o[6]=t[5],o[7]=t[6],o[8]=t[7],o[9]=t[8],o[10]=t[9],o[11]=t[10],o[12]=t[11],o[13]=t[12],o[14]=t[13],o[15]=t[14],o[16]=t[15],o[17]=s[0],o[18]=s[1],o[19]=s[2],o[20]=s[3],o[21]=i;let a=22,l=a+n;return e.forEach(u=>{let c=gW.toPoints(u);o[a]=c.length,a++;for(let h=0;h<c.length;h++){let d=c[h];o[l+0]=d[0],o[l+1]=d[1],o[l+2]=d[2],l+=3;}}),o;};bI.exports=xW;});var EI=G((k4e,vI)=>{var wI=Dt(),bW=(r,e)=>{let t=wI.multiply(wI.create(),r,e.transforms);return Object.assign({},e,{transforms:t});};vI.exports=bW;});var _I=G((U4e,PI)=>{var yW=gt(),wW=ix(),vW=r=>{if(!wW(r))throw new Error("invalid geom3 structure");if(r.polygons.forEach(yW.validate),EW(r),!r.transforms.every(Number.isFinite))throw new Error(`geom3 invalid transforms ${r.transforms}`);},EW=r=>{let e=new Map();r.polygons.forEach(({vertices:n})=>{n.forEach((i,s)=>{let o=`${i}`,a=`${n[(s+1)%n.length]}`,l=`${o}/${a}`,u=e.has(l)?e.get(l):0;e.set(l,u+1);});});let t=[];if(e.forEach((n,i)=>{let s=i.split("/").reverse().join("/"),o=e.get(s);n!==o&&t.push(i.replace("/"," -> "));}),t.length>0)throw new Error(`non-manifold edges ${t.length}
${t.join(`
`)}`);};PI.exports=vW;});var rt=G((D4e,SI)=>{SI.exports={clone:K3(),create:Vu(),fromPoints:iI(),fromCompactBinary:oI(),invert:fI(),isA:ix(),toPoints:mI(),toPolygons:ju(),toString:xI(),toCompactBinary:yI(),transform:EI(),validate:_I()};});var Ld=G((G4e,BI)=>{var PW=r=>Object.assign({},r);BI.exports=PW;});var sx=G((F4e,AI)=>{var{EPS:II}=wt(),_W=it(),SW=Ld(),BW=r=>{if(r.isClosed)return r;let e=SW(r);if(e.isClosed=!0,e.points.length>1){let t=e.points,n=t[0],i=t[t.length-1];for(;_W.distance(n,i)<II*II&&(t.pop(),t.length!==1);)i=t[t.length-1];}return e;};AI.exports=BW;});var Zu=G((q4e,CI)=>{var IW=Dt(),AW=r=>(r===void 0&&(r=[]),{points:r,isClosed:!1,transforms:IW.create()});CI.exports=AW;});var Od=G((z4e,RI)=>{var{EPS:MI}=wt(),TI=it(),CW=sx(),MW=Zu(),TW=(r,e)=>{let t={closed:!1},{closed:n}=Object.assign({},t,r),i=MW();if(i.points=e.map(s=>TI.clone(s)),i.points.length>1){let s=i.points[0],o=i.points[i.points.length-1];TI.distance(s,o)<MI*MI&&(n=!0);}return n===!0&&(i=CW(i)),i;};RI.exports=TW;});var kI=G((Y4e,OI)=>{var NI=Dt(),LI=it(),RW=r=>(NI.isIdentity(r.transforms)||(r.points=r.points.map(e=>LI.transform(LI.create(),e,r.transforms)),r.transforms=NI.create()),r);OI.exports=RW;});var qo=G((X4e,UI)=>{var NW=kI(),LW=r=>NW(r).points;UI.exports=LW;});var GI=G((V4e,DI)=>{var{TAU:kd}=wt(),pr=it(),OW=Od(),kW=qo(),UW=(r,e)=>{let t={radius:[0,0],xaxisrotation:0,clockwise:!1,large:!1,segments:16},{endpoint:n,radius:i,xaxisrotation:s,clockwise:o,large:a,segments:l}=Object.assign({},t,r);if(!Array.isArray(n))throw new Error("endpoint must be an array of X and Y values");if(n.length<2)throw new Error("endpoint must contain X and Y values");if(n=pr.clone(n),!Array.isArray(i))throw new Error("radius must be an array of X and Y values");if(i.length<2)throw new Error("radius must contain X and Y values");if(l<4)throw new Error("segments must be four or more");let u=1e5;if(e.isClosed)throw new Error("the given path cannot be closed");let c=kW(e);if(c.length<1)throw new Error("the given path must contain one or more points (as the starting point for the arc)");let h=i[0],d=i[1],f=c[c.length-1];h=Math.round(h*u)/u,d=Math.round(d*u)/u,n=pr.fromValues(Math.round(n[0]*u)/u,Math.round(n[1]*u)/u);let p=!o,m=[];if(h===0||d===0)m.push(n);else{h=Math.abs(h),d=Math.abs(d);let b=s,y=Math.cos(b),v=Math.sin(b),E=pr.subtract(pr.create(),f,n);pr.scale(E,E,.5);let P=Math.round((y*E[0]+v*E[1])*u)/u,M=Math.round((-v*E[0]+y*E[1])*u)/u,I=pr.fromValues(P,M),C=I[0]*I[0]/(h*h)+I[1]*I[1]/(d*d);if(C>1){let U=Math.sqrt(C);h*=U,d*=U,h=Math.round(h*u)/u,d=Math.round(d*u)/u;}let L=Math.sqrt((h*h*d*d-h*h*I[1]*I[1]-d*d*I[0]*I[0])/(h*h*I[1]*I[1]+d*d*I[0]*I[0]));p===a&&(L=-L);let S=pr.fromValues(h*I[1]/d,-d*I[0]/h);pr.scale(S,S,L);let T=pr.fromValues(y*S[0]-v*S[1],v*S[0]+y*S[1]);T=pr.add(T,T,pr.scale(pr.create(),pr.add(pr.create(),f,n),.5));let B=pr.fromValues((I[0]-S[0])/h,(I[1]-S[1])/d),$=pr.fromValues((-I[0]-S[0])/h,(-I[1]-S[1])/d),Z=pr.angleRadians(B),W=pr.angleRadians($)-Z;W=W%kd,!p&&W>0?W-=kd:p&&W<0&&(W+=kd);let Y=Math.ceil(Math.abs(W)/kd*l)+1;Y<1&&(Y=1);for(let U=1;U<Y;U++){let D=Z+U/Y*W,k=Math.cos(D),ie=Math.sin(D),se=pr.fromValues(y*h*k-v*d*ie,v*h*k+y*d*ie);pr.add(se,se,T),m.push(se);}Y&&m.push(r.endpoint);}return m=c.concat(m),OW({},m);};DI.exports=UW;});var ox=G((W4e,FI)=>{var DW=Od(),GW=qo(),{equals:FW}=it(),qW=(...r)=>{let e=!1,t=[];return r.forEach((n,i)=>{let s=GW(n).slice();if(t.length>0&&s.length>0&&FW(s[0],t[t.length-1])&&s.shift(),s.length>0&&e)throw new Error(`Cannot concatenate to a closed path; check the ${i}th path`);e=n.isClosed,t=t.concat(s);}),DW({closed:e},t);};FI.exports=qW;});var ax=G(($4e,qI)=>{var zW=ox(),YW=Zu(),XW=(r,e)=>zW(e,YW(r));qI.exports=XW;});var YI=G((j4e,zI)=>{var{TAU:VW}=wt(),En=it(),WW=it(),$W=ax(),jW=qo(),ZW=(r,e)=>{let t={segments:16},{controlPoints:n,segments:i}=Object.assign({},t,r);if(!Array.isArray(n))throw new Error("controlPoints must be an array of one or more points");if(n.length<1)throw new Error("controlPoints must be an array of one or more points");if(i<4)throw new Error("segments must be four or more");if(e.isClosed)throw new Error("the given geometry cannot be closed");let s=jW(e);if(s.length<1)throw new Error("the given path must contain one or more points (as the starting point for the bezier curve)");if(n=n.slice(),n[0]===null){if(n.length<2)throw new Error("a null control point must be passed with one more control points");let M=s[s.length-2];if("lastBezierControlPoint"in e&&(M=e.lastBezierControlPoint),!Array.isArray(M))throw new Error("the given path must contain TWO or more points if given a null control point");let I=En.scale(En.create(),s[s.length-1],2);En.subtract(I,I,M),n[0]=I;}n.unshift(s[s.length-1]);let a=n.length-1,l=[],u=1;for(let M=0;M<=a;++M)M>0&&(u*=M),l.push(u);let c=[];for(let M=0;M<=a;++M){let I=l[a]/(l[M]*l[a-M]);c.push(I);}let h=En.create(),d=En.create(),f=WW.create(),p=M=>{let I=1,C=Math.pow(1-M,a),L=M!==1?1/(1-M):1,S=En.create();for(let T=0;T<=a;++T){T===a&&(C=1);let B=c[T]*I*C,$=En.scale(h,n[T],B);En.add(S,S,$),I*=M,C*=L;}return S;},m=[],g=[],b=a+1;for(let M=0;M<b;++M){let I=M/(b-1),C=p(I);m.push(C),g.push(I);}let y=1,v=VW/i,E=Math.sin(v);for(;y<m.length-1;){let M=En.subtract(h,m[y],m[y-1]);En.normalize(M,M);let I=En.subtract(d,m[y+1],m[y]);En.normalize(I,I);let C=En.cross(f,M,I);if(Math.abs(C[2])>E){let L=g[y-1],S=g[y+1],T=L+(S-L)*1/3,B=L+(S-L)*2/3,$=p(T),Z=p(B);m.splice(y,1,$,Z),g.splice(y,1,T,B),y--,y<1&&(y=1);}else++y;}m.shift();let P=$W(m,e);return P.lastBezierControlPoint=n[n.length-2],P;};zI.exports=ZW;});var WI=G((Z4e,VI)=>{var HW=it(),XI=qo(),KW=(r,e)=>{if(r.isClosed!==e.isClosed||r.points.length!==e.points.length)return!1;let t=XI(r),n=XI(e),i=t.length,s=0;do{let o=!1;for(let a=0;a<i;a++)if(!HW.equals(t[a],n[(a+s)%i])){o=!0;break;}if(o===!1)return!0;if(!r.isClosed)return!1;}while(++s<i);return!1;};VI.exports=KW;});var jI=G((H4e,$I)=>{var QW=Dt(),JW=it(),e$=Zu(),t$=r=>{if(r[0]!==2)throw new Error("invalid compact binary data");let e=e$();e.transforms=QW.clone(r.slice(1,17)),e.isClosed=!!r[17];for(let t=22;t<r.length;t+=2){let n=JW.fromValues(r[t],r[t+1]);e.points.push(n);}return r[18]>=0&&(e.color=[r[18],r[19],r[20],r[21]]),e;};$I.exports=t$;});var lx=G((K4e,ZI)=>{var r$=r=>!!(r&&typeof r=="object"&&"points"in r&&"transforms"in r&&"isClosed"in r&&Array.isArray(r.points)&&"length"in r.transforms);ZI.exports=r$;});var KI=G((Q4e,HI)=>{var n$=Ld(),i$=r=>{let e=n$(r);return e.points=r.points.slice().reverse(),e;};HI.exports=i$;});var JI=G((J4e,QI)=>{var s$=it(),o$=qo(),a$=r=>{let e=o$(r),t="path ("+e.length+" points, "+r.isClosed+`):
[
`;return e.forEach(n=>{t+="  "+s$.toString(n)+`,
`;}),t+=`]
`,t;};QI.exports=a$;});var tA=G((eOe,eA)=>{var l$=r=>{let e=r.points,t=r.transforms,n=[-1,-1,-1,-1];r.color&&(n=r.color);let i=new Float32Array(1+16+1+4+e.length*2);i[0]=2,i[1]=t[0],i[2]=t[1],i[3]=t[2],i[4]=t[3],i[5]=t[4],i[6]=t[5],i[7]=t[6],i[8]=t[7],i[9]=t[8],i[10]=t[9],i[11]=t[10],i[12]=t[11],i[13]=t[12],i[14]=t[13],i[15]=t[14],i[16]=t[15],i[17]=r.isClosed?1:0,i[18]=n[0],i[19]=n[1],i[20]=n[2],i[21]=n[3];for(let s=0;s<e.length;s++){let o=s*2+22,a=e[s];i[o]=a[0],i[o+1]=a[1];}return i;};eA.exports=l$;});var iA=G((tOe,nA)=>{var rA=Dt(),u$=(r,e)=>{let t=rA.multiply(rA.create(),r,e.transforms);return Object.assign({},e,{transforms:t});};nA.exports=u$;});var oA=G((rOe,sA)=>{var c$=it(),h$=lx(),f$=r=>{if(!h$(r))throw new Error("invalid path2 structure");if(r.points.length>1){for(let e=0;e<r.points.length;e++)if(c$.equals(r.points[e],r.points[(e+1)%r.points.length]))throw new Error(`path2 duplicate points ${r.points[e]}`);}if(r.points.forEach(e=>{if(!e.every(Number.isFinite))throw new Error(`path2 invalid point ${e}`);}),!r.transforms.every(Number.isFinite))throw new Error(`path2 invalid transforms ${r.transforms}`);};sA.exports=f$;});var kt=G((nOe,aA)=>{aA.exports={appendArc:GI(),appendBezier:YI(),appendPoints:ax(),clone:Ld(),close:sx(),concat:ox(),create:Zu(),equals:WI(),fromPoints:Od(),fromCompactBinary:jI(),isA:lx(),reverse:KI(),toPoints:qo(),toString:JI(),toCompactBinary:tA(),transform:iA(),validate:oA()};});var dA=G((iOe,fA)=>{var d$=Qe(),lA=tt(),uA=rt(),cA=kt(),hA=gt(),p$=(r,e)=>{let t=lA.clone(e);return t.color=r,t;},m$=(r,e)=>{let t=uA.clone(e);return t.color=r,t;},g$=(r,e)=>{let t=cA.clone(e);return t.color=r,t;},x$=(r,e)=>{let t=hA.clone(e);return t.color=r,t;},b$=(r,...e)=>{if(!Array.isArray(r))throw new Error("color must be an array");if(r.length<3)throw new Error("color must contain R, G and B values");if(r.length===3&&(r=[r[0],r[1],r[2],1]),e=d$(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>lA.isA(n)?p$(r,n):uA.isA(n)?m$(r,n):cA.isA(n)?g$(r,n):hA.isA(n)?x$(r,n):(n.color=r,n));return t.length===1?t[0]:t;};fA.exports=b$;});var ux=G((sOe,pA)=>{var y$={black:[0,0,0],silver:[.7529411764705882,.7529411764705882,.7529411764705882],gray:[.5019607843137255,.5019607843137255,.5019607843137255],white:[1,1,1],maroon:[.5019607843137255,0,0],red:[1,0,0],purple:[.5019607843137255,0,.5019607843137255],fuchsia:[1,0,1],green:[0,.5019607843137255,0],lime:[0,1,0],olive:[.5019607843137255,.5019607843137255,0],yellow:[1,1,0],navy:[0,0,.5019607843137255],blue:[0,0,1],teal:[0,.5019607843137255,.5019607843137255],aqua:[0,1,1],aliceblue:[.9411764705882353,.9725490196078431,1],antiquewhite:[.9803921568627451,.9215686274509803,.8431372549019608],aquamarine:[.4980392156862745,1,.8313725490196079],azure:[.9411764705882353,1,1],beige:[.9607843137254902,.9607843137254902,.8627450980392157],bisque:[1,.8941176470588236,.7686274509803922],blanchedalmond:[1,.9215686274509803,.803921568627451],blueviolet:[.5411764705882353,.16862745098039217,.8862745098039215],brown:[.6470588235294118,.16470588235294117,.16470588235294117],burlywood:[.8705882352941177,.7215686274509804,.5294117647058824],cadetblue:[.37254901960784315,.6196078431372549,.6274509803921569],chartreuse:[.4980392156862745,1,0],chocolate:[.8235294117647058,.4117647058823529,.11764705882352941],coral:[1,.4980392156862745,.3137254901960784],cornflowerblue:[.39215686274509803,.5843137254901961,.9294117647058824],cornsilk:[1,.9725490196078431,.8627450980392157],crimson:[.8627450980392157,.0784313725490196,.23529411764705882],cyan:[0,1,1],darkblue:[0,0,.5450980392156862],darkcyan:[0,.5450980392156862,.5450980392156862],darkgoldenrod:[.7215686274509804,.5254901960784314,.043137254901960784],darkgray:[.6627450980392157,.6627450980392157,.6627450980392157],darkgreen:[0,.39215686274509803,0],darkgrey:[.6627450980392157,.6627450980392157,.6627450980392157],darkkhaki:[.7411764705882353,.7176470588235294,.4196078431372549],darkmagenta:[.5450980392156862,0,.5450980392156862],darkolivegreen:[.3333333333333333,.4196078431372549,.1843137254901961],darkorange:[1,.5490196078431373,0],darkorchid:[.6,.19607843137254902,.8],darkred:[.5450980392156862,0,0],darksalmon:[.9137254901960784,.5882352941176471,.47843137254901963],darkseagreen:[.5607843137254902,.7372549019607844,.5607843137254902],darkslateblue:[.2823529411764706,.23921568627450981,.5450980392156862],darkslategray:[.1843137254901961,.30980392156862746,.30980392156862746],darkslategrey:[.1843137254901961,.30980392156862746,.30980392156862746],darkturquoise:[0,.807843137254902,.8196078431372549],darkviolet:[.5803921568627451,0,.8274509803921568],deeppink:[1,.0784313725490196,.5764705882352941],deepskyblue:[0,.7490196078431373,1],dimgray:[.4117647058823529,.4117647058823529,.4117647058823529],dimgrey:[.4117647058823529,.4117647058823529,.4117647058823529],dodgerblue:[.11764705882352941,.5647058823529412,1],firebrick:[.6980392156862745,.13333333333333333,.13333333333333333],floralwhite:[1,.9803921568627451,.9411764705882353],forestgreen:[.13333333333333333,.5450980392156862,.13333333333333333],gainsboro:[.8627450980392157,.8627450980392157,.8627450980392157],ghostwhite:[.9725490196078431,.9725490196078431,1],gold:[1,.8431372549019608,0],goldenrod:[.8549019607843137,.6470588235294118,.12549019607843137],greenyellow:[.6784313725490196,1,.1843137254901961],grey:[.5019607843137255,.5019607843137255,.5019607843137255],honeydew:[.9411764705882353,1,.9411764705882353],hotpink:[1,.4117647058823529,.7058823529411765],indianred:[.803921568627451,.3607843137254902,.3607843137254902],indigo:[.29411764705882354,0,.5098039215686274],ivory:[1,1,.9411764705882353],khaki:[.9411764705882353,.9019607843137255,.5490196078431373],lavender:[.9019607843137255,.9019607843137255,.9803921568627451],lavenderblush:[1,.9411764705882353,.9607843137254902],lawngreen:[.48627450980392156,.9882352941176471,0],lemonchiffon:[1,.9803921568627451,.803921568627451],lightblue:[.6784313725490196,.8470588235294118,.9019607843137255],lightcoral:[.9411764705882353,.5019607843137255,.5019607843137255],lightcyan:[.8784313725490196,1,1],lightgoldenrodyellow:[.9803921568627451,.9803921568627451,.8235294117647058],lightgray:[.8274509803921568,.8274509803921568,.8274509803921568],lightgreen:[.5647058823529412,.9333333333333333,.5647058823529412],lightgrey:[.8274509803921568,.8274509803921568,.8274509803921568],lightpink:[1,.7137254901960784,.7568627450980392],lightsalmon:[1,.6274509803921569,.47843137254901963],lightseagreen:[.12549019607843137,.6980392156862745,.6666666666666666],lightskyblue:[.5294117647058824,.807843137254902,.9803921568627451],lightslategray:[.4666666666666667,.5333333333333333,.6],lightslategrey:[.4666666666666667,.5333333333333333,.6],lightsteelblue:[.6901960784313725,.7686274509803922,.8705882352941177],lightyellow:[1,1,.8784313725490196],limegreen:[.19607843137254902,.803921568627451,.19607843137254902],linen:[.9803921568627451,.9411764705882353,.9019607843137255],magenta:[1,0,1],mediumaquamarine:[.4,.803921568627451,.6666666666666666],mediumblue:[0,0,.803921568627451],mediumorchid:[.7294117647058823,.3333333333333333,.8274509803921568],mediumpurple:[.5764705882352941,.4392156862745098,.8588235294117647],mediumseagreen:[.23529411764705882,.7019607843137254,.44313725490196076],mediumslateblue:[.4823529411764706,.40784313725490196,.9333333333333333],mediumspringgreen:[0,.9803921568627451,.6039215686274509],mediumturquoise:[.2823529411764706,.8196078431372549,.8],mediumvioletred:[.7803921568627451,.08235294117647059,.5215686274509804],midnightblue:[.09803921568627451,.09803921568627451,.4392156862745098],mintcream:[.9607843137254902,1,.9803921568627451],mistyrose:[1,.8941176470588236,.8823529411764706],moccasin:[1,.8941176470588236,.7098039215686275],navajowhite:[1,.8705882352941177,.6784313725490196],oldlace:[.9921568627450981,.9607843137254902,.9019607843137255],olivedrab:[.4196078431372549,.5568627450980392,.13725490196078433],orange:[1,.6470588235294118,0],orangered:[1,.27058823529411763,0],orchid:[.8549019607843137,.4392156862745098,.8392156862745098],palegoldenrod:[.9333333333333333,.9098039215686274,.6666666666666666],palegreen:[.596078431372549,.984313725490196,.596078431372549],paleturquoise:[.6862745098039216,.9333333333333333,.9333333333333333],palevioletred:[.8588235294117647,.4392156862745098,.5764705882352941],papayawhip:[1,.9372549019607843,.8352941176470589],peachpuff:[1,.8549019607843137,.7254901960784313],peru:[.803921568627451,.5215686274509804,.24705882352941178],pink:[1,.7529411764705882,.796078431372549],plum:[.8666666666666667,.6274509803921569,.8666666666666667],powderblue:[.6901960784313725,.8784313725490196,.9019607843137255],rosybrown:[.7372549019607844,.5607843137254902,.5607843137254902],royalblue:[.2549019607843137,.4117647058823529,.8823529411764706],saddlebrown:[.5450980392156862,.27058823529411763,.07450980392156863],salmon:[.9803921568627451,.5019607843137255,.4470588235294118],sandybrown:[.9568627450980393,.6431372549019608,.3764705882352941],seagreen:[.1803921568627451,.5450980392156862,.3411764705882353],seashell:[1,.9607843137254902,.9333333333333333],sienna:[.6274509803921569,.3215686274509804,.17647058823529413],skyblue:[.5294117647058824,.807843137254902,.9215686274509803],slateblue:[.41568627450980394,.35294117647058826,.803921568627451],slategray:[.4392156862745098,.5019607843137255,.5647058823529412],slategrey:[.4392156862745098,.5019607843137255,.5647058823529412],snow:[1,.9803921568627451,.9803921568627451],springgreen:[0,1,.4980392156862745],steelblue:[.27450980392156865,.5098039215686274,.7058823529411765],tan:[.8235294117647058,.7058823529411765,.5490196078431373],thistle:[.8470588235294118,.7490196078431373,.8470588235294118],tomato:[1,.38823529411764707,.2784313725490196],turquoise:[.25098039215686274,.8784313725490196,.8156862745098039],violet:[.9333333333333333,.5098039215686274,.9333333333333333],wheat:[.9607843137254902,.8705882352941177,.7019607843137254],whitesmoke:[.9607843137254902,.9607843137254902,.9607843137254902],yellowgreen:[.6039215686274509,.803921568627451,.19607843137254902]};pA.exports=y$;});var gA=G((oOe,mA)=>{var w$=ux(),v$=r=>w$[r.toLowerCase()];mA.exports=v$;});var bA=G((aOe,xA)=>{var E$=r=>{if(r=r.replace("#",""),r.length<6)throw new Error("the given notation must contain 3 or more hex values");let e=parseInt(r.substring(0,2),16)/255,t=parseInt(r.substring(2,4),16)/255,n=parseInt(r.substring(4,6),16)/255;if(r.length>=8){let i=parseInt(r.substring(6,8),16)/255;return[e,t,n,i];}return[e,t,n];};xA.exports=E$;});var cx=G((lOe,yA)=>{var P$=(r,e,t)=>(t<0&&(t+=1),t>1&&(t-=1),t<.16666666666666666?r+(e-r)*6*t:t<.5?e:t<.6666666666666666?r+(e-r)*(.6666666666666666-t)*6:r);yA.exports=P$;});var vA=G((uOe,wA)=>{var _$=Qe(),hx=cx(),S$=(...r)=>{if(r=_$(r),r.length<3)throw new Error("values must contain H, S and L values");let e=r[0],t=r[1],n=r[2],i=n,s=n,o=n;if(t!==0){let a=n<.5?n*(1+t):n+t-n*t,l=2*n-a;i=hx(l,a,e+1/3),s=hx(l,a,e),o=hx(l,a,e-1/3);}if(r.length>3){let a=r[3];return[i,s,o,a];}return[i,s,o];};wA.exports=S$;});var PA=G((cOe,EA)=>{var B$=Qe(),I$=(...r)=>{if(r=B$(r),r.length<3)throw new Error("values must contain H, S and V values");let e=r[0],t=r[1],n=r[2],i=0,s=0,o=0,a=Math.floor(e*6),l=e*6-a,u=n*(1-t),c=n*(1-l*t),h=n*(1-(1-l)*t);switch(a%6){case 0:i=n,s=h,o=u;break;case 1:i=c,s=n,o=u;break;case 2:i=u,s=n,o=h;break;case 3:i=u,s=c,o=n;break;case 4:i=h,s=u,o=n;break;case 5:i=n,s=u,o=c;break;}if(r.length>3){let d=r[3];return[i,s,o,d];}return[i,s,o];};EA.exports=I$;});var SA=G((hOe,_A)=>{var A$=Qe(),C$=(...r)=>{if(r=A$(r),r.length<3)throw new Error("values must contain R, G and B values");let e=r[0]*255,t=r[1]*255,n=r[2]*255,i=`#${Number(16777216+e*65536+t*256+n).toString(16).substring(1,7)}`;return r.length>3&&(i=i+Number(r[3]*255).toString(16)),i;};_A.exports=C$;});var IA=G((fOe,BA)=>{var M$=Qe(),T$=(...r)=>{if(r=M$(r),r.length<3)throw new Error("values must contain R, G and B values");let e=r[0],t=r[1],n=r[2],i=Math.max(e,t,n),s=Math.min(e,t,n),o,a,l=(i+s)/2;if(i===s)o=a=0;else{let u=i-s;switch(a=l>.5?u/(2-i-s):u/(i+s),i){case e:o=(t-n)/u+(t<n?6:0);break;case t:o=(n-e)/u+2;break;case n:o=(e-t)/u+4;break;}o/=6;}if(r.length>3){let u=r[3];return[o,a,l,u];}return[o,a,l];};BA.exports=T$;});var CA=G((dOe,AA)=>{var R$=Qe(),N$=(...r)=>{if(r=R$(r),r.length<3)throw new Error("values must contain R, G and B values");let e=r[0],t=r[1],n=r[2],i=Math.max(e,t,n),s=Math.min(e,t,n),o,a=i,l=i-s,u=i===0?0:l/i;if(i===s)o=0;else{switch(i){case e:o=(t-n)/l+(t<n?6:0);break;case t:o=(n-e)/l+2;break;case n:o=(e-t)/l+4;break;}o/=6;}if(r.length>3){let c=r[3];return[o,u,a,c];}return[o,u,a];};AA.exports=N$;});var TA=G((pOe,MA)=>{MA.exports={colorize:dA(),colorNameToRgb:gA(),cssColors:ux(),hexToRgb:bA(),hslToRgb:vA(),hsvToRgb:PA(),hueToColorComponent:cx(),rgbToHex:SA(),rgbToHsl:IA(),rgbToHsv:CA()};});var LA=G((mOe,NA)=>{var L$=r=>{if(!Array.isArray(r))throw new Error("Bezier points must be a valid array/");if(r.length<2)throw new Error("Bezier points must contain at least 2 values.");let e=O$(r);return{points:r,pointType:e,dimensions:e==="float_single"?0:r[0].length,permutations:RA(r.length-1),tangentPermutations:RA(r.length-2)};},O$=function(r){let e=null;return r.forEach(t=>{let n="";if(Number.isFinite(t))n="float_single";else if(Array.isArray(t))t.forEach(i=>{if(!Number.isFinite(i))throw new Error("Bezier point values must all be numbers.");}),n="float_"+t.length;else throw new Error("Bezier points must all be numbers or arrays of number.");if(e==null)e=n;else if(e!==n)throw new Error("Bezier points must be either all numbers or all arrays of numbers of the same size.");}),e;},RA=function(r){let e=[];for(let t=0;t<=r;t++)e.push(fx(r)/(fx(t)*fx(r-t)));return e;},fx=function(r){let e=1;for(let t=2;t<=r;t++)e*=t;return e;};NA.exports=L$;});var UA=G((gOe,kA)=>{var k$=(r,e)=>{if(r<0||r>1)throw new Error("Bezier valueAt() input must be between 0 and 1");if(e.pointType==="float_single")return OA(e,e.points,r);{let t=[];for(let n=0;n<e.dimensions;n++){let i=[];for(let s=0;s<e.points.length;s++)i.push(e.points[s][n]);t.push(OA(e,i,r));}return t;}},OA=function(r,e,t){let n=e.length-1,i=0;for(let s=0;s<=n;s++)i+=r.permutations[s]*Math.pow(1-t,n-s)*Math.pow(t,s)*e[s];return i;};kA.exports=k$;});var FA=G((xOe,GA)=>{var U$=(r,e)=>{if(r<0||r>1)throw new Error("Bezier tangentAt() input must be between 0 and 1");if(e.pointType==="float_single")return DA(e,e.points,r);{let t=[];for(let n=0;n<e.dimensions;n++){let i=[];for(let s=0;s<e.points.length;s++)i.push(e.points[s][n]);t.push(DA(e,i,r));}return t;}},DA=function(r,e,t){let n=e.length-1,i=0;for(let s=0;s<n;s++){let o=n*(e[s+1]-e[s]);i+=r.tangentPermutations[s]*Math.pow(1-t,n-1-s)*Math.pow(t,s)*o;}return i;};GA.exports=U$;});var zA=G((bOe,qA)=>{qA.exports={create:LA(),valueAt:UA(),tangentAt:FA()};});var XA=G((yOe,YA)=>{YA.exports={bezier:zA()};});var Hu=G((wOe,VA)=>{var D$=r=>{let e=0;for(let t=0;t<r.length;t++){let n=(t+1)%r.length;e+=r[t][0]*r[n][1],e-=r[n][0]*r[t][1];}return e/2;};VA.exports=D$;});var dx=G((vOe,WA)=>{var G$=Hu(),F$=r=>G$(r.vertices);WA.exports=F$;});var px=G((EOe,$A)=>{var q$=r=>((r===void 0||r.length<3)&&(r=[]),{vertices:r});$A.exports=q$;});var mx=G((POe,jA)=>{var z$=px(),Y$=r=>{let e=r.vertices.slice().reverse();return z$(e);};jA.exports=Y$;});var HA=G((SOe,ZA)=>{var X$=dx(),V$=mx(),W$=(r,e)=>{if(r.length===0)return 0;let t=e.vertices;return t.length<3?0:(X$(e)<0&&(e=V$(e)),r.reduce((i,s)=>i+$$(s,t),0)===r.length?1:0);},$$=(r,e)=>{let t=e.length,n=r[0],i=r[1],s=e[t-1],o=e[0],a=s[1]>i,l=0,u=0;for(let c=t+1;--c;){let h=o[1]>i;if(a!==h){let d=s[0]>n,f=o[0]>n;(d&&f||o[0]-(o[1]-i)*(s[0]-o[0])/(s[1]-o[1])>=n)&&(l=!l);}a=h,s=o,o=e[++u];}return l;},_Oe=(r,e,t)=>(e[0]-r[0])*(t[1]-r[1])-(t[0]-r[0])*(e[1]-r[1]);ZA.exports=W$;});var Ud=G((BOe,KA)=>{KA.exports={arePointsInside:HA(),create:px(),flip:mx(),measureArea:dx()};});var Dd=G((IOe,QA)=>{QA.exports={geom2:tt(),geom3:rt(),path2:kt(),poly2:Ud(),poly3:gt()};});var Gd=G((AOe,JA)=>{var j$=()=>[0,1,0];JA.exports=j$;});var tC=G((COe,eC)=>{var Z$=Gd(),H$=r=>{let e=Z$();return e[0]=r[0],e[1]=r[1],e[2]=r[2],e;};eC.exports=H$;});var Fd=G((MOe,rC)=>{var gx=it(),K$=r=>{let e=gx.normal(gx.create(),r);return gx.negate(e,e),e;};rC.exports=K$;});var Ku=G((TOe,iC)=>{var nC=it(),Q$=r=>nC.scale(nC.create(),r,r[2]);iC.exports=Q$;});var oC=G((ROe,sC)=>{var J$=it(),ej=Fd(),tj=Ku(),rj=(r,e)=>{let t=tj(r),n=ej(r),i=(n[1]-t[1])/(n[0]-t[0]),s=t[1]-i*t[0],o=-1/i,l=(e[1]-o*e[0]-s)/(i-o),u=i*l+s;return J$.fromValues(l,u);};sC.exports=rj;});var xx=G((NOe,aC)=>{var nj=(r,e)=>(r[0]=e[0],r[1]=e[1],r[2]=e[2],r);aC.exports=nj;});var uC=G((LOe,lC)=>{var ij=it(),sj=(r,e)=>{let t=ij.dot(e,r);return t=Math.abs(t-r[2]),t;};lC.exports=sj;});var hC=G((OOe,cC)=>{var oj=(r,e)=>r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2];cC.exports=oj;});var bx=G((kOe,fC)=>{var Qu=it(),aj=(r,e,t)=>{let n=Qu.subtract(Qu.create(),t,e);Qu.normal(n,n),Qu.normalize(n,n);let i=Qu.dot(e,n);return r[0]=n[0],r[1]=n[1],r[2]=i,r;};fC.exports=aj;});var yx=G((UOe,dC)=>{var lj=Gd(),uj=(r,e,t)=>{let n=lj();return n[0]=r,n[1]=e,n[2]=t,n;};dC.exports=uj;});var Ju=G((DOe,pC)=>{var{NEPS:wx}=wt(),cj=(r,e)=>Math.abs(r[0]-e[0])<=wx&&Math.abs(r[1]-e[1])<=wx&&Math.abs(r[2]-e[2])<=wx;pC.exports=cj;});var vx=G((GOe,mC)=>{var hj=(r,e,t)=>{let n=t-r[1],i=e[1]-r[1];i<0&&(n=-n,i=-i);let s;return n<=0?s=0:n>=i?s=1:i<1e-10?s=.5:s=n/i,r[0]+s*(e[0]-r[0]);};mC.exports=hj;});var Ex=G((FOe,gC)=>{var fj=(r,e,t,n)=>{if(r[0]===e[0]&&r[1]===e[1]||t[0]===n[0]&&t[1]===n[1])return;let i=(n[1]-t[1])*(e[0]-r[0])-(n[0]-t[0])*(e[1]-r[1]);if(Math.abs(i)<Number.MIN_VALUE)return;let s=((n[0]-t[0])*(r[1]-t[1])-(n[1]-t[1])*(r[0]-t[0]))/i,o=((e[0]-r[0])*(r[1]-t[1])-(e[1]-r[1])*(r[0]-t[0]))/i;if(s<0||s>1||o<0||o>1)return;let a=r[0]+s*(e[0]-r[0]),l=r[1]+s*(e[1]-r[1]);return[a,l];};gC.exports=fj;});var bC=G((qOe,xC)=>{var dj=(r,e,t,n,i,s)=>{let a=1/(r*n-e*t),l=i*n-e*s,u=-i*t+r*s;return l*=a,u*=a,[l,u];};xC.exports=dj;});var nl=G((zOe,yC)=>{yC.exports={aboutEqualNormals:Ju(),area:Hu(),cos:Ir().cos,interpolateBetween2DPointsForY:vx(),intersect:Ex(),sin:Ir().sin,solve2Linear:bC()};});var vC=G((YOe,wC)=>{var pj=it(),{solve2Linear:mj}=nl(),gj=(r,e)=>{let t=mj(r[0],r[1],e[0],e[1],r[2],e[2]);return pj.clone(t);};wC.exports=gj;});var _C=G((XOe,PC)=>{var EC=it(),xj=xx(),bj=yx(),yj=(r,e)=>{let t=EC.negate(EC.create(),e),n=-e[2];return xj(r,bj(t[0],t[1],n));};PC.exports=yj;});var BC=G((VOe,SC)=>{var wj=r=>`line2: (${r[0].toFixed(7)}, ${r[1].toFixed(7)}, ${r[2].toFixed(7)})`;SC.exports=wj;});var CC=G((WOe,AC)=>{var IC=it(),vj=bx(),Ej=Ku(),Pj=Fd(),_j=(r,e,t)=>{let n=Ej(e),i=Pj(e);return IC.transform(n,n,t),IC.transform(i,i,t),vj(r,n,i);};AC.exports=_j;});var TC=G(($Oe,MC)=>{var Sj=Ku(),Bj=(r,e)=>{let t=(r[2]-r[1]*e)/r[0];return Number.isNaN(t)&&(t=Sj(r)[0]),t;};MC.exports=Bj;});var qd=G((jOe,RC)=>{RC.exports={clone:tC(),closestPoint:oC(),copy:xx(),create:Gd(),direction:Fd(),distanceToPoint:uC(),equals:hC(),fromPoints:bx(),fromValues:yx(),intersectPointOfLines:vC(),origin:Ku(),reverse:_C(),toString:BC(),transform:CC(),xAtY:TC()};});var Px=G((ZOe,LC)=>{var NC=Ye(),Ij=()=>[NC.fromValues(0,0,0),NC.fromValues(0,0,1)];LC.exports=Ij;});var UC=G((HOe,kC)=>{var OC=Ye(),Aj=Px(),Cj=r=>{let e=Aj();return OC.copy(e[0],r[0]),OC.copy(e[1],r[1]),e;};kC.exports=Cj;});var _x=G((KOe,DC)=>{var zo=Ye(),Mj=(r,e)=>{let t=r[0],n=r[1],i=zo.dot(zo.subtract(zo.create(),e,t),n),s=zo.dot(n,n),o=i/s,a=zo.scale(zo.create(),n,o);return zo.add(a,a,t),a;};DC.exports=Mj;});var qC=G((QOe,FC)=>{var GC=Ye(),Tj=(r,e)=>(GC.copy(r[0],e[0]),GC.copy(r[1],e[1]),r);FC.exports=Tj;});var YC=G((JOe,zC)=>{var Rj=r=>r[1];zC.exports=Rj;});var VC=G((eke,XC)=>{var Sx=Ye(),Nj=_x(),Lj=(r,e)=>{let t=Nj(r,e),n=Sx.subtract(Sx.create(),e,t);return Sx.length(n);};XC.exports=Lj;});var jC=G((tke,$C)=>{var WC=Ye(),Oj=(r,e)=>!(!WC.equals(r[1],e[1])||!WC.equals(r[0],e[0]));$C.exports=Oj;});var il=G((rke,ZC)=>{var zd=Ye(),kj=(r,e,t)=>{let n=zd.normalize(zd.create(),t);return zd.copy(r[0],e),zd.copy(r[1],n),r;};ZC.exports=kj;});var KC=G((nke,HC)=>{var Yo=Ye(),{solve2Linear:Bx}=nl(),{EPS:Uj}=wt(),Dj=il(),Gj=(r,e,t)=>{let n=Yo.cross(Yo.create(),e,t),i=Yo.length(n);if(i<Uj)throw new Error("parallel planes do not intersect");i=1/i,n=Yo.scale(n,n,i);let s=Math.abs(n[0]),o=Math.abs(n[1]),a=Math.abs(n[2]),l,u;return s>=o&&s>=a?(u=Bx(e[1],e[2],t[1],t[2],e[3],t[3]),l=Yo.fromValues(0,u[0],u[1])):o>=s&&o>=a?(u=Bx(e[0],e[2],t[0],t[2],e[3],t[3]),l=Yo.fromValues(u[0],0,u[1])):(u=Bx(e[0],e[1],t[0],t[1],e[3],t[3]),l=Yo.fromValues(u[0],u[1],0)),Dj(r,l,n);};HC.exports=Gj;});var eM=G((ike,JC)=>{var QC=Ye(),Fj=il(),qj=(r,e,t)=>{let n=QC.subtract(QC.create(),t,e);return Fj(r,e,n);};JC.exports=qj;});var rM=G((ske,tM)=>{var sl=Ye(),zj=(r,e)=>{let t=e,n=e[3],i=r[0],s=r[1],o=(n-sl.dot(t,i))/sl.dot(t,s);return sl.add(sl.create(),i,sl.scale(sl.create(),s,o));};tM.exports=zj;});var iM=G((oke,nM)=>{var Yj=r=>r[0];nM.exports=Yj;});var oM=G((ake,sM)=>{var Ix=Ye(),Xj=il(),Vj=(r,e)=>{let t=Ix.clone(e[0]),n=Ix.negate(Ix.create(),e[1]);return Xj(r,t,n);};sM.exports=Vj;});var lM=G((lke,aM)=>{var Wj=r=>{let e=r[0],t=r[1];return`line3: point: (${e[0].toFixed(7)}, ${e[1].toFixed(7)}, ${e[2].toFixed(7)}) direction: (${t[0].toFixed(7)}, ${t[1].toFixed(7)}, ${t[2].toFixed(7)})`;};aM.exports=Wj;});var cM=G((uke,uM)=>{var ol=Ye(),$j=il(),jj=(r,e,t)=>{let n=e[0],i=e[1],s=ol.add(ol.create(),n,i),o=ol.transform(ol.create(),n,t),a=ol.transform(s,s,t),l=ol.subtract(a,a,o);return $j(r,o,l);};uM.exports=jj;});var fM=G((cke,hM)=>{hM.exports={clone:UC(),closestPoint:_x(),copy:qC(),create:Px(),direction:YC(),distanceToPoint:VC(),equals:jC(),fromPlanes:KC(),fromPointAndDirection:il(),fromPoints:eM(),intersectPointOfLineAndPlane:rM(),origin:iM(),reverse:oM(),toString:lM(),transform:cM()};});var pM=G((hke,dM)=>{dM.exports={constants:wt(),line2:qd(),line3:fM(),mat4:Dt(),plane:oi(),utils:nl(),vec2:it(),vec3:Ye(),vec4:rx()};});var Ax=G((fke,xM)=>{var Zj=Qe(),mM=tt(),gM=rt(),Hj=kt(),Kj=gt(),Yd=new WeakMap(),Qj=()=>0,Jj=r=>{let e=Yd.get(r);return e||(e=mM.toSides(r).reduce((n,i)=>n+(i[0][0]*i[1][1]-i[0][1]*i[1][0]),0),e*=.5,Yd.set(r,e),e);},eZ=r=>{let e=Yd.get(r);return e||(e=gM.toPolygons(r).reduce((n,i)=>n+Kj.measureArea(i),0),Yd.set(r,e),e);},tZ=(...r)=>{if(r=Zj(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>Hj.isA(t)?Qj(t):mM.isA(t)?Jj(t):gM.isA(t)?eZ(t):0);return e.length===1?e[0]:e;};xM.exports=tZ;});var yM=G((dke,bM)=>{var rZ=Qe(),nZ=Ax(),iZ=(...r)=>{if(r=rZ(r),r.length===0)throw new Error("measureAggregateArea: no geometries supplied");let e=nZ(r);if(r.length===1)return e;let t=0;return e.reduce((n,i)=>n+i,t);};bM.exports=iZ;});var js=G((pke,_M)=>{var sZ=Qe(),Ai=it(),ec=Ye(),wM=tt(),vM=rt(),EM=kt(),PM=gt(),al=new WeakMap(),oZ=r=>{let e=al.get(r);if(e)return e;let t=EM.toPoints(r),n;t.length===0?n=Ai.create():n=Ai.clone(t[0]);let i=Ai.clone(n);return t.forEach(s=>{Ai.min(n,n,s),Ai.max(i,i,s);}),n=[n[0],n[1],0],i=[i[0],i[1],0],e=[n,i],al.set(r,e),e;},aZ=r=>{let e=al.get(r);if(e)return e;let t=wM.toPoints(r),n;t.length===0?n=Ai.create():n=Ai.clone(t[0]);let i=Ai.clone(n);return t.forEach(s=>{Ai.min(n,n,s),Ai.max(i,i,s);}),n=[n[0],n[1],0],i=[i[0],i[1],0],e=[n,i],al.set(r,e),e;},lZ=r=>{let e=al.get(r);if(e)return e;let t=vM.toPolygons(r),n=ec.create();if(t.length>0){let s=PM.toPoints(t[0]);ec.copy(n,s[0]);}let i=ec.clone(n);return t.forEach(s=>{PM.toPoints(s).forEach(o=>{ec.min(n,n,o),ec.max(i,i,o);});}),n=[n[0],n[1],n[2]],i=[i[0],i[1],i[2]],e=[n,i],al.set(r,e),e;},uZ=(...r)=>{if(r=sZ(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>EM.isA(t)?oZ(t):wM.isA(t)?aZ(t):vM.isA(t)?lZ(t):[[0,0,0],[0,0,0]]);return e.length===1?e[0]:e;};_M.exports=uZ;});var Xd=G((mke,SM)=>{var cZ=Qe(),hZ=Lg(),fZ=Ng(),dZ=js(),pZ=(...r)=>{if(r=cZ(r),r.length===0)throw new Error("measureAggregateBoundingBox: no geometries supplied");let e=dZ(r);if(r.length===1)return e;let t=[[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]];return e.reduce((n,i)=>(n=[hZ(n[0],n[0],i[0]),fZ(n[1],n[1],i[1])],n),t);};SM.exports=pZ;});var Cx=G((gke,BM)=>{var{EPS:mZ}=wt(),gZ=(r,e)=>{let t=0;for(let n=0;n<e;n++)t+=r[1][n]-r[0][n];return mZ*t/e;};BM.exports=gZ;});var AM=G((xke,IM)=>{var xZ=Qe(),bZ=Xd(),yZ=Cx(),{geom2:wZ,geom3:vZ,path2:EZ}=Dd(),PZ=(...r)=>{if(r=xZ(r),r.length===0)throw new Error("measureAggregateEpsilon: no geometries supplied");let e=bZ(r),t=0;return t=r.reduce((n,i)=>EZ.isA(i)||wZ.isA(i)?Math.max(n,2):vZ.isA(i)?Math.max(n,3):0,t),yZ(e,t);};IM.exports=PZ;});var Mx=G((bke,TM)=>{var _Z=Qe(),SZ=tt(),CM=rt(),BZ=kt(),IZ=gt(),MM=new WeakMap(),AZ=()=>0,CZ=()=>0,MZ=r=>{let e=MM.get(r);return e||(e=CM.toPolygons(r).reduce((n,i)=>n+IZ.measureSignedVolume(i),0),MM.set(r,e),e);},TZ=(...r)=>{if(r=_Z(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>BZ.isA(t)?AZ(t):SZ.isA(t)?CZ(t):CM.isA(t)?MZ(t):0);return e.length===1?e[0]:e;};TM.exports=TZ;});var NM=G((yke,RM)=>{var RZ=Qe(),NZ=Mx(),LZ=(...r)=>{if(r=RZ(r),r.length===0)throw new Error("measureAggregateVolume: no geometries supplied");let e=NZ(r);if(r.length===1)return e;let t=0;return e.reduce((n,i)=>n+i,t);};RM.exports=LZ;});var FM=G((wke,GM)=>{var OZ=Qe(),LM=it(),ln=Ye(),OM=tt(),kM=rt(),UM=kt(),DM=gt(),ll=new WeakMap(),kZ=r=>{let e=ll.get(r);if(e!==void 0)return e;let t=ln.create(),n=0,i=UM.toPoints(r);if(i.length>0){let s=0,o=ln.create();i.forEach(a=>{ln.add(t,t,ln.fromVec2(o,a,0)),s++;}),ln.scale(t,t,1/s),i.forEach(a=>{n=Math.max(n,LM.squaredDistance(t,a));}),n=Math.sqrt(n);}return e=[t,n],ll.set(r,e),e;},UZ=r=>{let e=ll.get(r);if(e!==void 0)return e;let t=ln.create(),n=0,i=OM.toSides(r);if(i.length>0){let s=0,o=ln.create();i.forEach(a=>{ln.add(t,t,ln.fromVec2(o,a[0],0)),s++;}),ln.scale(t,t,1/s),i.forEach(a=>{n=Math.max(n,LM.squaredDistance(t,a[0]));}),n=Math.sqrt(n);}return e=[t,n],ll.set(r,e),e;},DZ=r=>{let e=ll.get(r);if(e!==void 0)return e;let t=ln.create(),n=0,i=kM.toPolygons(r);if(i.length>0){let s=0;i.forEach(o=>{DM.toPoints(o).forEach(a=>{ln.add(t,t,a),s++;});}),ln.scale(t,t,1/s),i.forEach(o=>{DM.toPoints(o).forEach(a=>{n=Math.max(n,ln.squaredDistance(t,a));});}),n=Math.sqrt(n);}return e=[t,n],ll.set(r,e),e;},GZ=(...r)=>{r=OZ(r);let e=r.map(t=>UM.isA(t)?kZ(t):OM.isA(t)?UZ(t):kM.isA(t)?DZ(t):[[0,0,0],0]);return e.length===1?e[0]:e;};GM.exports=GZ;});var zM=G((vke,qM)=>{var FZ=Qe(),qZ=js(),zZ=(...r)=>{r=FZ(r);let e=r.map(t=>{let n=qZ(t);return[n[0][0]+(n[1][0]-n[0][0])/2,n[0][1]+(n[1][1]-n[0][1])/2,n[0][2]+(n[1][2]-n[0][2])/2];});return e.length===1?e[0]:e;};qM.exports=zZ;});var WM=G((Eke,VM)=>{var YZ=Qe(),Ci=Ye(),YM=tt(),XM=rt(),Vd=new WeakMap(),XZ=r=>{let e=Vd.get(r);if(e!==void 0)return e;let t=YM.toSides(r),n=0,i=0,s=0;if(t.length>0){for(let a=0;a<t.length;a++){let l=t[a][0],u=t[a][1],c=l[0]*u[1]-l[1]*u[0];n+=c,i+=(l[0]+u[0])*c,s+=(l[1]+u[1])*c;}n/=2;let o=1/(n*6);i*=o,s*=o;}return e=Ci.fromValues(i,s,0),Vd.set(r,e),e;},VZ=r=>{let e=Vd.get(r);if(e!==void 0)return e;e=Ci.create();let t=XM.toPolygons(r);if(t.length===0)return e;let n=0,i=Ci.create();return t.forEach(s=>{let o=s.vertices;for(let a=0;a<o.length-2;a++){Ci.cross(i,o[a+1],o[a+2]);let l=Ci.dot(o[0],i)/6;n+=l,Ci.add(i,o[0],o[a+1]),Ci.add(i,i,o[a+2]);let u=Ci.scale(i,i,1/4*l);Ci.add(e,e,u);}}),Ci.scale(e,e,1/n),Vd.set(r,e),e;},WZ=(...r)=>{r=YZ(r);let e=r.map(t=>YM.isA(t)?XZ(t):XM.isA(t)?VZ(t):[0,0,0]);return e.length===1?e[0]:e;};VM.exports=WZ;});var jM=G((Pke,$M)=>{var $Z=Qe(),jZ=js(),ZZ=(...r)=>{r=$Z(r);let e=r.map(t=>{let n=jZ(t);return[n[1][0]-n[0][0],n[1][1]-n[0][1],n[1][2]-n[0][2]];});return e.length===1?e[0]:e;};$M.exports=ZZ;});var us=G((_ke,ZM)=>{var HZ=Qe(),{geom2:KZ,geom3:QZ,path2:JZ}=Dd(),Tx=Cx(),Rx=js(),eH=r=>Tx(Rx(r),2),tH=r=>Tx(Rx(r),2),rH=r=>Tx(Rx(r),3),nH=(...r)=>{if(r=HZ(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>JZ.isA(t)?eH(t):KZ.isA(t)?tH(t):QZ.isA(t)?rH(t):0);return e.length===1?e[0]:e;};ZM.exports=nH;});var KM=G((Ske,HM)=>{HM.exports={measureAggregateArea:yM(),measureAggregateBoundingBox:Xd(),measureAggregateEpsilon:AM(),measureAggregateVolume:NM(),measureArea:Ax(),measureBoundingBox:js(),measureBoundingSphere:FM(),measureCenter:zM(),measureCenterOfMass:WM(),measureDimensions:jM(),measureEpsilon:us(),measureVolume:Mx()};});var mr=G((Bke,QM)=>{var iH=(r,e)=>Array.isArray(r)&&r.length>=e?r.every(t=>Number.isFinite(t)):!1,sH=(r,e)=>Number.isFinite(r)&&r>e,oH=(r,e)=>Number.isFinite(r)&&r>=e;QM.exports={isNumberArray:iH,isGT:sH,isGTE:oH};});var tT=G((Ike,eT)=>{var{EPS:JM,TAU:ul}=wt(),cs=it(),aH=kt(),{isGT:lH,isGTE:Nx,isNumberArray:uH}=mr(),cH=r=>{let e={center:[0,0],radius:1,startAngle:0,endAngle:ul,makeTangent:!1,segments:32},{center:t,radius:n,startAngle:i,endAngle:s,makeTangent:o,segments:a}=Object.assign({},e,r);if(!uH(t,2))throw new Error("center must be an array of X and Y values");if(!lH(n,0))throw new Error("radius must be greater than zero");if(!Nx(i,0))throw new Error("startAngle must be positive");if(!Nx(s,0))throw new Error("endAngle must be positive");if(!Nx(a,4))throw new Error("segments must be four or more");i=i%ul,s=s%ul;let l=ul;i<s&&(l=s-i),i>s&&(l=s+(ul-i));let u=Math.acos((n*n+n*n-JM*JM)/(2*n*n)),c=cs.clone(t),h,d=[];if(l<u)h=cs.fromAngleRadians(cs.create(),i),cs.scale(h,h,n),cs.add(h,h,c),d.push(h);else{let f=Math.max(1,Math.floor(a*(l/ul)))+1,p=f*.5/l;p>.25&&(p=.25);let m=o?f+2:f;for(let g=0;g<=m;g++){let b=g;o&&(b=(g-1)*(f-2*p)/f+p,b<0&&(b=0),b>f&&(b=f));let y=i+b*(l/f);h=cs.fromAngleRadians(cs.create(),y),cs.scale(h,h,n),cs.add(h,h,c),d.push(h);}}return aH.fromPoints({closed:!1},d);};eT.exports=cH;});var kx=G((Ake,iT)=>{var{EPS:rT,TAU:Zs}=wt(),Lx=it(),hH=tt(),{sin:fH,cos:dH}=Ir(),{isGTE:Ox,isNumberArray:nT}=mr(),pH=r=>{let e={center:[0,0],radius:[1,1],startAngle:0,endAngle:Zs,segments:32},{center:t,radius:n,startAngle:i,endAngle:s,segments:o}=Object.assign({},e,r);if(!nT(t,2))throw new Error("center must be an array of X and Y values");if(!nT(n,2))throw new Error("radius must be an array of X and Y values");if(!n.every(f=>f>0))throw new Error("radius values must be greater than zero");if(!Ox(i,0))throw new Error("startAngle must be positive");if(!Ox(s,0))throw new Error("endAngle must be positive");if(!Ox(o,3))throw new Error("segments must be three or more");i=i%Zs,s=s%Zs;let a=Zs;i<s&&(a=s-i),i>s&&(a=s+(Zs-i));let l=Math.min(n[0],n[1]),u=Math.acos((l*l+l*l-rT*rT)/(2*l*l));if(a<u)throw new Error("startAngle and endAngle do not define a significant rotation");o=Math.floor(o*(a/Zs));let c=Lx.clone(t),h=a/o,d=[];o=a<Zs?o+1:o;for(let f=0;f<o;f++){let p=h*f+i,m=Lx.fromValues(n[0]*dH(p),n[1]*fH(p));Lx.add(m,c,m),d.push(m);}return a<Zs&&d.push(c),hH.fromPoints(d);};iT.exports=pH;});var Ux=G((Cke,sT)=>{var{TAU:mH}=wt(),gH=kx(),{isGT:xH}=mr(),bH=r=>{let e={center:[0,0],radius:1,startAngle:0,endAngle:mH,segments:32},{center:t,radius:n,startAngle:i,endAngle:s,segments:o}=Object.assign({},e,r);if(!xH(n,0))throw new Error("radius must be greater than zero");return n=[n,n],gH({center:t,radius:n,startAngle:i,endAngle:s,segments:o});};sT.exports=bH;});var Dx=G((Mke,aT)=>{var yH=rt(),wH=gt(),{isNumberArray:oT}=mr(),vH=r=>{let e={center:[0,0,0],size:[2,2,2]},{center:t,size:n}=Object.assign({},e,r);if(!oT(t,3))throw new Error("center must be an array of X, Y and Z values");if(!oT(n,3))throw new Error("size must be an array of width, depth and height values");if(!n.every(s=>s>0))throw new Error("size values must be greater than zero");return yH.create([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(s=>{let o=s[0].map(a=>[t[0]+n[0]/2*(2*!!(a&1)-1),t[1]+n[1]/2*(2*!!(a&2)-1),t[2]+n[2]/2*(2*!!(a&4)-1)]);return wH.create(o);}));};aT.exports=vH;});var uT=G((Tke,lT)=>{var EH=Dx(),{isGT:PH}=mr(),_H=r=>{let e={center:[0,0,0],size:2},{center:t,size:n}=Object.assign({},e,r);if(!PH(n,0))throw new Error("size must be greater than zero");return n=[n,n,n],EH({center:t,size:n});};lT.exports=_H;});var qx=G((Rke,hT)=>{var{EPS:cT,TAU:Hs}=wt(),Ar=Ye(),SH=rt(),BH=gt(),{sin:IH,cos:AH}=Ir(),{isGT:CH,isGTE:Gx,isNumberArray:Fx}=mr(),MH=r=>{let e={center:[0,0,0],height:2,startRadius:[1,1],startAngle:0,endRadius:[1,1],endAngle:Hs,segments:32},{center:t,height:n,startRadius:i,startAngle:s,endRadius:o,endAngle:a,segments:l}=Object.assign({},e,r);if(!Fx(t,3))throw new Error("center must be an array of X, Y and Z values");if(!CH(n,0))throw new Error("height must be greater then zero");if(!Fx(i,2))throw new Error("startRadius must be an array of X and Y values");if(!i.every(L=>L>=0))throw new Error("startRadius values must be positive");if(!Fx(o,2))throw new Error("endRadius must be an array of X and Y values");if(!o.every(L=>L>=0))throw new Error("endRadius values must be positive");if(o.every(L=>L===0)&&i.every(L=>L===0))throw new Error("at least one radius must be positive");if(!Gx(s,0))throw new Error("startAngle must be positive");if(!Gx(a,0))throw new Error("endAngle must be positive");if(!Gx(l,4))throw new Error("segments must be four or more");s=s%Hs,a=a%Hs;let u=Hs;s<a&&(u=a-s),s>a&&(u=a+(Hs-s));let c=Math.min(i[0],i[1],o[0],o[1]),h=Math.acos((c*c+c*c-cT*cT)/(2*c*c));if(u<h)throw new Error("startAngle and endAngle do not define a significant rotation");let d=Math.floor(l*(u/Hs)),f=Ar.fromValues(0,0,-(n/2)),p=Ar.fromValues(0,0,n/2),m=Ar.subtract(Ar.create(),p,f),g=Ar.fromValues(1,0,0),b=Ar.fromValues(0,1,0),y=Ar.create(),v=Ar.create(),E=Ar.create(),P=(L,S,T)=>{let B=S*u+s;return Ar.scale(y,g,T[0]*AH(B)),Ar.scale(v,b,T[1]*IH(B)),Ar.add(y,y,v),Ar.scale(E,m,L),Ar.add(E,E,f),Ar.add(Ar.create(),y,E);},M=(...L)=>{let S=L.map(T=>Ar.add(Ar.create(),T,t));return BH.create(S);},I=[];for(let L=0;L<d;L++){let S=L/d,T=(L+1)/d;u===Hs&&L===d-1&&(T=0),o[0]===i[0]&&o[1]===i[1]?(I.push(M(f,P(0,T,o),P(0,S,o))),I.push(M(P(0,T,o),P(1,T,o),P(1,S,o),P(0,S,o))),I.push(M(p,P(1,S,o),P(1,T,o)))):(i[0]>0&&i[1]>0&&I.push(M(f,P(0,T,i),P(0,S,i))),(i[0]>0||i[1]>0)&&I.push(M(P(0,S,i),P(0,T,i),P(1,S,o))),o[0]>0&&o[1]>0&&I.push(M(p,P(1,S,o),P(1,T,o))),(o[0]>0||o[1]>0)&&I.push(M(P(1,S,o),P(0,T,i),P(1,T,o))));}return u<Hs&&(I.push(M(f,P(0,0,i),p)),I.push(M(P(0,0,i),P(1,0,o),p)),I.push(M(f,p,P(0,1,i))),I.push(M(P(0,1,i),p,P(1,1,o)))),SH.create(I);};hT.exports=MH;});var dT=G((Nke,fT)=>{var TH=qx(),{isGT:RH}=mr(),NH=r=>{let e={center:[0,0,0],height:2,radius:1,segments:32},{center:t,height:n,radius:i,segments:s}=Object.assign({},e,r);if(!RH(i,0))throw new Error("radius must be greater than zero");return TH({center:t,height:n,startRadius:[i,i],endRadius:[i,i],segments:s});};fT.exports=NH;});var zx=G((Lke,yT)=>{var{TAU:pT}=wt(),$e=Ye(),LH=rt(),mT=gt(),{sin:gT,cos:xT}=Ir(),{isGTE:OH,isNumberArray:bT}=mr(),kH=r=>{let e={center:[0,0,0],radius:[1,1,1],segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]},{center:t,radius:n,segments:i,axes:s}=Object.assign({},e,r);if(!bT(t,3))throw new Error("center must be an array of X, Y and Z values");if(!bT(n,3))throw new Error("radius must be an array of X, Y and Z values");if(!n.every(p=>p>0))throw new Error("radius values must be greater than zero");if(!OH(i,4))throw new Error("segments must be four or more");let o=$e.scale($e.create(),$e.normalize($e.create(),s[0]),n[0]),a=$e.scale($e.create(),$e.normalize($e.create(),s[1]),n[1]),l=$e.scale($e.create(),$e.normalize($e.create(),s[2]),n[2]),u=Math.round(i/4),c,h=[],d=$e.create(),f=$e.create();for(let p=0;p<=i;p++){let m=pT*p/i,g=$e.add($e.create(),$e.scale(d,o,xT(m)),$e.scale(f,a,gT(m)));if(p>0){let b,y;for(let v=0;v<=u;v++){let E=pT/4*v/u,P=xT(E),M=gT(E);if(v>0){let I=[],C;C=$e.subtract($e.create(),$e.scale(d,c,b),$e.scale(f,l,y)),I.push($e.add(C,C,t)),C=$e.subtract($e.create(),$e.scale(d,g,b),$e.scale(f,l,y)),I.push($e.add(C,C,t)),v<u&&(C=$e.subtract($e.create(),$e.scale(d,g,P),$e.scale(f,l,M)),I.push($e.add(C,C,t))),C=$e.subtract($e.create(),$e.scale(d,c,P),$e.scale(f,l,M)),I.push($e.add(C,C,t)),h.push(mT.create(I)),I=[],C=$e.add($e.create(),$e.scale(d,c,b),$e.scale(f,l,y)),I.push($e.add($e.create(),t,C)),C=$e.add(C,$e.scale(d,g,b),$e.scale(f,l,y)),I.push($e.add($e.create(),t,C)),v<u&&(C=$e.add(C,$e.scale(d,g,P),$e.scale(f,l,M)),I.push($e.add($e.create(),t,C))),C=$e.add(C,$e.scale(d,c,P),$e.scale(f,l,M)),I.push($e.add($e.create(),t,C)),I.reverse(),h.push(mT.create(I));}b=P,y=M;}}c=g;}return LH.create(h);};yT.exports=kH;});var Yx=G((Oke,vT)=>{var UH=rt(),DH=gt(),{isNumberArray:wT}=mr(),GH=r=>{let e={points:[],faces:[],colors:void 0,orientation:"outward"},{points:t,faces:n,colors:i,orientation:s}=Object.assign({},e,r);if(!(Array.isArray(t)&&Array.isArray(n)))throw new Error("points and faces must be arrays");if(t.length<3)throw new Error("three or more points are required");if(n.length<1)throw new Error("one or more faces are required");if(i){if(!Array.isArray(i))throw new Error("colors must be an array");if(i.length!==n.length)throw new Error("faces and colors must have the same length");}t.forEach((a,l)=>{if(!wT(a,3))throw new Error(`point ${l} must be an array of X, Y, Z values`);}),n.forEach((a,l)=>{if(a.length<3)throw new Error(`face ${l} must contain 3 or more indexes`);if(!wT(a,a.length))throw new Error(`face ${l} must be an array of numbers`);}),s!=="outward"&&n.forEach(a=>a.reverse());let o=n.map((a,l)=>{let u=DH.create(a.map(c=>t[c]));return i&&i[l]&&(u.color=i[l]),u;});return UH.create(o);};vT.exports=GH;});var ST=G((kke,_T)=>{var ET=Dt(),PT=Ye(),FH=rt(),qH=Yx(),{isGT:zH,isGTE:YH}=mr(),XH=r=>{let e={radius:1,frequency:6},{radius:t,frequency:n}=Object.assign({},e,r);if(!zH(t,0))throw new Error("radius must be greater than zero");if(!YH(n,6))throw new Error("frequency must be six or more");n=Math.floor(n/6);let i=[[.850651,0,-.525731],[.850651,-0,.525731],[-.850651,-0,.525731],[-.850651,0,-.525731],[0,-.525731,.850651],[0,.525731,.850651],[0,.525731,-.850651],[0,-.525731,-.850651],[-.525731,-.850651,-0],[.525731,-.850651,-0],[.525731,.850651,0],[-.525731,.850651,0]],s=[[0,9,1],[1,10,0],[6,7,0],[10,6,0],[7,9,0],[5,1,4],[4,1,9],[5,10,1],[2,8,3],[3,11,2],[2,5,4],[4,8,2],[2,11,5],[3,7,6],[6,11,3],[8,7,3],[9,8,4],[11,10,5],[10,11,6],[8,9,7]],o=(d,f,p)=>{let m=d[0],g=d[1],b=d[2],y=p,v=[],E=[];for(let P=0;P<f;P++)for(let M=0;M<f-P;M++){let I=P/f,C=(P+1)/f,L=M/(f-P),S=(M+1)/(f-P),T=f-P-1?M/(f-P-1):1,B=[];B[0]=a(a(m,g,L),b,I),B[1]=a(a(m,g,S),b,I),B[2]=a(a(m,g,T),b,C);for(let $=0;$<3;$++){let Z=PT.length(B[$]);for(let H=0;H<3;H++)B[$][H]/=Z;}if(v.push(B[0],B[1],B[2]),E.push([y,y+1,y+2]),y+=3,M<f-P-1){let $=f-P-1?(M+1)/(f-P-1):1;B[0]=a(a(m,g,S),b,I),B[1]=a(a(m,g,$),b,C),B[2]=a(a(m,g,T),b,C);for(let Z=0;Z<3;Z++){let H=PT.length(B[Z]);for(let W=0;W<3;W++)B[Z][W]/=H;}v.push(B[0],B[1],B[2]),E.push([y,y+1,y+2]),y+=3;}}return{points:v,triangles:E,offset:y};},a=(d,f,p)=>{let m=1-p,g=[];for(let b=0;b<3;b++)g[b]=d[b]*m+f[b]*p;return g;},l=[],u=[],c=0;for(let d=0;d<s.length;d++){let f=o([i[s[d][0]],i[s[d][1]],i[s[d][2]]],n,c);l=l.concat(f.points),u=u.concat(f.triangles),c=f.offset;}let h=qH({points:l,faces:u,orientation:"inward"});return t!==1&&(h=FH.transform(ET.fromScaling(ET.create(),[t,t,t]),h)),h;};_T.exports=XH;});var IT=G((Uke,BT)=>{var VH=kt(),WH=r=>{if(!Array.isArray(r))throw new Error("points must be an array");return VH.fromPoints({},r);};BT.exports=WH;});var CT=G((Dke,AT)=>{var Xx=tt(),$H=r=>{let e={points:[],paths:[]},{points:t,paths:n}=Object.assign({},e,r);if(!(Array.isArray(t)&&Array.isArray(n)))throw new Error("points and paths must be arrays");let i=t;Array.isArray(t[0])&&(Array.isArray(t[0][0])||(i=[t])),i.forEach((l,u)=>{if(!Array.isArray(l))throw new Error("list of points "+u+" must be an array");if(l.length<3)throw new Error("list of points "+u+" must contain three or more points");l.forEach((c,h)=>{if(!Array.isArray(c))throw new Error("list of points "+u+", point "+h+" must be an array");if(c.length<2)throw new Error("list of points "+u+", point "+h+" must contain by X and Y values");});});let s=n;if(n.length===0){let l=0;s=i.map(u=>u.map(c=>l++));}let o=[];i.forEach(l=>l.forEach(u=>o.push(u)));let a=[];return s.forEach(l=>{let u=l.map(h=>o[h]),c=Xx.fromPoints(u);a=a.concat(Xx.toSides(c));}),Xx.create(a);};AT.exports=$H;});var Vx=G((Gke,TT)=>{var Ks=it(),jH=tt(),{isNumberArray:MT}=mr(),ZH=r=>{let e={center:[0,0],size:[2,2]},{center:t,size:n}=Object.assign({},e,r);if(!MT(t,2))throw new Error("center must be an array of X and Y values");if(!MT(n,2))throw new Error("size must be an array of X and Y values");if(!n.every(a=>a>0))throw new Error("size values must be greater than zero");let i=[n[0]/2,n[1]/2],s=[i[0],-i[1]],o=[Ks.subtract(Ks.create(),t,i),Ks.add(Ks.create(),t,s),Ks.add(Ks.create(),t,i),Ks.subtract(Ks.create(),t,s)];return jH.fromPoints(o);};TT.exports=ZH;});var UT=G((Fke,kT)=>{var{EPS:Wd,TAU:tc}=wt(),Wx=it(),lr=Ye(),HH=rt(),cl=gt(),{sin:KH,cos:QH}=Ir(),{isGT:JH,isGTE:eK,isNumberArray:RT}=mr(),NT=(r,e,t,n,i,s)=>{let o=tc/4*i/n,a=QH(o),l=KH(o),u=n-i,c=t*a,h=e[2]-(t-t*l);s||(h=t-t*l-e[2]),c=c>Wd?c:0;let d=lr.add(lr.create(),r,[e[0]-t,e[1]-t,h]),f=lr.add(lr.create(),r,[t-e[0],e[1]-t,h]),p=lr.add(lr.create(),r,[t-e[0],t-e[1],h]),m=lr.add(lr.create(),r,[e[0]-t,t-e[1],h]),g=[],b=[],y=[],v=[];for(let E=0;E<=u;E++){let P=u>0?tc/4*E/u:0,M=Wx.fromAngleRadians(Wx.create(),P);Wx.scale(M,M,c);let I=lr.fromVec2(lr.create(),M);g.push(lr.add(lr.create(),d,I)),lr.rotateZ(I,I,[0,0,0],tc/4),b.push(lr.add(lr.create(),f,I)),lr.rotateZ(I,I,[0,0,0],tc/4),y.push(lr.add(lr.create(),p,I)),lr.rotateZ(I,I,[0,0,0],tc/4),v.push(lr.add(lr.create(),m,I));}return s?[g,b,y,v]:(g.reverse(),b.reverse(),y.reverse(),v.reverse(),[v,y,b,g]);},LT=(r,e)=>{let t=[];for(let n=0;n<r.length;n++){let i=r[n],s=e[n];for(let o=0;o<i.length-1;o++)t.push(cl.create([i[o],i[o+1],s[o]])),o<s.length-1&&t.push(cl.create([s[o],i[o+1],s[o+1]]));}return t;},OT=(r,e)=>{let t=[];for(let n=0;n<r.length;n++){let i=r[n],s=e[n],o=i[i.length-1],a=s[s.length-1],l=(n+1)%r.length;i=r[l],s=e[l];let u=i[0],c=s[0];t.push(cl.create([o,u,c,a]));}return t;},tK=(r,e)=>{r=[r[3],r[2],r[1],r[0]],r=r.map(s=>s.slice().reverse());let t=[];r.forEach(s=>{s.forEach(o=>t.push(o));});let n=[];e.forEach(s=>{s.forEach(o=>n.push(o));});let i=[];for(let s=0;s<n.length;s++){let o=(s+1)%n.length;i.push(cl.create([t[s],t[o],n[o],n[s]]));}return i;},rK=r=>{let e={center:[0,0,0],size:[2,2,2],roundRadius:.2,segments:32},{center:t,size:n,roundRadius:i,segments:s}=Object.assign({},e,r);if(!RT(t,3))throw new Error("center must be an array of X, Y and Z values");if(!RT(n,3))throw new Error("size must be an array of X, Y and Z values");if(!n.every(u=>u>0))throw new Error("size values must be greater than zero");if(!JH(i,0))throw new Error("roundRadius must be greater than zero");if(!eK(s,4))throw new Error("segments must be four or more");if(n=n.map(u=>u/2),i>n[0]-Wd||i>n[1]-Wd||i>n[2]-Wd)throw new Error("roundRadius must be smaller then the radius of all dimensions");s=Math.floor(s/4);let o=null,a=null,l=[];for(let u=0;u<=s;u++){let c=NT(t,n,i,s,u,!0),h=NT(t,n,i,s,u,!1);if(u===0&&(l=l.concat(tK(h,c))),o&&(l=l.concat(LT(o,c),OT(o,c))),a&&(l=l.concat(LT(a,h),OT(a,h))),u===s){let d=c.map(f=>f[0]);l.push(cl.create(d)),d=h.map(f=>f[0]),l.push(cl.create(d));}o=c,a=h;}return HH.create(l);};kT.exports=rK;});var YT=G((qke,zT)=>{var{EPS:DT,TAU:GT}=wt(),Ne=Ye(),nK=rt(),iK=gt(),{sin:FT,cos:qT}=Ir(),{isGT:$x,isGTE:sK,isNumberArray:oK}=mr(),aK=r=>{let e={center:[0,0,0],height:2,radius:1,roundRadius:.2,segments:32},{center:t,height:n,radius:i,roundRadius:s,segments:o}=Object.assign({},e,r);if(!oK(t,3))throw new Error("center must be an array of X, Y and Z values");if(!$x(n,0))throw new Error("height must be greater then zero");if(!$x(i,0))throw new Error("radius must be greater then zero");if(!$x(s,0))throw new Error("roundRadius must be greater then zero");if(s>i-DT)throw new Error("roundRadius must be smaller then the radius");if(!sK(o,4))throw new Error("segments must be four or more");let a=[0,0,-(n/2)],l=[0,0,n/2],u=Ne.subtract(Ne.create(),l,a),c=Ne.length(u);if(2*s>c-DT)throw new Error("height must be larger than twice roundRadius");let h;Math.abs(u[0])>Math.abs(u[1])?h=Ne.fromValues(0,1,0):h=Ne.fromValues(1,0,0);let d=Ne.scale(Ne.create(),Ne.normalize(Ne.create(),u),s),f=Ne.scale(Ne.create(),Ne.normalize(Ne.create(),Ne.cross(Ne.create(),d,h)),i),p=Ne.scale(Ne.create(),Ne.normalize(Ne.create(),Ne.cross(Ne.create(),f,d)),i);Ne.add(a,a,d),Ne.subtract(l,l,d);let m=Math.floor(.25*o),g=M=>{let I=M.map(C=>Ne.add(C,C,t));return iK.create(I);},b=[],y=Ne.create(),v=Ne.create(),E;for(let M=0;M<=o;M++){let I=GT*M/o,C=Ne.add(Ne.create(),Ne.scale(y,f,qT(I)),Ne.scale(v,p,FT(I)));if(M>0){let L=[];L.push(Ne.add(Ne.create(),a,C)),L.push(Ne.add(Ne.create(),a,E)),L.push(Ne.add(Ne.create(),l,E)),L.push(Ne.add(Ne.create(),l,C)),b.push(g(L));let S,T;for(let B=0;B<=m;B++){let $=GT/4*B/m,Z=qT($),H=FT($);if(B>0){L=[];let W;W=Ne.add(Ne.create(),a,Ne.subtract(y,Ne.scale(y,E,S),Ne.scale(v,d,T))),L.push(W),W=Ne.add(Ne.create(),a,Ne.subtract(y,Ne.scale(y,C,S),Ne.scale(v,d,T))),L.push(W),B<m&&(W=Ne.add(Ne.create(),a,Ne.subtract(y,Ne.scale(y,C,Z),Ne.scale(v,d,H))),L.push(W)),W=Ne.add(Ne.create(),a,Ne.subtract(y,Ne.scale(y,E,Z),Ne.scale(v,d,H))),L.push(W),b.push(g(L)),L=[],W=Ne.add(Ne.create(),Ne.scale(y,E,S),Ne.scale(v,d,T)),Ne.add(W,W,l),L.push(W),W=Ne.add(Ne.create(),Ne.scale(y,C,S),Ne.scale(v,d,T)),Ne.add(W,W,l),L.push(W),B<m&&(W=Ne.add(Ne.create(),Ne.scale(y,C,Z),Ne.scale(v,d,H)),Ne.add(W,W,l),L.push(W)),W=Ne.add(Ne.create(),Ne.scale(y,E,Z),Ne.scale(v,d,H)),Ne.add(W,W,l),L.push(W),L.reverse(),b.push(g(L));}S=Z,T=H;}}E=C;}return nK.create(b);};zT.exports=aK;});var $T=G((zke,WT)=>{var{EPS:XT,TAU:$d}=wt(),Vt=it(),lK=tt(),{isGT:uK,isGTE:cK,isNumberArray:VT}=mr(),hK=r=>{let e={center:[0,0],size:[2,2],roundRadius:.2,segments:32},{center:t,size:n,roundRadius:i,segments:s}=Object.assign({},e,r);if(!VT(t,2))throw new Error("center must be an array of X and Y values");if(!VT(n,2))throw new Error("size must be an array of X and Y values");if(!n.every(m=>m>0))throw new Error("size values must be greater than zero");if(!uK(i,0))throw new Error("roundRadius must be greater than zero");if(!cK(s,4))throw new Error("segments must be four or more");if(n=n.map(m=>m/2),i>n[0]-XT||i>n[1]-XT)throw new Error("roundRadius must be smaller then the radius of all dimensions");let o=Math.floor(s/4),a=Vt.add(Vt.create(),t,[n[0]-i,n[1]-i]),l=Vt.add(Vt.create(),t,[i-n[0],n[1]-i]),u=Vt.add(Vt.create(),t,[i-n[0],i-n[1]]),c=Vt.add(Vt.create(),t,[n[0]-i,i-n[1]]),h=[],d=[],f=[],p=[];for(let m=0;m<=o;m++){let g=$d/4*m/o,b=Vt.fromAngleRadians(Vt.create(),g);Vt.scale(b,b,i),h.push(Vt.add(Vt.create(),a,b)),Vt.rotate(b,b,Vt.create(),$d/4),d.push(Vt.add(Vt.create(),l,b)),Vt.rotate(b,b,Vt.create(),$d/4),f.push(Vt.add(Vt.create(),u,b)),Vt.rotate(b,b,Vt.create(),$d/4),p.push(Vt.add(Vt.create(),c,b));}return lK.fromPoints(h.concat(d,f,p));};WT.exports=hK;});var jx=G((Yke,jT)=>{var fK=zx(),{isGT:dK}=mr(),pK=r=>{let e={center:[0,0,0],radius:1,segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]},{center:t,radius:n,segments:i,axes:s}=Object.assign({},e,r);if(!dK(n,0))throw new Error("radius must be greater than zero");return n=[n,n,n],fK({center:t,radius:n,segments:i,axes:s});};jT.exports=pK;});var HT=G((Xke,ZT)=>{var mK=Vx(),{isGT:gK}=mr(),xK=r=>{let e={center:[0,0],size:2},{center:t,size:n}=Object.assign({},e,r);if(!gK(n,0))throw new Error("size must be greater than zero");return n=[n,n],mK({center:t,size:n});};ZT.exports=xK;});var e5=G((Vke,JT)=>{var{TAU:KT}=wt(),rc=it(),bK=tt(),{isGT:yK,isGTE:jd,isNumberArray:wK}=mr(),vK=(r,e)=>r>0&&e>1&&e<r/2?Math.cos(Math.PI*e/r)/Math.cos(Math.PI*(e-1)/r):0,QT=(r,e,t,n)=>{let i=KT/r,s=[];for(let o=0;o<r;o++){let a=rc.fromAngleRadians(rc.create(),i*o+t);rc.scale(a,a,e),rc.add(a,n,a),s.push(a);}return s;},EK=r=>{let e={center:[0,0],vertices:5,outerRadius:1,innerRadius:0,density:2,startAngle:0},{center:t,vertices:n,outerRadius:i,innerRadius:s,density:o,startAngle:a}=Object.assign({},e,r);if(!wK(t,2))throw new Error("center must be an array of X and Y values");if(!jd(n,2))throw new Error("vertices must be two or more");if(!yK(i,0))throw new Error("outerRadius must be greater than zero");if(!jd(s,0))throw new Error("innerRadius must be greater than zero");if(!jd(a,0))throw new Error("startAngle must be greater than zero");if(n=Math.floor(n),o=Math.floor(o),a=a%KT,s===0){if(!jd(o,2))throw new Error("density must be two or more");s=i*vK(n,o);}let l=rc.clone(t),u=QT(n,i,a,l),c=QT(n,s,a+Math.PI/n,l),h=[];for(let d=0;d<n;d++)h.push(u[d]),h.push(c[d]);return bK.fromPoints(h);};JT.exports=EK;});var hl=G((Wke,o5)=>{var PK=Qe(),t5=Dt(),r5=oi(),n5=tt(),i5=rt(),s5=kt(),Zd=(r,...e)=>{let t={origin:[0,0,0],normal:[0,0,1]},{origin:n,normal:i}=Object.assign({},t,r);if(e=PK(e),e.length===0)throw new Error("wrong number of arguments");let s=r5.fromNormalAndPoint(r5.create(),i,n);if(Number.isNaN(s[0]))throw new Error("the given origin and normal do not define a proper plane");let o=t5.mirrorByPlane(t5.create(),s),a=e.map(l=>s5.isA(l)?s5.transform(o,l):n5.isA(l)?n5.transform(o,l):i5.isA(l)?i5.transform(o,l):l);return a.length===1?a[0]:a;},_K=(...r)=>Zd({normal:[1,0,0]},r),SK=(...r)=>Zd({normal:[0,1,0]},r),BK=(...r)=>Zd({normal:[0,0,1]},r);o5.exports={mirror:Zd,mirrorX:_K,mirrorY:SK,mirrorZ:BK};});var Zx=G(($ke,l5)=>{var a5=oi(),Xo=Ye(),IK=r=>{let e=r.edges;if(e.length<3)throw new Error("slices must have 3 or more edges to calculate a plane");let t=e.reduce((o,a)=>Xo.add(Xo.create(),o,a[0]),Xo.create());Xo.scale(t,t,1/e.length);let n,i=0;e.forEach(o=>{if(!Xo.equals(o[0],o[1])){let a=Xo.squaredDistance(t,o[0]);a>i&&(n=o,i=a);}});let s=e.find(o=>Xo.equals(o[1],n[0]));return a5.fromPoints(a5.create(),s[0],n[0],n[1]);};l5.exports=IK;});var Qs=G((jke,u5)=>{var AK=r=>(r||(r=[]),{edges:r});u5.exports=AK;});var f5=G((Zke,h5)=>{var CK=Qs(),c5=Ye(),MK=(...r)=>{let e,t;return r.length===1?(e=CK(),t=r[0]):(e=r[0],t=r[1]),e.edges=t.edges.map(n=>[c5.clone(n[0]),c5.clone(n[1])]),e;};h5.exports=MK;});var p5=G((Hke,d5)=>{var TK=Ye(),RK=(r,e)=>{let t=r.edges,n=e.edges;return t.length!==n.length?!1:t.reduce((s,o,a)=>{let l=n[a],u=TK.squaredDistance(o[0],l[0]);return s&&u<Number.EPSILON;},!0);};d5.exports=RK;});var g5=G((Kke,m5)=>{var Hd=Ye(),NK=Qs(),LK=r=>{if(!Array.isArray(r))throw new Error("the given points must be an array");if(r.length<3)throw new Error("the given points must contain THREE or more points");let e=[],t=r[r.length-1];return r.forEach(n=>{n.length===2&&e.push([Hd.fromVec2(Hd.create(),t),Hd.fromVec2(Hd.create(),n)]),n.length===3&&e.push([t,n]),t=n;}),NK(e);};m5.exports=LK;});var b5=G((Qke,x5)=>{var Kd=Ye(),OK=Qs(),kK=r=>{if(!Array.isArray(r))throw new Error("the given sides must be an array");let e=[];return r.forEach(t=>{e.push([Kd.fromVec2(Kd.create(),t[0]),Kd.fromVec2(Kd.create(),t[1])]);}),OK(e);};x5.exports=kK;});var w5=G((Jke,y5)=>{var UK=r=>!!(r&&typeof r=="object"&&"edges"in r&&Array.isArray(r.edges));y5.exports=UK;});var E5=G((eUe,v5)=>{var DK=Qs(),GK=(...r)=>{let e,t;return r.length===1?(e=DK(),t=r[0]):(e=r[0],t=r[1]),e.edges=t.edges.map(n=>[n[1],n[0]]),e;};v5.exports=GK;});var _5=G((tUe,P5)=>{var FK=r=>r.edges;P5.exports=FK;});var B5=G((rUe,S5)=>{var qK=(r,e)=>{let t,n,i,s,o,a=1;do{n=r,r=null;let l=null;for(o=0;n;){o++,i=n;let u=0;for(t=0;t<a&&(u++,i=i.nextZ,!!i);t++);let c=a;for(;u>0||c>0&&i;)u!==0&&(c===0||!i||e(n)<=e(i))?(s=n,n=n.nextZ,u--):(s=i,i=i.nextZ,c--),l?l.nextZ=s:r=s,s.prevZ=l,l=s;n=i;}l.nextZ=null,a*=2;}while(o>1);return r;};S5.exports=qK;});var Hx=G((nUe,I5)=>{var zK=B5(),Qd=class{constructor(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1;}},YK=(r,e,t,n)=>{let i=new Qd(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i;},XK=r=>{r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ);};I5.exports={Node:Qd,insertNode:YK,removeNode:XK,sortLinked:zK};});var Jd=G((iUe,A5)=>{var VK=(r,e,t,n,i,s,o,a)=>(i-o)*(e-a)-(r-o)*(s-a)>=0&&(r-o)*(n-a)-(t-o)*(e-a)>=0&&(t-o)*(s-a)-(i-o)*(n-a)>=0,WK=(r,e,t)=>(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y);A5.exports={area:WK,pointInTriangle:VK};});var Kx=G((sUe,N5)=>{var{Node:C5,insertNode:M5,removeNode:ep}=Hx(),{area:un}=Jd(),$K=(r,e,t,n,i)=>{let s;if(i===JK(r,e,t,n)>0)for(let o=e;o<t;o+=n)s=M5(o,r[o],r[o+1],s);else for(let o=t-n;o>=e;o-=n)s=M5(o,r[o],r[o+1],s);return s&&rp(s,s.next)&&(ep(s),s=s.next),s;},T5=(r,e)=>{if(!r)return r;e||(e=r);let t=r,n;do if(n=!1,!t.steiner&&(rp(t,t.next)||un(t.prev,t,t.next)===0)){if(ep(t),t=e=t.prev,t===t.next)break;n=!0;}else t=t.next;while(n||t!==e);return e;},jK=(r,e,t)=>{let n=r;do{let i=n.prev,s=n.next.next;!rp(i,s)&&R5(i,n,n.next,s)&&nc(i,s)&&nc(s,i)&&(e.push(i.i/t),e.push(n.i/t),e.push(s.i/t),ep(n),ep(n.next),n=r=s),n=n.next;}while(n!==r);return T5(n);},ZK=(r,e)=>{let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&R5(t,t.next,r,e))return!0;t=t.next;}while(t!==r);return!1;},nc=(r,e)=>un(r.prev,r,r.next)<0?un(r,e,r.next)>=0&&un(r,r.prev,e)>=0:un(r,e,r.prev)<0||un(r,r.next,e)<0,HK=(r,e)=>{let t=r,n=!1,i=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n;},KK=(r,e)=>{let t=new C5(r.i,r.x,r.y),n=new C5(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n;},QK=(r,e)=>r.next.i!==e.i&&r.prev.i!==e.i&&!ZK(r,e)&&(nc(r,e)&&nc(e,r)&&HK(r,e)&&(un(r.prev,r,e.prev)||un(r,e.prev,e))||rp(r,e)&&un(r.prev,r,r.next)>0&&un(e.prev,e,e.next)>0),R5=(r,e,t,n)=>{let i=Math.sign(un(r,e,t)),s=Math.sign(un(r,e,n)),o=Math.sign(un(t,n,r)),a=Math.sign(un(t,n,e));return!!(i!==s&&o!==a||i===0&&tp(r,t,e)||s===0&&tp(r,n,e)||o===0&&tp(t,r,n)||a===0&&tp(t,e,n));},tp=(r,e,t)=>e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y),JK=(r,e,t,n)=>{let i=0;for(let s=e,o=t-n;s<t;s+=n)i+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return i;},rp=(r,e)=>r.x===e.x&&r.y===e.y;N5.exports={cureLocalIntersections:jK,filterPoints:T5,isValidDiagonal:QK,linkedPolygon:$K,locallyInside:nc,splitPolygon:KK};});var k5=G((oUe,O5)=>{var{filterPoints:Qx,linkedPolygon:eQ,locallyInside:tQ,splitPolygon:rQ}=Kx(),{area:L5,pointInTriangle:nQ}=Jd(),iQ=(r,e,t,n)=>{let i=[];for(let s=0,o=e.length;s<o;s++){let a=e[s]*n,l=s<o-1?e[s+1]*n:r.length,u=eQ(r,a,l,n,!1);u===u.next&&(u.steiner=!0),i.push(lQ(u));}i.sort((s,o)=>s.x-o.x);for(let s=0;s<i.length;s++)t=sQ(i[s],t),t=Qx(t,t.next);return t;},sQ=(r,e)=>{let t=oQ(r,e);if(!t)return e;let n=rQ(t,r),i=Qx(t,t.next);return Qx(n,n.next),e===t?i:e;},oQ=(r,e)=>{let t=e,n=r.x,i=r.y,s=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){let h=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=n&&h>s){if(s=h,h===n){if(i===t.y)return t;if(i===t.next.y)return t.next;}o=t.x<t.next.x?t:t.next;}}t=t.next;}while(t!==e);if(!o)return null;if(n===s)return o;let a=o,l=o.x,u=o.y,c=1/0;t=o;do{if(n>=t.x&&t.x>=l&&n!==t.x&&nQ(i<u?n:s,i,l,u,i<u?s:n,i,t.x,t.y)){let h=Math.abs(i-t.y)/(n-t.x);tQ(t,r)&&(h<c||h===c&&(t.x>o.x||t.x===o.x&&aQ(o,t)))&&(o=t,c=h);}t=t.next;}while(t!==a);return o;},aQ=(r,e)=>L5(r.prev,r,e.prev)<0&&L5(e.next,r,r.next)<0,lQ=r=>{let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t;};O5.exports=iQ;});var D5=G((aUe,U5)=>{var uQ=k5(),{removeNode:cQ,sortLinked:hQ}=Hx(),{cureLocalIntersections:fQ,filterPoints:np,isValidDiagonal:dQ,linkedPolygon:pQ,splitPolygon:mQ}=Kx(),{area:Vo,pointInTriangle:ic}=Jd(),gQ=(r,e,t=2)=>{let n=e&&e.length,i=n?e[0]*t:r.length,s=pQ(r,0,i,t,!0),o=[];if(!s||s.next===s.prev)return o;let a,l,u,c,h;if(n&&(s=uQ(r,e,s,t)),r.length>80*t){a=u=r[0],l=c=r[1];for(let d=t;d<i;d+=t){let f=r[d],p=r[d+1];f<a&&(a=f),p<l&&(l=p),f>u&&(u=f),p>c&&(c=p);}h=Math.max(u-a,c-l),h=h!==0?1/h:0;}return sc(s,o,t,a,l,h),o;},sc=(r,e,t,n,i,s,o)=>{if(!r)return;!o&&s&&wQ(r,n,i,s);let a=r,l,u;for(;r.prev!==r.next;){if(l=r.prev,u=r.next,s?bQ(r,n,i,s):xQ(r)){e.push(l.i/t),e.push(r.i/t),e.push(u.i/t),cQ(r),r=u.next,a=u.next;continue;}if(r=u,r===a){o?o===1?(r=fQ(np(r),e,t),sc(r,e,t,n,i,s,2)):o===2&&yQ(r,e,t,n,i,s):sc(np(r),e,t,n,i,s,1);break;}}},xQ=r=>{let e=r.prev,t=r,n=r.next;if(Vo(e,t,n)>=0)return!1;let i=r.next.next;for(;i!==r.prev;){if(ic(e.x,e.y,t.x,t.y,n.x,n.y,i.x,i.y)&&Vo(i.prev,i,i.next)>=0)return!1;i=i.next;}return!0;},bQ=(r,e,t,n)=>{let i=r.prev,s=r,o=r.next;if(Vo(i,s,o)>=0)return!1;let a=i.x<s.x?i.x<o.x?i.x:o.x:s.x<o.x?s.x:o.x,l=i.y<s.y?i.y<o.y?i.y:o.y:s.y<o.y?s.y:o.y,u=i.x>s.x?i.x>o.x?i.x:o.x:s.x>o.x?s.x:o.x,c=i.y>s.y?i.y>o.y?i.y:o.y:s.y>o.y?s.y:o.y,h=Jx(a,l,e,t,n),d=Jx(u,c,e,t,n),f=r.prevZ,p=r.nextZ;for(;f&&f.z>=h&&p&&p.z<=d;){if(f!==r.prev&&f!==r.next&&ic(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Vo(f.prev,f,f.next)>=0||(f=f.prevZ,p!==r.prev&&p!==r.next&&ic(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Vo(p.prev,p,p.next)>=0))return!1;p=p.nextZ;}for(;f&&f.z>=h;){if(f!==r.prev&&f!==r.next&&ic(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Vo(f.prev,f,f.next)>=0)return!1;f=f.prevZ;}for(;p&&p.z<=d;){if(p!==r.prev&&p!==r.next&&ic(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Vo(p.prev,p,p.next)>=0)return!1;p=p.nextZ;}return!0;},yQ=(r,e,t,n,i,s)=>{let o=r;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&dQ(o,a)){let l=mQ(o,a);o=np(o,o.next),l=np(l,l.next),sc(o,e,t,n,i,s),sc(l,e,t,n,i,s);return;}a=a.next;}o=o.next;}while(o!==r);},wQ=(r,e,t,n)=>{let i=r;do i.z===null&&(i.z=Jx(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,hQ(i,s=>s.z);},Jx=(r,e,t,n,i)=>(r=32767*(r-t)*i,e=32767*(e-n)*i,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1);U5.exports=gQ;});var F5=G((lUe,G5)=>{var{area:vQ}=nl(),{toOutlines:EQ}=tt(),{arePointsInside:PQ}=Ud(),_Q=r=>{let e=EQ(r),t=[],n=[];e.forEach((o,a)=>{let l=vQ(o);l<0?n.push(a):l>0&&t.push(a);});let i=[],s=[];return t.forEach((o,a)=>{let l=e[o];i[a]=[],n.forEach((u,c)=>{let h=e[u];PQ([h[0]],{vertices:l})&&(i[a].push(u),s[c]||(s[c]=[]),s[c].push(a));});}),n.forEach((o,a)=>{if(s[a]&&s[a].length>1){let l=SQ(s[a],u=>i[u].length);s[a].forEach((u,c)=>{c!==l&&(i[u]=i[u].filter(h=>h!==o));});}}),i.map((o,a)=>({solid:e[t[a]],holes:o.map(l=>e[l])}));},SQ=(r,e)=>{let t,n;return r.forEach((i,s)=>{let o=e(i);(n===void 0||o<n)&&(t=s,n=o);}),t;};G5.exports=_Q;});var Y5=G((uUe,z5)=>{var BQ=tt(),q5=oi(),IQ=it(),Tr=Ye(),AQ=Zx(),CQ=F5(),e1=class{constructor(e){this.plane=AQ(e);let t=Tr.orthogonal(Tr.create(),this.plane),n=Tr.cross(Tr.create(),this.plane,t);this.v=Tr.normalize(n,n),this.u=Tr.cross(Tr.create(),this.v,this.plane),this.basisMap=new Map();let i=e.edges.map(o=>o.map(a=>this.to2D(a))),s=BQ.create(i);this.roots=CQ(s);}to2D(e){let t=IQ.fromValues(Tr.dot(e,this.u),Tr.dot(e,this.v));return this.basisMap.set(t,e),t;}to3D(e){let t=this.basisMap.get(e);if(t)return t;{console.log("Warning: point not in original slice");let n=Tr.scale(Tr.create(),this.u,e[0]),i=Tr.scale(Tr.create(),this.v,e[1]),s=Tr.scale(Tr.create(),q5,q5[3]),o=Tr.add(n,n,s);return Tr.add(i,i,o);}}};z5.exports=e1;});var V5=G((cUe,X5)=>{var MQ=gt(),TQ=D5(),RQ=Y5(),NQ=r=>{let e=new RQ(r),t=[];return e.roots.forEach(({solid:n,holes:i})=>{let s=n.length,o=[];i.forEach((h,d)=>{o.push(s),s+=h.length;});let a=[n,...i].flat(),l=a.flat(),u=h=>e.to3D(a[h]),c=TQ(l,o);for(let h=0;h<c.length;h+=3){let d=c.slice(h,h+3).map(u);t.push(MQ.fromPointsAndPlane(d,e.plane));}}),t;};X5.exports=NQ;});var j5=G((hUe,$5)=>{var W5=Ye(),LQ=r=>r.reduce((e,t)=>e+=`[${W5.toString(t[0])}, ${W5.toString(t[1])}], `,""),OQ=r=>`[${LQ(r.edges)}]`;$5.exports=OQ;});var H5=G((fUe,Z5)=>{var ip=Ye(),kQ=Qs(),UQ=(r,e)=>{let t=e.edges.map(n=>[ip.transform(ip.create(),n[0],r),ip.transform(ip.create(),n[1],r)]);return kQ(t);};Z5.exports=UQ;});var fl=G((dUe,K5)=>{K5.exports={calculatePlane:Zx(),clone:f5(),create:Qs(),equals:p5(),fromPoints:g5(),fromSides:b5(),isA:w5(),reverse:E5(),toEdges:_5(),toPolygons:V5(),toString:j5(),transform:H5()};});var eR=G((pUe,J5)=>{var Q5=Ye(),DQ=Qs(),GQ=r=>{if(!r.edges)return r;let e=r.edges,t=new Map(),n=new Map();e=e.filter(o=>!Q5.equals(o[0],o[1])),e.forEach(o=>{let a=o[0].toString(),l=o[1].toString();t.set(a,o[0]),t.set(l,o[1]),n.set(a,(n.get(a)||0)+1),n.set(l,(n.get(l)||0)-1);});let i=[],s=[];return n.forEach((o,a)=>{o<0&&i.push(a),o>0&&s.push(a);}),i.forEach(o=>{let a=t.get(o),l=1/0,u;s.forEach(c=>{let h=t.get(c),d=Q5.distance(a,h);d<l&&(l=d,u=h);}),console.warn(`slice.repair: repairing vertex gap ${a} to ${u} distance ${l}`),e=e.map(c=>c[0].toString()===o?[u,c[1]]:c[1].toString()===o?[c[0],u]:c);}),DQ(e);};J5.exports=GQ;});var oR=G((mUe,sR)=>{var{EPS:tR}=wt(),dl=Ye(),sp=gt(),rR=fl(),t1=(r,e)=>r===e?r:r<e?t1(e,r):e===1?1:e===0?r:t1(e,r%e),FQ=(r,e)=>r*e/t1(r,e),nR=(r,e)=>{let t=r/e.length;if(t===1)return e;let n=dl.fromValues(t,t,t),i=[];return e.forEach(s=>{let o=dl.subtract(dl.create(),s[1],s[0]);dl.divide(o,o,n);let a=s[0];for(let l=1;l<=t;++l){let u=dl.add(dl.create(),a,o);i.push([a,u]),a=u;}}),i;},iR=tR*tR/2*Math.sin(Math.PI/3),qQ=(r,e)=>{let t=rR.toEdges(r),n=rR.toEdges(e);if(t.length!==n.length){let s=FQ(t.length,n.length);s!==t.length&&(t=nR(s,t)),s!==n.length&&(n=nR(s,n));}let i=[];return t.forEach((s,o)=>{let a=n[o],l=sp.create([s[0],s[1],a[1]]),u=sp.measureArea(l);Number.isFinite(u)&&u>iR&&i.push(l);let c=sp.create([s[0],a[1],a[0]]),h=sp.measureArea(c);Number.isFinite(h)&&h>iR&&i.push(c);}),i;};sR.exports=qQ;});var op=G((gUe,cR)=>{var aR=Dt(),lR=tt(),zQ=rt(),r1=gt(),Js=fl(),YQ=eR(),uR=oR(),XQ=(r,e,t)=>{let n=null;return lR.isA(t)&&(n=Js.fromSides(lR.toSides(t))),r1.isA(t)&&(n=Js.fromPoints(r1.toPoints(t))),r===0||r===1?Js.transform(aR.fromTranslation(aR.create(),[0,0,r]),n):null;},VQ=(r,e)=>{let t={numberOfSlices:2,capStart:!0,capEnd:!0,close:!1,repair:!0,callback:XQ},{numberOfSlices:n,capStart:i,capEnd:s,close:o,repair:a,callback:l}=Object.assign({},t,r);if(n<2)throw new Error("numberOfSlices must be 2 or more");a&&(e=YQ(e));let u=n-1,c=null,h=null,d=null,f=[];for(let p=0;p<n;p++){let m=l(p/u,p,e);if(m){if(!Js.isA(m))throw new Error("the callback function must return slice objects");if(Js.toEdges(m).length===0)throw new Error("the callback function must return slices with one or more edges");d&&(f=f.concat(uR(d,m))),p===0&&(c=m),p===n-1&&(h=m),d=m;}}if(s){let p=Js.toPolygons(h);f=f.concat(p);}if(i){let p=Js.toPolygons(c).map(r1.invert);f=f.concat(p);}return!i&&!s&&o&&!Js.equals(h,c)&&(f=f.concat(uR(h,c))),zQ.create(f);};cR.exports=VQ;});var i1=G((xUe,hR)=>{var{TAU:Pn}=wt(),oc=Dt(),{mirrorX:WQ}=hl(),ac=tt(),n1=fl(),$Q=op(),jQ=(r,e)=>{let t={segments:12,startAngle:0,angle:Pn,overflow:"cap"},{segments:n,startAngle:i,angle:s,overflow:o}=Object.assign({},t,r);if(n<3)throw new Error("segments must be greater then 3");i=Math.abs(i)>Pn?i%Pn:i,s=Math.abs(s)>Pn?s%Pn:s;let a=i+s;if(a=Math.abs(a)>Pn?a%Pn:a,a<i){let y=i;i=a,a=y;}let l=a-i;if(l<=0&&(l=Pn),Math.abs(l)<Pn){let y=Pn/n;n=Math.floor(Math.abs(l)/y),Math.abs(l)>n*y&&n++;}let u=ac.toSides(e);if(u.length===0)throw new Error("the given geometry cannot be empty");let c=u.filter(y=>y[0][0]<0),h=u.filter(y=>y[0][0]>=0);c.length>0&&h.length>0&&o==="cap"&&(c.length>h.length?(u=u.map(y=>{let v=y[0],E=y[1];return v=[Math.min(v[0],0),v[1]],E=[Math.min(E[0],0),E[1]],[v,E];}),e=ac.reverse(ac.create(u)),e=WQ(e)):h.length>=c.length&&(u=u.map(y=>{let v=y[0],E=y[1];return v=[Math.max(v[0],0),v[1]],E=[Math.max(E[0],0),E[1]],[v,E];}),e=ac.create(u)));let f=l/n,p=Math.abs(l)<Pn,m=n1.fromSides(ac.toSides(e));n1.reverse(m,m);let g=oc.create(),b=(y,v,E)=>{let P=f*v+i;return l===Pn&&v===n&&(P=i),oc.multiply(g,oc.fromZRotation(g,P),oc.fromXRotation(oc.create(),Pn/4)),n1.transform(g,E);};return r={numberOfSlices:n+1,capStart:p,capEnd:p,close:!p,callback:b},$Q(r,m);};hR.exports=jQ;});var pl=G((bUe,gR)=>{var ZQ=Qe(),fR=Dt(),dR=tt(),pR=rt(),mR=kt(),ap=(r,...e)=>{if(!Array.isArray(r))throw new Error("angles must be an array");if(e=ZQ(e),e.length===0)throw new Error("wrong number of arguments");for(r=r.slice();r.length<3;)r.push(0);let t=r[2],n=r[1],i=r[0],s=fR.fromTaitBryanRotation(fR.create(),t,n,i),o=e.map(a=>mR.isA(a)?mR.transform(s,a):dR.isA(a)?dR.transform(s,a):pR.isA(a)?pR.transform(s,a):a);return o.length===1?o[0]:o;},HQ=(r,...e)=>ap([r,0,0],e),KQ=(r,...e)=>ap([0,r,0],e),QQ=(r,...e)=>ap([0,0,r],e);gR.exports={rotate:ap,rotateX:HQ,rotateY:KQ,rotateZ:QQ};});var eo=G((yUe,vR)=>{var JQ=Qe(),xR=Dt(),bR=tt(),yR=rt(),wR=kt(),lp=(r,...e)=>{if(!Array.isArray(r))throw new Error("offset must be an array");if(e=JQ(e),e.length===0)throw new Error("wrong number of arguments");for(r=r.slice();r.length<3;)r.push(0);let t=xR.fromTranslation(xR.create(),r),n=e.map(i=>wR.isA(i)?wR.transform(t,i):bR.isA(i)?bR.transform(t,i):yR.isA(i)?yR.transform(t,i):i);return n.length===1?n[0]:n;},eJ=(r,...e)=>lp([r,0,0],e),tJ=(r,...e)=>lp([0,r,0],e),rJ=(r,...e)=>lp([0,0,r],e);vR.exports={translate:lp,translateX:eJ,translateY:tJ,translateZ:rJ};});var PR=G((wUe,ER)=>{var{TAU:nJ}=wt(),iJ=i1(),{rotate:sJ}=pl(),{translate:oJ}=eo(),aJ=Ux(),{isGT:s1,isGTE:o1}=mr(),lJ=r=>{let e={innerRadius:1,innerSegments:32,outerRadius:4,outerSegments:32,innerRotation:0,startAngle:0,outerRotation:nJ},{innerRadius:t,innerSegments:n,outerRadius:i,outerSegments:s,innerRotation:o,startAngle:a,outerRotation:l}=Object.assign({},e,r);if(!s1(t,0))throw new Error("innerRadius must be greater than zero");if(!o1(n,3))throw new Error("innerSegments must be three or more");if(!s1(i,0))throw new Error("outerRadius must be greater than zero");if(!o1(s,3))throw new Error("outerSegments must be three or more");if(!o1(a,0))throw new Error("startAngle must be positive");if(!s1(l,0))throw new Error("outerRotation must be greater than zero");if(t>=i)throw new Error("inner circle is two large to rotate about the outer circle");let u=aJ({radius:t,segments:n});return o!==0&&(u=sJ([0,0,o],u)),u=oJ([i,0],u),iJ({startAngle:a,angle:l,segments:s},u);};ER.exports=lJ;});var SR=G((vUe,_R)=>{var{NEPS:ml}=wt(),lc=it(),uJ=tt(),{isNumberArray:cJ}=mr(),a1=(r,e,t)=>Math.acos((r*r+e*e-t*t)/(2*r*e)),hJ=(r,e,t)=>e>ml?Math.sqrt(r*r+t*t-2*r*t*Math.cos(e)):Math.sqrt((r-t)*(r-t)+r*t*e*e*(1-e*e/12)),fJ=r=>{if(Math.abs(r[0]+r[1]+r[2]-Math.PI)>ml)throw new Error("AAA triangles require angles that sum to PI");let t=r[0],n=r[1],i=Math.PI-t-n,s=1,o=s/Math.sin(i)*Math.sin(t),a=s/Math.sin(i)*Math.sin(n);return gl(t,n,i,o,a,s);},dJ=r=>{let e=r[0],t=r[1],n=Math.PI+ml-e-t;if(n<ml)throw new Error("AAS triangles require angles that sum to PI");let i=r[2],s=i/Math.sin(e)*Math.sin(t),o=i/Math.sin(e)*Math.sin(n);return gl(e,t,n,i,s,o);},pJ=r=>{let e=r[0],t=r[2],n=Math.PI+ml-e-t;if(n<ml)throw new Error("ASA triangles require angles that sum to PI");let i=r[1],s=i/Math.sin(n)*Math.sin(e),o=i/Math.sin(n)*Math.sin(t);return gl(e,t,n,s,o,i);},mJ=r=>{let e=r[0],t=r[1],n=r[2],i=hJ(e,t,n),s=a1(i,e,n),o=Math.PI-s-t;return gl(s,t,o,n,i,e);},gJ=r=>{let e=r[0],t=r[1],n=r[2],i=Math.asin(t*Math.sin(n)/e),s=Math.PI-i-n,o=e/Math.sin(n)*Math.sin(s);return gl(i,s,n,t,o,e);},xJ=r=>{let e=r[1],t=r[2],n=r[0];if(e+t<=n||t+n<=e||n+e<=t)throw new Error("SSS triangle is incorrect, as the longest side is longer than the sum of the other sides");let i=a1(t,n,e),s=a1(n,e,t),o=Math.PI-i-s;return gl(i,s,o,e,t,n);},gl=(r,e,t,n,i,s)=>{let o=lc.fromValues(0,0),a=lc.fromValues(s,0),l=lc.fromValues(n,0);return lc.add(l,lc.rotate(l,l,[0,0],Math.PI-e),a),uJ.fromPoints([o,a,l]);},bJ=r=>{let e={type:"SSS",values:[1,1,1]},{type:t,values:n}=Object.assign({},e,r);if(typeof t!="string")throw new Error("triangle type must be a string");if(t=t.toUpperCase(),!((t[0]==="A"||t[0]==="S")&&(t[1]==="A"||t[1]==="S")&&(t[2]==="A"||t[2]==="S")))throw new Error("triangle type must contain three letters; A or S");if(!cJ(n,3))throw new Error("triangle values must contain three values");if(!n.every(i=>i>0))throw new Error("triangle values must be greater than zero");switch(t){case"AAA":return fJ(n);case"AAS":return dJ(n);case"ASA":return pJ(n);case"SAS":return mJ(n);case"SSA":return gJ(n);case"SSS":return xJ(n);default:throw new Error("invalid triangle type, try again");}};_R.exports=bJ;});var IR=G((EUe,BR)=>{BR.exports={arc:tT(),circle:Ux(),cube:uT(),cuboid:Dx(),cylinder:dT(),cylinderElliptic:qx(),ellipse:kx(),ellipsoid:zx(),geodesicSphere:ST(),line:IT(),polygon:CT(),polyhedron:Yx(),rectangle:Vx(),roundedCuboid:UT(),roundedCylinder:YT(),roundedRectangle:$T(),sphere:jx(),square:HT(),star:e5(),torus:PR(),triangle:SR()};});var CR=G((PUe,AR)=>{AR.exports={height:14,32:[16],33:[10,5,21,5,7,void 0,5,2,4,1,5,0,6,1,5,2],34:[16,4,21,4,14,void 0,12,21,12,14],35:[21,11,25,4,-7,void 0,17,25,10,-7,void 0,4,12,18,12,void 0,3,6,17,6],36:[20,8,25,8,-4,void 0,12,25,12,-4,void 0,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],37:[24,21,21,3,0,void 0,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,void 0,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7],38:[26,23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2],39:[10,5,19,4,20,5,21,6,20,6,18,5,16,4,15],40:[14,11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7],41:[14,3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7],42:[16,8,21,8,9,void 0,3,18,13,12,void 0,13,18,3,12],43:[26,13,18,13,0,void 0,4,9,22,9],44:[10,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],45:[26,4,9,22,9],46:[10,5,2,4,1,5,0,6,1,5,2],47:[22,20,25,2,-7],48:[20,9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21],49:[20,6,17,8,18,11,21,11,0],50:[20,4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0],51:[20,5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],52:[20,13,21,3,7,18,7,void 0,13,21,13,0],53:[20,15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],54:[20,16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7],55:[20,17,21,7,0,void 0,3,21,17,21],56:[20,8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21],57:[20,16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3],58:[10,5,14,4,13,5,12,6,13,5,14,void 0,5,2,4,1,5,0,6,1,5,2],59:[10,5,14,4,13,5,12,6,13,5,14,void 0,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],60:[24,20,18,4,9,20,0],61:[26,4,12,22,12,void 0,4,6,22,6],62:[24,4,18,20,9,4,0],63:[18,3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,void 0,9,2,8,1,9,0,10,1,9,2],64:[27,18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,void 0,12,16,10,14,9,11,9,8,10,6,11,5,void 0,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,void 0,19,16,18,8,18,6,19,5],65:[18,9,21,1,0,void 0,9,21,17,0,void 0,4,7,14,7],66:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,void 0,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0],67:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5],68:[21,4,21,4,0,void 0,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0],69:[19,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11,void 0,4,0,17,0],70:[18,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11],71:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,void 0,13,8,18,8],72:[22,4,21,4,0,void 0,18,21,18,0,void 0,4,11,18,11],73:[8,4,21,4,0],74:[16,12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7],75:[21,4,21,4,0,void 0,18,21,4,7,void 0,9,12,18,0],76:[17,4,21,4,0,void 0,4,0,16,0],77:[24,4,21,4,0,void 0,4,21,12,0,void 0,20,21,12,0,void 0,20,21,20,0],78:[22,4,21,4,0,void 0,4,21,18,0,void 0,18,21,18,0],79:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21],80:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10],81:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,void 0,12,4,18,-2],82:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,void 0,11,11,18,0],83:[20,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],84:[16,8,21,8,0,void 0,1,21,15,21],85:[22,4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21],86:[18,1,21,9,0,void 0,17,21,9,0],87:[24,2,21,7,0,void 0,12,21,7,0,void 0,12,21,17,0,void 0,22,21,17,0],88:[20,3,21,17,0,void 0,17,21,3,0],89:[18,1,21,9,11,9,0,void 0,17,21,9,11],90:[20,17,21,3,0,void 0,3,21,17,21,void 0,3,0,17,0],91:[14,4,25,4,-7,void 0,5,25,5,-7,void 0,4,25,11,25,void 0,4,-7,11,-7],92:[14,0,21,14,-3],93:[14,9,25,9,-7,void 0,10,25,10,-7,void 0,3,25,10,25,void 0,3,-7,10,-7],94:[16,6,15,8,18,10,15,void 0,3,12,8,17,13,12,void 0,8,17,8,0],95:[16,0,-2,16,-2],96:[10,6,21,5,20,4,18,4,16,5,15,6,16,5,17],97:[19,15,14,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],98:[19,4,21,4,0,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],99:[18,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],100:[19,15,21,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],101:[18,3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],102:[12,10,21,8,21,6,20,5,17,5,0,void 0,2,14,9,14],103:[19,15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],104:[19,4,21,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],105:[8,3,21,4,20,5,21,4,22,3,21,void 0,4,14,4,0],106:[10,5,21,6,20,7,21,6,22,5,21,void 0,6,14,6,-3,5,-6,3,-7,1,-7],107:[17,4,21,4,0,void 0,14,14,4,4,void 0,8,8,15,0],108:[8,4,21,4,0],109:[30,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0,void 0,15,10,18,13,20,14,23,14,25,13,26,10,26,0],110:[19,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],111:[19,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14],112:[19,4,14,4,-7,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],113:[19,15,14,15,-7,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],114:[13,4,14,4,0,void 0,4,8,5,11,7,13,9,14,12,14],115:[17,14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3],116:[12,5,21,5,4,6,1,8,0,10,0,void 0,2,14,9,14],117:[19,4,14,4,4,5,1,7,0,10,0,12,1,15,4,void 0,15,14,15,0],118:[16,2,14,8,0,void 0,14,14,8,0],119:[22,3,14,7,0,void 0,11,14,7,0,void 0,11,14,15,0,void 0,19,14,15,0],120:[17,3,14,14,0,void 0,14,14,3,0],121:[16,2,14,8,0,void 0,14,14,8,0,6,-4,4,-6,2,-7,1,-7],122:[17,14,14,3,0,void 0,3,14,14,14,void 0,3,0,14,0],123:[14,9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,void 0,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,void 0,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7],124:[8,4,25,4,-7],125:[14,5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,void 0,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,void 0,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7],126:[24,3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,void 0,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]};});var l1=G((_Ue,MR)=>{var yJ=CR(),wJ={xOffset:0,yOffset:0,input:"?",align:"left",font:yJ,height:14,lineSpacing:2.142857142857143,letterSpacing:1,extrudeOffset:0},vJ=(r,e)=>{!e&&typeof r=="string"&&(r={input:r}),r=r||{};let t=Object.assign({},wJ,r);return t.input=e||t.input,t;};MR.exports=vJ;});var u1=G((SUe,TR)=>{var EJ=l1(),PJ=(r,e)=>{let{xOffset:t,yOffset:n,input:i,font:s,height:o,extrudeOffset:a}=EJ(r,e),l=i.charCodeAt(0);(!l||!s[l])&&(l=63);let u=[].concat(s[l]),c=(o-a)/s.height,h=a/2,d=u.shift()*c,f=[],p=[];for(let m=0,g=u.length;m<g;m+=2){let b=c*u[m]+t,y=c*u[m+1]+n+h;if(u[m]!==void 0){p.push([b,y]);continue;}f.push(p),p=[],m--;}return p.length&&f.push(p),{width:d,height:o,segments:f};};TR.exports=PJ;});var LR=G((BUe,NR)=>{var _J=u1(),SJ=l1(),RR=(r,e)=>{let{x:t,y:n}=Object.assign({x:0,y:0},r||{}),i=e.segments,s=null,o=null;for(let a=0,l=i.length;a<l;a++){s=i[a];for(let u=0,c=s.length;u<c;u++)o=s[u],s[u]=[o[0]+t,o[1]+n];}return e;},BJ=(r,e)=>{let{xOffset:t,yOffset:n,input:i,font:s,height:o,align:a,extrudeOffset:l,lineSpacing:u,letterSpacing:c}=SJ(r,e),[h,d]=[t,n],f,p,m,g,b,y,v={width:0,segments:[]},E=[],P=[],M=0,I=h,C=()=>{E.push(v),M=Math.max(M,v.width),v={width:0,segments:[]};};for(f=0,p=i.length;f<p;f++){if(m=i[f],g=_J({xOffset:h,yOffset:d,font:s,height:o,extrudeOffset:l},m),m===`
`){h=I,d-=g.height*u,C();continue;}b=g.width*c,v.width+=b,h+=b,m!==" "&&(v.segments=v.segments.concat(g.segments));}for(v.segments.length&&C(),f=0,p=E.length;f<p;f++)v=E[f],M>v.width&&(y=M-v.width,a==="right"?v=RR({x:y},v):a==="center"&&(v=RR({x:y/2},v))),P=P.concat(v.segments);return P;};NR.exports=BJ;});var kR=G((IUe,OR)=>{OR.exports={vectorChar:u1(),vectorText:LR()};});var xl=G((AUe,UR)=>{var IJ=tt(),AJ=rt(),CJ=kt(),MJ=r=>{let e;for(let t of r){let n=0;if(IJ.isA(t)&&(n=1),AJ.isA(t)&&(n=2),CJ.isA(t)&&(n=3),e&&n!==e)return!1;e=n;}return!0;};UR.exports=MJ;});var GR=G((CUe,DR)=>{var TJ=r=>r*.017453292519943295;DR.exports=TJ;});var c1=G((MUe,FR)=>{var RJ=(r,e)=>r-e;FR.exports=RJ;});var zR=G((TUe,qR)=>{var NJ=(r,e,t)=>{let n=0,i=r.length;for(;i>n;){let s=Math.floor((n+i)/2),o=r[s];t(e,o)>0?n=s+1:i=s;}r.splice(n,0,e);};qR.exports=NJ;});var VR=G((RUe,XR)=>{var{TAU:YR}=wt(),LJ=(r,e,t)=>{let n=e>0?r*YR/e:0,i=t>0?YR/t:0;return Math.ceil(Math.max(n,i,4));};XR.exports=LJ;});var $R=G((NUe,WR)=>{var OJ=r=>r*57.29577951308232;WR.exports=OJ;});var h1=G((LUe,jR)=>{jR.exports={areAllShapesTheSameType:xl(),degToRad:GR(),flatten:Qe(),fnNumberSort:c1(),insertSorted:zR(),radiusToSegments:VR(),radToDeg:$R()};});var up=G((OUe,HR)=>{var ZR=it(),kJ=tt(),UJ=(r,e)=>{if(e.vertices.length<4)return null;let t=[],n=e.vertices.filter((o,a)=>o[2]>0?(t.push(a),!0):!1);if(n.length!==2)throw new Error("Assertion failed: fromFakePolygon: not enough points found");let i=n.map(o=>{let a=Math.round(o[0]/r)*r+0,l=Math.round(o[1]/r)*r+0;return ZR.fromValues(a,l);});if(ZR.equals(i[0],i[1]))return null;let s=t[1]-t[0];if(s===1||s===3)s===1&&i.reverse();else throw new Error("Assertion failed: fromFakePolygon: unknown index ordering");return i;},DJ=(r,e)=>{let t=e.map(n=>UJ(r,n)).filter(n=>n!==null);return kJ.create(t);};HR.exports=DJ;});var cp=G((kUe,KR)=>{var to=Ye(),GJ=tt(),FJ=rt(),qJ=gt(),zJ=(r,e,t)=>{let n=[to.fromVec2(to.create(),t[0],r),to.fromVec2(to.create(),t[1],r),to.fromVec2(to.create(),t[1],e),to.fromVec2(to.create(),t[0],e)];return qJ.create(n);},YJ=(r,e)=>{let n=GJ.toSides(e).map(s=>zJ(r.z0,r.z1,s));return FJ.create(n);};KR.exports=YJ;});var eN=G((UUe,JR)=>{var QR=Dt(),XJ=it(),gr=Ye(),Wo=function(r,e){arguments.length<2&&(e=gr.orthogonal(gr.create(),r)),this.v=gr.normalize(gr.create(),gr.cross(gr.create(),r,e)),this.u=gr.cross(gr.create(),this.v,r),this.plane=r,this.planeorigin=gr.scale(gr.create(),r,r[3]);};Wo.GetCartesian=function(r,e){let t=r+"/"+e,n,i;if(t==="X/Y")n=[0,0,1],i=[1,0,0];else if(t==="Y/-X")n=[0,0,1],i=[0,1,0];else if(t==="-X/-Y")n=[0,0,1],i=[-1,0,0];else if(t==="-Y/X")n=[0,0,1],i=[0,-1,0];else if(t==="-X/Y")n=[0,0,-1],i=[-1,0,0];else if(t==="-Y/-X")n=[0,0,-1],i=[0,-1,0];else if(t==="X/-Y")n=[0,0,-1],i=[1,0,0];else if(t==="Y/X")n=[0,0,-1],i=[0,1,0];else if(t==="X/Z")n=[0,-1,0],i=[1,0,0];else if(t==="Z/-X")n=[0,-1,0],i=[0,0,1];else if(t==="-X/-Z")n=[0,-1,0],i=[-1,0,0];else if(t==="-Z/X")n=[0,-1,0],i=[0,0,-1];else if(t==="-X/Z")n=[0,1,0],i=[-1,0,0];else if(t==="-Z/-X")n=[0,1,0],i=[0,0,-1];else if(t==="X/-Z")n=[0,1,0],i=[1,0,0];else if(t==="Z/X")n=[0,1,0],i=[0,0,1];else if(t==="Y/Z")n=[1,0,0],i=[0,1,0];else if(t==="Z/-Y")n=[1,0,0],i=[0,0,1];else if(t==="-Y/-Z")n=[1,0,0],i=[0,-1,0];else if(t==="-Z/Y")n=[1,0,0],i=[0,0,-1];else if(t==="-Y/Z")n=[-1,0,0],i=[0,-1,0];else if(t==="-Z/-Y")n=[-1,0,0],i=[0,0,-1];else if(t==="Y/-Z")n=[-1,0,0],i=[0,1,0];else if(t==="Z/Y")n=[-1,0,0],i=[0,0,1];else throw new Error("OrthoNormalBasis.GetCartesian: invalid combination of axis identifiers. Should pass two string arguments from [X,Y,Z,-X,-Y,-Z], being two different axes.");return new Wo(new Plane(new Vector3D(n),0),new Vector3D(i));},Wo.Z0Plane=function(){let r=new Plane(new Vector3D([0,0,1]),0);return new Wo(r,new Vector3D([1,0,0]));},Wo.prototype={getProjectionMatrix:function(){return QR.fromValues(this.u[0],this.v[0],this.plane[0],0,this.u[1],this.v[1],this.plane[1],0,this.u[2],this.v[2],this.plane[2],0,0,0,-this.plane[3],1);},getInverseProjectionMatrix:function(){let r=gr.scale(gr.create(),this.plane,this.plane[3]);return QR.fromValues(this.u[0],this.u[1],this.u[2],0,this.v[0],this.v[1],this.v[2],0,this.plane[0],this.plane[1],this.plane[2],0,r[0],r[1],r[2],1);},to2D:function(r){return XJ.fromValues(gr.dot(r,this.u),gr.dot(r,this.v));},to3D:function(r){let e=gr.scale(gr.create(),this.u,r[0]),t=gr.scale(gr.create(),this.v,r[1]),n=gr.add(e,e,this.planeorigin);return gr.add(t,t,n);},line3Dto2D:function(r){let e=r.point,t=r.direction.plus(e),n=this.to2D(e),i=this.to2D(t);return Line2D.fromPoints(n,i);},line2Dto3D:function(r){let e=r.origin(),t=r.direction().plus(e),n=this.to3D(e),i=this.to3D(t);return Line3D.fromPoints(n,i);},transform:function(r){let e=this.plane.transform(r),t=this.u.transform(r),n=new Vector3D(0,0,0).transform(r),i=t.minus(n);return new Wo(e,i);}},JR.exports=Wo;});var nN=G((DUe,rN)=>{var{EPS:hs}=wt(),ro=qd(),ai=it(),VJ=eN(),bl=vx(),{insertSorted:WJ,fnNumberSort:$J}=h1(),tN=gt(),jJ=r=>{if(r.length<2)return r;let e=[],t=r.length,n=tN.plane(r[0]),i=new VJ(n),s=[],o=[],a=new Map(),l=new Map(),u=new Map(),c=10/hs;for(let p=0;p<t;p++){let m=r[p],g=[],b=m.vertices.length,y=-1;if(b>0){let v,E;for(let P=0;P<b;P++){let M=i.to2D(m.vertices[P]),I=Math.floor(M[1]*c),C;u.has(I)?C=u.get(I):u.has(I+1)?C=u.get(I+1):u.has(I-1)?C=u.get(I-1):(C=M[1],u.set(I,M[1])),M=ai.fromValues(M[0],C),g.push(M);let L=M[1];(P===0||L<v)&&(v=L,y=P),(P===0||L>E)&&(E=L);let S=l.get(L);S||(S={},l.set(L,S)),S[p]=!0;}if(v>=E)g=[],b=0,y=-1;else{let P=a.get(v);P||(P=[],a.set(v,P)),P.push(p);}}g.reverse(),y=b-y-1,s.push(g),o.push(y);}let h=[];l.forEach((p,m)=>h.push(m)),h.sort($J);let d=[],f=[];for(let p=0;p<h.length;p++){let m=[],g=h[p],b=l.get(g);for(let v=0;v<d.length;++v){let E=d[v],P=E.polygonindex;if(b[P]){let M=s[P],I=M.length,C=E.leftvertexindex,L=E.rightvertexindex;for(;;){let T=C+1;if(T>=I&&(T=0),M[T][1]!==g)break;C=T;}let S=L-1;if(S<0&&(S=I-1),M[S][1]===g&&(L=S),C!==E.leftvertexindex&&C===L)d.splice(v,1),--v;else{E.leftvertexindex=C,E.rightvertexindex=L,E.topleft=M[C],E.topright=M[L];let T=C+1;T>=I&&(T=0),E.bottomleft=M[T];let B=L-1;B<0&&(B=I-1),E.bottomright=M[B];}}}let y;if(p>=h.length-1)d=[],y=null;else{y=Number(h[p+1]);let v=.5*(g+y),E=a.get(g);for(let P in E){let M=E[P],I=s[M],C=I.length,L=o[M],S=L;for(;;){let H=S+1;if(H>=C&&(H=0),I[H][1]!==g||H===L)break;S=H;}let T=L;for(;;){let H=T-1;if(H<0&&(H=C-1),I[H][1]!==g||H===S)break;T=H;}let B=S+1;B>=C&&(B=0);let $=T-1;$<0&&($=C-1);let Z={polygonindex:M,leftvertexindex:S,rightvertexindex:T,topleft:I[S],topright:I[T],bottomleft:I[B],bottomright:I[$]};WJ(d,Z,(H,W)=>{let Y=bl(H.topleft,H.bottomleft,v),U=bl(W.topleft,W.bottomleft,v);return Y>U?1:Y<U?-1:0;});}}for(let v in d){let E=d[v],P=bl(E.topleft,E.bottomleft,g),M=ai.fromValues(P,g);P=bl(E.topright,E.bottomright,g);let I=ai.fromValues(P,g);P=bl(E.topleft,E.bottomleft,y);let C=ai.fromValues(P,y);P=bl(E.topright,E.bottomright,y);let L=ai.fromValues(P,y),S={topleft:M,topright:I,bottomleft:C,bottomright:L,leftline:ro.fromPoints(ro.create(),M,C),rightline:ro.fromPoints(ro.create(),L,I)};if(m.length>0){let T=m[m.length-1],B=ai.distance(S.topleft,T.topright),$=ai.distance(S.bottomleft,T.bottomright);B<hs&&$<hs&&(S.topleft=T.topleft,S.leftline=T.leftline,S.bottomleft=T.bottomleft,m.splice(m.length-1,1));}m.push(S);}if(p>0){let v=new Set(),E=new Set();for(let P=0;P<m.length;P++){let M=m[P];for(let I=0;I<f.length;I++)if(!E.has(I)){let C=f[I];if(ai.distance(C.bottomleft,M.topleft)<hs&&ai.distance(C.bottomright,M.topright)<hs){E.add(I);let L=ro.direction(M.leftline),S=ro.direction(C.leftline),T=L[0]-S[0],B=ro.direction(M.rightline),$=ro.direction(C.rightline),Z=B[0]-$[0],H=Math.abs(T)<hs,W=Math.abs(Z)<hs,Y=H||T>=0,U=W||Z>=0;Y&&U&&(M.outpolygon=C.outpolygon,M.leftlinecontinues=H,M.rightlinecontinues=W,v.add(I));break;}}}for(let P=0;P<f.length;P++)if(!v.has(P)){let M=f[P];M.outpolygon.rightpoints.push(M.bottomright),ai.distance(M.bottomright,M.bottomleft)>hs&&M.outpolygon.leftpoints.push(M.bottomleft),M.outpolygon.leftpoints.reverse();let C=M.outpolygon.rightpoints.concat(M.outpolygon.leftpoints).map(S=>i.to3D(S)),L=tN.fromPointsAndPlane(C,n);L.vertices.length&&e.push(L);}}for(let v=0;v<m.length;v++){let E=m[v];E.outpolygon?(E.leftlinecontinues||E.outpolygon.leftpoints.push(E.topleft),E.rightlinecontinues||E.outpolygon.rightpoints.push(E.topright)):(E.outpolygon={leftpoints:[],rightpoints:[]},E.outpolygon.leftpoints.push(E.topleft),ai.distance(E.topleft,E.topright)>hs&&E.outpolygon.rightpoints.push(E.topright));}f=m;}return e;};rN.exports=jJ;});var uc=G((GUe,oN)=>{var iN=rt(),sN=gt(),ZJ=Ju(),HJ=nN(),KJ=(r,e)=>Math.abs(r[3]-e[3])<15e-8?ZJ(r,e):!1,QJ=r=>{if(r.isRetesselated)return r;let e=iN.toPolygons(r),t=[];e.forEach(s=>{let o=t.find(a=>KJ(a[0],sN.plane(s)));o?o[1].push(s):t.push([sN.plane(s),[s]]);});let n=[];t.forEach(s=>{let o=s[1],a=HJ(o);n=n.concat(a);});let i=iN.create(n);return i.isRetesselated=!0,i;};oN.exports=QJ;});var hp=G((FUe,lN)=>{var{EPS:yl}=wt(),aN=js(),JJ=(r,e)=>{if(r.polygons.length===0||e.polygons.length===0)return!1;let t=aN(r),n=t[0],i=t[1],s=aN(e),o=s[0],a=s[1];return!(o[0]-i[0]>yl||n[0]-a[0]>yl||o[1]-i[1]>yl||n[1]-a[1]>yl||o[2]-i[2]>yl||n[2]-a[2]>yl);};lN.exports=JJ;});var hN=G((qUe,cN)=>{var uN=oi(),eee=gt(),wl=class{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygontreenodes=[],this.parent=e;}invert(){let e=[this],t;for(let n=0;n<e.length;n++){t=e[n],t.plane&&(t.plane=uN.flip(uN.create(),t.plane)),t.front&&e.push(t.front),t.back&&e.push(t.back);let i=t.front;t.front=t.back,t.back=i;}}clipPolygons(e,t){let n={node:this,polygontreenodes:e},i,s=[];do{if(i=n.node,e=n.polygontreenodes,i.plane){let o=i.plane,a=[],l=[],u=t?a:l,c=e.length;for(let d=0;d<c;d++){let f=e[d];f.isRemoved()||f.splitByPlane(o,u,a,l,a);}i.front&&l.length>0&&s.push({node:i.front,polygontreenodes:l});let h=a.length;if(i.back&&h>0)s.push({node:i.back,polygontreenodes:a});else for(let d=0;d<h;d++)a[d].remove();}n=s.pop();}while(n!==void 0);}clipTo(e,t){let n=this,i=[];do n.polygontreenodes.length>0&&e.rootnode.clipPolygons(n.polygontreenodes,t),n.front&&i.push(n.front),n.back&&i.push(n.back),n=i.pop();while(n!==void 0);}addPolygonTreeNodes(e){let t={node:this,polygontreenodes:e},n=[];do{let i=t.node,s=t.polygontreenodes;if(s.length===0){t=n.pop();continue;}if(!i.plane){let u=0;u=Math.floor(s.length/2);let c=s[u].getPolygon();i.plane=eee.plane(c);}let o=[],a=[],l=s.length;for(let u=0;u<l;++u)s[u].splitByPlane(i.plane,i.polygontreenodes,a,o,a);o.length>0&&(i.front||(i.front=new wl(i)),l===o.length&&a.length===0?i.front.polygontreenodes=o:n.push({node:i.front,polygontreenodes:o})),a.length>0&&(i.back||(i.back=new wl(i)),l===a.length&&o.length===0?i.back.polygontreenodes=a:n.push({node:i.back,polygontreenodes:a})),t=n.pop();}while(t!==void 0);}};cN.exports=wl;});var dN=G((zUe,fN)=>{var vl=Ye(),tee=(r,e,t)=>{let n=vl.subtract(vl.create(),t,e),i=(r[3]-vl.dot(r,e))/vl.dot(r,n);return Number.isNaN(i)&&(i=0),i>1&&(i=1),i<0&&(i=0),vl.scale(n,n,i),vl.add(n,e,n),n;};fN.exports=tee;});var mN=G((YUe,pN)=>{var{EPS:fp}=wt(),ree=oi(),dp=Ye(),f1=gt(),nee=dN(),iee=(r,e)=>{let t={type:null,front:null,back:null},n=e.vertices,i=n.length,s=f1.plane(e);if(ree.equals(s,r))t.type=0;else{let o=!1,a=!1,l=[],u=-fp;for(let c=0;c<i;c++){let h=dp.dot(r,n[c])-r[3],d=h<u;l.push(d),h>fp&&(o=!0),h<u&&(a=!0);}if(!o&&!a){let c=dp.dot(r,s);t.type=c>=0?0:1;}else if(!a)t.type=2;else if(!o)t.type=3;else{t.type=4;let c=[],h=[],d=l[0];for(let p=0;p<i;p++){let m=n[p],g=p+1;g>=i&&(g=0);let b=l[g];if(d===b)d?h.push(m):c.push(m);else{let y=n[g],v=nee(r,m,y);d?(h.push(m),h.push(v),c.push(v)):(c.push(m),c.push(v),h.push(v));}d=b;}let f=fp*fp;if(h.length>=3){let p=h[h.length-1];for(let m=0;m<h.length;m++){let g=h[m];dp.squaredDistance(g,p)<f&&(h.splice(m,1),m--),p=g;}}if(c.length>=3){let p=c[c.length-1];for(let m=0;m<c.length;m++){let g=c[m];dp.squaredDistance(g,p)<f&&(c.splice(m,1),m--),p=g;}}c.length>=3&&(t.front=f1.fromPointsAndPlane(c,s)),h.length>=3&&(t.back=f1.fromPointsAndPlane(h,s));}}return t;};pN.exports=iee;});var bN=G((XUe,xN)=>{var{EPS:see}=wt(),oee=Ye(),gN=gt(),aee=mN(),cc=class{constructor(e,t){this.parent=e,this.children=[],this.polygon=t,this.removed=!1;}addPolygons(e){if(!this.isRootNode())throw new Error("Assertion failed");let t=this;e.forEach(n=>{t.addChild(n);});}remove(){if(!this.removed){this.removed=!0,this.polygon=null;let e=this.parent.children,t=e.indexOf(this);if(t<0)throw new Error("Assertion failed");e.splice(t,1),this.parent.recursivelyInvalidatePolygon();}}isRemoved(){return this.removed;}isRootNode(){return!this.parent;}invert(){if(!this.isRootNode())throw new Error("Assertion failed");this.invertSub();}getPolygon(){if(!this.polygon)throw new Error("Assertion failed");return this.polygon;}getPolygons(e){let t=[this],n=[t],i,s,o,a;for(i=0;i<n.length;++i)for(t=n[i],s=0,o=t.length;s<o;s++)a=t[s],a.polygon?e.push(a.polygon):a.children.length>0&&n.push(a.children);}splitByPlane(e,t,n,i,s){if(this.children.length){let o=[this.children],a,l,u,c,h;for(a=0;a<o.length;a++)for(h=o[a],l=0,u=h.length;l<u;l++)c=h[l],c.children.length>0?o.push(c.children):c._splitByPlane(e,t,n,i,s);}else this._splitByPlane(e,t,n,i,s);}_splitByPlane(e,t,n,i,s){let o=this.polygon;if(o){let a=gN.measureBoundingSphere(o),l=a[3]+see,u=a,c=oee.dot(e,u)-e[3];if(c>l)i.push(this);else if(c<-l)s.push(this);else{let h=aee(e,o);switch(h.type){case 0:t.push(this);break;case 1:n.push(this);break;case 2:i.push(this);break;case 3:s.push(this);break;case 4:if(h.front){let d=this.addChild(h.front);i.push(d);}if(h.back){let d=this.addChild(h.back);s.push(d);}break;}}}}addChild(e){let t=new cc(this,e);return this.children.push(t),t;}invertSub(){let e=[this],t=[e],n,i,s,o;for(n=0;n<t.length;n++)for(e=t[n],i=0,s=e.length;i<s;i++)o=e[i],o.polygon&&(o.polygon=gN.invert(o.polygon)),o.children.length>0&&t.push(o.children);}recursivelyInvalidatePolygon(){this.polygon=null,this.parent&&this.parent.recursivelyInvalidatePolygon();}clear(){let e=[this],t=[e];for(let n=0;n<t.length;++n){e=t[n];let i=e.length;for(let s=0;s<i;s++){let o=e[s];o.polygon&&(o.polygon=null),o.parent&&(o.parent=null),o.children.length>0&&t.push(o.children),o.children=[];}}}toString(){let e="",t=[this],n=[t],i,s,o,a;for(i=0;i<n.length;++i){t=n[i];let l=" ".repeat(i);for(s=0,o=t.length;s<o;s++)a=t[s],e+=`${l}PolygonTreeNode (${a.isRootNode()}): ${a.children.length}`,a.polygon?e+=`
 ${l}polygon: ${a.polygon.vertices}
`:e+=`
`,a.children.length>0&&n.push(a.children);}return e;}};xN.exports=cc;});var wN=G((VUe,yN)=>{var lee=hN(),uee=bN(),d1=class{constructor(e){this.polygonTree=new uee(),this.rootnode=new lee(null),e&&this.addPolygons(e);}invert(){this.polygonTree.invert(),this.rootnode.invert();}clipTo(e,t=!1){this.rootnode.clipTo(e,t);}allPolygons(){let e=[];return this.polygonTree.getPolygons(e),e;}addPolygons(e){let t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=this.polygonTree.addChild(e[n]);this.rootnode.addPolygonTreeNodes(t);}clear(){this.polygonTree.clear();}toString(){return"Tree: "+this.polygonTree.toString("");}};yN.exports=d1;});var pp=G((WUe,vN)=>{vN.exports={Tree:wN()};});var _N=G(($Ue,PN)=>{var mp=rt(),cee=hp(),{Tree:EN}=pp(),hee=(r,e)=>{if(!cee(r,e))return mp.create();let t=new EN(mp.toPolygons(r)),n=new EN(mp.toPolygons(e));t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.addPolygons(n.allPolygons()),t.invert();let i=t.allPolygons();return mp.create(i);};PN.exports=hee;});var p1=G((jUe,SN)=>{var fee=Qe(),dee=uc(),pee=_N(),mee=(...r)=>{r=fee(r);let e=r.shift();return r.forEach(t=>{e=pee(e,t);}),e=dee(e),e;};SN.exports=mee;});var IN=G((ZUe,BN)=>{var gee=Qe(),xee=rt(),bee=us(),yee=up(),wee=cp(),vee=p1(),Eee=(...r)=>{r=gee(r);let e=r.map(i=>wee({z0:-1,z1:1},i)),t=vee(e),n=bee(t);return yee(n,xee.toPolygons(t));};BN.exports=Eee;});var CN=G((HUe,AN)=>{var Pee=Qe(),_ee=xl(),See=tt(),Bee=rt(),Iee=IN(),Aee=p1(),Cee=(...r)=>{if(r=Pee(r),r.length===0)throw new Error("wrong number of arguments");if(!_ee(r))throw new Error("only intersect of the types are supported");let e=r[0];return See.isA(e)?Iee(r):Bee.isA(e)?Aee(r):e;};AN.exports=Cee;});var RN=G((KUe,TN)=>{var m1=Ye(),Mee=us(),MN=rt(),Tee=r=>r.sort((e,t)=>e-t).filter((e,t,n)=>!t||e!==n[t-1]),Ree=(r,e,t)=>{let n=`${e}`,i=r.get(n);i===void 0?r.set(n,[t]):i.push(t);},Nee=(r,e)=>{let t=`${e}`;return r.get(t);},Lee=r=>{let e=Mee(r),t=MN.toPolygons(r),n=t.length,i=new Map(),s=m1.create();t.forEach((c,h)=>{c.vertices.forEach(d=>{Ree(i,m1.snap(s,d,e),h);});});let o=t.map(c=>{let h=[];return c.vertices.forEach(d=>{h=h.concat(Nee(i,m1.snap(s,d,e)));}),{e:1,d:Tee(h)};});i.clear();let a=0,l=o.length;for(let c=0;c<l;c++){let h=o[c];if(h.e>0){let d=new Array(n);d[c]=!0;do a=0,d.forEach((f,p)=>{let m=o[p];if(m.e>0){m.e=-1;for(let g=0;g<m.d.length;g++)d[m.d[g]]=!0;a++;}});while(a>0);h.indexes=d;}}let u=[];for(let c=0;c<l;c++)if(o[c].indexes){let h=[];o[c].indexes.forEach((d,f)=>h.push(t[f])),u.push(MN.create(h));}return u;};TN.exports=Lee;});var LN=G((QUe,NN)=>{var Oee=Qe(),kee=rt(),Uee=RN(),Dee=(...r)=>{if(r=Oee(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>kee.isA(t)?Uee(t):t);return e.length===1?e[0]:e;};NN.exports=Dee;});var UN=G((JUe,kN)=>{var gp=rt(),Gee=hp(),{Tree:ON}=pp(),Fee=(r,e)=>{if(!Gee(r,e))return gp.clone(r);let t=new ON(gp.toPolygons(r)),n=new ON(gp.toPolygons(e));t.invert(),t.clipTo(n),n.clipTo(t,!0),t.addPolygons(n.allPolygons()),t.invert();let i=t.allPolygons();return gp.create(i);};kN.exports=Fee;});var g1=G((eDe,DN)=>{var qee=Qe(),zee=uc(),Yee=UN(),Xee=(...r)=>{r=qee(r);let e=r.shift();return r.forEach(t=>{e=Yee(e,t);}),e=zee(e),e;};DN.exports=Xee;});var FN=G((tDe,GN)=>{var Vee=Qe(),Wee=rt(),$ee=us(),jee=up(),Zee=cp(),Hee=g1(),Kee=(...r)=>{r=Vee(r);let e=r.map(i=>Zee({z0:-1,z1:1},i)),t=Hee(e),n=$ee(t);return jee(n,Wee.toPolygons(t));};GN.exports=Kee;});var zN=G((rDe,qN)=>{var Qee=Qe(),Jee=xl(),ete=tt(),tte=rt(),rte=FN(),nte=g1(),ite=(...r)=>{if(r=Qee(r),r.length===0)throw new Error("wrong number of arguments");if(!Jee(r))throw new Error("only subtract of the types are supported");let e=r[0];return ete.isA(e)?rte(r):tte.isA(e)?nte(r):e;};qN.exports=ite;});var x1=G((nDe,XN)=>{var El=rt(),ste=hp(),{Tree:YN}=pp(),ote=(r,e)=>{if(!ste(r,e))return ate(r,e);let t=new YN(El.toPolygons(r)),n=new YN(El.toPolygons(e));t.clipTo(n,!1),n.clipTo(t),n.invert(),n.clipTo(t),n.invert();let i=t.allPolygons().concat(n.allPolygons());return El.create(i);},ate=(r,e)=>{let t=El.toPolygons(r);return t=t.concat(El.toPolygons(e)),El.create(t);};XN.exports=ote;});var b1=G((iDe,VN)=>{var lte=Qe(),ute=uc(),cte=x1(),hte=(...r)=>{r=lte(r);let e;for(e=1;e<r.length;e+=2)r.push(cte(r[e-1],r[e]));let t=r[e-1];return t=ute(t),t;};VN.exports=hte;});var y1=G((sDe,WN)=>{var fte=Qe(),dte=rt(),pte=us(),mte=up(),gte=cp(),xte=b1(),bte=(...r)=>{r=fte(r);let e=r.map(i=>gte({z0:-1,z1:1},i)),t=xte(e),n=pte(t);return mte(n,dte.toPolygons(t));};WN.exports=bte;});var xp=G((oDe,$N)=>{var yte=Qe(),wte=xl(),vte=tt(),Ete=rt(),Pte=y1(),_te=b1(),Ste=(...r)=>{if(r=yte(r),r.length===0)throw new Error("wrong number of arguments");if(!wte(r))throw new Error("only unions of the same type are supported");let e=r[0];return vte.isA(e)?Pte(r):Ete.isA(e)?_te(r):e;};$N.exports=Ste;});var ZN=G((aDe,jN)=>{jN.exports={intersect:CN(),scission:LN(),subtract:zN(),union:xp()};});var fc=G((lDe,KN)=>{var{EPS:Bte,TAU:Ite}=wt(),HN=Ex(),hc=qd(),tr=it(),Ate=Hu(),Cte=(r,e)=>{let t={delta:1,corners:"edge",closed:!1,segments:16},{delta:n,corners:i,closed:s,segments:o}=Object.assign({},t,r);if(Math.abs(n)<Bte)return e;let a=r.closed?Ate(e):1;a===0&&(a=1);let l=a>0&&n>=0||a<0&&n<0;n=Math.abs(n);let u=null,c=[],h=[],d=tr.create(),f=e.length;for(let p=0;p<f;p++){let m=(p+1)%f,g=e[p],b=e[m];l?tr.subtract(d,g,b):tr.subtract(d,b,g),tr.normal(d,d),tr.normalize(d,d),tr.scale(d,d,n);let y=tr.add(tr.create(),g,d),v=tr.add(tr.create(),b,d),E=[y,v];if(u!=null&&(s||!s&&m!==0)){let P=HN(u[0],u[1],E[0],E[1]);P?(c.pop(),E[0]=P):h.push({c:g,s0:u,s1:E});}u=[y,v],!(m===0&&!s)&&(c.push(E[0]),c.push(E[1]));}if(s&&u!=null){let p=c[0],m=c[1],g=HN(u[0],u[1],p,m);if(g)c[0]=g,c.pop();else{let b=e[0],y=[p,m];h.push({c:b,s0:u,s1:y});}}if(i==="edge"){let p=new Map();c.forEach((b,y)=>p.set(b,y));let m=hc.create(),g=hc.create();h.forEach(b=>{hc.fromPoints(m,b.s0[0],b.s0[1]),hc.fromPoints(g,b.s1[0],b.s1[1]);let y=hc.intersectPointOfLines(m,g);if(Number.isFinite(y[0])&&Number.isFinite(y[1])){let v=b.s0[1],E=p.get(v);c[E]=y,c[(E+1)%c.length]=void 0;}else{let v=b.s1[0],E=p.get(v);c[E]=void 0;}}),c=c.filter(b=>b!==void 0);}if(i==="round"){let p=Math.floor(o/4),m=tr.create();h.forEach(g=>{let b=tr.angle(tr.subtract(m,g.s1[0],g.c));if(b-=tr.angle(tr.subtract(m,g.s0[1],g.c)),l&&b<0&&(b=b+Math.PI,b<0&&(b=b+Math.PI)),!l&&b>0&&(b=b-Math.PI,b>0&&(b=b-Math.PI)),b!==0){p=Math.floor(o*(Math.abs(b)/Ite));let y=b/p,v=tr.angle(tr.subtract(m,g.s0[1],g.c)),E=[];for(let P=1;P<p;P++){let M=v+y*P,I=tr.fromAngleRadians(tr.create(),M);tr.scale(I,I,n),tr.add(I,I,g.c),E.push(I);}if(E.length>0){let P=g.s0[1],M=c.findIndex(I=>tr.equals(P,I));M=(M+1)%c.length,c.splice(M,0,...E);}}else{let y=g.s1[0],v=c.findIndex(E=>tr.equals(y,E));c.splice(v,1);}});}return c;};KN.exports=Cte;});var JN=G((uDe,QN)=>{var bp=tt(),Mte=fc(),Tte=(r,e)=>{let t={delta:1,corners:"edge",segments:16},{delta:n,corners:i,segments:s}=Object.assign({},t,r);if(!(i==="edge"||i==="chamfer"||i==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');let l=bp.toOutlines(e).map(u=>(r={delta:n,corners:i,closed:!0,segments:s},Mte(r,u))).reduce((u,c)=>u.concat(bp.toSides(bp.fromPoints(c))),[]);return bp.create(l);};QN.exports=Tte;});var rL=G((cDe,tL)=>{var eL=Dt(),Rte=Ye(),Nte=rt(),dc=gt(),Lte=(r,e)=>{Rte.dot(dc.plane(e),r)>0&&(e=dc.invert(e));let n=[e],i=dc.transform(eL.fromTranslation(eL.create(),r),e),s=e.vertices.length;for(let o=0;o<s;o++){let a=o<s-1?o+1:0,l=dc.create([e.vertices[o],i.vertices[o],i.vertices[a],e.vertices[a]]);n.push(l);}return n.push(dc.invert(i)),Nte.create(n);};tL.exports=Lte;});var sL=G((hDe,iL)=>{var{EPS:Ote,TAU:w1}=wt(),nL=Dt(),zt=Ye(),kte=c1(),v1=rt(),$o=gt(),Ute=jx(),Dte=uc(),E1=x1(),Gte=rL(),Fte=(r,e,t)=>{let n=e.toString();if(r.has(n))r.get(n)[1].push(t);else{let i=[e,[t]];r.set(n,i);}},qte=(r,e,t)=>{let n=e[0].toString(),i=e[1].toString(),s=n<i?`${n},${i}`:`${i},${n}`;if(r.has(s))r.get(s)[1].push(t);else{let o=[e,[t]];r.set(s,o);}},P1=(r,e)=>{r.findIndex(n=>n===e)<0&&r.push(e);},zte=(r,e)=>{let t={delta:1,segments:12},{delta:n,segments:i}=Object.assign({},t,r),s=v1.create(),o=new Map(),a=new Map(),l=zt.create(),u=zt.create();return v1.toPolygons(e).forEach((h,d)=>{let f=zt.scale(zt.create(),$o.plane(h),2*n),p=$o.transform(nL.fromTranslation(nL.create(),zt.scale(zt.create(),f,-.5)),h),m=Gte(f,p);s=E1(s,m);let g=h.vertices;for(let b=0;b<g.length;b++){Fte(o,g[b],$o.plane(h));let y=(b+1)%g.length,v=[g[b],g[y]];qte(a,v,$o.plane(h));}}),a.forEach(h=>{let d=h[0],f=h[1],p=d[0],m=d[1],g=zt.subtract(zt.create(),m,p);zt.normalize(g,g);let b=f[0],y=zt.cross(zt.create(),b,g),v=[];for(let T=0;T<i;T++)P1(v,T*w1/i);for(let T=0,B=f.length;T<B;T++){let $=f[T],Z=zt.dot(y,$),H=zt.dot(b,$),W=Math.atan2(Z,H);W<0&&(W+=w1),P1(v,W),W=Math.atan2(-Z,-H),W<0&&(W+=w1),P1(v,W);}v=v.sort(kte);let E=v.length,P,M,I=[],C=[],L=[];for(let T=-1;T<E;T++){let B=v[T<0?T+E:T],$=Math.sin(B),Z=Math.cos(B);zt.scale(l,b,Z*n),zt.scale(u,y,$*n),zt.add(l,l,u);let H=zt.add(zt.create(),p,l),W=zt.add(zt.create(),m,l),Y=!1;if(T>=0&&zt.distance(H,P)<Ote&&(Y=!0),!Y){if(T>=0){I.push(H),C.push(W);let U=[M,W,H,P],D=$o.create(U);L.push(D);}P=H,M=W;}}C.reverse(),L.push($o.create(I)),L.push($o.create(C));let S=v1.create(L);s=E1(s,S);}),o.forEach(h=>{let d=h[0],f=h[1],p=f[0],m=null,g=0;for(let E=1;E<f.length;E++){let P=f[E],M=zt.cross(l,p,P),I=zt.length(M);I>.05&&I>g&&(g=I,m=P);}m||(m=zt.orthogonal(l,p));let b=zt.cross(l,p,m);zt.normalize(b,b);let y=zt.cross(u,b,p),v=Ute({center:[d[0],d[1],d[2]],radius:n,segments:i,axes:[p,b,y]});s=E1(s,v);}),Dte(s);};iL.exports=zte;});var aL=G((fDe,oL)=>{var Yte=rt(),Xte=xp(),Vte=sL(),Wte=(r,e)=>{let t={delta:1,corners:"round",segments:12},{delta:n,corners:i,segments:s}=Object.assign({},t,r);if(i!=="round")throw new Error('corners must be "round" for 3D geometries');if(Yte.toPolygons(e).length===0)throw new Error("the given geometry cannot be empty");r={delta:n,corners:i,segments:s};let a=Vte(r,e);return Xte(e,a);};oL.exports=Wte;});var cL=G((dDe,uL)=>{var $te=Hu(),cn=it(),Pl=tt(),pc=kt(),lL=fc(),jte=r=>{let{external:e,internal:t}=r;$te(e)<0?e=e.reverse():t=t.reverse();let n=pc.fromPoints({closed:!0},e),i=pc.fromPoints({closed:!0},t),s=Pl.toSides(Pl.fromPoints(pc.toPoints(n))),o=Pl.toSides(Pl.fromPoints(pc.toPoints(i)));return s.push(...o),Pl.create(s);},Zte=(r,e,t,n)=>{let{points:i,external:s,internal:o}=r,a=Math.floor(e/2),l=[],u=[];if(t==="round"&&a>0){let h=Math.PI/a,d=i[i.length-1],f=cn.angle(cn.subtract(cn.create(),s[s.length-1],d)),p=i[0],m=cn.angle(cn.subtract(cn.create(),o[0],p));for(let g=1;g<a;g++){let b=f+h*g,y=cn.fromAngleRadians(cn.create(),b);cn.scale(y,y,n),cn.add(y,y,d),l.push(y),b=m+h*g,y=cn.fromAngleRadians(cn.create(),b),cn.scale(y,y,n),cn.add(y,y,p),u.push(y);}}let c=[];return c.push(...s,...l,...o.reverse(),...u),Pl.fromPoints(c);},Hte=(r,e)=>{r=Object.assign({},{delta:1,corners:"edge",segments:16},r);let{delta:n,corners:i,segments:s}=r;if(n<=0)throw new Error("the given delta must be positive for paths");if(!(i==="edge"||i==="chamfer"||i==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');let o=e.isClosed,a=pc.toPoints(e);if(a.length===0)throw new Error("the given geometry cannot be empty");let l={points:a,external:lL({delta:n,corners:i,segments:s,closed:o},a),internal:lL({delta:-n,corners:i,segments:s,closed:o},a)};return e.isClosed?jte(l):Zte(l,s,i,n);};uL.exports=Hte;});var yp=G((pDe,hL)=>{var Kte=Qe(),Qte=tt(),Jte=rt(),ere=kt(),tre=JN(),rre=aL(),nre=cL(),ire=(r,...e)=>{if(e=Kte(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>ere.isA(n)?nre(r,n):Qte.isA(n)?tre(r,n):Jte.isA(n)?rre(r,n):n);return t.length===1?t[0]:t;};hL.exports=ire;});var pL=G((mDe,dL)=>{var wp=tt(),fL=Ud(),sre=fc(),ore=(r,e)=>{let t={delta:1,corners:"edge",segments:0},{delta:n,corners:i,segments:s}=Object.assign({},t,r);if(!(i==="edge"||i==="chamfer"||i==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');let o=wp.toOutlines(e),l=o.map(u=>(r={delta:o.reduce((d,f)=>d+fL.arePointsInside(u,fL.create(f)),0)%2===0?n:-n,corners:i,closed:!0,segments:s},sre(r,u))).reduce((u,c)=>u.concat(wp.toSides(wp.fromPoints(c))),[]);return wp.create(l);};dL.exports=ore;});var xL=G((gDe,gL)=>{var mL=kt(),are=fc(),lre=(r,e)=>{let t={delta:1,corners:"edge",closed:e.isClosed,segments:16},{delta:n,corners:i,closed:s,segments:o}=Object.assign({},t,r);if(!(i==="edge"||i==="chamfer"||i==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');r={delta:n,corners:i,closed:s,segments:o};let a=are(r,mL.toPoints(e));return mL.fromPoints({closed:s},a);};gL.exports=lre;});var yL=G((xDe,bL)=>{var ure=Qe(),cre=tt(),hre=kt(),fre=pL(),dre=xL(),pre=(r,...e)=>{if(e=ure(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>hre.isA(n)?dre(r,n):cre.isA(n)?fre(r,n):n);return t.length===1?t[0]:t;};bL.exports=pre;});var vL=G((bDe,wL)=>{wL.exports={expand:yp(),offset:yL()};});var gc=G((yDe,EL)=>{var mc=Dt(),_1=Ye(),mre=tt(),S1=fl(),gre=op(),xre=(r,e)=>{let t={offset:[0,0,1],twistAngle:0,twistSteps:12,repair:!0},{offset:n,twistAngle:i,twistSteps:s,repair:o}=Object.assign({},t,r);if(s<1)throw new Error("twistSteps must be 1 or more");i===0&&(s=1);let a=_1.clone(n),l=mre.toSides(e);if(l.length===0)throw new Error("the given geometry cannot be empty");let u=S1.fromSides(l);a[2]<0&&S1.reverse(u,u);let c=mc.create(),h=(d,f,p)=>{let m=f/s*i,g=_1.scale(_1.create(),a,f/s);return mc.multiply(c,mc.fromZRotation(c,m),mc.fromTranslation(mc.create(),g)),S1.transform(c,p);};return r={numberOfSlices:s+1,capStart:!0,capEnd:!0,repair:o,callback:h},gre(r,u);};EL.exports=xre;});var _L=G((wDe,PL)=>{var bre=tt(),yre=kt(),wre=gc(),vre=(r,e)=>{if(!e.isClosed)throw new Error("extruded path must be closed");let t=yre.toPoints(e),n=bre.fromPoints(t);return wre(r,n);};PL.exports=vre;});var BL=G((vDe,SL)=>{var Ere=Qe(),Pre=tt(),_re=kt(),Sre=gc(),Bre=_L(),Ire=(r,...e)=>{let t={height:1,twistAngle:0,twistSteps:1,repair:!0},{height:n,twistAngle:i,twistSteps:s,repair:o}=Object.assign({},t,r);if(e=Ere(e),e.length===0)throw new Error("wrong number of arguments");r={offset:[0,0,n],twistAngle:i,twistSteps:s,repair:o};let a=e.map(l=>_re.isA(l)?Bre(r,l):Pre.isA(l)?Sre(r,l):l);return a.length===1?a[0]:a;};SL.exports=Ire;});var AL=G((EDe,IL)=>{var Are=kt(),Cre=yp(),Mre=gc(),Tre=(r,e)=>{let t={size:1,height:1},{size:n,height:i}=Object.assign({},t,r);if(r.delta=n,r.offset=[0,0,i],Are.toPoints(e).length===0)throw new Error("the given geometry cannot be empty");let o=Cre(r,e);return Mre(r,o);};IL.exports=Tre;});var ML=G((PDe,CL)=>{var{area:Rre}=nl(),B1=tt(),Nre=kt(),Lre=yp(),Ore=gc(),kre=(r,e)=>{let t={size:1,height:1},{size:n,height:i}=Object.assign({},t,r);r.delta=n,r.offset=[0,0,i];let s=B1.toOutlines(e);if(s.length===0)throw new Error("the given geometry cannot be empty");let a=s.map(u=>(Rre(u)<0&&u.reverse(),Lre(r,Nre.fromPoints({closed:!0},u)))).reduce((u,c)=>u.concat(B1.toSides(c)),[]),l=B1.create(a);return Ore(r,l);};CL.exports=kre;});var RL=G((_De,TL)=>{var Ure=Qe(),Dre=tt(),Gre=kt(),Fre=AL(),qre=ML(),zre=(r,...e)=>{let t={size:1,height:1},{size:n,height:i}=Object.assign({},t,r);if(e=Ure(e),e.length===0)throw new Error("wrong number of arguments");if(n<=0)throw new Error("size must be positive");if(i<=0)throw new Error("height must be positive");let s=e.map(o=>Gre.isA(o)?Fre(r,o):Dre.isA(o)?qre(r,o):o);return s.length===1?s[0]:s;};TL.exports=zre;});var DL=G((SDe,UL)=>{var Yre=Qe(),NL=Ju(),I1=oi(),LL=Dt(),OL=tt(),kL=rt(),_l=gt(),Xre=us(),Vre=y1(),Wre=(r,e)=>{let t=I1.fromNormalAndPoint(I1.create(),r.axis,r.origin);if(Number.isNaN(t[0])||Number.isNaN(t[1])||Number.isNaN(t[2])||Number.isNaN(t[3]))throw new Error("project: invalid axis or origin");let n=Xre(e),i=n*n*Math.sqrt(3)/4;if(n===0)return OL.create();let s=kL.toPolygons(e),o=[];for(let l=0;l<s.length;l++){let u=s[l].vertices.map(d=>I1.projectionOfPoint(t,d)),c=_l.create(u),h=_l.plane(c);!NL(t,h)||_l.measureArea(c)<i||o.push(c);}if(!NL(t,[0,0,1])){let l=LL.fromVectorRotation(LL.create(),t,[0,0,1]);o=o.map(u=>_l.transform(l,u));}o=o.sort((l,u)=>_l.measureArea(u)-_l.measureArea(l));let a=o.map(l=>OL.fromPoints(l.vertices));return Vre(a);},$re=(r,...e)=>{let t={axis:[0,0,1],origin:[0,0,0]},{axis:n,origin:i}=Object.assign({},t,r);if(e=Yre(e),e.length===0)throw new Error("wrong number of arguments");r={axis:n,origin:i};let s=e.map(o=>kL.isA(o)?Wre(r,o):o);return s.length===1?s[0]:s;};UL.exports=$re;});var qL=G((BDe,FL)=>{FL.exports={extrudeFromSlices:op(),extrudeLinear:BL(),extrudeRectangular:RL(),extrudeRotate:i1(),project:DL(),slice:fl()};});var A1=G((IDe,YL)=>{var zL=it(),jre=r=>{let e=zL.fromValues(1/0,1/0);r.forEach(i=>{(i[1]<e[1]||i[1]===e[1]&&i[0]<e[0])&&(e=i);});let t=[];r.forEach(i=>{let s=Hre(i[1]-e[1],i[0]-e[0]),o=zL.squaredDistance(i,e);t.push({point:i,angle:s,distSq:o});}),t.sort((i,s)=>i.angle<s.angle?-1:i.angle>s.angle?1:i.distSq<s.distSq?-1:i.distSq>s.distSq?1:0);let n=[];return t.forEach(i=>{let s=n.length;for(;s>1&&Zre(n[s-2],n[s-1],i.point)<=Number.EPSILON;)n.pop(),s=n.length;n.push(i.point);}),n;},Zre=(r,e,t)=>(e[0]-r[0])*(t[1]-r[1])-(e[1]-r[1])*(t[0]-r[0]),Hre=(r,e)=>r===0&&e===0?-1/0:-e/r;YL.exports=jre;});var vp=G((ADe,$L)=>{var XL=tt(),VL=rt(),WL=kt(),Kre=r=>{let e=new Set(),t=[],n=i=>{let s=i.toString();e.has(s)||(t.push(i),e.add(s));};return r.forEach(i=>{XL.isA(i)?XL.toPoints(i).forEach(n):VL.isA(i)?VL.toPoints(i).forEach(s=>s.forEach(n)):WL.isA(i)&&WL.toPoints(i).forEach(n);}),t;};$L.exports=Kre;});var ZL=G((CDe,jL)=>{var Qre=Qe(),Jre=kt(),ene=A1(),tne=vp(),rne=(...r)=>{r=Qre(r);let e=tne(r),t=ene(e);return Jre.fromPoints({closed:!0},t);};jL.exports=rne;});var QL=G((MDe,KL)=>{var nne=Qe(),HL=tt(),ine=A1(),sne=vp(),one=(...r)=>{r=nne(r);let e=sne(r),t=ine(e);return t.length<3?HL.create():HL.fromPoints(t);};KL.exports=one;});var r4=G((TDe,t4)=>{var ane=tl(),JL=qu(),e4=Ug(),lne=(r,e,t)=>{let n=[],i=[],s=[];JL(n,t,e),JL(i,r,e);let o=e4(ane(s,i,n)),a=e4(n);if(a===0)throw Error("a and b are the same point");return o/a;},une=(r,e,t)=>Math.sqrt(lne(r,e,t));t4.exports=une;});var s4=G((RDe,i4)=>{var cne=tl(),hne=Md(),n4=qu(),fne=(r,e,t,n)=>{let i=[0,0,0];return n4(r,e,t),n4(i,t,n),cne(r,r,i),hne(r,r);};i4.exports=fne;});var a4=G((NDe,o4)=>{var C1=class{constructor(){this.head=null,this.tail=null;}clear(){this.head=this.tail=null;}insertBefore(e,t){t.prev=e.prev,t.next=e,t.prev?t.prev.next=t:this.head=t,e.prev=t;}insertAfter(e,t){t.prev=e,t.next=e.next,t.next?t.next.prev=t:this.tail=t,e.next=t;}add(e){this.head?this.tail.next=e:this.head=e,e.prev=this.tail,e.next=null,this.tail=e;}addAll(e){for(this.head?this.tail.next=e:this.head=e,e.prev=this.tail;e.next;)e=e.next;this.tail=e;}remove(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev;}removeChain(e,t){e.prev?e.prev.next=t.next:this.head=t.next,t.next?t.next.prev=e.prev:this.tail=e.prev;}first(){return this.head;}isEmpty(){return!this.head;}};o4.exports=C1;});var u4=G((LDe,l4)=>{var M1=class{constructor(e,t){this.point=e,this.index=t,this.next=null,this.prev=null,this.face=null;}};l4.exports=M1;});var h4=G((ODe,c4)=>{var dne=Tg(),pne=kg(),T1=class{constructor(e,t){this.vertex=e,this.face=t,this.next=null,this.prev=null,this.opposite=null;}head(){return this.vertex;}tail(){return this.prev?this.prev.vertex:null;}length(){return this.tail()?dne(this.tail().point,this.head().point):-1;}lengthSquared(){return this.tail()?pne(this.tail().point,this.head().point):-1;}setOpposite(e){this.opposite=e,e.opposite=this;}};c4.exports=T1;});var p4=G((kDe,d4)=>{var R1=Cg(),mne=Mg(),gne=tl(),N1=Gu(),xne=Rg(),bne=Md(),Ep=Og(),L1=qu(),O1=h4(),f4=0,yne=1,k1=2,xc=class{constructor(){this.normal=[],this.centroid=[],this.offset=0,this.outside=null,this.mark=f4,this.edge=null,this.nVertices=0;}getEdge(e){if(typeof e!="number")throw Error("requires a number");let t=this.edge;for(;e>0;)t=t.next,e-=1;for(;e<0;)t=t.prev,e+=1;return t;}computeNormal(){let e=this.edge,t=e.next,n=t.next,i=L1([],t.head().point,e.head().point),s=[],o=[];for(this.nVertices=2,this.normal=[0,0,0];n!==e;)mne(o,i),L1(i,n.head().point,e.head().point),R1(this.normal,this.normal,gne(s,o,i)),n=n.next,this.nVertices+=1;this.area=xne(this.normal),this.normal=Ep(this.normal,this.normal,1/this.area);}computeNormalMinArea(e){if(this.computeNormal(),this.area<e){let t,n=0,i=this.edge;do{let c=i.lengthSquared();c>n&&(t=i,n=c),i=i.next;}while(i!==this.edge);let s=t.tail().point,o=t.head().point,a=L1([],o,s),l=Math.sqrt(n);Ep(a,a,1/l);let u=N1(this.normal,a);Ep(a,a,-u),R1(this.normal,this.normal,a),bne(this.normal,this.normal);}}computeCentroid(){this.centroid=[0,0,0];let e=this.edge;do R1(this.centroid,this.centroid,e.head().point),e=e.next;while(e!==this.edge);Ep(this.centroid,this.centroid,1/this.nVertices);}computeNormalAndCentroid(e){typeof e<"u"?this.computeNormalMinArea(e):this.computeNormal(),this.computeCentroid(),this.offset=N1(this.normal,this.centroid);}distanceToPlane(e){return N1(this.normal,e)-this.offset;}connectHalfEdges(e,t){let n;if(e.opposite.face===t.opposite.face){let i=t.opposite.face,s;e===this.edge&&(this.edge=t),i.nVertices===3?(s=t.opposite.prev.opposite,i.mark=k1,n=i):(s=t.opposite.next,i.edge===s.prev&&(i.edge=s),s.prev=s.prev.prev,s.prev.next=s),t.prev=e.prev,t.prev.next=t,t.setOpposite(s),i.computeNormalAndCentroid();}else e.next=t,t.prev=e;return n;}mergeAdjacentFaces(e,t){let n=e.opposite,i=n.face;t.push(i),i.mark=k1;let s=e.prev,o=e.next,a=n.prev,l=n.next;for(;s.opposite.face===i;)s=s.prev,l=l.next;for(;o.opposite.face===i;)o=o.next,a=a.prev;let u;for(u=l;u!==a.next;u=u.next)u.face=this;this.edge=o;let c;return c=this.connectHalfEdges(a,o),c&&t.push(c),c=this.connectHalfEdges(s,l),c&&t.push(c),this.computeNormalAndCentroid(),t;}collectIndices(){let e=[],t=this.edge;do e.push(t.head().index),t=t.next;while(t!==this.edge);return e;}static createTriangle(e,t,n,i=0){let s=new xc(),o=new O1(e,s),a=new O1(t,s),l=new O1(n,s);return o.next=l.prev=a,a.next=o.prev=l,l.next=a.prev=o,s.edge=o,s.computeNormalAndCentroid(i),s;}};d4.exports={VISIBLE:f4,NON_CONVEX:yne,DELETED:k1,Face:xc};});var y4=G((UDe,b4)=>{var U1=Gu(),wne=r4(),vne=s4(),m4=a4(),Ene=u4(),{Face:fs,VISIBLE:Sl,NON_CONVEX:g4,DELETED:Pne}=p4(),_ne=1,x4=2,D1=class{constructor(e){if(!Array.isArray(e))throw TypeError("input is not a valid array");if(e.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.nFaces=0,this.nPoints=e.length,this.faces=[],this.newFaces=[],this.claimed=new m4(),this.unclaimed=new m4(),this.vertices=[];for(let t=0;t<e.length;t+=1)this.vertices.push(new Ene(e[t],t));this.discardedFaces=[],this.vertexPointIndices=[];}addVertexToFace(e,t){e.face=t,t.outside?this.claimed.insertBefore(t.outside,e):this.claimed.add(e),t.outside=e;}removeVertexFromFace(e,t){e===t.outside&&(e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.claimed.remove(e);}removeAllVerticesFromFace(e){if(e.outside){let t=e.outside;for(;t.next&&t.next.face===e;)t=t.next;return this.claimed.removeChain(e.outside,t),t.next=null,e.outside;}}deleteFaceVertices(e,t){let n=this.removeAllVerticesFromFace(e);if(n)if(!t)this.unclaimed.addAll(n);else{let i;for(let s=n;s;s=i)i=s.next,t.distanceToPlane(s.point)>this.tolerance?this.addVertexToFace(s,t):this.unclaimed.add(s);}}resolveUnclaimedPoints(e){let t=this.unclaimed.first();for(let n=t;n;n=t){t=n.next;let i=this.tolerance,s;for(let o=0;o<e.length;o+=1){let a=e[o];if(a.mark===Sl){let l=a.distanceToPlane(n.point);if(l>i&&(i=l,s=a),i>1e3*this.tolerance)break;}}s&&this.addVertexToFace(n,s);}}computeExtremes(){let e=[],t=[],n=[],i=[],s,o;for(s=0;s<3;s+=1)n[s]=i[s]=this.vertices[0];for(s=0;s<3;s+=1)e[s]=t[s]=this.vertices[0].point[s];for(s=1;s<this.vertices.length;s+=1){let a=this.vertices[s],l=a.point;for(o=0;o<3;o+=1)l[o]<e[o]&&(e[o]=l[o],n[o]=a);for(o=0;o<3;o+=1)l[o]>t[o]&&(t[o]=l[o],i[o]=a);}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e[0]),Math.abs(t[0]))+Math.max(Math.abs(e[1]),Math.abs(t[1]))+Math.max(Math.abs(e[2]),Math.abs(t[2]))),[n,i];}createInitialSimplex(){let e=this.vertices,[t,n]=this.computeExtremes(),i,s,o,a,l=0,u=0;for(o=0;o<3;o+=1){let m=n[o].point[o]-t[o].point[o];m>l&&(l=m,u=o);}let c=t[u],h=n[u];for(l=0,o=0;o<this.vertices.length;o+=1){let m=this.vertices[o];if(m!==c&&m!==h){let g=wne(m.point,c.point,h.point);g>l&&(l=g,i=m);}}let d=vne([],c.point,h.point,i.point),f=U1(c.point,d);for(l=-1,o=0;o<this.vertices.length;o+=1){let m=this.vertices[o];if(m!==c&&m!==h&&m!==i){let g=Math.abs(U1(d,m.point)-f);g>l&&(l=g,s=m);}}let p=[];if(U1(s.point,d)-f<0)for(p.push(fs.createTriangle(c,h,i),fs.createTriangle(s,h,c),fs.createTriangle(s,i,h),fs.createTriangle(s,c,i)),o=0;o<3;o+=1){let m=(o+1)%3;p[o+1].getEdge(2).setOpposite(p[0].getEdge(m)),p[o+1].getEdge(1).setOpposite(p[m+1].getEdge(0));}else for(p.push(fs.createTriangle(c,i,h),fs.createTriangle(s,c,h),fs.createTriangle(s,h,i),fs.createTriangle(s,i,c)),o=0;o<3;o+=1){let m=(o+1)%3;p[o+1].getEdge(2).setOpposite(p[0].getEdge((3-o)%3)),p[o+1].getEdge(0).setOpposite(p[m+1].getEdge(1));}for(o=0;o<4;o+=1)this.faces.push(p[o]);for(o=0;o<e.length;o+=1){let m=e[o];if(m!==c&&m!==h&&m!==i&&m!==s){l=this.tolerance;let g;for(a=0;a<4;a+=1){let b=p[a].distanceToPlane(m.point);b>l&&(l=b,g=p[a]);}g&&this.addVertexToFace(m,g);}}}reindexFaceAndVertices(){let e=[];for(let t=0;t<this.faces.length;t+=1){let n=this.faces[t];n.mark===Sl&&e.push(n);}this.faces=e;}collectFaces(e){let t=[];for(let n=0;n<this.faces.length;n+=1){if(this.faces[n].mark!==Sl)throw Error("attempt to include a destroyed face in the hull");let i=this.faces[n].collectIndices();if(e)t.push(i);else for(let s=0;s<i.length-2;s+=1)t.push([i[0],i[s+1],i[s+2]]);}return t;}nextVertexToAdd(){if(!this.claimed.isEmpty()){let e,t,n=0,i=this.claimed.first().face;for(t=i.outside;t&&t.face===i;t=t.next){let s=i.distanceToPlane(t.point);s>n&&(n=s,e=t);}return e;}}computeHorizon(e,t,n,i){this.deleteFaceVertices(n),n.mark=Pne;let s;t?s=t.next:s=t=n.getEdge(0);do{let o=s.opposite,a=o.face;a.mark===Sl&&(a.distanceToPlane(e)>this.tolerance?this.computeHorizon(e,o,a,i):i.push(s)),s=s.next;}while(s!==t);}addAdjoiningFace(e,t){let n=fs.createTriangle(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setOpposite(t.opposite),n.getEdge(0);}addNewFaces(e,t){this.newFaces=[];let n,i;for(let s=0;s<t.length;s+=1){let o=t[s],a=this.addAdjoiningFace(e,o);n?a.next.setOpposite(i):n=a,this.newFaces.push(a.face),i=a;}n.next.setOpposite(i);}oppositeFaceDistance(e){return e.face.distanceToPlane(e.opposite.face.centroid);}doAdjacentMerge(e,t){let n=e.edge,i=!0,s=0;do{if(s>=e.nVertices)throw Error("merge recursion limit exceeded");let o=n.opposite.face,a=!1;if(t===x4?(this.oppositeFaceDistance(n)>-this.tolerance||this.oppositeFaceDistance(n.opposite)>-this.tolerance)&&(a=!0):e.area>o.area?this.oppositeFaceDistance(n)>-this.tolerance?a=!0:this.oppositeFaceDistance(n.opposite)>-this.tolerance&&(i=!1):this.oppositeFaceDistance(n.opposite)>-this.tolerance?a=!0:this.oppositeFaceDistance(n)>-this.tolerance&&(i=!1),a){let l=e.mergeAdjacentFaces(n,[]);for(let u=0;u<l.length;u+=1)this.deleteFaceVertices(l[u],e);return!0;}n=n.next,s+=1;}while(n!==e.edge);return i||(e.mark=g4),!1;}addVertexToHull(e){let t=[];this.unclaimed.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t);for(let n=0;n<this.newFaces.length;n+=1){let i=this.newFaces[n];if(i.mark===Sl)for(;this.doAdjacentMerge(i,_ne););}for(let n=0;n<this.newFaces.length;n+=1){let i=this.newFaces[n];if(i.mark===g4)for(i.mark=Sl;this.doAdjacentMerge(i,x4););}this.resolveUnclaimedPoints(this.newFaces);}build(){let e;for(this.createInitialSimplex();e=this.nextVertexToAdd();)this.addVertexToHull(e);this.reindexFaceAndVertices();}};b4.exports=D1;});var v4=G((DDe,w4)=>{var Sne=y4(),Bne=(r,e={})=>{let t=new Sne(r);return t.build(),t.collectFaces(e.skipTriangulation);};w4.exports=Bne;});var P4=G((GDe,E4)=>{var Ine=Qe(),Ane=rt(),Cne=gt(),Mne=v4(),Tne=vp(),Rne=(...r)=>{if(r=Ine(r),r.length===1)return r[0];let e=Tne(r),n=Mne(e,{skipTriangulation:!0}).map(i=>{let s=i.map(o=>e[o]);return Cne.create(s);});return Ane.create(n);};E4.exports=Rne;});var G1=G((FDe,_4)=>{var Nne=Qe(),Lne=xl(),One=tt(),kne=rt(),Une=kt(),Dne=ZL(),Gne=QL(),Fne=P4(),qne=(...r)=>{if(r=Nne(r),r.length===0)throw new Error("wrong number of arguments");if(!Lne(r))throw new Error("only hulls of the same type are supported");let e=r[0];return Une.isA(e)?Dne(r):One.isA(e)?Gne(r):kne.isA(e)?Fne(r):e;};_4.exports=qne;});var B4=G((qDe,S4)=>{var zne=Qe(),Yne=xp(),Xne=G1(),Vne=(...r)=>{if(r=zne(r),r.length<2)throw new Error("wrong number of arguments");let e=[];for(let t=1;t<r.length;t++)e.push(Xne(r[t-1],r[t]));return Yne(e);};S4.exports=Vne;});var A4=G((zDe,I4)=>{I4.exports={hull:G1(),hullChain:B4()};});var q1=G((YDe,M4)=>{var F1=Ye(),C4=gt(),Wne=(r,e)=>{let t=Math.abs(C4.measureArea(e));return Number.isFinite(t)&&t>r;},$ne=(r,e)=>{let t=e.map(i=>{let s=i.vertices.map(l=>F1.snap(F1.create(),l,r)),o=[];for(let l=0;l<s.length;l++){let u=(l+1)%s.length;F1.equals(s[l],s[u])||o.push(s[l]);}let a=C4.create(o);return i.color&&(a.color=i.color),a;}),n=r*r*Math.sqrt(3)/4;return t=t.filter(i=>Wne(n,i)),t;};M4.exports=$ne;});var N4=G((XDe,R4)=>{var jne=Ju(),Bl=Ye(),Pp=gt(),Zne=r=>{let e=Pp.toPoints(r),t=[];for(let n=0;n<e.length;n++){let i=(n+1)%e.length,s={v1:e[n],v2:e[i]};t.push(s);}for(let n=0;n<t.length;n++){let i=(n+1)%e.length;t[n].next=t[i],t[i].prev=t[n];}return t;},Hne=(r,e)=>{let t=`${e.v1}:${e.v2}`;r.set(t,e);},z1=(r,e)=>{let t=`${e.v1}:${e.v2}`;r.delete(t);},Kne=(r,e)=>{let t=`${e.v2}:${e.v1}`;return r.get(t);},Qne=(r,e,t)=>{let n=r.prev.v1,i=r.prev.v2,s=e.next.v2,o=T4(n,i,s,t);n=e.prev.v1,i=e.prev.v2,s=r.next.v2;let a=T4(n,i,s,t);return[o,a];},Jne=Bl.create(),eie=Bl.create(),T4=(r,e,t,n)=>{let i=Bl.subtract(Jne,e,r),s=Bl.subtract(eie,t,e);return Bl.cross(i,i,s),Bl.dot(i,n);},tie=r=>{let e,t=[];for(;r.next;){let n=r.next;t.push(r.v1),r.v1=null,r.v2=null,r.next=null,r.prev=null,r=n;}return t.length>0&&(e=Pp.create(t)),e;},rie=r=>{if(r.length<2)return r;let e=r[0].plane,t=r.slice(),n=new Map();for(;t.length>0;){let s=t.shift(),o=Zne(s);for(let a=0;a<o.length;a++){let l=o[a],u=Kne(n,l);if(u){let c=Qne(l,u,e);if(c[0]>=0&&c[1]>=0){let h=u.next,d=l.next;l.prev.next=u.next,l.next.prev=u.prev,u.prev.next=l.next,u.next.prev=l.prev,l.v1=null,l.v2=null,l.next=null,l.prev=null,z1(n,u),u.v1=null,u.v2=null,u.next=null,u.prev=null;let f=(p,m,g)=>{let b={v1:g.v1,v2:m.v2,next:m.next,prev:g.prev};g.prev.next=b,m.next.prev=b,z1(p,m),m.v1=null,m.v2=null,m.next=null,m.prev=null,z1(p,g),g.v1=null,g.v2=null,g.next=null,g.prev=null;};c[0]===0&&f(n,h,h.prev),c[1]===0&&f(n,d,d.prev);}}else l.next&&Hne(n,l);}}let i=[];return n.forEach(s=>{let o=tie(s);o&&i.push(o);}),n.clear(),i;},nie=(r,e)=>Math.abs(r[3]-e[3])<15e-8?jne(r,e):!1,iie=(r,e)=>{let t=[];e.forEach(i=>{let s=t.find(o=>nie(o[0],Pp.plane(i)));s?s[1].push(i):t.push([Pp.plane(i),[i]]);});let n=[];return t.forEach(i=>{let s=i[1],o=rie(s);n=n.concat(o);}),n;};R4.exports=iie;});var U4=G((VDe,k4)=>{var L4=wt(),Mi=Ye(),sie=gt(),no=!1,Dr=r=>`${r}`,O4=(r,e,t,n,i,s)=>{let o=Dr(n),a=Dr(i);if(no&&o===a)throw new Error("assert failed");let l=`${o}/${a}`,u=`${a}/${o}`;if(r.has(u))return _p(r,e,t,i,n,null),null;let c={vertex0:n,vertex1:i,polygonindex:s};return r.has(l)?r.get(l).push(c):r.set(l,[c]),e.has(o)?e.get(o).push(l):e.set(o,[l]),t.has(a)?t.get(a).push(l):t.set(a,[l]),l;},_p=(r,e,t,n,i,s)=>{let o=Dr(n),a=Dr(i),l=`${o}/${a}`;if(no&&!r.has(l))throw new Error("assert failed");let u=-1,c=r.get(l);for(let h=0;h<c.length;h++){let d=c[h],f=Dr(d.vertex0);if(f===o&&(f=Dr(d.vertex1),f===a&&!(s!==null&&d.polygonindex!==s))){u=h;break;}}if(no&&u<0)throw new Error("assert failed");if(c.splice(u,1),c.length===0&&r.delete(l),u=e.get(o).indexOf(l),no&&u<0)throw new Error("assert failed");if(e.get(o).splice(u,1),e.get(o).length===0&&e.delete(o),u=t.get(a).indexOf(l),no&&u<0)throw new Error("assert failed");t.get(a).splice(u,1),t.get(a).length===0&&t.delete(a);},oie=r=>{let e=new Map();for(let t=0;t<r.length;t++){let n=r[t],i=n.vertices.length;if(i>=3){let s=n.vertices[0],o=Dr(s);for(let a=0;a<i;a++){let l=a+1;l===i&&(l=0);let u=n.vertices[l],c=Dr(u),h=`${o}/${c}`,d=`${c}/${o}`;if(e.has(d)){let f=e.get(d);f.splice(-1,1),f.length===0&&e.delete(d);}else{let f={vertex0:s,vertex1:u,polygonindex:t};e.has(h)?e.get(h).push(f):e.set(h,[f]);}s=u,o=c;}}else console.warn("warning: invalid polygon found during insertTjunctions");}if(e.size>0){let t=new Map(),n=new Map(),i=new Map();for(let[o,a]of e)i.set(o,!0),a.forEach(l=>{let u=Dr(l.vertex0),c=Dr(l.vertex1);t.has(u)?t.get(u).push(o):t.set(u,[o]),n.has(c)?n.get(c).push(o):n.set(c,[o]);});let s=r.slice(0);for(;e.size!==0;){for(let a of e.keys())i.set(a,!0);let o=!1;for(;;){let a=Array.from(i.keys());if(a.length===0)break;let l=a[0],u=!0;if(e.has(l)){let c=e.get(l);if(no&&c.length===0)throw new Error("assert failed");let h=c[0];for(let d=0;d<2;d++){let f=d===0?h.vertex0:h.vertex1,p=d===0?h.vertex1:h.vertex0,m=Dr(f),g=Dr(p),b=[];d===0?n.has(m)&&(b=n.get(m)):t.has(m)&&(b=t.get(m));for(let y=0;y<b.length;y++){let v=b[y],E=e.get(v)[0],P=d===0?E.vertex0:E.vertex1,M=d===0?E.vertex1:E.vertex0,I=Dr(P),C=Dr(M);if(no&&C!==m)throw new Error("assert failed");if(I===g){_p(e,t,n,f,p,null),_p(e,t,n,p,f,null),u=!1,d=2,o=!0;break;}else{let L=f,S=p,T=P,B=Mi.subtract(Mi.create(),T,L),$=Mi.dot(Mi.subtract(Mi.create(),S,L),B)/Mi.dot(B,B);if($>0&&$<1){let Z=Mi.scale(Mi.create(),B,$);if(Mi.add(Z,Z,L),Mi.squaredDistance(Z,S)<L4.EPS*L4.EPS){let W=E.polygonindex,Y=s[W],U=Dr(E.vertex1),D=-1;for(let le=0;le<Y.vertices.length;le++)if(Dr(Y.vertices[le])===U){D=le;break;}if(no&&D<0)throw new Error("assert failed");let k=Y.vertices.slice(0);k.splice(D,0,p);let ie=sie.create(k);s[W]=ie,_p(e,t,n,E.vertex0,E.vertex1,W);let se=O4(e,t,n,E.vertex0,p,W),oe=O4(e,t,n,p,E.vertex1,W);se!==null&&i.set(se,!0),oe!==null&&i.set(oe,!0),u=!1,d=2,o=!0;break;}}}}}}u&&i.delete(l);}if(!o)break;}r=s;}return e.clear(),r;};k4.exports=oie;});var G4=G((WDe,D4)=>{var Y1=Ye(),X1=gt(),aie=(r,e,t)=>{let n=e.vertices.length;if(n>3){if(n>4){let o=[0,0,0];e.vertices.forEach(a=>Y1.add(o,o,a)),Y1.snap(o,Y1.divide(o,o,[n,n,n]),r);for(let a=0;a<n;a++){let l=X1.create([o,e.vertices[a],e.vertices[(a+1)%n]]);e.color&&(l.color=e.color),t.push(l);}return;}let i=X1.create([e.vertices[0],e.vertices[1],e.vertices[2]]),s=X1.create([e.vertices[0],e.vertices[2],e.vertices[3]]);e.color&&(i.color=e.color,s.color=e.color),t.push(i,s);return;}t.push(e);},lie=(r,e)=>{let t=[];return e.forEach(n=>{aie(r,n,t);}),t;};D4.exports=lie;});var z4=G(($De,q4)=>{var uie=Qe(),cie=us(),hie=tt(),F4=rt(),fie=kt(),die=q1(),pie=N4(),mie=U4(),gie=G4(),xie=(r,e)=>e,bie=(r,e)=>e,yie=(r,e)=>{let t={snap:!1,simplify:!1,triangulate:!1},{snap:n,simplify:i,triangulate:s}=Object.assign({},t,r),o=cie(e),a=F4.toPolygons(e);n&&(a=die(o,a)),i&&(a=pie(o,a)),s&&(a=mie(a),a=gie(o,a));let l=Object.assign({},e);return l.polygons=a,l;},wie=(r,...e)=>{if(e=uie(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>{if(fie.isA(n))return xie(r,n);if(hie.isA(n))return bie(r,n);if(F4.isA(n))return yie(r,n);throw new Error("invalid geometry");});return t.length===1?t[0]:t;};q4.exports=wie;});var X4=G((jDe,Y4)=>{var vie=Qe(),jo=it(),V1=tt(),W1=rt(),$1=kt(),j1=us(),Eie=q1(),Pie=r=>{let e=j1(r),n=$1.toPoints(r).map(i=>jo.snap(jo.create(),i,e));return $1.create(n);},_ie=r=>{let e=j1(r),n=V1.toSides(r).map(i=>[jo.snap(jo.create(),i[0],e),jo.snap(jo.create(),i[1],e)]);return n=n.filter(i=>!jo.equals(i[0],i[1])),V1.create(n);},Sie=r=>{let e=j1(r),t=W1.toPolygons(r),n=Eie(e,t);return W1.create(n);},Bie=(...r)=>{if(r=vie(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>$1.isA(t)?Pie(t):V1.isA(t)?_ie(t):W1.isA(t)?Sie(t):t);return e.length===1?e[0]:e;};Y4.exports=Bie;});var W4=G((ZDe,V4)=>{V4.exports={generalize:z4(),snap:X4()};});var j4=G((HDe,$4)=>{var Iie=(r,e,t)=>{for(r=r.slice();r.length<t;)r.push(e);return r;};$4.exports=Iie;});var J4=G((KDe,Q4)=>{var Aie=Qe(),Z4=j4(),H4=Xd(),{translate:Cie}=eo(),Mie=r=>{if(!Array.isArray(r.modes)||r.modes.length>3)throw new Error("align(): modes must be an array of length <= 3");if(r.modes=Z4(r.modes,"none",3),r.modes.filter(e=>["center","max","min","none"].includes(e)).length!==3)throw new Error('align(): all modes must be one of "center", "max" or "min"');if(!Array.isArray(r.relativeTo)||r.relativeTo.length>3)throw new Error("align(): relativeTo must be an array of length <= 3");if(r.relativeTo=Z4(r.relativeTo,0,3),r.relativeTo.filter(e=>Number.isFinite(e)||e==null).length!==3)throw new Error("align(): all relativeTo values must be a number, or null.");if(typeof r.grouped!="boolean")throw new Error("align(): grouped must be a boolean value.");return r;},Tie=(r,e,t)=>{for(let n=0;n<3;n++)r[n]==null&&(e[n]==="center"?r[n]=(t[0][n]+t[1][n])/2:e[n]==="max"?r[n]=t[1][n]:e[n]==="min"&&(r[n]=t[0][n]));return r;},K4=(r,e,t)=>{let n=H4(r),i=[0,0,0];for(let s=0;s<3;s++)e[s]==="center"?i[s]=t[s]-(n[0][s]+n[1][s])/2:e[s]==="max"?i[s]=t[s]-n[1][s]:e[s]==="min"&&(i[s]=t[s]-n[0][s]);return Cie(i,r);},Rie=(r,...e)=>{r=Object.assign({},{modes:["center","center","min"],relativeTo:[0,0,0],grouped:!1},r),r=Mie(r);let{modes:n,relativeTo:i,grouped:s}=r;if(e=Aie(e),e.length===0)throw new Error("align(): No geometries were provided to act upon");if(i.filter(o=>o==null).length){let o=H4(e);i=Tie(i,n,o);}return s?e=K4(e,n,i):e=e.map(o=>K4(o,n,i)),e.length===1?e[0]:e;};Q4.exports=Rie;});var bc=G((QDe,eO)=>{var Nie=Qe(),Lie=tt(),Oie=rt(),kie=kt(),Uie=js(),{translate:Die}=eo(),Z1=(r,e)=>{let t={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:n,relativeTo:i}=Object.assign({},t,r),s=Uie(e),o=[0,0,0];return n[0]&&(o[0]=i[0]-(s[0][0]+(s[1][0]-s[0][0])/2)),n[1]&&(o[1]=i[1]-(s[0][1]+(s[1][1]-s[0][1])/2)),n[2]&&(o[2]=i[2]-(s[0][2]+(s[1][2]-s[0][2])/2)),Die(o,e);},Sp=(r,...e)=>{let t={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:n,relativeTo:i}=Object.assign({},t,r);if(e=Nie(e),e.length===0)throw new Error("wrong number of arguments");if(i.length!==3)throw new Error("relativeTo must be an array of length 3");r={axes:n,relativeTo:i};let s=e.map(o=>kie.isA(o)||Lie.isA(o)||Oie.isA(o)?Z1(r,o):o);return s.length===1?s[0]:s;},Gie=(...r)=>Sp({axes:[!0,!1,!1]},r),Fie=(...r)=>Sp({axes:[!1,!0,!1]},r),qie=(...r)=>Sp({axes:[!1,!1,!0]},r);eO.exports={center:Sp,centerX:Gie,centerY:Fie,centerZ:qie};});var yc=G((JDe,sO)=>{var zie=Qe(),tO=Dt(),rO=tt(),nO=rt(),iO=kt(),Bp=(r,...e)=>{if(!Array.isArray(r))throw new Error("factors must be an array");if(e=zie(e),e.length===0)throw new Error("wrong number of arguments");for(r=r.slice();r.length<3;)r.push(1);if(r[0]<=0||r[1]<=0||r[2]<=0)throw new Error("factors must be positive");let t=tO.fromScaling(tO.create(),r),n=e.map(i=>iO.isA(i)?iO.transform(t,i):rO.isA(i)?rO.transform(t,i):nO.isA(i)?nO.transform(t,i):i);return n.length===1?n[0]:n;},Yie=(r,...e)=>Bp([r,1,1],e),Xie=(r,...e)=>Bp([1,r,1],e),Vie=(r,...e)=>Bp([1,1,r],e);sO.exports={scale:Bp,scaleX:Yie,scaleY:Xie,scaleZ:Vie};});var cO=G((eGe,uO)=>{var Wie=Qe(),oO=tt(),aO=rt(),lO=kt(),$ie=(r,...e)=>{if(e=Wie(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>lO.isA(n)?lO.transform(r,n):oO.isA(n)?oO.transform(r,n):aO.isA(n)?aO.transform(r,n):n);return t.length===1?t[0]:t;};uO.exports=$ie;});var fO=G((tGe,hO)=>{hO.exports={align:J4(),center:bc().center,centerX:bc().centerX,centerY:bc().centerY,centerZ:bc().centerZ,mirror:hl().mirror,mirrorX:hl().mirrorX,mirrorY:hl().mirrorY,mirrorZ:hl().mirrorZ,rotate:pl().rotate,rotateX:pl().rotateX,rotateY:pl().rotateY,rotateZ:pl().rotateZ,scale:yc().scale,scaleX:yc().scaleX,scaleY:yc().scaleY,scaleZ:yc().scaleZ,transform:cO(),translate:eo().translate,translateX:eo().translateX,translateY:eo().translateY,translateZ:eo().translateZ};});var pO=G((rGe,dO)=>{dO.exports={colors:TA(),curves:XA(),geometries:Dd(),maths:pM(),measurements:KM(),primitives:IR(),text:kR(),utils:h1(),booleans:ZN(),expansions:vL(),extrusions:qL(),hulls:A4(),modifiers:W4(),transforms:fO()};});var yO=G((nGe,J1)=>{"use strict";J1.exports=Ip,J1.exports.default=Ip;function Ip(r,e,t){t=t||2;var n=e&&e.length,i=n?e[0]*t:r.length,s=mO(r,0,i,t,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,u,c,h,d,f;if(n&&(s=Qie(r,e,s,t)),r.length>80*t){a=u=r[0],l=c=r[1];for(var p=t;p<i;p+=t)h=r[p],d=r[p+1],h<a&&(a=h),d<l&&(l=d),h>u&&(u=h),d>c&&(c=d);f=Math.max(u-a,c-l),f=f!==0?32767/f:0;}return wc(s,o,t,a,l,f,0),o;}function mO(r,e,t,n,i){var s,o;if(i===Q1(r,e,t,n)>0)for(s=e;s<t;s+=n)o=bO(s,r[s],r[s+1],o);else for(s=t-n;s>=e;s-=n)o=bO(s,r[s],r[s+1],o);return o&&Ap(o,o.next)&&(Ec(o),o=o.next),o;}function Zo(r,e){if(!r)return r;e||(e=r);var t=r,n;do if(n=!1,!t.steiner&&(Ap(t,t.next)||rr(t.prev,t,t.next)===0)){if(Ec(t),t=e=t.prev,t===t.next)break;n=!0;}else t=t.next;while(n||t!==e);return e;}function wc(r,e,t,n,i,s,o){if(!!r){!o&&s&&nse(r,n,i,s);for(var a=r,l,u;r.prev!==r.next;){if(l=r.prev,u=r.next,s?Zie(r,n,i,s):jie(r)){e.push(l.i/t|0),e.push(r.i/t|0),e.push(u.i/t|0),Ec(r),r=u.next,a=u.next;continue;}if(r=u,r===a){o?o===1?(r=Hie(Zo(r),e,t),wc(r,e,t,n,i,s,2)):o===2&&Kie(r,e,t,n,i,s):wc(Zo(r),e,t,n,i,s,1);break;}}}}function jie(r){var e=r.prev,t=r,n=r.next;if(rr(e,t,n)>=0)return!1;for(var i=e.x,s=t.x,o=n.x,a=e.y,l=t.y,u=n.y,c=i<s?i<o?i:o:s<o?s:o,h=a<l?a<u?a:u:l<u?l:u,d=i>s?i>o?i:o:s>o?s:o,f=a>l?a>u?a:u:l>u?l:u,p=n.next;p!==e;){if(p.x>=c&&p.x<=d&&p.y>=h&&p.y<=f&&Il(i,a,s,l,o,u,p.x,p.y)&&rr(p.prev,p,p.next)>=0)return!1;p=p.next;}return!0;}function Zie(r,e,t,n){var i=r.prev,s=r,o=r.next;if(rr(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,u=o.x,c=i.y,h=s.y,d=o.y,f=a<l?a<u?a:u:l<u?l:u,p=c<h?c<d?c:d:h<d?h:d,m=a>l?a>u?a:u:l>u?l:u,g=c>h?c>d?c:d:h>d?h:d,b=H1(f,p,e,t,n),y=H1(m,g,e,t,n),v=r.prevZ,E=r.nextZ;v&&v.z>=b&&E&&E.z<=y;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==i&&v!==o&&Il(a,c,l,h,u,d,v.x,v.y)&&rr(v.prev,v,v.next)>=0||(v=v.prevZ,E.x>=f&&E.x<=m&&E.y>=p&&E.y<=g&&E!==i&&E!==o&&Il(a,c,l,h,u,d,E.x,E.y)&&rr(E.prev,E,E.next)>=0))return!1;E=E.nextZ;}for(;v&&v.z>=b;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==i&&v!==o&&Il(a,c,l,h,u,d,v.x,v.y)&&rr(v.prev,v,v.next)>=0)return!1;v=v.prevZ;}for(;E&&E.z<=y;){if(E.x>=f&&E.x<=m&&E.y>=p&&E.y<=g&&E!==i&&E!==o&&Il(a,c,l,h,u,d,E.x,E.y)&&rr(E.prev,E,E.next)>=0)return!1;E=E.nextZ;}return!0;}function Hie(r,e,t){var n=r;do{var i=n.prev,s=n.next.next;!Ap(i,s)&&gO(i,n,n.next,s)&&vc(i,s)&&vc(s,i)&&(e.push(i.i/t|0),e.push(n.i/t|0),e.push(s.i/t|0),Ec(n),Ec(n.next),n=r=s),n=n.next;}while(n!==r);return Zo(n);}function Kie(r,e,t,n,i,s){var o=r;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&ose(o,a)){var l=xO(o,a);o=Zo(o,o.next),l=Zo(l,l.next),wc(o,e,t,n,i,s,0),wc(l,e,t,n,i,s,0);return;}a=a.next;}o=o.next;}while(o!==r);}function Qie(r,e,t,n){var i=[],s,o,a,l,u;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:r.length,u=mO(r,a,l,n,!1),u===u.next&&(u.steiner=!0),i.push(sse(u));for(i.sort(Jie),s=0;s<i.length;s++)t=ese(i[s],t);return t;}function Jie(r,e){return r.x-e.x;}function ese(r,e){var t=tse(r,e);if(!t)return e;var n=xO(t,r);return Zo(n,n.next),Zo(t,t.next);}function tse(r,e){var t=e,n=r.x,i=r.y,s=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var a=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=n&&a>s&&(s=a,o=t.x<t.next.x?t:t.next,a===n))return o;}t=t.next;}while(t!==e);if(!o)return null;var l=o,u=o.x,c=o.y,h=1/0,d;t=o;do n>=t.x&&t.x>=u&&n!==t.x&&Il(i<c?n:s,i,u,c,i<c?s:n,i,t.x,t.y)&&(d=Math.abs(i-t.y)/(n-t.x),vc(t,r)&&(d<h||d===h&&(t.x>o.x||t.x===o.x&&rse(o,t)))&&(o=t,h=d)),t=t.next;while(t!==l);return o;}function rse(r,e){return rr(r.prev,r,e.prev)<0&&rr(e.next,r,r.next)<0;}function nse(r,e,t,n){var i=r;do i.z===0&&(i.z=H1(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,ise(i);}function ise(r){var e,t,n,i,s,o,a,l,u=1;do{for(t=r,r=null,s=null,o=0;t;){for(o++,n=t,a=0,e=0;e<u&&(a++,n=n.nextZ,!!n);e++);for(l=u;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,a--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:r=i,i.prevZ=s,s=i;t=n;}s.nextZ=null,u*=2;}while(o>1);return r;}function H1(r,e,t,n,i){return r=(r-t)*i|0,e=(e-n)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1;}function sse(r){var e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t;}function Il(r,e,t,n,i,s,o,a){return(i-o)*(e-a)>=(r-o)*(s-a)&&(r-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(i-o)*(n-a);}function ose(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!ase(r,e)&&(vc(r,e)&&vc(e,r)&&lse(r,e)&&(rr(r.prev,r,e.prev)||rr(r,e.prev,e))||Ap(r,e)&&rr(r.prev,r,r.next)>0&&rr(e.prev,e,e.next)>0);}function rr(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y);}function Ap(r,e){return r.x===e.x&&r.y===e.y;}function gO(r,e,t,n){var i=Mp(rr(r,e,t)),s=Mp(rr(r,e,n)),o=Mp(rr(t,n,r)),a=Mp(rr(t,n,e));return!!(i!==s&&o!==a||i===0&&Cp(r,t,e)||s===0&&Cp(r,n,e)||o===0&&Cp(t,r,n)||a===0&&Cp(t,e,n));}function Cp(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y);}function Mp(r){return r>0?1:r<0?-1:0;}function ase(r,e){var t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&gO(t,t.next,r,e))return!0;t=t.next;}while(t!==r);return!1;}function vc(r,e){return rr(r.prev,r,r.next)<0?rr(r,e,r.next)>=0&&rr(r,r.prev,e)>=0:rr(r,e,r.prev)<0||rr(r,r.next,e)<0;}function lse(r,e){var t=r,n=!1,i=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n;}function xO(r,e){var t=new K1(r.i,r.x,r.y),n=new K1(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n;}function bO(r,e,t,n){var i=new K1(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i;}function Ec(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ);}function K1(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1;}Ip.deviation=function(r,e,t,n){var i=e&&e.length,s=i?e[0]*t:r.length,o=Math.abs(Q1(r,0,s,t));if(i)for(var a=0,l=e.length;a<l;a++){var u=e[a]*t,c=a<l-1?e[a+1]*t:r.length;o-=Math.abs(Q1(r,u,c,t));}var h=0;for(a=0;a<n.length;a+=3){var d=n[a]*t,f=n[a+1]*t,p=n[a+2]*t;h+=Math.abs((r[d]-r[p])*(r[f+1]-r[d+1])-(r[d]-r[f])*(r[p+1]-r[d+1]));}return o===0&&h===0?0:Math.abs((h-o)/o);};function Q1(r,e,t,n){for(var i=0,s=e,o=t-n;s<t;s+=n)i+=(r[o]-r[s])*(r[s+1]+r[o+1]),o=s;return i;}Ip.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},n=0,i=0;i<r.length;i++){for(var s=0;s<r[i].length;s++)for(var o=0;o<e;o++)t.vertices.push(r[i][s][o]);i>0&&(n+=r[i-1].length,t.holes.push(n));}return t;};});var zU=Object.create,Ob=Object.defineProperty,YU=Object.getOwnPropertyDescriptor,XU=Object.getOwnPropertyNames,VU=Object.getPrototypeOf,WU=Object.prototype.hasOwnProperty,$U=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),jU=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of XU(e))!WU.call(r,i)&&i!==t&&Ob(r,i,{get:()=>e[i],enumerable:!(n=YU(e,i))||n.enumerable});return r;},ZU=(r,e,t)=>(t=r!=null?zU(VU(r)):{},jU(e||!r||!r.__esModule?Ob(t,"default",{value:r,enumerable:!0}):t,r)),HU=$U((r,e)=>{"use strict";e.exports=t,e.exports.default=t;function t(U,D,k){k=k||2;var ie=D&&D.length,se=ie?D[0]*k:U.length,oe=n(U,0,se,k,!0),le=[];if(!oe||oe.next===oe.prev)return le;var Ee,be,xe,Oe,Re,Ve,lt;if(ie&&(oe=c(U,D,oe,k)),U.length>80*k){Ee=xe=U[0],be=Oe=U[1];for(var R=k;R<se;R+=k)Re=U[R],Ve=U[R+1],Re<Ee&&(Ee=Re),Ve<be&&(be=Ve),Re>xe&&(xe=Re),Ve>Oe&&(Oe=Ve);lt=Math.max(xe-Ee,Oe-be),lt=lt!==0?32767/lt:0;}return s(oe,le,k,Ee,be,lt,0),le;}function n(U,D,k,ie,se){var oe,le;if(se===Y(U,D,k,ie)>0)for(oe=D;oe<k;oe+=ie)le=Z(oe,U[oe],U[oe+1],le);else for(oe=k-ie;oe>=D;oe-=ie)le=Z(oe,U[oe],U[oe+1],le);return le&&M(le,le.next)&&(H(le),le=le.next),le;}function i(U,D){if(!U)return U;D||(D=U);var k=U,ie;do if(ie=!1,!k.steiner&&(M(k,k.next)||P(k.prev,k,k.next)===0)){if(H(k),k=D=k.prev,k===k.next)break;ie=!0;}else k=k.next;while(ie||k!==D);return D;}function s(U,D,k,ie,se,oe,le){if(U){!le&&oe&&m(U,ie,se,oe);for(var Ee=U,be,xe;U.prev!==U.next;){if(be=U.prev,xe=U.next,oe?a(U,ie,se,oe):o(U)){D.push(be.i/k|0),D.push(U.i/k|0),D.push(xe.i/k|0),H(U),U=xe.next,Ee=xe.next;continue;}if(U=xe,U===Ee){le?le===1?(U=l(i(U),D,k),s(U,D,k,ie,se,oe,2)):le===2&&u(U,D,k,ie,se,oe):s(i(U),D,k,ie,se,oe,1);break;}}}}function o(U){var D=U.prev,k=U,ie=U.next;if(P(D,k,ie)>=0)return!1;for(var se=D.x,oe=k.x,le=ie.x,Ee=D.y,be=k.y,xe=ie.y,Oe=se<oe?se<le?se:le:oe<le?oe:le,Re=Ee<be?Ee<xe?Ee:xe:be<xe?be:xe,Ve=se>oe?se>le?se:le:oe>le?oe:le,lt=Ee>be?Ee>xe?Ee:xe:be>xe?be:xe,R=ie.next;R!==D;){if(R.x>=Oe&&R.x<=Ve&&R.y>=Re&&R.y<=lt&&v(se,Ee,oe,be,le,xe,R.x,R.y)&&P(R.prev,R,R.next)>=0)return!1;R=R.next;}return!0;}function a(U,D,k,ie){var se=U.prev,oe=U,le=U.next;if(P(se,oe,le)>=0)return!1;for(var Ee=se.x,be=oe.x,xe=le.x,Oe=se.y,Re=oe.y,Ve=le.y,lt=Ee<be?Ee<xe?Ee:xe:be<xe?be:xe,R=Oe<Re?Oe<Ve?Oe:Ve:Re<Ve?Re:Ve,me=Ee>be?Ee>xe?Ee:xe:be>xe?be:xe,fe=Oe>Re?Oe>Ve?Oe:Ve:Re>Ve?Re:Ve,K=b(lt,R,D,k,ie),j=b(me,fe,D,k,ie),re=U.prevZ,he=U.nextZ;re&&re.z>=K&&he&&he.z<=j;){if(re.x>=lt&&re.x<=me&&re.y>=R&&re.y<=fe&&re!==se&&re!==le&&v(Ee,Oe,be,Re,xe,Ve,re.x,re.y)&&P(re.prev,re,re.next)>=0||(re=re.prevZ,he.x>=lt&&he.x<=me&&he.y>=R&&he.y<=fe&&he!==se&&he!==le&&v(Ee,Oe,be,Re,xe,Ve,he.x,he.y)&&P(he.prev,he,he.next)>=0))return!1;he=he.nextZ;}for(;re&&re.z>=K;){if(re.x>=lt&&re.x<=me&&re.y>=R&&re.y<=fe&&re!==se&&re!==le&&v(Ee,Oe,be,Re,xe,Ve,re.x,re.y)&&P(re.prev,re,re.next)>=0)return!1;re=re.prevZ;}for(;he&&he.z<=j;){if(he.x>=lt&&he.x<=me&&he.y>=R&&he.y<=fe&&he!==se&&he!==le&&v(Ee,Oe,be,Re,xe,Ve,he.x,he.y)&&P(he.prev,he,he.next)>=0)return!1;he=he.nextZ;}return!0;}function l(U,D,k){var ie=U;do{var se=ie.prev,oe=ie.next.next;!M(se,oe)&&I(se,ie,ie.next,oe)&&T(se,oe)&&T(oe,se)&&(D.push(se.i/k|0),D.push(ie.i/k|0),D.push(oe.i/k|0),H(ie),H(ie.next),ie=U=oe),ie=ie.next;}while(ie!==U);return i(ie);}function u(U,D,k,ie,se,oe){var le=U;do{for(var Ee=le.next.next;Ee!==le.prev;){if(le.i!==Ee.i&&E(le,Ee)){var be=$(le,Ee);le=i(le,le.next),be=i(be,be.next),s(le,D,k,ie,se,oe,0),s(be,D,k,ie,se,oe,0);return;}Ee=Ee.next;}le=le.next;}while(le!==U);}function c(U,D,k,ie){var se=[],oe,le,Ee,be,xe;for(oe=0,le=D.length;oe<le;oe++)Ee=D[oe]*ie,be=oe<le-1?D[oe+1]*ie:U.length,xe=n(U,Ee,be,ie,!1),xe===xe.next&&(xe.steiner=!0),se.push(y(xe));for(se.sort(h),oe=0;oe<se.length;oe++)k=d(se[oe],k);return k;}function h(U,D){return U.x-D.x;}function d(U,D){var k=f(U,D);if(!k)return D;var ie=$(k,U);return i(ie,ie.next),i(k,k.next);}function f(U,D){var k=D,ie=U.x,se=U.y,oe=-1/0,le;do{if(se<=k.y&&se>=k.next.y&&k.next.y!==k.y){var Ee=k.x+(se-k.y)*(k.next.x-k.x)/(k.next.y-k.y);if(Ee<=ie&&Ee>oe&&(oe=Ee,le=k.x<k.next.x?k:k.next,Ee===ie))return le;}k=k.next;}while(k!==D);if(!le)return null;var be=le,xe=le.x,Oe=le.y,Re=1/0,Ve;k=le;do ie>=k.x&&k.x>=xe&&ie!==k.x&&v(se<Oe?ie:oe,se,xe,Oe,se<Oe?oe:ie,se,k.x,k.y)&&(Ve=Math.abs(se-k.y)/(ie-k.x),T(k,U)&&(Ve<Re||Ve===Re&&(k.x>le.x||k.x===le.x&&p(le,k)))&&(le=k,Re=Ve)),k=k.next;while(k!==be);return le;}function p(U,D){return P(U.prev,U,D.prev)<0&&P(D.next,U,U.next)<0;}function m(U,D,k,ie){var se=U;do se.z===0&&(se.z=b(se.x,se.y,D,k,ie)),se.prevZ=se.prev,se.nextZ=se.next,se=se.next;while(se!==U);se.prevZ.nextZ=null,se.prevZ=null,g(se);}function g(U){var D,k,ie,se,oe,le,Ee,be,xe=1;do{for(k=U,U=null,oe=null,le=0;k;){for(le++,ie=k,Ee=0,D=0;D<xe&&(Ee++,ie=ie.nextZ,!!ie);D++);for(be=xe;Ee>0||be>0&&ie;)Ee!==0&&(be===0||!ie||k.z<=ie.z)?(se=k,k=k.nextZ,Ee--):(se=ie,ie=ie.nextZ,be--),oe?oe.nextZ=se:U=se,se.prevZ=oe,oe=se;k=ie;}oe.nextZ=null,xe*=2;}while(le>1);return U;}function b(U,D,k,ie,se){return U=(U-k)*se|0,D=(D-ie)*se|0,U=(U|U<<8)&16711935,U=(U|U<<4)&252645135,U=(U|U<<2)&858993459,U=(U|U<<1)&1431655765,D=(D|D<<8)&16711935,D=(D|D<<4)&252645135,D=(D|D<<2)&858993459,D=(D|D<<1)&1431655765,U|D<<1;}function y(U){var D=U,k=U;do(D.x<k.x||D.x===k.x&&D.y<k.y)&&(k=D),D=D.next;while(D!==U);return k;}function v(U,D,k,ie,se,oe,le,Ee){return(se-le)*(D-Ee)>=(U-le)*(oe-Ee)&&(U-le)*(ie-Ee)>=(k-le)*(D-Ee)&&(k-le)*(oe-Ee)>=(se-le)*(ie-Ee);}function E(U,D){return U.next.i!==D.i&&U.prev.i!==D.i&&!S(U,D)&&(T(U,D)&&T(D,U)&&B(U,D)&&(P(U.prev,U,D.prev)||P(U,D.prev,D))||M(U,D)&&P(U.prev,U,U.next)>0&&P(D.prev,D,D.next)>0);}function P(U,D,k){return(D.y-U.y)*(k.x-D.x)-(D.x-U.x)*(k.y-D.y);}function M(U,D){return U.x===D.x&&U.y===D.y;}function I(U,D,k,ie){var se=L(P(U,D,k)),oe=L(P(U,D,ie)),le=L(P(k,ie,U)),Ee=L(P(k,ie,D));return!!(se!==oe&&le!==Ee||se===0&&C(U,k,D)||oe===0&&C(U,ie,D)||le===0&&C(k,U,ie)||Ee===0&&C(k,D,ie));}function C(U,D,k){return D.x<=Math.max(U.x,k.x)&&D.x>=Math.min(U.x,k.x)&&D.y<=Math.max(U.y,k.y)&&D.y>=Math.min(U.y,k.y);}function L(U){return U>0?1:U<0?-1:0;}function S(U,D){var k=U;do{if(k.i!==U.i&&k.next.i!==U.i&&k.i!==D.i&&k.next.i!==D.i&&I(k,k.next,U,D))return!0;k=k.next;}while(k!==U);return!1;}function T(U,D){return P(U.prev,U,U.next)<0?P(U,D,U.next)>=0&&P(U,U.prev,D)>=0:P(U,D,U.prev)<0||P(U,U.next,D)<0;}function B(U,D){var k=U,ie=!1,se=(U.x+D.x)/2,oe=(U.y+D.y)/2;do k.y>oe!=k.next.y>oe&&k.next.y!==k.y&&se<(k.next.x-k.x)*(oe-k.y)/(k.next.y-k.y)+k.x&&(ie=!ie),k=k.next;while(k!==U);return ie;}function $(U,D){var k=new W(U.i,U.x,U.y),ie=new W(D.i,D.x,D.y),se=U.next,oe=D.prev;return U.next=D,D.prev=U,k.next=se,se.prev=k,ie.next=k,k.prev=ie,oe.next=ie,ie.prev=oe,ie;}function Z(U,D,k,ie){var se=new W(U,D,k);return ie?(se.next=ie.next,se.prev=ie,ie.next.prev=se,ie.next=se):(se.prev=se,se.next=se),se;}function H(U){U.next.prev=U.prev,U.prev.next=U.next,U.prevZ&&(U.prevZ.nextZ=U.nextZ),U.nextZ&&(U.nextZ.prevZ=U.prevZ);}function W(U,D,k){this.i=U,this.x=D,this.y=k,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1;}t.deviation=function(U,D,k,ie){var se=D&&D.length,oe=se?D[0]*k:U.length,le=Math.abs(Y(U,0,oe,k));if(se)for(var Ee=0,be=D.length;Ee<be;Ee++){var xe=D[Ee]*k,Oe=Ee<be-1?D[Ee+1]*k:U.length;le-=Math.abs(Y(U,xe,Oe,k));}var Re=0;for(Ee=0;Ee<ie.length;Ee+=3){var Ve=ie[Ee]*k,lt=ie[Ee+1]*k,R=ie[Ee+2]*k;Re+=Math.abs((U[Ve]-U[R])*(U[lt+1]-U[Ve+1])-(U[Ve]-U[lt])*(U[R+1]-U[Ve+1]));}return le===0&&Re===0?0:Math.abs((Re-le)/le);};function Y(U,D,k,ie){for(var se=0,oe=D,le=k-ie;oe<k;oe+=ie)se+=(U[le]-U[oe])*(U[oe+1]+U[le+1]),le=oe;return se;}t.flatten=function(U){for(var D=U[0][0].length,k={vertices:[],holes:[],dimensions:D},ie=0,se=0;se<U.length;se++){for(var oe=0;oe<U[se].length;oe++)for(var le=0;le<D;le++)k.vertices.push(U[se][oe][le]);se>0&&(ie+=U[se-1].length,k.holes.push(ie));}return k;};}),im=new ArrayBuffer(8),Jo=new Float64Array(im),ea=new Uint32Array(im),Fc=new Uint16Array(im),sm=ArrayBuffer;try{sm=self.HTMLImageElement||sm;}catch{}function kb(r){if(typeof r!="object"||r===null||r instanceof Date||r instanceof ArrayBuffer||r instanceof Blob||r instanceof FormData||r instanceof Function||r instanceof Uint8ClampedArray||r instanceof sm)return r;if(Array.isArray(r))return r.map(kb);{let e={};for(let t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=kb(r[t]));return e;}}function mse(r,e){return KU(r,e,()=>[]);}function KU(r,e,t){let n=r[e];return n!==void 0||(n=t(e),r[e]=n),n;}function gse(r,e){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(e(void 0,r[t],t)===!1)return;}else{let t=0;for(let n in r)if(r.hasOwnProperty(n)){let i=r[n];if(e(n,i,t)===!1)return;t++;}}}var QU=Object.prototype.hasOwnProperty;async function xse(r,e){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if((await e(void 0,r[t],t))===!1)return;}else{let t=0;for(let n in r)if(QU.call(r,n)){let i=r[n];if((await e(n,i,t))===!1)return;t++;}}}function bse(r,e,t){return typeof r=="string"&&(/https?:/.test(r)||(r=location.origin+r)),Promise.race([fetch(r,e),new Promise((n,i)=>setTimeout(i,t))]);}function yse(r,e){let t=0,n=0;return(...i)=>{let s=++t;setTimeout(()=>{let o=performance.now();if(s===t||o-n>=r){try{e(...i);}catch(a){console.log(a);}n=o;}},Math.max(0,r-(performance.now()-n)));};}function wse(r,e){let t=r.length,n=0;for(;n<t;){let i=r.indexOf(`
`,n);i<0&&(i=t);let s=r.substring(n,i);try{if(e(s)===!1)return;}catch(o){console.error(o);}n=i+1;}}function vse(r){let e=null;return()=>(e===null&&(e=r()),e);}var om=0;function Ese(){om===0&&(om=Date.now()-performance.now());let r=new Array(),e=om+performance.now();Jo[0]=e,r.push(ea[1].toString(16)),Jo[0]=Math.random(),r.push(Fc[3].toString(16));let t=Fc[2].toString(16);r.push("4"+t.substr(0,3)),Jo[0]=e;let n=ea[0].toString(16)+ea[1].toString(16);return r.push("0"+n.substr(0,3)),r.push(n.substr(3)),r.join("-");}var Pse=class{constructor(r){this.resources=r,this.idle=[];}acquire(r){this.resources>0?(this.resources--,r()):this.idle.push(r);}acquire1(r){return this.resources>0?(this.resources--,r()):this.acquireSync().then(r);}acquireSync(){return new Promise(r=>{this.acquire(r);});}release(){let r=this.idle.shift();r?Promise.resolve().then(r):this.resources++;}getWaitingNum(){return this.idle.length;}};function _se(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global;}function Sse(r,e,t){let n=r.length+e-1;for(let i=0;i<n;i++){let s=new Array();for(let o=i-e+1;o<=i;o++)s.push(r[o]);if(t(s)===!1)break;}}function Bse(){let r=new Date(),e=r.getFullYear(),t=r.getMonth()+1,n=r.getDate(),i=r.getHours(),s=r.getMinutes(),o=r.getSeconds(),a=r.getMilliseconds();return"["+e+"-"+(t<10?"0"+t:t)+"-"+(n<10?"0"+n:n)+" "+(i<10?"0"+i:i)+":"+(s<10?"0"+s:s)+":"+(o<10?"0"+o:o)+"."+(a<100?a<10?"00"+a:"0"+a:a)+"] ";}async function Ise(r){let e=typeof r=="string"?new TextEncoder().encode(r):r,t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(n=>n.toString(16).padStart(2,"0")).join("");}var qc=null;function Ui(r,e,t=0,n=r.length){i(r,null,e,t,n);function i(o,a,l,u,c){let h,d,f,p;if(u<c-1){let m=c-u;if(m>50)a===null&&(a=new Array(m+1)),s(o,a,l,u,(u+c)/2|0,c);else{h=o[u],d=u,f=u,p=c;let g=d+1;for(;g<p;){if(f!=p){if(p=p+-1,l(h,o[p])<=0)continue;o[f]=o[p],f=p;continue;}if(l(h,o[g])>=0){d=g,g=d+1;continue;}o[f]=o[g],d=g,f=g,g=d+1;}o[f]=h,i(o,a,l,u,f),i(o,a,l,f+1,c);}}}function s(o,a,l,u,c,h){i(o,a,l,u,c),i(o,a,l,c,h);for(var d=u,f=c,p=0,m=o[d],g=o[f];d<c&&f<h;){var b=l(m,g);isNaN(b)?(a[p++]=g,g=o[++f]):(b<=0&&(a[p++]=m,m=o[++d]),b>=0&&(a[p++]=g,g=o[++f]));}for(;d<c;d++)a[p++]=o[d];for(;f<h;f++)a[p++]=o[f];for(d=u,f=0;f<p;d++,f++)o[d]=a[f];}}var wr=class{static repeat(r,e){let t=new Array(e);for(;e-->0;)t[e]=r;return t.join("");}static lpad(r,e,t){let n=t-r.length;return n>0?this.repeat(e,n)+r:r;}static rpad(r,e,t){let n=t-r.length;return n>0?r+this.repeat(e,n):r;}static strHashcode(r){if(r.length>0){let e=0;for(let t=0;t<r.length;t++)e=31*e+r.charCodeAt(t)|0;return e;}else return 0;}static arraycopy(r,e,t,n,i){if(r.length>=e+i&&t.length>=n+i)for(;i-->0;)t[n++]=r[e++];else throw new Error("arraycopy out of range");}static undefAsNull(r){return null;}static reverse(r,e){for(let t=0,n=r.length-1;n>=0;t++,n--)e[t]=r[n];return e;}static sortAsc(r,e){return r-e;}static xmlDecode(r){let e=r.length,t=new Array(),n=-1;for(let i=0;i<e;i++){let s=r.charAt(i);if(n>=0){if(s===";"){let o=r.substring(n+1,i);switch(o){case"lt":t.push("<");break;case"gt":t.push(">");break;case"quot":t.push('"');break;case"apos":t.push("'");break;case"amp":t.push("&");break;default:if(o.charAt(0)==="#"){let a=parseInt(o.substring(1));t.push(String.fromCharCode(a));}else t.push("&"+o+";");}n=-1;}}else s==="&"?n=i:t.push(s);}return n>=0&&t.push(r.substring(n)),t.join("");}static addAll(r,e){for(let t of e)r.push(t);}static addAllSet(r,e){for(let t of e)r.add(t);}static contains(r,e){for(let t of r)if(t.equals(e))return!0;return!1;}static equals(r,e){if(r.length==e.length){for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0;}else return!1;}static remove(r,e){let t=0,n=r.length;for(let i=0;i<n;i++)r[i]===e&&(r.splice(i,1),i--,n--,t++);return t;}static getUrlVars(){for(var r={},e=location.href.slice(location.href.indexOf("?")+1).split("&"),t=0;t<e.length;t++){var n=e[t].split("=");r[decodeURIComponent(n[0])]=decodeURIComponent(n[1]);}return r;}static prefix(){if(!qc){let r=this.getUrlVars().version;r?qc="/analyzer/v"+r:qc="/analyzer";}return qc;}static add2objS(r,e,t){if(e in r)return r[e];{let n=t(e);return r[e]=n,n;}}static downloadFile(r,e){let t=document.createElement("a"),n=URL.createObjectURL(e);t.download=r,t.href=n,t.click(),URL.revokeObjectURL(n);}static uuid(){let r=new Array();Jo[0]=new Date().getTime(),r.push(ea[1].toString(16)),Jo[0]=Math.random(),r.push(Fc[3].toString(16));let e=Fc[2].toString(16);r.push("4"+e.substr(0,3)),Jo[0]=performance.now();let t=ea[0].toString(16)+ea[1].toString(16);return r.push("0"+t.substr(0,3)),r.push(t.substr(3)),r.join("-");}static funcCopy(r){return(0,eval)("("+r.toString()+")");}static NVL(...r){for(let e of r)if(e!==null)return e;return null;}static isSingle(r){return Array.from(new Set(r)).length===r.length;}},JU=[1,10,100,1e3];function Ase(r){return typeof r=="number"&&!isNaN(r);}var zc=0,co=0;function Ub(r,e,t){return zc=Math.abs(r-e),t>=5&&zc>1e-5||isNaN(t)&&zc>1e-8?!1:zc<1e-13?!0:(co=Math.min(Db(r),Db(e)),co<10&&(co=10),isNaN(t)||(co=Math.min(co,t)),Gb(r,co)===Gb(e,co));}var Yc=0,Xc=0;function Db(r){return Yc=0,Xc=0,r>0?Yc=r-Math.floor(r):Yc=r-Math.ceil(r),Xc=(Yc.toString()||"").length,Xc>2?Xc-2:0;}function Gb(r,e,t){if(typeof r!="number"&&(r=+r),isNaN(r))return NaN;if(e=e|0,e<=0||!r&&!t)return Math.round(r);var n=JU[e]||Math.pow(10,e)||10;if(t){var i=r<0?"-":"";for(r=r<0?-r:r,r=Math.round(r*n)+"";r.length<=e;)r="0"+r;return r=r.slice(0,-e)+"."+r.slice(-e),parseFloat(i+r);}else return Math.round(r*n+1e-10)/n;}var eD=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.PERCENT=1]="PERCENT",r[r.LEFT_PAD0=2]="LEFT_PAD0",r))(eD||{}),tD=/(\.?0+)$/,ta=class{static format(r,...e){return this.format1(r,e);}static format1(r,e){let t=this._format(r,e);if(typeof t=="string")return t;throw new Error(this.format("Invalid state on (%d) %s",t,r));}static _format(r,e){let t=[],n=0,i=0,s,o=0,a=0;for(let l=0;l<r.length;l++){let u=r.charAt(l),c=u.charCodeAt(0);switch(n){case 0:c===37?n=1:t.push(u);break;case 1:switch(c){case 100:if(s=e[i++],typeof s=="number")t.push(s.toFixed(0)),n=0;else return l;break;case 102:if(s=e[i++],typeof s=="number")t.push(s.toString()),n=0;else return l;break;case 120:if(s=e[i++],typeof s=="number")t.push((s|0).toString(16)),n=0;else return l;break;case 88:if(s=e[i++],typeof s=="number")t.push((s|0).toString(16).toUpperCase()),n=0;else return l;break;case 115:case 99:s=e[i++],t.push(s===null?"null":s.toString()),n=0;break;case 48:o=l+1,a=-1,n=2;break;case 37:t.push("%"),n=0;break;default:return l;}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a=l;break;case 120:if(a>=o){let h=parseInt(r.substring(o,a+1));if(s=e[i++],typeof s=="number")t.push(wr.lpad((s|0).toString(16),"0",h)),n=0;else return l;}else return l;break;case 88:if(a>=o){let h=parseInt(r.substring(o,a+1));if(s=e[i++],typeof s=="number")t.push(wr.lpad((s|0).toString(16).toUpperCase(),"0",h)),n=0;else return l;}else return l;break;default:return l;}break;default:return l;}}return t.join("");}static startsWith(r,e){return r.length>=e.length?r.substring(0,e.length)===e:!1;}static endsWith(r,e){return r.length>=e.length?r.substring(r.length-e.length)===e:!1;}static split(r,e){let t=new Array(),n=0;for(;;){let i=r.exec(e);if(i!==null){let s=r.lastIndex-i[0].length;t.push(e.substring(n,s)),n=r.lastIndex;}else{let s=e.substring(n);st.nullOrEmpty(s)||t.push(s);break;}}return t;}static fmtNumber(r){return r.toFixed(5).replace(tD,"");}},st=class{static rgb(r){if(0<=r&&r<=255)return r;throw new Error(ta.format("RGB should not nagative and not over 255(0xFF): %X",r));}static normal(r){if(isFinite(r))return r;throw new Error(ta.format("%f is not permitted",r));}static positiveOr0(r){if(r>=0)return r;throw new Error(ta.format("%f must >= 0",r));}static positive(r){if(r>0)return r;throw new Error(ta.format("%f must > 0",r));}static notnull(r){if(r!=null)return r;throw new Error("invalid null value");}static mustnull(r){if(r===null)return null;throw new Error("value must be null");}static notEmpty(r){if(r==null||r.length===0)throw new Error("invalid empty string");return r;}static nullOrEmpty(r){return r==null||r.length===0;}static notNullOrUndef(r){if(r!=null)return r;throw new Error("null or undefined is not permitted");}},ue=(_class=class ue{static regular(r){return Math.round(r*this.precision)/this.precision;}static eq(r,e){return Math.abs(r-e)<=this.eps;}static neq(r,e){return Math.abs(r-e)>this.eps;}static less(r,e){return r-e<-this.eps;}static lesseq(r,e){return r-e<=this.eps;}static greater(r,e){return r-e>this.eps;}static greatereq(r,e){return r-e>=-this.eps;}static sqrt(r){return Math.abs(r)<=1e-10?0:Math.sqrt(r);}static sortAsc(r,e){return r-e;}static sortDesc(r,e){return e-r;}},_class.eps=1e-8,_class.precision=1e8,_class);function ra(r,e){Vc(r.iterator(),e);}function Vc(r,e){let t=0;for(;r.hasNext();){let n=r.next();e(t++,n);}}var rD=class{constructor(r){this.lst=r;}iterator(){return new Fb(this.lst);}},Fb=class{constructor(r){this.idx=-1,this.lst=r;}hasNext(){return this.idx<this.lst.length-1;}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug");}};function Cse(r){return new rD(r);}function Wc(r){return new Fb(r);}var Xe=(_class2=class pn{static toDegrees(e){return e*180/Math.PI;}static toRadians(e){return e/180*Math.PI;}static regularD(e){return e=e%360,e=e<0?360+e:e,e===360?0:e;}static regular(e){return e=e%pn.PIx2,e=e<0?pn.PIx2+e:e,e===pn.PIx2?0:e;}static toQuarterBase(e){return pn.regular((e+pn.PI_4)/pn.PI_2*pn.PI_2);}static toQuarterBaseD(e){return pn.regularD(((e+45)/90|0)*90);}static transformD(e,t){return pn.toDegrees(pn.transform(pn.toRadians(e),t));}static transform(e,t){let n=Math.cos(e),i=Math.sin(e),s=new F(t.data[6],t.data[7]),o=new F(n,i).multiply3(t);return pn.regular(o.angle(s));}},_class2.PIx2=Math.PI*2,_class2.PI_2=Math.PI/2,_class2.PI_4=Math.PI/4,_class2),Yt=class{static dotProd1(r,e,t,n){return r*t+e*n;}static dotProd2(r,e,t,n,i,s){return this.dotProd1(t-r,n-e,i-t,s-n);}static dotProd3(r,e,t){return this.dotProd2(r.x,r.y,e.x,e.y,t.x,t.y);}static crossProd1(r,e,t,n){return r*n-e*t;}static crossProd2(r,e,t,n,i,s){return this.crossProd1(t-r,n-e,i-t,s-n);}static crossProd3(r,e,t){return this.crossProd2(r.x,r.y,e.x,e.y,t.x,t.y);}static distance2(r,e,t,n){let i=t-r,s=n-e;return i*i+s*s;}static distance1(r,e,t,n){return this.hypot(t-r,n-e);}static distance1p(r,e){return this.distance1(r.x,r.y,e.x,e.y);}static hypot(r,e){if(r=Math.abs(r),e=Math.abs(e),e>r){var t=e;e=r,r=t;}if(r===0)return e;var n=e/r;return r*Math.sqrt(1+n*n);}},qb=new ArrayBuffer(16),zb=new Float64Array(qb),$c=new Int32Array(qb),F=(_class3=class Bt{static sortByXAsc(e,t){return e.x-t.x;}static sortByYAsc(e,t){return e.y-t.y;}static sortByXYAsc(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y-t.y;}static caculateAngle(e,t){let n=Math.cos(e),i=Math.sin(e),s=n*t.data[0]+i*t.data[4],o=n*t.data[1]+i*t.data[5],a=new Bt(s,o).normalize();return Math.atan2(a.y,a.x);}static normal(e,t,n){let i=t.sub(e),s=n.sub(t);return i.cross(s);}static getVector2(e){return new Bt(Math.cos(e),Math.sin(e));}static getCrossPoint1(e,t,n,i){if(e.equals1(t)||n.equals1(i)||ue.eq(1,Math.abs(t.sub(e).normalize().dot(i.sub(n).normalize()))))return null;let s=t.y-e.y,o=e.x-t.x,a=t.x*e.y-e.x*t.y,l=i.y-n.y,u=n.x-i.x,c=i.x*n.y-n.x*i.y,h=s*u-l*o;return new Bt((c*o-a*u)/h,(a*l-c*s)/h);}static getCrossPoint2(e,t,n,i){return this.getCrossPoint1(e,e.add(t),n,n.add(i));}constructor(e,t){this.x=st.normal(e),this.y=st.normal(t);}get hashed(){return this._hashed==null&&(zb[0]=this.x,zb[1]=this.y,this._hashed=$c[0]^$c[1]^$c[2]^$c[3]),this._hashed;}dot(e){return this.x*e.x+this.y*e.y;}length(){return Math.sqrt(this.dot(this));}getCos(){return this.x/this.length();}sub(e){var t=this.x-e.x,n=this.y-e.y;return new Bt(t,n);}add(e){var t=this.x+e.x,n=this.y+e.y;return new Bt(t,n);}div(e){return new Bt(this.x/e,this.y/e);}add1(e,t){return new Bt(this.x+e,this.y+t);}mul(e){return new Bt(this.x*e,this.y*e);}cross(e){return this.x*e.y-this.y*e.x;}getSin(){return this.y/this.length();}angle2(e){let t=this.y-e.y,n=this.x-e.x;return t=Math.abs(t-0)<10**-4?0:t,n=Math.abs(n-0)<10**-4?0:n,Math.atan2(t,n);}angleD2(e){return Xe.toDegrees(this.angle2(e));}angle(e){return Math.atan2(this.y-e.y,this.x-e.x);}angleX(e=Bt.ORIGIN){let t=this.angle(e);return t<0&&(t=Math.PI*2+t),t;}angleD(e){return Xe.toDegrees(this.angle(e));}distance1(e){let t=e.x-this.x,n=e.y-this.y;return Yt.hypot(t,n);}distance2(e){let t=e.x-this.x,n=e.y-this.y;return t*t+n*n;}rotateD(e,t){return this.rotate(e,Xe.toRadians(t));}rotate(e,t){let n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y,a=s*n+o*-i,l=s*i+o*n;return e.add1(a,l);}multiply3(e){let t=this.x*e.data[0]+this.y*e.data[3]+e.data[6],n=this.x*e.data[1]+this.y*e.data[4]+e.data[7];return new Bt(t,n);}multiply4(e){let t=this.x*e.data[0]+this.y*e.data[4]+e.data[12],n=this.x*e.data[1]+this.y*e.data[5]+e.data[13];return new Bt(t,n);}hashCode(){return this.hashed;}equals(e,t){return e instanceof Bt?Ub(e.x,this.x,t)&&Ub(e.y,this.y,t):!1;}equals1(e){return e?ue.eq(this.x,e.x)&&ue.eq(this.y,e.y):!1;}equals2(e,t){return e instanceof Bt?Math.abs(this.x-e.x)<=t&&Math.abs(this.y-e.y)<=t:!1;}similarEquals(e,t=.5){return Math.abs(this.x*.1-e.x*.1)<=t&&Math.abs(this.y*.1-e.y*.1)<=t;}toString(){return"Vector [X="+this.x+", Y="+this.y+"]";}bbox(){let e=this.x,t=this.y;return new ye(e,e,t,t);}normalize(){if(this.x===0&&this.y===0)return new Bt(0,0);let e=this.x/this.length(),t=this.y/this.length();return new Bt(e,t);}regular(e=1e-4){let t=Math.round(1/e);return new Bt(Math.round(this.x*t)/t,Math.round(this.y*t)/t);}round(e=4){let t=10**(e|0);return new Bt(Math.round(this.x*t)/t,Math.round(this.y*t)/t);}mirrorX(e=Bt.ORIGIN){return new Bt(this.x,2*e.y-this.y);}mirrorY(e=Bt.ORIGIN){return new Bt(2*e.x-this.x,this.y);}mirrorCenter(e=Bt.ORIGIN){return new Bt(2*e.x-this.x,2*e.y-this.y);}clone(){return new Bt(this.x,this.y);}mirror(e=Bt.ORIGIN){return new Bt(2*e.x-this.x,2*e.y-this.y);}pointOnRays(e,t){let n=Xe.toRadians(e);return new Bt(this.x+Math.cos(n)*t,this.y+Math.sin(n)*t);}pointOnRays2(e,t){let n=e.angle(this);return new Bt(this.x+Math.cos(n)*t,this.y+Math.sin(n)*t);}scale(e){return new Bt(this.x*e,this.y*e);}},_class3.ORIGIN=new _class3(0,0),_class3.X_UNIT_VECTOR=new _class3(1,0),_class3.Y_UNIT_VECTOR=new _class3(0,1),_class3),Yb=(r=>(r[r.LEFT=0]="LEFT",r[r.CENTER=1]="CENTER",r[r.RIGHT=2]="RIGHT",r))(Yb||{}),Xb=(r=>(r[r.TOP=0]="TOP",r[r.CENTER=1]="CENTER",r[r.BOTTOM=2]="BOTTOM",r))(Xb||{}),ci=(_class4=class mi{constructor(e,t){this.horizontal=e,this.vertical=t;}},_class4.LT=new _class4(0,0),_class4.LC=new _class4(0,1),_class4.LB=new _class4(0,2),_class4.CT=new _class4(1,0),_class4.CC=new _class4(1,1),_class4.CB=new _class4(1,2),_class4.RT=new _class4(2,0),_class4.RC=new _class4(2,1),_class4.RB=new _class4(2,2),_class4),nD=(r=>(r[r.INNER=0]="INNER",r[r.OUTER=1]="OUTER",r[r.SEPARATED=2]="SEPARATED",r[r.INTERSECTED=3]="INTERSECTED",r[r.EQ=4]="EQ",r[r.INSIDE_TOUCHED=5]="INSIDE_TOUCHED",r[r.OUTSIDE_TOUCHED=6]="OUTSIDE_TOUCHED",r))(nD||{}),ke=class{constructor(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY;}ext1(r){return this.minX=Math.min(this.minX,r.minX),this.maxX=Math.max(this.maxX,r.maxX),this.minY=Math.min(this.minY,r.minY),this.maxY=Math.max(this.maxY,r.maxY),this;}ext2(r){return this.minX=Math.min(this.minX,r.x),this.maxX=Math.max(this.maxX,r.x),this.minY=Math.min(this.minY,r.y),this.maxY=Math.max(this.maxY,r.y),this;}ext3(r){for(let e=0;e<r.length;e++){let t=r[e];this.ext2(t);}return this;}ext4(r){return ra(r,(e,t)=>(this.ext2(t),!0)),this;}ext5(r,e,t,n){return this.minX=Math.min(this.minX,r),this.maxX=Math.max(this.maxX,e),this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,n),this;}ext6(r,e){return this.minX=Math.min(this.minX,r),this.maxX=Math.max(this.maxX,r),this.minY=Math.min(this.minY,e),this.maxY=Math.max(this.maxY,e),this;}ext7(r){if(r<0){let e=r*2;if(e<this.minX-this.maxX||e<this.minY-this.maxY)throw new Error("");}return this.minX-=r,this.maxX+=r,this.minY-=r,this.maxY+=r,this;}ext8(r){let e=[];for(let t=0;t<r.length;t+=2)e.push(new F(r[t],r[t+1]));return this.ext3(e);}ext9(r,e,t,n){return this.minX=Math.min(this.minX,r),this.maxX=Math.max(this.maxX,r+t),this.minY=Math.min(this.minY,e),this.maxY=Math.max(this.maxY,e+n),this;}ext10({x:r,y:e,width:t,height:n}){return this.ext9(r,e,t,n);}valid(){return isFinite(this.minX)&&isFinite(this.maxX)&&isFinite(this.minY)&&isFinite(this.maxY);}clear(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY;}build(){return new ye(this.minX,this.maxX,this.minY,this.maxY);}build1(){return this.valid()?new ye(this.minX,this.maxX,this.minY,this.maxY):new ye(0,0,0,0);}},Ll=new Float64Array(4),ye=class Hn{static extendRect({x:e,y:t,width:n,height:i}){return new Hn(e,e+n,t,t+i);}static extend1(e,t){if(e===null)return new Hn(t.x,t.x,t.y,t.y);{let n=Math.min(e.minX,t.x),i=Math.max(e.maxX,t.x),s=Math.min(e.minY,t.y),o=Math.max(e.maxY,t.y);return new Hn(n,i,s,o);}}static extend2(e,t){if(e){let n=Math.min(e.minX,t.minX),i=Math.max(e.maxX,t.maxX),s=Math.min(e.minY,t.minY),o=Math.max(e.maxY,t.maxY);return new Hn(n,i,s,o);}else return t;}static extend3(e,t){let n=Math.min(e.x,t.x),i=Math.max(e.x,t.x),s=Math.min(e.y,t.y),o=Math.max(e.y,t.y);return new Hn(n,i,s,o);}static extend4(e,t,n){let i=e.add1(-t/2,-n/2),s=e.add1(t/2,n/2);return Hn.extend3(i,s);}constructor(e,t,n,i){if(this.minX=st.normal(e),this.maxX=st.normal(t),this.minY=st.normal(n),this.maxY=st.normal(i),e>t||n>i)throw new Error(`min > max is not permitted: [${e}, ${t}, ${n}, ${i}]`);}get data(){return Ll[0]=this.minX,Ll[1]=this.maxX,Ll[2]=this.minY,Ll[3]=this.maxY,Ll;}isContains(e){return this.isContains1(e.x,e.y);}points(){return[this.LL(),this.LR(),this.UR(),this.UL(),this.LL()];}isContains1(e,t){return this.isContainsX(e)&&this.isContainsY(t);}isContains2(e,t){return this.isContainsX1(e)&&this.isContainsY1(t);}isContainsX(e){return e>=this.minX&&e<=this.maxX;}isContainsX1(e){return ue.greatereq(e,this.minX)&&ue.lesseq(e,this.maxX);}isContainsY(e){return e>=this.minY&&e<=this.maxY;}isContainsY1(e){return ue.greatereq(e,this.minY)&&ue.lesseq(e,this.maxY);}isIntersect(e){let t=Math.max(this.minX,e.minX),n=Math.min(this.maxX,e.maxX);if(t>n)return!1;let i=Math.max(this.minY,e.minY),s=Math.min(this.maxY,e.maxY);return!(i>s);}extendOfSize(e){return st.positiveOr0(this.maxX-this.minX+e*2),st.positiveOr0(this.maxY-this.minY+e*2),new Hn(this.minX-e,this.maxX+e,this.minY-e,this.maxY+e);}isInside(e){return this.minX>=e.minX&&this.maxX<=e.maxX&&this.minY>=e.minY&&this.maxY<=e.maxY;}isContainsBBox(e){return this.maxX>=e.maxX&&this.minX<=e.minX&&this.maxY>=e.maxY&&this.minY<=e.minY;}isContainsBBox1(e){return ue.greatereq(this.maxX,e.maxX)&&ue.lesseq(this.minX,e.minX)&&ue.greatereq(this.maxY,e.maxY)&&ue.lesseq(this.minY,e.minY);}intersection1(e){let t=Math.max(this.minX,e.minX),n=Math.min(this.maxX,e.maxX);if(ue.greater(t,n))return null;t>n&&(n=t);let i=Math.max(this.minY,e.minY),s=Math.min(this.maxY,e.maxY);return ue.greater(i,s)?null:(i>s&&(s=i),new Hn(t,n,i,s));}width(){return this.maxX-this.minX;}height(){return this.maxY-this.minY;}UL(){return new F(this.minX,this.maxY);}UR(){return new F(this.maxX,this.maxY);}LL(){return new F(this.minX,this.minY);}LR(){return new F(this.maxX,this.minY);}center(){return new F(this.maxX-(this.maxX-this.minX)/2,this.maxY-(this.maxY-this.minY)/2);}area(){return this.width()*this.height();}transform(e){let t=new ke();return t.ext2(this.LL().multiply3(e)),t.ext2(this.LR().multiply3(e)),t.ext2(this.UR().multiply3(e)),t.ext2(this.UL().multiply3(e)),t.build();}transform4(e){let t=new ke();return t.ext2(this.LL().multiply4(e)),t.ext2(this.LR().multiply4(e)),t.ext2(this.UR().multiply4(e)),t.ext2(this.UL().multiply4(e)),t.build();}isSeparated(e){if(e==null||e==null)return!1;let t;this.minX>=e.minX?t=this.minX:t=e.minX;let n;if(this.maxX<=e.maxX?n=this.maxX:n=e.maxX,t>n)return!0;{let i;this.minY>=e.minY?i=this.minY:i=e.minY;let s;return this.maxY<=e.maxY?s=this.maxY:s=e.maxY,i>s;}}relation(e){let t=0,n=0,i;this.minX>e.minX?(t++,i=this.minX):this.minX===e.minX?i=this.minX:(n++,i=e.minX);let s;if(this.maxX<e.maxX?(t++,s=this.maxX):this.maxX===e.maxX?s=this.maxX:(n++,s=e.maxX),i>s)return 2;{let o;this.minY>e.minY?(t++,o=this.minY):this.minY===e.minY?o=this.minY:(n++,o=e.minY);let a;return this.maxY<e.maxY?(t++,a=this.maxY):this.maxY===e.maxY?a=this.maxY:(n++,a=e.maxY),o>a?2:t===4?0:n===4?1:t===0&&n===0?4:i===s||o===a?6:t!==n?5:3;}}zoom(e){let t=this.width(),n=this.height(),i=this.center();return e!=0&&(t/=e/2,n/=e/2),new Hn(i.x-t,i.x+t,i.y-t,i.y+t);}toString(){return"BBox [minX="+this.minX+", maxX="+this.maxX+", minY="+this.minY+", maxY="+this.maxY+"]";}equals(e){return this.minY==e.minY&&this.minX==e.minX&&this.maxX==e.maxX&&this.maxY==e.maxY;}extendSize(e,t){return Object.is(void 0,t)&&(t=e),Hn.extend4(this.center(),this.width()+e,this.height()+t);}positionOnBBox(e,t=0){let n=this.center(),i=this.width()*t/2,s=this.height()*t/2,o=e.x-n.x,a=e.y-n.y;return o>i?a>s?ci.RT:a<-s?ci.RB:ci.RC:o<-i?a>s?ci.LT:a<-s?ci.LB:ci.LC:a>s?ci.CT:a<-s?ci.CB:ci.CC;}bbox(){return this;}},mn=class mt{static mul(e,t,n,i,s,o){let a=0,l=0;for(let u=0;u<e;u++){for(let c=0;c<n;c++){let h=c,d=0;for(let f=0;f<t;f++)d+=i[l+f]*s[h],h+=n;o[a++]=d;}l+=t;}}constructor(e,t,n){this.m=st.normal(e),this.n=st.normal(t);let i=e*t;if(n.length===i){for(let s=0;s<n.length;s++)st.normal(n[s]);this.data=n;}else throw new Error("invalid matrix size");}mul(e){if(this.n===e.m){let t=new Array(this.m*e.n);return mt.mul(this.m,this.n,e.n,this.data,e.data,t),new mt(this.m,e.n,t);}else throw new Error("m !== p");}toString(){let e=[];e.push("Matrix ("),e.push(this.m.toString()),e.push(" x "),e.push(this.n.toString()),e.push(")");let t=0;for(let n=0;n<this.m;n++)for(let i=0;i<this.n;i++){let s=this.data[t++].toString();i===0?(e.push(`
`),e.push("	"),e.push(s)):(e.push(", "),e.push(s));}return e.join("");}static on(e,t,n){return e*t+n;}initExpandMatrix(e){let t=this.m,n=this.n,i=n*2,s=new Array(t*i);for(let o=0;o<t;o++)for(let a=0;a<i;a++)a<n?s[mt.on(i,o,a)]=e[mt.on(n,o,a)]:a===t+o?s[mt.on(i,o,a)]=1:s[mt.on(i,o,a)]=0;return s;}inverseMatrix(e,t,n){for(let i=0;i<t;i++){let s=e[mt.on(n,i,i)];for(let o=0;o<n;o++)e[mt.on(n,i,o)]/=s;}return e;}getMatrixRank(e,t,n){let i=Math.min(t,n);for(let s=0;s<t;s++){if(e[mt.on(n,s,s)]===0){let o=new Array(n),a;for(a=s;a<t;a++)if(e[mt.on(n,a,s)]!==0){wr.arraycopy(e,mt.on(n,a,0),o,0,n),wr.arraycopy(e,mt.on(n,s,0),e,mt.on(n,a,0),n),wr.arraycopy(o,0,e,mt.on(n,s,0),n);break;}a>=t&&(i-=1);}if(!(i<t))for(let o=0;o<t;o++){if(o===s)continue;let a=e[mt.on(n,o,s)]/e[mt.on(n,s,s)];for(let l=0;l<n;l++)e[mt.on(n,o,l)]-=e[mt.on(n,s,l)]*a;}}return i;}getInverseMatrix(){if(this.m!==this.n)throw new Error("The matrix is an "+this.m+"x"+this.n+" order matrix, non-square matrix, please check!");function e(o){return ue.lesseq(Math.abs(o),0);}let t=this.initExpandMatrix(this.data.slice(0)),n=this.n*2;function i(o,a){for(let l=0;l<n;l++){let u=t[mt.on(n,o,l)];t[mt.on(n,o,l)]=t[mt.on(n,a,l)],t[mt.on(n,a,l)]=u;}}for(let o=0;o<this.m;o++){let a=Math.abs(t[mt.on(n,o,o)]),l=o;if(e(t[mt.on(n,o,o)]))for(let c=o+1;c<this.m;c++){if(e(t[mt.on(n,c,o)])){Math.abs(t[mt.on(n,c,o)])>a&&(a=Math.abs(t[mt.on(n,c,o)]),l=c);continue;}i(o,c);break;}if(e(t[mt.on(n,o,o)])){if(a===0)throw new Error("The matrix is a non-full rank matrix, please check!");console.warn("The matrix may be a non-full rank matrix, please check!"),l!==o&&i(o,l);}let u=1/t[mt.on(n,o,o)];for(let c=0;c<n;c++)t[mt.on(n,o,c)]*=u;for(let c=0;c<this.m;c++){if(o===c)continue;let h=t[mt.on(n,c,o)];for(let d=o;d<n;d++)t[mt.on(n,c,d)]-=t[mt.on(n,o,d)]*h;}}let s=[];for(let o=0;o<this.m;o++)for(let a=this.n;a<n;a++)s[mt.on(this.n,o,a-this.n)]=t[mt.on(n,o,a)];return new mt(this.m,this.n,s);}getTransposeMatrix(){let e=new Array(this.data.length);for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++)e[n*this.n+t]=this.data[t*this.m+n];return new mt(this.n,this.m,e);}hashCode(){let e=0;for(let t of this.data)e+=t;return e;}equals(e){return this===e?!0:e===null?!1:e instanceof mt?!(this.m!=e.m||this.n!=e.n||!wr.equals(this.data,e.data)):!1;}},iD=(r=>(r[r.MIL=1]="MIL",r[r.INCH=1e3]="INCH",r[r.FT=12e3]="FT",r[r.YARD=36e3]="YARD",r[r.MILE=6336e4]="MILE",r[r.KM=3937007874e-2]="KM",r[r.M=39370]="M",r[r.DM=3937]="DM",r[r.CM=393.7]="CM",r[r.MM=39.37]="MM",r[r.UM=.039]="UM",r[r.NM=394e-7]="NM",r[r.PT=13.88888888888889]="PT",r[r.PX72=13.88888888888889]="PX72",r[r.PX96=10.416666666666666]="PX96",r[r.PX100=10]="PX100",r[r.LTSPICE=6.25]="LTSPICE",r[r.PX1=.1]="PX1",r[r.PX001=.001]="PX001",r))(iD||{}),sD=(r=>(r.MIL="mil",r.INCH="inch",r.FT="ft",r.YARD="yard",r.MILE="mile",r.KM="km",r.M="m",r.DM="dm",r.CM="cm",r.MM="mm",r.UM="um",r.NM="nm",r.PT="pt",r.PX72="px(72)",r.PX96="px(96)",r.PX100="px(100)",r))(sD||{}),am={mil:1,inch:1e3,ft:12e3,yard:36e3,mile:6336e4,km:3937007874e-2,dm:3937,mm:39.37,um:.039,nm:394e-7,pt:13.88888888888889,"px(72)":13.88888888888889,"px(96)":10.416666666666666,"px(100)":10},oD=(()=>{let r={};for(let e in am)r[am[e]]=e;return r;})();function Mse(r,e){return oD[r]||e;}function Tse(r,e){return am[r]||e;}var Rse=(_class5=class a2{constructor(e,t){this.ratio=e/t;}wrap(e){return e*this.ratio;}static convert(e,t,n){return e*t/n;}},_class5.ASIS=new _class5(1,1),_class5),Ol=class{conversion(r,e,t){if(r===e)return t;let n=r+2+e;return this[n](t);}conversion1(r,e,t){let n=r+2+e,i=this[n](t);return e=="mil"?Math.round(i*10)/10:Math.round(i*1e3)/1e3;}mil2mil(r){return r;}mil2mm(r){return r*.0254;}mil2cm(r){return r*.00254;}mil2inch(r){return r/1e3;}mm2mm(r){return r;}mm2mil(r){let e=Math.pow(10,5);return Math.round(r*39.37007874015748*e)/e;}mm2cm(r){return r/10;}mm2inch(r){let e=Math.pow(10,8);return Math.round(r*.03937007874015748*e)/e;}cm2mil(r){let e=Math.pow(10,6);return Math.round(r*393.7007874015748*e)/e;}cm2mm(r){return r*10;}cm2inch(r){let e=Math.pow(10,7);return Math.round(r*.3937007874015748*e)/e;}inch2mil(r){return r*1e3;}inch2mm(r){return r*25.4;}inch2cm(r){return r*2.54;}};Ol.prototype["px(100)2mil"]=r=>r*10,Ol.prototype["px(100)2mm"]=r=>r*.254,Ol.prototype["mil2px(100)"]=r=>r/10,Ol.prototype["mm2px(100)"]=r=>{let e=Math.pow(10,5);return Math.round(r*3.937007874015748*e)/e;};var jc=null,lm=new ArrayBuffer(8),um=new Float64Array(lm),cm=new Uint32Array(lm),Vb=new Uint16Array(lm);function Nse(r,e,t=0,n=r.length){i(r,null,e,t,n);function i(o,a,l,u,c){let h,d,f,p;if(u<c-1){let m=c-u;if(m>50)a===null&&(a=new Array(m+1)),s(o,a,l,u,(u+c)/2|0,c);else{h=o[u],d=u,f=u,p=c;let g=d+1;for(;g<p;){if(f!=p){if(p=p+-1,l(h,o[p])<=0)continue;o[f]=o[p],f=p;continue;}if(l(h,o[g])>=0){d=g,g=d+1;continue;}o[f]=o[g],d=g,f=g,g=d+1;}o[f]=h,i(o,a,l,u,f),i(o,a,l,f+1,c);}}}function s(o,a,l,u,c,h){i(o,a,l,u,c),i(o,a,l,c,h);for(var d=u,f=c,p=0,m=o[d],g=o[f];d<c&&f<h;){var b=l(m,g);isNaN(b)?(a[p++]=g,g=o[++f]):(b<=0&&(a[p++]=m,m=o[++d]),b>=0&&(a[p++]=g,g=o[++f]));}for(;d<c;d++)a[p++]=o[d];for(;f<h;f++)a[p++]=o[f];for(d=u,f=0;f<p;d++,f++)o[d]=a[f];}}var Wb=class{static repeat(r,e){let t=new Array(e);for(;e-->0;)t[e]=r;return t.join("");}static lpad(r,e,t){let n=t-r.length;return n>0?this.repeat(e,n)+r:r;}static rpad(r,e,t){let n=t-r.length;return n>0?r+this.repeat(e,n):r;}static strHashcode(r){if(r.length>0){let e=0;for(let t=0;t<r.length;t++)e=31*e+r.charCodeAt(t)|0;return e;}else return 0;}static arraycopy(r,e,t,n,i){if(r.length>=e+i&&t.length>=n+i)for(;i-->0;)t[n++]=r[e++];else throw new Error("arraycopy out of range");}static undefAsNull(r){return null;}static reverse(r,e){for(let t=0,n=r.length-1;n>=0;t++,n--)e[t]=r[n];return e;}static sortAsc(r,e){return r-e;}static xmlDecode(r){let e=r.length,t=new Array(),n=-1;for(let i=0;i<e;i++){let s=r.charAt(i);if(n>=0){if(s===";"){let o=r.substring(n+1,i);switch(o){case"lt":t.push("<");break;case"gt":t.push(">");break;case"quot":t.push('"');break;case"apos":t.push("'");break;case"amp":t.push("&");break;default:if(o.charAt(0)==="#"){let a=parseInt(o.substring(1));t.push(String.fromCharCode(a));}else t.push("&"+o+";");}n=-1;}}else s==="&"?n=i:t.push(s);}return n>=0&&t.push(r.substring(n)),t.join("");}static addAll(r,e){for(let t of e)r.push(t);}static addAllSet(r,e){for(let t of e)r.add(t);}static contains(r,e){for(let t of r)if(t.equals(e))return!0;return!1;}static equals(r,e){if(r.length==e.length){for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0;}else return!1;}static remove(r,e){let t=0,n=r.length;for(let i=0;i<n;i++)r[i]===e&&(r.splice(i,1),i--,n--,t++);return t;}static getUrlVars(){for(var r={},e=location.href.slice(location.href.indexOf("?")+1).split("&"),t=0;t<e.length;t++){var n=e[t].split("=");r[decodeURIComponent(n[0])]=decodeURIComponent(n[1]);}return r;}static prefix(){if(!jc){let r=this.getUrlVars().version;r?jc="/analyzer/v"+r:jc="/analyzer";}return jc;}static add2objS(r,e,t){if(e in r)return r[e];{let n=t(e);return r[e]=n,n;}}static downloadFile(r,e){let t=document.createElement("a"),n=URL.createObjectURL(e);t.download=r,t.href=n,t.click(),URL.revokeObjectURL(n);}static uuid(){let r=new Array();um[0]=new Date().getTime(),r.push(cm[1].toString(16)),um[0]=Math.random(),r.push(Vb[3].toString(16));let e=Vb[2].toString(16);r.push("4"+e.substr(0,3)),um[0]=performance.now();let t=cm[0].toString(16)+cm[1].toString(16);return r.push("0"+t.substr(0,3)),r.push(t.substr(3)),r.join("-");}static funcCopy(r){return(0,eval)("("+r.toString()+")");}static NVL(...r){for(let e of r)if(e!==null)return e;return null;}static isSingle(r){return Array.from(new Set(r)).length===r.length;}},aD=[1,10,100,1e3];function Zc(r){return typeof r=="number"&&!isNaN(r);}function Lse(r){return new Ol().conversion("mm","mil",r);}function Ose(r,e,t){if(Zc(e)&&Zc(e)&&e>t)throw new Error("error params: min > max");return Zc(e)&&r<e?{check:!1,value:e}:Zc(t)&&r>t?{check:!1,value:t}:{check:!0,value:r};}var Hc=0,ho=0;function kse(r,e,t){return Hc=Math.abs(r-e),t>=5&&Hc>1e-5||isNaN(t)&&Hc>1e-8?!1:Hc<1e-13?!0:(ho=Math.min($b(r),$b(e)),ho<10&&(ho=10),isNaN(t)||(ho=Math.min(ho,t)),jb(r,ho)===jb(e,ho));}var Kc=0,Qc=0;function $b(r){return Kc=0,Qc=0,r>0?Kc=r-Math.floor(r):Kc=r-Math.ceil(r),Qc=(Kc.toString()||"").length,Qc>2?Qc-2:0;}function jb(r,e,t){if(typeof r!="number"&&(r=+r),isNaN(r))return NaN;if(e=e|0,e<=0||!r&&!t)return Math.round(r);var n=aD[e]||Math.pow(10,e)||10;if(t){var i=r<0?"-":"";for(r=r<0?-r:r,r=Math.round(r*n)+"";r.length<=e;)r="0"+r;return r=r.slice(0,-e)+"."+r.slice(-e),parseFloat(i+r);}else return Math.round(r*n+1e-10)/n;}var Use=class{constructor(r){this.resources=r,this.idle=[];}acquire(r){this.resources>0?(this.resources--,r()):this.idle.push(r);}acquire1(r){return this.resources>0?(this.resources--,r()):this.acquireSync().then(r);}acquireSync(){return new Promise(r=>{this.acquire(r);});}release(){let r=this.idle.shift();r?Promise.resolve().then(r):this.resources++;}getWaitingNum(){return this.idle.length;}},lD=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.PERCENT=1]="PERCENT",r[r.LEFT_PAD0=2]="LEFT_PAD0",r))(lD||{}),uD=/(\.?0+)$/,na=class{static format(r,...e){return this.format1(r,e);}static format1(r,e){let t=this._format(r,e);if(typeof t=="string")return t;throw new Error(this.format("Invalid state on (%d) %s",t,r));}static _format(r,e){let t=[],n=0,i=0,s,o=0,a=0;for(let l=0;l<r.length;l++){let u=r.charAt(l),c=u.charCodeAt(0);switch(n){case 0:c===37?n=1:t.push(u);break;case 1:switch(c){case 100:if(s=e[i++],typeof s=="number")t.push(s.toFixed(0)),n=0;else return l;break;case 102:if(s=e[i++],typeof s=="number")t.push(s.toString()),n=0;else return l;break;case 120:if(s=e[i++],typeof s=="number")t.push((s|0).toString(16)),n=0;else return l;break;case 88:if(s=e[i++],typeof s=="number")t.push((s|0).toString(16).toUpperCase()),n=0;else return l;break;case 115:case 99:s=e[i++],t.push(s===null?"null":s.toString()),n=0;break;case 48:o=l+1,a=-1,n=2;break;case 37:t.push("%"),n=0;break;default:return l;}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a=l;break;case 120:if(a>=o){let h=parseInt(r.substring(o,a+1));if(s=e[i++],typeof s=="number")t.push(Wb.lpad((s|0).toString(16),"0",h)),n=0;else return l;}else return l;break;case 88:if(a>=o){let h=parseInt(r.substring(o,a+1));if(s=e[i++],typeof s=="number")t.push(Wb.lpad((s|0).toString(16).toUpperCase(),"0",h)),n=0;else return l;}else return l;break;default:return l;}break;default:return l;}}return t.join("");}static startsWith(r,e){return r.length>=e.length?r.substring(0,e.length)===e:!1;}static endsWith(r,e){return r.length>=e.length?r.substring(r.length-e.length)===e:!1;}static split(r,e){let t=new Array(),n=0;for(;;){let i=r.exec(e);if(i!==null){let s=r.lastIndex-i[0].length;t.push(e.substring(n,s)),n=r.lastIndex;}else{let s=e.substring(n);Zb.nullOrEmpty(s)||t.push(s);break;}}return t;}static fmtNumber(r){return r.toFixed(5).replace(uD,"");}},Zb=class{static rgb(r){if(0<=r&&r<=255)return r;throw new Error(na.format("RGB should not nagative and not over 255(0xFF): %X",r));}static normal(r){if(isFinite(r))return r;throw new Error(na.format("%f is not permitted",r));}static positiveOr0(r){if(r>=0)return r;throw new Error(na.format("%f must >= 0",r));}static positive(r){if(r>0)return r;throw new Error(na.format("%f must > 0",r));}static notnull(r){if(r!=null)return r;throw new Error("invalid null value");}static mustnull(r){if(r===null)return null;throw new Error("value must be null");}static notEmpty(r){if(r==null||r.length===0)throw new Error("invalid empty string");return r;}static nullOrEmpty(r){return r==null||r.length===0;}static notNullOrUndef(r){if(r!=null)return r;throw new Error("null or undefined is not permitted");}},cD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Je=(_class6=class Xt extends mn{static translate(e,t,n){return new Xt([1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1]);}static translate1(e){return new Xt([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1]);}static rotateX(e){let t=Math.cos(e),n=Math.sin(e);return new Xt([1,0,0,0,0,t,n,0,0,-n,t,0,0,0,0,1]);}static rotateY(e){let t=Math.cos(e),n=Math.sin(e);return new Xt([t,0,-n,0,0,1,0,0,n,0,t,0,0,0,0,1]);}static rotateZ(e){let t=Math.cos(e),n=Math.sin(e);return new Xt([t,n,0,0,-n,t,0,0,0,0,1,0,0,0,0,1]);}static rotateAxis(e,t){e=e.normalize();let n=e.x,i=e.y,s=e.z,o=Math.sin(t),a=Math.cos(t);return new Xt([n*n*(1-a)+a,n*i*(1-a)+s*o,n*s*(1-a)-i*o,0,n*i*(1-a)-s*o,i*i*(1-a)+a,i*s*(1-a)+n*o,0,n*s*(1-a)+i*o,i*s*(1-a)-n*o,s*s*(1-a)+a,0,0,0,0,1]);}static scale(e,t=e,n=e){return new Xt([e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1]);}static flipX(){return new Xt([1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1]);}static flipY(){return new Xt([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);}static rotateZForPoint(e,t){return e.equals1(F.ORIGIN)?Xt.rotateZ(t):Xt.translate(-e.x,-e.y,0).rotateZ(t).translate1(e.x,e.y,0);}static getMatrix4(e,t,n,i){let s=Math.cos(t),o=Math.sin(t),a=n*(e.x*s-e.y*o)+i.x,l=e.x*o+e.y*s+i.y,u=[n*s,o,0,0,-o*n,s,0,0,0,0,1,0,a,l,0,1];return new Xt(u);}constructor(e=cD){super(4,4,e);}translate(e){return this.multiply4(Xt.translate1(e));}translate1(e,t,n){return this.multiply4(Xt.translate(e,t,n));}rotateX(e){return this.multiply4(Xt.rotateX(e));}rotateY(e){return this.multiply4(Xt.rotateY(e));}rotateZ(e){return this.multiply4(Xt.rotateZ(e));}scale(e,t=e,n=e){return this.multiply4(Xt.scale(e,t,n));}scale1(e){return this.multiply4(Xt.scale(e.x,e.y,e.z));}setOrigin(e,t,n){return Xt.translate(-e,-t,-n).multiply4(this).translate1(e,t,n);}setOrigin1(e){return this.setOrigin(e.x,e.y,e.z);}multiply4(e){let t=new Array(16);return mn.mul(4,4,4,this.data,e.data,t),new Xt(t);}getInverseMatrix(){let e=super.getInverseMatrix();return new Xt(e.data);}getTransposeMatrix(){let e=super.getTransposeMatrix();return new Xt(e.data);}inverse(){let e=this.getInverseMatrix();return new Xt(e.data);}toMatrix3(){let e=this.data;return new ze([e[0],e[1],0,e[4],e[5],0,e[12],e[13],1]);}},_class6.ORIGIN=new _class6(),_class6);function kl(r){return Zb.normal(parseFloat(r));}var hD=[1,0,0,0,1,0,0,0,1],ze=(_class7=class jt extends mn{constructor(e=hD){super(3,3,e);let t=e[0],n=e[3],i=e[1],s=e[4];this.iScale=Math.sqrt(t*t+i*i),this.jScale=Math.sqrt(n*n+s*s);}static translate(e,t){return new jt([1,0,0,0,1,0,e,t,1]);}static translate1(e){return this.translate(e.x,e.y);}static rotate(e){let t=Math.cos(e),n=Math.sin(e);return new jt([t,n,0,-n,t,0,0,0,1]);}static rotateD(e){return this.rotate(Xe.toRadians(e));}static scale(e,t=e){return new jt([e,0,0,0,t,0,0,0,1]);}static scale1(e,t){return new jt([e,0,0,0,t,0,0,0,1]);}static toDOMMatrix(e){let[t,n,,i,s,,o,a]=e.data;return`matrix(${[t,n,i,s,o,a].join(",")})`;}static svgTrasform(e){let t=e.split(" "),n=null;return t.forEach(i=>{i=i.trim();let s=i.trim().replace(")","").split("("),o=s[0],a=s[1].split(",");switch(o){case"translate":let l=kl(a[0]),u=kl(a[1]);n=n?n.translate(l,u):jt.translate(l,u);break;case"rotate":let c=kl(a[0]),h=kl(a[1]),d=kl(a[2]);n=n?n.setOrigin(h,d):jt.translate(h,d),n=n.rotateD(c);break;default:return;}}),n;}isMirrored(){return this.det()<0;}multiply3(e){let t=new Array(9);return mn.mul(3,3,3,this.data,e.data,t),new jt(t);}translate(e,t){return this.multiply3(jt.translate(e,t));}translate1(e){return this.multiply3(jt.translate1(e));}scale(e,t=e){return this.multiply3(jt.scale(e,t));}scale1(e,t){return this.multiply3(jt.scale1(e,t));}det(){return this.data[0]*this.data[4]-this.data[3]*this.data[1];}invert(){let e=this.getInverseMatrix();return new jt(e.data);}rotateD(e){return this.multiply3(jt.rotateD(e));}rotate(e){return this.multiply3(jt.rotate(e));}resetOffset(){let e=this.data;return new jt([e[0],e[1],0,e[3],e[4],0,0,0,1]);}setOrigin(e,t){return jt.translate(-e,-t).multiply3(this).translate(e,t);}setOrigin1(e){return this.setOrigin(e.x,e.y);}getInverseMatrix(){return new jt(super.getInverseMatrix().data);}getTransposeMatrix(){let e=super.getTransposeMatrix();return new jt(e.data);}toMatrix4(){let e=this.data;return new Je([e[0],e[1],0,e[2],e[3],e[4],0,e[5],0,0,1,0,e[6],e[7],0,e[8]]);}scaleNum(e){return!e||isNaN(e)?e:e*this.iScale;}},_class7.ORIGIN=new _class7(),_class7.MIRROR_Y=new _class7([1,0,0,0,-1,0,0,0,1]),_class7.MIRROR_X=new _class7([-1,0,0,0,1,0,0,0,1]),_class7.ROT_90=new _class7([0,1,0,-1,0,0,0,0,1]),_class7.ROT_N90=new _class7([0,-1,0,1,0,0,0,0,1]),_class7),ji=(r=>(r[r.BUTT=0]="BUTT",r[r.ROUND=1]="ROUND",r[r.SQUARE=2]="SQUARE",r))(ji||{}),vt=(r=>(r[r.CW=0]="CW",r[r.CCW=1]="CCW",r))(vt||{}),Ul=class{},$i=class Kl{constructor(e,t,n){this.p1=e,this.p2=t,this.p3=n;}barycentre(){return Kl.barycentre(this.p1,this.p2,this.p3);}incentre(){return Kl.incentre(this.p1,this.p2,this.p3);}static barycentre(e,t,n){let i=e.x+t.x+n.x,s=e.y+t.y+n.y;return new F(i/3,s/3);}static incentre(e,t,n){let i=t.sub(n).length(),s=e.sub(n).length(),o=e.sub(t).length(),a=i+s+o,l=i*e.x+s*t.x+o*n.x,u=i*e.y+s*t.y+o*n.y;return new F(l/a,u/a);}area(){return Kl.area(this.p1,this.p2,this.p3);}static area(e,t,n){return this.area2(e.x,e.y,t.x,t.y,n.x,n.y)/2;}static area2(e,t,n,i,s,o){return Math.abs(Yt.crossProd2(e,t,n,i,s,o));}scale(e,t){let n=ze.translate(-e.x,-e.y).scale(t).translate1(e),i=this.p1.multiply3(n),s=this.p2.multiply3(n),o=this.p3.multiply3(n);return new Kl(i,s,o);}scaleOnBarycentre(e){return this.scale(this.barycentre(),e);}scaleOnIncentre(e){return this.scale(this.incentre(),e);}extend(e){let t=this.incentre(),n=this.p1.add(this.p2).sub(t).scale(1/2),i=n.length(),s=F.ORIGIN.pointOnRays2(n,i+e).length()/i;return this.scaleOnIncentre(s);}container(e){let t=this.p3.sub(this.p1),n=this.p2.sub(this.p1),i=e.sub(this.p1),s=t.dot(t),o=t.dot(n),a=t.dot(i),l=n.dot(n),u=n.dot(i),c=1/(s*l-o*o),h=(l*a-o*u)*c;if(h<0||h>1)return!1;let d=(s*u-o*a)*c;return d<0||d>1?!1:h+d<=1;}};function Jc(){return{minDistance:Number.POSITIVE_INFINITY,start:null,end:null};}var Di=class vs{static getMinDistanceWithoutCross(e,t){let n=Jc();return vs.minLine(e,t,n),n.minDistance;}static getMinDistance(e,t){return dn(e,t)?0:this.getMinDistanceWithoutCross(e,t);}static getMinLineWithCross(e,t){let n=Jc();return vs.minLine(e,t,n),new q(n.start,n.end);}static getMinLine(e,t){return vs.intersection(e,t)||this.getMinLineWithCross(e,t);}static getMinDistanceFromPoint(e,t){let n=Jc();if(t instanceof q)this.point2LineMinLine(n,t,e);else if(t instanceof ee)this.point2ArcMinDistance(e,t,n);else throw new Error("not support");return n.minDistance;}constructor(e,t){if(this.pt1=e,this.pt2=t,this.minline=vs.intersection(e,t),this.minline)this.minDistance=0;else{let n=Jc();vs.minLine(e,t,n),this.minline=new q(n.start,n.end),this.minDistance=n.minDistance;}}getDistance(){return this.minDistance;}getLine(){return this.minline;}static intersection(e,t){let n=dn(e,t);if(n===0)return;let i=new Array();for(let s=0;s<n;s+=2){let o=new F(V[s],V[s+1]);i.push(o);}return i.length>1?new q(i[0],i[1]):new q(i[0],i[0]);}static minLine(e,t,n){if(e instanceof q&&t instanceof q)return this.minDistanceForLines(e,t,n);if(e instanceof ee&&t instanceof q)return this.minDistanceForLineAndArc(e,t,n);if(e instanceof q&&t instanceof ee)return this.minDistanceForLineAndArc(t,e,n);if(e instanceof ee&&t instanceof ee)return this.minDistanceForArcs(e,t,n);throw new Error("not support");}static minDistanceForLines(e,t,n){[e.start(),e.end(),t.start(),t.end()].forEach((i,s)=>{s<2?this.point2LineMinLine(n,t,i):this.point2LineMinLine(n,e,i);});}static minDistanceForLineAndArc(e,t,n){this.point2LineMinLine(n,t,e.start()),this.point2LineMinLine(n,t,e.svgEnd);let i=vs.foot(t,e.center);t.bbox().extendOfSize(1e-8).isContains(i)&&this.point2ArcMinLine(n,e,i),this.point2ArcMinLine(n,e,t.start()),this.point2ArcMinLine(n,e,t.end());}static minDistanceForArcs(e,t,n){this.concentricArc(e,t,n),$n(e,t.center)&&$n(t,e.center)?this.shortestLineForArcs(e,t,n):(this.point2ArcMinDistance(t.start(),e,n),this.point2ArcMinDistance(t.svgEnd,e,n),this.point2ArcMinDistance(e.start(),t,n),this.point2ArcMinDistance(e.svgEnd,t,n));}static minLineForArcAndLine(e,t,n){let i=e.pointOn(n.angleD(e.center)),s=e.pointOn(e.center.angleD(n));this.arcShortestLine(e,t,n,i),this.arcShortestLine(e,t,n,s);}static arcInnerLineFootSegment(e,t,n){let i=n.distance1(e.center);if(i!==0){let s=e.rx*(n.y-e.center.y)/i+e.center.y,o=e.rx*(n.x-e.center.x)/i+e.center.x;i=e.rx-i,i<t.minDistance&&(t.minDistance=i,t.start=new F(o,s),t.end=n);}else i=e.rx-i,i<t.minDistance&&(t.minDistance=i,t.start=e.start(),t.end=n);}static shortestLineForArcs(e,t,n){let i=e.center.angleD(t.center),s=t.center.angleD(e.center),o=e.pointOn(i),a=e.pointOn(s),l=t.pointOn(i),u=t.pointOn(s);$n(e,o)&&(this.arcShortestLine(t,n,o,l),this.arcShortestLine(t,n,o,u)),$n(e,a)&&(this.arcShortestLine(t,n,a,l),this.arcShortestLine(t,n,a,u)),this.shortestLineForArcs1(e,t,n);}static shortestLineForArcs1(e,t,n){let i=t.start().sub(e.center).normalize(),s=t.end().sub(e.center).normalize(),o=e.start().sub(t.center).normalize(),a=e.end().sub(t.center).normalize(),l=e.center.add(i.mul(e.rx)),u=e.center.add(s.mul(e.rx)),c=t.center.add(o.mul(t.rx)),h=t.center.add(a.mul(t.rx));$n(e,l)&&ue.greater(t.start().distance2(e.center),0)&&this.arcShortestLine(e,n,t.start(),l),$n(e,u)&&ue.greater(t.end().distance2(e.center),0)&&this.arcShortestLine(e,n,t.end(),u),$n(t,c)&&ue.greater(e.start().distance2(t.center),0)&&this.arcShortestLine(t,n,e.start(),c),$n(t,h)&&ue.greater(e.end().distance2(t.center),0)&&this.arcShortestLine(t,n,e.end(),h);}static concentricArc(e,t,n){if(!(e.center.distance1(t.center)<1e-5&&e.rx===t.rx&&e.ry===t.ry))return;let i=e.start().distance1(t.svgEnd);i<n.minDistance&&(n.minDistance=i,n.start=e.start(),n.end=t.svgEnd),i=t.start().distance1(e.svgEnd),i<n.minDistance&&(n.minDistance=i,n.start=t.start(),n.end=e.svgEnd);}static point2ArcMinDistance(e,t,n){if($n(t,e)){let i=t.pointOn(e.angleD(t.center)),s=t.pointOn(t.center.angleD(e));this.arcShortestLine(t,n,e,i),this.arcShortestLine(t,n,e,s);}else this.minLineSegment(n,t.start(),e),this.minLineSegment(n,t.svgEnd,e);}static point2ArcMinLine(e,t,n){if($n(t,n)){let i=n.distance1(t.center);i>t.rx||i>t.ry?this.minLineForArcAndLine(t,e,n):this.arcInnerLineFootSegment(t,e,n);}}static point2LineMinLine(e,t,n){let i=vs.foot(t,n);t.bbox().extendOfSize(1e-8).isContains(i)?this.minLineSegment(e,i,n):(this.minLineSegment(e,t.start(),n),this.minLineSegment(e,t.end(),n));}static minLineSegment(e,t,n){let i=t.distance1(n);i<e.minDistance&&(e.minDistance=i,e.start=t,e.end=n);}static arcShortestLine(e,t,n,i){if(!$n(e,i))return;let s=n.distance1(i);s<t.minDistance&&(t.minDistance=s,t.start=n,t.end=i);}static foot(e,t){if(e.isPoint())return e.start();if(!ue.eq(e.b,0)&&!ue.eq(e.a,0)){let n=(e.b*e.b*t.x-e.a*e.b*t.y-e.a*e.c)/(e.b*e.b+e.a*e.a),i=(-e.a*e.b*t.x+e.a*e.a*t.y-e.b*e.c)/(e.b*e.b+e.a*e.a);return new F(n,i);}else return ue.eq(e.b,0)&&!ue.eq(e.a,0)?new F(e.start().x,t.y):!ue.eq(e.b,0)&&ue.eq(e.a,0)?new F(t.x,e.start().y):t;}};function $n(r,e){if(ue.eq(r.sweepAngle,360))return!0;let t=Xe.regularD(e.angleD(r.center));return r.sweepAngle>0?(ue.less(t,r.startAngle)&&(t+=360),ue.greatereq(r.endAngle(),t)):(ue.greater(t,r.startAngle)&&(t-=360),ue.lesseq(r.endAngle(),t));}var Dse={0:0,90:1,180:0,270:-1},Gse={0:1,90:0,180:-1,270:0},Hb=[1,10,100,1e3],Kb="http://www.w3.org/2000/svg",Qb="http://www.w3.org/1999/xlink",Jb="http://www.w3.org/XML/1998/namespace",ey="https://easyeda.com/",Fse=function(){var r={svg:Kb,xlink:Qb,xml:Jb,c:ey};return r[Kb]="svg",r[Qb]="xlink",r[Jb]="xml",r[ey]="c",r;}(),qse=0,zse=1,Yse=2,Xse=10,Vse=11,Wse=1,$se=6,jse=7,Zse=16,Hse=17,Kse=8,Qse=9,Jse=18,eoe=19,toe=4,roe=12,noe=13,ioe=5,soe=14,ooe=15,aoe=2,loe=3,uoe=0,coe={A4L:{W:1169,H:827},A4P:{W:827,H:1169},A3L:{W:1654,H:1169},A3P:{W:1169,H:1654},A2L:{W:2339,H:1654},A2P:{W:1654,H:2339},A1L:{W:3311,H:2339},A1P:{W:2339,H:3311}},Jt=function(){var r={RATLINES:9,MODEL3D:19,ALL:11,TOPSILKLAYER:3,TOPLAYER:1,TOPPASTERLAYER:5,TOPSOLDERLAYER:7,LIBBODY:99,PADSURFACE:100,BOARDOUTLINE:10,DOCUMENT:12,TOPASSEMBLY:13,MECHANICAL:15,TOPCOMPONENT:16,SUBSTRATE:18},e;for(e=21;e<21+32;e++)r["INNER"+(e-20)]=e;for(r.BOTTOMSILKLAYER=4,r.BOTTOMLAYER=2,r.BOTTOMPASTERLAYER=6,r.BOTTOMSOLDERLAYER=8,r.BOTTOMASSEMBLY=14,r.BOTTOMCOMPONENT=17,e=53;e<53+32;e++)r["BOARD"+(e-52)]=e;return r;}(),hoe=function(){var r={COPPERAREA:[1,2,21,22,23,24],PLANEZONE:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,99],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],DIMENSION:[3,4,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11,99,100],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15],SHEET:[12,13,14,15]};r["3D"]=function(){for(var i=[16,19,3,7,5,1],s=21;s<52;s++)i.push(s+32,s);return i.push(2,6,8,4,17),i;}();var e,t,n;for(e in r)if(r.hasOwnProperty(e)&&(n=r[e],n.indexOf(21)>0&&n.indexOf(25)===-1))for(t=25;t<=52;t++)n.push(t);return r;}(),xr=function(){var r={1:"TopLayer",2:"BottomLayer",3:"TopSilkLayer",4:"BottomSilkLayer",5:"TopPasteMaskLayer",6:"BottomPasteMaskLayer",7:"TopSolderMaskLayer",8:"BottomSolderMaskLayer",9:"Ratlines",10:"BoardOutLine",11:"Multi-Layer",12:"Document",13:"TopAssembly",14:"BottomAssembly",15:"Mechanical",16:"TopComponents",17:"BottomComponents",18:"Substrate",19:"3DModel",99:"ComponentShapeLayer",100:"LeadShapeLayer"},e;for(e=21;e<21+32;e++)r[e]="Inner"+(e-20);for(e=53;e<53+32;e++)r[e]="Substrate"+(e-52);return r;}(),foe=function(){var r=[],e=[];for(var t in Jt)if(Jt.hasOwnProperty(t)){if(t.match(/^BOARD\d+/))continue;r.push(Jt[t]);}r.sort(),e.sort();var n={},i,s={21:"#999966",22:"#008000",23:"#00FF00",24:"#BC8E00",25:"#70DBFA",26:"#00CC66",27:"#9966FF",28:"#800080",29:"#008080",30:"#15935F",31:"#000080",32:"#00B400",33:"#2E4756",34:"#99842F",35:"#FFFFAA",36:"#99842F",37:"#2E4756",38:"#3535FF",39:"#8000BC",40:"#43AE5F",41:"#C3ECCE",42:"#728978",43:"#39503F",44:"#0C715D",45:"#5A8A80",46:"#2B937E",47:"#23999D",48:"#45B4E3",49:"#215DA1",50:"#4564D7",51:"#6969E9",52:"#9069E9"};r.forEach(function(a){switch(a){case Jt.TOPLAYER:i={name:xr[a],color:"#FF0000",darkColor:"#CC0000",visible:!0,active:!0,config:!0};break;case Jt.BOTTOMLAYER:i={name:xr[a],color:"#0000FF",darkColor:"#000080",visible:!0,active:!1,config:!0};break;case Jt.TOPSILKLAYER:i={name:xr[a],color:"#FFCC00",darkColor:"#806600",visible:!0,active:!1,config:!0};break;case Jt.BOTTOMSILKLAYER:i={name:xr[a],color:"#66CC33",darkColor:"#33661A",visible:!0,active:!1,config:!0};break;case Jt.TOPPASTERLAYER:i={name:xr[a],color:"#808080",darkColor:"#666666",visible:!0,active:!1,config:!0};break;case Jt.BOTTOMPASTERLAYER:i={name:xr[a],color:"#800000",darkColor:"#660000",visible:!0,active:!1,config:!0};break;case Jt.TOPSOLDERLAYER:i={name:xr[a],color:"#800080",darkColor:"#660066",visible:!0,active:!1,transparency:.3,config:!0};break;case Jt.BOTTOMSOLDERLAYER:i={name:xr[a],color:"#AA00FF",darkColor:"#8800CC",visible:!0,active:!1,transparency:.3,config:!0};break;case Jt.RATLINES:i={name:xr[a],color:"#6464FF",darkColor:"#5050CC",visible:!1,active:!1,config:!0};break;case Jt.BOARDOUTLINE:i={name:xr[a],color:"#FF00FF",darkColor:"#CC00CC",visible:!0,active:!1,config:!0};break;case Jt.ALL:i={name:xr[a],color:"#C0C0C0",darkColor:"#999999",visible:!0,active:!1,config:!0};break;case Jt.DOCUMENT:i={name:xr[a],color:"#FFFFFF",darkColor:"#CCCCCC",visible:!0,active:!1,config:!0};break;case Jt.TOPASSEMBLY:i={name:xr[a],color:"#33CC99",darkColor:"#33AA99",visible:!1,active:!1,config:!1};break;case Jt.BOTTOMASSEMBLY:i={name:xr[a],color:"#5555FF",darkColor:"#8888FF",visible:!1,active:!1,config:!1};break;case Jt.MECHANICAL:i={name:xr[a],color:"#F022F0",darkColor:"#F088F0",visible:!1,active:!1,config:!1};break;case Jt.MODEL3D:i={name:xr[a],color:"#66CCFF",visible:!1,active:!1,config:!1};break;case Jt.LIBBODY:i={name:xr[a],color:"#00CCCC",visible:!1,active:!1,config:!1};break;case Jt.PADSURFACE:i={name:xr[a],color:"#CC9999",visible:!1,active:!1,config:!1};break;default:a>=Jt.INNER1&&a<=Jt.INNER32?i={name:xr[a],color:s[a],darkColor:o(s[a]),visible:!1,active:!1,config:!1}:i=null;break;}i&&(n[a]=i);}),n.Hole={config:!0,name:"Hole",darkColor:"#222222",color:"#222222"},n.DRCError={config:!0,name:"DRCError",color:"#FAD609",darkColor:"#FAD609"};function o(a){if(typeof a!="string"||!a.match(/#?([\da-f]{6})/i))return a;var l=parseInt(RegExp.$1,16),u=.5,c=Math.min(255,Math.round((l>>16)*u)),h=Math.min(255,Math.round((l>>8&255)*u)),d=Math.min(255,Math.round((l&255)*u)),f=((c<<16)+(h<<8)+d).toString(16);return"#"+("00000"+f).substr(-6).toUpperCase();}return n;}(),ty={BLANK:0,SCH:1,PART:2,PCB:3,FOOTPRINT:4,PRJ:5,SUBPART:6,SPICESYMBOL:7,SUBCKT:8,NETLIST:9,WAVEFORM:10,SCHLIB3D:11,PHOTOVIEW:12,SCHMODULE:13,PCBMODULE:14,VIEW3D:15,PCBLIB3D:16,BLOCK_SYMBOL:17,NETFLAG:18,NETPORT:19,SHEET_SYMBOL:20,NONEELEC_SYMBOL:21,SHORT_SYMBOL:22,FOOTPRINTVIEW:23,CNCPRINTVIEW:24,PCB2D:31,PCB3D:32},doe=function(){var r={};for(let e in ty)r[ty[e]]=e;return r;}(),poe={PRJ:"1",BOARDS:"2",BOARD:"3",BLOCKS:"4",BLOCK:"5",SCH:"6",SHEET:"7",SYMBOLS:"8",SYMBOL:"9",NETS:"10",NET:"11",WIRE:"13",BLOCK_SYMBOL:"12",BUS:"14",SYMBOLCOLLECT:"15",NETCLASS:"16",NETCOLLECT:"17",NETTREENODE:"18",REUSEBLOCKS:"19",REUSEBLOCK:"20",NETPORTS:"23",NETPORT:"24",NETFLAGS:"25",NETFLAG:"26",SHORTSYMBOLS:"27",SHORTSYMBOL:"28",NONEELECSYMBOLS:"29",NONEELECSYMBOL:"30",PRIMITIVES:"31",PRIMITIVE:"32",PCB:"101",ALLNETROOT:"106",ObjectRoot:"objectRoot",Object:"object",TrackNet:"trackNet",CopperLayer:"copperLayer",Copper:"copper",Group:"group",ComponentClassification:"componentClassification",Nets:"nets",Net:"net",NetClasses:"netClasses",NetClass:"netClass",RatlineNets:"ratlineNets",RatlineNet:"ratlineNet",Ratline:"ratline",Differentials:"differentials",Differential:"differential",EqualLengthGroups:"equalLengthGroups",EqualLengthGroup:"equalLengthGroup",PadsPairGroups:"PadsPairGroups",PadsPairGroup:"padsPairGroup",PadsPair:"padsPair",NetComponents:"netComponents",Errors:"errors",ErrorType:"errorType",ErrorObjType:"errorObjType"},moe="~",goe="^^",xoe="#@$",boe="`",yoe="#sheet#",woe=["Unknow","LCSC","Digi-Key","Mouser","Element14","RS-Online"],voe=200,Eoe={lists:[{title:"Created",newtitle:{en:"My Libraries",cn:"\u6211\u7684\u4E2A\u4EBA\u5E93"},docType:2,tags:["All"],nickname:"Created",uuid:"c45b67d5dd2241f380ca7836744c1044"},{title:"Favorite",newtitle:{en:"My Favorites",cn:"\u6211\u7684\u6536\u85CF\u5E93"},docType:2,tags:["All"],nickname:"Favorite",uuid:"c45b67d5dd2241f380ca7836744c1044"},{nickname:"\u6D4B\u8BD5\u7528\u4F8B",uuid:"ca1608a600764e02aca5152493eba223",title:"\u6D4B\u8BD5\u7528\u4F8B",docType:2,tags:["All","1231"]}]},Poe={},hm=Math.PI*2,eh=Math.PI/2,_oe=Math.sin(Math.PI/180);function fo(r,e,t){if(typeof r!="number"&&(r=+r),isNaN(r))return NaN;if(e=e|0,e<=0||!r&&!t)return Math.round(r);var n=Hb[e]||Math.pow(10,e)||10;if(t){var i=r<0?"-":"";for(r=r<0?-r:r,r=Math.round(r*n)+"";r.length<=e;)r="0"+r;return r=r.slice(0,-e)+"."+r.slice(-e),parseFloat(i+r);}else return Math.round(r*n+1e-10)/n;}function ry(r){let e=0;r>0?e=r-Math.floor(r):e=r-Math.ceil(r);let t=(e.toString()||"").length;return t>2?t-2:0;}function Soe(r,e,t){if(t>=5&&Math.abs(r-e)>1e-5)return!1;let n=Math.min(ry(r),ry(e));return n<10&&(n=10),isNaN(t)||(n=Math.min(n,t)),fo(r,n)===fo(e,n);}function Boe(r,e){typeof r=="string"&&(r=parseFloat(r));let t=Math.pow(10,e);return Math.round(r*t)/t;}function Ioe(r,e){if(!r||typeof r!="string")return"";var t=/\d+\.\d{12,}/g,n=Hb[e]||Math.pow(10,e)||10;return r.replace(t,function(i){return(Math.round(parseFloat(i)*n+1e-10)/n).toString();});}function Aoe(r,e,t,n,i,s){if(t>i){var o=t;t=i,i=o;}if(n>s){var a=n;n=s,s=a;}return r>=t&&r<=i&&e>=n&&e<=s;}function Coe(r){var e=[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}];return e;}function Moe(r,e){var t=Math.max(r.x+r.width,e.x+e.width),n=Math.max(r.y+r.height,e.y+e.height),i=Math.min(r.x,e.x),s=Math.min(r.y,e.y);return{x:i,y:s,width:t-i,height:n-s};}function Toe(r,e){return e.x<r.x+r.width&&e.x+e.width>r.x&&e.y<r.y+r.height&&e.y+e.height>r.y;}function Dl(r,e,t,n){var i=r.x,s=r.y,o=e.x,a=e.y,l=t.x,u=t.y,c=o-i,h=a-s,d=c*c+h*h,f=((l-i)*c+(u-s)*h)/d;if((f>1||f<0)&&n)return null;var p=i+f*c,m=s+f*h;return{x:p,y:m};}function Roe(r,e,t,n){var i=r.x,s=r.y,o=e.x,a=e.y,l=t.x,u=t.y,c=o-i,h=a-s,d=c*c+h*h;n===void 0&&(n=0);var f=((l-i)*c+(u-s)*h)/d;if(!(f>=1+n)&&!(f<=0)){var p=i+f*c,m=s+f*h,g=p-l,b=m-u,y={point:{x:p,y:m},distance2:g*g+b*b};return y;}}function Noe(r,e,t){var n=r.x,i=r.y,s=e.x,o=e.y,a=t.x,l=t.y,u=s-n,c=o-i,h=u*u+c*c;if(h===0)return(a-n)*(a-n)+(l-i)*(l-i);var d=((a-n)*u+(l-i)*c)/h,f=n+d*u,p=i+d*c,m=f-a,g=p-l;return m*m+g*g;}function Loe(r,e,t,n){var i=r.x,s=r.y,o=e.x,a=e.y,l=t.x,u=t.y,c=n.x,h=n.y,d=o-i,f=a-s,p=l-c,m=u-h,g=f*p-d*m;if(!g)return null;var b=(d*p*(u-s)-l*d*m+i*f*p)/g,y=(f*m*(l-i)-u*f*p+s*d*m)/-g;return{x:b,y};}function Ooe(r,e,t,n){function i(m,g){return m.x==g.x&&m.y==g.y;}var s=i(r,t)||i(r,n)?r:i(e,t)||i(e,n)?e:null;if(s)return{x:s.x,y:s.y};var o,a,l,u,c,h,d,f,p;return o=e.x-r.x,a=e.y-r.y,l=n.x-t.x,u=n.y-t.y,d=l*a-u*o,d===0?!1:(f=t.x-r.x,p=t.y-r.y,h=(o*p-a*f)/d,c=(l*p-u*f)/d,h>=0&&h<=1&&c>=0&&c<=1?{x:r.x+c*o,y:r.y+c*a}:!1);}function fD(r,e,t){if(!e)return null;var n,i=e.length,s=null,o=e[0].x,a=e[0].y,l=o,u=a,c=r.x,h=r.y,d,f;for(n=1;n<i;n++)d=e[n].x,f=e[n].y,o>d&&(o=d),a>f&&(a=f),l<d&&(l=d),u<f&&(u=f);if(c<o-t||h<a-t||c>l+t||h>u+t)return null;for(n=1;n<i;n++)if(s=Gl(r,e[n-1],e[n]),s.d<t)return s;return null;}function Gl(r,e,t){var n,i=+e.x,s=+e.y,o=+t.x,a=+t.y,l=+r.x,u=+r.y,c=o-i,h=a-s,d=l-i,f=u-s,p,m,g,b,y,v;return c===0&&h===0?{d:Math.sqrt(d*d+f*f),point:{x:i,y:s}}:(n=(d*c+f*h)/(c*c+h*h),n<0?{d:Math.sqrt(d*d+f*f),point:{x:i,y:s}}:n>1?(p=l-o,m=u-a,{d:Math.sqrt(p*p+m*m),point:{x:o,y:a}}):(y=i+n*c,v=s+n*h,g=l-y,b=u-v,{d:Math.sqrt(g*g+b*b),point:{x:y,y:v}}));}function koe(r,e,t,n){var i=t-r,s=n-e,o=Math.atan2(s,i);return o=o<0?o+Math.PI+Math.PI:o,o;}function dD(r,e,t,n){var i=r-t,s=e-n;return i*i+s*s;}function nr(r,e,t,n){return Math.sqrt(dD(r,e,t,n));}function ny(r,e,t){var n=Math.sin(t),i=Math.cos(t),s=r[0]-e[0],o=r[1]-e[1];return[s*i-o*n+e[0],o*i+s*n+e[1]];}function Uoe(r,e,t){return t=+t,ny(r,e,t*Math.PI/180);}function Doe(r,e,t){return t=+t,t===null?r:(typeof t=="string"?t=-parseInt(t):t=-t,ny(r,e,t*Math.PI/180));}function Goe(r){return r<0?(360+r%360)%360:r>=360?r%360:r;}function fm(r,e,t){var n=r-e;return t||(t=1e-10),(n>0?n:-n)<t;}function Foe(r,e){let t=r.x-e.x,n=r.y-e.y;return(t>0?t:-t)<.001&&(n>0?n:-n)<.001;}function qoe(r,e){var t=r-e;return(t>0?t:-t)<.1;}function zoe(r,e){var t=r.x-e.x,n=r.y-e.y;return(t>0?t:-t)<.1&&(n>0?n:-n)<.1;}function Yoe(r,e,t,n,i){var s=fD({x:t,y:n},r,i+.5*e),o=null,a;return s&&[].forEach.call(r,function(l,u){if(!o&&r[u+1]){var c=pm(s.point,l,r[u+1]);c&&(o=Dl(l,r[u+1],{x:t,y:n}),a=nr(t,n,o.x,o.y));}}),o&&{point:o,d:a};}function Xoe(r,e,t,n,i){return Math.pow(r-t,2)+Math.pow(e-n,2)<=Math.pow(i,2);}function Voe(r,e){typeof r=="string"&&(r={x:+r.split(" ")[0],y:+r.split(" ")[1]});for(var t=r.x,n=r.y,i=!1,s=0,o=e.length,a=o-1;s<o;a=s,s++){typeof e[s]=="string"&&(e[s]={x:+e[s].split(" ")[0],y:+e[s].split(" ")[1]});var l=e[s].x,u=e[s].y,c=e[a].x,h=e[a].y;if(l==t&&u==n||c==t&&h==n)return!0;if(u<n&&h>=n||u>=n&&h<n){var d=l+(n-u)*(c-l)/(h-u);if(d==t)return!0;d>t&&(i=!i);}}return i;}function pD(r,e,t,n,i,s){if(e===0){var o=s*s-(t/r+n)*(t/r+n);return o>=0?[{x:-t/r,y:i+Math.sqrt(o)},{x:-t/r,y:i-Math.sqrt(o)}]:[];}var a,l,u,c,h,d,f,p;h=r*r+e*e,d=2*r*t-2*n*e*e+2*i*r*e,f=t*t+2*i*t*e+e*e*(n*n+i*i-s*s);var m=wD(h,d,f);return h=m.a,d=m.b,f=m.c,p=d*d-4*h*f,p<-.001?[]:(p<0&&(p=0),p=Math.sqrt(p),a=(-d+p)/(2*h),l=(-d-p)/(2*h),Math.abs(e)<.1?(u=Math.sqrt(s*s-Math.pow(a-n,2))+i,Math.abs(r*a+e*u+t-0)>.001?(u=-Math.sqrt(s*s-Math.pow(a-n,2))+i,c=Math.sqrt(s*s-Math.pow(l-n,2))+i):c=-Math.sqrt(s*s-Math.pow(l-n,2))+i):(u=-(r*a+t)/e,c=-(r*l+t)/e),[{x:a,y:u},{x:l,y:c}]);}function iy(r,e,t,n,i){var s=1e-4,o={x:t,y:n};if(Math.abs(r.x-e.x)<s&&Math.abs(r.y-e.y)<s)return(r.x-t)*(r.x-t)+(r.y-n)*(r.y-n)<s?[{x:r.x,y:e.y}]:[];var a=Dl(r,e,o),l=nr(t,n,a.x,a.y);if(l-i>s)return[];if(Math.abs(l-i)<s)return[a];if(l<s)var u=Math.atan2(e.y-r.y,e.x-r.x)+Math.PI/2;else u=Math.atan2(n-a.y,t-a.x);var c=In(a,u),h=In(o,u),d=Math.sqrt(i*i-l*l),f={x:c.x,y:c.y+d},p={x:c.x,y:c.y-d},m=In(f,-u),g=In(p,-u);return[m,g];}function dm(r,e,t,n,i){var s=[];return iy(r,e,t,n,i).forEach(function(o){pm({x:o.x,y:o.y},r,e)&&s.push({x:o.x,y:o.y});}),s;}function pm(r,e,t){var n=c(r)&&c(e)&&c(t);if(!n)return console.warn("Bad arguments"),null;var i=e.x-t.x>0?e.x:t.x,s=e.y-t.y>0?e.y:t.y,o=e.x-t.x>0?t.x:e.x,a=e.y-t.y>0?t.y:e.y,l=r.x,u=r.y;return l<=i+.001&&l>=o-.001&&u<=s+.001&&u>=a-.001;function c(h){return h?(h.x=Number(h.x),h.y=Number(h.y),isNaN(h.x)||isNaN(h.y)?(console.warn("Can not convert to Number, NaN found"),!1):!0):(console.warn("Empty input!"),!1);}}function mD(r,e,t,n=.5){var i=h(r)&&h(e)&&h(t);if(!i)return console.warn("Bad arguments"),null;var s=e.x-t.x>0?e.x:t.x,o=e.y-t.y>0?e.y:t.y,a=e.x-t.x>0?t.x:e.x,l=e.y-t.y>0?t.y:e.y,u=r.x,c=r.y;return u<=s+.001+n&&u>=a-.001-n&&c<=o+.001+n&&c>=l-.001-n;function h(d){return d?(d.x=Number(d.x),d.y=Number(d.y),isNaN(d.x)||isNaN(d.y)?(console.warn("Can not convert to Number, NaN found"),!1):!0):(console.warn("Empty input!"),!1);}}function Woe(r,e,t,n,i,s){if(t===void 0)throw new Error("getLinesIntersection(): c1 can`t be undefined");return r*i===n*e?null:{x:(e*s-i*t)/(r*i-n*e),y:(r*s-n*t)/(e*n-i*r)};}function In(r,e){var t=Math.cos(e),n=Math.sin(e);return{x:r.x*t+r.y*n,y:r.y*t-r.x*n};}function $oe(r,e,t){return{x:r.x+e,y:r.y+t};}function joe(r,e){return{a:r.y-e.y,b:e.x-r.x,c:r.x*e.y-e.x*r.y};}function gD(r,e,t,n){if(e||t)return Math.abs(e*r.x+t*r.y+n)/Math.sqrt(e*e+t*t);}function xD(r,e,t,n,i,s,o){o===void 0&&(o=.001);var a,l,u,c,h,d,f,p;if(Math.abs(e-i)>o){var m=(r*r-n*n+e*e-i*i+s*s-t*t)/(2*(e-i)),g=(r-n)/(e-i);if(a=1+g*g,l=-2*(r+(m-e)*g),u=r*r+Math.pow(m-e,2)-t*t,p=l*l-4*a*u,p>.001)c=(-l+Math.sqrt(p))/(2*a),h=(-l-Math.sqrt(p))/(2*a),d=m-g*c,f=m-g*h;else if(Math.abs(p)<.001)c=-l/(2*a),h=c,d=m-g*c,f=d;else return null;}else if(Math.abs(r-n)>o){if(c=(r*r-n*n+s*s-t*t)/(2*(r-n)),h=c,a=1,l=-2*e,u=e*e-t*t+(c-r)*(c-r),p=l*l-4*a*u,p>.001)d=(-l+Math.sqrt(p))/(2*a),f=(-l-Math.sqrt(p))/(2*a);else if(p>-.001)d=-l/(2*a),f=d;else return null;}else return null;return[{x:c,y:d},{x:h,y:f}];}function Zoe(r,e,t){var n=Math.atan2(e.y,e.x)-Math.atan2(r.y,r.x);return t&&(n>Math.PI&&(n-=2*Math.PI),n<-Math.PI&&(n+=2*Math.PI)),n;}function Hoe(r,e,t){var n=(e.x-r.x)*(t.y-r.y)-(e.y-r.y)*(t.x-r.x);if(n>0)return"\u987A\u65F6\u9488";if(n<0)return"\u9006\u65F6\u9488";if(n===0)return"\u5171\u7EBF";}function bD(r,e,t){var n=Math.min,i=Math.max;return n(e.x,t.x)<=r.x&&r.x<=i(e.x,t.x)&&n(e.y,t.y)<=r.y&&r.y<=i(e.y,t.y)&&(r.x-e.x)*(t.y-e.y)==(t.x-e.x)*(r.y-e.y);}function Koe(r,e){if(!e||!e.length)return!1;for(var t=e.length,n=0;n<t-1;n++)if(bD(r,e[n],e[n+1]))return!0;return!1;}function Qoe(r,e){return r.x==e.x&&r.y==e.y;}function Joe(r,e){return Math.sqrt((r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y));}function eae(r){var e;return r.match(/,/)?e=r.trim().split(","):e=r.trim().split(" "),e.map(function(t,n,i){return n%2===0?{x:Number(t),y:Number(i[n+1])}:void 0;}).filter(function(t){return t!==void 0;});}function tae(r,e){return!r||!r.length?"":(e===void 0&&(e=3),e=Number(e),[].reduce.call(r,function(t,n){return t+=fo(n.x,e)+" "+fo(n.y,e)+" ";},"").trim());}function rae(r,e,t){return!r||!r.length?[]:r.map(function(n){return{x:fo(n.x*e,t||0),y:fo(n.y*e,t||0)};});}function yD(r,e,t,n,i){i||(i=0);var s=(r.x-t.x)*(e.y-t.y)-(r.y-t.y)*(e.x-t.x),o=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x);if(s*o>=i)return!1;var a=(t.x-r.x)*(n.y-r.y)-(t.y-r.y)*(n.x-r.x),l=a+s-o;if(a*l>=i)return!1;var u=a/(o-s),c=u*(e.x-r.x),h=u*(e.y-r.y);return{x:r.x+c,y:r.y+h};}function nae(r,e){var t=.001,n=po(r),i=po(e);if(!n||!i)return null;var s=ia(n),o=ia(i);if(!s||!o)return console.warn("Bad arc arguments!"),null;var a=nr(s.x,s.y,n.M.x,n.M.y),l=nr(o.x,o.y,i.M.x,i.M.y);let u=xD(s.x,s.y,a,o.x,o.y,l);return u?(u=u.filter(function(c){return!!($r(n,c,s)&&$r(i,c,o));}),u.length>0?u.length===2&&Math.abs(u[0].x-u[1].x)<t&&Math.abs(u[0].y-u[1].y)<t?[u[0]]:u:null):null;}function po(r){if(r=r.trim(),r[0]!=="M")return null;var e=r.slice(1).split("A");if(e.length!==2)return console.warn("Cannot handle multi arc!"),null;var t=e[0].trim().split(",").reduce(function(i,s){return i.concat(s.trim().split(" "));},[]),n=e[1].trim().split(",").reduce(function(i,s){return i.concat(s.trim().split(" "));},[]);return n.length!==7?(console.warn("Bad Arc arguments!"),null):n[0]!==n[1]?(console.warn("Eclipse is not supported"),null):{M:{x:Number(t[0]),y:Number(t[1])},A:{rx:Number(n[0]),ry:Number(n[1]),rotation:Number(n[2]),largeArc:Number(n[3]),clockwise:Number(n[4]),x:Number(n[5]),y:Number(n[6])}};}function ia(r){typeof r=="string"&&(r=po(r));var e=r.M,t=r.A,n=r.A.rx,i=Math.atan2(t.y-e.y,t.x-e.x),s=In(e,i),o=In(t,i),a=nr(s.x,s.y,o.x,o.y)/2;n<a&&(n=a);var l=Math.sqrt(n*n-a*a),u=r.A.largeArc===r.A.clockwise?1:-1,c={x:s.x+a,y:s.y-l*u};return In(c,-i);}function $r(r,e,t,n){n===void 0&&(n=.001),typeof r=="string"&&(r=po(r)),t||(t=ia(r));var i=Math.atan2(e.y-t.y,e.x-t.x),s=Math.atan2(r.M.y-t.y,r.M.x-t.x),o=Math.atan2(r.A.y-t.y,r.A.x-t.x);if(Math.abs(s-i)<n||Math.abs(s-i)>Math.PI*2-n||Math.abs(o-i)<n)return!0;var a=Math.abs(s-o)>Math.PI==r.A.largeArc>0;return Math.abs(Math.abs(s-o)-Math.PI)<n&&(a=(s<=0&&o>=0)==(r.A.clockwise===1)),s>=o&&s>=i&&i>=o||s<=o&&s<=i&&i<=o?a:!a;}function iae(r,e,t,n){var i,s,o,a,l,u,c,h={x:null,y:null},d={x:null,y:null},f=null;return f=yD(r,e,t,n),f?{d:0,point:f}:(f=Gl(r,t,n),l=f.d,a=1/0,l<a&&(a=l,h.x=f.point.x,h.y=f.point.y,d=r),f=Gl(e,t,n),l=f.d,l<a&&(a=l,h.x=f.point.x,h.y=f.point.y,d=e),f=Gl(t,r,e),l=f.d,l<a&&(a=l,h.x=f.point.x,h.y=f.point.y,d=t),f=Gl(n,r,e),l=f.d,l<a&&(a=l,h.x=f.point.x,h.y=f.point.y,d=n),{d:a,nearP1:h,nearP2:d});}function sae(r,e,t,n){if(!(r&&e&&t&&n))return console.warn("Bad arguments!"),null;var i=Math.atan2(e.y-r.y,e.x-r.x);i<0&&(i+=Math.PI);var s=Math.atan2(n.y-t.y,n.x-t.x);return s<0&&(s+=Math.PI),Math.abs(s-i);}function mm(r,e,t){if(t=Number(t),!r||!e||isNaN(t))return console.warn("Bad arguments!"),null;if(r.x===e.x&&r.y===e.y)return console.warn("The input points should not be the same!"),null;var n=Math.atan2(e.y-r.y,e.x-r.x),i=In(r,n),s=In(e,n),o=s.x-i.x>0?1:-1,a={x:i.x+o*t,y:i.y};return In(a,-n);}function oae(r,e,t){var n=Math.atan2(e.y-r.y,e.x-r.x),i=In(r,n),s=In(t,n);return s.x>=i.x;}function aae(r){var e=[];if(r){var t=r.replace(/[MLZz,]/g," ").trim().split(/\s+/),n;t.length%2!==0&&console.warn("Error occured in transforming path: odd length found!"),t.forEach(function(i,s){let o=Number(i);isNaN(o)&&console.warn("Error occured in transforming path :NaN found in "+i+"! Probably because input argument is not a simple path."),s%2===0?n={x:o}:(n.y=o,e.push(n));});}return e;}function lae(r){if(!r.length)return[];for(var e=[],t={},n=0;n<r.length;n++){var i=typeof r[n]+r[n];t[i]||(e.push(r[n]),t[i]=!0);}return e;}function uae(r,e){if(!e&&r.clockwise!==void 0)return r.clockwise;for(var t=0,n=1,i=r.length;n<i;n++)t+=(r[n].x-r[n-1].x)*(r[n].y+r[n-1].y);return t+=(r[0].x-r[i-1].x)*(r[0].y+r[i-1].y),r.clockwise=t<0;}function wD(r,e,t){var n=[r,e,t],i=s(n);return{a:r/i,b:e/i,c:t/i};function s(o){o=o.filter(function(c){return c!=0;}).sort(function(c,h){return Math.abs(c)-Math.abs(h);});var a=u(o[o.length-1]),l=u(o[0]);if(a-l>10)return o.shift(),s(o);if(a<=0&&l<=0||l>=1)return o[0];return 1;function u(c){if(Math.abs(c)>=1){var h=Math.abs(c).toString();return h.indexOf("e")>=0?+h.split(/e/)[1]+1:h.split(".")[0].length;}else return h=Math.abs(c).toString(),h.indexOf("e-")>=0?-h.split(/e-/)[1]+1:-h.match(/\.0*/g)[0].length-1;}}}function cae(r,e,t){e=e||1,t=t||32;var n="",i=e,s=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];r&&(i=Math.round(Math.random()*(t-e))+e);for(var o=0;o<i;o++){let a=Math.round(Math.random()*(s.length-1));n+=s[a];}return n;}function hae(r,e,t,n){n===void 0&&(n=1e-4),typeof r=="string"&&(r=po(r)),t||(t=ia(r));var i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))/nr(t.x,t.y,r.M.x,r.M.y)-1;return!!(Math.abs(i)<n&&$r(r,e,t));}function fae(r,e){var t=1e-4;typeof r=="string"&&(r=po(r));var n,i,s,o,a,l,u,c,h,d,f,p=ia(r),m=nr(p.x,p.y,r.M.x,r.M.y),g=r.M,b={x:r.A.x,y:r.A.y},y={x:b.x-p.x||0,y:-(b.y-p.y)||0},v={x:g.x-p.x||0,y:-(g.y-p.y)||0};if(e.x==g.x&&e.y==g.y)var E="startPoint";else e.x==b.x&&e.y==b.y?E="endPoint":E="other";if(n=p.y-e.y,i=e.x-p.x,s=p.x*e.y-p.y*e.x,o=-i,a=n,l=-o*p.x-a*p.y,u=pD(o,a,l,p.x,p.y,m),u.length==2){c=u[0],h=u[1];var P={x:h.x-c.x,y:-(h.y-c.y)};E=="endPoint"?d=Math.atan2(P.y,P.x)-Math.atan2(v.y,v.x):d=Math.atan2(P.y,P.x)-Math.atan2(y.y,y.x),d>=Math.PI?d=2*Math.PI-d:d<=-Math.PI?d+=2*Math.PI:d>-Math.PI&&d<0&&(d=-d);var M={x:c.x-h.x,y:-(c.y-h.y)};E=="endPoint"?f=Math.atan2(M.y,M.x)-Math.atan2(v.y,v.x):f=Math.atan2(M.y,M.x)-Math.atan2(y.y,y.x),f>=Math.PI?f=2*Math.PI-f:f<=-Math.PI?f+=2*Math.PI:f>-Math.PI&&f<0&&(f=-f);var I=+r.A.largeArc==1,C=Math.abs(d-f)<t;if(E=="endPoint"){if(C){if($r(r,h,p))return M;if($r(r,c,p))return P;}else{if(d<f&&!I||d>f&&I)return M;if(d<f&&I||d>f&&!I)return P;}}else if(E=="startPoint")if(C){if($r(r,h,p))return P;if($r(r,c,p))return M;}else{if(d<f&&!I||d>f&&I)return P;if(d<f&&I||d>f&&!I)return M;}}}function dae(r,e,t){var n=.001;if(typeof r=="string"&&(r=po(r)),!r||!e||!t)return null;if(r.A.rx!==r.A.ry)return console.warn("Eclipse is not supported."),null;var i=ia(r),s=iy(e,t,i.x,i.y,r.A.rx);return s=s.filter(function(o){return!!$r(r,o,i);}),s.length===0?null:s.length===2&&Math.abs(s[0].x-s[1].x)<n&&Math.abs(s[0].y-s[1].y)<n?[s[0]]:s;}function pae(r,e,t,n){var i=+e.y-+r.y,s=+e.x-+r.x,o=Math.sqrt(i*i+s*s),a,l;if(Math.abs(r.x-e.x)<1e-12&&Math.abs(r.y-e.y)<1e-12){var u=Math.atan2(n,1);l=Math.cos(u)*t,a=Math.sin(u)*t;}else if(n==="none"||n==1/0||n==-1/0){let h=i>0?t:-t;a=i+h,l=0;}else if(o===0)l=Math.sqrt(t*t/(n*n+1)),a=l*n;else{var c=o+t;a=i*c/o,l=s*c/o;}return{x:+r.x+l,y:+r.y+a};}function mae(r,e,t,n){function i(l,u,c,h){return l*h-u*c;}var s=i(e.x-r.x,t.x-n.x,e.y-r.y,t.y-n.y);if(s<=1e-6&&s>=-1e-6)return!1;var o=i(t.x-r.x,t.x-n.x,t.y-r.y,t.y-n.y)/s;if(o>1||o<0)return!1;var a=i(e.x-r.x,t.x-r.x,e.y-r.y,t.y-r.y)/s;return!(a>1||a<0);}function vD(r,e,t,n,i,s){var o=(i-t)*(r-t)+(s-n)*(e-n),a=(i-t)*(i-t)+(s-n)*(s-n),l=o/a,u=t+(i-t)*l,c=n+(s-n)*l;return o<=0?Math.sqrt((r-t)*(r-t)+(e-n)*(e-n)):o>=a?Math.sqrt((r-i)*(r-i)+(e-s)*(e-s)):Math.sqrt((r-u)*(r-u)+(c-e)*(c-e));}function gae(r,e,t,n,i,s){var o={x:i.cx,y:i.cy},a={x:r,y:e},l={x:t,y:n},u=!0,c=i.rx,h={x:+s[0],y:+s[1]},d={x:+s[7],y:+s[8]},f=nr(o.x,o.y,r,e),p=nr(o.x,o.y,t,n),m={A:{clockwise:+s[6],largeArc:+s[5],rotation:+s[4],rx:+s[3],ry:+s[2],x:+s[7],y:+s[8]},M:{x:+s[0],y:+s[1]}},g=0,b=0,y=0,v=0,E=0,P=0,M=0,I=0,C=0,L=[],S=Dl(a,l,o,u);if(S)if(nr(S.x,S.y,o.x,o.y)>c){var T=dm(S,o,o.x,o.y,c)[0];$r(m,T,o)&&(g=nr(S.x,S.y,T.x,T.y),L.push(g));}else T=mm(o,S,c),T&&$r(m,T,o)&&(g=nr(S.x,S.y,T.x,T.y),L.push(g));var B=Dl(a,l,h,u);B&&(b=nr(B.x,B.y,h.x,h.y),L.push(b));var $=Dl(a,l,d,u);if($&&(y=nr($.x,$.y,d.x,d.y),L.push(y)),f>c){var Z=dm(a,o,o.x,o.y,c)[0];$r(m,Z,o)&&(v=nr(Z.x,Z.y,a.x,a.y),L.push(v));}else Z=mm(o,a,c),$r(m,Z,o)&&(v=nr(Z.x,Z.y,a.x,a.y),L.push(v));return p>c?(Z=dm(l,o,o.x,o.y,c)[0],$r(m,Z,o)&&(E=nr(Z.x,Z.y,l.x,l.y),L.push(E))):(Z=mm(o,l,c),$r(m,Z,o)&&(E=nr(Z.x,Z.y,l.x,l.y),L.push(E))),P=nr(a.x,a.y,h.x,h.y),M=nr(a.x,a.y,d.x,d.y),I=nr(l.x,l.y,h.x,h.y),C=nr(l.x,l.y,d.x,d.y),L.push(P,M,I,C),Math.min.apply(null,L);}function xae(r,e,t){var n=t.y-e.y,i=e.x-t.x,s=t.x*e.y-e.x*t.y;return gD(r,n,i,s);}function bae(r){return{x:Math.round(r.x*1e4),y:Math.round(r.y*1e4)};}function yae(r,e){if(!e||!e.length)return r;let t=e.indexOf(r);if(t>=0)return e[t];t=0;let n=1/0;return e.forEach((i,s)=>{n>Math.abs(i-r)&&(t=s);}),e[t];}function ED(r,e,t){return pm(r,e,t)?fm((r.x-e.x)*(t.y-e.y),(t.x-e.x)*(r.y-e.y),.001):!1;}var Fl=1e-4,V=new Float64Array(100);function dn(r,e){if(r instanceof q&&e instanceof q)return hi(r,e);if(r instanceof ee&&e instanceof q)return xm(r,e);if(r instanceof q&&e instanceof ee)return xm(e,r);if(r instanceof ee&&e instanceof ee)return cy(r,e);if(r instanceof Ce&&e instanceof Ce)return th(r,e);if(r instanceof Ce&&e instanceof q)return th(r,new Ce([e.start(),e.end()]));if(r instanceof q&&e instanceof Ce)return th(new Ce([r.start(),r.end()]),e);if(r instanceof Ce&&e instanceof ee)return gy(e,r);if(r instanceof ee&&e instanceof Ce)return gy(r,e);throw new Error("not supported operation");}function wae(r,e){let t=r.primitives,n=e.primitives,i=t.length>n.length?n:t,s=t.length>n.length?t:n,o=!1;return i.some(a=>(s.some(l=>(o=dn(a,l)>0,o)),o)),o;}function vae(r,e){if(r instanceof q)return sy(r,e);if(r instanceof ee)return oy(r,e);if(r instanceof Ce)return gm(r,e);throw new Error("not supported operation");}function sy(r,e){let t=r.bbox();if(t.isContainsY1(e)){let n=new q(new F(t.minX-1,e),new F(t.maxX+1,e));return hi(n,r)>0?1:0;}else return 0;}function oy(r,e){if(r.rx===r.ry){let t=r.bbox();if(t.isContainsY1(e)){let n=new q(new F(t.minX-1,e),new F(t.maxX+1,e));return ql(r,n)>0?1:0;}else return 0;}else throw new Error("not supported operation");}function Eae(r,e){if(r.rx===r.ry){let t=r.bbox();if(t.isContainsY1(e)){let n=new q(new F(t.minX-1,e),new F(t.maxX+1,e)),i=ql(r,n);return i>0?i:0;}else return 0;}else throw new Error("not supported operation");}function gm(r,e){let t=r.bbox();return t.isContainsY1(e)&&th(new Ce([new F(t.minX-1,e),new F(t.maxX+1,e)]),r)>0?1:0;}function ay(r,e,t){return isFinite(e)&&isFinite(t)?r.isContains2(e,t):!1;}function PD(r,e){let t=e.length(),n=Yt.crossProd3(e.start(),e.end(),r.start())/t,i=Yt.crossProd3(e.start(),e.end(),r.end())/t;return Math.abs(n)<1e-8||Math.abs(i)<1e-8||n*i<0;}function hi(r,e){let t=r.bbox().intersection1(e.bbox());if(!t)return 0;if(r.isPoint()){if(e.isPoint()){let n=t.center();return V[0]=n.x,V[1]=n.y,2;}else return ly(e,r,t);}else{if(e.isPoint())return ly(r,e,t);{let n=function(v,E){t.isContains2(v,E)&&(V[y++]=v,V[y++]=E);};if(!PD(r,e))return 0;let i=r.start().x,s=r.start().y,o=r.end().x,a=r.end().y,l=e.start().x,u=e.start().y,c=e.end().x,h=e.end().y,d=e.length(),f=Yt.crossProd2(i,s,l,u,c,h)/d,p=Yt.crossProd2(o,a,l,u,c,h)/d;if(f*p>0&&!ue.eq(f,0)&&!ue.eq(p,0))return 0;let m=r.length(),g=Yt.crossProd2(l,u,i,s,o,a)/m,b=Yt.crossProd2(c,h,i,s,o,a)/m;if(g*b>0&&!ue.eq(g,0)&&!ue.eq(b,0))return 0;let y=0;if(ue.eq(f,0)&&ue.eq(p,0)){let v=t.UL(),E=t.UR(),P=t.LL(),M=t.LR();if(ue.eq(t.width(),0))ue.eq(t.height(),0)?(V[y++]=v.x,V[y++]=v.y):(V[y++]=v.x,V[y++]=v.y,V[y++]=P.x,V[y++]=P.y);else if(ue.eq(t.height(),0))V[y++]=v.x,V[y++]=v.y,V[y++]=E.x,V[y++]=E.y;else{let I=$i.area2(v.x,v.y,l,u,c,h),C=$i.area2(E.x,E.y,l,u,c,h);I<C?(V[y++]=v.x,V[y++]=v.y,V[y++]=M.x,V[y++]=M.y):(V[y++]=E.x,V[y++]=E.y,V[y++]=P.x,V[y++]=P.y);}}else if(ue.eq(f,0))n(i,s);else if(ue.eq(p,0))n(o,a);else{let v=Math.abs(f/(f-p));n(i+(o-i)*v,s+(a-s)*v);}return y;}}}function ly(r,e,t){let n=e.start(),i=e.end(),s=Yt.crossProd3(r.start(),r.end(),e.start()),o=Yt.crossProd3(r.start(),r.end(),e.end());if(s*o<0){let a=t.center();return V[0]=a.x,V[1]=a.y,2;}else if(Math.abs(s)<Math.abs(o)){if(ue.eq(s/r.length(),0))return V[0]=n.x,V[1]=n.y,2;}else if(ue.eq(o/r.length(),0))return V[0]=i.x,V[1]=i.y,2;return 0;}function Pae(r,e){return r.bbox().extendOfSize(1e-8).isContains(e)?r.isPoint()?e.equals1(r.start())?(V[0]=e.x,V[1]=e.y,2):0:ue.eq($i.area2(r.start().x,r.start().y,r.end().x,r.end().y,e.x,e.y),0)?(V[0]=e.x,V[1]=e.y,2):0:0;}function _D(r,e,t,n=.5){let i=my(r,e,t);i.d<=n&&(r=i.point);let s=e.distance1(t),o=e.distance1(r),a=t.distance1(r);return!!fm(o+a,s,.001);}function ql(r,e){let t=r.bbox().intersection1(e.bbox());if(t!=null){t=t.extendOfSize(Fl);let n=r.center.x,i=r.center.y,s=r.rx,o=r.rx2,a=e.start().x,l=e.start().y,u=e.end().x,c=e.end().y,h=r.center.distance1(e.start()),d=r.center.distance1(e.end()),f=ue.eq(h,s)?0:h>s?1:-1,p=ue.eq(d,s)?0:d>s?1:-1,m=0;if(f===-1&&p===-1)return 0;if(f===0&&p===0)V[m++]=a,V[m++]=l,V[m++]=u,V[m++]=c;else if(f===1&&p===1){let g=Di.foot(e,r.center),b=g.distance1(r.center);if(ue.greater(b,s))return 0;if(ue.eq(b,s))ue.eq(e.distance2(r.start()),0)?(V[m++]=r.start().x,V[m++]=r.start().y,V[m++]=r.start().x,V[m++]=r.start().y):ue.eq(e.distance2(r.end()),0)?(V[m++]=r.end().x,V[m++]=r.end().y,V[m++]=r.end().x,V[m++]=r.end().y):(V[m++]=g.x,V[m++]=g.y,V[m++]=g.x,V[m++]=g.y);else{m=uy(n,i,a,l,u,c,m,g);let y=V[m-2],v=V[m-1];m-=2;let E=Yt.distance1(n,i,y,v);if(ue.eq(E,s))V[m++]=y,V[m++]=v,V[m++]=y,V[m++]=v;else if(E<s)m=vr(o,n,i,a,l,y,v,m),m=vr(o,n,i,y,v,u,c,m);else return 0;}}else if(f===-1||p===-1)m=vr(o,n,i,a,l,u,c,m);else{let g=Di.foot(e,r.center),b=g.distance1(r.center);if(ue.eq(b,s)){let y=function(P){return ay(t,P.x,P.y)&&$t(r,P);},v=r.start(),E=r.end();if(f===0){let P=e.start();if(y(P))return V[m++]=P.x,V[m++]=P.y,V[m++]=P.x,V[m++]=P.y,m;if(y(g))return V[m++]=g.x,V[m++]=g.y,V[m++]=g.x,V[m++]=g.y,m;if(ue.eq(e.distance2(v),0)&&y(v))return V[m++]=v.x,V[m++]=v.y,V[m++]=v.x,V[m++]=v.y,m;if(ue.eq(e.distance2(E),0)&&y(E))return V[m++]=E.x,V[m++]=E.y,V[m++]=E.x,V[m++]=E.y,m;if(h<=s)m=vr(o,n,i,g.x,g.y,u,c,m),m===2&&(V[m++]=V[0],V[m++]=V[1]);else if(b<s){if(m=vr(o,n,i,g.x,g.y,u,c,m),m===2&&y(new F(V[0],V[1])))return V[m++]=V[0],V[m++]=V[1],m;m=vr(o,n,i,g.x,g.y,a,l,0),m===2&&(V[m++]=V[0],V[m++]=V[1]);}}else{let P=e.end();if(y(P))return V[m++]=P.x,V[m++]=P.y,V[m++]=P.x,V[m++]=P.y,m;if(y(g))return V[m++]=g.x,V[m++]=g.y,V[m++]=g.x,V[m++]=g.y,m;if(ue.eq(e.distance2(v),0)&&y(v))return V[m++]=v.x,V[m++]=v.y,V[m++]=v.x,V[m++]=v.y,m;if(ue.eq(e.distance2(E),0)&&y(E))return V[m++]=E.x,V[m++]=E.y,V[m++]=E.x,V[m++]=E.y,m;if(d<=s)m=vr(o,n,i,g.x,g.y,a,l,m),m===2&&(V[m++]=V[0],V[m++]=V[1]);else if(b<s){if(m=vr(o,n,i,g.x,g.y,a,l,m),m===2&&y(new F(V[0],V[1])))return V[m++]=V[0],V[m++]=V[1],m;m=vr(o,n,i,g.x,g.y,u,c,0),m===2&&(V[m++]=V[0],V[m++]=V[1]);}}}else if(f===0){let y=e.start();V[m++]=y.x,V[m++]=y.y,(a-g.x)*(u-g.x)+(l-g.y)*(c-g.y)<0&&(m=vr(o,n,i,g.x,g.y,u,c,m));}else{let y=e.end();V[m++]=y.x,V[m++]=y.y,(a-g.x)*(u-g.x)+(l-g.y)*(c-g.y)<0&&(m=vr(o,n,i,g.x,g.y,a,l,m));}}if(m>0){let g=0;for(let b=0;b<m;b+=2){let y=V[b],v=V[b+1];isFinite(y)&&isFinite(v)&&ay(t,y,v)&&$t(r,new F(y,v))&&(V[g++]=y,V[g++]=v);}return g;}else return 0;}else return 0;}function SD(r,e){if(r.bbox()){let t=r.center.x,n=r.center.y,i=r.rx2,s=e.start().x,o=e.start().y,a=e.end().x,l=e.end().y,u=r.center.distance2(e.start()),c=r.center.distance2(e.end()),h=ue.eq(u,i)?0:u>i?1:-1,d=ue.eq(c,i)?0:c>i?1:-1,f=0;if(h===-1&&d===-1)return 0;if(h===0&&d===0)V[f++]=s,V[f++]=o,V[f++]=a,V[f++]=l;else if(h===1&&d===1){let p=Di.foot(e,r.center),m=p.distance2(r.center);if(ue.greater(m,i))return 0;if(ue.eq(m,i)){let g=p.distance2(r.start()),b=p.distance2(r.end());ue.eq(g,0)?(V[f++]=r.start().x,V[f++]=r.start().y):ue.eq(b,0)?(V[f++]=r.end().x,V[f++]=r.end().y):(V[f++]=p.x,V[f++]=p.y);}else{f=uy(t,n,s,o,a,l,f,p);let g=V[f-2],b=V[f-1],y=Yt.distance2(t,n,g,b);if(f-=2,ue.eq(y,i))V[f++]=g,V[f++]=b;else if(y<i)f=vr(i,t,n,s,o,g,b,f),f=vr(i,t,n,g,b,a,l,f);else return 0;}}else if(h===-1||d===-1)f=vr(i,t,n,s,o,a,l,f);else{let p=Di.foot(e,r.center);h===0?(V[f++]=e.start().x,V[f++]=e.start().y,ue.neq(p.distance2(e.start()),0)&&(s-p.x)*(a-p.x)+(o-p.y)*(l-p.y)<0&&(f=vr(i,t,n,p.x,p.y,a,l,f))):(V[f++]=e.end().x,V[f++]=e.end().y,ue.neq(p.distance2(e.end()),0)&&(s-p.x)*(a-p.x)+(o-p.y)*(l-p.y)<0&&(f=vr(i,t,n,p.x,p.y,s,o,f)));}if(f>0){let p=0;for(let m=0;m<f;m+=2){let g=V[m],b=V[m+1];isFinite(g)&&isFinite(b)&&(V[p++]=g,V[p++]=b);}return p;}else return 0;}else return 0;}function vr(r,e,t,n,i,s,o,a){if(i==o){let v=r-(i-t)*(i-t);if(ue.greater(v,0)){let E=Math.sqrt(v),P=e-E,M=e+E,I=Math.min(n,s),C=Math.max(n,s);return P>=I&&P<=C&&(V[a++]=P,V[a++]=i),M>=I&&M<=C&&(V[a++]=M,V[a++]=i),a;}}let l=Yt.distance2(n,i,e,t)-r,u=Yt.distance2(s,o,e,t)-r,c=n,h=i,d=s,f=o,p=NaN,m=NaN,g=Number.POSITIVE_INFINITY,b=0;for(;g!==0;){b++;let v=Math.max(Math.min(Math.abs(l)/(Math.abs(l)+Math.abs(u)),.75),.25);if(p=c+(d-c)*v,m=h+(f-h)*v,c===p&&h===m||d===p&&f===m){Math.abs(l)>Math.abs(u)?(p=d,m=f,g=u):(p=c,m=h,g=l);break;}else g=Yt.distance2(p,m,e,t)-r,g<0&&l>u||g>0&&l<u?(d=p,f=m,u=g):(c=p,h=m,l=g);}let y=Math.sqrt(r)-Yt.distance1(p,m,e,t);return(ue.eq(0,g)||ue.eq(0,y))&&(V[a++]=p,V[a++]=m),a;}function uy(r,e,t,n,i,s,o,a){let l=Yt.dotProd2(t,n,i,s,r,e),u=Yt.dotProd2(i,s,t,n,r,e);if(l>=0)return V[o++]=i,V[o++]=s,o;if(u>=0)return V[o++]=t,V[o++]=n,o;if(Yt.crossProd2(t,n,i,s,r,e)==0)return V[o++]=r,V[o++]=e,o;{let c=NaN,h=NaN,d=t,f=n,p=i,m=s,g=Yt.distance2(t,n,r,e),b=Yt.distance2(i,s,r,e),y=Number.POSITIVE_INFINITY,v=0;for(;y>0&&(v++,c=d+(p-d)*.5,h=f+(m-f)*.5,!(g==b||d==c&&f==h||p==c&&m==h));){y=Yt.distance2(c,h,r,e);let E=Yt.dotProd2(d,f,c,h,r,e);if(E==0)break;E<0?(p=c,m=h,b=y):(d=c,f=h,g=y);}return Yt.distance2(c,h,r,e)<Yt.distance2(a.x,a.y,r,e)?(V[o++]=c,V[o++]=h):(V[o++]=a.x,V[o++]=a.y),o;}}function xm(r,e){if(r.rx===r.ry)return ql(r,e);throw new Error("not supported");}function BD(r,e){if(r.rx===r.ry)return SD(r,e);throw new Error("not supported");}function cy(r,e){if(r.bbox().intersection1(e.bbox())!=null){if(r.rx===r.ry&&e.rx===e.ry)return ID(r,e);throw new Error("not supported operation");}return 0;}function ID(r,e){let t=r.center.x,n=r.center.y,i=e.center.x,s=e.center.y,o=r.rx,a=e.rx,l=r.rx2,u=e.rx2,c=r.center.distance1(e.center),h=Math.abs(o-a),d=o+a;if(ue.greater(c,d)||ue.less(c,h))return 0;if(ue.eq(c,d)){if(hy(r,e))return 4;let f=new q(r.center,e.center),p=ql(e,f);return p=fy(r,p),p!==0?p:(p=ql(r,f),fy(e,p));}else if(ue.greater(h,0)&&ue.greater(c,0)&&ue.eq(c,h)){if(hy(r,e))return 4;if(o>a){let f=(o-a)/o;return V[0]=t+(i-t)/f,V[1]=n+(s-n)/f,dy(r,e,2);}else{let f=(a-o)/a;return V[0]=i+(t-i)/f,V[1]=s+(n-s)/f,dy(r,e,2);}}else if(ue.eq(h,0)&&ue.eq(c,0)){let f=0,p;return $t(r,e.start())&&(V[f]=e.start().x,V[f+1]=e.start().y,f+=2,p=e.start()),$t(r,e.end())&&(V[f]=e.end().x,V[f+1]=e.end().y,f+=2,p=e.end()),f===0?($t(e,r.start())&&(V[f]=r.start().x,V[f+1]=r.start().y,f+=2),$t(e,r.end())&&(V[f]=r.end().x,V[f+1]=r.end().y,f+=2)):f===2&&(!p.equals1(r.start())&&$t(e,r.start())&&(V[f]=r.start().x,V[f+1]=r.start().y,f+=2),!p.equals1(r.end())&&$t(e,r.end())&&(V[f]=r.end().x,V[f+1]=r.end().y,f+=2)),f;}else{let f=(r.center.distance2(e.center)-u+l)/(c*2)/c,p=(i-t)*f+t,m=(s-n)*f+n,g=i-t,b=s-n,y=Math.max(o,a),v,E,P,M;if(Math.abs(g)<Math.abs(b)){let S=g/-b,T=m-S*p;v=p-y,E=S*v+T,P=p+y,M=S*P+T;}else{let S=b/-g,T=p-S*m;E=m-y,v=S*E+T,M=m+y,P=S*M+T;}let I=vr(l,t,n,v,E,p,m,0);if(I=vr(l,t,n,p,m,P,M,I),I!==4)throw new Error("cnt !== 4");let C=new F(V[0],V[1]),L=new F(V[2],V[3]);if($t(r,C)&&$t(e,C))return $t(r,L)&&$t(e,L)?4:xs(r.start(),e,L,C)?(V[2]=r.start().x,V[3]=r.start().y,4):xs(r.end(),e,L,C)?(V[2]=r.end().x,V[3]=r.end().y,4):xs(e.start(),r,L,C)?(V[2]=e.start().x,V[3]=e.start().y,4):xs(e.end(),r,L,C)?(V[2]=e.end().x,V[3]=e.end().y,4):2;if($t(r,L)&&$t(e,L))return xs(r.start(),e,C,L)?(V[0]=r.start().x,V[1]=r.start().y,4):xs(r.end(),e,C,L)?(V[0]=r.end().x,V[1]=r.end().y,4):xs(e.start(),r,C,L)?(V[0]=e.start().x,V[1]=e.start().y,4):xs(e.end(),r,C,L)?(V[0]=e.end().x,V[1]=e.end().y,4):(V[0]=V[2],V[1]=V[3],2);{let S=function(Z,H){if(ue.eq(Z.distance1(H.center),H.rx)&&$t(H,Z)){if(Z.distance2(C)<Z.distance2(L)){if(T)return;T=!0;}else{if(B)return;B=!0;}V[$++]=Z.x,V[$++]=Z.y;}},T=!1,B=!1,$=0;return S(r.start(),e),S(r.end(),e),S(e.start(),r),S(e.end(),r),$;}}}function xs(r,e,t,n){return ue.eq(r.distance1(e.center),e.rx)&&$t(e,r)&&r.distance2(t)<r.distance2(n);}function hy(r,e){return ue.eq(e.start().distance1(r.center),r.rx)&&$t(r,e.start())?(V[0]=e.start().x,V[1]=e.start().y,V[2]=e.start().x,V[3]=e.start().y,!0):ue.eq(e.end().distance1(r.center),r.rx)&&$t(r,e.end())?(V[0]=e.end().x,V[1]=e.end().y,V[2]=e.end().x,V[3]=e.end().y,!0):ue.eq(r.start().distance1(e.center),e.rx)&&$t(e,r.start())?(V[0]=r.start().x,V[1]=r.start().y,V[2]=r.start().x,V[3]=r.start().y,!0):ue.eq(r.end().distance1(e.center),e.rx)&&$t(e,r.end())?(V[0]=r.end().x,V[1]=r.end().y,V[2]=r.end().x,V[3]=r.end().y,!0):!1;}function fy(r,e){if(e===0)return 0;let t=V[0],n=V[1];return $t(r,new F(t,n))?(V[0]=t,V[1]=n,V[2]=t,V[3]=n,4):0;}function dy(r,e,t){if(t===0)return 0;let n=V[0],i=V[1],s=new F(n,i);return $t(r,s)&&$t(e,s)?(V[0]=n,V[1]=i,V[2]=n,V[3]=i,4):0;}function sa(r,e){return Math.abs(r-e)<=1e-6;}function $t(r,e){let t=r.bbox();if(e.x-t.minX>-Fl&&e.x-t.maxX<Fl&&e.y-t.minY>-Fl&&e.y-t.maxY<Fl){let n=Xe.regularD(e.angleD(r.center));return sa(n,r.startAngle)||sa(n,r.startAngle+360)||sa(n,r.startAngle-360)||sa(n,r.endAngle())||sa(n,r.endAngle()+360)||sa(n,r.endAngle()-360)?!0:r.sweepAngle>0?(ue.less(n,r.startAngle)&&(n+=360),ue.greatereq(r.endAngle(),n)):(ue.greater(n,r.startAngle)&&(n-=360),ue.lesseq(r.endAngle(),n));}else return!1;}function _ae(r,e){return e.primitives.some(t=>_D(r,t.start(),t.end()));}function Sae(r,e,t,n=.5){return mD(r,e,t)?Yt.crossProd3(r,e,t)<Math.sin(Math.PI/180):!1;}function Bae(r){let e=[];r.points(1,t=>{e.push(t);});for(let t=0;t<r.primitives.length;t++){let n=r.primitives[t],i=r.primitives[t+1];for(;i&&py([n.start(),n.end()],[i.start(),i.end()]);)t++,n=r.primitives[t],i=r.primitives[t+1];return t==r.primitives.length-1;}}function py(r,e){let t=r[1].x-r[0].x,n=r[1].y-r[0].y,i=e[1].x-e[0].x,s=e[1].y-e[0].y;if(t===0&&i!==0||t!==0&&i===0)return!1;if(t===0&&i===0)return!0;let o=n/t,a=s/i;return fm(o,a,Math.sin(Math.PI/180));}function my(r,e,t){var n,i=+e.x,s=+e.y,o=+t.x,a=+t.y,l=+r.x,u=+r.y,c=o-i,h=a-s,d=l-i,f=u-s,p,m,g,b,y,v;return c===0&&h===0?{d:Math.sqrt(d*d+f*f),point:new F(i,s)}:(n=(d*c+f*h)/(c*c+h*h),n<0?{d:Math.sqrt(d*d+f*f),point:new F(i,s)}:n>1?(p=l-o,m=u-a,{d:Math.sqrt(p*p+m*m),point:new F(o,a)}):(y=i+n*c,v=s+n*h,g=l-y,b=u-v,{d:Math.sqrt(g*g+b*b),point:new F(y,v)}));}function AD(r,e,t,n){function i(m,g,b){return m instanceof F&&g instanceof F?Math.abs(m.x-g.x)<=b&&Math.abs(m.y-g.y)<=b:!1;}var s=i(r,t,.5)||i(r,n,.5)?r:i(e,t,.5)||i(e,n,.5)?e:null;if(s)return!1;var o,a,l,u,c,h,d,f,p;return o=e.x-r.x,a=e.y-r.y,l=n.x-t.x,u=n.y-t.y,d=l*a-u*o,d===0?!1:(f=t.x-r.x,p=t.y-r.y,h=(o*p-a*f)/d,c=(l*p-u*f)/d,h>=0&&h<=1&&c>=0&&c<=1?new F(r.x+c*o,r.y+c*a):!1);}function jn(r,e){if(!r||!e||r.length!=e.length)return!1;let t="equals1";return!r.some((n,i)=>{let s=e[i],o=!1;return n&&s&&typeof n=="object"&&typeof s=="object"?typeof n[t]=="function"&&MD(n,s)?o=!n[t].call(n,s):o=!(n===s||n.toString()===s.toString()):typeof n=="number"&&typeof s=="number"?o=!(CD(n,s)||Number.isNaN(n)&&Number.isNaN(s)):o=n!==s,o;});}function CD(r,e,t=5){return Math.abs(r-e)*Math.pow(10,t)<1;}function MD(r,e){return!r||!e||typeof r!="object"||typeof e!="object"?r===e:r.constructor===e.constructor;}function Iae(r,e){return new q(r,e);}function Aae(r){let e=[];for(let t=0;t<r.primitives.length;t++){let n=r.primitives[t];for(let i=t+1;i<r.primitives.length;i++){let s=r.primitives[i],o=AD(n.start().mul(.1),n.end().mul(.1),s.start().mul(.1),s.end().mul(.1));o&&e.push(o.mul(10));}}return e;}function Cae(r,e,t,n){var i=e.y-r.y,s=r.x-e.x,o=i*r.x+s*r.y,a=n.y-t.y,l=t.x-n.x,u=a*t.x+l*t.y,c=i*l-a*s;if(c==0)return null;var h=(l*o-s*u)/c,d=(i*u-a*o)/c;return new F(h,d);}function Mae(r,e,t){isNaN(t)&&(t=.001);let n=r.center,i=r.start(),s=r.rx,o=r.ry;var a=Math.atan2(e.y-n.y,e.x-n.x),l=Math.atan2(i.y-n.y,i.x-n.x),u=Math.atan2(o-n.y,s-n.x);if(Math.abs(l-a)<t||Math.abs(l-a)>Math.PI*2-t||Math.abs(u-a)<t)return!0;var c=Math.abs(l-u)>Math.PI===r.isLarge();return Math.abs(Math.abs(l-u)-Math.PI)<t&&(c=(l<=0&&u>=0)==!r.isCCW),l>=u&&l>=a&&a>=u||l<=u&&l<=a&&a<=u?c:!c;}var Ke=new Float64Array(100);function th(r,e){if(r.bbox().extendOfSize(ue.eps).isSeparated(e.bbox()))return 0;let t=[[r,e]],n=(r.controls.length-1)*(e.controls.length-1)*8,i=0,s=Number.POSITIVE_INFINITY;for(;t.length!==0;){let o=function(W){T=Math.min(T,W),B=Math.max(B,W);},a=function(W,Y){let U=hi(W,Y);if(U===0)throw new Error("cnt === 0");for(let D=0;D<U;D+=2)o(V[D]);};if(i>n){for(let W=i-2;W>=2;W-=2)for(let Y=W-2;Y>=0;Y-=2)if(ue.eq(Ke[W],Ke[Y])&&ue.eq(Ke[W+1],Ke[Y+1])){Ke[Y]=(Ke[W]+Ke[Y])/2,Ke[Y+1]=(Ke[W+1]+Ke[Y+1])/2;for(let U=i-3;U>=W;U--)Ke[U]=Ke[U+2];i-=2;break;}if(i>n){i=0;let W=e.start(),Y=new Float64Array(8);r.getPercent(W)!==null&&(Y[i++]=W.x,Y[i++]=W.y);let U=e.end();r.getPercent(U)!==null&&(Y[i++]=U.x,Y[i++]=U.y);let D=r.start();e.getPercent(D)!==null&&(Y[i++]=D.x,Y[i++]=D.y);let k=r.end();return e.getPercent(k)!==null&&(Y[i++]=k.x,Y[i++]=k.y),V.set(Y),i;}}let[l,u]=t.pop(),c=l.controls,h=u.controls;if(c.length===2&&h.length===2){let W=hi(new q(c[0],c[1]),new q(h[0],h[1]));for(let Y=0;Y<W;Y++)Ke[i++]=V[Y];continue;}let d=c[0],f=c[c.length-1];d.equals1(f)&&(f=d.add1(1,0));let p=f.y-d.y,m=d.x-f.x,g=-p*d.x-m*d.y,b=Math.sqrt(1/(p**2+m**2));p*=b,m*=b,g*=b;let y=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY;if(c.forEach(W=>{let Y=p*W.x+m*W.y+g;Y<y&&(y=Y),Y>v&&(v=Y);}),ue.eq(y,v)){if(u.controls.length===2){let W=hi(new q(l.start(),l.end()),new q(u.start(),u.end()));for(let Y=0;Y<W;Y++)Ke[i++]=V[Y];if(W!==0)continue;}l=new Ce([c[0],c[c.length-1]]),c=l.controls;}let E=h.map(W=>{let Y=p*W.x+m*W.y+g,U=Math.abs(Y);return U<s&&(s=U),Y;}),P=0;for(let W of E){if(ue.less(W,y))P=P|1;else if(ue.greater(W,v))P=P|2;else{P=3;break;}if(P===3)break;}if(P!==3)continue;let M=0,I=0,C=f.x-d.x,L=f.y-d.y,S=Math.sqrt(1/(C**2+L**2));C*=S,L*=S;for(let W=1;W<c.length;W++){let Y=c[W],U=(Y.x-d.x)*C+(Y.y-d.y)*L;U<M?M=U:U>I&&(I=U);}P=0;for(let W of h){let Y=(W.x-d.x)*C+(W.y-d.y)*L;if(ue.less(Y,M))P=P|1;else if(ue.greater(Y,I))P=P|2;else{P=3;break;}if(P===3)break;}if(P!==3)continue;let T=Number.POSITIVE_INFINITY,B=Number.NEGATIVE_INFINITY;s/=2,s<=ue.eps&&(s=ue.eps),y-=s,v+=s,E.forEach((W,Y)=>{W>=y&&W<=v&&o(Y/(E.length-1));});let $=new q(new F(0,y),new F(1,y)),Z=new q(new F(0,v),new F(1,v));for(let W=0;W<E.length-1;W++){let Y=new F(W/(E.length-1),E[W]),U=Y.y<y?1:Y.y>v?2:3;for(let D=0;D<E.length;D++){let k=new F(D/(E.length-1),E[D]),ie=k.y<y?1:k.y>v?2:3;U!==ie&&(U===1?ie===2?(a(new q(Y,k),$),a(new q(Y,k),Z)):a(new q(Y,k),$):U===2?ie===1?(a(new q(Y,k),$),a(new q(Y,k),Z)):a(new q(Y,k),Z):ie===1?a(new q(Y,k),$):a(new q(Y,k),Z));}}T!==0&&(u=u.clip(T)[1]),B!==1&&(u=u.clip((B-T)/(1-T))[0]);let H=u.bbox();if(ue.eq(H.minX,H.maxX)&&ue.eq(H.minY,H.maxY)){P=0;for(let W of u.controls){let Y=(W.x-d.x)*C+(W.y-d.y)*L;if(ue.less(Y,M))P=P|1;else if(ue.greater(Y,I))P=P|2;else{P=3;break;}if(P===3)break;}if(P===3){let W=new F((H.minX+H.maxX)/2,(H.minY+H.maxY)/2);l.getPercent(W)&&(Ke[i++]=W.x,Ke[i++]=W.y);}continue;}if(B-T>.8){let[W,Y]=u.clip(.5);t.push([W,l]),t.push([Y,l]);}else t.push([u,l]);}for(let o=0;o<i;o++)V[o]=Ke[o];return i;}function TD(r,e){if(r.bbox().extendOfSize(ue.eps).isSeparated(e.bbox()))return{cnt:0};let t=[[r,e]],n=(r.controls.length-1)*(e.controls.length-1)*8,i=0,s=Number.POSITIVE_INFINITY;for(;t.length!==0;){let o=function(W){T=Math.min(T,W),B=Math.max(B,W);},a=function(W,Y){let U=hi(W,Y);if(U===0)throw new Error("cnt === 0");for(let D=0;D<U;D+=2)o(V[D]);};if(i>n){for(let W=i-2;W>=2;W-=2)for(let Y=W-2;Y>=0;Y-=2)if(ue.eq(Ke[W],Ke[Y])&&ue.eq(Ke[W+1],Ke[Y+1])){Ke[Y]=(Ke[W]+Ke[Y])/2,Ke[Y+1]=(Ke[W+1]+Ke[Y+1])/2;for(let U=i-3;U>=W;U--)Ke[U]=Ke[U+2];i-=2;break;}if(i>n){i=0;let W=new Float64Array(8),Y=e.end(),U=0;r.getPercent(Y)!==null&&(W[i++]=Y.x,W[i++]=Y.y,U=2);let D=r.end();return e.getPercent(D)!==null&&(W[i++]=D.x,W[i++]=D.y,U=U===0?1:3),V.set(W),{havOverlap:U,cnt:i};}}let[l,u]=t.pop(),c=l.controls,h=u.controls;if(c.length===2&&h.length===2){let W=hi(new q(c[0],c[1]),new q(h[0],h[1]));for(let Y=0;Y<W;Y++)Ke[i++]=V[Y];continue;}let d=c[0],f=c[c.length-1];d.equals1(f)&&(f=d.add1(1,0));let p=f.y-d.y,m=d.x-f.x,g=-p*d.x-m*d.y,b=Math.sqrt(1/(p**2+m**2));p*=b,m*=b,g*=b;let y=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY;if(c.forEach(W=>{let Y=p*W.x+m*W.y+g;Y<y&&(y=Y),Y>v&&(v=Y);}),ue.eq(y,v)){if(u.controls.length===2){let W=hi(new q(l.start(),l.end()),new q(u.start(),u.end()));for(let Y=0;Y<W;Y++)Ke[i++]=V[Y];if(W!==0)continue;}l=new Ce([c[0],c[c.length-1]]),c=l.controls;}let E=h.map(W=>{let Y=p*W.x+m*W.y+g,U=Math.abs(Y);return U<s&&(s=U),Y;}),P=0;for(let W of E){if(ue.less(W,y))P=P|1;else if(ue.greater(W,v))P=P|2;else{P=3;break;}if(P===3)break;}if(P!==3)continue;let M=0,I=0,C=f.x-d.x,L=f.y-d.y,S=Math.sqrt(1/(C**2+L**2));C*=S,L*=S;for(let W=1;W<c.length;W++){let Y=c[W],U=(Y.x-d.x)*C+(Y.y-d.y)*L;U<M?M=U:U>I&&(I=U);}P=0;for(let W of h){let Y=(W.x-d.x)*C+(W.y-d.y)*L;if(ue.less(Y,M))P=P|1;else if(ue.greater(Y,I))P=P|2;else{P=3;break;}if(P===3)break;}if(P!==3)continue;let T=Number.POSITIVE_INFINITY,B=Number.NEGATIVE_INFINITY;s/=2,s<=ue.eps&&(s=ue.eps),y-=s,v+=s,E.forEach((W,Y)=>{W>=y&&W<=v&&o(Y/(E.length-1));});let $=new q(new F(0,y),new F(1,y)),Z=new q(new F(0,v),new F(1,v));for(let W=0;W<E.length-1;W++){let Y=new F(W/(E.length-1),E[W]),U=Y.y<y?1:Y.y>v?2:3;for(let D=0;D<E.length;D++){let k=new F(D/(E.length-1),E[D]),ie=k.y<y?1:k.y>v?2:3;U!==ie&&(U===1?ie===2?(a(new q(Y,k),$),a(new q(Y,k),Z)):a(new q(Y,k),$):U===2?ie===1?(a(new q(Y,k),$),a(new q(Y,k),Z)):a(new q(Y,k),Z):ie===1?a(new q(Y,k),$):a(new q(Y,k),Z));}}T!==0&&(u=u.clip(T)[1]),B!==1&&(u=u.clip((B-T)/(1-T))[0]);let H=u.bbox();if(ue.eq(H.minX,H.maxX)&&ue.eq(H.minY,H.maxY)){P=0;for(let W of u.controls){let Y=(W.x-d.x)*C+(W.y-d.y)*L;if(ue.less(Y,M))P=P|1;else if(ue.greater(Y,I))P=P|2;else{P=3;break;}if(P===3)break;}if(P===3){let W=new F((H.minX+H.maxX)/2,(H.minY+H.maxY)/2);l.getPercent(W)&&(Ke[i++]=W.x,Ke[i++]=W.y);}continue;}if(B-T>.8){let[W,Y]=u.clip(.5);t.push([W,l]),t.push([Y,l]);}else t.push([u,l]);}for(let o=0;o<i;o++)V[o]=Ke[o];return{cnt:i};}var RD=class{constructor(r=ue.eps){this.eps=r;}eq(r,e){return Math.abs(r-e)<=this.eps;}setEps(r){this.eps=r;}},zl=new RD();function gy(r,e){if(r.bbox().extendOfSize(ue.eps).isSeparated(e.bbox()))return 0;let t=[[r,e]],n=(e.controls.length-1)*16,i=0;for(;t.length!==0;){if(i>n){let o=function(){for(let u=0;u<i;u+=2)for(let c=u+2;c<i;c+=2)if(!(zl.eq(Ke[u],Ke[c])&&zl.eq(Ke[u+1],Ke[c+1]))){l(Ke[c],Ke[c+1],a);break;}function l(u,c,h){let d=!1;for(let f=0;f<h.length;f+=2)if(zl.eq(u,h[f])&&zl.eq(c,h[f+1])){d=!0;break;}d||h.push(u,c);}},a=[Ke[0],Ke[1]];if(o(),a.length>=100&&(zl.setEps(.001),a=[Ke[0],Ke[1]],o(),a.length>=100))throw new Error("clearSamePoint()");i=a.length,a.forEach((l,u)=>Ke[u]=l);}let s=t.pop();if(s[0]instanceof ee){let o=function(Z){L=Math.min(L,Z),S=Math.max(S,Z);},a=function(Z,H){let W=hi(Z,H);if(W===0)throw new Error("cnt === 0");for(let Y=0;Y<W;Y+=2)o(V[Y]);},[l,u]=s,c=u.controls;if(c.length===2){let Z=xm(l,new q(c[0],c[1]));for(let H=0;H<Z;H++)Ke[i++]=V[H];continue;}let h=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,f,p,m,g,b;if(Math.abs(l.sweepAngle)>359){let Z=l.rx;f=l.center.add1(Z,0),p=l.center.add1(-Z,0),h=-Z,d=Z,m=0,g=1,b=-l.center.y;}else{f=l.start(),p=l.end(),m=p.y-f.y,g=f.x-p.x,b=-m*f.x-g*f.y;let Z=Math.sqrt(1/(m**2+g**2));m*=Z,g*=Z,b*=Z;let H=m*l.center.x+g*l.center.y+b;l.isCCW?(d=l.rx+H,h=0):(h=H-l.rx,d=0);}let y=c.map(Z=>m*Z.x+g*Z.y+b),v=0;for(let Z of y){if(ue.less(Z,h))v=v|1;else if(ue.greater(Z,d))v=v|2;else{v=3;break;}if(v===3)break;}if(v!==3)continue;let E=0,P=0,M=p.x-f.x,I=p.y-f.y,C=Math.sqrt(1/(M**2+I**2));if(M*=C,I*=C,Math.abs(l.sweepAngle)<=180)E=0,P=(p.x-f.x)*M+(p.y-f.y)*I;else throw new Error("not support");v=0;for(let Z of c){let H=(Z.x-f.x)*M+(Z.y-f.y)*I;if(ue.less(H,E))v=v|1;else if(ue.greater(H,P))v=v|2;else{v=3;break;}if(v===3)break;}if(v!==3)continue;let L=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY;h-=ue.eps,d+=ue.eps,y.forEach((Z,H)=>{Z>=h&&Z<=d&&o(H/(y.length-1));});let T=new q(new F(0,h),new F(1,h)),B=new q(new F(0,d),new F(1,d));for(let Z=0;Z<y.length-1;Z++){let H=new F(Z/(y.length-1),y[Z]),W=H.y<h?1:H.y>d?2:3;for(let Y=0;Y<y.length;Y++){let U=new F(Y/(y.length-1),y[Y]),D=U.y<h?1:U.y>d?2:3;W!==D&&(W===1?D===2?(a(new q(H,U),T),a(new q(H,U),B)):a(new q(H,U),T):W===2?D===1?(a(new q(H,U),T),a(new q(H,U),B)):a(new q(H,U),B):D===1?a(new q(H,U),T):a(new q(H,U),B));}}L!==0&&(u=u.clip(L)[1]),S!==1&&(u=u.clip((S-L)/(1-L))[0]);let $=u.bbox();if(ue.eq($.minX,$.maxX)&&ue.eq($.minY,$.maxY)){v=0;for(let Z of u.controls){let H=(Z.x-f.x)*M+(Z.y-f.y)*I;if(ue.less(H,E))v=v|1;else if(ue.greater(H,P))v=v|2;else{v=3;break;}if(v===3)break;}v===3&&(Ke[i++]=($.minX+$.maxX)/2,Ke[i++]=($.minY+$.maxY)/2);continue;}S-L>.8?u.clip(.5).forEach(Z=>t.push([Z,l])):t.push([u,l]);}else{let[o,a]=s;t.push([ee.build3(a.center,a.startAngle,a.sweepAngle/2,a.rx,a.ry),o]),t.push([ee.build3(a.center,a.startAngle+a.sweepAngle/2,a.sweepAngle/2,a.rx,a.ry),o]);}}for(let s=0;s<i;s++)V[s]=Ke[s];return i;}var ND=class{static getSweep(r){if(r.length>2){let e=0,t=r.length;for(let s=0;s<t-1;s++){let o=r[s],a=r[s+1];e+=(a.x+o.x)*(a.y-o.y);}let n=r[0],i=r[t-1];return e+=(n.x+i.x)*(n.y-i.y),e>0;}else throw new Error("Unable to determine the direction of rotation!");}static isClose(r){return!!(r.primitives.length>0&&r.primitives[0].start().equals1(r.primitives[r.primitives.length-1].end()));}};function LD(r){let e=r.primitives,t=e[0],n=t instanceof ee?t.sweepAngle%360:null;if(e.length===1&&t instanceof ee&&(ue.eq(n,0)||ue.eq(Math.abs(n),360)))return!!t.isCCW;let i=new Array();return r.points(.1,s=>{i.push(s);}),ND.getSweep(i);}var OD=class{static zoomCorner(r,e){let t=new Array(),n=new Array(),i=new Array();return this.getPanPrimitive(r,t,i,e),this.rearrange(t,i),this.processStart(t,i),this.getResult(t,i,n,e),n.length>0?Me.build2(n):null;}static zoomPolygon(r,e){let t=new Array(),n=new Array(),i=new Array();return LD(r)&&(r=r.reverse().asClose()),this.getPanPrimitive(r,t,i,e),this.rearrange(t,i),this.processStart(t,i),this.getResult(t,i,n,e),n.length>0?Me.build2(n):null;}static zoomLines(r,e){return this.zoomPolygon(Me.build2(r.primitives.concat(r.reverse().primitives)),e/2);}static getPanPrimitive(r,e,t,n){let i=r.primitives;for(let s of i){let o=this.panDistance(s,n);o!==void 0&&(e.push(o),t.push(s));}}static rearrange(r,e){let t=r.length,n=0;for(let o=0;o<t;o++){let a=e[o],l=r[o],u=o==t-1?r[0]:r[o+1];if(!(l instanceof ee&&u instanceof ee)&&!this.isCW(l.end(),u.start(),a.end())){if(dn(l,u)!=0){n=o==t-1?0:o+1;break;}}else{n=o;break;}}let i=this.start4Index(e,n),s=this.start4Index(r,n);e.length=0,r.length=0,i.forEach(o=>{e.push(o);}),s.forEach(o=>{r.push(o);});}static processStart(r,e){let t=r.length;if(t>2){let n=r[t-1],i=r[0],s=e[t-1];if(!(n instanceof ee&&i instanceof ee)&&!this.isCW(n.end(),i.start(),s.end())){let o=dn(n,i);for(let a=0;a<o;a+=2){let l=new F(V[a],V[a+1]);r[t-1]=this.generatePrimitive(n,n.start(),l),r[0]=this.generatePrimitive(i,l,i.end());}}}}static getResult(r,e,t,n){let i=r.length;for(let s=0;s<i;s++){let o=e[s],a=s===i-1?e[0]:e[s+1],l=s==i-1?0:s+1,u=l==i-1?e[0]:e[l+1],c=r[s],h=s==i-1?r[0]:r[s+1],d=l==i-1?r[0]:r[l+1];if(!(c instanceof ee&&h instanceof ee)&&!this.isCW(c.end(),h.start(),o.end())){let p=this.add(r,t,s,c,h,0);p=this.update(r,t,s,h,p);let m=this.generateArc(a,u,h,d,n);if(p=this.add(r,t,s,c,m,p),p=this.update(r,t,s,m,p),p>0)continue;}t.push(c);let f=this.generateArc(o,a,c,h,n);f!==void 0&&t.push(f);}}static generateArc(r,e,t,n,i){if(i>0){let s=r.end(),o=e.start(),a=t.end(),l=n.start();if(a.distance2(l)>1e-8)if(s.equals(o)){let u=a.angleD(s),c=l.angleD(s);return ee.build2(s,u,c,i,i,0);}else{let u=a.angleD(s),c=l.angleD(s),h=a.angleD(o),d=l.angleD(o),f=ee.build2(s,u,c,i,i,0),p=ee.build2(o,h,d,i,i,0);return f.pointOn(f.endAngle()).equals1(l)?f:p.pointOn(p.endAngle()).equals1(l)?p:f;}}}static updateNews(r,e,t,n){let i=r.length,s=e==i-1?0:e+1;r[s]=this.generatePrimitive(t,n,t.end());}static add(r,e,t,n,i,s){if(s>0)return s;if(n!=null&&i!=null){let o=dn(n,i);for(let a=0;a<o;a+=2){let l=new F(V[a],V[a+1]);e.push(this.generatePrimitive(n,n.start(),l)),this.updateNews(r,t,i,l);break;}return o;}else return 0;}static update(r,e,t,n,i){if(i>0)return i;let s=e.length;if(s>0&&n!=null){let o=e[s-1],a=dn(o,n);for(let l=0;l<a;l+=2){let u=new F(V[l],V[l+1]);e[s-1]=this.generatePrimitive(o,o.start(),u),this.updateNews(r,t,n,u);}return a;}else return 0;}static generatePrimitive(r,e,t){if(r instanceof q)return new q(e,t);if(r instanceof ee){let n=r,i=e.angleD(n.center),s=t.angleD(n.center);return ee.build2(n.center,i,s,n.rx,n.ry,n.sweep());}else throw new Error("not supported operation");}static start4Index(r,e){let t=r.length,n=new Array();for(let i=e;i<t;i++)n.push(r[i]);for(let i=0;i<e;i++)n.push(r[i]);return n;}static isCW(r,e,t){let n=new q(t,r),i=new q(t,e),s=n.end().x-n.start().x,o=n.end().y-n.start().y,a=i.end().x-i.start().x,l=i.end().y-i.start().y;return!(s*l-o*a>0);}static panDistance(r,e){if(r instanceof q){if(r.isPoint())return;{let t=r.panDistance(e);return t.length()>1e-5?t:void 0;}}else if(r instanceof ee){let t=r;if(t.sweepAngle>0){if(t.rx-e<=0||t.ry-e<=0)return;}else if(t.sweepAngle<0&&(t.rx+e<=0||t.ry+e<=0))return;return t=t.panDistance(e),t.start().distance1(t.end())>1e-5||ue.eq(Math.abs(t.sweepAngle),360)?t:void 0;}else throw new Error("not supported operation");}},De=.001,Er=De**2;function Fe(r,e){return r.distance2(e)<Er;}function Gi(r,e){return Math.abs(r-e)<=1e-4;}function Tae(r,e){return Math.abs(r-e)<=De;}function Rae(r,e){return Math.abs(r-e)<=Er;}function Nae(r,e){return r-e<-De;}function Lae(r,e){return r-e>De;}function fi(r,e=Xe.toRadians(r.startAngle)){return r.isCCW?e+=eh:e-=eh,new F(Math.cos(e),Math.sin(e));}function rh(r,e=0){let t=r.controls;if(e===0){let n=t[0],i=t.slice(1).find(s=>!(s.x===n.x&&s.y===n.y));if(!i)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return i.sub(n);}else if(e===1){let n=t[t.length-1],i=t.slice(0,-1).reverse().find(s=>!(s.x===n.x&&s.y===n.y));if(!i)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return n.sub(i);}if(t.length===3){let[n,i,s]=t;return i.sub(n).mul(2*(1-e)).add(s.sub(i).mul(2*e)).normalize();}else{let[n,i,s,o]=t;return i.sub(n).mul(3*(1-e)**2).add(s.sub(i).mul(6*(1-e)*e)).add(o.sub(s).mul(3*e**2)).normalize();}}function bs(r,e,t){let n=r.slice(1).findIndex(s=>!(s.x===e.x&&s.y===e.y)),i=r[n+1];if(t&&(t.getPercent(i,De)!==null||new q(t.start(),t.end()).distance(i)<=De)&&(i=r[n+2]),!i)throw Error("getSecondPoint(controls: readonly Vector2[])");return i;}function ot(r,e){if(r instanceof q)return r.end().sub(r.start()).normalize();if(r instanceof ee)return(e?fi(r,e.angle(r.center)):fi(r)).normalize();if(r instanceof Ce){if(r.controls.length===2){let[t,n]=r.controls;if(Fe(t,n))throw Error("equalsPP(p0, p1)");return n.sub(t).normalize();}else return(e?rh(r,r.getPercent(e,De)):rh(r)).normalize();}else throw new Error("not support");}function kD(r,e,t){let n=[],i=e**2-4*r*t;if(i>=0){let s=-e/(2*r),o=Math.sqrt(i)/(2*r),a=s+o;if(n.push(a),i>0){let l=s-o;n.push(l);}}return n;}function UD(r,e,t,n,i=0,s=1){let o=[],a=r*Math.pow(i,3)+e*Math.pow(i,2)+t*i+n,l=r*Math.pow(s,3)+e*Math.pow(s,2)+t*s+n,u,c;if(a*l<0){for(;Math.abs(i-s)>De;)if(u=(i+s)/2,c=r*Math.pow(u,3)+e*Math.pow(u,2)+t*u+n,Math.abs(c)<De){o.push(u);break;}else a*c<0?s=u:l*c<0&&(i=u);}else a*l===0&&(a===0&&o.push(i),l===0&&o.push(s));return o;}function Oae(r){let e=r.controls;if(e.length!==3)throw Error("bezier.controls !== 3");let[t,n,i]=e;return{a:t.sub(n.mul(2)).add(i),b:n.sub(t)};}function kae(r){let e=r.controls;if(e.length!==4)throw Error("beizer.controls.length !== 4");let[t,n,i,s]=e;return{a:s.sub(t).add(n.sub(i).mul(3)),b:t.sub(n.mul(2)).add(i).mul(2),c:n.sub(t)};}function bm(r){return ue.greater(r,0)&&ue.less(r,1);}function nh(r,e,t,n){let i=r[n]-2*e[n]+t[n],s=e[n]-r[n];if(i===0)return[];let o=-s/i,a=[];return bm(o)&&a.push(o),a;}function ih(r,e,t,n,i){let s,o,a=-r[i]+3*e[i]-3*t[i]+n[i],l=2*(r[i]-2*e[i]+t[i]),u=e[i]-r[i],c=l**2-4*a*u;if(ue.lesseq(c,0))s=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;else{let d=Math.sqrt(c);s=(-l-d)/(2*a),o=(-l+d)/(2*a);let f=a*2;if(ue.lesseq(s,1)&&ue.greatereq(s,0)){let p=Number.NEGATIVE_INFINITY;for(;ue.neq(s,p);){p=s;let m=f*s+l;s=-(a*s**2+l*s+u-m*s)/m;}}if(ue.lesseq(o,1)&&ue.greatereq(o,0)){let p=Number.NEGATIVE_INFINITY;for(;ue.neq(o,p);){p=o;let m=f*o+l;o=-(a*o**2+l*o+u-m*o)/m;}}}let h=[];return bm(o)&&h.push(o),bm(s)&&h.push(s),h;}function DD(r,e){if(r.controls.length===2){let[a,l]=r.controls;Fe(a,l)||e.push(new q(a,l));return;}let t,n;if(r.controls.length===3){let[a,l,u]=r.controls;t=nh(a,l,u,"x"),n=nh(a,l,u,"y");}else{let[a,l,u,c]=r.controls;t=ih(a,l,u,c,"x"),n=ih(a,l,u,c,"y");}t.sort((a,l)=>l-a),n.sort((a,l)=>l-a);let i=t.pop()||1,s=n.pop()||1,o=0;for(;i!==1||s!==1;)if(ue.eq(i,s))i=t.pop()||1,s=n.pop()||1;else if(i<s){let[a,l]=r.clip((i-o)/(1-o));o=i,e.push(a),r=l,i=t.pop()||1;}else{let[a,l]=r.clip((s-o)/(1-o));o=s,e.push(a),r=l,s=n.pop()||1;}e.push(r);}var GD=1e-5,FD=1,Ce=class Lr extends Ul{constructor(e){if(super(),this._startToEndL=null,e.length<2)throw new Error("Bezier needs at least 2 endpoints");this.controls=e.slice();}get startToEndL(){return this._startToEndL===null&&(this._startToEndL=new q(this.start(),this.end())),this._startToEndL;}build1(e){let t=[];return ra(e,(n,i)=>(t.push(i),!0)),new Lr(t);}start(){return this.controls[0];}end(){return this.controls[this.controls.length-1];}static pointOn(e,t){if(t.length<1)throw new Error("bezier must have at least 1 point");if(t.length===1)return t[0];{let n=new Array(t.length-1);for(let i=1;i<t.length;i++){let s=t[i-1],o=t[i],a=(o.x-s.x)*e,l=(o.y-s.y)*e;n[i-1]=s.add1(a,l);}return Lr.pointOn(e,n);}}clip1(e,t,n,i){if(n.push(t[0]),i.push(t[t.length-1]),t.length<2)throw new Error("bezier clip must have at least 2 point");if(t.length===2){let s=t[0],o=t[1],a=(o.x-s.x)*e,l=(o.y-s.y)*e,u=s.add1(a,l);n.push(u),i.push(u);}else{let s=new Array(t.length-1);for(let o=1;o<t.length;o++){let a=t[o-1],l=t[o],u=(l.x-a.x)*e,c=(l.y-a.y)*e;s[o-1]=a.add1(u,c);}this.clip1(e,s,n,i);}}clip(e){let t=[],n=[];return this.clip1(e,this.controls,t,n),[new Lr(t),new Lr(n.reverse())];}greater(e,t,n){return e-t>n;}less(e,t,n){return e-t<-n;}eq(e,t,n){return Math.abs(e-t)<=n;}eqPP(e,t,n){return!e||!t?!1:this.eq(e.x,t.x,n)&&this.eq(e.y,t.y,n);}isInRange(e,t=ue.eps){let n=this.controls.map(s=>s.y-e.y),i=0;for(let s of n){if(this.less(s,0,t))i=i|1;else if(this.greater(s,0,t))i=i|2;else{i=3;break;}if(i===3)break;}if(i!==3)return!1;i=0;for(let s of this.controls){let o=s.x-e.x;if(this.less(o,0,t))i=i|1;else if(this.greater(o,0,t))i=i|2;else{i=3;break;}if(i===3)break;}return i===3;}getPercent(e,t=ue.eps){if(!this.isInRange(e,t))return null;let n=Number.POSITIVE_INFINITY,i=[[this,0,1]];for(;i.length!==0;){let s=function(g){c=Math.min(c,g),h=Math.max(h,g);},o=function(g,b){let y=hi(g,b);if(y===0)throw new Error("cnt === 0");for(let v=0;v<y;v+=2)s(V[v]);},[a,l,u]=i.pop();if(this.eqPP(a.start(),e,t))return l;if(this.eqPP(a.end(),e,t))return u;let c=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,d=a.controls.map(g=>g.y-e.y);n=d.reduce((g,b)=>{let y=Math.abs(b);return y<g?y:g;},n),n/=2,n<=t&&(n=t),d.forEach((g,b)=>{this.eq(g,0,t)&&s(b/(d.length-1));});let f=new q(new F(0,-n),new F(1,-n)),p=new q(new F(0,n),new F(1,n));for(let g=0;g<d.length-1;g++){let b=new F(g/(d.length-1),d[g]),y=this.less(b.y,0,t)?1:this.greater(b.y,0,t)?2:3;for(let v=0;v<d.length;v++){let E=new F(v/(d.length-1),d[v]),P=this.less(E.y,0,t)?1:this.greater(E.y,0,t)?2:3;y!==P&&(y===1?P===2?(o(new q(b,E),f),o(new q(b,E),p)):o(new q(b,E),f):y===2?P===1?(o(new q(b,E),f),o(new q(b,E),p)):o(new q(b,E),p):P===1?o(new q(b,E),f):o(new q(b,E),p));}}if(!isFinite(c)){if(Math.max(...d.map(g=>Math.abs(g)))<t*4)return(l+u)/2;continue;}if(c!==0&&(a=a.clip(c)[1],l=(u-l)*c+l),h!==1){let g=(h-c)/(1-c);a=a.clip(g)[0],u=(u-l)*g+l;}if(!a.isInRange(e,t))continue;let m=a.controls.reduce((g,b)=>g.ext2(b),new ke()).build1();if(this.eq(m.minX,m.maxX,t)&&this.eq(m.minY,m.maxY,t))return(l+u)/2;if(h-c>.8){let[g,b]=a.clip(.5);g.isInRange(e,t)?(i.push([g,l,(l+u)/2]),b.isInRange(e,t)&&i.push([b,(l+u)/2,u])):i.push([b,(l+u)/2,u]);}else i.push([a,l,u]);}return null;}toBezier(){return this;}toString(){return"Bezier ["+this.controls.join(" ")+"]";}bbox(){return this._bbox||(this._bbox=new ke().ext3(this.points(.1)).build1()),this._bbox;}bboxWithControls(){return this._bbox_controls||(this._bbox_controls=new ke().ext3(this.controls).build()),this._bbox_controls;}multiply3(e){let t=new Array(this.controls.length);for(let n=0;n<this.controls.length;n++){let i=this.controls[n];t[n]=i.multiply3(e);}return new Lr(t);}stroke(e,t,n){let i=OD.zoomLines(Me.build4(this.points(FD)),e);return n===0?i:i.reverse();}points(e){let t=[];return this.getBezierPoints(e,n=>t.push(n)),t;}getBezierPoints(e,t){if(this.controls.length===2){t(this.start()),t(this.end());return;}let n=[this];for(t(this.start());n.length!==0;){let s=n.pop(),o=new q(s.start(),s.end());if(i(s.controls,o)<=e)t(s.end());else{let[a,l]=s.clip(.5);n.push(l,a);}}function i(s,o){let a=o.start(),l=o.end();a.equals1(l)&&(l=a.add1(1,0));let u=l.y-a.y,c=a.x-l.x,h=-u*a.x-c*a.y,d=Math.sqrt(1/(u**2+c**2));u*=d,c*=d,h*=d;let f=s.map(p=>Math.abs(u*p.x+c*p.y+h));return Math.max(...f);}}getBezierPoints3(e,t){if(this.controls.length===2){t(this.start()),t(this.end());return;}let n=e*e,i=this.controls[0],s=.5;for(;s>GD&&!(i.distance2(Lr.pointOn(s,this.controls))<=n);s*=.5);let o=Math.ceil(1/s);s=1/o,t(i);let a=0;for(let l=1;l<o;l++)a+=s,t(Lr.pointOn(a,this.controls));t(this.end());}getPointsBySlope(e){if(this.controls.length===4)return this.getPointsBySlope4(e);throw new Error("Currently, only 4 control points are supported!");}getPointsBySlope4(e){let[t,n,i,s]=this.controls,o=-3*t.x+9*n.x-9*i.x+3*s.x,a=6*t.x-12*n.x+6*i.x,l=-3*t.x+3*n.x,u=[];if(Number.isFinite(e)){let c=-3*t.y+9*n.y-9*i.y+3*s.y,h=6*t.y-12*n.y+6*i.y,d=-3*t.y+3*n.y,f=c-o*e,p=h-a*e,m=d-l*e,g=-p/(2*f),b=Math.sqrt(p**2-4*f*m)/(2*f),y=g+b;y>=0&&y<=1&&u.push(Lr.pointOn(y,this.controls));let v=g-b;v>=0&&v<=1&&u.push(Lr.pointOn(v,this.controls));}else{let c=-a/(2*o),h=Math.sqrt(a**2-4*o*l)/(2*o),d=c+h;d>=0&&d<=1&&u.push(Lr.pointOn(d,this.controls));let f=c-h;f>=0&&f<=1&&u.push(Lr.pointOn(f,this.controls));}return u;}buildConverxHull(e=ue.eps){let t=[...this.controls],n=[],i=t[0],s=1;do{let o=t[s%t.length];this.eqPP(i,o,e)||n.push(new q(i,o)),i=o,s++;}while(i!==t[0]);if(n.length===0)throw Error("buildConverxHull(diff = DoubleKit.eps)");return Me.build7(n).asClose();}getExtremePoints(e){if(!e)return o(this.controls);let t=e.start(),n=e.end(),i=n.x-t.x,s=n.y-t.y;if(Math.abs(i)<=ue.eps||Math.abs(s)<=ue.eps)return o(this.controls);{let a=s/i;if(this.controls.length===3){t.equals1(n)&&(n=t.add1(1,0));let l=n.y-t.y,u=t.x-n.x,c=-l*t.x-u*t.y,h=Math.sqrt(1/(l**2+u**2));l*=h,u*=h,c*=h;let d=this.controls.map(m=>l*m.x+u*m.y+c),f=d[0]-2*d[1]+d[2],p=d[1]-d[0]-a/2;if(f!==0){let m=-p/f;if(ue.greater(m,0)&&ue.less(m,1))return[Lr.pointOn(m,this.controls)];}}else if(this.controls.length===4)return this.getPointsBySlope(a);}return[];function o(a){let l,u;if(a.length===3){let[f,p,m]=a;l=nh(f,p,m,"x"),u=nh(f,p,m,"y");}else if(a.length===4){let[f,p,m,g]=a;l=ih(f,p,m,g,"x"),u=ih(f,p,m,g,"y");}l.sort((f,p)=>p-f),u.sort((f,p)=>p-f);let c=l.pop()||1,h=u.pop()||1,d=[];for(;c!==1||h!==1;)ue.eq(c,h)?(c=l.pop()||1,h=u.pop()||1):c<h?(d.push(Lr.pointOn(c,a)),c=l.pop()||1):(d.push(Lr.pointOn(h,a)),h=u.pop()||1);return d;}}getToLineMaxDis(e){let t=this.getExtremePoints(e),n=e.distance2(this.start()),i=e.distance2(this.end()),s=Math.max(n,i);return t.forEach(a=>o(e.distance2(a))),s;function o(a){s=Math.max(s,a);}}getToLineMinAndMaxDis_Controls(e){let t=e.start(),n=e.end();e.start().equals1(e.end())&&(n=t.add1(1,0));let i=n.y-t.y,s=t.x-n.x,o=-i*t.x-s*t.y,a=Math.sqrt(1/(i**2+s**2));i*=a,s*=a,o*=a;let l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;return this.controls.forEach(c=>{let h=i*c.x+s*c.y+o;h<l&&(l=h),h>u&&(u=h);}),{minDis:l,maxDis:u};}getPercentInLine(e){let t=[],n=[],i=this.controls,s=e.start(),o=e.end(),a=o.y-s.y,l=s.x-o.x,u=-a*s.x-l*s.y,c=Math.sqrt(1/(a**2+l**2));if(a*=c,l*=c,u*=c,a**2+l**2<=0)return t;if(i.length===3){let[h,d,f]=i,p=a*(h.x-2*d.x+f.x)+l*(h.y-2*d.y+f.y),m=2*(a*(d.x-h.x)+l*(d.y-h.y)),g=a*h.x+l*h.y+u;n=kD(p,m,g);}else if(i.length===4){let[h,d,f,p]=i,m=p.sub(f.mul(3)).add(d.mul(3)).sub(h),g=h.sub(d.mul(2)).add(f).mul(3),b=d.sub(h).mul(3),y=h,v=a*m.x+l*m.y,E=a*g.x+l*g.y,P=a*b.x+l*b.y,M=a*y.x+l*y.y+u,I=Math.sqrt(1/(v**2+E**2));v*=I,E*=I,P*=I,M*=I,n=UD(v,E,P,M);}else throw Error("not support getBeizerPointInLine");return n.forEach(h=>{h>=0&&h<=1&&t.push(h);}),t;}reverse(){return new Lr(this.controls.slice().reverse());}},xy=(_class8=class Ql{constructor(){this.textCache=new Map(),this.numCache=new Array(20),this.boxCache=new Array(4),this.textOffsetCache=new Array(9),this.BuildLineCache=new Array(7),this.BuildTrackCache=new Array(7),this.BuildViaCache=new Array(11),this.BuildBoxCache=new Array(10),this.BuildArcCache=new Array(10),this.BuildArcTrackCache=new Array(10),this.BuildTextCache=new Array(7),this.BuildPadStyleCache=new Array(4),this.BuildPadCache=new Array(12),this.ARRAY1=new Array(1),this.ARRAY2=new Array(2),this.ARRAY3=new Array(3),this.ARRAY4=new Array(4),this.ARRAY5=new Array(5),this.ARRAY6=new Array(6),this.ARRAY7=new Array(7),this.ARRAY8=new Array(8),this.ARRAY9=new Array(9),this.ARRAY10=new Array(10),this.ARRAY11=new Array(11),this.ARRAY12=new Array(12),this.textOffsetCache[0]=F.ORIGIN,this.textOffsetCache[1]=new F(0,-.5),this.textOffsetCache[2]=new F(0,-1),this.textOffsetCache[3]=new F(-.5,0),this.textOffsetCache[4]=new F(-.5,-.5),this.textOffsetCache[5]=new F(-.5,-1),this.textOffsetCache[6]=new F(-1,0),this.textOffsetCache[7]=new F(-1,-.5),this.textOffsetCache[8]=new F(-1,-1);}static getCache(){return Ql.instance==null&&(Ql.instance=new Ql()),Ql.instance;}},_class8.instance=null,_class8),q=class xo extends Ul{constructor(e,t){super(),this._a=null,this._b=null,this._c=null,this.__bbox=null,this._hashed=null,this._direct=null,this._start=e,this._end=t;}get a(){return this._a===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._a;}get b(){return this._b===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._b;}get c(){return this._c===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._c;}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed;}get direct(){return this._direct==null&&(this._direct=this._end.sub(this._start).normalize()),this._direct;}cutLine(e){if(ue.eq(this.distance(e),0)){let t=new xo(this._start,e);return t._a=this._a,t._b=this._b,t._c=this._c,t;}return new xo(this._start,e);}get midPoint(){return this._start.add(this._end).mul(.5);}toBezier(){return new Ce([this._start,this._end]);}_hashCode(){let e=31,t=1;return t=e*t+this._start.hashCode(),t=e*t+this._end.hashCode(),t;}start(){return this._start;}end(){return this._end;}center(){let e=this.start(),t=this.end();return e.add(t).mul(.5);}panDistance(e){let t=this._end.x-this._start.x,n=this._end.y-this._start.y,i=this.length();t=t*e/i,n=-n*e/i;let s=new F(this._start.x+n,this._start.y+t),o=new F(this._end.x+n,this._end.y+t);return new xo(s,o);}isPoint(){return this._start.distance2(this._end)<=1e-8;}length(){return this._start.distance1(this._end);}toString(){return"Line [start="+this._start+", end="+this._end+"]";}bbox(){if(this.__bbox==null){let e=xy.getCache().boxCache;e[0]=Math.min(this._start.x,this._end.x),e[1]=Math.max(this._start.x,this._end.x),e[2]=Math.min(this._start.y,this._end.y),e[3]=Math.max(this._start.y,this._end.y),this.__bbox=new ye(e[0],e[1],e[2],e[3]);}return this.__bbox;}multiply3(e){return new xo(this._start.multiply3(e),this._end.multiply3(e));}hashCode(){return this.hashed;}equals(e){let t=e;return this.hashed===t.hashed&&this._start.equals(t._start)&&this._end.equals(t._end);}equals1(e){let t=e;return this.hashed===t.hashed&&this._start.equals1(t._start)&&this._end.equals1(t._end);}equals2(e){let t=[this.start(),this.end()],n=[e.start(),e.end()];return jn(t,n)||jn(t,n.reverse());}stroke(e,t,n){let i,s,o;this._end.x<this._start.x?(s=this._start.x-this._end.x,o=this._start.y-this._end.y,i=this._end):(s=this._end.x-this._start.x,o=this._end.y-this._start.y,i=this._start);let a=Math.sqrt(s*s+o*o),l=e/2,u,c,h;t===2?(c=-l,h=a+l):(c=0,h=a),t===0||t===2?n===0?u=Me.build5([c,-l,c,l,h,l,h,-l]):u=Me.build5([c,l,c,-l,h,-l,h,l]):n===0?u=Me.build2([ee.build3(new F(c,0),-90,-180,l,l),ee.build3(new F(h,0),90,-180,l,l)]):u=Me.build2([ee.build3(new F(c,0),90,180,l,l),ee.build3(new F(h,0),-90,180,l,l)]);let d=Math.atan2(o,s),f=ze.rotate(d).translate1(i);return u.asClose().multiply3(f);}points(e){return[this._start,this._end];}mirrorY(e){return new xo(this.start().mirrorY(e),this.end().mirrorY(e));}reverse(){return new xo(this._end,this._start);}inArea(e,t,n){let i=e.x,s=e.y,o=this._start,a=this._end,l=n==1,u=i-o.x,c=s-o.y,h=i-a.x,d=s-a.y,f=a.x-o.x,p=a.y-o.y,m=new F(-p,f).normalize(),g=f+m.x*t/2,b=p+m.y*t/2,y=g*g+b*b,v=u*u+c*c,E=h*h+d*d,P=Math.abs(u*p-c*f)/2,M=Math.sqrt(f*f+p*p)*t/4;if(P<=M&&v<=y&&E<=y){if(l)return!0;{let I=new F(i,s).sub(a).normalize(),C=new F(i,s).sub(o).normalize(),L=new F(m.x,m.y).cross(I),S=new F(m.x,m.y).cross(C);return L>=0&&S<=0;}}else if(l){let I=t/2;return v<=I*I?!0:E<=I*I;}else return!1;}isParallel(e,t=!1){let n=ue.eq(Math.abs(this.direct.cross(e.direct)),0),i=!t||ue.greatereq(this.direct.dot(e.direct),0);return n&&i;}distance2(e){return(this.a*e.x+this.b*e.y+this.c)**2/(this.a**2+this.b**2);}distance2ForPP(e){let{x:t,y:n}=e,{x:i,y:s}=this.start(),{x:o,y:a}=this.end();return((t-i)*(a-s)-(n-s)*(o-i))**2/((a-s)**2+(o-i)**2);}distance(e){return Math.abs(this.a*e.x+this.b*e.y+this.c)/Math.sqrt(this.a**2+this.b**2);}};function Uae(r,e=.05){if(r.length<3)return r.slice();let t=r[0],n=[t];for(let l=1;l<r.length;l++){let u=r[l];t.equals1(u)||n.push(u),t=u;}if(t!==n[n.length-1]&&(n.length!==1&&n.pop(),n.push(t)),e<0)return n;let i=n[1],s=i.sub(n[0]).normalize(),o=0,a=[n[0]];for(let l=2;l<n.length;l++){let u=n[l],c=u.sub(i).normalize();o+=Math.acos(Math.min(1,Math.max(-1,s.dot(c)))),o>e&&(a.push(i),o=0),i=u,s=c;}return a.push(i),a;}function qD(r,e=.05){if(r.length<3)return r.slice();let t=r.slice(0,1),n=(s,o,a)=>vD(s.x,s.y,o.x,o.y,a.x,a.y);for(;;){t=r.slice(0,1);for(let s=1;s<r.length-1;s+=2)n(r[s],r[s-1],r[s+1])>e&&t.push(r[s]),t.push(r[s+1]);if(t.at(-1).equals1(r.at(-1))||t.push(r.at(-1)),r.length==t.length)break;r=t;}let i=r[r.length-1];return t.push(i),t;}var zD=ZU(HU());function YD(r){if(r instanceof q)r=new q(r.end(),r.start());else if(r instanceof ee)r=r.exchangeSweep();else if(r instanceof Ce)r=new Ce(r.controls.slice().reverse());else throw new Error("bug");return r;}function XD(r){if(r.length>2){let e=r[0],t=new Array();t.push(e);for(let n=1,i=r.length;n<i;n++){let s=r[n],o=!1;if(n+1<i){let a=s.sub(e).normalize(),l=r[n+1].sub(e).normalize(),u=a.cross(l);Math.abs(u)<.01&&(o=!0);}o||(t.push(s),e=s);}return t;}else return r;}var VD=class{constructor(){this.fac=new ke(),this.length=0,this.box=null,this.pt=null,this.i=0;}calcBBox(r){for(this.fac.clear(),this.length=r.length,this.box=null,this.pt=null,this.i=0;this.i<this.length;this.i++)this.pt=r[this.i],this.box=this.pt.bbox(),this.fac.ext1(this.box);return this.fac.build1();}},WD=new VD(),Me=class Zt{constructor(e,t){this.__bbox=null,this.primitives=e,this.__bbox=t;}static calcBBox(e){return WD.calcBBox(e);}static build1(e){let t=[],n=null;return Vc(e,(i,s)=>{let o=s.start();return n!==null&&!o.equals(n)&&t.push(new q(n,o)),t.push(s),n=s.end(),!0;}),t.length===0&&n!=null&&t.push(new q(n,n)),new Zt(t);}static build2(e){return Zt.build1(Wc(e));}static build3(e){let t=[],n=null;return Vc(e,(i,s)=>(n!==null&&t.push(new q(n,s)),n=s,!0)),new Zt(t);}static build4(e){return this.build3(Wc(e));}static build5(e){let t=[];for(let n=0;n<e.length;n+=2)t.push(new F(e[n],e[n+1]));return this.build4(t);}static build6(e){return Zt.build4([e.LL(),e.LR(),e.UR(),e.UL(),e.LL()]);}static build7(e){return new Zt(e);}static build8(e){let t=new F(e[0],e[1]),n,i=[],s,o=(a,l)=>a.length==l&&a.every(u=>typeof u=="number");for(let a=2;a<e.length;)switch(typeof e[a]=="string"?s=e[a]:a-=1,s){case"ARC":{let l=e.slice(a+1,a+4);if(!o(l,3))throw new Error("invalid rawData");let u=l[0];n=new F(l[1],l[2]),i.push(ee.build5(t,n,u)),t=n,a+=4;break;}case"L":{let l=e.slice(a+1,a+3);if(!o(l,2))throw new Error("invalid rawData");n=new F(l[0],l[1]),i.push(new q(t,n)),t=n,a+=3;break;}case"C":{let l=e.slice(a+1,a+7);if(!o(l,7))throw new Error("invalid rawData");let u=new F(l[0],l[1]),c=new F(l[2],l[3]);n=new F(l[4],l[5]),i.push(new Ce([t,u,c,n])),t=n,a+=7;break;}default:throw new Error("invalid rawData");}return Zt.build2(i);}static buildBBox(e,t=0){return t===1?Zt.build5([e.minX,e.minY,e.maxX,e.minY,e.maxX,e.maxY,e.minX,e.maxY,e.minX,e.minY]):Zt.build5([e.minX,e.minY,e.minX,e.maxY,e.maxX,e.maxY,e.maxX,e.minY,e.minX,e.minY]);}static triangulate(e,t,n=1){if(e.length===1){let l=new Array();e[0].asClose().points2(n,d=>l.push(d));let u,c=l[0],h=[];for(let d=0;d<l.length-2;d+=2){let f=l[d+1],p=l[d+2],m=f.sub(c).normalize().cross(p.sub(c).normalize());if(ue.neq(m,0)){if(u===!0){if(m<0){h.length=0;break;}}else if(u===!1){if(m>0){h.length=0;break;}}else u=m>0;h.push(c),h.push(f),h.push(p);}l.push(c),c=p;}if(h.length!==0){for(let d=0;d<h.length;d+=3)t(h[d],h[d+1],h[d+2]);return;}}let i=[],s=[];e.forEach(l=>{i.length!==0&&s.push(i.length/2),l.asClose().points2(n,u=>i.push(u.x,u.y));});let o=zD.default(i,s),a=[];for(let l=1;l<i.length;l+=2)a.push(new F(i[l-1],i[l]));for(let l=0;l<o.length;l+=3)t(a[o[l]],a[o[l+1]],a[o[l+2]]);}lines(e,t){let n=new Array();this.points(e,s=>n.push(s));let i=n[0];for(let s=1;s<n.length;s++){let o=n[s];t(i),t(o),i=o;}}triangles(e,t){Zt.triangulate([this],(...n)=>{n.forEach(i=>t(i));},e);}mirror(){let e=[];return this.primitives.forEach(t=>{if(t instanceof q)t=new q(t.start().mirror(),t.end().mirror());else if(t instanceof ee)t=t.mirror();else if(t instanceof Ce){let n=t.controls.map(i=>i.mirror());t=new Ce(n);}else throw new Error("bug");e.push(t);}),new Zt(e,this.__bbox);}getPoints(e){let t=[];for(let n of this.primitives)for(let i of n.points(e))t.push(i);return t;}round(e=4){let t=this.primitives.slice();for(let n=0;n<t.length;n++){let i=t[n];if(i instanceof q){let s=i.start().round(e),o=i.end().round(e);t[n]=new q(s,o);}else if(i instanceof Ce){let s=i.controls.map(o=>o.round(e));t[n]=new Ce(s);}else if(i instanceof ee){let s=i.start().round(e),o=i.end().round(e),a=i.sweepAngle;t[n]=ee.build5(s,o,a);}}return new Zt(t,this.__bbox);}simplify(e=.05){let t=[],n=!1,i=[],s=this.closed();if(this.primitives.length<=1)return Zt.build2(this.primitives);let o=()=>{if(i.length>2){let l=qD(i,e);for(let u=1;u<l.length;u++)t.push(new q(l[u-1],l[u]));}else t.push(new q(i[0],i[1]));i.length=0,n=!1;};for(let l=0;l<this.primitives.length;l++){let u=this.primitives[l];u instanceof q?(n?i.push(u.end()):(i.length=0,i.push(u.start(),u.end()),n=!0),l===this.primitives.length-1&&o()):(n&&o(),t.push(u));}let a=new Zt(t,this.__bbox);return s&&!a.closed()&&(a=a.asClose()),a;}hasBackLine(){let{primitives:e}=this,t;for(let n=0;n<e.length;n++){let i=e[n];if(i instanceof q){if(i.end().equals1(i.start()))continue;if(t&&(i.end().equals1(t.start())||ED(i.end(),t.start(),t.end())))return!0;t=i;}else t=null;}return!1;}area(e){let t=null,n=null,i=0;return this.points(e,s=>{n?i+=(s.x+n.x)*(s.y-n.y):t=s,n=s;}),i+=(t.x+n.x)*(t.y-n.y),i/2;}closed(e){return this.primitives.length===0?!1:this.start().equals(this.end(),e);}asClose(){let e=this.primitives[0],t=this.primitives[this.primitives.length-1],n=e.start(),i=t.end();if(n.equals(i))return this;{let s=new Array();return wr.addAll(s,this.primitives),s.push(new q(i,n)),Zt.build2(s);}}closeEndpoint(){let e=this.primitives[0],t=this.primitives[this.primitives.length-1],n=e.start(),i=t.end();if(n.equals1(i))return this;{let s=new Array();return wr.addAll(s,this.primitives),s.push(new q(i,n)),new Zt(s);}}reverse(){let e=new Array(this.primitives.length);for(let t=0,n=this.primitives.length-1;n>=0;t++,n--){let i=this.primitives[n];if(i instanceof q)i=new q(i.end(),i.start());else if(i instanceof ee)i=i.exchangeSweep();else if(i instanceof Ce)i=new Ce(i.controls.slice().reverse());else throw new Error("bug");e[t]=i;}return new Zt(e,this.__bbox);}reverse1(){let e=new Array(this.primitives.length);for(let t=0,n=this.primitives.length-1;n>=0;t++,n--){let i=this.primitives[n];if(i instanceof q)i=new q(i.end(),i.start());else if(i instanceof ee)i=i.exchangeSweep1();else if(i instanceof Ce)i=new Ce(i.controls.slice().reverse());else throw new Error("bug");e[t]=i;}return new Zt(e,this.__bbox);}mirrorY(e){let t=[];return this.primitives.forEach(n=>{if(n instanceof q)n=n.mirrorY(e);else if(n instanceof ee)n=n.mirrorY(e);else if(n instanceof Ce){let i=n.controls.map(s=>s.mirrorY(e));n=new Ce(i);}else throw new Error("bug");t.push(n);}),new Zt(t,this.__bbox);}points(e,t){if(this.primitives.length!==0){for(let n=0;n<this.primitives.length-1;n++){let i=this.primitives[n].points(e);i.pop(),i.forEach(s=>t(s));}this.primitives[this.primitives.length-1].points(e).forEach(n=>t(n));}}points1(e,t){if(this.primitives.length===0)return;for(let i=0;i<this.primitives.length-1;i++){let s=this.primitives[i],o=s instanceof ee?s.points1(e):s.points(e);o.pop(),o.forEach(a=>t(a));}let n=this.primitives[this.primitives.length-1];(n instanceof ee?n.points1(e):n.points(e)).forEach(i=>t(i));}points2(e,t){if(this.primitives.length===0)return;for(let i=0;i<this.primitives.length-1;i++){let s=this.primitives[i],o=s instanceof ee?s.points2():s.points(e);o.pop(),o.forEach(a=>t(a));}let n=this.primitives[this.primitives.length-1];(n instanceof ee?n.points2():n.points(e)).forEach(i=>t(i));}multiply3(e){let t=new Array(this.primitives.length);for(let n=0;n<this.primitives.length;n++)t[n]=this.primitives[n].multiply3(e);return Zt.build7(t);}bbox(){return this.__bbox==null&&(this.__bbox=Zt.calcBBox(this.primitives)),this.__bbox;}start(){return this.primitives.length!==0?this.primitives[0].start():null;}end(){return this.primitives.length!==0?this.primitives[this.primitives.length-1].end():null;}isClose(e){if(this.primitives.length<=1&&!(this.primitives[0]instanceof ee))return!1;{let t=this.primitives[0],n=this.primitives[this.primitives.length-1];return t.start().equals(n.end(),e);}}isEqual(e){if(e instanceof Zt&&e.primitives.length==this.primitives.length){let t=e.primitives.length;for(let n=0;n<t;n++){let i=e.primitives[n],s=this.primitives[n];if(JSON.stringify(i)!=JSON.stringify(s))return!1;}return!0;}return!1;}equals(e){if(!e)return!1;let t=this.primitives,n=e.primitives;if(t.length!=n.length)return!1;if(e.isClose()){let i=0;for(;i<t.length;){let s=t.slice(i).concat(t.slice(0,i));if(jn(s,n)||jn(s.reverse(),n))return!0;i++;}return!1;}else return jn(this.primitives,e.primitives);}clone(){return Zt.build2(this.primitives);}putItem(e,t){if(!e)return!1;if(e instanceof Zt)return this.mergePolyline(e,t);let n=this.start();if(!n){this.primitives.push(e),this.__bbox=e.bbox();return;}let i=this.end();if(n.equals(i,t))return!1;let s=e.start(),o=e.end(),a=!1,l=!1;if(n.equals(s,t))a=!0,l=!1;else if(n.equals(o,t))a=!1,l=!1;else if(i.equals(s,t))a=!1,l=!0;else if(i.equals(o,t))a=!0,l=!0;else return!1;return l?this.primitives.push(a?e.reverse():e):this.primitives.unshift(a?e.reverse():e),this.__bbox=ye.extend2(this.__bbox,e.bbox()),!0;}mergePolyline(e,t,n=0){if(!e)return!1;let i=this.start();if(!i){this.primitives.push(...e.primitives),this.__bbox=e.bbox();return;}let s=this.end();if(i.equals(s,t))return!1;let o=e.start(),a=e.end(),l=!1,u=!1;if(i.equals(o,t))l=!0,u=!1;else if(i.equals(a,t))l=!1,u=!1;else if(s.equals(o,t))l=!1,u=!0;else if(s.equals(a,t))l=!0,u=!0;else return!1;let c=l?e.reverse():e;return u?this.primitives.push(...c.primitives):this.primitives.unshift(...c.primitives),this.__bbox=ye.extend2(this.__bbox,e.bbox()),!0;}deDuplicationPoint(e){let t=this.primitives[this.primitives.length-1].start(),n=this.primitives[this.primitives.length-1].end(),i=e.primitives[0].start(),s=e.primitives[0].end();if(this.primitives[this.primitives.length-1]instanceof q&&e.primitives[0]instanceof q&&py([t,n],[i,s])){this.primitives.pop(),e.primitives.shift();let o=[];o.push(new q(t,s)),this.primitives.push(...o);}}getWindingNum(e){let t=this.end(),n=0,{x:i,y:s}=e;for(let a of this.primitives){if(t.y>s?a.bbox().minY>s:a.bbox().maxY<=s){t=a.end();continue;}if(a instanceof ee&&(a.isCCW?Math.floor(a.startAngle/90)+1!==Math.ceil(a.endAngle()/90):Math.ceil(a.startAngle/90)-1!==Math.floor(a.endAngle()/90))){let l=a.startAngle,u=a.endAngle();if(a.sweepAngle>0){let c=90;for(;c<=u;)c>l&&(o(ee.build3(a.center,l,c-l,a.rx,a.ry)),l=c),c+=90;l<u&&o(ee.build3(a.center,l,u-l,a.rx,a.ry));}else{let c=270;for(;c>=u;)c<l&&(o(ee.build3(a.center,l,c-l,a.rx,a.ry)),l=c),c-=90;l>u&&o(ee.build3(a.center,l,u-l,a.rx,a.ry));}}else o(a);}return n;function o(a){let l=a.start(),u=a.end();if(t.y>s!=l.y>s&&(t.x>i?l.x>i?n+=l.y>t.y?1:-1:t.y>l.y?(t.x-i)*(l.y-s)-(t.y-s)*(l.x-i)<0&&n--:(t.x-i)*(l.y-s)-(t.y-s)*(l.x-i)>0&&n++:l.x>i&&(t.y>l.y?(t.x-i)*(l.y-s)-(t.y-s)*(l.x-i)<0&&n--:(t.x-i)*(l.y-s)-(t.y-s)*(l.x-i)>0&&n++)),l.y>s!=u.y>s){if(l.x>i){if(u.x>i)n+=u.y>l.y?1:-1;else if(a instanceof q)l.y>u.y?(l.x-i)*(u.y-s)-(l.y-s)*(u.x-i)<0&&n--:(l.x-i)*(u.y-s)-(l.y-s)*(u.x-i)>0&&n++;else if(a instanceof ee){let{center:c,isCCW:h,rx2:d}=a,f=(c.x-i)**2+(c.y-s)**2;l.y>u.y?(h?f>d:f<d)&&n--:(h?f<d:f>d)&&n++;}else if(a instanceof Ce){if(gm(a,s)===0)throw new Error("no inters");V[0]>i&&(n+=u.y>l.y?1:-1);}else throw new Error("not support!");}else if(u.x>i)if(a instanceof q)l.y>u.y?(l.x-i)*(u.y-s)-(l.y-s)*(u.x-i)<0&&n--:(l.x-i)*(u.y-s)-(l.y-s)*(u.x-i)>0&&n++;else if(a instanceof ee){let{center:c,isCCW:h,rx2:d}=a,f=(c.x-i)**2+(c.y-s)**2;l.y>u.y?(h?f>d:f<d)&&n--:(h?f<d:f>d)&&n++;}else if(a instanceof Ce){if(gm(a,s)===0)throw new Error("no inters");V[0]>i&&(n+=u.y>l.y?1:-1);}else throw new Error("not support!");}t=u;}}},sh=Math.PI*2,Dae=Math.PI,Gae=Math.PI/2,Fae=Math.sin(Math.PI/180),qae=.5,zae=6.75,$D=4,ee=class Tt extends Ul{constructor(e,t,n,i,s){super(),this._rx2=null,this._ry2=null,this._svgEnd=null,this._hashed=null,this.__bbox=null,this.rx=e,this.ry=t,this.center=n,this.startAngle=i,this.sweepAngle=s,this._start=F.ORIGIN,this._end=F.ORIGIN,this._start=this.pointOn(i),this._end=this.pointOn(i+s);}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed;}hashCode(){return this.hashed;}_hashCode(){let e=31,t=1;return t=e*t+new F(this.rx,this.rx).hashCode(),t=e*t+this.center.hashCode(),t=e*t+new F(this.startAngle,this.sweepAngle).hashCode(),t;}get rx2(){return this._rx2==null&&(this._rx2=this.rx*this.rx),this._rx2;}get ry2(){return this._ry2==null&&(this._ry2=this.ry*this.ry),this._ry2;}get svgEnd(){return this._svgEnd==null&&(this._svgEnd=this.getSvgEnd(this.startAngle,this.sweepAngle,this._start,this._end)),this._svgEnd;}getSvgEnd(e,t,n,i){let s=t>=0?-.01:.01,o=e+t;for(;(t>=0&&o>e||t<0&&o<e)&&n.distance2(i)<2e-4;)s*=2,o+=s,i=this.pointOn(o);return i;}static build1(e,t,n,i,s,o){st.positive(n),st.positive(i);let a=e.equals(t);if(a)return new Tt(n,i,e,0,s?360:0);{let l=e.x,u=-e.y,c=t.x,h=-t.y,d=o===0,f=(l-c)/2,p=(u-h)/2,m=Math.cos(0),g=Math.sin(0),b=m*f+g*p,y=-g*f+m*p;n=Math.abs(n),i=Math.abs(i);let v=n*n,E=i*i,P=b*b,M=y*y,I=s===d?-1:1,C=(v*E-v*M-E*P)/(v*M+E*P);C=C<0?0:C;let L=I*Math.sqrt(C),S=L*(n*y/i),T=L*-(i*b/n),B=(l+c)/2,$=(u+h)/2,Z=B+(m*S-g*T),H=$+(g*S+m*T),W=(b-S)/n,Y=(y-T)/i,U=(-b-S)/n,D=(-y-T)/i,k,ie;ie=Math.sqrt(W*W+Y*Y),k=W,I=Y<0?-1:1;let se=Xe.toDegrees(I*Math.acos(k/ie));ie=Math.sqrt((W*W+Y*Y)*(U*U+D*D)),k=W*U+Y*D,I=W*D-Y*U<0?-1:1;let oe=k/ie,le;oe<-1?le=Math.acos(-1):oe>1?le=Math.acos(1):le=Math.acos(oe);let Ee=Xe.toDegrees(I*le);!d&&Ee>0?Ee-=360:d&&Ee<0&&(Ee+=360),st.normal(se),st.normal(Ee);let be=f*f/v+p*p/E,xe=e.distance1(t)/2;n<xe&&i<xe&&(n*=Math.sqrt(be),i*=Math.sqrt(be));let Oe=a?0:Xe.regularD(-se),Re=a?s?360:0:-Ee;return new Tt(n,i,new F(Z,-H),Oe,Re);}}static build2(e,t,n,i,s,o){st.positive(i),st.positive(s),st.normal(t),st.normal(n);let a;return t===n?(t=Xe.regularD(t),n=Xe.regularD(n),a=0):(t=Xe.regularD(t),n=Xe.regularD(n),o===1?n<=t&&(n+=360):n>=t&&(t+=360),a=n-t),new Tt(i,s,e,Xe.regularD(t),a);}static build3(e,t,n,i,s){return st.positive(i),st.positive(s),st.normal(n),new Tt(i,s,e,Xe.regularD(t),n);}static build4(e,t,n,i,s,o){let a=e.angleD(n),l=t.angleD(n);return Tt.build2(n,a,l,i,s,o);}static build5(e,t,n){n=Xe.toRadians(n);let i=t.sub(e),s=new F(-i.y,i.x).normalize(),o=Math.abs(n)/2,a;if(o!=0)a=i.length()/2/Math.sin(o);else throw new Error("Can't represent circle!!!");let l=s.rotate(F.ORIGIN,o),u,c;n>0?(u=1,c=t.add(l.scale(a))):(u=0,c=e.sub(l.scale(a)));let h=Xe.toDegrees(e.angle(c)),d=Xe.toDegrees(t.angle(c));return Tt.build2(c,h,d,a,a,u);}static buildCircle(e,t,n=0){return Tt.build2(e,0,360,t,t,n);}start(){return this._start;}end(){return this._end;}isLarge(){return Math.abs(this.sweepAngle)>180;}sweep(){return this.sweepAngle>=0?1:0;}get isCCW(){return this.sweepAngle>=0;}endAngle(){return this.startAngle+this.sweepAngle;}pointOn(e){e=Xe.regularD(e);let t=this.rx,n=this.ry;if(e===0)return this.center.add1(t,0);if(e===90)return this.center.add1(0,n);if(e===180)return this.center.add1(-t,0);if(e===270)return this.center.add1(0,-n);{let i=this.rx2,s=this.ry2,o=Math.tan(Xe.toRadians(e)),a=o*o,l=Math.sqrt(i*s/(i+s/a)),u=Math.sqrt(i*s/(s+i*a));return e>90&&e<270&&(u=-u),e>180&&e<360&&(l=-l),isNaN(u)&&(u=0),isNaN(l)&&(l=0),this.center.add1(u,l);}}exchangeSweep(){return Tt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,this.rx,this.ry);}exchangeSweepAndStart(){return Tt.build1(this.end(),this.start(),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1);}exchangeSweep1(){return Tt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle+.01,this.rx,this.ry);}mirrorY(e){let t=this.start(),n=this.end();return t.equals(n)?Tt.build3(this.center.mirrorY(),0,360,this.rx,this.ry):Tt.build1(t.mirrorY(e),n.mirrorY(e),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1);}mirror(e=F.ORIGIN){let t=this.start(),n=this.end();return t.equals(n)?Tt.build3(this.center.mirror(e),0,360,this.rx,this.ry):Tt.build1(t.mirror(e),n.mirror(e),this.rx,this.ry,this.isLarge(),this.sweep());}sectorArea(){return Math.abs(this.sweepAngle)/360*Math.PI*this.rx*this.ry;}area(){let e=$i.area(this.center,this._start,this.pointOn(this.endAngle()));return this.sectorArea()-e;}multiply3(e){let t;e.isMirrored()?t=-this.sweepAngle:t=this.sweepAngle;let n;return e.equals(ze.ROT_90)?n=Xe.regularD(this.startAngle+90):e.equals(ze.ROT_N90)?n=Xe.regularD(this.startAngle-90):n=Xe.transformD(this.startAngle,e),Tt.build3(this.center.multiply3(e),n,t,e.iScale*this.rx,e.iScale*this.ry);}toBezier(){if(Math.abs(this.sweepAngle)>90)throw new Error("not support!");let e=this.start(),t=this.end(),n=Xe.toRadians(this.sweepAngle)/2,i=4/3*(1-Math.cos(n))/Math.sin(n)*this.rx;return new Ce([e,e.add(new F(i,0).multiply3(ze.rotateD(this.startAngle+90))),t.add(new F(i,0).multiply3(ze.rotateD(this.endAngle()-90))),t]);}toBezier2(){let e=[];n(this,90);let t=[];return e.forEach(i=>t.push(i.toBezier())),t;function n(i,s){if(Math.abs(i.sweepAngle)>s){let o=i.sweepAngle/2;n(Tt.build3(i.center,i.startAngle,o,i.rx,i.ry),s),n(Tt.build3(i.center,i.startAngle+o,o,i.rx,i.ry),s);}else e.push(i);}}buildBBox(){let e=xy.getCache().boxCache,t=this.startAngle+this.sweepAngle;if(e[0]=Math.min(this._start.x,this._end.x),e[1]=Math.max(this._start.x,this._end.x),e[2]=Math.min(this._start.y,this._end.y),e[3]=Math.max(this._start.y,this._end.y),this.sweepAngle>0){let n=0;for(;n<t;){if(n>this.startAngle){let i=this.pointOn(n);e[0]=Math.min(e[0],i.x),e[1]=Math.max(e[1],i.x),e[2]=Math.min(e[2],i.y),e[3]=Math.max(e[3],i.y);}n+=90;}}else if(this.sweepAngle<0){let n=360;for(;n>t;){if(n<this.startAngle){let i=this.pointOn(n);e[0]=Math.min(e[0],i.x),e[1]=Math.max(e[1],i.x),e[2]=Math.min(e[2],i.y),e[3]=Math.max(e[3],i.y);}n-=90;}}return new ye(e[0],e[1],e[2],e[3]);}bbox(){return this.__bbox==null&&(this.__bbox=this.buildBBox()),this.__bbox;}length(){return Math.abs(this.rx*this.sweepAngle*Math.PI/180);}toString(){return ta.format("Arc [start=%s, end=%s, rx=%s, ry=%s, center=%s, startAngle=%s, sweepAngle=%s]",this._start,this._end,this.rx,this.ry,this.center,this.startAngle,this.sweepAngle);}stroke(e,t,n){let i=e/2,s=this.rx+i,o=this.ry+i,a=this.rx-i,l=this.ry-i,u=new ze();a<0&&(a=-a,u=u.multiply3(ze.MIRROR_Y)),l<0&&(l=-l,u=u.multiply3(ze.MIRROR_X)),a===0&&(a=.001),l===0&&(l=.001),u=u.setOrigin1(this.center);let c,h;switch(n===this.sweep()?(c=Tt.build3(this.center,this.startAngle,this.sweepAngle,s,o),h=Tt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,a,l)):(c=Tt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,s,o),h=Tt.build3(this.center,this.startAngle,this.sweepAngle,a,l)),h=h.multiply3(u),t){case 1:{let d=n===1?180:-180,f=n===this.sweep()?this.pointOn(this.endAngle()):this.pointOn(this.startAngle),p=n===this.sweep()?this.pointOn(this.startAngle):this.pointOn(this.endAngle()),m=c.pointOn(c.endAngle()).angleD(f),g=h.pointOn(h.endAngle()).angleD(p);return Me.build2([c,Tt.build3(f,m,d,i,i),h,Tt.build3(p,g,d,i,i)]);}default:return Me.build2([c,h]);}}points2(){let e=Math.ceil(Math.abs(this.sweepAngle)/$D),t=this.sweepAngle/e,n=[this._start];for(let i=1;i<e;i++)n.push(this.pointOn(this.startAngle+t*i));return n.push(this._end),n;}points1(e){let t=Math.max(this.rx,this.ry);if(t<=e)return[this.start(),this.svgEnd];let n=(t-e)/t,i=Math.ceil(Math.abs(this.sweepAngle/Xe.toDegrees(Math.acos(n))/2)),s=new Array(i+1),o=this.sweepAngle/i,a=this.startAngle;for(let l=0;l<=i;l++,a+=o)s[l]=this.pointOn(a);return s;}points(e){let t=Math.max(this.rx,this.ry);if(e=Math.abs(e),t<=e)return[this.start(),this.svgEnd];e=Math.max(e,t*1e-5),e=Math.min(e,t*(1-Math.SQRT1_2));let n=(t-e)/t,i=Math.ceil(Math.abs(this.sweepAngle/Xe.toDegrees(Math.acos(n))/2));i=Math.max(i,2);let s=new Array(i+1),o=this.sweepAngle/i,a=this.startAngle+o;s[0]=this.start();for(let l=1;l<i;l++,a+=o)s[l]=this.pointOn(a);return s[i]=this.end(),s;}panDistance(e){return this.sweepAngle>0?new Tt(this.rx-e,this.ry-e,this.center,this.startAngle,this.sweepAngle):new Tt(this.rx+e,this.ry+e,this.center,this.startAngle,this.sweepAngle);}panDistance1(e){if(this.sweepAngle>0){let t=this.rx-e;return t<0?(t=Math.abs(t),Tt.build3(this.center,this.startAngle-180,this.sweepAngle,t,t)):new Tt(t,t,this.center,this.startAngle,this.sweepAngle);}else{let t=this.rx+e;return t<0?(t=Math.abs(t),Tt.build3(this.center,this.startAngle-180,this.sweepAngle,t,t)):new Tt(t,t,this.center,this.startAngle,this.sweepAngle);}}get bulge(){let e=Math.abs(fo(this.sweepAngle,3))/180*Math.PI;return Math.tan(e/4);}get midPoint(){let e=Xe.toRadians(this.startAngle),t=Xe.toRadians(this.endAngle()),n=this.sweep(),i=this.center,s=this.rx;if(n==1){if(t>e){let o=(t-e)/2+e;return i.add(new F(Math.cos(o),Math.sin(o)).mul(s));}else{if(t==e)return i.add(new F(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(s));{let o=(t+sh-e)/2+e;return i.add(new F(Math.cos(o),Math.sin(o)).mul(s));}}}else if(t>e){let o=(e+sh-t)/2+t;return i.add(new F(Math.cos(o),Math.sin(o)).mul(s));}else{if(t==e)return i.add(new F(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(s));{let o=(e-t)/2+t;return i.add(new F(Math.cos(o),Math.sin(o)).mul(s));}}}get svgPathData(){return[{type:"M",values:[this._start.x,this._start.y]},{type:"A",values:[this.rx,this.ry,0,this.isLarge()?1:0,this.isCCW,this._end.x,this._end.y]}];}equals(e){let t=Xe.regularD(this.startAngle),n=Xe.regularD(this.sweepAngle),i=Xe.regularD(e.startAngle),s=Xe.regularD(e.sweepAngle);return jn([this.rx,this.ry,this.center,Math.abs(n)],[e.rx,e.ry,e.center,Math.abs(s)])&&(jn([n,t],[s,i])||jn([Xe.regularD(t+n)],[i]));}equals1(e){let t=Xe.regularD(this.startAngle),n=Xe.regularD(this.sweepAngle),i=Xe.regularD(e.startAngle),s=Xe.regularD(e.sweepAngle);return jn([this.rx,this.ry,this.center,Math.abs(n)],[e.rx,e.ry,e.center,Math.abs(s)])&&(jn([n,t],[s,i])||jn([Xe.regularD(t+n)],[i]));}inArea(e,t){let n=e.x,i=e.y,s=this.center,o=this.rx,a=Xe.toRadians(this.startAngle);this.sweep()==0&&(a=Xe.toRadians(this.endAngle()));let l=Xe.toRadians(this.endAngle());this.sweep()==0&&(l=Xe.toRadians(this.startAngle));let u=o-t/2,c=o+t/2;var h=n-s.x,d=i-s.y,f=Math.atan2(d,h);if(f<0&&(f+=sh),a<=l&&f>=a&&f<=l||a>l&&(f>=a&&f<=sh||f>=0&&f<=l)||a==l){var p=Math.sqrt(h*h+d*d);return p<=c&&p>=u;}else{var p=(c+u)/2,m=new F(s.x+Math.cos(a)*p,s.y+Math.sin(a)*p),g=new F(s.x+Math.cos(l)*p,s.y+Math.sin(l)*p),b=n-m.x,y=i-m.y,v=n-g.x,E=i-g.y;return b*b+y*y<=t*t/4?!0:v*v+E*E<=t*t/4;}}isCircle(){return(ue.eq(Math.abs(this.sweepAngle),360)||this._start.equals1(this._end))&&this.rx==this.ry;}reverse(){return Tt.build3(this.center,this.endAngle(),-this.sweepAngle,this.rx,this.ry);}getAngle(){let e=Math.PI*2;return this.sweep()==1?(this.endAngle()-this.startAngle+e)%e:(this.startAngle-this.endAngle()+e)%e;}isValid(){return this.rx>0&&this.ry>0;}},by=new ArrayBuffer(24),ym=new Float64Array(by),oa=new Int32Array(by),pe=(_class9=class jr{static normal(e,t,n){let i=t.sub(e),s=n.sub(t);return i.cross(s);}constructor(e,t,n){this.x=st.normal(e),this.y=st.normal(t),this.z=st.normal(n),ym[0]=e,ym[1]=t,ym[2]=n,this.hashed=oa[0]^oa[1]^oa[2]^oa[3]^oa[4]^oa[5];}isZeroVector(){return this.x===0&&this.y===0&&this.z===0;}hashCode(){return this.hashed;}equals(e){return e instanceof jr?e.x===this.x&&e.y===this.y&&e.z===this.z:!1;}cross(e){return new jr(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x);}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z;}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);}normalize(){var e=this.length();return new jr(this.x/e,this.y/e,this.z/e);}sub(e){return new jr(this.x-e.x,this.y-e.y,this.z-e.z);}add(e){return new jr(this.x+e.x,this.y+e.y,this.z+e.z);}scale(e){return new jr(this.x*e,this.y*e,this.z*e);}neg(){return new jr(-this.x,-this.y,-this.z);}multiply4(e){var t=this.x*e.data[0]+this.y*e.data[4]+this.z*e.data[8]+e.data[12],n=this.x*e.data[1]+this.y*e.data[5]+this.z*e.data[9]+e.data[13],i=this.x*e.data[2]+this.y*e.data[6]+this.z*e.data[10]+e.data[14],s=this.x*e.data[3]+this.y*e.data[7]+this.z*e.data[11]+e.data[15];return s!=0?new jr(t/s,n/s,i/s):new jr(t,n,i);}rotate(e,t){return this.multiply4(Je.rotateAxis(e,t));}toVector2(){return new F(this.x,this.y);}},_class9.ORIGIN=new _class9(0,0,0),_class9.X_UNIT_VECTOR=new _class9(1,0,0),_class9.Y_UNIT_VECTOR=new _class9(0,1,0),_class9.Z_UNIT_VECTOR=new _class9(0,0,1),_class9),kr=class{constructor(){this.clear();}clear(){this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.minZ=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.maxZ=Number.NEGATIVE_INFINITY;}ext1(r,e,t,n,i,s){if(r<=n&&e<=i&&t<=s)this.minX=Math.min(this.minX,r),this.minY=Math.min(this.minY,e),this.minZ=Math.min(this.minZ,t),this.maxX=Math.max(this.maxX,n),this.maxY=Math.max(this.maxY,i),this.maxZ=Math.max(this.maxZ,s);else throw new Error("min > max is not permitted");return this;}ext2(r,e,t){return this.minX=Math.min(this.minX,r),this.minY=Math.min(this.minY,e),this.minZ=Math.min(this.minZ,t),this.maxX=Math.max(this.maxX,r),this.maxY=Math.max(this.maxY,e),this.maxZ=Math.max(this.maxZ,t),this;}ext3(r){return this.ext2(r.x,r.y,r.z);}ext4(r){return this.ext1(r.minX,r.minY,r.minZ,r.maxX,r.maxY,r.maxZ);}ext5(r,e){return this.minX=Math.min(this.minX,r),this.minY=Math.min(this.minY,e),this.maxX=Math.max(this.maxX,r),this.maxY=Math.max(this.maxY,e),this;}ext6(r){return this.minZ=Math.min(this.minZ,r),this.maxZ=Math.max(this.maxZ,r),this;}ext7(r){return this.minX=Math.min(this.minX,r.minX),this.minY=Math.min(this.minY,r.minY),this.maxX=Math.max(this.maxX,r.maxX),this.maxY=Math.max(this.maxY,r.maxY),this;}isValid(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.minZ)&&isFinite(this.maxX)&&isFinite(this.maxY)&&isFinite(this.maxZ);}build(){return new gn(this.minX,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ);}},gn=class{constructor(r,e,t,n,i,s){if(r<=n&&e<=i&&t<=s)this.minX=st.normal(r),this.minY=st.normal(e),this.minZ=st.normal(t),this.maxX=st.normal(n),this.maxY=st.normal(i),this.maxZ=st.normal(s);else throw new Error("min > max is not permitted");}center(){return new pe((this.minX+this.maxX)/2,(this.minY+this.maxY)/2,(this.minZ+this.maxZ)/2);}transform(r){let e=new kr();for(let t of this.getVertexes())e.ext3(t.multiply4(r));return e.build();}isContains(r){return!(r.x<this.minX||r.y<this.minY||r.z<this.minZ||r.x>this.maxX||r.y>this.maxY||r.z>this.maxZ);}getVertexes(){return[new pe(this.minX,this.minY,this.minZ),new pe(this.minX,this.minY,this.maxZ),new pe(this.minX,this.maxY,this.minZ),new pe(this.minX,this.maxY,this.maxZ),new pe(this.maxX,this.minY,this.minZ),new pe(this.maxX,this.minY,this.maxZ),new pe(this.maxX,this.maxY,this.minZ),new pe(this.maxX,this.maxY,this.maxZ)];}toBBox2(){return new ye(this.minX,this.maxX,this.minY,this.maxY);}},ct=class ga{static build(e){return e instanceof Me?new ga([new Ht([e])]):e instanceof Ht?new ga([e]):e;}static buildByPolygon(e){return e?new ga([e]):new ga([]);}static buildByStroke(e,t,n=1,i){return this.buildByPolygon(Ht.buildByStroke(e,t,n,i));}static buildCircle(e,t){return this.buildByPolygon(Ht.buildCircle(e,t));}static buildRect(e){return this.buildByPolygon(Ht.buildRect(e));}static buildBBox(e){return this.buildByPolygon(Ht.buildBBox(e));}constructor(e){this.items=e.slice();}multiply3(e){return new ga(this.items.map(t=>t.multiply3(e)));}bbox(){return this._bbox||(this._bbox=this.items.reduce((e,t)=>e.ext1(t.bbox()),new ke()).build1()),this._bbox;}toPolylineGroups(){return this.items.map(e=>e.toPolylineGroup());}},nt=(_class10=class ar{static isHexFormate(e){return!e||typeof e!="string"?!1:/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e);}static of1(e){return this.of2(e>>16&255,e>>8&255,e&255);}static of2(e,t,n,i=255){return new ar(e/255,t/255,n/255,i/255);}static of3(e){e.startsWith("#")&&(e=e.substr(1));let t=e.length;if(t==3)return new ar(parseInt(e[0],16)/15,parseInt(e[1],16)/15,parseInt(e[2],16)/15);if(t==6)return new ar(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255);if(t==8)return new ar(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255,parseInt(e.substr(6,2),16)/255);throw new Error("invalid color string");}static of4(e){let t=parseInt(e.r*255+"").toString(16),n=parseInt(e.g*255+"").toString(16),i=parseInt(e.b*255+"").toString(16);return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),("#"+t+n+i).toUpperCase();}static of5(e,t){if(e.startsWith("#")&&(e=e.substr(1)),e.length==3)return new ar(parseInt(e[0],16)/15,parseInt(e[1],16)/15,parseInt(e[2],16)/15,t);if(e.length==6)return new ar(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255,t);throw new Error("invalid color string");}static of6(e,t){return new ar(e.r,e.g,e.b,t);}static of7(e){return e==null?null:ar.of3(e);}constructor(e,t,n,i=1){this.r=st.positiveOr0(e),this.g=st.positiveOr0(t),this.b=st.positiveOr0(n),this.alpha=i;}hashCode(){return this.r+this.g+this.b+this.alpha;}equals(e,t=!1){let n=this.r===e.r&&this.g===e.g&&this.b===e.b;return t?n:n&&this.alpha===e.alpha;}add(e,t,n,i){return new ar(Math.max(0,Math.min(1,this.r+e)),Math.max(0,Math.min(1,this.g+t)),Math.max(0,Math.min(1,this.b+n)),Math.max(0,Math.min(1,this.alpha+i)));}mul(e){return new ar(Math.max(0,Math.min(1,this.r*e)),Math.max(0,Math.min(1,this.g*e)),Math.max(0,Math.min(1,this.b*e)),this.alpha);}mul1(e){return new ar(Math.max(0,this.r*e),Math.max(0,this.g*e),Math.max(0,this.b*e),this.alpha);}getData(){return[this.r,this.g,this.b,this.alpha];}toString(){let e=(this.r*255).toString(16),t=(this.g*255).toString(16),n=(this.b*255).toString(16);return e.length<2&&(e="0"+e),t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),"#"+e.substr(0,2)+t.substr(0,2)+n.substr(0,2);}toString1(){let e=(this.r*255).toString(16),t=(this.g*255).toString(16),n=(this.b*255).toString(16),i=(this.alpha*255).toString(16);return e.length<2&&(e="0"+e),t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),"#"+e.substr(0,2)+t.substr(0,2)+n.substr(0,2)+i.substr(0,2);}toRGBA(){let e=this.r*255,t=this.g*255,n=this.b*255;return[e,t,n,this.alpha];}toRGBAString(){let e=this.r*255,t=this.g*255,n=this.b*255;return`rgba(${e},${t},${n},${this.alpha})`;}isWHITE(){return this.r===1&&this.g===1&&this.b===1&&this.alpha===1;}},_class10.WHITE=new _class10(1,1,1,1),_class10.BLACK=new _class10(0,0,0,1),_class10.RED=new _class10(1,0,0,1),_class10.GREEN=new _class10(0,1,0,1),_class10.BLUE=new _class10(0,0,1,1),_class10.Gray=_class10.of3("#9966ff"),_class10.Silver=_class10.of3("#D2D2D2"),_class10.Golden=_class10.of3("#DCAA14"),_class10.Pink=_class10.of3("#ffaec9"),_class10),jD=0,Yl=class Om{constructor(e,t){this.inters=[],this.shape=e,this.start=e.start(),this.end=e.end(),t&&(this.id=jD++);}reverse(){this.shape=this.shape.reverse();let e=this.start;this.start=this.end,this.end=e;}getCenterPoint(e=this.end){let{x:t,y:n}=this.start,{x:i,y:s}=e;if(this.shape instanceof ee){let o=this.shape.rx,a=new F((t+i)/2,(n+s)/2),l=this.shape.center,u;return a.x!==l.x||a.y!==l.y?(u=a.angle(l),Math.abs(this.shape.sweepAngle)>180&&(u+=u>=0?-180:180)):u=(this.shape.startAngle+this.shape.endAngle())/2,new F(l.x+Math.cos(u)*o,l.y+Math.sin(u)*o);}else{if(this.shape instanceof q)return new F((t+i)/2,(n+s)/2);if(this.shape instanceof Ce){let o=this.shape.getPercent(e,De);return Ce.pointOn(o/2,this.shape.controls);}else throw Error("not support");}}static finalAngle(e,t,n){let i=e.cross(t)>0,s=Math.acos(Math.min(1,Math.max(-1,e.dot(t)/t.length())));return(n?!i:i)&&(s=hm-s),s;}sortInters(){if(this.shape instanceof ee){let e=this.shape.center,t=this.shape.start().sub(e).normalize(),n=this.shape.isCCW;this.inters.sort((i,s)=>{let o=i.coord.sub(e),a=s.coord.sub(e);return Om.finalAngle(t,o,n)-Om.finalAngle(t,a,n)<=0?-1:1;});}else if(this.shape instanceof q){let e=this.start,t=this.end,n=new F(t.x+(e.x-t.x)*2,t.y+(e.y-t.y)*2);this.inters.sort((i,s)=>i.coord.distance2(n)-s.coord.distance2(n)<=0?-1:1);}else if(this.shape instanceof Ce){let e=this.shape;this.inters.sort((t,n)=>e.getPercent(t.coord,De)-e.getPercent(n.coord,De)<=0?-1:1);}else throw Error("not support the primitive type");this.inters.forEach((e,t)=>e.setIndex(t));}getStart(){return this.start;}getEnd(){return this.end;}getShape(){return this.shape;}connect(e){this.nextSide=e,e.prevSide=this;}static returnPolygonList(e){let t=[];return e.forEach(n=>{let i=[];n.forEach((s,o)=>{let a=[];s.forEach(l=>{a.push(l.shape);}),i.push(Me.build7(a));}),t.push(new Ht(i));}),t;}addInter(e){this.inters.push(e);}static returnPolygonGroup(e){let t=[];return e.forEach(n=>{let i=[];n.forEach((s,o)=>{let a=[];s.forEach(l=>{a.push(l.shape);}),i.push(Me.build7(a));}),t.push(new Ht(i));}),new ct(t);}static rebuild(e,t,n){if(e instanceof q||t.distance2(n)<1e-6)return new q(t,n);if(e instanceof ee)return ee.build2(e.center,t.angleD(e.center),n.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);if(e instanceof Ce){let i=e.getPercent(t,De),s=e.clip(i)[1];return s.clip(s.getPercent(n,De))[0];}else throw new Error("not supported operation");}static returnPolyline(e){return Me.build7(e.map(t=>t.shape));}bbox(){return this.shape.bbox();}},ZD=(r=>(r[r.END1=0]="END1",r[r.END2=1]="END2",r[r.END12=2]="END12",r[r.LEFT1=3]="LEFT1",r[r.LEFT2=4]="LEFT2",r))(ZD||{}),oh=new Map([[0,1],[1,0],[2,2],[3,4],[4,3]]);function aa(r,e){if(r instanceof ee&&e instanceof ee)return KD(r,e);if(r instanceof ee&&e instanceof q)return Ay(r,e);if(r instanceof q&&e instanceof ee)return Ey(r,e);if(r instanceof q&&e instanceof q)return mo(r,e);if(r instanceof Ce&&e instanceof q)return r.controls.length===2||qi(r)?mo(new q(r.start(),r.end()),e):ah(r,e);if(r instanceof q&&e instanceof Ce)return e.controls.length===2||qi(e)?mo(r,new q(e.start(),e.end())):HD(r,e);if(r instanceof ee&&e instanceof Ce)return e.controls.length===2||qi(e)?Ay(r,new q(e.start(),e.end())):wy(r,e);if(r instanceof Ce&&e instanceof ee)return r.controls.length===2||qi(r)?Ey(new q(r.start(),r.end()),e):oh.get(wy(e,r));if(r instanceof Ce&&e instanceof Ce)return vy(r,e);throw new Error("not support");}function la(r,e){return ot(r,e.start()).dot(ot(e,e.start()))<=0?!1:aa(r,e)<=2;}function wm(r,e){let t=e.getPercent(r.end(),De);if(t===null)return!1;if(t===0)return!0;let n=e.clip(t)[0],i=r.buildConverxHull(De),s=n.buildConverxHull(De),o=u(i),a=u(s);return l(o,a);function l(c,h){let d=c[0],f=h[0];if(!d||!f)throw Error("isAllOverlap(sides1: PackSide[], sides2: PackSide[])");let p=!0;do{let m=d.getShape(),g=f.getShape();if(m instanceof q&&g instanceof q){let b=p?mo(m,g):oh.get(mo(g,m));if(b===0)d=d.nextSide,p=!1;else if(b===1)f=f.nextSide,p=!0;else if(b===2)d=d.nextSide,f=f.nextSide,p=!0;else return!1;}else throw Error("not support");}while(d!==c[0].prevSide&&f!==h[0].prevSide);return!0;}function u(c){let h=c.primitives.map(f=>new Yl(f)),d=h[h.length-1];return h.forEach(f=>{d.connect(f),d=f;}),h;}}function Yae(r,e){let t=r.end().distance2(e.center);if(t>(e.rx+De)**2||t<(e.rx-De)**2||!(Fe(r.end(),e.end())||lh(e,r.end())))return!1;let n=JD(e.center,r);if(n<=(e.rx+De)**2&&n>=(e.rx-De)**2)return!0;}function yy(r,e){let t=r.end().distance2(e.center);if(t>(e.rx+De)**2||t<(e.rx-De)**2||!(Fe(r.end(),e.end())||lh(e,r.end())))return!1;if(r.center.equals1(e.center))return!0;let n=r.center.distance1(e.center),i=Math.abs(r.rx-e.rx);if(n>Math.min(r.rx,e.rx)){let s=r.center.angleD(e.center);return r.rx>e.rx?!(n+i>De&&di(r,s))&&!(n-i>De&&r.rx+e.rx-n>De&&di(r,s+180)):!(n-i>De&&di(r,s))&&!(r.rx+e.rx-n>De&&di(r,s+180));}else{if(n+i<=De)return!0;let s=r.rx>e.rx?r.center.angleD(e.center):e.center.angleD(r.center);return di(r,s)?!1:n-i<=De?!0:!di(r,s+180);}}function wy(r,e){let t=r.toBezier2(),n,i=0;for(let s=t.length;i<s;i++){let o=t[i];if(n=vy(o,e),n!==0)break;}return n===2&&i!==t.length-1?1:n;}function vy(r,e){if(r.controls.length===2||qi(r))return e.controls.length===2||qi(e)?mo(new q(r.start(),e.end()),new q(e.start(),e.end())):oh.get(ah(e,new q(e.start(),r.end())));if(e.controls.length===2||qi(e))return ah(vm(r,e.start()),new q(e.start(),e.end()));let t=vm(r,e.start());if(qi(t))return oh.get(ah(e,new q(e.start(),r.end())));let n=wm(t,e),i=wm(e,t);if(!n&&!i){let s=TD(t,e);if(s.havOverlap){let o=s.havOverlap!==2,a=s.havOverlap!==1;return Fi(r,e,o,a);}else{let o,a,l=s.cnt;for(let u=0;u<l;u+=2){let c=new F(V[u],V[u+1]),h=t.getPercent(c,De),d=e.getPercent(c,De);if(h===0||d===0)continue;let f=h===1?t:t.clip(h)[0],p=d===1?e:e.clip(d)[0];h===1&&(f=t),d===1&&(p=e),wm(f,p)&&(o=t.end(),a=e.end());break;}return(!o||!a)&&(o=bs(t.controls,t.controls[0],e),a=bs(e.controls,t.controls[0],t)),o.sub(t.controls[0]).cross(a.sub(t.controls[0]))>0?4:3;}}return Fi(r,e,n,i);}function ah(r,e){let t=vm(r,e.start());if(qi(t))return mo(new q(t.start(),t.end()),e);let n=_y(t,e),{isIn:i,bezierIsInLeft:s}=Py(e,t);if(!n&&!i){if(s!==void 0)return s?3:4;let o=null;for(let a=r.getPercent(e.start(),De)+.01;a<=1;){let l=Ce.pointOn(a,r.controls);if(ua(e,l)>Er){o=l;break;}a+=.01,a>1&&(a=1);}if(!o)throw Error("!end1 && !end2 not result");return e.direct.cross(o.sub(e.start()))<0?4:3;}return Fi(t,e,n,i);}function HD(r,e){let{isIn:t,bezierIsInLeft:n}=Py(r,e),i=_y(e,r);if(!t&&!i){if(n!==void 0)return n?4:3;let s=null;for(let o=.01;o<=1;){let a=Ce.pointOn(o,e.controls);if(ua(r,a)>Er){s=a;break;}o+=.01,o>1&&(o=1);}if(!s)throw Error("!end1 && !end2 not result");return r.direct.cross(s.sub(r.start()))<0?3:4;}return Fi(e,r,t,i);}function KD(r,e){let t=yy(Iy(r,e.start()),e),n=yy(e,r);if(!t&&!n){let i=fi(e);if(r.center.sub(e.start()).dot(e.center.sub(e.start()))>0){if(r.rx===e.rx)return r.isCCW?i.dot(r.center.sub(e.center))<0?3:4:i.dot(r.center.sub(e.center))>0?3:4;let s,o;return r.rx>e.rx?(s=r,o=e):(s=e,o=r),i.dot(o.center.sub(s.center))>0&&o.rx+o.center.distance1(s.center)-s.rx>De?r.isCCW?r.rx>e.rx?3:4:r.rx<e.rx?3:4:r.isCCW?r.rx<e.rx?3:4:r.rx>e.rx?3:4;}else return r.rx+e.rx-r.center.distance1(e.center)>De&&i.dot(r.center.sub(e.center))>0?e.isCCW?3:4:r.isCCW?3:4;}return Fi(r,e,t,n);}function Ey(r,e){let t=Di.foot(r,e.center),n=r.end().distance2(e.center),i=r.end().sub(r.start()),s=n<=(e.rx+De)**2&&n>=(e.rx-De)**2&&(i.dot(t.sub(e.start()))<=0||r.start().distance2(r.end())<=r.start().distance2(t)||t.distance2(e.center)>=(e.rx-De)**2)&&(Fe(r.end(),e.end())||lh(e,r.end())),o=Sy(e,r);if(!s&&!o){let a=r.distance2(e.center);return a<=Er?i.cross(fi(e))>0?4:3:r.distance2(e.start())>Er?r.direct.cross(e.start().sub(r.start()))*r.direct.cross(e.center.sub(r.start()))>0?i.cross(e.center.sub(r.start()))>0?4:3:i.cross(e.center.sub(r.start()))<0?4:3:i.dot(t.sub(e.start()))>0&&a<(e.rx-De)**2?i.cross(e.center.sub(r.start()))<0?4:3:i.cross(e.center.sub(r.start()))>0?4:3;}return Fi(e,r,s,o);}function di(r,e){return e=Xe.regularD(e),r.sweepAngle>0?(e<r.startAngle&&(e+=360),r.endAngle()>e):(e>r.startAngle&&(e-=360),r.endAngle()<e);}function lh(r,e){return Fe(r.end(),e)||Fe(r.start(),e)||di(r,e.angleD(r.center));}function Xae(r,e){let t=r.getPercent(e,De);return Fe(r.start(),e)||Fe(r.end(),e)||t!==0&&!t;}function Py(r,e){let t=r.panDistance(De),n=r.panDistance(-De),i=Cy(e,t),s=Cy(e,n);if(!i.length&&!s.length)return{isIn:e.getPercent(r.end(),De)!==null};let o=[...i,...s].sort((h,d)=>h.t-d.t),a=new q(n.start(),t.start()),l=[],u=a.distance(e.start());for(let h=0,d=o.length;h<d;h++){let f=o[h];if(l.push(f),a.distance(f.interP)-u>r.length()-u+De)break;if(l.length===2){let p=(l[1].t*10+l.shift().t*10)/20,m=Ce.pointOn(p,e.controls);if(r.distance2(m)>Er)return{isIn:!1,bezierIsInLeft:r.direct.cross(m.sub(r.start()))>0};}}let c=l.length?a.distance(l[0].interP)-u>=r.length()-u+De:!0;return{isIn:c,bezierIsInLeft:c?void 0:r.direct.cross(l[0].interP.sub(r.start()))>0};}function _y(r,e){if(ua(e,r.end())>Er||r.getToLineMaxDis(e)>Er)return!1;let t=QD(e,Er);return r.getToLineMaxDis(t)<=(e.length()+De)**2;}function Sy(r,e){let t=e.end().angleD(e.start()),n=ua(e,r.end());if(n>Er)return!1;if(di(r,t+90)){if(Di.foot(e,r.center).distance1(r.pointOn(t+90))>r.rx)return!1;n=Math.max(n,(r.rx-e.distance(r.center))**2);}if(di(r,t-90)){if(Di.foot(e,r.center).distance1(r.pointOn(t-90))>r.rx)return!1;n=Math.max(n,(r.rx-e.distance(r.center))**2);}return n<=Er&&(Fe(r.end(),e.end())||Em(e,r.end()));}var By=(De*2)**2;function Iy(r,e){if(Fe(r.end(),e))return ee.build3(r.center,r.endAngle(),0,r.rx,r.ry);if(r.start().distance2(e)<By)return r;let t=Xe.regularD(e.angleD(r.center));if(!di(r,t))throw new Error("!angleIsInArc(arc, angle)");return ee.build2(r.center,t,r.endAngle(),r.rx,r.ry,r.isCCW?1:0);}function vm(r,e){if(Fe(r.end(),e))return new Ce([e,e]);if(r.start().distance2(e)<By)return r;let t=r.getPercent(e,De);if(t===null)throw new Error("!cutBezier(bezier: Bezier, p: Vector2)");return r.clip(t)[1];}function Ay(r,e){let t=Sy(Iy(r,e.start()),e),n=e.end().distance2(r.center),i=Di.foot(e,r.center),s=e.end().sub(e.start()),o=n<=(r.rx+De)**2&&n>=(r.rx-De)**2&&(s.dot(i.sub(e.start()))<=0||e.start().distance2(e.end())<=e.start().distance2(i)||i.distance2(r.center)>=(r.rx-De)**2)&&(Fe(r.end(),e.end())||lh(r,e.end()));if(!t&&!o){let a=e.distance2(r.center);return a<=Er?s.cross(fi(r,e.start().angle(r.center)))>0?3:4:s.dot(i.sub(e.start()))>0&&a<(r.rx-De)**2?s.cross(r.center.sub(e.start()))>0?4:3:s.cross(r.center.sub(e.start()))<0?4:3;}return Fi(e,r,t,o);}function mo(r,e){if(Fe(r.end(),e.end()))return Fi(r,e,!0,!0);let t=ua(e,r.end())<=Er&&Em(e,r.end()),n=ua(r,e.end())<=Er&&Em(r,e.end());return!t&&!n?r.end().sub(r.start()).cross(e.end().sub(r.start()))>0?4:3:Fi(r,e,t,n);}function Em(r,e){return Di.foot(r,e).distance2(r.start())<r.end().distance2(r.start());}function Fi(r,e,t,n){if(t)return n&&Fe(r.end(),e.end())?2:0;if(n)return 1;throw new Error("!end1 && !end2");}function ua(r,e){return(r.a*e.x+r.b*e.y+r.c)**2/(r.a**2+r.b**2);}function QD(r,e){let t=r.panDistance(e),n=r.panDistance(-e);return new q(n.start(),t.start());}function Vae(r,e){let t=e.controls,n=1/0;for(let i=0;i<=1;i+=.01){let s=Ce.pointOn(i,t).distance1(r);s<n&&(n=s);}return n;}function JD(r,e){return 0;}function qi(r){let e=r.start(),t=r.end();e.equals1(t)&&(t=e.add1(1,0));let n=t.y-e.y,i=e.x-t.x,s=-n*e.x-i*e.y,o=Math.sqrt(1/(n**2+i**2));n*=o,i*=o,s*=o;let a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return r.controls.forEach(u=>{let c=n*u.x+i*u.y+s;c<a&&(a=c),c>l&&(l=c);}),ue.eq(a,l);}function Cy(r,e){let t=dn(r,e),n=[];for(let i=0;i<t;i+=2){let s=new F(V[i],V[i+1]),o=r.getPercent(s);o!==null&&n.push({interP:s,t:o});}return n;}function Jn(r,e=.01,t=270){let n=e**2,i=r.end(),s=[],o=[];r.primitives.forEach(b=>{let y=b.start(),v=b.end();if(p(i,y)||o.push(new q(i,y)),l(b)){o.push(null);return;}if(b instanceof q)o.push(b);else if(b instanceof ee&&b.rx===b.ry)m(b,o);else if(b instanceof Ce){let E=[];DD(b,E),E.forEach(P=>{let M=P.start(),I=P.end();p(M,I)||o.push(P);});}else throw new Error("not support!");i=v;});let a=o.length;o.forEach((b,y)=>{if(b)s.push(b);else{if(y===a-1){let E=s[0],P=s[s.length-1];if(E!==P&&ot(P,P.end()).dot(ot(E,E.start()))<0)if(p(P.end(),E.start())){if(!(E.start().x===P.end().x&&E.start().y===P.end().y)){if(P instanceof q){let M=new q(E.start(),P.end()),I=f(M),C=new q(I,E.start()),L=new q(P.start(),I);P.start().distance2(I)>Er&&(s[s.length-1]=L,s.push(C));}else if(E instanceof q){let M=new q(P.end(),E.start()),I=f(M),C=new q(P.end(),I),L=new q(I,E.end());I.distance2(E.end())>Er&&(s[0]=L,s.push(C));}else if(P instanceof Ce){let M=new q(E.start(),P.end()),I=f(M),C=new Ce([...P.controls.slice(0,-1),I]);l(C)||(s[s.length-1]=C,s.push(new q(I,E.start())));}else if(E instanceof Ce){let M=new q(P.end(),E.start()),I=f(M),C=new Ce([I,...E.controls.slice(1)]);l(C)||(s[0]=C,s.push(new q(P.end(),I)));}else if(P instanceof ee&&E instanceof ee)if(Math.abs(Math.abs(P.sweepAngle)-180)<Math.abs(Math.abs(E.sweepAngle)-180)){let M=new q(E.start(),P.end()),I=f(M),C=ee.build5(P.start(),I,P.sweepAngle);l(C)||(s[s.length-1]=C,s.push(new q(I,E.start())));}else{let M=new q(P.end(),E.start()),I=f(M),C=ee.build5(I,E.end(),E.sweepAngle);l(C)||(s[0]=C,s.push(new q(P.end(),I)));}}}else{let M=new q(P.end(),E.start());s.push(M);}return;}let v=o[(y+1)%a];if(v){let E,P=y,M=!1;for(;E=o[(--P+a)%a],E!==v;)if(E){M=!0;break;}if(M&&ot(E,E.end()).dot(ot(v,v.start()))<0)if(p(E.end(),v.start())){if(!(v.start().x===E.end().x&&v.start().y===E.end().y)){if(E instanceof q){let I=new q(v.start(),E.end()),C=f(I),L=new q(C,v.start()),S=new q(E.start(),C);l(S)||(o[(P+a)%a]=S,s[s.length-1]&&(s[s.length-1]=S),s.push(L));}else if(v instanceof q){let I=new q(E.end(),v.start()),C=f(I),L=new q(E.end(),C),S=new q(C,v.end());l(S)||(o[(y+1)%a]=S,s[0]===v&&(s[0]=S),s.push(L));}else if(E instanceof Ce){let I=new q(v.start(),E.end()),C=f(I),L=new Ce([...E.controls.slice(0,-1),C]);l(L)||(o[(P+a)%a]=L,s[s.length-1]&&(s[s.length-1]=L),s.push(new q(C,v.start())));}else if(v instanceof Ce){let I=new q(E.end(),v.start()),C=f(I),L=new Ce([C,...v.controls.slice(1)]);l(L)||(o[(y+1)%a]=L,s[0]===v&&(s[0]=L),s.push(new q(E.end(),C)));}else if(E instanceof ee&&v instanceof ee)if(Math.abs(Math.abs(E.sweepAngle)-180)<Math.abs(Math.abs(v.sweepAngle)-180)){let I=new q(v.start(),E.end()),C=f(I),L=ee.build5(E.start(),C,E.sweepAngle);l(L)||(o[(P+a)%a]=L,s[s.length-1]&&(s[s.length-1]=L),s.push(new q(C,v.start())));}else{let I=new q(E.end(),v.start()),C=f(I),L=ee.build5(C,v.end(),v.sweepAngle);l(L)||(o[(y+1)%a]=L,s[0]===v&&(s[0]=L),s.push(new q(E.end(),C)));}}}else{let I=new q(E.end(),v.start());s.push(I);}}}});function l(b){if(!b)return!0;let y=b.start(),v=b.end();if(p(y,v))if(b instanceof ee){if(!(b.rx>=e&&Math.abs(b.sweepAngle)>180))return!0;}else if(b instanceof Ce){if(!(b.controls.length!==2&&b.getToLineMaxDis(new q(b.start().add1(1,0),b.end()))>=e))return!0;}else return!0;return!1;}if(s.length===0)return null;p(i,s[0].start())||s.push(new q(i,s[0].start()));let u=s[s.length-1];if(s.length===1)return u instanceof ee?Me.build7([ee.build2(u.center,0,180,u.rx,u.ry,u.sweep()),ee.build2(u.center,180,360,u.rx,u.ry,u.sweep())]):u instanceof Ce?Me.build7(u.clip(.5)):null;let c=s.map(b=>new eG(b)),h=c[c.length-1];for(c.forEach(b=>{b.connect(h),h=b;});!h.isVisited;){let b=function(){h.next.connect(v),h=h.next,h.isConnected=!1,h.isVisited=!1;},y=function(){h.connect(v.prev),h.isConnected=!1;},v=h.prev;if(h===v)break;let E=h.pt,P=v.pt,M=P.end();if(!h.isConnected&&!M.equals(E.start())){let I=function(L){h.isConnected=!0,h.pt=E=L,h.next.isVisited=!1;},C=function(L){h.isConnected=!0,v.pt=L,v.isVisited=!1,h=v;};if(E instanceof q){if(p(M,E.end())){b();continue;}else I(new q(M,E.end()));}else if(P instanceof q){p(P.start(),E.start())?y():C(new q(P.start(),E.start()));continue;}else if(E instanceof Ce){if(p(M,E.end())&&!(E.controls.length!==2&&E.getToLineMaxDis(E.startToEndL)>=e)){b();continue;}else I(new Ce([M,...E.controls.slice(1)]));}else if(P instanceof Ce)p(P.start(),E.start())&&!(P.controls.length!==2&&P.getToLineMaxDis(P.startToEndL)>=e)?y():C(new Ce([...P.controls.slice(0,-1),E.start()]));else if(E instanceof ee&&P instanceof ee){if(Math.abs(Math.abs(E.sweepAngle)-180)<Math.abs(Math.abs(P.sweepAngle)-180)){let L=ee.build5(M,E.end(),E.sweepAngle);if(p(L.start(),L.end())&&!(L.rx>=e&&Math.abs(L.sweepAngle)>180)){b();continue;}else I(L);}else{let L=ee.build5(P.start(),E.start(),P.sweepAngle);p(L.start(),L.end())&&!(L.rx>=e&&Math.abs(L.sweepAngle)>180)?y():C(L);continue;}}else throw new Error("not support");}if(ot(E,E.start()).dot(ot(P,P.end()))<0){let I=function(){h.next===v?h=null:(h.next.connect(v.prev),h=h.next,h.isConnected=!1,h.isVisited=!1);},C=aa(P.reverse(),E);if(C===0){let L=My(E,P.start(),E.end());if(g(L)){if(I(),!h)break;}else y();continue;}else if(C===1){let L=My(P,P.start(),E.end());if(g(L)){if(I(),!h)break;}else b();continue;}else if(C===2){if(I(),!h)break;continue;}}h.isVisited=!0,h=h.next;}if(!h)return null;s.length=0;let d=h;for(s.push(h.pt),h=h.next;h!==d;)s.push(h.pt),h=h.next;if(s.length===1){let b=s[0];return b instanceof ee?(p(b.start(),b.end())?s[0]=ee.buildCircle(b.center,b.rx,b.sweep()):s.push(new q(b.end(),b.start())),Me.build7(s)):b instanceof Ce?(p(b.start(),b.end())||s.push(new q(b.end(),b.start())),Me.build7(s)):null;}if(r=Me.build7(s),Math.abs(r.area(.1))<n)return null;return r;function f(b){if(b.direct.x===0&&b.direct.y===0)throw Error("getEndOfExtendLine(line: Line, distance: number)");let y={x:b.direct.normalize().x*De,y:b.direct.normalize().y*De},v=b.end();return new F(v.x+y.x,v.y+y.y);}function p(b,y){return b.distance2(y)<n;}function m(b,y){if(Math.abs(b.sweepAngle)>t){let v=b.sweepAngle/2;m(ee.build3(b.center,b.startAngle,v,b.rx,b.ry),y),m(ee.build3(b.center,b.startAngle+v,v,b.rx,b.ry),y);}else y.push(b);}function g(b){return p(b.start(),b.end())&&!(b instanceof ee&&b.rx>=e&&Math.abs(b.sweepAngle)>180);}}function My(r,e,t){if(r instanceof q||e.distance2(t)<=Er)return new q(e,t);if(r instanceof ee){let n=r.center,i=r.startAngle,s=e.angleD(n),o=t.angleD(n);return r.isCCW?(s<i&&(s+=360),o<i&&(o+=360)):(s>i&&(s-=360),o>i&&(o-=360)),ee.build5(e,t,o-s);}else if(r instanceof Ce){let n=r.getPercent(e,De),i=r.getPercent(t,De);return r.clip(n)[1].clip((i-n)/(1-n))[0];}else throw new Error("not supported operation");}var eG=class{constructor(r){this.pt=r;}connect(r){this.prev=r,r.next=this;}};function Ty(r){let e=ca(),t=Jn(r);return Rr.preprocessPolyline+=zi(e),t;}var Rr={addDocShapes2RTree:0,getPour:0,prepare:0,getSinglePourLayerPolyline:0,combindOutlines:0,mergeSameNet:0,run:0,end:0,deSelfIntersection:0,changeDirect:0,extend:0,preprocessPolyline:0,runBoolean:0,IntersectionSeeker:0,BooleanTools:0,totalBool:0};function ca(){return{timeIndex:Object.assign({},Rr),start:performance.now()};}function Ry(r){return Object.values(r).reduce((e,t)=>e+t,0);}function zi(r){return performance.now()-r.start-(Ry(Rr)-Ry(r.timeIndex));}function tG(r){let e={};for(let t of Object.keys(Rr))e[t]=Rr[t]-r.timeIndex[t];return e;}var uh=new Error("list is empty"),ch=class{constructor(r,e){this.prev=null,this.next=null,this.parent=r,this.item=e;}insertAfter(r){r.next=this.next,this.next=r,r.prev=this,r.next!==null&&(r.next.prev=r);}insertBefore(r){r.prev=this.prev,this.prev=r,r.next=this,r.prev!==null&&(r.prev.next=r);}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev);}set(r){this.item=r;}},rG=class{constructor(r){this._next=r;}hasNext(){return this._next!==null;}next(){let r=this._next;if(r!==null)return this._next=r.next,r.item;throw new Error("iterator is null");}},nG=class{constructor(r){this._next=r;}hasNext(){return this._next!==null;}next(){let r=this._next;if(r!==null)return this._next=r.next,r;throw new Error("iterator is null");}},iG=class{constructor(){this.first=null,this.last=null,this.cnt=0;}add(r){return this.addLast(r);}push(r){return this.addLast(r);}pop(){return this.removeLast();}shift(){return this.removeFirst();}removeFirst(){let r=this.first;if(r===null)throw uh;return this.remove(r),r.item;}removeLast(){let r=this.last;if(r===null)throw uh;return this.remove(r),r.item;}addLast(r){if(this.first===null||this.last===null){let e=new ch(this,r);return this.first=e,this.last=e,this.cnt++,e;}else return this.insertAfter(this.last,r);}addFirst(r){if(this.first===null||this.last===null){let e=new ch(this,r);return this.first=e,this.last=e,this.cnt++,e;}else return this.insertBefore(this.first,r);}getFirst(){if(this.first===null)throw uh;return this.first.item;}getLast(){if(this.last===null)throw uh;return this.last.item;}insertAfter(r,e){let t=new ch(this,e);return r.insertAfter(t),r===this.last&&(this.last=t),this.cnt++,t;}insertBefore(r,e){let t=new ch(this,e);return r.insertBefore(t),r===this.first&&(this.first=t),this.cnt++,t;}remove(r){r.remove(),r===this.first&&(this.first=r.next),r===this.last&&(this.last=r.prev),this.cnt--;}size(){return this.cnt;}clear(){this.first=null,this.last=null,this.cnt=0;}iterator(){return new rG(this.first);}listIterator(){return new nG(this.first);}toArray(){let r=new Array(),e=this.first;for(;e!=null;)r.push(e.item),e=e.next;return r;}};function Pm(r,e){sG(r.iterator(),e);}function sG(r,e){let t=0;for(;r.hasNext();){let n=r.next();e(t++,n);}}var oG=class{constructor(r){this.lst=r;}iterator(){return new Ny(this.lst);}},Ny=class{constructor(r){this.idx=-1,this.lst=r;}hasNext(){return this.idx<this.lst.length-1;}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug");}};function Wae(r){return new oG(r);}function $ae(r){return new Ny(r);}var hh=new Error("list is empty"),fh=class{constructor(r,e){this.prev=null,this.next=null,this.parent=r,this.item=e;}insertAfter(r){r.next=this.next,this.next=r,r.prev=this,r.next!==null&&(r.next.prev=r);}insertBefore(r){r.prev=this.prev,this.prev=r,r.next=this,r.prev!==null&&(r.prev.next=r);}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev);}set(r){this.item=r;}},aG=class{constructor(r){this._next=r;}hasNext(){return this._next!==null;}next(){let r=this._next;if(r!==null)return this._next=r.next,r.item;throw new Error("iterator is null");}},lG=class{constructor(r){this._next=r;}hasNext(){return this._next!==null;}next(){let r=this._next;if(r!==null)return this._next=r.next,r;throw new Error("iterator is null");}},go=class{constructor(){this.first=null,this.last=null,this.cnt=0;}add(r){return this.addLast(r);}push(r){return this.addLast(r);}pop(){return this.removeLast();}shift(){return this.removeFirst();}removeFirst(){let r=this.first;if(r===null)throw hh;return this.remove(r),r.item;}removeLast(){let r=this.last;if(r===null)throw hh;return this.remove(r),r.item;}addLast(r){return this.first===null||this.last===null?(this.first=new fh(this,r),this.last=this.first,this.cnt=1,this.first):this.insertAfter(this.last,r);}addFirst(r){if(this.first===null||this.last===null){let e=new fh(this,r);return this.first=e,this.last=e,this.cnt++,e;}else return this.insertBefore(this.first,r);}getFirst(){if(this.first===null)throw hh;return this.first.item;}getLast(){if(this.last===null)throw hh;return this.last.item;}insertAfter(r,e){let t=new fh(this,e);return r.insertAfter(t),r===this.last&&(this.last=t),this.cnt++,t;}insertBefore(r,e){let t=new fh(this,e);return r.insertBefore(t),r===this.first&&(this.first=t),this.cnt++,t;}remove(r){r.remove(),r===this.first&&(this.first=r.next),r===this.last&&(this.last=r.prev),this.cnt--;}size(){return this.cnt;}clear(){this.first=null,this.last=null,this.cnt=0;}iterator(){return new aG(this.first);}listIterator(){return new lG(this.first);}toArray(){let r=new Array(this.cnt),e=this.first,t=0;for(;e!=null;)r[t]=e.item,e=e.next,t++;return r;}};function _m(r){throw new Error("");}var dh=class{constructor(r,e){this.node1=null,this.node2=null,this.key=r,this.value=e;}},uG=class{constructor(r){this.itors=r;}hasNext(){return this.itors.hasNext();}next(){return this.itors.next().key;}},cG=class{constructor(r){this.itors=r;}hasNext(){return this.itors.hasNext();}next(){return this.itors.next().value;}},ph=class{constructor(){this.innerList=new go(),this.innerMap={};}replace(r,e){r.node1!==null&&(r.node1.set(e),e.node1=r.node1),r.node2!==null&&(r.node2.set(e),e.node2=r.node2);}clear(){this.innerList.clear();for(let r in this.innerMap)delete this.innerMap[r];}put(r,e){let t=r.hashCode(),n=new dh(r,e),i=this.innerMap[t];if(i===void 0)return n.node1=this.innerList.add(n),this.innerMap[t]=n,null;if(i instanceof dh){if(i.key.equals(r))return this.innerMap[t]=n,this.replace(i,n),i.value;{n.node1=this.innerList.add(n);let s=new go();return i.node2=s.add(i),n.node2=s.add(n),this.innerMap[t]=s,null;}}if(i instanceof go){let s=null;return Pm(i,(o,a)=>a.key.equals(r)?(this.replace(a,n),s=a.value,!1):!0),s===null?(n.node1=this.innerList.add(n),n.node2=i.push(n),null):s;}return _m(i);}get(r){let e=r.hashCode(),t=this.innerMap[e];if(t===void 0)return null;if(t instanceof dh)return t.key.equals(r)?t.value:null;if(t instanceof go){let n=null;return Pm(t,(i,s)=>s.key.equals(r)?(n=s.value,!1):!0),n;}return _m(t);}containsKey(r){return this.get(r)!==null;}delete(r){r.node1!==null&&r.node1.parent.remove(r.node1),r.node2===null?delete this.innerMap[r.key.hashCode()]:r.node2.parent.remove(r.node2);}remove(r){let e=r.hashCode(),t=this.innerMap[e];if(t===void 0)return null;if(t instanceof dh)return t.key.equals(r)?(this.delete(t),t.value):null;if(t instanceof go){let n=null;return Pm(t,(i,s)=>s.key.equals(r)?(n=s.value,this.delete(s),!1):!0),n;}return _m(t);}computeIfAbsent(r,e){let t=this.get(r);if(t===null){let n=e(r);return this.put(r,n),n;}else return t;}size(){return this.innerList.size();}isEmpty(){return this.innerList.size()===0;}keys(){return new uG(this.innerList.iterator());}values(){return new cG(this.innerList.iterator());}entries(){return this.innerList.iterator();}},hG=class{constructor(){this.points=[],this.lines=[],this.arcs=[],this.beziers=[],this.listText=[],this.fonts=[];}addPt(r,e=!0){if(r instanceof q)this.lines.push(r);else if(r instanceof ee)this.arcs.push(r);else if(r instanceof Ce)this.beziers.push(r);else throw new Error("not support");e&&this.points.push(r.start());}addPoint(r){this.points.push(r);}addText(r,e,t=1,n=.1,i=!0){this.listText.push({pos:r,str:e,size:t,width:n}),i&&this.points.push(r);}addPly(r,e=!0){r.primitives.forEach(t=>this.addPt(t,e));}build(){let r=[],e=[],t=[],n=[],i=[],s=[];return this.points.forEach(o=>r.push(o.x,o.y)),this.lines.forEach(o=>e.push(o.start().x,o.start().y,o.end().x,o.end().y)),this.arcs.forEach(o=>t.push(o.center.x,o.center.y,o.rx,Xe.toRadians(o.startAngle),Xe.toRadians(o.endAngle()),o.sweep())),this.beziers.forEach(o=>{o.controls.forEach(a=>{n.push(a.x,a.y);}),n.push("end");}),this.listText.forEach(o=>i.push(o.pos.x,o.pos.y,o.str,o.width,o.size)),this.fonts.forEach(o=>s.push(o)),{points:r,lines:e,arcs:t,texts:i,beziers:n,fonts:s};}},ha=class{constructor(r){this.map=new ph(),this.bus=r;}initColor(r){return this.map.computeIfAbsent(r,()=>new hG());}draw(){let r={},e=this.map.entries();for(;e.hasNext();){let t=e.next();r[t.key.toString()]=t.value.build();}this.bus.publish("/debug/draw",r);}clear(){this.map.clear();}},Sm=class km{constructor(e,t,n,i,s){this.inters=[],this.allInterIsInvalid=!0,this.isVisit=!1,this.sides=e,this.isGroup1=n,this.isOutside=i,this.polyline=t,s&&(this.polygon=s),e.forEach(o=>o.outline=this);}static build(e,t,n,i,s){let o=e.primitives.map(l=>new Yl(l,i)),a=o[o.length-1];return o.forEach(l=>{a.connect(l),a=l;}),s?new km(o,e,t,n,s):new km(o,e,t,n);}get hasInter(){return!!this.interOutlines;}isAllInterIsInvalid(){return this.allInterIsInvalid;}setAllInterIsInvalidToFalse(){this.allInterIsInvalid=!1;}resetVisited(){this.isVisit=!1;}intersect(e,t){if(!(e.interOutlines&&e.interOutlines===this.interOutlines))if(e.interOutlines){if(this.interOutlines){let n,i;this.interOutlines.length>e.interOutlines.length?(n=this.interOutlines,i=e.interOutlines):(n=e.interOutlines,i=this.interOutlines),i.forEach(s=>{n.push(s),s.interOutlines=n;}),t.delete(i);}else e.interOutlines.push(this),this.interOutlines=e.interOutlines;}else this.interOutlines?(this.interOutlines.push(e),e.interOutlines=this.interOutlines):(e.interOutlines=this.interOutlines=[this,e],t.add(this.interOutlines));}isContain(e){if(!this.polyline.bbox().extendOfSize(De).isContainsBBox(e.polyline.bbox()))return!1;let t=e.polyline.primitives[0].start();if(e.hasInter&&e.isAllInterIsInvalid()){let n=e.inters[0];n.getBindedInter().side.outline!==this?t=n.side.getCenterPoint():t=n.side.getCenterPoint(n.coord);}return!!this.polyline.getWindingNum(t);}isInternally(e){return!!this.polyline.getWindingNum(e);}isEqual(e){return this.polyline===e.polyline;}bbox(){return this.polyline.bbox();}reverse(){this.sides.reverse();let e=this.sides[this.sides.length-1];this.sides.forEach(t=>{t.reverse(),e.connect(t),e=t;});}returnPolyline(){let e=this.sides.map(n=>n.getShape()),t=this.polyline.primitives;if(this.sides.length===t.length){let n=new Set(t);if(!e.some(i=>!n.has(i)))return this.polyline;}return Me.build7(e);}};function fG(r,e){let t=r.bbox(),n=e.bbox(),i=(t.minY+t.maxY)/2,s=(n.minY+n.maxY)/2;return i-s;}function dG(r,e){let t=r.bbox(),n=e.bbox(),i=(t.minX+t.maxX)/2,s=(n.minX+n.maxX)/2;return i-s;}var fa=class{constructor(r){if(this.__bbox=null,typeof r<"u"){if(r instanceof Array){this.__items=[];for(let e of r)this.add(e);}else this.__items=r,this.__bbox=r.bbox();}else this.__items=[];}add(r){if(this.__items instanceof Array)this.__items.push(r),this.__bbox=ye.extend2(this.__bbox,r.bbox());else throw new Error("can't insert multiple item into leaf node");}items(){return this.__items;}bbox(){if(this.__bbox!==null)return this.__bbox;throw new Error("bug");}},mh=class{constructor(r){this.changed=!1,this.root=new fa(),this.capacity=r,this.capacity2=r*r,this.itemList=[];}size(){return this.itemList.length;}items(){return this.flushWhenNeed(),this.itemList;}add(r){this.itemList.push(r),this.changed=!0;}remove(r){wr.remove(this.itemList,r),this.changed=!0;}clear(){this.changed=!1,this.root=new fa(),this.itemList.length=0;}flushWhenNeed(){if(this.changed){let r=new Array();for(let e of this.itemList)r.push(new fa(e));for(;;){let e=this.organize(r);if(e.length>1)r=e;else break;}this.root=new fa(r),this.changed=!1;}}organize(r){Ui(r,dG,0,r.length);let e=r.length,t=[];for(let n=0;n<e;)if(n+this.capacity2<=e){let i=n+this.capacity2;Ui(r,fG,n,i);for(let s=n;s<i;s+=this.capacity){let o=new fa(r.slice(s,s+this.capacity));t.push(o);}n=n+this.capacity*this.capacity;}else{let i=new fa(r.slice(n,n+this.capacity));t.push(i),n=n+this.capacity;}return t;}search(r){this.flushWhenNeed();let e=[],t=[];for(t.push(this.root);;){let n=t.shift();if(typeof n<"u"){let i=n.items();if(i instanceof Array){for(let s of i)if(!r.isSeparated(s.bbox())){let o=s.items();o instanceof Array?t.push(s):e.push(o);}}else r.isSeparated(n.bbox())||e.push(i);}else break;}return e;}walker(r){this.flushWhenNeed(),this._walker(this.root,0,r);}_walker(r,e,t){this.flushWhenNeed();let n=r.items();if(n instanceof Array)for(let i of n)this._walker(i,e+1,t);else t(n,e);}bbox(){return this.flushWhenNeed(),this.root.bbox();}},pG=(r=>(r[r.DEBUG=0]="DEBUG",r[r.INFO=1]="INFO",r[r.WARNING=2]="WARNING",r[r.ERROR=3]="ERROR",r[r.DUMMY=4]="DUMMY",r))(pG||{});function mG(r){switch(r){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY";}}var gG=(r,e)=>{r===3?console.error(e):console.log(e);},xG=(r,e)=>na.format("%s %s: %s",new Date(),mG(r),e),Bm=(_class11=class Bh{constructor(e,t=gG,n=xG){this.debug=!1,this.level=e,this.writer=t,this.fmt=n;}static mix(...e){let t=4;for(let n of e)n.level<t&&(t=n.level);return new Bh(t,(n,i)=>{for(let s of e)s.write1(n,i);},(n,i)=>i);}wrap(e=null,t=null){let n=e===null?this.fmt:(s,o)=>(o=e(s,o),this.fmt(s,o)),i=t===null?this.writer:(s,o)=>{t(s,o),this.writer(s,o);};return new Bh(this.level,i,n);}chain(e){return e.wrap(this.fmt.bind(this),this.writer.bind(this));}include(e){return this.level<=e;}write3(e,t,n){this.include(e)&&this.writer(e,this.fmt(e,na.format(t,...n)));}write2(e,t){this.include(e)&&(t instanceof Error?this.writer(e,this.fmt(e,t.stack)):this.writer(e,this.fmt(e,t.toString())));}write1(e,t){this.include(e)&&this.writer(e,this.fmt(e,t));}debug3(e,...t){this.write3(0,e,t);}debug2(e){this.write2(0,e);}debug1(e){this.write1(0,e);}info3(e,...t){this.write3(1,e,t);}info2(e){this.write2(1,e);}info1(e){this.write1(1,e);}warning3(e,...t){this.write3(2,e,t);}warning2(e){this.write2(2,e);}warning1(e){this.write1(2,e);}error3(e,...t){this.write3(3,e,t);}error2(e){this.write2(3,e);}error1(e){this.write1(3,e);}},_class11.DUMMY=new _class11(4),_class11),Ly=!1,Oy=class{onRTreeBBox(r){}onResultSide(r){}onOriginSide(r){}onSplitedSide(r){}onDebugSide(r){}onSweep(r,e,t,n,i,s){}onIntersect(r,e,t){}onSegment(r,e,t,n,i,s){}onSegment1(r,e,t){if(Ly){let n=new F(r.getX(t),t),i=new F(e.getX(t),t);this.onSegment(n,r.weight,r,i,e.weight,e);}else this.onSegment(r.start,r.weight,r,e.end,e.weight,e);}onSweep1(r,e,t){if(Ly){let n=new F(r.getX(t),t),i=new F(e.getX(t),t);this.onSweep(n,r.weight,r,i,e.weight,e);}else this.onSweep(r.start,r.weight,r,e.end,e.weight,e);}},ky=class extends Oy{constructor(r){super(),this.plGrps=new Array(),this.debug=r;}onPolylineGroup(r,e){this.plGrps.push(r);}},Xl=class{constructor(r){this.cache={},this.levels=r,this.result=new Array(r),this.weights=new Array(r),this.maxIdx=r-1,this.rule=this.decide.bind(this);let e=1;for(let t=0;t<r;t++)this.weights[t]=e,e*=50;}weight(r){return this.weights[r];}decide(r){r=Math.abs(r);let e=this.cache[r];if(e===void 0){let t=r;for(let n=this.maxIdx;n>=0;n--){let i=this.weights[n],s=r/i|0,o=r%i;o>(i/2|0)?(r=i-o,s++):r=o,this.result[n]=s>0;}e=this.decide1(this.result),this.cache[t]=e;}return e;}},Uy=r=>r!==0,bG=r=>r>0,jae=r=>r<0,Zae=r=>r%2!==0,yG=new class extends Xl{decide1(r){return r[0]||r[1];}}(2),wG=new class extends Xl{decide1(r){return r[0]&&!r[1];}}(2),vG=new class extends Xl{decide1(r){return r[0]&&r[1];}}(2),EG=new class extends Xl{decide1(r){return r[0]&&!r[1]||!r[0]&&r[1];}}(2),PG=(r=>(r[r.UNMARKED=0]="UNMARKED",r[r.INSIDE=1]="INSIDE",r[r.OUTSIDE=2]="OUTSIDE",r[r.INVALID=3]="INVALID",r))(PG||{}),da=class xa{constructor(e,t,n,i,s,o,a){this.inters=[],this.connect=new Array(),this.previous=null,this.next=null,this.finalGrp=-1,this.trans=NaN,this.outsideWeight=0,this.insideWeight=0,this.invalidWeight=0,this._confidence=0,this._confidence_y=NaN,this._x=NaN,this._x_y=NaN,this.status=0,this.bo=e,this.shape=t,this.baseWeight=n,i.y>s.y?this.weight=-n:i.y==s.y?this.weight=0:this.weight=n,this.start=i,this.end=s,this.polyGrp=o,this.polyIndex=a,this._bbox=new ke().ext1(t.bbox()).ext2(i).ext2(s).build1(),this.inters.push(i),this.inters.push(s);let l=31,u=1;u=l*u+this.polyGrp,u=l*u+this.polyIndex,this._hashcode=u;}static rebuild(e,t,n){if(e instanceof q||t.distance2(n)<1e-6)return new q(t,n);if(e instanceof ee){let i=e,s=e.bbox().center().x,o;t.y>n.y?o=s>i.center.x?0:1:o=s>i.center.x?1:0;let a=t.angleD(i.center),l=n.angleD(i.center);return ee.build2(i.center,a,l,i.rx,i.ry,o);}else throw new Error("not supported operation");}updateBbox(){this._bbox=new ke().ext2(this.start).ext2(this.end).build1();}is(e,t){return e===this.polyGrp&&t===this.polyIndex;}confidence(e){if(this._confidence_y!=e){let t=this._bbox.height();if(t!==0){if(Math.abs(e-this._bbox.maxY)>5e-4&&Math.abs(e-this._bbox.minY)>5e-4){let n=1-Math.abs(2*e-this._bbox.maxY-this._bbox.minY)/t;this._confidence=n*1e4|0;}else this._confidence=0;}else this._confidence=1;this._confidence_y=e;}return this._confidence;}needCountWeight(){return this.outsideWeight+this.insideWeight+this.invalidWeight<5e3;}revokeOutside(e){let t=this.confidence(e);return this.outsideWeight-=t,this.invalidWeight+=t,t;}revokeInside(e){let t=this.confidence(e);return this.insideWeight-=t,this.invalidWeight+=t,t;}setOutside(e){let t=this.confidence(e);return this.outsideWeight+=t,t;}setInside(e){let t=this.confidence(e);return this.insideWeight+=t,t;}setInvalid(e){let t=this.confidence(e);return this.invalidWeight+=t,t;}prevNot0(){let e=this.previous;for(;e!=null&&e!=this;){if(e.weight!=0)return e;e=e.previous;}return null;}nextNot0(){let e=this.next;for(;e!=null&&e!=this;){if(e.weight!=0)return e;e=e.next;}return null;}getX(e){if(this.bo!==null)return(this._x_y!=e||isNaN(this._x))&&(_G(this,e)>0?this._x=V[0]:this._x=NaN,this._x_y=e),this._x;throw new Error("not supported operation");}voteStatus(){return this.outsideWeight>this.insideWeight&&this.outsideWeight>this.invalidWeight?2:this.insideWeight>this.outsideWeight&&this.insideWeight>this.invalidWeight?1:this.invalidWeight>this.outsideWeight&&this.invalidWeight>this.insideWeight?3:0;}reverse(e){if(e===2){if(this.start.y>this.end.y){let t=xa.rebuild(this.shape,this.end,this.start),n=new xa(this.bo,t,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return wr.addAll(n.connect,this.connect),n;}else return this;}else if(e===1)if(this.start.y<this.end.y){let t=xa.rebuild(this.shape,this.end,this.start),n=new xa(this.bo,t,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return wr.addAll(n.connect,this.connect),n;}else return this;return this;}isNeedScan(e){return this.needCountWeight()&&this.confidence(e)>0;}hashCode(){return this._hashcode;}equals(e){return e instanceof xa?!(this.polyGrp!==e.polyGrp||this.polyIndex!==e.polyIndex):!1;}bbox(){return this._bbox;}toString(){return ta.format("(%d,%d,%d) (%d,%d,%d) %s %s",this.polyGrp,this.polyIndex,this.weight,this.outsideWeight,this.invalidWeight,this.insideWeight,this.start,this.end);}},pa=class{constructor(){this.innerMap=new ph();}add(r){return this.innerMap.put(r,!0)!==!0;}remove(r){this.innerMap.remove(r);}contains(r){return this.innerMap.get(r)===!0;}iterator(){return this.innerMap.keys();}addAll(r){let e=r.iterator();for(;e.hasNext();)this.add(e.next());}size(){return this.innerMap.size();}clear(){let r=this.iterator();for(;r.hasNext();){let e=r.next();this.remove(e);}}},Dy=wr.funcCopy(Ui);function _G(r,e){let t=0;if(Math.abs(r.start.y-e)<=1e-4)V[t++]=r.start.x;else if(Math.abs(r.end.y-e)<=1e-4)V[t++]=r.end.x;else if(r.shape instanceof q)t=sy(r.shape,e);else if(r.shape instanceof ee)t=oy(r.shape,e);else throw new Error("not supported operation");return t;}var gh=class{constructor(r,e,t,n){this.sides=new Array(),this.loader=r,this.loader.bo=this,this.logger=t,this.rule=e,this.event=n;}static sortByBBoxMinY(r,e){return r.bbox().minY-e.bbox().minY;}static sortByBBoxAreaDesc(r,e){return e.bbox().area()-r.bbox().area();}addPolyline(r,e=1,t=.01,n=!0){for(let i of this.loader.buildGroup(r,e,t,n))this.sides.push(i),this.event.onOriginSide(i);}buildRTree(){let r=new mh(10);for(let e of this.sides)r.add(e);return r;}fillValidSides(r,e,t){for(let n of e)isFinite(n.getX(t))&&r.push(n);}getSortedEndpointsLineAsc(r){let e=new Array();for(let i of r)i.needCountWeight()&&(e.push(i.start),e.push(i.end));Dy(e,F.sortByYAsc,0,e.length);let t=new Array(),n=Number.NEGATIVE_INFINITY;for(let i of e){let s=i.y;s>n&&(t.push(s),n=s);}return t;}splitSides(r,e,t){let n=r.start,i=r.end,s=new F(i.x+(n.x-i.x)*2,i.y+(n.y-i.y)*2);Dy(r.inters,(a,l)=>a.distance2(s)-l.distance2(s),0,r.inters.length);let o=null;for(let a of r.inters)if(o==null)a.equals(n)&&(o=a);else if(!a.equals(o)){let l=da.rebuild(r.shape,o,a);l instanceof ee&&Math.abs(l.sweepAngle)>190&&(l=new q(o,a));let u=new da(this,l,r.baseWeight,o,a,r.polyGrp,t++);if(e.push(u),u.updateBbox(),a.equals(i))break;o=a;}return t;}splitSidesByInters(){let r=new Array();for(let e of this.sides)if(e.polyIndex==0){let t=0,n=null,i=null;do{let s=new Array();t=this.splitSides(e,s,t);for(let o of s)n!=null?(n.next=o,o.previous=n):i=o,n=o,this.event.onSplitedSide(o),r.push(o);if(e.next===null)throw new Error("not supported operation");e=e.next;}while(e.polyIndex!==0);i!=null&&n!=null&&(i.previous=n,n.next=i);}this.sides.length=0;for(let e of r)this.sides.push(e);}seekIntersection(){if(this.sides.length>0){let r=this.buildRTree(),e=new pa();for(let t of this.sides){e.add(t);let n=t.bbox().extendOfSize(1e-5),i=t.shape instanceof q;for(let s of r.search(n))if(!e.contains(s)){let o=s.shape instanceof q;if(!(i&&o&&t.next!==null&&t.previous!==null&&(t.next.equals(s)||t.previous.equals(s)))){let a=dn(t.shape,s.shape);for(let l=0;l<a;l+=2){let u=new F(V[l],V[l+1]);t.inters.push(u),s.inters.push(u),this.event.onIntersect(u,t,s);}}}}}}},SG=class l2{constructor(e){this.sides=new pa(),this.others=new pa(),this.id=e;}add(e){this.sides.add(e),e.finalGrp=this.id;for(let t of e.connect)this.others.add(t);}polyline(){let e=new Array();return ra(this.sides,(t,n)=>(e.push(n.shape),!0)),Me.build2(e).asClose();}hashCode(){return this.id;}equals(e){return e!=null&&e instanceof l2?this.id===e.id:!1;}},Gy=class{constructor(r){this.bo=null,this.sides=new Array(),this.polyGrp=0,this.polyIndex=0,this.prevSide=null,this.firstSide=null,this.noWeight0=r;}completeGroup(r){this.prevSide!=null&&this.firstSide!=null&&!this.prevSide.end.equals(this.firstSide.start)&&this.addSide(new q(this.prevSide.end,this.firstSide.start),r);let e=new Array(),t=null,n=null;for(let i of this.sides)(!this.noWeight0||i.weight!==0)&&(t!=null?(t.next=i,i.previous=t):n=i,t=i,e.push(i));return t!=null&&n!=null&&(n.previous=t,t.next=n),this.polyGrp++,this.sides.length=0,this.prevSide=null,this.firstSide=null,this.polyIndex=0,e;}buildGroup(r,e,t,n=!0){for(let i of r.primitives)if(i instanceof q)this.addSide(i,e);else if(n&&i instanceof ee&&i.rx===i.ry)this.addArc(i,e);else{let s=null;for(let o of i.points(t))s!=null&&this.addSide(new q(s,o),e),s=o;}return this.completeGroup(e);}addArc(r,e){let t=r.sweepAngle,n=Xe.regularD(r.startAngle),i=n+t;if(t>0){let s=90;for(;s<=i;)s>n&&(this.addSide(ee.build3(r.center,n,s-n,r.rx,r.ry),e),n=s),s+=90;n<i&&this.addSide(ee.build3(r.center,n,i-n,r.rx,r.ry),e);}else if(t<0){let s=270;for(;s>=i;)s<n&&(this.addSide(ee.build3(r.center,n,s-n,r.rx,r.ry),e),n=s),s-=90;n>i&&this.addSide(ee.build3(r.center,n,i-n,r.rx,r.ry),e);}}addSide(r,e){if(r.start().equals(r.end()))return;let t=r.start(),n;this.prevSide!=null?(this.prevSide.end.equals(t)||this.addSide(new q(this.prevSide.end,t),e),n=new da(this.bo,r,e,r.start(),r.end(),this.polyGrp,this.polyIndex++)):(n=new da(this.bo,r,e,r.start(),r.end(),this.polyGrp,this.polyIndex++),this.firstSide=n),this.prevSide=n,this.sides.push(n);}},Fy=class{constructor(r,e,t){this.eps=new Array(),this.curWeight=0,this.start=null,this.last=null,this.prevStart=null,this.prevEnd=null,this.y=t,this.rule=r,this.bo=e,this.event=e.event;}onEp(r){this.tuningWeight(r),this.start===null?this.rule(this.curWeight)?this.in(r):r.setInvalid(this.y):this.rule(this.curWeight)?r.setInvalid(this.y):this.out(r,this.start),this.last!==null&&this.event.onSweep1(this.last,r,this.y),this.last=r;}in(r){this.prevEnd!=null&&this.onSameX(r,this.prevEnd)?(this.start=this.prevStart,this.prevStart=null,this.prevEnd.revokeInside(this.y),this.prevEnd=null):(this.start=r,this.start.setOutside(this.y));}out(r,e){if(this.onSameX(e,r))e.revokeOutside(this.y);else{if(r.setInside(this.y)>0&&e.confidence(this.y)>0){let t=e.voteStatus(),n=r.voteStatus();this.isValid(t)&&this.isValid(n)?t==2&&n==1&&(r.connect.push(e),e.connect.push(r)):(r.connect.push(e),e.connect.push(r));}this.event.onSegment1(e,r,this.y),this.eps.push(e),this.eps.push(r),this.prevStart=e,this.prevEnd=r;}this.start=null;}isValid(r){return r==1||r==2;}onSameX(r,e){return r.bbox().isIntersect(e.bbox())&&ue.eq(r.getX(this.y),e.getX(this.y));}tuningWeight(r){this.curWeight+=r.weight;let e=r.nextNot0(),t=r.prevNot0();e!=null&&r.weight===e.weight&&e.trans===this.y&&(this.curWeight-=r.weight),t!=null&&r.weight===t.weight&&t.trans===this.y&&(this.curWeight-=r.weight),r.trans=this.y;}},xh=new Error(),qy=new class extends Xl{decide1(r){return r[0]&&r[1];}}(2),BG=new class extends Oy{onPolylineGroup(r,e){throw xh;}onSegment(r,e,t,n,i,s){throw xh;}}(),IG=class{constructor(r,e){this.rtree=r,this.level=e;}},AG=class u2 extends gh{static isIntersect(e,t,n=Bm.DUMMY){let i=new u2(n),s=i.createGroup1(e.items),o=i.createGroup2(t.items);return s.rtree.itemList.length==0||o.rtree.itemList.length==0?!1:i.isIntersect(s,o);}constructor(e){super(new Gy(!1),qy.rule,e,BG);}createGroup1(e){return this.createGroup(e,0);}createGroup2(e){return this.createGroup(e,1);}createGroup(e,t){let n=qy.weight(t);for(let s of e)this.addPolyline(s,n);let i=this.buildRTree();return this.sides.length=0,new IG(i,t);}isIntersect(e,t){if(e.level!==t.level){let n=e.rtree.bbox().intersection1(t.rtree.bbox());if(n!==null){try{this.inters(e,t);let i=(n.minY+n.maxY)/2;this.sweep(e,t,i);}catch(i){if(i===xh)return!0;throw i;}return!1;}else return!1;}else throw new Error("inersection detection should not in same group");}inters(e,t){if(e.rtree.size()>t.rtree.size()){let n=e;e=t,t=n;}for(let n of e.rtree.items()){n.trans=NaN;let i=n.bbox().extendOfSize(1e-5);for(let s of t.rtree.search(i))if(s.trans=NaN,dn(n.shape,s.shape)>0)throw xh;}}sweep(e,t,n){let i=ye.extend2(e.rtree.bbox(),t.rtree.bbox()).extendOfSize(1e-5),s=new Array();this.fillValidSides(s,e.rtree.search(i),n),this.fillValidSides(s,t.rtree.search(i),n),Ui(s,(a,l)=>a.getX(n)-l.getX(n),0,s.length);let o=new Fy(this.rule,this,n);for(let a of s)o.onEp(a);}},bo=class Wi{constructor(e){this.items=new Array(e.length),wr.arraycopy(e,0,this.items,0,e.length),this.__bbox=this.calcBBox();}static build1(e){let t=[];return Vc(e,(n,i)=>(t.push(i),!0)),new Wi(t);}static build2(e){let t=e.map(n=>Me.build8(n));return new Wi(t);}static combinePolylineGroupArr(e){let t=[];for(let n of e)t=t.concat(n.items);return new Wi(t);}calcBBox(){let e=new ke();for(let t=0;t<this.items.length;t++)e.ext1(this.items[t].bbox());return e.build1();}multiply3(e){let t=new Array(this.items.length);for(let n=0;n<t.length;n++)t[n]=this.items[n].multiply3(e);return new Wi(t);}bbox(){return this.__bbox;}asClose(){return this.items.forEach(e=>e.asClose()),this;}mirrorY(e){return this.items.forEach(t=>t.mirrorY(e)),this;}closeEndpoint(){return this.items.forEach(e=>e.closeEndpoint()),this;}get primitives(){return this.items.map(e=>e.primitives).flat(2);}isEqual(e){return e instanceof Wi?this.items.every(t=>e.items.some(n=>n.isEqual(t))):!1;}getOutMostPolyline(){return this.items.reduce((e,t)=>t.bbox().area()>e.bbox().area()?t:e,this.items[0]);}getOutline(){let e=this.items;if(e.length===1)return{outline:e,hole:new Array()};let t=new Set(),n=new Set();for(let i=0,s=e.length;i<s;i++){let o=e[i];if(!t.has(o)&&!n.has(o)){i+1>=s&&t.add(o);for(let a=i+1;a<s;a++){let l=e[a];if(!t.has(l)&&!n.has(l)){if(!o.bbox().isInside(l.bbox().extendOfSize(1e-4))&&!l.bbox().isInside(o.bbox().extendOfSize(1e-4)))continue;AG.isIntersect(new Wi([o]),new Wi([l]))&&(o.bbox().area()>l.bbox().area()?(t.add(o),n.add(l)):(t.add(l),n.add(o)));}}!t.has(o)&&!n.has(o)&&t.add(o);}}return{outline:[...t],hole:[...n]};}round(e=4){let t=this.items.map(n=>n.round(e));return new Wi(t);}},CG=wr.funcCopy(Ui),MG=wr.funcCopy(Ui),TG=wr.funcCopy(Ui);function RG(r){return new Array();}function Im(r,e){let t=new ky(!1),n=new zy(r,Bm.DUMMY,t);for(let i of e)n.addPolyline(i);return n.simplify(),t.plGrps;}function Hae(r,e){r=r.asClose();let t=Im(Uy,[r]),n=[];for(let i of t)wr.addAll(n,i.items);if(e>0){for(let i of r.primitives)i instanceof q&&i.length()<1e-4||n.push(i.stroke(e*2,1,0));return Im(Uy,n);}else if(e<0){e=-e;for(let i of r.primitives)n.push(i.stroke(e*2,1,1));return Im(bG,n);}else return t;}var zy=class extends gh{constructor(r,e,t){super(new Gy(!1),r,e,t),this.finalSides=new Array(),this.sideGroups={},this.vecSides=new Array(),this.scanY=NaN,this.curNetIndex=0,this.curIndex=-1,this.scanLines=0;}sweep(r,e,t){this.scanY=NaN,this.scanLines=0,CG(e,gh.sortByBBoxMinY,0,e.length);let n=new go();this.curNetIndex=0;let i=Number.POSITIVE_INFINITY;for(let s of r)s>i&&this.scan(n,(i+s)/2,e),i=s;this.getAllMarkPrimitive(t,e),this.logger.debug3("scan %s %d",t,this.scanLines);}simplify(){this.seekIntersection(),this.splitSidesByInters(),this.sweep(this.getSortedEndpointsLineAsc(this.sides),this.sides,!1),this.flipSides(),this.sweep(this.getSortedEndpointsLineAsc(this.vecSides),this.vecSides,!0),this.connectSides(),this.fillResult();}addPolyline(r,e=1,t=.01,n=!0){super.addPolyline(r,e,t,n);}scan(r,e,t){if(this.scanY==e)return;this.scanY=e;let n=!1,i=r.listIterator();for(;i.hasNext();){let s=i.next(),o=s.item;ue.less(o.bbox().maxY,e)?r.remove(s):!n&&o.isNeedScan(e)&&(n=!0);}for(;this.curNetIndex<t.length;){let s=t[this.curNetIndex];if(ue.less(s.bbox().minY,e))ue.greatereq(s.bbox().maxY,e)&&(this.add2AET(r,s),!n&&s.isNeedScan(e)&&(n=!0)),this.curNetIndex++;else break;}if(n){this.scanLines++;let s=new Fy(this.rule,this,e),o=r.iterator();for(;o.hasNext();){let a=o.next();s.onEp(a);}}}add2AET(r,e){let t=e.bbox().minX,n=e.bbox().maxX,i=e.bbox().minY,s=e.bbox().maxY,o=r.listIterator(),a=null;for(;o.hasNext();){let l,u=o.next(),c=u.item,h=c.bbox().minX,d=c.bbox().maxX;if(n<=h)l=-1;else if(d<=t)l=1;else{let p=c.bbox().minY,m=c.bbox().maxY,g=Math.max(i,p),b=Math.min(s,m);l=this.compareBySweep(e,c,(g+b)/2);}let f=c.shape;if(f instanceof q&&f.length()<.001&&a==null&&l<0){a=u;continue;}if(a!=null&&l<0){r.insertBefore(a,e);return;}if(l<0){r.insertBefore(u,e);return;}else a=null;}r.add(e);}getLineAngle(r){let e=r.start().angle(r.end());return e<0&&(e+=Math.PI),e;}getArcAngle(r,e){let t=Math.asin((e-r.center.y)/r.rx);return r.startAngle>90&&r.startAngle<270&&(t=-t),t<0&&(t+=Math.PI),(t+Math.PI/2)%Math.PI;}compareArcLine(r,e,t){let n=this.getArcAngle(r,t),i=this.getLineAngle(e);return ue.eq(n,i)?-r.sweepAngle:i-n;}compareBySweep(r,e,t){let n=r.getX(t);if(!isFinite(n))return 0;let i=e.getX(t);if(!isFinite(i))return 0;if(!ue.eq(n,i))return n-i;if(r.shape instanceof q)return e.shape instanceof q?this.getLineAngle(e.shape)-this.getLineAngle(r.shape):-this.compareArcLine(e.shape,r.shape,t);if(e.shape instanceof q)return this.compareArcLine(r.shape,e.shape,t);{let s=r.shape,o=e.shape,a=this.getArcAngle(s,t),l=this.getArcAngle(o,t);return ue.eq(a,l)?s.sweepAngle*o.sweepAngle<=0?s.sweepAngle<=0?1:-1:s.sweepAngle>0?s.rx-o.rx:o.rx-s.rx:l-a;}}getAllMarkPrimitive(r,e){for(let t of e)if(t.status===0&&t.bbox().height()!=0){let n=t.voteStatus();if(n===2||n===1){t.status=n;let i=t.reverse(n);if(r){this.event.onResultSide(i);let s=i.shape.multiply3(ze.ROT_N90),o=i.start.multiply3(ze.ROT_N90),a=i.end.multiply3(ze.ROT_N90);i=new da(this,s,i.baseWeight,o,a,i.polyGrp,i.polyIndex);}this.finalSides.push(i),this.event.onResultSide(i);}}}flipSides(){for(let r of this.sides)if(r.polyIndex==0){let e=null,t=null;do{let n=r.shape.multiply3(ze.ROT_90),i=r.start.multiply3(ze.ROT_90),s=r.end.multiply3(ze.ROT_90),o=new da(this,n,r.baseWeight,i,s,r.polyGrp,r.polyIndex);if(o.outsideWeight=r.outsideWeight,o.insideWeight=r.insideWeight,o.invalidWeight=r.invalidWeight,o.status=r.status,e!=null?(e.next=o,o.previous=e):t=o,this.vecSides.push(o),this.event.onSplitedSide(o),e=o,r.next!==null)r=r.next;else break;}while(r.polyIndex!=0);t!=null&&(t.previous=e,e.next=t);}}canBeEnd(r,e){if(r.size()==1){let t=r.getFirst().shape;if(t instanceof ee){if(e&&t.rx<=e)return!1;}else if(t instanceof q&&e&&t.length()<=e)return!1;}return!0;}connectSides(){let r=new ph(),e=new mh(10);for(let s of this.finalSides)r.computeIfAbsent(s.start,RG).push(s),e.add(s.start);let t=0,n=new pa(),i=new Array();for(let s of this.finalSides)if(!n.contains(s)){let o=new pa(),a=s.start,l=new go();l.add(s),n.add(s);let u=s.end;for(;l.size()>0;)if(this.isStart(a,u)&&this.canBeEnd(l,.01)){l.size()>1&&this.fillSideGroups(l,t++);break;}else{let c=r.get(u),h=this.findNext(n,c);if(h==null&&(u=this.findNeigber(u,o,e,.01),u!==null&&(c=r.get(u),h=this.findNext(n,c))),h!=null)l.add(h),n.add(h),u=h.end;else if(u!=null?o.add(u):(i.length==0&&l.size()>1&&this.logger.warning3("unable to connect at %s",l.getLast()),i.push(l.removeLast())),l.size()>0)u=l.getLast().end;else break;}}}fillSideGroups(r,e){let t=new SG(e);ra(r,(n,i)=>(t.add(i),!0)),this.sideGroups[t.id]=t;}isStart(r,e){return r.distance2(e)<=1e-4;}findNext(r,e){if(e!=null){for(let t of e)if(!r.contains(t))return t;}return null;}fillResult(){let r=0,e=new ph();for(let n in this.sideGroups){let i=this.sideGroups[n];ra(i.sides,(s,o)=>(o.polyGrp!=-2&&e.put(o,o),!0));}let t=new pa();for(let n in this.sideGroups){let i=this.sideGroups[n];if(t.add(i)){let s=0,o=new Array();for(o.push(i);s<o.length;){let l=o[s],u=new Array();ra(l.others,(h,d)=>{let f=e.get(d);return f!=null&&u.push(f.finalGrp),!0;}),MG(u,wr.sortAsc,0,u.length);let c=l.id;for(let h of u)if(h!=c&&h!=l.id){let d=this.sideGroups[h];t.add(d)&&o.push(d),c=h;}s++;}let a=new Array();for(let l of o)a.push(l.polyline());TG(a,gh.sortByBBoxAreaDesc,0,a.length),this.event.onPolylineGroup(new bo(a),r++);}}}findNeigber(r,e,t,n){let i=n*n,s=Number.MAX_VALUE,o=null;for(let a of t.search(r.bbox().extendOfSize(n)))if(!e.contains(a)){let l=r.distance2(a);l<s&&(s=l,o=a);}return s<i?o:null;}},NG=class extends zy{constructor(r,e,t,n,i,s){super(r.rule,Bm.DUMMY,e),this.sideGroup1=[],this.sideGroup2=[],this.group1=t,this.group2=n,this.seeker=i,this.addGroup(t,r.weight(0),this.sideGroup1),this.addGroup(n,r.weight(1),this.sideGroup2),this.bus=s;}addGroup(r,e,t){if(!r)debugger;r.items.forEach(n=>{let i=[];n.items.forEach(s=>{let o=this.sides.length;this.addPolyline(s,e),i.push(this.sides.slice(o));}),t.push(i);});}seekIntersection(){this.seeker.seek(this.group1,this.group2,(r,e,t,n,i,s)=>{let o=this.sideGroup1[r][e][t],a=this.sideGroup2[n][i][s],l=dn(o.shape,a.shape);for(let u=0;u<l;u+=2){let c=new F(V[u],V[u+1]);o.inters.push(c),a.inters.push(c),this.event.onIntersect(c,o,a);}return l;},this.bus);}},LG=class extends ky{constructor(r){super(!!r),r&&(this.drawDebug=new ha(r),this.blueDrawing=this.drawDebug.initColor(nt.BLUE),this.greenDrawing=this.drawDebug.initColor(nt.GREEN),this.redDrawing=this.drawDebug.initColor(nt.RED));}onOriginSide(r){super.onOriginSide(r),this.debug&&this.blueDrawing.addPt(r.shape);}onPolylineGroup(r,e){super.onPolylineGroup(r,e),this.debug&&r.items.forEach(t=>this.greenDrawing.addPly(t));}draw(){this.drawDebug.draw();}};function bh(r,e,t,n,i){let s=ca(),o=new LG(i);new NG(r,o,e,t,n,i).simplify();let a=[];o.plGrps.forEach(u=>{let c=u.items.map(h=>Ty(h));c[0]&&a.push(new Ht(c.filter(h=>h)));});let l=new ct(a);return Rr.BooleanTools+=zi(s),l;}var yh=!0,Vl={intersect(r,e,t,n){try{return Hl.intersect(r,e,t,n);}catch(i){if(yh)throw i;return console.error(i),bh(vG,r,e,t,n);}},union(r,e,t,n){try{return Hl.union(r,e,t,n);}catch(i){if(yh)throw i;return console.error(i),bh(yG,r,e,t,n);}},diff(r,e,t,n){try{return Hl.diff(r,e,t,n);}catch(i){if(yh)throw i;return console.error(i),bh(wG,r,e,t,n);}},xor(r,e,t,n){return Hl.xor(r,e,t,n);try{return Hl.xor(r,e,t,n);}catch(i){if(yh)throw i;return console.error(i),bh(EG,r,e,t,n);}}},OG=(_class12=class OG{static printf(){}static addIntersect(r){ne.CalIntersectNum+=r.calIntersectNum,ne.IntersectNum+=r.intersectNum;}},_class12.T0=0,_class12.T1=0,_class12.T2=0,_class12.T3=0,_class12.T4=0,_class12.T5=0,_class12.T6=0,_class12),et=class Kn{static getPolyTypeLine(e){let t=[];if(e instanceof Me)for(let n of e.primitives)t.push(n);else if(e instanceof Ht){for(let n of e.items)if(n instanceof Me)for(let i of n.primitives)t.push(i);else{let i=this.getPolyTypeLine(n);for(let s of i)t.push(s);}}else if(e instanceof ct)for(let n of e.items){let i=this.getPolyTypeLine(n);for(let s of i)t.push(s);}return t;}static getPolyGroupAreaRate(e){let t=e.bbox().area(),n=0;for(let i of e.items){let s=i.getOutMostPolyline(),o=Math.abs(s.area(.01))/t;n+=o;}return n;}static getPolyTypePolyLine(e){let t=[];if(e instanceof Me)t.push(e);else if(e instanceof Ht){for(let n of e.items)if(n instanceof Me)t.push(n);else{let i=this.getPolyTypePolyLine(n);for(let s of i)t.push(s);}}else if(e instanceof ct)for(let n of e.items){let i=this.getPolyTypePolyLine(n);for(let s of i)t.push(s);}return t;}static BresenhamLine(e,t,n,i){let s=[],o=Math.abs(n-e),a=Math.abs(i-t),l=e<n?1:-1,u=t<i?1:-1,c=o-a;for(s.push([e,t]);e!==n||t!==i;){let h=c*2;h>-a&&(c-=a,e+=l),h<o&&(c+=o,t+=u),s.push([e,t]);}return s;}static sampleArc(e){let t=60,n=Math.ceil(Math.abs(e.endAngle()-e.startAngle)/t),i=[],s=e.endAngle()>=e.startAngle?1:-1;for(let o=0;o<=n;o++){let a=(e.startAngle+(o+0)*t*s)/180*Math.PI,l=(e.startAngle+(o+1)*t*s)/180*Math.PI,u=e.center.add(new F(Math.cos(a),Math.sin(a)).mul(e.rx)),c=e.center.add(new F(Math.cos(l),Math.sin(l)).mul(e.rx));i.push(new q(u,c));}return i;}static createGrid(e,t){let n={},i=[];for(let o of e){let a=o.bbox();if(a.area()<=ne.GridSize**2&&a.width()<=ne.GridSize&&a.height()<=ne.GridSize){let l=Math.floor((o.bbox().center().x-ne.StartGrid.x)/ne.GridSize),u=Math.floor((o.bbox().center().y-ne.StartGrid.y)/ne.GridSize),c=`${l}_${u}`;n[c]=1;continue;}if(o instanceof ee){let l=o,u=this.sampleArc(l);for(let c of u)i.push(c);}else i.push(o);}let s=o=>{let a=o.start().sub(ne.StartGrid),l=o.end().sub(ne.StartGrid),u=Math.floor(a.x/t),c=Math.floor(a.y/t),h=Math.floor(l.x/t),d=Math.floor(l.y/t),f=Kn.BresenhamLine(u,c,h,d);for(let p of f){let m=`${p[0]}_${p[1]}`;n[m]=1;}};for(let o of i)s(o);return n;}static evaluateCostSingle(e,t){if(e.length<=0||t.length<=0)return 0;let n={ScoreCalEdge:1,ScoreUnionArea:1,ScoreIntersectArea:1},i={ScoreCalEdge:1,ScoreUnionArea:1,ScoreIntersectArea:1},s=e[0].bbox();for(let f=1;f<e.length;f++)s=ye.extend2(s,e[f].bbox());let o=t[0].bbox();for(let f=1;f<t.length;f++)o=ye.extend2(o,t[f].bbox());if(!s||!o)return 1;let a=ye.extend2(s,o),l=s.intersection1(o);if(!l||!a)return 1;n.ScoreUnionArea=a.area()/(1e3*1e3),n.ScoreIntersectArea=1-l.area()/a.area();let u=0,c=0;for(let f of e){let p=Kn.getPolyTypeLine(f);u+=p.length;}for(let f of t){let p=Kn.getPolyTypeLine(f);c+=p.length;}n.ScoreCalEdge=u*c/4e5;let h=0;for(let f of Object.values(i))h+=f;let d=0;for(let f of Object.keys(n)){let p=i[f]/h;d+=n[f]*p;}return d;}static evaluateCostNodeListGrid(e,t){if(e.length<=0)return 0;let n=e[0].getNodeBBox();for(let l=1;l<e.length;l++)n=ye.extend2(n,e[l].getNodeBBox());let i=t.getNodeBBox();if(!n.isIntersect(i))return 0;let s=0,o=t.getGridInfo(),a={};for(let l of e){let u=l.getGridInfo();if(u.length<=o.length)for(let c of Object.keys(u))c in a||c in o&&(a[c]=1,s+=1);else for(let c of Object.keys(o))c in a||c in u&&(a[c]=1,s+=1);}return s;}static evaluateCostNodeListBBox(e,t){if(e.length<=0)return 0;let n=e[0].getNodeBBox();for(let a=0;a<e.length;a++)n=ye.extend2(n,e[a].getNodeBBox());let i=t.getNodeBBox(),s=n.intersection1(i);if(!s)return 0;let o=n.area()+i.area()-s.area();return 1-s.area()/o;}static evaluateCostNodeListCombo(e,t){if(e.length<=0)return 0;let n={ScoreUnionArea:{name:"\u5E76\u96C6\u533A\u57DF",score:1,weight:1},ScoreIntersectArea:{name:"\u4EA4\u96C6\u6BD4\u4F8B",score:1,weight:1},ScoreLineNumCal:{name:"\u63A5\u89E6\u8FB9",score:1,weight:1}},i=e[0].getNodeBBox();for(let p=0;p<e.length;p++)i=ye.extend2(i,e[p].getNodeBBox());let s=t.getNodeBBox(),o=i.intersection1(s);if(!o)return 0;let a=0,l=0,u=0,c=0;for(let p of e){let m=Kn.getPolyTypeLine(p.polygon);for(let g of m)l+=1,o.isIntersect(g.bbox())&&(a+=1);}let h=Kn.getPolyTypeLine(t.polygon);c=h.length;for(let p of h)o.isIntersect(p.bbox())&&(u+=1);let d=i.area()+s.area()-o.area();n.ScoreIntersectArea.score=1-o.area()/d;let f=1-(a+u)/(l+c);return l+c;}static getListBBox(e){if(e.length<=0)return;let t=new ke();for(let n of e){let i=Kn.getSingleBBox(n);t.ext1(i);}return t.build1();}static getSingleBBox(e){if(e instanceof Array){let t=new ke(),n=Kn.getListBBox(e.slice(1));return t.ext1(n),t.build1();}else return e.bbox();}static getListPolyTypeLine(e){if(e.length<=0)return[];let t=[];for(let n of e){let i=Kn.getSinglePolyTypeLine(n);t=t.concat(i);}return t;}static getSinglePolyTypeLine(e){return e instanceof Array?Kn.getListPolyTypeLine(e.slice(1)):Kn.getPolyTypeLine(e);}static evaluateCostNodeBoolChildByBBox(e,t,n=void 0){if(!e||!t)return 0;let i=e.intersection1(t);if(!i)return 0;let s=ye.extend2(e,t);if(n)Math.min(1-i.area()/e.area(),1-i.area()/t.area(),1-i.area()/s.area())*.5+(1-s.area()/n.area())*.5;else return Math.min(1-i.area()/e.area(),1-i.area()/t.area(),1-i.area()/s.area());}static evaluateCostNodeBoolChildByCombo(e,t,n,i){return n.length+i.length;}static doDrawRule(e,t=ne.PrintStart){if(e.length<2)return[t,t,t];let n=5,i=10,s=e[0],o=ne.translate(s),a=[],l=t.y,u=t.x,c=t.x;t=t.add(new F(0,-i));for(let f=1;f<e.length;f++){let p=e[f];if(p instanceof Array){t=t.add(new F(n,0));let m=this.doDrawRule(p,t);a.push(m[0]),m[1].x<=u&&(u=m[1].x),m[2].x>=c&&(c=m[2].x),t=new F(m[2].x+n,t.y);}else p.name||(p.name=ne.getPolyTypeKey(),ne.drawText(p.bbox().UL(),p.name)),a.push(t.clone()),t.x<=u&&(u=t.x),t.x>=c&&(c=t.x),ne.drawText(t,p.name),t=t.add(new F(n,0));}let h=0;for(let f of a)h+=f.x;let d=new F(h/a.length,t.y+i);ne.drawText(d,"N:"+o);for(let f of a){let p=new q(f,d),m=new Array();m.push(p);let g=Me.build1(Wc(m));ne.drawPolyType(g,nt.GREEN);}return[d,new F(u,l),new F(c,l)];}static drawRule(e,t=ne.PrintStart,n=!1,i){ne.clearDrawing(),this.doDrawRule(e,t),n&&this.doDrawRulePolygon(e,i),ne.getDebug().draw();}static doDrawRulePolygon(e,t){let n=e[0];for(let i=1;i<e.length;i++){let s=e[i];if(s instanceof Array)this.doDrawRulePolygon(s,t);else{let o=t;n===2&&i===1&&(o=nt.RED),s.name&&ne.drawText(s.bbox().UL(),s.name,o),ne.drawPolyType(s,o);}}}static getRulePolygonName(e){let t=[];return this.doGetRulePolygonName(e,t),t.sort((n,i)=>parseInt(n.split("P")[1])-parseInt(i.split("P")[1])),t;}static doGetRulePolygonName(e,t){for(let n=1;n<e.length;n++){let i=e[n];i instanceof Array?this.doGetRulePolygonName(i,t):(i.name||(i.name=ne.getPolyTypeKey()),t.push(i.name));}}static getRulePolygonTypeByName(e,t){for(let n=1;n<e.length;n++){let i=e[n];if(i instanceof Array){let s=this.getRulePolygonTypeByName(i,t);if(s)return s;}else if(i.name===t)return i;}}static IsOneBBoxPointInPolygonType(e,t){for(let n=0;n<4;n++){let i;switch(n){case 0:i=e.LL();break;case 1:i=e.UR();break;case 2:i=e.LR();break;case 3:i=e.UL();break;default:break;}for(let s of t.items)if(s.getOutMostPolyline().getWindingNum(i))return!0;}return!1;}static IsCenterBBoxPointInPolygonType(e,t){let n=e.center();for(let i of t.items)if(i.getOutMostPolyline().getWindingNum(n))return!0;return!1;}static IsAllPointInPolygonType(e,t){if(!t||!e)return!1;for(let n of e.items){let i=n.items;for(let s of i)for(let o of s.primitives)for(let a of t.items)if(!a.getOutMostPolyline().getWindingNum(o.start()))return!1;}return!0;}static KeepBBoxPolygonGroup(e,t){let n=t.bbox().intersection1(e);if(!n)return!1;for(let i of t.items)for(let s of i.items)for(let o of s.primitives)if(n.isIntersect(o.bbox()))return!0;return!!this.IsCenterBBoxPointInPolygonType(e,t);}},Yy=class Ih{constructor(){this.listChild=[],this.name=ne.getArrangeNodeKey();}isLeaf(){return this.listChild.length>0&&!(this.listChild[0]instanceof Ih);}getResult(){if(this.listChild.length<=0)return[];if(this.listChild[0]instanceof Ih){let e=[];for(let t of this.listChild){let n=t.getResult();n instanceof Array&&n.length<=0||e.push(n);}return e;}else return this.listChild.length===1?this.listChild[0]:this.listChild;}getFlatChild(){if(this.listChild.length<=0)return[];let e=[];for(let t of this.listChild)if(t instanceof Ih){let n=t.getFlatChild();if(n.length<=0)continue;e=e.concat(n);}else e.push(t);return e;}addChild(e){this.listChild.indexOf(e)<0&&this.listChild.push(e);}},Xy=class{constructor(r="None"){this.m_listFinalNode=[],this.m_dictSolution={},this.m_nIteration=0,this.m_strName=r;}initOption(r){this.m_funSearchChild=r.funSearchChild,this.m_funGetCurValue=r.funGetValue,this.m_funCalCombineCost=r.funCalCombineCost,this.m_funCalTotal=r.funCalTotal,this.m_funGetBox=r.funGetBBox;}run(){this.m_nIteration=0;let r=performance.now();for(let e=0;e<ne.IterationNum;e++){if(this.m_nIteration+=1,performance.now()-r>=ne.IterationMilliSecond){console.warn("\u9000\u51FA\u8FED\u4EE3\uFF1A\u8D85\u8FC7\u8FED\u4EE3\u65F6\u95F4");break;}this.onIteration();}return ne.IterationNum>1&&this.m_nIteration>=ne.IterationNum&&console.warn("\u8D85\u8FC7\u8FED\u4EE3\u6B21\u6570",ne.IterationNum),this.getResult(this.m_listFinalNode);}runOnce(){return this.onIteration(),this.getResult(this.m_listFinalNode);}getResult(r){let e=[];for(let t of r){let n=t.getResult();n instanceof Array&&n.length<=0||e.push(n);}return e;}},kG=class extends Yy{},wh=class c2 extends Xy{constructor(){super(...arguments),this.m_bConfig=!1,this.m_nTemperature=0,this.m_nCoolingRate=0;}init(e){this.m_listFinalNode=[];for(let t of e){let n=new kG();n.addChild(t),this.m_listFinalNode.push(n);}}config(e){this.m_nTemperature=e.temperature,this.m_nCoolingRate=e.coolingRate,this.m_bConfig=!0;}onIteration(){if(!this.m_bConfig)throw new Error("\u5C1A\u672A\u8FDB\u884C\u521D\u59CB\u5316");let e=this.m_listFinalNode.length,t=[...this.m_listFinalNode];this.m_listFinalNode=t;let n=this.m_funCalTotal(this.getResult(t)),i=n,s=[...this.m_listFinalNode],o=[];for(;this.m_nTemperature>1;){ne.TotalCalNum+=1;let a=[...t],l=Math.floor(Math.random()*e),u=Math.floor(Math.random()*e),c=a[l];a[l]=a[u],a[u]=c;let h=this.getResult(a),d=this.m_funCalTotal(h);if(c2.acceptanceProbability(n,d,this.m_nTemperature)>Math.random()){if(ne.UseConvergence){let f=Math.abs(d-n);o.push(f);}t=[...a],n=d;}if(n<=i&&(s=[...t],i=n),this.m_nTemperature*=1-this.m_nCoolingRate,ne.UseConvergence&&(o.length>ne.Convergence&&o.splice(0,1),o.length>=ne.Convergence)){let f=!0;for(let p of o)p>=ne.MinDelta&&(f=!1);if(f)break;}}this.m_listFinalNode=s;}static optimize(e,t,n,i){let s=e.length,o=[...e],a=i(o),l=a,u=[...o],c=[];for(;t>1;){ne.TotalCalNum+=1;let h=[...o],d=Math.floor(Math.random()*s),f=Math.floor(Math.random()*s),p=h[d];h[d]=h[f],h[f]=p;let m=i(h);if(this.acceptanceProbability(a,m,t)>Math.random()&&(o=[...h],a=m),a<l){if(u=[...o],ne.UseConvergence){let g=Math.abs(l-a);if(c.push(g),c.length>ne.Convergence&&c.splice(0,1),c.length>=ne.Convergence){let b=!0;for(let y of c)y>=ne.MinDelta&&(b=!1);if(b)break;}}l=a;}t*=1-n;}return u;}static acceptanceProbability(e,t,n){return t<e?1:Math.exp((e-t)/n);}},ne=(_class13=class He{static getSAOptimizer(){return He.SAOptimizer||(He.SAOptimizer=new wh()),He.SAOptimizer;}static reset(){He.TotalNodeNum=0,He.TotalCalNum=0,He.CalIntersectNum=0,He.IntersectNum=0,He.dictValue={},He.dictShowTime={};}static formatTimeIndex(e){return JSON.stringify({:e.runBoolean,:e.IntersectionSeeker,:e.BooleanTools,:e.totalBool});}static print(){if(He.Record&&console.log(this.formatTimeIndex(Rr)),!!He.LogTime){switch(console.log("\u4E24\u8FB9\u8BA1\u7B97\u4EA4\u70B9\u6B21\u6570\uFF1A"+He.CalIntersectNum),console.log("\u4EA4\u70B9\u6570\u91CF\uFF1A"+He.IntersectNum),He.OptimizeType){case"Force":console.log("\u66B4\u529B\u4F18\u5316\u8282\u70B9\u6570\uFF1A"+He.TotalNodeNum),console.log("\u66B4\u529B\u4F18\u5316\u5E73\u5747\u6B21\u6570\uFF1A"+Math.ceil(He.TotalCalNum/He.TotalNodeNum));break;case"SA":console.log("\u968F\u673A\u4F18\u5316\u8282\u70B9\u6570\uFF1A"+He.TotalNodeNum),console.log("\u968F\u673A\u4F18\u5316\u5E73\u5747\u6B21\u6570\uFF1A"+Math.ceil(He.TotalCalNum/He.TotalNodeNum));break;default:break;}if(He.addMarkTime("\u5E03\u5C14\u5168\u90E8\u65F6\u95F4",He.getMarkTime("\u5168\u5C40\u89C4\u5212\u65F6\u95F4")+Rr.IntersectionSeeker+Rr.BooleanTools),He.LogTime)for(let e of Object.keys(this.dictShowTime))console.log(e,this.formatTime(this.dictShowTime[e]));OG.printf();}}static addEvaluateValue(e,t,n){He.dictValue[e]===void 0&&(He.dictValue[e]={}),He.dictValue[e][t]===void 0&&(He.dictValue[e][t]=0);let i=He.dictValue[e][t]+n;He.dictValue[e][t]=i/2;}static getDebug(){return He.drawDebug||(He.drawDebug=new ha(He.curBus)),He.drawDebug;}static getDrawing(e=nt.GREEN){return this.getDebug().initColor(e);}static clearDrawing(){He.getDebug().clear();}static drawText(e,t,n=nt.GREEN){He.getDrawing(n).addText(e,t,1.5,.1,!0);}static drawBBox(e,t=nt.GREEN){if(!e)return;let n=He.getDrawing(t),i=new q(e.UL(),e.UR()),s=new q(e.UR(),e.LR()),o=new q(e.LR(),e.LL()),a=new q(e.LL(),e.UL());n.addPt(i),n.addPt(s),n.addPt(o),n.addPt(a);}static drawPolyType(e,t){let n=He.getDrawing(t);if(e instanceof Me)n.addPly(e);else if(e instanceof Ht)for(let i of e.items)i instanceof Me?n.addPly(i):this.drawPolyType(i,t);else if(e instanceof ct)for(let i of e.items)this.drawPolyType(i,t);}static getPolyTypeKey(){return this.IncreasePoly+=1,"P"+He.IncreasePoly;}static getNodeKey(){return this.IncreaseNode+=1,"N"+He.IncreaseNode;}static getTreeKey(){return this.IncreaseTree+=1,"T"+He.IncreaseTree;}static getArrangeNodeKey(){return this.IncreaseArrangeNode+=1,"A"+He.IncreaseArrangeNode;}static getOptimizeKey(){return this.IncreaseOptimizeNode+=1,"O"+He.IncreaseOptimizeNode;}static getMarkTime(e){return e in He.dictShowTime?He.dictShowTime[e]:0;}static addMarkTime(e,t){He.LogTime&&(e in He.dictShowTime||(He.dictShowTime[e]=0),He.dictShowTime[e]+=t);}static markStart(e){He.LogTime&&(this.dictMarkTime[e]=performance.now());}static formatTime(e){let t=Math.floor(e/1e3),n=Math.floor(e%1e3);return t>0?`${t}s${n}ms`:`${e.toFixed(3)}ms`;}static markEnd(e){if(!He.LogTime)return;if(!(e in this.dictMarkTime)){console.error("\u6CA1\u6709\u8BB0\u5F55\u5F00\u59CB",e);return;}let t=performance.now()-this.dictMarkTime[e];return delete this.dictMarkTime[e],t;}static translate(e){switch(e){case 0:return"\u2229";case 2:return"-";case 1:return"U";case 3:return"X";default:break;}}static calculateDispersion(e){if(e.length<=0)return 0;let t=i=>{let s=0,o=0,a=0,l=0;for(let u of i)for(let c of u.primitives)a+=1,o+=c.start().x,s+=c.start().y;o=o/a,s=s/a;for(let u of i)for(let c of u.primitives){let h=o-c.start().x,d=s-c.start().y;l+=Math.sqrt(h*h+d*d);}return l/a;},n=[];for(let i of e)n=n.concat(et.getPolyTypePolyLine(i));return t(n);}static evaluateCostMulti(e,t){if(e.length<=0)return{calEdge:0,intersectAreaRate:0,lastEdge:0};if(t.length<=0)return{calEdge:0,intersectArea:0,lastEdge:0};let n=e[0].bbox();for(let f=1;f<e.length;f++)n=ye.extend2(n,e[f].bbox());let i=t[0].bbox();for(let f=1;f<t.length;f++)i=ye.extend2(i,t[f].bbox());let s=0,o=0,a=[];for(let f of e){let p=et.getPolyTypeLine(f);s+=p.length;for(let m of p)a.push(m.bbox());}let l=[];for(let f of t){let p=et.getPolyTypeLine(f);o+=p.length;for(let m of p)l.push(m.bbox());}let u=ye.extend2(n,i),c=[],h=0;for(let f of a)i.isContainsBBox(f)&&c.push(f),i.isIntersect(f)||(h+=1);for(let f of l)n.isContainsBBox(f)&&c.push(f),i.isIntersect(f)||(h+=1);if(c.length<=0)return{calEdge:0,intersectAreaRate:0,lastEdge:h};let d=c[0];for(let f=1;f<c.length;f++)d=ye.extend2(d,c[f]);return{calEdge:s*o,intersectAreaRate:d.area()/u.area(),lastEdge:h};}static clamp(e,t,n){return Math.max(t,Math.min(e,n));}static getPolygonValue(e){if(e.length<=0)return 0;let t=He.calculateDispersion(e),n=e[0].bbox(),i=0;for(let s of e){n=ye.extend2(n,s.bbox());let o=et.getPolyTypeLine(s);i+=o.length;}return n.area()*.3+i*.3+t*.3;}},_class13.UseRunArrange=!0,_class13.UseOptimizeSplit=!0,_class13.UseRandomOptimize=!1,_class13.LocalBestThread=4,_class13.ForceCalTestNum=8,_class13.HandleDiff=!0,_class13.SplitDiffNum=5,_class13.HandleDiffAreaRate=.9,_class13.Record=!0,_class13.Debug=!1,_class13.DrawSeek=!1,_class13.UseClass=!1,_class13.AutoPair=!0,_class13.UseConvergence=!0,_class13.OnlyBBoxTouch=!0,_class13.NoOptimizePureTreeNode=!0,_class13.OcTreeSplitStep=4,_class13.KDTreeSplitStep=4,_class13.SplitType="OcTree",_class13.UnionSplitType="Raw",_class13.UnionSplitGridSize=8,_class13.OptimizeType="PredictCalculate",_class13.EvaluateType="Combo",_class13.Temperature=100,_class13.CoolingRate=.3,_class13.MinDelta=_class13.EvaluateType==="BBox"?.1*_class13.LocalBestThread:2,_class13.Convergence=3,_class13.IterationNum=1,_class13.IterationMilliSecond=2e4,_class13.EvaluateRaw=!1,_class13.Evaluate=!1,_class13.LogRule=!1,_class13.LogTree=!1,_class13.LogTime=!1,_class13.LogCalRules=!1,_class13.ExtendRate=4,_class13.LogEmpire=!1,_class13.GridSize=8,_class13.StartGrid=new F(-1e4,-1e4),_class13.AttractG=1e3,_class13.AreaRate=0,_class13.DrawLogBBox=!1,_class13.DrawBoolTree=!1,_class13.DrawRect=!1,_class13.DrawAttract=!1,_class13.DrawGrid=!1,_class13.DrawBoolTreeBBox=!1,_class13.DrawSplitRect=!1,_class13.CalIntersectNum=0,_class13.IntersectNum=0,_class13.TotalCalNum=0,_class13.TotalNodeNum=0,_class13.dictValue={},_class13.IncreasePoly=0,_class13.IncreaseNode=0,_class13.IncreaseTree=0,_class13.IncreaseArrangeNode=0,_class13.IncreaseOptimizeNode=0,_class13.PrintGrid=5,_class13.PrintStart=new F(150,-200),_class13.dictMarkTime={},_class13.dictShowTime={},_class13),Vy=class{constructor(r){this.palette=new ha(r);}drawing(){this.palette.draw();}drew(){this.palette.draw(),this.clear();}clear(){this.palette.clear();}drawPt(r,e){this.palette.initColor(e).addPt(r),this.drawing();}drawPtArr(r,e){let t=this.palette.initColor(e);r.forEach(n=>{t.addPt(n);}),this.drawing();}drawPolyLine(r,e){this.palette.initColor(e).addPly(r),this.drawing();}drawPolyLineArr(r,e){r.forEach(t=>{this.drawPolyLine(t,e);}),this.drawing();}drawPolygon(r,e){let t=this.palette.initColor(e);r.items.forEach(n=>{t.addPly(n);}),this.drawing();}drawPolygonArr(r,e){r.forEach(t=>{this.drawPolygon(t,e);}),this.drawing();}drawGroup(r,e){let t=this.palette.initColor(e);r.items.forEach(n=>{n.items.forEach(i=>{t.addPly(i);});}),this.drawing();}drawText(r,e,t){this.palette.initColor(t).addText(r,e,1.5,.1,!0),this.drawing();}drawGroupArr(r,e){r.forEach(t=>{this.drawGroup(t,e);}),this.drawing();}drawRect(r,e){this.drawPt(new q(new F(r.maxX,r.maxY),new F(r.maxX,r.minY)),e),this.drawPt(new q(new F(r.maxX,r.maxY),new F(r.minX,r.maxY)),e),this.drawPt(new q(new F(r.minX,r.minY),new F(r.maxX,r.minY)),e),this.drawPt(new q(new F(r.minX,r.minY),new F(r.minX,r.maxY)),e),this.drawing();}drawBbox(r,e){this.drawPt(new q(new F(r.maxX,r.maxY),new F(r.maxX,r.minY)),e),this.drawPt(new q(new F(r.maxX,r.maxY),new F(r.minX,r.maxY)),e),this.drawPt(new q(new F(r.minX,r.minY),new F(r.maxX,r.minY)),e),this.drawPt(new q(new F(r.minX,r.minY),new F(r.minX,r.maxY)),e),this.drawing();}drawPtArrBbox(r,e){let t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER;for(let o=0;o<r.length-1;o++)t=Math.max(t,r[o].bbox().maxX),n=Math.min(n,r[o].bbox().minX),i=Math.max(i,r[o].bbox().maxY),s=Math.min(s,r[o].bbox().minY);this.drawBbox(new ye(n,t,s,i),e);}drawGridSpace(r,e){for(let t=0;t<r.getGrid().length;t++)if(r.getGrid()[t]!==void 0)for(let n=0;n<r.getGrid()[t].length;n++)r.getGrid()[t][n]!==void 0&&this.drawRect(r.getGridRect(t,n),e);this.drawing();}drawGridSpaceAll(r,e){for(let t=0;t<r.getRows();t++)for(let n=0;n<r.getCols();n++)this.drawRect(r.getGridRect(t,n),e);this.drawing();}drawPoint(r,e){this.palette.initColor(e).addPoint(r),this.drawing();}},Kae,Qae,UG=class{init(r){}seek(r,e,t,n){if(ne.DrawSeek){let d=new Vy(n);r.name&&d.drawText(r.bbox().UL(),r.name,nt.GREEN),e.name&&d.drawText(e.bbox().UL(),e.name,nt.BLUE),d.drawGroup(r,nt.GREEN),d.drawGroup(e,nt.BLUE);debugger;d.clear();}let i=r.bbox().extendOfSize(5e-6).intersection1(e.bbox().extendOfSize(5e-6));if(!i)return;let s=ca(),o=[];for(let d=0,f=r.items.length;d<f;d++){let p=r.items[d];if(i.isIntersect(p.bbox()))for(let m=0,g=p.items.length;m<g;m++){let b=p.items[m];if(i.isIntersect(b.bbox()))for(let y=0,v=b.primitives.length;y<v;y++){let E=b.primitives[y].bbox();i.isIntersect(E)&&o.push({bbox:E,polygonIndex:d,polylineIndex:m,ptIndex:y});}}}let a=o.length;if(a===0){Rr.IntersectionSeeker+=zi(s);return;}let l=[];for(let d=0,f=e.items.length;d<f;d++){let p=e.items[d];if(i.isIntersect(p.bbox()))for(let m=0,g=p.items.length;m<g;m++){let b=p.items[m];if(i.isIntersect(b.bbox()))for(let y=0,v=b.primitives.length;y<v;y++){let E=b.primitives[y].bbox();i.isIntersect(E)&&l.push({bbox:E,polygonIndex:d,polylineIndex:m,ptIndex:y});}}}let u=l.length;if(u===0){Rr.IntersectionSeeker+=zi(s);return;}if(a<5||u<5){for(let d=0,f=o.length;d<f;d++)for(let p=0,m=l.length;p<m;p++)if(o[d].bbox.isIntersect(l[p].bbox.extendOfSize(1e-5))){let g=o[d],b=l[p];ne.IntersectNum+=t(g.polygonIndex,g.polylineIndex,g.ptIndex,b.polygonIndex,b.polylineIndex,b.ptIndex);}Rr.IntersectionSeeker+=zi(s);return;}o.sort((d,f)=>d.bbox.minX-f.bbox.minX),l.sort((d,f)=>d.bbox.minX-f.bbox.minX);let c=0,h=0;for(;c<a&&h<u;)if(o[c].bbox.minX<l[h].bbox.minX){let d=o[c],f=d.bbox;for(let p=h;p<u;p++){let m=l[p],g=m.bbox;if(g.minX>f.maxX+1e-5)break;(f.minY<g.minY?g.minY:f.minY)<(f.maxY<g.maxY?f.maxY:g.maxY)+1e-5&&(ne.IntersectNum+=t(d.polygonIndex,d.polylineIndex,d.ptIndex,m.polygonIndex,m.polylineIndex,m.ptIndex));}c++;}else{let d=l[h],f=d.bbox;for(let p=c;p<a;p++){let m=o[p],g=m.bbox;if(g.minX>f.maxX+1e-5)break;(g.minY<f.minY?f.minY:g.minY)<(g.maxY<f.maxY?g.maxY:f.maxY)+1e-5&&(ne.IntersectNum+=t(m.polygonIndex,m.polylineIndex,m.ptIndex,d.polygonIndex,d.polylineIndex,d.ptIndex));}h++;}Rr.IntersectionSeeker+=zi(s);}};function DG(r,e){let t=r.bbox(),n=e.bbox(),i=(t.minY+t.maxY)/2,s=(n.minY+n.maxY)/2;return i-s;}function GG(r,e){let t=r.bbox(),n=e.bbox(),i=(t.minX+t.maxX)/2,s=(n.minX+n.maxX)/2;return i-s;}var Wl=class Cn{constructor(e,t){if(this.childs=new Array(),this._bbox=null,this.parent=null,this.capacity=e,typeof t<"u"&&Array.isArray(t))for(let n of t)this.insert(n);}bbox(){return st.notnull(this._bbox);}itor(e,t){for(let n of this.childs)n instanceof Cn?n.itor(e+1,t):t(n,e);}debug(e){for(let t of this.childs)console.log(e,t.bbox(),t instanceof Cn?"+":"-"),t instanceof Cn&&t.debug(e+" |--");}insert(e){let t=this.childs,n=e.bbox();if(!(e instanceof Cn))for(let i=0;i<t.length;i++){let s=t[i];if(s instanceof Cn&&n.isInside(s.bbox())){s.insert(e),this._bbox=ye.extend2(this._bbox,n);return;}}e instanceof Cn&&(e.parent=this),t.length<=this.capacity?t.push(e):(t.push(e),this.splitNode()),this._bbox=ye.extend2(this._bbox,n);}remove(e){if(e instanceof Cn&&e.childs.length>0)throw new Error();let t=this.childs,n=e.bbox(),i=new Array();for(let s=0;s<t.length;s++){let o=t[s];if(o===e)return t.splice(s,1),t.length>0?(this.updateBBox(),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox()):this.parent!==null?(this.parent.remove(this),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox()):this._bbox=null,1;o instanceof Cn&&n.isInside(o.bbox())&&i.push(o);}if(e instanceof Cn)throw new Error();for(let s of i){let o=s.remove(e);if(o===1)return this.childs.length>0&&this.updateBBox(),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox(),1;if(o!==0)throw new Error();}return 0;}recycle(){this.childs.length=0;}updateBBox(){let e=new ke();for(let t of this.childs)e.ext1(t.bbox());this._bbox=e.build1();}splitNode(){let e=this.childs,t=e.length,n=-1,i=-1,s=Number.NEGATIVE_INFINITY;for(let u=0;u<t;u++){let c=e[u];for(let h=u+1;h<t;h++){let d=e[h],f=ye.extend2(c.bbox(),d.bbox()).area();f>s&&(s=f,n=u,i=h);}}let o=this.asNode(e[n]),a=this.asNode(e[i]);for(let u=0;u<t;u++)if(u!==n&&u!==i){let c=e[u],h=c.bbox(),d=ye.extend2(o._bbox,h).area(),f=ye.extend2(a._bbox,h).area();d<f?o.insert(c):a.insert(c);}e.length=0;let l=this.parent;l!==null&&l.childs.length<this.capacity?(o.parent=l,a.parent=l,l.childs.push(o),l.childs.push(a),l.remove(this),l.updateBBox()):(o.parent=this,a.parent=this,e.push(o),e.push(a),this.updateBBox()),this.childs.length>0&&this.updateBBox(),o.updateBBox(),a.updateBBox();}asNode(e){if(e instanceof Cn)return e;{let t=new Cn(this.capacity);return t.insert(e),t;}}},Wy=.5,$y=1e5,vh=class{constructor(r){this.items=new Set(),this.changeList=new Set(),this.deadList=new Set(),this.changed=!1,this.capacity=r,this.capacity2=r*r,this.root=new Wl(r);}itor(r){this.root.itor(0,r);}size(){return this.items.size;}search(r){this.flushWhenNeed();let e=[],t=[];for(t.push(this.root);;){let n=t.shift();if(n!==void 0)for(let i of n.childs)r.isSeparated(i.bbox())||(i instanceof Wl?t.push(i):e.push(i));else break;}return e;}insert(r){this.items.add(r),this.changeList.add(r),this.changed=!0;}remove(r){this.items.delete(r),this.deadList.add(r),this.changed=!0;}bbox(){return this.flushWhenNeed(),this.root.bbox();}flushDeleteWhenNeed(){if(this.changed){let r=this.deadList.size,e=1;if(this.items.size>0&&(e=r/this.items.size),e>Wy||r>$y)this.fullRefresh(),this.deadList.clear(),this.changeList.clear(),this.changed=!1;else{for(let t of this.deadList)this.root.remove(t);this.deadList.clear(),this.changed=this.changeList.size>0;}}}flushWhenNeed(){if(this.changed){let r=this.changeList.size+this.deadList.size,e=1;if(this.items.size>0&&(e=r/this.items.size),e>Wy||r>$y)this.fullRefresh();else{for(let t of this.deadList)this.root.remove(t);for(let t of this.changeList)this.items.has(t)&&this.root.insert(t);}this.deadList.clear(),this.changeList.clear(),this.changed=!1;}}debug(){this.root.debug("");}recycle(){this.items.clear(),this.changeList.clear(),this.deadList.clear(),this.root.recycle(),this.changed=!1;}fullRefresh(){let r=new Array();for(let e of this.items)r.push(e);for(;;){let e=this.organize(r);if(e.length>1)r=e;else break;}this.root.recycle(),this.root=new Wl(this.capacity,r);}organize(r){Ui(r,GG,0,r.length);let e=r.length,t=[];for(let n=0;n<e;)if(n+this.capacity2<=e){let i=n+this.capacity2;Ui(r,DG,n,i);for(let s=n;s<i;s+=this.capacity){let o=new Wl(this.capacity,r.slice(s,s+this.capacity));t.push(o);}n=n+this.capacity*this.capacity;}else{let i=new Wl(this.capacity,r.slice(n,n+this.capacity));t.push(i),n=n+this.capacity;}return t;}},Am=class Ah{constructor(){this.listChild=[],this.name=ne.getArrangeNodeKey();}isLeaf(){return this.listChild.length>0&&!(this.listChild[0]instanceof Ah);}getResult(){if(this.listChild.length<=0)return[];if(this.listChild[0]instanceof Ah){let e=[];for(let t of this.listChild){let n=t.getResult();n instanceof Array&&n.length<=0||e.push(n);}return e;}else return this.listChild.length===1?this.listChild[0]:this.listChild;}getFlatChild(){if(this.listChild.length<=0)return[];let e=[];for(let t of this.listChild)if(t instanceof Ah){let n=t.getFlatChild();if(n.length<=0)continue;e=e.concat(n);}else e.push(t);return e;}addChild(e){this.listChild.indexOf(e)<0&&this.listChild.push(e);}},Cm=class{constructor(r,e){this.m_dictCurNode={},this.m_dictContains={},this.m_nIteration=0,this.m_strName=r,this.m_funSearchChild=e.funSearchChild,this.m_funGetCurValue=e.funGetValue,this.m_funCalCombineCost=e.funCalCombineCost,this.m_funCalTotal=e.funCalTotal,this.m_funGetBox=e.funGetBBox;}recordContains(r,e){r in this.m_dictContains||(this.m_dictContains[r]={}),this.m_dictContains[r][e.name]=e;}deleteContains(r){for(let e of Object.keys(this.m_dictContains))delete this.m_dictContains[e][r.name];}run(){this.m_nIteration=0;let r=performance.now();for(let e=0;e<ne.IterationNum;e++){if(this.m_nIteration+=1,performance.now()-r>=ne.IterationMilliSecond){console.warn("\u9000\u51FA\u8FED\u4EE3\uFF1A\u8D85\u8FC7\u8FED\u4EE3\u65F6\u95F4");break;}this.onIteration();}return ne.IterationNum>1&&this.m_nIteration>=ne.IterationNum&&console.warn("\u8D85\u8FC7\u8FED\u4EE3\u6B21\u6570",ne.IterationNum),this.getResult();}runOnce(){return this.onIteration(),this.getResult();}combineToNode(r,e,t){r&&e?(t.addChild(r),t.addChild(e)):console.error(r===null||r===void 0?void 0:r.name,e===null||e===void 0?void 0:e.name,this.m_dictCurNode,r,e),this.deleteContains(r),this.deleteContains(e),delete this.m_dictCurNode[r.name],delete this.m_dictCurNode[e.name],this.m_dictCurNode[t.name]=t;let n=t.getFlatChild();for(let i of n)this.recordContains(i,t);}combineToFirst(r,e){if(r&&e){let n=e.getFlatChild();for(let i of n)r.listChild.indexOf(i)<0&&r.listChild.push(i);}else console.error(r===null||r===void 0?void 0:r.name,e===null||e===void 0?void 0:e.name,this.m_dictCurNode,r,e);this.deleteContains(e),delete this.m_dictCurNode[e.name];let t=r.getFlatChild();for(let n of t)this.recordContains(n,r);}getResult(){let r=[];for(let e of Object.values(this.m_dictCurNode)){let t=e.getResult();t instanceof Array&&t.length<=0||r.push(t);}return r;}},jy=class extends Am{constructor(){super(...arguments),this.speed=new F(0,0);}move(r){this.bBox&&(this.bBox=new ye(this.bBox.minX+r.x,this.bBox.maxX+r.x,this.bBox.minY+r.y,this.bBox.maxY+r.y));}},FG=class extends Cm{constructor(){super(...arguments),this.m_dictCombine={};}init(r){for(let e of r){let t=new jy();t.addChild(e),this.recordContains(e,t),this.m_dictCurNode[t.name]=t;}}onIteration(){this.doAllNode();}doAllNode(){let r=[];for(let e of Object.values(this.m_dictCurNode)){if(e.name in this.m_dictCombine)continue;let t=e.getFlatChild(),n=this.m_funSearchChild(t);if(n.length<=0)continue;e.bBox||(e.bBox=this.m_funGetBox(t));for(let h of n){let d=this.m_dictContains[h];if(!d)continue;let f=Object.values(d);if(!(f.length<=0))for(let p of f)r.indexOf(p)<0&&r.push(p);}let i=new F(0,0),s=Math.min(e.bBox.width(),e.bBox.height())/Math.max(e.bBox.width(),e.bBox.height()),o=1/e.bBox.area()*s,a;for(let h of r){if(h.name===e.name||h.name in this.m_dictCombine)continue;h.bBox||(h.bBox=this.m_funGetBox(h.getFlatChild()));let d=Math.min(h.bBox.width(),h.bBox.height())/Math.max(h.bBox.width(),h.bBox.height());if(a=new jy(),h.bBox.intersection1(e.bBox)&&s>=ne.AreaRate&&d>=ne.AreaRate){this.combineToNode(e,h,a),a.bBox=ye.extend2(e.bBox,h.bBox),this.m_dictCombine[e.name]=e,this.m_dictCombine[h.name]=e;break;}let f=h.bBox.center().sub(e.bBox.center()),p=1/h.bBox.area()*d,m=o+p,g=ne.AttractG*(m/f.length());if(g)try{i=i.add(f.normalize().mul(g));}catch{}}if(a&&ne.DrawAttract&&ne.drawBBox(a.bBox),e.name in this.m_dictCombine||!o)continue;let l=i.mul(1/o),u=.016;e.speed=e.speed.add(l.mul(u));let c=e.speed.mul(u);e.move(c),ne.DrawAttract&&ne.drawBBox(e.bBox);}}},Zy=class extends Am{},qG=(_class14=class ba extends Cm{constructor(){super(...arguments),this.m_dictSeparate={};}static getEmpireKey(){return ba.IncreaseEmpire+=1,"E"+ba.IncreaseEmpire;}init(e){for(let t of e){let n=new Zy();n.addChild(t),this.recordContains(t,n),this.m_dictCurNode[n.name]=n;}}onIteration(){if(ba.Debug&&console.log("\u5F00\u59CB\u4F18\u5316\u524D",this.m_dictCurNode),Object.keys(this.m_dictCurNode).length<=1){console.warn("\u9000\u51FA\u8FED\u4EE3\uFF1A\u53EA\u67091\u4E2A\u5E1D\u56FD");return;}let e={};for(let o of Object.keys(this.m_dictCurNode)){let a=this.m_dictCurNode[o],l=a.value;l===void 0&&(l=this.m_funGetCurValue(a.getResult()),a.value=l),e[l]||(e[l]=[]),e[l].push(o);}let t=Object.keys(e);t.sort((o,a)=>parseInt(o)-parseInt(a));let n=t[0],i=e[n];if(i.length<=0){ne.LogEmpire&&console.warn("\u9000\u51FA\u8FED\u4EE3\uFF1A\u6CA1\u6709\u6B96\u6C11\u5730");return;}let s=[];for(let o of i)s.push(this.m_dictCurNode[o]);for(let o of s){if(o.name in this.m_dictSeparate)continue;let a=2**32,l="None",u=[],c=o.getFlatChild(),h=this.m_funSearchChild(c);h.length<=0&&(this.m_dictSeparate[o.name]=1),ne.LogEmpire&&console.log("\u5904\u7406\u6B96\u6C11\u5730",o,c,h);for(let m of h){let g=this.m_dictContains[m];if(!g)continue;let b=Object.values(g);if(!(b.length<=0))for(let y of b)u.indexOf(y)<0&&u.push(y);}ba.Debug&&console.log("\u641C\u7D22\u90BB\u5C45",h,this.m_dictContains,"\u5F85\u6D4B\u8BD5\u5E1D\u56FD\u90BB\u5C45",u);for(let m of u){if(m.name===o.name)continue;let g=this.m_funCalCombineCost(o.getResult(),m.getResult());g<=a&&(a=g,l=m.name);}if(l==="None")continue;let d=this.m_dictCurNode[l],f=new Zy();d&&o?(f.addChild(d),f.addChild(o)):console.error(l,this.m_dictCurNode,d,o),this.deleteContains(d),this.deleteContains(o),delete this.m_dictCurNode[d.name],delete this.m_dictCurNode[o.name],ba.Debug&&console.log("\u5408\u5E76\u533A\u5757",l,o.name,"\u521B\u5EFA\u5E1D\u56FD",f.name),this.m_dictCurNode[f.name]=f;let p=f.getFlatChild();for(let m of p)this.recordContains(m,f);}}},_class14.IncreaseEmpire=0,_class14.Debug=!1,_class14),Hy=class extends Am{},zG=class extends Cm{constructor(){super(...arguments),this.m_dictHandle={};}init(r){for(let e of r){let t=new Hy();t.addChild(e),this.recordContains(e,t),this.m_dictCurNode[t.name]=t;}}onIteration(){this.m_dictHandle={};let r=!1;for(let e=0;e<1e4;e++)if(r=this.doCurrentNode(),r)return;}markHandle(r,e){this.m_dictHandle[r.name]=1;}doCurrentNode(){let r=!1,e=[],t=Object.values(this.m_dictCurNode);for(let n of t){if(n.name in this.m_dictHandle)continue;let i=n.getFlatChild();if(i.length>=ne.LocalBestThread){this.markHandle(n,"\u5DF2\u7ECF\u8FBE\u5230\u6700\u5927\u6570\u91CF");continue;}let s=this.m_funSearchChild(i);if(s.length<=0){this.markHandle(n,"\u65E0\u6CD5\u548C\u5468\u56F4\u5408\u5E76");continue;}n.bBox||(n.bBox=this.m_funGetBox(i));for(let a of s){let l=this.m_dictContains[a];if(!l){this.markHandle(n,"\u65E0\u6CD5\u548C\u5468\u56F4\u5408\u5E76");continue;}let u=Object.values(l);if(u.length<=0){this.markHandle(n,"\u65E0\u6CD5\u548C\u5468\u56F4\u5408\u5E76");continue;}for(let c of u)e.indexOf(c)<0&&e.push(c);}let o=!1;for(let a of e){if(a.name===n.name||a.name in this.m_dictHandle||a.getFlatChild().length>=ne.LocalBestThread)continue;a.bBox||(a.bBox=this.m_funGetBox(a.getFlatChild()));let l=Math.min(n.bBox.width(),n.bBox.height())/Math.max(n.bBox.width(),n.bBox.height()),u=Math.min(a.bBox.width(),a.bBox.height())/Math.max(a.bBox.width(),a.bBox.height());if(n.bBox.intersection1(a.bBox)&&l>=ne.AreaRate&&u>=ne.AreaRate){if(o=!0,this.markHandle(a,"\u5408\u5E76\u5230\u4E86\u5F53\u524D\u8282\u70B9"),a.isLeaf())this.combineToFirst(n,a),n.bBox=ye.extend2(n.bBox,a.bBox),i.length>ne.LocalBestThread&&this.markHandle(n,"\u5DF2\u7ECF\u8FBE\u5230\u6700\u5927\u6570\u91CF");else{let c=new Hy();this.combineToNode(n,a,c),c.bBox=ye.extend2(n.bBox,a.bBox);}r=!0;break;}}if(!o){this.markHandle(n,"\u5468\u56F4\u6CA1\u6709\u63A5\u89E6\u70B9");continue;}}return r;}},YG=class extends Yy{},Eh=class Um extends Xy{static permute(e){let t=[];function n(i,s){if(i===s)t.push([...e]);else for(let o=i;o<=s;o++)[e[i],e[o]]=[e[o],e[i]],n(i+1,s),[e[i],e[o]]=[e[o],e[i]];}return n(0,e.length-1),t;}static permuteNum(e){let t=[];function n(i,s){if(i===s)t.push([...e]);else for(let o=i;o<=s;o++)[e[i],e[o]]=[e[o],e[i]],n(i+1,s),[e[i],e[o]]=[e[o],e[i]];}return n(0,e.length-1),t;}static permuteString(e){let t=[];function n(i,s){if(i===s)t.push([...e]);else for(let o=i;o<=s;o++)[e[i],e[o]]=[e[o],e[i]],n(i+1,s),[e[i],e[o]]=[e[o],e[i]];}return n(0,e.length-1),t;}static shuffleTime(e,t){if(e.length<=4)return this.permuteString(e);let n=[];for(let i=0;i<t;i++)n.push(this.shuffle(e));return n;}static shuffle(e){let t=[...e],n=t.length;for(let i=n-1;i>0;i--){let s=Math.floor(Math.random()*(i+1));[t[i],t[s]]=[t[s],t[i]];}return t;}init(e){let t=[];for(let i of e){let s=new YG();s.addChild(i),t.push(s);}let n=Um.permute(t);for(let i of n)this.m_dictSolution[ne.getOptimizeKey()]=i;}onIteration(){let e=4294967296;for(let t of Object.values(this.m_dictSolution)){ne.TotalCalNum+=1;let n=this.getResult(t),i=this.m_funCalTotal(n);i<=e&&(e=i,this.m_listFinalNode=t);}}static optimize(e,t){let n=4294967296,i=Um.permute(e),s=e;for(let o of i){ne.TotalCalNum+=1;let a=t(o);a<=n&&(n=a,s=o);}return s;}},XG=class{constructor(r,e){this.index=r,this._bbox=e;}bbox(){return this._bbox;}},VG=class h2{constructor(e,t,n){this.dictChild={},this.listItem=[],this.bBox=null,this.parent=null,this.capacity=e,this.maxLevel=t,this.bBox=n;}split(){if(this.listItem.length<=0||this.listItem.length<=this.capacity||this.level>=this.maxLevel)return;let e=this.bBox.center(),t=this.bBox.width(),n=this.bBox.height(),i=(s,o)=>{let a=e.add(new F(t/2*s,n/2*o)),l=Math.min(a.x,e.x),u=Math.min(a.y,e.y),c=Math.max(a.x,e.x),h=Math.max(a.y,e.y),d=new ye(l,c,u,h),f=new h2(this.capacity,this.maxLevel,d);f.level=this.level+1,f.parent=this;let p=s+"_"+o;this.dictChild[p]=f;};for(let s of this.listItem){let o=s.bbox().center().sub(e),a=o.x/Math.abs(o.x),l=o.y/Math.abs(o.y);a||(a=-1,Math.random()>.5&&(a=1)),l||(l=-1,Math.random()>.5&&(l=1));let u=a+"_"+l;u in this.dictChild||i(a,l),this.dictChild[u].insert([s]);}for(let s of Object.values(this.dictChild))s.split();this.listItem=[];}insert(e){for(let t of e)this.listItem.push(t);}},Ky=class ya{constructor(e){this.capacity=e;}build(e){let t=e[0].bbox();for(let n=1;n<e.length;n++){let i=e[n];t=ye.extend2(t,i.bbox());}this.root=new VG(this.capacity,100,t),this.root.level=1,this.root.insert(e),this.root.split();}static createNode(e,t,n){let i=e.UL(),s=e.width()/t,o=e.height()/t,a=~~(n/t),l=n-a*t,u=i.x+l*s,c=i.y-(a+1)*o,h=u+s,d=c+o;return new ye(u,h,c,d);}static ocTreeSplitNode(e,t,n,i,s=2){if(e.length<=n)return e;let o=[],a=s**2,l=new Array(a),u=new Array(a);for(let f=0;f<a;f++)l[f]=new Array(e.length),u[f]=0;let c=t.UL(),h=t.width()/s,d=t.height()/s;for(let f of e){let p=i(f).center(),m=~~((p.x-c.x)/h),g=~~((c.y-p.y)/d)*s+m;try{l[g][u[g]]=f,u[g]+=1;}catch{o.push(f);}}for(let f=0;f<l.length;f++){let p=u[f];if(p<=0)continue;let m=l[f].slice(0,p);if(m.length===e.length)return e;let g=ya.createNode(t,s,f),b=ya.ocTreeSplitNode(m,g,n,i,s);if(b.length===e.length)return e;o.push(b);}return o;}static ocTreeSplitNodeMinIntersect(e,t,n,i){let s=[];if(e.length<=n)return e;let o=3,a=t.LL(),l=t.UR(),u=t.width()/(o+1),c=t.height()/(o+1),h=-(2**32),d=[],f=[];for(let p=1;p<=o;p++)for(let m=1;m<=o;m++){let g=a.x+u*p,b=a.y+c*m,y=[[],[],[],[]],v=new Array(4),E=new Array(4);E[0]=new ye(a.x,g,b,l.y),E[1]=new ye(g,l.x,b,l.y),E[2]=new ye(a.x,g,a.y,b),E[3]=new ye(g,l.x,a.y,b);for(let C of e){let L=i(C).center(),S=-1,T=-1;L.x===g?S=Math.random()>=.5?1:-1:L.x>g?S=1:L.x<g&&(S=-1),L.y===b?T=Math.random()>=.5?1:-1:L.y>b?T=1:L.y<b&&(T=-1),S===1&&T===1?y[1].push(C):S===1&&T===-1?y[3].push(C):S===-1&&T===-1?y[2].push(C):S===-1&&T===1&&y[0].push(C);}for(let C=0;C<4;C++){let L=y[C];if(L.length<=0)continue;let S=new ke();for(let T of L)S.ext1(i(T));v[C]=S.build1();}let P=0,M=0;for(let C of v)C&&(P+=C.area());M=P;let I=(C,L)=>{if(!v[C]||!v[L])return 0;let S=v[C].intersection1(v[L]);return S?S.area():0;};M-=I(0,1),M-=I(0,2),M-=I(0,3),M-=I(1,2),M-=I(1,3),M-=I(2,3),M/P>=h&&(d=y,f=E);}for(let p=0;p<d.length;p++){let m=d[p];if(m.length<=0)continue;let g=f[p],b;if(m.length===e.length?b=ya.ocTreeSplitNode(m,g,n,i):b=ya.ocTreeSplitNodeMinIntersect(m,g,n,i),b.length===e.length)return e;s.push(b);}return s;}static ocTreeSplit(e,t,n,i){return ya.ocTreeSplitNode(e,t,n,i,ne.OcTreeSplitStep);}},Qy=class{constructor(r){this.bheap=new Array(),this.count=0,this.comp=r;}size(){return this.count;}add(r){this.count>0?this.siftUp(this.count,r):this.bheap[0]=r,this.count++;}remove(r){let e=this.bheap.indexOf(r);e>-1&&(this.bheap.splice(e,1),this.count--),this.count<0&&(this.count=0);}poll(){for(;;)if(this.count>0){this.count--;let r=this.bheap[0];return this.count>0&&this.siftDown(0,this.bheap[this.count]),r;}else return null;}siftUp(r,e){for(;r>0;){let t=r-1>>>1,n=this.bheap[t];if(this.comp(e,n)>=0)break;this.bheap[r]=n,r=t;}this.bheap[r]=e;}siftDown(r,e){let t=this.count>>>1;for(;r<t;){let n=(r<<1)+1,i=this.bheap[n],s=n+1;if(s<this.count){let o=this.bheap[s];this.comp(i,o)>0&&(n=s,i=o);}if(this.comp(e,i)<=0)break;this.bheap[r]=i,r=n;}this.bheap[r]=e;}},Jy=class Ch{static createNode(e,t,n,i){let s=e.UL();if(n){let o=e.width()/t,a=s.x+i*o,l=a+o;return new ye(a,l,e.minY,e.maxY);}else{let o=e.height()/t,a=s.y-(i+1)*o,l=a+o;return new ye(e.minX,e.maxX,a,l);}}static kdTreeSplitNode(e,t,n,i,s,o,a=2){if(e.length<=n)return e;let l=[],u=a,c=new Array(u),h=new Array(u);for(let f=0;f<u;f++)h[f]=new Array(e.length),c[f]=0;let d=t.UL();if(i){let f=t.width()/a;for(let p of e){let m=~~((s(p).center().x-d.x)/f);try{h[m][c[m]]=p,c[m]+=1;}catch{l.push(p);}}}else{let f=t.height()/a;for(let p of e){let m=s(p).center(),g=~~((d.y-m.y)/f);try{h[g][c[g]]=p,c[g]+=1;}catch{l.push(p);}}}for(let f=0;f<h.length;f++){let p=c[f];if(p<=0)continue;let m=h[f].slice(0,p);if(m.length===e.length)return e;let g=Ch.createNode(t,a,i,f),b=Ch.kdTreeSplitNode(m,g,n,i,s,o,a);if(b.length===e.length)return e;l.push(b);}return l;}static kdTreeSplit(e,t,n,i,s,o){return Ch.kdTreeSplitNode(e,t,n,i,s,o,ne.KDTreeSplitStep);}},WG=(_class15=class Or{static getGridId(e,t){return`${e}_${t}`;}static getVecGrid(e){let t=e.split("_");return new F(parseInt(t[0]),parseInt(t[1]));}static initGrid(e,t){Or.dictGridKey2Group={},Or.dictGroupKey2Grid={};let n=ne.UnionSplitGridSize,i=new ke();for(let o of e){let a=t(o);i.ext1(a);}let s=i.build1();Or.posStart=s.UL();for(let o of e){let a=t(o),l=~~((a.minX-Or.posStart.x)/n),u=~~((a.maxX-Or.posStart.x)/n),c=~~((Or.posStart.y-a.minY)/n),h=~~((Or.posStart.y-a.maxY)/n),d=[];for(let f=l;f<=u;f++)for(let p=h;p<=c;p++){let m=Or.getGridId(f,p);d.push(m),m in this.dictGridKey2Group||(this.dictGridKey2Group[m]=[]),this.dictGridKey2Group[m].push(o);}this.dictGroupKey2Grid[o.toString()]=d;}}static filterTotalContain(e,t){let n=Object.keys(Or.dictGroupKey2Grid),i={},s={};return[];}static release(){Or.dictGridKey2Group={},Or.dictGroupKey2Grid={};}static getGroupConnect(e,t,n){if(e in t)return;t[e]=1,n.push(e);let i=Or.dictGroupKey2Grid[e];for(let s of i){let o=Or.dictGridKey2Group[s];for(let a of o)a in t||Or.getGroupConnect(a,t,n);}}static gridSplit(e,t){Or.initGrid(e,t);let n=[],i={};for(let s of e){let o=[];this.getGroupConnect(s,i,o),o.length>0&&n.push(o);}return n;}},_class15.dictGroupKey2Grid={},_class15.dictGridKey2Group={},_class15),ma=class{constructor(r,e){this.index=r,this._bbox=e;}bbox(){return this._bbox;}},Jae=class{constructor(r,e){this.index=r,this._bbox=e;}bbox(){return this._bbox;}},ele=class extends XG{},$G=class Zr{constructor(e,t=""){this.listChild=[],this.row=0,this.column=0,this.listWidth=[],this.lineNum=0,this.dictGridInfo={},this.dictCostSave={},this.getArrangePolygonType=(n,i)=>{let s=[];for(let o of n)if(Array.isArray(o)){let a=this.getArrangePolygonType(o,i);s=s.concat(a);}else try{let a=i[o].getAllPolygonType();s=s.concat(a);}catch{console.error("\u8F93\u5165\u9519\u8BEF, \u53EF\u80FD\u6CA1\u6709\u4ECE\u4F18\u5316\u8282\u70B9\u4E2D\u62FFgetResult");}return s;},this.tree=e,this.name=ne.getNodeKey();}setPolygon(e){this.polygon=e,this.polygon.name=ne.getPolyTypeKey();}setParent(e,t=!1){if(e!==this){this.parent=e,t||(this.operator=e.operator,e.listChild.push(this),this.dictTotalInfo=e.dictTotalInfo),this.row=e.row+1;for(let n of this.listChild)n!==this&&n.parent!==this&&n.setParent(this,!0);}}readToNode(e){if(e.length<1)return;let t=e[0];switch(t!==void 0&&(this.operator=t),t){case 0:case 1:case 3:case 2:let n=e.slice(1,e.length);if(n.length<=0)return;for(let i of n){let s=new Zr(this.tree);s.setParent(this),Array.isArray(i)?s.readToNode(i):(s.polygon=i,s.polygon.name=ne.getPolyTypeKey(),s.operator=this.operator);}break;default:throw new Error("\u4E0D\u652F\u6301\u5F53\u524D\u5E03\u5C14\u8FD0\u7B97:"+t);}}getTotalWidth(){let e=0;for(let t of this.listWidth)e+=t;return e;}updateWidth(){function e(n){if(!n)return 1;n.listWidth=[];for(let i of n.listChild)n.listWidth.push(e(i));return Math.max(n.getTotalWidth(),1);}e(this);function t(n){if(!n)return 0;if(n.parent){let i=n.parent.listChild.indexOf(n),s=n.parent.column-n.parent.getTotalWidth()/2;for(let o=0;o<i;o++)s+=n.parent.listWidth[o];s+=n.getTotalWidth()/2,n.column=s;}for(let i of n.listChild)t(i);}t(this);}static getNodeListPolygonType(e){let t=[];for(let n of e){let i=n.getAllPolygonType();for(let s of i)t.push(s);}return t;}getAllPolygonType(){if(this.polygon)return[this.polygon];let e=[];for(let t of this.listChild)e=e.concat(t.getAllPolygonType());return e;}evaluateMultiDimension(){let e={};for(let t of this.listChild){let n=t.evaluateMultiDimension();for(let i of Object.keys(n)){e[i]===void 0&&(e[i]=0);let s=e[i]+n[i];e[i]=s;}}if(this.operator===1){let t=[];for(let n=0;n<this.listChild.length;n++){let i=this.listChild[n],s=Zr.getNodeListPolygonType(t),o=Zr.getNodeListPolygonType([i]),a=[];for(let u of t)a.push(u.name);let l=ne.evaluateCostMulti(s,o);t.push(i);for(let u of Object.keys(l)){e[u]===void 0&&(e[u]=0);let c=e[u]+l[u];e[u]=c;}}}return e;}evaluateSingleDimension(){let e=0;for(let t of this.listChild){let n=t.evaluateSingleDimension();e+=n;}if(this.operator===1){let t=[];for(let n=0;n<this.listChild.length;n++){let i=this.listChild[n],s=Zr.getNodeListPolygonType(t),o=Zr.getNodeListPolygonType([i]),a=[];for(let u of t)a.push(u.name);let l=et.evaluateCostSingle(s,o);t.push(i),e+=l;}}return e;}getTotalInfo(){if(this.dictTotalInfo)return this.dictTotalInfo;let e=this.getAllPolygonType();if(e.length<=0)this.dictTotalInfo={name:this.name,area:0,avgArea:0,polygonTypeNum:0,lineNum:0,avgLineNum:0};else{let t=e[0].bbox(),n=0;for(let i=0;i<e.length;i++){i>=1&&(t=ye.extend2(t,e[i].bbox()));let s=et.getPolyTypeLine(e[i]);n+=s.length;}this.dictTotalInfo={name:this.name,area:t.area(),avgArea:t.area()/e.length,polygonTypeNum:e.length,lineNum:n,avgLineNum:n/e.length};}return this.dictTotalInfo;}getGridInfo(e=ne.GridSize){if(Object.keys(this.dictGridInfo).length>0)return this.dictGridInfo;if(ne.markStart("\u7F51\u683C"+this.name),this.polygon){let t=et.getPolyTypeLine(this.polygon);if(this.dictGridInfo=et.createGrid(t,e),ne.DrawGrid)for(let n of Object.keys(this.dictGridInfo)){let i=n.split("_"),s=parseInt(i[0]),o=parseInt(i[1]),a=ne.StartGrid.x+e*s,l=ne.StartGrid.y+e*o;ne.drawBBox(new ye(a-e/2,a+e/2,l-e/2,l+e/2));}}else for(let t of this.listChild){let n=t.getGridInfo(e);for(let i of Object.keys(n))this.dictGridInfo[i]=n[i];}return ne.addMarkTime("\u521D\u59CB\u5316\u7F51\u683C",ne.markEnd("\u7F51\u683C"+this.name)),this.dictGridInfo;}getNodeBBox(){if(this.bBox)return this.bBox;if(this.polygon)return this.bBox=this.polygon.bbox(),this.polygon.bbox();if(!this.listChild||this.listChild.length<=0)return;let e=new ke();this.listChild[0].getNodeBBox();for(let t=0;t<this.listChild.length;t++)e.ext1(this.listChild[t].getNodeBBox());return this.bBox=e.build1(),this.bBox;}getNodeLineNum(){if(this.lineNum)return this.lineNum;if(this.polygon)return this.lineNum=et.getPolyTypeLine(this.polygon).length,this.lineNum;if(!this.listChild||this.listChild.length<=0)return 0;this.lineNum=0;for(let e=1;e<this.listChild.length;e++)this.lineNum+=this.listChild[e].getNodeLineNum();return this.lineNum;}getPos(e){return new F(this.column*ne.PrintGrid,-this.row*ne.PrintGrid).add(e);}print(e){if(this.polygon&&(ne.DrawRect&&ne.drawPolyType(this.polygon,nt.GREEN),ne.DrawRect&&ne.drawText(this.polygon.bbox().UL(),this.polygon.name)),ne.DrawBoolTree){ne.DrawBoolTreeBBox&&(ne.drawBBox(this.getNodeBBox()),ne.drawText(this.getNodeBBox().UL(),this.name));let t=this.name+" "+ne.translate(this.operator);this.polygon&&(t+=this.polygon.name);let n=this.getPos(e);if(ne.drawText(n,t),this.parent){let i=this.parent.getPos(e),s=new q(i,n),o=new Array();o.push(s);let a=Me.build1(Wc(o));ne.drawPolyType(a,nt.GREEN);}}for(let t of this.listChild)t.print(e);}optimizeSplit(){if(this.operator===2&&this.listChild.length>2){let e=this.listChild[0],t=this.listChild.slice(1),n=new Zr(this.tree,"\u51CF\u64CD\u4F5C\u53F3\u8282\u70B9");n.operator=1;for(let i of t)i.setParent(n);this.listChild=[],e.setParent(this),n.setParent(this);}if(this.listChild.length>ne.LocalBestThread)switch(ne.SplitType){case"RTree":this.RTreeSplit();break;case"OcTree":this.OcTreeSplit();break;case"KDTree":this.KDTreeSplit();break;default:break;}for(let e of this.listChild)e.optimizeSplit();}optimizeRandom(e){for(let t of this.listChild)t.optimizeRandom(e);if(ne.NoOptimizePureTreeNode){let t=!1;for(let n of this.listChild)if(n.polygon){t=!0;break;}if(!t)return;}if(this.operator===1)switch(ne.TotalNodeNum+=1,ne.OptimizeType){case"Force":this.optimizeByForce();break;case"SA":this.optimizeBySA();break;case"Calculate":this.optimizeByCalculate(e);break;case"SACalculate":this.optimizeBySACalculate(e);break;default:break;}}optimizeByForce(){let e=[],t=[],n=this.listChild;if(n.length>1)for(let o=0;o<n.length;o++){let a=n[o],l=!1;for(let u of n)if(a.name!==u.name&&a.getNodeBBox().isIntersect(u.getNodeBBox())){l=!0;break;}l?e.push(o):t.push(o);}else for(let o=0;o<n.length;o++)e.push(o);let i=o=>{let a=o.join("_");if(a in this.dictCostSave)return this.dictCostSave[a];let l=0,u=[],c="";for(let h=0;h<o.length;h++){let d=o[h];h===0?c+=d:c=c+"_"+d;let f=n[d];if(c in this.dictCostSave)l+=this.dictCostSave[c];else{let p=0;switch(ne.EvaluateType){case"BBox":p=et.evaluateCostNodeListBBox(u,f);break;case"Grid":p=et.evaluateCostNodeListGrid(u,f);break;case"Combo":p=et.evaluateCostNodeListCombo(u,f);break;default:break;}this.dictCostSave[c]=p,l+=p;}u.push(f);}return this.dictCostSave[a]=l,l;},s=Eh.optimize(e,i);this.listChild=[];for(let o of s)this.listChild.push(n[o]);for(let o of t)this.listChild.push(n[o]);}optimizeBySA(){let e=[],t=[],n=this.listChild;if(n.length>1)for(let s=0;s<n.length;s++){let o=n[s],a=!1;for(let l of n)if(o.name!==l.name&&o.getNodeBBox().isIntersect(l.getNodeBBox())){a=!0;break;}a?e.push(s):t.push(s);}else for(let s=0;s<n.length;s++)e.push(s);this.listChild=[];let i=s=>{let o=s.join("_");if(o in this.dictCostSave)return this.dictCostSave[o];let a=0,l=[],u="";for(let c=0;c<s.length;c++){let h=s[c];c===0?u+=h:u=u+"_"+h;let d=n[h];if(u in this.dictCostSave)a+=this.dictCostSave[u];else{let f=0;switch(ne.EvaluateType){case"BBox":f=et.evaluateCostNodeListBBox(l,d);break;case"Grid":f=et.evaluateCostNodeListGrid(l,d);break;case"Combo":f=et.evaluateCostNodeListCombo(l,d);break;default:break;}this.dictCostSave[u]=f,a+=f;}l.push(d);}return this.dictCostSave[o]=a,a;};if(e.length>=3){let s;if(e.length===3||e.length===4)s=Eh.optimize(e,i);else{let o=ne.Temperature,a=ne.CoolingRate;s=wh.optimize(e,o,a,i);}for(let o of s)this.listChild.push(n[o]);for(let o of t)this.listChild.push(n[o]);}else this.listChild=n;}optimizeByCalculate(e){if(this.polygon)return;let t=new Qy((i,s)=>{let o=et.getPolyTypeLine(i.polygon).length,a=et.getPolyTypeLine(s.polygon).length;return o-a;});for(let i of this.listChild)i.polygon?t.add(i):console.error("\u5B58\u5728\u6811\u8282\u70B9");if(t.size()<=0){console.error("\u5168\u662F\u6811\u8282\u70B9");return;}for(;t.size()>1;){let i=t.poll(),s=t.poll(),o=[1,i.polygon,s.polygon],a=An(o,e);if(!a)return;a.name=ne.getPolyTypeKey();let l=new Zr(this.tree);l.setParent(this),l.polygon=a,t.add(l);}let n=t.poll();this.listChild=[],this.polygon=n.polygon;}optimizeBySACalculate(e){if(this.polygon)return;for(let i of this.listChild)i.polygon||console.error("\u5B58\u5728\u6811\u8282\u70B9");this.optimizeBySA();let t=this.getSimplifyRules(),n=An(t,e);n.name=ne.getPolyTypeKey(),this.listChild=[],this.polygon=n;}getListChildName(){let e=[];for(let t of this.listChild)e.push(t.name);return e.join(",");}RTreeSplit(){if(this.operator!==1)return;if(!this.rTreeLocalBest){this.rTreeLocalBest=new vh(ne.LocalBestThread);for(let s=0;s<this.listChild.length;s++){let o=this.listChild[s];this.rTreeLocalBest.insert(new ma(s,o.getNodeBBox()));}this.rTreeLocalBest.flushWhenNeed();}let e=s=>{if(ne.drawBBox(s.bbox()),!(s instanceof ma)&&s.childs)for(let o of s.childs)e(o);};ne.DrawSplitRect&&e(this.rTreeLocalBest.root);let t={},n=this.listChild,i=(s,o)=>{if(!(!s.childs||s.childs.length<=0))if(s.childs[0]instanceof ma){let a=[];for(let l of s.childs){let u=l;if(u.index in t)continue;t[u.index]=1;let c=n[u.index];a.push(c);}for(let l of a)l.setParent(o);}else for(let a of s.childs){let l=new Zr(o.tree,"\u5B50\u8282\u70B9");l.setParent(o),i(a,l);}};this.listChild=[],i(this.rTreeLocalBest.root,this);}OcTreeSplit(){if(this.operator!==1)return;let e=this.listChild;{let t=[];for(let s=0;s<e.length;s++)t.push(s);let n=Ky.ocTreeSplit(t,this.getNodeBBox(),ne.LocalBestThread,s=>e[s].getNodeBBox()),i=(s,o)=>{if(!(s&&s.length<=0))for(let a of s)if(Array.isArray(a)){let l=new Zr(o.tree,"\u5B50\u8282\u70B9");l.setParent(o),i(a,l);}else e[a].setParent(o);};this.listChild=[],i(n,this);}}KDTreeSplit(){if(this.operator!==1)return;let e=this.listChild,t=[];for(let s=0;s<e.length;s++)t.push(s);let n=Jy.kdTreeSplit(t,this.getNodeBBox(),ne.LocalBestThread,!0,s=>e[s].getNodeBBox(),s=>""),i=(s,o)=>{if(!(s&&s.length<=0))for(let a of s)if(Array.isArray(a)){let l=new Zr(o.tree,"\u5B50\u8282\u70B9");l.setParent(o),i(a,l);}else e[a].setParent(o);};this.listChild=[],i(n,this);}EmpireSplit(){let e=this.listChild;this.listChild=[];let t=h=>{let d=[];for(let f of h)if(Array.isArray(f)){let p=t(f);d=d.concat(p);}else{let p=e[f].getAllPolygonType();d=d.concat(p);}return d;},n=(h,d)=>{let f=t(h),p=t(d);return et.evaluateCostSingle(f,p);},i=h=>{let d=t(h);return ne.getPolygonValue(d);},s="\u5EFA\u6811"+this.name;ne.markStart(s),this.rTreeLocalBest=new vh(ne.LocalBestThread);for(let h=0;h<e.length;h++){let d=e[h];this.rTreeLocalBest.insert(new ma(h,d.getNodeBBox()));}this.rTreeLocalBest.flushWhenNeed(),ne.markEnd(s);let o=[];for(let h=0;h<e.length;h++)o.push(h);let a=h=>{let d=[];for(let b of h){let y=e[b];y||console.error("\u4E0D\u662F\u5B50\u8282\u70B9",b),d=d.concat(y.getAllPolygonType());}if(d.length<=0)return[];let f=d[0].bbox();for(let b=1;b<d.length;b++)f=ye.extend2(f,d[b].bbox());let p=f.extendOfSize(Math.min(f.width()*ne.ExtendRate,f.height()*ne.ExtendRate)),m=this.rTreeLocalBest.search(p),g=[];for(let b of m)g.push(b.index);return m.length<=1?[]:g;},l=new qG(this.name,{funSearchChild:a,funGetValue:i,funCalCombineCost:n});l.init(o);let u=l.run(),c=(h,d)=>{for(let f of h)if(Array.isArray(f)){if(f.length<=0)continue;let p=new Zr(this.tree);p.setParent(d),c(f,p);}else e[f].setParent(d);};c(u,this);}AttractSplit(){let e=this.name+"\u5F15\u529B\u62C6\u5206";ne.markStart(e);let t=this.listChild;this.listChild=[];let n=f=>{let p=[];for(let m of f)if(Array.isArray(m)){let g=n(m);p=p.concat(g);}else{let g=t[m].getAllPolygonType();p=p.concat(g);}return p;},i=(f,p)=>{let m=n(f),g=n(p);return et.evaluateCostSingle(m,g);},s=f=>{let p=n(f);return ne.getPolygonValue(p);},o="\u5EFA\u6811"+this.name;ne.markStart(o),this.rTreeLocalBest=new vh(ne.LocalBestThread);for(let f=0;f<t.length;f++){let p=t[f];this.rTreeLocalBest.insert(new ma(f,p.getNodeBBox()));}this.rTreeLocalBest.flushWhenNeed(),ne.markEnd(o);let a=f=>{let p=[];for(let v of f){let E=t[v];E||console.error("\u4E0D\u662F\u5B50\u8282\u70B9",v),p=p.concat(E.getAllPolygonType());}if(p.length<=0)return[];let m=p[0].bbox();for(let v=1;v<p.length;v++)m=ye.extend2(m,p[v].bbox());let g=m.extendOfSize(Math.min(m.width()*ne.ExtendRate,m.height()*ne.ExtendRate)),b=this.rTreeLocalBest.search(g),y=[];for(let v of b)y.push(v.index);return b.length<=1?[]:y;},l=[];for(let f=0;f<t.length;f++)l.push(f);let u=f=>{let p=[];for(let g of f){let b=t[g];b||console.error("\u4E0D\u662F\u5B50\u8282\u70B9",g),p=p.concat(b.getAllPolygonType());}if(p.length<=0)return[];let m=p[0].bbox();for(let g=1;g<p.length;g++)m=ye.extend2(m,p[g].bbox());return m;},c=new FG(this.name,{funSearchChild:a,funGetValue:s,funCalCombineCost:i,funGetBBox:u});c.init(l);let h=c.run(),d=(f,p)=>{for(let m of f)if(Array.isArray(m)){if(m.length<=0)continue;let g=new Zr(this.tree);g.setParent(p),d(m,g);}else t[m].setParent(p);};d(h,this),ne.markEnd(e);}BBoxSplit(){let e=this.name+"BBox";this.listChild.sort((u,c)=>u.getNodeBBox().center().x-c.getNodeBBox().center().x);let t=this.listChild;this.listChild=[];let n="\u5EFA\u6811"+this.name;ne.markStart(n),this.rTreeLocalBest=new vh(ne.LocalBestThread);for(let u=0;u<t.length;u++){let c=t[u];this.rTreeLocalBest.insert(new ma(u,c.getNodeBBox()));}this.rTreeLocalBest.flushWhenNeed(),ne.markEnd(n),ne.markStart(e);let i=[];for(let u=0;u<t.length;u++)i.push(u);let s=u=>{let c=[];for(let m of u){let g=t[m];g||console.error("\u4E0D\u662F\u5B50\u8282\u70B9",m),c=c.concat(g.getAllPolygonType());}if(c.length<=0)return[];let h=c[0].bbox();for(let m=1;m<c.length;m++)h=ye.extend2(h,c[m].bbox());let d=h.extendOfSize(Math.min(h.width()*ne.ExtendRate,h.height()*ne.ExtendRate)),f=this.rTreeLocalBest.search(d),p=[];for(let m of f)p.push(m.index);return f.length<=1?[]:p;},o=u=>{let c=[];for(let d of u){let f=t[d];f||console.error("\u4E0D\u662F\u5B50\u8282\u70B9",d),c=c.concat(f.getAllPolygonType());}if(c.length<=0)return[];let h=c[0].bbox();for(let d=1;d<c.length;d++)h=ye.extend2(h,c[d].bbox());return h;},a=new zG(this.name,{funSearchChild:s,funGetBBox:o});a.init(i);let l=a.runOnce();this.readArrangeResult(l,this,t),ne.markEnd(e);}getArrangeGridInfo(e,t,n){if(e.length<=0)return{};let i={};for(let s of e)if(Array.isArray(s)){let o=this.getArrangeGridInfo(s,t,n);for(let a of Object.keys(o))i[a]=t;}else{let o=n[s];if(!o)console.error("\u8F93\u5165\u9519\u8BEF, \u53EF\u80FD\u6CA1\u6709\u4ECE\u4F18\u5316\u8282\u70B9\u4E2D\u62FFgetResult");else{let a=performance.now(),l=o.getGridInfo();ne.addMarkTime("\u8282\u70B9\u83B7\u53D6\u7F51\u683C",performance.now()-a);let u=performance.now();for(let c in Object.keys(l))i[c]=t;ne.addMarkTime("\u8BBE\u7F6Ekey",performance.now()-u),ne.addMarkTime("\u8282\u70B9\u83B7\u53D6\u7F51\u683C\u603B\u65F6\u95F4",performance.now()-a);}}return i;}readArrangeResult(e,t,n){for(let i of e)if(Array.isArray(i)){if(i.length<=0)continue;let s=new Zr(this.tree);s.setParent(t),this.readArrangeResult(i,s,n);}else n[i].setParent(t);}getSimplifyRules(){if(this.listChild.length<=0)return this.polygon?[this.operator,this.polygon]:[this.operator];{let e=[];for(let t of this.listChild)e.push(t.getSimplifyRules());return[this.operator,...e];}}},jG=class f2{static fromRules(e){ne.LogRule&&console.warn("\u5E03\u5C14\u8FD0\u7B97\u8868\u8FBE\u5F0F",e);let t=new f2();return t.root=new $G(t),t.root.readToNode(e),t;}print(e,t){this.root.updateWidth(),t.print(e),ne.DrawBoolTree&&ne.LogTree&&console.log("\u5E03\u5C14\u8FD0\u7B97\u6811",this);}getSimplifyRules(e){let t=500;if(ne.DrawBoolTree&&this.print(ne.PrintStart.add(new F(0,0)),this.root),ne.EvaluateRaw){ne.markStart("\u539F\u59CB\u8BC4\u4F30");let o=this.root.evaluateMultiDimension();for(let a of Object.keys(o))ne.addEvaluateValue("\u539F\u59CB\u8BC4\u4F30",a,o[a]);ne.markEnd("\u539F\u59CB\u8BC4\u4F30");}ne.UseOptimizeSplit&&(ne.markStart("\u62C6\u5206\u8282\u70B9"),this.root.optimizeSplit(),ne.DrawBoolTree&&this.print(ne.PrintStart.add(new F(t,0)),this.root),ne.addMarkTime("\u5206\u6CBB\u65F6\u95F4",ne.markEnd("\u62C6\u5206\u8282\u70B9"))),ne.UseRandomOptimize&&(ne.markStart("\u968F\u673A\u4F18\u5316"),this.root.optimizeRandom(e),ne.addMarkTime("\u968F\u673A\u4F18\u5316\u603B\u65F6\u95F4",ne.markEnd("\u968F\u673A\u4F18\u5316")),ne.DrawBoolTree&&this.print(ne.PrintStart.add(new F(t*2,0)),this.root));let n=this.root.getSimplifyRules(),i=200,s=new F(0,-i);return ne.PrintStart=ne.PrintStart.add(s),n;}},ZG=class gi{static getPolygonType(e){let t=[];for(let n of e)if(Array.isArray(n)){let i=gi.getPolygonType(n.slice(1));for(let s of i)t.push(s);}else t.push(n);return t;}static simplifyRules(e,t){return ne.UseOptimizeSplit&&(ne.markStart("\u62C6\u5206\u8282\u70B9"),e=this.optimizeSplit(e,t),ne.addMarkTime("\u5206\u6CBB\u65F6\u95F4",ne.markEnd("\u62C6\u5206\u8282\u70B9"))),ne.UseRandomOptimize&&(ne.markStart("\u968F\u673A\u4F18\u5316"),e=this.optimizeRandom(e,t),ne.addMarkTime("\u968F\u673A\u4F18\u5316\u603B\u65F6\u95F4",ne.markEnd("\u968F\u673A\u4F18\u5316"))),e;}static OcTreeOptimizeSplit(e){let t=e[0];if(t!==1||e.length<=ne.LocalBestThread+1)return e;let n=e.slice(1),i=new Array(n.length);for(let u=1;u<e.length;u++)i[u-1]=u;let s=et.getListBBox(n),o=Ky.ocTreeSplit(i,s,ne.LocalBestThread,u=>{let c=e[u];return et.getSingleBBox(c);}),a=(u,c)=>{if(!(u.length<=0))for(let h of u)if(Array.isArray(h)){let d=[c[0]];a(h,d),c.push(d);}else{let d=e[h];c.push(d);}},l=[t];return a(o,l),l;}static KDTreeOptimizeSplit(e,t){let n=e[0];if(n!==1||e.length<=2)return e;let i=e.slice(1),s=new Array(i.length);for(let c=1;c<e.length;c++)s[c-1]=c;let o=et.getListBBox(i),a=Jy.kdTreeSplit(s,o,2,t,c=>{let h=e[c];return et.getSingleBBox(h);},c=>e[c].name),l=(c,h)=>{if(!(c.length<=0))for(let d of c)if(Array.isArray(d)){let f=[h[0]];l(d,f),h.push(f);}else{let f=e[d];h.push(f);}},u=[n];return l(a,u),u;}static optimizeSplit(e,t){let n=e[0];if(n===2){if(ne.HandleDiff){let s=e[1],o;if(Array.isArray(s)){let a=this.optimizeSplit(s,t);if(a.length<=1)return[2];o=An(a,t);}else o=An([2,s],t);if(e.length>3){let a;a=[1];for(let l=2;l<e.length;l++){let u=e[l];if(Array.isArray(u)){let c=et.getListBBox([...u.slice(1)]);et.KeepBBoxPolygonGroup(c,o)&&a.push(u);}else et.KeepBBoxPolygonGroup(u.bbox(),o)&&a.push(u);}return a.length<=1?[2,o]:(a=this.optimizeSplit(a,t),a.length>1?[2,o,...a.slice(1)]:[2,o]);}else{let a=e[2];if(Array.isArray(a)&&a[0]===1&&a.length>2){let l=a.slice(1);return this.optimizeSplit([2,o,...l],t);}}}else if(e.slice(1).length>2){let s=e[1],o=e.slice(2),a=this.optimizeSplit([1,...o],t);return a.length>1?[2,s,...a.slice(1)]:s;}}else if(n===1){let s=[1],o=[],a=[],l=[];if(e.length-1>ne.LocalBestThread){let u=!1;for(let c=1;c<e.length;c++){let h=e[c];if(!Array.isArray(h)){u=!0;break;}}if(u)if(ne.UnionSplitType==="Grid"){let c=e.length;for(let h=1;h<e.length;h++){let d=e[h];if(Array.isArray(d))s.push(d);else{let f=d.bbox(),p=f.width(),m=f.height(),g=6;p>m&&p/m>=g?o.push(d):m>p&&m/p>=g?a.push(d):Math.abs(p-m)<=.1?d.items[0].items.length===1&&d.items[0].items[0].primitives.length===4?s.push(d):l.push(d):s.push(d);}}if(s.length>ne.LocalBestThread&&(s=gi.OcTreeOptimizeSplit(s)),s.length===c)e=s;else if(o.length===c-1)e=[1,...o];else if(a.length===c-1)e=[1,...a];else if(l.length===c-1)e=[1,...l];else{e=[1],s.length>1&&e.push(s);let h=An(e,t,!0);if(e=[1,h],o.length>0){for(let f of o)e.push(f);e=[1,An(e,t,!1)];}a.length>0&&(e.push(...a),h=An(e,t,!1),e=[1,h]),a.length>0&&(e.push(...a),h=An(e,t,!1),e=[1,h]);}}else if(ne.UnionSplitType==="Connect"){let c=new Array(e.length-1);for(let d=1;d<e.length;d++)c[d-1]=d;let h=WG.gridSplit(c,d=>{let f=e[d];return et.getSingleBBox(f);});if(h.length>1){let d=new Array(h.length+1);d[0]=1;for(let f=0;f<h.length;f++){let p=h[f],m=new Array(p.length+1);m[0]=1;for(let g=0;g<p.length;g++){let b=p[g];m[g+1]=e[b];}m=gi.OcTreeOptimizeSplit(m),d[f+1]=m;}return e=d,e;}}else ne.UnionSplitType==="Raw"?e=gi.OcTreeOptimizeSplit(e):ne.UnionSplitType;}}else if(n===0&&e.length<=2)return[0];let i=[n];for(let s=1;s<e.length;s++){let o=e[s];if(Array.isArray(o)){let a=this.optimizeSplit(o,t);if(a.length<=1)continue;i.push(a);}else i.push(o);}return i;}static optimizeBySA(e){let t=e[0];if(e.length<=2)return e;let n={},i={},s={},o,a=d=>{let f=d.join("_");if(f in n)return n[f];let p=0;if(ne.AutoPair){let m=new Array(d.length);for(let g=0;g<d.length;g++)m[g]=d[g];for(;m.length>1;){let g=0,b=[];m.length%2===1?(b.push(m[0]),g=1):g=0;for(let y=g;y<m.length;y+=2){let v=`${m[y]}_${m[y+1]}`,E=0;if(v in n)E=n[v];else if(ne.EvaluateType==="BBox"){E=et.evaluateCostNodeBoolChildByBBox(s[m[y]],s[m[y+1]],o);let P=ye.extend2(s[m[y]],s[m[y+1]]);s[v]=P,n[v]=E;}else ne.EvaluateType==="Combo"&&(E=i[m[y]]*i[m[y+1]],i[v]=E,n[v]=E);p=E+p,b.push(v);}m=b;}n[f]=p;}else{let m=new Array(d.length);for(let g=0;g<d.length;g++)m[g]=d[g];for(;m.length>1;){let g=`${m[0]}_${m[1]}`,b=0;if(ne.EvaluateType==="BBox"){b=et.evaluateCostNodeBoolChildByBBox(s[m[0]],s[m[1]]);let y=ye.extend2(s[m[0]],s[m[1]]);s[g]=y,n[g]=b;}else ne.EvaluateType==="Combo"&&(b=i[m[0]]*i[m[1]],i[g]=b,n[g]=b);if(p=b+p,m.length===2)break;m=[g,...m.slice(2)];}n[f]=p;}return n[f];},l=d=>{if(ne.EvaluateType==="BBox")for(let f=0;f<d.length;f++){let p=e[d[f]],m=et.getSingleBBox(p);o?o=ye.extend2(o,m):o=m,s[d[f].toString()]=m;}else if(ne.EvaluateType==="Combo")for(let f=0;f<d.length;f++){let p=e[d[f]],m=et.getSinglePolyTypeLine(p);i[d[f].toString()]=m.length;}},u=[t],c=ne.Temperature,h=ne.CoolingRate;if(ne.OnlyBBoxTouch){let d=[],f=[];if(e.length>1){for(let p=1;p<e.length;p++){let m=e[p],g=!1;for(let b=1;b<e.length;b++){let y=e[b];if(m===y)continue;let v=et.getSingleBBox(m),E=et.getSingleBBox(y);if(v.isIntersect(E)){g=!0;break;}}g?d.push(p):f.push(p);}if(d.length>0&&f.length>0){let p=[t],m=[t];for(let g of d)p.push(e[g]);for(let g of f)m.push(e[g]);return this.optimizeBySA([t,p,m]);}}else for(let p=1;p<e.length;p++)d.push(p);if(d.length>2){l(d);let p=wh.optimize(d,c,h,a);for(let m of p)u.push(e[m]);for(let m of f)u.push(e[m]);}else u=e;}else{let d=new Array(e.length-1);for(let p=0;p<e.length;p++)p!==0&&(d[p-1]=p);l(d);let f=wh.optimize(d,c,h,a);for(let p of f)u.push(e[p]);}return u;}static optimizeByForce(e){let t=e[0];if(e.length<=2)return e;let n={},i={},s={},o,a=d=>{let f=d.join("_");if(f in n)return n[f];let p=0;if(ne.AutoPair){let m=new Array(d.length);for(let g=0;g<d.length;g++)m[g]=d[g];for(;m.length>1;){let g=0,b=[];m.length%2===1?(b.push(m[0]),g=1):g=0;for(let y=g;y<m.length;y+=2){let v=`${m[y]}_${m[y+1]}`,E=0;if(v in n)E=n[v];else if(ne.EvaluateType==="BBox"){E=et.evaluateCostNodeBoolChildByBBox(s[m[y]],s[m[y+1]],o);let P=ye.extend2(s[m[y]],s[m[y+1]]);s[v]=P,n[v]=E;}else ne.EvaluateType==="Combo"&&(E=i[m[y]]*i[m[y+1]],i[v]=E,n[v]=E);p=E+p,b.push(v);}m=b;}n[f]=p;}else{let m=new Array(d.length);for(let g=0;g<d.length;g++)m[g]=d[g];for(;m.length>1;){let g=`${m[0]}_${m[1]}`,b=0;if(ne.EvaluateType==="BBox"){b=et.evaluateCostNodeBoolChildByBBox(s[m[0]],s[m[1]]);let y=ye.extend2(s[m[0]],s[m[1]]);s[g]=y,n[g]=b;}else ne.EvaluateType==="Combo"&&(b=i[m[0]]*i[m[1]],i[g]=b,n[g]=b);if(p=b+p,m.length===2)break;m=[g,...m.slice(2)];}n[f]=p;}return n[f];},l=d=>{if(ne.EvaluateType==="BBox")for(let f=0;f<d.length;f++){let p=e[d[f]],m=et.getSingleBBox(p);o?o=ye.extend2(o,m):o=m,s[d[f].toString()]=m;}else if(ne.EvaluateType==="Combo")for(let f=0;f<d.length;f++){let p=e[d[f]],m=et.getSinglePolyTypeLine(p);i[d[f].toString()]=m.length;}},u=[t],c=new Array(e.length-1);for(let d=0;d<e.length;d++)d!==0&&(c[d-1]=d);l(c);let h=Eh.optimize(c,a);for(let d of h)u.push(e[d]);return u;}static optimizeByCalculate(e,t){let n=e[0];if(e.length<=2)return e;let i=new Qy((o,a)=>{let l=et.getSinglePolyTypeLine(o).length,u=et.getSinglePolyTypeLine(a).length;return l-u;});for(let o=1;o<e.length;o++){let a=e[o];if(Array.isArray(a)){let l=this.optimizeByCalculate(a,t);i.add(l);}else i.add(a);}for(;i.size()>1;){let o=i.poll(),a=i.poll(),l=An([n,o,a],t);if(!l)return;i.add(l);}let s=i.poll();return[n,s];}static optimizeByPredictCalculate(e,t){let n=e[0];if(e.length<=2)return e;let i={},s={},o={},a,l=h=>{let d=h.join("_");if(d in i)return i[d];let f=0;if(ne.AutoPair){let p=new Array(h.length);for(let m=0;m<h.length;m++)p[m]=h[m];for(;p.length>1;){let m=0,g=[];p.length%2===1?(g.push(p[0]),m=1):m=0;for(let b=m;b<p.length;b+=2){let y=`${p[b]}_${p[b+1]}`,v=0;if(y in i)v=i[y];else if(ne.EvaluateType==="BBox"){if(o[p[b]]){if(!o[p[b+1]])throw console.error(o),new Error(p[b+1]);}else throw console.error(o),new Error(p[b]);v=et.evaluateCostNodeBoolChildByBBox(o[p[b]],o[p[b+1]],a);let E=ye.extend2(o[p[b]],o[p[b+1]]);o[y]=E,i[y]=v;}else ne.EvaluateType==="Combo"&&(v=s[p[b]]*s[p[b+1]],s[y]=v,i[y]=v);f=v+f,g.push(y);}p=g;}i[d]=f;}else{let p=new Array(h.length);for(let m=0;m<h.length;m++)p[m]=h[m];for(;p.length>1;){let m=`${p[0]}_${p[1]}`,g=0;if(ne.EvaluateType==="BBox"){g=et.evaluateCostNodeBoolChildByBBox(o[p[0]],o[p[1]]);let b=ye.extend2(o[p[0]],o[p[1]]);o[m]=b,i[m]=g;}else ne.EvaluateType==="Combo"&&(g=s[p[0]]*s[p[1]],s[m]=g,i[m]=g);if(f=g+f,p.length===2)break;p=[m,...p.slice(2)];}i[d]=f;}return i[d];},u=[],c={};for(let h=1;h<e.length;h++){u.push(h.toString());let d=e[h],f=et.getSingleBBox(d);c[h.toString()]=d,o[h.toString()]=f,a?a=ye.extend2(a,f):a=f;}for(;u.length>1;){let h=Eh.permuteString(u),d=h[0],f=l(d);for(let g=1;g<h.length;g++){let b=h[g],y=l(b);y<=f&&(f=y,d=b);}let p=0,m=[];d.length%2===1?(m.push(d[0].toString()),p=1):p=0;for(let g=p;g<d.length;g+=2){let b=`${d[g]}_${d[g+1]}`;if(!(b in c)){let y=[n,c[d[g]],c[d[g+1]]];ne.DrawSeek&&new Vy(t).drawBbox(a,nt.RED);let v=An(y,t);c[b]=v,o[b]=et.getSingleBBox(v);}m.push(b);}u=m;}return[n,c[u[0]]];}static optimizeRandom(e,t){let n=e[0],i=e.slice(1),s=[n];for(let o of i)if(Array.isArray(o)){let a=gi.optimizeRandom(o,t);s.push(a);}else s.push(o);if(ne.NoOptimizePureTreeNode){let o=!0;for(let a of i)if(Array.isArray(a)){o=!1;break;}if(!o)return s;}if(n===1)switch(ne.TotalNodeNum+=1,ne.OptimizeType){case"Force":s=gi.optimizeByForce(s);break;case"SA":s=gi.optimizeBySA(s);break;case"Calculate":s=gi.optimizeByCalculate(s,t);break;case"PredictCalculate":s=gi.optimizeByPredictCalculate(s,t);break;default:break;}return s;}},ei=(r=>(r[r.INTERSECT=0]="INTERSECT",r[r.UNION=1]="UNION",r[r.DIFF=2]="DIFF",r[r.XOR=3]="XOR",r))(ei||{}),Mm=new ye(466,476,-509,-501);function HG(r){for(let e=1;e<r.length;e++){let t=r[e];if(Array.isArray(t)){if(HG(t))return!0;}else if(t instanceof Me){if(Mm.isContainsBBox(t.bbox()))return!0;}else if(t instanceof Ht){for(let n of t.items)if(Mm.isContainsBBox(n.bbox()))return!0;}else for(let n of t.items)for(let i of n.items)if(Mm.isContainsBBox(i.bbox()))return!0;}return!1;}function $l(r){let e=r[0],t=[e];switch(e){case 0:for(let i=1;i<r.length;i++){let s=r[i];if(Array.isArray(s)&&(s=$l(s),!s))return null;t.push(s);}break;case 1:case 3:for(let i=1;i<r.length;i++){let s=r[i];Array.isArray(s)&&(s=$l(s),!s)||t.push(s);}break;case 2:let n=r[1];if(Array.isArray(n)&&(n=$l(n),!n))return null;t.push(n);for(let i=2;i<r.length;i++){let s=r[i];Array.isArray(s)&&(s=$l(s),!s)||t.push(s);}break;default:throw new Error("not support boolean rule!");}return t.length===1?null:t;}function Tm(r,e,t){return Array.isArray(r)?e2(r,e,t):r;}function Rm(r,e,t,n,i=!0){if(i)for(;r.length>1;){let s,o=[];for(r.length%2===1?(o.push(r[0]),s=1):s=0;s<r.length;s+=2)o.push(e(r[s],r[s+1],t,n));r=o;}else for(;r.length>1;){if(r.length===2)return e(r[0],r[1],t,n);r=[e(r[0],r[1],t,n),...r.slice(2)];}return r[0];}function e2(r,e,t,n=!0){let i=[];for(let s=1;s<r.length;s++)i.push(Tm(r[s],e,t));switch(r[0]){case 0:return Rm(i,Vl.intersect,e,t);case 1:return Rm(i,Vl.union,e,t);case 2:let s=Rm(i.slice(1),Vl.union,e,t);return s?Vl.diff(i[0],s,e,t):i[0];case 3:let o=Tm(r[1],e,t);for(let a=2;a<r.length;a++)o=Vl.xor(o,Tm(r[a],e,t),e,t);return o;default:throw new Error("not support boolean rule! "+r[0]);}}function t2(r){let e=[r[0]];for(let t=1;t<r.length;t++){let n=r[t];if(Array.isArray(n)){let i=t2(n);Array.isArray(i)?i.length>1&&e.push(i):e.push(i);}else if(n instanceof Me){let i=Ty(n);i&&e.push(ct.build(i));}else n instanceof Ht?e.push(ct.build(n)):e.push(n);}return e;}function yo(r,e){if(ne.curBus=e,r=t2(r),ne.Debug){et.drawRule(r,new F(0,-1500),!0,nt.Gray),ne.getDebug().draw();debugger;}ne.markStart("runBoolean");let t;if(ne.UseRunArrange){if(ne.UseClass){ne.markStart("BoolTree");let n=jG.fromRules(r);ne.addMarkTime("\u7FFB\u8BD1\u65F6\u95F4",ne.markEnd("BoolTree")),t=n.getSimplifyRules(e);}else t=ZG.simplifyRules(r,e);}else t=$l(r);if(t.length<=1)return new ct([]);if(ne.Debug){et.drawRule(t,new F(0,-1500),!0,nt.BLUE),ne.getDebug().draw();debugger;ne.LogCalRules&&console.warn("\u6700\u7EC8\u8BA1\u7B97\u5E03\u5C14\u8868\u8FBE\u5F0F",t),ne.addMarkTime("\u5168\u5C40\u89C4\u5212\u65F6\u95F4",ne.markEnd("runBoolean"));let n=An(t,e);n.name=ne.getPolyTypeKey(),ne.getDebug().clear(),et.drawRule(t,new F(0,-1500),!1,nt.BLUE),ne.drawPolyType(n,nt.GREEN),ne.drawText(new F(0,-1400),"\u7ED3\u679CPolygon:"+n.items.length.toString(),nt.GREEN),ne.getDebug().draw();debugger;return n;}else return An(t,e);}function An(r,e,t=!0){if(!r||r.length===1)return new ct([]);let n=r,i=new UG(),s=[];function o(a){for(let l=1;l<a.length;l++){let u=a[l];Array.isArray(u)?o(u):s.push(u);}}return o(n),i.init(s),e2(n,i,e,t);}function r2(r,e,t){let n=[];return r.forEach(i=>i.forEach(s=>{if(s.hasInter&&!s.isAllInterIsInvalid())return;let o=s.bbox(),a=e.search(o.extendOfSize(De)).filter(l=>l.bbox().extendOfSize(De).isContainsBBox(o)).sort((l,u)=>l.bbox().area()-u.bbox().area());for(let l of a)if(l.isContain(s)){t(!s.isOutside,l.isOutside)!==t(s.isOutside,l.isOutside)&&n.push(s);return;}t(s.isOutside,!1)!==t(!s.isOutside,!1)&&n.push(s);})),n;}function KG(r,e,t){let n;switch(t){case 0:n=(a,l)=>a&&l;break;case 1:n=(a,l)=>a||l;break;case 2:n=(a,l)=>a&&!l;break;case 3:n=(a,l)=>a&&!l||!a&&l;break;default:throw Error("not support the rule");}let i=new mh(10),s=new mh(10);r.forEach(a=>a.forEach(l=>i.add(l))),e.forEach(a=>a.forEach(l=>s.add(l)));let o=r2(r,s,n);return r2(e,i,(a,l)=>n(l,a)).forEach(a=>o.push(a)),o;}var QG=class{constructor(r){this.roots=[],this.nodes=r.sort((e,t)=>e.bbox().minX-t.bbox().minX).map(e=>new JG(e)),this.nodes.forEach((e,t)=>{e.visit()&&(this.roots.push(e),this.build(t));});}build(r){let e=this.nodes[r];for(let t=r+1,n=this.nodes.length;t<n;t++){let i=this.nodes[t];if(e.key.bbox().maxX<i.key.bbox().minX)break;i.getIsVisit()||e.isContain(i)&&(i.visit(),e.addChild(i),this.build(t));}}getPolygons(){let r=[];return this.roots.forEach(e=>e.getPolygons().forEach(t=>r.push(t))),r;}},JG=class{constructor(r){this.children=[],this.isVisit=!1,this.key=r;}getIsVisit(){return this.isVisit;}isContain(r){return this.key.isContain(r.key);}addChild(r){this.children.push(r);}getPolygons(){let r=[];return this.getPolylineList(r),r.map(e=>{let t=e[0].polygon;if(t&&t.items.length===e.length){let n=e.map(s=>s.returnPolyline()),i=new Set(t.items);return n.some(s=>!i.has(s))?new Ht(n):t;}else return new Ht(e.map(n=>n.returnPolyline()));});}getPolylineList(r,e){e?(e.push(this.key),e=null):(e=[this.key],r.push(e)),this.children.forEach(t=>t.getPolylineList(r,e));}visit(){return this.isVisit?!1:(this.isVisit=!0,!0);}};function Nr(r,e,t,n){function i(){if(!n)return;let c=n.initColor(nt.Golden);c.addPt(s),c.addPoint(s.end()),n.initColor(nt.RED).addPt(o),n.draw();debugger;}let s=r.getShape(),o=t?e.getShape():e.getShape().reverse(),a=ot(s,o.start()),l=ot(o),u=a.cross(l);if(Gi(u,0)||Gi(Math.abs(a.dot(l)),1)){if(s instanceof q){if(o instanceof q){if(ue.eq(u,0)&&(a.dot(l)>0?!Fe(s.end(),o.start()):!Fe(s.start(),o.start())))throw i(),new Error("line and line");return u<0;}else{if(o instanceof ee)return a.cross(o.center.sub(s.start()))<0;if(o instanceof Ce){let c=o.getExtremePoints(s),h=c.length?c[0]:bs(o.controls,s.start());return a.cross(h.sub(s.start()))<0;}else throw new Error("not support");}}else if(s instanceof ee){if(o instanceof q)return s.isCCW;if(o instanceof ee){if(o.center.equals1(s.center)&&(a.dot(l)>0?!Fe(s.end(),o.start())&&s.end().sub(o.start()).dot(l)>0:!Fe(s.start(),o.start())&&s.start().sub(o.start()).dot(l)>0))throw i(),new Error("arc and arc");return o.rx>=s.rx||o.center.distance2(s.center)>s.rx2?s.isCCW:!s.isCCW;}else throw new Error("not support");}else if(s instanceof Ce){if(o instanceof q){let c=s.getPercent(o.start(),De),h=s.clip(c)[1],d=h.getExtremePoints(o);return(d.length?d[0]:bs(h.controls,o.start())).sub(o.start()).cross(l)<0;}else if(o instanceof Ce){let c=s.getPercent(o.start(),De),h=s.clip(c)[1],d=h.getExtremePoints(new q(o.start(),o.end())),f=o.getExtremePoints(new q(h.start(),h.end())),p=d.length?d[0]:bs(h.controls,o.start()),m=f.length?f[0]:bs(o.controls,o.start()),g=p.sub(o.start()),b=m.sub(o.start());return g.cross(b)<0;}else throw Error("not support");}else throw new Error("not support");}else return u<0;}function ys(r,e,t,n,i){let s=r.getShape(),o=e.getShape(),a=s instanceof ee?fi(s,Xe.toRadians(s.endAngle())):s instanceof Ce?rh(s,1):s.end().sub(s.start()).normalize(),l=ot(o),u=a.dot(l);if(Gi(u,-1))return Nr(r,e,!0,i)?Nr(r,t,n,i)&&Nr(e,t,n,i):Nr(r,t,n,i)||Nr(e,t,n,i);{let c=a.scale(-1).angle(F.ORIGIN),h=l.angle(F.ORIGIN);c>h&&(c-=hm);let d=(c+h)/2,f=new F(Math.cos(d),Math.sin(d)),p=n?t.getShape():t.getShape().reverse(),m=ot(p);return f.cross(m)<0?Nr(r,t,n,i):Nr(e,t,n,i);}}var e6=(r=>(r[r.NOT_IN=0]="NOT_IN",r[r.IS_IN=1]="IS_IN",r[r.IS_OVERLAP=2]="IS_OVERLAP",r))(e6||{}),t6=(r=>(r[r.AllClear=0]="AllClear",r[r.MapClear=1]="MapClear",r))(t6||{}),pi;function Yi(r,e,t,n,i,s=t.side===e,o=!0,a){let l=new Map();return pi=i,n2(i2(r,e,o,a,l,t,s,n),t,s,n,0);}function jl(r,e,t,n,i,s,o=n.side===t){pi=i;let a=s2(r,e,t,new Map(),n,o,s),l=a instanceof Array?-1:1;return n2(a,n,o,s,l);}function n2(r,e,t,n,i){for(;r instanceof Array;)i++,r.length===4?r=s2(...r,e,t,n):r=i2(...r,e,t,n);return{...r,existOverlap:i>0};}function i2(r,e,t,n,i,s,o,a){if(Ph===-1){a.initColor(nt.RED).addPt(r.getShape()),a.initColor(nt.Golden).addPt(e.getShape()),a.draw();debugger;}let l=r.getShape(),u=o?e.getShape().reverse():e.getShape(),c=(l instanceof ee?fi(l,t?u.start().angle(l.center):n?Xe.toRadians(l.endAngle()):void 0):l instanceof Ce?ot(l,t?u.start():n?l.end():l.start()):l.end().sub(l.start())).normalize(),h=(u instanceof ee?fi(u,t?void 0:(n?l.end():l.start()).angle(u.center)):u instanceof Ce?ot(u,t?void 0:n?l.end():l.start()):u.end().sub(u.start())).normalize();if(n===void 0){let f=c.dot(h);if(Gi(f,0))return{state:Nr(r,e,!o,a)?1:0,inter:Xi(r,e,s,o,t,n,i)};n=f<0;}else if(n?c.dot(h)>0:c.dot(h)<0)return t?{state:Nr(r,e,!o,a)?1:0,inter:Xi(r,e,s,o,t,n,i)}:n?{state:Nr(r,r.nextSide,!0,a)?0:1,inter:Xi(r,e,s,o,t,n,i),isReversed:!0}:{state:Nr(r.prevSide,r,!0,a)?0:1,inter:Xi(r,e,s,o,t,n,i),isReversed:!0};let d;if(t?d=aa(n?l.reverse():l,u):(d=aa(u,n?l.reverse():l),d===0||d===1?d=d===0?1:0:(d===3||d===4)&&(d=d===3?4:3)),d===1||d===2){let f=o?e.prevSide:e,p=f.inters,m=f.getEnd();for(let g=p.length-1;g>=0;g--){let b=p[g];if(!Fe(m,b.coord))break;if(b===s)return{state:2,inter:Xi(r,e,s,o,t,n,i)};}}if(d===3||d===4)return{state:d===(n?4:3)?1:0,inter:Xi(r,e,s,o,t,n,i)};if(i.has(r)?i.get(r).mapSideList.push(e):i.set(r,{sideIsReversed:n,mapSideList:[e]}),i.has(e)?i.get(e).mapSideList.push(r):i.set(e,{sideIsReversed:o,mapSideList:[r]}),d===2)return n?[r.prevSide,r,o?e.prevSide:e.nextSide,i]:[r,r.nextSide,o?e.prevSide:e.nextSide,i];if(d===0)return[n?r.prevSide:r.nextSide,e,!1,n,i];if(d===1)return[r,o?e.prevSide:e.nextSide,!0,n,i];throw Error("not support");}function Xi(r,e,t,n,i,s,o){let a=r.getShape(),l=n?e.getShape().reverse():e.getShape(),u=n;if(!i){let f=e;e=r,r=f,n=s,t=t.getBindedInter();}let c=f=>!(i?s:u)&&Fe(f,r.prevSide.getEnd())?r.prevSide:r;if(n){let f=e.inters;for(let p=0;p<f.length;p++){let m=f[p];if(m.isInvalid&&s===void 0)continue;if(m===t&&Fe(l.start(),t.coord))return i?m:m.getBindedInter();let g=m.getBindedInter().side,b=c(m.coord);if(g===b&&h(m))return d(m);}for(;;){e=e.nextSide;let p=e.inters;for(let m=0;m<p.length;m++){let g=p[m];if(g===t)return i?g:g.getBindedInter();if(o.has(e)){if(Fe(g.coord,g.getBindedInter().side.getEnd())){let b=g.getBindedInter().side;if(e.getEnd().sub(e.getStart()).normalize().dot(b.getEnd().sub(b.getStart()))<0){if(o.get(e).mapSideList.includes(g.getBindedInter().side.nextSide))return d(g);continue;}}if(o.get(e).mapSideList.includes(g.getBindedInter().side))return d(g);}else if(g.side===t.side&&h(g))return d(g);}}}else{let f=e.inters;for(let p=f.length-1;p>=0;p--){let m=f[p];if(m.isInvalid&&s===void 0)continue;if(m===t&&Fe(l.start(),t.coord))return i?m:m.getBindedInter();let g=m.getBindedInter().side,b=c(m.coord);if(g===b&&h(m))return d(m);}for(;;){e=e.prevSide;let p=e.inters;for(let m=p.length-1;m>=0;m--){let g=p[m];if(g===t)return i?g:g.getBindedInter();if(o.has(e)){if(Fe(g.coord,g.getBindedInter().side.getEnd())){let b=g.getBindedInter().side;if(e.getEnd().sub(e.getStart()).normalize().dot(b.getEnd().sub(b.getStart()))<0){if(o.get(e).mapSideList.includes(g.getBindedInter().side.nextSide))return d(g);continue;}}if(o.get(e).mapSideList.includes(g.getBindedInter().side))return d(g);}else if(g.side===t.side&&h(g))return d(g);}}}function h(f){if(f.isInvalid||f.getBindedInter().side!==(Fe(f.coord,r.prevSide.getEnd())?r.prevSide:r))return!1;let p;if(i){if(Fe(f.coord,l.start()))return!0;p=aa(s?a.reverse():a,m(l));}else{if(Fe(f.coord,s?a.end():a.start()))return!0;p=aa(l,m(s?a.reverse():a));}return p===2||p===1;function m(g){if(g instanceof q)return g.cutLine(f.coord);if(g instanceof ee)return ee.build2(g.center,g.startAngle,f.coord.angleD(g.center),g.rx,g.ry,g.isCCW?1:0);if(g instanceof Ce)return g.clip(g.getPercent(f.coord,De))[0];throw new Error("not supported operation");}}function d(f){let p=t.getBindedInter(),m=t.side,g=p.side,b=t===f,y=t;if(n){let v=t.getIndex()-1;for(;m;){var _m2,_m3;let E=m.inters;for(;v>=0;v--)if(t=E[v],t===f){b||(t.setIsInvalid(),t.isDealed(),y=t),m=null;break;}else if(pi===0)!t.isInvalid&&(!Fe(t.coord,f.coord)||t.side===f.side&&t.getBindedInter().side===f.getBindedInter().side)&&(t.setIsInvalid(),t.isDealed(),y=t);else if(pi===1){let P=t.getBindedInter().side;o.has(m)&&o.get(m).mapSideList.includes(P)&&(t.setIsInvalid(),t.isDealed(),y=t);}m=(_m2=m)===null||_m2===void 0?void 0:_m2.prevSide,v=((_m3=m)===null||_m3===void 0?void 0:_m3.inters.length)-1;}}else{let v=t.getIndex()+1;for(;m;){var _m4;let E=m.inters;for(;v<E.length;v++)if(t=E[v],t===f){b||(t.setIsInvalid(),t.isDealed(),y=t),m=null;break;}else if(pi===0)!t.isInvalid&&(!Fe(t.coord,f.coord)||t.side===f.side&&t.getBindedInter().side===f.getBindedInter().side)&&(t.setIsInvalid(),t.isDealed(),y=t);else if(pi===1){let P=t.getBindedInter().side;o.has(m)&&o.get(m).mapSideList.includes(P)&&(t.setIsInvalid(),t.isDealed(),y=t);}m=(_m4=m)===null||_m4===void 0?void 0:_m4.nextSide,v=0;}}if(pi===0)if(i?o.has(g)?o.get(g).sideIsReversed:s:u){let v=p.getIndex()-1;for(;g;){var _g2,_g3;let E=o.has(g),P=g.inters;for(;v>=0;v--){if(p=P[v],p===f.getBindedInter()){g=null;break;}p.isInvalid||!E||(!Fe(p.coord,f.getBindedInter().coord)||t.side===f.side&&t.getBindedInter().side===f.getBindedInter().side)&&(p.setIsInvalid(),p.isDealed());}g=(_g2=g)===null||_g2===void 0?void 0:_g2.prevSide,v=((_g3=g)===null||_g3===void 0?void 0:_g3.inters.length)-1;}}else{let v=p.getIndex()+1;for(;g;){var _g4;let E=g.inters,P=o.has(g);for(;v<E.length;v++){if(p=E[v],p===f.getBindedInter()){g=null;break;}p.isInvalid||!P||(!Fe(p.coord,f.getBindedInter().coord)||t.side===f.side&&t.getBindedInter().side===f.getBindedInter().side)&&(p.setIsInvalid(),p.isDealed());}g=(_g4=g)===null||_g4===void 0?void 0:_g4.nextSide,v=0;}}return i?y:y.getBindedInter();}}function s2(r,e,t,n,i,s,o){let a=r.getShape(),l=e.getShape(),u=s?t.getShape().reverse():t.getShape(),c=(a instanceof ee?fi(a,u.start().angle(a.center)):a instanceof Ce?ot(a,u.start()):a.end().sub(a.start())).normalize(),h=(l instanceof ee?fi(l,u.start().angle(l.center)):l instanceof Ce?ot(l,u.start()):l.end().sub(l.start())).normalize(),d=c.dot(h);if(Gi(d,-1)){let f=s?t.getShape().reverse():t.getShape(),p=ot(f).normalize();if(c.add(h.scale(-1)).normalize().dot(p)>-.9)return{state:Nr(r,e,!0,o)?0:1,inter:Xi(e,t,i,s,!0,!1,n)};{let m=Yi(r,t,i,o,pi,s);return m.state===2?m:Nr(r,e,!0,o)?m.state===0||m.inter!==i?m:Yi(e,t,i,o,pi,s):m.state===1||m.inter!==i?m:Yi(e,t,i,o,pi,s);}}else{let f=c.scale(-1).angle(F.ORIGIN),p=h.angle(F.ORIGIN);f>p&&(f-=hm);let m=(f+p)/2,g=new F(Math.cos(m),Math.sin(m)),b=ot(u).normalize();return g.cross(b)<=0?c.scale(-1).dot(b)<0?{state:ys(r,e,t,!s,o)?1:0,inter:Xi(r,t,i,s,!0,void 0,n)}:[r,t,!0,void 0,n]:h.dot(b)<=0?{state:ys(r,e,t,!s,o)?1:0,inter:Xi(e,t,i,s,!0,void 0,n)}:[e,t,!0,void 0,n];}}function Zn(r,e,t,n){function i(){if(!n)return;let c=n.initColor(nt.Golden),h=n.initColor(nt.RED);c.addPt(s),c.addPoint(s.end()),h.addPt(o),n.draw();debugger;}let s=r.getShape(),o=e.getShape(),a=ot(s,t),l=ot(o,t),u=a.cross(l);if(Gi(u,0)){if(s instanceof q){if(o instanceof q){if(ue.eq(u,0)&&(a.dot(l)>0?!Fe(s.end(),o.start()):!Fe(s.start(),o.start())))throw i(),new Error("line and line");return u<0;}else{if(o instanceof ee)return a.cross(o.center.sub(t))<0;if(o instanceof Ce){let c=o.getExtremePoints(s),h=c.length?c[0]:bs(o.controls,s.start());return a.cross(h.sub(s.start()))<0;}else throw new Error("not support");}}else if(s instanceof ee){if(o instanceof q)return s.isCCW;if(o instanceof ee){if(o.center.equals1(s.center)&&(a.dot(l)>0?!Fe(s.end(),o.start())&&s.end().sub(o.start()).dot(l)>0:!Fe(s.start(),o.start())&&s.start().sub(o.start()).dot(l)>0))throw i(),new Error("arc and arc");return o.rx>=s.rx||o.center.distance2(s.center)>s.rx2?s.isCCW:!s.isCCW;}else throw new Error("not support");}else if(s instanceof Ce){if(o instanceof q){let c=s.getPercent(t,De),h=s.clip(c)[1],d=h.getExtremePoints(o);return(d.length?d[0]:bs(h.controls,o.start())).sub(o.start()).cross(l)<0;}else throw new Error("not support");}else throw new Error("not support");}else return u<0;}function tle(r,e,t,n,i){let s=r.getShape(),o=e.getShape(),a=ot(s,n),l=ot(o,n),u=a.dot(l);if(Gi(u,1)){let c=t.getShape(),h=ot(c,n);return a.dot(h)<0?Zn(r,t,n,i):Zn(e,t,n,i);}else return Gi(u,-1)?Zn(r,e,n,i)?Zn(r,t,n,i)&&Zn(e,t,n,i):Zn(r,t,n,i)||Zn(e,t,n,i):a.cross(l)>0?Zn(r,t,n,i)||Zn(e,t,n,i):Zn(r,t,n,i)&&Zn(e,t,n,i);}var Ph=0;function r6(r,e,t,n){let i=e.getBindedInter(),s=e.side,o=i.side,a=s.getShape(),l=o.getShape();if(n&&(Ph++,Ph===-1)){n.initColor(nt.RED).addPt(a),n.initColor(nt.Golden).addPt(l),n.draw();debugger;}let u=0;if(r===-1){let d=jl(s,s.nextSide,o,i,u,n),f=d.state!==0;if(d.state===2){let m=ot(a,e.coord).add(ot(s.nextSide.getShape(),e.coord)).normalize(),g=ot(l,e.coord).add(ot(o.nextSide.getShape(),e.coord)).normalize();return h(f,m.dot(g)>0);}let p=jl(s,s.nextSide,o.nextSide,i,u,n);return d.state!==p.state?(c(d,p),1):h(f,d.state!==jl(o,o.nextSide,s,e,u,n).state,d.inter,p.inter);}if(r===1){let d=Yi(s,o,i,n,u),f=d.state!==0;if(d.state===2)return h(f,ot(a,e.coord).dot(ot(l,e.coord))>0);let p;if(d.isReversed&&d.existOverlap&&Fe(d.inter.coord,o.getEnd())&&d.inter.getBindedInter().side!==s){let b=d.inter.getBindedInter().side;b===s.nextSide?p={state:ys(s,b,o.nextSide,!0,n)?1:0,inter:i}:b===s.prevSide?p={state:ys(b,s,o.nextSide,!0,n)?1:0,inter:i}:p=Yi(s,o.nextSide,i,n,u);}else p=Yi(s,o.nextSide,i,n,u);if(d.state!==p.state)return c(d,p),1;let m=ot(l,e.coord),g=ot(o.nextSide.getShape(),e.coord);if(Gi(m.dot(g),-1)){let b=Nr(o,o.nextSide,!0,n);return h(f,d.state!==Yi(o.nextSide,s,e,n,u,b?!f:f,!1,!1).state,d.inter,p.inter);}else{let b=ot(a,e.coord);return h(f,m.add(g).dot(b)>0,d.inter,p.inter);}}return 1;function c(d,f){let p=d.state!==0;if(d.inter===f.inter){e.setOutToIn(p);return;}let m=[];if(r===-1){let b=ot(a,e.coord),y=ot(s.nextSide.getShape(),e.coord),v=ot(l,e.coord),E=ot(o.nextSide.getShape(),e.coord);m.push(b.dot(v)),m.push(b.dot(E)),m.push(y.dot(v)),m.push(y.dot(E));}else{let b=ot(a,e.coord);m.push(ot(l,e.coord).dot(b)),m.push(ot(o.nextSide.getShape(),e.coord).dot(b));}if(m.reduce((b,y)=>Math.abs(b)>Math.abs(y)?b:y,0)>0){if(t===1||t===0||t===2||t===3)e.setOutToIn(p);else throw new Error("not support");}else if(t===1)g(!p);else if(t===0||t===2||t===3)g(p);else throw new Error("not support");function g(b){e.setIsInvalid();let y=(b?d:f).inter;delete y.isInvalid,delete y.getBindedInter().isInvalid,y.setOutToIn(!p);}}function h(d,f,p,m){if(p===m){let g=new Vi(e.coord,s,n),b=new Vi(e.coord,o,n);return g.bind(b),f?s.inters.splice(e.getIndex(),0,g):s.inters.splice(e.getIndex()+1,0,g),o.inters.splice(e.getBindedInter().getIndex(),0,b),g.setOutToIn(d),e.setOutToIn(!d),g.isDealed(),s.inters.forEach((y,v)=>y.setIndex(v)),o.inters.forEach((y,v)=>y.setIndex(v)),2;}else{let g=function(){let b=p.getBindedInter(),y=m.getBindedInter();delete p.isInvalid,delete b.isInvalid,delete m.isInvalid,delete y.isInvalid,p.setOutToIn(!d),m.setOutToIn(d),v(p,m,!0),v(m,p,!1),v(b,y,f),v(y,b,!f);function v(E,P,M){let{judge:I,changeNum:C}=S(),L=E.getIndex();for(let T=L+C,B=E.side.inters;I(T);T+=C){if(B[T].isInvalid)continue;if(!Fe(B[T].coord,E.coord))break;B[T].setIndex(L),B[L].setIndex(T);let $=B[T];B[T]=B[L],B[L]=$,L=T;}function S(){let T=E.side===P.side;if(M){let B=T?P.getIndex():E.side.inters.length;return{judge:$=>$<B,changeNum:1};}else{let B=T?P.getIndex()+1:0;return{judge:$=>$>=B,changeNum:-1};}}}};if(e.setIsInvalid(),f){if(t===1||t===0||t===2||t===3)return g(),2;throw new Error("not support");}else{if(t===1)return d?0:(g(),2);if(t===0||t===2||t===3)return d?(g(),2):0;throw new Error("not support");}}}}var Zl=0;function _h(r,e,t,n,i){let s=ca(),o=[],a=[],l=[],u=new Set(),c;if(i&&(c=new ha(i),Zl++,Zl===-1)){c.clear();let E=c.initColor(nt.GREEN),P=c.initColor(nt.WHITE),M=c.initColor(nt.BLUE),I=c.initColor(nt.Gray);e.items.forEach(C=>C.items.forEach((L,S)=>{S>0?P.addPly(L):E.addPly(L);})),t.items.forEach(C=>C.items.forEach((L,S)=>{S>0?I.addPly(L):M.addPly(L);})),c.draw();debugger;}let h=e.items.length!==0&&t.items.length!==0?e.bbox().extendOfSize(De).intersection1(t.bbox()):null;if(h){let E=[],P=[];switch(r){case 0:{e.items.forEach(M=>{M.bbox().isIntersect(h)&&E.push(M);}),t.items.forEach(M=>{M.bbox().isIntersect(h)&&P.push(M);});break;}case 1:case 3:{e.items.forEach(M=>{M.bbox().isIntersect(h)?E.push(M):o.push(M);}),t.items.forEach(M=>{M.bbox().isIntersect(h)?P.push(M):o.push(M);});break;}case 2:{e.items.forEach(M=>{M.bbox().isIntersect(h)?E.push(M):o.push(M);}),t.items.forEach(M=>{M.bbox().isIntersect(h)&&P.push(M);});break;}default:throw new Error("not support");}E.length!==e.items.length&&(e=new ct(E)),P.length!==t.items.length&&(t=new ct(P));}else{switch(r){case 0:break;case 1:case 3:{e.items.forEach(E=>o.push(E)),t.items.forEach(E=>o.push(E));break;}case 2:{e.items.forEach(E=>o.push(E));break;}default:throw new Error("not support");}e=new ct([]),t=new ct([]);}y(e,a,!0),y(t,l,!1);let d=(()=>r===2||r===3?(E,P)=>Fe(E.nextSide.getStart(),P)?E.nextSide:E:(E,P)=>Fe(E.prevSide.getEnd(),P)?E.prevSide:E)(),f=(E,P,M)=>{if(Fe(E.getEnd(),M)){if(E.inters.findIndex(I=>I.getBindedInter().side===P&&Fe(I.coord,E.getEnd()))===-1)return new Vi(M,E,c);}else return new Vi(M,E,c);},p=r===2||r===3?(E,P,M)=>{if(Fe(E.getStart(),M)){if(E.inters.findIndex(I=>I.getBindedInter().side===P&&Fe(I.coord,E.getStart()))===-1)return new Vi(M,E,c);}else return new Vi(M,E,c);}:f;n.seek(e,t,(E,P,M,I,C,L)=>{let S=a[E][P],T=l[I][C],B=S.sides[M],$=T.sides[L],Z=dn(B.getShape(),$.getShape());if((B.getShape()instanceof Ce||$.getShape()instanceof Ce)&&Z>=4){let W=function(U,D){let k=!1;for(let ie=0;ie<D.length;ie+=2)Fe(new F(D[ie],D[ie+1]),U)&&(k=!0);k||D.push(U.x,U.y);},Y=[V[0],V[1]];for(let U=0;U<Z;U+=2){let D=new F(V[U],V[U+1]);for(let k=U+2;k<Z;k+=2){let ie=new F(V[k],V[k+1]);if(!Fe(D,ie)){W(ie,Y);break;}}}Z=Y.length,Y.forEach((U,D)=>V[D]=U);}let H=0;if(Z===4){let W=function(D){return Fe(B.getEnd(),D)||Fe(B.prevSide.getEnd(),D)||Fe($.prevSide.getEnd(),D)||Fe($.getEnd(),D);},Y=new F(V[0],V[1]),U=()=>{let D=new Vi(Y,B,c),k=new Vi(Y,$,c);D.bind(k),D.setIsInvalid(),D.isDealed(),S.inters.push(D),T.inters.push(k);};if(V[0]===V[2]&&V[1]===V[3])if(W(Y))H=2;else{U();return;}}for(;H<Z;H+=2){let W=new F(V[H],V[H+1]),Y=B,U=$;Fe(Y.prevSide.getEnd(),W)&&(Y=Y.prevSide),U=d(U,W);let D=f(Y,U,W);if(D){let k=p(U,Y,W);k&&(Y.addInter(D),S.inters.push(D),U.addInter(k),T.inters.push(k),D.bind(k),S.intersect(T,u));}}return Z;},i);let m=v(),g=KG(a,l,r);r===2&&g.forEach(E=>!E.isGroup1&&E.reverse()),new QG(m.concat(g)).getPolygons().forEach(E=>o.push(E));let b=new ct(o);if(c){if(Zl===-1){let E=c.initColor(nt.RED),P=c.initColor(nt.Golden);o.forEach(M=>{E.addPly(M.items[0]),M.items.slice(1).forEach(I=>P.addPly(I));}),c.draw();debugger;throw new Error();}b.id=Zl;}return Rr.BooleanTools+=zi(s),b;function y(E,P,M){E.items.forEach(I=>{let C=[];C.push(Sm.build(I.items[0],M,!0,c,I)),I.items.slice(1).forEach(L=>{C.push(Sm.build(L,M,!1,c));}),P.push(C);});}function v(){let E=[];return u.forEach(M=>{r===2||r===3?M.forEach(C=>{C.isGroup1||C.reverse(),C.sides.forEach(L=>L.sortInters());}):M.forEach(C=>C.sides.forEach(L=>L.sortInters())),M.forEach(C=>{C.inters.forEach(L=>{if(L.dealed)return;let S=L.side,T=L.getBindedInter().side,B;Fe(S.getEnd(),L.coord)&&Fe(T.getEnd(),L.coord)?B=-1:Fe(S.getEnd(),L.coord)?(B=1,L=L.getBindedInter()):Fe(T.getEnd(),L.coord)&&(B=1);let $=r6(B,L,r,c);L.isDealed(),$&&(C.setAllInterIsInvalidToFalse(),T.outline.setAllInterIsInvalidToFalse());});}),I(M),r===3&&(M.forEach(C=>{C.reverse(),C.sides.forEach(L=>{L.sortInters(),L.inters.forEach(S=>{S.resetVisitStatus();});});}),I(M));function I(C){C.forEach(L=>{L.inters.forEach(S=>{if(S.isInvalid||S.getVisited())return;let T=S.findStartInter(),B=P(r)?T.run():T.getBindedInter().run(),$=L.polyline.primitives;if(B){if($.length===B.primitives.length){let Z=new Set($);if(!B.primitives.some(H=>!Z.has(H))){E.push(L);return;}}E.push(Sm.build(B,!0,!0,c));}});});}}),E;function P(M){switch(M){case 0:case 2:case 3:return!0;case 1:return!1;default:throw Error("not support the rule");}}}}var Hl={intersect(r,e,t,n){return _h(0,r,e,t,n);},union(r,e,t,n){return _h(1,r,e,t,n);},diff(r,e,t,n){return _h(2,r,e,t,n);},xor(r,e,t,n){return _h(3,r,e,t,n);}},n6=0,Vi=class{constructor(r,e,t){this.coord=r,this.side=e,t&&(this.id=n6++,this.drawDebug=t);}resetVisitStatus(){this.visited=!1,this.bindedInter.visited=!1;}isDealed(){this.dealed=!0,this.getBindedInter().dealed=!0;}setOutToIn(r){this.outToIn=r,this.bindedInter.outToIn=!r;}setIsInvalid(){this.isInvalid=!0,this.getBindedInter().isInvalid=!0;}getBindedInter(){return this.bindedInter;}bind(r){this.bindedInter=r,r.bindedInter=this;}setIndex(r){this.index=r;}isSorted(){return this.index!==void 0;}getIndex(){return this.index;}getVisited(){return this.visited;}visitSelf(){this.visited=!0;}visit(){this.visited=!0,this.bindedInter.visited=!0;}getPrevPoint(){let r=this.getIndex(),e=this.side.getStart();return r&&(e=this.side.inters[r-1].coord),e;}getTangent(){let r=this.side.getShape();if(r instanceof q)return r.end().sub(r.start());if(r instanceof ee){let e=this.coord.angle(r.center);return r.isCCW?e+=eh:e-=eh,new F(Math.cos(e),Math.sin(e));}else{if(r instanceof Ce)return rh(r,r.getPercent(this.coord,De));throw new Error("not support");}}findStartInter(){return this.outToIn===void 0?this.getTangent().cross(this.bindedInter.getTangent())>0?this:this.bindedInter:this.outToIn?this:this.bindedInter;}run(){let r=[],e=this,t;if(this.drawDebug){Nm++;let n=Nm===-1,i=this.drawDebug.initColor(nt.RED);if(n){this.drawDebug.draw();debugger;}t=s=>{if(r.push(s),n){i.addPt(r[r.length-1]),this.drawDebug.draw();debugger;}};}else t=n=>r.push(n);for(;!e.visited;){let n=function(a,l){ue.eq(a.distance2(l),0)||t(Yl.rebuild(s.getShape(),a,l));};e.visit();let i=e.getIndex(),s=e.side,o=s.inters[i+1];for(;(_o2=o)!==null&&_o2!==void 0&&_o2.isInvalid;){var _o2;o=s.inters[o.getIndex()+1];}if(o)n(e.coord,o.coord),e=o.bindedInter;else{for(n(e.coord,s.getEnd()),s=s.nextSide,e=null;;){for(let a of s.inters)if(!a.isInvalid){e=a.bindedInter;break;}if(e)break;t(s.getShape()),s=s.nextSide;}ue.eq(s.getEnd().distance2(e.coord),0)?t(s.getShape()):n(s.getStart(),e.coord);}}if(e!==this)throw this.drawDebug&&console.log(JSON.stringify({runId:Nm,handleId:Ph,boolId:Zl})),new Error("inter !== this");return Jn(Me.build7(r));}},Nm=0,Sh=0;function eu(r,e){let t=r.primitives[0];if(r.primitives.length===1&&t instanceof ee&&Math.abs(t.sweepAngle)===360)return[r];let n=ca();Sh++;let i,s=c6(r);if(s.length===0)return[];let o=o6(s);if(Sh===-1){i=new ha(e);let l=i.initColor(nt.BLUE);s.forEach(c=>l.addPt(c.getShape()));let u=i.initColor(nt.GREEN);o.forEach(c=>u.addPoint(c.coord)),i.draw();debugger;throw new Error();}if(o.length===0)return[Me.build7(s.map(l=>l.getShape()))];a6(o),l6(o,i);let a=i6(o,i);if(a.length===0)throw console.log("=====deSelfIntersection=====",Sh),new Error("result.length === 0");if(i)throw a.forEach(l=>{i.initColor(nt.WHITE).addPly(l),i.draw();debugger;}),new Error();return Rr.deSelfIntersection+=zi(n),a;}function i6(r,e){let t=[];return r.forEach(n=>{if(n.getVisited()||n.isInvalid)return;let i=[],s=n,o;if(e){debugger;let l=e.initColor(nt.RED);o=u=>{i.push(u),l.addPt(i[i.length-1]),e.draw();debugger;};}else o=l=>i.push(l);for(;!s.getVisited();){let l=function(d,f){ue.eq(d.distance2(f),0)||o(o2(c.getShape(),d,f));};s.visitSelf();let u=s.getIndex(),c=s.side,h=c.inters[u+1];for(;(_h2=h)!==null&&_h2!==void 0&&_h2.isInvalid;){var _h2;h=c.inters[h.getIndex()+1];}if(h)l(s.coord,h.coord),s=h.getBindedInter();else{for(l(s.coord,c.getEnd()),c=c.nextSide,s=null;;){for(let d of c.inters)if(!d.isInvalid){s=d.getBindedInter();break;}if(s)break;o(c.getShape()),c=c.nextSide;}ue.eq(c.getEnd().distance2(s.coord),0)?o(c.getShape()):l(c.getStart(),s.coord);}}if(s!==n)throw console.log("=====deSelfIntersection=====",Sh),new Error("inter !== inter0");let a=Jn(Me.build7(i));a&&t.push(a);}),t;}function s6(r){return{next(){return r.hasNext()?{value:r.next()}:{done:!0,value:void 0};},[Symbol.iterator](){return this;}};}function o6(r){let e=[],t=new iG();for(let n of r.slice().sort((i,s)=>i.bbox().minY-s.bbox().minY)){for(let i of s6(t.listIterator())){let s=i.item;if(s.bbox().maxY<n.bbox().minY)t.remove(i);else{let o=function(d,f){let p=new Vi(f,d,null);return d.inters.push(p),e.push(p),p;},a=function(d,f){let p=d.getEnd(),m=new F(V[0],V[1]),g=new F(V[2],V[3]),b=p.distance2(m)>p.distance2(g)?m:g,y=d.prevSide;o(Fe(y.getEnd(),b)?y:d,b).bind(o(f,b));},l=s.getShape(),u=n.getShape(),c=dn(l,u),h=c===4&&V[0]===V[2]&&V[1]===V[3];if(h&&(c-=2),s.nextSide===n)s.prevSide!==n&&c===4&&a(s,n);else if(s.prevSide===n)c===4&&a(n,s);else if(c!==0){let d=function(p,m){let g=p.prevSide;return o(Fe(g.getEnd(),m)?g:p,m);},f=new F(V[0],V[1]);if(h&&!Fe(f,s.prevSide.getEnd())&&!Fe(f,n.prevSide.getEnd())&&ot(l,f).dot(ot(u,f))>0)continue;for(let p=0;p<c;p+=2){let m=new F(V[p],V[p+1]);d(s,m).bind(d(n,m));}}}}t.add(n);}return e.forEach(n=>{n.getIndex()===void 0&&n.side.sortInters();}),e;}function a6(r){r.forEach(e=>{let t=e.side.getEnd();if(e.isInvalid||!Fe(e.coord,t))return;let n=e.side.inters,i=e.getBindedInter().side;for(let s=n.length-1;s>=0;s--){let o=n[s];if(!Fe(o.coord,t))break;o!==e&&o.getBindedInter().side===i&&o.setIsInvalid();}});}function l6(r,e){r.forEach(t=>{if(t.isInvalid||t.dealed)return;let n=t.side,i=t.getBindedInter().side,s;Fe(n.getEnd(),t.coord)&&Fe(i.getEnd(),t.coord)?s=-1:Fe(n.getEnd(),t.coord)?n.nextSide!==i&&(s=1,t=t.getBindedInter()):Fe(i.getEnd(),t.coord)&&i.nextSide!==n&&(s=1),u6(s,t,e),t.isDealed();});}function u6(r,e,t){let n=e.getBindedInter(),i=e.side,s=n.side,o=i.getShape(),a=s.getShape(),l=1;if(r===-1){if(la(o.reverse(),a.reverse())||la(i.nextSide.getShape(),s.nextSide.getShape())){let c=jl(i,i.nextSide,s,n,l,t);if(c.state===2)throw new Error("info1.state === InState.IS_OVERLAP");let h=jl(i,i.nextSide,s.nextSide,n,l,t);c.state===h.state&&u(c,h);}else if(!(la(o.reverse(),s.nextSide.getShape())||la(i.nextSide.getShape(),a.reverse()))){let c=ys(i,i.nextSide,s,!1,t);c===ys(i,i.nextSide,s.nextSide,!0,t)&&c!==ys(s,s.nextSide,i.nextSide,!0,t)&&e.setIsInvalid();}}else if(r===1){let c=function(h,d){return ot(h,d.start()).dot(ot(d,d.start()))>0;};if(la(o.reverse(),a.reverse())||la(o,s.nextSide.getShape())){let h=Yi(i,s,n,t,l);if(h.state===2)throw new Error("info1.state === InState.IS_OVERLAP");let d=Yi(i,s.nextSide,n,t,l);h.state===d.state&&u(h,d);}else if(c(o.reverse(),a.reverse())&&c(o,s.nextSide.getShape())){let h=Nr(i,s,!1,t);h===Nr(i,s.nextSide,!0,t)&&h!==ys(s,s.nextSide,new Yl(o2(o,e.coord,o.end()),t),!0,t)&&e.setIsInvalid();}}function u(c,h){c.inter.setIsInvalid(),h.inter.setIsInvalid();}}function o2(r,e,t){if(r instanceof q||e.distance2(t)<1e-6)return new q(e,t);if(r instanceof ee)return ee.build2(r.center,e.angleD(r.center),t.angleD(r.center),r.rx,r.ry,r.sweep());if(r instanceof Ce){let n=r.getPercent(e,De),i=r.getPercent(t,De);return r.clip(n)[1].clip((i-n)/(1-n))[0];}else throw new Error("not supported operation");}function c6(r){let e=Jn(r);if(!e)return[];let t=e.primitives.map(i=>new Yl(i,null)),n=t[t.length-1];return t.forEach(i=>{n.connect(i),n=i;}),t;}var Zi=(_class16=class Zi{static clearData(r){this.originalPrimitive=[],this.offsetPrimitive=[],this.rawOffsetPrimitive=[],this.offsetDistance=0,this.testI++,this.testI===0?this.drawDebug=new ha(r):delete this.drawDebug;}static createRawOffsetEdge(){if(this.drawDebug){let r=this.drawDebug.initColor(nt.WHITE);this.originalPrimitive.forEach(e=>r.addPt(e)),this.drawDebug.draw();debugger;}for(let r=0;r<this.originalPrimitive.length;r+=1){let e=this.originalPrimitive[r];this.offsetPrimitive.push({index:r,offsetEdge:this.createOffsetEdge(e)});}if(this.drawDebug){let r=this.drawDebug.initColor(nt.Golden);this.offsetPrimitive.forEach(e=>r.addPt(e.offsetEdge)),this.drawDebug.draw();debugger;}if(this.offsetPrimitive.length>1){for(let r=0;r<this.offsetPrimitive.length;r+=1)if(r===this.offsetPrimitive.length-1){this.connectPrimitive(this.offsetPrimitive[r],this.offsetPrimitive[0]);let e=this.rawOffsetPrimitive[0],t;e instanceof ee?t=ee.build4(this.offsetPrimitive[0].offsetEdge.start(),e.end(),e.center,e.rx,e.ry,e.sweep()):t=new q(this.offsetPrimitive[0].offsetEdge.start(),e.end()),this.rawOffsetPrimitive.shift(),this.rawOffsetPrimitive.unshift(t);}else this.connectPrimitive(this.offsetPrimitive[r],this.offsetPrimitive[r+1]);}else this.rawOffsetPrimitive=[];}static getExtendPolyLine(r,e,t){if(r=Jn(r),!r.primitives.length)return[];if(this.clearData(t),this.originalPrimitive=r.primitives,this.isExpansion=e>0,this.offsetDistance=e,this.createRawOffsetEdge(),this.drawDebug){let i=this.drawDebug.initColor(nt.BLUE);this.rawOffsetPrimitive.forEach(s=>i.addPt(s)),this.drawDebug.draw();debugger;}let n=this.createClippingEdge(t);if(this.drawDebug){let i=this.drawDebug.initColor(nt.RED);n.forEach(s=>i.addPly(s)),this.drawDebug.draw();debugger;}if(!this.isExpansion&&n.length&&(n=this.getValidityPrimitive(n)),this.drawDebug){let i=this.drawDebug.initColor(nt.GREEN);n.forEach(s=>i.addPly(s)),this.drawDebug.draw();debugger;throw new Error();}return n;}static getValidityPrimitive(r){let e=[];for(let t=0;t<r.length;t+=1){let n=!0,i=r[t].primitives;e:for(let s=0;s<i.length;s+=1){let o=i[s],a;if(o instanceof ee)a=o.midPoint;else if(o instanceof q)a=o.start();else throw new Error("not support!");for(let l=0;l<this.originalPrimitive.length;l+=1){let u=this.originalPrimitive[l],c;if(u instanceof ee)c=this.pointArcClosest(a,u);else{let h=my(a,u.start(),u.end());c=h.d*h.d;}if(this.offsetDistance*this.offsetDistance-c>.01){n=!1;break e;}}}n&&e.push(r[t]);}return e;}static getInters(r){let e=[];for(let t=0;t<r;t+=2)e.push(new F(V[t],V[t+1]));return e;}static pointArcClosest(r,e){let t=e.center;if(r.equals1(e.center))return e.rx;if(e.inArea(r,0)){let s=r.sub(t);return Math.abs(s.length()-e.rx);}let n=r.distance2(e.start()),i=r.distance2(e.end());return ue.less(n,i)?n:i;}static createClippingEdge(r){let e=[],t=[],n=eu(Me.build2(this.rawOffsetPrimitive),r);n.forEach(s=>{let o=s.area(.01);e.push(o);});let i=Math.min(...e.filter(s=>s<0));for(let s=0;s<e.length;s+=1){let o=e[s];ue.eq(o,0)||(!this.isExpansion&&o<0||this.isExpansion&&(o<0&&e[s]===i||o>0))&&t.push(n[s]);}return t;}static createOffsetEdge(r){if(r instanceof ee)return r.panDistance1(this.offsetDistance);if(r instanceof q)return r.panDistance(this.offsetDistance);throw new Error("not support!");}static connectPrimitive(r,e){r.offsetEdge instanceof q&&e.offsetEdge instanceof q?this.lineToLineConnect(r,e):r.offsetEdge instanceof ee&&e.offsetEdge instanceof ee?this.arcToArcConnect(r,e):r.offsetEdge instanceof q&&e.offsetEdge instanceof ee?this.lineToArcConnect(r,e):this.arcToLineConnect(r,e);}static isFalseIntersection(r){return r>1||r<0;}static lineToLineConnect(r,e){let t=r.offsetEdge,n=e.offsetEdge,i=e.index,s=this.originalPrimitive[i].start();if(t.isParallel(n))t.bbox().intersection1(n.bbox())?this.rawOffsetPrimitive.push(t):this.lineToLineUseArcToConnect(s,t,n);else{let o=this.getLineToLineT(t,n),a=o[0],l=o[1];if(this.isFalseIntersection(a)||this.isFalseIntersection(l))a>1&&this.isFalseIntersection(l)?this.lineToLineUseArcToConnect(s,t,n):this.useLineToConnect(t,n);else if(!this.isFalseIntersection(a)&&!this.isFalseIntersection(l)){let u=t.end().sub(t.start()),c=t.start().add(u.mul(a)),h=new q(t.start(),c);this.rawOffsetPrimitive.push(h);let d=new q(c,n.end());this.updateNextOffsetPrimitive(i,d);}}}static updateNextOffsetPrimitive(r,e){this.offsetPrimitive[r].offsetEdge=e;}static useLineToConnect(r,e){this.rawOffsetPrimitive.push(r);let t=new q(r.end(),e.start());this.rawOffsetPrimitive.push(t);}static lineToLineUseArcToConnect(r,e,t){let n=this.getSweep(r,e),i=this.getSweepAngel(e.end(),t.start(),r,n);if(i===0){this.useLineToConnect(e,t);return;}this.rawOffsetPrimitive.push(e);let s=ee.build5(e.end(),t.start(),i);this.rawOffsetPrimitive.push(s);}static getSweep(r,e,t){let n=null,i=t||t===0?this.originalPrimitive[t]:e;if(i instanceof ee){let s=i.center.sub(i.end()).normalize();i.isCCW?n=new F(s.y,-s.x):n=new F(-s.y,s.x);}else n=e.end().sub(e.start()).normalize();return r.sub(e.end()).normalize().cross(n)>0?0:1;}static getLineToLineT(r,e){let t=r.end().sub(r.start()),n=e.end().sub(e.start()),i=t.cross(n),s=e.start().sub(r.start()),o=r.start().sub(e.start()),a=s.cross(n)/i,l=o.cross(t)/-i;return[a,l];}static lineToArcConnect(r,e){let t=r.offsetEdge,n=e.offsetEdge,i=r.index,s=e.index,o=this.getLineJoinArcScalarAndIntersectionNum(t,n),a=this.originalPrimitive[s].start();if(o.intersectionNum===0)this.lineAndArcUseArcConnect(a,t,n,i);else if(o.intersectionNum===1){let l=o.points[0];this.lineAndArcConnectionDetail(t,n,o.t[0],l,a,i,s);}else if(o.intersectionNum===2){let l=o.points[0],u=o.points[1],c=l.distance2(a),h=u.distance2(a);this.lineAndArcConnectionDetail(t,n,c<h?o.t[0]:o.t[1],c<h?l:u,a,i,s);}}static lineAndArcConnectionDetail(r,e,t,n,i,s,o){let a=this.isTrueArcIntersection(e,n);if(!this.isFalseIntersection(t)&&a){let l=new q(r.start(),n);this.rawOffsetPrimitive.push(l);let u;!e.center.equals1(n)||e.sweepAngle>1e-4?(u=ee.build4(n,e.end(),e.center,e.rx,e.ry,e.sweep()),u instanceof ee&&u.sweepAngle===0&&(u=new q(u.start(),u.end()))):u=new q(e.center,n),this.updateNextOffsetPrimitive(o,u);}else a?this.useLineToConnect(r,e):this.lineAndArcUseArcConnect(i,r,e,s);}static lineAndArcUseArcConnect(r,e,t,n){let i=this.getSweep(r,e,n),s=this.getSweepAngel(e.end(),t.start(),r,i);if(s===0){this.useLineToConnect(e,t);return;}let o=ee.build5(e.end(),t.start(),s);this.rawOffsetPrimitive.push(e),this.rawOffsetPrimitive.push(o);}static arcToLineConnectionDetail(r,e,t,n,i,s,o){let a=this.isTrueArcIntersection(r,n);if(!this.isFalseIntersection(t)&&a){let l;r.center.equals1(n)?l=new q(r.center,n):Math.abs(r.sweepAngle)<1e-4?l=new q(r.start(),n):(l=ee.build4(r.start(),n,r.center,r.rx,r.ry,r.sweep()),l instanceof ee&&l.sweepAngle===0&&(l=new q(l.start(),l.end()))),this.rawOffsetPrimitive.push(l);let u=new q(n,e.end());this.updateNextOffsetPrimitive(o,u);}else a?this.useLineToConnect(r,e):this.lineAndArcUseArcConnect(i,r,e,s);}static isTrueArcIntersection(r,e){return $t(r,e);}static getSweepAngel(r,e,t,n){let i=r.angleD(t),s=e.angleD(t),o;return i===s?o=0:(i=Xe.regularD(i),s=Xe.regularD(s),n===1?s<=i&&(s+=360):s>=i&&(i+=360),o=s-i),o;}static getLineJoinArcScalarAndIntersectionNum(r,e){let t={t:[],intersectionNum:0,points:[]},n=BD(e,r);if(n){t.intersectionNum=n/2;for(let i=0;i<n-1;i+=2){let s=new F(V[i],V[i+1]);t.points.push(s),s.sub(r.start()).x<1e-4||s.sub(r.start()).y<1e-4?t.t.push(0):t.t.push(s.sub(r.start()).x/r.end().sub(r.start()).x);}}else t.intersectionNum=0;return t;}static arcToLineConnect(r,e){let t=r.offsetEdge,n=e.offsetEdge,i=r.index,s=e.index,o=this.getLineJoinArcScalarAndIntersectionNum(n,t),a=this.originalPrimitive[s].start();if(o.intersectionNum===0)this.lineAndArcUseArcConnect(a,t,n,i);else if(o.intersectionNum===1){let l=o.points[0];this.arcToLineConnectionDetail(t,n,o.t[0],l,a,i,s);}else if(o.intersectionNum===2){let l=o.points[0],u=o.points[1],c=l.distance2(a),h=u.distance2(a);this.arcToLineConnectionDetail(t,n,c<h?o.t[0]:o.t[1],c<h?l:u,a,i,s);}}static rxChangeStatus(r){return r===1?!this.isExpansion:this.isExpansion;}static arcToArcConnect(r,e){let t=r.offsetEdge,n=e.offsetEdge,i=cy(t,n);if(i){let s=this.getInters(i),o;if(s.length===2){let u=this.originalPrimitive[e.index].start(),c=s[0],h=s[1],d=c.distance2(u),f=h.distance2(u);d<f?o=c:o=h;}else o=s[0];let a,l;o.equals1(t.center)?a=new q(t.center,o):Math.abs(t.sweepAngle)<1e-4?a=new q(t.start(),o):(a=ee.build4(t.start(),o,t.center,t.rx,t.ry,t.sweep()),a instanceof ee&&a.sweepAngle===0&&(a=new q(a.start(),a.end()))),this.rawOffsetPrimitive.push(a),o.equals1(n.center)?l=new q(o,n.center):Math.abs(n.sweepAngle)<1e-4?l=new q(o,n.end()):(l=ee.build4(o,n.end(),n.center,n.rx,n.ry,n.sweep()),l instanceof ee&&l.sweepAngle===0&&(l=new q(l.start(),l.end()))),this.updateNextOffsetPrimitive(e.index,l);}else{let s=this.originalPrimitive[r.index],o=this.originalPrimitive[e.index],a=this.rxChangeStatus(s.sweep()),l=this.rxChangeStatus(o.sweep()),u=this.originalPrimitive[e.index].start(),c=this.getSweep(u,t,r.index),h=Math.abs(this.offsetDistance),d=ee.build2(u,a?s.endAngle():s.endAngle()+180,l?o.startAngle:o.startAngle+180,h,h,c);this.rawOffsetPrimitive.push(t),this.rawOffsetPrimitive.push(d);}}},_class16.originalPrimitive=[],_class16.offsetPrimitive=[],_class16.rawOffsetPrimitive=[],_class16.testI=0,_class16),ti=class Jl extends Ul{constructor(e,t,n,i,s,o){if(super(),t<0||n<0)throw new Error("The width and height of rect can't be less than 0!");this.leftUpPoint=e,this.width=t,this.height=n,this.angle=i,this.isCCW=s,this.radius=Math.min(Math.max(o,0),t/2,n/2);}get radiusRatio(){return this.radius/Math.min(this.width,this.height);}start(){return this.leftUpPoint.add(new F(this.radius,0).multiply3(ze.rotateD(this.angle)));}end(){return this.start();}getLeftPoint(){return this.leftUpPoint.add(new F(0,-this.height/2).multiply3(ze.rotateD(this.angle)));}getRightPoint(){return this.leftUpPoint.add(new F(this.width,-this.height/2).multiply3(ze.rotateD(this.angle)));}extend(e){return new Jl(this.leftUpPoint.add(new F(-e,e).rotateD(F.ORIGIN,this.angle)),this.width+e*2,this.height+e*2,this.angle,this.isCCW,this.radius+e);}bbox(){let e=ze.rotateD(this.angle),{leftUpPoint:t,width:n,height:i,radius:s}=this,o=t.add(new F(s,-s).multiply3(e)),a=t.add(new F(s,s-i).multiply3(e)),l=t.add(new F(n-s,-s).multiply3(e)),u=t.add(new F(n-s,s-i).multiply3(e));return new ye(Math.min(o.x,a.x,l.x,u.x)-s,Math.max(o.x,a.x,l.x,u.x)+s,Math.min(o.y,a.y,l.y,u.y)-s,Math.max(o.y,a.y,l.y,u.y)+s);}toPolyline(){let e=[],{leftUpPoint:t,width:n,height:i,radius:s}=this;if(s===0){let a=F.ORIGIN,l=new F(n,0),u=new F(n,-i),c=new F(0,-i);e.push(new q(a,l),new q(l,u),new q(u,c),new q(c,a));}else{let a=new F(0,-s),l=new F(s,0),u=new F(n-s,0),c=new F(n,-s),h=new F(n,s-i),d=new F(n-s,-i),f=new F(s,-i),p=new F(0,s-i);e.push(ee.build1(a,l,s,s,!1,0),new q(l,u),ee.build1(u,c,s,s,!1,0),new q(c,h),ee.build1(h,d,s,s,!1,0),new q(d,f),ee.build1(f,p,s,s,!1,0),new q(p,a));}e=e.filter(a=>!a.start().equals1(a.end())),this.isCCW&&(e.forEach((a,l)=>e[l]=a.reverse()),e.reverse());let o=ze.rotateD(this.angle).translate1(t);return Me.build2(e.map(a=>a.multiply3(o)));}center(){return this.leftUpPoint.add1(this.width/2,this.height/2).rotateD(this.leftUpPoint,this.angle);}multiply3(e){let t=this.leftUpPoint.multiply3(e),n=new F(this.width,0).multiply3(ze.rotateD(this.angle)).multiply3(e),i=new F(0,-this.height).multiply3(ze.rotateD(this.angle)).multiply3(e);return e.isMirrored()?new Jl(t,i.length(),n.length(),i.angleD(F.ORIGIN),this.isCCW===1?0:1,this.radius*n.length()/this.width):new Jl(t,n.length(),i.length(),n.angleD(F.ORIGIN),this.isCCW,this.radius*n.length()/this.width);}reverse(){return new Jl(this.leftUpPoint,this.width,this.height,this.angle,this.isCCW===1?0:1,this.radius);}stroke(e,t,n){let i=this.stroke1(e,t,n);if(i.length===1)return i[0];{let[s,o]=i;return Me.build2(s.primitives.concat(new q(s.primitives[0].start(),o.primitives[0].start()),o.primitives,new q(o.primitives[0].start(),s.primitives[0].start())));}}stroke1(e,t,n){let i=n===this.isCCW?this:this.reverse(),s=e/2,o=Math.min(i.width,i.height)/2,a=i.extend(s).toPolyline();return o<=s?[a]:[a,i.extend(-s).toPolyline().reverse()];}points(e){let t=this.toPolyline(),n=[];return t.points(e,i=>n.push(i)),n;}toBezier(){throw new Error("Method not implemented.");}},h6=.01,Ht=class Qn{static simplify(e){return e=Jn(e),e?new Qn([e]):null;}static buildByStroke(e,t,n=1,i){if(e instanceof ee&&(e.rx<t/2+h6||Math.abs(e.sweepAngle)>180&&ue.lesseq(e.start().distance1(e.end()),t))){let s=eu(e.stroke(t,n,0),i);if(s.length===0)return null;if(s.length===1)return new Qn(s);let o=[null],a=Number.POSITIVE_INFINITY;return s.forEach(l=>{let u=l.area(.1);u<0?u<a&&(o[0]=l,a=u):o.push(l);}),new Qn(o);}else if(e instanceof ti){let s=e.stroke1(t,n,0).map(o=>Jn(o));return s[0]?s[1]?new Qn(s):new Qn([s[0]]):null;}return this.simplify(e.stroke(t,n,0));}static buildCircle(e,t){return this.simplify(Me.build7([ee.buildCircle(e,t,0)]));}static buildRect(e){return this.simplify(e.toPolyline());}static buildBBox(e){return this.simplify(Me.buildBBox(e,0));}constructor(e){this.items=e.slice();}multiply3(e){return new Qn(this.items.map(t=>t.multiply3(e)));}bbox(){return this.items[0].bbox();}isEqual(e){return e instanceof Qn?this.items.every(t=>e.items.some(n=>n.isEqual(t))):!1;}getOutMostPolyline(){return this.items[0];}extend(e,t){if(this.items.length!==1)throw new Error("this.items.length !== 1");if(e===0)return new ct([this]);let n=this.items[0],i=[];for(let c of n.primitives)if(c instanceof q)i.push(c);else if(c instanceof ee&&c.rx===c.ry)o(c);else if(c instanceof Ce)s(c);else throw new Error("not support!");n=Me.build7(i);function s(c){let h=c.points(.1);for(let d=0;d<h.length-1;d++){let f=h[d],p=h[d+1];i.push(new q(f,p));}}function o(c){if(Math.abs(c.sweepAngle)>270){let h=c.sweepAngle/2;o(ee.build3(c.center,c.startAngle,h,c.rx,c.ry)),o(ee.build3(c.center,c.startAngle+h,h,c.rx,c.ry));}else i.push(c);}let a=[],l=[];Zi.getExtendPolyLine(n,e,t).forEach(c=>{(c.area(.1)>0?l:a).push(c);});let u;if(a.length===1)l.forEach(c=>a.push(c)),u=new ct([new Qn(a)]);else if(a.length===0)console.warn("outlines.length === 0"),u=new ct([]);else if(l.length===0)u=new ct(a.map(c=>new Qn([c])));else{let c=a.map(h=>[h]);l.forEach(h=>{let d=[],f=h.bbox();if(c.forEach(p=>{p[0].bbox().isContainsBBox1(f)&&d.push(p);}),d.length===1)d[0].push(h);else{if(d.length===0)throw new Error("inPlsArr.length === 0");for(let p of d.sort((m,g)=>m[0].bbox().area()-g[0].bbox().area()))if(p[0].getWindingNum(h.start())===-1){p.push(h);break;}}}),u=new ct(c.map(h=>new Qn(h)));}return u;}toPolylineGroup(){return new bo(this.items);}},f6=class Mh extends ee{constructor(e,t,n,i,s){super(e,t,n,i,s);}static build2(e,t,n,i,s,o){st.positive(i),st.positive(s),st.normal(t),st.normal(n);let a;return t===n?(t=Xe.regularD(t),n=Xe.regularD(n),a=0):(t=Xe.regularD(t),n=Xe.regularD(n),o===1?n<=t&&(n+=360):n>=t&&(t+=360),a=n-t),new Mh(i,s,e,t,a);}static build3(e,t,n,i,s){return st.positive(i),st.positive(s),st.normal(n),new Mh(i,s,e,Xe.regularD(t),n);}static build4(e,t,n,i,s,o){let a=e.angleD(n),l=t.angleD(n);return Mh.build2(n,a,l,i,s,o);}},d6=class{constructor(r=4096){this.byteOffset=0,this.view=new DataView(new ArrayBuffer(r));}getFloat32(r,e){return this.view.getFloat32(r,e);}getFloat64(r,e){return this.view.getFloat64(r,e);}getInt8(r){return this.view.getInt8(r);}getInt16(r,e){return this.view.getInt16(r,e);}getInt32(r,e){return this.view.getInt32(r,e);}getUint8(r){return this.view.getUint8(r);}getUint16(r,e){return this.view.getUint16(r,e);}getUint32(r,e){return this.view.getUint32(r,e);}setFloat32(r,e,t){this.view.setFloat32(r,e,t);}setFloat64(r,e,t){this.view.setFloat64(r,e,t);}setInt8(r,e){this.view.setInt8(r,e);}setInt16(r,e,t){this.view.setInt16(r,e,t);}setInt32(r,e,t){this.view.setInt32(r,e,t);}setUint8(r,e){this.view.setUint8(r,e);}setUint16(r,e,t){this.view.setUint16(r,e,t);}setUint32(r,e,t){this.view.setUint32(r,e,t);}ext(r){let e=this.byteOffset;if(this.byteOffset+=r,this.byteOffset<=this.view.buffer.byteLength)return e;let t=new Uint8Array(this.view.buffer.byteLength*2);return t.set(new Uint8Array(this.view.buffer)),this.view=new DataView(t.buffer),e;}pushFloat32(r,e){let t=this.ext(4);this.view.setFloat32(t,r,e);}pushFloat64(r,e){let t=this.ext(8);this.view.setFloat64(t,r,e);}pushInt8(r){let e=this.ext(1);this.view.setInt8(e,r);}pushInt16(r,e){let t=this.ext(2);this.view.setInt16(t,r,e);}pushInt32(r,e){let t=this.ext(4);this.view.setInt32(t,r,e);}pushUint8(r){let e=this.ext(1);this.view.setUint8(e,r);}pushUint16(r,e){let t=this.ext(2);this.view.setUint16(t,r,e);}pushUint32(r,e){let t=this.ext(4);this.view.setUint32(t,r,e);}build(){return this.view.buffer.slice(0,this.byteOffset);}},ws=!0,p6=(r=>(r[r.POLYGON=1]="POLYGON",r[r.POLYLINE=2]="POLYLINE",r[r.LINE=3]="LINE",r[r.ARC=4]="ARC",r[r.BEZIER2=5]="BEZIER2",r[r.BEZIER3=6]="BEZIER3",r[r.BOOLEAN_OUTPUT=7]="BOOLEAN_OUTPUT",r[r.BOOLEAN_INTERSECTION=8]="BOOLEAN_INTERSECTION",r[r.BOOLEAN_UNION=9]="BOOLEAN_UNION",r[r.BOOLEAN_DIFF=10]="BOOLEAN_DIFF",r[r.BOOLEAN_RESULT=11]="BOOLEAN_RESULT",r[r.LINES=12]="LINES",r[r.ARCS=13]="ARCS",r[r.BEZIER2S=14]="BEZIER2S",r[r.BEZIER3S=15]="BEZIER3S",r[r.CIRCLE_CW=16]="CIRCLE_CW",r[r.CIRCLE_CCW=17]="CIRCLE_CCW",r[r.POLYGON_GROUP=18]="POLYGON_GROUP",r))(p6||{}),Lm=class{constructor(){this.builder=new d6(),this.containerIndex=0,this.resultIndex=0,this.info={lineNum:0,arcNum:0,circleNum:0,plyNum:0};}pushContainer(r){this.builder.pushUint8(r);}pushUint32(r){this.builder.pushUint32(r,ws);}pushFloat64(r){this.builder.pushFloat64(r,ws);}pushPoint(r){this.builder.pushFloat64(r.x,ws),this.builder.pushFloat64(r.y,ws);}polylineEncode(r){this.info.plyNum++;let e=r.primitives;if(this.pushUint32(e.length),e.length===1){let t=e[0];if(!(t instanceof ee)||t.rx!==t.ry||!ue.eq(Math.abs(t.sweepAngle),360))throw new Error("!(arc instanceof Arc) || arc.rx !== arc.ry || !DoubleKit.eq(Math.abs(arc.sweepAngle), 360)");this.info.circleNum++,this.pushPoint(t.center),this.pushContainer(t.isCCW?17:16),this.pushFloat64(t.rx);return;}this.pushPoint(e[0].start()),e.forEach(t=>{if(t instanceof q)this.info.lineNum++,this.pushContainer(3),this.pushPoint(t.end());else if(t instanceof ee&&t.rx===t.ry&&!ue.eq(Math.abs(t.sweepAngle),360))this.info.arcNum++,this.pushContainer(4),this.pushFloat64(Xe.toRadians(t.sweepAngle)),this.pushPoint(t.end());else throw new Error("not support!");});}polygonEncode(r){if(r instanceof Me)this.pushContainer(2),this.polylineEncode(r);else{if(r.items.length===1)return this.polygonEncode(r.items[0]);if(r instanceof Ht){this.pushContainer(1),this.pushUint32(r.items.length-1),this.polylineEncode(r.items[0]);for(let e=1;e<r.items.length;e++)this.pushContainer(2),this.polylineEncode(r.items[e]);}else if(r instanceof ct)this.pushContainer(18),this.pushUint32(r.items.length),r.items.forEach(e=>this.polygonEncode(e)),this.containerIndex-=r.items.length;else throw new Error("not support");}return this.containerIndex++;}rulesEncode(r,e=!0){let t=new Uint32Array(r.length-1);for(let n=1;n<r.length;n++){let i=r[n];i instanceof Array?t[n-1]=this.rulesEncode(i,!1):t[n-1]=this.polygonEncode(i);}switch(r[0]){case 0:this.pushContainer(8);break;case 1:this.pushContainer(9);break;case 2:this.pushContainer(10);break;default:throw new Error("not support boolean rule!");}return this.pushUint32(t.length),t.forEach(n=>this.pushUint32(n)),e&&this.pushContainer(7),this.containerIndex++;}resultEncode(r,e=this.resultIndex++){this.pushContainer(11),this.pushUint32(e),this.pushUint32(r.items.length),r.items.forEach(t=>this.polygonEncode(t));}build(){return this.builder.build();}};function wo(r){let e=[],t=[],n=[],i=new DataView(r),s=0;for(;s<r.byteLength;){let f=function(p){let m=a(),g=[p];for(let b=0;b<m;b++)g.push(n[a()]);n.push(g);};switch(o()){case 1:n.push(h());break;case 2:n.push(c());break;case 18:n.push(d());break;case 8:f(0);break;case 9:f(1);break;case 10:f(2);break;case 7:for(let b=n.length-1;b>=0;b--){let y=n[b];if(y instanceof Array){e.push(y);break;}}break;case 11:let p=a(),m=a(),g=[];for(let b=0;b<m;b++)switch(o()){case 1:g.push(h());break;case 2:g.push(new Ht([c()]));break;case 18:d().items.forEach(y=>g.push(y));break;default:throw new Error(`not support container type at ${s-1}: ${i.getUint8(s-1)}`);}t.push({group:new ct(g),index:p});break;default:throw new Error(`not support container type at ${s-1}: ${i.getUint8(s-1)}`);}}return{rulesArr:e,results:t};function o(){return i.getUint8(s++);}function a(){let f=i.getUint32(s,ws);return s+=4,f;}function l(){let f=new F(i.getFloat64(s,ws),i.getFloat64(s+8,ws));return s+=16,f;}function u(){let f=i.getFloat64(s,ws);return s+=8,f;}function c(){let f=a(),p=l();if(f===1){let g=o();if(g===17||g===16)return Me.build7([ee.buildCircle(p,u(),g===17?1:0)]);s--;}let m=[];for(let g=0;g<f;g++){let b;switch(o()){case 3:b=l(),m.push(new q(p,b));break;case 4:let y=u();b=l(),m.push(ee.build5(p,b,Xe.toDegrees(y)));break;default:throw new Error(`not support container type at ${s-1}: ${i.getUint8(s-1)}`);}p=b;}return Me.build7(m);}function h(){let f=a(),p=[c()];for(let m=0;m<f;m++){if(o()!==2)throw new Error(`not support container type at ${s-1}: ${i.getUint8(s-1)}`);p.push(c());}return new Ht(p);}function d(){let f=a(),p=[];for(let m=0;m<f;m++){let g=o();if(g===2)p.push(new Ht([c()]));else if(g===1)p.push(h());else throw new Error(`not support container type at ${s-1}: ${i.getUint8(s-1)}`);}return new ct(p);}}function tu(r){let e=new Lm();for(let t of r)t instanceof ct?e.resultEncode(t):e.resultEncode(t.group,t.index);return console.log("booleanResultEncode",e.info),e.build();}function Th(r){let e=new Lm();for(let t of r)e.rulesEncode(t);return console.log("booleanRulesEncode",e.info),e.build();}function wa(r,e){m6(r.iterator(),e);}function m6(r,e){let t=0;for(;r.hasNext();){let n=r.next();e(t++,n);}}var Dm=class{constructor(e){this.lst=e;}iterator(){return new Rh(this.lst);}},Rh=class{constructor(e){this.idx=-1;this.lst=e;}hasNext(){return this.idx<this.lst.length-1;}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug");}};function Mue(r){return new Dm(r);}function d2(r){return new Rh(r);}var Nh=new Error("list is empty"),va=class{constructor(e,t){this.prev=null;this.next=null;this.parent=e,this.item=t;}insertAfter(e){e.next=this.next,this.next=e,e.prev=this,e.next!==null&&(e.next.prev=e);}insertBefore(e){e.prev=this.prev,this.prev=e,e.next=this,e.prev!==null&&(e.prev.next=e);}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev);}set(e){this.item=e;}},Gm=class{constructor(e){this._next=e;}hasNext(){return this._next!==null;}next(){let e=this._next;if(e!==null)return this._next=e.next,e.item;throw new Error("iterator is null");}},Fm=class{constructor(e){this._next=e;}hasNext(){return this._next!==null;}next(){let e=this._next;if(e!==null)return this._next=e.next,e;throw new Error("iterator is null");}},Mn=class{constructor(){this.first=null;this.last=null;this.cnt=0;}add(e){return this.addLast(e);}push(e){return this.addLast(e);}pop(){return this.removeLast();}shift(){return this.removeFirst();}removeFirst(){let e=this.first;if(e===null)throw Nh;return this.remove(e),e.item;}removeLast(){let e=this.last;if(e===null)throw Nh;return this.remove(e),e.item;}addLast(e){if(this.first===null||this.last===null){let t=new va(this,e);return this.first=t,this.last=t,this.cnt++,t;}else return this.insertAfter(this.last,e);}addFirst(e){if(this.first===null||this.last===null){let t=new va(this,e);return this.first=t,this.last=t,this.cnt++,t;}else return this.insertBefore(this.first,e);}getFirst(){if(this.first===null)throw Nh;return this.first.item;}getLast(){if(this.last===null)throw Nh;return this.last.item;}insertAfter(e,t){let n=new va(this,t);return e.insertAfter(n),e===this.last&&(this.last=n),this.cnt++,n;}insertBefore(e,t){let n=new va(this,t);return e.insertBefore(n),e===this.first&&(this.first=n),this.cnt++,n;}remove(e){e.remove(),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev),this.cnt--;}size(){return this.cnt;}clear(){this.first=null,this.last=null,this.cnt=0;}iterator(){return new Gm(this.first);}listIterator(){return new Fm(this.first);}toArray(){let e=new Array(),t=this.first;for(;t!=null;)e.push(t.item),t=t.next;return e;}};function Lh(r){throw new Error("");}var Ea=class{constructor(e,t){this.node1=null;this.node2=null;this.key=e,this.value=t;}},qm=class{constructor(e){this.itors=e;}hasNext(){return this.itors.hasNext();}next(){return this.itors.next().key;}},zm=class{constructor(e){this.itors=e;}hasNext(){return this.itors.hasNext();}next(){return this.itors.next().value;}},Hr=class{constructor(){this.innerList=new Mn();this.innerMap={};}replace(e,t){e.node1!==null&&(e.node1.set(t),t.node1=e.node1),e.node2!==null&&(e.node2.set(t),t.node2=e.node2);}clear(){this.innerList.clear();for(let e in this.innerMap)delete this.innerMap[e];}put(e,t){let n=e.hashCode(),i=new Ea(e,t),s=this.innerMap[n];if(s===void 0)return i.node1=this.innerList.add(i),this.innerMap[n]=i,null;if(s instanceof Ea){if(s.key.equals(e))return this.innerMap[n]=i,this.replace(s,i),s.value;{i.node1=this.innerList.add(i);let o=new Mn();return s.node2=o.add(s),i.node2=o.add(i),this.innerMap[n]=o,null;}}if(s instanceof Mn){let o=null;return wa(s,(a,l)=>l.key.equals(e)?(this.replace(l,i),o=l.value,!1):!0),o===null?(i.node1=this.innerList.add(i),i.node2=s.push(i),null):o;}return Lh(s);}get(e){let t=e.hashCode(),n=this.innerMap[t];if(n===void 0)return null;if(n instanceof Ea)return n.key.equals(e)?n.value:null;if(n instanceof Mn){let i=null;return wa(n,(s,o)=>o.key.equals(e)?(i=o.value,!1):!0),i;}return Lh(n);}containsKey(e){return this.get(e)!==null;}delete(e){e.node1!==null&&e.node1.parent.remove(e.node1),e.node2===null?delete this.innerMap[e.key.hashCode()]:e.node2.parent.remove(e.node2);}remove(e){let t=e.hashCode(),n=this.innerMap[t];if(n===void 0)return null;if(n instanceof Ea)return n.key.equals(e)?(this.delete(n),n.value):null;if(n instanceof Mn){let i=null;return wa(n,(s,o)=>o.key.equals(e)?(i=o.value,this.delete(o),!1):!0),i;}return Lh(n);}computeIfAbsent(e,t){let n=this.get(e);if(n===null){let i=t(e);return this.put(e,i),i;}else return n;}size(){return this.innerList.size();}isEmpty(){return this.innerList.size()===0;}keys(){return new qm(this.innerList.iterator());}values(){return new zm(this.innerList.iterator());}entries(){return this.innerList.iterator();}};var Es=class{constructor(e){this.bheap=new Array();this.count=0;this.comp=e;}size(){return this.count;}add(e){this.count>0?this.siftUp(this.count,e):this.bheap[0]=e,this.count++;}poll(){if(this.count>0){this.count--;let e=this.bheap[0];return this.count>0&&this.siftDown(0,this.bheap[this.count]),e;}else return null;}siftUp(e,t){for(;e>0;){let n=e-1>>>1,i=this.bheap[n];if(this.comp(t,i)>=0)break;this.bheap[e]=i,e=n;}this.bheap[e]=t;}siftDown(e,t){let n=this.count>>>1;for(;e<n;){let i=(e<<1)+1,s=this.bheap[i],o=i+1;if(o<this.count){let a=this.bheap[o];this.comp(s,a)>0&&(i=o,s=a);}if(this.comp(t,s)<=0)break;this.bheap[e]=s,e=i;}this.bheap[e]=t;}};var m2=(n=>(n[n.MAX_COST=0]="MAX_COST",n[n.NODE_PAIR_RATE=1]="NODE_PAIR_RATE",n[n.NODE_RATE=2]="NODE_RATE",n))(m2||{});function Ym(r,e,t){let n=new Pa(r,e);if(!t.vertexNodePairMap.containsKey(n)){let i=new Wm(n.node1,n.node2,t);t.vertexNodePairMap.put(n,i),t.vertexNodePairPriorityQueue.add(i);}}function ru(r,e){let t=e.get(r);return t||(t=new Vm(r),e.put(r,t)),t;}function Xm(r,e){if(r.m===e.m&&r.n===e.n){let t=new Array(r.m*r.n);for(let n=0;n<t.length;n++)t[n]=r.data[n]+e.data[n];return new mn(r.m,e.n,t);}else throw new Error("Two matrices have different dimensions!");}var Vm=class{constructor(e){this.costMatrix=new mn(4,4,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);this.indexSetDict={};this.adjaNodeSet=new Set();this.isBorder=!1;this.vertex=e;}isBorderNode(){return this.isBorder;}determineBorder(){let e=Object.keys(this.indexSetDict);this.isBorder=e.length>1?!0:this.indexSetDict[e[0]].size<this.adjaNodeSet.size;}getAdjaNodeSet(){return this.adjaNodeSet;}addAdjaNode(e){this.adjaNodeSet.add(e);}delAdjaNode(e){this.adjaNodeSet.delete(e);}getCostMatrix(){return this.costMatrix;}addCostMatrix(e){this.costMatrix=Xm(this.costMatrix,e);}getIndexSetDict(){return this.indexSetDict;}addIndexes(e,t){this.indexSetDict[e]||(this.indexSetDict[e]=new Set());for(let n of t)this.indexSetDict[e].add(n);}},Pa=class{constructor(e,t){this.node1=e,this.node2=t;}hashCode(){return Math.ceil(8192*(this.node1.vertex.x+this.node1.vertex.y+this.node1.vertex.z))+Math.ceil(8192*(this.node2.vertex.x+this.node2.vertex.y+this.node2.vertex.z));}equals(e){return this.node1===e.node1&&this.node2===e.node2||this.node1===e.node2&&this.node2===e.node1;}},Wm=class{constructor(e,t,n){this.node1=e,this.node2=t,this.globalData=n,this.contractResult=this.calContractResult(),this.discarded=!1;}calCost(e,t){let n=[t.x,t.y,t.z,1];return Math.max(0,new mn(1,4,n).mul(e).mul(new mn(4,1,n)).data[0]);}isFlipped(e,t,n){let i=Array.from(e.getAdjaNodeSet());for(let s=0;s<i.length-1;s++)if(i[s]!==n){for(let o=s+1;o<i.length;o++)if(i[o]!==n&&pe.normal(e.vertex,i[s].vertex,i[o].vertex).dot(pe.normal(t,i[s].vertex,i[o].vertex))<0)return!0;}return!1;}calContractResult(){if(this.node1.isBorderNode()&&this.node2.isBorderNode())return{newVertex:null,cost:Number.POSITIVE_INFINITY};let e=Xm(this.node1.getCostMatrix(),this.node2.getCostMatrix());if(this.node1.isBorderNode())return this.isFlipped(this.node2,this.node1.vertex,this.node1)?{newVertex:null,cost:Number.POSITIVE_INFINITY}:{newVertex:this.node1.vertex,cost:this.calCost(e,this.node1.vertex)};if(this.node2.isBorderNode())return this.isFlipped(this.node1,this.node2.vertex,this.node2)?{newVertex:null,cost:Number.POSITIVE_INFINITY}:{newVertex:this.node2.vertex,cost:this.calCost(e,this.node2.vertex)};let t=[e.data.slice(0,4),e.data.slice(4,8),e.data.slice(8,12)];for(let o=0;o<3;o++){for(let a=o;a<3;a++)if(t[a][o]!==0){let l=t[a];t[a]=t[o],t[o]=l;}if(t[o][o]!==0)for(let a=o+1;a<3;a++){let l=t[a][o]/t[o][o];for(let u=o;u<4;u++)t[a][u]-=t[o][u]*l;}}let n=this.node1.vertex.add(this.node2.vertex).scale(.5),i=[n.x,n.y,n.z];for(let o=2;o>=0;o--){if(t[o][o]===0)continue;let a=-t[o][3];for(let l=2;l>o;l--)a-=i[l]*t[o][l];i[o]=a/t[o][o];}let s=new pe(i[0],i[1],i[2]);return!this.globalData.originalBBox.isContains(s)||this.isFlipped(this.node1,s,this.node2)||this.isFlipped(this.node2,s,this.node1)?{newVertex:null,cost:Number.POSITIVE_INFINITY}:{newVertex:s,cost:this.calCost(e,s)};}dealNewNode(e,t){if(t===e)return;this.globalData.vertexNodeMap.remove(e.vertex),t.addCostMatrix(e.getCostMatrix());let n=e.getIndexSetDict();for(let i in n)t.addIndexes(Number(i),n[i]);}reconnectNode(e,t){t!==e&&e.getAdjaNodeSet().forEach(n=>{this.globalData.vertexNodePairMap.remove(new Pa(e,n)).discard(),n.delAdjaNode(e),n!==t&&(n.addAdjaNode(t),t.addAdjaNode(n),Ym(t,n,this.globalData)),n.getAdjaNodeSet().forEach(i=>{i!==t&&(this.globalData.vertexNodePairMap.remove(new Pa(n,i)).discard(),Ym(n,i,this.globalData));});});}contract(){this.globalData.vertexNodePairMap.remove(new Pa(this.node1,this.node2)).discard(),this.node1.delAdjaNode(this.node2),this.node2.delAdjaNode(this.node1);let e=ru(this.contractResult.newVertex,this.globalData.vertexNodeMap);this.dealNewNode(this.node1,e),this.dealNewNode(this.node2,e),this.reconnectNode(this.node1,e),this.reconnectNode(this.node2,e);}isDiscarded(){return this.discarded;}discard(){this.discarded=!0;}};function p2(r){let e=new Array();for(let t=0;t<r.length;t+=3)pe.normal(r[t],r[t+1],r[t+2]).isZeroVector()||e.push(r[t],r[t+1],r[t+2]);return e;}function g6(r){let e=new Array(r.length/3);for(let t=0;t<e.length;t++){let n=pe.normal(r[t*3],r[t*3+1],r[t*3+2]).normalize(),i=[n.x,n.y,n.z,-r[t*3].x*n.x-r[t*3].y*n.y-r[t*3].z*n.z];e[t]=new mn(4,1,i).mul(new mn(1,4,i));}return e;}function g2(r,e=0,t=.5){if(r.forEach(a=>{if(a.length%3!==0)throw new Error("The length of vertexes is not a multiple of 3!");}),e===0){let a=new kr();for(let u of r)for(let c of u)a.ext3(c);let l=a.build();t=(Le(l.maxX-l.minX,2)+Le(l.maxY-l.minY,2)+Le(l.maxZ-l.minZ,2))*Le(t,2);}let n=[];r.forEach(a=>{n.push(p2(a));});let i=new Hr();P6(n,i);let s=new Hr(),o=new Es((a,l)=>a.contractResult.cost-l.contractResult.cost);return b6(n,i),x6(i),v6(i,s,o),y6(i,s,o,e,t),w6(i,n),n.forEach((a,l)=>n[l]=p2(a)),n;}function x6(r){let e=r.values();for(;e.hasNext();)e.next().determineBorder();}function b6(r,e){r.forEach(t=>{for(let n=0;n<t.length;n+=3){let i=[ru(t[n],e),ru(t[n+1],e),ru(t[n+2],e)];i[0].addAdjaNode(i[1]),i[0].addAdjaNode(i[2]),i[1].addAdjaNode(i[0]),i[1].addAdjaNode(i[2]),i[2].addAdjaNode(i[0]),i[2].addAdjaNode(i[1]);}});}function y6(r,e,t,n,i){let s=r.size(),o=e.size(),a=t.poll();for(;a&&Number.isFinite(a.contractResult.cost);){if(n===0){if(a.contractResult.cost>=i)return;}else if(n===1){if(1-e.size()/o>=i)return;}else if(n===2&&1-r.size()/s>=i)return;for(a.contract();a&&a.isDiscarded();)a=t.poll();}}function w6(r,e){let t=r.values();for(;t.hasNext();){let n=t.next(),i=n.getIndexSetDict();for(let s in i)i[s].forEach(o=>e[s][o]=n.vertex);}}function v6(r,e,t){let n={vertexNodeMap:r,vertexNodePairMap:e,vertexNodePairPriorityQueue:t,originalBBox:E6(r)},i=r.values();for(;i.hasNext();){let s=i.next();s.getAdjaNodeSet().forEach(o=>Ym(s,o,n));}}function E6(r){let e=r.values(),t=new kr();for(;e.hasNext();){let n=e.next().vertex;t.ext3(n);}return t.build();}function P6(r,e){let t={},n={};r.forEach((i,s)=>{t[s]=g6(i),n[s]=_6(i);});for(let i=0;i<r.length;i++){let s=n[i].entries();for(;s.hasNext();){let o=s.next(),a=new mn(4,4,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let u of o.value)a=Xm(a,t[i][Math.floor(u/3)]);let l=ru(o.key,e);l.addIndexes(i,o.value),l.addCostMatrix(a);}}}function _6(r){let e=new Hr();for(let t=0;t<r.length;t++)e.containsKey(r[t])?e.get(r[t]).add(t):e.put(r[t],new Set([t]));return e;}function oce(r){let e=new Array();for(let t=0;t<r.length;t+=3){let n=pe.normal(r[t],r[t+1],r[t+2]),i=n.length()===0?n:n.normalize();e.push(i,i,i);}return e;}function _a(r,e=Math.PI/5){let t=new Array(r.length/3);for(let o=0;o<t.length;o++)t[o]=pe.normal(r[o*3],r[o*3+1],r[o*3+2]);let n=new Hr();for(let o=0;o<r.length;o+=3)for(let a=0;a<3;a++)n.containsKey(r[o+a])?n.get(r[o+a]).push(t[o/3]):n.put(r[o+a],[t[o/3]]);let i=new Array(r.length),s=Math.cos(e);for(let o=0;o<i.length;o+=3)for(let a=0;a<3;a++)i[o+a]=S6(t[o/3],n.get(r[o+a]),s);return i;}function S6(r,e,t){let n=new Array(e.length);for(let s=0;s<n.length;s++)n[s]=e[s].scale(B6(r,e[s],t));let i=new pe(0,0,0);for(let s of n)i=i.add(s);return i;}function B6(r,e,t){return r.isZeroVector()||e.isZeroVector()?1:I6(r,e)<=t?0:1;}function I6(r,e){return Math.max(-1,Math.min(1,(r.x*e.x+r.y*e.y+r.z*e.z)/(r.length()*e.length())));}var x2=new ArrayBuffer(8*4),Oh=new Float64Array(x2),A6=new Int32Array(x2),Ft=class{static of(e){return new Ft(e>>16&255,e>>8&255,e&255);}static of1(e){return this.of2(e>>16&255,e>>8&255,e&255);}static of2(e,t,n,i=255){return new Ft(e/255,t/255,n/255,i/255);}static of3(e){if(e.startsWith("#")&&(e=e.substr(1)),e.length==3)return new Ft(parseInt(e[0],16)/15,parseInt(e[1],16)/15,parseInt(e[2],16)/15);if(e.length==6)return new Ft(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255);throw new Error("invalid color string");}static of4(e){let t=parseInt(e.r*255+"").toString(16),n=parseInt(e.g*255+"").toString(16),i=parseInt(e.b*255+"").toString(16);return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),("#"+t+n+i).toUpperCase();}static of5(e,t){if(e.startsWith("#")&&(e=e.substr(1)),e.length==3)return new Ft(parseInt(e[0],16)/15,parseInt(e[1],16)/15,parseInt(e[2],16)/15,t);if(e.length==6)return new Ft(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255,t);throw new Error(`invalid color string: ${e!==void 0?e:"undefined"}`);}static of6(e,t){return new Ft(e.r,e.g,e.b,t);}clone(){return new Ft(this.r,this.g,this.b);}constructor(e,t,n,i=1){if(e<0||e>1||t<0||t>1||n<0||n>1||i<0||i>1)throw new Error("r, g, b, and alpha must be between 0 and 1!");this.r=e,this.g=t,this.b=n,this.alpha=i,Oh[0]=e,Oh[1]=t,Oh[2]=n,Oh[3]=i;let s=0;for(let o=0;o<8;o++)s^=A6[o];this.hashed=s;}hashCode(){return this.hashed;}equals(e){return e instanceof Ft?e.r===this.r&&e.g===this.g&&e.b===this.b&&e.alpha===this.alpha:!1;}add(e,t,n,i){return new Ft(Math.max(0,Math.min(1,this.r+e)),Math.max(0,Math.min(1,this.g+t)),Math.max(0,Math.min(1,this.b+n)),Math.max(0,Math.min(1,this.alpha+i)));}mul(e){return new Ft(Math.max(0,Math.min(1,this.r*e)),Math.max(0,Math.min(1,this.g*e)),Math.max(0,Math.min(1,this.b*e)),this.alpha);}getData(){return[this.r,this.g,this.b,this.alpha];}getDataObj(){return{r:this.r,g:this.g,b:this.b,a:this.alpha};}toString(){let e=(this.r*255).toString(16),t=(this.g*255).toString(16),n=(this.b*255).toString(16);return e.length<2&&(e="0"+e),t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),"#"+e.substr(0,2)+t.substr(0,2)+n.substr(0,2);}toRGBA(){let e=this.r*255,t=this.g*255,n=this.b*255;return[e,t,n,this.alpha];}isWHITE(){return this.r===1&&this.g===1&&this.b===1&&this.alpha===1;}},qe=Ft;qe.WHITE=new Ft(1,1,1,1),qe.BLACK=new Ft(0,0,0,1),qe.RED=new Ft(1,0,0,1),qe.GREEN=new Ft(0,1,0,1),qe.BLUE=new Ft(0,0,1,1),qe.YELLOW=new Ft(1,1,0,1),qe.PURPLE=new Ft(1,0,1,1),qe.CYAN=new Ft(0,1,1,1),qe.Gray=Ft.of3("#9966ff"),qe.LightGray=Ft.of3("#d9d9d9"),qe.Silver=Ft.of3("#c0c0c0"),qe.Golden=Ft.of3("#d9d919"),qe.ZERO=new Ft(0,0,0,0),qe.ORANGE=Ft.of3("#ffa500");var ur=(s=>(s[s.USE_COLOR=0]="USE_COLOR",s[s.USE_MATERIAL=1]="USE_MATERIAL",s[s.RELY_ON_OTHER=2]="RELY_ON_OTHER",s[s.FORCE_TO_USE_SINGLE_COLOR=3]="FORCE_TO_USE_SINGLE_COLOR",s[s.WIREFRAME=4]="WIREFRAME",s))(ur||{}),Ps=class{constructor(e,t,n){this.outMatrixParamMap=new Map();e&&(this.color=e),t&&(this.material=t),n&&(this.className=n);}getMaterial(){return this.material;}setMaterial(e){this.material=e;}getColor(){return this.color;}setColor(e){this.color=e;}updateMatrixs(e){for(let t of e.entries())this.outMatrixParamMap.has(t[0])?(this.outMatrixParamMap.set(t[1],this.outMatrixParamMap.get(t[0])),this.outMatrixParamMap.delete(t[0])):this.outMatrixParamMap.set(t[1],{visible:!0,color:qe.BLACK,drawn:!0});}preDraw(){for(let e of this.outMatrixParamMap.values())e.drawn=!1;}markDrawn(e){this.outMatrixParamMap.get(e).drawn=!0;}hadDrawn(e){return this.outMatrixParamMap.get(e).drawn;}removeOutMatrixs(e){for(let t of e)this.outMatrixParamMap.delete(t);this.outMatrixParamMap.size===0&&this.clear();}setOutMatrixVisible(e,t){this.outMatrixParamMap.get(t).visible=e;}setSingleColor(e,t){this.outMatrixParamMap.get(t).color=e;}getSingleColor(e){return this.outMatrixParamMap.get(e).color;}};var wce=5,xi=class{constructor(e,t,n=Float32Array,i=e.STATIC_DRAW,s=null){this.gl=e,this.size=t,this.usage=i,this.arrayConstructor=n,s?(this.updateAllData=s,this.updateSubDataMap=new Map()):this.modify=!1;}vertexAttribPointer(e,t){let n=this.gl;if((this.updateAllData?this.updateSubDataMap.size===0:!this.modify)&&!this.buffer){n.vertexAttrib4f(e,0,0,0,0),n.disableVertexAttribArray(e);return;}this.updateData(n.ARRAY_BUFFER),n.vertexAttribPointer(e,t,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,null);}updateData(e){let t=this.gl,n=this.buffer;if(this.buffer||(this.buffer=t.createBuffer()),t.bindBuffer(e,this.buffer),this.updateAllData){if(this.updateSubDataMap.size===5||!n)this.data=new this.arrayConstructor(this.size),this.updateAllData(),t.bufferData(e,this.data,this.usage),delete this.data,delete this.modify,this.updateSubDataMap.clear();else if(this.updateSubDataMap.size!==0){let i=this.arrayConstructor===Uint16Array?2:4;for(let[s,o]of this.updateSubDataMap)t.bufferSubData(e,i*s,new this.arrayConstructor(o));this.updateSubDataMap.clear();}}else this.modify&&(t.bufferData(e,this.data,this.usage),this.modify=!1);}bindElementBuffer(){this.updateData(this.gl.ELEMENT_ARRAY_BUFFER);}bufferSubData(e,t){this.updateAllData?this.data?(this.data.set(t,e),this.modify=!0):this.updateSubDataMap.size<5&&this.updateSubDataMap.set(e,t):(this.data||(this.data=new this.arrayConstructor(this.size)),this.data.set(t,e),this.modify=!0);}drop(){this.gl.deleteBuffer(this.buffer),delete this.buffer,this.updateAllData||(this.modify=!0);}getSize(){return this.size;}};var Kr=3*Le(2,12);function It(r,e){return r&&(()=>{for(let t of r)t&&e(t);});}var Sa=class{constructor(e,t,n,i,s,o=null){this.bboxFac2=new ke();this._vertexes3D=[null,null,null,null];this.needUpdataVertexes3D=!1;this.leafNum=1;this.renderer=e,this.program=t,this.createObjs=n,this.createBuffer=i,this.createSubtree=s,this.parent=o,this.objs=n(),this.buffer=i(this.renderer,this.objs),this.elementBuffer=new xi(this.renderer.gl,Kr,Uint16Array);}addSubtreeNum(){this.leafNum++;let e=this.parent;for(;e;)e.leafNum++,e=e.parent;}get vertexes3D(){if(this.needUpdataVertexes3D){let e=this.bboxFac2.build();this._vertexes3D[0]=new pe(e.minX,e.minY,0),this._vertexes3D[1]=new pe(e.minX,e.maxY,0),this._vertexes3D[2]=new pe(e.maxX,e.minY,0),this._vertexes3D[3]=new pe(e.maxX,e.maxY,0),this.needUpdataVertexes3D=!1;}return this._vertexes3D;}split(){let e=this.bboxFac2.build(),t,n;e.width()>e.height()?(t="maxX",n="minX"):(t="maxY",n="minY");let i=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(let a of this.objs){let l=a.bbox();l[t]>i&&(i=l[t]),l[n]<s&&(s=l[n]);}this.subtree1=this.createSubtree(this),this.subtree2=this.createSubtree(this),this.addSubtreeNum();let o=s+i;for(let a of this.objs){let l=a.bbox();l[n]+l[t]<o?this.subtree1.addObj(a):this.subtree2.addObj(a);}this.buffer.drop(),this.buffer=null,this.elementBuffer.drop(),this.elementBuffer=null,this.objs=null;}addToSubtree0(e){if(this.subtree1.leafNum*4<this.subtree2.leafNum)this.subtree1.addObj(e);else if(this.subtree2.leafNum*4<this.subtree1.leafNum)this.subtree2.addObj(e);else{let t=e.bbox().center();t.distance2(this.subtree1.bboxFac2.build().center())<t.distance2(this.subtree2.bboxFac2.build().center())?this.subtree1.addObj(e):this.subtree2.addObj(e);}}addToSubtree(e){return this.bboxFac2.ext1(e.bbox()),this.needUpdataVertexes3D=!0,this.objs?!1:(this.addToSubtree0(e),!0);}renderIter(e,t,n,i){if(this.isEmpty())return;let s=new kr();this.vertexes3D.forEach(a=>s.ext3(a.multiply4(e)));let o=s.build();if(!(o.minX+t.x>1||o.maxX+t.x<-1||o.minY+t.y>1||o.maxY+t.y<-1)){if(this.buffer){this.buffer.isEmpty()||i(this);return;}n.push(this.subtree1),n.push(this.subtree2);}}renderCb(e){e.program.render(e.buffer,e.elementBuffer);}render(e,t){let n=new Array();this.renderIter(e,t,n,this.renderCb);let i=n.pop();for(;i;)i.renderIter(e,t,n,this.renderCb),i=n.pop();}clearIter(e){this.buffer?(this.buffer.drop(),this.elementBuffer.drop()):(e.push(this.subtree1),e.push(this.subtree2));}clear(){let e=new Array();this.clearIter(e);let t=e.pop();for(;t;)t.clearIter(e),t=e.pop();this.subtree1=null,this.subtree2=null,this.objs=this.createObjs(),this.bboxFac2.clear(),this.buffer=this.createBuffer(this.renderer,this.objs),this.elementBuffer=new xi(this.renderer.gl,Kr,Uint16Array),this._vertexes3D[0]=null,this._vertexes3D[1]=null,this._vertexes3D[2]=null,this._vertexes3D[3]=null;}trim(){if(!this.parent)return;this.buffer.drop(),this.elementBuffer.drop();let e=this.parent.subtree1===this?this.parent.subtree2:this.parent.subtree1;this.parent.subtree1=e.subtree1,this.parent.subtree2=e.subtree2,this.parent.objs=e.objs,this.parent.bboxFac2=e.bboxFac2,this.parent.buffer=e.buffer,this.parent.elementBuffer=e.elementBuffer,this.parent._vertexes3D=e.vertexes3D;}getBuffer(){return this.buffer;}getElementBuffer(){return this.elementBuffer;}getBBox(){try{return this.bboxFac2.build();}catch(e){return null;}}isEmpty(){return this.buffer&&this.buffer.isEmpty();}};var Tn=class extends Sa{constructor(e,t,n,i=null){super(e,t,()=>new Array(),n,s=>new Tn(e,t,n,s),i);}addObj(e){if(this.addToSubtree(e))return;if(!this.buffer.hasNEmpty(1)){this.split(),this.subtree1.isEmpty()?this.subtree1.addObj(e):this.subtree2.isEmpty()?this.subtree2.addObj(e):this.addObj(e);return;}let t=this.buffer.getNEmpty(1)[0];this.objs[t]=e,e.enterBuffer(t,this);}remove(e,t){let n=e.getId();this.buffer.remove(n),this.elementBuffer.bufferSubData(n*t,new Float32Array(t)),this.objs[n]=null,this.buffer.isEmpty()&&this.trim();}};var kh=null,$m=new ArrayBuffer(8),Ba=new Float64Array($m),Ia=new Uint32Array($m),Uh=new Uint16Array($m);function xn(r,e,t,n){i(r,null,e,t,n);function i(o,a,l,u,c){let h,d,f,p;if(u<c-1){let m=c-u;if(m>50)a===null&&(a=new Array(m+1)),s(o,a,l,u,(u+c)/2|0,c);else{h=o[u],d=u,f=u,p=c;let g=d+1;for(;g<p;){if(f!=p){if(p=p+-1,l(h,o[p])<=0)continue;o[f]=o[p],f=p;continue;}if(l(h,o[g])>=0){d=g,g=d+1;continue;}o[f]=o[g],d=g,f=g,g=d+1;}o[f]=h,i(o,a,l,u,f),i(o,a,l,f+1,c);}}}function s(o,a,l,u,c,h){i(o,a,l,u,c),i(o,a,l,c,h);for(var d=u,f=c,p=0,m=o[d],g=o[f];d<c&&f<h;){var b=l(m,g);isNaN(b)?(a[p++]=g,g=o[++f]):(b<=0&&(a[p++]=m,m=o[++d]),b>=0&&(a[p++]=g,g=o[++f]));}for(;d<c;d++)a[p++]=o[d];for(;f<h;f++)a[p++]=o[f];for(d=u,f=0;f<p;d++,f++)o[d]=a[f];}}var cr=class{static repeat(e,t){let n=new Array(t);for(;t-->0;)n[t]=e;return n.join("");}static lpad(e,t,n){let i=n-e.length;if(i>0){return this.repeat(t,i)+e;}else return e;}static rpad(e,t,n){let i=n-e.length;if(i>0){return e+this.repeat(t,i);}else return e;}static strHashcode(e){if(e.length>0){let t=0;for(let n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0;return t;}else return 0;}static arraycopy(e,t,n,i,s){if(e.length>=t+s&&n.length>=i+s)for(;s-->0;)n[i++]=e[t++];else throw new Error("arraycopy out of range");}static undefAsNull(e){return typeof e=="undefined",null;}static reverse(e,t){for(let n=0,i=e.length-1;i>=0;n++,i--)t[n]=e[i];return t;}static sortAsc(e,t){return e-t;}static xmlDecode(e){let t=e.length,n=new Array(),i=-1;for(let s=0;s<t;s++){let o=e.charAt(s);if(i>=0){if(o===";"){let a=e.substring(i+1,s);switch(a){case"lt":n.push("<");break;case"gt":n.push(">");break;case"quot":n.push('"');break;case"apos":n.push("'");break;case"amp":n.push("&");break;default:if(a.charAt(0)==="#"){let l=parseInt(a.substring(1));n.push(String.fromCharCode(l));}else n.push("&"+a+";");}i=-1;}}else o==="&"?i=s:n.push(o);}return i>=0&&n.push(e.substring(i)),n.join("");}static addAll(e,t){for(let n of t)e.push(n);}static contains(e,t){for(let n of e)if(n.equals(t))return!0;return!1;}static equals(e,t){if(e.length==t.length){for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0;}else return!1;}static remove(e,t){let n=0,i=e.length;for(let s=0;s<i;s++)e[s]===t&&(e.splice(s,1),s--,i--,n++);return n;}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),n=0;n<t.length;n++){var i=t[n].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]);}return e;}static prefix(){if(!kh){let e=this.getUrlVars().version;e?kh="/analyzer/v"+e:kh="/analyzer";}return kh;}static add2objS(e,t,n){if(t in e)return e[t];{let i=n(t);return e[t]=i,i;}}static downloadFile(e,t){let n=document.createElement("a"),i=URL.createObjectURL(t);n.download=e,n.href=i,n.click(),URL.revokeObjectURL(i);}static uuid(){let e=new Array();Ba[0]=new Date().getTime(),e.push(Ia[1].toString(16)),Ba[0]=Math.random(),e.push(Uh[3].toString(16));let t=Uh[2].toString(16);e.push("4"+t.substr(0,3)),Ba[0]=performance.now();let n=Ia[0].toString(16)+Ia[1].toString(16);return e.push("0"+n.substr(0,3)),e.push(n.substr(3)),e.join("-");}static funcCopy(e){return self.eval("("+e.toString()+")");}static NVL(...e){for(let t of e)if(t!==null)return t;return null;}static getFileType(e){var t=e.lastIndexOf(".");return t!=-1?e.substring(t+1,e.length).toLowerCase():"";}static string2Uint8Array(e){let t=[];for(let n=0,i=e.length;n<i;++n)t.push(e.charCodeAt(n));return new Uint8Array(t);}},jm=ArrayBuffer;try{jm=self.HTMLImageElement||jm;}catch(r){}function b2(r){if(typeof r!="object"||r===null||r instanceof Date||r instanceof ArrayBuffer||r instanceof Blob||r instanceof jm)return r;if(Array.isArray(r))return r.map(b2);{let e={};for(let t in r)r.hasOwnProperty(t)&&(e[t]=b2(r[t]));return e;}}function w2(r,e){return C6(r,e,()=>[]);}function C6(r,e,t){let n=r[e];return n!==void 0||(n=t(e),r[e]=n),n;}function _s(r,e){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(e(void 0,r[t],t)===!1)return;}else{let t=0;for(let n in r)if(r.hasOwnProperty(n)){let i=r[n];if(e(n,i,t)===!1)return;t++;}}}var M6=Object.prototype.hasOwnProperty;function v2(r,e){return Se(this,null,function*(){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if((yield e(void 0,r[t],t))===!1)return;}else{let t=0;for(let n in r)if(M6.call(r,n)){let i=r[n];if((yield e(n,i,t))===!1)return;t++;}}});}function the(r,e){let t=0,n=0;return(...i)=>{let s=++t;setTimeout(()=>{let o=performance.now();if(s===t||o-n>=r){try{e(...i);}catch(a){console.log(a);}n=o;}},Math.max(0,r-(performance.now()-n)));};}function Aa(r,e,t=()=>{}){return Se(this,null,function*(){let n=r.length,i=0;for(;i<n;){let s=r.indexOf(`
`,i);s<0&&(s=n);let o=r.substring(i,s);try{if(e(o)===!1)return;}catch(l){console.error(l);}i=s+1;let a=t();a instanceof Promise&&(yield a);}});}function E2(r){let e=!0,t;return()=>((e||t===""||t===" "||t===null||t===void 0||t==="null"||t==="undefined"||t==="NaN")&&(e=!1,t=r()),t);}var Zm=0;function Dh(){Zm===0&&(Zm=Date.now()-performance.now());let r=new Array(),e=Zm+performance.now();Ba[0]=e,r.push(Ia[1].toString(16)),Ba[0]=Math.random(),r.push(Uh[3].toString(16));let t=Uh[2].toString(16);r.push("4"+t.substr(0,3)),Ba[0]=e;let n=Ia[0].toString(16)+Ia[1].toString(16);return r.push("0"+n.substr(0,3)),r.push(n.substr(3)),r.join("-");}var vo=class{constructor(e){this.resources=e,this.idle=[];}acquire(e){this.resources>0?(this.resources--,e()):this.idle.push(e);}acquireSync(){return new Promise(e=>{this.acquire(e);});}release(){let e=this.idle.shift();e?Promise.resolve().then(e):this.resources++;}};function Rn(){if(typeof window!="undefined")return window;if(typeof self!="undefined")return self;if(typeof globalThis!="undefined")return globalThis;if(typeof global!="undefined")return global;}function rhe(r,e,t){let n=r.length+e-1;for(let i=0;i<n;i++){let s=new Array();for(let o=i-e+1;o<=i;o++)s.push(r[o]);if(t(s)===!1)break;}}function nhe(){let r=new Date(),e=r.getFullYear(),t=r.getMonth()+1,n=r.getDate(),i=r.getHours(),s=r.getMinutes(),o=r.getSeconds(),a=r.getMilliseconds();return"["+e+"-"+(t<10?"0"+t:t)+"-"+(n<10?"0"+n:n)+" "+(i<10?"0"+i:i)+":"+(s<10?"0"+s:s)+":"+(o<10?"0"+o:o)+"."+(a<100?a<10?"00"+a:"0"+a:a)+"] ";}function P2(r){return Se(this,null,function*(){let e=typeof r=="string"?new TextEncoder().encode(r):r,t=yield crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(s=>s.toString(16).padStart(2,"0")).join("");});}var Hi=new Uint8Array(123);for(let r=25;r>=0;--r)Hi[48+r]=52+r,Hi[65+r]=r,Hi[97+r]=26+r;Hi[43]=62,Hi[47]=63;function ihe(r){for(var e,t,n=0,i=0,s=r.length,o=new Uint8Array((s*3>>2)-(r[s-2]=="="?1:0)-(r[s-1]=="="?1:0));n<s;n+=4,i+=3)e=Hi[r.charCodeAt(n+1)],t=Hi[r.charCodeAt(n+2)],o[i]=Hi[r.charCodeAt(n)]<<2|e>>4,o[i+1]=e<<4|t>>2,o[i+2]=t<<6|Hi[r.charCodeAt(n+3)];return o;}function she(r,e){if(!r||Object.prototype.toString.call(r)!="[object Date]")return;function t(i,s){let o=-Math.round(i.getTimezoneOffset()/15)*15,a=~~(o/60),l=~~o%60,u="+";return o<0&&(u="-"),u+("00"+a).slice(-2)+s+("00"+l).slice(-2);}let n={"M+":r.getMonth()+1,"d+":r.getDate(),"h+":r.getHours(),"m+":r.getMinutes(),"s+":r.getSeconds(),S:r.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(/y+/,i=>(r.getFullYear()+"").slice(i.length==2?-2:0))),/(Z+)/.test(e)&&(e=e.replace(/Z+/,i=>t(r,i.length==1?":":"")));for(let i of Object.keys(n)){let s=new RegExp(i);s.test(e)&&(e=e.replace(s,o=>o.length==1?n[i]:("00"+n[i]).slice(-2)));}return e;}function ohe(r,e,...t){e=Object.assign({color:"#75de75","font-style":"italic","background-color":"#333",padding:"2px","font-size":"16px"},e),r.startsWith("%c")||(r="%c "+r+" "),console.log(r,JSON.stringify(e).replace(/["{}]/g,"").replace(/,/g,";"),...t);}var y2=new vo(5);function ri(r,e,t){return Se(this,null,function*(){typeof r=="string"&&(/https?:/.test(r)||(r=location.origin+r)),yield y2.acquireSync();try{let n=!1,i=new Promise((o,a)=>setTimeout(()=>{n=!0,a();},t)),s=(()=>Se(this,null,function*(){let o=yield fetch(r,e);return n&&o.body.cancel(),o;}))();return yield Promise.race([s,i]);}finally{y2.release();}});}var T6=(n=>(n[n.UNKNOWN=0]="UNKNOWN",n[n.PERCENT=1]="PERCENT",n[n.LEFT_PAD0=2]="LEFT_PAD0",n))(T6||{}),R6=/(\.?0+)$/,bn=class{static format(e,...t){return this.format1(e,t);}static format1(e,t){let n=this._format(e,t);if(typeof n=="string")return n;throw new Error(this.format("Invalid state on (%d) %s",n,e));}static _format(e,t){let n=[],i=0,s=0,o,a=0,l=0;for(let u=0;u<e.length;u++){let c=e.charAt(u),h=c.charCodeAt(0);switch(i){case 0:h===37?i=1:n.push(c);break;case 1:switch(h){case 100:if(o=t[s++],typeof o=="number")n.push(o.toFixed(0)),i=0;else return u;break;case 102:if(o=t[s++],typeof o=="number")n.push(o.toString()),i=0;else return u;break;case 120:if(o=t[s++],typeof o=="number")n.push((o|0).toString(16)),i=0;else return u;break;case 88:if(o=t[s++],typeof o=="number")n.push((o|0).toString(16).toUpperCase()),i=0;else return u;break;case 115:case 99:o=t[s++],n.push(o===null?"null":o.toString()),i=0;break;case 48:a=u+1,l=-1,i=2;break;case 37:n.push("%"),i=0;break;default:return u;}break;case 2:switch(h){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:l=u;break;case 120:if(l>=a){let d=parseInt(e.substring(a,l+1));if(o=t[s++],typeof o=="number")n.push(cr.lpad((o|0).toString(16),"0",d)),i=0;else return u;}else return u;break;case 88:if(l>=a){let d=parseInt(e.substring(a,l+1));if(o=t[s++],typeof o=="number")n.push(cr.lpad((o|0).toString(16).toUpperCase(),"0",d)),i=0;else return u;}else return u;break;default:return u;}break;default:return u;}}return n.join("");}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1;}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1;}static split(e,t){let n=new Array(),i=0;for(;;){let s=e.exec(t);if(s!==null){let o=e.lastIndex-s[0].length;n.push(t.substring(i,o)),i=e.lastIndex;}else{let o=t.substring(i);Ss.nullOrEmpty(o)||n.push(o);break;}}return n;}static fmtNumber(e){return e.toFixed(5).replace(R6,"");}};var Ss=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error(bn.format("RGB should not nagative and not over 255(0xFF): %X",e));}static normal(e){if(isFinite(e))return e;throw new Error(bn.format("%f is not permitted",e));}static positiveOr0(e){if(e>=0)return e;throw new Error(bn.format("%f must >= 0",e));}static positive(e){if(e>0)return e;throw new Error(bn.format("%f must > 0",e));}static notnull(e){if(e!=null)return e;throw new Error("invalid null value");}static mustnull(e){if(e===null)return null;throw new Error("value must be null");}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e;}static nullOrEmpty(e){return e==null||e.length===0;}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted");}};var zr=class{constructor(e){this.childs=new Array();this._bbox=null;this.parent=null;this.capacity=e;}bbox(){return Ss.notnull(this._bbox);}itor(e,t){for(let n of this.childs)n instanceof zr?n.itor(e+1,t):t(n,e);}debug(e){for(let t of this.childs)console.log(e,t.bbox(),t instanceof zr?"+":"-"),t instanceof zr&&t.debug(e+" |--");}insert(e){let t=this.childs,n=e.bbox();for(let i=0;i<t.length;i++){let s=t[i];if(s instanceof zr&&n.isInside(s.bbox())){s.insert(e),this._bbox=ye.extend2(this._bbox,n);return;}}e instanceof zr&&(e.parent=this),t.length<=this.capacity?t.push(e):(t.push(e),this.splitNode()),this._bbox=ye.extend2(this._bbox,n);}remove(e){if(e instanceof zr&&e.childs.length>0)throw new Error();let t=this.childs,n=e.bbox(),i=new Array();for(let s=0;s<t.length;s++){let o=t[s];if(o===e)return t.splice(s,1),t.length>0?(this.updateBBox(),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox()):this.parent!==null?(this.parent.remove(this),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox()):this._bbox=null,1;o instanceof zr&&n.isInside(o.bbox())&&i.push(o);}if(e instanceof zr)throw new Error();for(let s of i){let o=s.remove(e);if(o===1)return this.childs.length>0&&this.updateBBox(),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox(),1;if(o!==0)throw new Error();}return 0;}updateBBox(){let e=new ke();for(let t of this.childs)e.ext1(t.bbox());this._bbox=e.build();}splitNode(){let e=this.childs,t=e.length,n=-1,i=-1,s=Number.NEGATIVE_INFINITY;for(let u=0;u<t;u++){let c=e[u];for(let h=u+1;h<t;h++){let d=e[h],f=ye.extend2(c.bbox(),d.bbox()).area();f>s&&(s=f,n=u,i=h);}}let o=this.asNode(e[n]),a=this.asNode(e[i]);for(let u=0;u<t;u++)if(u!==n&&u!==i){let c=e[u],h=c.bbox(),d=ye.extend2(o._bbox,h).area(),f=ye.extend2(a._bbox,h).area();d<f?o.insert(c):a.insert(c);}e.length=0;let l=this.parent;l!==null&&l.childs.length<this.capacity?(o.parent=l,a.parent=l,l.childs.push(o),l.childs.push(a),l.remove(this),l.updateBBox()):(o.parent=this,a.parent=this,e.push(o),e.push(a),this.updateBBox()),this.childs.length>0&&this.updateBBox(),o.updateBBox(),a.updateBBox();}asNode(e){if(e instanceof zr)return e;{let t=new zr(this.capacity);return t.insert(e),t;}}},bi=class{constructor(e){this.items=new Set();this.root=new zr(e);}itor(e){this.root.itor(0,e);}search(e){let t=[],n=[];for(n.push(this.root);;){let i=n.shift();if(i!==void 0)for(let s of i.childs)e.isSeparated(s.bbox())||(s instanceof zr?n.push(s):t.push(s));else break;}return t;}insert(e){this.items.add(e),this.root.insert(e);}remove(e){return this.items.delete(e),this.root.remove(e);}bbox(){return this.root.bbox();}debug(){this.root.debug("");}};var nu=class{constructor(e,t,n,i,s){this.unitSize=t,this.size=n,this.long=i;let o=e.gl;i?(this.buffer=new xi(o,n*this.unitSize,Uint32Array,o.STATIC_DRAW,s),this.setVertexIds=(a,l)=>{this.buffer.bufferSubData(a*this.unitSize,new Uint32Array(l));}):(this.buffer=new xi(o,n*this.unitSize,Uint16Array,o.STATIC_DRAW,s),this.setVertexIds=(a,l)=>{this.buffer.bufferSubData(a*this.unitSize,new Uint16Array(l));});}getSize(){return this.size*this.unitSize;}remove(e){this.setVertexIds(e,new Array(this.unitSize).fill(0));}drop(){this.buffer.drop();}};var _he=4294967295,She=0;function N6(r){let e=r.toString(2),t=32-e.length;return t>0?"0".repeat(t)+e:e;}var Nn=class{constructor(e,t=null){this.marked=0;this.emptyStart=0;this.max=-1;this.size=e,this.index=new Uint32Array(Math.ceil(e/32)),t&&(this.index.set(t.index),this.marked=t.marked,this.emptyStart=t.emptyStart);}extSize(e){return new Nn(e,this);}isEmpty(){return this.marked===0;}getMarked(){return this.marked;}getChunk(e){return this.index[e];}isUsed(e){let t=e/32|0,n=this.index[t];return n===4294967295?!0:n===0?!1:(n>>31-e&1)===1;}markUsed(e){let t=e/32|0,n=this.index[t],i=1<<31-e;(n&i)===0&&(this.index[t]=n|i,this.marked++),e>this.max&&(this.max=e);}markRemove(e){let t=e/32|0,n=this.index[t],i=1<<31-e;(n&i)!==0&&(this.index[t]=n&(4294967295^i),this.marked--,e<this.emptyStart&&(this.emptyStart=e));}reset(){this.index.fill(0),this.marked=0,this.emptyStart=0,this.max=-1;}findEmpty(e=1){if(this.size-this.marked<e)return-1;let t=this.index,n=-1,i=!1;for(let s=Math.floor(this.emptyStart/32);s<t.length;s++){let o=t[s];if(o===0){if(n===-1){if(n=s*32,i||(this.emptyStart=n,i=!0),e<=32)return n;}else if((s+1)*32-n>=e)return n;}else if(o!==4294967295){for(let a=31;a>=0;a--)if((o>>a&1)===0){let l=s*32+31-a;if(n===-1&&(n=l,i||(this.emptyStart=n,i=!0)),l-n+1>=e)return n;}else n=-1;}else n=-1;}return-1;}hasNEmpty(e=1){return this.size-this.marked>=e;}findNEmpty(e=1){let t=[];if(this.size-this.marked<e)return t;if(this.size-this.max-1>=e){let i=this.max+e;for(let s=this.max+1;s<=i;s++)t.push(s);return t;}let n=this.index;for(let i=Math.floor(this.emptyStart/32);i<n.length;i++){if(this.marked+t.length===i*32){for(let o=i*32;t.length!==e;o++)t.push(o);return this.emptyStart=t[0],t;}let s=n[i];if(s===0){let o=i*32;if(t.indexOf(o)==-1){if(t.push(o),t.length>=e)return this.emptyStart=t[0],t;{let a=e-t.length;if(a<32){for(let l=0;l<a;l++)t.push(o+l+1);return this.emptyStart=t[0],t;}else for(let l=0;l<31;l++)t.push(o+l+1);}}}else if(s!==4294967295){for(let o=31;o>=0;o--)if((s>>o&1)===0){let a=i*32+31-o;if(t.indexOf(a)==-1&&(t.push(a),t.length==e))return this.emptyStart=t[0],t;}}}return this.emptyStart=t.length===0?this.size:t[0],[];}debug(){let e=[],t=this.index;for(let n=0;n<t.length;n++)e.push(N6(t[n]));console.log(e.join(" "));}};var The=4,Qr=class{constructor(e,t,n,i){this.buffers=new Array();this.index=new Nn(t),this.unitSizes=n;let s=e.gl;n.forEach((o,a)=>this.buffers.push(new xi(s,t*o,Float32Array,s.STATIC_DRAW,i[a])));}getBuffer(e){return this.buffers[e];}setData(e,t,n){this.buffers[e].bufferSubData(t*this.unitSizes[e],n);}getSize(){return this.index.size;}isEmpty(){return this.index.isEmpty();}hasNEmpty(e){return this.index.hasNEmpty(e);}getNEmpty(e){let t=this.index.findNEmpty(e);for(let n of t)this.index.markUsed(n);return t;}remove(e){this.index.markRemove(e);for(let t=0;t<this.unitSizes.length;t++)this.buffers[t].bufferSubData(e*this.unitSizes[t],new Float32Array(this.unitSizes[t]));}drop(){for(let e of this.buffers)e.drop();this.buffers.length=0,this.index.reset();}};var Ca=`
    precision highp float;
    precision highp int;

    uniform mat4 u_matrix;
	uniform mat4 u_MVPmatrix;
	uniform vec2 u_viewOffset;

	attribute float a_order;
	
	void calPosition(vec4 position) {
		gl_Position = u_MVPmatrix * u_matrix * position;
		gl_Position.xy += u_viewOffset * gl_Position.w;
		gl_Position.z = a_order / ${Le(2,21)}.0 * gl_Position.w;
	}
`,Gh=`
    precision highp float;
    precision highp int;
`,S2=1,Ma=[S2],Eo={order:0},At=[0,1,2],Ut=[0,1,2,3],er=[0,1,2,2,3,0],Bs=class{constructor(e,t,n){this.attrSettings=[];this.disabledAttrLocs=new Set();this.renderer=e,this.program=e.createProgram(t,n),this.u_matrixLoc=e.getUniformLoc(this.program,"u_matrix"),this.u_MVPmatrixLoc=e.getUniformLoc(this.program,"u_MVPmatrix"),this.u_viewOffsetLoc=e.getUniformLoc(this.program,"u_viewOffset"),this.addAttrSetting("a_order",Eo.order,S2);}addAttrSetting(e,t,n){let i=this.renderer.getAttrLoc(this.program,e);return this.attrSettings.push({loc:i,bufferIndex:t,unitSize:n}),i;}enable(e){this.disabledAttrLocs.delete(e);}disable(e){this.disabledAttrLocs.add(e);}transBaseCameraData(e){let t=this.renderer.gl;t.useProgram(this.program),t.uniformMatrix4fv(this.u_MVPmatrixLoc,!1,new Float32Array(e.getRenderMatrix().data));}transMatrixData(e){let t=this.renderer.gl;t.useProgram(this.program),t.uniformMatrix4fv(this.u_matrixLoc,!1,new Float32Array(e.data));}transViewOffset(e,t){let n=this.renderer.gl;n.useProgram(this.program),n.uniform2fv(this.u_viewOffsetLoc,[e,t]);}renderCb(e,t){let n=this.renderer.gl;n.useProgram(this.program);for(let i of this.attrSettings)n.enableVertexAttribArray(i.loc),e.getBuffer(i.bufferIndex).vertexAttribPointer(i.loc,i.unitSize);for(let i of this.disabledAttrLocs)n.disableVertexAttribArray(i);t();for(let i of this.attrSettings)n.disableVertexAttribArray(i.loc);}};var L6=Ca+`
    attribute vec3 a_position; // [x, y, style]

    void main() {
        if (a_position.z == 0.0) {
            return;
		}
		calPosition(vec4(a_position.xy, 0, 1));
		gl_PointSize = 1.0;
    }
`,O6="void main() {gl_FragColor = vec4(0, 0, 0, 1);}",B2=3,A2=[...Ma,B2],Hm=Object.assign({position:1},Eo);function Fh(r,e){return new Ta(r,Kr/3,e);}var I2=class extends Bs{constructor(t){super(t,L6,O6);this.addAttrSetting("a_position",Hm.position,B2);}transRenderMode(t){this.renderMode=t;}render(t){this.renderCb(t,()=>{let n=this.renderer.gl;this.renderMode===4?(t.lineElementBuffer.buffer.bindElementBuffer(),n.drawElements(n.LINES,t.lineElementBuffer.getSize(),t.lineElementBuffer.long?n.UNSIGNED_INT:n.UNSIGNED_SHORT,0)):(t.triangleElementBuffer.buffer.bindElementBuffer(),n.drawElements(n.TRIANGLES,t.triangleElementBuffer.getSize(),t.triangleElementBuffer.long?n.UNSIGNED_INT:n.UNSIGNED_SHORT,0));});}renderPoints(t){this.renderCb(t,()=>{let n=this.renderer.gl;n.drawArrays(n.POINTS,0,t.getSize());});}renderOne(t,n=this.renderMode){let i=this.renderMode;this.transRenderMode(n);let s=t.getInLeaf().getBuffer(),o=t.getStartId(),a=t.getPointNum();this.renderCb(s,()=>{let l=this.renderer.gl;this.renderMode===4?(s.lineElementBuffer.buffer.bindElementBuffer(),l.drawElements(l.LINES,a*2,s.lineElementBuffer.long?l.UNSIGNED_INT:l.UNSIGNED_SHORT,o*2*(s.lineElementBuffer.long?4:2))):(s.triangleElementBuffer.buffer.bindElementBuffer(),l.drawElements(l.TRIANGLES,a*3,s.triangleElementBuffer.long?l.UNSIGNED_INT:l.UNSIGNED_SHORT,o*3*(s.triangleElementBuffer.long?4:2)));}),this.transRenderMode(i);}};var Ta=class extends Qr{constructor(t,n,i){super(t,n,A2,[()=>{},It(i,o=>o.updatePosition())]);let s=n>Le(2,16);this.triangleElementBuffer=new nu(t,3,n,s,It(i,o=>o.updateTriangleElementBuffer())),this.lineElementBuffer=new nu(t,2,n,s,It(i,o=>o.updateLineElementBuffer()));}remove(t){super.remove(t),this.triangleElementBuffer.remove(t),this.lineElementBuffer.remove(t);}drop(){super.drop(),this.triangleElementBuffer.drop(),this.lineElementBuffer.drop();}};var Is=class extends Sa{constructor(e,t,n,i=null){super(e,t,()=>new Set(),n,s=>new Is(e,t,n,s),i);}addObj(e){if(this.addToSubtree(e))return;let t=e.getPointNum();if(!this.buffer.hasNEmpty(t))if(this.objs.size===0)this.buffer.drop(),this.buffer=new Ta(this.renderer,t,this.objs);else{this.split(),this.subtree1.isEmpty()?this.subtree1.addObj(e):this.subtree2.isEmpty()?this.subtree2.addObj(e):this.addObj(e);return;}let n=this.buffer.getNEmpty(t);e.enterBuffer(n,this),this.objs.add(e);}remove(e){this.objs.delete(e),this.buffer.isEmpty()&&this.trim();}renderPointsCb(e){e.program.renderPoints(e.buffer);}renderPoints(e,t){let n=new Array();this.renderIter(e,t,n,this.renderPointsCb);let i=n.pop();for(;i;)i.renderIter(e,t,n,this.renderPointsCb),i=n.pop();}};var Ln=class{constructor(e,t,n){this.inLeaf=null;this.id=-1;this.style=1;this._bbox=e,t&&(this.color=t),typeof n=="number"&&(this.order=n);}getInLeaf(){return this.inLeaf;}render(){this.inLeaf.program.renderOne(this);}bbox(){return this._bbox;}isRemoved(){return this.inLeaf===null;}remove(e){this.inLeaf!==null&&(this.inLeaf.remove(this,e),this.inLeaf=null,this.id=-1);}getId(){return this.id;}setData(e,t,n){let i=[];for(let s=0;s<t;s++)i.push(...n);this.inLeaf.getBuffer().setData(e,this.id,i);}updateColorOrder(){this.order!==void 0&&this.updateOrder(),this.color&&this.updateColor();}getColor(){return this.color;}getOrder(){return this.order;}};var Cs=Ca+`
	uniform int u_renderMode;
	uniform mat4 u_MVmatrix;
	uniform vec3 u_eyePosition;
	
    uniform float u_px_length;

	attribute vec4 a_color;
	attribute float a_index;

	varying vec3 v_normal;
	varying vec3 v_surfaceToEye;
    varying vec4 v_color;
	
	void preMaterial(vec4 position) {
		mat4 matrix = u_MVmatrix * u_matrix;
		v_normal = mat3(matrix) * vec3(0, 0, 1);
		vec4 pos = matrix * position;
		v_surfaceToEye = u_eyePosition - pos.xyz / pos.w;
	}
	
	void calParm(vec2 pos) {
		vec4 position = vec4(pos, 0, 1);
		calPosition(position);
		v_color = a_color;

        if(u_renderMode == 1) {
            preMaterial(position);
        }
	}
`,Ms=Gh+`
	uniform int u_renderMode;

	uniform vec4 u_color;

	uniform vec3 u_ambientFactor;
	uniform vec3 u_diffuseFactor;
	uniform vec3 u_specularFactor;
	uniform float u_shininess;
	uniform float u_alpha;
	uniform float u_shadingRate;

	uniform vec3 u_ambientLightColor;
	uniform vec3 u_directLightDir;
	uniform vec3 u_directLightColor;

    uniform float u_px_length;

	uniform bool u_transparent;

	varying vec3 v_normal;
	varying vec3 v_surfaceToEye;
    varying vec4 v_color;

	void renderUseMaterial(vec3 ambientFactor, vec3 diffuseFactor, vec3 specularFactor, float alpha) {
		vec3 ambient = ambientFactor * u_ambientLightColor;
	
		vec3 normal = normalize(v_normal);
		vec3 directLightDir = normalize(u_directLightDir);
		vec3 diffuse = abs(dot(normal , directLightDir)) * diffuseFactor * u_directLightColor;
	
		vec3 reflect = -2.0 * normal * dot(directLightDir, normal) + directLightDir;
		vec3 surfaceToEye = normalize(v_surfaceToEye);
		float lightToEyeFactor = abs(dot(reflect, surfaceToEye));
		vec3 specular = specularFactor * u_directLightColor * pow(lightToEyeFactor, 300.0) * u_shininess * 0.1;
	
		gl_FragColor.rgb = ambient + diffuse + specular;
		gl_FragColor.a = alpha;
	}

	void calColor() {
		if(u_renderMode == 1) {
			if(v_color.r + v_color.g + v_color.b + v_color.a == 0.0) {
				renderUseMaterial(u_ambientFactor, u_diffuseFactor, u_specularFactor, u_alpha);
			// varying \u53D8\u91CF\u63D2\u503C\u6709\u8BEF\u5DEE\uFF0C\u56E0\u6B64\u4E0D\u4F7F\u7528\u662F\u5426\u7B49\u4E8E 1 \u5224\u65AD\u662F\u5426\u900F\u660E
			} else if((u_transparent && v_color.a < 0.999) || (!u_transparent && v_color.a > 0.999)){
				renderUseMaterial(vec3(0), v_color.rgb, vec3(0), v_color.a);
			} else {
				discard;
			}
        } else {
			if(v_color.r + v_color.g + v_color.b + v_color.a == 0.0) {
				gl_FragColor = u_color;
			} else if((u_transparent && v_color.a < 0.999) || (!u_transparent && v_color.a > 0.999)){
				gl_FragColor = v_color;
			} else {
				discard;
			}
		}
		gl_FragColor.a *= u_shadingRate;
	}
`;function As(r){return new Float32Array([r.r,r.g,r.b]);}var C2=4,M2=1,Ts=[...Ma,M2,C2],yi=Object.assign({index:1,color:2},Eo),wi=class extends Bs{constructor(t,n,i){super(t,n,i);this.u_renderModeLoc=t.getUniformLoc(this.program,"u_renderMode"),this.u_colorLoc=t.getUniformLoc(this.program,"u_color"),this.u_MVmatrixLoc=t.getUniformLoc(this.program,"u_MVmatrix"),this.u_eyePositionLoc=t.getUniformLoc(this.program,"u_eyePosition"),this.u_ambientFactorLoc=t.getUniformLoc(this.program,"u_ambientFactor"),this.u_diffuseFactorLoc=t.getUniformLoc(this.program,"u_diffuseFactor"),this.u_specularFactorLoc=t.getUniformLoc(this.program,"u_specularFactor"),this.u_shininessLoc=t.getUniformLoc(this.program,"u_shininess"),this.u_alphaLoc=t.getUniformLoc(this.program,"u_alpha"),this.u_shadingRateLoc=t.getUniformLoc(this.program,"u_shadingRate"),this.u_ambientLightColorLoc=t.getUniformLoc(this.program,"u_ambientLightColor"),this.u_directLightDirLoc=t.getUniformLoc(this.program,"u_directLightDir"),this.u_directLightColorLoc=t.getUniformLoc(this.program,"u_directLightColor"),this.u_pxLengthLoc=t.getUniformLoc(this.program,"u_px_length"),this.u_transparentLoc=t.getUniformLoc(this.program,"u_transparent"),this.addAttrSetting("a_index",yi.index,M2),this.a_colorLoc=this.addAttrSetting("a_color",yi.color,C2);}transSceneData(t,n){this.transBaseCameraData(n);let i=this.renderer.gl;i.useProgram(this.program),i.uniformMatrix4fv(this.u_MVmatrixLoc,!1,new Float32Array(n.getViewMatrix().data)),i.uniform3fv(this.u_ambientLightColorLoc,As(t.ambientLight.color)),i.uniform3fv(this.u_directLightColorLoc,As(t.directionalLight.color));let s=t.directionalLight.direction();i.uniform3fv(this.u_directLightDirLoc,new Float32Array([s.x,s.y,s.z]));let o=n.getRelativePosition();i.uniform3fv(this.u_eyePositionLoc,new Float32Array([o.x,o.y,o.z]));}transPlaneData(t,n,i,s){let o=this.renderer.gl;if(o.useProgram(this.program),o.uniform1f(this.u_pxLengthLoc,i),o.uniform1f(this.u_shadingRateLoc,s),t.isColorful?this.enable(this.a_colorLoc):this.disable(this.a_colorLoc),n)o.uniform4fv(this.u_colorLoc,[n.r,n.g,n.b,n.alpha]);else{let a=t.getMaterial();if(!a)return;o.uniform3fv(this.u_ambientFactorLoc,As(a.ambient)),o.uniform3fv(this.u_diffuseFactorLoc,As(a.diffuse)),o.uniform3fv(this.u_specularFactorLoc,As(a.specular)),o.uniform1f(this.u_shininessLoc,a.shininess),o.uniform1f(this.u_alphaLoc,a.alpha);}}transRenderMode(t){let n=this.renderer.gl;n.useProgram(this.program),n.uniform1i(this.u_renderModeLoc,t===0||t===3?0:t===1?1:t===4?2:-1);}transTransparent(t){let n=this.renderer.gl;n.useProgram(this.program),n.uniform1i(this.u_transparentLoc,t?1:0);}};var k6=Cs+`
    attribute vec4 a_position12;
    attribute vec4 a_position34;
	attribute float a_style;

    //value == refer?1.0:0.0;
    float getValue(float value,float refer){
        return step(abs(sign(value - refer)),0.0);
    }

    void main() {
        if (a_style == 0.0) {
            return;
        }
		if(u_renderMode == 2){
			if(a_index == 0.0) {
				calParm(a_position12.xy + normalize(a_position12.xy - a_position12.zw) * u_px_length + normalize(a_position12.xy - a_position34.zw) * u_px_length);
			} else if(a_index == 1.0) {
				calParm(a_position12.zw + normalize(a_position12.zw - a_position34.xy) * u_px_length + normalize(a_position12.zw - a_position12.xy) * u_px_length);
			} else if(a_index == 2.0) {
				calParm(a_position34.xy + normalize(a_position34.xy - a_position34.zw) * u_px_length + normalize(a_position34.xy - a_position12.zw) * u_px_length);
			} else {
				calParm(a_position34.zw + normalize(a_position34.zw - a_position12.xy) * u_px_length + normalize(a_position34.zw - a_position34.xy) * u_px_length);
			}
		}else {
			calParm(a_position12.xy * getValue(0.0, a_index) + a_position12.zw * getValue(1.0, a_index) + a_position34.xy * getValue(2.0, a_index) + a_position34.zw * getValue(3.0, a_index));
		}
	}
`,U6=Ms+`
    void main() {
		calColor();
    }
`,T2=4,R2=4,N2=1,Yr=Object.assign({position12:3,position34:4,style:5},yi);function O2(r,e,t=Kr/er.length){return new Qr(r,t,[...Ts,T2,R2,N2].map(n=>n*Ut.length),[It(e,n=>n.updateOrder()),It(e,n=>n.updateIndex()),It(e,n=>n.updateColor()),It(e,n=>n.updatePosition12()),It(e,n=>n.updatePosition34()),It(e,n=>n.updateStyle())]);}var L2=class extends wi{constructor(e){super(e,k6,U6),this.addAttrSetting("a_position12",Yr.position12,T2),this.addAttrSetting("a_position34",Yr.position34,R2),this.addAttrSetting("a_style",Yr.style,N2);}render(e,t){this.renderCb(e,()=>{let n=this.renderer.gl;t.bindElementBuffer(),n.drawElements(n.TRIANGLES,t.getSize(),n.UNSIGNED_SHORT,0);});}renderOne(e){let t=e.getInLeaf();this.renderCb(t.getBuffer(),()=>{let n=this.renderer.gl;t.getElementBuffer().bindElementBuffer(),n.drawElements(n.TRIANGLES,er.length,n.UNSIGNED_SHORT,e.getId()*er.length*2);});}};var On=class extends Ln{constructor(t,n,i,s,o,a,l){super(o,a,l);this.point1=t,this.point2=n,this.point3=i,this.point4=s;}static build(t,n,i){let s=t.reduce((o,a)=>o.ext2(a),new ke()).build();return new On(s.LL(),s.LR(),s.UR(),s.UL(),s,n,i);}static enterBBoxBuffer(t,n,i=0){let s=t.LL(),o=t.LR(),a=t.UR(),l=t.UL(),u=[s.x,s.y,o.x,o.y],c=[a.x,a.y,l.x,l.y];n.setData(Yr.position12,i,[...u,...u,...u,...u]),n.setData(Yr.position34,i,[...c,...c,...c,...c]),n.setData(Yr.style,i,[1,1,1,1]),n.setData(Yr.index,i,[0,1,2,3]);}enterBuffer(t,n){this.id=t,this.inLeaf=n,this.updatePosition12(),this.updatePosition34(),this.updateStyle(),this.updateIndex(),this.inLeaf.getElementBuffer().bufferSubData(t*er.length,er.map(i=>t*Ut.length+i)),this.updateColorOrder();}updateIndex(){this.inLeaf.getBuffer().setData(Yr.index,this.id,Ut);}updatePosition12(){this.setData(Yr.position12,Ut.length,[this.point1.x,this.point1.y,this.point2.x,this.point2.y]);}updatePosition34(){this.setData(Yr.position34,Ut.length,[this.point3.x,this.point3.y,this.point4.x,this.point4.y]);}updateStyle(){this.setData(Yr.style,Ut.length,[this.style]);}updateOrder(){this.setData(Yr.order,Ut.length,[this.order||0]);}updateColor(){let t=this.color;t?this.setData(Yr.color,Ut.length,[t.r,t.g,t.b,t.alpha]):this.setData(Yr.color,Ut.length,[0,0,0,0]);}};var qh=class{constructor(e){this.managerIndexs=[];this.ableInter=!0;this.scene=e;}forEachManagerIndex(e){this.managerIndexs.forEach(e);}newManagerIndex(){let e={rtree:this.ableInter?null:new bi(10),polygonManager:new Is(this.scene.renderer,this.scene.polygonProgram,Fh),quadManager:this.ableInter?null:new Tn(this.scene.renderer,this.scene.quadProgram,O2)};return this.managerIndexs.push(e),e;}getManagerIndex(e){let t=e.bbox();for(let n of this.managerIndexs)if(this.ableInter||n.rtree.search(t).length===0)return n;return this.newManagerIndex();}isEmpty(){return this.managerIndexs.length===0;}renderUsingStencil(e,t,n,i,s){let o=e.renderer;o.enterStencilConfig();let a=o.gl;if(t===4)for(let l of this.managerIndexs)a.stencilOp(a.KEEP,a.INCR,a.INCR),a.stencilFunc(a.NOTEQUAL,0,127),a.colorMask(!1,!1,!1,!1),o.setDepthMask(!1),l.polygonManager.render(n,i),a.stencilOp(a.KEEP,a.REPLACE,a.REPLACE),a.stencilFunc(a.NOTEQUAL,64,63),a.colorMask(!0,!0,!0,!0),o.setDepthMask(!0),this.ableInter?(On.enterBBoxBuffer(l.polygonManager.getBBox(),e.quadBuffer),e.quadProgram.render(e.quadBuffer,e.quadElementBuffer)):(l.quadManager.render(n,i),s&&(a.colorMask(!1,!1,!1,!1),e.fullScreenProgram.render(),a.colorMask(!0,!0,!0,!0)));else for(let l of this.managerIndexs)a.stencilOpSeparate(a.FRONT,a.KEEP,a.INCR_WRAP,a.INCR_WRAP),a.stencilOpSeparate(a.BACK,a.KEEP,a.DECR_WRAP,a.DECR_WRAP),a.stencilFunc(a.NOTEQUAL,0,127),a.colorMask(!1,!1,!1,!1),o.setDepthMask(!1),l.polygonManager.render(n,i),a.stencilOp(a.KEEP,a.REPLACE,a.REPLACE),a.stencilFunc(a.NOTEQUAL,64,63),a.colorMask(!0,!0,!0,!0),o.setDepthMask(!0),this.ableInter?(On.enterBBoxBuffer(l.polygonManager.getBBox(),e.quadBuffer),e.quadProgram.render(e.quadBuffer,e.quadElementBuffer)):(l.quadManager.render(n,i),s&&(a.colorMask(!1,!1,!1,!1),e.fullScreenProgram.render(),a.colorMask(!0,!0,!0,!0)));o.leaveStencilConfig();}renderPointsUsingStencil(e,t,n,i){if(t!==0&&t!==4)return;let s=e.renderer;s.enterStencilConfig();let o=s.gl;for(let a of this.managerIndexs)o.stencilFunc(o.EQUAL,64,255),o.stencilOp(o.KEEP,o.INVERT,o.INVERT),o.colorMask(!1,!1,!1,!1),e.renderer.setDepthMask(!1),a.polygonManager.renderPoints(n,i),o.stencilFunc(o.EQUAL,191,255),o.stencilOp(o.KEEP,o.INVERT,o.INVERT),o.colorMask(!0,!0,!0,!0),e.renderer.setDepthMask(!0),this.ableInter?(On.enterBBoxBuffer(a.polygonManager.getBBox(),e.quadBuffer),e.quadProgram.render(e.quadBuffer,e.quadElementBuffer)):a.quadManager.render(n,i);s.leaveStencilConfig();}drawStencil(e,t){this.forEachManagerIndex(n=>n.polygonManager.render(e,t));}clear(){this.forEachManagerIndex(e=>{var t;e.polygonManager.clear(),(t=e.quadManager)==null||t.clear();}),this.managerIndexs.length=0;}};var zh=class extends Tn{renderIter(e,t,n){if(this.isEmpty())return;let i=new kr();this.vertexes3D.forEach(o=>i.ext3(o.multiply4(e)));let s=i.build();if(!(s.minX+t.x>1||s.maxX+t.x<-1||s.minY+t.y>1||s.maxY+t.y<-1)){if(this.buffer){for(let o of this.objs)o.render();return;}n.push(this.subtree1),n.push(this.subtree2);}}};var D6=Ca+`
	uniform int u_renderMode;
	uniform mat4 u_MVmatrix;
	uniform vec3 u_eyePosition;

	attribute vec4 a_leftPosition;  // [downx, downy, upx, upy]
	attribute vec4 a_rightPosition;  // [downx, downy, upx, upy]
	attribute float a_index;

	varying vec3 v_normal;
	varying vec3 v_surfaceToEye;
	
    varying vec2 v_texCoord;

	void preMaterial(vec4 position) {
		mat4 matrix = u_MVmatrix * u_matrix;
		v_normal = mat3(matrix) * vec3(0, 0, 1);
		vec4 pos = matrix * position;
		v_surfaceToEye = u_eyePosition - pos.xyz / pos.w;
	}
	
	void calParm(vec2 pos) {
		vec4 position = vec4(pos, 0, 1);
		calPosition(position);
		
        if(u_renderMode == 1) {
            preMaterial(position);
        }
	}

    void main(){
        vec2 position;
		if(a_index == 0.0){
            position = a_leftPosition.xy;
			v_texCoord = vec2(0, 1);
        }else if(a_index == 1.0){
            position = a_rightPosition.xy;
			v_texCoord = vec2(1, 1);
        }else if(a_index == 2.0){
            position = a_rightPosition.zw;
			v_texCoord = vec2(1, 0);
        }else if(a_index == 3.0){
            position = a_leftPosition.zw;
			v_texCoord = vec2(0, 0);
        }

        calParm(position);
    }
`,G6=Gh+`
	uniform sampler2D u_texture;

	uniform int u_renderMode;

	uniform float u_shininess;

	uniform vec3 u_ambientLightColor;
	uniform vec3 u_directLightDir;
	uniform vec3 u_directLightColor;

	uniform float u_alpha;

	uniform bool u_transparent;

	varying vec3 v_normal;
	varying vec3 v_surfaceToEye;
    varying vec2 v_texCoord;

	void renderUseMaterial(vec3 ambientFactor, vec3 diffuseFactor, vec3 specularFactor, float alpha) {
		vec3 ambient = ambientFactor * u_ambientLightColor;
	
		vec3 normal = normalize(v_normal);
		vec3 directLightDir = normalize(u_directLightDir);
		vec3 diffuse = abs(dot(normal , directLightDir)) * diffuseFactor * u_directLightColor;
	
		vec3 reflect = -2.0 * normal * dot(directLightDir, normal) + directLightDir;
		vec3 surfaceToEye = normalize(v_surfaceToEye);
		float lightToEyeFactor = abs(dot(reflect, surfaceToEye));
		vec3 specular = specularFactor * u_directLightColor * pow(lightToEyeFactor, 300.0) * u_shininess * 0.1;
	
		gl_FragColor.rgb = ambient + diffuse + specular;
		gl_FragColor.a = alpha;
	}

    void main() {
        gl_FragColor = texture2D(u_texture, v_texCoord);
		float alpha = gl_FragColor.a * u_alpha;
		gl_FragColor.a = alpha;
		if(u_renderMode == 1) {
			if(alpha > 0.001 && ((u_transparent && alpha < 0.999) || (!u_transparent && alpha > 0.999))){
				renderUseMaterial(gl_FragColor.rgb, gl_FragColor.rgb, gl_FragColor.rgb, alpha);
			} else {
				discard;
			}
        } else if(alpha < 0.001){
			discard;
		}
    }
`,k2=1,U2=4,D2=4,Rs=Object.assign({index:1,leftPosition:2,rightPosition:3},Eo);function F2(r,e){return new Qr(r,Kr/er.length,[...Ma,k2,U2,D2].map(t=>t*Ut.length),[It(e,t=>t.updateOrder()),It(e,t=>t.updateIndex()),It(e,t=>t.updateLeftPosition()),It(e,t=>t.updateRightPosition())]);}var G2=class extends Bs{constructor(t){super(t,D6,G6);this.addAttrSetting("a_index",Rs.index,k2),this.addAttrSetting("a_leftPosition",Rs.leftPosition,U2),this.addAttrSetting("a_rightPosition",Rs.rightPosition,D2),this.u_textureLoc=t.getUniformLoc(this.program,"u_texture"),this.u_renderModeLoc=t.getUniformLoc(this.program,"u_renderMode"),this.u_MVmatrixLoc=t.getUniformLoc(this.program,"u_MVmatrix"),this.u_eyePositionLoc=t.getUniformLoc(this.program,"u_eyePosition"),this.u_shininessLoc=t.getUniformLoc(this.program,"u_shininess"),this.u_ambientLightColorLoc=t.getUniformLoc(this.program,"u_ambientLightColor"),this.u_directLightDirLoc=t.getUniformLoc(this.program,"u_directLightDir"),this.u_directLightColorLoc=t.getUniformLoc(this.program,"u_directLightColor"),this.u_alphaLoc=t.getUniformLoc(this.program,"u_alpha"),this.u_transparentLoc=t.getUniformLoc(this.program,"u_transparent");}transSceneData(t,n){this.transBaseCameraData(n);let i=this.renderer.gl;i.useProgram(this.program),i.uniformMatrix4fv(this.u_MVmatrixLoc,!1,new Float32Array(n.getViewMatrix().data)),i.uniform3fv(this.u_ambientLightColorLoc,As(t.ambientLight.color)),i.uniform3fv(this.u_directLightColorLoc,As(t.directionalLight.color));let s=t.directionalLight.direction();i.uniform3fv(this.u_directLightDirLoc,new Float32Array([s.x,s.y,s.z]));let o=n.getRelativePosition();i.uniform3fv(this.u_eyePositionLoc,new Float32Array([o.x,o.y,o.z]));}transPlaneData(t){let n=t.getMaterial();if(!n)return;let i=this.renderer.gl;i.useProgram(this.program),i.uniform1f(this.u_shininessLoc,n.shininess);}transRenderMode(t){let n=this.renderer.gl;n.useProgram(this.program),n.uniform1i(this.u_renderModeLoc,t===0||t===3?0:t===1?1:t===4?2:-1);}transAlpha(t){let n=this.renderer.gl;n.useProgram(this.program),n.uniform1f(this.u_alphaLoc,t);}render(t,n,i,s){this.renderCb(t,()=>{let o=this.renderer.gl;n.bindElementBuffer(),o.uniform1i(this.u_textureLoc,0),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,s),o.drawElements(o.TRIANGLES,er.length,o.UNSIGNED_SHORT,i*er.length*2);});}renderOne(t){let n=t.getInLeaf();this.render(n.getBuffer(),n.getElementBuffer(),t.getId(),t.getTexture());}transTransparent(t){let n=this.renderer.gl;n.useProgram(this.program),n.uniform1i(this.u_transparentLoc,t?1:0);}};var iu=class extends Ln{constructor(t,n,i,s,o,a,l,u){super([t,n,i,s].reduce((h,d)=>h.ext2(d),new ke()).build(),null,u);this.ldPoint=t,this.luPoint=n,this.rdPoint=i,this.ruPoint=s,this.mask=o,this.alpha=a,this.scene=l;let c=l.renderer.gl;this.texture=l.renderer.createRGBATexture(new ImageData(new Uint8ClampedArray([0,0,0,255]),1,1),c.LINEAR,c.LINEAR,c.CLAMP_TO_EDGE,c.CLAMP_TO_EDGE);}updateLeftPosition(){this.setData(Rs.leftPosition,Ut.length,[this.ldPoint.x,this.ldPoint.y,this.luPoint.x,this.luPoint.y]);}updateRightPosition(){this.setData(Rs.rightPosition,Ut.length,[this.rdPoint.x,this.rdPoint.y,this.ruPoint.x,this.ruPoint.y]);}setImageSource(t){let n=this.scene.renderer.gl;n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t),n.bindTexture(n.TEXTURE_2D,null);}setTexture(t){let n=this.scene.renderer,i=n.gl,s=n.createRGBATexture(t,i.LINEAR,i.LINEAR,i.CLAMP_TO_EDGE,i.CLAMP_TO_EDGE);this.scene.renderer.gl.deleteTexture(this.texture),this.texture=s;}getTexture(){return this.texture;}enterBuffer(t,n){this.id=t,this.inLeaf=n,this.updateLeftPosition(),this.updateRightPosition(),this.updateIndex(),this.inLeaf.getElementBuffer().bufferSubData(t*er.length,er.map(i=>t*Ut.length+i)),this.updateColorOrder();}render(t=void 0,n=!1){let i=this.inLeaf.program;if(i.transAlpha(this.alpha),!this.mask){i.render(this.inLeaf.getBuffer(),this.inLeaf.getElementBuffer(),this.id,this.texture);return;}let s=this.scene.renderer,o=s.gl,a=s.getColorWriteMask();if(!a[0]||!a[1]||!a[2]||!a[3])throw new Error("not support!");t===4?this.mask.render(4):(s.enterStencilConfig(),o.stencilOpSeparate(o.FRONT,o.KEEP,o.INCR_WRAP,o.INCR_WRAP),o.stencilOpSeparate(o.BACK,o.KEEP,o.DECR_WRAP,o.DECR_WRAP),o.stencilFunc(o.NOTEQUAL,0,127),o.colorMask(!1,!1,!1,!1),s.setDepthMask(!1),this.mask.render(0),o.stencilOp(o.KEEP,o.REPLACE,o.REPLACE),o.stencilFunc(o.NOTEQUAL,64,63),o.colorMask(!0,!0,!0,!0),s.setDepthMask(!n),i.render(this.inLeaf.getBuffer(),this.inLeaf.getElementBuffer(),this.id,this.texture),o.colorMask(!1,!1,!1,!1),this.scene.fullScreenProgram.render(),o.colorMask(!0,!0,!0,!0),s.leaveStencilConfig());}updateOrder(){this.setData(Rs.order,Ut.length,[this.order]);}updateColor(){throw new Error("texture can't call updateColor!");}updateIndex(){this.inLeaf.getBuffer().setData(Rs.index,this.id,Ut);}};var Ra=class{constructor(e,t){this.inLeaf=null;this.vertexIdsArr=[];this.style=1;this.outlines=e,this.quad=t;}getColor(){return this.quad.getColor();}getOrder(){return this.quad.getOrder();}bbox(){return this.quad.bbox();}isRemoved(){return this.inLeaf===null;}getPointNum(){return this.outlines.reduce((e,t)=>e+t.length,0);}getInLeaf(){return this.inLeaf;}getStartId(){return this.vertexIdsArr[0][0];}enterBuffer(e,t){this.vertexIdsArr.length=0;let n=0;for(let i of this.outlines)this.vertexIdsArr.push(e.slice(n,n+=i.length));this.inLeaf=t,this.updatePosition(),this.updateTriangleElementBuffer(),this.updateLineElementBuffer();}idIterator(){let e=0,t=0,n=this.vertexIdsArr[e++];return()=>(t<n.length||(n=this.vertexIdsArr[e++],t=0),n[t++]);}updatePosition(){let e=this.inLeaf.getBuffer(),t=this.idIterator();for(let n of this.outlines)for(let i of n)e.setData(Hm.position,t(),[i.x,i.y,this.style]);}updateTriangleElementBuffer(){let e=this.inLeaf.getBuffer(),t=this.idIterator(),n=this.getTriangleIds();for(let i=0;i<n.length;i+=3)e.triangleElementBuffer.setVertexIds(t(),[n[i],n[i+1],n[i+2]]);}updateLineElementBuffer(){let e=this.inLeaf.getBuffer(),t=this.idIterator(),n=this.getLineIds();for(let i=0;i<n.length;i+=2)e.lineElementBuffer.setVertexIds(t(),[n[i],n[i+1]]);}getLineIds(){let e=new Array();for(let t of this.vertexIdsArr)for(let n=0;n<t.length-1;n++)e.push(t[n],t[n+1]);return e;}getTriangleIds(){let e=[];for(let t of this.vertexIdsArr){let n=t.slice();for(let i=0;i<n.length-2;i+=2)e.push(n[i]),e.push(n[i+1]),e.push(n[i+2]),n.push(n[i]);}return e;}getVertexNum(){return this.outlines.reduce((e,t)=>e+t.length,0)*3;}remove(){let e=this.inLeaf.getBuffer();for(let t of this.vertexIdsArr)for(let n of t)e.remove(n),e.triangleElementBuffer.remove(n),e.lineElementBuffer.remove(n);throw this.inLeaf.remove(this),this.inLeaf=null,new Error("render will be wrong!");}render(e=void 0){this.inLeaf.program.renderOne(this,e);}};var F6=Cs+`
	attribute vec4 a_center; // [x, y, radius, style]

	varying vec4 v_center;
    varying vec2 v_position;

    void main(){
        if(a_center[3] == 0.0 || a_center.z < 0.0){
            return;
		}
		v_center = a_center;

        float sq = sqrt(3.0);
		vec2 position = a_center.xy;
		float radius = a_center.z < u_px_length / 2.0 ? u_px_length / 2.0 : a_center.z;
		v_center.z = radius;
        if(a_index == 0.0){
            position.x += radius * (-sq);
            position.y += radius * (-1.0);
        }else if(a_index == 1.0){
            position.x += radius * (sq);
            position.y += radius * (-1.0);
        }else{
            position.y += radius * (2.0);
		}
		
        calParm(position);
		v_position = position;
    }
`,q6=Ms+`
    varying vec4 v_center;
	varying vec2 v_position;

    void main(){
		float dis = length(v_position.xy - v_center.xy);
		if(dis > v_center.z){
			discard;
		}
		if(u_renderMode == 2 && dis < v_center.z - u_px_length){
			discard;
		}
		
        calColor();
    }
`,q2=4,Po=Object.assign({center:3},yi);function Y2(r,e){return new Qr(r,Kr/At.length,[...Ts,q2].map(t=>t*At.length),[It(e,t=>t.updateOrder()),It(e,t=>t.updateIndex()),It(e,t=>t.updateColor()),It(e,t=>t.updateCenterRadiusStyle())]);}var z2=class extends wi{constructor(e){super(e,F6,q6),this.addAttrSetting("a_center",Po.center,q2);}render(e){this.renderCb(e,()=>{let t=this.renderer.gl;t.drawArrays(t.TRIANGLES,0,e.getSize()*At.length);});}renderOne(e){this.renderCb(e.getInLeaf().getBuffer(),()=>{let t=this.renderer.gl;t.drawArrays(t.TRIANGLES,e.getId()*At.length,At.length);});}};var Yh=class extends Ln{constructor(t,n,i,s){super(new ye(t.x-n,t.x+n,t.y-n,t.y+n),i,s);this.center=t,this.radius=n;}updateCenterRadiusStyle(){this.setData(Po.center,At.length,[this.center.x,this.center.y,this.radius,this.style]);}updateOrder(){this.setData(Po.order,At.length,[this.order||0]);}updateColor(){let t=this.color;t?this.setData(Po.color,At.length,[t.r,t.g,t.b,t.alpha]):this.setData(Po.color,At.length,[0,0,0,0]);}updateIndex(){this.inLeaf.getBuffer().setData(Po.index,this.id,At);}enterBuffer(t,n){this.id=t,this.inLeaf=n,this.updateCenterRadiusStyle(),this.updateIndex(),this.inLeaf.getElementBuffer().bufferSubData(t*At.length,At.map(i=>t*At.length+i)),this.updateColorOrder();}getCenter(){return this.center;}setCenter(t){return this.center=t,this.update(),this;}getRadius(){return this.radius;}setRadius(t){return this.radius=t,this.update(),this;}transform(t){this.setCenter(this.center.multiply4(t));}update(){if(this.inLeaf===null)throw new Error("");this.updateCenterRadiusStyle();}};var ir=Math.PI*2,Xh=Math.PI/2,dme=Math.sin(Math.PI/180),z6=[1,10,100,1e3];function pme(r,e,t){if(typeof r!="number"&&(r=+r),isNaN(r))return NaN;if(e=e|0,e<=0||!r&&!t)return Math.round(r);let n=z6[e]||Math.pow(10,e)||10;if(t){let i=r<0?"-":"";for(r=r<0?-r:r,r=Math.round(r*n)+"";r.length<=e;)r="0"+r;return r=r.slice(0,-e)+"."+r.slice(-e),parseFloat(i+r);}else return Math.round(r*n+1e-10)/n;}var Y6=Cs+`
    attribute vec4 a_center; // [cx, cy, rmax, rmin]
    attribute vec4 a_param; // [startAngle, endAngle, sweepAngle, style]

    varying float R;
    varying float r;
    varying vec2 v_center;
    varying vec4 v_param;
    varying vec2 v_position;
    
    void main(){
        if(a_param[3] == 0.0){
            return;
        }

        R = a_center[2];
        r = a_center[3];
        float width = R - r;
        if(width < 0.0 || r < 0.0){
            return;
        }
        v_center = a_center.xy;
        v_param = a_param;

        if(width < u_px_length){
            width = u_px_length;
            float radius = (R + r) / 2.0;
            float halfPxLength = u_px_length / 2.0;
            R = radius + halfPxLength;
            r = radius - halfPxLength;
        }

        float PI = 3.1415926535897932384626433832795;
        vec2 position = a_center.xy;
        float radius = R;
        if(a_param[2] < PI){
            float startAngle = a_param[0];
            float endAngle = a_param[1];
            vec2 center = a_center.xy;
            vec2 startPointR = center + vec2(cos(startAngle), sin(startAngle)) * r;
            vec2 endPointR = center + vec2(cos(endAngle), sin(endAngle)) * r;
            position.xy = (startPointR + endPointR) / 2.0;
            radius = length(startPointR - endPointR) / 2.0 + width;
        }

        if(a_index == 0.0){
            position.x += radius * (-sqrt(3.0));
            position.y += radius * (-1.0);
        }else if(a_index == 1.0){
            position.x += radius * (sqrt(3.0));
            position.y += radius * (-1.0);
        }else{
            position.y += radius * (2.0);
        }

        calParm(position);
        v_position = position;
    }
`,X6=Ms+`
    varying float R;
    varying float r;
    varying vec2 v_center;
    varying vec4 v_param;
    varying vec2 v_position;

    void main(){
        float d = length(v_position - v_center.xy);
        if(d > R || d < r){
            discard;
        }
        
        float PI = 3.1415926535897932384626433832795;
        vec2 direct = v_position - v_center;
        float startAngle = v_param[0];
        vec2 startDir = vec2(cos(startAngle), sin(startAngle));
        float startZ = startDir.x * direct.y - startDir.y * direct.x;
        float endAngle = v_param[1];
        vec2 endDir = vec2(cos(endAngle), sin(endAngle));
        float endZ = endDir.x * direct.y - endDir.y * direct.x;

        float angle = v_param[2];
        if((angle < PI && (startZ < 0.0 || endZ > 0.0)) || (angle >= PI && (startZ < 0.0 && endZ > 0.0))){
            float pointRadius = (R - r) / 2.0;
            float radius = (R + r) / 2.0;
            vec2 startCenter = v_center + startDir * radius;
            float startDis = length(v_position - startCenter);
            vec2 endCenter = v_center + endDir * radius;
            float endDis = length(v_position - endCenter);
            if(startDis > pointRadius && endDis > pointRadius){
                discard;
            }
            if(u_renderMode == 2 && (startDis < pointRadius - u_px_length || endDis < pointRadius - u_px_length)){
                discard;
            } 
        }else if(u_renderMode == 2 && d < R - u_px_length && d > r + u_px_length){
            discard;
        }
        
        calColor();
    }
`,X2=4,V2=4,Ki=Object.assign({center:3,param:4},yi);function $2(r,e){return new Qr(r,Kr/At.length,[...Ts,X2,V2].map(t=>t*At.length),[It(e,t=>t.updateOrder()),It(e,t=>t.updateIndex()),It(e,t=>t.updateColor()),It(e,t=>t.updateCenterRadius()),It(e,t=>t.updateParam())]);}var W2=class extends wi{constructor(e){super(e,Y6,X6),this.addAttrSetting("a_center",Ki.center,X2),this.addAttrSetting("a_param",Ki.param,V2);}render(e){this.renderCb(e,()=>{let t=this.renderer.gl;t.drawArrays(t.TRIANGLES,0,e.getSize()*At.length);});}renderOne(e){this.renderCb(e.getInLeaf().getBuffer(),()=>{let t=this.renderer.gl;t.drawArrays(t.TRIANGLES,e.getId()*At.length,At.length);});}};var Na=class extends Ln{constructor(t,n,i,s,o,a,l){super(Na.getBBox(t,n,i,s,o),a,l);this.center=t,this.radius=n,this.width=i,this.startAngle=s,this.endAngle=o;}static getBBox(t,n,i,s,o){o=s>o?o+Math.ceil((s-o)/ir)*ir:o-Math.floor((o-s)/ir)*ir;let a=new ke();a.ext2(F.X_UNIT_VECTOR.multiply3(ze.rotate(s))),a.ext2(F.X_UNIT_VECTOR.multiply3(ze.rotate(o)));for(let c=Math.ceil(s/Xh)*Xh;c<o;c+=Xh)a.ext2(F.X_UNIT_VECTOR.multiply3(ze.rotate(c)));let l=a.build(),u=i/2;return new ye(l.minX*n+t.x-u,l.maxX*n+t.x+u,l.minY*n+t.y-u,l.maxY*n+t.y+u);}setParam(t,n,i){this.setData(Ki.param,At.length,[t,n,n>t?n-t:n-t+ir,i]);}updateOrder(){this.setData(Ki.order,At.length,[this.order||0]);}updateColor(){let t=this.color;t?this.setData(Ki.color,At.length,[t.r,t.g,t.b,t.alpha]):this.setData(Ki.color,At.length,[0,0,0,0]);}updateIndex(){this.inLeaf.getBuffer().setData(Ki.index,this.id,At);}enterBuffer(t,n){this.id=t,this.inLeaf=n,this.updateCenterRadius(),this.setParam(this.startAngle,this.endAngle,this.style),this.updateIndex(),this.inLeaf.getElementBuffer().bufferSubData(t*At.length,At.map(i=>t*At.length+i)),this.updateColorOrder();}getCenter(){return this.center;}setCenter(t){return this.center=t,this.updateCenterRadius(),this;}getRadius(){return this.radius;}setRadius(t){return this.radius=t,this.updateCenterRadius(),this;}getWidth(){return this.width;}setWidth(t){return this.width=t,this.updateCenterRadius(),this;}getStartAngle(){return this.startAngle;}getStart(){let t=new F(Math.cos(this.getStartAngle()),Math.sin(this.getStartAngle()));return this.center.add(t.scale(this.radius));}getEnd(){let t=new F(Math.cos(this.getEndAngle()),Math.sin(this.getEndAngle()));return this.center.add(t.scale(this.radius));}setStartAngle(t){return t%=ir,t<0&&(t+=ir),this.startAngle=t,this.updateParam(),this;}getEndAngle(){return this.endAngle;}setEndAngle(t){return t%=ir,t<0&&(t+=ir),this.endAngle=t,this.updateParam(),this;}getSweepAngle(){return(this.endAngle-this.startAngle+ir)%ir;}transform(t){let n=this.center.add(new F(Math.cos(this.startAngle)*this.radius,Math.sin(this.startAngle)*this.radius)),i=this.center.add(new F(Math.cos(this.endAngle)*this.radius,Math.sin(this.endAngle)*this.radius)),s=this.getSweepAngle(),o=this.startAngle+s/2,a=this.center.add(new F(Math.cos(o)*this.radius,Math.sin(o)*this.radius)),l=this.center.multiply4(t),u=n.multiply4(t),c=i.multiply4(t),h=a.multiply4(t),d=u.sub(l),f=c.sub(l),p=Math.atan2(d.y,d.x),m=Math.atan2(f.y,f.x);p<0&&(p+=ir),m<0&&(m+=ir),this.setCenter(l);let g=h.sub(u),b=c.sub(h);this.startAngle=p,this.endAngle=m,g.cross(b)>=0?(this.startAngle=p,this.endAngle=m):(this.startAngle=m,this.endAngle=p),this.updateParam();}updateCenterRadius(){if(this.inLeaf===null)throw new Error("");this.setData(Ki.center,At.length,[this.center.x,this.center.y,this.radius+this.width/2,Math.max(this.radius-this.width/2,0)]);}updateParam(){if(this.inLeaf===null)throw new Error("");this.setParam(this.startAngle,this.endAngle,this.style);}};var V6=Cs+`
    attribute vec4 a_endpoints;
    attribute vec4 a_param;

    varying vec4 v_position;
    varying vec4 v_endpoints;
    varying float v_halfWidth;

    void main(){
        if(a_param[0] == 0.0){
            return;
        }
        v_endpoints = a_endpoints;

        if(a_param[1] < u_px_length){
            v_halfWidth = u_px_length / 2.0;
        }else{
            v_halfWidth = a_param[1] / 2.0;
        }
        vec2 direct;
        if(a_endpoints.xy == a_endpoints.zw){
            direct = vec2(1, 0);
        }else{
            direct = normalize(a_endpoints.zw - a_endpoints.xy);
        }
        vec2 vertical = vec2(-direct.y, direct.x);
        vec2 h_offset = vertical * v_halfWidth; // \u7528\u4E8E\u8BA1\u7B97\u5782\u76F4\u65B9\u5411\u843D\u70B9
        vec2 v_offset = direct * v_halfWidth * a_param[2]; // \u7528\u4E8E\u8BA1\u7B97\u6A2A\u5411\u6269\u5C55
        vec2 position;
        if(a_index == 0.0){
            position = a_endpoints.xy - h_offset - v_offset;
        }else if(a_index == 1.0){
            position = a_endpoints.zw - h_offset + v_offset;
        }else if(a_index == 2.0){
            position = a_endpoints.zw + h_offset + v_offset;
        }else if(a_index == 3.0){
            position = a_endpoints.xy + h_offset - v_offset;
        }

        calParm(position);
        v_position = vec4(position.xy, a_param.zw);
    }
`,W6=Ms+`
    varying vec4 v_position;
    varying vec4 v_endpoints;
    varying float v_halfWidth;

    void main(){
        vec2 direct = v_endpoints.zw - v_endpoints.xy;
        float len = length(direct);
        if(len == 0.0){
            direct = vec2(1, 0);
        }else{
            direct = normalize(direct);
        }
        // WebGL \u7740\u8272\u5668\u63D2\u503C\u6709\u95EE\u9898\uFF0C\u5728\u5706\u89D2\u65F6\u6B64\u503C\u4E0D\u7CBE\u786E\u7B49\u4E8E 1.0
        if(abs(v_position.z - 1.0) < 0.0001){
            vec2 dir = v_position.xy - v_endpoints.xy;
            float l = dot(dir, direct);
            if(l < 0.0){
                float dis = length(dir);
                if(dis > v_halfWidth){
                    discard;
                }
                if(u_renderMode == 2 && dis < v_halfWidth - u_px_length){
                    discard;
                }
            }else if(l > len){
                float dis = length(v_position.xy - v_endpoints.zw);
                if(dis > v_halfWidth){
                    discard;
                }
                if(u_renderMode == 2 && dis < v_halfWidth - u_px_length){
                    discard;
                }
            }else if(u_renderMode == 2 && abs(dot(vec2(-direct.y, direct.x), dir)) < v_halfWidth - u_px_length){
                discard;
            }
        }else {
            float radius = v_position.w;
            vec2 center = (v_endpoints.xy + v_endpoints.zw) * 0.5;
            vec2 crood = v_position.xy - center;
            float x = abs(dot(direct,crood));
            float y = abs(crood.x * direct.y - crood.y * direct.x);
            float xEdge = len * 0.5 - radius;
            float yEdge = v_halfWidth - radius;
            if(x < xEdge || y < yEdge){
                if(u_renderMode == 2 && x < len * 0.5 - u_px_length && y < v_halfWidth - u_px_length){
                    discard;
                }
            }else {
                float deltaX = x - xEdge;
                float deltaY = y - yEdge;
                float dis = length(vec2(deltaX,deltaY));
                if(dis > radius || (u_renderMode == 2 && dis < radius - u_px_length)){
                    discard;
                }
            }
        }
		
        calColor();
    }
`,j2=4,Z2=4,Qi=Object.assign({endpoints:3,param:4},yi);function K2(r,e){return new Qr(r,Kr/er.length,[...Ts,j2,Z2].map(t=>t*Ut.length),[It(e,t=>t.updateOrder()),It(e,t=>t.updateIndex()),It(e,t=>t.updateColor()),It(e,t=>t.updateEndpointsBuffer()),It(e,t=>t.updateParamBuffer())]);}var H2=class extends wi{constructor(e){super(e,V6,W6),this.addAttrSetting("a_endpoints",Qi.endpoints,j2),this.addAttrSetting("a_param",Qi.param,Z2);}render(e,t){this.renderCb(e,()=>{let n=this.renderer.gl;t.bindElementBuffer(),n.drawElements(n.TRIANGLES,t.getSize(),n.UNSIGNED_SHORT,0);});}renderOne(e){let t=e.getInLeaf();this.renderCb(t.getBuffer(),()=>{let n=this.renderer.gl;t.getElementBuffer().bindElementBuffer(),n.drawElements(n.TRIANGLES,er.length,n.UNSIGNED_SHORT,e.getId()*er.length*2);});}};var La=class extends Ln{constructor(t,n,i,s,o,a,l){super(La.getBBox(t,n,i),a,l);this.start=t,this.end=n,this.width=i,this.isRound=s,this.radius=o;}static getBBox(t,n,i){let s=new ke();return s.ext2(t),s.ext2(n),s.ext7(i/2),s.build();}updateEndpointsBuffer(){this.setData(Qi.endpoints,Ut.length,[this.start.x,this.start.y,this.end.x,this.end.y]);}updateParamBuffer(){this.setData(Qi.param,Ut.length,[this.style,this.width,this.isRound?1:0,this.radius]);}updateOrder(){this.setData(Qi.order,Ut.length,[this.order||0]);}updateColor(){let t=this.color;t?this.setData(Qi.color,Ut.length,[t.r,t.g,t.b,t.alpha]):this.setData(Qi.color,Ut.length,[0,0,0,0]);}updateIndex(){this.inLeaf.getBuffer().setData(Qi.index,this.id,Ut);}enterBuffer(t,n){this.id=t,this.inLeaf=n,this.updateEndpointsBuffer(),this.updateParamBuffer(),this.updateIndex(),this.inLeaf.getElementBuffer().bufferSubData(t*er.length,er.map(i=>t*Ut.length+i)),this.updateColorOrder();}getCenter(){return this.start.add(this.end).scale(.5);}getStart(){return this.start;}setStart(t,n=!0){return this.start=t,n&&this.updateEndpointsBuffer(),this;}getEnd(){return this.end;}setEnd(t,n=!0){return this.end=t,n&&this.updateEndpointsBuffer(),this;}getWidth(){return this.width;}setWidth(t){return this.width=t,this.updateParamBuffer(),this;}length(){return this.getStart().distance1(this.getEnd());}modifyLenght4Center(t){let n=this.getCenter(),i=this.end.sub(this.start).normalize(),s=n.sub(i.scale(t/2)),o=n.add(i.scale(t/2));this.setStart(s),this.setEnd(o);}transform(t){this.setStart(this.start.multiply4(t),!1),this.setEnd(this.end.multiply4(t));}};var Jr=class{static toDegrees(e){return e*180/Math.PI;}static toRadians(e){return e/180*Math.PI;}static regularD(e){return e=e%360,e=e<0?360+e:e,e===360?0:e;}static regular(e){return e=e%Jr.PIx2,e=e<0?Jr.PIx2+e:e,e===Jr.PIx2?0:e;}static toQuarterBase(e){return Jr.regular((e+Jr.PI_4)/Jr.PI_2*Jr.PI_2);}static toQuarterBaseD(e){return Jr.regularD(((e+45)/90|0)*90);}static transformD(e,t){return Jr.toDegrees(Jr.transform(Jr.toRadians(e),t));}static transform(e,t){let n=Math.cos(e),i=Math.sin(e),s=new F(t.data[6],t.data[7]),o=new F(n,i).multiply3(t);return Jr.regular(o.angle(s));}},at=Jr;at.PIx2=Math.PI*2,at.PI_2=Math.PI/2,at.PI_4=Math.PI/4;var Vh=class extends Ps{constructor(t,n,i=null,s=null){super(n,i,s);this.interPlanes=[this];this.subPlanes=[];this.parts=[{matrix:ze.ORIGIN,plane:this}];this.dictOutMatrixRenderCfg={};this.transparentObjs=[];this.isColorful=!1;this.renderTexture=!0;this.alwaysUpdateBBox=!0;this.scene=t,this.lineManager=new Tn(t.renderer,t.lineProgram,K2),this.arcManager=new Tn(t.renderer,t.arcProgram,$2),this.circleManager=new Tn(t.renderer,t.circleProgram,Y2),this.polygonManager=new qh(t),this.textureManager=new zh(t.renderer,t.textureProgram,F2),this.textureMaskManager=new Is(t.renderer,t.polygonProgram,Fh);}isEmpty(){return this.lineManager.isEmpty()&&this.arcManager.isEmpty()&&this.circleManager.isEmpty()&&this.polygonManager.isEmpty()&&this.textureManager.isEmpty();}clear(){this.lineManager.clear(),this.arcManager.clear(),this.circleManager.clear(),this.polygonManager.clear(),this.textureManager.clear();}createL(t,n,i,s,o,a,l){let u=new La(t,n,i,s,o,a,l);return this.lineManager.addObj(u),a&&a.alpha!==1&&this.transparentObjs.push(u),u;}createLine(t,n,i,s,o){return this.createL(t,n,i,!0,0,s,o);}removeLine(t){t.remove(er.length);}addLine(t){this.lineManager.addObj(t);}removeArc(t){t.remove(At.length);}addArc(t){this.arcManager.addObj(t);}createRect(t,n,i){return this.createL(t.getLeftPoint(),t.getRightPoint(),t.height,!1,t.radius,n,i),0;}createArc(t,n,i,s,o,a,l){let u=s+o;if(o<0){let h=u;u=s,s=h;}s=at.toRadians(s),s%=ir,s<0&&(s+=ir),u=at.toRadians(u),u%=ir,u<0&&(u+=ir);let c=new Na(t,n,i,s,u,a,l);return this.arcManager.addObj(c),a&&a.alpha!==1&&this.transparentObjs.push(c),c;}createCircle(t,n,i,s){let o=new Yh(t,n,i,s);return this.circleManager.addObj(o),i&&i.alpha!==1&&this.transparentObjs.push(o),0;}createPolygon(t,n,i,s){let o=[];for(let c of t){let h=[];c.points2(n,p=>h.push(p));let d=h[0],f=h[h.length-1];(d.x!==f.x||d.y!==f.y)&&h.push(d),o.push(h);}let a=On.build(o.flat(),i,s),l=new Ra(o,a),u=this.polygonManager.getManagerIndex(a);return u.polygonManager.addObj(l),u.rtree&&(u.rtree.insert(a),u.quadManager.addObj(a)),i&&i.alpha!==1&&this.transparentObjs.push(l),[0];}addOutMatrixRenderCfg(t,n){let i=t.getSelfAsOutToChildMatrix();for(let s of i){let o=this.outMatrixParamMap.get(s);!o||(n.visible=o.visible,this.dictOutMatrixRenderCfg[s.toString()]=n);}}removeOutMatrixRenderCfg(t,n){let i=t.getSelfAsOutToChildMatrix();for(let s of i)!this.outMatrixParamMap.get(s)||delete this.dictOutMatrixRenderCfg[s.toString()];}setPolygonAbleInter(t){this.polygonManager.ableInter=t;}createTexture(t,n,i,s,o,a,l){let u=o?new Ra(o,On.build(o.flat(),null,l)):null;u&&this.textureMaskManager.addObj(u);let c=new iu(t,n,i,s,u,a,this.scene,l);return this.textureManager.addObj(c),this.transparentObjs.push(c),c;}removePt(t){throw new Error("not support");}sortTransparentObjs(){this.transparentObjs.sort((t,n)=>t.getOrder()-n.getOrder());}getPxLength(t,n){let i=t.getCurrentCamera(),s;if(i.isOrthCamera())s=i.getPxLength();else{let o=this.getBBox(),l=(o?o.center():i.getTarget()).multiply4(n),u=i.getTarget().sub(l).dot(i.getTar2Pos().normalize());s=i.getPxLength()*(u/i.getTar2Pos().length()+1);}return s*=2,s;}transPlaneData(t,n,i,s){let o=n===0||n===4?this.getColor():n===3?this.outMatrixParamMap.get(i).color:null,a=this.getPxLength(t,i);t.arcProgram.transPlaneData(this,o,a,s),t.lineProgram.transPlaneData(this,o,a,s),t.circleProgram.transPlaneData(this,o,a,s),t.quadProgram.transPlaneData(this,o,a,s),t.textureProgram.transPlaneData(this);}transRenderMode(t,n){t.arcProgram.transRenderMode(n),t.lineProgram.transRenderMode(n),t.circleProgram.transRenderMode(n),t.polygonProgram.transRenderMode(n),t.quadProgram.transRenderMode(n),t.textureProgram.transRenderMode(n);}transTransparent(t,n){t.arcProgram.transTransparent(n),t.lineProgram.transTransparent(n),t.circleProgram.transTransparent(n),t.quadProgram.transTransparent(n),t.textureProgram.transTransparent(n);}getMutualStencilPlane(t){let n=new Set(this.interPlanes);for(let i of t.interPlanes)if(n.has(i))return i;return null;}hasInterPlane(t){return this.interPlanes.indexOf(t)!==-1;}drawStencil(t,n){this.transPlaneData(t,0,n,1),this.transRenderMode(t,0),this.transTransparent(t,!1);let i=n.multiply4(t.getCurrentCamera().getRenderMatrix()),s=t.getViewOffset(),o=t.renderer.gl;o.enable(o.STENCIL_TEST),o.colorMask(!1,!1,!1,!1),t.renderer.setDepthMask(!1),this.drawPassStencil(t,n,i,s,this.renderTexture),o.colorMask(!0,!0,!0,!0),t.renderer.setDepthMask(!0),o.disable(o.STENCIL_TEST);}draw(t,n,i,s,o=1){let a=this.outMatrixParamMap.get(n);if(a){if(a.drawn)return;a.drawn=!0;}if(this.interPlanes.length===0||!this.isColorful&&(i===1&&this.getMaterial().alpha===0||(i===0||i===4)&&this.getColor().alpha===0)||this.noDrawing)return;if(i===4&&(this.subPlanes.length!==0||this.interPlanes.length!==1||this.interPlanes[0]!==this))throw new Error("Wireframe mode can only be used to draw the plane itself!");this.transPlaneData(t,i,n,o),this.transRenderMode(t,0),this.transTransparent(t,!1);let l=n.multiply4(t.getCurrentCamera().getRenderMatrix()),u=t.getViewOffset(),c=t.renderer,h=c.gl;h.enable(h.STENCIL_TEST),h.colorMask(!1,!1,!1,!1),c.setDepthMask(!1);let d=this.interPlanes.slice(),f=this.subPlanes.slice(),p=this.dictOutMatrixRenderCfg[n.toString()];if(p)if(p.replacePlane){f=p.listSubPlane;for(let m of p.listInterPlane)m&&d.push(m);}else{for(let m of p.listSubPlane)m&&f.push(m);for(let m of p.listInterPlane)m&&d.push(m);}if(s)h.stencilFunc(h.NOTEQUAL,64,128),h.stencilOp(h.KEEP,h.REPLACE,h.REPLACE),t.fullScreenProgram.render(),d=d.filter(m=>m!==s);else if(d.length===1){h.clearStencil(64),h.clear(h.STENCIL_BUFFER_BIT),f.forEach(m=>m.drawNotPassStencil(t,n,l,u,this.renderTexture)),d[0].renderUsingStencil(t,i,n,l,u,this.renderTexture);return;}else d.pop().drawPassStencil(t,n,l,u,this.renderTexture);if(f.forEach(m=>m.drawNotPassStencil(t,n,l,u,this.renderTexture)),d.length===0)this.renderBBoxUsingStencil(t,i,n,this.getBBox());else{for(let m=1;m<d.length;m++)d[m].drawInterStencil(t,n,l,u,this.renderTexture);d[0].renderUsingStencil(t,i,n,l,u,this.renderTexture);}}getBBox2(){let t=new ke();for(let n of this.parts){let{plane:i,matrix:s}=n;for(let o of[i.lineManager,i.arcManager,i.circleManager,i.textureManager]){let a=o.getBBox();a&&t.ext1(a.transform(s));}i.polygonManager.forEachManagerIndex(o=>t.ext1(o.polygonManager.getBBox().transform(s)));}return t.valid()?t.build():null;}setAlwaysUpdateBBox(t){this.alwaysUpdateBBox=t;}getBBox(){return this.alwaysUpdateBBox?this.updateBBox():this.bBox||this.updateBBox(),this.bBox;}updateBBox(){try{let t=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(let o of this.interPlanes){let a=o.getBBox2();t=Math.max(a.minX,t),i=Math.min(a.maxX,i),n=Math.max(a.minY,n),s=Math.min(a.maxY,s);}return this.bBox=new gn(t,n,0,i,s,0),this.bBox;}catch(t){return this.bBox=null,this.bBox;}}addPart(t,n){this.parts.push({matrix:t,plane:n});}setRenderProcess(t=[this],n=[]){this.interPlanes=t.filter(i=>i),this.subPlanes=n.filter(i=>i&&!i.isEmpty());}addRenderProcess(t=[this],n=[]){for(let i of t)this.interPlanes.indexOf(i)<=-1&&this.interPlanes.push(i);for(let i of n)this.subPlanes.indexOf(i)<=-1&&this.subPlanes.push(i);}removeRenderProcess(t=[this],n=[]){for(let i of t){let s=this.interPlanes.indexOf(i);s>=0&&this.interPlanes.splice(s,1);}for(let i of n){let s=this.subPlanes.indexOf(i);s>=0&&this.subPlanes.splice(s,1);}}isBoard(t){return this.interPlanes.length===1&&this.interPlanes[0].className==="board"&&this.subPlanes.length===0&&t!==4&&(t!==1||this.getMaterial().alpha===1);}ableCover(t){let n=new Set(t.interPlanes);for(let i of this.interPlanes)if(!n.has(i))return!1;return!0;}renderGeneralObj(t,n,i,s){for(let o of this.parts){let a=o.matrix.toMatrix4(),l=a.multiply4(n);t.arcProgram.transMatrixData(l),t.lineProgram.transMatrixData(l),t.circleProgram.transMatrixData(l);let u=o.plane,c=a.multiply4(i);u.lineManager.render(c,s),u.arcManager.render(c,s),u.circleManager.render(c,s);}}renderPolygon(t,n,i,s){for(let o of this.parts){let a=o.matrix.toMatrix4();t.polygonProgram.transMatrixData(a.multiply4(n)),o.plane.polygonManager.drawStencil(a.multiply4(i),s);}}renderUsingStencil(t,n,i,s,o,a){this.transRenderMode(t,n);let l=t.renderer.gl;if(l.colorMask(!0,!0,!0,!0),l.stencilFunc(l.EQUAL,64,255),l.stencilOp(l.KEEP,l.KEEP,l.KEEP),t.renderer.setDepthMask(!0),this.renderGeneralObj(t,i,s,o),a&&n!==4)for(let c of this.parts){let h=c.matrix.toMatrix4(),d=h.multiply4(i);t.polygonProgram.transMatrixData(d),t.textureProgram.transMatrixData(d),c.plane.textureManager.render(h.multiply4(s),o);}for(let c of this.parts){let h=c.matrix.toMatrix4(),d=h.multiply4(i);t.polygonProgram.transMatrixData(d),t.quadProgram.transMatrixData(d),c.plane.polygonManager.renderUsingStencil(t,n,h.multiply4(s),o,this.transparentObjs.length!==0);}if(this.transparentObjs.length!==0){t.renderer.setDepthMask(!1),this.transTransparent(t,!0);for(let c of this.parts){let h=c.matrix.toMatrix4().multiply4(i);t.arcProgram.transMatrixData(h),t.lineProgram.transMatrixData(h),t.circleProgram.transMatrixData(h),t.textureProgram.transMatrixData(h),t.polygonProgram.transMatrixData(h),t.quadProgram.transMatrixData(h),this.transparentObjs.forEach(d=>{d instanceof Ra?(l.stencilOpSeparate(l.FRONT,l.KEEP,l.INCR_WRAP,l.INCR_WRAP),l.stencilOpSeparate(l.BACK,l.KEEP,l.DECR_WRAP,l.DECR_WRAP),l.stencilFunc(l.NOTEQUAL,0,127),l.colorMask(!1,!1,!1,!1),d.render(),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),l.stencilFunc(l.NOTEQUAL,64,63),l.colorMask(!0,!0,!0,!0),d.quad.render(),l.stencilFunc(l.EQUAL,64,255),l.stencilOp(l.KEEP,l.KEEP,l.KEEP)):d instanceof iu?a&&d.render(n,!0):d.render();});}t.renderer.setDepthMask(!0);}else for(let c of this.parts){let h=c.matrix.toMatrix4(),d=h.multiply4(i);t.polygonProgram.transMatrixData(d),t.quadProgram.transMatrixData(d),c.plane.polygonManager.renderPointsUsingStencil(t,n,h.multiply4(s),o);}if(l.disable(l.STENCIL_TEST),!(this.whiteCoverLayer||this.blackCoverLayer||this.boardCoverLayer)||this.isEmpty()||n!==0)return;let u=this.scene.renderer.getBlenderParam();l.blendFuncSeparate(l.ZERO,l.ONE,l.ZERO,l.ONE_MINUS_SRC_ALPHA),l.blendEquation(l.FUNC_ADD),this.whiteCoverLayer&&this.whiteCoverLayer[1].getVisible()&&this.isUpper(i,this.whiteCoverLayer[1].getMatrix())&&(l.clear(l.DEPTH_BUFFER_BIT),this.whiteCoverLayer[0].draw(t,i,0,null,.8)),this.blackCoverLayer&&this.blackCoverLayer[1].getVisible()&&this.isUpper(i,this.blackCoverLayer[1].getMatrix())&&(l.clear(l.DEPTH_BUFFER_BIT),this.blackCoverLayer[0].draw(t,i,0,null,1)),l.blendFuncSeparate(...u.slice(0,4)),l.blendEquationSeparate(...u.slice(4,6));}isUpper(t,n){return pe.ORIGIN.multiply4(t).z>pe.ORIGIN.multiply4(n).z;}renderBBoxUsingStencil(t,n,i,s){this.transRenderMode(t,n),t.quadProgram.transMatrixData(i);let o=t.renderer.gl;o.colorMask(!0,!0,!0,!0),t.renderer.setDepthMask(!0),o.stencilFunc(o.EQUAL,64,255),o.stencilOp(o.KEEP,o.KEEP,o.KEEP),On.enterBBoxBuffer(new ye(s.minX,s.maxX,s.minY,s.maxY),t.quadBuffer),t.quadProgram.render(t.quadBuffer,t.quadElementBuffer),o.disable(o.STENCIL_TEST);}drawPassStencil(t,n,i,s,o){let l=t.renderer.gl;l.clearStencil(0),l.clear(l.STENCIL_BUFFER_BIT),l.stencilFunc(l.ALWAYS,64,255),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),this.renderGeneralObj(t,n,i,s),l.stencilFunc(l.NOTEQUAL,64,255),l.stencilOpSeparate(l.FRONT,l.KEEP,l.INCR_WRAP,l.INCR_WRAP),l.stencilOpSeparate(l.BACK,l.KEEP,l.DECR_WRAP,l.DECR_WRAP),this.renderPolygon(t,n,i,s),l.stencilFunc(l.NOTEQUAL,64,63),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),t.fullScreenProgram.render();}drawNotPassStencil(t,n,i,s,o){let l=t.renderer.gl;l.stencilFunc(l.NOTEQUAL,128,127),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),this.renderGeneralObj(t,n,i,s),l.stencilFunc(l.NOTEQUAL,0,127),l.stencilOpSeparate(l.FRONT,l.KEEP,l.INCR_WRAP,l.INCR_WRAP),l.stencilOpSeparate(l.BACK,l.KEEP,l.DECR_WRAP,l.DECR_WRAP),this.renderPolygon(t,n,i,s),l.stencilFunc(l.NOTEQUAL,128,63),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),t.fullScreenProgram.render();}drawInterStencil(t,n,i,s,o){let l=t.renderer.gl;l.stencilFunc(l.NOTEQUAL,0,127),l.stencilOpSeparate(l.FRONT,l.KEEP,l.INCR_WRAP,l.INCR_WRAP),l.stencilOpSeparate(l.BACK,l.KEEP,l.DECR_WRAP,l.DECR_WRAP),this.renderPolygon(t,n,i,s),l.stencilFunc(l.EQUAL,64,255),l.stencilOp(l.KEEP,l.INCR_WRAP,l.INCR_WRAP),this.renderGeneralObj(t,n,i,s),l.stencilFunc(l.EQUAL,192,127),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),t.fullScreenProgram.render(),l.stencilFunc(l.EQUAL,128,128),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),t.fullScreenProgram.render(),l.stencilFunc(l.NOTEQUAL,64,63),l.stencilOp(l.KEEP,l.REPLACE,l.REPLACE),t.fullScreenProgram.render();}};var en=`
    struct Camera {
        mvpMatrix: mat4x4<f32>,
        mvMatrix: mat4x4<f32>,
        invMatrix: mat4x4<f32>,
        pos: vec3<f32>,
        isOrth: f32,
        vec: vec3<f32>,
		borderZ: f32,
    }
`,Wh=56;function Q2(r,e,t){qt.set(e.getRenderMatrix().data),qt.set(e.getViewMatrix().data,16),qt.set(e.getInverseMatrix().data,32);let n=e.getPostion();qt[48]=n.x,qt[49]=n.y,qt[50]=n.z,qt[51]=e.isOrthCamera()?1:0;let i=e.getTar2Pos().scale(-1);qt[52]=i.x,qt[53]=i.y,qt[54]=i.z,qt[55]=t===Number.NEGATIVE_INFINITY?-1:e.getBorderZ(t),r.write(0,qt,0,Wh);}var J2=`
	struct ColorMaterial {
		color: vec4<f32>,
		ambientFactor: vec3<f32>,
		shininess: f32,
		diffuseFactor: vec3<f32>,
		alpha: f32,
		specularFactor: vec3<f32>,
	}
`,su=15;function $h(r,e,t){if(e?qt.set(e.getData()):qt.set(new Float32Array(4)),t){let n=t.ambient;qt[4]=n.r,qt[5]=n.g,qt[6]=n.b,qt[7]=t.shininess;let i=t.diffuse;qt[8]=i.r,qt[9]=i.g,qt[10]=i.b,qt[11]=t.alpha;let s=t.specular;qt[12]=s.r,qt[13]=s.g,qt[14]=s.b;}else qt.set(new Float32Array(su-4),4);r.write(0,qt,0,su);}var qt=new Float32Array(Math.max(Wh,su));var Et=class extends Ps{constructor(t,n,i=null,s=null){super(n,i,s);this.listInstanceMatrix=[Je.ORIGIN];this.m_bBox=void 0;this.elements=t,t.incOut();}clear(){var t,n,i;this.elements.decOut((t=this.renderer)==null?void 0:t.gl),(n=this.colorMaterialBuf)==null||n.destroy(),(i=this.bindGroup)==null||i.destroy(),delete this.renderer,delete this.gpu;}addInstanceMatrix(t){this.listInstanceMatrix.push(t);}isOutOfRange(t,n,i){let s=new kr();n.forEach(d=>s.ext3(d.multiply4(t)));let o=s.build(),a=o.maxX-o.minX,l=o.maxY-o.minY,u=2/this.renderer.width(),c=2/this.renderer.height(),h=2;return a<=u*h||l<=c*h?!0:!(o.minX+i.x<1&&o.maxX+i.x>-1&&o.minY+i.y<1&&o.maxY+i.y>-1);}setMaterial(t){super.setMaterial(t),this.gpu&&$h(this.colorMaterialBuf,this.getColor(),this.getMaterial());}setColor(t){super.setColor(t),this.gpu&&$h(this.colorMaterialBuf,this.getColor(),this.getMaterial());}drawGPU(t,n){this.gpu||(this.gpu=t.gpu,this.colorMaterialBuf=t.gpu.createDynamicBuffer(su,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),$h(this.colorMaterialBuf,this.getColor(),this.getMaterial()),this.bindGroup=t.meshProgram.createDynamicBindGroup(this.colorMaterialBuf));let i=t.getCurrentCamera().getRenderMatrix(),s=this.elements.getBBox().getVertexes(),o=t.getViewOffset(),a=[];for(let u=n.length-1;u>=0;u--){let c=n[u],h=this.outMatrixParamMap.get(c.matrix),d=c.renderMode;!h.drawn&&!this.isOutOfRange(c.matrix.multiply4(i),s,o)&&(d===3?h.color:d===0?this.getColor():this.getMaterial()).alpha!==0&&a.push(c),h.drawn=!0;}if(a.length===0)return;let l=new Set(a.map(u=>u.renderMode));for(let u of l)t.meshProgram.render(u,this.elements,this.bindGroup,a.filter(c=>c.renderMode===u));}draw(t,n){let i=t.renderer;this.renderer||(this.renderer=i);let s=t.getCurrentCamera().getRenderMatrix(),o=this.getBBox().getVertexes(),a=t.getViewOffset(),l=[];for(let f=n.length-1;f>=0;f--){let p=n[f],m=this.outMatrixParamMap.get(p.matrix),g=p.renderMode,b=this.isOutOfRange(p.matrix.multiply4(s),o,a);!m.drawn&&!b&&(g===3?m.color:g===0?this.getColor():this.getMaterial()).alpha!==0&&l.push(p),m.drawn=!0;}if(l.length===0)return;let u=i.gl,c=[];for(let f=0;f<4;f++)c.push(i.createBuffer());let h,d=new Set(l.map(f=>f.renderMode));for(let f of d){let p=l.filter(g=>g.renderMode===f),m=[[],[],[],[]];for(let g of p)for(let b of this.listInstanceMatrix)for(let y=0;y<4;y++){let v=b.multiply4(g.matrix);m[y].push(...v.data.slice(y*4,(y+1)*4));}for(let g=0;g<4;g++)u.bindBuffer(u.ARRAY_BUFFER,c[g]),u.bufferData(u.ARRAY_BUFFER,new Float32Array(m[g]),u.STATIC_DRAW);if(f===0||f===3){let g=[];for(let b of p){let y=b.color;g.push(y.r,y.g,y.b,y.alpha);}h||(h=i.createBuffer()),u.bindBuffer(u.ARRAY_BUFFER,h),u.bufferData(u.ARRAY_BUFFER,new Float32Array(g),u.STATIC_DRAW);}t.generalProgram.render(f,this.elements,c,p.length*this.listInstanceMatrix.length,h,this.getMaterial());}for(let f of c)u.deleteBuffer(f);u.deleteBuffer(h);}getBBox(){if(this.m_bBox)return this.m_bBox;if(this.listInstanceMatrix.length===1)this.m_bBox=this.elements.getBBox();else{let t=this.elements.getBBox(),n=new kr(),i=new pe(t.minX,t.minY,t.minZ),s=new pe(t.maxX,t.maxY,t.maxZ);n.ext3(i),n.ext3(s);for(let o of this.listInstanceMatrix)n.ext3(i.multiply4(o)),n.ext3(s.multiply4(o));this.m_bBox=n.build();}return this.m_bBox;}};function tw(r,e,t,n,i,s,o,a,l,u,c=1){let h=new qe(r,e,t),d=new qe(n,i,s),f=new qe(o,a,l);return new yn(h,d,f,u*5,c);}var ew=new ArrayBuffer(8*5),ou=new Float64Array(ew),$6=new Int32Array(ew),yn=class{constructor(e,t,n,i,s){if(s<0||s>1)throw new Error("alpha must between 0 and 1");this.ambient=e,this.diffuse=t,this.specular=n,this.shininess=Ss.positiveOr0(i),this.alpha=s,ou[0]=e.hashCode(),ou[1]=t.hashCode(),ou[2]=n.hashCode(),ou[3]=i,ou[4]=s;let o=0;for(let a=0;a<10;a++)o^=$6[a];this.hashed=o;}hashCode(){return this.hashed;}equals(e){return e instanceof yn?e.ambient.equals(this.ambient)&&e.diffuse.equals(this.diffuse)&&e.specular.equals(this.specular)&&e.shininess===this.shininess&&e.alpha===this.alpha:!1;}};var sw=10,dt=10,sr=Le(2,4)-1<<dt,_o=Le(2,dt)-1,Rt=1<<dt+4,Nt=1<<dt+5,Pr=(l=>(l[l.CIRCLE=0]="CIRCLE",l[l.LINE=1]="LINE",l[l.ARC=2]="ARC",l[l.TRIANGLE=3]="TRIANGLE",l[l.RECT=4]="RECT",l[l.CUTED_CIRCLE=5]="CUTED_CIRCLE",l[l.TYPE_NUM=6]="TYPE_NUM",l[l.TEXTURE=7]="TEXTURE",l))(Pr||{});function rw(r){return(r&sr)>>dt;}var nw=new Float64Array(6),iw=[];function kn(r,e){nw[r]=e.length,iw[r]=e.getBBox;}var au={getPtLength(r,e){let t=r[e];return nw[rw(t)]+((t&Rt)===0?0:1)+((t&Nt)===0?0:1);},getBBox(r,e){return iw[rw(r[e])](r,e);}};var Km=class{constructor(){this.length=7;}create(e,t,n,i,s,o,a,l){let u=[e+(2<<dt),t.x,t.y,n,i,s,o];return typeof a=="number"&&(u[0]+=Rt,u.push(a)),typeof l=="number"&&(u[0]+=Nt,u.push(l)),u;}getBBox(e,t){let n=e[t+1],i=e[t+2],s=e[t+3],o=e[t+4],a=e[t+5],l=a+e[t+6],u=new ke();u.ext2(F.X_UNIT_VECTOR.multiply3(ze.rotate(a))),u.ext2(F.X_UNIT_VECTOR.multiply3(ze.rotate(l)));for(let d=Math.ceil(a/(Math.PI/2))*(Math.PI/2);d<l;d+=Math.PI/2)u.ext2(F.X_UNIT_VECTOR.multiply3(ze.rotate(d)));let c=u.build(),h=o/2;return new ye(c.minX*s+n-h,c.maxX*s+n+h,c.minY*s+i-h,c.maxY*s+i+h);}},tn=new Km();kn(2,tn);var Qm=class{constructor(){this.length=4;}create(e,t,n,i,s){let o=[e+(0<<dt),t.x,t.y,n];return typeof i=="number"&&(o[0]+=Rt,o.push(i)),typeof s=="number"&&(o[0]+=Nt,o.push(s)),o;}getBBox(e,t){let n=e[t+1],i=e[t+2],s=e[t+3];return new ye(n-s,n+s,i-s,i+s);}},rn=new Qm();kn(0,rn);var Jm=class{constructor(){this.length=6;}create(e,t,n,i,s,o){let a=[e+(1<<dt),t.x,t.y,n.x,n.y,i];return typeof s=="number"&&(a[0]+=Rt,a.push(s)),typeof o=="number"&&(a[0]+=Nt,a.push(o)),a;}getBBox(e,t){let n=e[t+1],i=e[t+2],s=e[t+3],o=e[t+4],a=e[t+5],l=new ke();return l.ext6(n,i),l.ext6(s,o),l.ext7(a/2),l.build();}},nn=new Jm();kn(1,nn);var e0=class{constructor(){this.length=7;}create(e,t,n,i,s,o){let a=[e+(3<<dt),t.x,t.y,n.x,n.y,i.x,i.y];return typeof s=="number"&&(a[0]+=Rt,a.push(s)),typeof o=="number"&&(a[0]+=Nt,a.push(o)),a;}getBBox(e,t){let n=e[t+1],i=e[t+2],s=e[t+3],o=e[t+4],a=e[t+5],l=e[t+6];return new ye(Math.min(n,s,a),Math.max(n,s,a),Math.min(i,o,l),Math.max(i,o,l));}},br=new e0();kn(3,br);var j6=typeof document!="undefined"&&(document.getElementById("webgpu-canvas")||document.getElementById("root")),hr=new URLSearchParams(typeof window=="undefined"?"":window.location.search),Z6=Number(hr.get("circleNum"))||2e4,H6=Number(hr.get("layerNum"))||1,K6=Number(hr.get("circleR"))||.01,jh=Number(hr.get("canvasW")),Zh=Number(hr.get("canvasH")),Q6=hr.get("entry"),_xe=hr.get("mode"),_r=Number(hr.get("maxPtNumInARtree"))||2e7,lu=Number(hr.get("copyNumX"))||1,Hh=Number(hr.get("copyNumY"))||lu,uu=Number(hr.get("copyOffsetX"))||0,Kh=Number(hr.get("copyOffsetY"))||uu,J6=Boolean(JSON.parse(hr.get("renderWhenChange"))),eF=Boolean(JSON.parse(hr.get("loopRenderMode"))),t0=Number(hr.get("maxGpuThreadNum"))||1024,r0=Number(hr.get("minFps"))||30,Oa=Number(hr.get("capacity"))||64,tF=Boolean(JSON.parse(hr.get("autoLoadData"))),Ns=Number(hr.get("maxDynamicPtNum"))||4e4,n0=Number(hr.get("texScale"))||1,rF=4e7,Sxe=rF,ht=4,i0=Le(2,30)/ht,Bxe=i0/2,wn=Le(2,Le(2,7)-1),Ixe=Le(2,31)-1;j6&&console.log({circleNum:Z6,layerNum:H6,circleR:K6,canvasW:jh,canvasH:Zh,entry:Q6,maxPtNumInARtree:_r,copyNumX:lu,copyNumY:Hh,copyOffsetX:uu,copyOffsetY:Kh,renderWhenChange:J6,loopRenderMode:eF,maxGpuThreadNum:t0,minFps:r0,capacity:Oa,autoLoadData:tF,maxDynamicPtNum:Ns,texScale:n0});function Axe(r,e=()=>""){return Se(this,null,function*(){let t=[],n=[],i=performance.now();function s(){return Se(this,null,function*(){n.push(performance.now()-i),i=performance.now(),yield r(),t.push(performance.now()-i),n.length===30&&(console.log("frame fps",1e3/(n.reduce((a,l)=>a+l,0)/n.length),"virtual fps",1e3/(t.reduce((a,l)=>a+l,0)/t.length),e()),n.length=0,t.length=0),o&&(o=requestAnimationFrame(s));});}let o=requestAnimationFrame(s);window.addEventListener("keydown",a=>{a.key==="Escape"&&(o?(cancelAnimationFrame(o),o=0):o=requestAnimationFrame(s));});});}function Cxe(r,e,t,n,i,s){return r=32767*(r-t)*i,e=32767*(e-n)*s,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1;}function ow(){return Se(this,null,function*(){if(!navigator.gpu)return;let r=yield navigator.gpu.requestAdapter(),e={};for(let n in r.limits){let i=r.limits[n];typeof i=="number"&&(e[n]=i);}let t=yield r.requestDevice({requiredLimits:e,requiredFeatures:r.features});return console.log(t.limits,Array.from(r.features)),t;});}function aw(r,e){return new Array(r).fill("").map((t,n)=>e(n)).join("");}var s0=class{constructor(){this.length=6;}create(e,t,n,i,s,o,a){let l=[e+(5<<dt),t.x,t.y,n,i,s];return typeof o=="number"&&(l[0]+=Rt,l.push(o)),typeof a=="number"&&(l[0]+=Nt,l.push(a)),l;}getBBox(e,t){let n=e[t+1],i=e[t+2],s=e[t+3],o=e[t+4],a=o+e[t+5],l=new ke();if(l.ext2(F.X_UNIT_VECTOR.multiply3(ze.rotate(o))),l.ext2(F.X_UNIT_VECTOR.multiply3(ze.rotate(a))),o<a)for(let c=Math.ceil(o/(Math.PI/2))*(Math.PI/2);c<a;c+=Math.PI/2)l.ext2(F.X_UNIT_VECTOR.multiply3(ze.rotate(c)));else for(let c=Math.floor(o/(Math.PI/2))*(Math.PI/2);c>a;c-=Math.PI/2)l.ext2(F.X_UNIT_VECTOR.multiply3(ze.rotate(c)));let u=l.build();return new ye(u.minX*s+n,u.maxX*s+n,u.minY*s+i,u.maxY*s+i);}},Xr=new s0();kn(5,Xr);var o0=class{constructor(){this.length=8;}create(e,t,n,i,s,o,a,l,u){let c=[e+(4<<dt),t.x,t.y,n,i,s,o,a];return typeof l=="number"&&(c[0]+=Rt,c.push(l)),typeof u=="number"&&(c[0]+=Nt,c.push(u)),c;}getBBox(e,t){let n=new F(e[t+1],e[t+2]),i=e[t+3],s=e[t+4],o=e[t+5],a=e[t+7],l=ze.rotateD(o),u=n.add(new F(a,-a).multiply3(l)),c=n.add(new F(a,a-s).multiply3(l)),h=n.add(new F(i-a,-a).multiply3(l)),d=n.add(new F(i-a,a-s).multiply3(l));return new ye(Math.min(u.x,c.x,h.x,d.x)-a,Math.max(u.x,c.x,h.x,d.x)+a,Math.min(u.y,c.y,h.y,d.y)-a,Math.max(u.y,c.y,h.y,d.y)+a);}},sn=new o0();kn(4,sn);function a0(r){return Le(2,Math.floor(Math.log2(r.limits.maxComputeWorkgroupStorageSize/ht/4)));}function nF(r){let e=r.limits.maxComputeWorkgroupSizeX,t=a0(r);return`
	struct BBox {
		minX: f32,
		maxX: f32,
		minY: f32,
		maxY: f32,
	}

	struct Params {
		groupOffsetX: u32,
		step: u32,
	}

    @binding(0) @group(0) var<uniform> params: Params;
	@binding(1) @group(0) var<storage, read_write> bboxs: array<BBox>;

	var<workgroup> localBBoxs: array<BBox, ${t}>;

	fn selectU(a: u32, b: u32, condition: bool) -> u32 {
		return select(a, b, condition);
	}

	fn ceilU(a: u32, b: u32) -> u32 {
		return a / b + selectU(1, 0, a % b == 0);
	}

	@compute @workgroup_size(${e})
    fn buildBBoxByBBoxs(
		@builtin(local_invocation_id) locCoord : vec3<u32>,
        @builtin(workgroup_id) groupId : vec3<u32>,
    ) {
		let bboxStep2 = params.step * 2;
		let bboxNum = arrayLength(&bboxs);
		let groupX = params.groupOffsetX + groupId.x;
		let groupStart = groupX * ${t} * bboxStep2;
		let groupEnd = select(min((groupX + 1) * ${t} * bboxStep2, bboxNum), bboxNum, (groupX + 1) * bboxStep2 >= ${Le(2,32)/t});
		let threadStart = select(groupStart + locCoord.x * bboxStep2, groupEnd, locCoord.x >= ceilU(groupEnd - groupStart, bboxStep2));
		let add = select(${e} * bboxStep2, groupEnd - threadStart, bboxStep2 >= ${Le(2,32)/e});
		for (var i = threadStart; i < groupEnd; i += add) {
			let nextI = i + params.step;
			let localBBoxIndex = (i - groupStart) / bboxStep2;
			if (nextI < groupEnd) {
				localBBoxs[localBBoxIndex].minX = min(bboxs[i].minX, bboxs[nextI].minX);
				localBBoxs[localBBoxIndex].maxX = max(bboxs[i].maxX, bboxs[nextI].maxX);
				localBBoxs[localBBoxIndex].minY = min(bboxs[i].minY, bboxs[nextI].minY);
				localBBoxs[localBBoxIndex].maxY = max(bboxs[i].maxY, bboxs[nextI].maxY);
			} else {
				localBBoxs[localBBoxIndex].minX = bboxs[i].minX;
				localBBoxs[localBBoxIndex].maxX = bboxs[i].maxX;
				localBBoxs[localBBoxIndex].minY = bboxs[i].minY;
				localBBoxs[localBBoxIndex].maxY = bboxs[i].maxY;
			}
		}

		workgroupBarrier();

		let num = ceilU(groupEnd - groupStart, bboxStep2);
		var step: u32 = 1;
		while (step < num) {
			let threadStep = step * 2 * ${e};
			for (var i = locCoord.x * step * 2 + step; i < num; i += threadStep) {
				let lastI = i - step;
				localBBoxs[lastI].minX = min(localBBoxs[i].minX, localBBoxs[lastI].minX);
				localBBoxs[lastI].maxX = max(localBBoxs[i].maxX, localBBoxs[lastI].maxX);
				localBBoxs[lastI].minY = min(localBBoxs[i].minY, localBBoxs[lastI].minY);
				localBBoxs[lastI].maxY = max(localBBoxs[i].maxY, localBBoxs[lastI].maxY);
			}
			step *= 2;
			workgroupBarrier();
		}

		if (locCoord.x == 0) {
			bboxs[groupStart].minX = localBBoxs[0].minX;
			bboxs[groupStart].maxX = localBBoxs[0].maxX;
			bboxs[groupStart].minY = localBBoxs[0].minY;
			bboxs[groupStart].maxY = localBBoxs[0].maxY;
		}
	}
`;}var Qh,lw,uw,Jh;function iF(r){if(Qh)return;let t=r.device.createShaderModule({code:nF(r)});Qh=r.createComputePipeline(t,"buildBBoxByBBoxs"),lw=r.createStaticBuffer(new Uint32Array(new Array(1024).fill(0).map((o,a)=>a*r.limits.maxComputeWorkgroupsPerDimension)),GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST);let n=a0(r)*2,i=1,s=[];for(;i<Number.MAX_SAFE_INTEGER;)s.push(i),i*=n;uw=r.createStaticBuffer(new Uint32Array(s),GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),Jh=r.createDynamicBuffer(2,GPUBufferUsage.UNIFORM|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST);}function cw(r,e){iF(r);let t=a0(r)*2,n=1,i=0,s=r.device.createCommandEncoder(),o=e.getSize()/4,a=r.createBindGroup(Qh.getBindGroupLayout(0),0,Jh,1,e);for(;n<o;){r.copyBufferToBuffer(uw,i++,Jh,1,1,s);let l=Math.ceil(o/n);r.runComputePass(s,Qh,a,(l%t===1?Math.floor:Math.ceil)(l/t)*r.limits.maxComputeWorkgroupSizeX,u=>r.copyBufferToBuffer(lw,u,Jh,0,1,s)),n*=t;}return r.submit(s),e.read(0,4).then(l=>{let u=new Float32Array(l);return new ye(u[0],u[1],u[2],u[3]);});}function sF(r){return`
	struct BBox {
		minX: f32,
		maxX: f32,
		minY: f32,
		maxY: f32,
	}

	struct Params {
		coordXOffset: u32,
	}

	struct IdStartIndex {
		id: u32,
		startIndex: u32,
	}

	struct InfoStartIndexs {
		ptNum: atomic<u32>,
		nextStartIndex: atomic<u32>,
        idStartIndexs: array<IdStartIndex>,
	}

	struct InfoStartIndexsR {
		ptNum: u32,
		nextStartIndex: u32,
        idStartIndexs: array<IdStartIndex>,
	}

    @binding(0) @group(0) var<uniform> params: Params;
	@binding(1) @group(0) var<storage, read_write> infoStartIndexs: InfoStartIndexsR;
	@binding(2) @group(0) var<storage, read_write> pts: array<f32>;
	@binding(3) @group(0) var<storage, read_write> bboxs: array<BBox>;

	@compute @workgroup_size(${r.limits.maxComputeWorkgroupSizeX})
    fn buildBBoxs(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let coordX = params.coordXOffset + coord.x;
		if (coordX >= infoStartIndexs.ptNum) {
			return;
		}

		let startIndex = infoStartIndexs.idStartIndexs[coordX].startIndex;
		let type0 = (u32(pts[startIndex]) & ${sr}) >> ${dt};
		if (type0 == ${0}) {
			bboxs[coordX].minX = pts[startIndex + 1] - pts[startIndex + 3];
			bboxs[coordX].maxX = pts[startIndex + 1] + pts[startIndex + 3];
			bboxs[coordX].minY = pts[startIndex + 2] - pts[startIndex + 3];
			bboxs[coordX].maxY = pts[startIndex + 2] + pts[startIndex + 3];
		} else if (type0 == ${1}) {
			bboxs[coordX].minX = min(pts[startIndex + 1], pts[startIndex + 3]) - pts[startIndex + 5] / 2.0;
			bboxs[coordX].maxX = max(pts[startIndex + 1], pts[startIndex + 3]) + pts[startIndex + 5] / 2.0;
			bboxs[coordX].minY = min(pts[startIndex + 2], pts[startIndex + 4]) - pts[startIndex + 5] / 2.0;
			bboxs[coordX].maxY = max(pts[startIndex + 2], pts[startIndex + 4]) + pts[startIndex + 5] / 2.0;
		} else if (type0 == ${2}) {
			let centerX = pts[startIndex + 1];
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let width2 = pts[startIndex + 4] / 2;
			let startAngle = pts[startIndex + 5];
			let endAngle = startAngle + pts[startIndex + 6];
			var x = cos(startAngle);
			var y = sin(startAngle);
			var minX = x;
			var maxX = x;
			var minY = y;
			var maxY = y;
			x = cos(endAngle);
			y = sin(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			minY = min(minY, y);
			maxY = max(maxY, y);
			for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
				x = cos(angle);
				y = sin(angle);
				minX = min(minX, x);
				maxX = max(maxX, x);
				minY = min(minY, y);
				maxY = max(maxY, y);
			}
			bboxs[coordX].minX = minX * radius - width2 + centerX;
			bboxs[coordX].maxX = maxX * radius + width2 + centerX;
			bboxs[coordX].minY = minY * radius - width2 + centerY;
			bboxs[coordX].maxY = maxY * radius + width2 + centerY;
		} else if (type0 == ${3}) {
			bboxs[coordX].minX = min(min(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]);
			bboxs[coordX].maxX = max(max(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]);
			bboxs[coordX].minY = min(min(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]);
			bboxs[coordX].maxY = max(max(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]);
		} else if (type0 == ${4}) {
			let leftUpPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]);
			let width = pts[startIndex + 3];
			let height = pts[startIndex + 4];
			let angle = radians(pts[startIndex + 5]);
			let radius = pts[startIndex + 7];

			let cos0 = cos(angle);
			let sin0 = sin(angle);
			let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0);

			let luPoint = leftUpPoint + mat0 * vec2(radius, -radius);
			let ldPoint = leftUpPoint + mat0 * vec2(radius, radius - height);
			let ruPoint = leftUpPoint + mat0 * vec2(width - radius, -radius);
			let rdPoint = leftUpPoint + mat0 * vec2(width - radius, radius - height);
			
			bboxs[coordX].minX = min(min(luPoint.x, ldPoint.x), min(ruPoint.x, rdPoint.x)) - radius;
			bboxs[coordX].maxX = max(max(luPoint.x, ldPoint.x), max(ruPoint.x, rdPoint.x)) + radius;
			bboxs[coordX].minY = min(min(luPoint.y, ldPoint.y), min(ruPoint.y, rdPoint.y)) - radius;
			bboxs[coordX].maxY = max(max(luPoint.y, ldPoint.y), max(ruPoint.y, rdPoint.y)) + radius;
		} else if (type0 == ${5}) {
			let centerX = pts[startIndex + 1];
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 4];
			let endAngle = startAngle + pts[startIndex + 5];
			var x = cos(startAngle);
			var y = sin(startAngle);
			var minX = x;
			var maxX = x;
			var minY = y;
			var maxY = y;
			x = cos(endAngle);
			y = sin(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			minY = min(minY, y);
			maxY = max(maxY, y);
			if (startAngle < endAngle) {
				for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
					x = cos(angle);
					y = sin(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			} else {
				for (var angle = floor(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle > endAngle; angle -= ${Math.PI/2}) {
					x = cos(angle);
					y = sin(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			}
			bboxs[coordX].minX = minX * radius + centerX;
			bboxs[coordX].maxX = maxX * radius + centerX;
			bboxs[coordX].minY = minY * radius + centerY;
			bboxs[coordX].maxY = maxY * radius + centerY;
		}
	}
`;}var ef,l0;function tf(r,e,t,n){return Se(this,null,function*(){if(n===0)return null;let i=r.device;ef||(ef=r.createComputePipeline(i.createShaderModule({code:sF(r)}),"buildBBoxs"),l0=r.createDynamicBuffer(1,GPUBufferUsage.UNIFORM|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST));let s=r.createDynamicBuffer(n*4,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),o=r.createBindGroup(ef.getBindGroupLayout(0),0,l0,1,e,2,t,3,s),a=i.createCommandEncoder();r.runComputePass(a,ef,o,n,u=>r.copyBufferToBuffer(r.coordXOffsetBuf,u,l0,0,1,a)),r.submit(a);let l=yield cw(r,s);return s.destroy(),l;});}var Ji=2;function hw(r,e){return`
	let num = ${e} + addiNum;
    if(${r}){
		let index = atomicAdd(&infoStartIndexs0.ptNum, 1);
		if(index < ${_r}){
			infoStartIndexs0.idStartIndexs[index].id = infoStartIndexs.idStartIndexs[coordX].id;
			let startIndex0 = atomicAdd(&infoStartIndexs0.nextStartIndex, num);
			infoStartIndexs0.idStartIndexs[index].startIndex = startIndex0;
			for(var i: u32 = 0; i < num; i++){
				pts0[startIndex0 + i] = pts[startIndex + i];
			}
			return;
		}
    }else{
		let index = atomicAdd(&infoStartIndexs1.ptNum, 1);
		if(index < ${_r}){
			infoStartIndexs1.idStartIndexs[index].id = infoStartIndexs.idStartIndexs[coordX].id;
			let startIndex1 = atomicAdd(&infoStartIndexs1.nextStartIndex, num);
			infoStartIndexs1.idStartIndexs[index].startIndex = startIndex1;
			for(var i: u32 = 0; i < num; i++){
				pts1[startIndex1 + i] = pts[startIndex + i];
			}
			return;
		}
    }
	let index = atomicAdd(&remainInfoStartIndexs.ptNum, 1);
	remainInfoStartIndexs.idStartIndexs[index].id = infoStartIndexs.idStartIndexs[coordX].id;
	let remainStartIndex = atomicAdd(&remainInfoStartIndexs.nextStartIndex, num);
	remainInfoStartIndexs.idStartIndexs[index].startIndex = remainStartIndex;
	for(var i: u32 = 0; i < num; i++){
		remainPts[remainStartIndex + i] = pts[startIndex + i];
	}
`;}function Un(r,e){return hw(`${r} < params.mid2`,e);}function ka(r){return hw("distance2(xy, params.xy0) < distance2(xy, params.xy1)",r);}function oF(r){let e=r.limits.maxComputeWorkgroupSizeX;return`
	struct Params {
		coordXOffset: u32,
        mid2: f32,
		xy0: vec2<f32>,
		minX0: f32,
		maxX0: f32,
		minY0: f32,
		maxY0: f32,
		xy1: vec2<f32>,
		minX1: f32,
		maxX1: f32,
		minY1: f32,
		maxY1: f32,
	}

	struct IdStartIndex {
		id: u32,
		startIndex: u32,
	}

	struct InfoStartIndexs {
		ptNum: atomic<u32>,
		nextStartIndex: atomic<u32>,
        idStartIndexs: array<IdStartIndex>,
	}

	struct InfoStartIndexsR {
		ptNum: u32,
		nextStartIndex: u32,
        idStartIndexs: array<IdStartIndex>,
	}

    @binding(0) @group(0) var<uniform> params: Params;
	@binding(1) @group(0) var<storage, read_write> infoStartIndexs: InfoStartIndexsR;
	@binding(2) @group(0) var<storage, read_write> pts: array<f32>;

	@binding(4) @group(0) var<storage, read_write> infoStartIndexs0: InfoStartIndexs;
	@binding(5) @group(0) var<storage, read_write> pts0: array<f32>;
	@binding(6) @group(0) var<storage, read_write> infoStartIndexs1: InfoStartIndexs;
	@binding(7) @group(0) var<storage, read_write> pts1: array<f32>;
	@binding(8) @group(0) var<storage, read_write> remainInfoStartIndexs: InfoStartIndexs;
	@binding(9) @group(0) var<storage, read_write> remainPts: array<f32>;

	fn distance2(p1: vec2<f32>, p2: vec2<f32>) -> f32 {
		let x = p1.x - p2.x;
		let y = p1.y - p2.y;
		return x * x + y * y;
	}

	fn selectU(a: u32, b: u32, condition: bool) -> u32 {
		return select(a, b, condition);
	}

    @compute @workgroup_size(${e})
    fn splitByX(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let coordX = params.coordXOffset + coord.x;
		if (coordX >= infoStartIndexs.ptNum) {
			return;
		}

		let startIndex = infoStartIndexs.idStartIndexs[coordX].startIndex;
		let head = u32(pts[startIndex]);
		let type0 = (head & ${sr}) >> ${dt};
		let addiNum = selectU(1, 0, (head & ${Rt}) == 0) + selectU(1, 0, (head & ${Nt}) == 0);
		if (type0 == ${0}) {
            ${Un("pts[startIndex + 1] * 2",rn.length)}
		} else if (type0 == ${1}) {
            ${Un("min(pts[startIndex + 1], pts[startIndex + 3]) + max(pts[startIndex + 1], pts[startIndex + 3])",nn.length)}
		} else if (type0 == ${2}) {
			let centerX = pts[startIndex + 1];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 5];
			let endAngle = startAngle + pts[startIndex + 6];
			var x = cos(startAngle);
			var minX = x;
			var maxX = x;
			x = cos(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
				x = cos(angle);
				minX = min(minX, x);
				maxX = max(maxX, x);
			}
            ${Un("minX * radius + centerX + maxX * radius + centerX",tn.length)}
		} else if (type0 == ${3}) {
            ${Un("min(min(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]) + max(max(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5])",br.length)}
		} else if (type0 == ${4}) {
			let leftUpPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]);
			let width = pts[startIndex + 3];
			let height = pts[startIndex + 4];
			let angle = radians(pts[startIndex + 5]);
			let radius = pts[startIndex + 7];

			let cos0 = cos(angle);
			let sin0 = sin(angle);
			let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0);

			let luPoint = leftUpPoint + mat0 * vec2(radius, -radius);
			let ldPoint = leftUpPoint + mat0 * vec2(radius, radius - height);
			let ruPoint = leftUpPoint + mat0 * vec2(width - radius, -radius);
			let rdPoint = leftUpPoint + mat0 * vec2(width - radius, radius - height);
            ${Un("min(min(luPoint.x, ldPoint.x), min(ruPoint.x, rdPoint.x)) + max(max(luPoint.x, ldPoint.x), max(ruPoint.x, rdPoint.x))",sn.length)}
		} else if (type0 == ${5}) {
			let centerX = pts[startIndex + 1];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 4];
			let endAngle = startAngle + pts[startIndex + 5];
			var x = cos(startAngle);
			var minX = x;
			var maxX = x;
			x = cos(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			if (startAngle < endAngle) {
				for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
					x = cos(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
				}
			} else {
				for (var angle = floor(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle > endAngle; angle -= ${Math.PI/2}) {
					x = cos(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
				}
			}
            ${Un("minX * radius + centerX + maxX * radius + centerX",Xr.length)}
		}
	}

    @compute @workgroup_size(${e})
    fn splitByY(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let coordX = params.coordXOffset + coord.x;
		if (coordX >= infoStartIndexs.ptNum) {
			return;
		}

		let startIndex = infoStartIndexs.idStartIndexs[coordX].startIndex;
		let head = u32(pts[startIndex]);
		let type0 = (head & ${sr}) >> ${dt};
		let addiNum = selectU(1, 0, (head & ${Rt}) == 0) + selectU(1, 0, (head & ${Nt}) == 0);
		if (type0 == ${0}) {
            ${Un("pts[startIndex + 2] * 2",rn.length)}
		} else if (type0 == ${1}) {
            ${Un("min(pts[startIndex + 2], pts[startIndex + 4]) + max(pts[startIndex + 2], pts[startIndex + 4])",nn.length)}
		} else if (type0 == ${2}) {
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 5];
			let endAngle = startAngle + pts[startIndex + 6];
			var y = sin(startAngle);
			var minY = y;
			var maxY = y;
			y = sin(endAngle);
			minY = min(minY, y);
			maxY = max(maxY, y);
			for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
				y = sin(angle);
				minY = min(minY, y);
				maxY = max(maxY, y);
			}
            ${Un("minY * radius + centerY + maxY * radius + centerY",tn.length)}
		} else if (type0 == ${3}) {
            ${Un("min(min(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]) + max(max(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6])",br.length)}
		} else if (type0 == ${4}) {
			let leftUpPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]);
			let width = pts[startIndex + 3];
			let height = pts[startIndex + 4];
			let angle = radians(pts[startIndex + 5]);
			let radius = pts[startIndex + 7];

			let cos0 = cos(angle);
			let sin0 = sin(angle);
			let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0);

			let luPoint = leftUpPoint + mat0 * vec2(radius, -radius);
			let ldPoint = leftUpPoint + mat0 * vec2(radius, radius - height);
			let ruPoint = leftUpPoint + mat0 * vec2(width - radius, -radius);
			let rdPoint = leftUpPoint + mat0 * vec2(width - radius, radius - height);
            ${Un("min(min(luPoint.y, ldPoint.y), min(ruPoint.y, rdPoint.y)) + max(max(luPoint.y, ldPoint.y), max(ruPoint.y, rdPoint.y))",sn.length)}
		} else if (type0 == ${5}) {
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 4];
			let endAngle = startAngle + pts[startIndex + 5];
			var y = sin(startAngle);
			var minY = y;
			var maxY = y;
			y = sin(endAngle);
			minY = min(minY, y);
			maxY = max(maxY, y);
			if (startAngle < endAngle) {
				for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
					y = sin(angle);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			} else {
				for (var angle = floor(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle > endAngle; angle -= ${Math.PI/2}) {
					y = sin(angle);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			}
            ${Un("minY * radius + centerY + maxY * radius + centerY",Xr.length)}
		}
	}

	@compute @workgroup_size(${e})
    fn splitByBBox(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let coordX = params.coordXOffset + coord.x;
		if (coordX >= infoStartIndexs.ptNum) {
			return;
		}

		let startIndex = infoStartIndexs.idStartIndexs[coordX].startIndex;
		let head = u32(pts[startIndex]);
		let type0 = (head & ${sr}) >> ${dt};
		let addiNum = selectU(1, 0, (head & ${Rt}) == 0) + selectU(1, 0, (head & ${Nt}) == 0);
		var xy: vec2<f32>;
		if (type0 == ${0}) {
			xy = vec2(pts[startIndex + 1], pts[startIndex + 2]);
			${ka(rn.length)}
		} else if (type0 == ${1}) {
			xy = vec2((min(pts[startIndex + 1], pts[startIndex + 3]) + max(pts[startIndex + 1], pts[startIndex + 3])) / 2,
				(min(pts[startIndex + 2], pts[startIndex + 4]) + max(pts[startIndex + 2], pts[startIndex + 4])) / 2);
			${ka(nn.length)}
		} else if (type0 == ${2}) {
			let centerX = pts[startIndex + 1];
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 5];
			let endAngle = startAngle + pts[startIndex + 6];
			var x = cos(startAngle);
			var y = sin(startAngle);
			var minX = x;
			var maxX = x;
			var minY = y;
			var maxY = y;
			x = cos(endAngle);
			y = sin(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			minY = min(minY, y);
			maxY = max(maxY, y);
			for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
				x = cos(angle);
				y = sin(angle);
				minX = min(minX, x);
				maxX = max(maxX, x);
				minY = min(minY, y);
				maxY = max(maxY, y);
			}
			xy = vec2((minX * radius + centerX + maxX * radius + centerX) / 2, (minY * radius + centerY + maxY * radius + centerY) / 2);
			${ka(tn.length)}
		} else if (type0 == ${3}) {
			xy = vec2((min(min(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]) + max(max(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5])) / 2,
				(min(min(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]) + max(max(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6])) / 2);
			${ka(br.length)}
		} else if (type0 == ${4}) {
			let leftUpPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]);
			let width = pts[startIndex + 3];
			let height = pts[startIndex + 4];
			let angle = radians(pts[startIndex + 5]);
			let radius = pts[startIndex + 7];

			let cos0 = cos(angle);
			let sin0 = sin(angle);
			let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0);

			let luPoint = leftUpPoint + mat0 * vec2(radius, -radius);
			let ldPoint = leftUpPoint + mat0 * vec2(radius, radius - height);
			let ruPoint = leftUpPoint + mat0 * vec2(width - radius, -radius);
			let rdPoint = leftUpPoint + mat0 * vec2(width - radius, radius - height);

			xy = vec2((min(min(luPoint.x, ldPoint.x), min(ruPoint.x, rdPoint.x)) + max(max(luPoint.x, ldPoint.x), max(ruPoint.x, rdPoint.x))) / 2,
				(min(min(luPoint.y, ldPoint.y), min(ruPoint.y, rdPoint.y)) + max(max(luPoint.y, ldPoint.y), max(ruPoint.y, rdPoint.y))) / 2);
			${ka(sn.length)}
		} else if (type0 == ${5}) {
			let centerX = pts[startIndex + 1];
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 4];
			let endAngle = startAngle + pts[startIndex + 5];
			var x = cos(startAngle);
			var y = sin(startAngle);
			var minX = x;
			var maxX = x;
			var minY = y;
			var maxY = y;
			x = cos(endAngle);
			y = sin(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			minY = min(minY, y);
			maxY = max(maxY, y);
			if (startAngle < endAngle) {
				for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
					x = cos(angle);
					y = sin(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			} else {
				for (var angle = floor(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle > endAngle; angle -= ${Math.PI/2}) {
					x = cos(angle);
					y = sin(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			}
			xy = vec2((minX * radius + centerX + maxX * radius + centerX) / 2, (minY * radius + centerY + maxY * radius + centerY) / 2);
			${ka(Xr.length)}
		}
	}
`;}var cu;function aF(r){if(cu)return;let t=r.device.createShaderModule({code:oF(r)});cu={splitByX:r.createComputePipeline(t,"splitByX"),splitByY:r.createComputePipeline(t,"splitByY"),splitByBBox:r.createComputePipeline(t,"splitByBBox")};}function fw(r,e,t,n,i,s,o,a,l,u){return Se(this,null,function*(){aF(r);let c=r.device,h,d=r.createDynamicBuffer(14,GPUBufferUsage.UNIFORM|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST);if(i&&a)r.writeBuffer(d,2,new Float32Array([i.center().x,i.center().y,i.minX,i.maxX,i.minY,i.maxY,a.center().x,a.center().y,a.minX,a.maxX,a.minY,a.maxY])),h=cu.splitByBBox;else{let P=yield tf(r,t,n,e);P.width()>P.height()?(r.writeBuffer(d,1,new Float32Array([P.minX+P.maxX])),h=cu.splitByX):(r.writeBuffer(d,1,new Float32Array([P.minY+P.maxY])),h=cu.splitByY);}let f=r.createDynamicBuffer(t.getSize(),t.usage),p=r.createDynamicBuffer(n.getSize(),n.usage),m=r.createBindGroup(h.getBindGroupLayout(0),0,d,1,t,2,n,4,s,5,o,6,l,7,u,8,f,9,p),g=c.createCommandEncoder();r.runComputePass(g,h,m,t.getSize(),P=>r.copyBufferToBuffer(r.coordXOffsetBuf,P,d,0,1,g)),r.submit(g),d.destroy();let[b,y,v]=yield Promise.all([f.read(0,2),s.read(0,2),l.read(0,2)]).then(P=>P.map(M=>new Uint32Array(M)));if((y[0]===0||v[0]===0)&&console.warn("info0[0] === 0 || info1[0] === 0"),b[0]===0)t.write(0,new Uint32Array([0,0]));else{let P=c.createCommandEncoder();r.copyBufferToBuffer(f,0,t,0,b[0]*2+Ji,P),r.copyBufferToBuffer(p,0,n,0,b[1],P),r.submit(P);}f.destroy(),p.destroy();let E=yield Promise.all([tf(r,s,o,y[0]),tf(r,l,u,v[0])]);return[{ptNum:b[0],nextStartIndex:b[1]},{bbox:E[0],ptNum:y[0],nextStartIndex:y[1]},{bbox:E[1],ptNum:v[0],nextStartIndex:v[1]}];});}function rf(r,e,t){let n=r.startsWith("filter1"),i=r.endsWith("End");return`
	@compute @workgroup_size(${t})
    fn ${r}(
		@builtin(global_invocation_id) coord: vec3<u32>,
    ) {
		if(coord.x ${n?"":"+ uniforms.coordXOffset"} >= uniforms.inNum){
			return;
		}
		let node = nodes[${n?"coord.x + uniforms.filterStart":"inIndexs[coord.x + uniforms.coordXOffset]"}];
		var p0 = camera.mvpMatrix * vec4(node.minX, node.minY, uniforms.minZ, 1);
		var p1 = camera.mvpMatrix * vec4(node.minX, node.maxY, uniforms.minZ, 1);
		var p2 = camera.mvpMatrix * vec4(node.maxX, node.minY, uniforms.minZ, 1);
		var p3 = camera.mvpMatrix * vec4(node.maxX, node.maxY, uniforms.minZ, 1);
		var p4 = camera.mvpMatrix * vec4(node.minX, node.minY, uniforms.maxZ, 1);
		var p5 = camera.mvpMatrix * vec4(node.minX, node.maxY, uniforms.maxZ, 1);
		var p6 = camera.mvpMatrix * vec4(node.maxX, node.minY, uniforms.maxZ, 1);
		var p7 = camera.mvpMatrix * vec4(node.maxX, node.maxY, uniforms.maxZ, 1);
		${aw(8,s=>`p${s}.x/=p${s}.w;p${s}.y/=p${s}.w;p${s}.z/=p${s}.w;`)}
		if(min(min(min(p0.x, p1.x), min(p2.x, p3.x)), min(min(p4.x, p5.x), min(p6.x, p7.x))) >= 1 || 
			max(max(max(p0.x, p1.x), max(p2.x, p3.x)), max(max(p4.x, p5.x), max(p6.x, p7.x))) <= -1 ||
			min(min(min(p0.y, p1.y), min(p2.y, p3.y)), min(min(p4.y, p5.y), min(p6.y, p7.y))) >= 1 || 
			max(max(max(p0.y, p1.y), max(p2.y, p3.y)), max(max(p4.y, p5.y), max(p6.y, p7.y))) <= -1 ||
			select(
				((p0.z <= 0 || p0.z > 1) && (p1.z <= 0 || p1.z > 1) && (p2.z <= 0 || p2.z > 1) && (p3.z <= 0 || p3.z > 1) &&
				(p4.z <= 0 || p4.z > 1) && (p5.z <= 0 || p5.z > 1) && (p6.z <= 0 || p6.z > 1) && (p7.z <= 0 || p7.z > 1)) ||
				((p0.z <= camera.borderZ && p0.z > 0) && (p1.z <= camera.borderZ && p1.z > 0) && (p2.z <= camera.borderZ && p2.z > 0) && (p3.z <= camera.borderZ && p3.z > 0) &&
				(p4.z <= camera.borderZ && p4.z > 0) && (p5.z <= camera.borderZ && p5.z > 0) && (p6.z <= camera.borderZ && p6.z > 0) && (p7.z <= camera.borderZ && p7.z > 0)),
				min(min(min(p0.z, p1.z), min(p2.z, p3.z)), min(min(p4.z, p5.z), min(p6.z, p7.z))) >= 1 ||
				max(max(max(p0.z, p1.z), max(p2.z, p3.z)), max(max(p4.z, p5.z), max(p6.z, p7.z))) <= 0,
				camera.isOrth != 0
			)
		) {
			return;
		}

		var num: u32 = 0;
		for(var i = 0; i < ${e}; i++) {
			if(node.childIndexs[i] != 0){
				num++;
			}
		}

		var index = atomicAdd(&nextIndex, num);
		for(var i = 0; i < ${e}; i++) {
			let childIndex = node.childIndexs[i];
			if(childIndex != 0){
				outIndexs[index] = ${i?"-childIndex - 1":"childIndex"};
				index++;
			}
		}
	}`;}var dw=5;function lF(r,e){let t=e.limits.maxComputeWorkgroupSizeX;return`
	struct Uniforms {
		filterStart: u32,
		minZ: f32,
		maxZ: f32,
		inNum: u32,

		// 4
		coordXOffset: u32,
    }

    struct Node {
        minX: f32,
        maxX: f32,
        minY: f32,
        maxY: f32,
		childIndexs: array<i32, ${r}>,
    }

	${en}

	@binding(0) @group(0) var<uniform> uniforms: Uniforms;
    @binding(1) @group(0) var<storage, read_write> nextIndex: atomic<u32>;
	@binding(2) @group(0) var<storage, read> nodes: array<Node>;
	@binding(3) @group(0) var<storage, read> inIndexs: array<i32>;
	@binding(4) @group(0) var<storage, read_write> outIndexs: array<i32>;
	@binding(6) @group(0) var<uniform> camera: Camera;

	${rf("filter1",r,t)}
	${rf("filter1End",r,t)}

	${rf("filter2",r,t)}
	${rf("filter2End",r,t)}

	fn selectU(a: u32, b: u32, condition: bool) -> u32 {
		return select(a, b, condition);
	}

	@binding(5) @group(0) var<storage, read_write> workgroupCount: vec3<u32>;

	@compute @workgroup_size(1)
    fn calWorkgroupCountX() {
		let x = uniforms.inNum / ${t} + selectU(1, 0, uniforms.inNum % ${t} == 0);
		workgroupCount.x = select(0, min(x - uniforms.coordXOffset / ${t}, ${e.limits.maxComputeWorkgroupsPerDimension}), x > uniforms.coordXOffset / ${t});
	}
`;}var nf=class{constructor(e,t){this.scene=e;let n=e.gpu;this.gpu=n;let i=n.device;this.capacity=t,this.uniformsBuf=n.createDynamicBuffer(dw,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM),this.indirectBuffer=n.createDynamicBuffer(3,GPUBufferUsage.COPY_DST|GPUBufferUsage.INDIRECT|GPUBufferUsage.STORAGE),this.indirectBuffer.write(0,new Uint32Array([0,1,1])),this.indexsBuf2=new Array(2).fill("").map(()=>n.createDynamicBuffer(_r,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC));let s=i.createShaderModule({code:lF(t,n)});this.nextIndexsBuf=n.createDynamicBuffer(1,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),this.filter1Pipeline=n.createComputePipeline(s,"filter1"),this.filter1EndPipeline=n.createComputePipeline(s,"filter1End"),this.filter2Pipeline=n.createComputePipeline(s,"filter2"),this.filter2EndPipeline=n.createComputePipeline(s,"filter2End"),this.calWorkgroupCountXPipeline=n.createComputePipeline(s,"calWorkgroupCountX"),this.filter1Layout=this.filter1Pipeline.getBindGroupLayout(0),this.filter1EndLayout=this.filter1EndPipeline.getBindGroupLayout(0),this.filter2Layout=this.filter2Pipeline.getBindGroupLayout(0),this.filter2EndLayout=this.filter2EndPipeline.getBindGroupLayout(0),this.calWorkgroupCountXBindGroup=n.createBindGroup(this.calWorkgroupCountXPipeline.getBindGroupLayout(0),0,this.uniformsBuf,5,this.indirectBuffer);}createFilterRenderBindGroups(e,t,n){let i=this.indexsBuf2;return{filter1BindGroup2:i.map((s,o)=>this.createFilter1BindGroup(t,i[(o+1)%2])),filter1EndBindGroup2:i.map((s,o)=>this.createFilter1EndBindGroup(t,i[(o+1)%2])),filter2BindGroup2:i.map((s,o)=>this.createFilter2BindGroup(t,s,i[(o+1)%2])),filter2EndBindGroup2:i.map((s,o)=>this.createFilter2EndBindGroup(t,s,i[(o+1)%2])),filterPtBindGroup2:i.map((s,o)=>this.scene.filterPtProgram.createDynamicBindGroup(e,s,n)),renderBindGroup:this.scene.renderPtProgram.createDynamicBindGroup(e,n)};}createFilter1BindGroup(e,t){return this.gpu.createBindGroup(this.filter1Layout,0,this.uniformsBuf,1,this.nextIndexsBuf,2,e,4,t,6,this.scene.cameraBuf);}createFilter1EndBindGroup(e,t){return this.gpu.createBindGroup(this.filter1EndLayout,0,this.uniformsBuf,1,this.nextIndexsBuf,2,e,4,t,6,this.scene.cameraBuf);}createFilter2BindGroup(e,t,n){return this.gpu.createBindGroup(this.filter2Layout,0,this.uniformsBuf,1,this.nextIndexsBuf,2,e,3,t,4,n,6,this.scene.cameraBuf);}createFilter2EndBindGroup(e,t,n){return this.gpu.createBindGroup(this.filter2EndLayout,0,this.uniformsBuf,1,this.nextIndexsBuf,2,e,3,t,4,n,6,this.scene.cameraBuf);}calWorkgroupCountX(e){this.gpu.runComputePass(e,this.calWorkgroupCountXPipeline,this.calWorkgroupCountXBindGroup,1);}filter(e,t,n,i,s){let o=new Uint32Array(dw),a=new Float32Array(o.buffer);o[0]=e.startNodeIndex,a[1]=t,a[2]=n,o[3]=e.nodeNum,this.scene.addData(o,this.uniformsBuf);let l=this.gpu.limits.maxComputeWorkgroupsPerDimension,u=this.scene.commandEncoder;for(let c=0;c<i;c++)if(c===0)this.nextIndexsBuf.clear(u),c===i-1?this.gpu.runComputePass(u,this.filter1EndPipeline,s.filter1EndBindGroup2[c%2],e.nodeNum):this.gpu.runComputePass(u,this.filter1Pipeline,s.filter1BindGroup2[c%2],e.nodeNum);else{this.gpu.copyBufferToBuffer(this.nextIndexsBuf,0,this.uniformsBuf,3,1,u),this.nextIndexsBuf.clear(u);let h=Math.ceil(e.nodeNum*Le(this.capacity,c)/this.gpu.limits.maxComputeWorkgroupSizeX);for(let d=0;d<h;d+=l)this.gpu.copyBufferToBuffer(this.gpu.coordXOffsetBuf,d/l,this.uniformsBuf,4,1,u),this.calWorkgroupCountX(u),c===i-1?this.gpu.runComputePassIndirect(u,this.filter2EndPipeline,s.filter2EndBindGroup2[c%2],this.indirectBuffer):this.gpu.runComputePassIndirect(u,this.filter2Pipeline,s.filter2BindGroup2[c%2],this.indirectBuffer);}return this.nextIndexsBuf;}};var nbe=4096,sf=class{constructor(){this.group=new We(2,!0);this.cameraSet=new Set();this.needRenderAll=!0;}getCameraSet(){return this.cameraSet;}addCamera(e){this.cameraSet.add(e);}delCamera(e){this.cameraSet.delete(e),this.needRenderAll=!0;}};var vi=class{constructor(e,t,n,i,s){this.gpu=e,this.buffer=e.createBuffer(t,n,i,s);}get usage(){return this.buffer.usage;}getSize(){return this.buffer.size/ht;}getBuffer(){return this.buffer;}read(e=0,t=this.getSize()){return this.gpu.readBuffer(this,e,t);}destroy(){this.gpu.bufferSize-=this.getSize(),this.buffer.destroy(),delete this.buffer;}};var Ls=class extends vi{constructor(t,n,i,s){super(t,n,i,!1,s);this.listeners=new Set();}setSize(t){t!==this.getSize()&&this.setBuffer(this.gpu.createBuffer(t,this.buffer.usage,!1,this.buffer.label));}extSize(t){if(t<=this.getSize())return;let n=this.gpu.createDynamicBuffer(t,this.buffer.usage,this.buffer.label);this.gpu.copyBufferToBuffer(this,0,n,0,this.getSize()),this.setBuffer(n.buffer);}trim(t){if(this.getSize()===t)return;if(this.getSize()<t)throw new Error("this.getSize() < size32");let n=this.gpu.createDynamicBuffer(t,this.buffer.usage,this.buffer.label);this.gpu.copyBufferToBuffer(this,0,n,0,t),this.setBuffer(n.buffer);}setBuffer(t){this.gpu.bufferSize-=this.getSize(),this.buffer.destroy(),this.buffer=t,this.listeners.forEach(n=>n(this.buffer));}molt(t){let n=this.gpu.createDynamicBuffer(0,this.buffer.usage,this.buffer.label);return n.setBuffer(this.buffer),this.buffer=this.gpu.createBuffer(t,this.buffer.usage,!1,this.buffer.label),this.listeners.forEach(i=>i(this.buffer)),n;}setDynamicBuffer(t){this.setBuffer(t.buffer),delete t.buffer;}clear(t,n=0,i=this.getSize()-n){t.clearBuffer(this.buffer,n*ht,i*ht);}addListener(t){this.listeners.add(t);}delListener(t){this.listeners.delete(t);}write(t,n,i=0,s){this.gpu.writeBuffer(this,t,n,i,s);}};var Dn=class{constructor(e,t,n,i,s){this.listeners=new Set();this.gpu=e,this.format=i,this.usage=s,this._texture=e.device.createTexture({size:[t,n],format:i,usage:s}),this._view=this._texture.createView();}get texture(){return this._texture;}get view(){return this._view;}get width(){return this._texture.width;}get height(){return this._texture.height;}updateSize(e,t){e===this.width&&t===this.height||(this._texture.destroy(),this._texture=this.gpu.device.createTexture({size:[e,t],format:this.format,usage:this.usage}),this._view=this._texture.createView(),this.listeners.forEach(n=>n(this._view)));}extSize(e,t,n,i){let s=this.gpu.device.createTexture({size:[this.width+e+n,this.height+t+i],format:this.format,usage:this.usage});this.gpu.run(o=>o.copyTextureToTexture({texture:this._texture},{texture:s,origin:{x:e,y:t}},this._texture)),this._texture.destroy(),this._texture=s,this._view=this._texture.createView(),this.listeners.forEach(o=>o(this._view));}addListener(e){this.listeners.add(e);}delListener(e){this.listeners.delete(e);}destroy(){this._texture.destroy(),delete this._texture;}};var of=class{constructor(e,t,...n){this.bufferListeners=[];this.gpu=e,this.layout=t,this.entries=[];for(let i=1;i<n.length;i+=2){let s=n[i-1],o=n[i];if(o instanceof vi){let a={buffer:o.getBuffer()};if(this.entries.push({binding:s,resource:a}),o instanceof Ls){let l=u=>{if(u.size===0)throw new Error("buffer.size === 0");a.buffer=u,this.updateBindGroup();};o.addListener(l),this.bufferListeners.push([o,l]);}}else if(o instanceof Dn){let a=this.entries.push({binding:s,resource:o.view})-1,l=u=>{this.entries[a].resource=u,this.updateBindGroup();};o.addListener(l),this.bufferListeners.push([o,l]);}else this.entries.push({binding:s,resource:o});}this.updateBindGroup();}updateBindGroup(){this.bindGroup=this.gpu.device.createBindGroup({layout:this.layout,entries:this.entries});}getBindGroup(){return this.bindGroup;}destroy(){this.bufferListeners.forEach(([e,t])=>e.delListener(t)),delete this.bindGroup;}};var af=class extends vi{constructor(e,t,n,i){super(e,t.length,n,!0,i),new Uint32Array(this.buffer.getMappedRange()).set(t),this.buffer.unmap();}};var Ua=class{constructor(e){this.presentationFormat=navigator.gpu.getPreferredCanvasFormat();this.tempBufIndex={};this.bufferSize=0;this.device=e,this.coordXOffsetBuf=this.createStaticBuffer(new Uint32Array(1024).map((t,n)=>n*e.limits.maxComputeWorkgroupsPerDimension*e.limits.maxComputeWorkgroupSizeX),GPUBufferUsage.COPY_SRC),this.numBuf=this.createStaticBuffer(new Uint32Array(1024).map((t,n)=>n),GPUBufferUsage.COPY_SRC),e.features.has("texture-compression-bc")?this.textureCompression="bc":e.features.has("texture-compression-etc2")?this.textureCompression="etc2":e.features.has("texture-compression-astc")&&(this.textureCompression="astc");}static build(){return Se(this,null,function*(){let e=yield ow();return new Ua(e);});}get limits(){return this.device.limits;}get features(){return this.device.features;}getTempBuf(e){return e=Le(2,Math.ceil(Math.log2(e))),this.tempBufIndex[e]||(this.tempBufIndex[e]=this.createDynamicBuffer(e,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)),this.tempBufIndex[e];}createBuffer(e,t,n,i){return this.bufferSize+=e,this.device.createBuffer({size:e*ht,usage:t,mappedAtCreation:n,label:i});}createDynamicBuffer(e,t,n){return new Ls(this,e,t,n);}createStaticBuffer(e,t,n){return new af(this,e,t,n);}createComputePipeline(e,t,n="auto",i,s){return this.device.createComputePipeline({layout:n,compute:{module:e,entryPoint:t,constants:i},label:s});}submit(...e){this.device.queue.submit(e.map(t=>t.finish()));}copyBufferToBuffer(e,t,n,i,s,o){if(t+s>e.getSize()||i+s>n.getSize())throw new Error("sourceOffset32 + size32 > source.getSize() || destinationOffset32 + size32 > destination.getSize()");if(o)o.copyBufferToBuffer(e.getBuffer(),t*ht,n.getBuffer(),i*ht,s*ht);else{let a=this.device.createCommandEncoder();a.copyBufferToBuffer(e.getBuffer(),t*ht,n.getBuffer(),i*ht,s*ht),this.submit(a);}}writeBuffer(e,t,n,i=0,s){if(s===void 0&&(s=Math.min(e.getSize()-t,n.byteLength/ht-i)),t+s>e.getSize()||(i+s)*ht>n.byteLength)throw new Error("bufferOffset32 + size32 > buffer.getSize() || (dataOffset32 + size32) * BYTES32 > data.byteLength");this.device.queue.writeBuffer(e.getBuffer(),t*ht,n instanceof ArrayBuffer?n:n.buffer,i*ht,s*ht);}runComputePass(e,t,n,i,s=o=>{if(o!==0)throw new Error("i !== 0");}){let{maxComputeWorkgroupsPerDimension:o,maxComputeWorkgroupSizeX:a}=this.limits,l=Math.ceil(i/a);for(let u=0;u<l;u+=o){s(u/o);let c=e.beginComputePass();c.setPipeline(t),c.setBindGroup(0,n),c.dispatchWorkgroups(Math.min(l-u,o)),c.end();}}run(e){let t=this.device.createCommandEncoder();e(t),this.submit(t);}runComputePassIndirect(e,t,n,i,s=0){let o=e.beginComputePass();o.setPipeline(t),o.setBindGroup(0,n),o.dispatchWorkgroupsIndirect(i.getBuffer(),s),o.end();}createBindGroup(e,...t){let n=[];for(let i=1;i<t.length;i+=2){let s=t[i];n.push({binding:t[i-1],resource:s instanceof vi?{buffer:s.getBuffer()}:s});}return this.device.createBindGroup({layout:e,entries:n});}createDynamicBindGroup(e,...t){return new of(this,e,...t);}clearColorView(e,t,n=t,i=t,s=1){let o=this.device.createCommandEncoder();o.beginRenderPass({colorAttachments:[{view:e,clearValue:{r:t,g:n,b:i,a:s},loadOp:"clear",storeOp:"store"}]}).end(),this.submit(o);}clearDepthView(e,t=0){let n=this.device.createCommandEncoder();n.beginRenderPass({colorAttachments:[],depthStencilAttachment:{view:e,depthClearValue:t,depthLoadOp:"clear",depthStoreOp:"store"}}).end(),this.submit(n);}readBuffer(i){return Se(this,arguments,function*(e,t=0,n=e.getSize()){let s=this.createDynamicBuffer(n-t,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);this.copyBufferToBuffer(e,t,s,0,n-t),yield s.getBuffer().mapAsync(GPUMapMode.READ);let o=s.getBuffer().getMappedRange().slice(0);return s.getBuffer().unmap(),s.destroy(),o;});}};var pw=42;function Da(r="output.position"){return`
	output.Position = camera.mvpMatrix * uniforms.matrix * vec4(${r}, 0, 1);
	output.Position.z = order / ${Le(2,23)} * output.Position.w;
	if(uniforms.renderMode == 1){
		let matrix = camera.mvMatrix * uniforms.matrix;
		output.normal = mat3x3(vec3(matrix[0].xyz), vec3(matrix[1].xyz), vec3(matrix[2].xyz)) * vec3<f32>(0, 0, 1);
		let pos = matrix * vec4(${r}, 0, 1);
		output.surfaceToEye = vec3(0, 0, length(camera.pos)) - pos.xyz / pos.w;
	}`;}var Ga=`
	if(uniforms.renderMode == 0 || uniforms.renderMode == 2){
		if(colorIndex > 0.5){
			return colors[u32(colorIndex + 0.5)];
		}
		return uniforms.color;
	}

	const ambientLightColor = vec3(0.1, 0.1, 0.1);
	const directLightColor = vec3<f32>(1, 1, 1);
	const directLightDir0 = vec3<f32>(0, 0, 1);

	var ambientFactor: vec3<f32>;
	var diffuseFactor: vec3<f32>;
	var specularFactor: vec3<f32>;
	if(colorIndex < 0.5) {
		ambientFactor = uniforms.ambientFactor;
		diffuseFactor = uniforms.diffuseFactor;
		specularFactor = uniforms.specularFactor;
	} else {
		ambientFactor = colors[u32(colorIndex + 0.5)].rgb;
		diffuseFactor = ambientFactor;
		specularFactor = ambientFactor;
	}

	var ambient = ambientFactor * ambientLightColor;

	var normal0 = normalize(normal);
	var directLightDir = normalize(directLightDir0);
	var diffuse = abs(dot(normal0 , directLightDir)) * diffuseFactor * directLightColor;

	var reflect = -2.0 * normal0 * dot(directLightDir, normal0) + directLightDir;
	var surfaceToEye0 = normalize(surfaceToEye);
	var lightToEyeFactor = abs(dot(reflect, surfaceToEye0));
	var specular = specularFactor * directLightColor * pow(lightToEyeFactor, 300.0) * uniforms.shininess * 0.1;

	return vec4(ambient + diffuse + specular, uniforms.alpha);
`,uF=`
	struct Uniforms {
        matrix: mat4x4<f32>,

		// 16
		color: vec4<f32>,			// \u9876\u70B9\u989C\u8272

		// 20
        ambientFactor: vec3<f32>,	// \u73AF\u5883\u5149\u56E0\u5B50

		// 24
        diffuseFactor: vec3<f32>,	// \u6F2B\u53CD\u5C04\u56E0\u5B50

		// 28
        specularFactor: vec3<f32>,	// \u955C\u9762\u53CD\u5C04\u56E0\u5B50
        shininess: f32,				// \u6750\u6599\u5149\u6CFD\u5EA6

		// 32
        alpha: f32,					// \u6750\u6599alpha\u503C
		pxLength: f32,				// \u5355\u4F4D\u50CF\u7D20\u957F\u5EA6
		renderMode: u32,			// \u6E32\u67D3\u6A21\u5F0F(\u6750\u8D28:1|\u7EBF\u6846:2|others:0)
		isNormal: u32,				// ?

		// 36
		circleOffset: u32,			// 
		lineOffset: u32,			// 
		arcOffset: u32,				// 
		triangleOffset: u32,		// 

		// 40
		rectOffset: u32,			//
		cutedCircleOffset: u32,		//
    }

	${en}

	@binding(0) @group(0) var<uniform> camera: Camera;
	@binding(1) @group(0) var<uniform> uniforms: Uniforms;
    @binding(2) @group(0) var<storage, read> indexsR: array<i32>;
	@binding(3) @group(0) var<storage, read> pts: array<f32>;
	@binding(4) @group(0) var<storage, read> colors: array<vec4<f32>>;

    struct CircleOutput {
        @builtin(position) Position: vec4<f32>,
        @location(0) position: vec2<f32>,
        @location(1) r: f32,
		@location(2) normal: vec3<f32>,
		@location(3) surfaceToEye: vec3<f32>,
		@location(4) colorIndex: f32,
    }
	
    @vertex
    fn circleVert(
        @builtin(vertex_index) vIndex: u32,
        @builtin(instance_index) iIndex: u32,
    ) -> CircleOutput {
		let startIndex = indexsR[iIndex + uniforms.circleOffset];
        var output: CircleOutput;
		let head = u32(pts[startIndex]);
		let center = vec2(pts[startIndex + 1], pts[startIndex + 2]);
        output.r = max(pts[startIndex + 3], uniforms.pxLength / 2);
		var index = startIndex + 4;
		var order: f32;
		if((head & ${Rt}) != 0){
			order = pts[index];
			index++;
		}
		if((head & ${Nt}) != 0){
			output.colorIndex = pts[index];
		}
        var sq = sqrt(3.0);
		if(vIndex == 0){
            output.position = center + vec2(-output.r * sq, -output.r);
        }else if(vIndex == 1){
            output.position = center + vec2(output.r * sq, -output.r);
        }else{
            output.position = center + vec2(0, 2 * output.r);
		}
		${Da()}
		output.position -= center;
        return output;
    }

    @fragment
    fn circleFrag(
        @builtin(position) Position : vec4<f32>,
        @location(0) position: vec2<f32>,
        @location(1) r: f32,
		@location(2) normal: vec3<f32>,
		@location(3) surfaceToEye: vec3<f32>,
		@location(4) colorIndex: f32,
    ) -> @location(0) vec4<f32> {
        if((uniforms.isNormal != 0 && Position.z <= camera.borderZ) || length(position) > r){
            discard;
        }
		if(uniforms.renderMode == 2 && length(position) < r - uniforms.pxLength){
			discard;
		}
		${Ga}
    }

    struct LineOutput {
        @builtin(position) Position: vec4<f32>,
        @location(0) position: vec2<f32>,
        @location(1) start: vec2<f32>,
        @location(2) end: vec2<f32>,
        @location(3) halfWidth: f32,
		@location(4) normal: vec3<f32>,
		@location(5) surfaceToEye: vec3<f32>,
		@location(6) colorIndex: f32,
    }

    @vertex
    fn lineVert(
        @builtin(vertex_index) vIndex: u32,
        @builtin(instance_index) iIndex: u32,
    ) -> LineOutput {
		let startIndex = indexsR[iIndex + uniforms.lineOffset];
        var output: LineOutput;
		let head = u32(pts[startIndex]);
		output.start = vec2(pts[startIndex + 1], pts[startIndex + 2]);
		output.end = vec2(pts[startIndex + 3], pts[startIndex + 4]);
		output.halfWidth = max(pts[startIndex + 5], uniforms.pxLength) / 2;
		var index = startIndex + 6;
		var order: f32;
		if((head & ${Rt}) != 0){
			order = pts[index];
			index++;
		}
		if((head & ${Nt}) != 0){
			output.colorIndex = pts[index];
		}
		var direct: vec2<f32>;
        if(all(output.start == output.end)){
            direct = vec2(1, 0);
        }else{
            direct = normalize(output.end - output.start);
        }
        let vertical = vec2(-direct.y, direct.x);
        let h_offset = vertical * output.halfWidth; // \u7528\u4E8E\u8BA1\u7B97\u5782\u76F4\u65B9\u5411\u843D\u70B9
        let v_offset = direct * output.halfWidth; // \u7528\u4E8E\u8BA1\u7B97\u6A2A\u5411\u6269\u5C55
        if(vIndex == 0 || vIndex == 5){
            output.position = output.start - h_offset - v_offset;
        }else if(vIndex == 1){
            output.position = output.end - h_offset + v_offset;
        }else if(vIndex == 2 || vIndex == 3){
            output.position = output.end + h_offset + v_offset;
        }else if(vIndex == 4){
            output.position = output.start + h_offset - v_offset;
        }
		${Da()}
        return output;
    }

    @fragment
    fn lineFrag(
        @builtin(position) Position : vec4<f32>,
        @location(0) position: vec2<f32>,
        @location(1) start: vec2<f32>,
        @location(2) end: vec2<f32>,
        @location(3) halfWidth: f32,
		@location(4) normal: vec3<f32>,
		@location(5) surfaceToEye: vec3<f32>,
		@location(6) colorIndex: f32,
    ) -> @location(0) vec4<f32> {
		if(uniforms.isNormal != 0 && Position.z <= camera.borderZ){
			discard;
		}
        var direct = end - start;
        let len = length(direct);
        if(len == 0){
            direct = vec2(1, 0);
        }else{
            direct = normalize(direct);
        }
		let dir = position - start;
		let l = dot(dir, direct);
		if(l < 0.0){
			let dis = length(dir);
			if(dis > halfWidth){
				discard;
			}
			if(uniforms.renderMode == 2 && dis < halfWidth - uniforms.pxLength){
				discard;
			}
		}else if(l > len){
			let dis = length(position - end);
			if(length(position - end) > halfWidth){
				discard;
			}
			if(uniforms.renderMode == 2 && dis < halfWidth - uniforms.pxLength){
				discard;
			}
		} else if (uniforms.renderMode == 2 && abs(dot(vec2(-direct.y, direct.x), dir)) < halfWidth - uniforms.pxLength){
			discard;
		}

		${Ga}
    }

    struct ArcOutput {
        @builtin(position) Position: vec4<f32>,
        @location(0) R: f32,
        @location(1) r: f32,
        @location(2) center: vec2<f32>,
        @location(3) startAngle: f32,
        @location(4) endAngle: f32,
        @location(5) position: vec2<f32>,
		@location(6) normal: vec3<f32>,
		@location(7) surfaceToEye: vec3<f32>,
		@location(8) colorIndex: f32,
    }

    @vertex
    fn arcVert(
        @builtin(vertex_index) vIndex: u32,
        @builtin(instance_index) iIndex: u32,
    ) -> ArcOutput {
		let startIndex = indexsR[iIndex + uniforms.arcOffset];
        var output: ArcOutput;
		let head = u32(pts[startIndex]);
		output.center = vec2(pts[startIndex + 1], pts[startIndex + 2]);
		let r = pts[startIndex + 3];
		let width = max(pts[startIndex + 4], uniforms.pxLength);
		output.startAngle = pts[startIndex + 5];
		let angle = pts[startIndex + 6];
		var index = startIndex + 7;
		var order: f32;
		if((head & ${Rt}) != 0){
			order = pts[index];
			index++;
		}
		if((head & ${Nt}) != 0){
			output.colorIndex = pts[index];
		}
		output.endAngle = output.startAngle + angle;
		output.R = r + width / 2;
		output.r = r - width / 2;

        output.position = output.center;
        var radius = output.R;
        if(angle < ${Math.PI}){
            let startPointR = output.center + vec2(cos(output.startAngle), sin(output.startAngle)) * output.r;
            let endPointR = output.center + vec2(cos(output.endAngle), sin(output.endAngle)) * output.r;
            output.position = (startPointR + endPointR) / 2.0;
            radius = length(startPointR - endPointR) / 2.0 + width;
        }

        if(vIndex == 0){
            output.position.x += radius * (-sqrt(3.0));
            output.position.y += radius * (-1.0);
        }else if(vIndex == 1){
            output.position.x += radius * (sqrt(3.0));
            output.position.y += radius * (-1.0);
        }else{
            output.position.y += radius * (2.0);
        }
		${Da()}
        return output;
    }

    @fragment
    fn arcFrag(
        @builtin(position) Position : vec4<f32>,
        @location(0) R: f32,
        @location(1) r: f32,
        @location(2) center: vec2<f32>,
        @location(3) startAngle: f32,
        @location(4) endAngle: f32,
        @location(5) position: vec2<f32>,
		@location(6) normal: vec3<f32>,
		@location(7) surfaceToEye: vec3<f32>,
		@location(8) colorIndex: f32,
    ) -> @location(0) vec4<f32> {
		if(uniforms.isNormal != 0 && Position.z <= camera.borderZ){
			discard;
		}
        let d = length(position - center);
        if(d > R || d < r){
            discard;
        }

        let direct = position - center;
        let startDir = vec2(cos(startAngle), sin(startAngle));
        let startZ = startDir.x * direct.y - startDir.y * direct.x;
        let endDir = vec2(cos(endAngle), sin(endAngle));
        let endZ = endDir.x * direct.y - endDir.y * direct.x;

        let angle = endAngle - startAngle;
        if((angle < ${Math.PI} && (startZ < 0.0 || endZ > 0.0)) || (angle >= ${Math.PI} && (startZ < 0.0 && endZ > 0.0))){
            let pointRadius = (R - r) / 2.0;
            let radius = (R + r) / 2.0;
            let startCenter = center + startDir * radius;
            let startDis = length(position - startCenter);
            let endCenter = center + endDir * radius;
            let endDis = length(position - endCenter);
            if(startDis > pointRadius && endDis > pointRadius){
                discard;
            }
			if(uniforms.renderMode == 2 && (startDis < pointRadius - uniforms.pxLength || endDis < pointRadius - uniforms.pxLength)){
                discard;
            } 
        } else if(uniforms.renderMode == 2 && d < R - uniforms.pxLength && d > r + uniforms.pxLength){
            discard;
        }
		${Ga}
    }

	struct TriangleOutput {
        @builtin(position) Position: vec4<f32>,
		@location(1) normal: vec3<f32>,
		@location(2) surfaceToEye: vec3<f32>,
		@location(3) colorIndex: f32,
		@location(4) p1: vec2<f32>,
		@location(5) p2: vec2<f32>,
		@location(6) p3: vec2<f32>,
		@location(7) position: vec2<f32>,
    }

    @vertex
    fn triangleVert(
        @builtin(vertex_index) vIndex: u32,
        @builtin(instance_index) iIndex: u32,
    ) -> TriangleOutput {
		let startIndex = indexsR[iIndex + uniforms.triangleOffset];
		let head = u32(pts[startIndex]);
		var output: TriangleOutput;
		var p1: vec2<f32> = vec2(pts[startIndex + 1], pts[startIndex + 2]);
		var p2: vec2<f32> = vec2(pts[startIndex + 3], pts[startIndex + 4]);
		var p3: vec2<f32> = vec2(pts[startIndex + 5], pts[startIndex + 6]);
		var position: vec2<f32>;
        if(vIndex == 0){
			position = p1;
        }else if(vIndex == 1){
			position = p2;
        }else{
			position = p3;
        }
		var index = startIndex + 7;
		var order: f32;
		if((head & ${Rt}) != 0){
			order = pts[index];
			index++;
		}
		if((head & ${Nt}) != 0){
			output.colorIndex = pts[index];
		}

		output.p1 = p1;
		output.p2 = p2;
		output.p3 = p3;
		output.position = position;
		${Da("position")}
		return output;
    }

	@fragment
    fn triangleFrag(
        @builtin(position) Position : vec4<f32>,
		@location(1) normal: vec3<f32>,
		@location(2) surfaceToEye: vec3<f32>,
		@location(3) colorIndex: f32,
		@location(4) p1: vec2<f32>,
		@location(5) p2: vec2<f32>,
		@location(6) p3: vec2<f32>,
		@location(7) position: vec2<f32>,
    ) -> @location(0) vec4<f32> {
		if(uniforms.isNormal != 0 && Position.z <= camera.borderZ){
            discard;
        }

		// [todo]
		// if(uniforms.renderMode == 2){
		// 	// \u6269\u5C55\u5BBD\u5EA6
		// 	let ext = -uniforms.pxLength;

		// 	// \u4E09\u89D2\u5F62\u5185\u5FC3
		// 	let l_1 = length(p2 - p3);
		// 	let l_2 = length(p1 - p3);
		// 	let l_3 = length(p1 - p2);
		// 	let d = l_1 + l_2 + l_3;
		// 	let x = l_1 * p1.x + l_2 * p2.x + l_3 * p3.x;
		// 	let y = l_1 * p1.y + l_2 * p2.y + l_3 * p3.y;
		// 	let center = vec2(x / d, y / d);

		// 	// \u7F29\u653E\u6BD4\u4F8B
		// 	let center_p1_p2 = (p1 + p2 - center) / 2;
		// 	let len_old = length(center_p1_p2);
		// 	let new_center_p1_p2 = normalize(center_p1_p2) * (len_old + ext);
		// 	let radio = length(new_center_p1_p2) / len_old;
			
		// 	// \u65B0\u5750\u6807
		// 	let v1 = p1 - center;
		// 	let v2 = p2 - center;
		// 	let v3 = p3 - center;
		// 	let new_p1 = v1 * radio + center;
		// 	let new_p2 = v2 * radio + center;
		// 	let new_p3 = v3 * radio + center;

		// 	// \u5224\u65AD\u70B9\u662F\u5426\u5728\u4E09\u89D2\u5F62\u5185
		// 	let n0 = new_p3 - new_p1;
		// 	let n1 = new_p2 - new_p1;
		// 	let n2 = position - new_p1;
		// 	let dot00 = dot(n0, n0);
		// 	let dot01 = dot(n0, n1);
		// 	let dot02 = dot(n0, n2);
		// 	let dot11 = dot(n1, n1);
		// 	let dot12 = dot(n1, n2);

		// 	let inverDeno = 1 / (dot00 * dot11 - dot01 * dot01) ;
		// 	let u = (dot11 * dot02 - dot01 * dot12) * inverDeno ;
		// 	if(u < 0 || u > 1) {
		// 		// if u out of range
		// 		// pass
		// 	} else {
		// 		let v = (dot00 * dot12 - dot01 * dot02) * inverDeno ;
		// 		if(v < 0 || v > 1) {
		// 			// pass
		// 		} else if(u + v < 1.0) {
		// 			discard;
		// 		}
		// 	}
			
		// }
		${Ga}
    }

    struct RectOutput {
        @builtin(position) Position: vec4<f32>,
        @location(0) position: vec2<f32>,
        @location(1) start: vec2<f32>,
        @location(2) end: vec2<f32>,
        @location(3) halfWidth: f32,
        @location(4) radius: f32,
		@location(5) normal: vec3<f32>,
		@location(6) surfaceToEye: vec3<f32>,
		@location(7) colorIndex: f32,
    }

    @vertex
    fn rectVert(
        @builtin(vertex_index) vIndex: u32,
        @builtin(instance_index) iIndex: u32,
    ) -> RectOutput {
		let startIndex = indexsR[iIndex + uniforms.rectOffset];
        var output: RectOutput;
		let head = u32(pts[startIndex]);
		let luPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]);
		let width = pts[startIndex + 3];
		let height = pts[startIndex + 4];
		let angle = radians(pts[startIndex + 5]);
		output.radius = pts[startIndex + 7];
		var index = startIndex + 8;
		var order: f32;
		if((head & ${Rt}) != 0){
			order = pts[index];
			index++;
		}
		if((head & ${Nt}) != 0){
			output.colorIndex = pts[index];
		}

		output.halfWidth = max(height, uniforms.pxLength) / 2;

		let cos0 = cos(angle);
		let sin0 = sin(angle);
		let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0);
		output.start = luPoint + mat0 * vec2(0, -output.halfWidth);
		output.end = luPoint + mat0 * vec2(width, -output.halfWidth);

		let direct = normalize(output.end - output.start);
        let vertical = vec2(-direct.y, direct.x);
        let h_offset = vec2(vertical * output.halfWidth); // \u7528\u4E8E\u8BA1\u7B97\u5782\u76F4\u65B9\u5411\u843D\u70B9
        if(vIndex == 0 || vIndex == 5){
            output.position = output.start - h_offset;
        }else if(vIndex == 1){
            output.position = output.end - h_offset;
        }else if(vIndex == 2 || vIndex == 3){
            output.position = output.end + h_offset;
        }else if(vIndex == 4){
            output.position = output.start + h_offset;
        }
		${Da()}
        return output;
    }

    @fragment
    fn rectFrag(
        @builtin(position) Position : vec4<f32>,
        @location(0) position: vec2<f32>,
        @location(1) start: vec2<f32>,
        @location(2) end: vec2<f32>,
        @location(3) halfWidth: f32,
        @location(4) radius: f32,
		@location(5) normal: vec3<f32>,
		@location(6) surfaceToEye: vec3<f32>,
		@location(7) colorIndex: f32,
    ) -> @location(0) vec4<f32> {
		if(uniforms.isNormal != 0 && Position.z <= camera.borderZ){
			discard;
		}
        var direct = end - start;
        let len = length(direct);
        if(len == 0){
            direct = vec2(1, 0);
        }else{
            direct = normalize(direct);
        }
		
		// [todo]
		// if(uniforms.renderMode == 2){
		// 	// discard;
		// }

		let center = (start + end) * 0.5;
		let crood = start - center;
		let x = abs(dot(direct,crood));
		let y = abs(crood.x * direct.y - crood.y * direct.x);
		let xEdge = len * 0.5 - radius;
		let yEdge = halfWidth - radius;
		if(x > xEdge && y > yEdge){
			let deltaX = x - xEdge;
			let deltaY = y - yEdge;
			let dis = length(vec2(deltaX,deltaY));
			if(dis > radius){
				discard;
			}
		}
		${Ga}
    }

    struct CutedCircleOutput {
        @builtin(position) Position: vec4<f32>,
        @location(0) r: f32,
        @location(1) center: vec2<f32>,
        @location(2) startAngle: f32,
        @location(3) endAngle: f32,
        @location(4) position: vec2<f32>,
		@location(5) normal: vec3<f32>,
		@location(6) surfaceToEye: vec3<f32>,
		@location(7) colorIndex: f32,
    }

    @vertex
    fn cutedCircleVert(
        @builtin(vertex_index) vIndex: u32,
        @builtin(instance_index) iIndex: u32,
    ) -> CutedCircleOutput {
		let startIndex = indexsR[iIndex + uniforms.cutedCircleOffset];
        var output: CutedCircleOutput;
		let head = u32(pts[startIndex]);
		output.center = vec2(pts[startIndex + 1], pts[startIndex + 2]);
		output.r = pts[startIndex + 3];
		output.startAngle = pts[startIndex + 4];
		let angle = pts[startIndex + 5];
		var index = startIndex + 6;
		var order: f32;
		if((head & ${Rt}) != 0){
			order = pts[index];
			index++;
		}
		if((head & ${Nt}) != 0){
			output.colorIndex = pts[index];
		}
		output.endAngle = output.startAngle + angle;

        output.position = output.center;
        var radius = output.r;
        if(abs(angle) < ${Math.PI}){
            let startPointR = output.center + vec2(cos(output.startAngle), sin(output.startAngle)) * output.r;
            let endPointR = output.center + vec2(cos(output.endAngle), sin(output.endAngle)) * output.r;
            output.position = (startPointR + endPointR) / 2.0;
            radius = length(startPointR - endPointR) / 2.0;
        }

		if(angle > 0){
			if(vIndex == 0){
				output.position.x += radius * (-sqrt(3.0));
				output.position.y += radius * (-1.0);
			}else if(vIndex == 1){
				output.position.x += radius * (sqrt(3.0));
				output.position.y += radius * (-1.0);
			}else{
				output.position.y += radius * (2.0);
			}
		} else {
			if(vIndex == 0){
				output.position.x += radius * (sqrt(3.0));
				output.position.y += radius * (-1.0);
			}else if(vIndex == 1){
				output.position.x += radius * (-sqrt(3.0));
				output.position.y += radius * (-1.0);
			}else{
				output.position.y += radius * (2.0);
			}
		}
		${Da()}
        return output;
    }

    @fragment
    fn cutedCircleFrag(
        @builtin(position) Position : vec4<f32>,
        @location(0) r: f32,
        @location(1) center: vec2<f32>,
        @location(2) startAngle: f32,
        @location(3) endAngle: f32,
        @location(4) position: vec2<f32>,
		@location(5) normal: vec3<f32>,
		@location(6) surfaceToEye: vec3<f32>,
		@location(7) colorIndex: f32,
    ) -> @location(0) vec4<f32> {
		if((uniforms.isNormal != 0 && Position.z <= camera.borderZ) || length(position - center) > r){
            discard;
        }

		let start = center + vec2(cos(startAngle), sin(startAngle)) * r;
		let end = center + vec2(cos(endAngle), sin(endAngle)) * r;
		let a = end.y - start.y;
		let b = start.x - end.x;
		let c = -a * start.x - b * start.y;

		let midAngle = (startAngle + endAngle) / 2;
		let mid = center + vec2(cos(midAngle), sin(midAngle)) * r;
		if(abs(endAngle - startAngle) < ${Math.PI*2-1e-4} && (a * mid.x + b * mid.y + c) * (a * position.x + b * position.y + c) < 0){
			discard;
		}
		${Ga}
    }
`,lf=class{constructor(e){this.afterDraw={render:(e,t,n,i,s)=>{if(e.isColorful){{this.gpu.copyBufferToBuffer(n,i+3,this.indirectBuffer,1,1,this.scene.commandEncoder);let o=this.scene.commandEncoder.beginRenderPass(this.desc);o.setStencilReference(64),o.setPipeline(this.trianglePipeline),o.setBindGroup(0,t),o.drawIndirect(this.indirectBuffer.getBuffer(),0),o.end();}{this.gpu.copyBufferToBuffer(n,i+5,this.indirectBuffer,1,1,this.scene.commandEncoder);let o=this.scene.commandEncoder.beginRenderPass(this.desc);o.setStencilReference(64),o.setPipeline(this.cutedCirclePipeline),o.setBindGroup(0,t),o.drawIndirect(this.indirectBuffer.getBuffer(),0),o.end();}}else{let o=s.getBBox2();this.scene.addData(new Uint32Array(1),this.uniformsBuf,39),this.scene.addData(new Uint32Array(new Float32Array(br.create(0,o.LL(),o.UL(),o.LR()).concat(br.create(0,o.UR(),o.UL(),o.LR()))).buffer),this.bboxPtsBuf);let a=this.scene.commandEncoder.beginRenderPass(this.desc);a.setStencilReference(64),a.setPipeline(this.trianglePipeline),a.setBindGroup(0,this.bboxBindGroup.getBindGroup()),a.draw(3,2),a.end();}},drawPassStencil:()=>this.scene.drawStencilProgram.draw(!1,64,63),drawNotPassStencil:()=>this.scene.drawStencilProgram.draw(!1,128,63)};this.scene=e;let t=e.gpu;this.gpu=t;let n=t.device;this.uniformsBuf=t.createDynamicBuffer(pw,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM),this.indirectBuffer=t.createDynamicBuffer(8,GPUBufferUsage.COPY_DST|GPUBufferUsage.INDIRECT|GPUBufferUsage.STORAGE),this.indirectBuffer.write(0,new Uint32Array([3,0,0,0,6,0,0,0])),this.desc={colorAttachments:[{view:e.planeProgram.colorTexture.view,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:e.planeProgram.depthStencilTexture.view,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"}},e.planeProgram.colorTexture.addListener(a=>this.desc.colorAttachments[0].view=a),e.planeProgram.depthStencilTexture.addListener(a=>this.desc.depthStencilAttachment.view=a),this.layout=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}},{binding:2,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:3,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:4,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]});let i=n.createShaderModule({code:uF}),s=n.createPipelineLayout({bindGroupLayouts:[this.layout]}),o=(a,l,u,c)=>["circle","line","arc","triangle","rect","cutedCircle"].map(h=>h==="triangle"||h==="cutedCircle"?n.createRenderPipeline({layout:s,vertex:{module:i,entryPoint:`${h}Vert`},fragment:{module:i,entryPoint:`${h}Frag`,targets:[{format:e.planeProgram.colorTexture.format,writeMask:0}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.planeProgram.depthStencilTexture.format,depthWriteEnabled:!1,stencilReadMask:c,stencilFront:{compare:"not-equal",passOp:"increment-wrap"},stencilBack:{compare:"not-equal",passOp:"decrement-wrap"}}}):n.createRenderPipeline({layout:s,vertex:{module:i,entryPoint:`${h}Vert`},fragment:{module:i,entryPoint:`${h}Frag`,targets:[{format:e.planeProgram.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}},writeMask:a?15:0}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.planeProgram.depthStencilTexture.format,depthWriteEnabled:a,depthCompare:"less",stencilReadMask:l,stencilFront:u,stencilBack:u}}));this.renderPipelines=o(!0,255,{compare:"equal"},127),this.drawNotPassStencilPipelines=o(!1,127,{compare:"not-equal",passOp:"replace"},127),this.drawPassStencilPipelines=o(!1,255,{compare:"always",passOp:"replace"},255),this.drawInterStencilPipelines=o(!1,255,{compare:"equal",passOp:"increment-wrap"},127),this.bboxPtsBuf=t.createDynamicBuffer(br.length*2,GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE),this.bboxBindGroup=this.createDynamicBindGroup(this.bboxPtsBuf,t.createStaticBuffer(new Uint32Array([0,br.length]),GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE)),this.trianglePipeline=n.createRenderPipeline({layout:s,vertex:{module:i,entryPoint:"triangleVert"},fragment:{module:i,entryPoint:"triangleFrag",targets:[{format:e.planeProgram.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.planeProgram.depthStencilTexture.format,depthWriteEnabled:!0,stencilReadMask:63,stencilFront:{compare:"not-equal",passOp:"replace"},stencilBack:{compare:"not-equal",passOp:"replace"}}}),this.cutedCirclePipeline=n.createRenderPipeline({layout:s,vertex:{module:i,entryPoint:"cutedCircleVert"},fragment:{module:i,entryPoint:"cutedCircleFrag",targets:[{format:e.planeProgram.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.planeProgram.depthStencilTexture.format,depthWriteEnabled:!0,stencilReadMask:63,stencilFront:{compare:"not-equal",passOp:"replace"},stencilBack:{compare:"not-equal",passOp:"replace"}}});}createBindGroup(e,t){return this.gpu.createBindGroup(this.layout,0,this.scene.cameraBuf,1,this.uniformsBuf,2,t,3,e,4,this.scene.colorsBuf);}createDynamicBindGroup(e,t){return this.gpu.createDynamicBindGroup(this.layout,0,this.scene.cameraBuf,1,this.uniformsBuf,2,t,3,e,4,this.scene.colorsBuf);}draw0(e,t,n,i,s,o){let a=t===1||t===4?4:0;this.gpu.copyBufferToBuffer(n,i+t,this.indirectBuffer,a+1,1,this.scene.commandEncoder);let l=this.scene.commandEncoder.beginRenderPass(this.desc);l.setPipeline(s[t]),l.setBindGroup(0,e),l.setStencilReference(o),l.drawIndirect(this.indirectBuffer.getBuffer(),a*ht),l.end();}render(e,t,n,i){t===3||t===5?this.draw0(e,t,n,i,this.renderPipelines,0):this.draw0(e,t,n,i,this.renderPipelines,64);}drawPassStencil(e,t,n,i){this.draw0(e,t,n,i,this.drawPassStencilPipelines,64);}drawNotPassStencil(e,t,n,i){t===3||t===5?this.draw0(e,t,n,i,this.drawNotPassStencilPipelines,0):this.draw0(e,t,n,i,this.drawNotPassStencilPipelines,128);}drawInterStencil(e,t,n,i){this.draw0(e,t,n,i,this.drawInterStencilPipelines,t===3||t===5?0:64);}draw(e,t,n,i,s,o,a,l,u,c,h="render"){let d=new Uint32Array(pw),f=new Float32Array(d.buffer);f.set(e.data),n.getColor()&&f.set(n.getColor().getData(),16),n.getMaterial()&&(f.set(n.getMaterial().ambient.getData(),20),f.set(n.getMaterial().diffuse.getData(),24),f.set(n.getMaterial().specular.getData(),28),f[31]=n.getMaterial().shininess,f[32]=n.getMaterial().alpha),f[33]=c.getPxLength(t,e),d[34]=i===1?1:i===4?2:0,d[35]=c.isNormal()?1:0,d.set(s.slice(u,u+6),36),this.scene.addData(d,this.uniformsBuf),h==="drawInterStencil"?(o.forEach((p,m)=>{p&&(m===3||m===5)&&this[h](a,m,l,u);}),o.forEach((p,m)=>{p&&(m===3||m===5||this[h](a,m,l,u));})):(o.forEach((p,m)=>{p&&(m===3||m===5||this[h](a,m,l,u));}),o.forEach((p,m)=>{p&&(m===3||m===5)&&this[h](a,m,l,u);}),this.afterDraw[h](n,a,l,u,c));}};var mw=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n);}return r;};}("struct Uniforms { coordXOffset: u32, texWidth: u32, offsetX: u32, offsetY: u32, width: u32, height: u32, } @binding(0) @group(0) var<uniform> uniforms: Uniforms; @binding(1) @group(0) var depthTexture: texture_depth_2d; @binding(2) @group(0) var<storage, read_write> buf_out: array<u32>; @compute @workgroup_size($MAX_COMPUTE_WORKGROUP_SIZE_X) fn extract( @builtin(global_invocation_id) coord: vec3<u32>, ) { let coordX = coord.x + uniforms.coordXOffset; let y = coordX * 32 / uniforms.width; if(y >= uniforms.height) { return; } var x = coordX * 32 - y * uniforms.width; var num: u32 = 0; for(var i: u32 = 0; i < 32; i++){ if(textureLoad(depthTexture, vec2<i32>(i32(x + i), i32(y)), 0) != 0){ num |= (0x80000000u >> i); } } buf_out[((y + uniforms.offsetY) * uniforms.texWidth + x + uniforms.offsetX) / 32] = num; }");var gw=6,uf=class{constructor(e){this.scene=e;let t=e.gpu;this.gpu=t;let n=t.device;this.uniformsBuf=t.createDynamicBuffer(gw,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);let i=n.createShaderModule({code:mw({MAX_COMPUTE_WORKGROUP_SIZE_X:t.limits.maxComputeWorkgroupSizeX})});this.pipeline=t.createComputePipeline(i,"extract"),this.layout=this.pipeline.getBindGroupLayout(0);}extract(e,t,n,i,s,o,a){let l=new Uint32Array(gw);l[1]=n,l[2]=i,l[3]=s,l[4]=o,l[5]=a,this.scene.addData(l,this.uniformsBuf),this.gpu.runComputePass(this.scene.commandEncoder,this.pipeline,this.gpu.createBindGroup(this.layout,0,this.uniformsBuf,1,e,2,t),o*a/32,u=>this.scene.gpu.copyBufferToBuffer(this.scene.gpu.coordXOffsetBuf,u,this.uniformsBuf,0,1,this.scene.commandEncoder));}};var xw=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n);}return r;};}("struct Uniforms { matrix: mat4x4<f32>, color: vec4<f32>, ambientFactor: vec3<f32>, diffuseFactor: vec3<f32>, specularFactor: vec3<f32>, shininess: f32, alpha: f32, renderMode: u32, pxLength: f32, } struct Tex { originX: f32, originY: f32, width: u32, height: u32, pxLength: f32, } $CAMERA_STRUCT_WGSL @binding(0) @group(0) var<uniform> uniforms: Uniforms; @binding(1) @group(0) var<uniform> tex: Tex; @binding(2) @group(0) var<uniform> camera: Camera; @binding(3) @group(0) var<storage, read> bufR: array<u32>; struct Output { @builtin(position) Position: vec4<f32>, @location(1) normal: vec3<f32>, @location(2) surfaceToEye: vec3<f32>, } @vertex fn vert( @builtin(vertex_index) vIndex: u32, ) -> Output { let width = max(f32(tex.width) * tex.pxLength, uniforms.pxLength); let height = max(f32(tex.height) * tex.pxLength, uniforms.pxLength); var pos: vec4<f32>; if(vIndex == 0 || vIndex == 5){ pos = vec4(tex.originX, tex.originY - height, 0, 1); } else if(vIndex == 1){ pos = vec4(tex.originX, tex.originY, 0, 1); } else if(vIndex == 2 || vIndex == 3){ pos = vec4(tex.originX + width, tex.originY, 0, 1); } else { pos = vec4(tex.originX + width, tex.originY - height, 0, 1); } var output: Output; output.Position = camera.mvpMatrix * uniforms.matrix * pos; if(uniforms.renderMode == 1){ let matrix = camera.mvMatrix * uniforms.matrix; output.normal = mat3x3(vec3(matrix[0].xyz), vec3(matrix[1].xyz), vec3(matrix[2].xyz)) * vec3<f32>(0, 0, 1); pos = uniforms.matrix * pos; output.surfaceToEye = vec3(0, 0, length(camera.pos)) - pos.xyz / pos.w; } return output; } fn calColor(normal: vec3<f32>, surfaceToEye: vec3<f32>) -> vec4<f32> { if(uniforms.renderMode == 0 || uniforms.renderMode == 2){ return uniforms.color; }else{ const ambientLightColor = vec3(0.1, 0.1, 0.1); const directLightColor = vec3<f32>(1, 1, 1); const directLightDir0 = vec3<f32>(0, 0, 1); var ambient = uniforms.ambientFactor * ambientLightColor; var normal0 = normalize(normal); var directLightDir = normalize(directLightDir0); var diffuse = abs(dot(normal0 , directLightDir)) * uniforms.diffuseFactor * directLightColor; var reflect = -2.0 * normal0 * dot(directLightDir, normal0) + directLightDir; var surfaceToEye0 = normalize(surfaceToEye); var lightToEyeFactor = abs(dot(reflect, surfaceToEye0)); var specular = uniforms.specularFactor * directLightColor * pow(lightToEyeFactor, 300.0) * uniforms.shininess * 0.1; return vec4(ambient + diffuse + specular, uniforms.alpha); } } @fragment fn frag( @builtin(position) Position : vec4<f32>, @location(1) normal: vec3<f32>, @location(2) surfaceToEye: vec3<f32>, ) -> @location(0) vec4<f32> { if(Position.z > camera.borderZ){ discard; } let x = floor(Position.x); let y = floor(Position.y); var p0: vec2<f32>; var p1: vec2<f32>; var p2: vec2<f32>; var p3: vec2<f32>; let z = (uniforms.matrix * vec4<f32>(0, 0, 0, 1)).z; if(camera.isOrth == 0){ var vec = (camera.invMatrix * vec4<f32>(x, y, 0, 1)).xyz - camera.pos; p0 = camera.pos.xy + vec.xy * (z - camera.pos.z) / vec.z; vec = (camera.invMatrix * vec4<f32>(x, y + 1, 0, 1)).xyz - camera.pos; p1 = camera.pos.xy + vec.xy * (z - camera.pos.z) / vec.z; vec = (camera.invMatrix * vec4<f32>(x + 1, y, 0, 1)).xyz - camera.pos; p2 = camera.pos.xy + vec.xy * (z - camera.pos.z) / vec.z; vec = (camera.invMatrix * vec4<f32>(x + 1, y + 1, 0, 1)).xyz - camera.pos; p3 = camera.pos.xy + vec.xy * (z - camera.pos.z) / vec.z; }else { var startPos = (camera.invMatrix * vec4<f32>(x, y, 0, 1)).xyz; p0 = startPos.xy + camera.vec.xy * (z - startPos.z) / camera.vec.z; startPos = (camera.invMatrix * vec4<f32>(x, y + 1, 0, 1)).xyz; p1 = startPos.xy + camera.vec.xy * (z - startPos.z) / camera.vec.z; startPos = (camera.invMatrix * vec4<f32>(x + 1, y, 0, 1)).xyz; p2 = startPos.xy + camera.vec.xy * (z - startPos.z) / camera.vec.z; startPos = (camera.invMatrix * vec4<f32>(x + 1, y + 1, 0, 1)).xyz; p3 = startPos.xy + camera.vec.xy * (z - startPos.z) / camera.vec.z; } p0 = vec2(p0.x - tex.originX, tex.originY - p0.y) / tex.pxLength; p1 = vec2(p1.x - tex.originX, tex.originY - p1.y) / tex.pxLength; p2 = vec2(p2.x - tex.originX, tex.originY - p2.y) / tex.pxLength; p3 = vec2(p3.x - tex.originX, tex.originY - p3.y) / tex.pxLength; let minX = max(round(min(min(p0.x, p1.x), min(p2.x, p3.x))), 0); let maxX = min(round(max(max(p0.x, p1.x), max(p2.x, p3.x))), f32(tex.width) - 1); let minY = max(round(min(min(p0.y, p1.y), min(p2.y, p3.y))), 0); let maxY = min(round(max(max(p0.y, p1.y), max(p2.y, p3.y))), f32(tex.height) - 1); if(maxX < 0 || minX >= f32(tex.width) || minX > maxX || maxY < 0 || minY >= f32(tex.height) || minY > maxY){ discard; } var minXU = u32(minX); var maxXU = u32(maxX); let minYU = u32(minY); let maxYU = u32(maxY); if((minXU & 0x1f) != 0){ let mask = select( 0xffffffffu >> (minXU & 0x1f), (0xffffffffu >> (minXU & 0x1f)) & (0xffffffffu << (31 - (maxXU & 0x1f))), (minXU >> 5) == (maxXU >> 5) ); for(var y = minYU; y <= maxYU; y++){ if((bufR[(y * tex.width + minXU) >> 5] & mask) != 0){ return calColor(normal, surfaceToEye); } } minXU = ((minXU >> 5) + 1) << 5; } let endXU = (maxXU + 1) & 0xffffffe0u; for(; minXU < endXU; minXU += 32){ for(var y = minYU; y <= maxYU; y++){ if(bufR[(y * tex.width + minXU) >> 5] != 0){ return calColor(normal, surfaceToEye); } } } if(minXU <= maxXU){ let mask = 0xffffffffu << (31 - (maxXU & 0x1f)); for(var y = minYU; y <= maxYU; y++){ if((bufR[(y * tex.width + minXU) >> 5] & mask) != 0){ return calColor(normal, surfaceToEye); } } } discard; }");var bw=35,yw=5,cf=class{constructor(e){this.scene=e;let t=e.gpu;this.gpu=t;let n=t.device;this.uniformsBuf=t.createDynamicBuffer(bw,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM),this.texBuf=t.createDynamicBuffer(yw,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM),this.layout=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}},{binding:2,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}},{binding:3,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]});let i=n.createPipelineLayout({bindGroupLayouts:[this.layout]}),s=n.createShaderModule({code:xw({CAMERA_STRUCT_WGSL:en})}),o=(a,l,u)=>n.createRenderPipeline({layout:i,vertex:{module:s,entryPoint:"vert"},fragment:{module:s,entryPoint:"frag",targets:[{format:e.planeProgram.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}},writeMask:a?15:0}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.planeProgram.depthStencilTexture.format,depthWriteEnabled:a,stencilReadMask:l,stencilFront:u,stencilBack:u}});this.renderPipeline=o(!0,255,{compare:"equal"}),this.drawNotPassStencilPipeline=o(!1,127,{compare:"not-equal",passOp:"replace"}),this.drawPassStencilPipeline=o(!1,255,{compare:"always",passOp:"replace"}),this.drawInterStencilPipeline=o(!1,255,{compare:"equal",passOp:"increment-wrap"}),this.desc={colorAttachments:[{view:e.planeProgram.colorTexture.view,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:e.planeProgram.depthStencilTexture.view,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"}},e.planeProgram.colorTexture.addListener(a=>this.desc.colorAttachments[0].view=a),e.planeProgram.depthStencilTexture.addListener(a=>this.desc.depthStencilAttachment.view=a);}createDynamicBindGroup(e){return this.gpu.createDynamicBindGroup(this.layout,0,this.uniformsBuf,1,this.texBuf,2,this.scene.cameraBuf,3,e);}draw0(e,t,n){let i=this.scene.commandEncoder.beginRenderPass(this.desc);i.setPipeline(t),i.setBindGroup(0,e),i.setStencilReference(n),i.draw(6,1,0,0),i.end();}render(e){this.draw0(e,this.renderPipeline,64);}drawPassStencil(e){this.draw0(e,this.drawPassStencilPipeline,64);}drawNotPassStencil(e){this.draw0(e,this.drawNotPassStencilPipeline,128);}drawInterStencil(e){this.draw0(e,this.drawInterStencilPipeline,64);}draw(e,t,n,i,s,o,a,l,u,c,h,d){if(o%32!==0)throw new Error("texWidth % 32 !== 0");if(t.isOrthCamera()){if(t.getScale()>c)return;}else{let f=i.getBBox2(),p=e.multiply4(t.getRenderMatrix()),m=new pe(f.minX,f.minY,0).multiply4(p).z,g=new pe(f.minX,f.maxY,0).multiply4(p).z,b=new pe(f.maxX,f.minY,0).multiply4(p).z,y=new pe(f.maxX,f.maxY,0).multiply4(p).z,v=t.getBorderZ(c);if((m>v||m<=0)&&(g>v||g<=0)&&(b>v||b<=0)&&(y>v||y<=0))return;}{let f=new Uint32Array(bw),p=new Float32Array(f.buffer);p.set(e.data),n.getColor()&&p.set(n.getColor().getData(),16),n.getMaterial()&&(p.set(n.getMaterial().ambient.getData(),20),p.set(n.getMaterial().diffuse.getData(),24),p.set(n.getMaterial().specular.getData(),28),p[31]=n.getMaterial().shininess,p[32]=n.getMaterial().alpha),f[33]=s===1?1:s===4?2:0,p[34]=t.getPxLength(),this.scene.addData(f,this.uniformsBuf);}{let f=new Uint32Array(yw),p=new Float32Array(f.buffer);p[0]=u.minX,p[1]=u.maxY,f[2]=o,f[3]=a,p[4]=l,this.scene.addData(f,this.texBuf);}this[d](h);}};var ww=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n);}return r;};}("struct BBox { minX: f32, maxX: f32, minY: f32, maxY: f32, } struct Uniforms { coordXOffset: u32, ptNum: u32, planeStep: u32, isNormal: u32, } struct Plane { color: vec4<f32>, z: f32, visible: f32, order: f32, } $CAMERA_STRUCT_WGSL @binding(0) @group(0) var<uniform> uniforms: Uniforms; @binding(1) @group(0) var<storage, read> pts: array<f32>; @binding(2) @group(0) var<storage, read_write> indexs: array<i32>; @binding(3) @group(0) var<storage, read_write> nextIndexsA: array<atomic<u32>>; @binding(3) @group(0) var<storage, read> nextIndexs: array<u32>; @binding(4) @group(0) var<storage, read> inIndexs: array<i32>; @binding(5) @group(0) var<storage, read> filterPtIndexs: array<u32>; @binding(6) @group(0) var<storage, read> matrixs: array<mat4x4<f32>>; @binding(9) @group(0) var<uniform> camera: Camera; @binding(7) @group(0) var<storage, read_write> workgroupCount: vec3<u32>; fn selectU(a: u32, b: u32, condition: bool) -> u32 { return select(a, b, condition); } @compute @workgroup_size(1) fn calWorkgroupCountX() { let x = uniforms.ptNum / $MAX_COMPUTE_WORKGROUP_SIZE_X + selectU(1, 0, uniforms.ptNum % $MAX_COMPUTE_WORKGROUP_SIZE_X == 0); workgroupCount.x = select(0, min(x - uniforms.coordXOffset / $MAX_COMPUTE_WORKGROUP_SIZE_X, $MAX_COMPUTE_WORKGROUP_PER_DIMENSION), x > uniforms.coordXOffset / $MAX_COMPUTE_WORKGROUP_SIZE_X); } @compute @workgroup_size($MAX_COMPUTE_WORKGROUP_SIZE_X) fn filterPt( @builtin(global_invocation_id) coord: vec3<u32>, ) { if(coord.x + uniforms.coordXOffset >= uniforms.ptNum){ return; } let startIndex = inIndexs[coord.x + uniforms.coordXOffset]; if(startIndex < 0){ return; } let head = u32(pts[startIndex]); let type0 = (head & $PT_TYPE_MASK) >> $PT_TYPE_SHIFT; let planeId = head & $PLANE_ID_MASK; let start = filterPtIndexs[planeId]; let end = filterPtIndexs[planeId + 1]; if(start >= end){ return; } var bbox: BBox; if (type0 == $PT_TYPE_CIRCLE) { bbox.minX = pts[startIndex + 1] - pts[startIndex + 3]; bbox.maxX = pts[startIndex + 1] + pts[startIndex + 3]; bbox.minY = pts[startIndex + 2] - pts[startIndex + 3]; bbox.maxY = pts[startIndex + 2] + pts[startIndex + 3]; } else if (type0 == $PT_TYPE_LINE) { bbox.minX = min(pts[startIndex + 1], pts[startIndex + 3]) - pts[startIndex + 5] / 2.0; bbox.maxX = max(pts[startIndex + 1], pts[startIndex + 3]) + pts[startIndex + 5] / 2.0; bbox.minY = min(pts[startIndex + 2], pts[startIndex + 4]) - pts[startIndex + 5] / 2.0; bbox.maxY = max(pts[startIndex + 2], pts[startIndex + 4]) + pts[startIndex + 5] / 2.0; } else if (type0 == $PT_TYPE_ARC) { let centerX = pts[startIndex + 1]; let centerY = pts[startIndex + 2]; let radius = pts[startIndex + 3]; let width2 = pts[startIndex + 4] / 2; let startAngle = pts[startIndex + 5]; let endAngle = startAngle + pts[startIndex + 6]; var x = cos(startAngle); var y = sin(startAngle); bbox.minX = x; bbox.maxX = x; bbox.minY = y; bbox.maxY = y; x = cos(endAngle); y = sin(endAngle); bbox.minX = min(bbox.minX, x); bbox.maxX = max(bbox.maxX, x); bbox.minY = min(bbox.minY, y); bbox.maxY = max(bbox.maxY, y); for (var angle = ceil(startAngle / 1.5707963267948966) * 1.5707963267948966; angle < endAngle; angle += 1.5707963267948966) { x = cos(angle); y = sin(angle); bbox.minX = min(bbox.minX, x); bbox.maxX = max(bbox.maxX, x); bbox.minY = min(bbox.minY, y); bbox.maxY = max(bbox.maxY, y); } bbox.minX = bbox.minX * radius - width2 + centerX; bbox.maxX = bbox.maxX * radius + width2 + centerX; bbox.minY = bbox.minY * radius - width2 + centerY; bbox.maxY = bbox.maxY * radius + width2 + centerY; } else if (type0 == $PT_TYPE_TRIANGLE) { bbox.minX = min(min(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]); bbox.maxX = max(max(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]); bbox.minY = min(min(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]); bbox.maxY = max(max(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]); } else if (type0 == $PT_TYPE_RECT) { let leftUpPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]); let width = pts[startIndex + 3]; let height = pts[startIndex + 4]; let angle = radians(pts[startIndex + 5]); let radius = pts[startIndex + 7]; let cos0 = cos(angle); let sin0 = sin(angle); let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0); let luPoint = leftUpPoint + mat0 * vec2(radius, -radius); let ldPoint = leftUpPoint + mat0 * vec2(radius, radius - height); let ruPoint = leftUpPoint + mat0 * vec2(width - radius, -radius); let rdPoint = leftUpPoint + mat0 * vec2(width - radius, radius - height); bbox.minX = min(min(luPoint.x, ldPoint.x), min(ruPoint.x, rdPoint.x)) - radius; bbox.maxX = max(max(luPoint.x, ldPoint.x), max(ruPoint.x, rdPoint.x)) + radius; bbox.minY = min(min(luPoint.y, ldPoint.y), min(ruPoint.y, rdPoint.y)) - radius; bbox.maxY = max(max(luPoint.y, ldPoint.y), max(ruPoint.y, rdPoint.y)) + radius; } else if (type0 == $PT_TYPE_CUTED_CIRCLE) { let centerX = pts[startIndex + 1]; let centerY = pts[startIndex + 2]; let radius = pts[startIndex + 3]; let startAngle = pts[startIndex + 4]; let endAngle = startAngle + pts[startIndex + 5]; var x = cos(startAngle); var y = sin(startAngle); bbox.minX = x; bbox.maxX = x; bbox.minY = y; bbox.maxY = y; x = cos(endAngle); y = sin(endAngle); bbox.minX = min(bbox.minX, x); bbox.maxX = max(bbox.maxX, x); bbox.minY = min(bbox.minY, y); bbox.maxY = max(bbox.maxY, y); if(startAngle < endAngle) { for (var angle = ceil(startAngle / 1.5707963267948966) * 1.5707963267948966; angle < endAngle; angle += 1.5707963267948966) { x = cos(angle); y = sin(angle); bbox.minX = min(bbox.minX, x); bbox.maxX = max(bbox.maxX, x); bbox.minY = min(bbox.minY, y); bbox.maxY = max(bbox.maxY, y); } } else { for (var angle = floor(startAngle / 1.5707963267948966) * 1.5707963267948966; angle > endAngle; angle -= 1.5707963267948966) { x = cos(angle); y = sin(angle); bbox.minX = min(bbox.minX, x); bbox.maxX = max(bbox.maxX, x); bbox.minY = min(bbox.minY, y); bbox.maxY = max(bbox.maxY, y); } } bbox.minX = bbox.minX * radius + centerX; bbox.maxX = bbox.maxX * radius + centerX; bbox.minY = bbox.minY * radius + centerY; bbox.maxY = bbox.maxY * radius + centerY; } for(var i = start; i < end; i++){ let matrix = matrixs[i]; var p0 = camera.mvpMatrix * matrix * vec4(bbox.minX, bbox.minY, 0, 1); var p1 = camera.mvpMatrix * matrix * vec4(bbox.minX, bbox.maxY, 0, 1); var p2 = camera.mvpMatrix * matrix * vec4(bbox.maxX, bbox.minY, 0, 1); var p3 = camera.mvpMatrix * matrix * vec4(bbox.maxX, bbox.maxY, 0, 1); p0.x /= p0.w; p0.y /= p0.w; p0.z /= p0.w; p1.x /= p1.w; p1.y /= p1.w; p1.z /= p1.w; p2.x /= p2.w; p2.y /= p2.w; p2.z /= p2.w; p3.x /= p3.w; p3.y /= p3.w; p3.z /= p3.w; if(min(min(p0.x, p1.x), min(p2.x, p3.x)) >= 1 || max(max(p0.x, p1.x), max(p2.x, p3.x)) <= -1 || min(min(p0.y, p1.y), min(p2.y, p3.y)) >= 1 || max(max(p0.y, p1.y), max(p2.y, p3.y)) <= -1 || select( ((p0.z <= 0 || p0.z > 1) && (p1.z <= 0 || p1.z > 1) && (p2.z <= 0 || p2.z > 1) && (p3.z <= 0 || p3.z > 1)) || (uniforms.isNormal != 0 && ((p0.z <= camera.borderZ && p0.z > 0) && (p1.z <= camera.borderZ && p1.z > 0) && (p2.z <= camera.borderZ && p2.z > 0) && (p3.z <= camera.borderZ && p3.z > 0)) ), min(min(p0.z, p1.z), min(p2.z, p3.z)) >= 1 || max(max(p0.z, p1.z), max(p2.z, p3.z)) <= 0, camera.isOrth != 0 ) ) { continue; } indexs[atomicAdd(&nextIndexsA[uniforms.planeStep * i * $PT_TYPE_NUM + type0], 1)] = startIndex; } } @binding(8) @group(0) var<storage, read_write> nextIndexs1: array<u32>; @compute @workgroup_size($MAX_COMPUTE_WORKGROUP_SIZE_X) fn subNextIndexs( @builtin(global_invocation_id) coord: vec3<u32>, ) { nextIndexs1[coord.x] = nextIndexs[coord.x] - nextIndexs1[coord.x]; }");var vw=4;function cF(r){return ww({MAX_COMPUTE_WORKGROUP_SIZE_X:r.limits.maxComputeWorkgroupSizeX,MAX_COMPUTE_WORKGROUP_PER_DIMENSION:r.limits.maxComputeWorkgroupsPerDimension,PT_TYPE_CIRCLE:0,PT_TYPE_LINE:1,PT_TYPE_ARC:2,PT_TYPE_TRIANGLE:3,PT_TYPE_RECT:4,PT_TYPE_CUTED_CIRCLE:5,PT_TYPE_NUM:6,PI:Math.PI,CAMERA_STRUCT_WGSL:en,PT_TYPE_MASK:sr,PT_TYPE_SHIFT:dt,PLANE_ID_MASK:_o});}var hf=class{constructor(e){this.scene=e;let t=e.gpu;this.gpu=t;let n=t.device;this.uniformsBuf=t.createDynamicBuffer(vw,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM),this.matrixsBuf=t.createDynamicBuffer(es*16,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),this.filterPtIndexsBuf=t.createDynamicBuffer(es+1,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),this.indirectBuffer=t.createDynamicBuffer(3,GPUBufferUsage.COPY_DST|GPUBufferUsage.INDIRECT|GPUBufferUsage.STORAGE),this.indirectBuffer.write(0,new Uint32Array([0,1,1])),this.nextIndexsBuf2=new Array(2).fill("").map(s=>t.createDynamicBuffer(6*es,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC|GPUBufferUsage.INDIRECT));let i=n.createShaderModule({code:cF(t)});this.filterPtPipeline=t.createComputePipeline(i,"filterPt"),this.calWorkgroupCountXPipeline=t.createComputePipeline(i,"calWorkgroupCountX"),this.subNextIndexsPipeline=t.createComputePipeline(i,"subNextIndexs"),this.filterPtLayout=this.filterPtPipeline.getBindGroupLayout(0),this.calWorkgroupCountXBindGroup=t.createBindGroup(this.calWorkgroupCountXPipeline.getBindGroupLayout(0),0,this.uniformsBuf,7,this.indirectBuffer),this.subNextIndexsBindGroup=t.createBindGroup(this.subNextIndexsPipeline.getBindGroupLayout(0),3,this.nextIndexsBuf2[0],8,this.nextIndexsBuf2[1]);}createBindGroup(e,t,n){return this.gpu.createBindGroup(this.filterPtLayout,0,this.uniformsBuf,1,e,2,n,3,this.nextIndexsBuf2[0],4,t,5,this.filterPtIndexsBuf,6,this.matrixsBuf,9,this.scene.cameraBuf);}createDynamicBindGroup(e,t,n){return this.gpu.createDynamicBindGroup(this.filterPtLayout,0,this.uniformsBuf,1,e,2,n,3,this.nextIndexsBuf2[0],4,t,5,this.filterPtIndexsBuf,6,this.matrixsBuf,9,this.scene.cameraBuf);}filter(e,t,n,i,s,o,a,l,u){var b;let c=new Uint32Array(o.length+1),h=new Float32Array(o.reduce((y,v)=>y+v.length,0)*16),d=0;for(let y=1;y<o.length;y++)(b=o[y])==null||b.forEach(v=>h.set(v.data,d++*16)),c[y+1]=d;this.scene.addData(c,this.filterPtIndexsBuf),this.scene.addData(new Uint32Array(h.buffer),this.matrixsBuf),this.scene.addData(a,this.nextIndexsBuf2[1]);let f=new Uint32Array(vw);f[2]=t,f[3]=u?1:0;let p=this.scene.commandEncoder;e instanceof Ls?(this.scene.addData(f,this.uniformsBuf),this.gpu.copyBufferToBuffer(e,0,this.uniformsBuf,1,1,p)):(f[1]=e,this.scene.addData(f,this.uniformsBuf)),this.filterPtIndexsBuf.clear(p,c.length),this.gpu.copyBufferToBuffer(this.nextIndexsBuf2[1],0,this.nextIndexsBuf2[0],0,n,p);let m=Math.ceil(i/this.gpu.limits.maxComputeWorkgroupSizeX),g=this.gpu.limits.maxComputeWorkgroupsPerDimension;for(let y=0;y<m;y+=g)this.gpu.copyBufferToBuffer(this.gpu.coordXOffsetBuf,y/g,this.uniformsBuf,0,1,p),this.gpu.runComputePass(p,this.calWorkgroupCountXPipeline,this.calWorkgroupCountXBindGroup,1),this.gpu.runComputePassIndirect(p,this.filterPtPipeline,s,this.indirectBuffer);this.gpu.runComputePass(p,this.subNextIndexsPipeline,this.subNextIndexsBindGroup,n),this.gpu.copyBufferToBuffer(this.nextIndexsBuf2[1],0,l,0,n,p);}};var Ew=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n);}return r;};}("@vertex fn fullVert(@builtin(vertex_index) vIndex : u32) -> @builtin(position) vec4<f32> { var pos = array<vec2<f32>, 6>( vec2<f32>( 1.0, 1.0), vec2<f32>( 1.0, -1.0), vec2<f32>(-1.0, -1.0), vec2<f32>( 1.0, 1.0), vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 1.0) ); return vec4<f32>(pos[vIndex], 0.5, 1.0); }");var ff=class{constructor(e){this.equalPipelineIndex={};this.notEqualPipelineIndex={};this.scene=e;let t=e.gpu;this.gpu=t,this.desc={colorAttachments:[],depthStencilAttachment:{view:this.scene.planeProgram.depthStencilTexture.view,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"}},this.scene.planeProgram.depthStencilTexture.addListener(n=>this.desc.depthStencilAttachment.view=n),this.module=this.gpu.device.createShaderModule({code:Ew({})});}getPipeline(e,t){let n=t?this.equalPipelineIndex:this.notEqualPipelineIndex;return n[e]||(n[e]=this.gpu.device.createRenderPipeline({layout:"auto",vertex:{module:this.module,entryPoint:"fullVert"},primitive:{topology:"triangle-list"},depthStencil:{format:this.scene.planeProgram.depthStencilTexture.format,depthWriteEnabled:!1,depthCompare:"always",stencilWriteMask:255,stencilReadMask:e,stencilFront:{compare:t?"equal":"not-equal",passOp:"replace"},stencilBack:{compare:t?"equal":"not-equal",passOp:"replace"}}})),n[e];}draw(e,t,n){let i=this.scene.commandEncoder.beginRenderPass(this.desc);i.setPipeline(this.getPipeline(n,e)),i.setStencilReference(t),i.draw(6),i.end();}};var df=class{constructor(e,t=null){this.outNum=0;if(t&&e.length!==t.length)throw new Error("The length of vertexes and normals is not equal!");if(e.length===0)throw new Error("The length of vertexes can't be 0!");e instanceof Float32Array?(this.vertexes=e,this.vertexNum=e.length/3):(this.vertexes=this.createArray(e),this.vertexNum=e.length),t instanceof Float32Array?this.normals=t:t&&(this.normals=this.createArray(t));}hasNormals(){return!!this.normals;}iterVertexes(e){for(let t=0;t<this.vertexes.length;t+=3)e(new pe(this.vertexes[t],this.vertexes[t+1],this.vertexes[t+2]));}iterVertexesNormals(e,t){for(let n=0;n<this.vertexes.length;n+=3)e(new pe(this.vertexes[n],this.vertexes[n+1],this.vertexes[n+2])),t(new pe(this.normals[n],this.normals[n+1],this.normals[n+2]));}getBuffer(e){if(!this.vertexsNormalsBuffer){let t=new Float32Array(this.vertexes.length*2);for(let n=0,i=0;i<this.vertexes.length;i+=3,n+=6)t[n]=this.vertexes[i],t[n+1]=this.vertexes[i+1],t[n+2]=this.vertexes[i+2];if(this.normals)for(let n=3,i=0;i<this.normals.length;i+=3,n+=6)t[n]=this.normals[i],t[n+1]=this.normals[i+1],t[n+2]=this.normals[i+2];this.vertexsNormalsBuffer=e.createStaticBuffer(new Uint32Array(t.buffer),GPUBufferUsage.VERTEX),delete this.vertexes,delete this.normals;}return this.vertexsNormalsBuffer;}createArray(e){let t=new Float32Array(e.length*3),n=0;for(let i of e)t[n++]=i.x,t[n++]=i.y,t[n++]=i.z;return t;}incOut(){this.outNum++;}decOut(e){var t;this.outNum--,this.outNum===0&&(e?(e.deleteBuffer(this.vertexsBuffer),this.vertexsBuffer=null,e.deleteBuffer(this.normalsBuffer),this.normalsBuffer=null):((t=this.vertexsNormalsBuffer)==null||t.destroy(),this.vertexsNormalsBuffer=null));}bindVertexesBuffer(e,t){let n=e.gl;this.vertexsBuffer?n.bindBuffer(n.ARRAY_BUFFER,this.vertexsBuffer):(this.vertexsBuffer=e.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexsBuffer),n.bufferData(n.ARRAY_BUFFER,this.vertexes,n.STATIC_DRAW),delete this.vertexes),n.vertexAttribPointer(t,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,null);}bindNormalsBuffer(e,t){let n=e.gl;this.normalsBuffer?n.bindBuffer(n.ARRAY_BUFFER,this.normalsBuffer):(this.normalsBuffer=e.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.normalsBuffer),n.bufferData(n.ARRAY_BUFFER,this.normals,n.STATIC_DRAW),delete this.normals),n.vertexAttribPointer(t,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,null);}getBBox(){if(!this.bbox){let e=new kr();for(let t=0;t<this.vertexes.length;t+=3)e.ext2(this.vertexes[t],this.vertexes[t+1],this.vertexes[t+2]);this.bbox=e.build();}return this.bbox;}},Fa=class extends df{constructor(e,t=null){if(super(e,t),!Number.isInteger(this.vertexes.length/6))throw new Error("The length of vertexs is not a multiple of 2!");}},fr=class extends df{constructor(e,t=null){if(super(e,t),!Number.isInteger(this.vertexes.length/9))throw new Error("The length of vertexs is not a multiple of 3!");}};var Pw=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n);}return r;};}("$CAMERA_STRUCT_WGSL @binding(0) @group(0) var<uniform> camera : Camera; @binding(1) @group(0) var<storage, read> matrixs : array<mat4x4<f32>>; struct VertexOutput { @builtin(position) Position : vec4<f32>, @location(0) normal : vec3<f32>, @location(1) surfaceToEye: vec3<f32>, } @vertex fn vert( @builtin(instance_index) iIndex: u32, @location(0) position : vec4<f32>, @location(1) normal : vec3<f32>, ) -> VertexOutput { var output : VertexOutput; output.Position = camera.mvpMatrix * matrixs[iIndex] * position; let matrix0 = camera.mvMatrix * matrixs[iIndex]; output.normal = mat3x3(matrix0[0].xyz, matrix0[1].xyz, matrix0[2].xyz) * normal; var pos = matrix0 * position; output.surfaceToEye = vec3(0, 0, length(camera.pos)) - pos.xyz / pos.w; return output; } $COLOR_MATERIAL_STRUCT_WGSL @binding(2) @group(0) var<uniform> colorMaterial: ColorMaterial; @binding(3) @group(0) var<uniform> renderMode: u32; @fragment fn frag( @location(0) normal : vec3<f32>, @location(1) surfaceToEye: vec3<f32>, ) -> @location(0) vec4<f32> { if(renderMode == 0){ return colorMaterial.color; } const ambientLightColor = vec3(0.1, 0.1, 0.1); const directLightColor = vec3<f32>(1, 1, 1); const directLightDir0 = vec3<f32>(0, 0, 1); var ambient = colorMaterial.ambientFactor * ambientLightColor; var normal0 = normalize(normal); var directLightDir = normalize(directLightDir0); var diffuse = abs(dot(normal0 , directLightDir)) * colorMaterial.diffuseFactor * directLightColor; var reflect = -2.0 * normal0 * dot(directLightDir, normal0) + directLightDir; var surfaceToEye0 = normalize(surfaceToEye); var lightToEyeFactor = abs(dot(reflect, surfaceToEye0)); var specular = colorMaterial.specularFactor * directLightColor * pow(lightToEyeFactor, 300.0) * colorMaterial.shininess * 0.1; return vec4(ambient + diffuse + specular, colorMaterial.alpha); }");var pf=class{constructor(e){this.scene=e;let t=e.gpu;this.gpu=t;let n=t.device,i=n.createShaderModule({code:Pw({CAMERA_STRUCT_WGSL:en,COLOR_MATERIAL_STRUCT_WGSL:J2})});this.layout=n.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{}},{binding:3,visibility:GPUShaderStage.FRAGMENT,buffer:{}}]});let s=o=>n.createRenderPipeline({layout:n.createPipelineLayout({bindGroupLayouts:[this.layout]}),vertex:{module:i,entryPoint:"vert",buffers:[{arrayStride:6*ht,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:3*ht,format:"float32x3"}]}]},fragment:{module:i,entryPoint:"frag",targets:[{format:e.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:o?"triangle-list":"line-list"},depthStencil:{format:e.depthTexture.format,depthWriteEnabled:!0,depthCompare:"greater"}});this.trianglePipeline=s(!0),this.linePipeline=s(!1),this.matrixBuf=t.createDynamicBuffer(4*4,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST),this.renderModeBuf=t.createDynamicBuffer(1,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),this.desc={colorAttachments:[{view:e.colorTexture.view,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:e.depthTexture.view,depthLoadOp:"load",depthStoreOp:"store"}},e.colorTexture.addListener(o=>this.desc.colorAttachments[0].view=o),e.depthTexture.addListener(o=>this.desc.depthStencilAttachment.view=o);}createDynamicBindGroup(e){return this.gpu.createDynamicBindGroup(this.layout,0,this.scene.cameraBuf,1,this.matrixBuf,2,e,3,this.renderModeBuf);}render(e,t,n,i){let s=new Float32Array(i.length*16);this.matrixBuf.getSize()<s.length&&this.matrixBuf.setSize(s.length),i.forEach((l,u)=>s.set(l.matrix.data,u*16)),this.gpu.writeBuffer(this.matrixBuf,0,s);let o=this.gpu.device.createCommandEncoder();this.gpu.copyBufferToBuffer(this.gpu.numBuf,e===1||e===4?1:0,this.renderModeBuf,0,1,o);let a=o.beginRenderPass(this.desc);a.setPipeline(t instanceof fr&&e!==4?this.trianglePipeline:this.linePipeline),a.setBindGroup(0,n.getBindGroup()),a.setVertexBuffer(0,t.getBuffer(this.gpu).getBuffer()),a.draw(t.vertexNum,i.length,0,0),a.end(),this.gpu.device.queue.submit([o.finish()]);}};var _w=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n);}return r;};}("struct Uniforms { matrix : mat4x4<f32>, } $Camera @group(0) @binding(0) var<uniform> uniforms : Uniforms; @group(0) @binding(1) var<uniform> camera: Camera; @group(0) @binding(2) var u_Sampler: sampler; @group(0) @binding(3) var u_Texture: texture_2d<f32>; struct VertexOutput { @builtin(position) Position : vec4<f32>, @location(0) uv : vec2<f32>, } @vertex fn v_main( @location(0) position: vec2<f32>, @location(1) uv: vec2<f32>, ) -> VertexOutput { var output : VertexOutput; output.Position = camera.mvpMatrix * uniforms.matrix * vec4(position, 0.0, 1.0); output.uv = uv; return output; } @fragment fn f_main( @location(0) uv: vec2<f32>, ) -> @location(0) vec4<f32> { return textureSample(u_Texture, u_Sampler, uv); }");var u0=4,mf=class{constructor(e){this.vertexStrideLen=4;this.scene=e;let t=e.gpu;this.gpu=t,this.device=t.device,this.pipeline=this.createPipeline(),this.renderDesc=this.createRenderDesc(),e.planeProgram.colorTexture.addListener(n=>this.renderDesc.colorAttachments[0].view=n),e.planeProgram.depthStencilTexture.addListener(n=>this.renderDesc.depthStencilAttachment.view=n),this.uniformBuffer=this.createUniformBuffer(),this.sampler=this.createSampler();}createPipeline(){let e=this.device,t=_w({Camera:en}),n=navigator.gpu.getPreferredCanvasFormat(),i=0;return e.createRenderPipeline({layout:"auto",vertex:{module:e.createShaderModule({code:t}),entryPoint:"v_main",buffers:[{arrayStride:this.vertexStrideLen*u0,attributes:[{shaderLocation:0,offset:i,format:"float32x2"},{shaderLocation:1,offset:i+=2*u0,format:"float32x2"}]}]},fragment:{module:e.createShaderModule({code:t}),entryPoint:"f_main",targets:[{format:n,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list",cullMode:"back"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}});}createRenderDesc(){let e=this.scene;return{colorAttachments:[{view:e.planeProgram.colorTexture.view,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:e.planeProgram.depthStencilTexture.view,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store",depthClearValue:1}};}createUniformBuffer(){return this.device.createBuffer({size:16*u0,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});}updateUniformBuffer(e){let t=this.uniformBuffer,n=new Float32Array(e.data);return this.device.queue.writeBuffer(t,0,n.buffer,n.byteOffset,n.byteLength),t;}createSampler(){return this.device.createSampler({magFilter:"linear",minFilter:"linear"});}createUniformBindGroup(e){return this.device.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:this.scene.cameraBuf.getBuffer()}},{binding:2,resource:this.sampler},{binding:3,resource:e.createView()}]});}createVerticesBuffer(e){let t=this.device.createBuffer({size:e.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0});return new Float32Array(t.getMappedRange()).set(e),t.unmap(),t;}createVertexArray(e){let t=[e.rdPoint.x,e.rdPoint.y,1,1,e.ldPoint.x,e.ldPoint.y,0,1,e.luPoint.x,e.luPoint.y,0,0,e.ruPoint.x,e.ruPoint.y,1,0,e.rdPoint.x,e.rdPoint.y,1,1,e.luPoint.x,e.luPoint.y,0,0];return new Float32Array(t);}render(e){let t=this.device;this.updateUniformBuffer(e.matrix);let n=t.createCommandEncoder(),i=n.beginRenderPass(this.renderDesc);i.setPipeline(this.pipeline);let s=e.texture;i.setBindGroup(0,this.createUniformBindGroup(s.gpuTexture));let o=this.createVertexArray({ldPoint:s.ldPoint,luPoint:s.luPoint,rdPoint:s.rdPoint,ruPoint:s.ruPoint});i.setVertexBuffer(0,this.createVerticesBuffer(o)),i.draw(o.length/this.vertexStrideLen,1,0,0),i.end(),t.queue.submit([n.finish()]);}};var hF=`
	struct Uniforms {
        matrix: mat4x4<f32>,
        viewOffset: vec2<f32>,
    }


	@binding(0) @group(0) var<uniform> uniforms: Uniforms;
    @binding(1) @group(0) var tex_in : texture_2d<f32>;

    @vertex
    fn vert(
        @location(0) position : vec2<f32>,
    ) -> @builtin(position) vec4<f32> {
		var pos = uniforms.matrix * vec4(position, 0, 1);
        pos.x += uniforms.viewOffset.x * pos.w;
        pos.y += uniforms.viewOffset.y * pos.w;
        return pos;
    }

    @fragment
    fn frag(
        @builtin(position) coord: vec4<f32>,
    ) -> @location(0) vec4<f32> {
        let color = textureLoad(tex_in, vec2<i32>(coord.xy), 0);
        if(color.a == 0){
            discard;
        }
        return color;
    }
`,gf=class{constructor(e,t,n){this.scene=e;let i=e.gpu;this.uniformsBuf=i.createDynamicBuffer(18,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),this.positionBuf=i.createDynamicBuffer(12,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST);let{device:s}=i;this.depthStencilTexture=new Dn(i,t,n,"depth24plus-stencil8",GPUTextureUsage.RENDER_ATTACHMENT),this.colorTexture=new Dn(i,t,n,"rgba8unorm",GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_SRC);let o=s.createShaderModule({code:hF});this.pipeline=s.createRenderPipeline({layout:"auto",vertex:{module:o,entryPoint:"vert",buffers:[{arrayStride:2*ht,attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]}]},fragment:{module:o,entryPoint:"frag",targets:[{format:e.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.depthTexture.format,depthWriteEnabled:!0}}),this.bindGroup=i.createDynamicBindGroup(this.pipeline.getBindGroupLayout(0),0,this.uniformsBuf,1,this.colorTexture),this.clearDesc={colorAttachments:[{view:this.colorTexture.view,clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthStencilTexture.view,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilClearValue:64,stencilLoadOp:"clear",stencilStoreOp:"store"}},this.colorTexture.addListener(a=>this.clearDesc.colorAttachments[0].view=a),this.depthStencilTexture.addListener(a=>this.clearDesc.depthStencilAttachment.view=a),this.desc={colorAttachments:[{view:e.colorTexture.view,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:e.depthTexture.view,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"}},e.colorTexture.addListener(a=>this.desc.colorAttachments[0].view=a),e.depthTexture.addListener(a=>this.desc.depthStencilAttachment.view=a);}resize(e,t){this.depthStencilTexture.updateSize(e,t),this.colorTexture.updateSize(e,t);}transViewOffset(e,t){this.scene.addData(new Uint32Array(new Float32Array([e,t]).buffer),this.uniformsBuf,16);}render(e,t,n,i){this.scene.commandEncoder.beginRenderPass(this.clearDesc).end(),e();let s=t.getBBox();if(!s)return;let o=t.getPxLength(n,i);this.scene.addData(new Uint32Array(new Float32Array([s.minX-o,s.minY-o,s.minX-o,s.maxY+o,s.maxX+o,s.minY-o,s.maxX+o,s.maxY+o,s.minX-o,s.maxY+o,s.maxX+o,s.minY-o]).buffer),this.positionBuf),this.scene.addData(new Uint32Array(new Float32Array(i.multiply4(n.getRenderMatrix()).data).buffer),this.uniformsBuf);let a=this.scene.commandEncoder.beginRenderPass(this.desc);a.setPipeline(this.pipeline),a.setBindGroup(0,this.bindGroup.getBindGroup()),a.setVertexBuffer(0,this.positionBuf.getBuffer()),a.draw(6),a.end();}};var fF=`
	struct Uniforms {
        matrix: mat4x4<f32>,
        pos0: vec2<f32>,
        pos1: vec2<f32>,
        pos2: vec2<f32>,
        pos3: vec2<f32>,
		shininess: f32,
		alpha: f32,
		renderMode: f32,
    }

	${en}

	@binding(0) @group(0) var<uniform> camera: Camera;
	@binding(1) @group(0) var<uniform> uniforms: Uniforms;
    @binding(2) @group(0) var samp: sampler;
    @binding(3) @group(0) var tex: texture_2d<f32>;

    struct Output {
        @builtin(position) Position: vec4<f32>,
        @location(0) uv: vec2<f32>,
		@location(1) normal: vec3<f32>,
		@location(2) surfaceToEye: vec3<f32>,
    }

    @vertex
    fn vert(
        @builtin(vertex_index) vIndex: u32,
    ) -> Output {
        var output: Output;
		var pos: vec4<f32>;
        if(vIndex == 0 || vIndex == 5) {
            pos = vec4(uniforms.pos0, 0, 1);
            output.uv = vec2<f32>(0, 1);
        } else if(vIndex == 1) {
            pos = vec4(uniforms.pos1, 0, 1);
            output.uv = vec2<f32>(0, 0);
        } else if(vIndex == 2 || vIndex == 3) {
            pos = vec4(uniforms.pos2, 0, 1);
            output.uv = vec2<f32>(1, 0);
        } else {
            pos = vec4(uniforms.pos3, 0, 1);
            output.uv = vec2<f32>(1, 1);
        }
		output.Position = camera.mvpMatrix * uniforms.matrix * pos;
		if(uniforms.renderMode == 1){
			let matrix = camera.mvMatrix * uniforms.matrix;
			output.normal = mat3x3(vec3(matrix[0].xyz), vec3(matrix[1].xyz), vec3(matrix[2].xyz)) * vec3<f32>(0, 0, 1);
			pos = uniforms.matrix * pos;
			output.surfaceToEye = vec3(0, 0, length(camera.pos)) - pos.xyz / pos.w;
		}
        return output;
    }

    @fragment
    fn frag(
        @builtin(position) Position : vec4<f32>,
        @location(0) uv: vec2<f32>,
		@location(1) normal: vec3<f32>,
		@location(2) surfaceToEye: vec3<f32>,
    ) -> @location(0) vec4<f32> {
        let color = textureSample(tex, samp, uv);
        if(color.a == 0 || Position.z > camera.borderZ){
            discard;
        }
		if(uniforms.renderMode == 0 || uniforms.renderMode == 2){
			return color;
		}

		const ambientLightColor = vec3(0.1, 0.1, 0.1);
		const directLightColor = vec3<f32>(1, 1, 1);
		const directLightDir0 = vec3<f32>(0, 0, 1);

		var ambient = color.rgb * ambientLightColor;

		var normal0 = normalize(normal);
		var directLightDir = normalize(directLightDir0);
		var diffuse = abs(dot(normal0 , directLightDir)) * color.rgb * directLightColor;

		var reflect = -2.0 * normal0 * dot(directLightDir, normal0) + directLightDir;
		var surfaceToEye0 = normalize(surfaceToEye);
		var lightToEyeFactor = abs(dot(reflect, surfaceToEye0));
		var specular = color.rgb * directLightColor * pow(lightToEyeFactor, 300.0) * uniforms.shininess * 0.1;

		return vec4(ambient + diffuse + specular, uniforms.alpha);
    }
`,xf=class{constructor(e){this.scene=e;let t=e.gpu;this.uniformsBuf=t.createDynamicBuffer(27,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST);let{device:n}=t,i=n.createShaderModule({code:fF});this.pipeline=n.createRenderPipeline({layout:"auto",vertex:{module:i,entryPoint:"vert"},fragment:{module:i,entryPoint:"frag",targets:[{format:e.planeProgram.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"triangle-list"},depthStencil:{format:e.planeProgram.depthStencilTexture.format,depthWriteEnabled:!0}}),this.desc={colorAttachments:[{view:e.planeProgram.colorTexture.view,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:e.planeProgram.depthStencilTexture.view,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"}},e.planeProgram.colorTexture.addListener(s=>this.desc.colorAttachments[0].view=s),e.planeProgram.depthStencilTexture.addListener(s=>this.desc.depthStencilAttachment.view=s);}createDynamicBindGroup(e){return this.scene.gpu.createDynamicBindGroup(this.pipeline.getBindGroupLayout(0),0,this.scene.cameraBuf,1,this.uniformsBuf,2,this.scene.gpu.device.createSampler({magFilter:"nearest",minFilter:"nearest"}),3,e);}render(e,t,n,i,s){let{bbox:o}=e.pBufInfo;if(t.isOrthCamera()){if(t.getScale()>i)return;}else{let l=n.multiply4(t.getRenderMatrix()),u=new pe(o.minX,o.minY,0).multiply4(l).z,c=new pe(o.minX,o.maxY,0).multiply4(l).z,h=new pe(o.maxX,o.minY,0).multiply4(l).z,d=new pe(o.maxX,o.maxY,0).multiply4(l).z,f=t.getBorderZ(i);if((u>f||u<=0)&&(c>f||c<=0)&&(h>f||h<=0)&&(d>f||d<=0))return;}this.scene.addData(new Uint32Array(new Float32Array(n.data.concat(o.minX,o.minY,o.minX,o.maxY,o.maxX,o.maxY,o.maxX,o.minY,e.getMaterial().shininess,e.getMaterial().alpha,s===1?1:s===4?2:0)).buffer),this.uniformsBuf);let a=this.scene.commandEncoder.beginRenderPass(this.desc);a.setPipeline(this.pipeline),a.setBindGroup(0,e.pBufInfo.bindGroup.getBindGroup()),a.draw(6),a.end();}};var Sw=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n);}return r;};}("struct Uniforms { matrix: mat4x4<f32>, color: vec4<f32>, ruleColor: vec4<f32>, position: vec2<f32>, } @binding(0) @group(0) var<uniform> uniforms: Uniforms; struct Output { @builtin(position) Position: vec4<f32>, @location(0) position: vec4<f32>, @location(1) curr: vec4<f32>, } @vertex fn vert( @location(0) position: vec2<f32>, ) -> Output { var output: Output; output.Position = vec4(position, 0, 1); if(abs(position.x) > 1.0){ if(position.x > 0.0){ output.Position.x = 1.0 - 18.0 * uniforms.matrix[0][0]; }else{ output.Position.x = -1.0 + 18.0 * uniforms.matrix[0][0]; } }else if(abs(position.y) > 1.0){ if(position.y > 0.0){ output.Position.y = 1.0 - 18.0 * uniforms.matrix[1][1]; }else{ output.Position.y = -1.0 + 18.0 * uniforms.matrix[1][1]; } } output.curr = vec4(output.Position.xy, 1.0 - 18.0 * uniforms.matrix[1][1], -1.0 + 18.0 * uniforms.matrix[0][0]); let pos = vec4(uniforms.position, 0, 1) * uniforms.matrix; let piexl_x = uniforms.matrix[0][0] / 2.0; let piexl_y = uniforms.matrix[1][1] / 2.0; output.position = vec4(pos.x - piexl_x, pos.x + piexl_x, pos.y - piexl_y, pos.y + piexl_y); return output; } @fragment fn frag( @builtin(position) Position: vec4<f32>, @location(0) position: vec4<f32>, @location(1) curr: vec4<f32>, ) -> @location(0) vec4<f32> { return select( uniforms.color, uniforms.ruleColor, (curr.x >= position[0] && curr.x <= position[1] && curr.y > curr.z) || (curr.y >= position[2] && curr.y <= position[3] && curr.x < curr.w) ); }");var Bw=function(r){return e=>{for(let t in e){let n=e[t],i=new RegExp(`\\$${t}\\b`,"g");r=r.replace(i,n);}return r;};}("struct Uniforms { matrix: mat4x4<f32>, color: vec4<f32>, } @binding(0) @group(0) var<uniform> uniforms: Uniforms; @vertex fn vert( @location(0) position: vec3<f32>, ) -> @builtin(position) vec4<f32> { var matrix = uniforms.matrix; if(position.z == 1){ matrix[0][0] = 1; matrix[3][0] = 0; } else { matrix[1][1] = 1; matrix[3][1] = 0; } return matrix * vec4(position.xy, 0, 1); } @fragment fn frag() -> @location(0) vec4<f32> { return uniforms.color; }");var Os=(g=>(g[g.MIL=1]="MIL",g[g.INCH=1e3]="INCH",g[g.FT=12e3]="FT",g[g.YARD=36e3]="YARD",g[g.MILE=6336e4]="MILE",g[g.KM=3937007874e-2]="KM",g[g.M=39370]="M",g[g.DM=3937]="DM",g[g.CM=393.7]="CM",g[g.MM=39.37]="MM",g[g.UM=.039]="UM",g[g.NM=394e-7]="NM",g[g.PT=13.88888888888889]="PT",g[g.PX72=13.88888888888889]="PX72",g[g.PX96=10.416666666666666]="PX96",g[g.PX100=10]="PX100",g))(Os||{}),c0=(g=>(g.MIL="mil",g.INCH="inch",g.FT="ft",g.YARD="yard",g.MILE="mile",g.KM="km",g.M="m",g.DM="dm",g.CM="cm",g.MM="mm",g.UM="um",g.NM="nm",g.PT="pt",g.PX72="px(72)",g.PX96="px(96)",g.PX100="px(100)",g))(c0||{}),h0=class{constructor(e,t){this.ratio=e/t;}wrap(e){return e*this.ratio;}static convert(e,t,n){return e*t/n;}},Ur=h0;Ur.ASIS=new h0(1,1);var bf=class{conversion(e,t,n){let i=e+2+t;return this[i](n);}conversion1(e,t,n){let i=e+2+t,s=this[i](n);return t=="mil"?Math.round(s*10)/10:Math.round(s*1e3)/1e3;}mil2mil(e){return e;}mil2mm(e){return e*.0254;}mil2cm(e){return e*.00254;}mil2inch(e){return e/1e3;}mm2mm(e){return e;}mm2mil(e){let t=Math.pow(10,5);return Math.round(e*39.37007874015748*t)/t;}mm2cm(e){return e/10;}mm2inch(e){let t=Math.pow(10,8);return Math.round(e*.03937007874015748*t)/t;}cm2mil(e){let t=Math.pow(10,6);return Math.round(e*3.937007874015748*t)/t;}cm2mm(e){return e*10;}cm2inch(e){let t=Math.pow(10,7);return Math.round(e*.3937007874015748*t)/t;}inch2mil(e){return e*1e3;}inch2mm(e){return e*25.4;}inch2cm(e){return e*2.54;}};var yf=class{constructor(e){this.backgroundColor=qe.WHITE;this.scaleColor=qe.BLACK;this.scale=1;this.ratio=5;this.spacing=2;this.unit="mil";this.origin=F.ORIGIN;this.scene=e;let t=e.gpu,n=t.device;this.desc={colorAttachments:[{view:e.colorTexture.view,loadOp:"load",storeOp:"store"}]},e.colorTexture.addListener(a=>this.desc.colorAttachments[0].view=a),this.backgroundUniformsBuf=t.createDynamicBuffer(26,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);let i=18;this.backgroundPosBuf=t.createStaticBuffer(new Uint32Array(new Float32Array([-1,-1,-i,-1,-i,1,-1,-1,-i,1,-1,1,-1,i,1,i,1,1,-1,i,1,1,-1,1]).buffer),GPUBufferUsage.VERTEX),this.backgroundArrayCount=this.backgroundPosBuf.getSize()/2;let s=n.createShaderModule({code:Sw({})});this.backgroundPipeline=n.createRenderPipeline({layout:"auto",vertex:{module:s,entryPoint:"vert",buffers:[{arrayStride:2*ht,attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]}]},fragment:{module:s,entryPoint:"frag",targets:[{format:e.colorTexture.format}]},primitive:{topology:"triangle-list"}}),this.backgroundBindGroup=t.createBindGroup(this.backgroundPipeline.getBindGroupLayout(0),0,this.backgroundUniformsBuf),this.scaleUniformsBuf=t.createDynamicBuffer(26,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM),this.scalePosBuf=t.createDynamicBuffer(1,GPUBufferUsage.COPY_DST|GPUBufferUsage.VERTEX),this.updateScalePosBuf();let o=n.createShaderModule({code:Bw({})});this.scalePipeline=n.createRenderPipeline({layout:"auto",vertex:{module:o,entryPoint:"vert",buffers:[{arrayStride:3*ht,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},fragment:{module:o,entryPoint:"frag",targets:[{format:e.colorTexture.format,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]},primitive:{topology:"line-list"}}),this.scaleBindGroup=t.createDynamicBindGroup(this.scalePipeline.getBindGroupLayout(0),0,this.scaleUniformsBuf);}setBackgroundColor(e){this.backgroundColor=e;}getBackgroundColor(){return this.backgroundColor;}updateScalePosBuf(){this.deltaX=1-36/this.scene.canvas.width,this.deltaY=1-36/this.scene.canvas.height;let e=[],t=0,n=0,i=this.scene.canvas.width/2,s=this.scene.canvas.height/2,o=(1-this.deltaY)/2;for(let l=0;l<i;l+=this.spacing)t=this.fillVertical(e,l,o,t,n),n+=1;n=0;for(let l=0;l>-i;l-=this.spacing)t=this.fillVertical(e,l,o,t,n),n+=1;n=0;let a=(1-this.deltaX)/2;for(let l=0;l<s;l+=this.spacing)t=this.fillHorizontal(e,l,a,t,n),n+=1;n=0;for(let l=0;l>-s;l-=this.spacing)t=this.fillHorizontal(e,l,a,t,n),n+=1;this.scalePosBuf.setSize(e.length),this.scalePosBuf.write(0,new Float32Array(e)),this.scaleArrayCount=e.length/3;}fillVertical(e,t,n,i,s){let o=s%5,a=s%10;return e[i++]=t,e[i++]=this.deltaY,e[i++]=0,e[i++]=t,a==0?e[i++]=this.deltaY+n*2:o==0?e[i++]=this.deltaY+n:e[i++]=this.deltaY+n*.5,e[i++]=0,i;}fillHorizontal(e,t,n,i,s){let o=s%5;return s%10==0?e[i++]=-this.deltaX-n*2:o==0?e[i++]=-this.deltaX-n:e[i++]=-this.deltaX-n*.5,e[i++]=t,e[i++]=1,e[i++]=-this.deltaX,e[i++]=t,e[i++]=1,i;}autoSize(){this.updateScalePosBuf();}get spacing10(){return this.spacing*this.ratio*this.scale*10;}modifyUnit(e){if(e!=this.unit){let t=new bf();e!="mil"?this.scale=t.conversion(e,"mil",1)/100:this.scale=1,this.scale,this.unit=e;}}autoScale(e){let t=e.getViewMatrix().multiply4(Je.scale(e.getScale(),e.getScale(),1)),n=Math.sqrt(t.data[0]*t.data[0]+t.data[1]*t.data[1]),i=0,s=n;for(;;)if(s>=1){if(s=s/10,s<1)break;i++;}else if(s=s*10,i--,s>=1)break;let o=n/Math.pow(10,i);o>=1&&o<2?n=n/Math.pow(10,i):o>=2&&o<5?n=n/(2*Math.pow(10,i)):n=n/(5*Math.pow(10,i));let a=this.origin.multiply4(e.getViewMatrix().multiply4(Je.scale(e.getScale(),e.getScale(),1))),l=this.spacing10*n,u=this.spacing10*n,c=a.x%l,h=a.y%u;return Je.scale(n*this.ratio*this.scale,n*this.ratio*this.scale,1).translate1(c,h,0).multiply4(e.getProjectMatrix().multiply4(Je.scale(1/e.getScale(),1/e.getScale(),1))).data;}setScaleColor(e){this.scaleColor=e;}getScaleColor(){return this.scaleColor;}getScaleRenderColor(){return this.scene.getAntialias()?this.scaleColor:new qe(this.scaleColor.r,this.scaleColor.g,this.scaleColor.b,this.scaleColor.alpha*.7);}render(){let e=this.scene.getCurrentCamera();{let t=this.getScaleRenderColor();this.scene.addData(new Uint32Array(new Float32Array(e.getProjectMatrix().multiply4(Je.scale(1/e.getScale(),1/e.getScale(),1)).data.concat(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.alpha,t.r,t.g,t.b,t.alpha,this.scene.screenPosition.x,this.scene.screenPosition.y)).buffer),this.backgroundUniformsBuf);let n=this.scene.commandEncoder.beginRenderPass(this.desc);n.setPipeline(this.backgroundPipeline),n.setBindGroup(0,this.backgroundBindGroup),n.setVertexBuffer(0,this.backgroundPosBuf.getBuffer()),n.draw(this.backgroundArrayCount),n.end();}{let t=this.getScaleRenderColor();this.scene.addData(new Uint32Array(new Float32Array(this.autoScale(e).concat(t.r,t.g,t.b,t.alpha)).buffer),this.scaleUniformsBuf);let n=this.scene.commandEncoder.beginRenderPass(this.desc);n.setPipeline(this.scalePipeline),n.setBindGroup(0,this.scaleBindGroup.getBindGroup()),n.setVertexBuffer(0,this.scalePosBuf.getBuffer()),n.draw(this.scaleArrayCount),n.end();}}};var es=1024,wf=class extends sf{constructor(t,n,i){super();this.planeIdMap=new Nn(es);this.dataU=new Uint32Array(Le(2,20));this.dataOffset=0;this.normalPlaneSet=new Set();this.normalPlaneRenderDatas=[];this.preDrawNormalPlaneDatas=[];this.lock=new vo(1);this.colorMap=new Hr();this.caledTexScale=!1;this.texScale=n0;this.texPxLength=1/this.texScale;this.removingPtNum=0;this.noResize=!1;this.screenPosition=F.ORIGIN;this.renderWhenChange=!0;this.virtualTimes=[];this.frameTimes=[];this.startTime=performance.now();this.canvas=i,this.gpu=new Ua(t),this.normalBuilder=new qa(this.gpu,Oa),this.planeIdMap.markUsed(0),this.context=i.getContext("webgpu"),this.context.configure({device:t,format:"rgba8unorm",alphaMode:"opaque",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST}),this.depthTexture=new Dn(this.gpu,i.width,i.height,"depth24plus",GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING),this.colorTexture=new Dn(this.gpu,i.width,i.height,"rgba8unorm",GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_SRC),this.cameraBuf=this.gpu.createDynamicBuffer(Wh,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),this.dataBuf=this.gpu.createDynamicBuffer(this.dataU.length,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.normalFilteredStartIndexsBuf=this.gpu.createDynamicBuffer(1,GPUBufferUsage.STORAGE),this.normalFilteredPtNumsBuf=this.gpu.createDynamicBuffer(1,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.colorsBuf=this.gpu.createDynamicBuffer(4,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.clearDesc={colorAttachments:[{view:this.colorTexture.view,clearValue:{r:.8,g:.8,b:.8,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTexture.view,depthClearValue:0,depthLoadOp:"clear",depthStoreOp:"store"}},this.colorTexture.addListener(a=>this.clearDesc.colorAttachments[0].view=a),this.depthTexture.addListener(a=>this.clearDesc.depthStencilAttachment.view=a),this.planeProgram=new gf(this,i.width,i.height),this.drawStencilProgram=new ff(this),this.renderPtProgram=new lf(this),this.extractBitBufferProgram=new uf(this),this.renderBitBufferProgram=new cf(this),this.filterPtProgram=new hf(this),this.filterNodeProgram=new nf(this,Oa),this.renderTexProgram=new xf(this),this.meshProgram=new pf(this),this.textureProgram=new mf(this),this.rulerProgram=new yf(this);let{startIndexsBuf:s,ptsBuf:o}=this.normalBuilder.update();this.normalFilterBindGroup=this.filterPtProgram.createDynamicBindGroup(o,s,this.normalFilteredStartIndexsBuf),this.normalRenderBindGroup=this.renderPtProgram.createDynamicBindGroup(o,this.normalFilteredStartIndexsBuf),window.addEventListener("keydown",a=>{a.key==="Escape"&&(this.renderWhenChange=!this.renderWhenChange);}),this.resize(),this.install(n);}install(t){t.rpcService("/engine/scene/setBackgroundColor",n=>{this.backgroudColor=qe.of5(...n);}),t.rpcService("/engine/scene/setCoordSys",n=>{this.needRenderAll=!0;}),t.rpcService("/engine/scene/setGridType",n=>{this.needRenderAll=!0;}),t.rpcService("/engine/scene/setGridPattern",n=>{this.needRenderAll=!0;}),t.rpcService("/engine/scene/setGridColor",n=>{this.needRenderAll=!0;}),t.rpcService("/engine/scene/setGridDelta",n=>{this.needRenderAll=!0;}),t.rpcService("/engine/scene/setPolarDelta",n=>{this.needRenderAll=!0;}),t.rpcService("/engine/scene/setPolarRadius",n=>{this.needRenderAll=!0;}),t.rpcService("/engine/scene/setPolarAngle",n=>{this.needRenderAll=!0;}),t.rpcService("/engine/scene/setOpenRuler",n=>{this.openRuler=n,this.needRenderAll=!0;}),t.rpcService("/engine/scene/setUnit",n=>{this.modifyUnit(n),this.needRenderAll=!0;});}getAntialias(){return!1;}logAllTexSize(){let t=0;this.normalPlaneSet.forEach(n=>{n.pBufInfo.buf?t+=n.pBufInfo.buf.getSize():n.pBufInfo.texture&&(t+=n.pBufInfo.texture.width*n.pBufInfo.texture.height);}),console.log("allTexSize:",t*ht/Le(2,30));}getColorIndex(t){if(!!t)return this.colorMap.computeIfAbsent(t,()=>{let n=this.colorMap.size()+1;return n*4>=this.colorsBuf.getSize()&&this.colorsBuf.extSize(this.colorsBuf.getSize()*2),this.colorsBuf.write(n*4,new Float32Array([t.r,t.g,t.b,t.alpha])),n;});}getPlaneId(){let t=this.planeIdMap.findEmpty();return this.planeIdMap.markUsed(t),t;}releasePlaneId(t){this.planeIdMap.markRemove(t);}initCommandEncoder(){this.dataOffset=0,this.commandEncoder=this.gpu.device.createCommandEncoder();}addData(t,n,i=0){if(this.dataOffset+t.length>this.dataU.length){if(t.length>this.dataU.length)throw new Error("data.length > this.dataU.length");this.submitCommandEncoder(),this.initCommandEncoder();}this.dataU.set(t,this.dataOffset),this.gpu.copyBufferToBuffer(this.dataBuf,this.dataOffset,n,i,t.length,this.commandEncoder),this.dataOffset+=t.length;}submitCommandEncoder(){this.gpu.writeBuffer(this.dataBuf,0,this.dataU,0,this.dataOffset),this.gpu.submit(this.commandEncoder);}getCurrentCamera(){return this.currentCamera;}getViewOffset(){return F.ORIGIN;}addNormalPlane(t){this.normalPlaneSet.add(t);}delNormalPlane(t){this.normalPlaneSet.delete(t);}turnSimpleModeOnOrOff(t){}setSampling(t){}clearTexture(){this.commandEncoder.beginRenderPass(this.clearDesc).end();}copyColorToCanvas(){let t=this.gpu.device.createCommandEncoder();t.copyTextureToTexture({texture:this.colorTexture.texture},{texture:this.context.getCurrentTexture()},this.colorTexture),this.gpu.submit(t);}renderNormalPlanesTest(t,n=Array.from(this.normalPlaneSet),i=()=>{}){var a;let s=[],o=[];if(n.forEach(l=>{s[l.getId()]=[Je.ORIGIN],o[l.getId()]={staticData:[]};}),this.updateCameraBuf(t,Number.NEGATIVE_INFINITY),this.initCommandEncoder(),this.normalPlaneRenderDatas.forEach(l=>{let u=t.getRenderMatrix(),c=new ke();[l.bbox.LL(),l.bbox.LR(),l.bbox.UL(),l.bbox.UR()].forEach(b=>{let y=new pe(b.x,b.y,0).multiply4(u);c.ext6(y.x,y.y);});let h=c.build();if(h.minX>=1||h.maxX<=-1||h.minY>=1||h.maxY<=-1)return;let d=this.filter(0,0,s,l);if(!d)return;let{ptNumsArr:f,filterRenderBindGroups:p,filteredPtNumsBuf:m}=l,g=0;s.forEach((b,y)=>{b.forEach(v=>{o[y].staticData.push({nextIndexs:d,index:g,ptNums:f.slice(y*6,(y+1)*6),renderBindGroup:p.renderBindGroup,filteredPtNumsBuf:m}),g+=6;});});}),this.normalPtNumsArr){let l=new Uint32Array(s.reduce((h,d)=>h+d.length,0)*6),u=0,c=0;for(let h=1;h<s.length;h++)(a=s[h])==null||a.forEach(d=>{var f;(f=this.normalPtNumsArr.slice(h*6,(h+1)*6))==null||f.forEach((p,m)=>{l[c+m]=u,u+=p;}),c+=6;});u!==0&&(this.normalFilteredStartIndexsBuf.setSize(u),this.normalFilteredPtNumsBuf.setSize(l.length),this.filterPtProgram.filter(this.normalBuilder.getIdsLengthInBuf(),1,l.length,this.normalBuilder.getIdsLengthInBuf(),this.normalFilterBindGroup.getBindGroup(),s,l,this.normalFilteredPtNumsBuf,!0),c=0,s.forEach((h,d)=>{h.forEach(f=>{o[d].dynamicData={nextIndexs:l,index:c,ptNums:this.normalPtNumsArr.slice(d*6,(d+1)*6)},c+=6;});}));}this.clearTexture(),n.forEach(l=>{this.planeProgram.render(()=>{let u=o[l.getId()];u.staticData.forEach(c=>{this.renderPtProgram.draw(Je.ORIGIN,t,l,0,c.nextIndexs,c.ptNums,c.renderBindGroup.getBindGroup(),c.filteredPtNumsBuf,c.index,l,"render");}),u.dynamicData&&this.renderPtProgram.draw(Je.ORIGIN,t,l,0,u.dynamicData.nextIndexs,u.dynamicData.ptNums,this.normalRenderBindGroup.getBindGroup(),this.normalFilteredPtNumsBuf,u.dynamicData.index,l,"render");},l,t,Je.ORIGIN);}),i(),this.submitCommandEncoder();}calTexScalePxLength(t){return Se(this,null,function*(){if(this.caledTexScale)return;this.caledTexScale=!0,this.normalPlaneSet.forEach(s=>s.clearPBuf()),this.resize(2048,1024),this.noResize=!0;let n=this.currentCamera.copy();n.setCameraType(!0),n.setCameraDirect(!0),n.adapt(new gn(t.minX,t.minY,0,t.maxX,t.maxY,0));let i=n.getScale();for(n.setScale(i*100),this.renderNormalPlanesTest(n),yield this.gpu.device.queue.onSubmittedWorkDone(),n.setScale(i);;){let s=performance.now();this.renderNormalPlanesTest(n),this.copyColorToCanvas(),yield this.gpu.device.queue.onSubmittedWorkDone();let o=performance.now()-s;if(console.log("render time:",o),o<=1e3/r0){this.texScale=n.getScale(),this.texPxLength=n.getPxLength(),this.noResize=!1,this.resize(),console.log("scale times:",this.texScale/i);return;}n.setScale(n.getScale()*1.1);}});}build(){return Se(this,null,function*(){if(!this.normalBuilder.isChange())return;console.log("normal ptNum:",this.normalBuilder.getPtNum());let t=yield this.normalBuilder.build();if(t instanceof Uint32Array){this.normalPtNumsArr=t;return;}delete this.normalPtNumsArr,this.normalPlaneRenderDatas.forEach(a=>{a.filteredStartIndexsBuf.destroy(),a.filteredPtNumsBuf.destroy(),a.filterRenderBindGroups.filterPtBindGroup2.forEach(l=>l.destroy()),a.filterRenderBindGroups.renderBindGroup.destroy();}),this.normalPlaneRenderDatas.length=0;let{rtreeIndex:n,bbox:i}=t,s=this.gpu;n.forEach(a=>{let l=s.createDynamicBuffer(a.ptNum,GPUBufferUsage.STORAGE),u=this.filterNodeProgram.createFilterRenderBindGroups(a.ptsBuf,a.nodesBuf,l),c=a.nodeRanges,h,d;for(let f=0;f<c.length;f++)if(c[f].nodeNum<=t0){d=f+1,h=c[f];break;}this.normalPlaneRenderDatas.push({filterRenderBindGroups:u,idsBuf:a.idsBuf,nodesBuf:a.nodesBuf,ptsBuf:a.ptsBuf,nodeRange:h,levelNum:d,bbox:a.bbox,ptNumsArr:a.ptNumsArr,filteredStartIndexsBuf:l,filteredPtNumsBuf:s.createDynamicBuffer(a.ptNumsArr.length,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)});});let o={idsSize:this.normalPlaneRenderDatas.reduce((a,l)=>a+l.idsBuf.getSize(),0)*ht/Le(2,30),ptsSize:this.normalPlaneRenderDatas.reduce((a,l)=>a+l.ptsBuf.getSize(),0)*ht/Le(2,30),nodesSize:this.normalPlaneRenderDatas.reduce((a,l)=>a+l.nodesBuf.getSize(),0)*ht/Le(2,30),filteredStartIndexsSize:this.normalPlaneRenderDatas.reduce((a,l)=>a+l.filteredStartIndexsBuf.getSize(),0)*ht/Le(2,30),filteredPtNumsSize:this.normalPlaneRenderDatas.reduce((a,l)=>a+l.filteredPtNumsBuf.getSize(),0)*ht/Le(2,30)};console.log("bufferSize",s.bufferSize*ht/Le(2,30),o,"totalSize:",Object.values(o).reduce((a,l)=>a+l,0)),yield this.calTexScalePxLength(i);});}preDrawNormalPlanes(t,n){var d;this.preDrawNormalPlaneDatas.length=0,this.updateCameraBuf(t);let i=t.getBorderZ(this.texScale);if(this.normalPlaneSet.size===0||i>=1)return;let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;n.forEach(f=>{for(let p of f[0].interPlanes)if(p.isNormal()&&!p.isEmpty()){let m=pe.ORIGIN.multiply4(f[1]).z;s=Math.min(s,m),o=Math.max(o,m);return;}for(let p of f[0].subPlanes)if(p.isNormal()&&!p.isEmpty()){let m=pe.ORIGIN.multiply4(f[1]).z;s=Math.min(s,m),o=Math.max(o,m);return;}});let a=[],{preDrawNormalPlaneDatas:l}=this;if(n.forEach(f=>{function p(g){if(g.isEmpty()||!g.isNormal())return;let b=g.getBBox2(),y=m.multiply4(t.getRenderMatrix()),v=[new pe(b.minX,b.minY,0).multiply4(y),new pe(b.minX,b.maxY,0).multiply4(y),new pe(b.maxX,b.minY,0).multiply4(y),new pe(b.maxX,b.maxY,0).multiply4(y)];if(v[0].x<=-1&&v[1].x<=-1&&v[2].x<=-1&&v[3].x<=-1||v[0].x>=1&&v[1].x>=1&&v[2].x>=1&&v[3].x>=1||v[0].y<=-1&&v[1].y<=-1&&v[2].y<=-1&&v[3].y<=-1||v[0].y>=1&&v[1].y>=1&&v[2].y>=1&&v[3].y>=1||v[0].z<=i&&v[1].z<=i&&v[2].z<=i&&v[3].z<=i)return;a[g.getId()]||(a[g.getId()]=[]),a[g.getId()].push(m);let E=l[g.getId()];E||(E=new Hr(),l[g.getId()]=E),E.get(m)||E.put(m,{staticData:[]});}let m=f[1];f[0].interPlanes.forEach(g=>p(g)),f[0].subPlanes.forEach(g=>p(g));}),a.length===0||(this.normalPlaneRenderDatas.forEach(f=>{let p=t.getRenderMatrix(),m=new ke();new gn(f.bbox.minX,f.bbox.minY,s,f.bbox.maxX,f.bbox.maxY,o).getVertexes().forEach(M=>{let I=new pe(M.x,M.y,M.z).multiply4(p);m.ext6(I.x,I.y);});let g=m.build();if(g.minX>=1||g.maxX<=-1||g.minY>=1||g.maxY<=-1)return;let b=this.filter(s,o,a,f);if(!b)return;let{ptNumsArr:y,filterRenderBindGroups:v,filteredPtNumsBuf:E}=f,P=0;a.forEach((M,I)=>{M.forEach(C=>{l[I].get(C).staticData.push({nextIndexs:b,index:P,ptNums:y.slice(I*6,(I+1)*6),renderBindGroup:v.renderBindGroup,filteredPtNumsBuf:E}),P+=6;});});}),!this.normalPtNumsArr))return;let u=new Uint32Array(a.reduce((f,p)=>f+p.length,0)*6),c=0,h=0;for(let f=1;f<a.length;f++)(d=a[f])==null||d.forEach(p=>{var m;(m=this.normalPtNumsArr.slice(f*6,(f+1)*6))==null||m.forEach((g,b)=>{u[h+b]=c,c+=g;}),h+=6;});c!==0&&(this.normalFilteredStartIndexsBuf.setSize(c),this.normalFilteredPtNumsBuf.setSize(u.length),this.filterPtProgram.filter(this.normalBuilder.getIdsLengthInBuf(),1,u.length,this.normalBuilder.getIdsLengthInBuf(),this.normalFilterBindGroup.getBindGroup(),a,u,this.normalFilteredPtNumsBuf,!0),h=0,a.forEach((f,p)=>{f.forEach(m=>{l[p].get(m).dynamicData={nextIndexs:u,index:h,ptNums:this.normalPtNumsArr.slice(p*6,(p+1)*6)},h+=6;});}));}afterDraw(t){t==="drawInterStencil"&&(this.drawStencilProgram.draw(!0,192,127),this.drawStencilProgram.draw(!0,128,128),this.drawStencilProgram.draw(!1,64,63));}renderNormalPlane(t,n,i,s,o){var l;if(t.isEmpty())return;let a=(l=this.preDrawNormalPlaneDatas[t.getId()])==null?void 0:l.get(n);a&&(a.staticData.forEach(u=>{this.renderPtProgram.draw(n,this.currentCamera,i,s,u.nextIndexs,u.ptNums,u.renderBindGroup.getBindGroup(),u.filteredPtNumsBuf,u.index,t,o);}),a.dynamicData&&this.renderPtProgram.draw(n,this.currentCamera,i,s,a.dynamicData.nextIndexs,a.dynamicData.ptNums,this.normalRenderBindGroup.getBindGroup(),this.normalFilteredPtNumsBuf,a.dynamicData.index,t,o)),t.pBufInfo.bbox&&(t.pBufInfo.buf?this.renderBitBufferProgram.draw(n,this.currentCamera,i,t,s,t.pBufInfo.width,t.pBufInfo.height,this.texPxLength,t.pBufInfo.bbox,this.texScale,t.pBufInfo.bindGroup.getBindGroup(),o):this.renderTexProgram.render(t,this.currentCamera,n,this.texScale,s)),this.afterDraw(o);}filterPtRender(t,n,i,s,o,a,l,u,c,h){let d=0,f=new Uint32Array(6);for(let m=1;m<6;m++)f[m]=d+=s[m-1];let p=this.gpu.getTempBuf(f.length);this.filterPtProgram.filter(l,0,f.length,l,o,u,f,p,!1),this.renderPtProgram.draw(u[c.getId()][0],t,n,i,f,s,a,p,0,c,h),this.afterDraw(h);}filter(t,n,i,s){var m;let{filterRenderBindGroups:o,nodeRange:a,levelNum:l,ptNumsArr:u,filteredPtNumsBuf:c}=s,h=this.filterNodeProgram.filter(a,t,n,l,o),d=new Uint32Array(i.reduce((g,b)=>g+b.length,0)*6),f=0,p=0;for(let g=1;g<i.length;g++)(m=i[g])==null||m.forEach(b=>{u.slice(g*6,(g+1)*6).forEach((y,v)=>{d[p+v]=f,f+=y;}),p+=6;});if(f!==0)return s.filteredStartIndexsBuf.setSize(f),c.setSize(d.length),this.filterPtProgram.filter(h,1,d.length,Math.min(a.nodeNum*Le(Oa,l),_r),o.filterPtBindGroup2[l%2].getBindGroup(),i,d,c,!0),d;}updateCameraBuf(t,n=this.texScale){Q2(this.cameraBuf,t,n);}render(){return Se(this,arguments,function*(t=2,n=null){let i=Array.from(this.cameraSet)[0];if(!i||!i.isChangedFromLastRender()&&!n&&this.renderWhenChange&&!this.needRenderAll)return;this.needRenderAll=!1,yield this.lock.acquireSync(),this.frameTimes.push(performance.now()-this.startTime),this.startTime=performance.now(),this.currentCamera=i,i.adjustAxis(),this.group.preDraw();let s=[];if(this.group.getPlaneGPUMatrixRenderModes(t).forEach(a=>{a[0].getBBox()?s.push(a):a[0].markDrawn(a[1]);}),i.isOrthCamera())i.getTar2Pos().z<0?s.sort((a,l)=>{let u=a[0].getBBox().transform(a[1]),c=l[0].getBBox().transform(l[1]);return c.minZ+c.maxZ-(u.minZ+u.maxZ);}):s.sort((a,l)=>{let u=a[0].getBBox().transform(a[1]),c=l[0].getBBox().transform(l[1]);return u.minZ+u.maxZ-(c.minZ+c.maxZ);});else{let a=i.getZ();s.sort((l,u)=>{let c=l[0].getBBox().transform(l[1]),h=u[0].getBBox().transform(u[1]);return Math.abs(a-(h.minZ+h.maxZ)/2)-Math.abs(a-(c.minZ+c.maxZ)/2);});}for(;this.removingPtNum!==0;)yield new Promise(a=>setTimeout(a,0));yield this.build(),this.normalPlaneSet.forEach(a=>a.updatePBuf()),this.resize(),this.initCommandEncoder(),this.clearTexture(),this.preDrawNormalPlanes(i,s),s.forEach(a=>this.planeProgram.render(()=>a[0].draw(i,a[1],a[2]),a[0],i,a[1])),this.submitCommandEncoder();let o=this.group.getMeshMap(t);for(let[a,l]of o.entries())a.drawGPU(this,l);this.openRuler&&(this.initCommandEncoder(),this.rulerProgram.render(),this.submitCommandEncoder()),this.copyColorToCanvas(),yield this.gpu.device.queue.onSubmittedWorkDone(),i.rendered(),this.lock.release(),this.virtualTimes.push(performance.now()-this.startTime),this.frameTimes.length===30&&(console.log("frame fps",1e3/(this.frameTimes.reduce((a,l)=>a+l,0)/this.frameTimes.length),"virtual fps",1e3/(this.virtualTimes.reduce((a,l)=>a+l,0)/this.virtualTimes.length)),this.frameTimes.length=0,this.virtualTimes.length=0);});}setScreenPosition(t){this.screenPosition=t,this.openRuler&&(this.needRenderAll=!0);}getSingleColor(t,n){return new Uint8Array(4);}getCanvas(){return this.canvas;}resize(t,n){if(!this.noResize){if(!t||!n)if(jh&&Zh)t=jh,n=Zh;else{let i=window.devicePixelRatio;/android|iphone|symbian|windows phone|ipad|ipod/i.test(navigator.userAgent)&&(i*=window.outerWidth/window.innerWidth),t=this.canvas.clientWidth*i,n=this.canvas.clientHeight*i,(t===0||n===0)&&(t=1,n=1);}this.canvas.width===t&&this.canvas.height===n||(this.canvas.width=t,this.canvas.height=n,this.colorTexture.updateSize(t,n),this.depthTexture.updateSize(t,n),this.cameraSet.forEach(i=>i.updateSize(t,n)),this.planeProgram.resize(t,n),this.rulerProgram.autoSize());}}isCoreGraphic(){return!0;}get backgroudColor(){let t=this.clearDesc.colorAttachments[0].clearValue;return new qe(t.r,t.g,t.b,t.a);}set backgroudColor(t){this.clearDesc.colorAttachments[0].clearValue={r:t.r,g:t.g,b:t.b,a:t.alpha},this.needRenderAll=!0;}getImageData(t,n,i,s){throw new Error("not support");}captureToCanvas(t,n,i){throw new Error("not support");}createPlane(t,n,i,s){return new za(this,Oa,t,n,i,s);}modifyUnit(t){this.rulerProgram.modifyUnit(t);}};function dF(r){return`
    struct Uniforms {
		ptNum: u32,
		coordXOffset: u32,
    }

	struct IdStartIndex {
		id: u32,
		startIndex: u32,
	}

	struct InfoStartIndexsR {
		ptNum: u32,
		nextStartIndex: u32,
        idStartIndexs: array<IdStartIndex>,
	}

    @binding(0) @group(0) var<uniform> uniforms: Uniforms;
    @binding(1) @group(0) var<storage, read_write> infoStartIndexs: InfoStartIndexsR;
	@binding(2) @group(0) var<storage, read_write> pts: array<f32>;
	@binding(3) @group(0) var<storage, read_write> counts: array<atomic<u32>>;

    @compute @workgroup_size(${r.limits.maxComputeWorkgroupSizeX})
    fn countPrimitiveType(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let index = uniforms.coordXOffset + coord.x;
		if(index >= uniforms.ptNum){
			return;
		}

		let head = u32(pts[infoStartIndexs.idStartIndexs[index].startIndex]);
		atomicAdd(&counts[(head & ${_o}) * ${6} + ((head & ${sr}) >> ${dt})], 1);
	}
`;}var vf;function Iw(r,e,t){vf||(vf=r.createComputePipeline(r.device.createShaderModule({code:dF(r)}),"countPrimitiveType"));let n=r.createDynamicBuffer(2,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),i=(e.getSize()-Ji)/2;n.write(0,new Uint32Array([i]));let s=r.createDynamicBuffer(6*es,GPUBufferUsage.COPY_SRC|GPUBufferUsage.STORAGE),o=r.createBindGroup(vf.getBindGroupLayout(0),0,n,1,e,2,t,3,s),a=r.device.createCommandEncoder();r.runComputePass(a,vf,o,i,u=>r.copyBufferToBuffer(r.coordXOffsetBuf,u,n,1,1,a)),r.submit(a);let l=s.read().then(u=>{let c=new Uint32Array(u);for(let h=c.length-1;h>=0;h--)if(c[h]!==0)return c.slice(0,h+1);throw new Error("no pt!");});return s.destroy(),n.destroy(),l;}var Sf=30,Bf=7,Pf=32-Bf,Mw=Le(2,Pf)-1,Ya=4;function Ef(r){let{maxComputeWorkgroupStorageSize:e}=r.limits,t=Le(2,Math.floor(Math.log2(e/ht/Ya))),n=Math.floor(e/ht/2);return{bboxNum:t,prefixNum:n};}function pF(r,e){let{bboxNum:t,prefixNum:n}=Ef(r),{maxComputeWorkgroupSizeX:i}=r.limits;return`
	struct BBox {
		minX: f32,
		maxX: f32,
		minY: f32,
		maxY: f32,
		mortonCode: u32,
	}

	fn setMortonCode(i: u32) {
		// coords are transformed into non-negative 15-bit integer range
		let bbox = bboxs[i];
		// var x = u32(32767 * ((bbox.minX + bbox.maxX) / 2 - params.minX) * params.invSize);
		// var y = u32(32767 * ((bbox.minY + bbox.maxY) / 2 - params.minY) * params.invSize);
		var x = u32(32767 * ((bbox.minX + bbox.maxX) / 2 - params.minX) * params.invX);
		var y = u32(32767 * ((bbox.minY + bbox.maxY) / 2 - params.minY) * params.invY);

		x = (x | (x << 8)) & 0x00ff00ff;
		x = (x | (x << 4)) & 0x0f0f0f0f;
		x = (x | (x << 2)) & 0x33333333;
		x = (x | (x << 1)) & 0x55555555;

		y = (y | (y << 8)) & 0x00ff00ff;
		y = (y | (y << 4)) & 0x0f0f0f0f;
		y = (y | (y << 2)) & 0x33333333;
		y = (y | (y << 1)) & 0x55555555;

		bboxs[i].mortonCode = x | (y << 1);
	}

	struct Node {
		minX: f32,
		maxX: f32,
		minY: f32,
		maxY: f32,
		childIndexs: array<i32, ${e}>,
	}

	struct Unit {
		bboxStartIndex: u32,
		bboxEndIndex: u32,
	}

	struct Params {
		minX: f32,
		minY: f32,
		invSize: f32,
		bboxBaseIndex: i32,
		step: u32,
		shift: u32,
		srcNodeStartIndex: u32,
		srcNodeEndIndex: u32,
		dstNodeStartIndex: u32,
		maxLevel: u32,
		groupOffsetX: u32,
		invX: f32,
		invY: f32,
		shiftedResultId: u32,
	}

	struct IdStartIndex {
		id: u32,
		startIndex: u32,
	}

	struct InfoStartIndexsR {
		ptNum: u32,
		nextStartIndex: u32,
        idStartIndexs: array<IdStartIndex>,
	}

	@binding(11) @group(0) var<storage, read_write> infoStartIndexs: InfoStartIndexsR;
	@binding(12) @group(0) var<storage, read_write> sortedPts: array<f32>;
	@binding(0) @group(0) var<storage, read_write> pts: array<f32>;
	@binding(1) @group(0) var<storage, read_write> bboxs: array<BBox>;
	@binding(2) @group(0) var<storage, read_write> nodes: array<Node>;
	@binding(3) @group(0) var<storage, read_write> units: array<Unit>;
    @binding(4) @group(0) var<uniform> params: Params;
    @binding(4) @group(0) var<storage, read_write> paramsW: Params;

	@compute @workgroup_size(${i})
    fn buildBBoxs(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let coordX = params.groupOffsetX * ${i} + coord.x;
		if (coordX >= arrayLength(&bboxs)) {
			return;
		}

		let startIndex = infoStartIndexs.idStartIndexs[coordX].startIndex;
		let head = u32(pts[startIndex]);
        let type0 = (head & ${sr}) >> ${dt};
		bboxs[coordX].mortonCode = 0; // \u6B64\u884C\u4EE3\u7801\u662F\u591A\u4F59\u7684\uFF0C\u4F46\u662F\u6CA1\u6709\u53EF\u80FD\u4F1A\u5BFC\u81F4 bug
		if (type0 == ${0}) {
			bboxs[coordX].minX = pts[startIndex + 1] - pts[startIndex + 3];
			bboxs[coordX].maxX = pts[startIndex + 1] + pts[startIndex + 3];
			bboxs[coordX].minY = pts[startIndex + 2] - pts[startIndex + 3];
			bboxs[coordX].maxY = pts[startIndex + 2] + pts[startIndex + 3];
		} else if (type0 == ${1}) {
			bboxs[coordX].minX = min(pts[startIndex + 1], pts[startIndex + 3]) - pts[startIndex + 5] / 2.0;
			bboxs[coordX].maxX = max(pts[startIndex + 1], pts[startIndex + 3]) + pts[startIndex + 5] / 2.0;
			bboxs[coordX].minY = min(pts[startIndex + 2], pts[startIndex + 4]) - pts[startIndex + 5] / 2.0;
			bboxs[coordX].maxY = max(pts[startIndex + 2], pts[startIndex + 4]) + pts[startIndex + 5] / 2.0;
		} else if (type0 == ${2}) {
			let centerX = pts[startIndex + 1];
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let width2 = pts[startIndex + 4] / 2;
			let startAngle = pts[startIndex + 5];
			let endAngle = startAngle + pts[startIndex + 6];
			var x = cos(startAngle);
			var y = sin(startAngle);
			var minX = x;
			var maxX = x;
			var minY = y;
			var maxY = y;
			x = cos(endAngle);
			y = sin(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			minY = min(minY, y);
			maxY = max(maxY, y);
			for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
				x = cos(angle);
				y = sin(angle);
				minX = min(minX, x);
				maxX = max(maxX, x);
				minY = min(minY, y);
				maxY = max(maxY, y);
			}
			bboxs[coordX].minX = minX * radius - width2 + centerX;
			bboxs[coordX].maxX = maxX * radius + width2 + centerX;
			bboxs[coordX].minY = minY * radius - width2 + centerY;
			bboxs[coordX].maxY = maxY * radius + width2 + centerY;
		} else if (type0 == ${3}) {
			bboxs[coordX].minX = min(min(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]);
			bboxs[coordX].maxX = max(max(pts[startIndex + 1], pts[startIndex + 3]), pts[startIndex + 5]);
			bboxs[coordX].minY = min(min(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]);
			bboxs[coordX].maxY = max(max(pts[startIndex + 2], pts[startIndex + 4]), pts[startIndex + 6]);
		} else if (type0 == ${4}) {
			let leftUpPoint = vec2(pts[startIndex + 1], pts[startIndex + 2]);
			let width = pts[startIndex + 3];
			let height = pts[startIndex + 4];
			let angle = radians(pts[startIndex + 5]);
			let radius = pts[startIndex + 7];

			let cos0 = cos(angle);
			let sin0 = sin(angle);
			let mat0 = mat2x2<f32>(cos0, sin0, -sin0, cos0);

			let luPoint = leftUpPoint + mat0 * vec2(radius, -radius);
			let ldPoint = leftUpPoint + mat0 * vec2(radius, radius - height);
			let ruPoint = leftUpPoint + mat0 * vec2(width - radius, -radius);
			let rdPoint = leftUpPoint + mat0 * vec2(width - radius, radius - height);
			
			bboxs[coordX].minX = min(min(luPoint.x, ldPoint.x), min(ruPoint.x, rdPoint.x)) - radius;
			bboxs[coordX].maxX = max(max(luPoint.x, ldPoint.x), max(ruPoint.x, rdPoint.x)) + radius;
			bboxs[coordX].minY = min(min(luPoint.y, ldPoint.y), min(ruPoint.y, rdPoint.y)) - radius;
			bboxs[coordX].maxY = max(max(luPoint.y, ldPoint.y), max(ruPoint.y, rdPoint.y)) + radius;
		} else if (type0 == ${5}) {
			let centerX = pts[startIndex + 1];
			let centerY = pts[startIndex + 2];
			let radius = pts[startIndex + 3];
			let startAngle = pts[startIndex + 4];
			let endAngle = startAngle + pts[startIndex + 5];
			var x = cos(startAngle);
			var y = sin(startAngle);
			var minX = x;
			var maxX = x;
			var minY = y;
			var maxY = y;
			x = cos(endAngle);
			y = sin(endAngle);
			minX = min(minX, x);
			maxX = max(maxX, x);
			minY = min(minY, y);
			maxY = max(maxY, y);
			if (startAngle < endAngle) {
				for (var angle = ceil(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle < endAngle; angle += ${Math.PI/2}) {
					x = cos(angle);
					y = sin(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			} else {
				for (var angle = floor(startAngle / ${Math.PI/2}) * ${Math.PI/2}; angle > endAngle; angle -= ${Math.PI/2}) {
					x = cos(angle);
					y = sin(angle);
					minX = min(minX, x);
					maxX = max(maxX, x);
					minY = min(minY, y);
					maxY = max(maxY, y);
				}
			}
			bboxs[coordX].minX = minX * radius + centerX;
			bboxs[coordX].maxX = maxX * radius + centerX;
			bboxs[coordX].minY = minY * radius + centerY;
			bboxs[coordX].maxY = maxY * radius + centerY;
		}
	}

	struct LocalBBox {
		minX: f32,
		maxX: f32,
		minY: f32,
		maxY: f32,
	}
	var<workgroup> localBBoxs: array<LocalBBox, ${t}>;

	fn selectU(a: u32, b: u32, condition: bool) -> u32 {
		return select(a, b, condition);
	}

	fn ceilU(a: u32, b: u32) -> u32 {
		return a / b + selectU(1, 0, a % b == 0);
	}

	fn ceilI(a: i32, b: i32) -> i32 {
		return a / b + select(1, 0, a % b == 0);
	}

	@compute @workgroup_size(${i})
    fn buildBBox(
		@builtin(local_invocation_id) locCoord : vec3<u32>,
        @builtin(workgroup_id) groupId : vec3<u32>,
    ) {
		let bboxStep2 = params.step * 2;
		let bboxNum = arrayLength(&bboxs);
		let groupX = params.groupOffsetX + groupId.x;
		let groupStart = groupX * ${t} * bboxStep2;
		let groupEnd = select(min((groupX + 1) * ${t} * bboxStep2, bboxNum), bboxNum, (groupX + 1) * bboxStep2 >= ${Le(2,32)/t});
		let threadStart = select(groupStart + locCoord.x * bboxStep2, groupEnd, locCoord.x >= ceilU(groupEnd - groupStart, bboxStep2));
		let add = select(${i} * bboxStep2, groupEnd - threadStart, bboxStep2 >= ${Le(2,32)/i});
		for (var i = threadStart; i < groupEnd; i += add) {
			let nextI = i + params.step;
			let localBBoxIndex = (i - groupStart) / bboxStep2;
			if (nextI < groupEnd) {
				localBBoxs[localBBoxIndex].minX = min(bboxs[i].minX, bboxs[nextI].minX);
				localBBoxs[localBBoxIndex].maxX = max(bboxs[i].maxX, bboxs[nextI].maxX);
				localBBoxs[localBBoxIndex].minY = min(bboxs[i].minY, bboxs[nextI].minY);
				localBBoxs[localBBoxIndex].maxY = max(bboxs[i].maxY, bboxs[nextI].maxY);
			} else {
				localBBoxs[localBBoxIndex].minX = bboxs[i].minX;
				localBBoxs[localBBoxIndex].maxX = bboxs[i].maxX;
				localBBoxs[localBBoxIndex].minY = bboxs[i].minY;
				localBBoxs[localBBoxIndex].maxY = bboxs[i].maxY;
			}
		}

		workgroupBarrier();

		let num = ceilU(groupEnd - groupStart, bboxStep2);
		var step: u32 = 1;
		while (step < num) {
			let threadStep = step * ${i*2};
			for (var i = locCoord.x * step * 2 + step; i < num; i += threadStep) {
				let lastI = i - step;
				localBBoxs[lastI].minX = min(localBBoxs[i].minX, localBBoxs[lastI].minX);
				localBBoxs[lastI].maxX = max(localBBoxs[i].maxX, localBBoxs[lastI].maxX);
				localBBoxs[lastI].minY = min(localBBoxs[i].minY, localBBoxs[lastI].minY);
				localBBoxs[lastI].maxY = max(localBBoxs[i].maxY, localBBoxs[lastI].maxY);
			}
			step *= 2;
			workgroupBarrier();
		}

		if (locCoord.x == 0) {
			bboxs[groupStart].minX = localBBoxs[0].minX;
			bboxs[groupStart].maxX = localBBoxs[0].maxX;
			bboxs[groupStart].minY = localBBoxs[0].minY;
			bboxs[groupStart].maxY = localBBoxs[0].maxY;
		}
	}

	@compute @workgroup_size(${i})
    fn calMortonCode(
        @builtin(global_invocation_id) coord : vec3<u32>,
    ) {
		let coordX = params.groupOffsetX * ${i} + coord.x;
		if(coordX >= arrayLength(&bboxs)){
			return;
		}

		setMortonCode(coordX);
	}
	
	
    @binding(5) @group(0) var<storage, read_write> sortedInfoStartIndexs: InfoStartIndexsR;
    @binding(6) @group(0) var<storage, read_write> sortedBBoxs: array<BBox>;
    @binding(7) @group(0) var<storage, read_write> statusArr: array<atomic<u32>>;
    @binding(8) @group(0) var<storage, read_write> counter: atomic<u32>;
	var<workgroup> prefixs: array<u32, ${n}>;
	var<workgroup> groupOrder: u32;

    @binding(9) @group(0) var<storage, read_write> prefixSums : array<u32>;

	fn reduce(locCoordX: u32) -> u32 {
		var step: u32 = 1;
		while(step < ${n}){
			let threadStep = step * ${i*2};
			for(var i = (locCoordX + 1) * step * 2 - 1; i < ${n}; i += threadStep){
				prefixs[i] = prefixs[i - step] + prefixs[i];
			}
			step *= 2;
			workgroupBarrier();
		}
		return step;
	}

	@compute @workgroup_size(${i})
    fn calPrefixSumByBBoxs(
		@builtin(local_invocation_id) locCoord : vec3<u32>,
        @builtin(workgroup_id) groupId : vec3<u32>,
    ) {
		let groupX = params.groupOffsetX + groupId.x;
		let groupStart = groupX * ${n} * 2;
		let threadStart = groupStart + locCoord.x * 2;
		let groupEnd = min((groupX + 1) * ${n} * 2, arrayLength(&bboxs));
		for(var i = threadStart; i < groupEnd; i += ${i*2}){
			prefixs[(i - groupStart) / 2] =
				select((((bboxs[i].mortonCode >> params.shift) & 1) ^ 1) + (((bboxs[i + 1].mortonCode >> params.shift) & 1) ^ 1),
				((bboxs[i].mortonCode >> params.shift) & 1) ^ 1, i + 1 == groupEnd);
		}
		workgroupBarrier();

		reduce(locCoord.x);
		if(locCoord.x == 0){
			prefixSums[groupX] = prefixs[${n-1}];
		}
	}

	@compute @workgroup_size(${i})
    fn calPrefixSumBySums(
		@builtin(local_invocation_id) locCoord : vec3<u32>,
        @builtin(workgroup_id) groupId : vec3<u32>,
    ) {
		let groupX = params.groupOffsetX + groupId.x;
		let step2 = params.step * 2;
		let groupStart = groupX * ${n} * step2;
		let groupEnd = min((groupX + 1) * ${n} * step2, arrayLength(&prefixSums));
		let threadStart = groupStart + locCoord.x * step2;
		for(var i = threadStart; i < groupEnd; i += ${i} * step2){
			let nextI = i + params.step;
			prefixs[(i - groupStart) / step2] = select(prefixSums[i] + prefixSums[nextI], prefixSums[i], nextI >= groupEnd);
		}
		workgroupBarrier();

		reduce(locCoord.x);
		if(locCoord.x == 0){
			prefixSums[groupStart] = prefixs[${n-1}];
		}
	}

	fn prefixScan(locCoordX: u32) -> u32 {
		var step = reduce(locCoordX);

		let aggregate = prefixs[${n-1}];
		if(groupOrder == 0){
			if(locCoordX == 0){
				atomicStore(&statusArr[groupOrder], 0x80000000 | aggregate);
			}
		}else if(locCoordX == 0){
			atomicStore(&statusArr[groupOrder], 0x40000000 | aggregate);
		}
		workgroupBarrier();

		prefixs[${n-1}] = 0;
		workgroupBarrier();

		while(step != 1){
			step /= 2;
			let threadStep = step * ${i*2};
			for(var i = (locCoordX + 1) * step * 2 - 1; i < ${n}; i += threadStep){
				let leftI = i - step;
				let cur = prefixs[i];
				prefixs[i] = cur + prefixs[leftI];
				prefixs[leftI] = cur;
			}
			workgroupBarrier();
		}

		if(groupOrder != 0 && locCoordX == 0){
			var preAggregate: u32 = 0;
			var prevIndex = groupOrder - 1;
			var prevStatus = atomicLoad(&statusArr[prevIndex]);
			while((prevStatus & 0x80000000) == 0){
				if((prevStatus & 0x40000000) != 0){
					preAggregate += (prevStatus & 0x3fffffff);
					prevIndex--;
				}
				prevStatus = atomicLoad(&statusArr[prevIndex]);
			}
			atomicStore(&statusArr[groupOrder], 0x80000000 | (aggregate + preAggregate + (prevStatus & 0x3fffffff)));
		}
		workgroupBarrier();

		return (atomicLoad(&statusArr[groupOrder]) & 0x3fffffff) - aggregate;
	}

	@compute @workgroup_size(${i})
    fn sort(
		@builtin(local_invocation_id) locCoord : vec3<u32>,
    ) {
		if(locCoord.x == 0){
			groupOrder = atomicAdd(&counter, 1);
		}
		workgroupBarrier();

		let groupStart = groupOrder * ${n};
		let threadStart = groupStart + locCoord.x;
		let bboxNum = arrayLength(&bboxs);
		let groupEnd = min((groupOrder + 1) * ${n}, bboxNum);
		for(var i = threadStart; i < groupEnd; i += ${i}){
			prefixs[i - groupStart] = ((bboxs[i].mortonCode >> params.shift) & 1) ^ 1;
		}
		workgroupBarrier();

		let groupExPrefix = prefixScan(locCoord.x);
		for(var i = threadStart; i < groupEnd; i += ${i}){
			let prefix = prefixs[i - groupStart] + groupExPrefix;
			let dstIndex = select(prefixSums[0] + i - prefix, prefix, ((bboxs[i].mortonCode >> params.shift) & 1) == 0);
			sortedBBoxs[dstIndex] = bboxs[i];
			sortedInfoStartIndexs.idStartIndexs[dstIndex] = infoStartIndexs.idStartIndexs[i];
		}
	}

	@compute @workgroup_size(${i})
    fn sortPts(
		@builtin(local_invocation_id) locCoord : vec3<u32>,
    ) {
		if(locCoord.x == 0){
			groupOrder = atomicAdd(&counter, 1);
		}
		workgroupBarrier();

		let groupStart = groupOrder * ${n};
		let threadStart = groupStart + locCoord.x;
		let objNum = arrayLength(&infoStartIndexs.idStartIndexs);
		let groupEnd = min((groupOrder + 1) * ${n}, objNum);
		for(var i = threadStart; i < groupEnd; i += ${i}){
			let startIndex = infoStartIndexs.idStartIndexs[i].startIndex;
			let head = u32(pts[startIndex]);
			let type0 = (head & ${sr}) >> ${dt};
			let addiNum = selectU(1, 0, (head & ${Rt}) == 0) + selectU(1, 0, (head & ${Nt}) == 0);
			if (type0 == ${0}) {
				prefixs[i - groupStart] = ${rn.length} + addiNum;
			} else if (type0 == ${1}) {
				prefixs[i - groupStart] = ${nn.length} + addiNum;
			} else if (type0 == ${2}) {
				prefixs[i - groupStart] = ${tn.length} + addiNum;
			} else if (type0 == ${3}) {
				prefixs[i - groupStart] = ${br.length} + addiNum;
			} else if (type0 == ${4}) {
				prefixs[i - groupStart] = ${sn.length} + addiNum;
			} else if (type0 == ${5}) {
				prefixs[i - groupStart] = ${Xr.length} + addiNum;
			}
		}
		workgroupBarrier();

		let groupExPrefix = prefixScan(locCoord.x);
		for(var i = threadStart; i < groupEnd; i += ${i}){
			let startIndex = infoStartIndexs.idStartIndexs[i].startIndex;
			let head = u32(pts[startIndex]);
			let type0 = (head & ${sr}) >> ${dt};
			var num = selectU(1, 0, (head & ${Rt}) == 0) + selectU(1, 0, (head & ${Nt}) == 0);
			if (type0 == ${0}) {
				num += ${rn.length};
			} else if (type0 == ${1}) {
				num += ${nn.length};
			} else if (type0 == ${2}) {
				num += ${tn.length};
			} else if (type0 == ${3}) {
				num += ${br.length};
			} else if (type0 == ${4}) {
				num += ${sn.length};
			} else if (type0 == ${5}) {
				num += ${Xr.length};
			}

			let prefix = prefixs[i - groupStart] + groupExPrefix;
			for(var j: u32 = 0; j < num; j++){
				sortedPts[prefix + j] = pts[startIndex + j];
			}
			infoStartIndexs.idStartIndexs[i].startIndex = prefix;
		}
	}

	@compute @workgroup_size(${i})
    fn calUnits(
		@builtin(global_invocation_id) coord : vec3<u32>,
    ) {
		let coordX = params.groupOffsetX * ${i} + coord.x;
		let nextI = coordX + 1;
		let bboxNum = arrayLength(&bboxs);
		if(nextI >= bboxNum){
			if(nextI == bboxNum){
				units[bboxs[coordX].mortonCode >> params.shift].bboxEndIndex = nextI;
			}
			return;
		}

		let left = bboxs[coordX].mortonCode >> params.shift;
		let right = bboxs[nextI].mortonCode >> params.shift;
		if(left != right) {
			units[left].bboxEndIndex = nextI;
			units[right].bboxStartIndex = nextI;
		}
	}

	@binding(10) @group(0) var<storage, read_write> groupNodeStartIndexs: array<u32>;
	@binding(13) @group(0) var<storage, read_write> ptIndexs: array<u32>;
	@binding(14) @group(0) var<storage, read_write> ids: array<u32>;

	@compute @workgroup_size(${i})
    fn buildNodesByGroups(
		@builtin(global_invocation_id) coord : vec3<u32>,
	) {
		if(coord.x >=  arrayLength(&units)){
			return;
		}

		let unit = units[coord.x];
		let nodeStartIndex = groupNodeStartIndexs[coord.x * params.maxLevel];
		let idOffset = (nodeStartIndex - groupNodeStartIndexs[0]) * ${e} - unit.bboxStartIndex;
		for(var i = unit.bboxStartIndex; i < unit.bboxEndIndex; i += ${e}){
			var node: Node;
			node.minX = ${wn};
			node.maxX = ${-wn};
			node.minY = ${wn};
			node.maxY = ${-wn};
			let end = min(i + ${e}, unit.bboxEndIndex);
			for(var j = i; j < end; j++){
				let bbox = bboxs[j];
				node.minX = min(node.minX, bbox.minX);
				node.maxX = max(node.maxX, bbox.maxX);
				node.minY = min(node.minY, bbox.minY);
				node.maxY = max(node.maxY, bbox.maxY);
				node.childIndexs[j - i] = -i32(infoStartIndexs.idStartIndexs[j].startIndex) - 1 - params.bboxBaseIndex;
				ptIndexs[infoStartIndexs.idStartIndexs[j].id] = params.shiftedResultId + idOffset + j;
				ids[idOffset + j] = infoStartIndexs.idStartIndexs[j].id;
			}
			nodes[nodeStartIndex + (i - unit.bboxStartIndex) / ${e}] = node;
		}
	
		var nodeNum = ceilU(unit.bboxEndIndex - unit.bboxStartIndex, ${e});
		let end = (coord.x + 1) * params.maxLevel;
		for(var i = coord.x * params.maxLevel + 1; i < end; i++) {
			let nodeStartIndex = groupNodeStartIndexs[i - 1];
			let nodeEndIndex = nodeStartIndex + nodeNum;
			var nodeIndex = i32(groupNodeStartIndexs[i]);
			for(var i = nodeStartIndex; i < nodeEndIndex; i += ${e}){
				var node: Node;
				node.minX = ${wn};
				node.maxX = ${-wn};
				node.minY = ${wn};
				node.maxY = ${-wn};
				let end = min(i + ${e}, nodeEndIndex);
				for(var j = i; j < end; j++){
					let node0 = nodes[j];
					node.minX = min(node.minX, node0.minX);
					node.maxX = max(node.maxX, node0.maxX);
					node.minY = min(node.minY, node0.minY);
					node.maxY = max(node.maxY, node0.maxY);
					node.childIndexs[j - i] = i32(j);
				}
				nodes[nodeIndex] = node;
				nodeIndex++;
			}
			nodeNum = ceilU(nodeNum, ${e});
		}
	}

	@compute @workgroup_size(${i})
    fn buildNodesByNodes(
		@builtin(global_invocation_id) coord : vec3<u32>,
    ) {
		let coordX = params.groupOffsetX * ${i} + coord.x;
		let start = i32(coordX * ${e} + params.srcNodeStartIndex);
		let end = min(start + ${e}, i32(params.srcNodeEndIndex));
		if(end <= start){
			return;
		}

		var node: Node;
		node.minX = ${wn};
		node.maxX = ${-wn};
		node.minY = ${wn};
		node.maxY = ${-wn};
		for(var i = start; i < end; i++){
			let node0 = nodes[i];
			node.minX = min(node.minX, node0.minX);
			node.maxX = max(node.maxX, node0.maxX);
			node.minY = min(node.minY, node0.minY);
			node.maxY = max(node.maxY, node0.maxY);
			node.childIndexs[i - start] = i;
		}
		nodes[coordX + params.dstNodeStartIndex] = node;
	}`;}var f0={};function mF(r,e){if(!f0[e]){let t=r.device.createShaderModule({code:pF(r,e)});f0[e]={buildBBoxs:r.createComputePipeline(t,"buildBBoxs"),buildBBox:r.createComputePipeline(t,"buildBBox"),calMortonCode:r.createComputePipeline(t,"calMortonCode"),calPrefixSumByBBoxs:r.createComputePipeline(t,"calPrefixSumByBBoxs"),calPrefixSumBySums:r.createComputePipeline(t,"calPrefixSumBySums"),sortPts:r.createComputePipeline(t,"sortPts"),sort:r.createComputePipeline(t,"sort"),buildNodesByNodes:r.createComputePipeline(t,"buildNodesByNodes"),calUnits:r.createComputePipeline(t,"calUnits"),buildNodesByGroups:r.createComputePipeline(t,"buildNodesByGroups")};}return f0[e];}var d0,Aw,Cw;function gF(r){if(d0)return;let{bboxNum:e,prefixNum:t}=Ef(r),n=e*2,i=1,s=[];for(;i<Number.MAX_SAFE_INTEGER;)s.push(i),i*=n;d0=r.createStaticBuffer(new Uint32Array(s),GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST);let o=Math.ceil(Number.MAX_SAFE_INTEGER/t/2),a=1,l=[];for(;a<o;)l.push(a),a*=t*2;Aw=r.createStaticBuffer(new Uint32Array(l),GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),Cw=r.createStaticBuffer(new Uint32Array(new Array(1024).fill(0).map((u,c)=>c*r.limits.maxComputeWorkgroupsPerDimension)),GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST);}var _f=class{constructor(e,t,n,i,s,o,a){this.nodeRanges=[];if(this.gpu=t,this.capacity=e,this.clear(),this.ptNum=n,this.infoStartIndexsBuf=i,this.ptsBuf=s,this.ptIndexsBuf=a,this.resultId=o.findEmpty(),this.resultId===-1)throw new Error("this.resultId === -1");o.markUsed(this.resultId),gF(t),this.pipelineDict=mF(t,e);}clear(){var e;this.changed=!0,(e=this.buildedNodesBuf)==null||e.destroy(),delete this.buildedNodesBuf,this.maxLevel=0,delete this.bbox;}getTreeInfo(e){let t=0,n=0;do n++,e=Math.ceil(e/this.capacity),t+=e;while(e>1);return{nodeSum:t,level:n};}build(){return Se(this,null,function*(){var o;if(!this.changed)return{resultId:this.resultId,ptNumsArr:this.ptNumsArr,nodesBuf:this.buildedNodesBuf,maxLevel:this.maxLevel,nodeRanges:this.nodeRanges.slice(),bbox:this.bbox,idsBuf:this.buildedIdsBuf};if(this.changed=!1,(o=this.buildedNodesBuf)==null||o.destroy(),this.bbox=null,this.ptNum===0)throw new Error("this.ptNum === 0");let{gpu:e}=this;yield e.device.queue.onSubmittedWorkDone(),console.time("rtree.build"),this.ptNumsArr=yield Iw(this.gpu,this.infoStartIndexsBuf,this.ptsBuf);let t=Ya+1,n=e.createDynamicBuffer(this.ptNum*t,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),i=e.createDynamicBuffer(14,GPUBufferUsage.UNIFORM|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST),s=e.createDynamicBuffer(1,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST);if(yield this.buildBBoxs(this.ptsBuf,n,this.infoStartIndexsBuf,i),yield this.buildBBox(n,i),this.calMortonCode(n,i),yield this.sort(this.infoStartIndexsBuf,n,this.ptsBuf,i,s),this.ptNum<4e4)throw new Error("this.ptNum < 40000");return yield this.buildGroupedNodes(n,this.infoStartIndexsBuf,i,s),n.destroy(),i.destroy(),s.destroy(),this.infoStartIndexsBuf.setSize(0),yield e.device.queue.onSubmittedWorkDone(),console.timeEnd("rtree.build"),{resultId:this.resultId,ptNumsArr:this.ptNumsArr,nodesBuf:this.buildedNodesBuf,maxLevel:this.maxLevel,nodeRanges:this.nodeRanges.slice(),bbox:this.bbox,idsBuf:this.buildedIdsBuf};});}dispatchWorkgroups(e,t,n,i,s,o=!0){this.gpu.runComputePass(i,t,n,e*this.gpu.limits.maxComputeWorkgroupSizeX,a=>{o&&this.gpu.copyBufferToBuffer(Cw,a,s,10,1,i);});}buildBBoxs(e,t,n,i){return Se(this,null,function*(){let s=this.gpu.device,o=this.gpu.createBindGroup(this.pipelineDict.buildBBoxs.getBindGroupLayout(0),0,e,1,t,4,i,11,n),a=s.createCommandEncoder();this.dispatchWorkgroups(Math.ceil(this.ptNum/this.gpu.limits.maxComputeWorkgroupSizeX),this.pipelineDict.buildBBoxs,o,a,i),s.queue.submit([a.finish()]);});}buildBBox(e,t){return Se(this,null,function*(){let{gpu:n}=this,{device:i}=n,s=n.createDynamicBuffer(e.getSize(),GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),o=i.createCommandEncoder();n.copyBufferToBuffer(e,0,s,0,e.getSize(),o);let a=this.pipelineDict.buildBBox,l=n.createBindGroup(a.getBindGroupLayout(0),1,s,4,t),u=Ef(n).bboxNum*2,c=1,h=0;for(;c<this.ptNum;){n.copyBufferToBuffer(d0,h++,t,4,1,o);let f=Math.ceil(this.ptNum/c);this.dispatchWorkgroups((f%u===1?Math.floor:Math.ceil)(f/u),a,l,o,t),c*=u;}n.submit(o);let d=new Float32Array(yield s.read(0,4));this.bbox=new ye(d[0],d[1],d[2],d[3]),t.write(0,new Float32Array([this.bbox.minX,this.bbox.minY,1/Math.max(this.bbox.maxX-this.bbox.minX,this.bbox.maxY-this.bbox.minY)])),t.write(11,new Float32Array([1/(this.bbox.maxX-this.bbox.minX),1/(this.bbox.maxY-this.bbox.minY)])),s.destroy();});}calMortonCode(e,t){let{device:n}=this.gpu,i=this.pipelineDict.calMortonCode,s=this.gpu.createBindGroup(i.getBindGroupLayout(0),1,e,4,t),o=n.createCommandEncoder();this.dispatchWorkgroups(Math.ceil(this.ptNum/this.gpu.limits.maxComputeWorkgroupSizeX),i,s,o,t),n.queue.submit([o.finish()]);}sort(e,t,n,i,s){return Se(this,null,function*(){let{gpu:o}=this,{device:a}=o,{prefixNum:l}=Ef(o),u=Math.ceil(this.ptNum/l),c=o.createDynamicBuffer(u,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST),h=o.createDynamicBuffer(e.getSize(),e.usage),d=o.createDynamicBuffer(t.getSize(),t.usage),f=o.createDynamicBuffer(Math.ceil(this.ptNum/l/2),GPUBufferUsage.STORAGE),p=o.createBindGroup(this.pipelineDict.calPrefixSumByBBoxs.getBindGroupLayout(0),1,t,4,i,9,f),m=o.createBindGroup(this.pipelineDict.calPrefixSumBySums.getBindGroupLayout(0),4,i,9,f),g=new Array(2).fill("").map((E,P)=>o.createBindGroup(this.pipelineDict.sort.getBindGroupLayout(0),11,P==0?e:h,1,P==0?t:d,4,i,5,P==0?h:e,6,P==0?d:t,7,c,8,s,9,f)),b=30,y=Math.ceil(this.ptNum/l/2),v=a.createCommandEncoder();for(let E=0;E<b;E++){E!==0&&c.clear(v),o.copyBufferToBuffer(o.numBuf,E,i,5,1,v),s.clear(v),this.dispatchWorkgroups(y,this.pipelineDict.calPrefixSumByBBoxs,p,v,i);let P=1,M=0;for(;P<y;)o.copyBufferToBuffer(Aw,M++,i,4,1,v),this.dispatchWorkgroups(Math.ceil(y/(P*=l*2)),this.pipelineDict.calPrefixSumBySums,m,v,i);this.dispatchWorkgroups(u,this.pipelineDict.sort,g[E%2],v,i,!1);}o.submit(v),yield this.sortPts(c,n,e,u,i,s),c.destroy(),f.destroy(),h.destroy(),d.destroy();});}sortPts(e,t,n,i,s,o){return Se(this,null,function*(){if(this.ptNum>2e7)throw new Error("this.ptNum > 20000000");let{gpu:a}=this,l=a.createDynamicBuffer(t.getSize(),t.usage),u=a.device.createCommandEncoder();o.clear(u),e.clear(u);let c=a.createBindGroup(this.pipelineDict.sortPts.getBindGroupLayout(0),0,t,7,e,8,o,11,n,12,l);this.dispatchWorkgroups(i,this.pipelineDict.sortPts,c,u,s,!1),a.submit(u),this.ptsBuf.setDynamicBuffer(l);});}calUnits(e,t){return Se(this,null,function*(){let{gpu:n}=this,{device:i}=n,s=Math.ceil(Math.log2(Math.ceil(this.ptNum/2048))/2)*2,o=30-s;n.writeBuffer(t,5,new Uint32Array([o]));let a=Le(2,s),l=n.createDynamicBuffer(2*a,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE);{let h=n.createBindGroup(this.pipelineDict.calUnits.getBindGroupLayout(0),1,e,3,l,4,t),d=i.createCommandEncoder();this.dispatchWorkgroups(Math.ceil(this.ptNum/n.limits.maxComputeWorkgroupSizeX),this.pipelineDict.calUnits,h,d,t),n.submit(d);}let u=new Uint32Array(yield l.read());l.destroy();let c=[];for(let h=0;h<u.length;h+=2)u[h]!==u[h+1]&&c.push(u[h],u[h+1]);return{units:new Uint32Array(c),unitNum:c.length/2};});}buildNodesByGroups(e,t,n,i,s,o,a,l){let{gpu:u}=this;this.buildedIdsBuf=u.createDynamicBuffer(this.nodeRanges[0].nodeNum*this.capacity,GPUBufferUsage.STORAGE);let c=u.createStaticBuffer(o,GPUBufferUsage.STORAGE);u.writeBuffer(a,13,new Uint32Array([this.resultId<<Pf]));let h=u.device,d=u.createBindGroup(this.pipelineDict.buildNodesByGroups.getBindGroupLayout(0),1,t,2,n,3,i,4,a,10,c,11,s,13,this.ptIndexsBuf,14,this.buildedIdsBuf),f=h.createCommandEncoder();l.clear(f),this.dispatchWorkgroups(Math.ceil(e/u.limits.maxComputeWorkgroupSizeX),this.pipelineDict.buildNodesByGroups,d,f,a,!1),u.submit(f),c.destroy();}buildGroupedNodes(e,t,n,i){return Se(this,null,function*(){let{gpu:s}=this,{units:o,unitNum:a}=yield this.calUnits(e,n),l=s.createDynamicBuffer(o.length,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE);s.writeBuffer(l,0,o);let u=0,c=0,h;this.nodeRanges.length=0;{let b=[];for(let P=0;P<o.length;P+=2){let M=[],I=o[P+1]-o[P],C=0;do C++,I=Math.ceil(I/this.capacity),M.push(I);while(I>1);b.push(M),C>c&&(c=C);}h=new Uint32Array(c*a);let y=1;for(let P=0;P<c;P++){let M=y;for(let I=0;I<a;I++)h[I*c+P]=y,y+=b[I][P]||1;this.nodeRanges.push({startNodeIndex:M,nodeNum:y-M});}let{nodeSum:v,level:E}=this.getTreeInfo(a);u=y-1+v,this.maxLevel=c+E;}s.writeBuffer(n,9,new Uint32Array([c])),this.buildedNodesBuf=s.createDynamicBuffer((this.capacity+Ya)*u,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.VERTEX),this.buildNodesByGroups(a,e,this.buildedNodesBuf,l,t,h,n,i);let d=a,f=h[c-1],p=f+d,m=[];do m.push(f,p,p===u?0:p),d=Math.ceil(d/this.capacity),f=p,p=f+d,this.nodeRanges.push({startNodeIndex:f===u?0:f,nodeNum:d});while(d!==1);let g=s.createDynamicBuffer(m.length,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST);s.writeBuffer(g,0,new Uint32Array(m));{let b=s.createBindGroup(this.pipelineDict.buildNodesByNodes.getBindGroupLayout(0),2,this.buildedNodesBuf,4,n),y=s.device.createCommandEncoder();for(let v=0;v<m.length;v+=3)s.copyBufferToBuffer(g,v,n,6,3,y),this.dispatchWorkgroups(Math.ceil((m[v+1]-m[v])/this.capacity/s.limits.maxComputeWorkgroupSizeX),this.pipelineDict.buildNodesByNodes,b,y,n);s.submit(y);}l.destroy(),g.destroy();});}};function xF(r,e){return`
    struct Uniforms {
        startNodeIndex: u32,
        nodeNum: u32,
    }

    struct Node {
        minX: f32,
        maxX: f32,
        minY: f32,
        maxY: f32,
        childIndexs: array<i32, ${e}>,
    }

	struct IdStartIndex {
		id: u32,
		startIndex: i32,
	}

	struct InfoStartIndexs {
		ptNum: atomic<u32>,
		nextStartIndex: atomic<i32>,
        idStartIndexs: array<IdStartIndex>,
	}

    @binding(0) @group(0) var<uniform> uniforms: Uniforms;
	@binding(1) @group(0) var<storage, read> nodes: array<Node>;
	@binding(2) @group(0) var<storage, read> ids: array<u32>;
	@binding(3) @group(0) var<storage, read> ptsR: array<f32>;
	@binding(4) @group(0) var<storage, read_write> infoStartIndexs: InfoStartIndexs;
	@binding(5) @group(0) var<storage, read_write> pts: array<f32>;
    
    
	@compute @workgroup_size(${r.limits.maxComputeWorkgroupSizeX})
    fn extractInfoStartIndexs(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
        if(coord.x >= uniforms.nodeNum){
            return;
        }

        let childIndexs = nodes[coord.x + uniforms.startNodeIndex].childIndexs;
		let idOffset = coord.x * ${e};
        for(var i: u32 = 0; i < ${e}; i++){
            if(childIndexs[i] < 0) {
				let startIndex = -childIndexs[i] - 1;
				let head = u32(ptsR[startIndex]);
				let type0 = (head & ${sr}) >> ${dt};
				var ptLength = select(1, 0, (head & ${Rt}) == 0) + select(1, 0, (head & ${Nt}) == 0);
				if (type0 == ${0}) {
					ptLength += ${rn.length};
				} else if (type0 == ${1}) {
					ptLength += ${nn.length};
				} else if (type0 == ${2}) {
					ptLength += ${tn.length};
				} else if (type0 == ${3}) {
					ptLength += ${br.length};
				} else if (type0 == ${4}) {
					ptLength += ${sn.length};
				} else if (type0 == ${5}) {
					ptLength += ${Xr.length};
				}
				let index = atomicAdd(&infoStartIndexs.ptNum, 1);
				let startIndex0 = atomicAdd(&infoStartIndexs.nextStartIndex, ptLength);
				infoStartIndexs.idStartIndexs[index].id = ids[idOffset + i];
				infoStartIndexs.idStartIndexs[index].startIndex = startIndex0;
				for(var i = 0; i < ptLength; i++){
					pts[startIndex0 + i] = ptsR[startIndex + i];
				}
            }
        }
    }
    `;}var p0={};function bF(r,e){if(!p0[e]){let t=r.device.createShaderModule({code:xF(r,e)});p0[e]=r.createComputePipeline(t,"extractInfoStartIndexs");}return p0[e];}function Tw(r,e,t,n,i,s,o,a){s.setSize(Ji+a*2),s.write(0,new Uint32Array([0,0]));let l=r.createDynamicBuffer(2,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST);l.write(0,new Uint32Array([n[0].startNodeIndex,n[0].nodeNum]));let u=r.createDynamicBuffer(o.getSize(),o.usage),c=bF(r,i);return r.run(h=>r.runComputePass(h,c,r.createBindGroup(c.getBindGroupLayout(0),0,l,1,e,2,t,3,o,4,s,5,u),n[0].nodeNum)),l.destroy(),o.setDynamicBuffer(u),s.read(0,2).then(h=>{let d=new Uint32Array(h);return s.trim(Ji+d[0]*2),o.trim(d[1]),{ptNum:d[0],nextStartIndex:d[1]};});}function yF(r){return`
	struct Params {
		coordXOffset: u32,
	}

	struct IdStartIndex {
		id: u32,
		startIndex: i32,
	}

	struct InfoStartIndexs {
		ptNum: atomic<u32>,
		nextStartIndex: atomic<i32>,
        idStartIndexs: array<IdStartIndex>,
	}

    @binding(0) @group(0) var<uniform> params: Params;
	@binding(1) @group(0) var<storage, read> ids: array<u32>;
	@binding(2) @group(0) var<storage, read> startIndexs: array<i32>;
	@binding(3) @group(0) var<storage, read> ptsR: array<f32>;
	@binding(4) @group(0) var<storage, read_write> infoStartIndexs: InfoStartIndexs;
	@binding(5) @group(0) var<storage, read_write> pts: array<f32>;

	@compute @workgroup_size(${r.limits.maxComputeWorkgroupSizeX})
    fn addPts(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let index = params.coordXOffset + coord.x;
		if(index >= arrayLength(&ids)){
			return;
		}

		let startIndex = startIndexs[index];
		if(startIndex < 0){
			return;
		}
		let head = u32(ptsR[startIndex]);
		let type0 = (head & ${sr}) >> ${dt};
		var ptLength = select(1, 0, (head & ${Rt}) == 0) + select(1, 0, (head & ${Nt}) == 0);
		if (type0 == ${0}) {
			ptLength += ${rn.length};
		} else if (type0 == ${1}) {
			ptLength += ${nn.length};
		} else if (type0 == ${2}) {
			ptLength += ${tn.length};
		} else if (type0 == ${3}) {
			ptLength += ${br.length};
		} else if (type0 == ${4}) {
			ptLength += ${sn.length};
		} else if (type0 == ${5}) {
			ptLength += ${Xr.length};
		}
		let index0 = atomicAdd(&infoStartIndexs.ptNum, 1);
		let startIndex0 = atomicAdd(&infoStartIndexs.nextStartIndex, ptLength);
		infoStartIndexs.idStartIndexs[index0].id = ids[index];
		infoStartIndexs.idStartIndexs[index0].startIndex = startIndex0;
		for(var i = 0; i < ptLength; i++){
			pts[startIndex0 + i] = ptsR[startIndex + i];
		}
	}
`;}var If;function Rw(r,e,t,n,i,s){If||(If=r.createComputePipeline(r.device.createShaderModule({code:yF(r)}),"addPts"));let o=r.device,a=r.createDynamicBuffer(1,GPUBufferUsage.UNIFORM|GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST),l=r.createBindGroup(If.getBindGroupLayout(0),0,a,1,e,2,t,3,n,4,i,5,s),u=o.createCommandEncoder();return r.runComputePass(u,If,l,e.getSize(),c=>r.copyBufferToBuffer(r.coordXOffsetBuf,c,a,0,1,u)),r.submit(u),a.destroy(),i.read(0,2).then(c=>{let h=new Uint32Array(c);return{ptNum:h[0],nextStartIndex:h[1]};});}var So=class{constructor(e,t,n=null){this.nextStartIndex=0;this.ptNum=0;this.fac=new ke();this.changed=!0;if(this.gpu=e,this.capacity=t,this.parent=n,this.resultIdMap=(n==null?void 0:n.resultIdMap)||new Nn(Le(2,Bf)),this.infoStartIndexsBuf=e.createDynamicBuffer(0,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.ptsBuf=e.createDynamicBuffer(0,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.initBuf(),!n){let i=Le(2,Bf-(32-Sf));for(let s=0;s<i;s++)this.resultIdMap.markUsed(s);}}initBuf(){this.infoStartIndexsBuf.setSize(0),this.ptsBuf.setSize(0),this.nextStartIndex=0,this.ptNum=0;}clear(){if(this.delBuildedResult(),this.parent){this.infoStartIndexsBuf.destroy(),this.ptsBuf.destroy(),this.child1&&(this.child1.clear(),this.child2.clear());return;}this.initBuf(),this.fac.clear(),this.child1&&(this.child1.clear(),this.child2.clear(),delete this.child1,delete this.child2);}isChanged(){return this.changed;}extBuffer(e,t){if(this.ptNum>=e)throw new Error("this.ptNum >= ptNum");this.infoStartIndexsBuf.extSize(Ji+e*2),this.ptsBuf.extSize(t||this.nextStartIndex+(e-this.ptNum)*8);}trimBuffer(){this.infoStartIndexsBuf.trim(Ji+this.ptNum*2),this.ptsBuf.trim(this.nextStartIndex);}ext(e){if(!e)return;let t=this;for(;t;)t.fac.ext1(e),t=t.parent;}extractBufs(){return Se(this,null,function*(){if(!this.buildedResult)return;let{ptNum:e,nextStartIndex:t}=yield Tw(this.gpu,this.buildedResult.nodesBuf,this.buildedResult.idsBuf,this.buildedResult.nodeRanges,this.capacity,this.infoStartIndexsBuf,this.ptsBuf,this.ptNum);this.ptNum=e,this.nextStartIndex=t;});}delBuildedResult(){this.changed=!0,this.buildedResult&&(this.buildedResult.nodesBuf.destroy(),this.buildedResult.idsBuf.destroy(),this.resultIdMap.markRemove(this.buildedResult.resultId),delete this.buildedResult);}split(e=!1){return Se(this,null,function*(){let t=this.gpu;this.child1?(yield this.child1.extractBufs(),yield this.child2.extractBufs()):(this.child1=new So(t,this.capacity,this),this.child2=new So(t,this.capacity,this)),this.child1.extBuffer(Math.min(this.child1.ptNum+this.ptNum,_r)),this.child2.extBuffer(Math.min(this.child2.ptNum+this.ptNum,_r));let[n,i,s]=yield fw(t,this.ptNum,this.infoStartIndexsBuf,this.ptsBuf,this.child1.fac.valid()?this.child1.fac.build():null,this.child1.infoStartIndexsBuf,this.child1.ptsBuf,this.child2.fac.valid()?this.child2.fac.build():null,this.child2.infoStartIndexsBuf,this.child2.ptsBuf);if(!this.child1.fac.valid()&&(i.ptNum===0||s.ptNum===0))throw new Error("!this.child1.fac.valid() && (result1.ptNum === 0 || result2.ptNum === 0)");this.ptNum=n.ptNum,this.nextStartIndex=n.nextStartIndex,this.trimBuffer(),this.child1.ptNum!==i.ptNum&&this.child1.delBuildedResult(),this.child1.buildedResult?this.child1.infoStartIndexsBuf.setSize(0):(this.child1.ext(i.bbox),this.child1.nextStartIndex=i.nextStartIndex,i.ptNum>_r?(this.child1.ptNum=_r,this.child1.infoStartIndexsBuf.write(0,new Uint32Array([_r])),yield this.child1.split()):this.child1.ptNum=i.ptNum,this.child1.trimBuffer()),this.child2.ptNum!==s.ptNum&&this.child2.delBuildedResult(),this.child2.buildedResult?this.child2.infoStartIndexsBuf.setSize(0):(this.child2.ext(s.bbox),this.child2.nextStartIndex=s.nextStartIndex,s.ptNum>_r?(this.child2.ptNum=_r,this.child2.infoStartIndexsBuf.write(0,new Uint32Array([_r])),yield this.child2.split()):this.child2.ptNum=s.ptNum,this.child2.trimBuffer()),e&&this.ptNum!==0&&(yield this.split(e));});}add(e,t,n){return Se(this,null,function*(){yield this.extractBufs(),this.delBuildedResult(),this.extBuffer(this.ptNum+e.getSize(),this.nextStartIndex+n.getSize());let{ptNum:i,nextStartIndex:s}=yield Rw(this.gpu,e,t,n,this.infoStartIndexsBuf,this.ptsBuf);for(this.nextStartIndex=s,this.ptNum=i,this.trimBuffer();this.ptNum>_r;)yield this.split();});}buildIter(e,t,n){return Se(this,null,function*(){this.child1?(this.ptNum&&(yield this.split(!0)),e.push(this.child1),e.push(this.child2)):(this.changed&&(this.changed=!1,this.buildedResult=nm(rm({},yield new _f(this.capacity,this.gpu,this.ptNum,this.infoStartIndexsBuf,this.ptsBuf,this.resultIdMap,n).build()),{ptNum:this.ptNum}),this.ext(this.buildedResult.bbox)),t[this.buildedResult.resultId]=nm(rm({},this.buildedResult),{ptsBuf:this.ptsBuf}));});}build(e){return Se(this,null,function*(){let t=[],n=[],i=this;for(;i;)yield i.buildIter(n,t,e),i=n.pop();return{rtreeIndex:t,bbox:this.fac.build()};});}};var Gn=Math.floor(i0/32/2)*32,qa=class{constructor(e,t){this.ptIndexsArr=[];this.blocks=[];this.noBuildedPtNumsArr=new Uint32Array(6*es);this.gpu=e,this.rtree=new So(this.gpu,t),this.capacity=t,this.nodeUnitNum=Ya+t,this.startIndexsBuf=e.createDynamicBuffer(1,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.ptsBuf=e.createDynamicBuffer(1,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST),this.clear();}initBlock(){this.block={ptOffset:this.blocks.length*Ns,ids:new Uint32Array(4096),startIndexs:new Int32Array(4096),pts:new Float32Array(4096),nextPtIndex:0,nextStartIndex:0,deledIndex:Number.POSITIVE_INFINITY,deledNum:0,idsLengthInBuf:0},this.blocks.push(this.block);}clearNoBuildedData(){this.markUpdate(),this.blocks.length=0,this.initBlock(),this.block.nextPtIndex=1,this.block.startIndexs[0]=-1,this.startIndexsUpdateStartIndex=0,this.startIndexsUpdateEndIndex=1,this.noBuildedPtNumsArr.fill(0),this.startIndexsBuf.setSize(1),this.ptsBuf.setSize(1);}getNoBuildedPtNums(e){return this.noBuildedPtNumsArr.slice(e*6,(e+1)*6);}clear(){this.clearNoBuildedData(),this.ptIndexsArr.length=0,this.ptIndexsArr.push(new Uint32Array(4096)),this.indexMap=new Nn(4096),this.indexMap.markUsed(0),this.rtree.clear();}isChange(){return Number.isFinite(this.startIndexsUpdateStartIndex);}markUpdate(){this.startIndexsUpdateStartIndex=Number.POSITIVE_INFINITY,this.startIndexsUpdateEndIndex=Number.NEGATIVE_INFINITY,this.ptsUpdateStartIndex=Number.POSITIVE_INFINITY,this.ptsUpdateEndIndex=Number.NEGATIVE_INFINITY;}modifyStartIndexsUpdateIndexs(e){this.startIndexsUpdateStartIndex=Math.min(this.startIndexsUpdateStartIndex,e),this.startIndexsUpdateEndIndex=Math.max(this.startIndexsUpdateEndIndex,e+1);}modifyPtsUpdateIndexs(e,t){this.ptsUpdateStartIndex=Math.min(this.ptsUpdateStartIndex,e),this.ptsUpdateEndIndex=Math.max(this.ptsUpdateEndIndex,e+t);}update0(e,t,n,i){!Number.isFinite(n)||(e.getSize()>i?e.trim(i):e.extSize(i),this.gpu.writeBuffer(e,n,t,n,i-n));}update(){if(this.blocks.length!==1)throw new Error("this.blocks.length !== 1");return this.update0(this.startIndexsBuf,this.block.startIndexs,this.startIndexsUpdateStartIndex,this.startIndexsUpdateEndIndex),this.update0(this.ptsBuf,this.block.pts,this.ptsUpdateStartIndex,this.ptsUpdateEndIndex),this.block.idsLengthInBuf=Math.max(this.block.idsLengthInBuf,this.startIndexsUpdateEndIndex),this.markUpdate(),{startIndexsBuf:this.startIndexsBuf,ptsBuf:this.ptsBuf};}addPt(e){let t=this.indexMap.findEmpty();if(t===-1){let s=this.ptIndexsArr[this.ptIndexsArr.length-1];if(s.length===Gn)this.ptIndexsArr.push(new Uint32Array(4096)),this.indexMap=this.indexMap.extSize(this.indexMap.size+4096);else{let o=new Uint32Array(Math.min(s.length*2,Gn));o.set(s),this.ptIndexsArr[this.ptIndexsArr.length-1]=o,this.indexMap=this.indexMap.extSize(this.indexMap.size+o.length-s.length);}t=this.indexMap.findEmpty();}if(this.indexMap.markUsed(t),this.block.nextPtIndex===Ns){this.block.pts=this.block.pts.slice(0,this.block.nextStartIndex);let s=0;for(let o of this.blocks)o.deledNum>s&&(this.block=o,s=o.deledNum);if(s!==0){this.block===this.blocks[0]&&(this.startIndexsUpdateStartIndex=Math.min(this.block.deledIndex,this.startIndexsUpdateStartIndex),this.ptsUpdateStartIndex=Math.min(this.block.deledStartIndex,this.ptsUpdateStartIndex)),this.block.nextPtIndex=this.block.deledIndex,this.block.nextStartIndex=this.block.deledStartIndex,this.block.deledIndex=Number.POSITIVE_INFINITY,this.block.deledNum=0,delete this.block.deledStartIndex;for(let o=this.block.nextPtIndex+1;o<Ns;o++){let a=this.block.startIndexs[o];if(a<0)continue;this.block.ids[this.block.nextPtIndex]=this.block.ids[o],this.block.startIndexs[this.block.nextPtIndex++]=this.block.nextStartIndex;let l=au.getPtLength(this.block.pts,a);this.block.pts.set(this.block.pts.slice(a,a+l),this.block.nextStartIndex),this.block.nextStartIndex+=l;}this.block===this.blocks[0]&&(this.startIndexsUpdateEndIndex=this.block.nextPtIndex,this.ptsUpdateEndIndex=this.block.nextStartIndex);}else this.initBlock();}if(this.block.nextPtIndex===this.block.ids.length){let s=new Uint32Array(Math.min(this.block.nextPtIndex*2,Ns));s.set(this.block.ids),this.block.ids=s;let o=new Int32Array(s.length);o.set(this.block.startIndexs),this.block.startIndexs=o;}let n=this.block.nextPtIndex++;this.block.ids[n]=t,this.ptIndexsArr[Math.floor(t/Gn)][t%Gn]=n+this.block.ptOffset;let i=this.block.nextStartIndex;if(this.block.nextStartIndex+=e.length,this.block.startIndexs[n]=i,i+e.length>this.block.pts.length){let s=new Float32Array(this.block.pts.length*2);s.set(this.block.pts),this.block.pts=s;}return this.block.pts.set(e,i),this.noBuildedPtNumsArr[(e[0]&_o)*6+((e[0]&sr)>>dt)]++,this.block===this.blocks[0]&&(this.modifyStartIndexsUpdateIndexs(n),this.modifyPtsUpdateIndexs(i,e.length)),t;}removePt(e){let t=this.ptIndexsArr[Math.floor(e/Gn)][e%Gn];if(t===0)throw new Error("pt does not exist!");if(this.ptIndexsArr[Math.floor(e/Gn)][e%Gn]=0,this.indexMap.markRemove(e),t>>Sf===0){let n=this.blocks[Math.floor(t/Ns)],i=t%Ns,s=n.startIndexs[i],o=n.pts[s];this.noBuildedPtNumsArr[(o&_o)*6+((o&sr)>>dt)]--,n.startIndexs[i]=-1,n.ids[i]=0,i<n.deledIndex&&(n.deledIndex=i,n.deledStartIndex=s),n.deledNum++,n===this.blocks[0]&&this.modifyStartIndexsUpdateIndexs(t);}else{let n=this.rtreeIndex[t>>Pf],i=t&Mw,s=(n.nodeRanges[0].startNodeIndex+Math.floor(i/this.capacity))*this.nodeUnitNum+Ya+i%this.capacity;return n.nodesBuf.read(s,s+1).then(o=>{n.nodesBuf.write(s,new Uint32Array(1));let a=-new Int32Array(o)[0]-1;return n.ptsBuf.read(a,Math.min(a+sw,n.ptsBuf.getSize())).then(l=>au.getBBox(new Float32Array(l),0));});}}getPtNum(){return this.indexMap.getMarked();}getIdsLengthInBuf(){return this.block.idsLengthInBuf;}needBuild(){return this.blocks.length!==1;}build(){return Se(this,null,function*(){if(this.blocks.length===1)return this.update(),this.noBuildedPtNumsArr;let e;for(let o=this.noBuildedPtNumsArr.length-1;o>=0;o--)if(this.noBuildedPtNumsArr[o]!==0){e=Math.ceil(o/6);break;}let t=new Uint32Array(e);for(let o=0;o<e;o++){let a=(o+1)*6,l=0;for(let u=o*6;u<a;u++)l+=this.noBuildedPtNumsArr[u];t[o]=l;}this.update0(this.startIndexsBuf,this.blocks[0].startIndexs,this.startIndexsUpdateStartIndex,this.startIndexsUpdateEndIndex),this.update0(this.ptsBuf,this.blocks[0].pts,this.ptsUpdateStartIndex,this.ptsUpdateEndIndex);let n=this.gpu.createStaticBuffer(this.blocks[0].ids,GPUBufferUsage.STORAGE);yield this.rtree.add(n,this.startIndexsBuf,this.ptsBuf),n.destroy(),this.startIndexsBuf.setSize(1),this.ptsBuf.setSize(1),delete this.blocks[0];for(let o=1;o<this.blocks.length;o++){let a=this.blocks[o],l=this.gpu.createDynamicBuffer(a.nextPtIndex,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST);l.write(0,a.ids,0,a.nextPtIndex);let u=this.gpu.createDynamicBuffer(a.nextPtIndex,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST);u.write(0,a.startIndexs,0,a.nextPtIndex);let c=this.gpu.createDynamicBuffer(a.nextStartIndex,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST);c.write(0,a.pts,0,a.nextStartIndex),yield this.rtree.add(l,u,c),l.destroy(),u.destroy(),c.destroy(),delete this.blocks[o];}this.clearNoBuildedData();let i=this.gpu.createDynamicBuffer(this.ptIndexsArr.reduce((o,a)=>o+a.length,0),GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST);this.ptIndexsArr.forEach((o,a)=>{i.write(a*Gn,o),delete this.ptIndexsArr[a];});let s=yield this.rtree.build(i);return this.rtreeIndex=s.rtreeIndex,yield Promise.all(new Array(Math.ceil(i.getSize()/Gn)).fill(0).map((o,a)=>i.read(a*Gn,Math.min((a+1)*Gn,i.getSize())).then(l=>this.ptIndexsArr[a]=new Uint32Array(l)))),i.destroy(),Object.assign(s,{});});}};var Af=new pe(-1,1,4),Nw=Af.cross(new pe(0,1,0)).cross(Af).normalize(),m0=2,Lw=16,Bo=class{constructor(e,t,n,i,s,o,a){this.updateFlag=!0;this.changedFromLastRender=!0;this.isOrth=!1;this.needRender=!0;this.target=pe.ORIGIN;this.tar2pos=Af;this.up=Nw;this.scale=1;this.center=pe.ORIGIN;this.radius=1;this.rotatable=!0;this.axisVisible=!1;this.bbox=n,this.axisGroup=i,this.updateSize(e,t),this.id=s,this.messageBus=o,this.isWebGPU=typeof a=="boolean"?a:a instanceof wf;}markChange(){var e;this.updateFlag=!0,this.changedFromLastRender=!0,(e=this.messageBus)==null||e.publish("/engine/camera/update",{id:this.id,scale:this.scale});}setAxisGroup(e){this.axisGroup=e,this.changedFromLastRender=!0;}copy(e=this.bbox){let t=new Bo(0,0,e,this.axisGroup,null,null,this.isWebGPU);return t.width=this.width,t.height=this.height,t.isOrth=this.isOrth,t.target=this.target,t.tar2pos=this.tar2pos,t.up=this.up,t.scale=this.scale,t.center=this.center,t.radius=this.radius,t.rotatable=this.rotatable,t;}isChangedFromLastRender(){return this.changedFromLastRender;}setNeedRender(e){this.needRender=e,this.markChange();}getNeedRender(){return this.needRender;}ableRender(){return this.needRender&&!(this.bbox.width()===0||this.bbox.height()===0||this.bbox.minX>=1||this.bbox.maxX<=-1||this.bbox.minY>=1||this.bbox.maxY<=-1);}rendered(){this.changedFromLastRender=!1;}setObject(e,t){this.center=e,this.radius=t,this.tar2pos=this.tar2pos.normalize().scale(this.getOriginLength()),this.markChange();}setAxisVisible(e){this.axisVisible=e,this.changedFromLastRender=!0;}adjustAxis(){var e,t;(e=this.axisGroup)==null||e.setVisible(this.axisVisible),(t=this.axisGroup)==null||t.setPosition(this.target);}getPostion(){return this.target.add(this.tar2pos);}getZ(){return this.target.z+this.tar2pos.z;}getOriginLength(){return this.radius*m0;}getUp(){return this.up;}getRelativePosition(){return new pe(0,0,this.tar2pos.length());}getTar2Pos(){return this.tar2pos;}setRotatable(e){this.rotatable=e;}setCameraDirect(e){this.tar2pos=new pe(0,0,e?this.getOriginLength():-this.getOriginLength()),this.up=new pe(0,1,0),this.markChange();}isOrthCamera(){return this.isOrth;}getBorderZ(e){return this.isOrth?this.scale>e?-1:2:(m0-1)/(m0*(this.scale/e));}setCameraType(e){this.isOrth=e,this.markChange();}getTarget(){return this.target;}setTarget(e){this.target=e,this.markChange();}reset(){this.rotatable&&(this.tar2pos=Af.normalize().scale(this.getOriginLength())),this.target=this.center,this.up=Nw,this.scale=1,this.markChange();}rotateH(e){if(!this.rotatable)return;let t=this.up.scale(-1);this.tar2pos=this.tar2pos.rotate(t,e).normalize().scale(this.getOriginLength()),this.markChange();}rotateV(e){if(!this.rotatable)return;let t=this.tar2pos.cross(this.up);this.up=this.up.rotate(t,e).normalize(),this.tar2pos=this.tar2pos.rotate(t,e).normalize().scale(this.getOriginLength()),this.markChange();}rotateP(e){!this.rotatable||(this.up=this.up.rotate(this.tar2pos,e).normalize(),this.markChange());}rotateZTo(e){let t=this.rotatable;this.rotatable=!0,this.up=new pe(0,1,0),this.rotateP(e),this.rotatable=t,this.markChange();}rotateTo(e){let t=this.rotatable;this.rotatable=!0,this.up=new pe(0,0,1),this.tar2pos=new pe(0,-this.getOriginLength(),0),this.rotateH(e.x),this.rotateV(e.y),this.rotateP(e.z),this.rotatable=t,this.markChange();}updateSize(e,t){this.width=e*this.bbox.width()/2,this.height=t*this.bbox.height()/2,this.markChange();}getWidth(){return this.width;}getHeight(){return this.height;}addOffset(e){let t=this.tar2pos.normalize(),n=this.up.cross(t).normalize(),i=t.cross(n).normalize();this.target=this.target.add(n.scale(e.x).add(i.scale(e.y)).add(t.scale(e.z))),this.markChange();}scaleAtPoint(e,t,n){t=(t-this.bbox.minX)/this.bbox.width()*2-1,n=(n-this.bbox.minY)/this.bbox.height()*2-1;let i=this.tar2pos.normalize(),s=this.up.cross(i).normalize(),o=i.cross(s).normalize(),a=s.scale(t*this.width/2/this.scale).add(o.scale(n*this.height/2/this.scale));this.scale=this.scale*e;let l=s.scale(t*this.width/2/this.scale).add(o.scale(n*this.height/2/this.scale));this.target=this.target.add(a).sub(l),this.markChange();}setScale(e){this.scale=e,this.markChange();}getScale(){return this.scale;}getViewMatrix(){return this.update(),this.viewMatrix;}getProjectMatrix(){return this.update(),this.projectMatrix;}getRenderMatrix(){return this.update(),this.renderMatrix;}is2D(){return!this.rotatable&&this.isOrth&&this.tar2pos.x===0&&this.tar2pos.y===0;}getOffsetXY(e,t){let n=this.tar2pos,i=this.up.rotate(n,-Math.PI/2).normalize().scale(e);if(i=i.add(this.up.normalize().scale(t)),i.z!==0&&n.z!==0){let s=n.z/i.z;i=i.add(n.scale(-1/s));}return new F(i.x,i.y);}updateViewMatrix(){let e=this.tar2pos.normalize(),t=this.up.cross(e).normalize(),n=e.cross(t).normalize(),i;if(this.isOrth){let s=this.tar2pos.normalize().scale(this.tar2pos.length()-(this.getOriginLength()-this.radius)-this.radius*Lw*(this.isWebGPU?2:1));i=this.target.add(s);}else i=this.target.add(this.tar2pos);this.viewMatrix=new Je([t.x,t.y,t.z,0,n.x,n.y,n.z,0,e.x,e.y,e.z,0,i.x,i.y,i.z,1]).getInverseMatrix();}getPxLength(){return 1/this.scale;}updateProjectMatrix(){this.isOrth?this.projectMatrix=new Je([2/this.width*this.scale,0,0,0,0,2/this.height*this.scale,0,0,0,0,(this.isWebGPU?.5:-1)/this.radius/Lw,0,0,0,0,1]):this.projectMatrix=new Je([2*this.getOriginLength()*this.scale/this.width,0,0,0,0,2*this.getOriginLength()*this.scale/this.height,0,0,0,0,0,-1,0,0,(this.isWebGPU?1:-1)*(this.getOriginLength()-this.radius),0]);}update(){this.updateFlag&&(this.updateViewMatrix(),this.updateProjectMatrix(),this.renderMatrix=this.viewMatrix.multiply4(this.projectMatrix),this.updateInvMatrix(),this.updateFlag=!1);}adapt(e){if(!e)return[0,0,0,0];this.setTarget(e.center());let t=this.getRenderMatrix(),n=e.getVertexes().map(c=>c.multiply4(t)),i=new ke();for(let c of n)i.ext6(c.x,c.y);let s=i.build(),o=1/Math.max(-s.minX,s.maxX,-s.minY,s.maxY);this.setScale(this.getScale()*o),s=new ye(s.minX*o,s.maxX*o,s.minY*o,s.maxY*o);let a=this.bbox.width()/2*this.width,l=this.bbox.height()/2*this.height,u=s.center();return[u.x*a/2,u.y*l/2,a*s.width()/2,l*s.height()/2];}updateInvMatrix(){let e=this.tar2pos.normalize(),t=this.up.cross(e).normalize(),n=e.cross(t).normalize(),i=this.getPostion();this.invMatrix=Je.translate(-this.width/2,-this.height/2,0).multiply4(Je.flipX()).scale((this.isOrth?1:(this.getOriginLength()-this.radius)/this.getOriginLength())/this.scale).translate1(0,0,this.isOrth?this.radius:this.radius-this.getOriginLength()).multiply4(new Je([t.x,t.y,t.z,0,n.x,n.y,n.z,0,e.x,e.y,e.z,0,i.x,i.y,i.z,1]));}getInverseMatrix(){return this.update(),this.invMatrix;}};var Ie=class{static regular(e){return Math.round(e*this.precision)/this.precision;}static eq(e,t){return Math.abs(e-t)<=this.eps;}static neq(e,t){return Math.abs(e-t)>this.eps;}static less(e,t){return e-t<-this.eps;}static lesseq(e,t){return e-t<this.eps;}static greater(e,t){return e-t>this.eps;}static greatereq(e,t){return e-t>-this.eps;}static sqrt(e){return Math.abs(e)<=1e-10?0:Math.sqrt(e);}static sortAsc(e,t){return e-t;}static sortDesc(e,t){return t-e;}};Ie.eps=1e-8,Ie.precision=1e8;var Cf=class{constructor(e,t,n,i,s,o){this.length=9;this.scene=e,this.data=this.create(t,n,i,s,o);}create(e,t,n,i,s){return[e+(7<<dt),t.x,t.y,n.x,n.y,i.x,i.y,s.x,s.y];}get ldPoint(){return new F(this.data[1],this.data[2]);}get luPoint(){return new F(this.data[3],this.data[4]);}get rdPoint(){return new F(this.data[5],this.data[6]);}get ruPoint(){return new F(this.data[7],this.data[8]);}getBaseBBox(){return ye.extend3(this.luPoint,this.rdPoint);}getBBox(e,t){return new ye(e[t+1],e[t+7],e[t+2],e[t+8]);}setTexture(e){return Se(this,null,function*(){yield this.setImageSource(e);});}setImageSource(e){return Se(this,null,function*(){let t=this.scene.gpu.device,n=yield createImageBitmap(e),i=t.createTexture({size:[n.width,n.height,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});t.queue.copyExternalImageToTexture({source:n},{texture:i},[n.width,n.height]),this.gpuTexture=i;});}};function wF(r){return`
    struct Uniforms {
		coordXOffset: u32,
        width: u32,
        num: u32,
        extWidth: u32,
        offsetX: u32,
        offsetY: u32,
    }

    @binding(0) @group(0) var<uniform> uniforms: Uniforms;
    @binding(1) @group(0) var<storage, read> pBufR: array<u32>;
    @binding(2) @group(0) var<storage, read_write> pBuf: array<u32>;

    @compute @workgroup_size(${r.limits.maxComputeWorkgroupSizeX})
    fn extPBuf(
        @builtin(global_invocation_id) coord : vec3<u32>
    ) {
		let index = uniforms.coordXOffset + coord.x;
		if(index >= uniforms.num){
			return;
		}

        let y = index / uniforms.width;
        let x = index - y * uniforms.width;
        pBuf[(y + uniforms.offsetY) * uniforms.extWidth + x + uniforms.offsetX] = pBufR[y * uniforms.width + x];
	}
`;}var Mf;function Ow(r,e,t,n,i,s,o){Mf||(Mf=r.createComputePipeline(r.device.createShaderModule({code:wF(r)}),"extPBuf"));let a=r.createStaticBuffer(new Uint32Array([0,t/32,e.getSize(),n/32,s/32,o]),GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),l=r.createDynamicBuffer(n*i/32,e.usage),u=r.createBindGroup(Mf.getBindGroupLayout(0),0,a,1,e,2,l),c=r.device.createCommandEncoder();r.runComputePass(c,Mf,u,e.getSize(),h=>r.copyBufferToBuffer(r.coordXOffsetBuf,h,a,0,1,c)),r.submit(c),a.destroy(),e.setDynamicBuffer(l);}function ks(r){for(let e=0;e<lu;e++)for(let t=0;t<Hh;t++)r(e*uu,t*Kh);}var za=class extends Ps{constructor(t,n,i,s=null,o=null,a){super(i,s,o);this.bboxFac2=new ke();this._isEmpty=!0;this.hasColorfulPt=!1;this.textures=[];this.interPlanes=[this];this.subPlanes=[];this.ptNum=0;this.getOrInitId=this.initId;this.scene=t,this._isNormal=a,this.builder=a?t.normalBuilder:new qa(t.gpu,n),this.pBufInfo={changedFac:new ke()};}initId(){return this._id=this.scene.getPlaneId(),this.setEmpty(!1),this._id;}getId(){if(this._id===void 0)throw new Error("this._id === undefined");return this._id;}isNormal(){return this._isNormal;}updateMatrixs(t){if(super.updateMatrixs(t),!!this._isNormal)for(let n of t.values()){let i=pe.ORIGIN.multiply4(n),s=new pe(1,0,0).multiply4(n),o=new pe(0,1,0).multiply4(n);if(i.x!==0||i.y!==0||s.x!==1||s.y!==0||o.x!==0||o.y!==1)throw new Error("oP.x !== 0 || oP.y !== 0 || xP.x !== 1 || xP.y !== 0 || yP.x !== 0 || yP.y !== 1");}}addPt(t,n){let i=au.getBBox(t,0);if(this.bboxFac2.ext1(i),this.pBufInfo.changedFac.ext1(i),!this.hasColorfulPt&&n){this.hasColorfulPt=!0;let{scene:o}=this;if(this.pBufInfo.texture=new Dn(o.gpu,this.pBufInfo.width||1,this.pBufInfo.height||1,"rgba8unorm",GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC),this.pBufInfo.buf){let{width:a,height:l,bbox:u,bindGroup:c}=this.pBufInfo,h=new Bo(a,l,new ye(-1,1,-1,1),new We(),"",null,!0);h.setCameraType(!0),h.setCameraDirect(!0),h.adapt(new gn(u.minX,u.minY,0,u.maxX,u.maxY,0)),o.updateCameraBuf(h),o.resize(a,l),o.initCommandEncoder(),o.renderBitBufferProgram.draw(Je.ORIGIN,h,this,this,0,a,l,o.texPxLength,u,o.texScale,c.getBindGroup(),"render"),o.commandEncoder.copyTextureToTexture({texture:o.planeProgram.colorTexture.texture},{texture:this.pBufInfo.texture.texture},{width:a,height:l}),o.submitCommandEncoder(),o.resize(),c.destroy(),this.pBufInfo.buf.destroy(),delete this.pBufInfo.buf;}this.pBufInfo.bindGroup=o.renderTexProgram.createDynamicBindGroup(this.pBufInfo.texture);}let s=this.builder.addPt(t);return this._isNormal&&this.scene.addNormalPlane(this),this.ptNum++,s;}removePt(t){let n=this.builder.removePt(t);if(--this.ptNum===0&&this.setEmpty(!0),!(n instanceof Promise))return n;if(!this._isNormal)throw new Error("not support");this.scene.removingPtNum++,n.then(i=>{this.scene.removingPtNum--,this.pBufInfo.changedFac.ext1(i);});}clearPBuf(){var t,n;delete this.pBufInfo.bbox,delete this.pBufInfo.width,delete this.pBufInfo.height,(t=this.pBufInfo.buf)==null||t.setSize(1),(n=this.pBufInfo.texture)==null||n.updateSize(1,1),this.pBufInfo.changedFac.ext1(this.bboxFac2.build());}updatePBuf(){let{scene:t}=this,{changedFac:n}=this.pBufInfo;if(!n.valid())return;let i=n.build();n.clear(),i=new ye(i.minX-t.texPxLength,i.maxX+t.texPxLength,i.minY-t.texPxLength,i.maxY+t.texPxLength),!this.pBufInfo.texture&&!this.pBufInfo.buf&&(this.pBufInfo.buf=t.gpu.createDynamicBuffer(1,GPUBufferUsage.COPY_SRC|GPUBufferUsage.STORAGE),this.pBufInfo.bindGroup=t.renderBitBufferProgram.createDynamicBindGroup(this.pBufInfo.buf));let{buf:s,texture:o}=this.pBufInfo;if(this.pBufInfo.bbox){if(!this.pBufInfo.bbox.isContainsBBox1(i)){let{bbox:h,width:d,height:f}=this.pBufInfo,p=Math.ceil(Math.max(h.minX-i.minX,0)/t.texPxLength/32)*32,m=Math.ceil(Math.max(i.maxY-h.maxY,0)/t.texPxLength),g=Math.max(Math.ceil((i.maxX-h.minX)/t.texPxLength/32)*32,d),b=Math.max(Math.ceil((h.maxY-i.minY)/t.texPxLength),f);this.pBufInfo.width=g+p,this.pBufInfo.height=b+m,this.pBufInfo.bbox=new ye(h.minX-p*t.texPxLength,h.minX+g*t.texPxLength,h.maxY-b*t.texPxLength,h.maxY+m*t.texPxLength),s&&Ow(t.gpu,s,d,g+p,b+m,p,m),o==null||o.extSize(p,m,g-d,b-f),t.logAllTexSize();}let{bbox:c}=this.pBufInfo;i=new ye(Math.max(c.minX,c.minX+Math.floor((i.minX-c.minX)/t.texPxLength/32)*32*t.texPxLength),Math.min(c.maxX,c.minX+Math.ceil((i.maxX-c.minX)/t.texPxLength/32)*32*t.texPxLength),Math.max(c.minY,c.maxY+Math.floor((i.minY-c.maxY)/t.texPxLength)*t.texPxLength),Math.min(c.maxY,c.maxY+Math.ceil((i.maxY-c.maxY)/t.texPxLength)*t.texPxLength));}else{let c=Math.ceil(i.width()/t.texPxLength/32)*32,h=Math.ceil(i.height()/t.texPxLength);i=new ye(i.minX,i.minX+c*t.texPxLength,i.minY,i.minY+h*t.texPxLength),this.pBufInfo.width=c,this.pBufInfo.height=h,this.pBufInfo.bbox=i,s==null||s.setSize(c*h/32),o==null||o.updateSize(c,h),t.logAllTexSize();}let{width:a,bbox:l}=this.pBufInfo,u=new Bo(Math.round(i.width()/t.texPxLength),Math.round(i.height()/t.texPxLength),new ye(-1,1,-1,1),new We(),"",null,!0);u.setCameraType(!0),u.setCameraDirect(!0),u.adapt(new gn(i.minX,i.minY,0,i.maxX,i.maxY,0)),t.resize(u.getWidth(),u.getHeight()),t.renderNormalPlanesTest(u,[this],()=>{s?t.extractBitBufferProgram.extract(t.depthTexture.view,s,a,Math.round((i.minX-l.minX)/t.texPxLength),Math.round((l.maxY-i.maxY)/t.texPxLength),t.colorTexture.width,t.colorTexture.height):t.commandEncoder.copyTextureToTexture({texture:t.planeProgram.colorTexture.texture},{texture:o.texture,origin:{x:Math.round((i.minX-l.minX)/t.texPxLength),y:Math.round((l.maxY-i.maxY)/t.texPxLength)}},t.planeProgram.colorTexture);});}createLine(t,n,i,s,o){return ks((a,l)=>{this.addPt(nn.create(this.getOrInitId(),t.add1(a,l),n.add1(a,l),i,o,this.scene.getColorIndex(s)),s);}),0;}createArc(t,n,i,s,o,a,l){return s=at.toRadians(s),o=at.toRadians(o),o<0&&(s=s+o,o=-o),s%=ir,s<0&&(s+=ir),ks((u,c)=>{this.addPt(tn.create(this.getOrInitId(),t.add1(u,c),n,i,s,o,l,this.scene.getColorIndex(a)),a);}),0;}createCircle(t,n,i,s){return ks((o,a)=>{this.addPt(rn.create(this.getOrInitId(),t.add1(o,a),n,s,this.scene.getColorIndex(i)),i);}),0;}createPolygon(t,n,i,s){let o=[];for(let u of t){let c=[],h,d,f,p,m,g,b=()=>{if(!!h){if(p>0)for(let P=0;P<p;P+=360)ks((M,I)=>{this.addPt(Xr.create(this.getOrInitId(),h.add1(M,I),d,at.toRadians(f+P),at.toRadians(Math.min(p-P,360)),s,this.scene.getColorIndex(i)),i);});else for(let P=0;P>p;P-=360)ks((M,I)=>{this.addPt(Xr.create(this.getOrInitId(),h.add1(M,I),d,at.toRadians(f+P),at.toRadians(Math.max(p-P,-360)),s,this.scene.getColorIndex(i)),i);});m.equals1(g)||c.push(new q(m,g)),h=null;}};if(u.primitives.forEach(P=>{if(P instanceof ee&&P.rx===P.ry){if(h){if(d===P.rx&&h.equals1(P.center)&&Ie.eq(at.regularD(f+p),at.regularD(P.startAngle))){p+=P.sweepAngle,g=P.end();return;}b();}h=P.center,d=P.rx,f=P.startAngle,p=P.sweepAngle,m=P.start(),g=P.end();}else b(),c.push(P);}),b(),c.length===0)continue;let y=[];for(Me.build2(c).points2(n,P=>y.push(P));y.length!==0&&y[0].equals1(y[y.length-1]);)y.pop();if(y.length<3)continue;let v=y[0],E=[v];for(let P=1;P<y.length;P++){let M=y[P];v.equals1(M)||(E.push(M),v=M);}E.length>=3&&o.push(E);}for(let u of o){let c=u.slice();for(let h=0;h<c.length-2;h+=2)ks((d,f)=>{this.addPt(br.create(this.getOrInitId(),c[h].add1(d,f),c[h+1].add1(d,f),c[h+2].add1(d,f),s,this.scene.getColorIndex(i)),i);}),c.push(c[h]);}let a=new ke();t.forEach(u=>a.ext1(u.bbox()));let l=a.build();return this.bboxFac2.ext5(l.minX,l.maxX+(lu-1)*uu,l.minY,l.maxY+(Hh-1)*Kh),[0];}createRect(t,n,i){return ks((s,o)=>{this.addPt(sn.create(this.getOrInitId(),t.leftUpPoint.add1(s,o),t.width,t.height,t.angle,t.isCCW,t.radius,i,this.scene.getColorIndex(n)),n);}),0;}createTexture(t,n,i,s,o,a,l){let u=null;ks((h,d)=>{u=new Cf(this.scene,this.getOrInitId(),t.add1(h,d),n.add1(h,d),i.add1(h,d),s.add1(h,d));}),this.textures.push(u);let c=u.getBaseBBox();return this.bboxFac2.ext1(c),u;}setRenderProcess(t=[this],n=[]){this.interPlanes=t.filter(i=>i),this.subPlanes=n.filter(i=>i&&!i.isEmpty());}getPxLength(t,n){let i;if(t.isOrthCamera())i=t.getPxLength();else{let s=this.getBBox(),a=(s?s.center():t.getTarget()).multiply4(n),l=t.getTarget().sub(a).dot(t.getTar2Pos().normalize());i=t.getPxLength()*(l/t.getTar2Pos().length()+1);}return i*=2,i;}setPolygonAbleInter(t){}isEmpty(){return this._isEmpty;}getBBox2(){return this.bboxFac2.valid()?this.bboxFac2.build():null;}addPart(t,n){}sortTransparentObjs(){}setEmpty(t){var n,i,s;if(this._isEmpty=t,t){if(this.bboxFac2.clear(),this.scene.delNormalPlane(this),this.hasColorfulPt=!1,this._id===void 0)return;this.scene.releasePlaneId(this._id),delete this._id,this.getOrInitId=this.initId,(n=this.pBufInfo.bindGroup)==null||n.destroy(),delete this.pBufInfo.bindGroup,(i=this.pBufInfo.texture)==null||i.destroy(),delete this.pBufInfo.texture,(s=this.pBufInfo.buf)==null||s.destroy(),delete this.pBufInfo.buf,delete this.pBufInfo.width,delete this.pBufInfo.height,delete this.pBufInfo.bbox;}else this._isNormal&&this.scene.addNormalPlane(this),this.getOrInitId=()=>this._id;}clear(){this.builder.clear(),this.ptNum=0,this.setEmpty(!0);}getBBox(){try{let t=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(let o of this.interPlanes){if(o.isEmpty())continue;let a=o.getBBox2();a&&(t=Math.max(a.minX,t),i=Math.min(a.maxX,i),n=Math.max(a.minY,n),s=Math.min(a.maxY,s));}return new gn(t,n,0,i,s,0);}catch(t){return null;}}drawSelf(t,n,i,s,o){if(this.isEmpty())return;if(this._isNormal){this.scene.renderNormalPlane(this,n,i,s,o);return;}if(this.builder.isChange()){let{startIndexsBuf:l,ptsBuf:u}=this.builder.update(),c=this.scene.gpu.getTempBuf(this.builder.getIdsLengthInBuf());this.filterBindGroup=this.scene.filterPtProgram.createBindGroup(u,l,c),this.renderBindGroup=this.scene.renderPtProgram.createBindGroup(u,c),console.log(`ptNum of ${this.className} plane:`,this.builder.getPtNum());}let a=[];a[this.getId()]=[n],this.scene.filterPtRender(t,i,s,this.builder.getNoBuildedPtNums(this.getId()),this.filterBindGroup,this.renderBindGroup,this.builder.getIdsLengthInBuf(),a,this,o);}draw(t,n,i){this.subPlanes.forEach(s=>s.drawSelf(t,n,this,0,"drawNotPassStencil"));for(let s=1;s<this.interPlanes.length;s++)this.interPlanes[s].drawSelf(t,n,this,0,"drawInterStencil");this.interPlanes[0].drawSelf(t,n,this,i,"render"),this.isColorful&&this.textures.forEach(s=>{this.scene.textureProgram.render({matrix:n,texture:s});});}};var We=class{constructor(e=2,t=!1){this.outSelfMatrixVisibleMap=new Map();this.contents=new Set();this.position=pe.ORIGIN;this.scale=new pe(1,1,1);this.rotation=pe.ORIGIN;this.addiMatrix=Je.ORIGIN;this.updateFlag=!1;this.visible=!0;this.hidden=!1;this.selfMatrix=this.addiMatrix;this.renderMode=e,t&&this.outSelfMatrixVisibleMap.set(Je.ORIGIN,[new Je(),!0]);}static clone(e,t){let n=new We();return n.setPosition(e.position),n.setScale(e.scale),n.setRotation(e.rotation),n.setAddiMatrix(e.addiMatrix),n.setRenderMode(e.renderMode),n.setVisible(e.visible),n.setHidden(e.hidden),(t||e.contents).forEach(i=>n.add(i)),n;}setRenderMode(e){this.renderMode=e;}isEmpty(){for(let e of this.contents)if(e instanceof We){if(!e.isEmpty())return!1;}else return!1;return!0;}setOutMatrixVisible(e,t){let n=this.outSelfMatrixVisibleMap.get(t);n[1]=e,e=e&&this.visible;for(let i of this.contents)i.setOutMatrixVisible(e,n[0]);}setVisible(e){if(e!==this.visible){this.visible=e;for(let t of this.outSelfMatrixVisibleMap.values()){let n=t[1]&&this.visible;for(let i of this.contents)i.setOutMatrixVisible(n,t[0]);}}}setMeshAlpha(e){Array.from(this.contents).forEach(t=>{if(t instanceof We){let n=We.clone(t);this.add(n),this.remove(t),n.setMeshAlpha(e);}else t instanceof Et&&t.getMaterial()&&t.getMaterial().alpha!=e&&(this.add(new Et(t.elements,t.getColor(),new yn(t.getMaterial().ambient,t.getMaterial().diffuse,t.getMaterial().specular,t.getMaterial().shininess,e),t.className)),this.remove(t));});}getVisible(){return this.visible;}setHidden(e){this.hidden=e;}getPosition(){return this.position;}getContents(){return this.contents;}setPosition(e){return this.position=e,this.updateFlag=!0,this;}getScale(){return this.scale;}setScale(e){return this.scale=e,this.updateFlag=!0,this;}getRotation(){return this.rotation;}setRotation(e){return this.rotation=e,this.updateFlag=!0,this;}getAddiMatrix(){return this.addiMatrix;}setAddiMatrix(e){return this.addiMatrix=e,this.updateFlag=!0,this;}getMatrix(){return this.updateFlag&&(this.selfMatrix=Je.ORIGIN.rotateZ(this.rotation.z).rotateX(this.rotation.x).rotateY(this.rotation.y).scale(this.scale.x,this.scale.y,this.scale.z).translate(this.position).multiply4(this.addiMatrix),this.updateFlag=!1,this.update()),this.selfMatrix;}getSelfAsOutToChildMatrix(){let e=[];for(let t of this.outSelfMatrixVisibleMap.values())e.push(t[0]);return e;}add(e){this.contents.add(e);let t=new Map();for(let n of this.outSelfMatrixVisibleMap.values())t.set(new Je(),n[0]);e.updateMatrixs(t);for(let n of this.outSelfMatrixVisibleMap.values())e.setOutMatrixVisible(this.visible&&n[1],n[0]);return e;}remove(e){if(!this.contents.has(e))return;this.contents.delete(e);let t=new Array();for(let n of this.outSelfMatrixVisibleMap.values())t.push(n[0]);e.removeOutMatrixs(t);}removeOutMatrixs(e){let t=new Array();for(let n of e)t.push(this.outSelfMatrixVisibleMap.get(n)[0]),this.outSelfMatrixVisibleMap.delete(n);for(let n of this.contents)n.removeOutMatrixs(t);}clear(){let e=new Array();for(let t of this.outSelfMatrixVisibleMap.values())e.push(t[0]);for(let t of this.contents)t.removeOutMatrixs(e);this.contents.clear();}getBBox(e=!1){if(this.hidden||e&&!this.visible)return null;let t=this.getMatrix(),n=new kr();for(let i of this.contents){let s=i.getBBox(e);s&&n.ext4(s.transform(t));}return n.isValid()?n.build():null;}updateMatrixs(e){let t=new Map();for(let n of e.entries()){let i=this.getMatrix().multiply4(n[1]),s=!0,o=this.outSelfMatrixVisibleMap.get(n[0]);o?(s=o[1],t.set(o[0],i),this.outSelfMatrixVisibleMap.delete(n[0])):t.set(new Je(),i),this.outSelfMatrixVisibleMap.set(n[1],[i,s]);}for(let n of this.contents)n.updateMatrixs(t);}setSingleColor(e,t=null){if(t){let n=this.outSelfMatrixVisibleMap.get(t)[0];for(let i of this.contents)i.setSingleColor(e,n);}else for(let n of this.contents)for(let i of this.outSelfMatrixVisibleMap.values())n.setSingleColor(e,i[0]);}update(){let e=new Map();for(let t of this.outSelfMatrixVisibleMap.keys())e.set(t,t);this.updateMatrixs(e);}preDraw(){if(!!this.visible){this.getMatrix();for(let e of this.contents)e.preDraw();}}getPlaneGLMatrixRenderModes(e=2,t=Je.ORIGIN){if(!this.visible)return[];e!==3&&this.renderMode!==2&&(e=this.renderMode);let n=this.outSelfMatrixVisibleMap.get(t)[0],i=[];for(let s of this.contents)if(s instanceof We)for(let o of s.getPlaneGLMatrixRenderModes(e,n))i.push(o);else s instanceof Vh&&i.push([s,n,e]);return i;}getPlaneGPUMatrixRenderModes(e=2,t=Je.ORIGIN){if(!this.visible)return[];e!==3&&this.renderMode!==2&&(e=this.renderMode);let n=this.outSelfMatrixVisibleMap.get(t)[0],i=[];for(let s of this.contents)if(s instanceof We)for(let o of s.getPlaneGPUMatrixRenderModes(e,n))i.push(o);else s instanceof za&&i.push([s,n,e]);return i;}getMeshMap(e=2,t=Je.ORIGIN){let n=new Map();if(!this.visible)return n;e!==3&&this.renderMode!==2&&(e=this.renderMode);let i=this.outSelfMatrixVisibleMap.get(t)[0];for(let s of this.contents)if(s instanceof We)for(let o of s.getMeshMap(e,i).entries()){let a=n.get(o[0]);a||(a=[],n.set(o[0],a)),o[1].forEach(l=>a.push(l));}else if(s instanceof Et){let o=n.get(s);o||(o=[],n.set(s,o)),o.push({matrix:i,renderMode:e,color:e===0?s.getColor():e===3?s.getSingleColor(i):null});}return n;}clearCaled(){this.contents.forEach(e=>{e instanceof We?e.clearCaled():e instanceof Et&&delete e.caled;});}calMeshMemory(e=!0){let t=0;return this.contents.forEach(n=>{var i,s;n instanceof We?t+=n.calMeshMemory(!1):n instanceof Et&&!n.caled&&(t+=(((i=n.elements.vertexes)==null?void 0:i.length)||0)*4,t+=(((s=n.elements.normals)==null?void 0:s.length)||0)*4,n.caled=!0);}),e&&this.clearCaled(),t;}};var Tf=class{constructor(e){this.ambient=null;this.diffuse=null;this.specular=null;this.d=0;this.name=e;}},hu=new Tf("__default__");hu.ambient=[0,0,0],hu.diffuse=[.5,.5,.5],hu.specular=[0,0,0],hu.d=1;function kw(r,e,t){let n=new Array(),i=new Array(),s=new Array(),o=new Array(),a=new Array(),l=new Array();for(let u=0;u<r.length;u++){let c=r[u],h=e[u];n.push(c.x),i.push(c.y),s.push(c.z),o.push(h.x),a.push(h.y),l.push(h.z);}return{vertexXs:n,vertexYs:i,vertexZs:s,normalXs:o,normalYs:a,normalZs:l,material:{ambient:t.ambient,diffuse:t.diffuse,specular:t.specular,d:t.d}};}var g0=/(\d*)\/(\d*)\/(\d*)/;function Xa(r,e,t=0,n=()=>""){let i=new Date().getTime();r!=="None"&&console.log(`ObjDecode start [${r}]`);let s=new Array(),o=new Array();s.push(null),o.push(null);let a={},l=null;a.__default__={material:hu,vs:[],ns:[]};let u=a.__default__;Aa(e,p);let c=new Array(),h=new Array(),d=new Array();for(let b in a){let{material:y,vs:v,ns:E}=a[b];v.length>0&&(c.push(v),h.push(E),d.push(y));}let f=new Array();if(t===0)for(let b=0;b<c.length;b++){let y=c[b],v=h[b];v||(v=_a(y,Math.PI/3)),f.push(kw(y,v,d[b]));}else{let b=g2(c,0,t);for(let y=0;y<b.length;y++)b[y].length!==0&&f.push(kw(b[y],_a(b[y],Math.PI/3),d[y]));}return r!=="None"&&console.log(`ObjDecode end [${r}] ${new Date().getTime()-i}`),f;function p(b){b=b.trim();let y=b.split(/\s+/),v=y.shift();switch(v){case"v":s.push(new pe(parseFloat(y[0]),parseFloat(y[1]),parseFloat(y[2])));break;case"vn":o.push(new pe(parseFloat(y[0]),parseFloat(y[1]),parseFloat(y[2])));break;case"vt":break;case"f":let E=g0.exec(y[0]);if(E){let P=m(E[1]),M=g(E[3]),{vs:I,ns:C}=u,L=g0.exec(y[1]),S=m(L[1]),T=g(L[3]),B=C!==null;B&&(!M||!T)&&(u.ns=null,B=!1);for(let $=2;$<y.length;$++){let Z=g0.exec(y[$]),H=m(Z[1]),W=g(Z[3]);I.push(P,S,H),S=H,B&&(W?(C.push(M,T,W),T=W):(u.ns=null,B=!1));}}else{let P=m(y[0]),{vs:M}=u;u.ns=null;let I=m(y[1]);for(let C=2;C<y.length;C++){let L=m(y[C]);M.push(P,I,L),I=L;}}break;case"newmtl":case"endmtl":l&&l.ambient&&l.diffuse&&l.specular&&(a[l.name]={material:l,vs:[],ns:[]},l=null),v==="newmtl"&&(l=new Tf(y.join(" ")),l.ambient=[0,0,0],l.diffuse=[0,0,0],l.specular=[0,0,0]);break;case"Ka":l&&(l.ambient=[parseFloat(y[0]),parseFloat(y[1]),parseFloat(y[2])]);break;case"Kd":l&&(l.diffuse=[parseFloat(y[0]),parseFloat(y[1]),parseFloat(y[2])]);break;case"Ks":l&&(l.specular=[parseFloat(y[0]),parseFloat(y[1]),parseFloat(y[2])]);break;case"d":l&&(l.d=parseFloat(y[0]));break;case"usemtl":u=a[y.join(" ")]||a.__default__;break;case"mtllib":{let P=n(y[0]);P&&(Aa(P,p),p("endmtl"));break;}case"#":break;default:b&&console.log("ignore",b);}}function m(b){let y=parseInt(b);return y>0?s[y]:s[s.length+y];}function g(b){let y=parseInt(b);return y>0?o[y]:o[o.length+y];}}function x0(r,e=1){let t=new We();for(let n of r){let i=new Array(),s=new Array(),{vertexXs:o,vertexYs:a,vertexZs:l,normalXs:u,normalYs:c,normalZs:h,material:d}=n;for(let f=0;f<o.length;f++)i.push(new pe(o[f],a[f],l[f])),s.push(new pe(u[f],c[f],h[f]));t.add(new Et(new fr(i,s),null,tw(d.ambient[0],d.ambient[1],d.ambient[2],d.diffuse[0],d.diffuse[1],d.diffuse[2],d.specular[0],d.specular[1],d.specular[2],1,e)));}return t;}function ts(r,e=0,t=()=>"",n=1){return x0(Xa("None",r,e,t),n);}function BSe(r,e,t=1){return Se(this,null,function*(){let n={},i={};yield r(s=>Se(this,null,function*(){let{path:o,content:a}=s;console.log(o,a),o.endsWith(".mtl")?n[o]=new TextDecoder().decode(yield a()):o.endsWith(".obj")&&(i[o]=new TextDecoder().decode(yield a()));})),yield v2(i,(s,o)=>Se(this,null,function*(){let a=s.substring(0,s.lastIndexOf("/")+1),l=n[s.substring(0,s.length-3)+"mtl"],u=ts(o,0,c=>n[a+c]||l,t);if(e(s,u)===!1)return!1;}));});}var r3e=4,n3e=0,i3e=1,s3e=2;function ja(r){let e=r.length;for(;--e>=0;)r[e]=0;}var $F=0,jw=1,jF=2,ZF=3,HF=258,M0=29,du=256,pu=du+1+M0,Za=30,T0=19,Zw=2*pu+1,Ao=15,R0=16,KF=7,N0=256,Hw=16,Kw=17,Qw=18,L0=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),kf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),QF=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Jw=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),JF=512,rs=new Array((pu+2)*2);ja(rs);var mu=new Array(Za*2);ja(mu);var gu=new Array(JF);ja(gu);var xu=new Array(HF-ZF+1);ja(xu);var O0=new Array(M0);ja(O0);var Uf=new Array(Za);ja(Uf);function k0(r,e,t,n,i){this.static_tree=r,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=i,this.has_stree=r&&r.length;}var ev,tv,rv;function U0(r,e){this.dyn_tree=r,this.max_code=0,this.stat_desc=e;}var nv=r=>r<256?gu[r]:gu[256+(r>>>7)],bu=(r,e)=>{r.pending_buf[r.pending++]=e&255,r.pending_buf[r.pending++]=e>>>8&255;},on=(r,e,t)=>{r.bi_valid>R0-t?(r.bi_buf|=e<<r.bi_valid&65535,bu(r,r.bi_buf),r.bi_buf=e>>R0-r.bi_valid,r.bi_valid+=t-R0):(r.bi_buf|=e<<r.bi_valid&65535,r.bi_valid+=t);},Ei=(r,e,t)=>{on(r,t[e*2],t[e*2+1]);},iv=(r,e)=>{let t=0;do t|=r&1,r>>>=1,t<<=1;while(--e>0);return t>>>1;},e8=r=>{r.bi_valid===16?(bu(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8);},t8=(r,e)=>{let t=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,l=e.stat_desc.max_length,u,c,h,d,f,p,m=0;for(d=0;d<=Ao;d++)r.bl_count[d]=0;for(t[r.heap[r.heap_max]*2+1]=0,u=r.heap_max+1;u<Zw;u++)c=r.heap[u],d=t[t[c*2+1]*2+1]+1,d>l&&(d=l,m++),t[c*2+1]=d,!(c>n)&&(r.bl_count[d]++,f=0,c>=a&&(f=o[c-a]),p=t[c*2],r.opt_len+=p*(d+f),s&&(r.static_len+=p*(i[c*2+1]+f)));if(m!==0){do{for(d=l-1;r.bl_count[d]===0;)d--;r.bl_count[d]--,r.bl_count[d+1]+=2,r.bl_count[l]--,m-=2;}while(m>0);for(d=l;d!==0;d--)for(c=r.bl_count[d];c!==0;)h=r.heap[--u],!(h>n)&&(t[h*2+1]!==d&&(r.opt_len+=(d-t[h*2+1])*t[h*2],t[h*2+1]=d),c--);}},sv=(r,e,t)=>{let n=new Array(Ao+1),i=0,s,o;for(s=1;s<=Ao;s++)n[s]=i=i+t[s-1]<<1;for(o=0;o<=e;o++){let a=r[o*2+1];a!==0&&(r[o*2]=iv(n[a]++,a));}},r8=()=>{let r,e,t,n,i,s=new Array(Ao+1);for(t=0,n=0;n<M0-1;n++)for(O0[n]=t,r=0;r<1<<L0[n];r++)xu[t++]=n;for(xu[t-1]=n,i=0,n=0;n<16;n++)for(Uf[n]=i,r=0;r<1<<kf[n];r++)gu[i++]=n;for(i>>=7;n<Za;n++)for(Uf[n]=i<<7,r=0;r<1<<kf[n]-7;r++)gu[256+i++]=n;for(e=0;e<=Ao;e++)s[e]=0;for(r=0;r<=143;)rs[r*2+1]=8,r++,s[8]++;for(;r<=255;)rs[r*2+1]=9,r++,s[9]++;for(;r<=279;)rs[r*2+1]=7,r++,s[7]++;for(;r<=287;)rs[r*2+1]=8,r++,s[8]++;for(sv(rs,pu+1,s),r=0;r<Za;r++)mu[r*2+1]=5,mu[r*2]=iv(r,5);ev=new k0(rs,L0,du+1,pu,Ao),tv=new k0(mu,kf,0,Za,Ao),rv=new k0(new Array(0),QF,0,T0,KF);},ov=r=>{let e;for(e=0;e<pu;e++)r.dyn_ltree[e*2]=0;for(e=0;e<Za;e++)r.dyn_dtree[e*2]=0;for(e=0;e<T0;e++)r.bl_tree[e*2]=0;r.dyn_ltree[N0*2]=1,r.opt_len=r.static_len=0,r.last_lit=r.matches=0;},av=r=>{r.bi_valid>8?bu(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0;},n8=(r,e,t,n)=>{av(r),n&&(bu(r,t),bu(r,~t)),r.pending_buf.set(r.window.subarray(e,e+t),r.pending),r.pending+=t;},lv=(r,e,t,n)=>{let i=e*2,s=t*2;return r[i]<r[s]||r[i]===r[s]&&n[e]<=n[t];},D0=(r,e,t)=>{let n=r.heap[t],i=t<<1;for(;i<=r.heap_len&&(i<r.heap_len&&lv(e,r.heap[i+1],r.heap[i],r.depth)&&i++,!lv(e,n,r.heap[i],r.depth));)r.heap[t]=r.heap[i],t=i,i<<=1;r.heap[t]=n;},uv=(r,e,t)=>{let n,i,s=0,o,a;if(r.last_lit!==0)do n=r.pending_buf[r.d_buf+s*2]<<8|r.pending_buf[r.d_buf+s*2+1],i=r.pending_buf[r.l_buf+s],s++,n===0?Ei(r,i,e):(o=xu[i],Ei(r,o+du+1,e),a=L0[o],a!==0&&(i-=O0[o],on(r,i,a)),n--,o=nv(n),Ei(r,o,t),a=kf[o],a!==0&&(n-=Uf[o],on(r,n,a)));while(s<r.last_lit);Ei(r,N0,e);},G0=(r,e)=>{let t=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems,o,a,l=-1,u;for(r.heap_len=0,r.heap_max=Zw,o=0;o<s;o++)t[o*2]!==0?(r.heap[++r.heap_len]=l=o,r.depth[o]=0):t[o*2+1]=0;for(;r.heap_len<2;)u=r.heap[++r.heap_len]=l<2?++l:0,t[u*2]=1,r.depth[u]=0,r.opt_len--,i&&(r.static_len-=n[u*2+1]);for(e.max_code=l,o=r.heap_len>>1;o>=1;o--)D0(r,t,o);u=s;do o=r.heap[1],r.heap[1]=r.heap[r.heap_len--],D0(r,t,1),a=r.heap[1],r.heap[--r.heap_max]=o,r.heap[--r.heap_max]=a,t[u*2]=t[o*2]+t[a*2],r.depth[u]=(r.depth[o]>=r.depth[a]?r.depth[o]:r.depth[a])+1,t[o*2+1]=t[a*2+1]=u,r.heap[1]=u++,D0(r,t,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],t8(r,e),sv(t,l,r.bl_count);},cv=(r,e,t)=>{let n,i=-1,s,o=e[0*2+1],a=0,l=7,u=4;for(o===0&&(l=138,u=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)s=o,o=e[(n+1)*2+1],!(++a<l&&s===o)&&(a<u?r.bl_tree[s*2]+=a:s!==0?(s!==i&&r.bl_tree[s*2]++,r.bl_tree[Hw*2]++):a<=10?r.bl_tree[Kw*2]++:r.bl_tree[Qw*2]++,a=0,i=s,o===0?(l=138,u=3):s===o?(l=6,u=3):(l=7,u=4));},hv=(r,e,t)=>{let n,i=-1,s,o=e[0*2+1],a=0,l=7,u=4;for(o===0&&(l=138,u=3),n=0;n<=t;n++)if(s=o,o=e[(n+1)*2+1],!(++a<l&&s===o)){if(a<u)do Ei(r,s,r.bl_tree);while(--a!==0);else s!==0?(s!==i&&(Ei(r,s,r.bl_tree),a--),Ei(r,Hw,r.bl_tree),on(r,a-3,2)):a<=10?(Ei(r,Kw,r.bl_tree),on(r,a-3,3)):(Ei(r,Qw,r.bl_tree),on(r,a-11,7));a=0,i=s,o===0?(l=138,u=3):s===o?(l=6,u=3):(l=7,u=4);}},i8=r=>{let e;for(cv(r,r.dyn_ltree,r.l_desc.max_code),cv(r,r.dyn_dtree,r.d_desc.max_code),G0(r,r.bl_desc),e=T0-1;e>=3&&r.bl_tree[Jw[e]*2+1]===0;e--);return r.opt_len+=3*(e+1)+5+5+4,e;},s8=(r,e,t,n)=>{let i;for(on(r,e-257,5),on(r,t-1,5),on(r,n-4,4),i=0;i<n;i++)on(r,r.bl_tree[Jw[i]*2+1],3);hv(r,r.dyn_ltree,e-1),hv(r,r.dyn_dtree,t-1);},o8=r=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&r.dyn_ltree[t*2]!==0)return 0;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return 1;for(t=32;t<du;t++)if(r.dyn_ltree[t*2]!==0)return 1;return 0;},fv=!1,a8=r=>{fv||(r8(),fv=!0),r.l_desc=new U0(r.dyn_ltree,ev),r.d_desc=new U0(r.dyn_dtree,tv),r.bl_desc=new U0(r.bl_tree,rv),r.bi_buf=0,r.bi_valid=0,ov(r);},dv=(r,e,t,n)=>{on(r,($F<<1)+(n?1:0),3),n8(r,e,t,!0);},l8=r=>{on(r,jw<<1,3),Ei(r,N0,rs),e8(r);},u8=(r,e,t,n)=>{let i,s,o=0;r.level>0?(r.strm.data_type===2&&(r.strm.data_type=o8(r)),G0(r,r.l_desc),G0(r,r.d_desc),o=i8(r),i=r.opt_len+3+7>>>3,s=r.static_len+3+7>>>3,s<=i&&(i=s)):i=s=t+5,t+4<=i&&e!==-1?dv(r,e,t,n):r.strategy===4||s===i?(on(r,(jw<<1)+(n?1:0),3),uv(r,rs,mu)):(on(r,(jF<<1)+(n?1:0),3),s8(r,r.l_desc.max_code+1,r.d_desc.max_code+1,o+1),uv(r,r.dyn_ltree,r.dyn_dtree)),ov(r),n&&av(r);},c8=(r,e,t)=>(r.pending_buf[r.d_buf+r.last_lit*2]=e>>>8&255,r.pending_buf[r.d_buf+r.last_lit*2+1]=e&255,r.pending_buf[r.l_buf+r.last_lit]=t&255,r.last_lit++,e===0?r.dyn_ltree[t*2]++:(r.matches++,e--,r.dyn_ltree[(xu[t]+du+1)*2]++,r.dyn_dtree[nv(e)*2]++),r.last_lit===r.lit_bufsize-1),h8=a8,f8=dv,d8=u8,p8=c8,m8=l8,g8={_tr_init:h8,_tr_stored_block:f8,_tr_flush_block:d8,_tr_tally:p8,_tr_align:m8},x8=(r,e,t,n)=>{let i=r&65535|0,s=r>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do i=i+e[n++]|0,s=s+i|0;while(--o);i%=65521,s%=65521;}return i|s<<16|0;},yu=x8,b8=()=>{let r,e=[];for(var t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r;}return e;},y8=new Uint32Array(b8()),w8=(r,e,t,n)=>{let i=y8,s=n+t;r^=-1;for(let o=n;o<s;o++)r=r>>>8^i[(r^e[o])&255];return r^-1;},Sr=w8,Co={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Mo={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:v8,_tr_stored_block:E8,_tr_flush_block:P8,_tr_tally:Us,_tr_align:_8}=g8,{Z_NO_FLUSH:To,Z_PARTIAL_FLUSH:S8,Z_FULL_FLUSH:B8,Z_FINISH:Ds,Z_BLOCK:pv,Z_OK:Pi,Z_STREAM_END:mv,Z_STREAM_ERROR:Fn,Z_DATA_ERROR:I8,Z_BUF_ERROR:F0,Z_DEFAULT_COMPRESSION:A8,Z_FILTERED:C8,Z_HUFFMAN_ONLY:Df,Z_RLE:M8,Z_FIXED:T8,Z_DEFAULT_STRATEGY:R8,Z_UNKNOWN:N8,Z_DEFLATED:Gf}=Mo,L8=9,O8=15,k8=8,U8=29,D8=256,q0=D8+1+U8,G8=30,F8=19,q8=2*q0+1,z8=15,Pt=3,Gs=258,ni=Gs+Pt+1,Y8=32,Ff=42,z0=69,qf=73,zf=91,Yf=103,Ro=113,wu=666,yr=1,vu=2,No=3,Ha=4,X8=3,Fs=(r,e)=>(r.msg=Co[e],e),gv=r=>(r<<1)-(r>4?9:0),qs=r=>{let e=r.length;for(;--e>=0;)r[e]=0;},V8=(r,e,t)=>(e<<r.hash_shift^t)&r.hash_mask,zs=V8,Ys=r=>{let e=r.state,t=e.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(r.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),r.next_out),r.next_out+=t,e.pending_out+=t,r.total_out+=t,r.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0));},Cr=(r,e)=>{P8(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,e),r.block_start=r.strstart,Ys(r.strm);},Ct=(r,e)=>{r.pending_buf[r.pending++]=e;},Eu=(r,e)=>{r.pending_buf[r.pending++]=e>>>8&255,r.pending_buf[r.pending++]=e&255;},W8=(r,e,t,n)=>{let i=r.avail_in;return i>n&&(i=n),i===0?0:(r.avail_in-=i,e.set(r.input.subarray(r.next_in,r.next_in+i),t),r.state.wrap===1?r.adler=yu(r.adler,e,i,t):r.state.wrap===2&&(r.adler=Sr(r.adler,e,i,t)),r.next_in+=i,r.total_in+=i,i);},xv=(r,e)=>{let t=r.max_chain_length,n=r.strstart,i,s,o=r.prev_length,a=r.nice_match,l=r.strstart>r.w_size-ni?r.strstart-(r.w_size-ni):0,u=r.window,c=r.w_mask,h=r.prev,d=r.strstart+Gs,f=u[n+o-1],p=u[n+o];r.prev_length>=r.good_match&&(t>>=2),a>r.lookahead&&(a=r.lookahead);do if(i=e,!(u[i+o]!==p||u[i+o-1]!==f||u[i]!==u[n]||u[++i]!==u[n+1])){n+=2,i++;do;while(u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&n<d);if(s=Gs-(d-n),n=d-Gs,s>o){if(r.match_start=e,o=s,s>=a)break;f=u[n+o-1],p=u[n+o];}}while((e=h[e&c])>l&&--t!==0);return o<=r.lookahead?o:r.lookahead;},Lo=r=>{let e=r.w_size,t,n,i,s,o;do{if(s=r.window_size-r.lookahead-r.strstart,r.strstart>=e+(e-ni)){r.window.set(r.window.subarray(e,e+e),0),r.match_start-=e,r.strstart-=e,r.block_start-=e,n=r.hash_size,t=n;do i=r.head[--t],r.head[t]=i>=e?i-e:0;while(--n);n=e,t=n;do i=r.prev[--t],r.prev[t]=i>=e?i-e:0;while(--n);s+=e;}if(r.strm.avail_in===0)break;if(n=W8(r.strm,r.window,r.strstart+r.lookahead,s),r.lookahead+=n,r.lookahead+r.insert>=Pt)for(o=r.strstart-r.insert,r.ins_h=r.window[o],r.ins_h=zs(r,r.ins_h,r.window[o+1]);r.insert&&(r.ins_h=zs(r,r.ins_h,r.window[o+Pt-1]),r.prev[o&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=o,o++,r.insert--,!(r.lookahead+r.insert<Pt)););}while(r.lookahead<ni&&r.strm.avail_in!==0);},$8=(r,e)=>{let t=65535;for(t>r.pending_buf_size-5&&(t=r.pending_buf_size-5);;){if(r.lookahead<=1){if(Lo(r),r.lookahead===0&&e===To)return yr;if(r.lookahead===0)break;}r.strstart+=r.lookahead,r.lookahead=0;let n=r.block_start+t;if((r.strstart===0||r.strstart>=n)&&(r.lookahead=r.strstart-n,r.strstart=n,Cr(r,!1),r.strm.avail_out===0)||r.strstart-r.block_start>=r.w_size-ni&&(Cr(r,!1),r.strm.avail_out===0))return yr;}return r.insert=0,e===Ds?(Cr(r,!0),r.strm.avail_out===0?No:Ha):(r.strstart>r.block_start&&(Cr(r,!1),r.strm.avail_out===0),yr);},Y0=(r,e)=>{let t,n;for(;;){if(r.lookahead<ni){if(Lo(r),r.lookahead<ni&&e===To)return yr;if(r.lookahead===0)break;}if(t=0,r.lookahead>=Pt&&(r.ins_h=zs(r,r.ins_h,r.window[r.strstart+Pt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-ni&&(r.match_length=xv(r,t)),r.match_length>=Pt){if(n=Us(r,r.strstart-r.match_start,r.match_length-Pt),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=Pt){r.match_length--;do r.strstart++,r.ins_h=zs(r,r.ins_h,r.window[r.strstart+Pt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++;}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=zs(r,r.ins_h,r.window[r.strstart+1]);}else n=Us(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(Cr(r,!1),r.strm.avail_out===0))return yr;}return r.insert=r.strstart<Pt-1?r.strstart:Pt-1,e===Ds?(Cr(r,!0),r.strm.avail_out===0?No:Ha):r.last_lit&&(Cr(r,!1),r.strm.avail_out===0)?yr:vu;},Ka=(r,e)=>{let t,n,i;for(;;){if(r.lookahead<ni){if(Lo(r),r.lookahead<ni&&e===To)return yr;if(r.lookahead===0)break;}if(t=0,r.lookahead>=Pt&&(r.ins_h=zs(r,r.ins_h,r.window[r.strstart+Pt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=Pt-1,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-ni&&(r.match_length=xv(r,t),r.match_length<=5&&(r.strategy===C8||r.match_length===Pt&&r.strstart-r.match_start>4096)&&(r.match_length=Pt-1)),r.prev_length>=Pt&&r.match_length<=r.prev_length){i=r.strstart+r.lookahead-Pt,n=Us(r,r.strstart-1-r.prev_match,r.prev_length-Pt),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=i&&(r.ins_h=zs(r,r.ins_h,r.window[r.strstart+Pt-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=Pt-1,r.strstart++,n&&(Cr(r,!1),r.strm.avail_out===0))return yr;}else if(r.match_available){if(n=Us(r,0,r.window[r.strstart-1]),n&&Cr(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return yr;}else r.match_available=1,r.strstart++,r.lookahead--;}return r.match_available&&(n=Us(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<Pt-1?r.strstart:Pt-1,e===Ds?(Cr(r,!0),r.strm.avail_out===0?No:Ha):r.last_lit&&(Cr(r,!1),r.strm.avail_out===0)?yr:vu;},j8=(r,e)=>{let t,n,i,s,o=r.window;for(;;){if(r.lookahead<=Gs){if(Lo(r),r.lookahead<=Gs&&e===To)return yr;if(r.lookahead===0)break;}if(r.match_length=0,r.lookahead>=Pt&&r.strstart>0&&(i=r.strstart-1,n=o[i],n===o[++i]&&n===o[++i]&&n===o[++i])){s=r.strstart+Gs;do;while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&i<s);r.match_length=Gs-(s-i),r.match_length>r.lookahead&&(r.match_length=r.lookahead);}if(r.match_length>=Pt?(t=Us(r,1,r.match_length-Pt),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(t=Us(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),t&&(Cr(r,!1),r.strm.avail_out===0))return yr;}return r.insert=0,e===Ds?(Cr(r,!0),r.strm.avail_out===0?No:Ha):r.last_lit&&(Cr(r,!1),r.strm.avail_out===0)?yr:vu;},Z8=(r,e)=>{let t;for(;;){if(r.lookahead===0&&(Lo(r),r.lookahead===0)){if(e===To)return yr;break;}if(r.match_length=0,t=Us(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,t&&(Cr(r,!1),r.strm.avail_out===0))return yr;}return r.insert=0,e===Ds?(Cr(r,!0),r.strm.avail_out===0?No:Ha):r.last_lit&&(Cr(r,!1),r.strm.avail_out===0)?yr:vu;};function _i(r,e,t,n,i){this.good_length=r,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=i;}var Pu=[new _i(0,0,0,0,$8),new _i(4,4,8,4,Y0),new _i(4,5,16,8,Y0),new _i(4,6,32,32,Y0),new _i(4,4,16,16,Ka),new _i(8,16,32,32,Ka),new _i(8,16,128,128,Ka),new _i(8,32,128,256,Ka),new _i(32,128,258,1024,Ka),new _i(32,258,258,4096,Ka)],H8=r=>{r.window_size=2*r.w_size,qs(r.head),r.max_lazy_match=Pu[r.level].max_lazy,r.good_match=Pu[r.level].good_length,r.nice_match=Pu[r.level].nice_length,r.max_chain_length=Pu[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=Pt-1,r.match_available=0,r.ins_h=0;};function K8(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Gf,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(q8*2),this.dyn_dtree=new Uint16Array((2*G8+1)*2),this.bl_tree=new Uint16Array((2*F8+1)*2),qs(this.dyn_ltree),qs(this.dyn_dtree),qs(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(z8+1),this.heap=new Uint16Array(2*q0+1),qs(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*q0+1),qs(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0;}var bv=r=>{if(!r||!r.state)return Fs(r,Fn);r.total_in=r.total_out=0,r.data_type=N8;let e=r.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?Ff:Ro,r.adler=e.wrap===2?0:1,e.last_flush=To,v8(e),Pi;},yv=r=>{let e=bv(r);return e===Pi&&H8(r.state),e;},Q8=(r,e)=>!r||!r.state||r.state.wrap!==2?Fn:(r.state.gzhead=e,Pi),wv=(r,e,t,n,i,s)=>{if(!r)return Fn;let o=1;if(e===A8&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),i<1||i>L8||t!==Gf||n<8||n>15||e<0||e>9||s<0||s>T8)return Fs(r,Fn);n===8&&(n=9);let a=new K8();return r.state=a,a.strm=r,a.wrap=o,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Pt-1)/Pt),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=(1+2)*a.lit_bufsize,a.level=e,a.strategy=s,a.method=t,yv(r);},J8=(r,e)=>wv(r,e,Gf,O8,k8,R8),eq=(r,e)=>{let t,n;if(!r||!r.state||e>pv||e<0)return r?Fs(r,Fn):Fn;let i=r.state;if(!r.output||!r.input&&r.avail_in!==0||i.status===wu&&e!==Ds)return Fs(r,r.avail_out===0?F0:Fn);i.strm=r;let s=i.last_flush;if(i.last_flush=e,i.status===Ff)if(i.wrap===2)r.adler=0,Ct(i,31),Ct(i,139),Ct(i,8),i.gzhead?(Ct(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Ct(i,i.gzhead.time&255),Ct(i,i.gzhead.time>>8&255),Ct(i,i.gzhead.time>>16&255),Ct(i,i.gzhead.time>>24&255),Ct(i,i.level===9?2:i.strategy>=Df||i.level<2?4:0),Ct(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(Ct(i,i.gzhead.extra.length&255),Ct(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(r.adler=Sr(r.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=z0):(Ct(i,0),Ct(i,0),Ct(i,0),Ct(i,0),Ct(i,0),Ct(i,i.level===9?2:i.strategy>=Df||i.level<2?4:0),Ct(i,X8),i.status=Ro);else{let o=Gf+(i.w_bits-8<<4)<<8,a=-1;i.strategy>=Df||i.level<2?a=0:i.level<6?a=1:i.level===6?a=2:a=3,o|=a<<6,i.strstart!==0&&(o|=Y8),o+=31-o%31,i.status=Ro,Eu(i,o),i.strstart!==0&&(Eu(i,r.adler>>>16),Eu(i,r.adler&65535)),r.adler=1;}if(i.status===z0)if(i.gzhead.extra){for(t=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>t&&(r.adler=Sr(r.adler,i.pending_buf,i.pending-t,t)),Ys(r),t=i.pending,i.pending===i.pending_buf_size));)Ct(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>t&&(r.adler=Sr(r.adler,i.pending_buf,i.pending-t,t)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=qf);}else i.status=qf;if(i.status===qf)if(i.gzhead.name){t=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>t&&(r.adler=Sr(r.adler,i.pending_buf,i.pending-t,t)),Ys(r),t=i.pending,i.pending===i.pending_buf_size)){n=1;break;}i.gzindex<i.gzhead.name.length?n=i.gzhead.name.charCodeAt(i.gzindex++)&255:n=0,Ct(i,n);}while(n!==0);i.gzhead.hcrc&&i.pending>t&&(r.adler=Sr(r.adler,i.pending_buf,i.pending-t,t)),n===0&&(i.gzindex=0,i.status=zf);}else i.status=zf;if(i.status===zf)if(i.gzhead.comment){t=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>t&&(r.adler=Sr(r.adler,i.pending_buf,i.pending-t,t)),Ys(r),t=i.pending,i.pending===i.pending_buf_size)){n=1;break;}i.gzindex<i.gzhead.comment.length?n=i.gzhead.comment.charCodeAt(i.gzindex++)&255:n=0,Ct(i,n);}while(n!==0);i.gzhead.hcrc&&i.pending>t&&(r.adler=Sr(r.adler,i.pending_buf,i.pending-t,t)),n===0&&(i.status=Yf);}else i.status=Yf;if(i.status===Yf&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Ys(r),i.pending+2<=i.pending_buf_size&&(Ct(i,r.adler&255),Ct(i,r.adler>>8&255),r.adler=0,i.status=Ro)):i.status=Ro),i.pending!==0){if(Ys(r),r.avail_out===0)return i.last_flush=-1,Pi;}else if(r.avail_in===0&&gv(e)<=gv(s)&&e!==Ds)return Fs(r,F0);if(i.status===wu&&r.avail_in!==0)return Fs(r,F0);if(r.avail_in!==0||i.lookahead!==0||e!==To&&i.status!==wu){let o=i.strategy===Df?Z8(i,e):i.strategy===M8?j8(i,e):Pu[i.level].func(i,e);if((o===No||o===Ha)&&(i.status=wu),o===yr||o===No)return r.avail_out===0&&(i.last_flush=-1),Pi;if(o===vu&&(e===S8?_8(i):e!==pv&&(E8(i,0,0,!1),e===B8&&(qs(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),Ys(r),r.avail_out===0))return i.last_flush=-1,Pi;}return e!==Ds?Pi:i.wrap<=0?mv:(i.wrap===2?(Ct(i,r.adler&255),Ct(i,r.adler>>8&255),Ct(i,r.adler>>16&255),Ct(i,r.adler>>24&255),Ct(i,r.total_in&255),Ct(i,r.total_in>>8&255),Ct(i,r.total_in>>16&255),Ct(i,r.total_in>>24&255)):(Eu(i,r.adler>>>16),Eu(i,r.adler&65535)),Ys(r),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Pi:mv);},tq=r=>{if(!r||!r.state)return Fn;let e=r.state.status;return e!==Ff&&e!==z0&&e!==qf&&e!==zf&&e!==Yf&&e!==Ro&&e!==wu?Fs(r,Fn):(r.state=null,e===Ro?Fs(r,I8):Pi);},rq=(r,e)=>{let t=e.length;if(!r||!r.state)return Fn;let n=r.state,i=n.wrap;if(i===2||i===1&&n.status!==Ff||n.lookahead)return Fn;if(i===1&&(r.adler=yu(r.adler,e,t,0)),n.wrap=0,t>=n.w_size){i===0&&(qs(n.head),n.strstart=0,n.block_start=0,n.insert=0);let l=new Uint8Array(n.w_size);l.set(e.subarray(t-n.w_size,t),0),e=l,t=n.w_size;}let s=r.avail_in,o=r.next_in,a=r.input;for(r.avail_in=t,r.next_in=0,r.input=e,Lo(n);n.lookahead>=Pt;){let l=n.strstart,u=n.lookahead-(Pt-1);do n.ins_h=zs(n,n.ins_h,n.window[l+Pt-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++;while(--u);n.strstart=l,n.lookahead=Pt-1,Lo(n);}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=Pt-1,n.match_available=0,r.next_in=o,r.input=a,r.avail_in=s,n.wrap=i,Pi;},nq=J8,iq=wv,sq=yv,oq=bv,aq=Q8,lq=eq,uq=tq,cq=rq,hq="pako deflate (from Nodeca project)",_u={deflateInit:nq,deflateInit2:iq,deflateReset:sq,deflateResetKeep:oq,deflateSetHeader:aq,deflate:lq,deflateEnd:uq,deflateSetDictionary:cq,deflateInfo:hq},fq=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),dq=function(r){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(!!t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let n in t)fq(t,n)&&(r[n]=t[n]);}}return r;},pq=r=>{let e=0;for(let n=0,i=r.length;n<i;n++)e+=r[n].length;let t=new Uint8Array(e);for(let n=0,i=0,s=r.length;n<s;n++){let o=r[n];t.set(o,i),i+=o.length;}return t;},Xf={assign:dq,flattenChunks:pq},vv=!0;try{String.fromCharCode.apply(null,new Uint8Array(1));}catch{vv=!1;}var Su=new Uint8Array(256);for(let r=0;r<256;r++)Su[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;Su[254]=Su[254]=1;var mq=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let e,t,n,i,s,o=r.length,a=0;for(i=0;i<o;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<o&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<o&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|t&63):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|t&63):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|t&63);return e;},gq=(r,e)=>{if(e<65534&&r.subarray&&vv)return String.fromCharCode.apply(null,r.length===e?r:r.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(r[n]);return t;},xq=(r,e)=>{let t=e||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,e));let n,i,s=new Array(t*2);for(i=0,n=0;n<t;){let o=r[n++];if(o<128){s[i++]=o;continue;}let a=Su[o];if(a>4){s[i++]=65533,n+=a-1;continue;}for(o&=a===2?31:a===3?15:7;a>1&&n<t;)o=o<<6|r[n++]&63,a--;if(a>1){s[i++]=65533;continue;}o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|o&1023);}return gq(s,i);},bq=(r,e)=>{e=e||r.length,e>r.length&&(e=r.length);let t=e-1;for(;t>=0&&(r[t]&192)===128;)t--;return t<0||t===0?e:t+Su[r[t]]>e?t:e;},Bu={string2buf:mq,buf2string:xq,utf8border:bq};function yq(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0;}var Ev=yq,Pv=Object.prototype.toString,{Z_NO_FLUSH:wq,Z_SYNC_FLUSH:vq,Z_FULL_FLUSH:Eq,Z_FINISH:Pq,Z_OK:Vf,Z_STREAM_END:_q,Z_DEFAULT_COMPRESSION:Sq,Z_DEFAULT_STRATEGY:Bq,Z_DEFLATED:Iq}=Mo;function Iu(r){this.options=Xf.assign({level:Sq,method:Iq,chunkSize:16384,windowBits:15,memLevel:8,strategy:Bq},r||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ev(),this.strm.avail_out=0;let t=_u.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==Vf)throw new Error(Co[t]);if(e.header&&_u.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=Bu.string2buf(e.dictionary):Pv.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=_u.deflateSetDictionary(this.strm,n),t!==Vf)throw new Error(Co[t]);this._dict_set=!0;}}Iu.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?Pq:wq,typeof r=="string"?t.input=Bu.string2buf(r):Pv.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(s===vq||s===Eq)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue;}if(i=_u.deflate(t,s),i===_q)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),i=_u.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Vf;if(t.avail_out===0){this.onData(t.output);continue;}if(s>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue;}if(t.avail_in===0)break;}return!0;},Iu.prototype.onData=function(r){this.chunks.push(r);},Iu.prototype.onEnd=function(r){r===Vf&&(this.result=Xf.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg;};function X0(r,e){let t=new Iu(e);if(t.push(r,!0),t.err)throw t.msg||Co[t.err];return t.result;}function Aq(r,e){return e=e||{},e.raw=!0,X0(r,e);}function Cq(r,e){return e=e||{},e.gzip=!0,X0(r,e);}var Mq=Iu,Tq=X0,Rq=Aq,Nq=Cq,Lq=Mo,Oq={Deflate:Mq,deflate:Tq,deflateRaw:Rq,gzip:Nq,constants:Lq},Wf=30,kq=12,Uq=function(e,t){let n,i,s,o,a,l,u,c,h,d,f,p,m,g,b,y,v,E,P,M,I,C,L,S,T=e.state;n=e.next_in,L=e.input,i=n+(e.avail_in-5),s=e.next_out,S=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),l=T.dmax,u=T.wsize,c=T.whave,h=T.wnext,d=T.window,f=T.hold,p=T.bits,m=T.lencode,g=T.distcode,b=(1<<T.lenbits)-1,y=(1<<T.distbits)-1;e:do{p<15&&(f+=L[n++]<<p,p+=8,f+=L[n++]<<p,p+=8),v=m[f&b];t:for(;;){if(E=v>>>24,f>>>=E,p-=E,E=v>>>16&255,E===0)S[s++]=v&65535;else if(E&16){P=v&65535,E&=15,E&&(p<E&&(f+=L[n++]<<p,p+=8),P+=f&(1<<E)-1,f>>>=E,p-=E),p<15&&(f+=L[n++]<<p,p+=8,f+=L[n++]<<p,p+=8),v=g[f&y];r:for(;;){if(E=v>>>24,f>>>=E,p-=E,E=v>>>16&255,E&16){if(M=v&65535,E&=15,p<E&&(f+=L[n++]<<p,p+=8,p<E&&(f+=L[n++]<<p,p+=8)),M+=f&(1<<E)-1,M>l){e.msg="invalid distance too far back",T.mode=Wf;break e;}if(f>>>=E,p-=E,E=s-o,M>E){if(E=M-E,E>c&&T.sane){e.msg="invalid distance too far back",T.mode=Wf;break e;}if(I=0,C=d,h===0){if(I+=u-E,E<P){P-=E;do S[s++]=d[I++];while(--E);I=s-M,C=S;}}else if(h<E){if(I+=u+h-E,E-=h,E<P){P-=E;do S[s++]=d[I++];while(--E);if(I=0,h<P){E=h,P-=E;do S[s++]=d[I++];while(--E);I=s-M,C=S;}}}else if(I+=h-E,E<P){P-=E;do S[s++]=d[I++];while(--E);I=s-M,C=S;}for(;P>2;)S[s++]=C[I++],S[s++]=C[I++],S[s++]=C[I++],P-=3;P&&(S[s++]=C[I++],P>1&&(S[s++]=C[I++]));}else{I=s-M;do S[s++]=S[I++],S[s++]=S[I++],S[s++]=S[I++],P-=3;while(P>2);P&&(S[s++]=S[I++],P>1&&(S[s++]=S[I++]));}}else if((E&64)===0){v=g[(v&65535)+(f&(1<<E)-1)];continue r;}else{e.msg="invalid distance code",T.mode=Wf;break e;}break;}}else if((E&64)===0){v=m[(v&65535)+(f&(1<<E)-1)];continue t;}else if(E&32){T.mode=kq;break e;}else{e.msg="invalid literal/length code",T.mode=Wf;break e;}break;}}while(n<i&&s<a);P=p>>3,n-=P,p-=P<<3,f&=(1<<p)-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?5+(i-n):5-(n-i),e.avail_out=s<a?257+(a-s):257-(s-a),T.hold=f,T.bits=p;},Qa=15,_v=852,Sv=592,Bv=0,V0=1,Iv=2,Dq=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Gq=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Fq=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),qq=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),zq=(r,e,t,n,i,s,o,a)=>{let l=a.bits,u=0,c=0,h=0,d=0,f=0,p=0,m=0,g=0,b=0,y=0,v,E,P,M,I,C=null,L=0,S,T=new Uint16Array(Qa+1),B=new Uint16Array(Qa+1),$=null,Z=0,H,W,Y;for(u=0;u<=Qa;u++)T[u]=0;for(c=0;c<n;c++)T[e[t+c]]++;for(f=l,d=Qa;d>=1&&T[d]===0;d--);if(f>d&&(f=d),d===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,a.bits=1,0;for(h=1;h<d&&T[h]===0;h++);for(f<h&&(f=h),g=1,u=1;u<=Qa;u++)if(g<<=1,g-=T[u],g<0)return-1;if(g>0&&(r===Bv||d!==1))return-1;for(B[1]=0,u=1;u<Qa;u++)B[u+1]=B[u]+T[u];for(c=0;c<n;c++)e[t+c]!==0&&(o[B[e[t+c]]++]=c);if(r===Bv?(C=$=o,S=19):r===V0?(C=Dq,L-=257,$=Gq,Z-=257,S=256):(C=Fq,$=qq,S=-1),y=0,c=0,u=h,I=s,p=f,m=0,P=-1,b=1<<f,M=b-1,r===V0&&b>_v||r===Iv&&b>Sv)return 1;for(;;){H=u-m,o[c]<S?(W=0,Y=o[c]):o[c]>S?(W=$[Z+o[c]],Y=C[L+o[c]]):(W=32+64,Y=0),v=1<<u-m,E=1<<p,h=E;do E-=v,i[I+(y>>m)+E]=H<<24|W<<16|Y|0;while(E!==0);for(v=1<<u-1;y&v;)v>>=1;if(v!==0?(y&=v-1,y+=v):y=0,c++,--T[u]===0){if(u===d)break;u=e[t+o[c]];}if(u>f&&(y&M)!==P){for(m===0&&(m=f),I+=h,p=u-m,g=1<<p;p+m<d&&(g-=T[p+m],!(g<=0));)p++,g<<=1;if(b+=1<<p,r===V0&&b>_v||r===Iv&&b>Sv)return 1;P=y&M,i[P]=f<<24|p<<16|I-s|0;}}return y!==0&&(i[I+y]=u-m<<24|64<<16|0),a.bits=f,0;},Au=zq,Yq=0,Av=1,Cv=2,{Z_FINISH:Mv,Z_BLOCK:Xq,Z_TREES:$f,Z_OK:Oo,Z_STREAM_END:Vq,Z_NEED_DICT:Wq,Z_STREAM_ERROR:qn,Z_DATA_ERROR:Tv,Z_MEM_ERROR:Rv,Z_BUF_ERROR:$q,Z_DEFLATED:Nv}=Mo,Lv=1,Ov=2,kv=3,Uv=4,Dv=5,Gv=6,Fv=7,qv=8,zv=9,Yv=10,jf=11,ns=12,W0=13,Xv=14,$0=15,Vv=16,Wv=17,$v=18,jv=19,Zf=20,Hf=21,Zv=22,Hv=23,Kv=24,Qv=25,Jv=26,j0=27,eE=28,tE=29,Kt=30,rE=31,jq=32,Zq=852,Hq=592,Kq=15,Qq=Kq,nE=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function Jq(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0;}var iE=r=>{if(!r||!r.state)return qn;let e=r.state;return r.total_in=r.total_out=e.total=0,r.msg="",e.wrap&&(r.adler=e.wrap&1),e.mode=Lv,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(Zq),e.distcode=e.distdyn=new Int32Array(Hq),e.sane=1,e.back=-1,Oo;},sE=r=>{if(!r||!r.state)return qn;let e=r.state;return e.wsize=0,e.whave=0,e.wnext=0,iE(r);},oE=(r,e)=>{let t;if(!r||!r.state)return qn;let n=r.state;return e<0?(t=0,e=-e):(t=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?qn:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,sE(r));},aE=(r,e)=>{if(!r)return qn;let t=new Jq();r.state=t,t.window=null;let n=oE(r,e);return n!==Oo&&(r.state=null),n;},ez=r=>aE(r,Qq),lE=!0,Z0,H0,tz=r=>{if(lE){Z0=new Int32Array(512),H0=new Int32Array(32);let e=0;for(;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for(Au(Av,r.lens,0,288,Z0,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;Au(Cv,r.lens,0,32,H0,0,r.work,{bits:5}),lE=!1;}r.lencode=Z0,r.lenbits=9,r.distcode=H0,r.distbits=5;},uE=(r,e,t,n)=>{let i,s=r.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(e.subarray(t-s.wsize,t),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>n&&(i=n),s.window.set(e.subarray(t-n,t-n+i),s.wnext),n-=i,n?(s.window.set(e.subarray(t-n,t),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0;},rz=(r,e)=>{let t,n,i,s,o,a,l,u,c,h,d,f,p,m,g=0,b,y,v,E,P,M,I,C,L=new Uint8Array(4),S,T,B=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!r||!r.state||!r.output||!r.input&&r.avail_in!==0)return qn;t=r.state,t.mode===ns&&(t.mode=W0),o=r.next_out,i=r.output,l=r.avail_out,s=r.next_in,n=r.input,a=r.avail_in,u=t.hold,c=t.bits,h=a,d=l,C=Oo;e:for(;;)switch(t.mode){case Lv:if(t.wrap===0){t.mode=W0;break;}for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}if(t.wrap&2&&u===35615){t.check=0,L[0]=u&255,L[1]=u>>>8&255,t.check=Sr(t.check,L,2,0),u=0,c=0,t.mode=Ov;break;}if(t.flags=0,t.head&&(t.head.done=!1),!(t.wrap&1)||(((u&255)<<8)+(u>>8))%31){r.msg="incorrect header check",t.mode=Kt;break;}if((u&15)!==Nv){r.msg="unknown compression method",t.mode=Kt;break;}if(u>>>=4,c-=4,I=(u&15)+8,t.wbits===0)t.wbits=I;else if(I>t.wbits){r.msg="invalid window size",t.mode=Kt;break;}t.dmax=1<<t.wbits,r.adler=t.check=1,t.mode=u&512?Yv:ns,u=0,c=0;break;case Ov:for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}if(t.flags=u,(t.flags&255)!==Nv){r.msg="unknown compression method",t.mode=Kt;break;}if(t.flags&57344){r.msg="unknown header flags set",t.mode=Kt;break;}t.head&&(t.head.text=u>>8&1),t.flags&512&&(L[0]=u&255,L[1]=u>>>8&255,t.check=Sr(t.check,L,2,0)),u=0,c=0,t.mode=kv;case kv:for(;c<32;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}t.head&&(t.head.time=u),t.flags&512&&(L[0]=u&255,L[1]=u>>>8&255,L[2]=u>>>16&255,L[3]=u>>>24&255,t.check=Sr(t.check,L,4,0)),u=0,c=0,t.mode=Uv;case Uv:for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}t.head&&(t.head.xflags=u&255,t.head.os=u>>8),t.flags&512&&(L[0]=u&255,L[1]=u>>>8&255,t.check=Sr(t.check,L,2,0)),u=0,c=0,t.mode=Dv;case Dv:if(t.flags&1024){for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}t.length=u,t.head&&(t.head.extra_len=u),t.flags&512&&(L[0]=u&255,L[1]=u>>>8&255,t.check=Sr(t.check,L,2,0)),u=0,c=0;}else t.head&&(t.head.extra=null);t.mode=Gv;case Gv:if(t.flags&1024&&(f=t.length,f>a&&(f=a),f&&(t.head&&(I=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(s,s+f),I)),t.flags&512&&(t.check=Sr(t.check,n,f,s)),a-=f,s+=f,t.length-=f),t.length))break e;t.length=0,t.mode=Fv;case Fv:if(t.flags&2048){if(a===0)break e;f=0;do I=n[s+f++],t.head&&I&&t.length<65536&&(t.head.name+=String.fromCharCode(I));while(I&&f<a);if(t.flags&512&&(t.check=Sr(t.check,n,f,s)),a-=f,s+=f,I)break e;}else t.head&&(t.head.name=null);t.length=0,t.mode=qv;case qv:if(t.flags&4096){if(a===0)break e;f=0;do I=n[s+f++],t.head&&I&&t.length<65536&&(t.head.comment+=String.fromCharCode(I));while(I&&f<a);if(t.flags&512&&(t.check=Sr(t.check,n,f,s)),a-=f,s+=f,I)break e;}else t.head&&(t.head.comment=null);t.mode=zv;case zv:if(t.flags&512){for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}if(u!==(t.check&65535)){r.msg="header crc mismatch",t.mode=Kt;break;}u=0,c=0;}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=ns;break;case Yv:for(;c<32;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}r.adler=t.check=nE(u),u=0,c=0,t.mode=jf;case jf:if(t.havedict===0)return r.next_out=o,r.avail_out=l,r.next_in=s,r.avail_in=a,t.hold=u,t.bits=c,Wq;r.adler=t.check=1,t.mode=ns;case ns:if(e===Xq||e===$f)break e;case W0:if(t.last){u>>>=c&7,c-=c&7,t.mode=j0;break;}for(;c<3;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}switch(t.last=u&1,u>>>=1,c-=1,u&3){case 0:t.mode=Xv;break;case 1:if(tz(t),t.mode=Zf,e===$f){u>>>=2,c-=2;break e;}break;case 2:t.mode=Wv;break;case 3:r.msg="invalid block type",t.mode=Kt;}u>>>=2,c-=2;break;case Xv:for(u>>>=c&7,c-=c&7;c<32;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}if((u&65535)!==(u>>>16^65535)){r.msg="invalid stored block lengths",t.mode=Kt;break;}if(t.length=u&65535,u=0,c=0,t.mode=$0,e===$f)break e;case $0:t.mode=Vv;case Vv:if(f=t.length,f){if(f>a&&(f=a),f>l&&(f=l),f===0)break e;i.set(n.subarray(s,s+f),o),a-=f,s+=f,l-=f,o+=f,t.length-=f;break;}t.mode=ns;break;case Wv:for(;c<14;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}if(t.nlen=(u&31)+257,u>>>=5,c-=5,t.ndist=(u&31)+1,u>>>=5,c-=5,t.ncode=(u&15)+4,u>>>=4,c-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=Kt;break;}t.have=0,t.mode=$v;case $v:for(;t.have<t.ncode;){for(;c<3;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}t.lens[B[t.have++]]=u&7,u>>>=3,c-=3;}for(;t.have<19;)t.lens[B[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,S={bits:t.lenbits},C=Au(Yq,t.lens,0,19,t.lencode,0,t.work,S),t.lenbits=S.bits,C){r.msg="invalid code lengths set",t.mode=Kt;break;}t.have=0,t.mode=jv;case jv:for(;t.have<t.nlen+t.ndist;){for(;g=t.lencode[u&(1<<t.lenbits)-1],b=g>>>24,y=g>>>16&255,v=g&65535,!(b<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}if(v<16)u>>>=b,c-=b,t.lens[t.have++]=v;else{if(v===16){for(T=b+2;c<T;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}if(u>>>=b,c-=b,t.have===0){r.msg="invalid bit length repeat",t.mode=Kt;break;}I=t.lens[t.have-1],f=3+(u&3),u>>>=2,c-=2;}else if(v===17){for(T=b+3;c<T;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}u>>>=b,c-=b,I=0,f=3+(u&7),u>>>=3,c-=3;}else{for(T=b+7;c<T;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}u>>>=b,c-=b,I=0,f=11+(u&127),u>>>=7,c-=7;}if(t.have+f>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=Kt;break;}for(;f--;)t.lens[t.have++]=I;}}if(t.mode===Kt)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=Kt;break;}if(t.lenbits=9,S={bits:t.lenbits},C=Au(Av,t.lens,0,t.nlen,t.lencode,0,t.work,S),t.lenbits=S.bits,C){r.msg="invalid literal/lengths set",t.mode=Kt;break;}if(t.distbits=6,t.distcode=t.distdyn,S={bits:t.distbits},C=Au(Cv,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,S),t.distbits=S.bits,C){r.msg="invalid distances set",t.mode=Kt;break;}if(t.mode=Zf,e===$f)break e;case Zf:t.mode=Hf;case Hf:if(a>=6&&l>=258){r.next_out=o,r.avail_out=l,r.next_in=s,r.avail_in=a,t.hold=u,t.bits=c,Uq(r,d),o=r.next_out,i=r.output,l=r.avail_out,s=r.next_in,n=r.input,a=r.avail_in,u=t.hold,c=t.bits,t.mode===ns&&(t.back=-1);break;}for(t.back=0;g=t.lencode[u&(1<<t.lenbits)-1],b=g>>>24,y=g>>>16&255,v=g&65535,!(b<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}if(y&&(y&240)===0){for(E=b,P=y,M=v;g=t.lencode[M+((u&(1<<E+P)-1)>>E)],b=g>>>24,y=g>>>16&255,v=g&65535,!(E+b<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}u>>>=E,c-=E,t.back+=E;}if(u>>>=b,c-=b,t.back+=b,t.length=v,y===0){t.mode=Jv;break;}if(y&32){t.back=-1,t.mode=ns;break;}if(y&64){r.msg="invalid literal/length code",t.mode=Kt;break;}t.extra=y&15,t.mode=Zv;case Zv:if(t.extra){for(T=t.extra;c<T;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}t.length+=u&(1<<t.extra)-1,u>>>=t.extra,c-=t.extra,t.back+=t.extra;}t.was=t.length,t.mode=Hv;case Hv:for(;g=t.distcode[u&(1<<t.distbits)-1],b=g>>>24,y=g>>>16&255,v=g&65535,!(b<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}if((y&240)===0){for(E=b,P=y,M=v;g=t.distcode[M+((u&(1<<E+P)-1)>>E)],b=g>>>24,y=g>>>16&255,v=g&65535,!(E+b<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}u>>>=E,c-=E,t.back+=E;}if(u>>>=b,c-=b,t.back+=b,y&64){r.msg="invalid distance code",t.mode=Kt;break;}t.offset=v,t.extra=y&15,t.mode=Kv;case Kv:if(t.extra){for(T=t.extra;c<T;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}t.offset+=u&(1<<t.extra)-1,u>>>=t.extra,c-=t.extra,t.back+=t.extra;}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=Kt;break;}t.mode=Qv;case Qv:if(l===0)break e;if(f=d-l,t.offset>f){if(f=t.offset-f,f>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=Kt;break;}f>t.wnext?(f-=t.wnext,p=t.wsize-f):p=t.wnext-f,f>t.length&&(f=t.length),m=t.window;}else m=i,p=o-t.offset,f=t.length;f>l&&(f=l),l-=f,t.length-=f;do i[o++]=m[p++];while(--f);t.length===0&&(t.mode=Hf);break;case Jv:if(l===0)break e;i[o++]=t.length,l--,t.mode=Hf;break;case j0:if(t.wrap){for(;c<32;){if(a===0)break e;a--,u|=n[s++]<<c,c+=8;}if(d-=l,r.total_out+=d,t.total+=d,d&&(r.adler=t.check=t.flags?Sr(t.check,i,d,o-d):yu(t.check,i,d,o-d)),d=l,(t.flags?u:nE(u))!==t.check){r.msg="incorrect data check",t.mode=Kt;break;}u=0,c=0;}t.mode=eE;case eE:if(t.wrap&&t.flags){for(;c<32;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8;}if(u!==(t.total&4294967295)){r.msg="incorrect length check",t.mode=Kt;break;}u=0,c=0;}t.mode=tE;case tE:C=Vq;break e;case Kt:C=Tv;break e;case rE:return Rv;case jq:default:return qn;}return r.next_out=o,r.avail_out=l,r.next_in=s,r.avail_in=a,t.hold=u,t.bits=c,(t.wsize||d!==r.avail_out&&t.mode<Kt&&(t.mode<j0||e!==Mv))&&uE(r,r.output,r.next_out,d-r.avail_out),h-=r.avail_in,d-=r.avail_out,r.total_in+=h,r.total_out+=d,t.total+=d,t.wrap&&d&&(r.adler=t.check=t.flags?Sr(t.check,i,d,r.next_out-d):yu(t.check,i,d,r.next_out-d)),r.data_type=t.bits+(t.last?64:0)+(t.mode===ns?128:0)+(t.mode===Zf||t.mode===$0?256:0),(h===0&&d===0||e===Mv)&&C===Oo&&(C=$q),C;},nz=r=>{if(!r||!r.state)return qn;let e=r.state;return e.window&&(e.window=null),r.state=null,Oo;},iz=(r,e)=>{if(!r||!r.state)return qn;let t=r.state;return(t.wrap&2)===0?qn:(t.head=e,e.done=!1,Oo);},sz=(r,e)=>{let t=e.length,n,i,s;return!r||!r.state||(n=r.state,n.wrap!==0&&n.mode!==jf)?qn:n.mode===jf&&(i=1,i=yu(i,e,t,0),i!==n.check)?Tv:(s=uE(r,e,t,t),s?(n.mode=rE,Rv):(n.havedict=1,Oo));},oz=sE,az=oE,lz=iE,uz=ez,cz=aE,hz=rz,fz=nz,dz=iz,pz=sz,mz="pako inflate (from Nodeca project)",is={inflateReset:oz,inflateReset2:az,inflateResetKeep:lz,inflateInit:uz,inflateInit2:cz,inflate:hz,inflateEnd:fz,inflateGetHeader:dz,inflateSetDictionary:pz,inflateInfo:mz};function gz(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1;}var xz=gz,cE=Object.prototype.toString,{Z_NO_FLUSH:bz,Z_FINISH:yz,Z_OK:Cu,Z_STREAM_END:K0,Z_NEED_DICT:Q0,Z_STREAM_ERROR:wz,Z_DATA_ERROR:hE,Z_MEM_ERROR:vz}=Mo;function Mu(r){this.options=Xf.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(r&&r.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ev(),this.strm.avail_out=0;let t=is.inflateInit2(this.strm,e.windowBits);if(t!==Cu)throw new Error(Co[t]);if(this.header=new xz(),is.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Bu.string2buf(e.dictionary):cE.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=is.inflateSetDictionary(this.strm,e.dictionary),t!==Cu)))throw new Error(Co[t]);}Mu.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i=this.options.dictionary,s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?yz:bz,cE.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),s=is.inflate(t,o),s===Q0&&i&&(s=is.inflateSetDictionary(t,i),s===Cu?s=is.inflate(t,o):s===hE&&(s=Q0));t.avail_in>0&&s===K0&&t.state.wrap>0&&r[t.next_in]!==0;)is.inflateReset(t),s=is.inflate(t,o);switch(s){case wz:case hE:case Q0:case vz:return this.onEnd(s),this.ended=!0,!1;}if(a=t.avail_out,t.next_out&&(t.avail_out===0||s===K0))if(this.options.to==="string"){let l=Bu.utf8border(t.output,t.next_out),u=t.next_out-l,c=Bu.buf2string(t.output,l);t.next_out=u,t.avail_out=n-u,u&&t.output.set(t.output.subarray(l,l+u),0),this.onData(c);}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(s===Cu&&a===0)){if(s===K0)return s=is.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(t.avail_in===0)break;}}return!0;},Mu.prototype.onData=function(r){this.chunks.push(r);},Mu.prototype.onEnd=function(r){r===Cu&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Xf.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg;};function J0(r,e){let t=new Mu(e);if(t.push(r),t.err)throw t.msg||Co[t.err];return t.result;}function Ez(r,e){return e=e||{},e.raw=!0,J0(r,e);}var Pz=Mu,_z=J0,Sz=Ez,Bz=J0,Iz=Mo,Az={Inflate:Pz,inflate:_z,inflateRaw:Sz,ungzip:Bz,constants:Iz},{Deflate:Cz,deflate:Mz,deflateRaw:Tz,gzip:Rz}=Oq,{Inflate:Nz,inflate:Lz,inflateRaw:Oz,ungzip:kz}=Az,fE=Cz,dE=Mz,pE=Tz,mE=Rz,gE=Nz,xE=Lz,bE=Oz,yE=kz,wE=Mo,eg={Deflate:fE,deflate:dE,deflateRaw:pE,gzip:mE,Inflate:gE,inflate:xE,inflateRaw:bE,ungzip:yE,constants:wE};var ss=3e4,tg=Rn(),Tu=E2(()=>{if(tg["META-engine-env"])return tg["META-engine-env"];if(tg.document){let r=document.querySelector('meta[name="engine-env"]');return r&&r.content||"";}else return"";});function rg(){switch(Tu()){case"editor":case"editor-pro":case"global-editor":case"global-editor-pro":return"";case"3rd-dev":return"https://dev.lceda.cn";case"3rd-pro-dev":return"https://devpro.lceda.cn";case"3rd-global":return"https://easyeda.com";case"3rd-china":return"https://lceda.cn";case"3rd-pro-china":return"https://pro.lceda.cn";default:return"http://localhost";}}function vE(){switch(Tu()){case"global-editor":case"global-editor-pro":case"3rd-global":return"https://modules.easyeda.com";case"private-editor-pro":return"/storage";default:return"https://modules.lceda.cn";}}function EE(r){let e=new URLSearchParams();return Tu()==="3rd-global"?(e.append("numbers",JSON.stringify(r)),ri(`${rg()}/api/components/searchByNumbers`,{method:"POST",body:e},ss)):(e.append("codes",r.join(",")),ri(`${rg()}/api/products/getPackageUuidByCodes?${e.toString()}`,{method:"GET"},ss));}function PE(r){let e=new URLSearchParams();return e.append("uuids",JSON.stringify(r)),ri(`${rg()}/api/components/searchByUuids`,{method:"POST",body:e},ss);}function _E(r){return ri(`${vE()}/3dmodel/${r}`,{method:"GET"},ss);}function SE(r){return ri(`${vE()}/qAxj6KHrDKw4blvCG8QJPs7Y/${r}`,{method:"GET"},ss);}function ng(r){let e=/^(.+)\|(.+)$/.exec(r);if(e){let t=new URLSearchParams();return t.append("fileName",e[1]),t.append("filePath",e[2]),ri(`/api/client/stepFileInfo?${t}`,{method:"GET"},ss);}else throw new Error(`invalid client module identity ${JSON.stringify(r)}`);}function BE(r){return ri(`${location.origin}/api/client/model/${r}/get`,{method:"GET"},ss);}function IE(r,e){return Se(this,null,function*(){return ri(`${location.origin}/api/client/model/${r}/upload`,{method:"POST",body:e},ss);});}var Uz=(s=>(s.STEP2OBJ="/occapi/api/convert/step2obj",s.PCB2STEP="/occapi/api/convert/pcb2step",s.TCL2STEP="/occapi/api/convert/tcl2step",s.TCL2STL="/occapi/api/convert/tcl2stl",s.TCL2OBJ="/occapi/api/convert/tcl2obj",s))(Uz||{});function u3e(r,e){let t=eg.gzip(e);return ri(r,{method:"POST",cache:"no-cache",credentials:"same-origin",body:t},300*1e3);}function c3e(r){return ri(`/occapi/api/downloadTemp/${r}`,{method:"GET"},ss);}var ko=ki(fu()),Kf=class{constructor(){this.uuid=Dh();this.broadcastBus=new ko.BroadcastChannelMessageBus(this.uuid);this.messageBus=new ko.MessageBus();if(typeof window!="undefined"){let e=window._MSG_BUS_=window._MSG_BUS_||new ko.MessageBus();this.broadcastBus.subscribe("/worker/pcb2step/progress",t=>{e.publish("/worker/pcb2step/progress",t);});}}};function ig(r,e){/^https?:/.test(r)||(r=location.origin+r);let t=`
		self['META-engine-env'] = ${JSON.stringify(Tu())};
		self['BROAD_CAST_BUS_UUID'] = ${JSON.stringify(e)};
		console.log(${JSON.stringify(r)});
		try{
			importScripts(${JSON.stringify(r)});
		}catch(e){
			console.error(e);
		}
	
	`;return URL.createObjectURL(new Blob([t]));}var AE=class extends Kf{constructor(t,n,i=1e4){super();this.tasks=new Es((t,n)=>t.lastUpdate-n.lastUpdate);this.sem=new vo(t),this.workerUrl=ig(n,this.uuid);let s=()=>{let o=performance.now();for(;;){let a=this.tasks.poll();if(a){if(o-a.lastUpdate>i)a.bridge.discard();else{this.tasks.add(a);break;}}else break;}setTimeout(s,1e3);};s();}rpcCall(t,n,i=1e4){return Se(this,null,function*(){yield this.sem.acquireSync();let s=this.next();try{return i>0?yield s.bridge.rpcCall(t,n,i):yield s.bridge.rpcCall(t,n);}finally{this.sem.release(),s.lastUpdate=performance.now(),this.tasks.add(s);}});}runOnce(t){return Se(this,null,function*(){yield this.sem.acquireSync();let n=this.next();try{return yield t((i,s)=>Se(this,null,function*(){return yield n.bridge.rpcCall(i,s);}));}finally{this.sem.release(),n.bridge.discard();}});}next(){return this.tasks.poll()||{bridge:new ko.WorkerMessageBridge(this.messageBus,new Worker(this.workerUrl)),lastUpdate:0};}},Si=class extends Kf{constructor(){super(),Qf(this.messageBus,this.uuid);}rpcCall(e,t){return this.messageBus.rpcCall(e,t);}runOnce(e){return Se(this,null,function*(){return yield e(this.messageBus.rpcCall.bind(this.messageBus));});}};var dr=class{};dr.LayerVisible=!1,dr.LayerCreate=!1,dr.UpdateLayerPhysics=!1,dr.LayerSetPos=!1,dr.LayerSetThickness=!1,dr.LayerInterfaceThickness=!1,dr.MarkDrawn=!1,dr.LoadModelType=!1,dr.DrawDebug=!1,dr.LayerSubstrate=!1;function CE(r,e,t,n,i=1e4,s=!1){return Se(this,null,function*(){let o=!0;for(let a of r)if(a.items.length!==0){o=!1;break;}if(o){for(let a of e)if(a.items.length!==0){o=!1;break;}}if(o)return ct.buildBBox(t);if(s){let a=[ei.UNION];r.forEach(u=>a.push(u));let l=[ei.UNION];return e.forEach(u=>l.push(u)),yield Jf([ei.DIFF,a,l],n,i);}else{let a=[ei.DIFF,ct.buildBBox(t.extendOfSize(100))];r.forEach(h=>a.push(h)),e.forEach(h=>a.push(h));let l=yield Jf(a,n,i);if(l.items.length<=1)return console.warn(`outline not closed ${l.items.length}`),l;let u=Number.NEGATIVE_INFINITY,c;for(let h of l.items)h.bbox().area()>u&&(u=h.bbox().area(),c=h);return new ct(l.items.filter(h=>h!==c));}});}function k3e(r,e,t,n=1e4){return Se(this,null,function*(){if(!r||r.length===0)return[];let i=[],s=r.map(o=>Se(this,null,function*(){let a=[ei.DIFF,ct.buildBBox(e.extendOfSize(100))];o.forEach(f=>a.push(f));let l=yield Jf(a,t,n);if(l.items.length<=1)return;let u=Number.NEGATIVE_INFINITY,c,h=Number.NEGATIVE_INFINITY,d;for(let f of l.items){let p=f.bbox().area();p>u?(h=u,d=c,u=p,c=f):p>h&&(h=p,d=f);}i.push(d);}));return yield Promise.all(s),i;});}function U3e(r,e,t,n=1e4){if(!e||e.length===0)return r;let i=[ei.DIFF,r];return e.forEach(s=>i.push(s)),Jf(i,t,n);}function Jf(r,e,t){return Se(this,null,function*(){dr.LayerSubstrate&&console.warn("/worker/runBoolean",t),console.log("pool",e instanceof Si,navigator.hardwareConcurrency);let n=(yield e.rpcCall("/worker/runBoolean",Th([r]),300*1e3)).message;dr.LayerSubstrate&&console.warn("/worker/runBoolean",n.byteLength);let i=wo(n);return dr.LayerSubstrate&&console.warn("/worker/runBoolean decode",i),i.results[0].group;});}function D3e(r,e,t){return Se(this,null,function*(){return wo(tu([yo(wo(Th([r])).rulesArr[0])])).results[0].group;});}var sg=(le=>(le.ANALYSIS_OUT_LINE="ANALYSIS_OUT_LINE",le.ANALYSIS_IN_LINE="ANALYSIS_IN_LINE",le.ANALYSIS_HOLE_NPTH="ANALYSIS_HOLE_NPTH",le.ANALYSIS_HOLE_PTH="ANALYSIS_HOLE_PTH",le.ANALYSIS_TOP_PAD="ANALYSIS_TOP_PAD",le.ANALYSIS_BOTTOM_PAD="ANALYSIS_BOTTOM_PAD",le.ANALYSIS_PTH_FILL="ANALYSIS_PTH_FILL",le.ANALYSIS_PTH_FILL_VIA="ANALYSIS_PTH_FILL_VIA",le.ANALYSIS_PTH_NO_VIA="ANALYSIS_PTH_NO_VIA",le.DETECT_OUTLINE="DETECT_OUTLINE",le.OUTLINE="OUTLINE",le.MULTI="MULTI",le.TOP_ASSEMBLY="TOP_ASSEMBLY",le.TOP_PASTE_MASK="TOP_PASTE_MASK",le.TOP_SILK="TOP_SILK",le.TOP_SPRAY="TOP_SPRAY",le.TOP_SOLDER_MASK="TOP_SOLDER_MASK",le.TOP="TOP",le.SIGNAL="SIGNAL",le.BOTTOM="BOTTOM",le.BOT_SOLDER_MASK="BOT_SOLDER_MASK",le.BOT_SPRAY="BOT_SPRAY",le.BOT_SILK="BOT_SILK",le.BOT_PASTE_MASK="BOT_PASTE_MASK",le.BOT_ASSEMBLY="BOT_ASSEMBLY",le.MECHANICAL="MECHANICAL",le.DOCUMENT="DOCUMENT",le.HOLE="HOLE",le.SUBSTRATE="SUBSTRATE",le.TOP_STIFFENER="TOP_STIFFENER",le.BOTTOM_STIFFENER="BOTTOM_STIFFENER",le.PRINT_LAYER="PRINT_LAYER",le.WHITE_COVER_LAYER="WHITE_COVER_LAYER",le.BLACK_COVER_LAYER="BLACK_COVER_LAYER",le.BOARD_LAYER="BOARD_LAYER",le.GLUE_LAYER="GLUE_LAYER",le.LIGHT_LAYER="LIGHT_LAYER",le.BUN_LAYER="BUN_LAYER",le.TOP_QRCODE="TOP_QRCODE",le.BOT_QRCODE="BOT_QRCODE",le))(sg||{}),ed=class{constructor(){this.typeConfigIndex={};this.multiOrderIndex={};this.typeOrder=0;this.buildOrder=0;this.electricalLayerIds=[];this.pushedBot=!1;this.groupIndex={};this.groupIndex["TOP_SILK"]=1,this.groupIndex["TOP_SPRAY"]=1,this.groupIndex["ANALYSIS_PTH_FILL_VIA"]=1,this.groupIndex["TOP_SOLDER_MASK"]=1,this.groupIndex["TOP"]=1,this.groupIndex["BOTTOM"]=2,this.groupIndex["BOT_SOLDER_MASK"]=2,this.groupIndex["BOT_SPRAY"]=2,this.groupIndex["BOT_SILK"]=2,this.initTypes();}setGroup(e){Object.assign(this.groupIndex,e);for(let t of Object.entries(this.groupIndex))t[1]===0&&delete this.groupIndex[t[0]];this.clear();}clear(){Object.keys(this.typeConfigIndex).forEach(e=>delete this.typeConfigIndex[e]),Object.keys(this.multiOrderIndex).forEach(e=>delete this.multiOrderIndex[e]),this.typeOrder=0,this.buildOrder=0,this.electricalLayerIds.length=0,this.pushedBot=!1,this.initTypes();}registType(e,t,n){this.typeConfigIndex[e]={type:e,group:t,material:n,typeOrder:this.typeOrder++};}buildLayerConfig(e,t,n,i){return t==="TOP"?this.electricalLayerIds.unshift(e):t==="SIGNAL"?this.pushedBot?this.electricalLayerIds.splice(this.electricalLayerIds.length-1,0,e):this.electricalLayerIds.push(e):t==="BOTTOM"&&(this.electricalLayerIds.push(e),this.pushedBot=!0),t in this.typeConfigIndex||this.registType(t,0,null),this.buildOrder++,{id:e,name:n,color:i,material:this.typeConfigIndex[t].material,buildOrder:this.buildOrder,thickness:0,typeConfig:this.typeConfigIndex[t]};}adjustMultiOrder(){let e=[],t=0;for(let i of Object.values(this.typeConfigIndex)){let s=i.type;s==="OUTLINE"?t++:s==="MULTI"?(t++,this.multiOrderIndex[s]=i.typeOrder):s.startsWith("MULTI-")&&e.push(i);}e.sort((i,s)=>i.typeOrder-s.typeOrder);for(let i of Object.values(this.typeConfigIndex)){let s=i.type;if(!(s==="MULTI"||s.startsWith("MULTI-")||s==="OUTLINE"))for(let o of e)o.typeOrder>i.typeOrder&&i.typeOrder++;}let n=[];for(let i of e){let[s,o,a]=i.type.split("-"),l=Math.min(this.electricalLayerIds.indexOf(Number(o)),this.electricalLayerIds.indexOf(Number(a))),u=n[l];u||(u=[],n[l]=u),u.push(i);}for(let i of n)if(!!i)for(let s of i)s.typeOrder=t,this.multiOrderIndex[s.type]=t++;}setMultiLoc(e){if(e)for(let t of Object.entries(this.multiOrderIndex))this.typeConfigIndex[t[0]].typeOrder=t[1];else{let t=this.typeOrder;for(let n of Object.entries(this.multiOrderIndex).sort((i,s)=>s[1]-i[1]).map(i=>i[0]))this.typeConfigIndex[n].typeOrder=t++;}}initTypes(){this.registType("OUTLINE",this.groupIndex["OUTLINE"]||0,null),this.registType("MULTI",this.groupIndex["MULTI"]||0,null),this.registType("TOP_ASSEMBLY",this.groupIndex["TOP_ASSEMBLY"]||0,null),this.registType("TOP_PASTE_MASK",this.groupIndex["TOP_PASTE_MASK"]||0,"silver"),this.registType("TOP_QRCODE",this.groupIndex["TOP_QRCODE"]||0,"silk_white"),this.registType("TOP_SILK",this.groupIndex["TOP_SILK"]||0,"silk_white"),this.registType("TOP_SPRAY",this.groupIndex["TOP_SPRAY"]||0,"silver"),this.registType("ANALYSIS_PTH_FILL_VIA",this.groupIndex["ANALYSIS_PTH_FILL_VIA"]||0,"solder_mask_green_without_copper"),this.registType("TOP_STIFFENER",this.groupIndex["TOP_STIFFENER"]||0,null),this.registType("TOP_SOLDER_MASK",this.groupIndex["TOP_SOLDER_MASK"]||0,"solder_mask_green"),this.registType("TOP",this.groupIndex["TOP"]||0,"brass"),this.registType("SIGNAL",this.groupIndex["SIGNAL"]||0,"brass"),this.registType("BOTTOM",this.groupIndex["BOTTOM"]||0,"brass"),this.registType("BOT_SOLDER_MASK",this.groupIndex["BOT_SOLDER_MASK"]||0,"solder_mask_green"),this.registType("BOTTOM_STIFFENER",this.groupIndex["BOTTOM_STIFFENER"]||0,null),this.registType("BOT_SPRAY",this.groupIndex["BOT_SPRAY"]||0,"silver"),this.registType("BOT_SILK",this.groupIndex["BOT_SILK"]||0,"silk_white"),this.registType("BOT_QRCODE",this.groupIndex["BOT_QRCODE"]||0,"silk_white"),this.registType("BOT_PASTE_MASK",this.groupIndex["BOT_PASTE_MASK"]||0,"silver"),this.registType("BOT_ASSEMBLY",this.groupIndex["BOT_ASSEMBLY"]||0,null),this.registType("MECHANICAL",this.groupIndex["MECHANICAL"]||0,null),this.registType("DOCUMENT",this.groupIndex["DOCUMENT"]||0,null),this.registType("HOLE",this.groupIndex["HOLE"]||0,null),this.registType("SUBSTRATE",this.groupIndex["SUBSTRATE"]||0,"substrate_yellow"),this.registType("BUN_LAYER",this.groupIndex["BUN_LAYER"]||0,"silk_white"),this.registType("PRINT_LAYER",this.groupIndex["PRINT_LAYER"]||0,"silk_white"),this.registType("WHITE_COVER_LAYER",this.groupIndex["WHITE_COVER_LAYER"]||0,"silk_white"),this.registType("BLACK_COVER_LAYER",this.groupIndex["BLACK_COVER_LAYER"]||0,"silk_white"),this.registType("BOARD_LAYER",this.groupIndex["BOARD_LAYER"]||0,"substrate_yellow"),this.registType("GLUE_LAYER",this.groupIndex["GLUE_LAYER"]||0,"silk_white"),this.registType("LIGHT_LAYER",this.groupIndex["LIGHT_LAYER"]||0,"silk_white");}setPrintMethod(e){let t=this.typeConfigIndex["PRINT_LAYER"],n=this.typeConfigIndex["BOARD_LAYER"];if(e&&t.typeOrder<n.typeOrder||!e&&t.typeOrder>n.typeOrder)return;let i=this.typeConfigIndex["WHITE_COVER_LAYER"],s=this.typeConfigIndex["BLACK_COVER_LAYER"],o=this.typeConfigIndex["BUN_LAYER"],a=t.typeOrder,l=n.typeOrder,u=i.typeOrder,c=s.typeOrder,h=o.typeOrder;e?(o.typeOrder=l,t.typeOrder=h,i.typeOrder=a,s.typeOrder=u,n.typeOrder=c):(n.typeOrder=h,o.typeOrder=a,t.typeOrder=u,i.typeOrder=c,s.typeOrder=l);}};var ME=`v 0.5 0 0.5
v -0.5 0 0.5
v 0 0.5 0.5
v 0 -0.5 0.5
v 0 0 1
v 0 0 0

v 0.5 0.5 1
v 0.5 0 1
v 0.5 -0.5 1
v 0 -0.5 1
v -0.5 -0.5 1
v -0.5 0 1
v -0.5 0.5 1
v 0 0.5 1

v 0.5 0.5 0.5
v 0.5 -0.5 0.5
v -0.5 -0.5 0.5
v -0.5 0.5 0.5

v 0.5 0.5 0
v 0.5 0 0
v 0.5 -0.5 0
v 0 -0.5 0
v -0.5 -0.5 0
v -0.5 0 0
v -0.5 0.5 0
v 0 0.5 0

newmtl white
Ka 1 1 1
Kd 1 1 1
Ks 0 0 0
d 0.0
endmtl

usemtl white

f 1// 7// 8//
f 1// 15// 7//
f 1// 16// 21//
f 1// 21// 20//
f 2// 11// 12//
f 2// 17// 11//
f 2// 18// 25//
f 2// 25// 24//
f 3// 14// 7//
f 3// 7// 15//
f 3// 25// 18//
f 3// 26// 25//
f 4// 10// 11//
f 4// 11// 17//
f 4// 21// 16//
f 4// 22// 21//
f 5// 13// 12//
f 5// 14// 13//
f 5// 9// 8//
f 5// 10// 9//
f 6// 19// 20//
f 6// 26// 19//
f 6// 22// 23//
f 6// 23// 24//

newmtl black
Ka 0 0 0
Kd 0 0 0
Ks 0 0 0
d 0.0
endmtl

usemtl black

f 1// 8// 9//
f 1// 9// 16//
f 1// 19// 15//
f 1// 20// 19//
f 2// 12// 13//
f 2// 13// 18//
f 2// 23// 17//
f 2// 24// 23//
f 3// 13// 14//
f 3// 18// 13//
f 3// 15// 19//
f 3// 19// 26//
f 4// 9// 10//
f 4// 16// 9//
f 4// 17// 23//
f 4// 23// 22//
f 5// 8// 7//
f 5// 7// 14//
f 5// 11// 10//
f 5// 12// 11//
f 6// 20// 21//
f 6// 21// 22//
f 6// 24// 25//
f 6// 25// 26//`;var TE=`v 0.5 0.5 1
v -0.5 -0.5 1
v -0.5 0.5 1
v 0.5 0.5 0
v 0.5 -0.5 1
v 0.5 -0.5 0
v -0.5 -0.5 0
v -0.5 0.5 0

newmtl gray
Ka 0.4 0.4 0.4
Kd 0.4 0.4 0.4
Ks 0 0 0
d 0.0
endmtl

usemtl gray

f 1// 5// 6//
f 1// 6// 4//
f 2// 3// 8//
f 2// 8// 7//
f 1// 8// 3//
f 1// 4// 8//
f 2// 6// 5//
f 2// 7// 6//
f 3// 5// 1//
f 3// 2// 5//
f 4// 6// 7//
f 4// 7// 8//
`;var os=class{constructor(e,t){this.cacheIndex=new Map();this.pending=new Array();this.ticket=0;this.loader=t,this.name=e+performance.now();}addCache(e,t){let n=null,i=new Promise(s=>{n=s,s(t);});this.cacheIndex.set(e,{promise:i,resolve:n});}keys(){return this.cacheIndex.keys();}fetch(e){var n;let t=(n=this.cacheIndex.get(e))==null?void 0:n.promise;if(!t){let i=null;t=new Promise(s=>{i=s;}),this.cacheIndex.set(e,{promise:t,resolve:i}),this.addPending(e);}return t;}clear(){this.cacheIndex.clear();}addPending(e){this.pending.push(e),this.ticket===0&&(this.ticket=1,Promise.resolve().then(()=>{this.ticket=0;let t=this.pending.slice();this.pending.length=0,this.loader(t,(n,i)=>{var s;(s=this.cacheIndex.get(n))==null||s.resolve(i);});}));}};var og=qe.YELLOW,td=new qe(1,0,1),RE=1,rd=new We(),Xs=[new pe(-.5,-.5,0),new pe(-.5,.5,0),new pe(.5,.5,0),new pe(.5,-.5,0)],NE=[];for(let r=0;r<4;r++)NE.push(Xs[r],Xs[(r+1)%4]);rd.add(new Et(new Fa(NE,null),og,null,"sub1")),rd.add(new Et(new fr([Xs[0],Xs[1],Xs[2],Xs[2],Xs[3],Xs[0]]),qe.ZERO));var ii=class{constructor(e=0,t=0,n=0,i=0,s=0,o=0,a=""){this.componentShape=[];this.componentGroup=new We(0);this.componentWireframeGroup=new We(0);this.pinShape=[];this.pinGroup=new We(0);this.pinWireframeGroup=new We(0);this.polarityShape=[];this.polarityGroup=new We(0);this.polarityWireframeGroup=new We(0);this.padShape={};this.pad1Group=new We(0);this.pad1WireframeGroup=new We(0);this.holeShape=[];this.frameGroup=new We(0);this.modelGroup=new We();this.group=new We();this.x=e,this.y=t,this.z=n,this.rx=i,this.ry=s,this.rz=o,this.uuid=a,this.group.add(this.modelGroup),this.group.add(this.componentGroup),this.group.add(this.componentWireframeGroup),this.group.add(this.pinGroup),this.group.add(this.pinWireframeGroup),this.group.add(this.polarityGroup),this.group.add(this.polarityWireframeGroup),this.group.add(this.pad1Group),this.group.add(this.pad1WireframeGroup),this.group.add(this.frameGroup),this.componentGroup.setVisible(!1),this.componentWireframeGroup.setVisible(!1),this.pinGroup.setVisible(!1),this.pinWireframeGroup.setVisible(!1),this.polarityGroup.setVisible(!1),this.polarityWireframeGroup.setVisible(!1),this.pad1Group.setVisible(!1),this.pad1WireframeGroup.setVisible(!1),this.frameGroup.setVisible(!1);}beAdd(e){e.add(this.group);}setModel(e){this.modelGroup.clear(),this.modelGroup.add(e);}getBBox(){return this.group.getBBox();}setVisible(e){this.group.setVisible(e);}gnrTriangles(e,t){let n=[];return t+=this.modelGroup.getBBox().maxZ,e.forEach(i=>i.triangles(RE,s=>n.push(new pe(s.x,s.y,t)))),new fr(n);}gnrLines(e,t){let n=[];return t+=this.modelGroup.getBBox().maxZ,e.forEach(i=>i.lines(RE,s=>n.push(new pe(s.x,s.y,t)))),new Fa(n);}gnrAll(){if(this.componentShape.length!==0&&(this.componentGroup.add(new Et(this.gnrTriangles(this.componentShape,ii.componentZ),qe.YELLOW)),this.componentWireframeGroup.add(new Et(this.gnrLines(this.componentShape,ii.componentZ),qe.YELLOW))),this.pinShape.length!==0&&(this.pinGroup.add(new Et(this.gnrTriangles(this.pinShape,ii.pinZ),og,null,"sub1")),this.pinWireframeGroup.add(new Et(this.gnrLines(this.pinShape,ii.pinZ),og,null,"sub1"))),this.polarityShape.length!==0&&(this.polarityGroup.add(new Et(this.gnrTriangles(this.polarityShape,ii.polarityZ),td,null,"sub2")),this.polarityWireframeGroup.add(new Et(this.gnrLines(this.polarityShape,ii.polarityZ),td,null,"sub2"))),this.padShape[1]&&this.padShape[1].length!==0&&(this.pad1Group.add(new Et(this.gnrTriangles(this.padShape[1],ii.pad1Z),td,null,"sub2")),this.pad1WireframeGroup.add(new Et(this.gnrLines(this.padShape[1],ii.pad1Z),td,null,"sub2"))),this.pinShape.length!==0||this.componentShape.length!==0){let e=this.getFrameBBox();this.frameGroup.add(rd);let t=e.center();this.frameGroup.setPosition(new pe(t.x,t.y,this.modelGroup.getBBox().maxZ+ii.frameZ)),this.frameGroup.setScale(new pe(e.width(),e.height(),1));}}getFrameBBox(){let e=new ke();for(let t of this.pinShape.concat(this.componentShape))e.ext1(t.bbox());return e.build();}getComponentBBox(){try{let e=new ke();for(let t of this.componentShape)e.ext1(t.bbox());return e.build();}catch(e){return;}}setFrameVisible(e){this.frameGroup.setVisible(e);}static setFrameColor(e){for(let t of rd.getContents())t.elements instanceof Fa&&t.setColor(e);}setModelVisible(e){this.modelGroup.setVisible(e);}setComponentVisible(e){this.componentGroup.setVisible(e);}setComponentColor(e){for(let t of this.componentGroup.getContents())t.setColor(e);}setComponentWireframeVisible(e){this.componentWireframeGroup.setVisible(e);}setComponentWireframeColor(e){for(let t of this.componentWireframeGroup.getContents())t.setColor(e);}setPinVisible(e){this.pinGroup.setVisible(e);}setPinColor(e){for(let t of this.pinGroup.getContents())t.setColor(e);}setPinWireframeVisible(e){this.pinWireframeGroup.setVisible(e);}setPinWireframeColor(e){for(let t of this.pinWireframeGroup.getContents())t.setColor(e);}setPolarityVisible(e){this.polarityGroup.setVisible(e);}setPolarityColor(e){for(let t of this.polarityGroup.getContents())t.setColor(e);}setPolarityWireframeVisible(e){this.polarityWireframeGroup.setVisible(e);}setPolarityWireframeColor(e){for(let t of this.polarityWireframeGroup.getContents())t.setColor(e);}setPad1Visible(e){this.pad1Group.setVisible(e);}setPad1Color(e){for(let t of this.pad1Group.getContents())t.setColor(e);}setPad1WireframeVisible(e){this.pad1WireframeGroup.setVisible(e);}setPad1WireframeColor(e){for(let t of this.pad1WireframeGroup.getContents())t.setColor(e);}},an=ii;an.componentZ=4,an.pinZ=4,an.polarityZ=8,an.pad1Z=12,an.holeZ=0,an.frameZ=4;var nd=(o=>(o[o.TRACE=0]="TRACE",o[o.DEBUG=1]="DEBUG",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.DUMMY=5]="DUMMY",o))(nd||{}),Fz=(r,e)=>{switch(r){case 4:console.error(...e);break;case 3:console.warn(...e);break;case 2:console.info(...e);break;default:console.log(...e);}},qz=(r,e)=>e,vn=class{constructor(e,t=Fz,n=qz){this.level=e,this.writer=t,this.formatter=n;}wrap(...e){return new vn(this.level,this.writer,(t,n)=>{n=this.formatter(t,n);for(let i=e.length-1;i>=0;i--)n=e[i](t,n);return n;});}shadow(...e){return new vn(this.level,(t,n)=>{this.writer(t,n);for(let i of e)i(t,n);},this.formatter);}mix(...e){return new vn(0,(t,n)=>{this.process(t,n);for(let i of e)i.process(t,n);},(t,n)=>n);}process(e,t){this.level<=e&&this.writer(e,this.formatter(e,t));}process1(e,t,n){this.level<=e&&this.writer(e,this.formatter(e,[bn.format(t,...n)]));}trace(...e){this.process(0,e);}trace1(e,...t){this.process1(0,e,t);}debug(...e){this.process(1,e);}debug1(e,...t){this.process1(1,e,t);}info(...e){this.process(2,e);}info1(e,...t){this.process1(2,e,t);}warn(...e){this.process(3,e);}warn1(e,...t){this.process1(3,e,t);}error(...e){this.process(4,e);}error1(e,...t){this.process1(4,e,t);}},kE=new vn(5),zz=Date.now()-performance.now(),ag=new ArrayBuffer(10),Yz=new Float64Array(ag,0,1),LE=new Uint8Array(ag),OE=-1,lg=0;function hBe(){let r=zz+performance.now();return Yz[0]=r,r===OE?lg++:(lg=0,OE=r),LE[8]=Math.random()*1e3,LE[9]=lg,`X-LC-ID-${Buffer.from(ag).toString("base64")}`;}function ug(r,e=.05){if(r.length<3)return r.slice();let t=r[0],n=[t];for(let l=1;l<r.length;l++){let u=r[l];t.equals1(u)||n.push(u),t=u;}if(t!==n[n.length-1]&&(n.length!==1&&n.pop(),n.push(t)),e<0)return n;let i=n[1],s=i.sub(n[0]).normalize(),o=0,a=[n[0]];for(let l=2;l<n.length;l++){let u=n[l],c=u.sub(i).normalize();o+=Math.acos(Math.min(1,Math.max(-1,s.dot(c)))),o>e&&(a.push(i),o=0),i=u,s=c;}return a.push(i),a;}function id(r,e,t=.01){let n=[],i=[];for(let h of r)if(h instanceof q)n.length===0&&n.push(h.start()),n.push(h.end());else{let d=ug(n,t);n.length=0;let f=d[0];for(let p=1;p<d.length;p++){let m=d[p];i.push(new q(f,m)),f=m;}i.push(h);}let s=ug(n,t),o=s[0];for(let h=1;h<s.length;h++){let d=s[h];i.push(new q(o,d)),o=d;}let a=[],l,u=[];for(let h of i){if(!(h instanceof q)){c(),u.push(h);continue;}if(a.length===0){a.push(h.start(),h.end());continue;}if(!h.start().equals1(a[a.length-1])){c(),a.push(h.start(),h.end());continue;}a.push(h.end());let d=a[a.length-3],f=a[a.length-2],p=a[a.length-1],m=d.distance2(f)/p.distance2(f);if(m>4||m<.25){c(),a.push(h.start(),h.end());continue;}let g=d.sub(f).normalize(),b=p.sub(f).normalize(),y=g.dot(b);if(Ie.eq(y,-1)||y>-.95){c(),a.push(h.start(),h.end());continue;}let v=g.cross(b);if(l&&l.sweepAngle*v>0){c(),a.push(h.start(),h.end());continue;}let E=a[0];if(E.equals1(p)){l?(l=ee.build3(l.center,0,-360,l.rx,l.rx),c()):(c(),a.push(h.start(),h.end()));continue;}let P=E.add(p).scale(.5),M=E.sub(p),I=-M.y,C=M.x,L=0,S=0,T=0,B=0;for(let k of a)L+=k.x,S+=k.y,T+=Le(k.x,2),B+=Le(k.y,2);L/=a.length,S/=a.length,T/=a.length,B/=a.length;let $=E.x,Z=E.y,H=2*I*(L-$)+2*C*(S-Z);if(Ie.eq(H,0)){c(),a.push(h.start(),h.end());continue;}let W=(T-Le($,2)-2*P.x*(L-$)+B-Le(Z,2)-2*P.y*(S-Z))/H,Y=new F(P.x+W*I,P.y+W*C),U=E.distance1(Y),D;for(let k of a){if(Math.abs(k.distance1(Y)-U)>e||D&&Math.abs(k.add(D).scale(.5).distance1(Y)-U)>e){c(),a.push(h.start(),h.end());break;}D=k;}a.length!==2&&(l=ee.build2(Y,E.angleD(Y),a[a.length-1].angleD(Y),U,U,v>0?vt.CW:vt.CCW));}return c(),u;function c(){l?(u.push(l),l=null,a.length=0):a.length!==0&&(u.push(new q(a[0],a[1])),a.length=0);}}var Xz=new vn(4);function sd(r,e,t,n=null,i){return Se(this,null,function*(){let s=new Ur(1,t).ratio,o=.5*s,a=1*s,l={},u=n?1/n.scale:1,c=ze.scale(u),h,d,f,p,m,g,b=new Set(),y=[],v=M=>{switch(y[0]){case"POLY":{let I=y[2],C=y[4],L=y[5]*u,S=Uo(y[6]).map(T=>T.multiply3(c));if(S.length===0)break;if(b.has(C)){h&&P(),h=S,d=I,f=C,p=L,m=y[1],g=M,P();break;}if(!h)h=S,d=I,f=C,p=L,m=y[1],g=M;else if(S[0].start().equals1(h[h.length-1].end())&&d===I&&f===C&&p===L)for(let T of S)h.push(T);else P(),h=S,d=I,f=C,p=L,m=y[1],g=M;break;}case"POLYS":{let I=y[2],C=y[4],L=y[5]*u,S=y[6].map(T=>Me.build2(Uo(T).map(B=>B.multiply3(c))));r.onPolys(C,y[1],S,L,I,M);break;}case"FILL":{let I=y[2],C=y[4],L=y[7];UE(L,r,C,y[1],I,c,M);break;}case"FPC_FILL":{let I=y[1],C=y[2],L=y[3],S=y[4],T=new Ur(39.37,1).ratio,B=y[5]*T,$=y[6];Vz(r,I,{material:S,thickness:B}),UE($,r,L,I,C,c,M);break;}}},E=M=>{if(M=M.trim(),!M)return;let I=JSON.parse(M);if(!Array.isArray(I))return;let C=I[0];if(y){let L;C==="PROP"&&I[1]===y[1]&&(L=I[2]?typeof I[3]=="number"?qe.of5(I[2],I[3]):qe.of3(I[2]):qe.ZERO),v(L),y=null;}if(C!=="PROP"){if(C==="POLY"||C==="POLYS"||C==="FILL"||C==="FPC_FILL"){y=I;return;}switch(C){case"HEAD":{I[1].scale&&(n?(n.scale*=I[1].scale,n.scaleMatrix=ze.scale(n.scale)):(u*=I[1].scale,c=ze.scale(u))),r.onStart();break;}case"LAYER":{let L=I[1],S=I[2],T=I[3],B=I[7]&&I[8]?qe.of5(I[7],I[8]):qe.ZERO;r.onLayerConfig(L,S,T,B),l[L]=S;break;}case"LAYER_PHYS":{let L=I[1],S=I[2],T=I[3]*u;r.onLayerPhys(L,S,T);break;}case"PANELIZE":{let L=I[1],S=Boolean(I[2]);r.onPanelize(new ze([L[0],L[3],0,L[1],L[4],0,L[2]*u,L[5]*u,1]),S);break;}case"SILK_OPTS":{r.onSilkOpts(I[1],I[2]?qe.of3(I[2]):qe.ZERO,I[3]?qe.of3(I[3]):qe.ZERO),b.add(I[1]);break;}case"PRINT_METHOD":{r.onPrintMethod(I[1]===1);break;}case"TEXTURE":{let L=I[2],S=I[4],T=I[5].map(Z=>Z*u),B=I[7],$=I[8];r.onTexture(S,I[1],I[3],new F(T[0],T[1]),new F(T[2],T[3]),new F(T[4],T[5]),new F(T[6],T[7]),B&&Wz(B,c),typeof $=="number"?$:1,L);break;}case"ITEM_ORDER":{r.onItemOrder(I[1]);break;}case"COMPONENT":{let L=l[I[3]]==="TOP_ASSEMBLY",S=I[7],T=I[4]*u,B=I[5]*u,$=at.toRadians(I[6]),Z=new We();Z.setPosition(new pe(T,B,0)),Z.setRotation(new pe(0,L?0:Math.PI,$)),S.x&&(S.x*=u),S.y&&(S.y*=u),S.z&&(S.z*=u),S.dx&&(S.dx*=u),S.dy&&(S.dy*=u),S.dz&&(S.dz*=u),S.outline&&(S.outline=S.outline.map(H=>H.map(W=>Me.build2(Uo(W)).multiply3(c)))),r.onModel(I[1],L,Z,S);break;}case"SHELL":{let[L,S,T,B,$,Z,H,W,Y]=I;Y.BottomHeight&&(Y.BottomHeight*=u),Y.TopInnerHeight&&(Y.TopInnerHeight*=u),Y.BottomInnerHeight&&(Y.BottomInnerHeight*=u),r.onShellOutline(S,T,B,$*u,Z*u,H*u,W.map(U=>Me.build2(Uo(U)).multiply3(c)),Y);break;}case"CREASE":{let[L,S,T,B,$,Z,H,W,Y]=I;r.onCrease(S,new F($,Z).multiply3(c),new F(H,W).multiply3(c),Y,T);break;}case"BOSS":{let[L,S,T,B,$,Z,H,W,Y,U,D]=I;r.onBoss(S,l[B]==="3D_SHELL_TOP",new F($,Z).multiply3(c),H*u,W*u,Y*u,U?U.map(k=>k*u):null,D?D.map(k=>k*u):null,T);break;}case"SHELL_ENTITY":{let[L,S,T,B,$,Z,H,W,Y]=I,U=0,D=[];for(let k of Y){let ie=Uo(k).map(oe=>oe.multiply3(c)),se=Me.build2(ie);D.push(se),U+=se.area(.1);}r.onShellEntity(S,l[B]==="3D_SHELL_TOP",$,Z,H*u,U<0?D:D.map(k=>k.reverse()),T);break;}case"CONNECT":{r.onConnect(I[1],I[2]);break;}default:Xz.debug("ignore",I);}}};if(typeof e=="string")yield Aa(e,E,i);else for(let M of e)Aa(yield M(),E);y&&v(null),h&&P(),yield r.onEnd();function P(){let M=l[f]==="OUTLINE"?a:o;id(h,M).forEach(I=>r.onPrimitive(f,m,I,p,d,g)),h=null;}});}function UE(r,e,t,n,i,s,o){let a=0,l=new Array();for(let u of r){let c=Uo(u).map(h=>h.multiply3(s));if(c.length===1){let h=c[0];if(h instanceof ee&&Math.abs(h.sweepAngle)>=360){e.onCircle(t,n,h.center,h.rx,i,o);continue;}else if(h instanceof ti){e.onRect(t,n,h,i,o);continue;}}if(c.length!==0){let h=Me.build2(c);l.push(h),a+=h.area(.1);}}a<0?e.onPolygon(t,n,l,i,o):a>0&&e.onPolygon(t,n,l.map(u=>u.reverse()),i,o);}function Vz(r,e,t){r.onPolygonCfg(e,t);}function Ru(r,e,t,n=!1){let i=new We();i.add(r);let s=Je.ORIGIN,o=r.getBBox();if(!o)return i;let a=e.dx||0,l=e.dy||0,u=e.dz||0,c=at.toRadians(e.rx||0),h=at.toRadians(e.ry||0),d=at.toRadians(e.rz||0),f=e.x||0,p=e.y||0,m=e.z||0;if(n){if(Ie.eq(c%Math.PI,0)&&Ie.eq(h%Math.PI,0)){let g=a/(o.maxX-o.minX);isFinite(g)&&g>0&&(s=s.scale(g,1,1));let b=l/(o.maxY-o.minY);isFinite(b)&&b>0&&(s=s.scale(1,b,1)),s=s.rotateZ(d),s=s.translate1(f,p,0);}else{let g=new ke(),b=Je.rotateZ(d).rotateX(c).rotateY(h).translate1(f,p,m);new gn(-a/2,-l/2,-u/2,a/2,l/2,u/2).getVertexes().forEach(v=>{v=v.multiply4(b),g.ext6(v.x,v.y);});let y=g.build();if(!Ie.eq(y.area(),0)){s=s.scale(y.width()/(o.maxX-o.minX),y.height()/(o.maxY-o.minY),1);let v=y.center();s=s.translate1(v.x,v.y,0);}}}else{let g=(o.maxX+o.minX)/2,b=(o.maxY+o.minY)/2,y=o.minZ;if(s=s.translate1(-g,-b,-y),t&&isFinite(e.scale)&&e.scale>0)s=s.scale(e.scale);else if(t){let v=new Array();v.push(a/(o.maxX-o.minX)),v.push(l/(o.maxY-o.minY)),v.push(u/(o.maxZ-o.minZ));let E=Math.min(...v.filter(P=>isFinite(P)&&P>0));isFinite(E)&&E>0&&(s=s.scale(E));}else{let v=a/(o.maxX-o.minX);isFinite(v)&&v>0&&(s=s.scale(v,1,1));let E=l/(o.maxY-o.minY);isFinite(E)&&E>0&&(s=s.scale(1,E,1));let P=u/(o.maxZ-o.minZ);isFinite(P)&&P>0&&(s=s.scale(1,1,P));}s=s.rotateZ(d).rotateX(c).rotateY(h),s=s.translate1(f,p,m);}return i.setAddiMatrix(s),i;}function Wz(r,e){let t=0,n=new Array();for(let i of r){let s=Uo(i).map(o=>o.multiply3(e));if(s.length!==0){let o=Me.build2(s);n.push(o),t+=o.area(.1);}}if(t<0)return n;if(t>0)return n.map(i=>i.reverse());}function Uo(r){let e=new Array(),t=new Array(),n=i;return r.forEach(h=>n(h)),e;function i(h){switch(h){case"CIRCLE":{if(t.length>0)throw new Error("CIRCLE should be standalone");n=a;break;}case"R":{if(t.length>0)throw new Error("R should be standalone");n=l;break;}case"L":{if(t.length!==2)throw new Error("L needs a pre x/y");n=u;break;}case"ARC":{if(t.length!==2)throw new Error("ARC needs a pre x/y");n=c;break;}case"Q":{if(t.length!==2)throw new Error("Q needs a pre x/y");n=s;break;}case"C":{if(t.length!==2)throw new Error("C needs a pre x/y");n=o;break;}default:if(typeof h=="number")t.push(h);else throw new Error(`unexpected ${h}`);}}function s(h){if(typeof h=="number"){if(t.push(h),t.length===6){let d=t.pop(),f=t.pop(),p=t.pop(),m=t.pop(),g=t.pop(),b=t.pop();e.push(new Ce([new F(b,g),new F(m,p),new F(f,d)])),t.push(f,d);}}else{if(t.length!==2)throw new Error("invalid Q");n=i,i(h);}}function o(h){if(typeof h=="number"){if(t.push(h),t.length===8){let d=t.pop(),f=t.pop(),p=t.pop(),m=t.pop(),g=t.pop(),b=t.pop(),y=t.pop(),v=t.pop();e.push(new Ce([new F(v,y),new F(b,g),new F(m,p),new F(f,d)])),t.push(f,d);}}else{if(t.length!==2)throw new Error("invalid C");n=i,i(h);}}function a(h){if(typeof h=="number"){if(t.push(h),t.length===3){let d=t[0],f=t[1],p=t[2];p>0&&e.push(ee.build3(new F(d,f),0,-360,p,p)),t.length=0,n=i;}}else throw new Error("invalid CIRCLE");}function l(h){if(typeof h=="number"){if(t.push(h),t.length===7){let d=t[0],f=t[1],p=t[2],m=t[3],g=t[4];e.push(new ti(new F(d,f),p,m,g,t[5],Math.min(p,m)/2*t[6])),t.length=0,n=i;}}else throw new Error("invalid RECT");}function u(h){if(typeof h=="number"){if(t.push(h),t.length===4){let d=t.pop(),f=t.pop(),p=t.pop(),m=t.pop();e.push(new q(new F(m,p),new F(f,d))),t.push(f,d);}}else{if(t.length!==2)throw new Error("invalid L");n=i,i(h);}}function c(h){if(typeof h=="number"){if(t.push(h),t.length===5){let d=t.pop(),f=t.pop(),p=t.pop(),m=t.pop(),g=t.pop();(g!==f||m!==d)&&p!==0&&e.push(ee.build5(new F(g,m),new F(f,d),p)),t.push(f,d);}}else{if(t.length!==2)throw new Error("invalid Arc");n=i,i(h);}}}function DE(r){return r===32||r===9||r===13||r===10;}function tIe(r){return r===13||r===10;}var od=class{constructor(){this._line=1;this._col=0;}line(){return this._line;}col(){return this._col;}_feed(e){return e===10?(this._col=0,this._line++):this._col++,this.feed(e);}parse(e){let t=e.length;for(let n=0;n<t;n++){let i=e.charCodeAt(n);if(!this._feed(i))return this;}return this.finish(),this;}};var cg=500,GE=String.fromCharCode,ad=class{constructor(){this.buffer=new Array();}size(){return this.buffer.length;}isEOF(){return!1;}write(e){return this.buffer.push(e),1;}writen1(e){return this.writen2(e,0,e.length);}writen2(e,t,n){let i=this.buffer;for(let s=0,o=t;s<n;s++,o++)i.push(e[o]);return n;}writeAsync(e,t){t(this.write(e));}writenAsync1(e,t){t(this.writen1(e));}writenAsync2(e,t,n,i){i(this.writen2(e,t,n));}writeStr(e){let t=e.length,n=new Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return this.writen1(n);}clear(){this.buffer.length=0;}toString(){let e=this.buffer,t=e.length;if(t<=cg)return GE.apply(null,e);{let n=new Array();for(let i=0;i<e.length;i+=cg){let s=Math.min(t-i,cg),o=GE.apply(null,e.slice(i,i+s));n.push(o);}return n.join("");}}};var $z=(i=>(i[i.UNKNOW=0]="UNKNOW",i[i.IN_NUMBER=1]="IN_NUMBER",i[i.IN_NUMBER_E=2]="IN_NUMBER_E",i[i.IN_NUMBER_E_SIGNED=3]="IN_NUMBER_E_SIGNED",i))($z||{}),jz=(C=>(C[C.UNKNOW=0]="UNKNOW",C[C.MOVE_X=1]="MOVE_X",C[C.MOVE_Y=2]="MOVE_Y",C[C.LINE_X=3]="LINE_X",C[C.LINE_Y=4]="LINE_Y",C[C.HORIZONTAL_X=5]="HORIZONTAL_X",C[C.VERTICAL_Y=6]="VERTICAL_Y",C[C.CUBIC_BEZIER_X1=7]="CUBIC_BEZIER_X1",C[C.CUBIC_BEZIER_Y1=8]="CUBIC_BEZIER_Y1",C[C.CUBIC_BEZIER_X2=9]="CUBIC_BEZIER_X2",C[C.CUBIC_BEZIER_Y2=10]="CUBIC_BEZIER_Y2",C[C.CUBIC_BEZIER_X=11]="CUBIC_BEZIER_X",C[C.CUBIC_BEZIER_Y=12]="CUBIC_BEZIER_Y",C[C.ARC_RX=13]="ARC_RX",C[C.ARC_RY=14]="ARC_RY",C[C.ARC_ROTATION=15]="ARC_ROTATION",C[C.ARC_LARGE=16]="ARC_LARGE",C[C.ARC_SWEEP=17]="ARC_SWEEP",C[C.ARC_X=18]="ARC_X",C[C.ARC_Y=19]="ARC_Y",C[C.QUADRATIC_BEZIER_X1=20]="QUADRATIC_BEZIER_X1",C[C.QUADRATIC_BEZIER_Y1=21]="QUADRATIC_BEZIER_Y1",C[C.QUADRATIC_BEZIER_X=22]="QUADRATIC_BEZIER_X",C[C.QUADRATIC_BEZIER_Y=23]="QUADRATIC_BEZIER_Y",C))(jz||{});function Zz(r){return 97<=r&&r<=122||65<=r&&r<=90;}function Mr(r){let e=parseFloat(r);if(isFinite(e))return e;throw new Error("expect number");}var ld=class extends od{constructor(t,n=!0,i=kE){super();this.buffer=new ad();this.group=new Array();this.subPartStart=F.ORIGIN;this.curPoint=F.ORIGIN;this.lexState=0;this.parseState=0;this.isAbsolute=!1;this.isLargeArc=!1;this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=Number.NaN;this.y=Number.NaN;this.rx=Number.NaN;this.ry=Number.NaN;this.rotation=Number.NaN;this.sweep=vt.CCW;this.logger=i,this.cb=t,this.yAxis=n?-1:1;}on(t){return this.cb(t);}feed(t){switch(this.logger.debug1("%c|%s",t,this.lexState),this.lexState){case 0:return DE(t)?!0:48<=t&&t<=57||t===45||t===46||t===43?(this.pushBuffer(t),this.lexState=1,!0):Zz(t)?this.feedS(String.fromCharCode(t)):(this.logger.warn1("unknow letter %c",t),!0);case 1:return 48<=t&&t<=57||t===46?(this.pushBuffer(t),!0):t===101||t===69?(this.pushBuffer(t),this.lexState=2,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(t)):!1;case 2:return 48<=t&&t<=57?(this.pushBuffer(t),!0):t===45||t===43?(this.pushBuffer(t),this.lexState=3,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(t)):!1;case 3:return 48<=t&&t<=57?(this.pushBuffer(t),!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(t)):!1;default:return!0;}}finish(){this.feed(32),this.tryNotify();}feedS(t){switch(this.logger.debug1("%s|%s|%s|%s",t,this.parseState,this.curPoint,this.subPartStart),this.parseState){case 0:switch(t){case"M":this.isAbsolute=!0,this.parseState=1;break;case"m":this.isAbsolute=!1,this.parseState=1;break;case"L":this.isAbsolute=!0,this.parseState=3;break;case"l":this.isAbsolute=!1,this.parseState=3;break;case"H":this.isAbsolute=!0,this.parseState=5;break;case"h":this.isAbsolute=!1,this.parseState=5;break;case"V":this.isAbsolute=!0,this.parseState=6;break;case"v":this.isAbsolute=!1,this.parseState=6;break;case"z":case"Z":{this.group.push(new q(this.curPoint,this.subPartStart));let s=this.tryNotify();return this.curPoint=this.subPartStart,s;}case"C":this.isAbsolute=!0,this.parseState=7;break;case"c":this.isAbsolute=!1,this.parseState=7;break;case"S":this.isAbsolute=!0,this.parseState=9;break;case"s":this.isAbsolute=!1,this.parseState=9;break;case"A":this.isAbsolute=!0,this.parseState=13;break;case"a":this.isAbsolute=!1,this.parseState=13;break;case"Q":this.isAbsolute=!0,this.parseState=20;break;case"q":this.isAbsolute=!1,this.parseState=20;break;default:this.logger.warn1("unknow",t);}return!0;case 1:let n=this.tryNotify();return this.x=Mr(t),this.parseState=2,n;case 2:{this.y=this.yAxis*Mr(t);let s;return this.isAbsolute?s=new F(this.x,this.y):s=this.curPoint.add1(this.x,this.y),this.curPoint=s,this.subPartStart=s,this.parseState=3,!0;}case 3:return this.x=parseFloat(t),isFinite(this.x)?(this.parseState=4,!0):(this.parseState=0,this.feedS(t));case 4:{this.y=this.yAxis*Mr(t);let s;return this.isAbsolute?s=new F(this.x,this.y):s=this.curPoint.add1(this.x,this.y),this.group.push(new q(this.curPoint,s)),this.curPoint=s,this.parseState=3,!0;}case 5:if(this.x=parseFloat(t),isFinite(this.x)){let s;return this.isAbsolute?s=new F(this.x,this.curPoint.y):s=this.curPoint.add1(this.x,0),this.group.push(new q(this.curPoint,s)),this.curPoint=s,!0;}else return this.parseState=0,this.feedS(t);case 6:if(this.y=parseFloat(t),isFinite(this.y)){this.y=this.yAxis*this.y;let s;return this.isAbsolute?s=new F(this.curPoint.x,this.y):s=this.curPoint.add1(0,this.y),this.group.push(new q(this.curPoint,s)),this.curPoint=s,!0;}else return this.parseState=0,this.feedS(t);case 7:let i=parseFloat(t);if(isFinite(i))return this.x1=i,this.parseState=8,!0;if(t=="S"){let s=this.curPoint.x-this.x2,o=this.curPoint.y-this.y2;return this.x1=this.x+s,this.y1=this.y+o,this.parseState=0,this.feedS(t);}else if(t=="s"){let s=this.x-this.x2,o=this.y-this.y2;return this.x1=s,this.y1=o,this.parseState=0,this.feedS(t);}else return this.x1=i,this.parseState=0,this.feedS(t);case 8:return this.y1=this.yAxis*Mr(t),this.parseState=9,!0;case 9:return this.x2=Mr(t),this.parseState=10,!0;case 10:return this.y2=this.yAxis*Mr(t),this.parseState=11,!0;case 11:return this.x=Mr(t),this.parseState=12,!0;case 12:{this.y=this.yAxis*Mr(t);let s,o,a;return this.isAbsolute?(s=new F(this.x1,this.y1),o=new F(this.x2,this.y2),a=new F(this.x,this.y)):(s=this.curPoint.add1(this.x1,this.y1),o=this.curPoint.add1(this.x2,this.y2),a=this.curPoint.add1(this.x,this.y)),this.group.push(new Ce([this.curPoint,s,o,a])),this.curPoint=a,this.parseState=7,!0;}case 13:return this.rx=parseFloat(t),isFinite(this.rx)?(this.parseState=14,!0):(this.parseState=0,this.feedS(t));case 14:return this.ry=Mr(t),this.parseState=15,!0;case 15:return this.rotation=Mr(t),this.parseState=16,!0;case 16:return this.isLargeArc=Mr(t)===1,this.parseState=17,!0;case 17:return this.sweep=Mr(t)===1?vt.CW:vt.CCW,this.parseState=18,!0;case 18:return this.x=Mr(t),this.parseState=19,!0;case 19:{this.y=this.yAxis*Mr(t);let s;return this.isAbsolute?s=new F(this.x,this.y):s=this.curPoint.add1(this.x,this.y),this.group.push(ee.build1(this.curPoint,s,this.rx,this.ry,this.isLargeArc,this.sweep)),this.curPoint=s,this.parseState=13,!0;}case 20:return this.x1=parseFloat(t),isFinite(this.x1)?(this.parseState=21,!0):(this.parseState=0,this.feedS(t));case 21:return this.y1=this.yAxis*Mr(t),this.parseState=22,!0;case 22:return this.x=Mr(t),this.parseState=23,!0;case 23:{this.y=this.yAxis*Mr(t);let s,o;return this.isAbsolute?(s=new F(this.x1,this.y1),o=new F(this.x,this.y)):(s=this.curPoint.add1(this.x1,this.y1),o=this.curPoint.add1(this.x,this.y)),this.group.push(new Ce([this.curPoint,s,s,o])),this.curPoint=o,this.parseState=20,!0;}default:return this.logger.warn1("unsupported parse state",this.parseState),!0;}}pushBuffer(t){this.buffer.write(t);}getCleanBuffer(){let t=this.buffer.toString();return this.buffer.clear(),t;}tryNotify(){if(this.group.length===0)return!0;{let t=Me.build1(d2(this.group));return this.group.length=0,this.on(t);}}onException(t){throw t;}};var Hz=(o=>(o[o.TOP=1]="TOP",o[o.BOTTOM=2]="BOTTOM",o[o.DOCUMENT=12]="DOCUMENT",o[o.COMPONENT_SHAPE=99]="COMPONENT_SHAPE",o[o.PIN_SHAPE=100]="PIN_SHAPE",o[o.POLARITY_SHAPE=101]="POLARITY_SHAPE",o))(Hz||{});function FE(r,e,t){var p,m;let n=new an(),i=0,s=0;n.dataStr=r;try{console.log(r),n.polarity=r.polarity==="1";let g=r.dataStr;n.tht=(m=(p=r.customData)==null?void 0:p.jlcPara)==null?void 0:m.assemblyProcess;{let b=g.canvas.split("~");i=parseFloat(b[16]||"0")*e,s=parseFloat(b[17]||"0")*e;}for(let b of g.shape){let y=b.indexOf("~");if(y>=0)switch(b.substring(0,y)){case"SVGNODE":h(b);break;case"CIRCLE":c(b);break;case"SOLIDREGION":u(b);break;case"PAD":l(b);break;case"HOLE":o(b);break;case"TRACK":a(b);break;}}}catch(g){console.error(g);}return n;function o(g){let b=g.split("~"),y=f(b[3]);n.holeShape.push(ee.build3(new F(...d(b[1],b[2])),0,-360,y,y));}function a(g){let b=g.split("~"),y=parseInt(b[2]);if(y===99||y===100||y===12){let v=b[4].split(" "),E=f(b[1]),P=new F(...d(v[0],v[1]));for(let M=3;M<v.length;M+=2){let I=new F(...d(v[M-1],v[M])),C=new q(P,I).stroke(E,ji.ROUND,vt.CCW);y===12?n.polarityShape.push(C):y===100?n.pinShape.push(C):y===99&&n.componentShape.push(C),P=I;}}}function l(g){let b=g.split("~"),y=f(b[4]),v=f(b[5]),E=b[8],P=Math.max(Math.min(y,v)/2/3,1),M=ee.build3(new F(...d(b[2],b[3])),0,-360,P,P);w2(n.padShape,E).push(Me.build2([M]));}function u(g){let b=g.split("~"),y=parseInt(b[1]);if(y===99||y===100||y===12){let v=ze.scale(e).translate(-i,s);new ld(E=>{switch(E=E.multiply3(v),y){case 99:n.componentShape.push(E);break;case 100:n.pinShape.push(E);break;case 12:n.polarityShape.push(E);break;}return!0;}).parse(b[3]);}}function c(g){let b=g.split("~"),y=f(b[3]),v=f(b[4]),E=y+v/2,P=ee.build3(new F(...d(b[1],b[2])),0,-360,E,E),M=parseInt(b[5]);if(M===12)n.polarityShape.push(Me.build2([P]));else if(M===100)n.pinShape.push(Me.build2([P]));else if(M===101){let{x:I,y:C}=P.center,L;I>0&&C>=0?L=1:I<=0&&C>0?L=2:I<0&&C<=0?L=3:I>=0&&C<0?L=4:L=1,n.polarityMarkQuadrant=L,t&&n.group.setRotation(new pe(0,0,at.toRadians((t-L)*90)));}}function h(g){let b=JSON.parse(g.substring(8));console.log(b);let y=b.attrs;if(b.nodeType===1&&y.c_etype==="outline3D"){let v=y.c_origin.split(","),[E,P]=d(v[0],v[1]),M=f(y.z),I=new ke();if(_s(b.childNodes,(Z,H)=>{let W=H.attrs.points.split(" ");for(let Y=0;Y<W.length;Y+=2)I.ext6(...d(W[Y],W[Y+1]));}),I.valid()){let Z=I.build().center();(Math.abs(Z.x-E)>.1||Math.abs(Z.y-P)>.1)&&(console.warn("fix 3d model x/y",y.uuid),E=Z.x,P=Z.y);}let C=y.c_rotation.split(",").map(Z=>parseFloat(Z)),L=C[0],S=C[1],T=C[2],B=f(y.c_width),$=f(y.c_height);Object.assign(n,{x:E,y:P,z:M,rx:L,ry:S,rz:T,dx:B,dy:$,uuid:y.uuid});}}function d(g,b){return[parseFloat(g)*e-i,-(parseFloat(b)*e-s)];}function f(g){return parseFloat(g)*e;}}var hg=/^[^|]+\.ste?p\|[^|]+$/i,qE=(a=>(a[a.SUCCESS=0]="SUCCESS",a[a.ILLEGAL_UUID=1]="ILLEGAL_UUID",a[a.NOT_FOUND=2]="NOT_FOUND",a[a.TIMEOUT=3]="TIMEOUT",a[a.EMPTY_MODEL=4]="EMPTY_MODEL",a[a.NO_STEP=5]="NO_STEP",a[a.NO_NETWORK=6]="NO_NETWORK",a))(qE||{}),ud=class{constructor(e,t,n){this.modelGnrs=new Array();this.simplifyCostRate=0;this.codePolarityMarkQuadrantDict={};this.fuuidPolarityMarkQuadrantDict={};let i=(n==null?void 0:n.loadModel)===void 0?!0:n.loadModel,s=(n==null?void 0:n.loadFootprint)===void 0?!0:n.loadFootprint;this.keepGroup=(n==null?void 0:n.keepGroup)||new We(),this.logger=(n==null?void 0:n.logger)||new vn(2),this.pool=t,this.unit=e;let o=new Ur(10,e).ratio;this.keepGroup.setVisible(!1),this.invisibleRect=new We(0),this.invisibleRect.add(new Et(new fr([new pe(-.5,-.5,.3),new pe(-.5,.5,.3),new pe(.5,-.5,.3),new pe(.5,.5,.3),new pe(.5,-.5,.3),new pe(-.5,.5,.3)]),qe.ZERO)),this.invisibleRect.setScale(new pe(3,3,3).scale(o)),this.blackWhiteSquare=ts(ME),this.blackWhiteSquare.setScale(new pe(3,3,3).scale(o)),this.grayCuboid=ts(TE),this.grayCuboid.setScale(new pe(3,3,3).scale(o)),this.keepGroup.add(this.invisibleRect),this.keepGroup.add(this.blackWhiteSquare),this.keepGroup.add(this.grayCuboid),this.setDefaultModel(null),this.uuidModelCache=new os("uuidModelCache",(l,u)=>{if(!i){l.forEach(c=>u(c,{model:this.defaultModel,modelStatus:c&&(hg.test(c)||c.length===32)?2:1}));return;}l.forEach(c=>Se(this,null,function*(){if(!c){u(c,{model:this.defaultModel,modelStatus:1});return;}let h;if(hg.test(c)){let f;try{if(f=yield ng(c),f.status===404)throw new Error("res.status === 404");}catch(m){u(c,{model:this.defaultModel,modelStatus:m?6:3});return;}if(f.status!==200){u(c,{model:this.defaultModel,modelStatus:2});return;}let p=JSON.parse(yield f.text()).result;h=(yield this.pool.rpcCall("/worker/step2mesh",[p,this.simplifyCostRate])).message;}else if(c.length===32){let f;try{if(f=yield _E(c),f.status===404)throw new Error("res.status === 404");}catch(m){u(c,{model:this.defaultModel,modelStatus:m?6:3});return;}if(f.status!==200){u(c,{model:this.defaultModel,modelStatus:2});return;}let p=yield f.text();h=(yield this.pool.rpcCall("/worker/objDecode",[c,p,this.simplifyCostRate],600*1e3)).message;}else{u(c,{model:this.defaultModel,modelStatus:1});return;}let d=x0(h);d.isEmpty()?u(c,{model:this.defaultModel,modelStatus:4}):(this.keepGroup.add(d),u(c,{model:d,modelStatus:0}));}));}),this.uuidModelSourceCache=new os("uuidModelSourceCache",(l,u)=>Se(this,null,function*(){for(let c of l){if(!c){u(c,{buffer:null,modelStatus:1});return;}if(hg.test(c)){let h;try{if(h=yield ng(c),h.status===404)throw new Error("res.status === 404");}catch(f){u(c,{buffer:null,modelStatus:f?6:3});return;}if(h.status!==200){u(c,{buffer:null,modelStatus:2});return;}let d=JSON.parse(yield h.text()).result;u(c,{buffer:new TextEncoder().encode(d).buffer,modelStatus:0});}else if(c.length===32){let h;try{if(h=yield SE(c),h.status===404)throw new Error("res.status === 404");}catch(d){u(c,{buffer:null,modelStatus:d?6:3});return;}if(h.status!==200){u(c,{buffer:null,modelStatus:2});return;}u(c,{buffer:yield h.arrayBuffer(),modelStatus:0});}else u(c,{buffer:null,modelStatus:1});}})),this.codeFuuidCache=new os("codeFuuidCache",(l,u)=>Se(this,null,function*(){var c,h;if(this.logger.info("codes",l),!s){l.forEach(d=>u(d,""));return;}try{let f=yield(yield EE(l)).json();if(f.success){let p={};l.forEach(m=>p[m]=""),(c=f.result)!=null&&c.data?_s((h=f.result)==null?void 0:h.data,(m,g)=>{p[g.code]=g.package_uuid;}):_s(f.result,(m,g)=>p[g.number]=g.puuid),_s(p,(m,g)=>{this.fuuidPolarityMarkQuadrantDict[g]=this.codePolarityMarkQuadrantDict[m],u(m,g);});}else throw new Error(f);}catch(d){this.logger.error(d),l.forEach(f=>u(f,""));}})),this.fuuidMgnrCache=new os("fuuidMgnrCache",(l,u)=>Se(this,null,function*(){if(this.logger.info("footprints",l),!s){l.forEach(c=>{let h=new an();this.modelGnrs.push(h),u(c,h);});return;}try{let h=yield(yield PE(l)).json();if(h.success){let d={};l.forEach(f=>{d[f]=new an();}),_s(h.result,(f,p)=>{d[p.uuid]=FE(p,o,this.fuuidPolarityMarkQuadrantDict[p.uuid]);}),_s(d,(f,p)=>{this.modelGnrs.push(p),u(f,p);});}else throw new Error(h);}catch(c){this.logger.error(c),l.forEach(h=>{let d=new an();this.modelGnrs.push(d),u(h,d);});}}));let a=(l,u,c,h,d,f=null)=>{let p=new We(),m=new Array(),g=new Array();for(let E of l){let P=new Array();E.points2(.1,M=>{P.push(M);}),g.push(P);}g.forEach(E=>{let P=null;E.forEach(M=>{P&&m.push(new pe(M.x,M.y,h),new pe(M.x,M.y,d),new pe(P.x,P.y,h),new pe(P.x,P.y,h),new pe(M.x,M.y,d),new pe(P.x,P.y,d)),P=M;});}),p.add(new Et(new fr(m,_a(m)),u,c,f));let b=new Array();g.forEach(E=>{let P=new Array();if(E.forEach(M=>P.push(M)),P.length>2)for(let M=0;M<P.length-2;M+=2)b.push(new pe(P[M].x,P[M].y,h),new pe(P[M+1].x,P[M+1].y,h),new pe(P[M+2].x,P[M+2].y,h)),P.push(P[M]);});let y=new Et(new fr(b,_a(b)),u,c,f);p.add(y);let v=new We();return v.add(y),v.setPosition(new pe(0,0,d-h)),p.add(v),p;};this.fuuidModelCache=new os("fuuidModelCache",(l,u)=>{for(let c of l)Se(this,null,function*(){let h=yield this.fuuidMgnrCache.fetch(c),d=yield this.uuidModelCache.fetch(h.uuid);if(h.originModel=d.model,h.modelStatus=d.modelStatus,d.modelStatus!==0&&h.pinShape.length!==0&&h.componentShape.length!==0)try{let f=new We();f.add(a(h.pinShape,null,new yn(qe.of2(196,196,196),qe.of2(196,196,196),qe.of2(157,157,157),.1,1),0,15)),f.add(a(h.componentShape,null,new yn(qe.of2(64,64,64),qe.of2(64,64,64),qe.of2(19,19,19),.1,1),5,35)),h.setModel(f);}catch(f){h.setModel(Ru(d.model,h,!1,d.model===this.invisibleRect));}else h.setModel(Ru(d.model,h,d.modelStatus===0,d.model===this.invisibleRect));h.gnrAll(),h.beAdd(this.keepGroup),h.setPolarityVisible(!0),h.setPad1Visible(!0),this.logger.info(h.uuid,"complete"),this.logger.debug(h.uuid,h),u(c,h);});}),this.codeModelCache=new os("codeModelCache",(l,u)=>{let c=[];for(let h of l)Se(this,null,function*(){let d=yield this.codeFuuidCache.fetch(h),f=yield this.fuuidModelCache.fetch(d);f.modelStatus!==0&&c.push(h),u(h,f);});c.length;});}setDefaultModel(e){e==="invisible_rect"?this.defaultModel=this.invisibleRect:e==="gray_cuboid"?this.defaultModel=this.grayCuboid:this.defaultModel=this.blackWhiteSquare;}getDefaultModel(e){return e==="invisible_rect"?this.invisibleRect:e==="gray_cuboid"?this.grayCuboid:e===void 0?this.defaultModel:this.blackWhiteSquare;}forEach(e){this.modelGnrs.forEach(e);}setSimplifyCostRate(e){this.simplifyCostRate=e;}clear(){this.uuidModelCache.clear(),this.codeFuuidCache.clear(),this.fuuidMgnrCache.clear(),this.fuuidModelCache.clear(),this.codeModelCache.clear();for(let e of this.keepGroup.getContents())e!==this.blackWhiteSquare&&e!==this.invisibleRect&&e!==this.grayCuboid&&this.keepGroup.remove(e);this.modelGnrs.length=0,Object.keys(this.codePolarityMarkQuadrantDict).forEach(e=>delete this.codePolarityMarkQuadrantDict[e]),Object.keys(this.fuuidPolarityMarkQuadrantDict).forEach(e=>delete this.fuuidPolarityMarkQuadrantDict[e]);}getByModelUuid(e){return this.uuidModelCache.fetch(e);}getOriginModelByFuuid(e){return Se(this,null,function*(){let t=yield this.fuuidMgnrCache.fetch(e);return yield this.uuidModelCache.fetch(t.uuid);});}getOriginModelByCode(e){return Se(this,null,function*(){let t=yield this.codeFuuidCache.fetch(e),n=yield this.fuuidMgnrCache.fetch(t);return yield this.uuidModelCache.fetch(n.uuid);});}getByCode(e,t){return Se(this,null,function*(){if(this.codePolarityMarkQuadrantDict[e]!==void 0&&this.codePolarityMarkQuadrantDict[e]!==t)throw new Error("The multi polarityMarkQuadrant is conflicting!");return(t===1||t===2||t===3||t===4)&&(this.codePolarityMarkQuadrantDict[e]=t),this.codeModelCache.fetch(e);});}addCodeFuuidCache(e,t){this.codeFuuidCache.addCache(e,t);}getModelWithSource(e){return Se(this,null,function*(){let t=yield this.uuidModelCache.fetch(e),n=yield this.uuidModelSourceCache.fetch(e);return{model:t,source:n};});}getModelGnrByCode(e){return Se(this,null,function*(){let t=yield this.codeFuuidCache.fetch(e);return yield this.fuuidMgnrCache.fetch(t);});}};function Kz(r,e){let t=r.bbox(),n=e.bbox(),i=(t.minY+t.maxY)/2,s=(n.minY+n.maxY)/2;return i-s;}function Qz(r,e){let t=r.bbox(),n=e.bbox(),i=(t.minX+t.maxX)/2,s=(n.minX+n.maxX)/2;return i-s;}var Vs=class{constructor(e){this.__bbox=null;if(typeof e!="undefined"){if(e instanceof Array){this.__items=[];for(let t of e)this.add(t);}else this.__items=e,this.__bbox=e.bbox();}else this.__items=[];}add(e){if(this.__items instanceof Array)this.__items.push(e),this.__bbox=ye.extend2(this.__bbox,e.bbox());else throw new Error("can't insert multiple item into leaf node");}items(){return this.__items;}bbox(){if(this.__bbox!==null)return this.__bbox;throw new Error("bug");}},zn=class{constructor(e){this.changed=!1;this.root=new Vs(),this.capacity=e,this.capacity2=e*e,this.itemList=[];}size(){return this.itemList.length;}items(){return this.flushWhenNeed(),this.itemList;}add(e){this.itemList.push(e),this.changed=!0;}remove(e){cr.remove(this.itemList,e),this.changed=!0;}clear(){this.changed=!1,this.root=new Vs(),this.itemList.length=0;}flushWhenNeed(){if(this.changed){let e=new Array();for(let t of this.itemList)e.push(new Vs(t));for(;;){let t=this.organize(e);if(t.length>1)e=t;else break;}this.root=new Vs(e),this.changed=!1;}}organize(e){xn(e,Qz,0,e.length);let t=e.length,n=[];for(let i=0;i<t;)if(i+this.capacity2<=t){let s=i+this.capacity2;xn(e,Kz,i,s);for(let o=i;o<s;o+=this.capacity){let a=new Vs(e.slice(o,o+this.capacity));n.push(a);}i=i+this.capacity*this.capacity;}else{let s=new Vs(e.slice(i,i+this.capacity));n.push(s),i=i+this.capacity;}return n;}search(e){this.flushWhenNeed();let t=[],n=[];for(n.push(this.root);;){let i=n.shift();if(typeof i!="undefined"){let s=i.items();if(s instanceof Array){for(let o of s)if(!e.isSeparated(o.bbox())){let a=o.items();a instanceof Array?n.push(o):t.push(a);}}else e.isSeparated(i.bbox())||t.push(s);}else break;}return t;}walker(e){this.flushWhenNeed(),this._walker(this.root,0,e);}_walker(e,t,n){this.flushWhenNeed();let i=e.items();if(i instanceof Array)for(let s of i)this._walker(s,t+1,n);else n(i,t);}bbox(){return this.flushWhenNeed(),this.root.bbox();}};var cd=class{constructor(e,t,n,i){this.sides=new Array();this.loader=e,this.logger=n,this.rule=t,this.event=i;}addPolyline(e,t=1){let n=this.loader.buildGroup(e,t);for(let i of n)this.sides.push(i),this.event.onOriginSide(i);return n;}buildRTree(){let e=new zn(10);for(let t of this.sides)e.add(t);return e;}fillValidSides(e,t,n){for(let i of t)isFinite(i.getX(n))&&e.push(i);}};var Bi=class{constructor(e,t){this.minDistance=Number.MAX_VALUE;this.p=e,this.p1=t,this.intersection()?(this.minDistance=0,this.minline=new q(F.ORIGIN,F.ORIGIN)):this.minline=this.minLine();}getDistance(){return this.minDistance;}getLine(){return this.minline;}intersection(){return Nu(this.p,this.p1)>0;}minLine(){if(this.p instanceof q&&this.p1 instanceof q){let e=this.p,t=this.p1;return this.minDistanceForLines(e,t,this.minline);}else if(this.p instanceof ee&&this.p1 instanceof q){let e=this.p,t=this.p1;return this.minDistanceForLineAndArc(e,t,this.minline);}else if(this.p instanceof q&&this.p1 instanceof ee){let e=this.p1,t=this.p;return this.minDistanceForLineAndArc(e,t,this.minline);}else if(this.p instanceof ee&&this.p1 instanceof ee){let e=this.p,t=this.p1;return this.minDistanceForArcs(e,t,this.minline);}return this.minline;}minDistanceForLines(e,t,n){let i=[e.start(),e.end(),t.start(),t.end()];for(let s=0;s<i.length;s++)s<2?n=this.point2LineMinLine(n,t,i[s]):n=this.point2LineMinLine(n,e,i[s]);return n;}minDistanceForLineAndArc(e,t,n){n=this.point2LineMinLine(n,t,e.start()),n=this.point2LineMinLine(n,t,e.svgEnd);let i=Bi.foot(t,e.center);return t.bbox().isContains(i)&&(n=this.point2ArcMinLine(n,e,i)),n=this.point2ArcMinLine(n,e,t.start()),n=this.point2ArcMinLine(n,e,t.end()),n;}minDistanceForArcs(e,t,n){return n=this.concentricArc(e,t,n),Lt(e,t.center)&&Lt(t,e.center)?n=this.shortestLineForArcs(e,t,n):(n=this.point2ArcMinDistance(t.start(),e,n),n=this.point2ArcMinDistance(t.svgEnd,e,n),n=this.point2ArcMinDistance(e.start(),t,n),n=this.point2ArcMinDistance(e.svgEnd,t,n)),n;}minLineForArcAndLine(e,t,n){let i=e.pointOn(n.angleD(e.center)),s=e.pointOn(e.center.angleD(n));return t=this.arcShortestLine(e,t,n,i),t=this.arcShortestLine(e,t,n,s),t;}arcInnerLineFootSegment(e,t,n){let i=n.distance1(e.center);if(i!==0){let s=e.rx*(n.y-e.center.y)/i+e.center.y,o=e.rx*(n.x-e.center.x)/i+e.center.x,a=new q(new F(o,s),n);i=e.rx-i,i<this.minDistance&&(this.minDistance=i,t=a);}else{let s=new q(e.start(),n);i=e.rx-i,i<this.minDistance&&(this.minDistance=i,t=s);}return t;}shortestLineForArcs(e,t,n){let i=e.center.angleD(t.center),s=t.center.angleD(e.center),o=e.pointOn(i),a=e.pointOn(s),l=t.pointOn(i),u=t.pointOn(s);return Lt(e,o)&&(n=this.arcShortestLine(t,n,o,l),n=this.arcShortestLine(t,n,o,u)),Lt(e,a)&&(n=this.arcShortestLine(t,n,a,l),n=this.arcShortestLine(t,n,a,u)),n;}concentricArc(e,t,n){if(e.center.distance1(t.center)<1e-5&&e.rx===t.rx&&e.ry===t.ry){let i=new q(e.start(),t.svgEnd);i.length()<this.minDistance&&(this.minDistance=i.length(),n=i),i=new q(t.start(),e.svgEnd),i.length()<this.minDistance&&(this.minDistance=i.length(),n=i);}return n;}point2ArcMinDistance(e,t,n){if(Lt(t,e)){let i=t.pointOn(e.angleD(t.center)),s=t.pointOn(t.center.angleD(e));n=this.arcShortestLine(t,n,e,i),n=this.arcShortestLine(t,n,e,s);}else n=this.minLineSegment(n,t.start(),e),n=this.minLineSegment(n,t.svgEnd,e);return n;}point2ArcMinLine(e,t,n){if(Lt(t,n)){let i=n.distance1(t.center);i>t.rx||i>t.ry?e=this.minLineForArcAndLine(t,e,n):e=this.arcInnerLineFootSegment(t,e,n);}return e;}point2LineMinLine(e,t,n){let i=Bi.foot(t,n);return t.bbox().isContains(i)?e=this.minLineSegment(e,i,n):(e=this.minLineSegment(e,t.start(),n),e=this.minLineSegment(e,t.end(),n)),e;}minLineSegment(e,t,n){let i=t.distance1(n);return i<this.minDistance&&(this.minDistance=i,e=new q(t,n)),e;}arcShortestLine(e,t,n,i){if(Lt(e,i)){let s=new q(n,i),o=s.length();o<this.minDistance&&(this.minDistance=o,t=s);}return t;}static foot(e,t){if(e.isPoint())return e.start();if(e.b!==0&&e.a!==0){let n=(e.b*e.b*t.x-e.a*e.b*t.y-e.a*e.c)/(e.b*e.b+e.a*e.a),i=(-e.a*e.b*t.x+e.a*e.a*t.y-e.b*e.c)/(e.b*e.b+e.a*e.a);return new F(n,i);}else return e.b===0&&e.a!==0?new F(e.start().x,t.y):e.b!==0&&e.a===0?new F(t.x,e.start().y):t;}};var or=class{static dotProd1(e,t,n,i){return e*n+t*i;}static dotProd2(e,t,n,i,s,o){return this.dotProd1(n-e,i-t,s-n,o-i);}static dotProd3(e,t,n){return this.dotProd2(e.x,e.y,t.x,t.y,n.x,n.y);}static crossProd1(e,t,n,i){return e*i-t*n;}static crossProd2(e,t,n,i,s,o){return this.crossProd1(n-e,i-t,s-n,o-i);}static crossProd3(e,t,n){return this.crossProd2(e.x,e.y,t.x,t.y,n.x,n.y);}static distance2(e,t,n,i){let s=n-e,o=i-t;return s*s+o*o;}static distance1(e,t,n,i){return this.hypot(n-e,i-t);}static distance1p(e,t){return this.distance1(e.x,e.y,t.x,t.y);}static hypot(e,t){if(e=Math.abs(e),t=Math.abs(t),t>e){var n=t;t=e,e=n;}if(e===0)return t;var i=t/e;return e*Math.sqrt(1+i*i);}};var Lu=1e-4,J=new Float64Array(100);function Nu(r,e){if(r instanceof q&&e instanceof q)return el(r,e);if(r instanceof ee&&e instanceof q)return hd(r,e);if(r instanceof q&&e instanceof ee)return hd(e,r);if(r instanceof ee&&e instanceof ee)return tY(r,e);throw new Error("not supported operation");}function HAe(r,e){let t=r.primitives,n=e.primitives,i=t.length>n.length?n:t,s=t.length>n.length?t:n,o=!1;return i.some(a=>(s.some(l=>(o=Nu(a,l)>0,o)),o)),o;}function KAe(r,e){if(r instanceof q)return fg(r,e);if(r instanceof ee)return dg(r,e);throw new Error("not supported operation");}function fg(r,e){let t=r.bbox();if(t.isContainsY1(e)){let n=new q(new F(t.minX-1,e),new F(t.maxX+1,e));return el(n,r)>0?1:0;}else return 0;}function dg(r,e){if(r.rx===r.ry){let t=r.bbox();if(t.isContainsY1(e)){let n=new q(new F(t.minX-1,e),new F(t.maxX+1,e));return Ou(r,n)>0?1:0;}else return 0;}else throw new Error("not supported operation");}function QAe(r,e){if(r.rx===r.ry){let t=r.bbox();if(t.isContainsY1(e)){let n=new q(new F(t.minX-1,e),new F(t.maxX+1,e)),i=Ou(r,n);return i>0?i:0;}else return 0;}else throw new Error("not supported operation");}function zE(r,e,t){return isFinite(e)&&isFinite(t)?r.isContains2(e,t):!1;}function Jz(r,e){let t=r.bbox().intersection1(e.bbox());if(t!=null){let n=or.crossProd3(e.start(),e.end(),r.start()),i=or.crossProd3(e.start(),e.end(),r.end());return Math.abs(n)<1e-8||Math.abs(i)<1e-8||n*i<0?t:null;}else return null;}function el(r,e){if(r.isPoint())return YE(e,r.start());if(e.isPoint())return YE(r,e.start());{let t=Jz(r,e);if(t!=null){let y=function(v,E){t.isContains2(v,E)&&(J[b++]=v,J[b++]=E);},n=r.start().x,i=r.start().y,s=r.end().x,o=r.end().y,a=e.start().x,l=e.start().y,u=e.end().x,c=e.end().y,h=e.length(),d=or.crossProd2(n,i,a,l,u,c)/h,f=or.crossProd2(s,o,a,l,u,c)/h;if(d*f>0&&!Ie.eq(d,0)&&!Ie.eq(f,0))return 0;let p=r.length(),m=or.crossProd2(a,l,n,i,s,o)/p,g=or.crossProd2(u,c,n,i,s,o)/p;if(m*g>0&&!Ie.eq(m,0)&&!Ie.eq(g,0))return 0;let b=0;if(Ie.eq(d,0)&&Ie.eq(f,0)){let v=t.UL(),E=t.UR(),P=t.LL(),M=t.LR();if(Ie.eq(t.width(),0))Ie.eq(t.height(),0)?(J[b++]=v.x,J[b++]=v.y):(J[b++]=v.x,J[b++]=v.y,J[b++]=P.x,J[b++]=P.y);else if(Ie.eq(t.height(),0))J[b++]=v.x,J[b++]=v.y,J[b++]=E.x,J[b++]=E.y;else{let I=$i.area2(v.x,v.y,a,l,u,c),C=$i.area2(E.x,E.y,a,l,u,c);I<C?(J[b++]=v.x,J[b++]=v.y,J[b++]=M.x,J[b++]=M.y):(J[b++]=E.x,J[b++]=E.y,J[b++]=P.x,J[b++]=P.y);}}else if(Ie.eq(d,0))y(n,i);else if(Ie.eq(f,0))y(s,o);else{let v=Math.abs(d/(d-f));y(n+(s-n)*v,i+(o-i)*v);}return b;}else return 0;}}function YE(r,e){return r.bbox().extendOfSize(1e-8).isContains(e)?r.isPoint()?e.equals1(r.start())?(J[0]=e.x,J[1]=e.y,2):0:Ie.eq($i.area2(r.start().x,r.start().y,r.end().x,r.end().y,e.x,e.y),0)?(J[0]=e.x,J[1]=e.y,2):0:0;}function Ou(r,e){let t=r.bbox().intersection1(e.bbox());if(t!=null){t=t.extendOfSize(Lu);let n=r.center.x,i=r.center.y,s=r.rx,o=r.rx2,a=e.start().x,l=e.start().y,u=e.end().x,c=e.end().y,h=r.center.distance1(e.start()),d=r.center.distance1(e.end()),f=Ie.eq(h,s)?0:h>s?1:-1,p=Ie.eq(d,s)?0:d>s?1:-1,m=0;if(f===-1&&p===-1)return 0;if(f===0&&p===0)J[m++]=a,J[m++]=l,J[m++]=u,J[m++]=c;else if(f===1&&p===1){let g=Bi.foot(e,r.center),b=g.distance1(r.center);if(Ie.greater(b,s))return 0;if(Ie.eq(b,s))Ie.eq(e.distance2(r.start()),0)?(J[m++]=r.start().x,J[m++]=r.start().y,J[m++]=r.start().x,J[m++]=r.start().y):Ie.eq(e.distance2(r.end()),0)?(J[m++]=r.end().x,J[m++]=r.end().y,J[m++]=r.end().x,J[m++]=r.end().y):(J[m++]=g.x,J[m++]=g.y,J[m++]=g.x,J[m++]=g.y);else{m=XE(n,i,a,l,u,c,m);let y=J[m-2],v=J[m-1],E=or.distance1(n,i,y,v);if(m-=2,Ie.eq(E,s))J[m++]=y,J[m++]=v;else if(E<s)m=Br(o,n,i,a,l,y,v,m),m=Br(o,n,i,y,v,u,c,m);else return 0;}}else if(f===-1||p===-1)m=Br(o,n,i,a,l,u,c,m);else{let g=Bi.foot(e,r.center),b=g.distance1(r.center);if(Ie.eq(b,s)){let y=function(v){return zE(t,v.x,v.y)&&Lt(r,v);};if(f===0){let v=e.start();if(y(v))return J[m++]=v.x,J[m++]=v.y,J[m++]=v.x,J[m++]=v.y,m;if(y(g))return J[m++]=g.x,J[m++]=g.y,J[m++]=g.x,J[m++]=g.y,m;if(h<=s)m=Br(o,n,i,g.x,g.y,u,c,m),m===2&&(J[m++]=J[0],J[m++]=J[1]);else if(b<s){if(m=Br(o,n,i,g.x,g.y,u,c,m),m===2&&y(new F(J[0],J[1])))return J[m++]=J[0],J[m++]=J[1],m;m=Br(o,n,i,g.x,g.y,a,l,0),m===2&&(J[m++]=J[0],J[m++]=J[1]);}}else{let v=e.end();if(y(v))return J[m++]=v.x,J[m++]=v.y,J[m++]=v.x,J[m++]=v.y,m;if(y(g))return J[m++]=g.x,J[m++]=g.y,J[m++]=g.x,J[m++]=g.y,m;if(d<=s)m=Br(o,n,i,g.x,g.y,a,l,m),m===2&&(J[m++]=J[0],J[m++]=J[1]);else if(b<s){if(m=Br(o,n,i,g.x,g.y,a,l,m),m===2&&y(new F(J[0],J[1])))return J[m++]=J[0],J[m++]=J[1],m;m=Br(o,n,i,g.x,g.y,u,c,0),m===2&&(J[m++]=J[0],J[m++]=J[1]);}}}else if(f===0){let y=e.start();J[m++]=y.x,J[m++]=y.y,(a-g.x)*(u-g.x)+(l-g.y)*(c-g.y)<0&&(m=Br(o,n,i,g.x,g.y,u,c,m));}else{let y=e.end();J[m++]=y.x,J[m++]=y.y,(a-g.x)*(u-g.x)+(l-g.y)*(c-g.y)<0&&(m=Br(o,n,i,g.x,g.y,a,l,m));}}if(m>0){let g=0;for(let b=0;b<m;b+=2){let y=J[b],v=J[b+1];isFinite(y)&&isFinite(v)&&zE(t,y,v)&&Lt(r,new F(y,v))&&(J[g++]=y,J[g++]=v);}return g;}else return 0;}else return 0;}function eY(r,e){if(r.bbox()){let t=r.center.x,n=r.center.y,i=r.rx2,s=e.start().x,o=e.start().y,a=e.end().x,l=e.end().y,u=r.center.distance2(e.start()),c=r.center.distance2(e.end()),h=Ie.eq(u,i)?0:u>i?1:-1,d=Ie.eq(c,i)?0:c>i?1:-1,f=0;if(h===-1&&d===-1)return 0;if(h===0&&d===0)J[f++]=s,J[f++]=o,J[f++]=a,J[f++]=l;else if(h===1&&d===1){let p=Bi.foot(e,r.center),m=p.distance2(r.center);if(Ie.greater(m,i))return 0;if(Ie.eq(m,i)){let g=p.distance2(r.start()),b=p.distance2(r.end());Ie.eq(g,0)?(J[f++]=r.start().x,J[f++]=r.start().y):Ie.eq(b,0)?(J[f++]=r.end().x,J[f++]=r.end().y):(J[f++]=p.x,J[f++]=p.y);}else{f=XE(t,n,s,o,a,l,f);let g=J[f-2],b=J[f-1],y=or.distance2(t,n,g,b);if(f-=2,Ie.eq(y,i))J[f++]=g,J[f++]=b;else if(y<i)f=Br(i,t,n,s,o,g,b,f),f=Br(i,t,n,g,b,a,l,f);else return 0;}}else if(h===-1||d===-1)f=Br(i,t,n,s,o,a,l,f);else{let p=Bi.foot(e,r.center);h===0?(J[f++]=e.start().x,J[f++]=e.start().y,Ie.neq(p.distance2(e.start()),0)&&(s-p.x)*(a-p.x)+(o-p.y)*(l-p.y)<0&&(f=Br(i,t,n,p.x,p.y,a,l,f))):(J[f++]=e.end().x,J[f++]=e.end().y,Ie.neq(p.distance2(e.end()),0)&&(s-p.x)*(a-p.x)+(o-p.y)*(l-p.y)<0&&(f=Br(i,t,n,p.x,p.y,s,o,f)));}if(f>0){let p=0;for(let m=0;m<f;m+=2){let g=J[m],b=J[m+1];isFinite(g)&&isFinite(b)&&(J[p++]=g,J[p++]=b);}return p;}else return 0;}else return 0;}function Br(r,e,t,n,i,s,o,a){if(i==o){let v=r-(i-t)*(i-t);if(Ie.greater(v,0)){let E=Math.sqrt(v),P=e-E,M=e+E,I=Math.min(n,s),C=Math.max(n,s);return P>=I&&P<=C&&(J[a++]=P,J[a++]=i),M>=I&&M<=C&&(J[a++]=M,J[a++]=i),a;}}let l=or.distance2(n,i,e,t)-r,u=or.distance2(s,o,e,t)-r,c=n,h=i,d=s,f=o,p=NaN,m=NaN,g=Number.POSITIVE_INFINITY,b=0;for(;g!==0;){b++;let v=Math.max(Math.min(Math.abs(l)/(Math.abs(l)+Math.abs(u)),.75),.25);if(p=c+(d-c)*v,m=h+(f-h)*v,c===p&&h===m||d===p&&f===m){Math.abs(l)>Math.abs(u)?(p=d,m=f,g=u):(p=c,m=h,g=l);break;}else g=or.distance2(p,m,e,t)-r,g<0&&l>u||g>0&&l<u?(d=p,f=m,u=g):(c=p,h=m,l=g);}let y=Math.sqrt(r)-or.distance1(p,m,e,t);return(Ie.eq(0,g)||Ie.eq(0,y))&&(J[a++]=p,J[a++]=m),a;}function XE(r,e,t,n,i,s,o){if(or.crossProd2(t,n,i,s,r,e)==0){let l=or.dotProd2(t,n,i,s,r,e),u=or.dotProd2(i,s,t,n,r,e);return l<0&&u<0?(J[o++]=r,J[o++]=e,o):l>=0?(J[o++]=i,J[o++]=s,o):(J[o++]=t,J[o++]=n,o);}else{let l=NaN,u=NaN,c=t,h=n,d=i,f=s,p=or.distance2(t,n,r,e),m=or.distance2(i,s,r,e),g=Number.POSITIVE_INFINITY,b=0;for(;g>0&&(b++,l=c+(d-c)*.5,u=h+(f-h)*.5,!(p==m||c==l&&h==u||d==l&&f==u));){g=or.distance2(l,u,r,e);let y=or.dotProd2(c,h,l,u,r,e);if(y==0)break;y<0?(d=l,f=u,m=g):(c=l,h=u,p=g);}return J[o++]=l,J[o++]=u,o;}}function hd(r,e){if(r.rx===r.ry)return Ou(r,e);throw new Error("not supported");}function JAe(r,e){if(r.rx===r.ry)return eY(r,e);throw new Error("not supported");}function tY(r,e){if(r.bbox().intersection1(e.bbox())!=null){if(r.rx===r.ry&&e.rx===e.ry)return rY(r,e);throw new Error("not supported operation");}return 0;}function rY(r,e){let t=r.center.x,n=r.center.y,i=e.center.x,s=e.center.y,o=r.rx,a=e.rx,l=r.rx2,u=e.rx2,c=r.center.distance1(e.center),h=Math.abs(o-a),d=o+a;if(Ie.greater(c,d)||Ie.less(c,h))return 0;if(Ie.eq(c,d)){if(VE(r,e))return 4;let f=new q(r.center,e.center),p=Ou(e,f);return p=WE(r,p),p!==0?p:(p=Ou(r,f),WE(e,p));}else if(Ie.greater(h,0)&&Ie.greater(c,0)&&Ie.eq(c,h)){if(VE(r,e))return 4;if(o>a){let f=(o-a)/o;return J[0]=t+(i-t)/f,J[1]=n+(s-n)/f,$E(r,e,2);}else{let f=(a-o)/a;return J[0]=i+(t-i)/f,J[1]=s+(n-s)/f,$E(r,e,2);}}else if(Ie.eq(h,0)&&Ie.eq(c,0)){let f=0,p;return Lt(r,e.start())&&(J[f]=e.start().x,J[f+1]=e.start().y,f+=2,p=e.start()),Lt(r,e.end())&&(J[f]=e.end().x,J[f+1]=e.end().y,f+=2,p=e.end()),f===0?(Lt(e,r.start())&&(J[f]=r.start().x,J[f+1]=r.start().y,f+=2),Lt(e,r.end())&&(J[f]=r.end().x,J[f+1]=r.end().y,f+=2)):f===2&&(!p.equals1(r.start())&&Lt(e,r.start())&&(J[f]=r.start().x,J[f+1]=r.start().y,f+=2),!p.equals1(r.end())&&Lt(e,r.end())&&(J[f]=r.end().x,J[f+1]=r.end().y,f+=2)),f;}else{let p=(r.center.distance2(e.center)-u+l)/(c*2)/c,m=(i-t)*p+t,g=(s-n)*p+n,b=i-t,y=s-n,v=Math.max(o,a),E,P,M,I;if(Math.abs(b)<Math.abs(y)){let T=b/-y,B=g-T*m;E=m-v,P=T*E+B,M=m+v,I=T*M+B;}else{let T=y/-b,B=m-T*g;P=g-v,E=T*P+B,I=g+v,M=T*I+B;}let C=Br(l,t,n,E,P,m,g,0);if(C=Br(l,t,n,m,g,M,I,C),C!==4)throw new Error("cnt !== 4");let L=new F(J[0],J[1]),S=new F(J[2],J[3]);if(Lt(r,L)&&Lt(e,L))return Lt(r,S)&&Lt(e,S)?4:Ws(r.start(),e,S,L)?(J[2]=r.start().x,J[3]=r.start().y,4):Ws(r.end(),e,S,L)?(J[2]=r.end().x,J[3]=r.end().y,4):Ws(e.start(),r,S,L)?(J[2]=e.start().x,J[3]=e.start().y,4):Ws(e.end(),r,S,L)?(J[2]=e.end().x,J[3]=e.end().y,4):2;if(Lt(r,S)&&Lt(e,S))return Ws(r.start(),e,L,S)?(J[0]=r.start().x,J[1]=r.start().y,4):Ws(r.end(),e,L,S)?(J[0]=r.end().x,J[1]=r.end().y,4):Ws(e.start(),r,L,S)?(J[0]=e.start().x,J[1]=e.start().y,4):Ws(e.end(),r,L,S)?(J[0]=e.end().x,J[1]=e.end().y,4):(J[0]=J[2],J[1]=J[3],2);{let Z=function(H,W){if(!!(Ie.eq(H.distance1(W.center),W.rx)&&Lt(W,H))){if(H.distance2(L)<H.distance2(S)){if(T)return;T=!0;}else{if(B)return;B=!0;}J[$++]=H.x,J[$++]=H.y;}},T=!1,B=!1,$=0;return Z(r.start(),e),Z(r.end(),e),Z(e.start(),r),Z(e.end(),r),$;}}}function Ws(r,e,t,n){return Ie.eq(r.distance1(e.center),e.rx)&&Lt(e,r)&&r.distance2(t)<r.distance2(n);}function VE(r,e){return Ie.eq(e.start().distance1(r.center),r.rx)&&Lt(r,e.start())?(J[0]=e.start().x,J[1]=e.start().y,J[2]=e.start().x,J[3]=e.start().y,!0):Ie.eq(e.end().distance1(r.center),r.rx)&&Lt(r,e.end())?(J[0]=e.end().x,J[1]=e.end().y,J[2]=e.end().x,J[3]=e.end().y,!0):Ie.eq(r.start().distance1(e.center),e.rx)&&Lt(e,r.start())?(J[0]=r.start().x,J[1]=r.start().y,J[2]=r.start().x,J[3]=r.start().y,!0):Ie.eq(r.end().distance1(e.center),e.rx)&&Lt(e,r.end())?(J[0]=r.end().x,J[1]=r.end().y,J[2]=r.end().x,J[3]=r.end().y,!0):!1;}function WE(r,e){if(e===0)return 0;let t=J[0],n=J[1];return Lt(r,new F(t,n))?(J[0]=t,J[1]=n,J[2]=t,J[3]=n,4):0;}function $E(r,e,t){if(t===0)return 0;let n=J[0],i=J[1],s=new F(n,i);return Lt(r,s)&&Lt(e,s)?(J[0]=n,J[1]=i,J[2]=n,J[3]=i,4):0;}function Ja(r,e){return Math.abs(r-e)<=1e-6;}function Lt(r,e){let t=r.bbox();if(e.x-t.minX>-Lu&&e.x-t.maxX<Lu&&e.y-t.minY>-Lu&&e.y-t.maxY<Lu){let n=at.regularD(e.angleD(r.center));return Ja(n,r.startAngle)||Ja(n,r.startAngle+360)||Ja(n,r.startAngle-360)||Ja(n,r.endAngle())||Ja(n,r.endAngle()+360)||Ja(n,r.endAngle()-360)?!0:r.sweepAngle>0?(Ie.less(n,r.startAngle)&&(n+=360),Ie.greatereq(r.endAngle(),n)):(Ie.greater(n,r.startAngle)&&(n-=360),Ie.lesseq(r.endAngle(),n));}else return!1;}function eCe(r,e,t){var n,i=+e.x,s=+e.y,o=+t.x,a=+t.y,l=+r.x,u=+r.y,c=o-i,h=a-s,d=l-i,f=u-s,p,m,g,b,y,v;return c===0&&h===0?{d:Math.sqrt(d*d+f*f),point:new F(i,s)}:(n=(d*c+f*h)/(c*c+h*h),n<0?{d:Math.sqrt(d*d+f*f),point:new F(i,s)}:n>1?(p=l-o,m=u-a,{d:Math.sqrt(p*p+m*m),point:new F(o,a)}):(y=i+n*c,v=s+n*h,g=l-y,b=u-v,{d:Math.sqrt(g*g+b*b),point:new F(y,v)}));}function tCe(r,e,t,n){function i(m,g,b){return m instanceof F&&g instanceof F?Math.abs(m.x-g.x)<=b&&Math.abs(m.y-g.y)<=b:!1;}var s=i(r,t,.5)||i(r,n,.5)?r:i(e,t,.5)||i(e,n,.5)?e:null;if(s)return!1;var o,a,l,u,c,h,d,f,p;return o=e.x-r.x,a=e.y-r.y,l=n.x-t.x,u=n.y-t.y,d=l*a-u*o,d===0?!1:(f=t.x-r.x,p=t.y-r.y,h=(o*p-a*f)/d,c=(l*p-u*f)/d,h>=0&&h<=1&&c>=0&&c<=1?new F(r.x+c*o,r.y+c*a):!1);}function rCe(r,e){if(!r||!e||r.length!=e.length)return!1;let t="equals1";return!r.some((i,s)=>{let o=e[s],a=!1;return i&&o&&typeof i=="object"&&typeof o=="object"?typeof i[t]=="function"&&iY(i,o)?a=!i[t].call(i,o):a=!(i===o||i.toString()===o.toString()):typeof i=="number"&&typeof o=="number"?a=!(nY(i,o)||Number.isNaN(i)&&Number.isNaN(o)):a=i!==o,a;});}function nY(r,e,t=5){return Math.abs(r-e)*Math.pow(10,t)<1;}function iY(r,e){return!r||!e||typeof r!="object"||typeof e!="object"?r===e:r.constructor===e.constructor;}function nCe(r,e){return new q(r,e);}function iCe(r,e,t,n){var i=e.y-r.y,s=r.x-e.x,o=i*r.x+s*r.y,a=n.y-t.y,l=t.x-n.x,u=a*t.x+l*t.y,c=i*l-a*s;if(c==0)return null;var h=(l*o-s*u)/c,d=(i*u-a*o)/c;return new F(h,d);}function sCe(r,e,t){isNaN(t)&&(t=.001);let n=r.center,i=r.start(),s=r.rx,o=r.ry;var a=Math.atan2(e.y-n.y,e.x-n.x),l=Math.atan2(i.y-n.y,i.x-n.x),u=Math.atan2(o-n.y,s-n.x);if(Math.abs(l-a)<t||Math.abs(l-a)>Math.PI*2-t||Math.abs(u-a)<t)return!0;var c=Math.abs(l-u)>Math.PI===r.isLarge();return Math.abs(Math.abs(l-u)-Math.PI)<t&&(c=(l<=0&&u>=0)==!r.isCCW),l>=u&&l>=a&&a>=u||l<=u&&l<=a&&a<=u?c:!c;}var fd=(n=>(n[n.VALID=0]="VALID",n[n.INVALID=1]="INVALID",n[n.UNMARKED=2]="UNMARKED",n))(fd||{}),as=class{constructor(e){this._status=2;this.sides=[];this.connect=[];this.keepWeight=0;this.reverseWeight=0;this.invalidWeight=0;this.weight=e;}get status(){return this._status;}get start(){return this.sides[0].start;}get end(){return this.sides[this.sides.length-1].end;}mark(){if(this._status===2){if(this.invalidWeight>this.keepWeight&&this.invalidWeight>this.reverseWeight){this._status=1;return;}if(this.keepWeight>this.reverseWeight&&this.keepWeight>this.invalidWeight){this._status=0;return;}if(this.reverseWeight>this.keepWeight&&this.reverseWeight>this.invalidWeight){this._status=0,this.needReverse=!0;return;}}}reverse(){let e=this.reverseWeight;this.reverseWeight=this.keepWeight,this.keepWeight=e;let t=[];for(;this.sides.length!==0;)t.push(this.sides.pop().reverse());for(let i of t)this.sides.push(i);this.startNode&&(this.startNode.outChainSet.delete(this),this.startNode.inChainSet.add(this),this.endNode.inChainSet.delete(this),this.endNode.outChainSet.add(this));let n=this.startNode;this.startNode=this.endNode,this.endNode=n;}getStartTangent(){let e=this.sides[0].shape;return e instanceof ee?e.start().sub(e.center).multiply3(e.isCCW?ze.ROT_90:ze.ROT_N90).normalize():e.end().sub(e.start()).normalize();}getEndTangent(){let e=this.sides[this.sides.length-1].shape;return e instanceof ee?e.end().sub(e.center).multiply3(e.isCCW?ze.ROT_N90:ze.ROT_90).normalize():e.start().sub(e.end()).normalize();}bbox(){return this.sides.reduce((e,t)=>e.ext1(t.bbox()),new ke()).build();}getWindingNum(e){let t=this.end,n=0,{x:i,y:s}=e;for(let o of this.sides){let{start:a,end:l,shape:u}=o;if(t.y>s!=a.y>s&&(t.x>i?a.x>i?n+=a.y>t.y?1:-1:t.y>a.y?(t.x-i)*(a.y-s)-(t.y-s)*(a.x-i)<0&&n--:(t.x-i)*(a.y-s)-(t.y-s)*(a.x-i)>0&&n++:a.x>i&&(t.y>a.y?(t.x-i)*(a.y-s)-(t.y-s)*(a.x-i)<0&&n--:(t.x-i)*(a.y-s)-(t.y-s)*(a.x-i)>0&&n++)),a.y>s!=l.y>s){if(a.x>i){if(l.x>i)n+=l.y>a.y?1:-1;else if(u instanceof q)a.y>l.y?(a.x-i)*(l.y-s)-(a.y-s)*(l.x-i)<0&&n--:(a.x-i)*(l.y-s)-(a.y-s)*(l.x-i)>0&&n++;else if(u instanceof ee){let{center:c,isCCW:h,rx2:d}=u,f=Le(c.x-i,2)+Le(c.y-s,2);a.y>l.y?(h?f>d:f<d)&&n--:(h?f<d:f>d)&&n++;}else throw new Error("not support!");}else if(l.x>i)if(u instanceof q)a.y>l.y?(a.x-i)*(l.y-s)-(a.y-s)*(l.x-i)<0&&n--:(a.x-i)*(l.y-s)-(a.y-s)*(l.x-i)>0&&n++;else if(u instanceof ee){let{center:c,isCCW:h,rx2:d}=u,f=Le(c.x-i,2)+Le(c.y-s,2);a.y>l.y?(h?f>d:f<d)&&n--:(h?f<d:f>d)&&n++;}else throw new Error("not support!");}t=l;}return n;}};function sY(r,e){let t=0;if(Math.abs(r.start.y-e)<=1e-4)J[t++]=r.start.x;else if(Math.abs(r.end.y-e)<=1e-4)J[t++]=r.end.x;else if(r.shape instanceof q)t=fg(r.shape,e);else if(r.shape instanceof ee)t=dg(r.shape,e);else throw new Error("not supported operation");return t;}var jE=(i=>(i[i.UNMARKED=0]="UNMARKED",i[i.INSIDE=1]="INSIDE",i[i.OUTSIDE=2]="OUTSIDE",i[i.INVALID=3]="INVALID",i))(jE||{}),si=class{constructor(e,t,n,i,s,o){this.inters=[];this._confidence=0;this._confidence_y=NaN;this._x=NaN;this._x_y=NaN;this.trans=NaN;this.previous=null;this.next=null;this.shape=e,t.y>n.y?this.weight=-o.weight:t.y==n.y?this.weight=0:this.weight=o.weight,this.start=t,this.end=n;let a=new ke().ext1(e.bbox()).ext2(t).ext2(n).build();this.polyGrp=i,this.polyIndex=s,this._bbox=a,this.inters.push([t,null]),this.inters.push([n,null]),this.chain=o;}static rebuild(e,t,n){if(e instanceof q||t.distance2(n)<1e-6)return new q(t,n);if(e instanceof ee){let i=e,s=e.bbox().center().x,o;t.y>n.y?o=s>i.center.x?vt.CW:vt.CCW:o=s>i.center.x?vt.CCW:vt.CW;let a=t.angleD(i.center),l=n.angleD(i.center);return ee.build2(i.center,a,l,i.rx,i.ry,o);}else throw new Error("not supported operation");}updateBbox(){this._bbox=new ke().ext2(this.start).ext2(this.end).build();}confidence(e){if(this._confidence_y!=e){let t=this._bbox.height();if(t!==0){if(Math.abs(e-this._bbox.maxY)>5e-4&&Math.abs(e-this._bbox.minY)>5e-4){let n=1-Math.abs(2*e-this._bbox.maxY-this._bbox.minY)/t;this._confidence=n*1e4|0;}else this._confidence=0;}else this._confidence=1;this._confidence_y=e;}return this._confidence;}revokeOutside(e){let t=this.confidence(e);return this.start.y>this.end.y?this.chain.reverseWeight-=t:this.chain.keepWeight-=t,this.chain.invalidWeight+=t,t;}revokeInside(e){let t=this.confidence(e);return this.start.y<this.end.y?this.chain.reverseWeight-=t:this.chain.keepWeight-=t,this.chain.invalidWeight+=t,t;}setOutside(e){let t=this.confidence(e);return this.start.y>this.end.y?this.chain.reverseWeight+=t:this.chain.keepWeight+=t,t;}setInside(e){let t=this.confidence(e);return this.start.y<this.end.y?this.chain.reverseWeight+=t:this.chain.keepWeight+=t,t;}setInvalid(e){let t=this.confidence(e);return this.chain.invalidWeight+=t,t;}prevNot0(){let e=this.previous;for(;e!=null&&e!=this;){if(e.weight!=0)return e;e=e.previous;}return null;}nextNot0(){let e=this.next;for(;e!=null&&e!=this;){if(e.weight!=0)return e;e=e.next;}return null;}getX(e){return(this._x_y!=e||isNaN(this._x))&&(sY(this,e)>0?this._x=J[0]:this._x=NaN,this._x_y=e),this._x;}voteStatus(){let{keepWeight:e,reverseWeight:t,invalidWeight:n,status:i}=this.chain;return i===1?3:i===0?(this.chain.needReverse?!(this.end.y>this.start.y):this.end.y>this.start.y)?2:1:e>n&&e>t?this.end.y>this.start.y?2:1:n>e&&n>t?3:t>n&&t>e?this.end.y<this.start.y?2:1:0;}reverse(){this.shape=si.rebuild(this.shape,this.end,this.start);let e=this.start;return this.start=this.end,this.end=e,this;}isNeedScan(e){return this.chain.keepWeight+this.chain.reverseWeight+this.chain.invalidWeight<5e3&&this.confidence(e)>0&&this.chain.status===2;}bbox(){return this._bbox;}toString(){return bn.format("(%d,%d,%d) (%d,%d,%d) %s %s",this.polyGrp,this.polyIndex,this.weight,this.chain.keepWeight,this.chain.reverseWeight,this.chain.invalidWeight,this.start,this.end);}};var dd=class{constructor(e){this.polyGrp=0;this.polyIndex=0;this.prevSide=null;this.noWeight0=e;}completeGroup(){this.prevSide&&!this.prevSide.end.equals1(this.curSideChain.start)&&this.addSide(new q(this.prevSide.end,this.curSideChain.start));let e,t=null,n=null;return this.noWeight0?e=this.curSideChain.sides.filter(i=>i.weight===0?!1:(t!=null?(t.next=i,i.previous=t):n=i,t=i,!0)):(e=this.curSideChain.sides,e.forEach(i=>{t!=null?(t.next=i,i.previous=t):n=i,t=i;})),t!=null&&n!=null&&(n.previous=t,t.next=n),this.polyGrp++,this.curSideChain=null,this.prevSide=null,this.polyIndex=0,e;}buildGroup(e,t){this.curSideChain=new as(t);for(let n of e.primitives)if(n instanceof q)this.addSide(n);else if(n instanceof ee&&n.rx===n.ry)this.addArc(n);else{let i=null;for(let s of n.points(1))i!=null&&this.addSide(new q(i,s)),i=s;}return this.completeGroup();}addArc(e){let t=e.sweepAngle,n=at.regularD(e.startAngle),i=n+t;if(t>0){let s=90;for(;s<=i;)s>n&&(this.addSide(ee.build3(e.center,n,s-n,e.rx,e.ry)),n=s),s+=90;n<i&&this.addSide(ee.build3(e.center,n,i-n,e.rx,e.ry));}else if(t<0){let s=270;for(;s>=i;)s<n&&(this.addSide(ee.build3(e.center,n,s-n,e.rx,e.ry)),n=s),s-=90;n>i&&this.addSide(ee.build3(e.center,n,i-n,e.rx,e.ry));}}addSide(e){let t=e.start(),n=e.end();if(t.equals1(n))return;this.prevSide&&!this.prevSide.end.equals1(t)&&this.addSide(new q(this.prevSide.end,t));let i=new si(e,t,n,this.polyGrp,this.polyIndex++,this.curSideChain);this.curSideChain.sides.push(i),this.prevSide=i;}};var pd=class{constructor(e,t,n,i=0){this.eps=new Array();this.start=null;this.last=null;this.prevStart=null;this.prevEnd=null;this.y=n,this.rule=e,this.event=t.event,this.curWeight=i,e(i)&&(this.start=void 0);}getCurWeight(){return this.curWeight;}onEp(e){this.tuningWeight(e),this.start===null?this.rule(this.curWeight)?this.in(e):e.setInvalid(this.y):this.rule(this.curWeight)?e.setInvalid(this.y):this.out(e),this.last!==null&&this.event.onSweep1(this.last,e,this.y),this.last=e;}in(e){this.prevEnd!=null&&this.onSameX(e,this.prevEnd)?(this.start=this.prevStart,this.prevStart=null,this.prevEnd.revokeInside(this.y),this.prevEnd=null):(this.start=e,this.start.setOutside(this.y));}connect(e){e.chain.connect.push(this.start.chain),this.start.chain.connect.push(e.chain);}out(e){if(this.start===void 0){e.setInside(this.y),this.start=null;return;}if(this.onSameX(this.start,e))this.start.revokeOutside(this.y);else{if(e.setInside(this.y)>0&&this.start.confidence(this.y)>0){let t=this.start.voteStatus(),n=e.voteStatus();this.isValid(t)&&this.isValid(n)?t==2&&n==1&&this.connect(e):this.connect(e);}this.event.onSegment1(this.start,e,this.y),this.eps.push(this.start),this.eps.push(e),this.prevStart=this.start,this.prevEnd=e;}this.start=null;}isValid(e){return e==1||e==2;}onSameX(e,t){return e.bbox().isIntersect(t.bbox())&&Ie.eq(e.getX(this.y),t.getX(this.y));}tuningWeight(e){this.curWeight+=e.weight;let t=e.nextNot0(),n=e.prevNot0();t!=null&&e.weight===t.weight&&t.trans===this.y&&(this.curWeight-=e.weight),n!=null&&e.weight===n.weight&&n.trans===this.y&&(this.curWeight-=e.weight),e.trans=this.y;}};var md=class{constructor(){this._inChainSet=new Set();this._outChainSet=new Set();this._mergedNode=this;}get mergedNode(){for(;!this._mergedNode._inChainSet;)this._mergedNode=this._mergedNode._mergedNode;return this._mergedNode;}get inChainSet(){return this.mergedNode._inChainSet;}get outChainSet(){return this.mergedNode._outChainSet;}getSortedChains(){let e=[];if(this.inChainSet.forEach(t=>{let n=t.sides[t.sides.length-1],i,s;n.shape instanceof ee?(i=n.shape.exchangeSweep(),s=at.regular(at.toRadians(n.shape.endAngle()-(n.shape.isCCW?90:-90)))):(i=new q(n.end,n.start),s=at.regular(n.start.angle(n.end))),e.push({chain:t,isStart:!1,angle:s,shape:i});}),this.outChainSet.forEach(t=>{let n=t.sides[0];e.push({chain:t,isStart:!0,angle:n.shape instanceof ee?at.regular(at.toRadians(n.shape.startAngle+(n.shape.isCCW?90:-90))):at.regular(n.end.angle(n.start)),shape:n.shape});}),e.sort((t,n)=>t.angle-n.angle),Ie.eq(e[0].angle+2*Math.PI,e[e.length-1].angle)){let t,n=e[0].angle;for(let i=1;i<e.length;i++){let s=e[i].angle;if(s-n>Ie.eps*2){t=(n+s)/2;break;}n=s;}e.forEach(i=>i.angle=at.regular(i.angle-t));}return e.sort((t,n)=>{if(!Ie.eq(t.angle,n.angle))return t.angle-n.angle;let i=t.shape,s=n.shape;if(i instanceof ee)return s instanceof ee?i.isCCW?s.isCCW?s.rx-i.rx:1:s.isCCW?-1:i.rx-s.rx:i.sweepAngle;if(s instanceof ee)return-s.sweepAngle;return console.log("=========",t,n,t.angle,n.angle,n.shape.end().sub(n.shape.start()).cross(t.shape.end().sub(n.shape.start()))),n.shape.end().sub(n.shape.start()).cross(t.shape.end().sub(n.shape.start()));return t.angle-n.angle;}),e.map(t=>({chain:t.chain,isStart:t.isStart}));}merge(e){if(!e)return this._mergedNode;let t=this.mergedNode,n=e.mergedNode;if(t===n)return t;for(let i of n._inChainSet)t._inChainSet.add(i);for(let i of n._outChainSet)t._outChainSet.add(i);return delete n._inChainSet,delete n._outChainSet,n._mergedNode=t,t;}};var gd=class{constructor(){this.chain=new as(0);this.others=[];}add(e){this.chain.sides.push(...e.sides),e.finalGrp=this;for(let t of e.connect)this.others.push(t);}get polyline(){if(!this._polyline){let e=new Array();for(let t of this.chain.sides)e.push(t.shape);this._polyline=Me.build2(e).asClose();}return this._polyline;}bbox(){return this.polyline.bbox();}};var xd=class{constructor(e,t){this.chains=e,this.originChains=t,e.forEach(n=>n.block=this),this._bbox=t.reduce((n,i)=>n.ext1(i.bbox()),new ke()).build();}searchOriginChains(e){return this.originChainRTree||(this.originChainRTree=new zn(10),this.originChains.forEach(t=>this.originChainRTree.add(t))),this.originChainRTree.search(e);}bbox(){return this._bbox;}};var oY=cr.funcCopy(xn),bd=class{constructor(e){this.parents=new Set();this.childrenRTree=new bi(10);this.marked=!1;this.markedChildNum=0;this.item=e;}bbox(){return this.item.bbox();}};function ZE(r){let e=r.map(n=>new bd(n));oY(e,(n,i)=>i.bbox().area()-n.bbox().area(),0,e.length);let t=new bd(null);return e.forEach(n=>{let i=n.bbox(),s=[t],o=new Set();for(;s.length!==0;){let a=s.pop();if(o.has(a))continue;o.add(a);let l=a.childrenRTree.search(i),u=l.filter(c=>c.bbox().isContainsBBox(i));u.length===0?(l.filter(c=>i.isContainsBBox(c.bbox())).forEach(c=>{c.parents.delete(a),a.childrenRTree.remove(c),c.parents.add(n),n.childrenRTree.insert(c);}),a.childrenRTree.insert(n),n.parents.add(a)):s.push(...u);}}),t.childrenRTree.items.forEach(n=>n.parents.clear()),Array.from(t.childrenRTree.items);}var yd=.01,wd=1,aY=cr.funcCopy(xn),lY=cr.funcCopy(xn),uY=cr.funcCopy(xn),cY=cr.funcCopy(xn);function hY(r,e){return r.bbox().minY-e.bbox().minY;}function fY(r,e){return r.bbox().area()-e.bbox().area();}var pg,HE={};function ku(r){HE[r]=(HE[r]||0)-pg+(pg=performance.now());}var dY=0,pY=0,mY=0,gY=0,xY=0,bY=0,yY=0,vd=class{constructor(e,t){this.vertex=e,this.node=t;}bbox(){return this.vertex.bbox();}},Ed=class extends cd{constructor(t,n,i){super(new dd(!1),t,n,i);this.outSideGroups=[];this.inSideGroups=[];this.scanY=NaN;this.curNetIndex=0;this.scanLines=0;this.blockOriginChainsIndex=[];this.blockChainsIndex=[];this.blocks=[];}addPolyline(t,n=1){let i=super.addPolyline(t,n);return i.length!==0&&(i[0].chain.blockIndex=this.blockOriginChainsIndex.length,this.blockOriginChainsIndex.push([i[0].chain])),i;}sweep(t,n,i,s,o){this.scanY=NaN,this.scanLines=0,lY(n,hY,0,n.length);let a=new Mn();this.curNetIndex=0;let l=Number.POSITIVE_INFINITY;for(let u of t)u>l&&this.scan(a,(l+u)/2,n,i,s),l=u;for(let u of o)u.mark();yY+=this.scanLines;}simplify(){bY++,dY+=this.blockOriginChainsIndex.length,mY+=this.sides.length,pg=performance.now(),this.seekIntersection(),ku("seekIntersection"),this.splitSidesByInters(),this.blockChainsIndex.forEach(t=>{pY+=t.length,t.forEach(n=>gY+=n.sides.length);}),ku("splitSidesByInters"),this.sweepBlocks(),xY+=this.blocks.length,ku("sweepBlocks"),this.connectSides(),ku("connectSides"),this.fillResult(),ku("fillResult");}sweepBlocks(){let t=new Set();this.blockChainsIndex.forEach((s,o)=>{let a=new xd(s,this.blockOriginChainsIndex[o]),l=a.bbox();if(l.width()<=yd||l.height()<=yd)return;this.blocks.push(a);let u=Number.NEGATIVE_INFINITY,c;s.forEach(h=>{h.sides.forEach(d=>{Math.abs(d.start.y-d.end.y)>u&&(u=Math.abs(d.start.y-d.end.y),c=d);});}),t.add(c.start.y),t.add(c.end.y);});let n=ZE(this.blocks),i=[];for(;n.length!==0;){let s=n.pop();s.childrenRTree.items.size===0?i.push(s):n.push(...s.childrenRTree.items);}for(;i.length!==0;){let s=i.pop();if(s.marked)continue;let o=new Mn();s.parents.forEach(h=>o.push(h));let a=s.item.chains[0].start,l=a.bbox(),u,c=0;for(;o.size()!==0&&!u;){let h=o.shift();for(let d of h.item.searchOriginChains(l)){let f=d.getWindingNum(a);f!==0&&(u=h,c-=f*d.weight);}h.parents.forEach(d=>o.push(d));}for(let h of s.parents)h.childrenRTree.remove(s),h.childrenRTree.items.size===h.markedChildNum&&i.push(h);s.parents.clear(),s.marked=!0,u?(s.item.startWeight=c,s.parents.add(u),u.childrenRTree.insert(s),u.markedChildNum++):(s.item.startWeight=0,n.push(s));}for(;n.length!==0;){let s=n.pop(),o=s.item.startWeight;for(let a of s.childrenRTree.items)a.item.startWeight+=o,n.push(a);}this.blocks.forEach((s,o)=>{let a=[];s.chains.forEach(l=>a.push(...l.sides)),this.sweep(this.getSortedEndpointsLineAsc(!1,s.chains),a,!1,s.startWeight,s.chains),this.sweep(this.getSortedEndpointsLineAsc(!0,s.chains),this.flipSides(a),!0,s.startWeight,s.chains);});}scan(t,n,i,s,o){if(this.scanY===n)return;this.scanY=n;let a=!1,l=t.listIterator();for(;l.hasNext();){let d=l.next(),f=d.item;Ie.less(f.bbox().maxY,n)?t.remove(d):!a&&f.isNeedScan(n)&&(a=!0);}for(;this.curNetIndex<i.length;){let d=i[this.curNetIndex];if(Ie.less(d.bbox().minY,n))Ie.greatereq(d.bbox().maxY,n)&&(this.add2AET(t,d),!a&&d.isNeedScan(n)&&(a=!0)),this.curNetIndex++;else break;}if(!a)return;this.scanLines++;let u=new pd(this.rule,this,n,o),c=t.iterator(),h=0;for(;c.hasNext();){let d=c.next(),f=u.getCurWeight();u.onEp(d),this.event.onScan(s,d,n,h++,f,u.getCurWeight());}}add2AET(t,n){let i=n.bbox().minX,s=n.bbox().maxX,o=n.bbox().minY,a=n.bbox().maxY,l=t.listIterator(),u=null;for(;l.hasNext();){let c,h=l.next(),d=h.item,f=d.bbox().minX,p=d.bbox().maxX;if(s<=f)c=-1;else if(p<=i)c=1;else{let g=d.bbox().minY,b=d.bbox().maxY,y=Math.max(o,g),v=Math.min(a,b);c=this.compareBySweep(n,d,(y+v)/2);}let m=d.shape;if(m instanceof q&&m.length()<.001&&u==null&&c<0){u=h;continue;}if(u!=null&&c<0){t.insertBefore(u,n);return;}if(c<0){t.insertBefore(h,n);return;}else u=null;}t.add(n);}getLineAngle(t){let n=t.start().angle(t.end());return n<0&&(n+=Math.PI),n;}getArcAngle(t,n){let i=Math.asin((n-t.center.y)/t.rx);return t.startAngle>90&&t.startAngle<270&&(i=-i),i<0&&(i+=Math.PI),(i+Math.PI/2)%Math.PI;}compareArcLine(t,n,i){let s=this.getArcAngle(t,i),o=this.getLineAngle(n);return Ie.eq(s,o)?-t.sweepAngle:o-s;}compareBySweep(t,n,i){let s=t.getX(i);if(!isFinite(s))return 0;let o=n.getX(i);if(!isFinite(o))return 0;if(!Ie.eq(s,o))return s-o;if(t.shape instanceof q)return n.shape instanceof q?this.getLineAngle(n.shape)-this.getLineAngle(t.shape):-this.compareArcLine(n.shape,t.shape,i);if(n.shape instanceof q)return this.compareArcLine(t.shape,n.shape,i);{let a=t.shape,l=n.shape,u=this.getArcAngle(a,i),c=this.getArcAngle(l,i);return Ie.eq(u,c)?a.sweepAngle*l.sweepAngle<=0?a.sweepAngle<=0?1:-1:a.sweepAngle>0?a.rx-l.rx:l.rx-a.rx:c-u;}}flipSides(t){let n=[];for(let i of t){if(i.polyIndex!==0)continue;let s=null,o=null;do{let a=i.shape.multiply3(ze.ROT_90),l=i.start.multiply3(ze.ROT_90),u=i.end.multiply3(ze.ROT_90),c=new si(a,l,u,i.polyGrp,i.polyIndex,i.chain);if(s!=null?(s.next=c,c.previous=s):o=c,n.push(c),this.event.onSplitedSide(c),s=c,i.next!==null)i=i.next;else break;}while(i.polyIndex!=0);o!=null&&(o.previous=s,s.next=o);}return n;}connectSides(){let t=[];this.blocks.forEach(n=>n.chains.forEach(i=>{if(i.needReverse===!0&&i.reverse(),i.sides.forEach(o=>this.event.onResultSide(o)),i.status===0?t.push(i):i.status===1&&i.startNode&&(i.startNode.outChainSet.delete(i),i.endNode.inChainSet.delete(i)),!i.startNode)return;let s=new ke();for(let o of i.sides){s.ext1(o.bbox());let a=s.build();if(a.width()>yd||a.height()>yd)return;}i.startNode.outChainSet.delete(i),i.endNode.inChainSet.delete(i),i.startNode.merge(i.endNode),i.status===0&&t.pop();}));{let n=new zn(10);for(let i of t)!i.startNode||(i.startNode.inChainSet.size!==i.startNode.outChainSet.size&&n.add(new vd(i.start,i.startNode)),i.endNode.inChainSet.size!==i.endNode.outChainSet.size&&n.add(new vd(i.end,i.endNode)));for(let{vertex:i,node:s}of n.items())n.search(new ye(i.x-wd,i.x+wd,i.y-wd,i.y+wd)).forEach(o=>{o.vertex!==i&&s.merge(o.node);});}for(let n of t){let i=new Mn();if(i.add(n),!n.startNode){this.fillSideGroups(i);continue;}if(!n.startNode.outChainSet.has(n))continue;n.startNode.outChainSet.delete(n),n.endNode.inChainSet.delete(n);let s=n.startNode.outChainSet;for(;i.size()>0;){let o=i.getLast();if(o.endNode.outChainSet===s)break;let a=Number.POSITIVE_INFINITY,l,u=o.end;for(let c of o.endNode.outChainSet){if(c.status!==0)continue;let h=u.distance2(c.start);if(h<a&&(a=h,l=c,h===0))break;}l?(i.add(l),l.startNode.outChainSet.delete(l),l.endNode.inChainSet.delete(l)):i.removeLast();}i.size()>0&&this.fillSideGroups(i);}}fillSideGroups(t){let n=new gd();wa(t,(i,s)=>(n.add(s),!0)),n.polyline.area(.1)<0?this.outSideGroups.push(n):this.inSideGroups.push(n);}fillResult(){let t=0,n=new zn(10),i=this.outSideGroups.map((s,o)=>{s.outIndex=o,n.add(s);let a=[];a.push(s);for(let l of a)if(l.isUsed!==!0){l.isUsed=!0;for(let u of l.others)u.finalGrp&&a.push(u.finalGrp);}return a.filter(l=>l.isUsed===!0?(l.isUsed=!1,!0):!1).map(l=>(l.isUsed=!0,l.polyline));});this.inSideGroups.map(s=>{if(s.isUsed===!0)return;let o=n.search(s.chain.start.bbox());cY(o,fY,0,o.length);for(let a of o)if(a.chain.getWindingNum(s.chain.start)!==0){i[a.outIndex].push(s.polyline);break;}});for(let s of i)this.event.onPolylineGroup(new bo(s),t++);}getSortedEndpointsLineAsc(t,n){let i=t?"x":"y",s=new Set();for(let a of n){if(a.status!==2)continue;let l,u=Number.NEGATIVE_INFINITY;for(let c of a.sides)Math.abs(c.start[i]-c.end[i])>u&&(l=c,u=Math.abs(c.start[i]-c.end[i]));u!==0&&(s.add(l.start[i]),s.add(l.end[i]));}let o=Array.from(s);return uY(o,cr.sortAsc,0,o.length),o;}splitSides(t,n,i,s){if(t.inters.length===2){let c=new si(t.shape,t.start,t.end,t.polyGrp,i++,this.curChain);return c.updateBbox(),n.push(c),this.curChain.sides.push(c),i;}let{start:o,end:a}=t,l=new F(a.x+(o.x-a.x)*2,a.y+(o.y-a.y)*2);aY(t.inters,(c,h)=>c[0].distance2(l)-h[0].distance2(l),0,t.inters.length);let u=null;for(let[c,h]of t.inters){if(!u)c.equals1(o)&&(u=c);else if(!c.equals1(u)){let d=si.rebuild(t.shape,u,c);d instanceof ee&&Math.abs(d.sweepAngle)>190&&(d=new q(u,c));let f=new si(d,u,c,t.polyGrp,i++,this.curChain);f.updateBbox(),n.push(f),this.curChain.sides.push(f),c.equals1(a)?u=null:u=c;}!h||(this.curChain.sides.length===0?this.prevChain&&(h.inChainSet.add(this.prevChain),this.prevChain.endNode=h.merge(this.prevChain.endNode)):(this.prevChain=this.curChain,h.inChainSet.add(this.prevChain),this.prevChain.endNode=h.merge(this.prevChain.endNode),this.curChain=new as(t.chain.weight),s.push(this.curChain)),h.outChainSet.add(this.curChain),this.curChain.startNode=h.merge(this.curChain.startNode));}return i;}splitSidesByInters(){this.blockOriginChainsIndex.forEach((t,n)=>{let i=[];this.blockChainsIndex[n]=i;for(let s of t){this.curChain=new as(s.weight),i.push(this.curChain);let o=this.curChain;this.prevChain=null;let a=0,l,u;for(let c of s.sides){let h=new Array();a=this.splitSides(c,h,a,i);for(let d of h)l!=null?(l.next=d,d.previous=l):u=d,l=d,this.event.onSplitedSide(d);}if(u.previous=l,l.next=u,o.startNode)this.curChain.sides.length===0?(i.pop(),this.curChain.startNode.outChainSet.delete(this.curChain),this.curChain.startNode.merge(o.startNode)):(o.startNode.inChainSet.add(this.curChain),this.curChain.endNode=o.startNode);else{if(o===this.curChain)continue;i.pop();for(let h of this.curChain.sides)h.chain=o;let c=this.curChain.sides.concat(o.sides);o.sides.length=0;for(let h of c)o.sides.push(h);this.curChain.startNode.outChainSet.delete(this.curChain),this.curChain.startNode.outChainSet.add(o),o.startNode=this.curChain.startNode;}}});}seekIntersection(){let t=new ke();this.sides.forEach(o=>t.ext1(o.bbox()));let n=t.build().LL();for(let o of this.sides){let a=o.bbox();o.oneDimStart=a.LL().distance2(n),o.oneDimEnd=a.UR().distance2(n);}this.sides.sort((o,a)=>o.oneDimStart-a.oneDimStart);let i=new bi(10),s=new Es((o,a)=>o.oneDimEnd-a.oneDimEnd);for(let o of this.sides){for(;;){let a=s.poll();if(a){if(o.oneDimStart<=a.oneDimEnd){s.add(a);break;}else i.remove(a);}else break;}for(let a of i.search(o.bbox().extendOfSize(1e-5))){if(a===o.next&&a===o.previous)continue;let l=Nu(o.shape,a.shape);if(l!==0){for(let u=l-2;u>=2;u-=2)for(let c=u-2;c>=0;c-=2)if(Ie.eq(J[u],J[c])&&Ie.eq(J[u+1],J[c+1])){J[c]=(J[u]+J[c])/2,J[c+1]=(J[u+1]+J[c+1])/2;for(let h=l-3;h>=u;h--)J[h]=J[h+2];l-=2;break;}if(a===o.next){if(l<=2)continue;Le(J[0]-a.start.x,2)+Le(J[1]-a.start.y,2)<Le(J[2]-a.start.x,2)+Le(J[3]-a.start.y,2)&&(J[0]=J[2],J[1]=J[3]),l=2;}else if(a===o.previous){if(l<=2)continue;Le(J[0]-a.end.x,2)+Le(J[1]-a.end.y,2)<Le(J[2]-a.end.x,2)+Le(J[3]-a.end.y,2)&&(J[0]=J[2],J[1]=J[3]),l=2;}if(o.chain.blockIndex!==a.chain.blockIndex){let u,c;this.blockOriginChainsIndex[o.chain.blockIndex].length>this.blockOriginChainsIndex[a.chain.blockIndex].length?(u=o.chain.blockIndex,c=a.chain.blockIndex):(u=a.chain.blockIndex,c=o.chain.blockIndex);let h=this.blockOriginChainsIndex[u];for(let d of this.blockOriginChainsIndex[c])d.blockIndex=u,h.push(d);delete this.blockOriginChainsIndex[c];}for(let u=0;u<l;u+=2){let c=new F(J[u],J[u+1]),h=new md();o.inters.push([c,h]),a.inters.push([c,h]),this.event.onIntersect(c,o,a);}}}s.add(o),i.insert(o);}}};var KE=r=>r!==0,wTe=r=>r>0,vTe=r=>r<0,ETe=r=>r%2!==0;var QE=!1,Pd=class{onRTreeBBox(e){}onResultSide(e){}onOriginSide(e){}onSplitedSide(e){}onDebugSide(e){}onSweep(e,t,n,i,s,o){}onIntersect(e,t,n){}onSegment(e,t,n,i,s,o){}onSegment1(e,t,n){if(QE){let i=new F(e.getX(n),n),s=new F(t.getX(n),n);this.onSegment(i,e.weight,e,s,t.weight,t);}else this.onSegment(e.start,e.weight,e,t.end,t.weight,t);}onSweep1(e,t,n){if(QE){let i=new F(e.getX(n),n),s=new F(t.getX(n),n);this.onSweep(i,e.weight,e,s,t.weight,t);}else this.onSweep(e.start,e.weight,e,t.end,t.weight,t);}onScan(e,t,n,i,s,o){}};var wY={"!":["1 -12 1 2","1 7 0 8 1 9 2 8 1 7"],'"':["0 -12 0 -5","8 -12 8 -5"],"#":["8 -16 1 16","14 -16 7 16","1 -3 15 -3","0 3 14 3"],$:["5 -16 5 13","9 -16 9 13","14 -9 12 -11 9 -12 5 -12 2 -11 0 -9 0 -7 1 -5 2 -4 4 -3 10 -1 12 0 13 1 14 3 14 6 12 8 9 9 5 9 2 8 0 6"],"%":["18 -12 0 9","5 -12 7 -10 7 -8 6 -6 4 -5 2 -5 0 -7 0 -9 1 -11 3 -12 5 -12 7 -11 10 -10 13 -10 16 -11 18 -12","14 2 12 3 11 5 11 7 13 9 15 9 17 8 18 6 18 4 16 2 14 2"],"&":["20 -3 20 -4 19 -5 18 -5 17 -4 16 -2 14 3 12 6 10 8 8 9 4 9 2 8 1 7 0 5 0 3 1 1 2 0 9 -4 10 -5 11 -7 11 -9 10 -11 8 -12 6 -11 5 -9 5 -7 6 -4 8 -1 13 6 15 8 17 9 19 9 20 8 20 7"],"'":["2 -15 2 -9"],"`":["2 -15 4 -9"],"(":["7 -16 5 -14 3 -11 1 -7 0 -2 0 2 1 7 3 11 5 14 7 16"],")":["0 -16 2 -14 4 -11 6 -7 7 -2 7 2 6 7 4 11 2 14 0 16"],"*":["5 -6 5 6","0 -3 10 3","10 -3 0 3"],"+":["9 -9 9 9","0 0 18 0"],",":["2 5 1 6 0 5 1 4 2 5 2 7 0 9"],"-":["0 0 18 0"],".":["1 4 0 5 1 6 2 5 1 4"],"/":["18 -16 0 16"],0:["6 -12 3 -11 1 -8 0 -3 0 0 1 5 3 8 6 9 8 9 11 8 13 5 14 0 14 -3 13 -8 11 -11 8 -12 6 -12"],1:["0 -8 2 -9 5 -12 5 9"],2:["1 -7 1 -8 2 -10 3 -11 5 -12 9 -12 11 -11 12 -10 13 -8 13 -6 12 -4 10 -1 0 9 14 9"],3:["2 -12 13 -12 7 -4 10 -4 12 -3 13 -2 14 1 14 3 13 6 11 8 8 9 5 9 2 8 1 7 0 5"],4:["10 -12 0 2 15 2","10 -12 10 9"],5:["12 -12 2 -12 1 -3 2 -4 5 -5 8 -5 11 -4 13 -2 14 1 14 3 13 6 11 8 8 9 5 9 2 8 1 7 0 5"],6:["12 -9 11 -11 8 -12 6 -12 3 -11 1 -8 0 -3 0 2 1 6 3 8 6 9 7 9 10 8 12 6 13 3 13 2 12 -1 10 -3 7 -4 6 -4 3 -3 1 -1 0 2"],7:["14 -12 4 9","0 -12 14 -12"],8:["5 -12 2 -11 1 -9 1 -7 2 -5 4 -4 8 -3 11 -2 13 0 14 2 14 5 13 7 12 8 9 9 5 9 2 8 1 7 0 5 0 2 1 0 3 -2 6 -3 10 -4 12 -5 13 -7 13 -9 12 -11 9 -12 5 -12"],9:["13 -5 12 -2 10 0 7 1 6 1 3 0 1 -2 0 -5 0 -6 1 -9 3 -11 6 -12 7 -12 10 -11 12 -9 13 -5 13 0 12 5 10 8 7 9 5 9 2 8 1 6"],":":["1 -3 0 -2 1 -1 2 -2 1 -3","1 4 0 5 1 6 2 5 1 4"],";":["1 -3 0 -2 1 -1 2 -2 1 -3","2 5 1 6 0 5 1 4 2 5 2 7 0 9"],"<":["16 -9 0 0 16 9"],"=":["0 -3 18 -3","0 3 18 3"],">":["0 -9 16 0 0 9"],"?":["0 -7 0 -8 1 -10 2 -11 4 -12 8 -12 10 -11 11 -10 12 -8 12 -6 11 -4 10 -3 6 -1 6 2","6 7 5 8 6 9 7 8 6 7"],"@":["15 -4 14 -6 12 -7 9 -7 7 -6 6 -5 5 -2 5 1 6 3 8 4 11 4 13 3 14 1","9 -7 7 -5 6 -2 6 1 7 3 8 4","15 -7 14 1 14 3 16 4 18 4 20 2 21 -1 21 -3 20 -6 19 -8 17 -10 15 -11 12 -12 9 -12 6 -11 4 -10 2 -8 1 -6 0 -3 0 0 1 3 2 5 4 7 6 8 9 9 12 9 15 8 17 7 18 6","16 -7 15 1 15 3 16 4"],A:["8 -12 0 9","8 -12 16 9","3 2 13 2"],B:["0 -12 0 9","0 -12 9 -12 12 -11 13 -10 14 -8 14 -6 13 -4 12 -3 9 -2","0 -2 9 -2 12 -1 13 0 14 2 14 5 13 7 12 8 9 9 0 9"],C:["15 -7 14 -9 12 -11 10 -12 6 -12 4 -11 2 -9 1 -7 0 -4 0 1 1 4 2 6 4 8 6 9 10 9 12 8 14 6 15 4"],D:["0 -12 0 9","0 -12 7 -12 10 -11 12 -9 13 -7 14 -4 14 1 13 4 12 6 10 8 7 9 0 9"],E:["0 -12 0 9","0 -12 13 -12","0 -2 8 -2","0 9 13 9"],F:["0 -12 0 9","0 -12 13 -12","0 -2 8 -2"],G:["15 -7 14 -9 12 -11 10 -12 6 -12 4 -11 2 -9 1 -7 0 -4 0 1 1 4 2 6 4 8 6 9 10 9 12 8 14 6 15 4 15 1","10 1 15 1"],H:["0 -12 0 9","14 -12 14 9","0 -2 14 -2"],I:["0 -12 0 9"],J:["10 -12 10 4 9 7 8 8 6 9 4 9 2 8 1 7 0 4 0 2"],K:["0 -12 0 9","14 -12 0 2","5 -3 14 9"],L:["0 -12 0 9","0 9 12 9"],M:["0 -12 0 9","0 -12 8 9","16 -12 8 9","16 -12 16 9"],N:["0 -12 0 9","0 -12 14 9","14 -12 14 9"],O:["6 -12 4 -11 2 -9 1 -7 0 -4 0 1 1 4 2 6 4 8 6 9 10 9 12 8 14 6 15 4 16 1 16 -4 15 -7 14 -9 12 -11 10 -12 6 -12"],P:["0 -12 0 9","0 -12 9 -12 12 -11 13 -10 14 -8 14 -5 13 -3 12 -2 9 -1 0 -1"],Q:["6 -12 4 -11 2 -9 1 -7 0 -4 0 1 1 4 2 6 4 8 6 9 10 9 12 8 14 6 15 4 16 1 16 -4 15 -7 14 -9 12 -11 10 -12 6 -12","9 5 15 11"],R:["0 -12 0 9","0 -12 9 -12 12 -11 13 -10 14 -8 14 -6 13 -4 12 -3 9 -2 0 -2","7 -2 14 9"],S:["14 -9 12 -11 9 -12 5 -12 2 -11 0 -9 0 -7 1 -5 2 -4 4 -3 10 -1 12 0 13 1 14 3 14 6 12 8 9 9 5 9 2 8 0 6"],T:["7 -12 7 9","0 -12 14 -12"],U:["0 -12 0 3 1 6 3 8 6 9 8 9 11 8 13 6 14 3 14 -12"],V:["0 -12 8 9","16 -12 8 9"],W:["0 -12 5 9","10 -12 5 9","10 -12 15 9","20 -12 15 9"],X:["0 -12 14 9","14 -12 0 9"],Y:["0 -12 8 -2 8 9","16 -12 8 -2"],Z:["14 -12 0 9","0 -12 14 -12","0 9 14 9"],"[":["0 -16 0 16","1 -16 1 16","0 -16 7 -16","0 16 7 16"],"\\":["0 -12 14 12"],"]":["6 -16 6 16","7 -16 7 16","0 -16 7 -16","0 16 7 16"],"^":["8 -14 0 0","8 -14 16 0"],_:["0 16 18 16"],a:["12 -5 12 9","12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"],b:["0 -12 0 9","0 -2 2 -4 4 -5 7 -5 9 -4 11 -2 12 1 12 3 11 6 9 8 7 9 4 9 2 8 0 6"],c:["12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"],d:["12 -12 12 9","12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"],e:["0 1 12 1 12 -1 11 -3 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"],f:["8 -12 6 -12 4 -11 3 -8 3 9","0 -5 7 -5"],g:["12 -5 12 11 11 14 10 15 8 16 5 16 3 15","12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"],h:["0 -12 0 9","0 -1 3 -4 5 -5 8 -5 10 -4 11 -1 11 9"],i:["0 -12 1 -11 2 -12 1 -13 0 -12","1 -5 1 9"],j:["4 -12 5 -11 6 -12 5 -13 4 -12","5 -5 5 12 4 15 2 16 0 16"],k:["0 -12 0 9","10 -5 0 5","4 1 11 9"],l:["0 -12 0 9"],m:["0 -5 0 9","0 -1 3 -4 5 -5 8 -5 10 -4 11 -1 11 9","11 -1 14 -4 16 -5 19 -5 21 -4 22 -1 22 9"],n:["0 -5 0 9","0 -1 3 -4 5 -5 8 -5 10 -4 11 -1 11 9"],o:["5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6 13 3 13 1 12 -2 10 -4 8 -5 5 -5"],p:["0 -5 0 16","0 -2 2 -4 4 -5 7 -5 9 -4 11 -2 12 1 12 3 11 6 9 8 7 9 4 9 2 8 0 6"],q:["12 -5 12 16","12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"],r:["0 -5 0 9","0 1 1 -2 3 -4 5 -5 8 -5"],s:["11 -2 10 -4 7 -5 4 -5 1 -4 0 -2 1 0 3 1 8 2 10 3 11 5 11 6 10 8 7 9 4 9 1 8 0 6"],t:["3 -12 3 5 4 8 6 9 8 9","0 -5 7 -5"],u:["0 -5 0 5 1 8 3 9 6 9 8 8 11 5","11 -5 11 9"],v:["0 -5 6 9","12 -5 6 9"],w:["0 -5 4 9","8 -5 4 9","8 -5 12 9","16 -5 12 9"],x:["0 -5 11 9","11 -5 0 9"],y:["1 -5 7 9","13 -5 7 9 5 13 3 15 1 16 0 16"],z:["11 -5 0 9","0 -5 11 -5","0 9 11 9"],"{":["5 -16 3 -15 2 -14 1 -12 1 -10 2 -8 3 -7 4 -5 4 -3 2 -1","3 -15 2 -13 2 -11 3 -9 4 -8 5 -6 5 -4 4 -2 0 0 4 2 5 4 5 6 4 8 3 9 2 11 2 13 3 15","2 1 4 3 4 5 3 7 2 8 1 10 1 12 2 14 3 15 5 16"],"|":["0 -16 0 16"],"}":["0 -16 2 -15 3 -14 4 -12 4 -10 3 -8 2 -7 1 -5 1 -3 3 -1","2 -15 3 -13 3 -11 2 -9 1 -8 0 -6 0 -4 1 -2 5 0 1 2 0 4 0 6 1 8 2 9 3 11 3 13 2 15","3 1 1 3 1 5 2 7 3 8 4 10 4 12 3 14 2 15 0 16"],"~":["0 3 0 1 1 -2 3 -3 5 -3 7 -2 11 1 13 2 15 2 17 1 18 -1","0 1 1 -1 3 -2 5 -2 7 -1 11 2 13 3 15 3 17 2 18 -1 18 -3"],"\xB0":["0 -11 -3 -8 0 -5 3 -8 0 -11"]};function vY(r,e=0){let t=wY[r],n=new Array();for(let i of t){let s=i.split(" "),o=new Array(s.length);for(let a=0;a<s.length;a+=2)o[a]=e+parseFloat(s[a]),o[a+1]=-parseFloat(s[a+1]);n.push(Me.build5(o));}return new bo(n);}function JE(r,e){let t=new Array(),n=e;for(let i of r){let s=vY(i,n);n+=s.bbox().width()+e,t.push(...s.items);}return t;}var _d=class extends Pd{constructor(t=null){super();if(this.scene=t,!t)return;let n=new We(0);t.group.add(n),n.setPosition(new pe(0,0,100)),this.redPlane=t.createPlane(qe.RED),n.add(this.redPlane),n=new We(0),t.group.add(n),n.setPosition(new pe(0,0,104)),this.greenPlane=t.createPlane(qe.GREEN),n.add(this.greenPlane),n=new We(0),t.group.add(n),n.setPosition(new pe(0,0,108)),this.bluePlane=t.createPlane(qe.BLUE),n.add(this.bluePlane);}display(){}drawLines(t,n,i=0){if(t instanceof ee&&t.rx===t.ry){n.createArc(t.center,t.rx,i,t.startAngle,t.sweepAngle);return;}let s=t.points(1),o=s[0];for(let a=1;a<s.length;a++){let l=s[a];o.equals1(l)||n.createLine(o,l,i),o=l;}}onPolylineGroup(t,n){if(!!this.scene)for(let i of t.items)i.primitives.forEach(s=>this.drawLines(s,this.bluePlane));}onRTreeBBox(t){if(!!this.scene)for(let n of Me.build4([t.LL(),t.UL(),t.UR(),t.LR(),t.LL()]).primitives);}onSegment(t,n,i,s,o,a){this.scene;}onIntersect(t,n,i){this.scene;}onResultSide(t){!this.scene||t.chain.status===0&&this.drawLines(t.shape,this.greenPlane);}onOriginSide(t){!this.scene||(this.drawLines(t.shape,this.redPlane),this.redPlane.createCircle(t.end,.1));}onScan(t,n,i,s,o,a){if(!this.scene)return;}onSplitedSide(t){this.scene;}onDebugSide(t){!this.scene||(this.drawLines(t.shape,this.bluePlane),this.bluePlane.createCircle(t.end,.1));}onSweep(t,n,i,s,o,a){if(!this.scene)return;let l=bn.format("SW (%d,%d,%d) : (%d,%d,%d) : %s : %s",i.polyGrp,i.polyIndex,n,a.polyGrp,a.polyIndex,o,t,s);}};var Sd=class extends _d{constructor(t=null){super(t);this.plGrps=new Array();}onPolylineGroup(t,n){super.onPolylineGroup(t,n),this.plGrps.push(t);}};function mg(r,e=null){let t=!1,n=[];if(r.forEach((i,s)=>{let o=eu(i);o.forEach(a=>n.push(a)),(s===0?o.length!==1:o.length>1&&!t)&&(t=!0);}),n.length===0)return new ct([]);if(t||n[0].area(.1)>0)return Uu(n,e);for(let i=1;i<n.length;i++)if(n[i].area(.1)<0)return Uu(n,e);return new ct([new Ht(n)]);}function Uu(r,e=null){let t=new Sd(e),n=new Ed(KE,new vn(1),t);r.forEach(s=>n.addPolyline(s)),n.simplify();let i=[];return t.plGrps.map(s=>{let o=[Jn(s.items[0])];if(!!o[0]){for(let a=1;a<s.items.length;a++){let l=Jn(s.items[a]);l&&o.push(l);}i.push(new Ht(o));}}),new ct(i);}var Bd=new Ur(1,10).ratio;function Id(i,s,o){return Se(this,arguments,function*(r,e,t,n=[]){let a=new ed(),l={},u=[["DOCTYPE","PREVIEW","1.0",...n]],c=[],h=[],d=[],f={},p=0,m=0,g=0,b=[],y=0,v={},E={scale:.1,scaleMatrix:ze.scale(.1)},P=0;yield sd({onStart:()=>{},onLayerConfig:(C,L,S,T)=>{let B=T.toString(),$=["LAYER",C,L,S,1,B,1,B,1];switch(l[C]={config:a.buildLayerConfig(C,L,S,T),line:$},u.push($),L){case"OUTLINE":g=C;break;case"TOP_ASSEMBLY":p=C;break;case"BOT_ASSEMBLY":m=C;break;}},onLayerPhys:(C,L,S)=>{l[C].config.material=L,l[C].config.thickness=S*E.scale,u.push(["LAYER_PHYS",C,L,S*E.scale,0,0]);},onPanelize:()=>{},onSilkOpts:()=>{},onItemOrder:()=>{},onPolys:()=>{},onPolygonCfg:(C,L)=>{L.thickness&&(y=L.thickness*E.scale);},onPrimitive:(C,L,S,T,B)=>{let $=l[C].config.typeConfig.type;$.startsWith("MULTI")?u.push(["POLY",`e${P++}`,0,"",C,T*E.scale,Do(Me.build2([S.multiply3(E.scaleMatrix)])),0]):$==="OUTLINE"?d.push(ct.buildByStroke(S,T,ji.ROUND)):$==="DETECT_OUTLINE"?h.push(ct.buildByStroke(S,T,ji.ROUND)):($==="TOP"||$==="BOTTOM"||$==="TOP_SILK"||$==="BOT_SILK")&&u.push(["POLY",`e${P++}`,0,"",C,T*E.scale,Do(Me.build2([S.multiply3(E.scaleMatrix)])),0]);},onCircle:(C,L,S,T,B)=>{let $=l[C].config.typeConfig.type;if($.startsWith("MULTI")){if(S=S.multiply3(E.scaleMatrix),T*=E.scale,b.length<1)u.push(["FILL",`e${P++}`,0,"",C,0,0,[["CIRCLE",S.x,S.y,T]]]),b.push([S,T]);else{for(let Z of b)if(Z[1]===T&&S.distance2(Z[0])<.04)return;u.push(["FILL",`e${P++}`,0,"",C,0,0,[["CIRCLE",S.x,S.y,T]]]),b.push([S,T]);}}else $==="OUTLINE"?d.push(ct.buildCircle(S,T)):$==="DETECT_OUTLINE"?h.push(ct.buildCircle(S,T)):$==="TOP_STIFFENER"||$==="BOTTOM_STIFFENER"?(S=S.multiply3(E.scaleMatrix),T*=E.scale,u.push(["FPC_FILL",`e${P++}`,0,"",C,y,0,[["CIRCLE",S.x,S.y,T]]])):($==="TOP"||$==="BOTTOM"||$==="TOP_SILK"||$==="BOT_SILK")&&(S=S.multiply3(E.scaleMatrix),T*=E.scale,u.push(["FILL",`e${P++}`,0,"",C,0,0,[["CIRCLE",S.x,S.y,T]]]));},onRect:(C,L,S,T)=>{let B=l[C].config.typeConfig.type;B.startsWith("MULTI")?(S=S.multiply3(E.scaleMatrix),u.push(["FILL",`e${P++}`,0,"",C,0,0,[["R",S.leftUpPoint.x,S.leftUpPoint.y,S.width,S.height,S.angle,S.isCCW,S.radiusRatio]]])):B==="OUTLINE"?d.push(ct.buildRect(S)):B==="DETECT_OUTLINE"?h.push(ct.buildRect(S)):(B==="TOP"||B==="BOTTOM"||B==="TOP_SILK"||B==="BOT_SILK")&&(S=S.multiply3(E.scaleMatrix),u.push(["FILL",`e${P++}`,0,"",C,0,0,[["R",S.leftUpPoint.x,S.leftUpPoint.y,S.width,S.height,S.angle,S.isCCW,S.radiusRatio]]]));},onPolygon:(C,L,S,T)=>{let B=l[C].config.typeConfig.type;if(B.startsWith("MULTI")){S=S.map(Z=>Z.multiply3(E.scaleMatrix));let $=S[0].bbox();$.area()>.01&&$.width()>.01&&$.height()>.01&&u.push(["FILL",`e${P++}`,0,"",C,0,0,S.map(Z=>Do(Z))]);}else B==="OUTLINE"?d.push(mg(S)):B==="DETECT_OUTLINE"?h.push(mg(S)):B==="TOP_STIFFENER"||B==="BOTTOM_STIFFENER"?(S=S.map($=>$.multiply3(E.scaleMatrix)),Uu(S).items.forEach($=>u.push(["FPC_FILL",`e${P++}`,0,"",C,y,0,$.items.map(Z=>Do(Z))]))):(B==="TOP"||B==="BOTTOM"||B==="TOP_SILK"||B==="BOT_SILK")&&(S=S.map($=>$.multiply3(E.scaleMatrix)),Uu(S).items.forEach($=>{u.push(["FILL",`e${P++}`,0,"",C,0,0,$.items.map(Z=>Do(Z))]);}));},onTexture:()=>{},onShellOutline:()=>{},onCrease:()=>{},onShellEntity:()=>{},onBoss:()=>{},onConnect:()=>{},onEnd:()=>{},onPrintMethod:()=>{},onModel:(C,L,S,T)=>{let{scale:B,scaleMatrix:$}=E;S.setPosition(S.getPosition().scale(B)),T.x&&(T.x*=B),T.y&&(T.y*=B),T.z&&(T.z*=B),T.dx&&(T.dx*=B),T.dy&&(T.dy*=B),T.dz&&(T.dz*=B),T.uuid?c.push(e.getModelWithSource(T.uuid).then(W=>Se(this,[W],function*({model:Z,source:H}){let Y=S.getPosition(),U=S.getRotation(),D=eP(Z.model,Z.modelStatus!==0,T,$);if(H.buffer){let k=new TextDecoder("ascii").decode(H.buffer.slice(0,10));if(/^\s*iso-/im.test(k)){let ie=T.uuid;f[ie]||(f[ie]=!0,yield t(`${ie}.step`,H.buffer));}}u.push(["COMPONENT",C,0,L?p:m,Y.x,Y.y,U.z/Math.PI*180,D,0]),v[C]=H.modelStatus!==2?H.modelStatus:Z.modelStatus===0?5:Z.modelStatus;}),console.warn)):T.Code&&T.Code!=="C00000"?c.push(e.getModelGnrByCode(T.Code).then(Z=>Se(this,null,function*(){delete T.Code,delete T.UniqueID,T.uuid=Z.uuid,T.x=Z.x,T.y=Z.y,T.z=Z.z,T.rx=Z.rx,T.ry=Z.ry,T.rz=Z.rz,typeof Z.dx=="number"&&(T.dx=Z.dx),typeof Z.dy=="number"&&(T.dy=Z.dy),typeof Z.dz=="number"&&(T.dz=Z.dz),typeof Z.scale=="number"&&(T.scale=Z.scale),e.getModelWithSource(T.uuid).then(Y=>Se(this,[Y],function*({model:H,source:W}){let U=S.getPosition(),D=S.getRotation(),k=eP(H.model,H.modelStatus!==0,T,$);if(W.buffer){let ie=new TextDecoder("ascii").decode(W.buffer.slice(0,10));if(/^\s*iso-/im.test(ie)){let se=T.uuid;f[se]||(f[se]=!0,yield t(`${se}.step`,W.buffer));}}u.push(["COMPONENT",C,0,L?p:m,U.x,U.y,D.z/Math.PI*180,k,0]),v[C]=W.modelStatus!==2?W.modelStatus:H.modelStatus===0?5:H.modelStatus;}),console.warn);}),console.warn)):v[C]=1;}},r,1,E),I();let M=new ke();return d.forEach(C=>M.ext1(C.bbox())),h.forEach(C=>M.ext1(C.bbox())),M.valid()&&(yield CE(h.length?h:d,[],M.build(),new Si(),void 0,h.length!==0)).items.forEach(L=>{Math.abs(L.items[0].area(Bd))<=Le(Bd,2)||u.push(["FILL",`e${P++}`,0,"",g,0,0,L.items.filter(S=>Math.abs(S.area(Bd))>Le(Bd,2)).map(S=>Do(S.multiply3(E.scaleMatrix)))]);}),yield Promise.all(c),yield t("pcb.json",u.map(C=>JSON.stringify(C)).join(`
`)),v;function I(){let C=Object.values(l).filter(Y=>Y.config.typeConfig.type==="SUBSTRATE").sort((Y,U)=>Y.config.buildOrder-U.config.buildOrder).map(Y=>({id:Y.config.id,thickness:Y.config.thickness})),L=Object.values(l).filter(Y=>Y.config.typeConfig.type==="SIGNAL").sort((Y,U)=>Y.config.buildOrder-U.config.buildOrder).slice(0,C.length-1);L.forEach((Y,U)=>{let D=Y.config.thickness;C[U].thickness+=D,C[U+1].thickness+=D;});let S=C[0],T=C[C.length-1],B,$;for(let Y of Object.values(l).map(U=>U.config)){let U=Y.typeConfig.type;if(U==="TOP"||U.startsWith("TOP_")){if(U==="TOP_STIFFENER")continue;U==="TOP"&&(B=Y.id),S.thickness+=Y.thickness;}else if(U==="BOTTOM"||U.startsWith("BOT_")){if(U==="BOTTOM_STIFFENER")continue;U==="BOTTOM"&&($=Y.id),T.thickness+=Y.thickness;}}let Z=0,H=[Z];for(let Y=C.length-1;Y>=0;Y--)Z+=C[Y].thickness,H.push(Z);let W=[$,...L.map(Y=>Y.config.id).reverse(),B].map(Y=>`${Y}`);Object.values(l).filter(Y=>Y.config.typeConfig.type.startsWith(`${"MULTI"}-`)).forEach(Y=>{let U=Y.config.typeConfig.type.split("-"),D=W.indexOf(U[1]),k=W.indexOf(U[2]),ie=Math.max(D,k),se=Math.min(D,k);Y.line[2]=`${"MULTI"}-${H[se]}-${H[ie]}`,Y.line[9]=H[se],Y.line[10]=H[ie]-H[se];});}});}function Do(r){let e=0;return r.primitives.reduce((t,n)=>(n instanceof q?t.push(n):n instanceof ee?Math.abs(n.sweepAngle)>=350?(t.push(ee.build3(n.center,n.startAngle,n.sweepAngle/2,n.rx,n.ry)),t.push(ee.build3(n.center,n.startAngle+n.sweepAngle/2,n.sweepAngle/2,n.rx,n.ry))):t.push(n):n.points(.1).reduce((i,s)=>(s.equals1(i)||t.push(new q(i,s)),s)),t),[]).reduce((t,n)=>{if(n instanceof q){switch(e){case 0:t.push(n.start().x,n.start().y,"L",n.end().x,n.end().y);break;case 1:t.push(n.end().x,n.end().y);break;default:t.push("L",n.end().x,n.end().y);}e=1;}else if(n instanceof ee){switch(e){case 0:t.push(n.start().x,n.start().y,"ARC",n.sweepAngle,n.end().x,n.end().y);break;case 2:t.push(n.sweepAngle,n.end().x,n.end().y);break;default:t.push("ARC",n.sweepAngle,n.end().x,n.end().y);}e=2;}return t;},[]);}function eP(r,e,t,n){var s;let i=e&&t.outline?Je.scale(1,1,t.dz).data:Ru(r,t,!e).getMatrix().data;return{"3D Model":t.uuid,Footprint:t.Footprint,Designator:t.Designator,Device:t.Device,"3D Model Transform":[i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14]].join(","),outline:(s=t.outline)==null?void 0:s.map(o=>o.map(a=>Do(a.multiply3(n))))};}var xg=ki(iP());function TY(r){return Se(this,null,function*(){let e=new xg.Occapi();return yield e.init(),e.stp2Obj(r);});}function sP(r,e){return Se(this,null,function*(){let t=yield P2(r),n="";try{let i=yield BE(t);i.status===200&&(n=yield i.text());}catch(i){console.error(i);}if(n)return Xa("None",n,e);{if(!/^\s*iso-/im.test(r.slice(0,10)))return;let i=yield TY(r);try{yield IE(t,i);}catch(s){console.error(s);}return Xa("None",i,e);}});}function oP(r,e,t,n){return Se(this,null,function*(){let i=new xg.Occapi(t);yield i.init();let s,o=yield Id(r,e,(a,l)=>Se(this,null,function*(){s=i.RECVAndGENStepModel(a,l);}),n);return[s,o];});}function mRe(r){let e=`
proc traversalWriteStep {shape_list shell} {
	set num 1
	foreach i $shape_list {
		global $i
		XNewDoc D
		XAddShape D $i
		XUpdateAssemblies D
		if {$shell == "top"} {
			WriteStep D topShell_$num.step a
		} else {
			WriteStep D botShell_$num.step a
		}
		unset D
		set num [expr $num +1]
	}
}
if {[info exist shell-top-union]} {
	set top_shape_list [explode shell-top-union]
	traversalWriteStep $top_shape_list top
}
if {[info exist shell-bot-union]} {
	set bot_shape_list [explode shell-bot-union]
	traversalWriteStep $bot_shape_list bottom
}
dall`;return`pload MODELING XDE OCAF
bfuzzyvalue 1e-3
`+r+e;}function gRe(r){let e=`
proc traversalWriteStl {shape_list shell} {
	set num 1
	while {[llength $shape_list] > 0} {
		puts $num
		set shape1 [lindex $shape_list 0]
		global $shape1
		tcopy $shape1 exportShape
		set shape_list [lreplace $shape_list 0 0]

		for {set i 0} {$i < [llength $shape_list]} {incr i} {
			set shape2 [lindex $shape_list $i]
			global $shape2
			incmesh $shape1 0.1
			incmesh $shape2 0.1
			if {[LCProximity $shape1 $shape2]} {
				compound $shape2 $exportShape $exportShape
				set shape_list [lreplace $shape_list $i $i]
			}
		}
		incmesh $exportShape 0.01
		if {$shell == "top"} {
			set filename topShell_$num.stl
		} else {
			set filename botShell_$num.stl
		}
		writestl $exportShape $filename 0
		incr num
	}
}
if {[info exist shell-top-union]} {
	set top_shape_list [explode shell-top-union]
	traversalWriteStl $top_shape_list top
}
if {[info exist shell-bot-union]} {
	set bot_shape_list [explode shell-bot-union]
	traversalWriteStl $bot_shape_list bottom
}
dall`;return`pload MODELING XDE OCAF JLC
bfuzzyvalue 1e-3
`+r+e;}function xRe(r){let e=`
if {[info exist shell-top-union]} {
	LCWriteObj shell-top-union topShell 1
}
if {[info exist shell-bot-union]} {
	LCWriteObj shell-bot-union botShell 1
}
dall`;return`pload MODELING XDE OCAF JLC
bfuzzyvalue 1e-3
`+r+e;}function bRe(r,e,t){typeof t!="undefined"&&t.byteLength>0&&r.file(e,t);}var RY=cr.funcCopy(xn),BRe=cr.funcCopy(xn),Du=100,IRe=[Math.PI/2,Math.PI*3/2],ARe=[0,Math.PI],CRe=[0,Math.PI/2,Math.PI,Math.PI*3/2],NY=(n=>(n[n.NoFlip=0]="NoFlip",n[n.FlipX=1]="FlipX",n[n.FlipY=2]="FlipY",n))(NY||{}),Ad=class{constructor(e){this._bbox=e;}bbox(){return this._bbox;}};function lP(r,e,t,n){console.time("alignModel");let i=new zn(10),s=new zn(10);for(let u=0;u<r.length;u+=4)i.add(new Ad(new ye(r[u],r[u+1],r[u+2],r[u+3])));for(let u=0;u<e.length;u+=4)s.add(new Ad(new ye(e[u],e[u+1],e[u+2],e[u+3])));let o=[],a=[];for(let u of Object.values(t))if(u.padCenters){let c=[];for(let h=0;h<u.padCenters.length;h+=2)c.push(new F(u.padCenters[h],u.padCenters[h+1]));u.padCenters=c,o.push(u);}for(let u of Object.values(n))if(u.padCenters){let c=[];for(let h=0;h<u.padCenters.length;h+=2)c.push(new F(u.padCenters[h],u.padCenters[h+1]));u.padCenters=c,a.push(u);}let l;if(i.itemList.length!==0&&o.length!==0&&(l=aP(i,o),bg(o,t,l),yg(i,o,l.matchedIndexs,l.usedPads,!0)),s.itemList.length!==0&&a.length!==0){let{matchedIndexs:u,usedPads:c}=LY(s,a,l);if(u.length>=Du||u.length===a.length)bg(a,n,l),yg(s,a,u,c,!1);else{let h=aP(s,a);bg(a,n,h),yg(s,a,h.matchedIndexs,h.usedPads,!1);}}return o.forEach(u=>{delete u.padCenters,delete u.width,delete u.height;}),a.forEach(u=>{delete u.padCenters,delete u.width,delete u.height;}),console.timeEnd("alignModel"),Object.assign(t,n);}function LY(r,e,t){let n=[],i=[];if(!t)return{matchedIndexs:n,usedPads:i};let{flip:s,offset:o}=t,a=s===0?()=>o:s===1?(l,u)=>new F(-l*2+o.x,o.y):(l,u)=>new F(o.x,-u*2+o.y);return e.forEach(({padCenters:l,x:u,y:c},h)=>{let d=a(u,c),f=!0,p=[];for(let m of l)if(p.length===p.push(...r.search(m.add(d).bbox()))){f=!1;break;}f&&(n.push(h),i.push(...p));}),{matchedIndexs:n,usedPads:i};}function bg(r,e,t){let{flip:n,offset:i}=t;n===0?(r.forEach(({padCenters:s})=>{s.forEach((o,a)=>s[a]=o.add(i));}),Object.values(e).forEach(s=>{s.x+=i.x,s.y+=i.y;})):n===1?(r.forEach(({x:s,padCenters:o})=>{o.forEach((a,l)=>o[l]=a.add1(-s*2+i.x,i.y));}),Object.values(e).forEach(s=>{s.x=-s.x+i.x,s.y+=i.y;})):(r.forEach(({y:s,padCenters:o})=>{o.forEach((a,l)=>o[l]=a.add1(i.x,-s*2+i.y));}),Object.values(e).forEach(s=>{s.x+=i.x,s.y=-s.y+i.y;}));}function yg(r,e,t,n,i){t.reverse();let s=t.pop();e.forEach((o,a)=>{if(a===s){s=t.pop();return;}if(o.tht==="THT")return;let{x:l,y:u,width:c,height:h,padCenters:d}=o;if(r.search(new ye(l-c*2,l+c*2,u-h*2,u+h*2)).filter(v=>!v.isUsed).length===0)return;let p=new F(o.x,o.y),m=-Le(2,31),g=[],b={},y=[0,Math.PI/2,Math.PI,Math.PI*3/2];for(let v of y){let E=0,P=ze.rotate(v).setOrigin(o.x,o.y),M=[],I=new ke();for(let C of d){let L=C.multiply3(P).bbox().extendOfSize(.1);I.ext1(L);let S=r.search(L);if(S.length<=0)break;E+=1,M.push(...S);}if(M.length===d.length&&M.length===E){g=M;let C=new ke();for(let B of g)C.ext1(B.bbox());let L=C.build().intersection1(I.build());if(!L)continue;let S=C.build().center().sub(p),T=L.area();T>=m&&(m=T,b.offsetX=S.x,b.offsetY=S.y,b.rot=i?v:-v,g.forEach(B=>{o.tht!=="THT"&&(B.isUsed=!0);}));}}Object.keys(b).length>0&&(o.x+=b.offsetX,o.y+=b.offsetY,o.rot+=b.rot);});}function aP(r,e){let t=e.map(u=>u.padCenters),n=[],i=[];if(t.forEach((u,c)=>{let h=!0,d=[];for(let f of u)if(d.length===d.push(...r.search(f.bbox()))){h=!1;break;}h&&(n.push(c),d.forEach(f=>f.isUsed=!0),i.push(...d));}),n.length>=Du||n.length===e.length)return{flip:0,offset:F.ORIGIN,matchedIndexs:n,usedPads:i};RY(e,(u,c)=>c.padCenters.length-u.padCenters.length,0,e.length);let s=wg(r,e.map(u=>u.padCenters));if(s.matchedIndexs.length>=Du||s.matchedIndexs.length===e.length)return Object.assign(s,{flip:0});let o=wg(r,e.map(u=>{let{x:c}=u;return u.padCenters.map(h=>h.add1(-c*2,0));}));if(o.matchedIndexs.length>=Du||o.matchedIndexs.length===e.length)return Object.assign(o,{flip:1});let a=wg(r,e.map(u=>{let{y:c}=u;return u.padCenters.map(h=>h.add1(0,-c*2));})),l=Math.max(s.matchedIndexs.length,o.matchedIndexs.length,a.matchedIndexs.length);return l===s.matchedIndexs.length?Object.assign(s,{flip:0}):l===o.matchedIndexs.length?Object.assign(o,{flip:1}):Object.assign(a,{flip:2});}function OY(r,e,t,n){let i=new Set();i.add([new Set([e]),e.bbox()]);for(let l of t){let u=[];for(let c of i){let[h,d]=c,f=n.search(new ye(d.minX+l.x,d.maxX+l.x,d.minY+l.y,d.maxY+l.y)).filter(g=>!h.has(g)&&!g.isUsed);if(f.length===0){i.delete(c);continue;}let p=f[0];h.add(p);let m=p.bbox();c[1]=new ye(Math.max(d.minX,m.minX-l.x),Math.min(d.maxX,m.maxX-l.x),Math.max(d.minY,m.minY-l.y),Math.min(d.maxY,m.maxY-l.y));for(let g=1;g<f.length;g++){let b=f[g],y=new Set(h);y.add(b);let v=b.bbox();u.push([y,new ye(Math.max(d.minX,v.minX-l.x),Math.min(d.maxX,v.maxX-l.x),Math.max(d.minY,v.minY-l.y),Math.min(d.maxY,v.maxY-l.y))]);}}if(u.forEach(c=>i.add(c)),i.size===0)break;}if(i.size===0)return null;let s=Number.NEGATIVE_INFINITY,o,a;for(let[l,u]of i)u.area()>s&&(s=u.area(),o=u,a=l);return{offset:o.center().sub(r),usedPads:Array.from(a)};}function wg(r,e){let t=new Map(),n,i,s,o=0;for(;o<e.length;o++){let a=e[o];if(a.length<=1&&t.size!==0)break;let l=!0;for(let[h,{matchedIndexs:d,usedPads:f}]of t){let p=!0,m=[];for(let g of a)if(m.length===m.push(...r.search(g.add(h).bbox()))){p=!1;break;}if(p&&(l=!1,d.push(o),f.push(...m),d.length>=Du)){n=d,i=f,s=h;break;}}if(n)break;if(!l)continue;let u=a[0],c=[];for(let h=1;h<a.length;h++)c.push(a[h].sub(u));for(let h of r.itemList){let d=OY(u,h,c,r);d&&t.set(d.offset,{matchedIndexs:[o],usedPads:d.usedPads});}}if(!n){n=[],s=F.ORIGIN;for(let[a,{matchedIndexs:l,usedPads:u}]of t)l.length>n.length&&(n=l,i=u,s=a);}for(o++;o<e.length;o++){let a=e[o],l=!0,u=[];for(let c of a)if(u.length===u.push(...r.search(c.add(s).bbox()))){l=!1;break;}l&&(n.push(o),i.push(...u));}return{offset:s,matchedIndexs:n,usedPads:i};}var _n=!0;function wO(r){let e=[];o(r);let t=e.length/3,n=new ArrayBuffer(84+t*50),i=new DataView(n);i.setUint32(80,t,_n);let s=84;for(let a=0;a<e.length;a+=3){let l=e[a],u=e[a+1],c=e[a+2],h=pe.normal(l,u,c).normalize();i.setFloat32(s,h.x,_n),i.setFloat32(s+4,h.y,_n),i.setFloat32(s+8,h.z,_n),i.setFloat32(s+12,l.x,_n),i.setFloat32(s+16,l.y,_n),i.setFloat32(s+20,l.z,_n),i.setFloat32(s+24,u.x,_n),i.setFloat32(s+28,u.y,_n),i.setFloat32(s+32,u.z,_n),i.setFloat32(s+36,c.x,_n),i.setFloat32(s+40,c.y,_n),i.setFloat32(s+44,c.z,_n),s+=50;}return new Blob([i.buffer],{type:"data/bin"});function o(a,l=Je.ORIGIN){let u=a.getMatrix().multiply4(l);for(let c of a.getContents())if(c instanceof We)o(c,u);else if(c instanceof Et){let h=c.elements;if(!(h instanceof fr))continue;h.iterVertexes(d=>e.push(d.multiply4(u)));}}}var Yn=ki(pO()),EO=ki(yO()),Tp=ki(Eg()),Pc=.01*new Ur(39.37,1).ratio,eb=(n=>(n[n.jscad=0]="jscad",n[n.drawexe=1]="drawexe",n[n.occshell=2]="occshell",n))(eb||{}),Rp=class{constructor(e){this.geoms={};this.drawCmds=[];this.debugCodes=[];this.shapes={};this.errList=[];this.cadEngine=e,Rn().OC&&(this.oc=Rn().OC);}clear(){switch(this.cadEngine){case 0:Object.keys(this.geoms).forEach(e=>delete this.geoms[e]),this.debugCodes.length=0;break;case 1:this.drawCmds.length=0;break;case 2:Object.keys(this.shapes).forEach(e=>{this.shapes[e].delete(),delete this.shapes[e];});break;}}getTriangles(e){switch(this.cadEngine){case 0:return vO(this.geoms[e]);case 2:console.log("gnr triangel:",e);let t=new Array(),n=new Array(),i=this.oc.getTriangleData(this.shapes[e],.4,.4),s=i.vertexs(),o=i.normals(),a=i.indices();for(let l of a){let u=3*l;t.push(new pe(s[u],s[u+1],s[u+2])),n.push(new pe(o[u],o[u+1],o[u+2]));}return new fr(t,n);}}getStepByid(e){return this.getStepByShape(this.shapes[e]);}getStepByShape(e){return new this.oc.importStep(e);}testDownloadStep(e){let t=new this.oc.importStep(e);console.log(new TextDecoder().decode(t));}downloadStep(e=""){return Se(this,null,function*(){let t=new Tp.default(),n=this.shapes["shell-top-union"],i=[];if(n){let a=new this.oc.TopoDS_Iterator_2(n,!0,!0);for(;a.More();)i.push(a.Value()),a.Next();if(i.length<=1){let l=this.getStepByShape(n);t.file(`3DShell_${e}_T.step`,new TextDecoder().decode(l));}else for(let l=0;l<i.length;l++){let u=this.getStepByShape(i[l]);t.file(`3DShell_${e}_T_${l+1}.step`,new TextDecoder().decode(u));}}let s=this.shapes["shell-bot-union"],o=[];if(s){let a=new this.oc.TopoDS_Iterator_2(s,!0,!0);for(;a.More();)o.push(a.Value()),a.Next();if(o.length<=1){let l=this.getStepByShape(s);t.file(`3DShell_${e}_B.step`,new TextDecoder().decode(l));}else for(let l=0;l<o.length;l++){let u=this.getStepByShape(o[l]);t.file(`3DShell_${e}_B_${l+1}.step`,new TextDecoder().decode(u));}}return yield t.generateAsync({type:"blob"});});}getStlByShape(e,t){let n=new TextDecoder();return new this.oc.importStl(e,t);}getObjByShape(e,t){let n=new TextDecoder();return new this.oc.importObj(e,t);}downloadStl(e=""){return Se(this,null,function*(){let t=new Tp.default(),n=[],i=this.shapes["shell-top-union"];if(i){let a=new this.oc.TopoDS_Iterator_2(i,!0,!0);for(;a.More();)n.push(a.Value()),a.Next();if(n.length<=1){let l=this.getStlByShape(i,.01);t.file(`3DShell_${e}_T.stl`,new TextDecoder().decode(l));}else{let l=1;for(let u=0;u<n.length;u++){let c=n.slice(u+1,n.length),h=new this.oc.BRep_Builder(),d=new this.oc.TopoDS_Compound();h.MakeCompound(d),h.Add(d,n[u]);for(let p=0;p<c.length;p++)this.oc.shapeProximity(n[u],c[p])&&(h.Add(h,c[p]),n.splice(u+p,1),u--);let f=this.getStlByShape(d,.01);f.byteLength>0&&(t.file(`3DShell_${e}_T_${l}.stl`,new TextDecoder().decode(f)),l++);}}}let s=[],o=this.shapes["shell-bot-union"];if(o){let a=new this.oc.TopoDS_Iterator_2(o,!0,!0);for(;a.More();)s.push(a.Value()),a.Next();if(s.length<=1){let l=this.getStlByShape(o,.01);t.file(`3DShell_${e}_B.stl`,new TextDecoder().decode(l));}else{let l=1;for(let u=0;u<s.length;u++){let c=s.slice(u+1,s.length),h=new this.oc.BRep_Builder(),d=new this.oc.TopoDS_Compound();h.MakeCompound(d),h.Add(d,s[u]);for(let p=0;p<c.length;p++)this.oc.shapeProximity(s[u],c[p])&&(h.Add(h,c[p]),s.splice(u+p,1),u--);let f=this.getStlByShape(d,.01);f.byteLength>0&&(t.file(`3DShell_${e}_B_${l}.stl`,new TextDecoder().decode(f)),l++);}}}return yield t.generateAsync({type:"blob"});});}downloadObj(e=""){return Se(this,null,function*(){let t=new Tp.default(),n=[],i=this.shapes["shell-top-union"];if(i){let a=new this.oc.TopoDS_Iterator_2(i,!0,!0);for(;a.More();)n.push(a.Value()),a.Next();if(n.length<=1){let l=this.getObjByShape(i,.01);t.file(`3DShell_${e}_T.obj`,new TextDecoder().decode(l));}else{let l=1;for(let u=0;u<n.length;u++){let c=n.slice(u+1,n.length),h=new this.oc.BRep_Builder(),d=new this.oc.TopoDS_Compound();h.MakeCompound(d),h.Add(d,n[u]);for(let p=0;p<c.length;p++)this.oc.shapeProximity(n[u],c[p])&&(h.Add(h,c[p]),n.splice(u+p,1),u--);let f=this.getObjByShape(d,.01);f.byteLength>0&&(t.file(`3DShell_${e}_T_${l}.obj`,new TextDecoder().decode(f)),l++);}}}let s=[],o=this.shapes["shell-bot-union"];if(o){let a=new this.oc.TopoDS_Iterator_2(o,!0,!0);for(;a.More();)s.push(a.Value()),a.Next();if(s.length<=1){let l=this.getObjByShape(o,.01);t.file(`3DShell_${e}_B.obj`,new TextDecoder().decode(l));}else{let l=1;for(let u=0;u<s.length;u++){let c=s.slice(u+1,s.length),h=new this.oc.BRep_Builder(),d=new this.oc.TopoDS_Compound();h.MakeCompound(d),h.Add(d,s[u]);for(let p=0;p<c.length;p++)this.oc.shapeProximity(s[u],c[p])&&(h.Add(h,c[p]),s.splice(u+p,1),u--);let f=this.getObjByShape(d,.01);f.byteLength>0&&(t.file(`3DShell_${e}_B_${l}.obj`,new TextDecoder().decode(f)),l++);}}}return yield t.generateAsync({type:"blob"});});}shapeRepair(e,t,n,i){let s=new this.oc.ShapeFix_Shape_1();s.Init(e),s.SetPrecision(t),s.SetMinTolerance(n),s.SetMaxTolerance(i),s.Perform(new this.oc.Message_ProgressRange_1());let o=s.Shape();return s.delete(),o;}cylinder(e,t,n){switch(this.cadEngine){case 0:this.geoms[e]=Yn.primitives.cylinder({height:n,radius:t,center:[0,0,n/2],segments:t*(1-Math.SQRT1_2)>Pc?Math.ceil(Math.abs(Math.PI/Math.acos((t-Pc)/t))):4}),this.debugCodes.push(`let ${e} = primitives.cylinder({
					height,
					radius,
					center: [0, 0, height / 2],
					segments: radius > RESOLUTION ? Math.ceil(Math.abs(Math.PI / Math.acos((radius - RESOLUTION) / radius))) : 3,
				});`);break;case 1:this.drawCmds.push(["pcylinder",e,t,n]);break;case 2:console.log(`Cylinder radius(${t} height(${n}))`,e),this.shapes[e]=new this.oc.BRepPrimAPI_MakeCylinder_1(t,n).Shape();break;}}makeEdge(e,t){let n=new this.oc.gp_Pnt_3(e.x,e.y,0),i=new this.oc.gp_Pnt_3(t.x,t.y,0),s=new this.oc.BRepBuilderAPI_MakeEdge_3(n,i),o=s.Edge();return n.delete(),i.delete(),s.delete(),o;}makeArc(e,t,n,i,s){let o=new this.oc.gp_Pnt_3(e.x,e.y,0),a=new this.oc.gp_Pnt_3(t.x,t.y,0),l=new this.oc.gp_Pnt_3(n.x,n.y,0),u=new this.oc.gp_Dir_4(0,0,-1),c=new this.oc.gp_Ax2_3(l,u),h=new this.oc.gp_Circ_2(c,i),d;if(s>0){let f=e;e=t,t=f;}try{let f=new this.oc.GC_MakeArcOfCircle_3(h,o,a,s>0);if(!f.IsDone())return f.delete(),!1;let p=new this.oc.Handle_Geom_Curve_2(f.Value().get());d=new this.oc.BRepBuilderAPI_MakeEdge_24(p).Edge(),p.delete();}catch(f){return console.error(f),!1;}finally{o.delete(),a.delete(),l.delete(),u.delete(),c.delete(),h.delete();}return d;}shapeIsValid(e){let t=new this.oc.BRepCheck_Analyzer(e,!0,!1),n=t.IsValid_2();return t.delete(),n;}polygonCylinder(e,t,n){switch(t=t.asClose(),this.cadEngine){case 0:t.area(1)<0&&(t=t.reverse());let i=[],s=null;t.points1(Pc,d=>{s&&s.equals1(d)||(i.push(d.x,d.y),s=d);}),this.geoms[e]=use(i,n),this.debugCodes.push(`let ${e} = csgExtrude(${JSON.stringify(i)}, ${n});`);break;case 1:let o=["profile",e],a=t.primitives[0].start();o.push("F",a.x,a.y);for(let d of t.primitives){let f=d.start();if(a.equals1(f)||(o.push("tt",f.x,f.y),a=f),d instanceof ee&&d.rx===d.ry)o.push("rr",d.startAngle+90),o.push("c",d.rx,d.sweepAngle);else{let p=d.points(Pc);for(let m=1;m<p.length;m++){let g=p[m];o.push("tt",g.x,g.y);}}a=d.end();}this.drawCmds.push(o,["fixsmalledges",e,e,.01,1],["prism",e,e,0,0,n]);break;case 2:console.log("polygonCylinder:",e,t,n);let l=new this.oc.BRepBuilderAPI_MakeWire_1(),u=t.primitives[0].start();for(let d=0;d<t.primitives.length;d++){let f=t.primitives[d],p=f.end();if(u.distance2(p)<.01&&!(f instanceof ee)){if(d===t.primitives.length-1&&!t.primitives[0].start().equals1(u)){let b=this.makeEdge(u,t.primitives[0].start());l.Add_1(b);}continue;}let m=f instanceof ee?f.points2():f.points(Pc),g=u;for(let b=1;b<m.length;b++){let y=this.makeEdge(g,m[b]);l.Add_1(y),g=m[b];}if(u=p,d===t.primitives.length-1&&!t.primitives[0].start().equals1(p)){let b=this.makeEdge(p,t.primitives[0].start());l.Add_1(b);}}let c;try{let d=l.Wire();c=new this.oc.BRepBuilderAPI_MakeFace_15(d,!1);}catch(d){console.warn("polygonCylinder wire error ",d);let f=this.shapeRepair(l.Wire(),1e-7,.01,.01),p=this.oc.TopoDS.Wire_1(f);c=new this.oc.BRepBuilderAPI_MakeFace_15(p,!1);}let h=new this.oc.BRepPrimAPI_MakePrism_1(c.Shape(),new this.oc.gp_Vec_4(0,0,n),!1,!0).Shape();if(!this.shapeIsValid(h)){let d=this.shapeRepair(l.Wire(),.01,.01,.01),f=this.oc.TopoDS.Wire_1(d);c=new this.oc.BRepBuilderAPI_MakeFace_15(f,!1);let p=new this.oc.BRepPrimAPI_MakePrism_1(c.Shape(),new this.oc.gp_Vec_4(0,0,n),!1,!0).Shape();if(!this.shapeIsValid(p))throw`${e} shape error`;}this.shapes[e]=h;break;}}translate(e,t,n,i){switch(this.cadEngine){case 0:this.geoms[e]=Yn.transforms.translate([t,n,i],this.geoms[e]),this.debugCodes.push(`${e} = transforms.translate(${JSON.stringify([t,n,i])}, ${e});`);break;case 1:this.drawCmds.push(["ttranslate",e,t,n,i]);break;case 2:console.log("translate:",e);let s=new this.oc.gp_Trsf_1();s.SetTranslation_1(new this.oc.gp_Vec_4(t,n,i));let o=new this.oc.BRepBuilderAPI_Transform_2(this.shapes[e],s,!1);this.shapes[e]=o.Shape();break;}}rotate(e,t,n,i,s,o,a,l){switch(this.cadEngine){case 0:this.geoms[e]=Yn.transforms.transform(Je.rotateAxis(new pe(s,o,a),at.toRadians(l)).setOrigin(t,n,i).data,this.geoms[e]),this.debugCodes.push(`${e} = transforms.transform(
					<any>Matrix4.rotateAxis(new Vector3(${s}, ${o}, ${a}), Angle.toRadians(${l})).setOrigin(${t}, ${n}, ${i}).data,
					${e},
				);`);break;case 1:this.drawCmds.push(["trotate",e,t,n,i,s,o,a,l]);break;case 2:console.log("rotate:",e);let u=new this.oc.gp_Ax1_2(new this.oc.gp_Pnt_3(t,n,i),new this.oc.gp_Dir_2(new this.oc.gp_Vec_4(s,o,a))),c=new this.oc.gp_Trsf_1();c.SetRotation_1(u,l*Math.PI/180);let h=new this.oc.BRepBuilderAPI_Transform_2(this.shapes[e],c,!1);this.shapes[e]=h.Shape();break;}}scale(e,t,n,i){switch(this.cadEngine){case 0:this.geoms[e]=Yn.transforms.scale([t,n,i],this.geoms[e]),this.debugCodes.push(`${e} = transforms.scale(${JSON.stringify([t,n,i])}, ${e});`);break;case 1:this.drawCmds.push(["scalexyz",e,e,t,n,i]);break;case 2:console.log("scale:",e);let s=new this.oc.gp_Mat_2(t,0,0,0,n,0,0,0,i),o=new this.oc.gp_GTrsf_1();o.SetVectorialPart(s);let a=new this.oc.BRepBuilderAPI_GTransform_2(this.shapes[e],o,!1);this.shapes[e]=a.Shape();break;}}occBuilder(e,t){let n=new this.oc.TopTools_ListOfShape_1();for(let a=0;a<t.length;a++)n.Append_1(this.shapes[t[a]]);let i=new this.oc.BOPAlgo_Builder_1();i.SetArguments(n),i.SetFuzzyValue(.001),i.SetCheckInverted(!1);let s=+new Date();i.Perform(new this.oc.Message_ProgressRange_1());let o=+new Date();this.shapes[e]=i.Shape(),console.log("Builder\u7528\u65F6: ",o-s);}occFuse(e,t){let n=new this.oc.TopTools_ListOfShape_1();for(let o=1;o<t.length;o++)n.Append_1(this.shapes[t[o]]);let i=new this.oc.TopTools_ListOfShape_1();i.Append_1(this.shapes[t[0]]);let s=new this.oc.BRepAlgoAPI_Fuse_1();s.SetArguments(i),s.SetTools(n),s.SetFuzzyValue(1e-5),s.SetCheckInverted(!1),s.Build(new this.oc.Message_ProgressRange_1()),this.shapes[e]=s.Shape();}union(e,t){if(t.length===0)throw new Error("ids.length === 0");if(t.length===1){this.copy(t[0],e);return;}switch(this.cadEngine){case 0:this.geoms[e]=Yn.booleans.union(t.map(i=>this.geoms[i])),this.debugCodes.push(`${e} = booleans.union(${JSON.stringify(t)});`);break;case 1:this.drawCmds.push(["bclearobjects"],["bcleartools"],["baddobjects",t[0]]);let n=["baddtools"];for(let i=1;i<t.length;i++)n.push(t[i]);this.drawCmds.push(n,["bfillds"],["bbop",e,1]);break;case 2:if(console.log("union:",e,t),t.length>2&&(t[0]==="shell-top-union"||t[0]==="shell-bot-union"||t[0]==="botUnionShellBoss"||t[0]==="topUnionShellBoss"||t[0].includes("Top")||t[0].includes("Bot"))){let i=t.shift();this.occFuse("temp",t),this.occFuse(e,[i,"temp"]);}else this.occFuse(e,t);break;}}union2(e,t){if(t.length===0)throw new Error("ids.length === 0");if(t.length===1){this.copy(t[0],e);return;}if(this.useDrawexe){this.drawCmds.push(["bclearobjects"],["bcleartools"],["baddobjects",t[0]]);let n=["baddtools"];for(let i=1;i<t.length;i++)n.push(t[i]);this.drawCmds.push(n,["bfillds"],["bbuild",e]);}else this.geoms[e]=Yn.booleans.union(t.map(n=>this.geoms[n])),this.debugCodes.push(`${e} = booleans.union(${JSON.stringify(t)});`);}occCut(e,t,n,i,s){if(i){for(let o=1;o<t.length;o++){let a=new this.oc.TopTools_ListOfShape_1();a.Append_1(this.shapes[t[o]]);let l=new this.oc.TopTools_ListOfShape_1();l.Append_1(this.shapes[t[0]]);let u=new this.oc.BRepAlgoAPI_Cut_1();if(u.SetArguments(l),u.SetTools(a),u.SetFuzzyValue(n),u.SetCheckInverted(s),u.SetToFillHistory(!1),u.Build(new this.oc.Message_ProgressRange_1()),a.delete(),l.delete(),u.HasErrors()||u.HasWarnings())throw u.delete(),console.warn("occCutSingle fail:",n,t[0],t[o]),this.errList.push({id:t[o],type:1,message:"\u5E03\u5C14\u5207\u9664\u8BA1\u7B97\u9519\u8BEF"}),new Error("occCutSingle fail");this.shapes[t[0]]&&this.shapes[t[0]].delete(),this.shapes[t[0]]=u.Shape(),u.delete();}return this.shapes[e]=this.shapes[t[0]],!0;}else{let o=new this.oc.TopTools_ListOfShape_1();for(let u=1;u<t.length;u++)o.Append_1(this.shapes[t[u]]);let a=new this.oc.TopTools_ListOfShape_1();a.Append_1(this.shapes[t[0]]);let l=new this.oc.BRepAlgoAPI_Cut_1();return l.SetArguments(a),l.SetTools(o),l.SetFuzzyValue(n),l.SetCheckInverted(s),l.SetToFillHistory(!1),l.Build(new this.oc.Message_ProgressRange_1()),a.delete(),o.delete(),l.HasErrors()||l.HasWarnings()?(console.warn("occCutGroup fail:",n,t),l.delete(),!1):(this.shapes[e]=l.Shape(),l.delete(),!0);}}occCutRetry(e,t){if(!this.occCut(e,t,.01,!1,!1)&&!this.occCut(e,t,.01,!1,!0)&&!this.occCut(e,t,.001,!1,!0)&&!this.occCut(e,t,1e-5,!1,!0)&&!this.occCut(e,t,1e-6,!1,!0)&&!this.occCut(e,t,1e-6,!0,!0))return console.error("occCut failure of all",e,t),!1;if(!this.shapeIsValid(this.shapes[e]))throw`${e} shape is error`;return!0;}subtract(e,t){switch(this.cadEngine){case 0:this.geoms[e]=Yn.booleans.subtract(t.map(n=>this.geoms[n])),this.debugCodes.push(`${e} = booleans.subtract(${JSON.stringify(t)});`);break;case 1:if(t.length<3)this.drawCmds.push(["bcut",e,t[0],t[1]]);else{for(let n=1;n<t.length;n+=5){this.drawCmds.push(["bclearobjects"],["bcleartools"],["baddobjects",t[0]]);let i=["baddtools"];i.push(t[n],t[n+1],t[n+2],t[n+3],t[n+4]),this.drawCmds.push(i,["bfillds"],["bbop",t[0],2]);}this.drawCmds.push(["tcopy",t[0],e]);}break;case 2:if(console.log("subtract",e,t),t.length<10){if(!this.occCutRetry(e,t)){let n=[];for(let i=1;i<t.length;i++)n.push(t[i]),(i%5===0||i===t.length-1)&&(n.unshift(t[0]),this.occCutRetry(e,n),n=[]);}}else{let n=[];for(let i=1;i<t.length;i++)n.push(t[i]),(i%5===0||i===t.length-1)&&(n.unshift(t[0]),this.occCutRetry(e,n),console.log("cut step complete"),n=[]);}break;}}intersect(e,t,n){switch(this.cadEngine){case 0:this.geoms[e]=Yn.booleans.intersect(this.geoms[t],this.geoms[n]),this.debugCodes.push(`${e} = booleans.intersect(${t},${n});`);break;case 1:this.drawCmds.push(["bcommon",e,t,n]);break;case 2:console.log("intersect:",e,t,n);let i=new this.oc.BRepAlgoAPI_Common_3(this.shapes[t],this.shapes[n],new this.oc.Message_ProgressRange_1());this.shapes[e]=i.Shape();break;}}copy(e,t,...n){n.unshift(e,t);for(let i=1;i<n.length;i+=2){let s=n[i];switch(this.cadEngine){case 0:this.geoms[s]=this.geoms[n[i-1]],this.debugCodes.push(`let ${s} = ${n[i-1]};`);break;case 1:this.drawCmds.push(["tcopy",n[i-1],s]);break;case 2:console.log("copy:",s,t,n);let o=new this.oc.BRepBuilderAPI_Copy_1();o.Perform(this.shapes[n[i-1]],!0,!1),this.shapes[s]=o.Shape();break;}}}};function use(r,e){var t=EO.default(r);let n=[],i=[];for(let o=1;o<r.length;o+=2){let a=r[o-1],l=r[o];n.push([a,l,0],[a,l,e]);}for(let o=0;o<t.length;o+=3)i.push([t[o]*2,t[o+2]*2,t[o+1]*2]);for(let o=0;o<t.length;o+=3)i.push([t[o]*2+1,t[o+1]*2+1,t[o+2]*2+1]);let s=r.length-2;for(let o=0;o<s;o+=2)i.push([o,o+3,o+1],[o+3,o,o+2]);return Yn.primitives.polyhedron({points:n,faces:i});}function vO(r){let e=r.polygons,t=new Array(),n=new Array(),i=new Je(r.transforms),s=i.toMatrix3().toMatrix4();for(let o=0;o<e.length;o++){let a=new Array();for(let c=0;c<e[o].vertices.length;c++)a.push(new pe(...e[o].vertices[c]).multiply4(i));a[0].equals(a[a.length-1])&&a.pop();let l=e[o].plane,u=l&&l.reduce((c,h)=>c+h,0)!==0&&new pe(l[0],l[1],l[2]).multiply4(s).normalize();if(!u){for(let c=2;c<a.length;c++)try{u=pe.normal(a[0],a[c-1],a[c]).normalize();}catch(h){}if(!u)continue;}for(let c=2;c<a.length;c++)t.push(a[0],a[c-1],a[c]),n.push(u,u,u);}return new fr(t,n);}function IGe(r,e){let t=new We();t.add(new Et(vO(r),qe.BLACK)),cr.downloadFile(e,wO(t));}function AGe(r){let e="";for(let t of r.primitives)t instanceof ee?e+=`Arc start: ${t.start().x} ${t.start().y} end: ${t.end().x} ${t.end().y} r: ${t.rx} sweepAngle: ${t.sweepAngle} centerX: ${t.center.x}
`:e+=`Line start: ${t.start().x} ${t.start().y} end: ${t.end().x} ${t.end().y}
`;console.log(e);}function tb(r){let e=new Hr(),t=new Hr(),n=new Hr(),i=[],s=[],o=0,a=0,l=0,u=null;return c(r),[i.join(`
`),s.join(`
`)];function c(p,m=Je.ORIGIN){let g=p.getMatrix().multiply4(m),b=g.data.slice();b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1;let y=new Je(b);for(let v of p.getContents())if(v instanceof We)c(v,g);else if(v instanceof Et){let E=v.elements;if(!(E instanceof fr))return;if(v.getMaterial()){let M=f(v.getMaterial());M!==u&&(s.push(`usemtl ${M}`),u=M);}let P=[];if(E.hasNormals()){let M=[];E.iterVertexesNormals(I=>P.push(I.multiply4(g)),I=>{if(M.push(I.multiply4(y)),P.length===3){if(!P[0].equals(P[1])&&!P[0].equals(P[2])&&!P[1].equals(P[2])){let C=h(P[0]),L=h(P[1]),S=h(P[2]),T=d(M[0]),B=d(M[1]),$=d(M[2]);s.push(`f ${C}//${T} ${L}//${B} ${S}//${$}`);}P.length=0,M.length=0;}});}else E.iterVertexes(M=>{if(P.push(M.multiply4(g)),P.length===3){if(!P[0].equals(P[1])&&!P[0].equals(P[2])&&!P[1].equals(P[2])){let I=h(P[0]),C=h(P[1]),L=h(P[2]);s.push(`f ${I}// ${C}// ${L}//`);}P.length=0;}});}}function h(p){return e.computeIfAbsent(p,()=>(s.push(`v ${p.x} ${p.y} ${p.z}`),++o));}function d(p){return p?t.computeIfAbsent(p,()=>(s.push(`vn ${p.x} ${p.y} ${p.z}`),++a)):"";}function f(p){return n.computeIfAbsent(p,()=>{let{ambient:m,diffuse:g,specular:b}=p,y=`mtl${++l}`;return i.push(`newmtl ${y}`),i.push(`Ka ${m.r.toFixed(2)} ${m.g.toFixed(2)} ${m.b.toFixed(2)}`),i.push(`Kd ${g.r.toFixed(2)} ${g.g.toFixed(2)} ${g.b.toFixed(2)}`),i.push(`Ks ${b.r.toFixed(2)} ${b.g.toFixed(2)} ${b.b.toFixed(2)}`),i.push("endmtl"),y;});}}var Np=class{constructor(e=4096){this.byteOffset=0;this.view=new DataView(new ArrayBuffer(e));}getByteOffset(){return this.byteOffset;}getFloat32(e,t){return this.view.getFloat32(e,t);}getFloat64(e,t){return this.view.getFloat64(e,t);}getInt8(e){return this.view.getInt8(e);}getInt16(e,t){return this.view.getInt16(e,t);}getInt32(e,t){return this.view.getInt32(e,t);}getUint8(e){return this.view.getUint8(e);}getUint16(e,t){return this.view.getUint16(e,t);}getUint32(e,t){return this.view.getUint32(e,t);}setFloat32(e,t,n){this.view.setFloat32(e,t,n);}setFloat64(e,t,n){this.view.setFloat64(e,t,n);}setInt8(e,t){this.view.setInt8(e,t);}setInt16(e,t,n){this.view.setInt16(e,t,n);}setInt32(e,t,n){this.view.setInt32(e,t,n);}setUint8(e,t){this.view.setUint8(e,t);}setUint16(e,t,n){this.view.setUint16(e,t,n);}setUint32(e,t,n){this.view.setUint32(e,t,n);}ext(e){let t=this.byteOffset;if(this.byteOffset+=e,this.byteOffset<=this.view.buffer.byteLength)return t;let n=new Uint8Array(this.view.buffer.byteLength*2);return n.set(new Uint8Array(this.view.buffer)),this.view=new DataView(n.buffer),t;}pushFloat32(e,t){let n=this.ext(4);this.view.setFloat32(n,e,t);}pushFloat64(e,t){let n=this.ext(8);this.view.setFloat64(n,e,t);}pushInt8(e){let t=this.ext(1);this.view.setInt8(t,e);}pushInt16(e,t){let n=this.ext(2);this.view.setInt16(n,e,t);}pushInt32(e,t){let n=this.ext(4);this.view.setInt32(n,e,t);}pushUint8(e){let t=this.ext(1);this.view.setUint8(t,e);}pushUint16(e,t){let n=this.ext(2);this.view.setUint16(n,e,t);}pushUint32(e,t){let n=this.ext(4);this.view.setUint32(n,e,t);}build(){return this.view.buffer.slice(0,this.byteOffset);}};var Ti=!0,PO=(o=>(o[o.LINE=0]="LINE",o[o.ARC=1]="ARC",o[o.CIRCLE_CW=2]="CIRCLE_CW",o[o.CIRCLE_CCW=3]="CIRCLE_CCW",o[o.RECT_CW=4]="RECT_CW",o[o.RECT_CCW=5]="RECT_CCW",o))(PO||{});function rb(r){let e=new Np();return r.forEach(a=>o(a)),e.build();function t(a){e.pushUint8(a);}function n(a){e.pushUint32(a,Ti);}function i(a){e.pushFloat64(a,Ti);}function s(a){e.pushFloat64(a.x,Ti),e.pushFloat64(a.y,Ti);}function o(a){let l=a.asClose().primitives,u=e.getByteOffset(),c=l.length;if(n(c),l.length===1){let h=l[0];if(h instanceof ee){if(h.rx!==h.ry||!Ie.eq(Math.abs(h.sweepAngle),360))throw new Error("pt.rx !== pt.ry || !DoubleKit.eq(Math.abs(pt.sweepAngle), 360)");s(h.center),t(h.isCCW?3:2),i(h.rx);}else if(h instanceof ti)s(h.leftUpPoint),t(h.isCCW?5:4),i(h.width),i(h.height),i(h.angle),i(h.radius);else throw new Error("not support!");return;}s(l[0].start()),l.forEach(h=>{if(h instanceof q)t(0),s(h.end());else if(h instanceof ee&&h.rx===h.ry){if(Ie.eq(Math.abs(h.sweepAngle),360)){let d=at.toRadians(h.sweepAngle/2);t(1),i(d),s(h.pointOn(h.startAngle+h.sweepAngle/2)),t(1),i(d),s(h.end()),c++;}else t(1),i(at.toRadians(h.sweepAngle)),s(h.end());}else throw new Error("not support!");}),e.setUint32(u,c,Ti);}}function nb(r){let e=[],t=new DataView(r),n=0;for(;n<r.byteLength;)e.push(l());return e;function i(){return t.getUint8(n++);}function s(){let u=t.getUint32(n,Ti);return n+=4,u;}function o(){let u=new F(t.getFloat64(n,Ti),t.getFloat64(n+8,Ti));return n+=16,u;}function a(){let u=t.getFloat64(n,Ti);return n+=8,u;}function l(){let u=s(),c=o();if(u===1){let d=i();if(d===3||d===2)return Me.build7([ee.buildCircle(c,a(),d===3?vt.CCW:vt.CW)]);if(d===5||d===4)return Me.build7([new ti(c,a(),a(),a(),d===5?vt.CCW:vt.CW,a())]);n--;}let h=[];for(let d=0;d<u;d++){let f;switch(i()){case 0:f=o(),h.push(new q(c,f));break;case 1:let p=a();f=o(),h.push(ee.build5(c,f,at.toDegrees(p)));break;default:throw new Error(`not support container type at ${n-1}: ${t.getUint8(n-1)}`);}c=f;}return Me.build2(h).asClose();}}var Lp=ki(fu()),ib=class{constructor(e,t,n,i,s,o){this.cutWidth=Number.POSITIVE_INFINITY;this.startPoint=e,this.vec=t.normalize(),this.botWidth=n,this.topWidth=i,this.height=s,this.thickness=o;let a=new F(this.vec.y,-this.vec.x).scale(this.thickness/2),l=this.startPoint.add(this.vec.scale(Math.max(this.topWidth,this.botWidth)));this.line1=new q(this.startPoint.add(a),l.add(a)),this.line2=new q(this.startPoint.sub(a),l.sub(a)),this._bbox=ye.extend2(this.line1.bbox(),this.line2.bbox());}getHeightRange(e){if(this.botWidth<e||this.topWidth<e){if(el(new q(new F(this.botWidth,0),new F(this.topWidth,this.height)),new q(new F(e,0),new F(e,this.height)))===0)throw new Error("cnt === 0");return this.botWidth<e?[J[1],this.height]:[0,J[1]];}return[0,this.height];}beCutByLine(e,t,n){if(el(e,n)===0)return 0;let s=new F(J[0],J[1]),o=s.distance1(e.start());if(o>=this.cutWidth)return 0;let a=this.getHeightRange(o),l=t.getHeightRange(s.distance1(n.start()));return a[0]>=l[0]&&a[1]<=l[1]?o:0;}beCut(e){if(Ie.eq(this.vec.cross(e.vec),0))return!1;let t=this.beCutByLine(this.line1,e,e.line1);if(!t)return!1;let n=this.beCutByLine(this.line1,e,e.line2);if(!n)return!1;let i=this.beCutByLine(this.line2,e,e.line1);if(!i)return!1;let s=this.beCutByLine(this.line2,e,e.line2);return s?(this.cutWidth=Math.max(t,n,i,s),!0):!1;}bbox(){return this._bbox;}getCutWidth(){return this.cutWidth;}},sb=new yn(qe.of1(13750737),qe.of1(13750737),qe.of1(13750737),.5,1),cse=new yn(qe.of1(13697024),qe.of1(13697024),qe.of1(13697024),.5,1),hse=(n=>(n[n.Shell=4]="Shell",n[n.Boss=8]="Boss",n[n.Entity=16]="Entity",n))(hse||{}),Al=class{constructor(e){this.topGroup=new We(1);this.botGroup=new We(1);this.shellIndex={};this.creaseIndex={};this.needUpdateCreases=new Set();this.connectIndex={};this.shellInfoIndex={};this.needUpdateShells=new Set();this.bossInfoIndex={};this.needUpdateBosss=new Set();this.entityInfoIndex={};this.needUpdateEntities=new Set();this.shellHeight=0;this.botHeight=0;this.shellThickness=0;this.outShellIds=[];this.topOutShellIds=[];this.botOutShellIds=[];this.timeout=5*60*1e3;this.drawjs=new Rp(e),this.ONE_MIL=1;let t=new Ur(39.37,1).ratio;this.RAIL_WIDTH=1.6*t,this.RAIL_THICKNESS=1.5*t,this.COVER_THICKNESS=2*t,this.INNER_THICKNESS=1.5*t,this.GAP=.1*t,this.DEVIATION=this.ONE_MIL;}clear(){this.topGroup.clear(),this.botGroup.clear(),Object.keys(this.shellIndex).forEach(e=>delete this.shellIndex[e]),Object.keys(this.creaseIndex).forEach(e=>delete this.creaseIndex[e]),this.needUpdateCreases.clear(),Object.keys(this.connectIndex).forEach(e=>delete this.connectIndex[e]),Object.keys(this.shellInfoIndex).forEach(e=>delete this.shellInfoIndex[e]),this.needUpdateShells.clear(),Object.keys(this.bossInfoIndex).forEach(e=>delete this.bossInfoIndex[e]),this.needUpdateBosss.clear(),Object.keys(this.entityInfoIndex).forEach(e=>delete this.entityInfoIndex[e]),this.needUpdateEntities.clear(),this.shellHeight=0,this.botHeight=0,this.shellThickness=0,delete this.shellType,this.drawjs.clear(),this.outShellIds.length=0,this.topOutShellIds.length=0,this.botOutShellIds.length=0;}setRenderMode(e){this.topGroup.setRenderMode(e),this.botGroup.setRenderMode(e);}initGroupIndex(e){this.shellIndex[e]&&Object.values(this.shellIndex[e]).forEach(n=>{this.topGroup.remove(n.group),this.botGroup.remove(n.group);});let t={};return this.shellIndex[e]=t,t;}fitPly(e){return Me.build2(id(e.primitives,.1));}addShell(e,t,n,i,s,o,a,l){a=a.map(u=>this.fitPly(u)),this.shellInfoIndex[e]=[t,n,i,s,o,a,l],this.needUpdateShells.add(e);}addCrease(e,t,n,i,s){this.creaseIndex[e]=[t,n,i,s],this.needUpdateCreases.add(e);}addShellEntity(e,t,n,i,s,o,a){if(s===0||o[0].area(.01)>=0)return;o=o.map(u=>this.fitPly(u));let l=o[0].bbox();l.area()>.01&&l.width()>.1&&l.height()>.1&&(this.entityInfoIndex[e]=[t,n,i,s,o,a],this.needUpdateEntities.add(e));}addBoss(e,t,n,i,s,o,a,l,u){this.bossInfoIndex[e]=[t,n,i,s,o,a,l,u],this.needUpdateBosss.add(e);}addConnect(e,t){this.needUpdateCreases.add(e),t.forEach(n=>this.connectIndex[n]=e);}gnrShell(e,t,n,i,s,o,a,l){let u=this.initGroupIndex(e);if(n==="T&B"){let c=a[0],h=[ei.UNION];c.primitives.forEach(C=>h.push(ct.buildByStroke(C,o,ji.ROUND)));let d=yo(h);if(d.items.length===0){console.error("Shell generation failed!");return;}let f=d.items[0].items.filter(C=>Math.abs(C.area(this.ONE_MIL))>Le(this.ONE_MIL,2)).map(C=>this.fitPly(C));if(f.length===1){console.error("Shell generation failed!");return;}let p=l.BottomHeight;this.botHeight=p;let m=l.TopInnerHeight,g=l.BottomInnerHeight,b=i-p,y=Ie.greatereq(p,o)?e+"Bot":null,v=Ie.greatereq(b,o)?e+"Top":null;if(!y&&!v)return;y?(this.drawjs.polygonCylinder(y,f[0],p),v&&(this.drawjs.copy(y,v),this.drawjs.scale(v,1,1,b/p),this.drawjs.translate(v,0,0,p))):v&&(this.drawjs.polygonCylinder(v,f[0],b),this.drawjs.translate(v,0,0,p));let E=[y],P=[y],M=[v],I=[v];for(let C=1;C<f.length;C++){let L=f[C].reverse();if(y&&g||v&&m){if(Zi.getExtendPolyLine(L,this.GAP+this.INNER_THICKNESS+this.GAP).forEach(S=>{if(y&&g){let T="topOutShell"+this.topOutShellIds.length;this.drawjs.polygonCylinder(T,S,i),this.topOutShellIds.push(T);}else{let T="botOutShell"+this.botOutShellIds.length;this.drawjs.polygonCylinder(T,S,i),this.botOutShellIds.push(T);}}),Zi.getExtendPolyLine(L,this.GAP).forEach(S=>{if(y&&g){let T="botOutShell"+this.botOutShellIds.length;this.drawjs.polygonCylinder(T,S,i),this.botOutShellIds.push(T);}else{let T="topOutShell"+this.topOutShellIds.length;this.drawjs.polygonCylinder(T,S,i),this.topOutShellIds.push(T);}}),y&&g){if(b-g-this.GAP>0){let S="topOutShell"+this.topOutShellIds.length;this.drawjs.polygonCylinder(S,L,b-g-this.GAP),this.drawjs.translate(S,0,0,p+g+this.GAP),this.topOutShellIds.push(S);}}else if(p-m-this.GAP>0){let S="botOutShell"+this.botOutShellIds.length;this.drawjs.polygonCylinder(S,L,p-m-this.GAP),this.botOutShellIds.push(S);}}else{let S="outShell"+this.outShellIds.length;this.drawjs.polygonCylinder(S,L,i),this.outShellIds.push(S);}if(y){if(g)Zi.getExtendPolyLine(L,this.GAP).forEach((S,T)=>{let B="botUnion"+C+"_"+T;this.drawjs.polygonCylinder(B,S,g+o*.5),this.drawjs.translate(B,0,0,p-o*.5),E.push(B);}),Zi.getExtendPolyLine(L,this.GAP+this.INNER_THICKNESS).forEach((S,T)=>{let B="botSub"+C+"_"+T;this.drawjs.polygonCylinder(B,S,p+g+this.DEVIATION),this.drawjs.translate(B,0,0,o),P.push(B);});else if(i-o!==0){let S="botSub"+C;this.drawjs.polygonCylinder(S,L,i-o),this.drawjs.translate(S,0,0,o),P.push(S);}}if(v)if(m)Zi.getExtendPolyLine(L,this.GAP).forEach((S,T)=>{let B="topUnion"+C+"_"+T;this.drawjs.polygonCylinder(B,S,m+o*.5),this.drawjs.translate(B,0,0,p-m),M.push(B);}),Zi.getExtendPolyLine(L,this.GAP+this.INNER_THICKNESS).forEach((S,T)=>{let B="topSub"+C+"_"+T;this.drawjs.polygonCylinder(B,S,b+m+this.DEVIATION),this.drawjs.translate(B,0,0,i-o-(b+m+this.DEVIATION)),I.push(B);});else{let S="topSub"+C;this.drawjs.polygonCylinder(S,L,b+m+this.DEVIATION),this.drawjs.translate(S,0,0,i-o-(b+m+this.DEVIATION)),I.push(S);}}E.length!==1&&this.drawjs.union(y,E),P.length!==1&&this.drawjs.subtract(y,P),M.length!==1&&this.drawjs.union(v,M),I.length!==1&&this.drawjs.subtract(v,I),y&&(u[y]={isTop:!1,status:4}),v&&(u[v]={isTop:!0,status:4});}else if(n==="DRAWER"){let c=a[0].primitives[0];if(Math.min(c.width,c.height)<=o){console.error("Shell generation failed!");return;}let h=o/2,d="outShell"+this.outShellIds.length;this.drawjs.polygonCylinder(d,c.extend(-h).toPolyline(),i),this.outShellIds.push(d);let f=new F(...l.Direction),p=new ti(f.x===1?c.leftUpPoint:f.x===-1?c.leftUpPoint.add1(c.width,-c.height):f.y===1?c.leftUpPoint.add1(0,-c.height):c.leftUpPoint.add1(c.width,0),f.x!==0?c.width:c.height,f.x!==0?c.height:c.width,0,c.isCCW,c.radius),m=[],g=e+"Bot";this.drawjs.polygonCylinder(g,p.extend(h).toPolyline(),i);let b="sub1";this.drawjs.polygonCylinder(b,p.extend(-h).toPolyline(),i),this.drawjs.translate(b,0,0,o);let{leftUpPoint:y,width:v,height:E,radius:P}=p,M=v-Math.max(P-this.GAP,h),I=M-this.GAP,C="sub2";this.drawjs.polygonCylinder(C,Me.build4([y.add1(Math.max(P,h),-h),y.add1(I,-h),y.add1(I,h+this.DEVIATION),y.add1(v+h+this.DEVIATION,h+this.DEVIATION),y.add1(v+h+this.DEVIATION,-E-h-this.DEVIATION),y.add1(I,-E-h-this.DEVIATION),y.add1(I,-E+h),y.add1(Math.max(P,h),-E+h),y.add1(Math.max(P,h),-h)]),i),this.drawjs.translate(C,0,0,i-this.RAIL_THICKNESS-this.COVER_THICKNESS-this.GAP*2),this.drawjs.subtract(g,[g,b,C]),u[g]={isTop:!1,status:4},m.push(g);let L=[];if(P>0){let be=y.add1(I,0),xe=y.add1(P,0),Oe=y.add1(0,-P),Re=y.add1(0,P-E),Ve=y.add1(P,-E),lt=y.add1(I,-E);L.push(new q(be,xe),ee.build1(xe,Oe,P,P,!1,vt.CCW),new q(Oe,Re),ee.build1(Re,Ve,P,P,!1,vt.CCW),new q(Ve,lt));}else{let be=y.add1(I,0),xe=y,Oe=y.add1(0,-E),Re=y.add1(I,-E);L.push(new q(be,xe),new q(xe,Oe),new q(Oe,Re));}let S=L[0].start(),T=L[L.length-1].end(),B=h+this.RAIL_WIDTH;if(P>B){let be=y.add1(I,-h-this.RAIL_WIDTH),xe=y.add1(P,-h-this.RAIL_WIDTH),Oe=y.add1(B,-P),Re=y.add1(B,P-E),Ve=y.add1(P,-E+B),lt=y.add1(I,-E+B),R=P-B;L.push(new q(T,lt),new q(lt,Ve),ee.build1(Ve,Re,R,R,!1,vt.CW),new q(Re,Oe),ee.build1(Oe,xe,R,R,!1,vt.CW),new q(xe,be),new q(be,S));}else{let be=y.add1(I,-h-this.RAIL_WIDTH),xe=y.add1(B,-B),Oe=y.add1(B,-E+B),Re=y.add1(I,-E+B);L.push(new q(T,Re),new q(Re,Oe),new q(Oe,xe),new q(xe,be),new q(be,S));}let $=e+"Rail1";this.drawjs.polygonCylinder($,Me.build2(L),this.RAIL_THICKNESS),this.drawjs.translate($,0,0,i-this.RAIL_THICKNESS),u[$]={isTop:!1,status:4},m.push($);let Z=e+"Rail2";this.drawjs.copy($,Z),this.drawjs.translate(Z,0,0,-this.RAIL_THICKNESS-this.COVER_THICKNESS-this.GAP*2),u[Z]={isTop:!1,status:4},m.push(Z);let H=[],W=y.add1(M,-h-this.GAP-this.RAIL_WIDTH),Y=y.add1(M,-E+h+this.GAP+this.RAIL_WIDTH),U=P+h;if(M<=v-P){let be=new F(W.x,y.y+h),xe=y.add1(v-P,h),Oe=y.add1(v+h,-P),Re=y.add1(v+h,-E+P),Ve=xe.add1(0,-E-(xe.y-y.y)*2),lt=be.add1(0,-E-(be.y-y.y)*2);H.push(new q(W,be),new q(be,xe),ee.build1(xe,Oe,U,U,!1,vt.CW),new q(Oe,Re),ee.build1(Re,Ve,U,U,!1,vt.CW),new q(Ve,lt),new q(lt,Y));}else{if(hd(ee.build1(y.add1(v-P,h),y.add1(v+h,-P),P+h,P+h,!1,vt.CW),new q(y.add1(M,h),y.add1(M,0)))===0)throw new Error("cnt === 0");let xe=new F(J[0],J[1]),Oe=y.add1(v+h,-P),Re=y.add1(v+h,-E+P),Ve=xe.add1(0,-E-(xe.y-y.y)*2);H.push(new q(W,xe),ee.build1(xe,Oe,U,U,!1,vt.CW),new q(Oe,Re),ee.build1(Re,Ve,U,U,!1,vt.CW),new q(Ve,Y));}let D=h+this.RAIL_WIDTH+this.GAP,k=P-D;if(k>0){let be=y.add1(P,-E+D),xe=y.add1(D,-E+P),Oe=y.add1(D,-P),Re=y.add1(P,-D);H.push(new q(Y,be),ee.build1(be,xe,k,k,!1,vt.CW),new q(xe,Oe),ee.build1(Oe,Re,k,k,!1,vt.CW),new q(Re,W));}else{let be=y.add1(D,-E+D),xe=y.add1(D,-D);H.push(new q(Y,be),new q(be,xe),new q(xe,W));}let ie=e+"ThickCover";this.drawjs.polygonCylinder(ie,Me.build2(H),this.COVER_THICKNESS+this.GAP+this.RAIL_THICKNESS),this.drawjs.translate(ie,0,0,i-this.RAIL_THICKNESS-this.GAP-this.COVER_THICKNESS),u[ie]={isTop:!0,status:4},m.push(ie);let se=e+"ThinCover",oe=h+this.GAP,le=P-oe;if(le>0){let be=y.add1(v-P+h,-oe),xe=y.add1(P,-oe),Oe=y.add1(oe,-P),Re=y.add1(oe,-E+P),Ve=y.add1(P,-E+oe),lt=y.add1(v-P+h,-E+oe);this.drawjs.polygonCylinder(se,Me.build2([new q(be,xe),ee.build1(xe,Oe,le,le,!1,vt.CCW),new q(Oe,Re),ee.build1(Re,Ve,le,le,!1,vt.CCW),new q(Ve,lt),new q(lt,be)]),this.COVER_THICKNESS);}else{let be=y.add1(v-P+h,-oe),xe=y.add1(oe,-oe),Oe=y.add1(oe,-E+oe),Re=y.add1(v-P+h,-E+oe);this.drawjs.polygonCylinder(se,Me.build2([new q(be,xe),new q(xe,Oe),new q(Oe,Re),new q(Re,be)]),this.COVER_THICKNESS);}this.drawjs.translate(se,0,0,i-this.RAIL_THICKNESS-this.GAP-this.COVER_THICKNESS),u[se]={isTop:!0,status:4},m.push(se);let Ee=f.angleD(F.ORIGIN);for(let be of m)Ie.eq(Ee,0)||this.drawjs.rotate(be,y.x,y.y,0,0,0,1,Ee),Ie.eq(c.angle,0)||this.drawjs.rotate(be,c.leftUpPoint.x,c.leftUpPoint.y,0,0,0,1,c.angle);}this.shellHeight=i,this.shellThickness=o,this.shellType=n;}gnrBoss(e,t,n,i,s,o,a,l,u){if(i<=0)return;let c=this.initGroupIndex(e);if(a&&i>s){let f=e+"Spigot",p=e+"Ext",[m,g]=a,b=m+s;i<m+s&&(b=i,m=i-s),this.drawjs.cylinder(f,g/2,m+this.DEVIATION),this.drawjs.cylinder(p,g/2+s,b),t?(this.drawjs.translate(f,n.x,n.y,this.shellHeight-m),this.drawjs.translate(p,n.x,n.y,this.shellHeight-b)):(this.drawjs.translate(f,n.x,n.y,-this.DEVIATION),this.drawjs.translate(p,n.x,n.y,0)),c[f]={isTop:t,subStatus:12},c[p]={isTop:t,status:8};}if(l){let[f,p,m,g]=l,b=this.shellType==="DRAWER"&&t?this.COVER_THICKNESS+this.GAP+this.RAIL_THICKNESS:this.shellThickness;if(i>b+m){let y=e+"Stiff1",v=n.add(new F(o/2,g/2+b));this.drawjs.polygonCylinder(y,Me.build4([v,v.add(new F(0,i-b-m)),v.add(new F(0,i-b-m)).add(new F(f+s,0)),v.add(new F(p+s,0)),v]),g);let E=n.add(new F(o/2,g/2));t?(this.drawjs.rotate(y,E.x,E.y,0,1,0,0,-90),this.drawjs.translate(y,0,-g,this.shellHeight)):this.drawjs.rotate(y,E.x,E.y,0,1,0,0,90);let P=e+"Stiff2";this.drawjs.copy(y,P),this.drawjs.rotate(P,n.x,n.y,0,0,0,1,90);let M=e+"Stiff3";this.drawjs.copy(y,M),this.drawjs.rotate(M,n.x,n.y,0,0,0,1,180);let I=e+"Stiff4";this.drawjs.copy(y,I),this.drawjs.rotate(I,n.x,n.y,0,0,0,1,270),c[y]={isTop:t,status:8},c[P]={isTop:t,status:8},c[M]={isTop:t,status:8},c[I]={isTop:t,status:8};}}let h=e+"Cylinder";this.drawjs.cylinder(h,o/2+s,i);let d=e+"Hole";a?this.drawjs.cylinder(d,o/2,i+this.DEVIATION*2):i>this.shellThickness?this.drawjs.cylinder(d,o/2,i-this.shellThickness+this.DEVIATION):d=null,t?(this.drawjs.translate(h,n.x,n.y,this.shellHeight-i),d&&this.drawjs.translate(d,n.x,n.y,this.shellHeight-i-this.DEVIATION)):(this.drawjs.translate(h,n.x,n.y,0),a?this.drawjs.translate(d,n.x,n.y,-this.DEVIATION):d&&this.drawjs.translate(d,n.x,n.y,this.shellThickness)),c[h]={isTop:t,status:8},d&&(c[d]={isTop:t,subStatus:12,onlySubCurLayer:!0});}gnrShellEntity(e,t,n,i,s,o,a){if(this.connectIndex[e]&&!this.creaseIndex[this.connectIndex[e]])return;let l=n||this.drawjs.cadEngine===1?0:this.DEVIATION;s=s>0?Math.min(s,1e10):Math.max(s,-1e10);let u=this.initGroupIndex(e),c=o[0],h=c.primitives[0];if(c.primitives.length===1&&h instanceof ee&&h.rx===h.ry&&Math.abs(h.sweepAngle)>=360?(this.drawjs.cylinder(e,h.rx,Math.abs(s)+2*l),this.drawjs.translate(e,h.center.x,h.center.y,0)):this.drawjs.polygonCylinder(e,c,Math.abs(s)+2*l),this.connectIndex[e]){let[d,f,p,m]=this.creaseIndex[this.connectIndex[e]],g=0;c.points1(this.DEVIATION,y=>g+=F.normal(y,d,f));let b=f.sub(d);s<0?this.drawjs.translate(e,0,0,s-l):this.drawjs.translate(e,0,0,-l),this.drawjs.rotate(e,d.x,d.y,0,b.x,b.y,0,g>0?p:-p);}else if(t){if(s<0){let d=this.shellType==="DRAWER"?this.COVER_THICKNESS+this.GAP+this.RAIL_THICKNESS:this.shellThickness;this.drawjs.translate(e,0,0,this.shellHeight-d-l);}else this.drawjs.translate(e,0,0,this.shellHeight-s-l);}else s<0?this.drawjs.translate(e,0,0,this.shellThickness+s-l):this.drawjs.translate(e,0,0,-l);if(!n){u[e]={isTop:t,subStatus:i};return;}if(!this.connectIndex[e])u[e]={isTop:t,status:16};else if(i===1)u[e]={isTop:!0,status:16};else if(i===2||this.shellType==="DRAWER"||this.shellHeight-this.botHeight<this.shellThickness)u[e]={isTop:!1,status:16};else if(this.botHeight<this.shellThickness)u[e]={isTop:!0,status:16};else{let[d,f,p,m]=this.creaseIndex[this.connectIndex[e]],g=f.sub(d).normalize(),b=!0,y;for(let v of o)if(v.points1(this.DEVIATION,E=>{if(!b)return;let P=E.sub(d).cross(g);y===void 0&&(y=P),(Math.abs(P)<this.botHeight||y*P<0)&&(b=!1);}),!b)break;u[e]={isTop:b,status:16};}}showAll(){var e,t;(e=this.topResultGroup)==null||e.setVisible(!1),(t=this.botResultGroup)==null||t.setVisible(!1);for(let n of Object.values(this.shellIndex))for(let i of Object.entries(n)){let[s,o]=i,{group:a,isTop:l,subStatus:u}=o;if(a){a.setVisible(!0),o.group.setHidden(!1);continue;}a=new We(u?1:4),a.add(new Et(this.drawjs.getTriangles(s),null,u?cse:sb)),o.group=a,l?this.topGroup.add(a):this.botGroup.add(a);}}gnrStiff(e){let t=e&&this.shellType==="DRAWER"?this.COVER_THICKNESS+this.GAP+this.RAIL_THICKNESS:this.shellThickness,n=Object.values(this.bossInfoIndex).filter(l=>l[0]===e&&l[6]&&l[2]>t+l[6][2]);if(n.length===0)return[];let i=new bi(10);for(let[l,u,c,h,d,f,p,m]of n){let C=function(L,S){i.insert(new ib(L,S,M,I,P,E));},g=d/2,[b,y,v,E]=p,P=c-t-v,M=y+h,I=b+h;C(u.add1(g,0),new F(1,0)),C(u.add1(-g,0),new F(-1,0)),C(u.add1(0,g),new F(0,1)),C(u.add1(0,-g),new F(0,-1));}i.items.forEach(l=>i.search(l.bbox()).forEach(u=>l.beCut(u)));let s=0,o=[],a=e?"topStiff":"botStiff";return i.items.forEach(l=>{let u=a+s++;o.push(u);let{topWidth:c,botWidth:h,startPoint:d,vec:f,thickness:p,height:m}=l,g=l.getCutWidth(),b=d.add1(0,p/2);if(g>=Math.max(c,h))this.drawjs.polygonCylinder(u,Me.build4([b,b.add1(0,t+m),b.add1(c,t+m),b.add1(h,t),b.add1(h,0),b]),p);else if(g<=Math.min(c,h))this.drawjs.polygonCylinder(u,Me.build4([b,b.add1(0,t+m),b.add1(g,t+m),b.add1(g,t),b.add1(g,0),b]),p);else{if(el(new q(new F(h,0),new F(c,m)),new q(new F(g,0),new F(g,m)))===0)throw new Error("cnt === 0");c<h?this.drawjs.polygonCylinder(u,Me.build4([b,b.add1(0,t+m),b.add1(c,t+m),b.add1(g,t+J[1]),b.add1(g,t),b.add1(g,0),b]),p):this.drawjs.polygonCylinder(u,Me.build4([b,b.add1(0,t+m),b.add1(g,t+m),b.add1(g,t+J[1]),b.add1(h,t),b.add1(h,0),b]),p);}let y=d.add1(0,p/2);e?(this.drawjs.rotate(u,y.x,y.y,0,1,0,0,-90),this.drawjs.translate(u,0,-p,this.shellHeight)):this.drawjs.rotate(u,y.x,y.y,0,1,0,0,90),this.drawjs.rotate(u,d.x,d.y,0,0,0,1,f.angleD(F.ORIGIN));}),o;}subShells(e,t,n){e.length===0||t.length===0||(e[0]!==n&&this.drawjs.union(n,e),this.drawjs.subtract(n,[n,...t]),e.length=0,e.push(n));}gnrShellTopBotUnion(){if(Object.values(this.shellIndex).length===0)return;let e=[[],[]],t=[this.gnrStiff(!1),this.gnrStiff(!0)],n=[[],[]],i=[[],[]],s=[[],[]],o=[[],[]],a=[[],[]],l=[[],[]],u=[[],[]],c=[[],[]];for(let d of Object.values(this.shellIndex))for(let f of Object.entries(d)){let p=function(E){v?E[y?1:0].push(m):(E[0].push(m),E[1].push(m));},[m,{status:g,subStatus:b,isTop:y,onlySubCurLayer:v}]=f;g===4?e[y?1:0].push(m):g===8?!/Stiff/.test(m)&&t[y?1:0].push(m):g===16?n[y?1:0].push(m):b===4?p(i):b===12?p(s):b===20?p(o):b===28?p(a):b===8?p(l):b===24?p(u):b===16&&p(c);}if(this.subShells(e[1],i[1],"topUnionShell"),this.subShells(e[0],i[0],"botUnionShell"),this.subShells(t[1],l[1],"topUnionBoss"),this.subShells(t[0],l[0],"botUnionBoss"),this.subShells(n[1],c[1],"topUnionEntity"),this.subShells(n[0],c[0],"botUnionEntity"),Object.keys(this.shellInfoIndex).length!==0&&(t[0].length!==0||t[1].length!==0)){let d="outShellUnion";if(this.outShellIds.length!==0&&this.drawjs.union(d,this.outShellIds),t[1].length!==0)if(t[1][0]!=="topUnionBoss"&&(this.drawjs.union("topUnionBoss",t[1]),t[1].length=0,t[1].push("topUnionBoss")),this.topOutShellIds.length===0)this.outShellIds.length!==0&&this.drawjs.intersect("topUnionBoss","topUnionBoss",d);else{let f="topOutShellUnion";this.drawjs.union(f,this.topOutShellIds),this.drawjs.intersect("topUnionBoss","topUnionBoss",f);}if(t[0].length!==0)if(t[0][0]!=="botUnionBoss"&&(this.drawjs.union("botUnionBoss",t[0]),t[0].length=0,t[0].push("botUnionBoss")),this.botOutShellIds.length===0)this.outShellIds.length!==0&&this.drawjs.intersect("botUnionBoss","botUnionBoss",d);else{let f="botOutShellUnion";this.drawjs.union(f,this.botOutShellIds),this.drawjs.intersect("botUnionBoss","botUnionBoss",f);}}let h=d=>{let f=d?1:0,p=d?"top":"bot",m=s[f],g=o[f],b=u[f],y=e[f],v=t[f],E=n[f];(m.length!==0?1:0)+(g.length!==0?1:0)+(b.length!==0?1:0)>=2?(this.subShells(y,m.concat(g),`${p}UnionShell`),this.subShells(v,m.concat(b),`${p}UnionBoss`),this.subShells(E,g.concat(b),`${p}UnionEntity`)):m.length!==0?(y.push(...v),v.length=0,this.subShells(y,m,`${p}UnionShellBoss`)):g.length!==0?(y.push(...E),E.length=0,this.subShells(y,g,`${p}UnionShellEntity`)):b.length!==0&&(v.push(...E),E.length=0,this.subShells(v,b,`${p}UnionBossEntity`));};return h(!0),e[1].push(...t[1],...n[1]),this.subShells(e[1],a[1],"shell-top-union"),e[1].length!==0&&e[1][0]!=="shell-top-union"&&this.drawjs.union("shell-top-union",e[1]),h(!1),e[0].push(...t[0],...n[0]),this.subShells(e[0],a[0],"shell-bot-union"),e[0].length!==0&&e[0][0]!=="shell-bot-union"&&this.drawjs.union("shell-bot-union",e[0]),[e[1].length>0?"shell-top-union":null,e[0].length>0?"shell-bot-union":null];}extScissorBBox(){}gnrResult(){return Se(this,arguments,function*(e=new Si(),t=!0){var a,l;if(Object.values(this.shellIndex).length===0)return;if(this.drawjs.cadEngine===1||t===!1){this.gnrShellTopBotUnion();return;}for(let u of Object.values(this.shellIndex))for(let c of Object.values(u))(a=c.group)==null||a.setVisible(!1),(l=c.group)==null||l.setHidden(!0);if(this.botResultGroup){this.topResultGroup.setVisible(!0),this.botResultGroup.setVisible(!0);return;}this.topResultGroup=new We(),this.botResultGroup=new We(),this.topGroup.add(this.topResultGroup),this.botGroup.add(this.botResultGroup);let[n,i]=(yield e.rpcCall("/worker/shell/quickGnrResult",this.enc(),this.timeout)).message;n&&this.topResultGroup.add(ts(n)),i&&this.botResultGroup.add(ts(i)),this.occshellWorkerBridge&&this.occshellWorkerBridge.discard();let s=ig("https://modules.lceda.cn/smt-gl-engine/0.10.29.59892ce1/worker.js",Dh()),o=new Lp.MessageBus();this.occshellWorkerBridge=new Lp.WorkerMessageBridge(o,new Worker(s)),this.occshellWorkerBridge.rpcCall("/worker/shell/gnrResult",this.enc()).then(u=>{this.extScissorBBox();let[c,h]=u.message;this.topResultGroup.clear(),this.botResultGroup.clear(),c&&this.topResultGroup.add(ts(c)),h&&this.botResultGroup.add(ts(h)),this.extScissorBBox();});});}end(){this.topGroup.remove(this.topResultGroup),this.topResultGroup=null,this.botGroup.remove(this.botResultGroup),this.botResultGroup=null;for(let e of Object.entries(this.connectIndex)){let[t,n]=e;this.needUpdateCreases.has(n)&&this.needUpdateEntities.add(t);}this.needUpdateCreases.clear();for(let e of this.needUpdateShells)this.gnrShell(e,...this.shellInfoIndex[e]);this.needUpdateShells.clear();for(let e of this.needUpdateBosss)this.gnrBoss(e,...this.bossInfoIndex[e]);this.needUpdateBosss.clear();for(let e of this.needUpdateEntities){let t=this.entityInfoIndex[e];t&&this.gnrShellEntity(e,...t);}this.needUpdateEntities.clear();}encVec(e){return[e.x,e.y];}decVec(e){return new F(e[0],e[1]);}enc(){let e={connectIndex:this.connectIndex,creaseIndex:{},shellInfoIndex:{},bossInfoIndex:{},entityInfoIndex:{}};return Object.entries(this.creaseIndex).forEach(t=>{let[n,i]=t;e.creaseIndex[n]=i.slice(),e.creaseIndex[n][0]=this.encVec(i[0]),e.creaseIndex[n][1]=this.encVec(i[1]);}),Object.entries(this.shellInfoIndex).forEach(t=>{let[n,i]=t;e.shellInfoIndex[n]=i.slice(),e.shellInfoIndex[n][5]=rb(i[5]);}),Object.entries(this.bossInfoIndex).forEach(t=>{let[n,i]=t;e.bossInfoIndex[n]=i.slice(),e.bossInfoIndex[n][1]=this.encVec(i[1]);}),Object.entries(this.entityInfoIndex).forEach(t=>{let[n,i]=t;e.entityInfoIndex[n]=i.slice(),e.entityInfoIndex[n][4]=rb(i[4]);}),e;}gnrResultInWorker(e){let{creaseIndex:t,connectIndex:n,shellInfoIndex:i,bossInfoIndex:s,entityInfoIndex:o}=e;Object.entries(t).forEach(c=>{let[h,d]=c;d[0]=this.decVec(d[0]),d[1]=this.decVec(d[1]),this.addCrease(h,...d);}),Object.entries(n).forEach(c=>{let[h,d]=c;this.addConnect(d,[h]);}),Object.entries(i).forEach(c=>{let[h,d]=c;d[5]=nb(d[5]),this.addShell(h,...d);}),Object.entries(s).forEach(c=>{let[h,d]=c;d[1]=this.decVec(d[1]),this.addBoss(h,...d);}),Object.entries(o).forEach(c=>{let[h,d]=c;d[4]=nb(d[4]),this.addShellEntity(h,...d);}),this.end();let a=[null,null];if(Object.values(this.shellIndex).length===0)return a;let[l,u]=this.gnrShellTopBotUnion();if(l){let c=new We();c.add(new Et(this.drawjs.getTriangles("shell-top-union"),null,sb)),a[0]=tb(c).join(`
`);}if(u){let c=new We();c.add(new Et(this.drawjs.getTriangles("shell-bot-union"),null,sb)),a[1]=tb(c).join(`
`);}return this.clear(),a;}};var _O={},ob=Rn(),Op=null;function ab(){return Op||(Op=new Promise((r,e)=>{try{let t="https://modules.lceda.cn/occShell/0.0.2/occShell.js";if(ob.importScripts)/^https?/.test(t)?importScripts(t):importScripts(location.origin+t),r();else if(ob.document){let n=document.createElement("script");n.src=t,n.onload=()=>{r();},n.onerror=e,n.onabort=e,document.head.appendChild(n);}}catch(t){e(t);}}).then(()=>ob.createOccshell(_O)).then(()=>_O).catch(r=>{throw Op=null,r;})),Op;}function SO(r,e){return Se(this,null,function*(){yield sd({onStart(){},onLayerConfig:()=>{},onLayerPhys:()=>{},onPanelize:()=>{},onSilkOpts:()=>{},onTexture:()=>{},onPrimitive:()=>{},onPolys:()=>{},onCircle:()=>{},onRect:()=>{},onPolygon:()=>{},onPolygonCfg:()=>{},onModel:()=>{},onItemOrder:()=>{},onPrintMethod:()=>{},onShellOutline:(s,o,a,l,u,c,h,d)=>e.addShell(s,o,a,l,u,c,h,d),onCrease:(s,o,a,l,u)=>e.addCrease(s,o,a,l,u),onShellEntity:(s,o,a,l,u,c,h)=>e.addShellEntity(s,o,a,l,u,c,h),onBoss:(s,o,a,l,u,c,h,d,f)=>e.addBoss(s,o,a,l,u,c,h,d,f),onConnect:(s,o)=>e.addConnect(s,o),onEnd:()=>e.end()},r,1,{scale:.1,scaleMatrix:ze.scale(.1)});let n=e.gnrShellTopBotUnion(),i=new Ur(1,39.37).ratio;n.forEach(s=>s&&e.drawjs.scale(s,i,i,i));});}var BO=ki(fu()),IO=ki(Eg());function Qf(r,e){let t=new BO.BroadcastChannelMessageBus(e);r.rpcService("/worker/step2mesh",n=>sP(n[0],n[1])),r.rpcService("/worker/objDecode",n=>Xa(n[0],n[1],n[2])),r.rpcService("/worker/runBoolean",n=>{dr.LayerSubstrate&&console.warn("/worker/runBoolean start");let i=[yo(wo(n).rulesArr[0])];dr.LayerSubstrate&&console.warn("bool result",i);let s=tu(i);return dr.LayerSubstrate&&console.warn("bool encode",s.byteLength),s;}),r.rpcService("/worker/alignModel",n=>lP(...n)),r.rpcService("/worker/pcb2step",n=>Se(this,null,function*(){let i=new ud(39.37,new Si());if(n[1]===!0){let s=new IO.default(),o=yield Id(n[0],i,(a,l)=>Se(this,null,function*(){s.file(a,l);}),n[2]);return{file:yield s.generateAsync({type:"blob"}),statusIndex:o};}else{let[s,o]=yield oP(n[0],i,a=>{t.publish("/worker/pcb2step/progress",a);},n[2]);return{file:new Blob([s],{type:"text/plain"}),statusIndex:o};}})),r.rpcService("/worker/tcl2model",n=>Se(this,null,function*(){if(Rn().OC===void 0){let s=yield ab();Rn().OC=s;}let i=new Al(2);try{switch(yield SO(n[0],i),n[1]){case"STEP":return yield i.drawjs.downloadStep(n[2]);case"STL":return yield i.drawjs.downloadStl(n[2]);case"OBJ":return yield i.drawjs.downloadObj(n[2]);}}catch(s){return i.drawjs.errList;}})),r.rpcService("/worker/shell/quickGnrResult",n=>Se(this,null,function*(){return console.log("/worker/shell/quickGnrResult"),new Al(0).gnrResultInWorker(n);})),r.rpcService("/worker/shell/gnrResult",n=>Se(this,null,function*(){if(console.log("/worker/shell/gnrResult__________"),Rn().OC===void 0){let i=yield ab();Rn().OC=i;}return new Al(2).gnrResultInWorker(n);}));}var kp=ki(fu()),AO=new kp.MessageBus();new kp.WorkerMessageBridge(AO,self),Qf(AO,self.BROAD_CAST_BUS_UUID),console.log("installed worker");})();/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/ /*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */ //!!  bug 
//# sourceMappingURL=https://modules.lceda.cn/smt-gl-engine/0.10.29.59892ce1/worker.js.map
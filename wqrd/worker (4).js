(()=>{var Uf=Object.create;var fu=Object.defineProperty,Ff=Object.defineProperties,Gf=Object.getOwnPropertyDescriptor,Wf=Object.getOwnPropertyDescriptors,Hf=Object.getOwnPropertyNames,Bh=Object.getOwnPropertySymbols,zf=Object.getPrototypeOf,Oh=Object.prototype.hasOwnProperty,Yf=Object.prototype.propertyIsEnumerable;var qi=Math.pow,_h=(a,t,e)=>t in a?fu(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,Ai=(a,t)=>{for(var e in t||={})Oh.call(t,e)&&_h(a,e,t[e]);if(Bh)for(var e of Bh(t))Yf.call(t,e)&&_h(a,e,t[e]);return a},Dh=(a,t)=>Ff(a,Wf(t));var qf=(a,t)=>()=>(t||a((t={exports:{}}).exports,t),t.exports);var Xf=(a,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Hf(t))!Oh.call(a,i)&&i!==e&&fu(a,i,{get:()=>t[i],enumerable:!(r=Gf(t,i))||r.enumerable});return a};var Kf=(a,t,e)=>(e=a!=null?Uf(zf(a)):{},Xf(t||!a||!a.__esModule?fu(e,"default",{value:a,enumerable:!0}):e,a));var Ii=(a,t,e)=>new Promise((r,i)=>{var n=l=>{try{o(e.next(l))}catch(u){i(u)}},s=l=>{try{o(e.throw(l))}catch(u){i(u)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(n,s);o((e=e.apply(a,t)).next())});var Fc=qf((Cl,ih)=>{(function(t,e){typeof Cl=="object"&&typeof ih=="object"?ih.exports=e():typeof define=="function"&&define.amd?define([],e):typeof Cl=="object"?Cl.lc_message_bus=e():t.lc_message_bus=e()})(self,()=>(()=>{"use strict";var a={};a.d=(V,A)=>{for(var v in A)a.o(A,v)&&!a.o(V,v)&&Object.defineProperty(V,v,{enumerable:!0,get:A[v]})},a.o=(V,A)=>Object.prototype.hasOwnProperty.call(V,A),a.r=V=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(V,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(V,"__esModule",{value:!0})};var t={};a.r(t),a.d(t,{BroadcastChannelMessageBus:()=>Df,MessageBus:()=>Oe,MessageBus2:()=>_f,WindowMessageBridge:()=>pe,WorkerMessageBridge:()=>ne});let e=new Error("list is empty");class r{constructor(A,v){this.prev=null,this.next=null,this.parent=A,this.item=v}insertAfter(A){A.next=this.next,this.next=A,A.prev=this,A.next!==null&&(A.next.prev=A)}insertBefore(A){A.prev=this.prev,this.prev=A,A.next=this,A.prev!==null&&(A.prev.next=A)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(A){this.item=A}}class i{constructor(A){this._next=A}hasNext(){return this._next!==null}next(){let A=this._next;if(A!==null)return this._next=A.next,A.item;throw new Error("iterator is null")}}class n{constructor(A){this._next=A}hasNext(){return this._next!==null}next(){let A=this._next;if(A!==null)return this._next=A.next,A;throw new Error("iterator is null")}}class s{constructor(){this.first=null,this.last=null,this.cnt=0}add(A){return this.addLast(A)}push(A){return this.addLast(A)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let A=this.first;if(A===null)throw e;return this.remove(A),A.item}removeLast(){let A=this.last;if(A===null)throw e;return this.remove(A),A.item}addLast(A){if(this.first===null||this.last===null){let v=new r(this,A);return this.first=v,this.last=v,this.cnt++,v}else return this.insertAfter(this.last,A)}addFirst(A){if(this.first===null||this.last===null){let v=new r(this,A);return this.first=v,this.last=v,this.cnt++,v}else return this.insertBefore(this.first,A)}getFirst(){if(this.first===null)throw e;return this.first.item}getLast(){if(this.last===null)throw e;return this.last.item}insertAfter(A,v){let _=new r(this,v);return A.insertAfter(_),A===this.last&&(this.last=_),this.cnt++,_}insertBefore(A,v){let _=new r(this,v);return A.insertBefore(_),A===this.first&&(this.first=_),this.cnt++,_}remove(A){A.remove(),A===this.first&&(this.first=A.next),A===this.last&&(this.last=A.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new i(this.first)}listIterator(){return new n(this.first)}toArray(){let A=new Array,v=this.first;for(;v!=null;)A.push(v.item),v=v.next;return A}}var o=(V,A,v)=>new Promise((_,G)=>{var K=Te=>{try{fe(v.next(Te))}catch(ar){G(ar)}},re=Te=>{try{fe(v.throw(Te))}catch(ar){G(ar)}},fe=Te=>Te.done?_(Te.value):Promise.resolve(Te.value).then(K,re);fe((v=v.apply(V,A)).next())});let l=new ArrayBuffer(8),u=new Float64Array(l),h=new Uint32Array(l),c=new Uint16Array(l),f=ArrayBuffer;try{f=self.HTMLImageElement||f}catch{}function d(V){if(typeof V!="object"||V===null||V instanceof Date||V instanceof ArrayBuffer||V instanceof Blob||V instanceof FormData||V instanceof Function||V instanceof Uint8ClampedArray||V instanceof f)return V;if(Array.isArray(V))return V.map(d);{let A={};for(let v in V)Object.hasOwnProperty.call(V,v)&&(A[v]=d(V[v]));return A}}function p(V,A){return m(V,A,()=>[])}function m(V,A,v){let _=V[A];return _!==void 0||(_=v(A),V[A]=_),_}function g(V,A){if(Array.isArray(V)){for(let v=0,_=V.length;v<_;v++)if(A(void 0,V[v],v)===!1)return}else{let v=0;for(let _ in V)if(V.hasOwnProperty(_)){let G=V[_];if(A(_,G,v)===!1)return;v++}}}let x=Object.prototype.hasOwnProperty;function y(V,A){return o(this,null,function*(){if(Array.isArray(V)){for(let v=0,_=V.length;v<_;v++)if((yield A(void 0,V[v],v))===!1)return}else{let v=0;for(let _ in V)if(x.call(V,_)){let G=V[_];if((yield A(_,G,v))===!1)return;v++}}})}function P(V,A,v){return typeof V=="string"&&(/https?:/.test(V)||(V=location.origin+V)),Promise.race([fetch(V,A),new Promise((_,G)=>setTimeout(G,v))])}function L(V,A){let v=0,_=0;return(...G)=>{let K=++v;setTimeout(()=>{let re=performance.now();if(K===v||re-_>=V){try{A(...G)}catch(fe){console.log(fe)}_=re}},Math.max(0,V-(performance.now()-_)))}}function w(V,A){let v=V.length,_=0;for(;_<v;){let G=V.indexOf(`
`,_);G<0&&(G=v);let K=V.substring(_,G);try{if(A(K)===!1)return}catch(re){console.error(re)}_=G+1}}function C(V){let A=null;return()=>(A===null&&(A=V()),A)}let T=0;function M(){T===0&&(T=Date.now()-performance.now());let V=new Array,A=T+performance.now();u[0]=A,V.push(h[1].toString(16)),u[0]=Math.random(),V.push(c[3].toString(16));let v=c[2].toString(16);V.push("4"+v.substr(0,3)),u[0]=A;let _=h[0].toString(16)+h[1].toString(16);return V.push("0"+_.substr(0,3)),V.push(_.substr(3)),V.join("-")}class E{constructor(A){this.resources=A,this.idle=[]}acquire(A){this.resources>0?(this.resources--,A()):this.idle.push(A)}acquireSync(){return new Promise(A=>{this.acquire(A)})}release(){let A=this.idle.shift();A?A():this.resources++}}function W(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function k(V,A,v){let _=V.length+A-1;for(let G=0;G<_;G++){let K=new Array;for(let re=G-A+1;re<=G;re++)K.push(V[re]);if(v(K)===!1)break}}function O(){let V=new Date,A=V.getFullYear(),v=V.getMonth()+1,_=V.getDate(),G=V.getHours(),K=V.getMinutes(),re=V.getSeconds(),fe=V.getMilliseconds();return"["+A+"-"+(v<10?"0"+v:v)+"-"+(_<10?"0"+_:_)+" "+(G<10?"0"+G:G)+":"+(K<10?"0"+K:K)+":"+(re<10?"0"+re:re)+"."+(fe<100?fe<10?"00"+fe:"0"+fe:fe)+"] "}function se(V){return o(this,null,function*(){let A=typeof V=="string"?new TextEncoder().encode(V):V,v=yield crypto.subtle.digest("SHA-256",A);return Array.from(new Uint8Array(v)).map(K=>K.toString(16).padStart(2,"0")).join("")})}function Y(V,A){let v=0,_=V.length;for(let G=0;G<_;G++)V[G]===A&&(V.splice(G,1),G--,_--,v++);return v}let $=W(),ae=$.WeakRef||(V=>V);function le(V){if(V!=null){if(typeof V=="object")return new ae(V);console.error(V,V instanceof Object,typeof V);return}}function ge(V){return V?.deref()}let Me;typeof window>"u"?Me=function(V){setTimeout(V,100)}:Me=$.requestAnimationFrame;let Je="_MSG_BUS_RPC_",Dt=5*60*1e3,rt=new s;function Wt(){let V=performance.now();for(;rt.size()>0;){let A=rt.getFirst();if(A.timeout<=V)rt.removeFirst(),A.reject("RPC Call Timed Out, topic is "+A.topic+" \u2764\u8BF7\u5B9A\u4F4D\u62A5\u9519\u2764");else break}Me(Wt)}Wt();var kr=(V=>(V.PUBLISH="publish",V.SUBSCRIBE="subscribe",V.PUSH="push",V.PULL="pull",V))(kr||{});class oe{constructor(A){this.bus=A}processRemoteMessage(A,v){let _=le(v),G=A.topic,K=A.type,re=A.message;switch(K){case"pull":this.bus.pull(G,fe=>{this.push(G,fe,ge(_))});break;case"subscribe":this.bus.subscribe(G,fe=>{this.publish(G,fe,ge(_))});break;case"publish":this.bus.publish(G,re,this,ge(_));break;case"push":this.bus.push(G,re,this,ge(_));break;default:console.warn("unknown message type "+K)}}rpcCall(A,v,_){let G=le(_);return new Promise((K,re)=>{let fe=rt.push({timeout:performance.now()+Dt,reject:re,topic:A}),Te=this.bus.uniqueRpcTopic(A);this.publish(A,{message:v,reply:Te},ge(G)),this.bus.pull(Te,(ar,kf,Vf)=>{K({message:ar,bridge:kf,source:le(Vf)}),rt.remove(fe)})})}}class ne extends oe{constructor(A,v){super(A),this.worker=v,v.onmessage=_=>{this.processRemoteMessage(_.data,void 0)}}publish(A,v){this.postMessage(A,"publish",v)}subscribe(A){this.postMessage(A,"subscribe",null)}push(A,v){this.postMessage(A,"push",v)}pull(A){this.postMessage(A,"pull",null)}rpcCall(A,v){return super.rpcCall(A,v,void 0)}postMessage(A,v,_){let G={topic:A,type:v,message:_};this.worker.postMessage(G)}discard(){this.worker.terminate()}}class pe extends oe{constructor(A){super(A),window.addEventListener("message",v=>{this.processRemoteMessage(v.data,v.source)},!1)}publish(A,v,_){this.postMessage(A,"publish",v,_)}subscribe(A,v){if(v===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(A,"subscribe",null,v)}push(A,v,_){this.postMessage(A,"push",v,_)}pull(A,v){if(v===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(A,"pull",null,v)}postMessage(A,v,_,G){let K={topic:A,type:v,message:_};G&&G.postMessage(K,"*")}}class Ce{constructor(A){this.isRunning=!0,this.callback=A}cancel(){this.isRunning=!1}running(){return this.isRunning}execute(A,v,_,G){try{A=G?A:d(A),this.callback(A,v,_)}catch(K){console.error(K)}}}class Oe{constructor(A=!1){this.subscribed={},this.pulled={},this.pushed={},this.rpcTicket=0,this.unsafe=A}uniqueRpcTopic(A){return A+Je+this.rpcTicket++}publish(A,v,_,G){let K=this.subscribed[A];if(K){let re;for(let fe of K)fe.running()?fe.execute(v,_,G,this.unsafe):(re=re||new Array,re.push(fe));if(re)for(let fe of re)Y(K,fe)}else console.debug("no sub on topic: "+A,"\u2764\u8BF7\u68C0\u67E5\u4EE3\u7801\u903B\u8F91\u2764")}subscribe(A,v){let _=new Ce(v);return p(this.subscribed,A).push(_),_}push(A,v,_,G){let K=!1,re=this.pulled[A];if(re){for(;re.length>0;){let fe=re.shift();if(fe.running()){fe.execute(v,_,G,this.unsafe),K=!0;break}}re.length===0&&delete this.pulled[A]}K||p(this.pushed,A).push({message:v,bridge:_,source:le(G)})}pull(A,v){let _=new Ce(v),G=this.pushed[A];if(G){let K=G.shift();_.execute(K.message,K.bridge,ge(K.source),this.unsafe),G.length===0&&delete this.pushed[A]}else p(this.pulled,A).push(_);return _}pullA(A){return new Promise(v=>{this.pull(A,(_,G,K)=>{v({message:_,bridge:G,source:le(K)})})})}rpcService(A,v){this.subscribe(A,(_,G,K)=>{let{message:re,reply:fe}=_;try{let Te=v(re);Te instanceof Promise?Te.then(ar=>{this.rpcReply(ar,fe,G,K)},ar=>{console.error(ar),this.rpcReply(void 0,fe,G,K)}):this.rpcReply(Te,fe,G,K)}catch(Te){console.error(Te),this.rpcReply(void 0,fe,G,K)}})}rpcCall(A,v){return new Promise((_,G)=>{let K=rt.push({timeout:performance.now()+Dt,reject:G,topic:A}),re=this.uniqueRpcTopic(A);this.publish(A,{message:v,reply:re}),this.pull(re,(fe,Te,ar)=>{_({message:fe,bridge:Te,source:le(ar)}),rt.remove(K)})})}rpcReply(A,v,_,G){_?_.push(v,A,G):this.push(v,A)}}var We=(V,A,v)=>new Promise((_,G)=>{var K=Te=>{try{fe(v.next(Te))}catch(ar){G(ar)}},re=Te=>{try{fe(v.throw(Te))}catch(ar){G(ar)}},fe=Te=>Te.done?_(Te.value):Promise.resolve(Te.value).then(K,re);fe((v=v.apply(V,A)).next())});let je="_MSG_BUS_RPC_";function Yi(V,A){let v=0,_=V.length;for(let G=0;G<_;G++)V[G]===A&&(V.splice(G,1),G--,_--,v++);return v}function tr(V,A){return Nf(V,A,()=>[])}function Nf(V,A,v){let _=V[A];return _!==void 0||(_=v(A),V[A]=_),_}class Ya{constructor(A,v){this.callback=A,this.unsafe=v,this.isRunning=!0}cancel(){this.isRunning=!1}running(){return this.isRunning}execute(A){return We(this,null,function*(){try{A=this.unsafe?A:d(A),this.callback(A)}catch(v){console.error(v)}})}}let Ef=Date.now()-performance.now(),vh=new ArrayBuffer(10),Bf=new Float64Array(vh,0,1),uu=new Uint8Array(vh),Nh=-1,hu=0;function cu(){let V=Ef+performance.now();return Bf[0]=V,V===Nh?hu++:(hu=0,Nh=V),uu[8]=Math.random()*1e3,uu[9]=hu,btoa(String.fromCharCode(...uu))}class Eh{constructor(A=cu()){this.uuid=A,this.rpcTicket=0}subscribeOnce(A,v){let _=this.subscribe(A,G=>{_.cancel(),v(G)});return _}pullA(A){return new Promise(v=>{this.pull(A,v)})}rpcService(A,v){let _=G=>{try{let{message:K,replyTopic:re}=G;try{let fe=v(K);fe instanceof Promise?fe.then(Te=>{this.publish(re,{success:!0,result:Te})}).catch(Te=>{console.error(Te),this.publish(re,{success:!1,err:String(Te)})}):this.publish(re,{success:!0,result:fe})}catch(fe){this.publish(re,{success:!1,err:String(fe)})}}finally{this.pull(A,_)}};this.pull(A,_)}rpcCall(A,v,_=0){let G=new Promise((K,re)=>{let fe=`${je}-${A}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce(fe,Te=>{Te.success?K(Te.result):re(new Error(Te.err))}),this.push(A,{message:v,replyTopic:fe})});return _>0?Promise.race([G,new Promise((K,re)=>{setTimeout(re,_)})]):G}}class _f extends Eh{constructor(A=!1){super(),this.unsafe=A,this.subscribed={},this.pulled={},this.pushed={}}publish(A,v){let _=this.subscribed[A];if(_){let G;for(let K of _)K.running()?K.execute(v):(G=G||new Array,G.push(K));if(G)for(let K of G)Yi(_,K)}}subscribe(A,v){let _=new Ya(v,this.unsafe);return tr(this.subscribed,A).push(_),_}push(A,v){let _=!1,G=this.pulled[A];if(G){for(;G.length>0;){let K=G.shift();if(K&&K.running()){K.execute(v),_=!0;break}}G.length===0&&delete this.pulled[A]}_||tr(this.pushed,A).push(v)}pull(A,v){let _=new Ya(v,this.unsafe);return this.repull(A,_),_}repull(A,v){let _=this.pushed[A];if(_){let G=_.shift();G&&(v.execute(G),_.length===0&&delete this.pushed[A])}else tr(this.pulled,A).push(v)}}class Of extends Eh{constructor(A=cu()){super(A),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(A,v){console.debug("BC",this.uuid,"PUBLISH",A,v),this.broadcastPublish(A,v)}subscribe(A,v){console.debug("BC",this.uuid,"SUBSCRIBE",A);let _=new Ya(v,!0);return tr(this.subscribed,A).push(_),_}push(A,v){let _=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",A,`(${_})`,v),tr(this.pushed,A).push({id:_,message:v}),this.broadcastPushedHeadMessage(A)}pull(A,v){console.debug("BC",this.uuid,"PULL",A);let _=new Ya(v,!0);return tr(this.pulled,A).push(_),this.broadcastWhoHas(A),_}broadcastPushedHeadMessage(A){let v=this.pushed[A];v&&v[0]&&this.broadcastIHave(A,v[0].id)}onReceivedPublish(A,v,_){console.debug("BCMSG(",this.uuid,")","from",A,"PUBLISH",v,"message",_);let G=this.subscribed[v];if(G){let K;for(let re of G)re.running()?re.execute(_):(K=K||new Array,K.push(re));if(K)for(let re of K)Yi(G,re);G.length===0&&delete this.subscribed[v]}}onReceivedWhoHas(A,v){console.debug("BCMSG(",this.uuid,")","from",A,"WHOHAS",v),this.broadcastPushedHeadMessage(v)}onReceivedIHave(A,v,_){console.debug("BCMSG(",this.uuid,")","from",A,"IHAVE",v,"id",_);let G=this.pulled[v];if(G){let K;for(let re of G)if(re.running()){this.broadcastINeed(v,A,_);break}else K=K||new Array,K.push(re);if(K)for(let re of K)Yi(G,re);G.length===0&&delete this.pulled[v]}}onReceivedINeed(A,v,_,G){if(console.debug("BCMSG(",this.uuid,")","from",A,"INEED",v,"source",_,"id",G),this.uuid===_){let K=this.pushed[v];if(K&&K[0]&&K[0].id===G){let{message:re}=K.shift();this.broadcastIGive(v,G,A,re),this.broadcastPushedHeadMessage(v),K.length===0&&delete this.pushed[v]}}}onReceivedIGive(A,v,_,G,K){console.debug("BCMSG(",this.uuid,")","from",A,"IGIVE",v,"id",_,"target",G,"message",K);let re=this.pulled[v];if(re&&this.uuid===G){let fe=!1;for(;re.length>0;){let Te=re.shift();if(Te.running()){Te.execute(K),fe=!0;break}}fe||this.push(v,K),re.length===0&&delete this.pulled[v]}}}class Df extends Of{constructor(A,v=cu()){super(v),this.bc=new BroadcastChannel(A),this.bc.onmessage=_=>{this.onMessage(_.data)}}onMessage(A){let{type:v,uuid:_,topic:G}=A;switch(v){case"PUBLISH":{let{message:K}=A;this.onReceivedPublish(_,G,K);break}case"WHOHAS":{this.onReceivedWhoHas(_,G);break}case"IHAVE":{let{id:K}=A;this.onReceivedIHave(_,G,K);break}case"INEED":{let{source:K,id:re}=A;this.onReceivedINeed(_,G,K,re);break}case"IGIVE":{let{target:K,id:re,message:fe}=A;this.onReceivedIGive(_,G,re,K,fe);break}default:console.warn("unsupported",A)}}broadcastPublish(A,v){this.post({type:"PUBLISH",uuid:this.uuid,topic:A,message:v})}broadcastWhoHas(A){this.post({type:"WHOHAS",uuid:this.uuid,topic:A})}broadcastIHave(A,v){this.post({type:"IHAVE",uuid:this.uuid,topic:A,id:v})}broadcastINeed(A,v,_){this.post({type:"INEED",uuid:this.uuid,topic:A,source:v,id:_})}broadcastIGive(A,v,_,G){this.post({type:"IGIVE",uuid:this.uuid,topic:A,id:v,target:_,message:G})}post(A){this.bc.postMessage(A),Promise.resolve().then(()=>{this.onMessage(A)})}}return t})())});var de=class{constructor(t,e,r){this.id=t,this.net=e,this.layer=r}};var du=(P=>(P[P.MIL=1]="MIL",P[P.INCH=1e3]="INCH",P[P.FT=12e3]="FT",P[P.YARD=36e3]="YARD",P[P.MILE=6336e4]="MILE",P[P.KM=3937007874e-2]="KM",P[P.M=39370]="M",P[P.DM=3937]="DM",P[P.CM=393.7]="CM",P[P.MM=39.37]="MM",P[P.UM=.039]="UM",P[P.NM=394e-7]="NM",P[P.PT=13.88888888888889]="PT",P[P.PX72=13.88888888888889]="PX72",P[P.PX96=10.416666666666666]="PX96",P[P.PX100=10]="PX100",P[P.LTSPICE=6.25]="LTSPICE",P[P.PX1=.1]="PX1",P[P.PX001=.001]="PX001",P))(du||{}),Jr=(g=>(g.MIL="mil",g.INCH="inch",g.FT="ft",g.YARD="yard",g.MILE="mile",g.KM="km",g.M="m",g.DM="dm",g.CM="cm",g.MM="mm",g.UM="um",g.NM="nm",g.PT="pt",g.PX72="px(72)",g.PX96="px(96)",g.PX100="px(100)",g))(Jr||{}),pu={["mil"]:1,["inch"]:1e3,["ft"]:12e3,["yard"]:36e3,["mile"]:6336e4,["km"]:3937007874e-2,["dm"]:3937,["mm"]:39.37,["um"]:.039,["nm"]:394e-7,["pt"]:13.88888888888889,["px(72)"]:13.88888888888889,["px(96)"]:10.416666666666666,["px(100)"]:10},Zf=(()=>{let a={};for(let t in pu)a[pu[t]]=t;return a})();function Km(a,t){return Zf[a]||t}function Zm(a,t){return pu[a]||t}var mu=class{constructor(t,e){this.ratio=t/e}wrap(t){return t*this.ratio}static convert(t,e,r){return t*e/r}},Rn=mu;Rn.ASIS=new mu(1,1);var Ht=class{conversion(t,e,r){if(t===e)return r;let i=t+2+e;return this[i](r)}conversion1(t,e,r){let i=t+2+e,n=this[i](r);return e=="mil"?Math.round(n*10)/10:Math.round(n*1e3)/1e3}mil2mil(t){return t}mil2mm(t){return t*.0254}mil2cm(t){return t*.00254}mil2inch(t){return t/1e3}mm2mm(t){return t}mm2mil(t){let e=Math.pow(10,5);return Math.round(t*39.37007874015748*e)/e}mm2cm(t){return t/10}mm2inch(t){let e=Math.pow(10,8);return Math.round(t*.03937007874015748*e)/e}cm2mil(t){let e=Math.pow(10,6);return Math.round(t*393.7007874015748*e)/e}cm2mm(t){return t*10}cm2inch(t){let e=Math.pow(10,7);return Math.round(t*.3937007874015748*e)/e}inch2mil(t){return t*1e3}inch2mm(t){return t*25.4}inch2cm(t){return t*2.54}};Ht.prototype["px(100)2mil"]=a=>a*10,Ht.prototype["px(100)2mm"]=a=>a*.254,Ht.prototype["mil2px(100)"]=a=>a/10,Ht.prototype["mm2px(100)"]=a=>{let t=Math.pow(10,5);return Math.round(a*3.937007874015748*t)/t};var qa=null,bu=new ArrayBuffer(8),gu=new Float64Array(bu),yu=new Uint32Array(bu),kh=new Uint16Array(bu);function ie(a,t,e=0,r=a.length){i(a,null,t,e,r);function i(s,o,l,u,h){let c,f,d,p;if(u<h-1){let m=h-u;if(m>50)o===null&&(o=new Array(m+1)),n(s,o,l,u,(u+h)/2|0,h);else{c=s[u],f=u,d=u,p=h;let g=f+1;for(;g<p;){if(d!=p){if(p=p+-1,l(c,s[p])<=0)continue;s[d]=s[p],d=p;continue}if(l(c,s[g])>=0){f=g,g=f+1;continue}s[d]=s[g],f=g,d=g,g=f+1}s[d]=c,i(s,o,l,u,d),i(s,o,l,d+1,h)}}}function n(s,o,l,u,h,c){i(s,o,l,u,h),i(s,o,l,h,c);for(var f=u,d=h,p=0,m=s[f],g=s[d];f<h&&d<c;){var x=l(m,g);isNaN(x)?(o[p++]=g,g=s[++d]):(x<=0&&(o[p++]=m,m=s[++f]),x>=0&&(o[p++]=g,g=s[++d]))}for(;f<h;f++)o[p++]=s[f];for(;d<c;d++)o[p++]=s[d];for(f=u,d=0;d<p;f++,d++)s[f]=o[d]}}var F=class{static repeat(t,e){let r=new Array(e);for(;e-- >0;)r[e]=t;return r.join("")}static lpad(t,e,r){let i=r-t.length;return i>0?this.repeat(e,i)+t:t}static rpad(t,e,r){let i=r-t.length;return i>0?t+this.repeat(e,i):t}static strHashcode(t){if(t.length>0){let e=0;for(let r=0;r<t.length;r++)e=31*e+t.charCodeAt(r)|0;return e}else return 0}static arraycopy(t,e,r,i,n){if(t.length>=e+n&&r.length>=i+n)for(;n-- >0;)r[i++]=t[e++];else throw new Error("arraycopy out of range")}static undefAsNull(t){return null}static reverse(t,e){for(let r=0,i=t.length-1;i>=0;r++,i--)e[r]=t[i];return e}static sortAsc(t,e){return t-e}static xmlDecode(t){let e=t.length,r=new Array,i=-1;for(let n=0;n<e;n++){let s=t.charAt(n);if(i>=0){if(s===";"){let o=t.substring(i+1,n);switch(o){case"lt":r.push("<");break;case"gt":r.push(">");break;case"quot":r.push('"');break;case"apos":r.push("'");break;case"amp":r.push("&");break;default:if(o.charAt(0)==="#"){let l=parseInt(o.substring(1));r.push(String.fromCharCode(l))}else r.push("&"+o+";")}i=-1}}else s==="&"?i=n:r.push(s)}return i>=0&&r.push(t.substring(i)),r.join("")}static addAll(t,e){for(let r of e)t.push(r)}static addAllSet(t,e){for(let r of e)t.add(r)}static contains(t,e){for(let r of t)if(r.equals(e))return!0;return!1}static equals(t,e){if(t.length==e.length){for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}else return!1}static remove(t,e){let r=0,i=t.length;for(let n=0;n<i;n++)t[n]===e&&(t.splice(n,1),n--,i--,r++);return r}static getUrlVars(){for(var t={},e=location.href.slice(location.href.indexOf("?")+1).split("&"),r=0;r<e.length;r++){var i=e[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}static prefix(){if(!qa){let t=this.getUrlVars().version;t?qa="/analyzer/v"+t:qa="/analyzer"}return qa}static add2objS(t,e,r){if(e in t)return t[e];{let i=r(e);return t[e]=i,i}}static downloadFile(t,e){let r=document.createElement("a"),i=URL.createObjectURL(e);r.download=t,r.href=i,r.click(),URL.revokeObjectURL(i)}static uuid(){let t=new Array;gu[0]=new Date().getTime(),t.push(yu[1].toString(16)),gu[0]=Math.random(),t.push(kh[3].toString(16));let e=kh[2].toString(16);t.push("4"+e.substr(0,3)),gu[0]=performance.now();let r=yu[0].toString(16)+yu[1].toString(16);return t.push("0"+r.substr(0,3)),t.push(r.substr(3)),t.join("-")}static funcCopy(t){return(0,eval)("("+t.toString()+")")}static NVL(...t){for(let e of t)if(e!==null)return e;return null}static isSingle(t){return Array.from(new Set(t)).length===t.length}},jf=[1,10,100,1e3];function ei(a){return typeof a=="number"&&!isNaN(a)}function Nn(a){return new Ht().conversion("mm","mil",a)}function nb(a,t,e){if(ei(t)&&ei(t)&&t>e)throw new Error("error params: min > max");return ei(t)&&a<t?{check:!1,value:t}:ei(e)&&a>e?{check:!1,value:e}:{check:!0,value:a}}var Xa=0,vn=0;function xu(a,t,e){return Xa=Math.abs(a-t),e>=5&&Xa>1e-5||isNaN(e)&&Xa>1e-8?!1:Xa<1e-13?!0:(vn=Math.min(Vh(a),Vh(t)),vn<10&&(vn=10),isNaN(e)||(vn=Math.min(vn,e)),Uh(a,vn)===Uh(t,vn))}var Ka=0,Za=0;function Vh(a){return Ka=0,Za=0,a>0?Ka=a-Math.floor(a):Ka=a-Math.ceil(a),Za=(Ka.toString()||"").length,Za>2?Za-2:0}function Uh(a,t,e){if(typeof a!="number"&&(a=+a),isNaN(a))return NaN;if(t=t|0,t<=0||!a&&!e)return Math.round(a);var r=jf[t]||Math.pow(10,t)||10;if(e){var i=a<0?"-":"";for(a=a<0?-a:a,a=Math.round(a*r)+"";a.length<=t;)a="0"+a;return a=a.slice(0,-t)+"."+a.slice(-t),parseFloat(i+a)}else return Math.round(a*r+1e-10)/r}var Fh=class{constructor(t){this.resources=t,this.idle=[]}acquire(t){this.resources>0?(this.resources--,t()):this.idle.push(t)}acquire1(t){return this.resources>0?(this.resources--,t()):this.acquireSync().then(t)}acquireSync(){return new Promise(t=>{this.acquire(t)})}release(){let t=this.idle.shift();t?Promise.resolve().then(t):this.resources++}getWaitingNum(){return this.idle.length}};var Qf=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.PERCENT=1]="PERCENT",r[r.LEFT_PAD0=2]="LEFT_PAD0",r))(Qf||{}),$f=/(\.?0+)$/,Pe=class{static format(t,...e){return this.format1(t,e)}static format1(t,e){let r=this._format(t,e);if(typeof r=="string")return r;throw new Error(this.format("Invalid state on (%d) %s",r,t))}static _format(t,e){let r=[],i=0,n=0,s,o=0,l=0;for(let u=0;u<t.length;u++){let h=t.charAt(u),c=h.charCodeAt(0);switch(i){case 0:c===37?i=1:r.push(h);break;case 1:switch(c){case 100:if(s=e[n++],typeof s=="number")r.push(s.toFixed(0)),i=0;else return u;break;case 102:if(s=e[n++],typeof s=="number")r.push(s.toString()),i=0;else return u;break;case 120:if(s=e[n++],typeof s=="number")r.push((s|0).toString(16)),i=0;else return u;break;case 88:if(s=e[n++],typeof s=="number")r.push((s|0).toString(16).toUpperCase()),i=0;else return u;break;case 115:case 99:s=e[n++],r.push(s===null?"null":s.toString()),i=0;break;case 48:o=u+1,l=-1,i=2;break;case 37:r.push("%"),i=0;break;default:return u}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:l=u;break;case 120:if(l>=o){let f=parseInt(t.substring(o,l+1));if(s=e[n++],typeof s=="number")r.push(F.lpad((s|0).toString(16),"0",f)),i=0;else return u}else return u;break;case 88:if(l>=o){let f=parseInt(t.substring(o,l+1));if(s=e[n++],typeof s=="number")r.push(F.lpad((s|0).toString(16).toUpperCase(),"0",f)),i=0;else return u}else return u;break;default:return u}break;default:return u}}return r.join("")}static startsWith(t,e){return t.length>=e.length?t.substring(0,e.length)===e:!1}static endsWith(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}static split(t,e){let r=new Array,i=0;for(;;){let n=t.exec(e);if(n!==null){let s=t.lastIndex-n[0].length;r.push(e.substring(i,s)),i=t.lastIndex}else{let s=e.substring(i);D.nullOrEmpty(s)||r.push(s);break}}return r}static fmtNumber(t){return t.toFixed(5).replace($f,"")}};var D=class{static rgb(t){if(0<=t&&t<=255)return t;throw new Error(Pe.format("RGB should not nagative and not over 255(0xFF): %X",t))}static normal(t){if(isFinite(t))return t;throw new Error(Pe.format("%f is not permitted",t))}static positiveOr0(t){if(t>=0)return t;throw new Error(Pe.format("%f must >= 0",t))}static positive(t){if(t>0)return t;throw new Error(Pe.format("%f must > 0",t))}static notnull(t){if(t!=null)return t;throw new Error("invalid null value")}static mustnull(t){if(t===null)return null;throw new Error("value must be null")}static notEmpty(t){if(t==null||t.length===0)throw new Error("invalid empty string");return t}static nullOrEmpty(t){return t==null||t.length===0}static notNullOrUndef(t){if(t!=null)return t;throw new Error("null or undefined is not permitted")}};var N=class{static regular(t){return Math.round(t*this.precision)/this.precision}static eq(t,e){return Math.abs(t-e)<=this.eps}static neq(t,e){return Math.abs(t-e)>this.eps}static less(t,e){return t-e<-this.eps}static lesseq(t,e){return t-e<this.eps}static greater(t,e){return t-e>this.eps}static greatereq(t,e){return t-e>-this.eps}static sqrt(t){return Math.abs(t)<=1e-10?0:Math.sqrt(t)}static sortAsc(t,e){return t-e}static sortDesc(t,e){return e-t}};N.eps=1e-8,N.precision=1e8;function dr(a,t){Xi(a.iterator(),t)}function Xi(a,t){let e=0;for(;a.hasNext();){let r=a.next();t(e++,r)}}var Su=class{constructor(t){this.lst=t}iterator(){return new ja(this.lst)}},ja=class{constructor(t){this.idx=-1;this.lst=t}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function pb(a){return new Su(a)}function Ir(a){return new ja(a)}var mr=class{static toDegrees(t){return t*180/Math.PI}static toRadians(t){return t/180*Math.PI}static regularD(t){return t=t%360,t=t<0?360+t:t,t===360?0:t}static regular(t){return t=t%mr.PIx2,t=t<0?mr.PIx2+t:t,t===mr.PIx2?0:t}static toQuarterBase(t){return mr.regular((t+mr.PI_4)/mr.PI_2*mr.PI_2)}static toQuarterBaseD(t){return mr.regularD(((t+45)/90|0)*90)}static transformD(t,e){return mr.toDegrees(mr.transform(mr.toRadians(t),e))}static transform(t,e){let r=Math.cos(t),i=Math.sin(t),n=new b(e.data[6],e.data[7]),s=new b(r,i).multiply3(e);return mr.regular(s.angle(n))}},J=mr;J.PIx2=Math.PI*2,J.PI_2=Math.PI/2,J.PI_4=Math.PI/4;var it=class{static dotProd1(t,e,r,i){return t*r+e*i}static dotProd2(t,e,r,i,n,s){return this.dotProd1(r-t,i-e,n-r,s-i)}static dotProd3(t,e,r){return this.dotProd2(t.x,t.y,e.x,e.y,r.x,r.y)}static crossProd1(t,e,r,i){return t*i-e*r}static crossProd2(t,e,r,i,n,s){return this.crossProd1(r-t,i-e,n-r,s-i)}static crossProd3(t,e,r){return this.crossProd2(t.x,t.y,e.x,e.y,r.x,r.y)}static distance2(t,e,r,i){let n=r-t,s=i-e;return n*n+s*s}static distance1(t,e,r,i){return this.hypot(r-t,i-e)}static distance1p(t,e){return this.distance1(t.x,t.y,e.x,e.y)}static hypot(t,e){if(t=Math.abs(t),e=Math.abs(e),e>t){var r=e;e=t,t=r}if(t===0)return e;var i=e/t;return t*Math.sqrt(1+i*i)}};var Gh=new ArrayBuffer(16),Wh=new Float64Array(Gh),Qa=new Int32Array(Gh),qe=class{static sortByXAsc(t,e){return t.x-e.x}static sortByYAsc(t,e){return t.y-e.y}static sortByXYAsc(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y-e.y}static caculateAngle(t,e){let r=Math.cos(t),i=Math.sin(t),n=r*e.data[0]+i*e.data[4],s=r*e.data[1]+i*e.data[5],o=new qe(n,s).normalize();return Math.atan2(o.y,o.x)}static normal(t,e,r){let i=e.sub(t),n=r.sub(e);return i.cross(n)}static getVector2(t){return new qe(Math.cos(t),Math.sin(t))}constructor(t,e){this.x=D.normal(t),this.y=D.normal(e)}get hashed(){return this._hashed==null&&(Wh[0]=this.x,Wh[1]=this.y,this._hashed=Qa[0]^Qa[1]^Qa[2]^Qa[3]),this._hashed}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.sqrt(this.dot(this))}getCos(){return this.x/this.length()}sub(t){var e=this.x-t.x,r=this.y-t.y;return new qe(e,r)}add(t){var e=this.x+t.x,r=this.y+t.y;return new qe(e,r)}add1(t,e){return new qe(this.x+t,this.y+e)}mul(t){return new qe(this.x*t,this.y*t)}cross(t){return this.x*t.y-this.y*t.x}getSin(){return this.y/this.length()}angle(t){return Math.atan2(this.y-t.y,this.x-t.x)}angleX(t=qe.ORIGIN){let e=this.angle(t);return e<0&&(e=Math.PI*2+e),e}angleD(t){return J.toDegrees(this.angle(t))}distance1(t){let e=t.x-this.x,r=t.y-this.y;return it.hypot(e,r)}distance2(t){let e=t.x-this.x,r=t.y-this.y;return e*e+r*r}rotateD(t,e){return this.rotate(t,J.toRadians(e))}rotate(t,e){let r=Math.cos(e),i=Math.sin(e),n=this.x-t.x,s=this.y-t.y,o=n*r+s*-i,l=n*i+s*r;return t.add1(o,l)}multiply3(t){let e=this.x*t.data[0]+this.y*t.data[3]+t.data[6],r=this.x*t.data[1]+this.y*t.data[4]+t.data[7];return new qe(e,r)}multiply4(t){let e=this.x*t.data[0]+this.y*t.data[4]+t.data[12],r=this.x*t.data[1]+this.y*t.data[5]+t.data[13];return new qe(e,r)}hashCode(){return this.hashed}equals(t,e){return t instanceof qe?xu(t.x,this.x,e)&&xu(t.y,this.y,e):!1}equals1(t,e=.5){return N.eq(this.x,t.x)&&N.eq(this.y,t.y)}similarEquals(t,e=.5){return Math.abs(this.x*.1-t.x*.1)<=e&&Math.abs(this.y*.1-t.y*.1)<=e}toString(){return"Vector [X="+this.x+", Y="+this.y+"]"}bbox(){let t=this.x,e=this.y;return new j(t,t,e,e)}normalize(){if(this.x===0&&this.y===0)return new qe(0,0);let t=this.x/this.length(),e=this.y/this.length();return new qe(t,e)}mirrorX(t=qe.ORIGIN){return new qe(this.x,2*t.y-this.y)}mirrorY(t=qe.ORIGIN){return new qe(2*t.x-this.x,this.y)}mirrorCenter(t=qe.ORIGIN){return new qe(2*t.x-this.x,2*t.y-this.y)}clone(){return new qe(this.x,this.y)}mirror(t){return t||(t=qe.ORIGIN),new qe(2*t.x-this.x,this.y)}pointOnRays(t,e){let r=J.toRadians(t);return new qe(this.x+Math.cos(r)*e,this.y+Math.sin(r)*e)}pointOnRays2(t,e){let r=t.angle(this);return new qe(this.x+Math.cos(r)*e,this.y+Math.sin(r)*e)}scale(t){return new qe(this.x*t,this.y*t)}},b=qe;b.ORIGIN=new qe(0,0),b.X_UNIT_VECTOR=new qe(1,0),b.Y_UNIT_VECTOR=new qe(0,1);var Jf=(r=>(r[r.LEFT=0]="LEFT",r[r.CENTER=1]="CENTER",r[r.RIGHT=2]="RIGHT",r))(Jf||{}),ep=(r=>(r[r.TOP=0]="TOP",r[r.CENTER=1]="CENTER",r[r.BOTTOM=2]="BOTTOM",r))(ep||{}),ti=class{constructor(t,e){this.horizontal=t,this.vertical=e}},Rt=ti;Rt.LT=new ti(0,0),Rt.LC=new ti(0,1),Rt.LB=new ti(0,2),Rt.CT=new ti(1,0),Rt.CC=new ti(1,1),Rt.CB=new ti(1,2),Rt.RT=new ti(2,0),Rt.RC=new ti(2,1),Rt.RB=new ti(2,2);var tp=(o=>(o[o.INNER=0]="INNER",o[o.OUTER=1]="OUTER",o[o.SEPARATED=2]="SEPARATED",o[o.INTERSECTED=3]="INTERSECTED",o[o.EQ=4]="EQ",o[o.INSIDE_TOUCHED=5]="INSIDE_TOUCHED",o[o.OUTSIDE_TOUCHED=6]="OUTSIDE_TOUCHED",o))(tp||{}),H=class{constructor(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}ext1(t){return this.minX=Math.min(this.minX,t.minX),this.maxX=Math.max(this.maxX,t.maxX),this.minY=Math.min(this.minY,t.minY),this.maxY=Math.max(this.maxY,t.maxY),this}ext2(t){return this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y),this}ext3(t){for(let e=0;e<t.length;e++){let r=t[e];this.ext2(r)}return this}ext4(t){return dr(t,(e,r)=>(this.ext2(r),!0)),this}ext5(t,e,r,i){return this.minX=Math.min(this.minX,t),this.maxX=Math.max(this.maxX,e),this.minY=Math.min(this.minY,r),this.maxY=Math.max(this.maxY,i),this}ext6(t,e){return this.minX=Math.min(this.minX,t),this.maxX=Math.max(this.maxX,t),this.minY=Math.min(this.minY,e),this.maxY=Math.max(this.maxY,e),this}ext7(t){if(t<0){let e=t*2;if(e<this.minX-this.maxX||e<this.minY-this.maxY)throw new Error("")}return this.minX-=t,this.maxX+=t,this.minY-=t,this.maxY+=t,this}valid(){return isFinite(this.minX)&&isFinite(this.maxX)&&isFinite(this.minY)&&isFinite(this.maxY)}clear(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}build(){return this.valid()?new j(this.minX,this.maxX,this.minY,this.maxY):new j(0,0,0,0)}},ma=new Float64Array(4),j=class{static extend1(t,e){if(t===null)return new j(e.x,e.x,e.y,e.y);{let r=Math.min(t.minX,e.x),i=Math.max(t.maxX,e.x),n=Math.min(t.minY,e.y),s=Math.max(t.maxY,e.y);return new j(r,i,n,s)}}static extend2(t,e){if(t){let r=Math.min(t.minX,e.minX),i=Math.max(t.maxX,e.maxX),n=Math.min(t.minY,e.minY),s=Math.max(t.maxY,e.maxY);return new j(r,i,n,s)}else return e}static extend3(t,e){let r=Math.min(t.x,e.x),i=Math.max(t.x,e.x),n=Math.min(t.y,e.y),s=Math.max(t.y,e.y);return new j(r,i,n,s)}static extend4(t,e,r){let i=t.add1(-e/2,-r/2),n=t.add1(e/2,r/2);return j.extend3(i,n)}constructor(t,e,r,i){this.minX=D.normal(t),this.maxX=D.normal(e),this.minY=D.normal(r),this.maxY=D.normal(i)}get data(){return ma[0]=this.minX,ma[1]=this.maxX,ma[2]=this.minY,ma[3]=this.maxY,ma}isContains(t){return this.isContains1(t.x,t.y)}isContains1(t,e){return this.isContainsX(t)&&this.isContainsY(e)}isContains2(t,e){return this.isContainsX1(t)&&this.isContainsY1(e)}isContainsX(t){return t>=this.minX&&t<=this.maxX}isContainsX1(t){return N.greatereq(t,this.minX)&&N.lesseq(t,this.maxX)}isContainsY(t){return t>=this.minY&&t<=this.maxY}isContainsY1(t){return N.greatereq(t,this.minY)&&N.lesseq(t,this.maxY)}isIntersect(t){let e=Math.max(this.minX,t.minX),r=Math.min(this.maxX,t.maxX);if(e>r)return!1;let i=Math.max(this.minY,t.minY),n=Math.min(this.maxY,t.maxY);return!(i>n)}extendOfSize(t){return D.positiveOr0(this.maxX-this.minX+t*2),D.positiveOr0(this.maxY-this.minY+t*2),new j(this.minX-t,this.maxX+t,this.minY-t,this.maxY+t)}isInside(t){return this.minX>=t.minX&&this.maxX<=t.maxX&&this.minY>=t.minY&&this.maxY<=t.maxY}isContainsBBox(t){return this.maxX>=t.maxX&&this.minX<=t.minX&&this.maxY>=t.maxY&&this.minY<=t.minY}isContainsBBox1(t){return N.greatereq(this.maxX,t.maxX)&&N.lesseq(this.minX,t.minX)&&N.greatereq(this.maxY,t.maxY)&&N.lesseq(this.minY,t.minY)}intersection1(t){let e=Math.max(this.minX,t.minX),r=Math.min(this.maxX,t.maxX);if(N.greater(e,r))return null;e>r&&(r=e);let i=Math.max(this.minY,t.minY),n=Math.min(this.maxY,t.maxY);return N.greater(i,n)?null:(i>n&&(n=i),new j(e,r,i,n))}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}UL(){return new b(this.minX,this.maxY)}UR(){return new b(this.maxX,this.maxY)}LL(){return new b(this.minX,this.minY)}LR(){return new b(this.maxX,this.minY)}center(){return new b(this.maxX-(this.maxX-this.minX)/2,this.maxY-(this.maxY-this.minY)/2)}area(){return this.width()*this.height()}transform(t){let e=new H;return e.ext2(this.LL().multiply3(t)),e.ext2(this.LR().multiply3(t)),e.ext2(this.UR().multiply3(t)),e.ext2(this.UL().multiply3(t)),e.build()}isSeparated(t){if(t==null||t==null)return!1;let e;this.minX>=t.minX?e=this.minX:e=t.minX;let r;if(this.maxX<=t.maxX?r=this.maxX:r=t.maxX,e>r)return!0;{let i;this.minY>=t.minY?i=this.minY:i=t.minY;let n;return this.maxY<=t.maxY?n=this.maxY:n=t.maxY,i>n}}relation(t){let e=0,r=0,i;this.minX>t.minX?(e++,i=this.minX):this.minX===t.minX?i=this.minX:(r++,i=t.minX);let n;if(this.maxX<t.maxX?(e++,n=this.maxX):this.maxX===t.maxX?n=this.maxX:(r++,n=t.maxX),i>n)return 2;{let s;this.minY>t.minY?(e++,s=this.minY):this.minY===t.minY?s=this.minY:(r++,s=t.minY);let o;return this.maxY<t.maxY?(e++,o=this.maxY):this.maxY===t.maxY?o=this.maxY:(r++,o=t.maxY),s>o?2:e===4?0:r===4?1:e===0&&r===0?4:i===n||s===o?6:e!==r?5:3}}zoom(t){let e=this.width(),r=this.height(),i=this.center();return t!=0&&(e/=t/2,r/=t/2),new j(i.x-e,i.x+e,i.y-e,i.y+e)}toString(){return"BBox [minX="+this.minX+", maxX="+this.maxX+", minY="+this.minY+", maxY="+this.maxY+"]"}equals(t){return this.minY==t.minY&&this.minX==t.minX&&this.maxX==t.maxX&&this.maxY==t.maxY}extendSize(t,e){return Object.is(void 0,e)&&(e=t),j.extend4(this.center(),this.width()+t,this.height()+e)}positionOnBBox(t,e=0){let r=this.center(),i=this.width()*e/2,n=this.height()*e/2,s=t.x-r.x,o=t.y-r.y;return s>i?o>n?Rt.RT:o<-n?Rt.RB:Rt.RC:s<-i?o>n?Rt.LT:o<-n?Rt.LB:Rt.LC:o>n?Rt.CT:o<-n?Rt.CB:Rt.CC}};var kt=(w=>(w[w.MULTI=0]="MULTI",w[w.TOP_SILK=1]="TOP_SILK",w[w.TOP_SOLDER_MASK=2]="TOP_SOLDER_MASK",w[w.TOP_PASTE=3]="TOP_PASTE",w[w.TOP_COPPER=4]="TOP_COPPER",w[w.INNER=5]="INNER",w[w.PLANE=6]="PLANE",w[w.BOT_COPPER=7]="BOT_COPPER",w[w.BOT_PASTE=8]="BOT_PASTE",w[w.BOT_SOLDER_MASK=9]="BOT_SOLDER_MASK",w[w.BOT_SILK=10]="BOT_SILK",w[w.OUTLINE=11]="OUTLINE",w[w.DOCUMENT=12]="DOCUMENT",w[w.MECHANICAL=13]="MECHANICAL",w[w.RATELINE=14]="RATELINE",w[w.MODEL=15]="MODEL",w[w.OTHER=16]="OTHER",w[w.COMPONENT_SHAPE=17]="COMPONENT_SHAPE",w[w.PIN_FLOATING=18]="PIN_FLOATING",w[w.COMPONENT_MARKING=19]="COMPONENT_MARKING",w[w.DRILL_DRAWING=20]="DRILL_DRAWING",w))(kt||{}),Hh=a=>{switch(a){case 0:return"MULTI";case 1:return"TOP_SILK";case 2:return"TOP_SOLDER_MASK";case 3:return"TOP_PASTE";case 4:return"TOP_COPPER";case 5:return"INNER";case 6:return"PLANE";case 7:return"BOT_COPPER";case 8:return"BOT_PASTE";case 9:return"BOT_SOLDER_MASK";case 10:return"BOT_SILK";case 11:return"OUTLINE";case 12:return"DOCUMENT";case 13:return"MECHANICAL";case 14:return"RATELINE";case 15:return"MODEL";case 16:return"OTHER"}},rr=class{static isTop(t){switch(t){case 4:case 3:case 2:case 1:return!0;default:return!1}}static isBot(t){switch(t){case 7:case 8:case 9:case 10:return!0;default:return!1}}constructor(t,e){this._resetLayer(t,e)}_resetLayer(t,e){switch(this.type=t,t){case 5:case 13:case 6:this.order=D.positive(e);break;default:if(e===0)this.order=e;else throw new Error(Pe.format("layer type %s order must eq 0, not %d",t,e))}this.setHash()}setHash(){this.hashed=32*(32+this.type)+this.order}hashCode(){return this.hashed}toString(){return"PcbLayer [type="+this.type+", order="+this.order+"]"}equals(t){return t instanceof rr?this.type===t.type&&this.order===t.order:!1}},I=rr;I.MULTI=new rr(0,0),I.TOP_SILK=new rr(1,0),I.TOP_SOLDER_MASK=new rr(2,0),I.TOP_PASTE=new rr(3,0),I.TOP_COPPER=new rr(4,0),I.BOT_COPPER=new rr(7,0),I.BOT_PASTE=new rr(8,0),I.BOT_SOLDER_MASK=new rr(9,0),I.BOT_SILK=new rr(10,0),I.OUTLINE=new rr(11,0),I.DOCUMENT=new rr(12,0),I.RATELINE=new rr(14,0),I.OTHER=new rr(16,0);var He=class{static mul(t,e,r,i,n,s){let o=0,l=0;for(let u=0;u<t;u++){for(let h=0;h<r;h++){let c=h,f=0;for(let d=0;d<e;d++)f+=i[l+d]*n[c],c+=r;s[o++]=f}l+=e}}constructor(t,e,r){this.m=D.normal(t),this.n=D.normal(e);let i=t*e;if(r.length===i){for(let n=0;n<r.length;n++)D.normal(r[n]);this.data=r}else throw new Error("invalid matrix size")}mul(t){if(this.n===t.m){let e=new Array(this.m*t.n);return He.mul(this.m,this.n,t.n,this.data,t.data,e),new He(this.m,t.n,e)}else throw new Error("m !== p")}toString(){let t=[];t.push("Matrix ("),t.push(this.m.toString()),t.push(" x "),t.push(this.n.toString()),t.push(")");let e=0;for(let r=0;r<this.m;r++)for(let i=0;i<this.n;i++){let n=this.data[e++].toString();i===0?(t.push(`
`),t.push("	"),t.push(n)):(t.push(", "),t.push(n))}return t.join("")}static on(t,e,r){return t*e+r}initExpandMatrix(t){let e=this.m,r=this.n,i=r*2,n=new Array(e*i);for(let s=0;s<e;s++)for(let o=0;o<i;o++)o<r?n[He.on(i,s,o)]=t[He.on(r,s,o)]:o===e+s?n[He.on(i,s,o)]=1:n[He.on(i,s,o)]=0;return n}inverseMatrix(t,e,r){for(let i=0;i<e;i++){let n=t[He.on(r,i,i)];for(let s=0;s<r;s++)t[He.on(r,i,s)]/=n}return t}getMatrixRank(t,e,r){let i=Math.min(e,r);for(let n=0;n<e;n++){if(t[He.on(r,n,n)]===0){let s=new Array(r),o;for(o=n;o<e;o++)if(t[He.on(r,o,n)]!==0){F.arraycopy(t,He.on(r,o,0),s,0,r),F.arraycopy(t,He.on(r,n,0),t,He.on(r,o,0),r),F.arraycopy(s,0,t,He.on(r,n,0),r);break}o>=e&&(i-=1)}if(!(i<e))for(let s=0;s<e;s++){if(s===n)continue;let o=t[He.on(r,s,n)]/t[He.on(r,n,n)];for(let l=0;l<r;l++)t[He.on(r,s,l)]-=t[He.on(r,n,l)]*o}}return i}getInverseMatrix(){let t=this.data.slice(0);if(this.m!==this.n)throw new Error("The matrix is an "+this.m+"x"+this.n+" order matrix, non-square matrix, please check!");let e=this.n*2,r=this.initExpandMatrix(t),i=(s=>{let o=[];for(;s-- >0;)o.push(0);return o})(this.m*this.n),n=this.getMatrixRank(r,this.m,e);if(n!==this.m)throw new Error("The ranks of the matrix is "+n+", a non-full rank matrix, please check!");r=this.inverseMatrix(r,this.m,e);for(let s=0;s<this.m;s++)for(let o=this.n;o<e;o++)i[He.on(this.n,s,o-this.n)]=r[He.on(e,s,o)];return new He(this.m,this.n,i)}hashCode(){let t=0;for(let e of this.data)t+=e;return t}equals(t){return this===t?!0:t===null?!1:t instanceof me?!(this.m!=t.m||this.n!=t.n||!F.equals(this.data,t.data)):!1}};var oi=class{static of(t){return new oi(t>>16&255,t>>8&255,t&255)}constructor(t,e,r){this.R=t,this.G=e,this.B=r,this.hashed=31*(31*t+e)+r}toString(){return Pe.format("#%02X%02X%02X",this.R,this.G,this.B)}hashCode(){return this.hashed}equals(t){return t instanceof oi?t.R===this.R&&t.G===this.G&&t.B===this.B:!1}},Cr=oi;Cr.BLACK=oi.of(0),Cr.WHITE=oi.of(16777215),Cr.RED=oi.of(16711680),Cr.GREEN=oi.of(65280),Cr.BLUE=oi.of(255),Cr.YELLOW=oi.of(16776960);var Lg="EasyEDA",Mg=/[^\-\d.]+/g,rp=/#([a-z0-9]{3,6})/i,ip=new Rn(13.88888888888889,10);function Ag(a){return D.normal(parseInt(a))}function Vr(a){return D.normal(parseFloat(a))}function Ig(a){let t=rp.exec(a);if(t!==null){let e=t[1];if(e.length===3){let r=parseInt(F.repeat(e.charAt(0),2),16),i=parseInt(F.repeat(e.charAt(1),2),16),n=parseInt(F.repeat(e.charAt(2),2),16);return new Cr(r,i,n)}else{if(e.length===6)return Cr.of(parseInt(e,16));throw new Error("invalid color format")}}else return null}function Cg(a){return Pe.endsWith(a,"pt")?ip.wrap(Vr(a.substring(0,a.length-2))):Pe.endsWith(a,"px")?Vr(a.substring(0,a.length-2)):Vr(a)}function Tg(a,t){return new b(Vr(a),-Vr(t))}var zh=class{constructor(t,e,r){this.bbox=new H;this.decoder=t,this.sourceName=e,this.logger=r}fontWeightVal(t){switch(t){case"normal":case"lighter":return 200;case"bold":case"bolder":return 600;default:try{return Vr(t)}catch(e){return this.logger.warning1(e.message),200}}}};var np=[1,0,0,0,1,0,0,0,1],Mt=class extends He{constructor(e=np){super(3,3,e);let r=e[0],i=e[3],n=e[1],s=e[4];this.iScale=Math.sqrt(r*r+n*n),this.jScale=Math.sqrt(i*i+s*s)}static translate(e,r){return new Mt([1,0,0,0,1,0,e,r,1])}static translate1(e){return this.translate(e.x,e.y)}static rotate(e){let r=Math.cos(e),i=Math.sin(e);return new Mt([r,i,0,-i,r,0,0,0,1])}static rotateD(e){return this.rotate(J.toRadians(e))}static scale(e){return new Mt([e,0,0,0,e,0,0,0,1])}static scale1(e,r){return new Mt([e,0,0,0,r,0,0,0,1])}static svgTrasform(e){let r=e.split(" "),i=null;return r.forEach(n=>{n=n.trim();let s=n.trim().replace(")","").split("("),o=s[0],l=s[1].split(",");switch(o){case"translate":let u=Vr(l[0]),h=Vr(l[1]);i=i?i.translate(u,h):Mt.translate(u,h);break;case"rotate":let c=Vr(l[0]),f=Vr(l[1]),d=Vr(l[2]);i=i?i.setOrigin(f,d):Mt.translate(f,d),i=i.rotateD(c);break;default:return}}),i}isMirrored(){return this.det()<0}multiply3(e){let r=new Array(9);return He.mul(3,3,3,this.data,e.data,r),new Mt(r)}translate(e,r){return this.multiply3(Mt.translate(e,r))}translate1(e){return this.multiply3(Mt.translate1(e))}scale(e){return this.multiply3(Mt.scale(e))}scale1(e,r){return this.multiply3(Mt.scale1(e,r))}det(){return this.data[0]*this.data[4]-this.data[3]*this.data[1]}invert(){let e=this.getInverseMatrix();return new Mt(e.data)}rotateD(e){return this.multiply3(Mt.rotateD(e))}rotate(e){return this.multiply3(Mt.rotate(e))}resetOffset(){let e=this.data;return new Mt([e[0],e[1],0,e[3],e[4],0,0,0,1])}setOrigin(e,r){return Mt.translate(-e,-r).multiply3(this).translate(e,r)}setOrigin1(e){return this.setOrigin(e.x,e.y)}},me=Mt;me.MIRROR_Y=new Mt([1,0,0,0,-1,0,0,0,1]),me.MIRROR_X=new Mt([-1,0,0,0,1,0,0,0,1]),me.ROT_90=new Mt([0,1,0,-1,0,0,0,0,1]),me.ROT_N90=new Mt([0,-1,0,1,0,0,0,0,1]);var Ci=class extends de{constructor(e,r,i,n,s,o,l){super("",e,r);this.location=i,this.rotation=D.normal(n),this.text=s,this.font=o,this.mirror=l,this.__bbox=this._bbox()}multiply3(e){return new Ci(this.net,this.layer,this.location.multiply3(e),J.transformD(this.rotation,e),this.text,this.font.transform(e),this.mirror)}bbox(){return this.__bbox}_bbox(){let e=this.font.size*this.text.length/2,r=this.rotation;this.mirror&&(r+=180);let i=this.location,n=this.location.add1(e,this.font.size);if(r%360===0)return new H().ext2(i).ext2(n).build();{let s=this.location.add1(e,0),o=this.location.add1(0,this.font.size),l=me.rotateD(r).setOrigin1(this.location);return new H().ext2(i.multiply3(l)).ext2(n.multiply3(l)).ext2(s.multiply3(l)).ext2(o.multiply3(l)).build()}}shape(e,r){return null}};var Ti=class{constructor(t,e,r,i=!1,n=!1){this.familly=t,this.size=e,this.weight=r,this.italic=i,this.bold=n}transform(t){return new Ti(this.familly,t.iScale*this.size,t.iScale*this.weight,this.italic,this.bold)}hashCode(){return F.strHashcode(this.familly)^this.size^this.weight}equals(t){return this===t?!0:t==null?!1:t instanceof Ti?!(this.familly!==t.familly||this.size!==t.size||this.weight!==t.weight||this.italic!==t.italic||this.bold!==t.bold):!1}};var Yh=new Ci("",I.DOCUMENT,b.ORIGIN,0,"",new Ti("",0,0),!1),En=class{constructor(){this.layer=null;this.location=null;this.orientation=Number.NaN;this.pattern=null;this.showDesignator=!1;this.showComment=!1;this.designator=null;this.comment=null;this.shapes=[]}clone(t){let e=new En;e.layer=t.layer,e.location=t.location,e.orientation=t.orientation,e.pattern=t.pattern,e.uniqueId=t.uniqueId,e.showDesignator=t.showDesignator,e.showComment=t.showComment,e.designator=t.designator,e.comment=t.comment;for(let r of t.shapes)e.shapes.push(r);return e}asContainer(){return this.orientation=0,this.pattern="",this.showDesignator=!1,this.showComment=!1,this.designator=Yh,this.comment=Yh,this}build(){return new ir(this)}},ir=class extends de{constructor(e){super(e.id||"","",D.notnull(e.layer));if(this.uniqueId=e.uniqueId||e.id,this.location=D.notnull(e.location),this.orientation=D.normal(e.orientation),this.pattern=D.notnull(e.pattern),this.showDesignator=e.showDesignator,this.showComment=e.showComment,this.designator=D.notnull(e.designator),this.comment=D.notnull(e.comment),this.props=e.props,e.shapes.length==0)throw new Error("no shape in component ");this.shapes=e.shapes.slice(0),this.__bbox=this._bbox()}multiply3(e){let r=new En;r.layer=this.layer,r.props=this.props,r.location=this.location.multiply3(e),r.orientation=J.transformD(this.orientation,e),r.pattern=this.pattern,r.id=this.id,r.uniqueId=this.uniqueId,r.showDesignator=this.showDesignator,r.showComment=this.showComment,r.designator=this.designator.multiply3(e),r.comment=this.comment.multiply3(e);for(let i of this.shapes)r.shapes.push(i.multiply3(e));return r.build()}bbox(){return this.__bbox}_bbox(){let e=new H;for(let r of this.shapes)e.ext1(r.bbox());return this.showDesignator&&e.ext1(this.designator.bbox()),this.showComment&&e.ext1(this.comment.bbox()),e.build()}shape(e,r){throw new Error("unsupported operation")}};var $a=class{constructor(t,e,r){this.sourceName=t,this.contributor=e,this.scale=r}};var Ki=class{constructor(){this.inner=new Array}contains(t){for(let e of this.inner)if(e.equals(t))return!0;return!1}add(t){this.contains(t)||this.inner.push(t)}addAll1(t){this.addAll2(t.iterator())}addAll2(t){Xi(t,(e,r)=>(this.add(r),!0))}array(){return this.inner}size(){return this.inner.length}isEmpty(){return this.inner.length===0}iterator(){return Ir(this.inner)}};var Zi=class{constructor(){this.sourceName=null;this.contributor=null;this.scale=Number.NaN;this.location=null;this.rules=[];this.shapes=[];this.layerStack=new Ki;this.layerInfos={};this.ruleCache=null;this.ruleNetCache=null;this.ruleOptions={}}build(){return new wu(this)}addLayerOrder(...t){if(t!==null)for(let e=0;e<t.length;e++){let r=D.notnull(t[e]);if(this.layerStack.contains(r))throw new Error(Pe.format("duplicate layer %s",r));this.layerStack.add(r)}}},wu=class extends $a{constructor(e){super(D.notnull(e.sourceName),D.notnull(e.contributor),e.scale);this.ruleCache=null;this.ruleNetCache=null;this.ruleOptions={};this.rules=e.rules.slice(0),this.shapes=e.shapes.slice(0),this.layerStack=e.layerStack.array().slice(0),this.layerInfos=e.layerInfos||{},this.ruleCache=e.ruleCache,this.ruleNetCache=e.ruleNetCache,this.ruleOptions=e.ruleOptions}components(){let e={},r=[];for(let i of this.shapes)i instanceof ir&&(i.pattern in e||(e[i.pattern]=!0,r.push(i)));return r}};var rs=class{},nr=class extends rs{constructor(e){super();this.selectors=e}},xt=class extends rs{constructor(e){super();this.net=e}},zt=class extends rs{constructor(e){super();this.id=e}},ht=class extends rs{},is=class{constructor(t){this.selector=t}},qh=class extends is{constructor(e,r){super(e);this.clearance=D.normal(r)}},Xh=class extends is{constructor(e,r){super(e);this.width=D.positiveOr0(r)}},sr=class extends is{constructor(e,r,i,n,s,o,l,u,h,c="0"){super(e);this.clearance=r,this.boardClearance=i,this.thermal=n,this.spokeWidth=s,this.spokeSpace=o,this.multiLayerThermal=l,this.multiLayerSpokeWidth=u,this.multiLayerSpokeSpace=h,this.trackConnect=c}},ai=class extends is{constructor(e,r,i,n,s,o,l,u,h){super(e);this.clearance=r,this.boardClearance=i,this.thermal=n,this.spokeWidth=s,this.spokeSpace=o,this.multiLayerThermal=l,this.multiLayerSpokeWidth=u,this.multiLayerSpokeSpace=h}};var ji=class{};var lr=class{constructor(t,e,r){this.p1=t,this.p2=e,this.p3=r}barycentre(){return lr.barycentre(this.p1,this.p2,this.p3)}incentre(){return lr.incentre(this.p1,this.p2,this.p3)}static barycentre(t,e,r){let i=t.x+e.x+r.x,n=t.y+e.y+r.y;return new b(i/3,n/3)}static incentre(t,e,r){let i=e.sub(r).length(),n=t.sub(r).length(),s=t.sub(e).length(),o=i+n+s,l=i*t.x+n*e.x+s*r.x,u=i*t.y+n*e.y+s*r.y;return new b(l/o,u/o)}area(){return lr.area(this.p1,this.p2,this.p3)}static area(t,e,r){return this.area2(t.x,t.y,e.x,e.y,r.x,r.y)/2}static area2(t,e,r,i,n,s){return Math.abs(it.crossProd2(t,e,r,i,n,s))}scale(t,e){let r=me.translate(-t.x,-t.y).scale(e).translate1(t),i=this.p1.multiply3(r),n=this.p2.multiply3(r),s=this.p3.multiply3(r);return new lr(i,n,s)}scaleOnBarycentre(t){return this.scale(this.barycentre(),t)}scaleOnIncentre(t){return this.scale(this.incentre(),t)}extend(t){let e=this.incentre(),r=this.p1.add(this.p2).sub(e).scale(1/2),i=r.length(),s=b.ORIGIN.pointOnRays2(r,i+t).length()/i;return this.scaleOnIncentre(s)}container(t){let e=this.p3.sub(this.p1),r=this.p2.sub(this.p1),i=t.sub(this.p1),n=e.dot(e),s=e.dot(r),o=e.dot(i),l=r.dot(r),u=r.dot(i),h=1/(n*l-s*s),c=(l*o-s*u)*h;if(c<0||c>1)return!1;let f=(n*u-s*o)*h;return f<0||f>1?!1:c+f<=1}};function Lu(a){function t(oe,ne){return oe<<ne|oe>>>32-ne}function e(oe,ne){var pe,Ce,Oe,We,je;return Oe=oe&2147483648,We=ne&2147483648,pe=oe&1073741824,Ce=ne&1073741824,je=(oe&1073741823)+(ne&1073741823),pe&Ce?je^2147483648^Oe^We:pe|Ce?je&1073741824?je^3221225472^Oe^We:je^1073741824^Oe^We:je^Oe^We}function r(oe,ne,pe){return oe&ne|~oe&pe}function i(oe,ne,pe){return oe&pe|ne&~pe}function n(oe,ne,pe){return oe^ne^pe}function s(oe,ne,pe){return ne^(oe|~pe)}function o(oe,ne,pe,Ce,Oe,We,je){return oe=e(oe,e(e(r(ne,pe,Ce),Oe),je)),e(t(oe,We),ne)}function l(oe,ne,pe,Ce,Oe,We,je){return oe=e(oe,e(e(i(ne,pe,Ce),Oe),je)),e(t(oe,We),ne)}function u(oe,ne,pe,Ce,Oe,We,je){return oe=e(oe,e(e(n(ne,pe,Ce),Oe),je)),e(t(oe,We),ne)}function h(oe,ne,pe,Ce,Oe,We,je){return oe=e(oe,e(e(s(ne,pe,Ce),Oe),je)),e(t(oe,We),ne)}function c(oe){for(var ne,pe=oe.length,Ce=pe+8,Oe=(Ce-Ce%64)/64,We=(Oe+1)*16,je=Array(We-1),Yi=0,tr=0;tr<pe;)ne=(tr-tr%4)/4,Yi=tr%4*8,je[ne]=je[ne]|oe.charCodeAt(tr)<<Yi,tr++;return ne=(tr-tr%4)/4,Yi=tr%4*8,je[ne]=je[ne]|128<<Yi,je[We-2]=pe<<3,je[We-1]=pe>>>29,je}function f(oe){var ne="",pe="",Ce,Oe;for(Oe=0;Oe<=3;Oe++)Ce=oe>>>Oe*8&255,pe="0"+Ce.toString(16),ne=ne+pe.substr(pe.length-2,2);return ne}function d(oe){oe=oe.replace(/\r\n/g,`
`);for(var ne="",pe=0;pe<oe.length;pe++){var Ce=oe.charCodeAt(pe);if(Ce<128)ne+=String.fromCharCode(Ce);else if(Ce>127&&Ce<2048)ne+=String.fromCharCode(Ce>>6|192),ne+=String.fromCharCode(Ce&63|128);else{if(Ce>=55296&&Ce<=56319){var Oe=oe.charCodeAt(pe+1);if(Oe&&Oe>=56320&&Oe<=57343){var We=(Ce-55296<<10|Oe-56320)+65536;ne+=String.fromCharCode(We>>18|240),ne+=String.fromCharCode(We>>12&63|128),ne+=String.fromCharCode(We>>6&63|128),ne+=String.fromCharCode(We&63|128),pe++;continue}}ne+=String.fromCharCode(Ce>>12|224),ne+=String.fromCharCode(Ce>>6&63|128),ne+=String.fromCharCode(Ce&63|128)}}return ne}var p=Array(),m,g,x,y,P,L,w,C,T,M=7,E=12,W=17,k=22,O=5,se=9,Y=14,$=20,ae=4,le=11,ge=16,Me=23,Je=6,Dt=10,rt=15,Wt=21;for(a=d(a),p=c(a),L=1732584193,w=4023233417,C=2562383102,T=271733878,m=0;m<p.length;m+=16)g=L,x=w,y=C,P=T,L=o(L,w,C,T,p[m+0],M,3614090360),T=o(T,L,w,C,p[m+1],E,3905402710),C=o(C,T,L,w,p[m+2],W,606105819),w=o(w,C,T,L,p[m+3],k,3250441966),L=o(L,w,C,T,p[m+4],M,4118548399),T=o(T,L,w,C,p[m+5],E,1200080426),C=o(C,T,L,w,p[m+6],W,2821735955),w=o(w,C,T,L,p[m+7],k,4249261313),L=o(L,w,C,T,p[m+8],M,1770035416),T=o(T,L,w,C,p[m+9],E,2336552879),C=o(C,T,L,w,p[m+10],W,4294925233),w=o(w,C,T,L,p[m+11],k,2304563134),L=o(L,w,C,T,p[m+12],M,1804603682),T=o(T,L,w,C,p[m+13],E,4254626195),C=o(C,T,L,w,p[m+14],W,2792965006),w=o(w,C,T,L,p[m+15],k,1236535329),L=l(L,w,C,T,p[m+1],O,4129170786),T=l(T,L,w,C,p[m+6],se,3225465664),C=l(C,T,L,w,p[m+11],Y,643717713),w=l(w,C,T,L,p[m+0],$,3921069994),L=l(L,w,C,T,p[m+5],O,3593408605),T=l(T,L,w,C,p[m+10],se,38016083),C=l(C,T,L,w,p[m+15],Y,3634488961),w=l(w,C,T,L,p[m+4],$,3889429448),L=l(L,w,C,T,p[m+9],O,568446438),T=l(T,L,w,C,p[m+14],se,3275163606),C=l(C,T,L,w,p[m+3],Y,4107603335),w=l(w,C,T,L,p[m+8],$,1163531501),L=l(L,w,C,T,p[m+13],O,2850285829),T=l(T,L,w,C,p[m+2],se,4243563512),C=l(C,T,L,w,p[m+7],Y,1735328473),w=l(w,C,T,L,p[m+12],$,2368359562),L=u(L,w,C,T,p[m+5],ae,4294588738),T=u(T,L,w,C,p[m+8],le,2272392833),C=u(C,T,L,w,p[m+11],ge,1839030562),w=u(w,C,T,L,p[m+14],Me,4259657740),L=u(L,w,C,T,p[m+1],ae,2763975236),T=u(T,L,w,C,p[m+4],le,1272893353),C=u(C,T,L,w,p[m+7],ge,4139469664),w=u(w,C,T,L,p[m+10],Me,3200236656),L=u(L,w,C,T,p[m+13],ae,681279174),T=u(T,L,w,C,p[m+0],le,3936430074),C=u(C,T,L,w,p[m+3],ge,3572445317),w=u(w,C,T,L,p[m+6],Me,76029189),L=u(L,w,C,T,p[m+9],ae,3654602809),T=u(T,L,w,C,p[m+12],le,3873151461),C=u(C,T,L,w,p[m+15],ge,530742520),w=u(w,C,T,L,p[m+2],Me,3299628645),L=h(L,w,C,T,p[m+0],Je,4096336452),T=h(T,L,w,C,p[m+7],Dt,1126891415),C=h(C,T,L,w,p[m+14],rt,2878612391),w=h(w,C,T,L,p[m+5],Wt,4237533241),L=h(L,w,C,T,p[m+12],Je,1700485571),T=h(T,L,w,C,p[m+3],Dt,2399980690),C=h(C,T,L,w,p[m+10],rt,4293915773),w=h(w,C,T,L,p[m+1],Wt,2240044497),L=h(L,w,C,T,p[m+8],Je,1873313359),T=h(T,L,w,C,p[m+15],Dt,4264355552),C=h(C,T,L,w,p[m+6],rt,2734768916),w=h(w,C,T,L,p[m+13],Wt,1309151649),L=h(L,w,C,T,p[m+4],Je,4149444226),T=h(T,L,w,C,p[m+11],Dt,3174756917),C=h(C,T,L,w,p[m+2],rt,718787259),w=h(w,C,T,L,p[m+9],Wt,3951481745),L=e(L,g),w=e(w,x),C=e(C,y),T=e(T,P);var kr=f(L)+f(w)+f(C)+f(T);return kr.toLowerCase()}function cx(a){var t="_^&!Aa1";return a?Lu(a+t):""}var Ja={0:0,90:1,180:0,270:-1},Mu={0:1,90:0,180:-1,270:0},Au=[1,10,100,1e3],Kh="http://www.w3.org/2000/svg",Zh="http://www.w3.org/1999/xlink",jh="http://www.w3.org/XML/1998/namespace",Qh="https://easyeda.com/",$h=function(){var a={svg:Kh,xlink:Zh,xml:jh,c:Qh};return a[Kh]="svg",a[Zh]="xlink",a[jh]="xml",a[Qh]="c",a}(),px=0,dx=1,mx=2,bx=10,gx=11,yx=1,xx=6,Px=7,Sx=16,wx=17,Lx=8,Mx=9,Ax=18,Ix=19,Cx=4,Tx=12,Rx=13,vx=5,Nx=14,Ex=15,Bx=2,_x=3,Ox=0,Dx={A4L:{W:1169,H:827},A4P:{W:827,H:1169},A3L:{W:1654,H:1169},A3P:{W:1169,H:1654},A2L:{W:2339,H:1654},A2P:{W:1654,H:2339},A1L:{W:3311,H:2339},A1P:{W:2339,H:3311}},Pt=function(){var a={RATLINES:9,MODEL3D:19,ALL:11,TOPSILKLAYER:3,TOPLAYER:1,TOPPASTERLAYER:5,TOPSOLDERLAYER:7,LIBBODY:99,PADSURFACE:100,BOARDOUTLINE:10,DOCUMENT:12,TOPASSEMBLY:13,MECHANICAL:15,TOPCOMPONENT:16,SUBSTRATE:18},t;for(t=21;t<21+32;t++)a["INNER"+(t-20)]=t;for(a.BOTTOMSILKLAYER=4,a.BOTTOMLAYER=2,a.BOTTOMPASTERLAYER=6,a.BOTTOMSOLDERLAYER=8,a.BOTTOMASSEMBLY=14,a.BOTTOMCOMPONENT=17,t=53;t<53+32;t++)a["BOARD"+(t-52)]=t;return a}(),kx=function(){var a={COPPERAREA:[1,2,21,22,23,24],PLANEZONE:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,99],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],DIMENSION:[3,4,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11,99,100],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15],SHEET:[12,13,14,15]};a["3D"]=function(){for(var i=[16,19,3,7,5,1],n=21;n<52;n++)i.push(n+32,n);return i.push(2,6,8,4,17),i}();var t,e,r;for(t in a)if(a.hasOwnProperty(t)&&(r=a[t],r.indexOf(21)>0&&r.indexOf(25)===-1))for(e=25;e<=52;e++)r.push(e);return a}(),Vt=function(){var a={1:"TopLayer",2:"BottomLayer",3:"TopSilkLayer",4:"BottomSilkLayer",5:"TopPasteMaskLayer",6:"BottomPasteMaskLayer",7:"TopSolderMaskLayer",8:"BottomSolderMaskLayer",9:"Ratlines",10:"BoardOutLine",11:"Multi-Layer",12:"Document",13:"TopAssembly",14:"BottomAssembly",15:"Mechanical",16:"TopComponents",17:"BottomComponents",18:"Substrate",19:"3DModel",99:"ComponentShapeLayer",100:"LeadShapeLayer"},t;for(t=21;t<21+32;t++)a[t]="Inner"+(t-20);for(t=53;t<53+32;t++)a[t]="Substrate"+(t-52);return a}(),Vx=function(){var a=[],t=[];for(var e in Pt)if(Pt.hasOwnProperty(e)){if(e.match(/^BOARD\d+/))continue;a.push(Pt[e])}a.sort(),t.sort();var r={},i,n={21:"#999966",22:"#008000",23:"#00FF00",24:"#BC8E00",25:"#70DBFA",26:"#00CC66",27:"#9966FF",28:"#800080",29:"#008080",30:"#15935F",31:"#000080",32:"#00B400",33:"#2E4756",34:"#99842F",35:"#FFFFAA",36:"#99842F",37:"#2E4756",38:"#3535FF",39:"#8000BC",40:"#43AE5F",41:"#C3ECCE",42:"#728978",43:"#39503F",44:"#0C715D",45:"#5A8A80",46:"#2B937E",47:"#23999D",48:"#45B4E3",49:"#215DA1",50:"#4564D7",51:"#6969E9",52:"#9069E9"};a.forEach(function(o){switch(o){case Pt.TOPLAYER:i={name:Vt[o],color:"#FF0000",darkColor:"#CC0000",visible:!0,active:!0,config:!0};break;case Pt.BOTTOMLAYER:i={name:Vt[o],color:"#0000FF",darkColor:"#000080",visible:!0,active:!1,config:!0};break;case Pt.TOPSILKLAYER:i={name:Vt[o],color:"#FFCC00",darkColor:"#806600",visible:!0,active:!1,config:!0};break;case Pt.BOTTOMSILKLAYER:i={name:Vt[o],color:"#66CC33",darkColor:"#33661A",visible:!0,active:!1,config:!0};break;case Pt.TOPPASTERLAYER:i={name:Vt[o],color:"#808080",darkColor:"#666666",visible:!0,active:!1,config:!0};break;case Pt.BOTTOMPASTERLAYER:i={name:Vt[o],color:"#800000",darkColor:"#660000",visible:!0,active:!1,config:!0};break;case Pt.TOPSOLDERLAYER:i={name:Vt[o],color:"#800080",darkColor:"#660066",visible:!0,active:!1,transparency:.3,config:!0};break;case Pt.BOTTOMSOLDERLAYER:i={name:Vt[o],color:"#AA00FF",darkColor:"#8800CC",visible:!0,active:!1,transparency:.3,config:!0};break;case Pt.RATLINES:i={name:Vt[o],color:"#6464FF",darkColor:"#5050CC",visible:!1,active:!1,config:!0};break;case Pt.BOARDOUTLINE:i={name:Vt[o],color:"#FF00FF",darkColor:"#CC00CC",visible:!0,active:!1,config:!0};break;case Pt.ALL:i={name:Vt[o],color:"#C0C0C0",darkColor:"#999999",visible:!0,active:!1,config:!0};break;case Pt.DOCUMENT:i={name:Vt[o],color:"#FFFFFF",darkColor:"#CCCCCC",visible:!0,active:!1,config:!0};break;case Pt.TOPASSEMBLY:i={name:Vt[o],color:"#33CC99",darkColor:"#33AA99",visible:!1,active:!1,config:!1};break;case Pt.BOTTOMASSEMBLY:i={name:Vt[o],color:"#5555FF",darkColor:"#8888FF",visible:!1,active:!1,config:!1};break;case Pt.MECHANICAL:i={name:Vt[o],color:"#F022F0",darkColor:"#F088F0",visible:!1,active:!1,config:!1};break;case Pt.MODEL3D:i={name:Vt[o],color:"#66CCFF",visible:!1,active:!1,config:!1};break;case Pt.LIBBODY:i={name:Vt[o],color:"#00CCCC",visible:!1,active:!1,config:!1};break;case Pt.PADSURFACE:i={name:Vt[o],color:"#CC9999",visible:!1,active:!1,config:!1};break;default:o>=Pt.INNER1&&o<=Pt.INNER32?i={name:Vt[o],color:n[o],darkColor:s(n[o]),visible:!1,active:!1,config:!1}:i=null;break}i&&(r[o]=i)}),r.Hole={config:!0,name:"Hole",darkColor:"#222222",color:"#222222"},r.DRCError={config:!0,name:"DRCError",color:"#FAD609",darkColor:"#FAD609"};function s(o){if(typeof o!="string"||!o.match(/#?([\da-f]{6})/i))return o;var l=parseInt(RegExp.$1,16),u=.5,h=Math.min(255,Math.round((l>>16)*u)),c=Math.min(255,Math.round((l>>8&255)*u)),f=Math.min(255,Math.round((l&255)*u)),d=((h<<16)+(c<<8)+f).toString(16);return"#"+("00000"+d).substr(-6).toUpperCase()}return r}(),ct={BLANK:0,SCH:1,PART:2,PCB:3,FOOTPRINT:4,PRJ:5,SUBPART:6,SPICESYMBOL:7,SUBCKT:8,NETLIST:9,WAVEFORM:10,SCHLIB3D:11,PHOTOVIEW:12,SCHMODULE:13,PCBMODULE:14,VIEW3D:15,PCBLIB3D:16,BLOCK_SYMBOL:17,NETFLAG:18,NETPORT:19,SHEET_SYMBOL:20,NONEELEC_SYMBOL:21,SHORT_SYMBOL:22,FOOTPRINTVIEW:23,CNCPRINTVIEW:24,PCB2D:31,PCB3D:32},Iu=function(){var a={};for(let t in ct)a[ct[t]]=t;return a}(),Ux={PRJ:"1",BOARDS:"2",BOARD:"3",BLOCKS:"4",BLOCK:"5",SCH:"6",SHEET:"7",SYMBOLS:"8",SYMBOL:"9",NETS:"10",NET:"11",WIRE:"13",BLOCK_SYMBOL:"12",BUS:"14",SYMBOLCOLLECT:"15",NETCLASS:"16",NETCOLLECT:"17",NETTREENODE:"18",REUSEBLOCKS:"19",REUSEBLOCK:"20",NETPORTS:"23",NETPORT:"24",NETFLAGS:"25",NETFLAG:"26",SHORTSYMBOLS:"27",SHORTSYMBOL:"28",NONEELECSYMBOLS:"29",NONEELECSYMBOL:"30",PRIMITIVES:"31",PRIMITIVE:"32",PCB:"101",COMPONENTS:"102",COMPONENT:"103",PINS:"104",PIN:"105",ALLNETROOT:"106",RATLINES:"107",RATLINE:"108",RATLINENETS:"109",RATLINENET:"110",ERRORS:"111",ERRORTYPE:"112",ERROROBJTYPE:"113",NETCLASSES_PCB:"114",NETCLASS_PCB:"115",PINTYPE:"117",TRACKNET:"118",GROUP:"119",ALLOBJROOT:"120",ALLCOMPONENTROOT:"121",CLASSIFICATION:"122",CLASSIFICATIONCOMPONENT:"123",COPPERLAYER:"124",DIFFERENTAILS:"125",DIFFERENTAIL:"126",EQUAL_LENGTH_GROUP_ROOT:"127",EQUAL_LENGTH_GROUP:"128",PADSPAIR_GROUP_ROOT:"132",PADSPAIR_GROUP:"133",TEARDROP_ROOT:"135",TEARDROP:"136"},Fx="~",Gx="^^",Wx="#@$",Hx="`",zx="#sheet#",Yx=["Unknow","LCSC","Digi-Key","Mouser","Element14","RS-Online"],qx=200,Xx={lists:[{title:"Created",newtitle:{en:"My Libraries",cn:"\u6211\u7684\u4E2A\u4EBA\u5E93"},docType:2,tags:["All"],nickname:"Created",uuid:"c45b67d5dd2241f380ca7836744c1044"},{title:"Favorite",newtitle:{en:"My Favorites",cn:"\u6211\u7684\u6536\u85CF\u5E93"},docType:2,tags:["All"],nickname:"Favorite",uuid:"c45b67d5dd2241f380ca7836744c1044"},{nickname:"\u6D4B\u8BD5\u7528\u4F8B",uuid:"ca1608a600764e02aca5152493eba223",title:"\u6D4B\u8BD5\u7528\u4F8B",docType:2,tags:["All","1231"]}]},Kx={};function el(a){switch(a){case ct.SCH:case ct.SUBCKT:case ct.SCHMODULE:return"sch";case ct.SUBPART:case ct.SPICESYMBOL:return"schlib";case ct.PCB:case ct.PCBMODULE:return"pcb";case ct.FOOTPRINT:return"pcblib";case ct.WAVEFORM:return"waveform";case ct.PHOTOVIEW:return"photoview";case ct.VIEW3D:return"3Dview";default:return}}function Qx(a){var t=el(a);return t=="schlib"||t=="pcblib"}var sp=(l=>(l[l.EMPTY=0]="EMPTY",l[l.CTRL=1]="CTRL",l[l.SHIFT=2]="SHIFT",l[l.ALT=3]="ALT",l[l.CTRL_SHIFT=4]="CTRL_SHIFT",l[l.CTRL_ALT=5]="CTRL_ALT",l[l.SHIFT_ALT=6]="SHIFT_ALT",l[l.CTRL_SHIFT_ALT=7]="CTRL_SHIFT_ALT",l))(sp||{});var Cu=class{static inc(){return++this.ggeid}static get(){return this.ggeid}static set(t){this.ggeid=t}};Cu.ggeid=4;function ns(a,t){return a?a.hasOwnProperty(t):!1}function tl(a,t){let e;for(let r in t)if(ns(t,r)&&a.indexOf(r)!==-1){e=!0;break}return e}function lP(a){if(typeof a!="string")return a;if(a==null)return"";let t={"&#126;":"~","&#94;":"^","&#35;&#64;&#36;":"#@$","&#96;":"`","&apos;":"'","&APOS;":"'"};function e(r){return t[r]}return a==null?"":tl(a,t)?(a+"").replace(/(&#96;|&#126;|&#94;|&#35;&#64;&#36;|&apos;)/gi,e):a}function uP(a){if(typeof a!="string")return a;if(a==null)return"";let t={"~":"&#126;","^":"&#94;","#@$":"&#35;&#64;&#36;","`":"&#96;"};function e(r){return t[r]}return tl(a,t)?a.replace(/(\~|\^|#@\$|\`)/g,e):a}function Jh(a){if(typeof a!="object"||a===null||a instanceof Date||a instanceof ArrayBuffer)return a;if(Array.isArray(a))return a.map(Jh);{let t={};for(let e in a)a.hasOwnProperty(e)&&(t[e]=Jh(a[e]));return t}}var Tu=class{constructor(t,e){this.x=+t||0,this.y=+e||0}toString(){return or(this.x,4)+"_"+or(this.y,4)}};function hP(a){return a?document.getElementById(a):null}function cP(a,t){if(!a||a=="#")return[];try{return(t||document).querySelectorAll(a)}catch(e){return[]}}function fP(a,t){if(!a||a=="#")return null;try{return(t||document).querySelector(a)}catch(e){return null}}function pP(a,t){let e=[+a[0]-t,a[1],+a[0]+t,a[1]],r=[+a[2]-t,a[3],+a[2]+t,a[3]],i=sc(a[0],a[1],a[2],a[3]);return i=180/(Math.PI/i),i-=90,e=nl(e,i,a[0],a[1]),r=nl(r,i,a[2],a[3]),"M"+e[0]+" "+e[1]+"A"+t+" "+t+" 0 0 1 "+e[2]+" "+e[3]+"L"+r[2]+" "+r[3]+"A"+t+" "+t+" 0 0 1 "+r[0]+" "+r[1]+"z"}function op(a){return(a||"").replace(/[ ,]{2,}| /g,",").split(",").map(Number)}function Ru(a){let t=[],e=op(a),r=e.length-1;for(let i=0;i<r;i+=2)t[i/2]=new Tu(e[i],e[i+1]);return t}function dP(a){let t=a;if(typeof t=="string"&&(t=Ru(t)),!il(t)||t.length<3)return"";let e="",r,i=[];for(let s=0;s<t.length;s++)r=t[s].x+"_"+t[s].y,i.indexOf(r)===-1&&i.push(r);let n=!0;if(i.length<3)return"";if(i.length>=3){let s=i[0].split("_")[0],o=i[0].split("_")[1],l=i[1].split("_")[0],u=i[1].split("_")[1];for(let h=2;h<i.length;h++){let c=i[h].split("_"),f=c[0],d=c[1];if(!Qi((s-l)*(d-u),(f-l)*(o-u))){n=!1;break}}if(n)return""}else return"";for(let s=0;s<i.length;s++){let o=i[s].split("_");s===0?e+="M"+o[0]+","+o[1]:e+="L"+o[0]+","+o[1]}return e&&(e+="Z"),e}function mP(a){return a.x+"_"+a.y}function bP(){}function gP(a){return Array.isArray(a)||a&&typeof a=="object"&&Object.prototype.toString.call(a)!="[object String]"&&typeof a.length=="number"&&a.length>=0&&a.length<4294967296&&a.length%1===0}function il(a){return Array.isArray(a)}function yP(a){return a?a.trim?a.trim():a.replace(/^\s+|\s+$/g,""):""}function ap(a,t){if(!a)return!1;if(a.classList)return a.classList.contains(t);let e=typeof a.className=="object"?a.className.baseVal:a.className;return t&&e&&e.split(/\s+/).indexOf(t)>=0}function xP(a){return ap(a,"fakeSegment")}function PP(a,t){return a.text==t.text?0:a.text>t.text?1:-1}function ec(a,t){let e=[],r=[],i=[];for(let u=0,h=a.length;u<h;u++){e[u]=u;let c=(t?a[u][t]||"":a[u]).toString();if(r[u]=c.toUpperCase().match(/\D+|\d+(?:\.\d+)?/g),i[u]=[],r[u])for(let f=0;f<r[u].length;f++)i[u][f]=r[u][f].match(/\d/)?1:2}let o=function(u,h){let c=r[u],f=r[h],d=i[u],p=i[h];if(!c||!f)return c==f?0:c?1:-1;let m=Math.max(c.length,f.length);for(let g=0;g<m;g++)if(c[g])if(f[g]){if(c[g]!=f[g])return d[g]!=p[g]?d[g]==1?-1:1:d[g]==1?c[g]-f[g]:c[g]<f[g]?-1:1}else return 1;else return-1;return 0};e.sort(o);let l=[];for(let u=0;u<a.length;u++)l[u]=a[e[u]];return l}function SP(a,t){let e=[],r=[],i=[];return a.forEach(n=>{let s=t?n[t]||"":n;s=="None"?i.push(n):(s.startsWith("$")?r:e).push(n)}),[].concat(ec(e,t),ec(r,t),i)}function wP(a){let t,e=a;for(;e!=t;)t=e,e=t.replace(/~|\^\^|#@\$|`|#sheet#/gi,"");return e}function LP(a,t){for(let e in a)ns(a,e)&&ns(t,e)&&a[e]===t[e]&&(delete a[e],delete t[e])}function lp(a){if(typeof a!="string")return a;if(a==null)return"";let t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;","&":"&amp;","&#039;":"'"};function e(r){return t[r]}return a==null?"":tl(a,t)?(a+"").replace(/[<>'"&]/g,e):a}function MP(a){if(typeof a!="string")return a;if(a==null)return"";let t={"&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&amp;":"&","&#039;":"'"};function e(r){return t[r]}return tl(a,t)?(a+"").replace(/&([^;]+);/g,e):a}function AP(a,t=void 0,e=void 0){if(!a||!t)return;let r=t?t.split(/\s+/):[],i=e?"add":e===!1?"remove":"toggle";if(a.classList&&a.classList.toggle){for(let l=0;l<r.length;l++)r[l]&&a.classList[i](r[l]);return}let n=typeof a.className=="object",s=n?a.className.baseVal:a.className,o=s?s.split(/\s+/):[];for(let l=0;l<r.length;l++)if(r[l]){let u=o.indexOf(r[l]);u<0?i!="remove"&&o.push(r[l]):i!="add"&&o.splice(u,1)}s=o.join(" "),n?a.className.baseVal=s:a.className=s}function IP(a,t){if(!a||!t)return;let e=t?t.split(/\s+/):[],r;if(a.classList)for(r=0;r<e.length;r++)e[r]&&a.classList.add(e[r]);else{let i=typeof a.className=="object",n=i?a.className.baseVal:a.className,s=n?n.trim().split(/\s+/):[];for(r=0;r<e.length;r++)e[r]&&s.indexOf(e[r])<0&&s.push(e[r]);n=s.join(" "),i?a.className.baseVal=n:a.className=n}}function CP(a,t){let e=t?t.split(/\s+/):[];if(a.classList)for(let r=0;r<e.length;r++)e[r]&&a.classList.remove(e[r]);else{let r=typeof a.className=="object",i=r?a.className.baseVal:a.className,n=i?i.trim().split(/\s+/):[];for(let s=0;s<e.length;s++){let o=n.indexOf(e[s]);o>=0&&n.splice(o,1)}i=n.join(" "),r?a.className.baseVal=i:a.className=i}}function TP(a){if(a&&a.parentNode)return a.parentNode.removeChild(a)}function RP(a,t){if(!a||!t)return a;if(a.removeAttribute)a.removeAttribute(t);else if(a.length)for(let e=0,r=a.length;e<r;e++)a[e]&&a[e].removeAttribute&&a[e].removeAttribute(t)}function vP(a,t,e){if(typeof t=="string")return a.getAttributeNS(e||null,t);if(!(e&&!$h[e])){for(let r in t)ns(t,r)&&a.setAttributeNS(e||null,r,t[r]);return a}}function NP(a){return a.indexOf(".")>0?a.replace(/\.?0*$/,""):a}function EP(a){return a.indexOf(".")<0?a+"0":a.replace(/\.(\d)/,"$1.").replace(/^0+(?!\.)/,"").replace(/\.$/,"")}function BP(a){return a.indexOf(".")<0?a.replace(/\d$/,".$&").replace(/^\./,"0."):a.replace(/(\d)\./,".$1").replace(/^\./,"0.")}function _P(a){return["SIGNAL","PLANE"].includes(a)}function rc(a=0){return Lu(Date.now()+oc(!0,3,32)+a).substr(8,16)}function OP(a){let t=!1;return function(){t||(t=!0,a.apply(this,arguments))}}function DP(a,t,e){let r,i,n,s,o,l,u=0,h=!1,c=!1,f=!0;if(typeof a!="function")throw new TypeError("Expected a function");t=Number(t)||0,typeof e=="object"&&(h=!!e.leading,c="maxWait"in e,n=c?Math.max(Number(e.maxWait)||0,t):n,f="trailing"in e?!!e.trailing:f);function d(C){let T=r,M=i;return r=i=void 0,u=C,s=a.apply(M,T),s}function p(C){return u=C,o=setTimeout(x,t),h?d(C):s}function m(C){let T=C-l,M=C-u,E=t-T;return c?Math.min(E,n-M):E}function g(C){let T=C-l,M=C-u;return l===void 0||T>=t||T<0||c&&M>=n}function x(){let C=Date.now();if(g(C))return y(C);o=setTimeout(x,m(C))}function y(C){return o=void 0,f&&r?d(C):(r=i=void 0,s)}function P(){o!==void 0&&clearTimeout(o),u=0,r=l=i=o=void 0}function L(){return o===void 0?s:y(Date.now())}function w(){let C=Date.now(),T=g(C);if(r=arguments,i=this,l=C,T){if(o===void 0)return p(l);if(c)return o=setTimeout(x,t),d(l)}return o===void 0&&(o=setTimeout(x,t)),s}return w.cancel=P,w.flush=L,w}function kP(a,t,e,r){r=r||0;let i=0,n=0,s=1,o=1,l,u,h={row:1,col:a,width:0,height:0};for(let c=1;c<=a;c++){for(s=c,o=1;s*o<a;)o++;c===1?(i=(o*t+(h.col-1)*r)/(s*e+(h.row-1)*r),l=Math.abs(i-1),h.row=s,h.col=o):(n=(o*t+(h.col-1)*r)/(s*e+(h.row-1)*r),u=Math.abs(n-1),u<l&&(i=n,h.row=s,h.col=o,l=u))}return h.width=h.col*t+(h.col-1)*r,h.height=h.row*e+(h.row-1)*r,h}function VP(...a){let t=/{([\d\w.]+)}/g,e=a.shift()+"";return a.length==1&&typeof a[0]=="object"&&(a=a[0]),t.lastIndex=0,e.replace(t,function(r,i){let n=a[i];return n===void 0?r:n})}function UP(a){if(!il(a))return;let t,e,r,i,n,s,o,l=a.length;for(let u=l-2;u>=0;u--)t=a[u],e=a[u+1],Bn(t.x,e.x)&&Bn(t.y,e.y)&&(u===0?a.splice(u+1,1):a.splice(u,1));l=a.length;for(let u=l-2;u>=1;u--)if(t=a[u-1],r=a[u],e=a[u+1],Bn(t.x,r.x)&&Bn(e.x,r.x)){i=t.x+e.x+r.x,n=Math.abs(i-3*e.x),s=Math.abs(i-3*r.x),i=Math.abs(i-3*t.x),o=Math.min(i,n,s),o==i?e.x=r.x=t.x:o==n?t.x=r.x=e.x:t.x=e.x=r.x;let h=(t.y+e.y+r.y)/3;i=Math.abs(t.y-h),n=Math.abs(e.y-h),s=Math.abs(r.y-h),o=Math.min(i,n,s),o==i?a.splice(u-1,1):o==n?a.splice(u+1,1):a.splice(u,1)}else Bn(t.y,r.y)&&Bn(e.y,r.y)?(i=t.y+e.y+r.y,n=Math.abs(i-3*e.y),s=Math.abs(i-3*r.y),i=Math.abs(i-3*t.y),o=Math.min(i,n,s),o==i?e.y=r.y=t.y:o==n?t.y=r.y=e.y:t.y=e.y=r.y,a.splice(u,1)):(i=Math.atan((t.y-r.y)/(t.x-r.x)),n=Math.atan((e.y-r.y)/(e.x-r.x)),Math.abs(i-n)<Math.PI/180&&a.splice(u,1))}function FP(a){function t(u){return u>=10?u:"0"+u}let e=new Date(a),r=e.getFullYear(),i=t(e.getMonth()+1),n=t(e.getDate()),s=t(e.getHours()),o=t(e.getMinutes()),l=t(e.getSeconds());return r+"-"+i+"-"+n+" "+s+":"+o+":"+l}function up(a){return a==ct.SCH||a==ct.SUBCKT}function GP(a){return up(a)||a==ct.SUBPART||a==ct.SPICESYMBOL||a==ct.WAVEFORM||Iu[a].match(/^sch/i)}function WP(a){return Iu[a].match(/^pcb/i)}function HP(a,t){let e=el(t);if(a==ct.SCHMODULE)return e=="sch";if(a==ct.PCBMODULE)return e=="pcb";let r=el(a);return r=="schlib"&&e=="sch"||r=="pcblib"&&e=="pcb"}function zP(a){let t={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},e={m:"l",M:"L"},r=/([MZLHVCSQTAmzlhvcsqta])([eE ,\-\+.\d]+)*/g,i=a.match(r),n=[];if(!i||!i.length)return[];for(let s=0;s<i.length;s++){let o=r.exec(a);if(Array.isArray(o)&&o.length===3&&o[2]&&o[2].trim()){let l=o[2].match(/(?:[-+]?(?:(?:\d+\.\d+)|(?:(?:\d+)|(?:\.\d+)))(?:e[-+]?\d+)?)/gi),u=o[1].toLowerCase(),h;if(t[u]&&(h=t[u])&&l.length>h){let c=e[o[1]]?e[o[1]]:o[1],f=o[1];for(let d=0,p=l.length;d<p;d+=h){let m=l.slice(d,d+h);m.unshift(f),n.push(m),f=c}}else l.unshift(o[1]),n.push(l)}else{let l=[o[1]];l[0]=="z"&&(l[0]="Z"),n.push(l)}}return n}function hp(a,t){if(Array.isArray(a)){for(let e=0,r=a.length;e<r;e++)if(t(void 0,a[e],e)===!1)return}else{let e=0;for(let r in a)if(a.hasOwnProperty(r)){let i=a[r];if(t(r,i,e)===!1)return;e++}}}function YP(a,t){return Ii(this,null,function*(){if(Array.isArray(a)){for(let e=0,r=a.length;e<r;e++)if((yield t(void 0,a[e],e))===!1)return}else{let e=0;for(let r in a)if(a.hasOwnProperty(r)){let i=a[r];if((yield t(r,i,e))===!1)return;e++}}})}function qP(a,t){return"#"+a.map(e=>(e=parseInt(t?Number(e)*255:e).toString(16).toUpperCase(),e.length===1?"0"+e:e)).join("")}function XP(a,t){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);if(e){let r=e.slice(1,4).map(i=>parseInt(i,16));return t?r.map(i=>+i/255):r}}function KP(a){return a?a.endsWith("?")?a:/\d+(\D*)$/.test(a)?a.replace(/\d+(\D*)$/,"?$1"):a+"?":"U?"}function ZP(a,t){return tc(a,t,()=>[])}function jP(a,t){return tc(a,t,()=>({}))}function tc(a,t,e){let r=a[t];return r!==void 0||(r=e(t),a[t]=r),r}function QP(a){return a?Object.keys(a).length==0:!1}function cp(a,t){if(!a||!a.length)return;let e=a.indexOf(t);if(!(e<0))return a.splice(e,1),t}function $P(a){let t=null;return(...e)=>(t||(t=a(...e).finally(()=>{t=null})),t)}function fp(a){if(!a)return"_1";let t=1;return a.match(/_\d+$/)&&(t=+a.match(/\d+$/)[0]||0,t++),a+"_"+t}function JP(a,t){let e=fp(a),r=/\d+$/,i=+e.match(r)[0]||0,n=e.replace(r,""),s=[e];for(let o=1;o<t;o++)++i,s.push(n+i);return s}function e0(a,t){let e={same:[],more:[],less:[].concat(t)};return a.forEach(r=>{t.indexOf(r)>=0?(e.same.push(r),cp(e.less,r)):e.more.push(r)}),e}function ic(a,t){let e=a.length,r=0;for(;r<e;){let i=a.indexOf(`
`,r);i<0&&(i=e);let n=a.substring(r,i);if(t(n)===!1)break;r=i+1}}function rl(a){return(t,e)=>{let r=!Object.is(e,void 0);return t?r?t.replace(a,e):a.test(t):r?"":!1}}var pp=rl(/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g),t0=rl(/\s+/g),dp=rl(/\ufffd/g),r0=rl(/[\.|\$]/g);function i0(a,t,e){a=(a||"").trim();let r=[pp,dp];return e=e?e.concat(r):r,e.forEach(i=>{a=i(a,t)}),a.trim()}function n0(a,t,e,r){let i=a[t];if(a[t])i=r(a,t,i),a[t]=i;else return i=e(t),a[t]=i,i}function nc(a){let t=[];if(a&&typeof a=="object"){let e=Object.keys(a).filter(r=>!/^\d+$/g.test(r));for(let r of e)t.push(a[r])}return t}function s0(a,t){var r=parseFloat(a);if(isNaN(r))return!1;let e=Math.pow(10,t);var r=Math.round(a*e)/e,i=r.toString(),n=i.indexOf(".");for(n<0&&(n=i.length,i+=".");i.length<=n+t;)i+="0";return i}function o0(a){let t=null;return()=>(t===null&&(t=a()),t)}function a0(a){let t=!0,e;return()=>Ii(this,null,function*(){return t&&(e=yield a(),t=!1),e})}function l0(a){let t=a.length,e,r;for(;t;)r=Math.floor(Math.random()*t--),e=a[t],a[t]=a[r],a[r]=e;return a}function u0(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()==="object"}function h0(a,t={}){let e=document.createElement("span");if(e.classList.add("i18n"),e.innerHTML=lp(a),t){let{context:r,attr:i,params:n}=t;r&&e.setAttribute("data-i18n-context",r),i&&e.setAttribute("data-i18n-attr",i),n&&hp(n,(s,o)=>{e.setAttribute(`i18n-params-${s}`,o+"")})}return e.outerHTML}function mp(a,t=""){if(!a)return"A";let e=a.charCodeAt(a.length-1),r="";do e===90?(a=mp(a.slice(0,a.length-1),t)+"A",r="A"):r=String.fromCharCode(e+1),e=r.charCodeAt(0);while(t.includes(r));return a.slice(0,a.length-1)+r}var c0=/^([A-Z]+)(\d+|\?|\)$/,f0=/^([A-Z]+)(\d+)$/;var A0=Math.PI*2,I0=Math.PI/2,C0=Math.sin(Math.PI/180);function or(a,t,e){if(typeof a!="number"&&(a=+a),isNaN(a))return NaN;if(t=t|0,t<=0||!a&&!e)return Math.round(a);var r=Au[t]||Math.pow(10,t)||10;if(e){var i=a<0?"-":"";for(a=a<0?-a:a,a=Math.round(a*r)+"";a.length<=t;)a="0"+a;return a=a.slice(0,-t)+"."+a.slice(-t),parseFloat(i+a)}else return Math.round(a*r+1e-10)/r}function ac(a){let t=0;a>0?t=a-Math.floor(a):t=a-Math.ceil(a);let e=(t.toString()||"").length;return e>2?e-2:0}function T0(a,t,e){if(e>=5&&Math.abs(a-t)>1e-5)return!1;let r=Math.min(ac(a),ac(t));return r<10&&(r=10),isNaN(e)||(r=Math.min(r,e)),or(a,r)===or(t,r)}function R0(a,t){typeof a=="string"&&(a=parseFloat(a));let e=Math.pow(10,t);return Math.round(a*e)/e}function v0(a,t){if(!a||typeof a!="string")return"";var e=/\d+\.\d{12,}/g,r=Au[t]||Math.pow(10,t)||10;return a.replace(e,function(i){return(Math.round(parseFloat(i)*r+1e-10)/r).toString()})}function ga(a,t,e){return arguments.length==3?a>=e.x&&a<=e.x+e.width&&t>=e.y&&t<=e.y+e.height:ga(a.x,a.y,t)}function N0(a,t,e,r,i,n){if(e>i){var s=e;e=i,i=s}if(r>n){var o=r;r=n,n=o}return a>=e&&a<=i&&t>=r&&t<=n}function E0(a){var t=[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x+a.width,y:a.y+a.height},{x:a.x,y:a.y+a.height}];return t}function B0(a,t){return ga(a.x,a.y,t)&&ga(a.x+a.width,a.y,t)&&ga(a.x,a.y+a.height,t)&&ga(a.x+a.width,a.y+a.height,t)}function _0(a,t){var e=Math.max(a.x+a.width,t.x+t.width),r=Math.max(a.y+a.height,t.y+t.height),i=Math.min(a.x,t.x),n=Math.min(a.y,t.y);return{x:i,y:n,width:e-i,height:r-n}}function O0(a){if(il(a)){for(var t=[],e=[],r=[],i=[],n=0;n<a.length;n++)t.push(a[n].x+a[n].width),e.push(a[n].y+a[n].height),r.push(a[n].x),i.push(a[n].y);var s=Math.max.apply(null,t),o=Math.max.apply(null,e),l=Math.min.apply(null,r),u=Math.min.apply(null,i);return{x:l,y:u,width:s-l,height:o-u}}}function D0(a,t){return t.x<a.x+a.width&&t.x+t.width>a.x&&t.y<a.y+a.height&&t.y+t.height>a.y}function ya(a,t,e,r){var i=a.x,n=a.y,s=t.x,o=t.y,l=e.x,u=e.y,h=s-i,c=o-n,f=h*h+c*c,d=((l-i)*h+(u-n)*c)/f;if((d>1||d<0)&&r)return null;var p=i+d*h,m=n+d*c;return{x:p,y:m}}function k0(a,t,e,r){var i=a.x,n=a.y,s=t.x,o=t.y,l=e.x,u=e.y,h=s-i,c=o-n,f=h*h+c*c;r===void 0&&(r=0);var d=((l-i)*h+(u-n)*c)/f;if(!(d>=1+r)&&!(d<=0)){var p=i+d*h,m=n+d*c,g=p-l,x=m-u,y={point:{x:p,y:m},distance2:g*g+x*x};return y}}function V0(a,t,e){var r=a.x,i=a.y,n=t.x,s=t.y,o=e.x,l=e.y,u=n-r,h=s-i,c=u*u+h*h;if(c===0)return(o-r)*(o-r)+(l-i)*(l-i);var f=((o-r)*u+(l-i)*h)/c,d=r+f*u,p=i+f*h,m=d-o,g=p-l;return m*m+g*g}function U0(a,t,e,r){var i=a.x,n=a.y,s=t.x,o=t.y,l=e.x,u=e.y,h=r.x,c=r.y,f=s-i,d=o-n,p=l-h,m=u-c,g=d*p-f*m;if(!g)return null;var x=(f*p*(u-n)-l*f*m+i*d*p)/g,y=(d*m*(l-i)-u*d*p+n*f*m)/-g;return{x,y}}function bp(a,t,e,r){function i(m,g){return m.x==g.x&&m.y==g.y}var n=i(a,e)||i(a,r)?a:i(t,e)||i(t,r)?t:null;if(n)return{x:n.x,y:n.y};var s,o,l,u,h,c,f,d,p;return s=t.x-a.x,o=t.y-a.y,l=r.x-e.x,u=r.y-e.y,f=l*o-u*s,f===0?!1:(d=e.x-a.x,p=e.y-a.y,c=(s*p-o*d)/f,h=(l*p-u*d)/f,c>=0&&c<=1&&h>=0&&h<=1?{x:a.x+h*s,y:a.y+h*o}:!1)}function gp(a,t,e){if(!t)return null;var r,i=t.length,n=null,s=t[0].x,o=t[0].y,l=s,u=o,h=a.x,c=a.y,f,d;for(r=1;r<i;r++)f=t[r].x,d=t[r].y,s>f&&(s=f),o>d&&(o=d),l<f&&(l=f),u<d&&(u=d);if(h<s-e||c<o-e||h>l+e||c>u+e)return null;for(r=1;r<i;r++)if(n=xa(a,t[r-1],t[r]),n.d<e)return n;return null}function xa(a,t,e){var r,i=+t.x,n=+t.y,s=+e.x,o=+e.y,l=+a.x,u=+a.y,h=s-i,c=o-n,f=l-i,d=u-n,p,m,g,x,y,P;return h===0&&c===0?{d:Math.sqrt(f*f+d*d),point:{x:i,y:n}}:(r=(f*h+d*c)/(h*h+c*c),r<0?{d:Math.sqrt(f*f+d*d),point:{x:i,y:n}}:r>1?(p=l-s,m=u-o,{d:Math.sqrt(p*p+m*m),point:{x:s,y:o}}):(y=i+r*h,P=n+r*c,g=l-y,x=u-P,{d:Math.sqrt(g*g+x*x),point:{x:y,y:P}}))}function sc(a,t,e,r){var i=e-a,n=r-t,s=Math.atan2(n,i);return s=s<0?s+Math.PI+Math.PI:s,s}function yp(a,t,e,r){var i=a-e,n=t-r;return i*i+n*n}function St(a,t,e,r){return Math.sqrt(yp(a,t,e,r))}function nl(a,t,e,r){if(t=+t,e=+e,r=+r,e===void 0||r===void 0||(t=xp(t),!t))return a.slice(0);for(var i=a.slice(0),n=i.length,s=0;s<n;s++)typeof i[s]!="number"&&(i[s]-=0);ns(Ja,t)||(Ja[t]=Math.sin(t*Math.PI/180),Mu[t]=Math.cos(t*Math.PI/180));var o=Ja[t],l=Mu[t];for(s=0;s<n;s+=2){var u=i[s],h=i[s+1],c=u-e,f=h-r;i[s]=e+l*c-o*f,i[s+1]=r+l*f+o*c}return i}function F0(a,t,e,r){var i=[a.x,a.y,a.x+a.width,a.y,a.x,a.y+a.height,a.x+a.width,a.y+a.height];i=nl(i,t,e,r);var n={x:Math.min(i[0],i[2],i[4],i[6]),y:Math.min(i[1],i[3],i[5],i[7])};return n.width=Math.max(i[0],i[2],i[4],i[6])-n.x,n.height=Math.max(i[1],i[3],i[5],i[7])-n.y,n}function lc(a,t,e){var r=Math.sin(e),i=Math.cos(e),n=a[0]-t[0],s=a[1]-t[1];return[n*i-s*r+t[0],s*i+n*r+t[1]]}function G0(a,t,e){return e=+e,lc(a,t,e*Math.PI/180)}function W0(a,t,e){return e=+e,e===null?a:(typeof e=="string"?e=-parseInt(e):e=-e,lc(a,t,e*Math.PI/180))}function xp(a){return a<0?(360+a%360)%360:a>=360?a%360:a}function Qi(a,t,e){var r=a-t;return e||(e=1e-10),(r>0?r:-r)<e}function H0(a,t){let e=a.x-t.x,r=a.y-t.y;return(e>0?e:-e)<.001&&(r>0?r:-r)<.001}function Bn(a,t){var e=a-t;return(e>0?e:-e)<.1}function z0(a,t){var e=a.x-t.x,r=a.y-t.y;return(e>0?e:-e)<.1&&(r>0?r:-r)<.1}function Y0(a,t,e,r,i){var n=gp({x:e,y:r},a,i+.5*t),s=null,o;return n&&[].forEach.call(a,function(l,u){if(!s&&a[u+1]){var h=Eu(n.point,l,a[u+1]);h&&(s=ya(l,a[u+1],{x:e,y:r}),o=St(e,r,s.x,s.y))}}),s&&{point:s,d:o}}function q0(a,t,e,r,i){return Math.pow(a-e,2)+Math.pow(t-r,2)<=Math.pow(i,2)}function X0(a,t){typeof a=="string"&&(a={x:+a.split(" ")[0],y:+a.split(" ")[1]});for(var e=a.x,r=a.y,i=!1,n=0,s=t.length,o=s-1;n<s;o=n,n++){typeof t[n]=="string"&&(t[n]={x:+t[n].split(" ")[0],y:+t[n].split(" ")[1]});var l=t[n].x,u=t[n].y,h=t[o].x,c=t[o].y;if(l==e&&u==r||h==e&&c==r)return!0;if(u<r&&c>=r||u>=r&&c<r){var f=l+(r-u)*(h-l)/(c-u);if(f==e)return!0;f>e&&(i=!i)}}return i}function Pp(a,t,e,r,i,n){if(t===0){var s=n*n-(e/a+r)*(e/a+r);return s>=0?[{x:-e/a,y:i+Math.sqrt(s)},{x:-e/a,y:i-Math.sqrt(s)}]:[]}var o,l,u,h,c,f,d,p;c=a*a+t*t,f=2*a*e-2*r*t*t+2*i*a*t,d=e*e+2*i*e*t+t*t*(r*r+i*i-n*n);var m=Cp(c,f,d);return c=m.a,f=m.b,d=m.c,p=f*f-4*c*d,p<-.001?[]:(p<0&&(p=0),p=Math.sqrt(p),o=(-f+p)/(2*c),l=(-f-p)/(2*c),Math.abs(t)<.1?(u=Math.sqrt(n*n-Math.pow(o-r,2))+i,Math.abs(a*o+t*u+e-0)>.001?(u=-Math.sqrt(n*n-Math.pow(o-r,2))+i,h=Math.sqrt(n*n-Math.pow(l-r,2))+i):h=-Math.sqrt(n*n-Math.pow(l-r,2))+i):(u=-(a*o+e)/t,h=-(a*l+e)/t),[{x:o,y:u},{x:l,y:h}])}function vu(a,t,e,r,i){var n=1e-4,s={x:e,y:r};if(Math.abs(a.x-t.x)<n&&Math.abs(a.y-t.y)<n)return(a.x-e)*(a.x-e)+(a.y-r)*(a.y-r)<n?[{x:a.x,y:t.y}]:[];var o=ya(a,t,s),l=St(e,r,o.x,o.y);if(l-i>n)return[];if(Math.abs(l-i)<n)return[o];if(l<n)var u=Math.atan2(t.y-a.y,t.x-a.x)+Math.PI/2;else u=Math.atan2(r-o.y,e-o.x);var h=Ur(o,u),c=Ur(s,u),f=Math.sqrt(i*i-l*l),d={x:h.x,y:h.y+f},p={x:h.x,y:h.y-f},m=Ur(d,-u),g=Ur(p,-u);return[m,g]}function Nu(a,t,e,r,i){var n=[];return vu(a,t,e,r,i).forEach(function(o){Eu({x:o.x,y:o.y},a,t)&&n.push({x:o.x,y:o.y})}),n}function Eu(a,t,e){var r=h(a)&&h(t)&&h(e);if(!r)return console.warn("Bad arguments"),null;var i=t.x-e.x>0?t.x:e.x,n=t.y-e.y>0?t.y:e.y,s=t.x-e.x>0?e.x:t.x,o=t.y-e.y>0?e.y:t.y,l=a.x,u=a.y;return l<=i+.001&&l>=s-.001&&u<=n+.001&&u>=o-.001;function h(c){return c?(c.x=Number(c.x),c.y=Number(c.y),isNaN(c.x)||isNaN(c.y)?(console.warn("Can not convert to Number, NaN found"),!1):!0):(console.warn("Empty input!"),!1)}}function hc(a,t,e,r=.5){var i=c(a)&&c(t)&&c(e);if(!i)return console.warn("Bad arguments"),null;var n=t.x-e.x>0?t.x:e.x,s=t.y-e.y>0?t.y:e.y,o=t.x-e.x>0?e.x:t.x,l=t.y-e.y>0?e.y:t.y,u=a.x,h=a.y;return u<=n+.001+r&&u>=o-.001-r&&h<=s+.001+r&&h>=l-.001-r;function c(f){return f?(f.x=Number(f.x),f.y=Number(f.y),isNaN(f.x)||isNaN(f.y)?(console.warn("Can not convert to Number, NaN found"),!1):!0):(console.warn("Empty input!"),!1)}}function Sp(a,t,e,r,i,n){if(e===void 0)throw new Error("getLinesIntersection(): c1 can`t be undefined");return a*i===r*t?null:{x:(t*n-i*e)/(a*i-r*t),y:(a*n-r*e)/(t*r-i*a)}}function Ur(a,t){var e=Math.cos(t),r=Math.sin(t);return{x:a.x*e+a.y*r,y:a.y*e-a.x*r}}function K0(a,t,e){return{x:a.x+t,y:a.y+e}}function wp(a,t){return{a:a.y-t.y,b:t.x-a.x,c:a.x*t.y-t.x*a.y}}function Z0(a,t,e){for(var r=!1,i,n,s=0,o=t.length-1;s<t.length;o=s++){if(i=t[s],n=t[o],Bu(a,i,n))return!e;i.y>a.y!=n.y>a.y&&a.x<(a.y-i.y)*(i.x-n.x)/(i.y-n.y)+i.x&&(r=!r)}return r}function j0(a,t,e,r,i){var n=wp(a,t),s=Sp(n.a,n.b,n.c,e,r,i);if(!s)return null;var o=Bu(s,a,t);return o?s:null}function Bu(a,t,e){return Eu(a,t,e)?Qi((a.x-t.x)*(e.y-t.y),(e.x-t.x)*(a.y-t.y),.001):!1}function Lp(a,t,e,r){if(t||e)return Math.abs(t*a.x+e*a.y+r)/Math.sqrt(t*t+e*e)}function Mp(a,t,e,r,i,n,s){s===void 0&&(s=.001);var o,l,u,h,c,f,d,p;if(Math.abs(t-i)>s){var m=(a*a-r*r+t*t-i*i+n*n-e*e)/(2*(t-i)),g=(a-r)/(t-i);if(o=1+g*g,l=-2*(a+(m-t)*g),u=a*a+Math.pow(m-t,2)-e*e,p=l*l-4*o*u,p>.001)h=(-l+Math.sqrt(p))/(2*o),c=(-l-Math.sqrt(p))/(2*o),f=m-g*h,d=m-g*c;else if(Math.abs(p)<.001)h=-l/(2*o),c=h,f=m-g*h,d=f;else return null}else if(Math.abs(a-r)>s)if(h=(a*a-r*r+n*n-e*e)/(2*(a-r)),c=h,o=1,l=-2*t,u=t*t-e*e+(h-a)*(h-a),p=l*l-4*o*u,p>.001)f=(-l+Math.sqrt(p))/(2*o),d=(-l-Math.sqrt(p))/(2*o);else if(p>-.001)f=-l/(2*o),d=f;else return null;else return null;return[{x:h,y:f},{x:c,y:d}]}function Q0(a,t,e){var r=Math.atan2(t.y,t.x)-Math.atan2(a.y,a.x);return e&&(r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI)),r}function $0(a,t,e){var r=(t.x-a.x)*(e.y-a.y)-(t.y-a.y)*(e.x-a.x);if(r>0)return"\u987A\u65F6\u9488";if(r<0)return"\u9006\u65F6\u9488";if(r===0)return"\u5171\u7EBF"}function Ap(a,t,e){var r=Math.min,i=Math.max;return r(t.x,e.x)<=a.x&&a.x<=i(t.x,e.x)&&r(t.y,e.y)<=a.y&&a.y<=i(t.y,e.y)&&(a.x-t.x)*(e.y-t.y)==(e.x-t.x)*(a.y-t.y)}function J0(a,t){if(!t||!t.length)return!1;for(var e=t.length,r=0;r<e-1;r++)if(Ap(a,t[r],t[r+1]))return!0;return!1}function uc(a,t){return a.x==t.x&&a.y==t.y}function e1(a,t){return Math.sqrt((a.x-t.x)*(a.x-t.x)+(a.y-t.y)*(a.y-t.y))}function t1(a){var t;return a.match(/,/)?t=a.trim().split(","):t=a.trim().split(" "),t.map(function(e,r,i){return r%2===0?{x:Number(e),y:Number(i[r+1])}:void 0}).filter(function(e){return e!==void 0})}function r1(a,t){return!a||!a.length?"":(t===void 0&&(t=3),t=Number(t),[].reduce.call(a,function(e,r){return e+=or(r.x,t)+" "+or(r.y,t)+" "},"").trim())}function i1(a,t,e){return!a||!a.length?[]:a.map(function(r){return{x:or(r.x*t,e||0),y:or(r.y*t,e||0)}})}function Ip(a,t,e,r,i){i||(i=0);var n=(a.x-e.x)*(t.y-e.y)-(a.y-e.y)*(t.x-e.x),s=(a.x-r.x)*(t.y-r.y)-(a.y-r.y)*(t.x-r.x);if(n*s>=i)return!1;var o=(e.x-a.x)*(r.y-a.y)-(e.y-a.y)*(r.x-a.x),l=o+n-s;if(o*l>=i)return!1;var u=o/(s-n),h=u*(t.x-a.x),c=u*(t.y-a.y);return{x:a.x+h,y:a.y+c}}function n1(a,t){var e=.001,r=$i(a),i=$i(t);if(!r||!i)return null;var n=_n(r),s=_n(i);if(!n||!s)return console.warn("Bad arc arguments!"),null;var o=St(n.x,n.y,r.M.x,r.M.y),l=St(s.x,s.y,i.M.x,i.M.y);let u=Mp(n.x,n.y,o,s.x,s.y,l);return u?(u=u.filter(function(h){return!!(ur(r,h,n)&&ur(i,h,s))}),u.length>0?u.length===2&&Math.abs(u[0].x-u[1].x)<e&&Math.abs(u[0].y-u[1].y)<e?[u[0]]:u:null):null}function $i(a){if(a=a.trim(),a[0]!=="M")return null;var t=a.slice(1).split("A");if(t.length!==2)return console.warn("Cannot handle multi arc!"),null;var e=t[0].trim().split(",").reduce(function(i,n){return i.concat(n.trim().split(" "))},[]),r=t[1].trim().split(",").reduce(function(i,n){return i.concat(n.trim().split(" "))},[]);return r.length!==7?(console.warn("Bad Arc arguments!"),null):r[0]!==r[1]?(console.warn("Eclipse is not supported"),null):{M:{x:Number(e[0]),y:Number(e[1])},A:{rx:Number(r[0]),ry:Number(r[1]),rotation:Number(r[2]),largeArc:Number(r[3]),clockwise:Number(r[4]),x:Number(r[5]),y:Number(r[6])}}}function _n(a){typeof a=="string"&&(a=$i(a));var t=a.M,e=a.A,r=a.A.rx,i=Math.atan2(e.y-t.y,e.x-t.x),n=Ur(t,i),s=Ur(e,i),o=St(n.x,n.y,s.x,s.y)/2;r<o&&(r=o);var l=Math.sqrt(r*r-o*o),u=a.A.largeArc===a.A.clockwise?1:-1,h={x:n.x+o,y:n.y-l*u};return Ur(h,-i)}function ur(a,t,e,r){r===void 0&&(r=.001),typeof a=="string"&&(a=$i(a)),e||(e=_n(a));var i=Math.atan2(t.y-e.y,t.x-e.x),n=Math.atan2(a.M.y-e.y,a.M.x-e.x),s=Math.atan2(a.A.y-e.y,a.A.x-e.x);if(Math.abs(n-i)<r||Math.abs(n-i)>Math.PI*2-r||Math.abs(s-i)<r)return!0;var o=Math.abs(n-s)>Math.PI==a.A.largeArc>0;return Math.abs(Math.abs(n-s)-Math.PI)<r&&(o=(n<=0&&s>=0)==(a.A.clockwise===1)),n>=s&&n>=i&&i>=s||n<=s&&n<=i&&i<=s?o:!o}function s1(a,t,e){var r=.001;if(typeof a=="string"&&(a=$i(a)),!a||!t||!e)return null;if(a.A.rx!==a.A.ry)return console.warn("Eclipse is not supported."),null;var i=_n(a),n=St(i.x,i.y,a.M.x,a.M.y),s=vu(t,e,i.x,i.y,n);return s=s.filter(function(o){return!!(ur(a,o,i)&&Bu(o,t,e))}),s.length===0?null:s.length===2&&Math.abs(s[0].x-s[1].x)<r&&Math.abs(s[0].y-s[1].y)<r?[s[0]]:s}function o1(a,t,e,r){var i,n,s,o,l,u,h,c={x:null,y:null},f={x:null,y:null},d=null;return d=Ip(a,t,e,r),d?{d:0,point:d}:(d=xa(a,e,r),l=d.d,o=1/0,l<o&&(o=l,c.x=d.point.x,c.y=d.point.y,f=a),d=xa(t,e,r),l=d.d,l<o&&(o=l,c.x=d.point.x,c.y=d.point.y,f=t),d=xa(e,a,t),l=d.d,l<o&&(o=l,c.x=d.point.x,c.y=d.point.y,f=e),d=xa(r,a,t),l=d.d,l<o&&(o=l,c.x=d.point.x,c.y=d.point.y,f=r),{d:o,nearP1:c,nearP2:f})}function a1(a,t,e,r){if(!(a&&t&&e&&r))return console.warn("Bad arguments!"),null;var i=Math.atan2(t.y-a.y,t.x-a.x);i<0&&(i+=Math.PI);var n=Math.atan2(r.y-e.y,r.x-e.x);return n<0&&(n+=Math.PI),Math.abs(n-i)}function _u(a,t,e){if(e=Number(e),!a||!t||isNaN(e))return console.warn("Bad arguments!"),null;if(a.x===t.x&&a.y===t.y)return console.warn("The input points should not be the same!"),null;var r=Math.atan2(t.y-a.y,t.x-a.x),i=Ur(a,r),n=Ur(t,r),s=n.x-i.x>0?1:-1,o={x:i.x+s*e,y:i.y};return Ur(o,-r)}function l1(a,t,e){var r=Math.atan2(t.y-a.y,t.x-a.x),i=Ur(a,r),n=Ur(e,r);return n.x>=i.x}function u1(a){var t=[];if(a){var e=a.replace(/[MLZz,]/g," ").trim().split(/\s+/),r;e.length%2!==0&&console.warn("Error occured in transforming path: odd length found!"),e.forEach(function(i,n){let s=Number(i);isNaN(s)&&console.warn("Error occured in transforming path :NaN found in "+i+"! Probably because input argument is not a simple path."),n%2===0?r={x:s}:(r.y=s,t.push(r))})}return t}function h1(a){if(!a.length)return[];for(var t=[],e={},r=0;r<a.length;r++){var i=typeof a[r]+a[r];e[i]||(t.push(a[r]),e[i]=!0)}return t}function c1(a,t){if(!t&&a.clockwise!==void 0)return a.clockwise;for(var e=0,r=1,i=a.length;r<i;r++)e+=(a[r].x-a[r-1].x)*(a[r].y+a[r-1].y);return e+=(a[0].x-a[i-1].x)*(a[0].y+a[i-1].y),a.clockwise=e<0}function Cp(a,t,e){var r=[a,t,e],i=n(r);return{a:a/i,b:t/i,c:e/i};function n(s){s=s.filter(function(h){return h!=0}).sort(function(h,c){return Math.abs(h)-Math.abs(c)});var o=u(s[s.length-1]),l=u(s[0]);if(o-l>10)return s.shift(),n(s);if(o<=0&&l<=0||l>=1)return s[0];return 1;function u(h){if(Math.abs(h)>=1){var c=Math.abs(h).toString();return c.indexOf("e")>=0?+c.split(/e/)[1]+1:c.split(".")[0].length}else return c=Math.abs(h).toString(),c.indexOf("e-")>=0?-c.split(/e-/)[1]+1:-c.match(/\.0*/g)[0].length-1}}}function oc(a,t,e){t=t||1,e=e||32;var r="",i=t,n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];a&&(i=Math.round(Math.random()*(e-t))+t);for(var s=0;s<i;s++){let o=Math.round(Math.random()*(n.length-1));r+=n[o]}return r}function f1(a,t,e,r){r===void 0&&(r=1e-4),typeof a=="string"&&(a=$i(a)),e||(e=_n(a));var i=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))/St(e.x,e.y,a.M.x,a.M.y)-1;return!!(Math.abs(i)<r&&ur(a,t,e))}function p1(a,t){var e=1e-4;typeof a=="string"&&(a=$i(a));var r,i,n,s,o,l,u,h,c,f,d,p=_n(a),m=St(p.x,p.y,a.M.x,a.M.y),g=a.M,x={x:a.A.x,y:a.A.y},y={x:x.x-p.x||0,y:-(x.y-p.y)||0},P={x:g.x-p.x||0,y:-(g.y-p.y)||0};if(t.x==g.x&&t.y==g.y)var L="startPoint";else t.x==x.x&&t.y==x.y?L="endPoint":L="other";if(r=p.y-t.y,i=t.x-p.x,n=p.x*t.y-p.y*t.x,s=-i,o=r,l=-s*p.x-o*p.y,u=Pp(s,o,l,p.x,p.y,m),u.length==2){h=u[0],c=u[1];var w={x:c.x-h.x,y:-(c.y-h.y)};L=="endPoint"?f=Math.atan2(w.y,w.x)-Math.atan2(P.y,P.x):f=Math.atan2(w.y,w.x)-Math.atan2(y.y,y.x),f>=Math.PI?f=2*Math.PI-f:f<=-Math.PI?f+=2*Math.PI:f>-Math.PI&&f<0&&(f=-f);var C={x:h.x-c.x,y:-(h.y-c.y)};L=="endPoint"?d=Math.atan2(C.y,C.x)-Math.atan2(P.y,P.x):d=Math.atan2(C.y,C.x)-Math.atan2(y.y,y.x),d>=Math.PI?d=2*Math.PI-d:d<=-Math.PI?d+=2*Math.PI:d>-Math.PI&&d<0&&(d=-d);var T=+a.A.largeArc==1,M=Math.abs(f-d)<e;if(L=="endPoint")if(M){if(ur(a,c,p))return C;if(ur(a,h,p))return w}else{if(f<d&&!T||f>d&&T)return C;if(f<d&&T||f>d&&!T)return w}else if(L=="startPoint")if(M){if(ur(a,c,p))return w;if(ur(a,h,p))return C}else{if(f<d&&!T||f>d&&T)return w;if(f<d&&T||f>d&&!T)return C}}}function d1(a,t,e){var r=.001;if(typeof a=="string"&&(a=$i(a)),!a||!t||!e)return null;if(a.A.rx!==a.A.ry)return console.warn("Eclipse is not supported."),null;var i=_n(a),n=vu(t,e,i.x,i.y,a.A.rx);return n=n.filter(function(s){return!!ur(a,s,i)}),n.length===0?null:n.length===2&&Math.abs(n[0].x-n[1].x)<r&&Math.abs(n[0].y-n[1].y)<r?[n[0]]:n}function m1(a,t,e,r){var i=+t.y-+a.y,n=+t.x-+a.x,s=Math.sqrt(i*i+n*n),o,l;if(Math.abs(a.x-t.x)<1e-12&&Math.abs(a.y-t.y)<1e-12){var u=Math.atan2(r,1);l=Math.cos(u)*e,o=Math.sin(u)*e}else if(r==="none"||r==1/0||r==-1/0){let c=i>0?e:-e;o=i+c,l=0}else if(s===0)l=Math.sqrt(e*e/(r*r+1)),o=l*r;else{var h=s+e;o=i*h/s,l=n*h/s}return{x:+a.x+l,y:+a.y+o}}function b1(a,t){function e(Y,$,ae){var le=Y.x-$.x,ge=Y.y-$.y,Me=ae.x-$.x,Je=ae.y-$.y,Dt=le*Je-ge*Me,rt=le*Me+ge*Je,Wt=Math.sqrt(le*le+ge*ge),kr=Math.sqrt(Me*Me+Je*Je),oe=rt/(Wt*kr);return oe=oe>1?1:oe<-1?-1:oe,Math.acos(oe)}var r,i,n,s,o,l,u=Ru(a);for(r=0;r<u.length;r++){if(l=u[r],!i&&!n&&!s&&!o){i=+l.x,n=+l.y,s=+l.x,o=+l.y;continue}+l.x<i&&(i=+l.x),+l.y<n&&(n=+l.y),+l.x>s&&(s=+l.x),+l.y>o&&(o=+l.y)}var h=s-i,c=o-n,f=Math.abs(t),d=f*2;if(d>=h||d>=c)return"";var p,m,g,x,y,P,L,w,C,T,M=[];for(r=0;r<u.length;r++)m=r===0?u[u.length-1]:u[r-1],p=u[r],g=r===u.length-1?u[0]:u[r+1],!(uc(p,g)||uc(p,m))&&(y=e(m,p,g),!(y===0||Qi(y,Math.PI))&&(x=f/Math.sin(y),P={x:m.x-p.x,y:m.y-p.y},w=Math.sqrt(Math.pow(P.x,2)+Math.pow(P.y,2)),C=x/w,P.x*=C,P.y*=C,L={x:g.x-p.x,y:g.y-p.y},w=Math.sqrt(Math.pow(L.x,2)+Math.pow(L.y,2)),C=x/w,L.x*=C,L.y*=C,T={x:p.x+P.x+L.x,y:p.y+P.y+L.y},M.push({x:T.x,y:T.y})));var E,W,k,O,se;for(r=0;r<M.length-3;r++)W=M[r],k=M[r+1],O=M[r+2],se=M[r+3],E=bp(W,k,O,se),E&&M.splice(r+1,2,E);return M.map(function(Y){return or(Y.x,2)+" "+or(Y.y,2)}).join(" ")}function g1(a,t,e,r){function i(l,u,h,c){return l*c-u*h}var n=i(t.x-a.x,e.x-r.x,t.y-a.y,e.y-r.y);if(n<=1e-6&&n>=-1e-6)return!1;var s=i(e.x-a.x,e.x-r.x,e.y-a.y,e.y-r.y)/n;if(s>1||s<0)return!1;var o=i(t.x-a.x,e.x-a.x,t.y-a.y,e.y-a.y)/n;return!(o>1||o<0)}function y1(a,t,e,r,i,n){var s=(i-e)*(a-e)+(n-r)*(t-r),o=(i-e)*(i-e)+(n-r)*(n-r),l=s/o,u=e+(i-e)*l,h=r+(n-r)*l;return s<=0?Math.sqrt((a-e)*(a-e)+(t-r)*(t-r)):s>=o?Math.sqrt((a-i)*(a-i)+(t-n)*(t-n)):Math.sqrt((a-u)*(a-u)+(h-t)*(h-t))}function x1(a,t,e,r,i,n){var s={x:i.cx,y:i.cy},o={x:a,y:t},l={x:e,y:r},u=!0,h=i.rx,c={x:+n[0],y:+n[1]},f={x:+n[7],y:+n[8]},d=St(s.x,s.y,a,t),p=St(s.x,s.y,e,r),m={A:{clockwise:+n[6],largeArc:+n[5],rotation:+n[4],rx:+n[3],ry:+n[2],x:+n[7],y:+n[8]},M:{x:+n[0],y:+n[1]}},g=0,x=0,y=0,P=0,L=0,w=0,C=0,T=0,M=0,E=[],W=ya(o,l,s,u);if(W)if(St(W.x,W.y,s.x,s.y)>h){var k=Nu(W,s,s.x,s.y,h)[0];ur(m,k,s)&&(g=St(W.x,W.y,k.x,k.y),E.push(g))}else k=_u(s,W,h),k&&ur(m,k,s)&&(g=St(W.x,W.y,k.x,k.y),E.push(g));var O=ya(o,l,c,u);O&&(x=St(O.x,O.y,c.x,c.y),E.push(x));var se=ya(o,l,f,u);if(se&&(y=St(se.x,se.y,f.x,f.y),E.push(y)),d>h){var Y=Nu(o,s,s.x,s.y,h)[0];ur(m,Y,s)&&(P=St(Y.x,Y.y,o.x,o.y),E.push(P))}else Y=_u(s,o,h),ur(m,Y,s)&&(P=St(Y.x,Y.y,o.x,o.y),E.push(P));return p>h?(Y=Nu(l,s,s.x,s.y,h)[0],ur(m,Y,s)&&(L=St(Y.x,Y.y,l.x,l.y),E.push(L))):(Y=_u(s,l,h),ur(m,Y,s)&&(L=St(Y.x,Y.y,l.x,l.y),E.push(L))),w=St(o.x,o.y,c.x,c.y),C=St(o.x,o.y,f.x,f.y),T=St(l.x,l.y,c.x,c.y),M=St(l.x,l.y,f.x,f.y),E.push(w,C,T,M),Math.min.apply(null,E)}function P1(a,t,e){var r=e.y-t.y,i=t.x-e.x,n=e.x*t.y-t.x*e.y;return Lp(a,r,i,n)}function S1(a){return{x:Math.round(a.x*1e4),y:Math.round(a.y*1e4)}}function w1(a,t){if(!t||!t.length)return a;let e=t.indexOf(a);if(e>=0)return t[e];e=0;let r=1/0;return t.forEach((i,n)=>{r>Math.abs(i-a)&&(e=n)}),t[e]}var Z=Math.PI*2,On=Math.PI,br=Math.PI/2,M1=Math.sin(Math.PI/180),A1=.5,I1=6.75;var vt=class{constructor(t,e){this.minDistance=Number.MAX_VALUE;this.p=t,this.p1=e,this.intersection()?(this.minDistance=0,this.minline=new S(b.ORIGIN,b.ORIGIN)):this.minline=this.minLine()}getDistance(){return this.minDistance}getLine(){return this.minline}intersection(){return Xe(this.p,this.p1)>0}minLine(){if(this.p instanceof S&&this.p1 instanceof S){let t=this.p,e=this.p1;return this.minDistanceForLines(t,e,this.minline)}else if(this.p instanceof R&&this.p1 instanceof S){let t=this.p,e=this.p1;return this.minDistanceForLineAndArc(t,e,this.minline)}else if(this.p instanceof S&&this.p1 instanceof R){let t=this.p1,e=this.p;return this.minDistanceForLineAndArc(t,e,this.minline)}else if(this.p instanceof R&&this.p1 instanceof R){let t=this.p,e=this.p1;return this.minDistanceForArcs(t,e,this.minline)}return this.minline}minDistanceForLines(t,e,r){let i=[t.start(),t.end(),e.start(),e.end()];for(let n=0;n<i.length;n++)n<2?r=this.point2LineMinLine(r,e,i[n]):r=this.point2LineMinLine(r,t,i[n]);return r}minDistanceForLineAndArc(t,e,r){r=this.point2LineMinLine(r,e,t.start()),r=this.point2LineMinLine(r,e,t.svgEnd);let i=vt.foot(e,t.center);return e.bbox().isContains(i)&&(r=this.point2ArcMinLine(r,t,i)),r=this.point2ArcMinLine(r,t,e.start()),r=this.point2ArcMinLine(r,t,e.end()),r}minDistanceForArcs(t,e,r){return r=this.concentricArc(t,e,r),Ut(t,e.center)&&Ut(e,t.center)?r=this.shortestLineForArcs(t,e,r):(r=this.point2ArcMinDistance(e.start(),t,r),r=this.point2ArcMinDistance(e.svgEnd,t,r),r=this.point2ArcMinDistance(t.start(),e,r),r=this.point2ArcMinDistance(t.svgEnd,e,r)),r}minLineForArcAndLine(t,e,r){let i=t.pointOn(r.angleD(t.center)),n=t.pointOn(t.center.angleD(r));return e=this.arcShortestLine(t,e,r,i),e=this.arcShortestLine(t,e,r,n),e}arcInnerLineFootSegment(t,e,r){let i=r.distance1(t.center);if(i!==0){let n=t.rx*(r.y-t.center.y)/i+t.center.y,s=t.rx*(r.x-t.center.x)/i+t.center.x,o=new S(new b(s,n),r);i=t.rx-i,i<this.minDistance&&(this.minDistance=i,e=o)}else{let n=new S(t.start(),r);i=t.rx-i,i<this.minDistance&&(this.minDistance=i,e=n)}return e}shortestLineForArcs(t,e,r){let i=t.center.angleD(e.center),n=e.center.angleD(t.center),s=t.pointOn(i),o=t.pointOn(n),l=e.pointOn(i),u=e.pointOn(n);return Ut(t,s)&&(r=this.arcShortestLine(e,r,s,l),r=this.arcShortestLine(e,r,s,u)),Ut(t,o)&&(r=this.arcShortestLine(e,r,o,l),r=this.arcShortestLine(e,r,o,u)),r}concentricArc(t,e,r){if(t.center.distance1(e.center)<1e-5&&t.rx===e.rx&&t.ry===e.ry){let i=new S(t.start(),e.svgEnd);i.length()<this.minDistance&&(this.minDistance=i.length(),r=i),i=new S(e.start(),t.svgEnd),i.length()<this.minDistance&&(this.minDistance=i.length(),r=i)}return r}point2ArcMinDistance(t,e,r){if(Ut(e,t)){let i=e.pointOn(t.angleD(e.center)),n=e.pointOn(e.center.angleD(t));r=this.arcShortestLine(e,r,t,i),r=this.arcShortestLine(e,r,t,n)}else r=this.minLineSegment(r,e.start(),t),r=this.minLineSegment(r,e.svgEnd,t);return r}point2ArcMinLine(t,e,r){if(Ut(e,r)){let i=r.distance1(e.center);i>e.rx||i>e.ry?t=this.minLineForArcAndLine(e,t,r):t=this.arcInnerLineFootSegment(e,t,r)}return t}point2LineMinLine(t,e,r){let i=vt.foot(e,r);return e.bbox().isContains(i)?t=this.minLineSegment(t,i,r):(t=this.minLineSegment(t,e.start(),r),t=this.minLineSegment(t,e.end(),r)),t}minLineSegment(t,e,r){let i=e.distance1(r);return i<this.minDistance&&(this.minDistance=i,t=new S(e,r)),t}arcShortestLine(t,e,r,i){if(Ut(t,i)){let n=new S(r,i),s=n.length();s<this.minDistance&&(this.minDistance=s,e=n)}return e}static foot(t,e){if(t.isPoint())return t.start();if(!N.eq(t.b,0)&&!N.eq(t.a,0)){let r=(t.b*t.b*e.x-t.a*t.b*e.y-t.a*t.c)/(t.b*t.b+t.a*t.a),i=(-t.a*t.b*e.x+t.a*t.a*e.y-t.b*t.c)/(t.b*t.b+t.a*t.a);return new b(r,i)}else return N.eq(t.b,0)&&!N.eq(t.a,0)?new b(t.start().x,e.y):!N.eq(t.b,0)&&N.eq(t.a,0)?new b(e.x,t.start().y):e}};var Pa=1e-4,U=new Float64Array(100);function cc(a,t,e,r,i){if(a.length>=t+i&&e.length>=r+i)for(;i-- >0;)e[r++]=a[t++];else throw new Error("arraycopy out of range")}function Xe(a,t){if(a instanceof S&&t instanceof S)return sl(a,t);if(a instanceof R&&t instanceof S)return pc(a,t);if(a instanceof S&&t instanceof R)return pc(t,a);if(a instanceof R&&t instanceof R)return Bp(a,t);throw new Error("not supported operation")}function rS(a,t){let e=a.primitives,r=t.primitives,i=e.length>r.length?r:e,n=e.length>r.length?e:r,s=!1;return i.some(o=>(n.some(l=>(s=Xe(o,l)>0,s)),s)),s}function iS(a,t){if(a instanceof S)return Ou(a,t);if(a instanceof R)return Du(a,t);throw new Error("not supported operation")}function Ou(a,t){let e=a.bbox();if(e.isContainsY1(t)){let r=new S(new b(e.minX-1,t),new b(e.maxX+1,t));return sl(r,a)>0?1:0}else return 0}function Du(a,t){if(a.rx===a.ry){let e=a.bbox();if(e.isContainsY1(t)){let r=new S(new b(e.minX-1,t),new b(e.maxX+1,t));return Dn(a,r)>0?1:0}else return 0}else throw new Error("not supported operation")}function ku(a,t){if(a.rx===a.ry){let e=a.bbox();if(e.isContainsY1(t)){let r=new S(new b(e.minX-1,t),new b(e.maxX+1,t)),i=Dn(a,r);return i>0?i:0}else return 0}else throw new Error("not supported operation")}function Tp(a,t,e){return isFinite(t)&&isFinite(e)?a.isContains2(t,e):!1}function Rp(a,t){let e=a.bbox().intersection1(t.bbox());if(e!=null){let r=it.crossProd3(t.start(),t.end(),a.start()),i=it.crossProd3(t.start(),t.end(),a.end());return Math.abs(r)<1e-8||Math.abs(i)<1e-8||r*i<0?e:null}else return null}function sl(a,t){if(a.isPoint1())return fc(t,a.start());if(t.isPoint1())return fc(a,t.start());{let e=Rp(a,t);if(e!=null){let r=a.start().x,i=a.start().y,n=a.end().x,s=a.end().y,o=t.start().x,l=t.start().y,u=t.end().x,h=t.end().y,c=it.crossProd2(r,i,o,l,u,h),f=it.crossProd2(n,s,o,l,u,h);if(c*f>0&&!N.eq(c,0)&&!N.eq(f,0))return 0;let d=it.crossProd2(o,l,r,i,n,s),p=it.crossProd2(u,h,r,i,n,s);if(d*p>0&&!N.eq(d,0)&&!N.eq(p,0))return 0;let m=0;if(N.eq(c,0)&&N.eq(f,0)){let g=e.UL(),x=e.UR(),y=e.LL(),P=e.LR();if(e.height()==0&&e.width()==0)U[m++]=g.x,U[m++]=g.y;else if(e.width()==0)U[m++]=g.x,U[m++]=g.y,U[m++]=y.x,U[m++]=y.y;else if(e.height()==0)U[m++]=g.x,U[m++]=g.y,U[m++]=x.x,U[m++]=x.y;else{let L=lr.area2(g.x,g.y,o,l,u,h),w=lr.area2(x.x,x.y,o,l,u,h);L<w?(U[m++]=g.x,U[m++]=g.y,U[m++]=P.x,U[m++]=P.y):(U[m++]=x.x,U[m++]=x.y,U[m++]=y.x,U[m++]=y.y)}}else if(N.eq(c,0))U[m++]=r,U[m++]=i;else if(N.eq(f,0))U[m++]=n,U[m++]=s;else{let g=Math.abs(c/(c-f));U[m++]=r+(n-r)*g,U[m++]=i+(s-i)*g}return m}else return 0}}function fc(a,t){return a.bbox().extendOfSize(1e-8).isContains(t)?a.isPoint1()?t.equals1(a.start())?(U[0]=t.x,U[1]=t.y,2):0:N.eq(lr.area2(a.start().x,a.start().y,a.end().x,a.end().y,t.x,t.y),0)?(U[0]=t.x,U[1]=t.y,2):0:0}function vp(a,t,e,r=.5){let i=Op(a,t,e);i.d<=r&&(a=i.point);let n=t.distance1(e),s=t.distance1(a),o=e.distance1(a);return!!Qi(s+o,n,.001)}function nS(a,t){let e=t.center,r=t.radius,i=t.start,n=t.end,s=t.midPoint,o=a.distance1(e),l=Qi(o,r,.001),u=new S(i,s),h=new S(n,s),c=new S(a,e),f=sl(u,c)||sl(h,c);return l&&!!f}function Dn(a,t){let e=a.bbox().intersection1(t.bbox());if(e!=null){let r=a.center.x,i=a.center.y,n=a.rx2,s=t.start().x,o=t.start().y,l=t.end().x,u=t.end().y,h=a.center.distance2(t.start()),c=a.center.distance2(t.end()),f=N.eq(h,n)?0:h>n?1:-1,d=N.eq(c,n)?0:c>n?1:-1,p=0;if(f===-1&&d===-1)return 0;if(f===0&&d===0)U[p++]=s,U[p++]=o,U[p++]=l,U[p++]=u;else if(f===1&&d===1){let m=vt.foot(t,a.center),g=m.distance2(a.center);if(N.greater(g,n))return 0;if(N.eq(g,n)){let x=m.distance2(a.start()),y=m.distance2(a.end());N.eq(x,0)?(U[p++]=a.start().x,U[p++]=a.start().y):N.eq(y,0)?(U[p++]=a.end().x,U[p++]=a.end().y):(U[p++]=m.x,U[p++]=m.y)}else{let x=a.start().x,y=a.start().y,P=a.end().x,L=a.end().y;if(lr.area2(x,y,s,o,l,u)<2e-8&&(U[p++]=x,U[p++]=y),lr.area2(P,L,s,o,l,u)<2e-8&&!a.start().equals1(a.end())&&(U[p++]=P,U[p++]=L),p<4){p=Np(r,i,s,o,l,u,p);let w=U[p-2],C=U[p-1],T=it.distance2(r,i,w,C);if(p-=2,N.eq(T,n))U[p++]=w,U[p++]=C;else if(T<n)p=Ri(n,r,i,s,o,w,C,p),p=Ri(n,r,i,w,C,l,u,p);else return 0}}}else if(f===-1||d===-1)p=Ri(n,r,i,s,o,l,u,p);else{let m=vt.foot(t,a.center),g=m.distance2(a.center);N.eq(g,n)?qi(s-m.x,2)+qi(o-m.y,2)>qi(l-m.x,2)+qi(u-m.y,2)?p=Ri(n,r,i,m.x,m.y,s,o,p):p=Ri(n,r,i,m.x,m.y,l,u,p):f===0?(p=Ri(n,r,i,m.x,m.y,s,o,p),(m.x-s)*(l-s)+(m.y-o)*(u-o)>0&&(p=Ri(n,r,i,m.x,m.y,l,u,p))):(p=Ri(n,r,i,m.x,m.y,l,u,p),(m.x-l)*(s-l)+(m.y-u)*(o-u)>0&&(p=Ri(n,r,i,m.x,m.y,s,o,p)))}if(p>0){cc(U,0,U,p,p);let m=0;e=e.extendOfSize(Pa);for(let g=0;g<p;g+=2){let x=U[p+g],y=U[p+g+1];m=Ep(a,e,m,y,x)}return m}else return 0}else return 0}function Ri(a,t,e,r,i,n,s,o){if(i==s){let P=a-(i-e)*(i-e);if(N.greater(P,0)){let L=Math.sqrt(P),w=t-L,C=t+L,T=Math.min(r,n),M=Math.max(r,n);return w>=T&&w<=M&&(U[o++]=w,U[o++]=i),C>=T&&C<=M&&(U[o++]=C,U[o++]=i),o}}let l=it.distance2(r,i,t,e)-a,u=it.distance2(n,s,t,e)-a,h=r,c=i,f=n,d=s,p=NaN,m=NaN,g=Number.POSITIVE_INFINITY,x=0;for(;g!==0;){x++;let P=Math.max(Math.min(Math.abs(l)/(Math.abs(l)+Math.abs(u)),.75),.25);if(p=h+(f-h)*P,m=c+(d-c)*P,h===p&&c===m||f===p&&d===m){Math.abs(l)>Math.abs(u)?(p=f,m=d,g=u):(p=h,m=c,g=l);break}else g=it.distance2(p,m,t,e)-a,g<0&&l>u||g>0&&l<u?(f=p,d=m,u=g):(h=p,c=m,l=g)}let y=Math.sqrt(a)-it.distance1(p,m,t,e);return(N.eq(0,g)||N.eq(0,y))&&(U[o++]=p,U[o++]=m),o}function Np(a,t,e,r,i,n,s){if(it.crossProd2(e,r,i,n,a,t)==0){let l=it.dotProd2(e,r,i,n,a,t),u=it.dotProd2(i,n,e,r,a,t);return l<0&&u<0?(U[s++]=a,U[s++]=t,s):l>=0?(U[s++]=i,U[s++]=n,s):(U[s++]=e,U[s++]=r,s)}else{let l=NaN,u=NaN,h=e,c=r,f=i,d=n,p=it.distance2(e,r,a,t),m=it.distance2(i,n,a,t),g=Number.POSITIVE_INFINITY,x=0;for(;g>0&&(x++,l=h+(f-h)*.5,u=c+(d-c)*.5,!(p==m||h==l&&c==u||f==l&&d==u));){g=it.distance2(l,u,a,t);let y=it.dotProd2(h,c,l,u,a,t);if(y==0)break;y<0?(f=l,d=u,m=g):(h=l,c=u,p=g)}return U[s++]=l,U[s++]=u,s}}function pc(a,t){if(a.rx===a.ry)return Dn(a,t);throw new Error("not supported")}function Ep(a,t,e,r,i){return isFinite(i)&&isFinite(r)&&Tp(t,i,r)&&Ut(a,new b(i,r))&&(U[e++]=i,U[e++]=r),e}function Bp(a,t){if(a.bbox().intersection1(t.bbox())!=null){if(a.rx===a.ry&&t.rx===t.ry)return _p(a,t);throw new Error("not supported operation")}return 0}function _p(a,t){let e=a.center.x,r=a.center.y,i=t.center.x,n=t.center.y,s=a.rx,o=t.rx,l=a.rx2,u=t.rx2,h=a.center.distance2(t.center),c=Math.sqrt(h),f=Math.abs(s-o),d=s+o;if(N.greater(c,d)||N.less(c,f))return 0;if(N.eq(c,d)){let p=new S(a.center,t.center),m=Dn(t,p),g=Sa(a,t,0,m);if(g!==0)return g;{let x=Dn(a,p);return Sa(a,t,0,x)}}else if(N.greater(f,0)&&N.greater(c,0)&&N.eq(c,f)){let p=0;if(s>o){let m=(s-o)/s;return U[0]=e+(i-e)/m,U[1]=r+(n-r)/m,Sa(a,t,p,2)}else{let m=(o-s)/o;return U[0]=i+(e-i)/m,U[1]=n+(r-n)/m,Sa(a,t,p,2)}}else if(N.eq(f,0)&&N.eq(c,0)){let p=0,m;return Ut(a,t.start())&&(U[p]=t.start().x,U[p+1]=t.start().y,p+=2,m=t.start()),Ut(a,t.end())&&(U[p]=t.end().x,U[p+1]=t.end().y,p+=2,m=t.end()),p===0?(Ut(t,a.start())&&(U[p]=a.start().x,U[p+1]=a.start().y,p+=2),Ut(t,a.end())&&(U[p]=a.end().x,U[p+1]=a.end().y,p+=2)):p===2&&(!m.equals1(a.start())&&Ut(t,a.start())&&(U[p]=a.start().x,U[p+1]=a.start().y,p+=2),!m.equals1(a.end())&&Ut(t,a.end())&&(U[p]=a.end().x,U[p+1]=a.end().y,p+=2)),p}else{let p=0,m=0,x=(h-u+l)/(c*2)/c,y=(i-e)*x+e,P=(n-r)*x+r,L=i-e,w=n-r,C=Math.max(s,o);if(Math.abs(L)<Math.abs(w)){let T=L/-w,M=P-T*y,E=new S(new b(y-C,T*(y-C)+M),new b(y+C,T*(y+C)+M));m+=Dn(t,E)}else{let T=w/-L,M=y-T*P,E=new S(new b(T*(P-C)+M,P-C),new b(T*(P+C)+M,P+C));m+=Dn(t,E)}return Sa(a,t,p,m)}}function Sa(a,t,e,r){if(r>0){let i=r*2;cc(U,0,U,i,r);for(let n=0;n<r;n+=2){let s=U[i+n],o=U[i+n+1],l=new b(s,o);Ut(a,l)&&Ut(t,l)&&(U[e++]=s,U[e++]=o)}}return e}function ss(a,t){return Math.abs(a-t)<=1e-6}function Ut(a,t){let e=a.bbox();if(t.x-e.minX>-Pa&&t.x-e.maxX<Pa&&t.y-e.minY>-Pa&&t.y-e.maxY<Pa)if(Math.abs(a.sweepAngle)>=180){let r=J.regularD(t.angleD(a.center));return ss(r,a.startAngle)||ss(r,a.startAngle+360)||ss(r,a.startAngle-360)||ss(r,a.endAngle())||ss(r,a.endAngle()+360)||ss(r,a.endAngle()-360)?!0:a.sweepAngle>0?(N.less(r,a.startAngle)&&(r+=360),N.greatereq(a.endAngle(),r)):(N.greater(r,a.startAngle)&&(r-=360),N.lesseq(a.endAngle(),r))}else return!0;else return!1}function sS(a,t){return t.primitives.some(e=>vp(a,e.start(),e.end()))}function oS(a,t,e,r=.5){return hc(a,t,e)?it.crossProd3(a,t,e)<Math.sin(Math.PI/180):!1}function aS(a){let t=[];a.points(1,e=>{t.push(e)});for(let e=0;e<a.primitives.length;e++){let r=a.primitives[e],i=a.primitives[e+1];for(;i&&Vu([r.start(),r.end()],[i.start(),i.end()]);)e++,r=a.primitives[e],i=a.primitives[e+1];return e==a.primitives.length-1}}function Vu(a,t){let e=a[1].x-a[0].x,r=a[1].y-a[0].y,i=t[1].x-t[0].x,n=t[1].y-t[0].y;if(e===0&&i!==0||e!==0&&i===0)return!1;if(e===0&&i===0)return!0;let s=r/e,o=n/i;return Qi(s,o,Math.sin(Math.PI/180))}function Op(a,t,e){var r,i=+t.x,n=+t.y,s=+e.x,o=+e.y,l=+a.x,u=+a.y,h=s-i,c=o-n,f=l-i,d=u-n,p,m,g,x,y,P;return h===0&&c===0?{d:Math.sqrt(f*f+d*d),point:new b(i,n)}:(r=(f*h+d*c)/(h*h+c*c),r<0?{d:Math.sqrt(f*f+d*d),point:new b(i,n)}:r>1?(p=l-s,m=u-o,{d:Math.sqrt(p*p+m*m),point:new b(s,o)}):(y=i+r*h,P=n+r*c,g=l-y,x=u-P,{d:Math.sqrt(g*g+x*x),point:new b(y,P)}))}function Dp(a,t,e,r){function i(m,g,x){return m instanceof b&&g instanceof b?Math.abs(m.x-g.x)<=x&&Math.abs(m.y-g.y)<=x:!1}var n=i(a,e,.5)||i(a,r,.5)?a:i(t,e,.5)||i(t,r,.5)?t:null;if(n)return!1;var s,o,l,u,h,c,f,d,p;return s=t.x-a.x,o=t.y-a.y,l=r.x-e.x,u=r.y-e.y,f=l*o-u*s,f===0?!1:(d=e.x-a.x,p=e.y-a.y,c=(s*p-o*d)/f,h=(l*p-u*d)/f,c>=0&&c<=1&&h>=0&&h<=1?new b(a.x+h*s,a.y+h*o):!1)}function ri(a,t){if(!a||!t||a.length!=t.length)return!1;let e="equals1";return!a.some((i,n)=>{let s=t[n],o=!1;return i&&s&&typeof i=="object"&&typeof s=="object"?typeof i[e]=="function"&&Vp(i,s)?o=!i[e].call(i,s):o=!(i===s||i.toString()===s.toString()):typeof i=="number"&&typeof s=="number"?o=!(kp(i,s)||Number.isNaN(i)&&Number.isNaN(s)):o=i!==s,o})}function kp(a,t,e=5){return Math.abs(a-t)*Math.pow(10,e)<1}function Vp(a,t){return!a||!t||typeof a!="object"||typeof t!="object"?a===t:a.constructor===t.constructor}function lS(a,t){return new S(a,t)}function uS(a){let t=[];for(let e=0;e<a.primitives.length;e++){let r=a.primitives[e];for(let i=e+1;i<a.primitives.length;i++){let n=a.primitives[i],s=Dp(r.start().mul(.1),r.end().mul(.1),n.start().mul(.1),n.end().mul(.1));s&&t.push(s.mul(10))}}return t}function hS(a,t,e,r){var i=t.y-a.y,n=a.x-t.x,s=i*a.x+n*a.y,o=r.y-e.y,l=e.x-r.x,u=o*e.x+l*e.y,h=i*l-o*n;if(h==0)return null;var c=(l*s-n*u)/h,f=(i*u-o*s)/h;return new b(c,f)}function cS(a,t,e){isNaN(e)&&(e=.001);let r=a.center,i=a.start(),n=a.rx,s=a.ry;var o=Math.atan2(t.y-r.y,t.x-r.x),l=Math.atan2(i.y-r.y,i.x-r.x),u=Math.atan2(s-r.y,n-r.x);if(Math.abs(l-o)<e||Math.abs(l-o)>Math.PI*2-e||Math.abs(u-o)<e)return!0;var h=Math.abs(l-u)>Math.PI===a.isLarge();return Math.abs(Math.abs(l-u)-Math.PI)<e&&(h=(l<=0&&u>=0)==!a.isCCW),l>=u&&l>=o&&o>=u||l<=u&&l<=o&&o<=u?h:!h}var ol=class{static getSweep(t){if(t.length>2){let e=0,r=t.length;for(let s=0;s<r-1;s++){let o=t[s],l=t[s+1];e+=(l.x+o.x)*(l.y-o.y)}let i=t[0],n=t[r-1];return e+=(i.x+n.x)*(i.y-n.y),e>0}else throw new Error("Unable to determine the direction of rotation!")}static isClose(t){return!!(t.primitives.length>0&&t.primitives[0].start().equals1(t.primitives[t.primitives.length-1].end()))}};function dc(a){let t=a.primitives,e=t[0],r=e instanceof R?e.sweepAngle%360:null;if(t.length===1&&e instanceof R&&(N.eq(r,0)||N.eq(Math.abs(r),360)))return!!e.isCCW;let i=new Array;return a.points(.1,n=>{i.push(n)}),ol.getSweep(i)}var gr=class{static zoomCorner(t,e){let r=new Array,i=new Array,n=new Array;return this.getPanPrimitive(t,r,n,e),this.rearrange(r,n),this.processStart(r,n),this.getResult(r,n,i,e),i.length>0?B.build2(i):null}static zoomPolygon(t,e){let r=new Array,i=new Array,n=new Array;return dc(t)&&(t=t.reverse().asClose()),this.getPanPrimitive(t,r,n,e),this.rearrange(r,n),this.processStart(r,n),this.getResult(r,n,i,e),i.length>0?B.build2(i):null}static zoomLines(t,e){return this.zoomPolygon(B.build2(t.primitives.concat(t.reverse().primitives)),e/2)}static getPanPrimitive(t,e,r,i){let n=t.primitives;for(let s of n){let o=this.panDistance(s,i);o!==void 0&&(e.push(o),r.push(s))}}static rearrange(t,e){let r=t.length,i=0;for(let o=0;o<r;o++){let l=e[o],u=t[o],h=o==r-1?t[0]:t[o+1];if(!(u instanceof R&&h instanceof R)&&!this.isCW(u.end(),h.start(),l.end())){if(Xe(u,h)!=0){i=o==r-1?0:o+1;break}}else{i=o;break}}let n=this.start4Index(e,i),s=this.start4Index(t,i);e.length=0,t.length=0,n.forEach(o=>{e.push(o)}),s.forEach(o=>{t.push(o)})}static processStart(t,e){let r=t.length;if(r>2){let i=t[r-1],n=t[0],s=e[r-1];if(!(i instanceof R&&n instanceof R)&&!this.isCW(i.end(),n.start(),s.end())){let o=Xe(i,n);for(let l=0;l<o;l+=2){let u=new b(U[l],U[l+1]);t[r-1]=this.generatePrimitive(i,i.start(),u),t[0]=this.generatePrimitive(n,u,n.end())}}}}static getResult(t,e,r,i){let n=t.length;for(let s=0;s<n;s++){let o=e[s],l=s===n-1?e[0]:e[s+1],u=s==n-1?0:s+1,h=u==n-1?e[0]:e[u+1],c=t[s],f=s==n-1?t[0]:t[s+1],d=u==n-1?t[0]:t[u+1];if(!(c instanceof R&&f instanceof R)&&!this.isCW(c.end(),f.start(),o.end())){let m=this.add(t,r,s,c,f,0);m=this.update(t,r,s,f,m);let g=this.generateArc(l,h,f,d,i);if(m=this.add(t,r,s,c,g,m),m=this.update(t,r,s,g,m),m>0)continue}r.push(c);let p=this.generateArc(o,l,c,f,i);p!==void 0&&r.push(p)}}static generateArc(t,e,r,i,n){if(n>0){let s=t.end(),o=e.start(),l=r.end(),u=i.start();if(l.distance2(u)>1e-8)if(s.equals(o)){let h=l.angleD(s),c=u.angleD(s);return R.build2(s,h,c,n,n,0)}else{let h=l.angleD(s),c=u.angleD(s),f=l.angleD(o),d=u.angleD(o),p=R.build2(s,h,c,n,n,0),m=R.build2(o,f,d,n,n,0);return p.pointOn(p.endAngle()).equals1(u)?p:m.pointOn(m.endAngle()).equals1(u)?m:p}}}static updateNews(t,e,r,i){let n=t.length,s=e==n-1?0:e+1;t[s]=this.generatePrimitive(r,i,r.end())}static add(t,e,r,i,n,s){if(s>0)return s;if(i!=null&&n!=null){let o=Xe(i,n);for(let l=0;l<o;l+=2){let u=new b(U[l],U[l+1]);e.push(this.generatePrimitive(i,i.start(),u)),this.updateNews(t,r,n,u);break}return o}else return 0}static update(t,e,r,i,n){if(n>0)return n;let s=e.length;if(s>0&&i!=null){let o=e[s-1],l=Xe(o,i);for(let u=0;u<l;u+=2){let h=new b(U[u],U[u+1]);e[s-1]=this.generatePrimitive(o,o.start(),h),this.updateNews(t,r,i,h)}return l}else return 0}static generatePrimitive(t,e,r){if(t instanceof S)return new S(e,r);if(t instanceof R){let i=t,n=e.angleD(i.center),s=r.angleD(i.center);return R.build2(i.center,n,s,i.rx,i.ry,i.sweep())}else throw new Error("not supported operation")}static start4Index(t,e){let r=t.length,i=new Array;for(let n=e;n<r;n++)i.push(t[n]);for(let n=0;n<e;n++)i.push(t[n]);return i}static isCW(t,e,r){let i=new S(r,t),n=new S(r,e),s=i.end().x-i.start().x,o=i.end().y-i.start().y,l=n.end().x-n.start().x,u=n.end().y-n.start().y;return!(s*u-o*l>0)}static panDistance(t,e){if(t instanceof S){if(t.isPoint())return;{let r=t.panDistance(e);return r.length()>1e-5?r:void 0}}else if(t instanceof R){let r=t;if(r.sweepAngle>0){if(r.rx-e<=0||r.ry-e<=0)return}else if(r.sweepAngle<0&&(r.rx+e<=0||r.ry+e<=0))return;return r=r.panDistance(e),r.start().distance1(r.end())>1e-5||N.eq(Math.abs(r.sweepAngle),360)?r:void 0}else throw new Error("not supported operation")}};function mc(a,t=.05){if(a.length<3)return a.slice();let e=a[0],r=[e];for(let l=1;l<a.length;l++){let u=a[l];e.equals1(u)||r.push(u),e=u}if(e!==r[r.length-1]&&(r.length!==1&&r.pop(),r.push(e)),t<0)return r;let i=r[1],n=i.sub(r[0]).normalize(),s=0,o=[r[0]];for(let l=2;l<r.length;l++){let u=r[l],h=u.sub(i).normalize();s+=Math.acos(n.dot(h)),s>t&&(o.push(i),s=0),i=u,n=h}return o.push(i),o}var Up=1e-5,Fp=1,we=class extends ji{constructor(e){super();if(e.length<2)throw new Error("Bezier needs at least 2 endpoints");this.controls=e.slice()}build1(e){let r=[];return dr(e,(i,n)=>(r.push(n),!0)),new we(r)}start(){return this.controls[0]}end(){return this.controls[this.controls.length-1]}static pointOn(e,r){if(r.length<1)throw new Error("bezier must have at least 1 point");if(r.length===1)return r[0];{let i=new Array(r.length-1);for(let n=1;n<r.length;n++){let s=r[n-1],o=r[n],l=(o.x-s.x)*e,u=(o.y-s.y)*e;i[n-1]=s.add1(l,u)}return we.pointOn(e,i)}}clip1(e,r,i,n){if(i.push(r[0]),n.push(r[r.length-1]),r.length<2)throw new Error("bezier clip must have at least 2 point");if(r.length===2){let s=r[0],o=r[1],l=(o.x-s.x)*e,u=(o.y-s.y)*e,h=s.add1(l,u);i.push(h),n.push(h)}else{let s=new Array(r.length-1);for(let o=1;o<r.length;o++){let l=r[o-1],u=r[o],h=(u.x-l.x)*e,c=(u.y-l.y)*e;s[o-1]=l.add1(h,c)}this.clip1(e,s,i,n)}}clip(e){let r=[],i=[];return this.clip1(e,this.controls,r,i),[new we(r),new we(i.reverse())]}toBezier(){return this}toString(){return"Bezier ["+this.controls.join(" ")+"]"}bbox(){return this._bbox||(this._bbox=new H().ext3(this.points(.1)).build()),this._bbox}multiply3(e){let r=new Array(this.controls.length);for(let i=0;i<this.controls.length;i++){let n=this.controls[i];r[i]=n.multiply3(e)}return new we(r)}stroke(e,r,i){let n=gr.zoomLines(B.build4(this.points(Fp)),e);return i===0?n:n.reverse()}points(e){if(this.controls.length===2)return this.controls.slice();let r=e*e,i=this.controls[0],n=.5;for(;n>Up&&!(i.distance2(we.pointOn(n,this.controls))<=r);n*=.5);let s=Math.ceil(1/n);n=1/s;let o=[this.start()],l=0;for(let u=1;u<s;u++)l+=n,o.push(we.pointOn(l,this.controls));return o.push(this.end()),mc(o)}getPointsBySlope(e){if(this.controls.length===4)return this.getPointsBySlope4(e);throw new Error("Currently, only 4 control points are supported!")}getPointsBySlope4(e){let[r,i,n,s]=this.controls,o=-3*r.x+9*i.x-9*n.x+3*s.x,l=6*r.x-12*i.x+6*n.x,u=-3*r.x+3*i.x,h=[];if(Number.isFinite(e)){let c=-3*r.y+9*i.y-9*n.y+3*s.y,f=6*r.y-12*i.y+6*n.y,d=-3*r.y+3*i.y,p=c-o*e,m=f-l*e,g=d-u*e,x=-m/(2*p),y=Math.sqrt(qi(m,2)-4*p*g)/(2*p),P=x+y;P>=0&&P<=1&&h.push(we.pointOn(P,this.controls));let L=x-y;L>=0&&L<=1&&h.push(we.pointOn(L,this.controls))}else{let c=-l/(2*o),f=Math.sqrt(qi(l,2)-4*o*u)/(2*o),d=c+f;d>=0&&d<=1&&h.push(we.pointOn(d,this.controls));let p=c-f;p>=0&&p<=1&&h.push(we.pointOn(p,this.controls))}return h}reverse(){let e=[...this.controls].reverse();return new we(e)}};var os=class{constructor(){this.textCache=new Map;this.numCache=new Array(20);this.boxCache=new Array(4);this.textOffsetCache=new Array(9);this.BuildLineCache=new Array(7);this.BuildTrackCache=new Array(7);this.BuildViaCache=new Array(11);this.BuildBoxCache=new Array(10);this.BuildArcCache=new Array(10);this.BuildArcTrackCache=new Array(10);this.BuildTextCache=new Array(7);this.BuildPadStyleCache=new Array(4);this.BuildPadCache=new Array(12);this.ARRAY1=new Array(1);this.ARRAY2=new Array(2);this.ARRAY3=new Array(3);this.ARRAY4=new Array(4);this.ARRAY5=new Array(5);this.ARRAY6=new Array(6);this.ARRAY7=new Array(7);this.ARRAY8=new Array(8);this.ARRAY9=new Array(9);this.ARRAY10=new Array(10);this.ARRAY11=new Array(11);this.ARRAY12=new Array(12);this.textOffsetCache[0]=b.ORIGIN,this.textOffsetCache[1]=new b(0,-.5),this.textOffsetCache[2]=new b(0,-1),this.textOffsetCache[3]=new b(-.5,0),this.textOffsetCache[4]=new b(-.5,-.5),this.textOffsetCache[5]=new b(-.5,-1),this.textOffsetCache[6]=new b(-1,0),this.textOffsetCache[7]=new b(-1,-.5),this.textOffsetCache[8]=new b(-1,-1)}static getCache(){return os.instance==null&&(os.instance=new os),os.instance}},Q=os;Q.instance=null;var R=class extends ji{constructor(e,r,i,n,s){super();this._rx2=null;this._ry2=null;this._svgEnd=null;this.__bbox=null;this.rx=e,this.ry=r,this.center=i,this.startAngle=n,this.sweepAngle=s,this._start=b.ORIGIN,this._end=b.ORIGIN,this._start=this.pointOn(n),this._end=this.pointOn(n+s)}get rx2(){return this._rx2==null&&(this._rx2=this.rx*this.rx),this._rx2}get ry2(){return this._ry2==null&&(this._ry2=this.ry*this.ry),this._ry2}get svgEnd(){return this._svgEnd==null&&(this._svgEnd=this.getSvgEnd(this.startAngle,this.sweepAngle,this._start,this._end)),this._svgEnd}getSvgEnd(e,r,i,n){let s=r>=0?-.01:.01,o=e+r;for(;(r>=0&&o>e||r<0&&o<e)&&i.distance2(n)<2e-4;)s*=2,o+=s,n=this.pointOn(o);return n}static build1(e,r,i,n,s,o,l=1){D.positive(i),D.positive(n);let u=e.equals(r);if(u)return new R(i,n,e,0,s?360:0);{let h=e.x,c=-e.y,f=r.x,d=-r.y,p=o===0,m=(h-f)/2,g=(c-d)/2,x=Math.cos(0),y=Math.sin(0),P=x*m+y*g,L=-y*m+x*g;i=Math.abs(i),n=Math.abs(n);let w=i*i,C=n*n,T=P*P,M=L*L,E=s===p?-1:1,W=(w*C-w*M-C*T)/(w*M+C*T);W=W<0?0:W;let k=E*Math.sqrt(W),O=k*(i*L/n),se=k*-(n*P/i),Y=(h+f)/2,$=(c+d)/2,ae=Y+(x*O-y*se),le=$+(y*O+x*se),ge=(P-O)/i,Me=(L-se)/n,Je=(-P-O)/i,Dt=(-L-se)/n,rt,Wt;Wt=Math.sqrt(ge*ge+Me*Me),rt=ge,E=Me<0?-1:1;let kr=J.toDegrees(E*Math.acos(rt/Wt));Wt=Math.sqrt((ge*ge+Me*Me)*(Je*Je+Dt*Dt)),rt=ge*Je+Me*Dt,E=ge*Dt-Me*Je<0?-1:1;let oe=rt/Wt,ne;oe<-1?ne=Math.acos(-1):oe>1?ne=Math.acos(1):ne=Math.acos(oe);let pe=J.toDegrees(E*ne);!p&&pe>0?pe-=360:p&&pe<0&&(pe+=360),D.normal(kr),D.normal(pe);let Ce=m*m/w+g*g/C,Oe=e.distance1(r)/2;i<Oe&&n<Oe&&(i*=Math.sqrt(Ce),n*=Math.sqrt(Ce));let We=u?0:J.regularD(-kr),je=u?s?360:0:-pe;return new R(i,n,new b(ae,-le),We,je)}}static build2(e,r,i,n,s,o,l=1){D.positive(n),D.positive(s),D.normal(r),D.normal(i);let u;return r===i?(r=J.regularD(r),i=J.regularD(i),u=0):(r=J.regularD(r),i=J.regularD(i),o===1?i<=r&&(i+=360):i>=r&&(r+=360),u=i-r),new R(n,s,e,J.regularD(r),u)}static build3(e,r,i,n,s,o=1){return D.positive(n),D.positive(s),D.normal(i),new R(n,s,e,J.regularD(r),i)}static build4(e,r,i,n,s,o,l=1){let u=e.angleD(i),h=r.angleD(i);return R.build2(i,u,h,n,s,o,l)}static build5(e,r,i){i=J.toRadians(i);let n=r.sub(e),s=new b(-n.y,n.x).normalize(),o=Math.abs(i)/2,l;if(o!=0)l=n.length()/2/Math.sin(o);else throw new Error("Can't represent circle!!!");let u=s.rotate(b.ORIGIN,o),h,c;i>0?(h=1,c=r.add(u.scale(l))):(h=0,c=e.sub(u.scale(l)));let f=J.toDegrees(e.angle(c)),d=J.toDegrees(r.angle(c));return R.build2(c,f,d,l,l,h)}static buildCircle(e,r,i){return R.build2(e,0,360,r,r,i)}start(){return this._start}end(){return this._end}isLarge(){return Math.abs(this.sweepAngle)>180}sweep(){return this.sweepAngle>=0?1:0}get isCCW(){return this.sweepAngle>=0}endAngle(){return this.startAngle+this.sweepAngle}pointOn(e){e=J.regularD(e);let r=this.rx,i=this.ry;if(e===0)return this.center.add1(r,0);if(e===90)return this.center.add1(0,i);if(e===180)return this.center.add1(-r,0);if(e===270)return this.center.add1(0,-i);{let n=this.rx2,s=this.ry2,o=Math.tan(J.toRadians(e)),l=o*o,u=Math.sqrt(n*s/(n+s/l)),h=Math.sqrt(n*s/(s+n*l));return e>90&&e<270&&(h=-h),e>180&&e<360&&(u=-u),isNaN(h)&&(h=0),isNaN(u)&&(u=0),this.center.add1(h,u)}}exchangeSweep(){return R.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,this.rx,this.ry)}exchangeSweepAndStart(){return R.build1(this.end(),this.start(),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}exchangeSweep1(){return R.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle+.01,this.rx,this.ry)}mirror(e){let r=this.start(),i=this.end();return r.equals(i)?R.build3(this.center.mirrorY(),0,360,this.rx,this.ry):R.build1(r.mirrorY(e),i.mirrorY(e),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}sectorArea(){return Math.abs(this.sweepAngle)/360*Math.PI*this.rx*this.ry}area(){let e=lr.area(this.center,this._start,this.pointOn(this.endAngle()));return this.sectorArea()-e}multiply3(e){let r;e.isMirrored()?r=-this.sweepAngle:r=this.sweepAngle;let i;return e.equals(me.ROT_90)?i=J.regularD(this.startAngle+90):e.equals(me.ROT_N90)?i=J.regularD(this.startAngle-90):i=J.transformD(this.startAngle,e),R.build3(this.center.multiply3(e),i,r,e.iScale*this.rx,e.iScale*this.ry)}toBezier(){if(Math.abs(this.sweepAngle)>90)throw new Error("not support!");let e=this.start(),r=this.end(),i=J.toRadians(this.sweepAngle)/2,n=4/3*(1-Math.cos(i))/Math.sin(i);return new we([e,e.add(new b(n,0).multiply3(me.rotateD(this.startAngle+90))),r.add(new b(n,0).multiply3(me.rotateD(this.endAngle()-90))),r])}buildBBox(){let e=Q.getCache().boxCache,r=this.startAngle+this.sweepAngle;if(e[0]=Math.min(this._start.x,this._end.x),e[1]=Math.max(this._start.x,this._end.x),e[2]=Math.min(this._start.y,this._end.y),e[3]=Math.max(this._start.y,this._end.y),this.sweepAngle>0){let i=0;for(;i<r;){if(i>this.startAngle){let n=this.pointOn(i);e[0]=Math.min(e[0],n.x),e[1]=Math.max(e[1],n.x),e[2]=Math.min(e[2],n.y),e[3]=Math.max(e[3],n.y)}i+=90}}else if(this.sweepAngle<0){let i=360;for(;i>r;){if(i<this.startAngle){let n=this.pointOn(i);e[0]=Math.min(e[0],n.x),e[1]=Math.max(e[1],n.x),e[2]=Math.min(e[2],n.y),e[3]=Math.max(e[3],n.y)}i-=90}}return new j(e[0],e[1],e[2],e[3])}bbox(){return this.__bbox==null&&(this.__bbox=this.buildBBox()),this.__bbox}length(){return Math.abs(this.rx*this.sweepAngle*Math.PI/180)}toString(){return Pe.format("Arc [start=%s, end=%s, rx=%s, ry=%s, center=%s, startAngle=%s, sweepAngle=%s]",this._start,this._end,this.rx,this.ry,this.center,this.startAngle,this.sweepAngle)}stroke(e,r,i){let n=e/2,s=this.rx+n,o=this.ry+n,l=this.rx-n,u=this.ry-n,h=new me;l<0&&(l=-l,h=h.multiply3(me.MIRROR_Y)),u<0&&(u=-u,h=h.multiply3(me.MIRROR_X)),l===0&&(l=.001),u===0&&(u=.001),h=h.setOrigin1(this.center);let c,f;switch(i===this.sweep()?(c=R.build3(this.center,this.startAngle,this.sweepAngle,s,o),f=R.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,l,u)):(c=R.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,s,o),f=R.build3(this.center,this.startAngle,this.sweepAngle,l,u)),f=f.multiply3(h),r){case 1:{let d=i===1?180:-180,p=i===this.sweep()?this.pointOn(this.endAngle()):this.pointOn(this.startAngle),m=i===this.sweep()?this.pointOn(this.startAngle):this.pointOn(this.endAngle()),g=c.pointOn(c.endAngle()).angleD(p),x=f.pointOn(f.endAngle()).angleD(m);return B.build2([c,R.build3(p,g,d,n,n),f,R.build3(m,x,d,n,n)])}default:return B.build2([c,f])}}points1(e){let r=2*Math.PI*Math.max(this.rx,this.ry)*(Math.abs(this.sweepAngle)/360),i=Math.ceil(r/e),n=new Array(i+1),s=this.sweepAngle/i,o=this.startAngle;for(let l=0;l<=i;l++,o+=s)n[l]=this.pointOn(o);return n}points(e){if(this.rx<=e)return[this.start(),this.svgEnd];{let r=(this.rx-e)/this.rx,i=Math.ceil(Math.abs(this.sweepAngle/J.toDegrees(Math.acos(r))/2));i=Math.max(i,2);let n=new Array(i+1),s=this.sweepAngle/i,o=this.startAngle;for(let l=0;l<=i;l++,o+=s)n[l]=this.pointOn(o);return n}}panDistance(e){return this.sweepAngle>0?new R(this.rx-e,this.ry-e,this.center,this.startAngle,this.sweepAngle):new R(this.rx+e,this.ry+e,this.center,this.startAngle,this.sweepAngle)}get bulge(){let r=Math.abs(or(this.sweepAngle,3))/180*Math.PI;return Math.tan(r/4)}get midPoint(){let e=this.startAngle,r=this.endAngle(),i=this.sweep(),n=this.center,s=this.rx;if(i==1)if(r>e){let o=(r-e)/2+e;return n.add(new b(Math.cos(o),Math.sin(o)).mul(s))}else{if(r==e)return n.add(new b(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(s));{let o=(r+Z-e)/2+e;return n.add(new b(Math.cos(o),Math.sin(o)).mul(s))}}else if(r>e){let o=(e+Z-r)/2+r;return n.add(new b(Math.cos(o),Math.sin(o)).mul(s))}else{if(r==e)return n.add(new b(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(s));{let o=(e-r)/2+r;return n.add(new b(Math.cos(o),Math.sin(o)).mul(s))}}}equals1(e){let r=J.regularD(this.startAngle),i=J.regularD(this.sweepAngle),n=J.regularD(e.startAngle),s=J.regularD(e.sweepAngle);return ri([this.rx,this.ry,this.center,Math.abs(i)],[e.rx,e.ry,e.center,Math.abs(s)])&&(ri([i,r],[s,n])||ri([J.regularD(r+i)],[n]))}inArea(e,r){let i=e.x,n=e.y,s=this.center,o=this.rx,l=J.toRadians(this.startAngle);this.sweep()==0&&(l=J.toRadians(this.endAngle()));let u=J.toRadians(this.endAngle());this.sweep()==0&&(u=J.toRadians(this.startAngle));let h=o-r/2,c=o+r/2;var f=i-s.x,d=n-s.y,p=Math.atan2(d,f);if(p<0&&(p+=Z),l<=u&&p>=l&&p<=u||l>u&&(p>=l&&p<=Z||p>=0&&p<=u)||l==u){var m=Math.sqrt(f*f+d*d);return m<=c&&m>=h}else{var m=(c+h)/2,g=new b(s.x+Math.cos(l)*m,s.y+Math.sin(l)*m),x=new b(s.x+Math.cos(u)*m,s.y+Math.sin(u)*m),y=i-g.x,P=n-g.y,L=i-x.x,w=n-x.y;return y*y+P*P<=r*r/4?!0:L*L+w*w<=r*r/4}}isCircle(){return(N.eq(Math.abs(this.sweepAngle),360)||this._start.equals1(this._end))&&this.rx==this.ry}reverse(){return R.build1(this.end(),this.start(),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}};var S=class extends ji{constructor(e,r){super();this._a=null;this._b=null;this._c=null;this.__bbox=null;this._hashed=null;this._direct=null;this._start=e,this._end=r}get a(){return this._a===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._a}get b(){return this._b===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._b}get c(){return this._c===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._c}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}get direct(){return this._direct==null&&(this._direct=this._end.sub(this._start).normalize()),this._direct}toBezier(){return new we([this._start,this._end])}_hashCode(){let e=31,r=1;return r=e*r+this._start.hashCode(),r=e*r+this._end.hashCode(),r}start(){return this._start}end(){return this._end}center(){let e=this.start(),r=this.end();return e.add(r).mul(.5)}panDistance(e){let r=this._end.sub(this._start).normalize(),i=new b(-r.y,r.x).mul(e),n=this._start.add(i),s=this._end.add(i);return new S(n,s)}isPoint(){return this._start.distance2(this._end)<=1e-8?!0:this._start.equals(this._end)}isPoint1(){return this._start.distance2(this._end)<=1e-8?!0:this._start.equals1(this._end)}length(){return this._start.distance1(this._end)}toString(){return"Line [start="+this._start+", end="+this._end+"]"}bbox(){if(this.__bbox==null){let e=Q.getCache().boxCache;e[0]=Math.min(this._start.x,this._end.x),e[1]=Math.max(this._start.x,this._end.x),e[2]=Math.min(this._start.y,this._end.y),e[3]=Math.max(this._start.y,this._end.y),this.__bbox=new j(e[0],e[1],e[2],e[3])}return this.__bbox}multiply3(e){return new S(this._start.multiply3(e),this._end.multiply3(e))}hashCode(){return this.hashed}equals(e){let r=e;return this.hashed===r.hashed&&this._start.equals(r.start)&&this._end.equals(r.end)}equals1(e){let r=[this.start(),this.end()],i=[e.start(),e.end()];return ri(r,i)||ri(r,i.reverse())}stroke(e,r,i){let n,s,o;this._end.x<this._start.x?(s=this._start.x-this._end.x,o=this._start.y-this._end.y,n=this._end):(s=this._end.x-this._start.x,o=this._end.y-this._start.y,n=this._start);let l=Math.sqrt(s*s+o*o),u=e/2,h,c,f;r===2?(c=-u,f=l+u):(c=0,f=l),r===0||r===2?i===0?h=B.build5([c,-u,c,u,f,u,f,-u]):h=B.build5([c,u,c,-u,f,-u,f,u]):i===0?h=B.build2([R.build3(new b(c,0),-90,-180,u,u),R.build3(new b(f,0),90,-180,u,u)]):h=B.build2([R.build3(new b(c,0),90,180,u,u),R.build3(new b(f,0),-90,180,u,u)]);let d=Math.atan2(o,s),p=me.rotate(d).translate1(n);return h=h.asClose(),h.multiply3(p)}points(e){return[this._start,this._end]}mirror(e){return new S(this.start().mirrorY(e),this.end().mirrorY(e))}reverse(){return new S(this._end,this._start)}inArea(e,r,i){let n=e.x,s=e.y,o=this._start,l=this._end,u=i==1,h=n-o.x,c=s-o.y,f=n-l.x,d=s-l.y,p=l.x-o.x,m=l.y-o.y,g=new b(-m,p).normalize(),x=p+g.x*r/2,y=m+g.y*r/2,P=x*x+y*y,L=h*h+c*c,w=f*f+d*d,C=Math.abs(h*m-c*p)/2,M=Math.sqrt(p*p+m*m)*r/4;if(C<=M&&L<=P&&w<=P){if(u)return!0;{let E=new b(n,s).sub(l).normalize(),W=new b(n,s).sub(o).normalize(),k=new b(g.x,g.y).cross(E),O=new b(g.x,g.y).cross(W);return k>=0&&O<=0}}else if(u){let E=r/2;return L<=E*E?!0:w<=E*E}else return!1}isParallel(e,r=!1){let i=N.eq(Math.abs(this.direct.cross(e.direct)),0),n=!r||N.greatereq(this.direct.dot(e.direct),0);return i&&n}};function Fu(a){if(a instanceof S)a=new S(a.end(),a.start());else if(a instanceof R)a=a.exchangeSweep();else if(a instanceof we)a=new we(a.controls.slice().reverse());else throw new Error("bug");return a}var Uu=class{constructor(){this.length=0;this.box=null;this.pt=null;this.i=0}calcBBox(t){let e=new H;for(this.length=t.length,this.box=null,this.pt=null,this.i=0;this.i<this.length;this.i++)this.pt=t[this.i],this.box=this.pt.bbox(),e.ext1(this.box);return e.build()}},Gp=new Uu,B=class{constructor(t,e){this.__bbox=null;this.primitives=t,this.__bbox=e}static calcBBox(t){return Gp.calcBBox(t)}static build1(t){let e=[],r=null;return Xi(t,(i,n)=>{let s=n.start();return r!==null&&!s.equals(r)&&e.push(new S(r,s)),e.push(n),r=n.end(),!0}),e.length===0&&r!=null&&e.push(new S(r,r)),new B(e)}static build2(t){return B.build1(Ir(t))}static build3(t){let e=[],r=null;return Xi(t,(i,n)=>(r!==null&&e.push(new S(r,n)),r=n,!0)),new B(e)}static build4(t){return this.build3(Ir(t))}static build5(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(new b(t[r],t[r+1]));return this.build4(e)}static build6(t){return B.build4([t.LL(),t.LR(),t.UR(),t.UL(),t.LL()])}static build7(t){return new B(t)}area(t){let e=null,r=null,i=0;return this.points(t,n=>{r?i+=(n.x+r.x)*(n.y-r.y):e=n,r=n}),i+=(e.x+r.x)*(e.y-r.y),i/2}closed(t){if(this.primitives.length<=1){let e=this.primitives[0];return!!(e&&e instanceof R&&e.isCircle())}else{let e=this.primitives[0],r=this.primitives[this.primitives.length-1];return e.start().equals(r.end(),t)}}asClose(){let t=this.primitives[0],e=this.primitives[this.primitives.length-1],r=t.start(),i=e.end();if(r.equals(i))return this;{let n=new Array;return F.addAll(n,this.primitives),n.push(new S(i,r)),B.build2(n)}}closeEndpoint(){let t=this.primitives[0],e=this.primitives[this.primitives.length-1],r=t.start(),i=e.end();if(r.equals1(i))return this;{let n=new Array;return F.addAll(n,this.primitives),n.push(new S(i,r)),new B(n)}}reverse(){let t=new Array(this.primitives.length);for(let e=0,r=this.primitives.length-1;r>=0;e++,r--){let i=this.primitives[r];if(i instanceof S)i=new S(i.end(),i.start());else if(i instanceof R)i=i.exchangeSweep();else if(i instanceof we)i=new we(i.controls.slice().reverse());else throw new Error("bug");t[e]=i}return new B(t,this.__bbox)}reverse1(){let t=new Array(this.primitives.length);for(let e=0,r=this.primitives.length-1;r>=0;e++,r--){let i=this.primitives[r];if(i instanceof S)i=new S(i.end(),i.start());else if(i instanceof R)i=i.exchangeSweep1();else if(i instanceof we)i=new we(i.controls.slice().reverse());else throw new Error("bug");t[e]=i}return new B(t,this.__bbox)}mirror(t){let e=[];return this.primitives.forEach(r=>{if(r instanceof S)r=r.mirror(t);else if(r instanceof R)r=r.mirror(t);else if(r instanceof we){let i=r.controls.map(n=>n.mirrorY(t));r=new we(i)}else throw new Error("bug");e.push(r)}),new B(e,this.__bbox)}points(t,e){if(this.primitives.length!==0){for(let r=0;r<this.primitives.length-1;r++){let i=this.primitives[r].points(t);i.pop(),i.forEach(n=>e(n))}this.primitives[this.primitives.length-1].points(t).forEach(r=>e(r))}}multiply3(t){let e=new Array(this.primitives.length);for(let r=0;r<this.primitives.length;r++)e[r]=this.primitives[r].multiply3(t);return B.build2(e)}bbox(){return this.__bbox==null&&(this.__bbox=B.calcBBox(this.primitives)),this.__bbox}start(){let t=this.primitives[0];return t?t.start():null}end(){let t=this.primitives.length,e=t>0?this.primitives[t-1]:null;return e?e.end():null}isClose(t){if(this.primitives.length<=1&&!(this.primitives[0]instanceof R))return!1;{let e=this.primitives[0],r=this.primitives[this.primitives.length-1];return e.start().equals(r.end(),t)}}isEqual(t){if(t instanceof B&&t.primitives.length==this.primitives.length){let e=t.primitives.length;for(let r=0;r<e;r++){let i=t.primitives[r],n=this.primitives[r];if(JSON.stringify(i)!=JSON.stringify(n))return!1}return!0}return!1}equals(t){if(!t)return!1;let e=this.primitives,r=t.primitives;if(e.length!=r.length)return!1;if(t.isClose()){let i=0;for(;i<e.length;){let n=e.slice(i).concat(e.slice(0,i));if(ri(n,r)||ri(n.reverse(),r))return!0;i++}return!1}else return ri(this.primitives,t.primitives)}clone(){return B.build2(this.primitives)}putItem(t,e){if(!t)return!1;if(t instanceof B)return this.mergePolyline(t,e);let r=this.start();if(!r){this.primitives.push(t),this.__bbox=t.bbox();return}let i=this.end();if(r.equals(i,e))return!1;let n=t.start(),s=t.end(),o=!1,l=!1;if(r.equals(n,e))o=!0,l=!1;else if(r.equals(s,e))o=!1,l=!1;else if(i.equals(n,e))o=!1,l=!0;else if(i.equals(s,e))o=!0,l=!0;else return!1;return l?this.primitives.push(o?t.reverse():t):this.primitives.unshift(o?t.reverse():t),this.__bbox=j.extend2(this.__bbox,t.bbox()),!0}mergePolyline(t,e,r=0){if(!t)return!1;let i=this.start();if(!i){this.primitives.push(...t.primitives),this.__bbox=t.bbox();return}let n=this.end();if(i.equals(n,e))return!1;let s=t.start(),o=t.end(),l=!1,u=!1;if(i.equals(s,e))l=!0,u=!1;else if(i.equals(o,e))l=!1,u=!1;else if(n.equals(s,e))l=!1,u=!0;else if(n.equals(o,e))l=!0,u=!0;else return!1;let h=l?t.reverse():t;return u?this.primitives.push(...h.primitives):this.primitives.unshift(...h.primitives),this.__bbox=j.extend2(this.__bbox,t.bbox()),!0}deDuplicationPoint(t){let e=this.primitives[this.primitives.length-1].start(),r=this.primitives[this.primitives.length-1].end(),i=t.primitives[0].start(),n=t.primitives[0].end();if(this.primitives[this.primitives.length-1]instanceof S&&t.primitives[0]instanceof S&&Vu([e,r],[i,n])){this.primitives.pop(),t.primitives.shift();let s=[];s.push(new S(e,n)),this.primitives.push(...s)}}};var ce=class extends de{constructor(e,r,i,n,s,o,l,u,h,c,f){super(e,r,I.MULTI);this.center=i,this.holeDiameter=D.normal(n),this.startLayerPad=o,this.innerPad=D.normal(l),this.endLayerPad=h,this.mask=c,this.startLayer=s,this.endLayer=u,this.unuseLayers=f,this.__bbox=this._bbox()}multiply3(e){return new ce(this.id,this.net,this.center.multiply3(e),e.iScale*this.holeDiameter,this.startLayer,e.iScale*this.startLayerPad,e.iScale*this.innerPad,this.endLayer,e.iScale*this.endLayerPad,this.mask,this.unuseLayers)}bbox(){return this.__bbox}isUnuseLayers(e){for(let r of this.unuseLayers)if(r.equals(e))return!0;return!1}_bbox(){let e=0;for(let r of[this.holeDiameter,this.startLayerPad,this.innerPad,this.endLayerPad])e<r&&(e=r);return e/=2,new j(this.center.x-e,this.center.x+e,this.center.y-e,this.center.y+e)}shape(e,r){return this.generate(this,e,r)}generate(e,r,i){if(this.isUnuseLayers(r))return null;if(r.type!==0){if(!isNaN(e.startLayerPad)&&r.equals(this.startLayer)){let n=e.startLayerPad/2;return B.build2([R.build3(e.center,0,-360,n+i,n+i)])}if(!isNaN(e.endLayerPad)&&r.equals(this.endLayer)){let n=e.endLayerPad/2;return B.build2([R.build3(e.center,0,-360,n+i,n+i)])}if(!isNaN(e.innerPad)&&this.isContains(r)&&r.type==5){let n=e.innerPad/2;return B.build2([R.build3(e.center,0,-360,n+i,n+i)])}if(!isNaN(e.innerPad)&&this.isContains(r)&&r.type==6){let n=e.innerPad/2;return B.build2([R.build3(e.center,0,-360,n+i,n+i)])}}else if(e.holeDiameter>0){let n=e.holeDiameter/2;return B.build2([R.build3(e.center,0,-360,n,n)])}return null}getOutsideShapeWithHole(e,r){if(!this.isContains(e))return null;if(this.isUnuseLayers(e)){let n=this.holeDiameter/2+r;return B.build2([R.build3(this.center,0,-360,n,n)])}let i;if(e.equals(this.startLayer))i=this.startLayerPad;else if(e.equals(this.endLayer))i=this.endLayerPad;else if(e.type==5||e.type==6)i=this.innerPad;else throw new Error("not support");return i=Math.max(i,this.holeDiameter)/2+r,B.build2([R.build3(this.center,0,-360,i,i)])}isContains(e){if(this.isUnuseLayers(e))return!1;if(e.equals(this.startLayer)||e.equals(this.endLayer))return!0;if(this.startLayer.equals(I.TOP_COPPER)){if(!e.equals(I.BOT_COPPER)&&e.order<=this.endLayer.order)return!0}else if(this.startLayer.equals(I.BOT_COPPER)){if(!e.equals(I.TOP_COPPER)&&e.order>=this.endLayer.order)return!0}else if(this.endLayer.equals(I.TOP_COPPER)){if(!e.equals(I.BOT_COPPER)&&e.order<=this.startLayer.order)return!0}else if(this.endLayer.equals(I.BOT_COPPER)){if(!e.equals(I.TOP_COPPER)&&e.order>=this.startLayer.order)return!0}else if(!e.equals(I.BOT_COPPER)&&!e.equals(I.TOP_COPPER)){if(this.startLayer.order>this.endLayer.order){if(e.order<this.startLayer.order&&e.order>this.endLayer.order)return!0}else if(e.order<this.endLayer.order&&e.order>this.startLayer.order)return!0}return!1}};var ue=class extends de{constructor(e,r,i,n,s,o,l,u,h){super(e,r,I.MULTI);this.center=i,this.holeDiameter=D.normal(n),this.topPad=s,this.innerPad=D.normal(o),this.botPad=l,this.mask=u,this.unuseLayers=h,this.__bbox=this._bbox()}isContains(e){return!this.isUnuseLayers(e)}multiply3(e){return new ue(this.id,this.net,this.center.multiply3(e),e.iScale*this.holeDiameter,e.iScale*this.topPad,e.iScale*this.innerPad,e.iScale*this.botPad,this.mask,this.unuseLayers)}bbox(){return this.__bbox}_bbox(){let e=0;for(let r of[this.holeDiameter,this.topPad,this.innerPad,this.botPad])e<r&&(e=r);return e/=2,new j(this.center.x-e,this.center.x+e,this.center.y-e,this.center.y+e)}shape(e,r){return this.generate(this,e,r)}isUnuseLayers(e){for(let r of this.unuseLayers)if(r.equals(e))return!0;return!1}generate(e,r,i){if(this.isUnuseLayers(r))return null;if(r.type!==0){if(!isNaN(e.topPad)&&r.equals(I.TOP_COPPER)){let n=e.topPad/2;return B.build2([R.build3(e.center,0,-360,n+i,n+i)])}if(!isNaN(e.botPad)&&r.equals(I.BOT_COPPER)){let n=e.botPad/2;return B.build2([R.build3(e.center,0,-360,n+i,n+i)])}if(!isNaN(e.innerPad)&&r.type===5){let n=e.innerPad/2;return B.build2([R.build3(e.center,0,-360,n+i,n+i)])}if(!isNaN(e.innerPad)&&r.type===6){let n=e.innerPad/2;return B.build2([R.build3(e.center,0,-360,n+i,n+i)])}}else if(e.holeDiameter>0){let n=e.holeDiameter/2+i;return B.build2([R.build3(e.center,0,-360,n,n)])}return null}};var De=class extends de{constructor(e,r,i,n,s){super(s||"",e,r);this.arc=i,this.width=n}multiply3(e){return new De(this.net,this.layer,this.arc.multiply3(e),e.iScale*this.width)}bbox(){return this.arc.bbox().extendOfSize(this.width/2)}shape(e,r){return this.layer.equals(e)?this.arc.stroke(this.width+r*2,1,0):null}};var ye=class extends de{constructor(e,r,i,n,s,o){super(o||"",e,r);this.start=i,this.end=n,this.width=D.normal(s),this.__bbox=this._bbox()}multiply3(e){return new ye(this.net,this.layer,this.start.multiply3(e),this.end.multiply3(e),e.iScale*this.width,this.id)}reverse(){return new ye(this.net,this.layer,this.end,this.start,this.width,this.id)}bbox(){return this.__bbox}_bbox(){let e=this.width/2;return new H().ext2(this.start.add1(e,e)).ext2(this.start.add1(-e,-e)).ext2(this.end.add1(e,e)).ext2(this.end.add1(-e,-e)).build()}shape(e,r){return this.layer.equals(e)?new S(this.start,this.end).stroke(this.width+r*2,1,0):null}};var ft=class extends de{constructor(e,r,i,n,s,o){super(o||"","",e);this._leftLow=r,this._leftUp=i,this._rightLow=n,this._rightUp=s}multiply3(e){let r=this._leftLow.multiply3(e),i=this._leftUp.multiply3(e),n=this._rightLow.multiply3(e),s=this._rightUp.multiply3(e);return new ft(this.layer,r,i,n,s)}bbox(){let e=new H;return e.ext2(this._leftLow).ext2(this._leftUp).ext2(this._rightLow).ext2(this._rightUp),e.build()}shape(e,r){if(this.layer.equals(e)){let i=this._rightLow.sub(this._leftLow).normalize().mul(r),n=this._leftUp.sub(this._leftLow).normalize().mul(r),s=this._leftLow.sub(i).sub(n),o=this._leftUp.sub(i).add(n),l=this._rightLow.add(i).sub(n),u=this._rightUp.add(i).add(n),h=new Array,c=new S(s,l),f=new S(l,u),d=new S(u,o),p=new S(o,s);return h.push(c),h.push(f),h.push(d),h.push(p),B.build2(h)}else return null}};function Ji(a){if(a instanceof S)return a.length();if(a instanceof R){let t=J.toRadians(a.sweepAngle);return Math.abs(a.rx*t)}}function kn(a,t,e,r,i=1){let n=t.sub(a).normalize(),s=new b(-n.y,n.x),o=a.distance1(t),l=Math.min(o,e)/2*r,u=l*2,h=(e-u)/2,c=s.mul(h),f=n.mul(l),d=s.mul(l),p=a.add(c),m=a.sub(c),g=t.add(c),x=t.sub(c),y=p.add(f),P=m.add(f),L=g.sub(f),w=x.sub(f),C=y.add(d),T=L.add(d),M=P.sub(d),E=w.sub(d);if(i==1){let W=new S(p,m),k=new S(M,E),O=new S(x,g),se=new S(T,C),Y=new Array;if(l>0){let $=R.build1(m,M,l,l,!1,1),ae=R.build1(E,x,l,l,!1,1),le=R.build1(g,T,l,l,!1,1),ge=R.build1(C,p,l,l,!1,1);for(let Me of[W,$,k,ae,O,le,se,ge])Me!=null&&Ji(Me)>0&&Y.push(Me)}else for(let $ of[W,k,O,se])$!=null&&Ji($)>0&&Y.push($);return B.build2(Y).asClose()}else{let W=new S(m,p),k=new S(C,T),O=new S(g,x),se=new S(E,M),Y=new Array;if(l>0){let $=R.build1(p,C,l,l,!1,0),ae=R.build1(T,g,l,l,!1,0),le=R.build1(x,E,l,l,!1,0),ge=R.build1(M,m,l,l,!1,0);for(let Me of[W,$,k,ae,O,le,se,ge])Me!=null&&Ji(Me)>0&&Y.push(Me)}else for(let $ of[W,k,O,se])$!=null&&Ji($)>0&&Y.push($);return B.build2(Y)}}var gc=(n=>(n[n.ROUND=0]="ROUND",n[n.RECTANGLE=1]="RECTANGLE",n[n.ROUND_RECTANGLE=2]="ROUND_RECTANGLE",n[n.OCTAGONAL=3]="OCTAGONAL",n[n.POLYGON=4]="POLYGON",n))(gc||{});function JL(a){switch(a){case 0:return"ROUND";case 1:return"RECTANGLE";case 2:return"ROUND_RECTANGLE";case 3:return"OCTAGONAL";case 4:return"POLYGON"}}var pt=class{constructor(t,e,r,i,n){if(t===4){this.outline=D.notnull(n);let s=n.bbox();e=s.width(),r=s.height()}else this.outline=D.mustnull(n);if(this.type=t,this.xSize=e,this.ySize=r,0<=i&&i<=100)this.cornerRadius=i;else throw new Error("cornerRadius is only allowed 0-100")}transform(t){let e=this.outline!==null?this.outline.multiply3(t):null;return new pt(this.type,t.iScale*this.xSize,t.iScale*this.ySize,this.cornerRadius,e)}equals(t){return t!==null&&t instanceof pt?t.type!==this.type||t.xSize!==this.xSize||t.ySize!==this.ySize?!1:t.cornerRadius===this.cornerRadius:!1}},Fr=class{constructor(t,e,r,i,n){t.type===0?(D.notnull(e),D.notnull(r),D.notnull(i)):t.type===4?(D.notnull(e),D.mustnull(r),D.mustnull(i)):t.type===7?(D.mustnull(e),D.mustnull(r),D.notnull(i)):(D.mustnull(e),D.notnull(r),D.mustnull(i)),this.top=n?this.mirrorShapes(e,n):e,this.inner=r,this.bot=i,this.layer=t}mirrorShapes(t,e){let r=t&&t.outline;if(!r)return null;let i=[];return r.points(1,n=>{i.push(n.mirrorY(e))}),new pt(t.type,t.xSize,t.ySize,t.cornerRadius,B.build4(i))}transform(t){let e=this.top!==null?this.top.transform(t):null,r=this.inner!==null?this.inner.transform(t):null,i=this.bot!==null?this.bot.transform(t):null;return new Fr(this.layer,e,r,i)}},yc=(r=>(r[r.ROUND=0]="ROUND",r[r.SQUARE=1]="SQUARE",r[r.SLOT=2]="SLOT",r))(yc||{}),Gr=class{constructor(t,e,r,i,n,s){if(N.less(r,e))throw new Error(Pe.format("hole size %f must less or eq than hole length %f",e,r));this.type=t,this.size=D.positiveOr0(e),this.length=D.positiveOr0(r),this.rotation=i,this.offsetX=D.normal(n),this.offsetY=D.normal(s)}transform(t){return new Gr(this.type,t.iScale*this.size,t.iScale*this.length,this.rotation,t.iScale*this.offsetX,t.iScale*this.offsetY)}},he=class extends de{constructor(e,r,i,n,s,o,l,u,h,c,f,d,p,m,g=new Array){super(e,r,i);this.location=n,this.rotation=s,this.shapes=o,this.hole=l,this.pasteMaskEx=D.normal(u),this.topSolderMaskEx=D.normal(h),this.bottomSolderMaskEx=D.normal(c),this.designator=f,this.plated=d,this.flag=p,this.__bbox=this._bbox(),this.padRule=m,this.unuseLayers=g}multiply3(e){return new he(this.id,this.net,this.layer,this.location.multiply3(e),J.transformD(this.rotation,e),this.shapes.transform(e),this.hole.transform(e),this.pasteMaskEx*e.iScale,this.topSolderMaskEx*e.iScale,this.bottomSolderMaskEx*e.iScale,this.designator,this.plated,this.flag,this.padRule,this.unuseLayers)}bbox(){return this.__bbox}_bbox(){let e=new H,r=0,i=0;for(let h of[this.shapes.top,this.shapes.inner,this.shapes.bot])h!==null&&(r<h.xSize&&(r=h.xSize),i<h.ySize&&(i=h.ySize),h.outline!==null&&e.ext1(h.outline.bbox()));r/=2,i/=2;let n=this.location.add1(-r,i),s=this.location.add1(r,-i),o=this.location.add1(r,i),l=this.location.add1(-r,-i),u=me.rotateD(this.rotation).setOrigin1(this.location);if(e.ext2(n.multiply3(u)).ext2(s.multiply3(u)).ext2(o.multiply3(u)).ext2(l.multiply3(u)),this.layer.type===0){r=this.hole.size/2,i=this.hole.length/2;let h=this.location.add1(this.hole.offsetX,this.hole.offsetY);n=h.add1(-r,i),s=h.add1(r,-i),o=this.location.add1(r,i),l=this.location.add1(-r,-i);let c=me.rotateD(this.hole.rotation).setOrigin1(h);n=n.multiply3(c),s=s.multiply3(c),e.ext2(n.multiply3(u)).ext2(s.multiply3(u)).ext2(o.multiply3(u)).ext2(l.multiply3(u))}return e.build()}isUnuseLayers(e){for(let r of this.unuseLayers)if(r.equals(e))return!0;return!1}shape(e,r){if(this.isUnuseLayers(e))return null;let i=me.rotateD(this.rotation).setOrigin1(this.location);if(e.type!==0)return this.shapes.top!==null&&e.type===4?this.generate1(this,this.shapes.top,r,i):this.shapes.bot!==null&&e.type===7?this.generate1(this,this.shapes.bot,r,i):this.shapes.inner!==null&&e.type===5?this.generate1(this,this.shapes.inner,r,i):this.shapes.inner!==null&&e.type===6?this.generate1(this,this.shapes.inner,r,i):null;if(this.hole.size>0&&this.hole.length>0){let n=this.location.add1(this.hole.offsetX,this.hole.offsetY),s=this.hole.size/2+r,o=this.hole.length/2+r,l;switch(this.hole.type){case 2:l=new S(n.add1(-o+s,0),n.add1(o-s,0)).stroke(s*2,1,0);break;case 1:l=new S(n.add1(-s,0),n.add1(s,0)).stroke(s*2,0,0);break;default:l=B.build2([R.build3(n,0,-360,s,s)]);break}return i=me.rotateD(this.hole.rotation).setOrigin1(n).multiply3(i),l.multiply3(i)}else return null}generate1(e,r,i,n){let s=i*2;switch(r.type){case 3:{let o,l;if(r.xSize>=r.ySize){let u=(r.xSize-r.ySize)/2;l=r.ySize,o=new S(e.location.add1(-u,0),e.location.add1(u,0))}else{let u=(r.ySize-r.xSize)/2;l=r.xSize,o=new S(e.location.add1(0,-u),e.location.add1(0,u))}return l=l+s,l>0?o.stroke(l,1,0).multiply3(n):null}case 1:if(r.cornerRadius==0){if(i>0)return this.roundRectangle(e,r,i).multiply3(n);{let o=r.xSize/2+i,l=r.ySize+s;return o>0&&l>0?new S(e.location.add1(-o,0),e.location.add1(o,0)).stroke(l,0,0).multiply3(n):null}}else{let o=Math.min(r.xSize,r.ySize)/2,u=(o/100*r.cornerRadius+i)/(o+i),h=r.xSize/2+i,c=r.ySize+s;return kn(e.location.add1(-h,0),e.location.add1(h,0),c,u,0).multiply3(n)}case 2:{let o=r.xSize/2+i,l=r.ySize+s;return o>0&&l>0?new S(e.location.add1(-o,0),e.location.add1(o,0)).stroke(l,0,0).multiply3(n):null}case 4:if(i!==0&&r.outline!==null){let o=r.outline.bbox();return o.width()+s>0&&o.height()+s>0?gr.zoomPolygon(r.outline,i):null}else return r.outline;default:if(r.xSize+s>0&&r.ySize+s>0){if(r.xSize===r.ySize)return B.build2([R.build3(e.location,0,-360,r.xSize/2+i,r.ySize/2+i)]).multiply3(n);if(r.xSize<r.ySize){let o=r.xSize+s,l=(r.ySize-r.xSize)/2;return new S(e.location.add1(0,-l),e.location.add1(0,l)).stroke(o,1,0).multiply3(n)}else{let o=(r.xSize-r.ySize)/2,l=r.ySize+s;return new S(e.location.add1(-o,0),e.location.add1(o,0)).stroke(l,1,0).multiply3(n)}}else return null}}roundRectangle(e,r,i){return B.build2([new S(e.location.add1(-r.xSize/2,r.ySize/2+i),e.location.add1(r.xSize/2,r.ySize/2+i)),R.build3(e.location.add1(r.xSize/2,r.ySize/2),90,-90,i,i),new S(e.location.add1(r.xSize/2+i,r.ySize/2),e.location.add1(r.xSize/2+i,-r.ySize/2)),R.build3(e.location.add1(r.xSize/2,-r.ySize/2),0,-90,i,i),new S(e.location.add1(r.xSize/2,-r.ySize/2-i),e.location.add1(-r.xSize/2,-r.ySize/2-i)),R.build3(e.location.add1(-r.xSize/2,-r.ySize/2),-90,-90,i,i),new S(e.location.add1(-r.xSize/2-i,-r.ySize/2),e.location.add1(-r.xSize/2-i,r.ySize/2)),R.build3(e.location.add1(-r.xSize/2,r.ySize/2),-180,-90,i,i)])}};var li=class{point2Angle(t,e,r){if(t.equals(e))if(r.equals(t)){let L=t.add(new b(.001,0)),w=.001,C=t.angle(L),T=e.angle(L),M=1;return{center:L,radius:w,startAngle:C,endAngle:T,sweep:M}}else{let L=t.add(r).mul(.5),w=r.distance1(t)/2,C=t.angle(L),T=e.angle(L),M=1;return{center:L,radius:w,startAngle:C,endAngle:T,sweep:M}}let i=e.sub(r).normalize(),n=r.sub(t).normalize();i.cross(n)==0&&r.add(new b(-i.y,i.x).mul(.01));let s=2*(e.x-t.x),o=2*(e.y-t.y),l=e.x*e.x+e.y*e.y-t.x*t.x-t.y*t.y,u=2*(r.x-e.x),h=2*(r.y-e.y),c=r.x*r.x+r.y*r.y-e.x*e.x-e.y*e.y,f=(l*h-c*o)/(s*h-u*o),d=(s*c-u*l)/(s*h-u*o),p=new b(f,d),m=p.distance1(t),g=t.angle(p),x=e.angle(p),y=n.cross(i),P;return y>0?P=1:P=0,{center:p,radius:m,startAngle:g,endAngle:x,sweep:P}}pointToAngle(t,e,r){let i=e.sub(t),n=new b(-i.y,i.x).normalize(),s=Math.abs(r)/2,o;if(s!=0)o=i.length()/2/Math.sin(s);else throw new Error("Can't represent circle!!!");let l=n.rotate(b.ORIGIN,s),u,h;r>0?(u=1,h=e.add(l.mul(o))):(u=0,h=t.sub(l.mul(o)));let c=t.angle(h),f=e.angle(h);return{center:h,radius:o,startAngle:c,endAngle:f,sweep:u}}angleToPoint(t,e,r,i,n){let s=t.add(new b(Math.cos(r),Math.sin(r)).mul(e)),o=t.add(new b(Math.cos(i),Math.sin(i)).mul(e)),l;return n==1?l=(i+Z-r)%Z:l=-(r+Z-i)%Z,{start:s,end:o,angle:l}}tangentToArc(t,e,r,i=!0){if(e.equals(r)){let p=new b(t.y,-t.x).normalize(),m=e.add(p),g=e.angle(m),x=g+Z;return i?{center:m,radius:1,startAngle:g,endAngle:x,sweep:0}:{center:m,radius:1,startAngle:x,endAngle:g,sweep:0}}let n=r.sub(e),s=t.cross(n),o,l,u;s>0?(o=1,l=new b(-t.y,t.x).normalize(),u=new b(-n.y,n.x).normalize()):(o=0,l=new b(t.y,-t.x).normalize(),u=new b(n.y,-n.x).normalize());let h=new S(e,e.add(l.mul(1e3))),c=e.add(r).mul(.5),f=new S(c.sub(u.mul(1e3)),c.add(u.mul(1e3)));if(Xe(h,f)>0){let p=new b(U[0],U[1]),m=p.distance1(e),g=e.angle(p),x=r.angle(p);return{center:p,radius:m,startAngle:g,endAngle:x,sweep:o}}else{let p=e.add(l.mul(1e3)),m=p.distance1(e),g=e.angle(p),x=r.angle(p);return{center:p,radius:m,startAngle:g,endAngle:x,sweep:o}}}tangentAngleArc(t,e,r,i){let n=null,s=null,o=null;i>0?(n=1,o=e.rotate(b.ORIGIN,Math.PI/2),s=t.add(o.mul(r))):(n=0,o=e.rotate(b.ORIGIN,-Math.PI/2),s=t.add(o.mul(r)));let l=o.mul(-1).angle(b.ORIGIN),u=l+i;return{center:s,radius:r,startAngle:l,endAngle:u,sweep:n}}};var al=new Error("list is empty"),as=class{constructor(t,e){this.prev=null;this.next=null;this.parent=t,this.item=e}insertAfter(t){t.next=this.next,this.next=t,t.prev=this,t.next!==null&&(t.next.prev=t)}insertBefore(t){t.prev=this.prev,this.prev=t,t.next=this,t.prev!==null&&(t.prev.next=t)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(t){this.item=t}},Gu=class{constructor(t){this._next=t}hasNext(){return this._next!==null}next(){let t=this._next;if(t!==null)return this._next=t.next,t.item;throw new Error("iterator is null")}},Wu=class{constructor(t){this._next=t}hasNext(){return this._next!==null}next(){let t=this._next;if(t!==null)return this._next=t.next,t;throw new Error("iterator is null")}},Xt=class{constructor(){this.first=null;this.last=null;this.cnt=0}add(t){return this.addLast(t)}push(t){return this.addLast(t)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let t=this.first;if(t===null)throw al;return this.remove(t),t.item}removeLast(){let t=this.last;if(t===null)throw al;return this.remove(t),t.item}addLast(t){return this.first===null||this.last===null?(this.first=new as(this,t),this.last=this.first,this.cnt=1,this.first):this.insertAfter(this.last,t)}addFirst(t){if(this.first===null||this.last===null){let e=new as(this,t);return this.first=e,this.last=e,this.cnt++,e}else return this.insertBefore(this.first,t)}getFirst(){if(this.first===null)throw al;return this.first.item}getLast(){if(this.last===null)throw al;return this.last.item}insertAfter(t,e){let r=new as(this,e);return t.insertAfter(r),t===this.last&&(this.last=r),this.cnt++,r}insertBefore(t,e){let r=new as(this,e);return t.insertBefore(r),t===this.first&&(this.first=r),this.cnt++,r}remove(t){t.remove(),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new Gu(this.first)}listIterator(){return new Wu(this.first)}toArray(){let t=new Array(this.cnt),e=this.first,r=0;for(;e!=null;)t[r]=e.item,e=e.next,r++;return t}};var ee=class{constructor(t){this.items=new Array(t.length),F.arraycopy(t,0,this.items,0,t.length),this.__bbox=this.calcBBox(),this.primitives}static build1(t){let e=[];return Xi(t,(r,i)=>(e.push(i),!0)),new ee(e)}calcBBox(){let t=new H;for(let e=0;e<this.items.length;e++)t.ext1(this.items[e].bbox());return t.build()}multiply3(t){let e=new Array(this.items.length);for(let r=0;r<e.length;r++)e[r]=this.items[r].multiply3(t);return new ee(e)}bbox(){return this.__bbox}asClose(){return this.items.forEach(t=>t.asClose()),this}mirror(t){return this.items.forEach(e=>e.mirror(t)),this}closeEndpoint(){return this.items.forEach(t=>t.closeEndpoint()),this}get primitives(){return this.items.map(t=>t.primitives).flat(2)}isEqual(t){return t instanceof ee?this.items.every(e=>t.items.some(r=>r.isEqual(e))):!1}getOutMostPolyline(){return this.items.reduce((t,e)=>e.bbox().area()>t.bbox().area()?e:t,this.items[0])}};function FM(a,t=.1){let e=new Array;return a.forEach(r=>{let i=new Array;r=r.asClose();let n=r.primitives[0].start();for(let o of r.primitives)o instanceof S?i.push(o.start()):o instanceof R?o.points(.01).forEach(u=>{i.push(u)}):o instanceof we&&o.points(t).forEach(u=>{i.push(u)});let s=r.primitives[r.primitives.length-1].end();i.push(s),s.equals(n)||i.push(n),e.push(i)}),e}function wa(a,t=1){let e=new Array;return a.forEach(r=>{let i=new Array;if(r.primitives.length==1){let o=r.primitives[0];if(o instanceof R&&Math.abs(o.sweepAngle)==360){i=["CIRCLE",o.center.x*t,o.center.y*t,o.rx*t],e.push(i);return}}let n=r.primitives,s=!1;for(let o of n)if(o instanceof S)i.push(o.start().x*t),i.push(o.start().y*t),s||(i.push("L"),s=!0);else if(o instanceof R&&Ji(o)>1e-8)s=!1,i.push(o.start().x*t),i.push(o.start().y*t),i.push("ARC"),i.push(o.sweepAngle);else if(o instanceof we){s=!1,i.push(o.start().x*t),i.push(o.start().y*t),i.push("C");for(let l=1,u=o.controls.length;l<u-1;l++){let h=o.controls[l];i.push(h.x*t),i.push(h.y*t)}}i.length>2&&(i.push(n[n.length-1].end().x*t),i.push(n[n.length-1].end().y*t),e.push(i))}),e}function ls(a,t=1){if(a.primitives.length==1){let i=a.primitives[0];if(i instanceof R&&Math.abs(i.sweepAngle)==360)return["CIRCLE",i.center.x*t,i.center.y*t,i.rx*t]}let e=new Array,r=a instanceof ee?a.items:[a];for(let i of r){let n=new Array;e.push(n);let s=i.primitives,o=!1;for(let l of s)if(l instanceof S)n.push(l.start().x*t),n.push(l.start().y*t),o||(n.push("L"),o=!0);else if(l instanceof R&&Ji(l)>1e-8)if(Math.abs(l.sweepAngle)==360){let u=l.points(.01);u.pop();let h=!0;for(let c of u)n.push(c.x*t),n.push(c.y*t),!o&&h&&(n.push("L"),o=!0),h=!1}else o=!1,n.push(l.start().x*t),n.push(l.start().y*t),n.push("ARC"),n.push(l.sweepAngle);else if(l instanceof we){o=!1,n.push(l.start().x*t),n.push(l.start().y*t),n.push("C");for(let u=1,h=l.controls.length;u<h-1;u++){let c=l.controls[u];n.push(c.x*t),n.push(c.y*t)}}n.length>2&&(n.push(s[s.length-1].end().x*t),n.push(s[s.length-1].end().y*t))}return e.length==1?e[0]:e}function et(a,t=1){t==0&&(t=1),a=Wp(a,t);let e=a.length,r=new Array(e),i=new li,n=null,s=null,o=!1,l=null,u=new Xt,h=null,c=null,f=0,d=2,p=null,m=null,g=null;for(f=0;f<e;f++){if(h=a[f],h[0]==="CIRCLE"){let x=B.build7([R.build2(new b(h[1],h[2]),0,360,h[3],h[3],0)]);r[f]=x;continue}for(n=new b(h[0],h[1]),o=!1,c=h.length,d=2;d<c;)switch(p=h[d],p){case"L":{s=new b(h[d+1],h[d+2]),l=new S(n,s),u.addLast(l),n=s,d+=3,o=!0;break}case"ARC":{if(o=!1,m=h[d+1]/180*Math.PI,s=new b(h[d+2],h[d+3]),Math.abs(m)>1e-8&&!n.equals1(s)){let{center:x,radius:y,startAngle:P,endAngle:L,sweep:w}=i.pointToAngle(n,s,m);l=R.build2(x,P/Math.PI*180,L/Math.PI*180,y,y,w),u.addLast(l)}n=s,d+=4;break}case"C":{o=!1;let x=new Array;for(x.push(n),d++;;){let y=new b(h[d],h[d+1]);if(x.push(y),typeof h[d+2]=="string"){n=y,d+=2;break}if(d+=2,d>=c)break}l=new we(x),u.addLast(l);break}default:{o?(s=new b(h[d],h[d+1]),l=new S(n,s),u.addLast(l),n=s,d+=2):d++;break}}u.size()>0&&(g=B.build7(u.toArray()),r[f]=g),u.clear()}return u.clear(),h=null,r}function Ne(a,t=1){if(a.length<2)return null;if(a[0]=="CIRCLE")return B.build7([R.build2(new b(a[1],a[2]),0,360,a[3],a[3],0)]);let e=new Array,r=new b(a[0]/t,a[1]/t),i=!1;for(let n=2,s=a.length;n<s;)if(a[n]=="L"){let o=new b(a[n+1]/t,a[n+2]/t),l=new S(r,o);e.push(l),r=o,n+=3,i=!0}else if(a[n]=="ARC"){i=!1;let o=a[n+1]/180*Math.PI,l=new b(a[n+2]/t,a[n+3]/t);if(Math.abs(o)>1e-8&&Math.abs(o)<Z&&!r.equals1(l)){let u=new li,{center:h,radius:c,startAngle:f,endAngle:d,sweep:p}=u.pointToAngle(r,l,o),m=R.build2(h,f/Math.PI*180,d/Math.PI*180,c,c,p);e.push(m)}r=l,n+=4}else if(a[n]=="C"){i=!1;let o=new Array;for(o.push(r),n++;;){let u=new b(a[n]/t,a[n+1]/t);if(o.push(u),typeof a[n+2]=="string"){r=u,n+=2;break}if(n+=2,n>=s)break}let l=new we(o);e.push(l)}else if(i){let o=new b(a[n]/t,a[n+1]/t),l=new S(r,o);e.push(l),r=o,n+=2,i=!0}else n++;return B.build7(e)}function GM(a){let t=new Array;a=a.asClose();let e=a.primitives[0].start();for(let i of a.primitives)i instanceof S?t.push(i.start()):i instanceof R?i.points(.01).forEach(s=>{t.push(s)}):i instanceof we&&i.points(.1).forEach(s=>{t.push(s)});let r=a.primitives[a.primitives.length-1].end();return t.push(r),r.equals(e)||t.push(e),t}function Wp(a,t=1){if(t==0||t==1)return a;let e=a.length,r=new Array(e),i="",n=null,s=null,o=null,l=0,u=0;for(;l<e;l++){n=a[l],s=n.length;let h=new Array(s);for(u=0;u<s;u++)o=n[u],i=typeof o,i==="number"?h[u]=o/t:h[u]=o;r[l]=h}return r}var Le=class extends de{constructor(e,r,i,n,s,o){super(o||"",e,r);this.type=i,this.width=n,this.outlines=s,this.__bbox=this._bbox()}multiply3(e){return new Le(this.net,this.layer,this.type,this.width,this.outlines.multiply3(e))}bbox(){return this.__bbox}_bbox(){return this.outlines.bbox().extendOfSize(this.width/2)}shape(e,r){return this.layer.equals(e)||this.layer.equals(I.MULTI)?this.outlines:null}};var ll=class{},st=class extends ll{constructor(e){super();this.neckThickness=D.positiveOr0(e)}transform(e){return new st(this.neckThickness*e.iScale)}},At=class extends ll{constructor(e,r,i=90){super();this.gridWidth=D.positiveOr0(e),this.gridClearance=D.positiveOr0(r),this.angle=i}transform(e){let r=e.iScale;return new At(this.gridWidth*r,this.gridClearance*r)}},Ve=class extends de{constructor(e,r,i,n,s,o,l,u,h,c,f,d,p){super(e,r,i);this.multiLayerClearance=1;this.multiLayerThermal=!1;for(let m of f)if(!(m instanceof S||m instanceof R))throw new Error("invalid outlines, must be Line or Arc");this.method=n,this.outlineClearance=D.normal(s),this.clearance=D.positiveOr0(o),this.thermal=l,this.keepIsland=u,this.pourIndex=h,this.needCopper=c,this.outlines=f,this.coppered=d,this.__bbox=this._bbox(),this.name=p||""}multiply3(e){let r=new Array(this.outlines.length);for(let s=0;s<this.outlines.length;s++)r[s]=this.outlines[s].multiply3(e);let i;if(this.coppered!==null){i=new Array(this.coppered.length);for(let s=0;s<this.coppered.length;s++)i[s]=this.coppered[s].multiply3(e)}else i=null;let n;return this.method==null?n=null:n=this.method.transform(e),new Ve(this.id,this.net,this.layer,n,this.outlineClearance*e.iScale,this.clearance*e.iScale,this.thermal,this.keepIsland,this.pourIndex,this.needCopper,r,i,this.name)}bbox(){return this.__bbox}_bbox(){let e=new H;for(let r of this.outlines)e.ext1(r.bbox());return e.build()}shape(e,r){return this.layer.equals(e)||this.layer.equals(I.MULTI)?B.build2(this.outlines):null}};var Qe=class extends de{constructor(e,r,i,n,s,o,l,u,h){super(e||"","",r);this.type=i,this.copper=n,this.track=s,this.device=o,this.region=u,this.plane=l,this.outlines=h,this.__bbox=this._bbox()}multiply3(e){return new Qe(this.id,this.layer,this.type,this.copper,this.track,this.device,this.plane,this.region,this.outlines.multiply3(e))}bbox(){return this.__bbox}_bbox(){return this.outlines.bbox()}shape(e,r){return this.layer.equals(e)||this.layer.equals(I.MULTI)?this.outlines:null}};var Ke=class extends de{constructor(e,r,i,n,s=""){super(s,e,r);this.type=i,this.outlines=n,this.__bbox=this._bbox()}multiply3(e){return new Ke(this.net,this.layer,this.type,this.outlines.multiply3(e))}bbox(){return this.__bbox}_bbox(){return this.outlines.bbox()}shape(e,r){return this.layer.equals(e)||this.layer.equals(I.MULTI)?this.outlines:null}};var ve=class extends de{constructor(e,r,i){super(e||"","",I.OUTLINE);this.type=r,this.outlines=i,this.__bbox=this._bbox()}multiply3(e){return new ve(this.id,this.type,this.outlines.multiply3(e))}bbox(){return this.__bbox}_bbox(){return this.outlines.bbox()}shape(e,r){return this.outlines}};var Ue=class extends de{constructor(e,r,i){super(e||"","",I.MULTI);this.type=r,this.outlines=i,this.__bbox=this._bbox()}multiply3(e){return new Ue(this.id,this.type,this.outlines.multiply3(e))}bbox(){return this.__bbox}_bbox(){return this.outlines.bbox()}shape(e,r){return this.outlines}};var us=(n=>(n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.WARNING=2]="WARNING",n[n.ERROR=3]="ERROR",n[n.DUMMY=4]="DUMMY",n))(us||{});function Hp(a){switch(a){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var zp=(a,t)=>{a===3?console.error(t):console.log(t)},Yp=(a,t)=>Pe.format("%s %s: %s",new Date,Hp(a),t),La=class{constructor(t,e=zp,r=Yp){this.debug=!1;this.level=t,this.writer=e,this.fmt=r}static mix(...t){let e=4;for(let r of t)r.level<e&&(e=r.level);return new La(e,(r,i)=>{for(let n of t)n.write1(r,i)},(r,i)=>i)}wrap(t=null,e=null){let r=t===null?this.fmt:(n,s)=>(s=t(n,s),this.fmt(n,s)),i=e===null?this.writer:(n,s)=>{e(n,s),this.writer(n,s)};return new La(this.level,i,r)}chain(t){return t.wrap(this.fmt.bind(this),this.writer.bind(this))}include(t){return this.level<=t}write3(t,e,r){this.include(t)&&this.writer(t,this.fmt(t,Pe.format(e,...r)))}write2(t,e){this.include(t)&&(e instanceof Error?this.writer(t,this.fmt(t,e.stack)):this.writer(t,this.fmt(t,e.toString())))}write1(t,e){this.include(t)&&this.writer(t,this.fmt(t,e))}debug3(t,...e){this.write3(0,t,e)}debug2(t){this.write2(0,t)}debug1(t){this.write1(0,t)}info3(t,...e){this.write3(1,t,e)}info2(t){this.write2(1,t)}info1(t){this.write1(1,t)}warning3(t,...e){this.write3(2,t,e)}warning2(t){this.write2(2,t)}warning1(t){this.write1(2,t)}error3(t,...e){this.write3(3,t,e)}error2(t){this.write2(3,t)}error1(t){this.write1(3,t)}},ot=La;ot.DUMMY=new La(4);var hs=class{constructor(t){this.s=t}equals(t){return t instanceof hs?this.s===t.s:!0}},cs=class{constructor(t){this.pourOnly=new Ki;this.logger=t}pours(){return this.pourOnly.array()}addPourOnly(t){this.pourOnly.add(new hs(t))}contains(t){return this.pourOnly.isEmpty()||this.pourOnly.contains(new hs(t))}};function ul(a){throw new Error("")}var fs=class{constructor(t,e){this.node1=null;this.node2=null;this.key=t,this.value=e}},Hu=class{constructor(t){this.itors=t}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().key}},zu=class{constructor(t){this.itors=t}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().value}},Nt=class{constructor(){this.innerList=new Xt;this.innerMap={}}replace(t,e){t.node1!==null&&(t.node1.set(e),e.node1=t.node1),t.node2!==null&&(t.node2.set(e),e.node2=t.node2)}clear(){this.innerList.clear();for(let t in this.innerMap)delete this.innerMap[t]}put(t,e){let r=t.hashCode(),i=new fs(t,e),n=this.innerMap[r];if(n===void 0)return i.node1=this.innerList.add(i),this.innerMap[r]=i,null;if(n instanceof fs){if(n.key.equals(t))return this.innerMap[r]=i,this.replace(n,i),n.value;{i.node1=this.innerList.add(i);let s=new Xt;return n.node2=s.add(n),i.node2=s.add(i),this.innerMap[r]=s,null}}if(n instanceof Xt){let s=null;return dr(n,(o,l)=>l.key.equals(t)?(this.replace(l,i),s=l.value,!1):!0),s===null?(i.node1=this.innerList.add(i),i.node2=n.push(i),null):s}return ul(n)}get(t){let e=t.hashCode(),r=this.innerMap[e];if(r===void 0)return null;if(r instanceof fs)return r.key.equals(t)?r.value:null;if(r instanceof Xt){let i=null;return dr(r,(n,s)=>s.key.equals(t)?(i=s.value,!1):!0),i}return ul(r)}containsKey(t){return this.get(t)!==null}delete(t){t.node1!==null&&t.node1.parent.remove(t.node1),t.node2===null?delete this.innerMap[t.key.hashCode()]:t.node2.parent.remove(t.node2)}remove(t){let e=t.hashCode(),r=this.innerMap[e];if(r===void 0)return null;if(r instanceof fs)return r.key.equals(t)?(this.delete(r),r.value):null;if(r instanceof Xt){let i=null;return dr(r,(n,s)=>s.key.equals(t)?(i=s.value,this.delete(s),!1):!0),i}return ul(r)}computeIfAbsent(t,e){let r=this.get(t);if(r===null){let i=e(t);return this.put(t,i),i}else return r}size(){return this.innerList.size()}isEmpty(){return this.innerList.size()===0}keys(){return new Hu(this.innerList.iterator())}values(){return new zu(this.innerList.iterator())}entries(){return this.innerList.iterator()}};var Yu=class{constructor(t,e,r,i,n,s,o){this.id=t,this.name=e,this.color=r,this.visible=i,this.active=n,this.config=s,this.isSignal=!0,this.layer=o}},ps=class{constructor(t,e){this.idIndex={};this.layerIndex=new Nt;this.define(1,"TopLayer",16711680,!0,!0,!0,4,0),this.define(2,"BottomLayer",255,!0,!1,!0,7,0),this.define(3,"TopSilkLayer",16763904,!0,!1,!0,1,0),this.define(4,"BottomSilkLayer",6736947,!0,!1,!0,10,0),this.define(5,"TopPasteMaskLayer",8421504,!0,!1,!0,3,0),this.define(6,"BottomPasteMaskLayer",8388608,!0,!1,!0,8,0),this.define(7,"TopSolderMaskLayer",8388736,!0,!1,!0,2,0),this.define(8,"BottomSolderMaskLayer",11141375,!0,!1,!0,9,0),this.define(9,"Ratlines",6579455,!0,!1,!0,14,0),this.define(10,"BoardOutline",16711935,!0,!1,!0,11,0),this.define(11,"Multi-Layer",12632256,!0,!1,!0,0,0),this.define(12,"Document",16777215,!0,!1,!0,12,0),this.define(13,"TopAssembly",3394713,!0,!1,!0,13,1),this.define(14,"BottomAssembly",5592575,!0,!1,!0,13,2),this.define(15,"Mechanical",15737584,!1,!1,!1,13,3),this.define(19,"3DModel",6737151,!1,!1,!1,15,0),this.define(21,"Inner1",10066278,!1,!1,!1,5,1),this.define(22,"Inner2",32768,!1,!1,!1,5,2),this.define(23,"Inner3",65280,!1,!1,!1,5,3),this.define(24,"Inner4",12357120,!1,!1,!1,5,4),this.define(25,"Inner5",7396346,!1,!1,!1,5,5),this.define(26,"Inner6",52326,!1,!1,!1,5,6),this.define(27,"Inner7",10053375,!1,!1,!1,5,7),this.define(28,"Inner8",8388736,!1,!1,!1,5,8),this.define(29,"Inner9",32896,!1,!1,!1,5,9),this.define(30,"Inner10",1413983,!1,!1,!1,5,10),this.define(31,"Inner11",128,!1,!1,!1,5,11),this.define(32,"Inner12",46080,!1,!1,!1,5,12),this.define(33,"Inner13",3032918,!1,!1,!1,5,13),this.define(34,"Inner14",10060847,!1,!1,!1,5,14),this.define(35,"Inner15",16777130,!1,!1,!1,5,15),this.define(36,"Inner16",10060847,!1,!1,!1,5,16),this.define(37,"Inner17",3032918,!1,!1,!1,5,17),this.define(38,"Inner18",3487231,!1,!1,!1,5,18),this.define(39,"Inner19",8388796,!1,!1,!1,5,19),this.define(40,"Inner20",4435551,!1,!1,!1,5,20),this.define(41,"Inner21",12840142,!1,!1,!1,5,21),this.define(42,"Inner22",7506296,!1,!1,!1,5,22),this.define(43,"Inner23",3756095,!1,!1,!1,5,23),this.define(44,"Inner24",815453,!1,!1,!1,5,24),this.define(45,"Inner25",5933696,!1,!1,!1,5,25),this.define(46,"Inner26",2855806,!1,!1,!1,5,26),this.define(47,"Inner27",2333085,!1,!1,!1,5,27),this.define(48,"Inner28",4568291,!1,!1,!1,5,28),this.define(49,"Inner29",2186657,!1,!1,!1,5,29),this.define(50,"Inner30",4547799,!1,!1,!1,5,30),this.define(51,"Inner31",6908393,!1,!1,!1,5,31),this.define(52,"Inner32",9464297,!1,!1,!1,5,32),this.define(99,"ComponentShapeLayer",52428,!1,!1,!1,17,0),this.define(100,"LeadShapeLayer",13408665,!1,!1,!1,18,0),this.define(101,"Component Marking Layer",6750156,!1,!1,!1,19,0),this.define(102,"Drill drawing Layer",6750156,!1,!1,!1,20,0),this.logger=t,this.reOrderLayers(e)}reOrderLayers(t){let e=20;if(t!==null&&t.length>0){for(let r of t)if(r.type===5||r.type===6){e++;let i=this.idIndex[e];i.isSignal=r.type===5,this.layerIndex.put(r,i),this.logger.debug3("alias %s to %s",r,i.layer)}}}info1(t){return this.idIndex[t]}info2(t){let e=this.layerIndex.get(t);if(e!==null)return e;switch(t.type){case 0:return this.idIndex[11];case 14:return this.idIndex[9];case 7:return this.idIndex[2];case 8:return this.idIndex[6];case 10:return this.idIndex[4];case 9:return this.idIndex[8];case 12:return this.idIndex[12];case 5:return this.info1(Math.min(20+t.order,52));case 6:{let r=this.info1(Math.min(20+t.order,52));return r.isSignal=!1,r}case 13:return this.idIndex[15];case 11:return this.idIndex[10];case 15:return this.idIndex[19];case 4:return this.idIndex[1];case 3:return this.idIndex[5];case 1:return this.idIndex[3];case 2:return this.idIndex[7];default:return this.logger.warning3("unsupported layer type %d, use Document instead",t.type),this.idIndex[12]}}encode(t){let e=this.idIndex[t];return e===null?(this.logger.warning3("unknown layer id %d, use Document layer instead",t),this.idIndex[12].layer):e.layer.type===5?e.isSignal?e.layer:new I(6,e.layer.order):e.layer}define(t,e,r,i,n,s,o,l){let u=new I(o,l),h=new Yu(t,e,Cr.of(r),i,n,s,u);this.idIndex[t]=h,this.layerIndex.put(u,h)}iterator(){return this.layerIndex.values()}};var dt=class{constructor(t){this.cache={};this.levels=t,this.result=new Array(t),this.weights=new Array(t),this.maxIdx=t-1,this.rule=this.decide.bind(this);let e=1;for(let r=0;r<t;r++)this.weights[r]=e,e*=50}weight(t){return this.weights[t]}decide(t){t=Math.abs(t);let e=this.cache[t];if(e===void 0){let r=t;for(let i=this.maxIdx;i>=0;i--){let n=this.weights[i],s=t/n|0,o=t%n;o>(n/2|0)?(t=n-o,s++):t=o,this.result[i]=s>0}e=this.decide1(this.result),this.cache[r]=e}return e}};var Kt=a=>a!==0,xc=a=>a>0,VI=a=>a<0,Pc=a=>a%2!==0,hl=new class extends dt{decide1(t){return t[0]||t[1]}}(2),cl=new class extends dt{decide1(t){return t[0]&&!t[1]}}(2),fl=new class extends dt{decide1(t){return t[0]&&t[1]}}(2),pl=new class extends dt{decide1(t){return t[0]&&!t[1]||!t[0]&&t[1]}}(2);var Sc=!1,ds=class{onRTreeBBox(t){}onResultSide(t){}onOriginSide(t){}onSplitedSide(t){}onDebugSide(t){}onSweep(t,e,r,i,n,s){}onIntersect(t,e,r){}onSegment(t,e,r,i,n,s){}onSegment1(t,e,r){if(Sc){let i=new b(t.getX(r),r),n=new b(e.getX(r),r);this.onSegment(i,t.weight,t,n,e.weight,e)}else this.onSegment(t.start,t.weight,t,e.end,e.weight,e)}onSweep1(t,e,r){if(Sc){let i=new b(t.getX(r),r),n=new b(e.getX(r),r);this.onSweep(i,t.weight,t,n,e.weight,e)}else this.onSweep(t.start,t.weight,t,e.end,e.weight,e)}};var qu=(r=>(r[r.SOLID=0]="SOLID",r[r.POLYGON_CUTOUT=1]="POLYGON_CUTOUT",r[r.BOARD_CUTOUT=2]="BOARD_CUTOUT",r))(qu||{}),Zt=class extends de{constructor(e,r,i,n,s,o){super(o||"",e,r);this.kind=i,this.outlines=n,this.__bbox=this._bbox(),this.targets=s}multiply3(e){return new Zt(this.net,this.layer,this.kind,this.outlines.multiply3(e),this.targets)}bbox(){return this.__bbox}_bbox(){return this.outlines.bbox()}shape(e,r){return this.layer.equals(e)||this.layer.equals(I.MULTI)?this.outlines:null}};var yr=class extends de{constructor(e,r,i,n,s){super("",e,r);this.arc=i,this.width=n,this.keepout=s}multiply3(e){return new yr(this.net,this.layer,this.arc.multiply3(e),e.iScale*this.width,this.keepout)}bbox(){return this.arc.bbox()}shape(e,r){return this.layer.equals(e)?this.arc.stroke(this.width+r*2,1,0):null}};var qp=!1,Xp=!0,Kp=!1,Zp=!1,jp=!0,Qp=!0,$p=!0,Jp=!0,ed=new I(5,1),td=new I(5,2),rd=new I(5,3),id=new I(5,4),nd=new I(5,5),sd=new I(5,6),ms=class extends ds{constructor(e){super();this.shapes=[];this.debug=e}display(){let e=new Zi;return e.contributor="",e.sourceName="",e.scale=10,F.addAll(e.shapes,this.shapes),e.build()}onPolylineGroup(e,r){if(this.debug)for(let i of e.items)this.debug1(nd,r.toString(),i)}onRTreeBBox(e){if(this.debug&&qp)for(let r of B.build4([e.LL(),e.UL(),e.UR(),e.LR(),e.LL()]).primitives)this.debug2(I.TOP_SILK,"",r,.003)}onSegment(e,r,i,n,s,o){if(this.debug&&Xp){let l=Pe.format("SG (%d,%d,%d) : (%d,%d,%d) : %s : %s",i.polyGrp,i.polyIndex,r,o.polyGrp,o.polyIndex,s,e,n);this.debug2(I.BOT_COPPER,l,new S(e,n),.003)}}onIntersect(e,r,i){if(this.debug&&Zp){let n=Pe.format("%d,%d:%d,%d:%s",r.polyGrp,r.polyIndex,i.polyGrp,i.polyIndex,e);this.debug2(td,n,new S(e.add1(-.01,0),e.add1(.01,0)),.01)}}onResultSide(e){this.debug&&jp&&this.debug2(id,e.toString(),e.shape,.003)}onOriginSide(e){this.debug&&Qp&&this.debug2(I.TOP_COPPER,e.toString(),e.shape,.003)}onSplitedSide(e){this.debug&&$p&&this.debug2(rd,e.toString(),e.shape,.003)}onDebugSide(e){this.debug&&Jp&&this.debug2(sd,e.toString(),e.shape,.003)}onSweep(e,r,i,n,s,o){if(this.debug&&Kp){let l=Pe.format("SW (%d,%d,%d) : (%d,%d,%d) : %s : %s",i.polyGrp,i.polyIndex,r,o.polyGrp,o.polyIndex,s,e,n);this.debug2(ed,l,new S(e,n),.003)}}debug1(e,r,...i){for(let n of i)this.shapes.push(new Zt(r,e,0,n))}debug2(e,r,i,n){i instanceof S?this.shapes.push(new ye(r,e,i.start(),i.end(),n)):i instanceof R?this.shapes.push(new yr(r,e,i,n,!1)):this.debug1(e,r,i.stroke(n,0,0))}};var at=class extends ms{constructor(e){super(e);this.plGrps=new Array}onPolylineGroup(e,r){super.onPolylineGroup(e,r),this.plGrps.push(e)}};var Xu=(i=>(i[i.UNMARKED=0]="UNMARKED",i[i.INSIDE=1]="INSIDE",i[i.OUTSIDE=2]="OUTSIDE",i[i.INVALID=3]="INVALID",i))(Xu||{}),jt=class{constructor(t,e,r,i,n,s,o){this.inters=[];this.connect=new Array;this.previous=null;this.next=null;this.finalGrp=-1;this.trans=NaN;this.outsideWeight=0;this.insideWeight=0;this.invalidWeight=0;this._confidence=0;this._confidence_y=NaN;this._x=NaN;this._x_y=NaN;this.status=0;this.bo=t,this.shape=e,this.baseWeight=r,i.y>n.y?this.weight=-r:i.y==n.y?this.weight=0:this.weight=r,this.start=i,this.end=n,this.polyGrp=s,this.polyIndex=o,this._bbox=new H().ext1(e.bbox()).ext2(i).ext2(n).build(),this.inters.push(i),this.inters.push(n);let l=31,u=1;u=l*u+this.polyGrp,u=l*u+this.polyIndex,this._hashcode=u}static rebuild(t,e,r){if(t instanceof S||e.distance2(r)<1e-6)return new S(e,r);if(t instanceof R){let i=t,n=t.bbox().center().x,s;e.y>r.y?s=n>i.center.x?0:1:s=n>i.center.x?1:0;let o=e.angleD(i.center),l=r.angleD(i.center);return R.build2(i.center,o,l,i.rx,i.ry,s)}else throw new Error("not supported operation")}updateBbox(){this._bbox=new H().ext2(this.start).ext2(this.end).build()}is(t,e){return t===this.polyGrp&&e===this.polyIndex}confidence(t){if(this._confidence_y!=t){let e=this._bbox.height();if(e!==0)if(Math.abs(t-this._bbox.maxY)>5e-4&&Math.abs(t-this._bbox.minY)>5e-4){let r=1-Math.abs(2*t-this._bbox.maxY-this._bbox.minY)/e;this._confidence=r*1e4|0}else this._confidence=0;else this._confidence=1;this._confidence_y=t}return this._confidence}needCountWeight(){return this.outsideWeight+this.insideWeight+this.invalidWeight<5e3}revokeOutside(t){let e=this.confidence(t);return this.outsideWeight-=e,this.invalidWeight+=e,e}revokeInside(t){let e=this.confidence(t);return this.insideWeight-=e,this.invalidWeight+=e,e}setOutside(t){let e=this.confidence(t);return this.outsideWeight+=e,e}setInside(t){let e=this.confidence(t);return this.insideWeight+=e,e}setInvalid(t){let e=this.confidence(t);return this.invalidWeight+=e,e}prevNot0(){let t=this.previous;for(;t!=null&&t!=this;){if(t.weight!=0)return t;t=t.previous}return null}nextNot0(){let t=this.next;for(;t!=null&&t!=this;){if(t.weight!=0)return t;t=t.next}return null}getX(t){if(this.bo!==null)return(this._x_y!=t||isNaN(this._x))&&(wc(this,t)>0?this._x=U[0]:this._x=NaN,this._x_y=t),this._x;throw new Error("not supported operation")}voteStatus(){return this.outsideWeight>this.insideWeight&&this.outsideWeight>this.invalidWeight?2:this.insideWeight>this.outsideWeight&&this.insideWeight>this.invalidWeight?1:this.invalidWeight>this.outsideWeight&&this.invalidWeight>this.insideWeight?3:0}reverse(t){if(t===2)if(this.start.y>this.end.y){let e=jt.rebuild(this.shape,this.end,this.start),r=new jt(this.bo,e,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return F.addAll(r.connect,this.connect),r}else return this;else if(t===1)if(this.start.y<this.end.y){let e=jt.rebuild(this.shape,this.end,this.start),r=new jt(this.bo,e,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return F.addAll(r.connect,this.connect),r}else return this;return this}isNeedScan(t){return this.needCountWeight()&&this.confidence(t)>0}hashCode(){return this._hashcode}equals(t){return t instanceof jt?!(this.polyGrp!==t.polyGrp||this.polyIndex!==t.polyIndex):!1}bbox(){return this._bbox}toString(){return Pe.format("(%d,%d,%d) (%d,%d,%d) %s %s",this.polyGrp,this.polyIndex,this.weight,this.outsideWeight,this.invalidWeight,this.insideWeight,this.start,this.end)}};function od(a,t){let e=a.bbox(),r=t.bbox(),i=(e.minY+e.maxY)/2,n=(r.minY+r.maxY)/2;return i-n}function ad(a,t){let e=a.bbox(),r=t.bbox(),i=(e.minX+e.maxX)/2,n=(r.minX+r.maxX)/2;return i-n}var en=class{constructor(t){this.__bbox=null;if(typeof t!="undefined")if(t instanceof Array){this.__items=[];for(let e of t)this.add(e)}else this.__items=t,this.__bbox=t.bbox();else this.__items=[]}add(t){if(this.__items instanceof Array)this.__items.push(t),this.__bbox=j.extend2(this.__bbox,t.bbox());else throw new Error("can't insert multiple item into leaf node")}items(){return this.__items}bbox(){if(this.__bbox!==null)return this.__bbox;throw new Error("bug")}},ze=class{constructor(t){this.changed=!1;this.root=new en,this.capacity=t,this.capacity2=t*t,this.itemList=[]}size(){return this.itemList.length}items(){return this.flushWhenNeed(),this.itemList}add(t){this.itemList.push(t),this.changed=!0}remove(t){F.remove(this.itemList,t),this.changed=!0}clear(){this.changed=!1,this.root=new en,this.itemList.length=0}flushWhenNeed(){if(this.changed){let t=new Array;for(let e of this.itemList)t.push(new en(e));for(;;){let e=this.organize(t);if(e.length>1)t=e;else break}this.root=new en(t),this.changed=!1}}organize(t){ie(t,ad,0,t.length);let e=t.length,r=[];for(let i=0;i<e;)if(i+this.capacity2<=e){let n=i+this.capacity2;ie(t,od,i,n);for(let s=i;s<n;s+=this.capacity){let o=new en(t.slice(s,s+this.capacity));r.push(o)}i=i+this.capacity*this.capacity}else{let n=new en(t.slice(i,i+this.capacity));r.push(n),i=i+this.capacity}return r}search(t){this.flushWhenNeed();let e=[],r=[];for(r.push(this.root);;){let i=r.shift();if(typeof i!="undefined"){let n=i.items();if(n instanceof Array){for(let s of n)if(!t.isSeparated(s.bbox())){let o=s.items();o instanceof Array?r.push(s):e.push(o)}}else t.isSeparated(i.bbox())||e.push(n)}else break}return e}walker(t){this.flushWhenNeed(),this._walker(this.root,0,t)}_walker(t,e,r){this.flushWhenNeed();let i=t.items();if(i instanceof Array)for(let n of i)this._walker(n,e+1,r);else r(i,e)}bbox(){return this.flushWhenNeed(),this.root.bbox()}};var Tr=class{constructor(){this.innerMap=new Nt}add(t){return this.innerMap.put(t,!0)!==!0}remove(t){this.innerMap.remove(t)}contains(t){return this.innerMap.get(t)===!0}iterator(){return this.innerMap.keys()}addAll(t){let e=t.iterator();for(;e.hasNext();)this.add(e.next())}size(){return this.innerMap.size()}clear(){let t=this.iterator();for(;t.hasNext();){let e=t.next();this.remove(e)}}};var Lc=F.funcCopy(ie);function wc(a,t){let e=0;if(Math.abs(a.start.y-t)<=1e-4)U[e++]=a.start.x;else if(Math.abs(a.end.y-t)<=1e-4)U[e++]=a.end.x;else if(a.shape instanceof S)e=Ou(a.shape,t);else if(a.shape instanceof R)e=Du(a.shape,t);else throw new Error("not supported operation");return e}var ui=class{constructor(t,e,r,i){this.sides=new Array;this.loader=t,this.loader.bo=this,this.logger=r,this.rule=e,this.event=i}static sortByBBoxMinY(t,e){return t.bbox().minY-e.bbox().minY}static sortByBBoxAreaDesc(t,e){return e.bbox().area()-t.bbox().area()}addPolyline(t,e=1,r=.01,i=!0){for(let n of this.loader.buildGroup(t,e,r,i))this.sides.push(n),this.event.onOriginSide(n)}buildRTree(){let t=new ze(10);for(let e of this.sides)t.add(e);return t}fillValidSides(t,e,r){for(let i of e)isFinite(i.getX(r))&&t.push(i)}getSortedEndpointsLineAsc(t){let e=new Array;for(let n of t)n.needCountWeight()&&(e.push(n.start),e.push(n.end));Lc(e,b.sortByYAsc,0,e.length);let r=new Array,i=Number.NEGATIVE_INFINITY;for(let n of e){let s=n.y;s>i&&(r.push(s),i=s)}return r}splitSides(t,e,r){let i=t.start,n=t.end,s=new b(n.x+(i.x-n.x)*2,n.y+(i.y-n.y)*2);Lc(t.inters,(l,u)=>l.distance2(s)-u.distance2(s),0,t.inters.length);let o=null;for(let l of t.inters)if(o==null)l.equals(i)&&(o=l);else if(!l.equals(o)){let u=jt.rebuild(t.shape,o,l);u instanceof R&&Math.abs(u.sweepAngle)>190&&(u=new S(o,l));let h=new jt(this,u,t.baseWeight,o,l,t.polyGrp,r++);if(e.push(h),h.updateBbox(),l.equals(n))break;o=l}return r}splitSidesByInters(){let t=new Array;for(let e of this.sides)if(e.polyIndex==0){let r=0,i=null,n=null;do{let s=new Array;r=this.splitSides(e,s,r);for(let o of s)i!=null?(i.next=o,o.previous=i):n=o,i=o,this.event.onSplitedSide(o),t.push(o);if(e.next===null)throw new Error("not supported operation");e=e.next}while(e.polyIndex!==0);n!=null&&i!=null&&(n.previous=i,i.next=n)}this.sides.length=0;for(let e of t)this.sides.push(e)}seekIntersection(){if(this.sides.length>0){let t=this.buildRTree(),e=new Tr;for(let r of this.sides){e.add(r);let i=r.bbox().extendOfSize(1e-5),n=r.shape instanceof S;for(let s of t.search(i))if(!e.contains(s)){let o=s.shape instanceof S;if(!(n&&o&&r.next!==null&&r.previous!==null&&(r.next.equals(s)||r.previous.equals(s)))){let l=Xe(r.shape,s.shape);for(let u=0;u<l;u+=2){let h=new b(U[u],U[u+1]);r.inters.push(h),s.inters.push(h),this.event.onIntersect(h,r,s)}}}}}}};var bs=class{constructor(t){this.sides=new Tr;this.others=new Tr;this.id=t}add(t){this.sides.add(t),t.finalGrp=this.id;for(let e of t.connect)this.others.add(e)}polyline(){let t=new Array;return dr(this.sides,(e,r)=>(t.push(r.shape),!0)),B.build2(t).asClose()}hashCode(){return this.id}equals(t){return t!=null&&t instanceof bs?this.id===t.id:!1}};var tn=class{constructor(t){this.bo=null;this.sides=new Array;this.polyGrp=0;this.polyIndex=0;this.prevSide=null;this.firstSide=null;this.noWeight0=t}completeGroup(t){this.prevSide!=null&&this.firstSide!=null&&!this.prevSide.end.equals(this.firstSide.start)&&this.addSide(new S(this.prevSide.end,this.firstSide.start),t);let e=new Array,r=null,i=null;for(let n of this.sides)(!this.noWeight0||n.weight!==0)&&(r!=null?(r.next=n,n.previous=r):i=n,r=n,e.push(n));return r!=null&&i!=null&&(i.previous=r,r.next=i),this.polyGrp++,this.sides.length=0,this.prevSide=null,this.firstSide=null,this.polyIndex=0,e}buildGroup(t,e,r,i=!0){for(let n of t.primitives)if(n instanceof S)this.addSide(n,e);else if(i&&n instanceof R&&n.rx===n.ry)this.addArc(n,e);else{let s=null;for(let o of n.points(r))s!=null&&this.addSide(new S(s,o),e),s=o}return this.completeGroup(e)}addArc(t,e){let r=t.sweepAngle,i=J.regularD(t.startAngle),n=i+r;if(r>0){let s=90;for(;s<=n;)s>i&&(this.addSide(R.build3(t.center,i,s-i,t.rx,t.ry),e),i=s),s+=90;i<n&&this.addSide(R.build3(t.center,i,n-i,t.rx,t.ry),e)}else if(r<0){let s=270;for(;s>=n;)s<i&&(this.addSide(R.build3(t.center,i,s-i,t.rx,t.ry),e),i=s),s-=90;i>n&&this.addSide(R.build3(t.center,i,n-i,t.rx,t.ry),e)}}addSide(t,e){if(t.start().equals(t.end()))return;let r=t.start(),i;this.prevSide!=null?(this.prevSide.end.equals(r)||this.addSide(new S(this.prevSide.end,r),e),i=new jt(this.bo,t,e,t.start(),t.end(),this.polyGrp,this.polyIndex++)):(i=new jt(this.bo,t,e,t.start(),t.end(),this.polyGrp,this.polyIndex++),this.firstSide=i),this.prevSide=i,this.sides.push(i)}};var rn=class{constructor(t,e,r){this.eps=new Array;this.curWeight=0;this.start=null;this.last=null;this.prevStart=null;this.prevEnd=null;this.y=r,this.rule=t,this.bo=e,this.event=e.event}onEp(t){this.tuningWeight(t),this.start===null?this.rule(this.curWeight)?this.in(t):t.setInvalid(this.y):this.rule(this.curWeight)?t.setInvalid(this.y):this.out(t,this.start),this.last!==null&&this.event.onSweep1(this.last,t,this.y),this.last=t}in(t){this.prevEnd!=null&&this.onSameX(t,this.prevEnd)?(this.start=this.prevStart,this.prevStart=null,this.prevEnd.revokeInside(this.y),this.prevEnd=null):(this.start=t,this.start.setOutside(this.y))}out(t,e){if(this.onSameX(e,t))e.revokeOutside(this.y);else{if(t.setInside(this.y)>0&&e.confidence(this.y)>0){let r=e.voteStatus(),i=t.voteStatus();this.isValid(r)&&this.isValid(i)?r==2&&i==1&&(t.connect.push(e),e.connect.push(t)):(t.connect.push(e),e.connect.push(t))}this.event.onSegment1(e,t,this.y),this.eps.push(e),this.eps.push(t),this.prevStart=e,this.prevEnd=t}this.start=null}isValid(t){return t==1||t==2}onSameX(t,e){return t.bbox().isIntersect(e.bbox())&&N.eq(t.getX(this.y),e.getX(this.y))}tuningWeight(t){this.curWeight+=t.weight;let e=t.nextNot0(),r=t.prevNot0();e!=null&&t.weight===e.weight&&e.trans===this.y&&(this.curWeight-=t.weight),r!=null&&t.weight===r.weight&&r.trans===this.y&&(this.curWeight-=t.weight),t.trans=this.y}};var ld=F.funcCopy(ie),ud=F.funcCopy(ie),hd=F.funcCopy(ie);function cd(a){return new Array}function Ma(a,t){let e=new at(!1),r=new It(a,ot.DUMMY,e);for(let i of t)r.addPolyline(i);return r.simplify(),e.plGrps}function Wr(a,t){a=a.asClose();let e=Ma(Kt,[a]),r=[];for(let i of e)F.addAll(r,i.items);if(t>0){for(let i of a.primitives)i instanceof S&&i.length()<1e-4||r.push(i.stroke(t*2,1,0));return Ma(Kt,r)}else if(t<0){t=-t;for(let i of a.primitives)r.push(i.stroke(t*2,1,1));return Ma(xc,r)}else return e}var It=class extends ui{constructor(e,r,i){super(new tn(!1),e,r,i);this.finalSides=new Array;this.sideGroups={};this.vecSides=new Array;this.scanY=NaN;this.curNetIndex=0;this.curIndex=-1;this.scanLines=0}sweep(e,r,i){this.scanY=NaN,this.scanLines=0,ld(r,ui.sortByBBoxMinY,0,r.length);let n=new Xt;this.curNetIndex=0;let s=Number.POSITIVE_INFINITY;for(let o of e)o>s&&this.scan(n,(s+o)/2,r),s=o;this.getAllMarkPrimitive(i,r),this.logger.debug3("scan %s %d",i,this.scanLines)}simplify(){this.seekIntersection(),this.splitSidesByInters(),this.sweep(this.getSortedEndpointsLineAsc(this.sides),this.sides,!1),this.flipSides(),this.sweep(this.getSortedEndpointsLineAsc(this.vecSides),this.vecSides,!0),this.connectSides(),this.fillResult()}addPolyline(e,r=1,i=.01,n=!0){super.addPolyline(e,r,i,n)}scan(e,r,i){if(this.scanY==r)return;this.scanY=r;let n=!1,s=e.listIterator();for(;s.hasNext();){let o=s.next(),l=o.item;N.less(l.bbox().maxY,r)?e.remove(o):!n&&l.isNeedScan(r)&&(n=!0)}for(;this.curNetIndex<i.length;){let o=i[this.curNetIndex];if(N.less(o.bbox().minY,r))N.greatereq(o.bbox().maxY,r)&&(this.add2AET(e,o),!n&&o.isNeedScan(r)&&(n=!0)),this.curNetIndex++;else break}if(n){this.scanLines++;let o=new rn(this.rule,this,r),l=e.iterator();for(;l.hasNext();){let u=l.next();o.onEp(u)}}}add2AET(e,r){let i=r.bbox().minX,n=r.bbox().maxX,s=r.bbox().minY,o=r.bbox().maxY,l=e.listIterator(),u=null;for(;l.hasNext();){let h,c=l.next(),f=c.item,d=f.bbox().minX,p=f.bbox().maxX;if(n<=d)h=-1;else if(p<=i)h=1;else{let g=f.bbox().minY,x=f.bbox().maxY,y=Math.max(s,g),P=Math.min(o,x);h=this.compareBySweep(r,f,(y+P)/2)}let m=f.shape;if(m instanceof S&&m.length()<.001&&u==null&&h<0){u=c;continue}if(u!=null&&h<0){e.insertBefore(u,r);return}if(h<0){e.insertBefore(c,r);return}else u=null}e.add(r)}getLineAngle(e){let r=e.start().angle(e.end());return r<0&&(r+=Math.PI),r}getArcAngle(e,r){let i=Math.asin((r-e.center.y)/e.rx);return e.startAngle>90&&e.startAngle<270&&(i=-i),i<0&&(i+=Math.PI),(i+Math.PI/2)%Math.PI}compareArcLine(e,r,i){let n=this.getArcAngle(e,i),s=this.getLineAngle(r);return N.eq(n,s)?-e.sweepAngle:s-n}compareBySweep(e,r,i){let n=e.getX(i);if(!isFinite(n))return 0;let s=r.getX(i);if(!isFinite(s))return 0;if(!N.eq(n,s))return n-s;if(e.shape instanceof S)return r.shape instanceof S?this.getLineAngle(r.shape)-this.getLineAngle(e.shape):-this.compareArcLine(r.shape,e.shape,i);if(r.shape instanceof S)return this.compareArcLine(e.shape,r.shape,i);{let o=e.shape,l=r.shape,u=this.getArcAngle(o,i),h=this.getArcAngle(l,i);return N.eq(u,h)?o.sweepAngle*l.sweepAngle<=0?o.sweepAngle<=0?1:-1:o.sweepAngle>0?o.rx-l.rx:l.rx-o.rx:h-u}}getAllMarkPrimitive(e,r){for(let i of r)if(i.status===0&&i.bbox().height()!=0){let n=i.voteStatus();if(n===2||n===1){i.status=n;let s=i.reverse(n);if(e){this.event.onResultSide(s);let o=s.shape.multiply3(me.ROT_N90),l=s.start.multiply3(me.ROT_N90),u=s.end.multiply3(me.ROT_N90);s=new jt(this,o,s.baseWeight,l,u,s.polyGrp,s.polyIndex)}this.finalSides.push(s),this.event.onResultSide(s)}}}flipSides(){for(let e of this.sides)if(e.polyIndex==0){let r=null,i=null;do{let n=e.shape.multiply3(me.ROT_90),s=e.start.multiply3(me.ROT_90),o=e.end.multiply3(me.ROT_90),l=new jt(this,n,e.baseWeight,s,o,e.polyGrp,e.polyIndex);if(l.outsideWeight=e.outsideWeight,l.insideWeight=e.insideWeight,l.invalidWeight=e.invalidWeight,l.status=e.status,r!=null?(r.next=l,l.previous=r):i=l,this.vecSides.push(l),this.event.onSplitedSide(l),r=l,e.next!==null)e=e.next;else break}while(e.polyIndex!=0);i!=null&&(i.previous=r,r.next=i)}}canBeEnd(e,r){if(e.size()==1){let i=e.getFirst().shape;if(i instanceof R){if(r&&i.rx<=r)return!1}else if(i instanceof S&&r&&i.length()<=r)return!1}return!0}connectSides(){let e=new Nt,r=new ze(10);for(let o of this.finalSides)e.computeIfAbsent(o.start,cd).push(o),r.add(o.start);let i=0,n=new Tr,s=new Array;for(let o of this.finalSides)if(!n.contains(o)){let l=new Tr,u=o.start,h=new Xt;h.add(o),n.add(o);let c=o.end;for(;h.size()>0;)if(this.isStart(u,c)&&this.canBeEnd(h,.01)){h.size()>1&&this.fillSideGroups(h,i++);break}else{let f=e.get(c),d=this.findNext(n,f);if(d==null&&(c=this.findNeigber(c,l,r,.01),c!==null&&(f=e.get(c),d=this.findNext(n,f))),d!=null)h.add(d),n.add(d),c=d.end;else if(c!=null?l.add(c):(s.length==0&&h.size()>1&&this.logger.warning3("unable to connect at %s",h.getLast()),s.push(h.removeLast())),h.size()>0)c=h.getLast().end;else break}}}fillSideGroups(e,r){let i=new bs(r);dr(e,(n,s)=>(i.add(s),!0)),this.sideGroups[i.id]=i}isStart(e,r){return e.distance2(r)<=1e-4}findNext(e,r){if(r!=null){for(let i of r)if(!e.contains(i))return i}return null}fillResult(){let e=0,r=new Nt;for(let n in this.sideGroups){let s=this.sideGroups[n];dr(s.sides,(o,l)=>(l.polyGrp!=-2&&r.put(l,l),!0))}let i=new Tr;for(let n in this.sideGroups){let s=this.sideGroups[n];if(i.add(s)){let o=0,l=new Array;for(l.push(s);o<l.length;){let h=l[o],c=new Array;dr(h.others,(d,p)=>{let m=r.get(p);return m!=null&&c.push(m.finalGrp),!0}),ud(c,F.sortAsc,0,c.length);let f=h.id;for(let d of c)if(d!=f&&d!=h.id){let p=this.sideGroups[d];i.add(p)&&l.push(p),f=d}o++}let u=new Array;for(let h of l)u.push(h.polyline());hd(u,ui.sortByBBoxAreaDesc,0,u.length),this.event.onPolylineGroup(new ee(u),e++)}}}findNeigber(e,r,i,n){let s=n*n,o=Number.MAX_VALUE,l=null;for(let u of i.search(e.bbox().extendOfSize(n)))if(!r.contains(u)){let h=e.distance2(u);h<o&&(o=h,l=u)}return o<s?l:null}};function fd(a){return{}}var nn=class{constructor(t){this.points=new Array;this.centerPlIds=new Nt;this.plIndex=new Array;this.net=t}add(t,e){let r=this.plIndex.length;for(let i of e)this.points.push(i),this.centerPlIds.computeIfAbsent(i,fd)[r]=!0;this.plIndex.push(t)}};var dl=new Error,Mc=new class extends dt{decide1(t){return t[0]&&t[1]}}(2),pd=new class extends ds{onPolylineGroup(t,e){throw dl}onSegment(t,e,r,i,n,s){throw dl}},Ku=class{constructor(t,e){this.rtree=t,this.level=e}},vi=class extends ui{static isIntersect(t,e,r=ot.DUMMY){let i=new vi(r),n=i.createGroup1(t.items),s=i.createGroup2(e.items);return n.rtree.itemList.length==0||s.rtree.itemList.length==0?!1:i.isIntersect(n,s)}constructor(t){super(new tn(!1),Mc.rule,t,pd)}createGroup1(t){return this.createGroup(t,0)}createGroup2(t){return this.createGroup(t,1)}createGroup(t,e){let r=Mc.weight(e);for(let n of t)this.addPolyline(n,r);let i=this.buildRTree();return this.sides.length=0,new Ku(i,e)}isIntersect(t,e){if(t.level!==e.level){let r=t.rtree.bbox().intersection1(e.rtree.bbox());if(r!==null){try{this.inters(t,e);let i=(r.minY+r.maxY)/2;this.sweep(t,e,i)}catch(i){if(i===dl)return!0;throw i}return!1}else return!1}else throw new Error("inersection detection should not in same group")}inters(t,e){if(t.rtree.size()>e.rtree.size()){let r=t;t=e,e=r}for(let r of t.rtree.items()){r.trans=NaN;let i=r.bbox().extendOfSize(1e-5);for(let n of e.rtree.search(i))if(n.trans=NaN,Xe(r.shape,n.shape)>0)throw dl}}sweep(t,e,r){let i=j.extend2(t.rtree.bbox(),e.rtree.bbox()).extendOfSize(1e-5),n=new Array;this.fillValidSides(n,t.rtree.search(i),r),this.fillValidSides(n,e.rtree.search(i),r),ie(n,(o,l)=>o.getX(r)-l.getX(r),0,n.length);let s=new rn(this.rule,this,r);for(let o of n)s.onEp(o)}};var gs=class{constructor(t){this.connected=new Array;this.plg=t,this.pi=new vi(ot.DUMMY),this.pig1=this.pi.createGroup1(t.items)}intersected(t){let e=this.pi.createGroup2(t instanceof ee?t.items:[t]);return this.pi.isIntersect(this.pig1,e)}};var dd=function(a,t){return t.bbox().area()-a.bbox().area()},Zu=new class extends dt{decide1(t){return!t[0]&&t[1]}}(2),hi=class{constructor(t,e,r,i,n){this.rtree=new ze(20);this.cache=new Array(30);this.bbox=t,this.autoConnectDistance=D.positive(e),this.cutWidth=D.positive(r),this.logger=i;for(let s of n)this.rtree.add(s)}addLine(t,e){let r=null,i=null;e?(r=t.start(),i=t.end()):(r=t.end(),i=t.start());let n=new j(r.x,r.x,r.y,r.y),s=this.rtree.search(n.extendOfSize(this.autoConnectDistance)),o=Number.MAX_VALUE,l=null;for(let u of s)if(u!=t){if(u.start().equals1(i)||u.end().equals1(i))continue;let h=u.start().distance2(r),c=u.end().distance2(r);h<o&&(o=h,l=u.start()),c<o&&(o=c,l=u.end())}return l}getDeltaLines(){let t=this.connect0().set.iterator(),e=new Array;for(;t.hasNext();){let r=t.next();e.push(r)}return e}connect0(){let t=new Array,e=new Array,r=new Set,i=new Tr;for(let n of this.rtree.items()){t.push(n);let s=0,o=0,l=this.rtree.search(n.bbox().extendOfSize(this.cutWidth)),u=!1;for(let h of l)if(n!=h&&((n.start().equals(h.start())||n.start().equals(h.end()))&&s++,(n.end().equals(h.start())||n.end().equals(h.end()))&&o++),s>0&&o>0){u=!0;break}if(!u)for(let h of l){if(n!=h){if(s==0){let c=this.addLine(n,!0);if(c!=null){let f=new S(n.start(),c);f.length()<=this.autoConnectDistance&&(i.contains(f)||(t.push(f),i.add(f)),s++)}}if(o==0){let c=this.addLine(n,!1);if(c!=null){let f=new S(n.end(),c);f.length()<=this.autoConnectDistance&&(i.contains(f)||(t.push(f),i.add(f)),o++)}}}if(s>0&&o>0)break}(s==0||o==0)&&(e.push(n),n instanceof R&&r.add(n))}for(let n of e)for(let s of this.rtree.search(n.bbox().extendOfSize(this.autoConnectDistance)))if(n!=s){let o=new vt(n,s),l=o.getDistance();if(this.cutWidth/10<l&&l<=this.autoConnectDistance){n instanceof R&&r.delete(n),s instanceof R&&r.delete(s);let u=o.getLine();i.contains(u)||(t.push(u),i.add(u))}}for(let n of r)n.end().distance1(n.start())<=this.autoConnectDistance&&t.push(new S(n.start(),n.end()));return{pts:t,set:i}}connect(){return this.connect0().pts}bboxOutline(){let t=this.bbox.extendOfSize(this.bbox.width());return new ee([B.build5([t.minX,t.minY,t.minX,t.maxY,t.maxX,t.maxY,t.maxX,t.minY]).asClose()])}detectBase(t){if(this.rtree.size()==0)return this.bboxOutline();let e=this.connect();if(e.length==0)return this.bboxOutline();{let r=new at(!1),i=new It(Zu.rule,this.logger,r);for(let o of e)i.addPolyline(o.stroke(this.cutWidth,1,0).asClose(),Zu.weight(0));let n=this.bbox.extendOfSize(Math.max(this.bbox.width(),this.bbox.height()));i.addPolyline(B.build5([n.minX,n.minY,n.minX,n.maxY,n.maxX,n.maxY,n.maxX,n.minY,n.minX,n.minY]),Zu.weight(1)),i.simplify(),r.debug&&r.display();let s=r.plGrps;return s.length<2?this.bboxOutline():(ie(s,dd,0,s.length),t(s))}}detect(){return this.detectBase(t=>{let e=new Array;for(let r=1;r<t.length;r++)F.addAll(e,t[r].items);return new ee(e)})}detect1(){return this.detectBase(t=>{let e=new Array;return F.addAll(e,t[0].items),new ee(e)})}};var ju=class extends ms{constructor(e){super(e);this.segments=new Array;this.y=NaN}onSegment(e,r,i,n,s,o){e=new b(i.getX(this.y),this.y),n=new b(o.getX(this.y),this.y),super.onSegment(e,r,i,n,s,o),this.segments.push(new S(e,n))}},sn=class extends ui{constructor(e){super(new tn(!0),Kt,e,new ju(!1));this.rtree=null;this.collector=this.event}addPolyline(e,r=1){super.addPolyline(e,r)}scan(e,r){this.rtree===null&&(this.rtree=this.buildRTree()),this.collector.y=e;let i=r.bbox().extendOfSize(1e-5),n=new Array;this.fillValidSides(n,this.rtree.search(i),e),ie(n,(l,u)=>l.getX(e)-u.getX(e),0,n.length);let s=new rn(this.rule,this,e);for(let l of n)s.onEp(l);let o=new Array;return F.addAll(o,this.collector.segments),this.collector.segments.length=0,o}};var Ac="\r",Aa=`\r
`,ml=class{constructor(t){this.ob=new Array;this.logger=t}obGetClean(){let t=this.ob.join("");return this.ob.length=0,t}autoD(t){return D.normal(t),(t|0)===t?t.toString():t.toFixed(4)}obWrite(t){this.ob.push(t)}item(t,e){let r=e.toString();/^[\x20-\x7e]*$/m.test(r)||(t="%UTF8%"+t),this.obWrite("|"),this.obWrite(t),this.obWrite("="),this.obWrite(r.replace(/\|/g,"\x8E"))}};var Qu=class{constructor(t,e,r){this.next=null;this.id=t,this.layer=e,this.name=r}toString(){return Pe.format("LayerNode%d %s alias %s next %d",this.id,this.layer,this.name,this.next==null?-1:this.next.id)}},bl=class{constructor(){this._layers=[];let t=1;this.add(I.TOP_COPPER,"Top Layer",t++);for(let e=1;e<=30;e++)this.add(new I(5,e),Pe.format("Mid-Layer %d",e),t++);this.add(I.BOT_COPPER,"Bottom Layer",t++),this.add(I.TOP_SILK,"Top Overlay",t++),this.add(I.BOT_SILK,"Bottom Overlay",t++),this.add(I.TOP_PASTE,"Top Paste",t++),this.add(I.BOT_PASTE,"Bottom Paste",t++),this.add(I.TOP_SOLDER_MASK,"Top Solder",t++),this.add(I.BOT_SOLDER_MASK,"Bottom Solder",t++);for(let e=1;e<=16;e++)this.add(new I(6,e),Pe.format("Internal Plane %d",e),t++);this.add(I.OTHER,"Drill Guide",t++),this.add(I.OUTLINE,"Keep-Out Layer",t++);for(let e=1;e<=16;e++)e===15?this.add(I.DOCUMENT,"Document",t++):e===16?this.add(I.OTHER,"Other",t++):this.add(new I(13,e),Pe.format("Mechanical %d",e),t++);this.add(I.OTHER,"Drill Drawing",t++),this.add(I.MULTI,"Multi-Layer",t++),this.add(I.OTHER,"Connections",t++),this.add(I.OTHER,"Background",t++),this.add(I.OTHER,"DRC Error Markers",t++),this.add(I.OTHER,"Selections",t++),this.add(I.OTHER,"Visible Grid 1",t++),this.add(I.OTHER,"Visible Grid 2",t++),this.add(I.OTHER,"Pad Holes",t++),this.add(I.OTHER,"Via Holes",t++)}layers(){return this._layers}add(t,e,r){this._layers.push(new Qu(r,t,e))}};var ys=class extends de{constructor(e,r,i,n,s,o,l){super("",e,r);this.location1=i,this.location2=n,this.rotation=D.normal(s),this.keepout=o,this.__bbox=this._bbox(),this.unFill=!!l}multiply3(e){let r=new H().ext2(this.location1).ext2(this.location2).build(),i=r.center().multiply3(e),n=e.iScale*r.width()/2,s=e.jScale*r.height()/2,o=i.add1(-n,-s),l=i.add1(n,s);return new ys(this.net,this.layer,o,l,J.transformD(this.rotation,e),this.keepout,this.unFill)}bbox(){return this.__bbox}_bbox(){let e=me.rotateD(this.rotation).setOrigin1(this.location1);return new H().ext2(this.location1).ext2(this.location2.multiply3(e)).build()}shape(e,r){let i=this.__bbox.extendOfSize(r);return this.layer.equals(e)?B.build4([i.LL(),i.UL(),i.UR(),i.LR(),i.LL()]):this.layer.equals(I.MULTI)?B.build4([i.LL(),i.UL(),i.UR(),i.LR(),i.LL()]):null}};var Vn=class extends de{constructor(e,r,i){super("",e,Vn.checkPlane(r));this.outline=i}static checkPlane(e){if(e.type===6)return e;throw new Error("plane zone must in plane layer")}multiply3(e){return new Vn(this.net,this.layer,this.outline.multiply3(e))}bbox(){return this.outline.bbox()}shape(e,r){return this.layer.equals(e)?this.outline:this.layer.equals(I.MULTI)?this.outline:null}};var gl=class{constructor(){this.obj={}}contains(t){return t in this.obj}isEmpty(){for(var t in this.obj)return!1;return!0}getOrDefault(t,e){let r=this.obj[t];return r===void 0?e:r}get(t){return this.obj[t]}put(t,e){let r=this.obj[t];return this.obj[t]=e,r}del(t){let e=this.obj[t];return delete this.obj[t],e}computeIfAbsent(t,e){let r=this.obj;if(t in r)return r[t];{let i=e(t.toString());return r[t]=i,i}}iterator(t){let e=this.obj;for(let r in e){let i=e[r];if(!t(r,i))break}}origin(){return this.obj}clear(){this.obj={}}size(){return Object.keys(this.obj).length}getKeys(){return Object.keys(this.obj)}getValues(){return Object.values(this.obj)}};var xs=class extends de{constructor(e,r,i,n){super(e,r,i);this.plg=n}multiply3(e){let r=new Array;for(let i of this.plg)r.push(i.multiply3(e));return new xs(this.id,this.net,this.layer,r)}bbox(){let e=new H;for(let r of this.plg)e.ext1(r.bbox());return e.build()}shape(e,r){throw new Error("unsupported operation")}};var md=new b(1500,1500),ci=500,$u=new pt(0,0,0,0,null),on=class extends ml{constructor(e,r){super(r);this.comp_idx=-1;this.net_idx=0;this.polygon_idx=-1;this.comp=null;this.nets=new gl;this.usedLayers=new Ki;this.doc=e}net(e){if(!D.nullOrEmpty(e)){let r=this.nets.computeIfAbsent(e,()=>this.net_idx++);this.item("NET",r)}}autoPO(e){switch(e){case 0:return"ROUND";case 1:return"RECTANGLE";case 3:return"OCTAGONAL";case 2:return"ROUNDEDRECTANGLE";default:return this.logger.warning3("unknow pad out shape %s",e),"ROUND"}}autoLayer(e){switch(this.usedLayers.add(e),e.type){case 4:return"TOP";case 3:return"TOPPASTE";case 1:return"TOPOVERLAY";case 2:return"TOPSOLDER";case 7:return"BOTTOM";case 8:return"BOTTOMPASTE";case 10:return"BOTTOMOVERLAY";case 9:return"BOTTOMSOLDER";case 6:return"PLANE"+e.order;case 5:return"MID"+e.order;case 13:return"MECHANICAL"+e.order;case 0:return"MULTILAYER";case 16:return"MECHANICAL16";case 11:return"KEEPOUT";case 12:return"MECHANICAL15";default:return this.logger.warning3("unknow layer type %d use mechanical instead",Hh(e.type)),"MECHANICAL16"}}autoMil(e){return this.autoD(e)+"mil"}export(){let e=new H;for(let r of this.doc.shapes)e.ext1(r.bbox());if(e.valid()){let r=e.build(),i=me.translate(-r.minX,-r.minY).scale(this.doc.scale).translate1(md),n=new Array,s=new Array;for(let f of this.doc.shapes){let d=f instanceof ir;for(let p of this.dispatcher(f.multiply3(i)))d?(d=!1,n.push(p)):s.push(p)}if(r=r.transform(i),!this.usedLayers.contains(I.DOCUMENT)){let f=new ye("",I.DOCUMENT,r.center().add1(-1,-1),r.center().add1(1,1),.1);s.push(this.gnrPcbTrack(f)[0])}let o=new Array;this.item("RECORD","Board"),this.item("KIND","Protel_Advanced_PCB"),this.item("VERSION","5.00");let l=[r.LR().add1(ci,-ci),r.LL().add1(-ci,-ci),r.UL().add1(-ci,ci),r.UR().add1(ci,ci),r.LR().add1(ci,-ci)];for(let f=0;f<l.length;f++){let d=l[f];this.item("KIND"+f,this.autoD(0)),this.item("VX"+f,this.autoMil(d.x)),this.item("VY"+f,this.autoMil(d.y)),this.item("CX"+f,this.autoMil(0)),this.item("CY"+f,this.autoMil(0)),this.item("SA"+f,this.autoD(0)),this.item("EA"+f,this.autoD(0)),this.item("R"+f,this.autoMil(0))}o.push(this.obGetClean());for(let f of new bl().layers()){f.id%5===1&&(o.push(this.obGetClean()),this.item("RECORD","Board"));let d=Pe.format("LAYER%d",f.id);this.item(d+"NAME",f.name);let p;switch(f.name){case"Top Layer":p=32;break;case"Top Overlay":case"Top Paste":case"Top Solder":p=1;break;default:p=0}if(Pe.startsWith(f.name,"Mechanical")){let m=parseInt(f.name.substring(11));(this.usedLayers.contains(new I(13,m))||m===15&&this.usedLayers.contains(I.DOCUMENT)||m===16&&this.usedLayers.contains(I.OTHER))&&this.item(d+"MECHENABLED","TRUE")}this.item(d+"NEXT",p),this.item(d+"DIELTYPE","0"),this.item(d+"DIELCONST","4.800"),this.item(d+"DIELHEIGHT","12.6mil"),this.item(d+"DIELMATERIAL","FR-4")}o.push(this.obGetClean());let u=new Array;this.nets.iterator((f,d)=>(this.item("RECORD","Net"),this.item("ID",d),this.item("NAME",f),this.item("VISIBLE","FALSE"),this.item("JUMPERSVISIBLE","FALSE"),u.push(this.obGetClean()),!0));let h=!0,c=new Array;for(let f of o)f.length>0&&(h?h=!1:c.push(Ac),c.push(f));for(let f of u)c.push(Aa),c.push(f);for(let f of n)c.push(Aa),c.push(f);for(let f of s)c.push(Aa),c.push(f);return c.push(Aa),c}else return null}dispatcher(e){return e instanceof ye?this.gnrPcbTrack(e):e instanceof Ci?this.gnrPcbString(e):e instanceof Ve?this.gnrPcbPolygonPour(e):e instanceof ue?this.gnrPcbVia(e):e instanceof he?this.gnrPcbPad(e):e instanceof ir?this.gnrPcbComponent(e):e instanceof yr?this.gnrPcbArc(e):e instanceof Zt?this.gnrPcbRegion(e):e instanceof ys?this.gnrPcbFill(e):e instanceof Vn?this.gnrPcbPlaneZone(e):e instanceof xs?this.gnrPcbImage(e):(this.logger.warning3("%s is not supported",e),[])}gnrPcbImage(e){if(this.comp===null){let r=new En;return r.location=e.bbox().UL(),r.pattern="IMPORTED_IMAGE",r.comment=new Ci(e.net,e.layer,r.location,0,r.pattern,new Ti("",1,1),!1),r.showComment=!1,r.designator=r.comment,r.showDesignator=!1,r.layer=e.layer,r.orientation=0,r.shapes.push(e),this.gnrPcbComponent(r.build())}else{let r=new at(!1),i=new It(Pc,this.logger,r);for(let s of e.plg)i.addPolyline(s);i.simplify();let n=new Array;for(let s of r.plGrps)n.push(this.gnrPcbImagePolygonGroup(e,s));return n}}gnrPcbImagePolygonGroup(e,r){this.item("RECORD","Region"),this.comp!==null&&this.item("COMPONENT",this.autoD(this.comp_idx)),this.net(e.net),this.item("SELECTION","FALSE"),this.item("LAYER",this.autoLayer(e.layer)),this.item("LOCKED","FALSE"),this.item("POLYGONOUTLINE","FALSE"),this.item("ISSHAPEBASED","TRUE"),this.item("KIND","0");let i=r.items;for(let n=0;n<i.length;n++){let s=i[n];if(n===0)if(s.primitives.length===0)this.item("MAINCONTOURVERTEXCOUNT",this.autoD(0));else{let o=s.primitives,l=s.closed()?o.length+1:o.length+2;this.item("MAINCONTOURVERTEXCOUNT",this.autoD(l)),this.generatePolygon(o)}else n===1&&this.item("HOLECOUNT",this.autoD(i.length-1)),this.generatePolygonHole(s,n-1)}return this.obGetClean()}gnrPcbPlaneZone(e){return this.item("RECORD","Polygon"),this.net(e.net),this.item("SELECTION","FALSE"),this.item("LAYER",this.autoLayer(e.layer)),this.item("LOCKED","FALSE"),this.item("POLYGONTYPE","Split Plane"),this.item("POLYGONOUTLINE","FALSE"),this.generatePolygon(e.outline.primitives),[this.obGetClean()]}gnrPcbTrack(e){return this.item("RECORD","Track"),this.comp!==null&&this.item("COMPONENT",this.autoD(this.comp_idx)),this.net(e.net),this.item("SELECTION","FALSE"),this.item("LAYER",this.autoLayer(e.layer)),this.item("LOCKED","FALSE"),this.item("POLYGONOUTLINE","FALSE"),this.item("X1",this.autoMil(e.start.x)),this.item("Y1",this.autoMil(e.start.y)),this.item("X2",this.autoMil(e.end.x)),this.item("Y2",this.autoMil(e.end.y)),this.item("WIDTH",this.autoMil(e.width)),[this.obGetClean()]}gnrPcbString(e){this.item("RECORD","Text"),this.comp!==null&&(this.item("COMPONENT",this.autoD(this.comp_idx)),e===this.comp.designator&&this.item("DESIGNATOR","True"),e===this.comp.comment&&this.item("COMMENT","True")),this.net(e.net),this.item("SELECTION","FALSE"),this.item("LAYER",this.autoLayer(e.layer)),this.item("LOCKED","FALSE"),D.nullOrEmpty(e.font.familly)?(this.item("FONTNAME","Arial"),this.item("USETTFONTS","FALSE")):(this.item("FONTNAME",e.font.familly),this.item("USETTFONTS","TRUE"));let r=new Array;for(let i=0;i<e.text.length;i++){let n=e.text.charCodeAt(i);r.push(n.toString())}return this.item("WIDESTRING",r.join(",")),e.text.indexOf(`
`)>=0&&this.item("MULTILINE","TRUE"),this.item("WIDTH",this.autoMil(e.font.weight)),this.item("HEIGHT",this.autoMil(e.font.size)),this.item("ROTATION",this.autoD(e.rotation)),this.item("MIRROR",e.mirror?"TRUE":"FALSE"),this.item("X",this.autoMil(e.location.x)),this.item("Y",this.autoMil(e.location.y)),[this.obGetClean()]}gnrPcbPolygonPour(e){return this.item("RECORD","Polygon"),this.comp!==null&&this.item("COMPONENT",this.autoD(this.comp_idx)),this.net(e.net),this.item("ID",this.autoD(++this.polygon_idx)),this.item("POLYGONTYPE","Polygon"),this.item("POUROVERSTYLE",this.autoD(1)),this.item("HATCHSTYLE","Solid"),this.item("SELECTION","FALSE"),this.item("LAYER",this.autoLayer(e.layer)),this.item("LOCKED","FALSE"),this.generatePolygon(e.outlines),[this.obGetClean()]}generatePolygonHole(e,r){let i=new Array;for(let s of e.asClose().primitives)for(let o of s.points(1))i.push(o);this.item("HOLE"+r+"VERTEXCOUNT",this.autoD(i.length));let n="H"+r;for(let s=0;s<i.length;s++){let o=i[s];this.item(n+"VX"+s,this.autoD(o.x*1e4)),this.item(n+"VY"+s,this.autoD(o.y*1e4))}}generatePolygon(e){let r=null,i=null,n=0;for(let s of e)s instanceof S?(r===null&&(r=s.start()),i=s.end(),this.generatePolygonSideP(s.start(),n++)):s instanceof R&&(r===null&&(r=s.start()),i=s.end(),this.generatePolygonSideA(s,n++));i!==null&&this.generatePolygonSideP(i,n++),r!==null&&!r.equals(i)&&this.generatePolygonSideP(r,n)}generatePolygonSideA(e,r){this.item("KIND"+r,this.autoD(1)),this.item("VX"+r,this.autoMil(e.start().x)),this.item("VY"+r,this.autoMil(e.start().y)),e.sweep()===0&&(e=e.exchangeSweep()),this.item("CX"+r,this.autoMil(e.center.x)),this.item("CY"+r,this.autoMil(e.center.y)),this.item("SA"+r,this.autoD(e.startAngle)),this.item("EA"+r,this.autoD(e.endAngle())),this.item("R"+r,this.autoD(e.rx))}generatePolygonSideP(e,r){this.item("KIND"+r,this.autoD(0)),this.item("VX"+r,this.autoMil(e.x)),this.item("VY"+r,this.autoMil(e.y)),this.item("CX"+r,this.autoMil(0)),this.item("CY"+r,this.autoMil(0)),this.item("SA"+r,this.autoD(0)),this.item("EA"+r,this.autoD(0)),this.item("R"+r,this.autoMil(0))}gnrPcbVia(e){return this.item("RECORD","Via"),this.comp!==null&&this.item("COMPONENT",this.autoD(this.comp_idx)),this.net(e.net),this.item("SELECTION","FALSE"),isNaN(e.topPad)?isNaN(e.botPad)?this.item("STARTLAYER","MIDLAYER1"):this.item("STARTLAYER","BOTTOM"):this.item("STARTLAYER","TOP"),isNaN(e.botPad)?isNaN(e.topPad)?this.item("ENDLAYER","MIDLAYER1"):this.item("ENDLAYER","TOP"):this.item("ENDLAYER","BOTTOM"),this.item("LOCKED","FALSE"),this.item("X",this.autoMil(e.center.x)),this.item("Y",this.autoMil(e.center.y)),this.item("HOLESIZE",this.autoD(e.holeDiameter)),this.item("PADMODE",this.autoD(0)),this.item("TOPLAYERSIZE",this.autoMil(e.topPad)),this.item("MIDLAYER1SIZE",this.autoMil(e.innerPad)),this.item("BOTTOMLAYERSIZE",this.autoMil(e.botPad)),this.item("DIAMETER",this.autoD(e.innerPad)),[this.obGetClean()]}gnrPcbPad(e){let r=new Array,i=new Array,n=e.shapes,s=n.top,o=n.inner,l=n.bot;if(s!==null&&s.outline!==null){let h=s.outline;i.push(new Zt(e.net,I.TOP_COPPER,0,h)),e.plated&&i.push(new Zt(e.net,I.TOP_PASTE,0,h)),i.push(new Zt(e.net,I.TOP_SOLDER_MASK,0,h)),s=$u}if(l!==null&&l.outline!==null){let h=l.outline;i.push(new Zt(e.net,I.BOT_COPPER,0,h)),e.plated&&i.push(new Zt(e.net,I.BOT_PASTE,0,h)),i.push(new Zt(e.net,I.BOT_SOLDER_MASK,0,h)),l=$u}if(o!==null&&o.outline!==null){let h=o.outline;for(let c of this.doc.layerStack)c.type===5&&i.push(new Zt(e.net,c,0,h));o=$u}for(let h of i)F.addAll(r,this.gnrPcbRegion(h));switch(this.item("RECORD","Pad"),this.comp!==null&&this.item("COMPONENT",this.autoD(this.comp_idx)),this.net(e.net),this.item("SELECTION","FALSE"),this.item("LAYER",this.autoLayer(e.layer)),this.item("LOCKED","FALSE"),this.item("ROTATION",this.autoD(J.regularD(e.rotation))),this.item("NAME",e.designator),this.item("HOLEWIDTH",this.autoD(e.hole.length)),this.item("PLATED",e.plated?"TRUE":"FALSE"),e.hole.type){case 0:this.item("HOLETYPE",this.autoD(0));break;case 1:this.item("HOLETYPE",this.autoD(1));break;case 2:this.item("HOLETYPE",this.autoD(2));break;default:this.logger.warning3("unknow hole shape %s",e.hole.type),this.item("HOLETYPE",this.autoD(0))}this.item("HOLESIZE",this.autoMil(e.hole.size)),this.item("HOLEROTATION",this.autoD(J.regularD(e.hole.rotation))),this.item("PADXOFFSET0",this.autoMil(e.hole.offsetX)),this.item("PADYOFFSET0",this.autoMil(e.hole.offsetY)),this.item("X",this.autoMil(e.location.x)),this.item("Y",this.autoMil(e.location.y)),this.item("PADMODE",this.autoD(0));let u;return s!==null&&l!==null?(this.item("TOPSHAPE",this.autoPO(s.type)),this.item("TOPXSIZE",this.autoMil(s.xSize)),this.item("TOPYSIZE",this.autoMil(s.ySize)),this.item("TOPLAYERCRPCT",this.autoD(s.cornerRadius)),this.item("BOTSHAPE",this.autoPO(l.type)),this.item("BOTXSIZE",this.autoMil(l.xSize)),this.item("BOTYSIZE",this.autoMil(l.ySize)),this.item("BOTTOMLAYERCRPCT",this.autoD(l.cornerRadius)),u=D.notnull(o)):s!==null?(u=s,this.item("TOPLAYERCRPCT",this.autoD(s.cornerRadius))):l!==null?(u=l,this.item("BOTTOMLAYERCRPCT",this.autoD(l.cornerRadius))):u=D.notnull(e.shapes.inner),this.item("SHAPE",this.autoPO(u.type)),this.item("XSIZE",this.autoMil(u.xSize)),this.item("YSIZE",this.autoMil(u.ySize)),this.item("MIDLAYER1CRPCT",this.autoD(u.cornerRadius)),r.push(this.obGetClean()),r}gnrPcbComponent(e){let r=new Array;this.comp_idx++,this.item("RECORD","Component"),this.item("ID",this.autoD(this.comp_idx)),this.item("LAYER",this.autoLayer(e.layer)),this.item("X",this.autoMil(e.location.x)),this.item("Y",this.autoMil(e.location.y)),this.item("ROTATION",this.autoD(e.orientation)),this.item("PATTERN",e.pattern),this.item("SOURCEDESIGNATOR",e.designator.text),this.item("NAMEON",e.showDesignator?"TRUE":"FALSE"),this.item("COMMENTON",e.showComment?"TRUE":"FALSE"),r.push(this.obGetClean()),this.comp=e,F.addAll(r,this.gnrPcbString(e.designator)),F.addAll(r,this.gnrPcbString(e.comment));for(let i of e.shapes)F.addAll(r,this.dispatcher(i));return this.comp=null,r}gnrPcbArc(e){let r=e.arc,i=r.start(),n=r.end();if(i.distance2(n)>1e-4||r.isLarge()){this.item("RECORD","Arc"),this.comp===null||this.item("COMPONENT",this.autoD(this.comp_idx));let s=e.arc;return s.sweep()===0&&(s=s.exchangeSweep()),this.net(e.net),this.item("SELECTION","FALSE"),this.item("LAYER",this.autoLayer(e.layer)),this.item("LOCKED","FALSE"),this.item("WIDTH",this.autoD(e.width)),this.item("LOCATION.X",this.autoMil(s.center.x)),this.item("LOCATION.Y",this.autoMil(s.center.y)),this.item("STARTANGLE",this.autoD(s.startAngle)),this.item("ENDANGLE",this.autoD(s.endAngle())),this.item("RADIUS",this.autoMil(s.rx)),this.item("SECONDARYRADIUS",this.autoMil(s.ry)),this.item("KEEPOUT",e.keepout?"TRUE":"FALSE"),[this.obGetClean()]}else return this.gnrPcbTrack(new ye(e.net,e.layer,i,n,e.width))}gnrPcbRegion(e){switch(this.item("RECORD","Region"),this.comp!==null&&this.item("COMPONENT",this.autoD(this.comp_idx)),this.net(e.net),this.item("SELECTION","FALSE"),this.item("LAYER",this.autoLayer(e.layer)),this.item("LOCKED","FALSE"),this.item("POLYGONOUTLINE","FALSE"),this.item("ISSHAPEBASED","TRUE"),e.kind){case 2:this.item("KIND","0"),this.item("ISBOARDCUTOUT","TRUE");break;case 1:this.item("KIND","1");break;case 0:this.item("KIND","0");break;default:this.logger.warning3("unknow region kind %s",e.kind),this.item("KIND","0")}if(e.outlines.primitives.length===0)this.item("MAINCONTOURVERTEXCOUNT",this.autoD(0));else{let r=e.outlines instanceof ee?e.outlines.items:[e.outlines];for(let i of r){let n=i.primitives,s=i.closed()?n.length:n.length+1;this.item("MAINCONTOURVERTEXCOUNT",this.autoD(s)),this.generatePolygon(n)}}return this.item("HOLECOUNT",this.autoD(0)),[this.obGetClean()]}gnrPcbFill(e){return this.item("RECORD","Fill"),this.comp!==null&&this.item("COMPONENT",this.autoD(this.comp_idx)),this.net(e.net),this.item("SELECTION","FALSE"),this.item("LAYER",this.autoLayer(e.layer)),this.item("LOCKED","FALSE"),this.item("ROTATION",this.autoD(e.rotation)),this.item("X1",this.autoMil(e.location1.x)),this.item("Y1",this.autoMil(e.location1.y)),this.item("X2",this.autoMil(e.location2.x)),this.item("Y2",this.autoMil(e.location2.y)),this.item("KEEPOUT",e.keepout?"TRUE":"FALSE"),[this.obGetClean()]}};function yl(a,t){for(let e=0;e<a;e+=2){let r=new b(U[e],U[e+1]),i=!0;for(let n of t)n.distance2(r)<1e-8&&(i=!1);i&&t.push(r)}return t}function Un(a){let t=[];if(a=a.filter(r=>r.length),a.length)for(let r=0;r<a.length;r++){let i=a[r].slice(),n=a[r],s=a[r+1];for(;s&&n[n.length-1].end().equals1(s[0].start());)i.push(...s),r++,n=a[r],s=a[r+1];if(Ia(B.build2(i)))return!0;t.push(i)}if(t.length>=2){for(let i of t)if(i.length>=2){let n=i[0],s=i[i.length-1];if(n.start().distance2(s.end())<1e-8)return!0}let r=t.length;for(let i=0;i<r;i++)for(let n=i+1;n<r;n++)if(e(i,n))return!0}return!1;function e(r,i){let n=t[r],s=t[i];for(let o=0;o<n.length;o++)for(let l=0;l<s.length;l++){let u=n[o],h=s[l],c=Xe(u,h),f=yl(c,[]);if(c>0)if(r==0&&i==t.length-1&&o==0&&l==s.length-1){if(!(c==2&&f.length==1&&u.start().distance2(h.end())<1e-8))return!0}else return!0}return!1}}function MB(a,t,e){let r=[],i=[],n=t.start(),s=a.length-1,o=l(t,s);return o&&(i.push(0),s=s-o+1,s<a.length&&l(e,s)&&i.push(1)),{coincideLines:r,coincidePoint:n,drawCoincideLines:i};function l(h,c){let f=0;for(;c>=0&&h;){let d=!0,p=a[c],m=Xe(p,h);if(m>=2){let g=yl(m,[]);c==0&&i.length==1&&g.length==1&&p.start().distance2(h.end())<1e-8||(d=g.some(x=>x.distance2(n)<1e-8||x.distance2(p.end())<1e-8))}if(m>=4&&!u(p,h)&&(d=!1),m>=4&&h instanceof R&&p instanceof R&&(Math.abs(h.rx-p.rx)>1e-8||h.center.distance1(p.center)>1e-8)&&(d=!1),d){let g=yl(m,[p.end()]);m>=4&&g.length>=2&&(n=g[1],(!r.length||r[r.length-1]!=c)&&(r.push(c),f++))}else return 0;c--}return f}function u(h,c){return h instanceof S&&c instanceof S||h instanceof R&&c instanceof R}}function Ia(a){return a instanceof B?Ic(a):!!a.items.some(r=>Ic(r))}function Ic(a){let t=new Array;a.primitives.forEach(r=>{r instanceof S&&r.length()<.01||t.push(r)});let e=t.length;if(e==2){let r=t[0],i=t[1];if(r instanceof S&&i instanceof S&&r.end().equals1(i.start())&&i.end().equals1(r.start()))return!0;let n=Xe(t[0],t[1]);for(let s=0;s<n;s+=2){let o=new b(U[s],U[s+1]);if(!(o.distance2(t[0].start())<1e-8||o.distance2(t[0].end())<1e-8)){if(!(o.distance2(t[1].start())<1e-8||o.distance2(t[1].end())<1e-8))return!0}}}else if(e>2)for(let r=0;r<e;r++){let i=t[r];if(r+1<e){let n=t[r+1],s=[i.end()],o=Xe(i,n);if(s=yl(o,s),s.length>1)return!0}for(let n=r+2;n<e;n++){let s=t[n],o=Xe(i,s);if(r==0&&n==e-1){for(let l=0;l<o;l+=2)if(new b(U[l],U[l+1]).distance1(i.start())>=1e-4)return!0}else if(o>0)return!0}}return!1}var mt=class extends de{constructor(e,r,i,n,s){super(e,r,i);this.outline=n,this.connect=s,this.__bbox=this.outline.bbox()}shape(e,r){return this.layer.equals(e)||this.layer.equals(I.MULTI)?this.outline:null}bbox(){return this.__bbox}multiply3(e){return new mt(this.id,this.net,this.layer,this.outline.multiply3(e),this.connect)}};var Hr=class extends de{constructor(e,r,i,n,s=""){super(s,e,r);this.type=i,this.outlines=n,this.__bbox=this._bbox()}multiply3(e){return new Hr(this.net,this.layer,this.type,this.outlines.multiply3(e),this.id)}bbox(){return this.__bbox}_bbox(){return this.outlines.bbox()}shape(e,r){return this.layer.equals(e)||this.layer.equals(I.MULTI)?this.outlines:null}};var fi=class{constructor(t,e){this.minDistance=Number.MAX_VALUE;this.p=t,this.p1=e,this.intersection()?this.minDistance=0:this.minline=this.minLine()}getDistance(){return this.minDistance}getLine(){return this.minline}intersection(){let t=Xe(this.p,this.p1);if(t>0){let e=new Array;for(let r=0;r<t;r+=2){let i=new b(U[r],U[r+1]);e.push(i)}e.length>1?this.minline=new S(e[0],e[1]):this.minline=new S(e[0],e[0])}return t>0}minLine(){if(this.p instanceof S&&this.p1 instanceof S){let t=this.p,e=this.p1;return this.minDistanceForLines(t,e,this.minline)}else if(this.p instanceof R&&this.p1 instanceof S){let t=this.p,e=this.p1;return this.minDistanceForLineAndArc(t,e,this.minline)}else if(this.p instanceof S&&this.p1 instanceof R){let t=this.p1,e=this.p;return this.minDistanceForLineAndArc(t,e,this.minline)}else if(this.p instanceof R&&this.p1 instanceof R){let t=this.p,e=this.p1;return this.minDistanceForArcs(t,e,this.minline)}return this.minline}minDistanceForLines(t,e,r){let i=[t.start(),t.end(),e.start(),e.end()];for(let n=0;n<i.length;n++)n<2?r=this.point2LineMinLine(r,e,i[n]):r=this.point2LineMinLine(r,t,i[n]);return r}minDistanceForLineAndArc(t,e,r){t.isCircle(),r=this.point2LineMinLine(r,e,t.start()),r=this.point2LineMinLine(r,e,t.svgEnd);let i=fi.foot(e,t.center);return e.bbox().extendOfSize(1e-8).isContains(i)&&(r=this.point2ArcMinLine(r,t,i)),r=this.point2ArcMinLine(r,t,e.start()),r=this.point2ArcMinLine(r,t,e.end()),r}minDistanceForArcs(t,e,r){return r=this.concentricArc(t,e,r),r=this.point2ArcMinDistance(e.start(),t,r),r=this.point2ArcMinDistance(e.svgEnd,t,r),r=this.point2ArcMinDistance(t.start(),e,r),r=this.point2ArcMinDistance(t.svgEnd,e,r),(xr(t,e.center)||xr(e,t.center))&&(r=this.shortestLineForArcs(t,e,r)),r}minLineForArcAndLine(t,e,r){let i=t.pointOn(r.angleD(t.center)),n=t.pointOn(t.center.angleD(r));return e=this.arcShortestLine(t,e,r,i),e=this.arcShortestLine(t,e,r,n),e}arcInnerLineFootSegment(t,e,r){let i=r.distance1(t.center);if(i!==0){let n=t.rx*(r.y-t.center.y)/i+t.center.y,s=t.rx*(r.x-t.center.x)/i+t.center.x,o=new S(new b(s,n),r);i=t.rx-i,i<this.minDistance&&(this.minDistance=i,e=o)}else{let n=new S(t.start(),r);i=t.rx-i,i<this.minDistance&&(this.minDistance=i,e=n)}return e}shortestLineForArcs(t,e,r){let i=t.center.angleD(e.center),n=e.center.angleD(t.center),s=t.pointOn(i),o=t.pointOn(n),l=e.pointOn(i),u=e.pointOn(n);return xr(t,s)&&(r=this.arcShortestLine(e,r,s,l),r=this.arcShortestLine(e,r,s,u)),xr(t,o)&&(r=this.arcShortestLine(e,r,o,l),r=this.arcShortestLine(e,r,o,u)),r=this.shortestLineForArcs1(t,e,r),r}shortestLineForArcs1(t,e,r){let i=e.start().sub(t.center).normalize(),n=e.end().sub(t.center).normalize(),s=t.start().sub(e.center).normalize(),o=t.end().sub(e.center).normalize(),l=t.center.add(i.mul(t.rx)),u=t.center.add(n.mul(t.rx)),h=e.center.add(s.mul(e.rx)),c=e.center.add(o.mul(e.rx));return xr(t,l)&&N.greater(e.start().distance2(t.center),0)&&(r=this.arcShortestLine(t,r,e.start(),l)),xr(t,u)&&N.greater(e.end().distance2(t.center),0)&&(r=this.arcShortestLine(t,r,e.end(),u)),xr(e,h)&&N.greater(t.start().distance2(e.center),0)&&(r=this.arcShortestLine(e,r,t.start(),h)),xr(e,c)&&N.greater(t.end().distance2(e.center),0)&&(r=this.arcShortestLine(e,r,t.end(),c)),r}concentricArc(t,e,r){if(t.center.distance1(e.center)<1e-5&&t.rx===e.rx&&t.ry===e.ry){let i=new S(t.start(),e.svgEnd);i.length()<this.minDistance&&(this.minDistance=i.length(),r=i),i=new S(e.start(),t.svgEnd),i.length()<this.minDistance&&(this.minDistance=i.length(),r=i)}return r}point2ArcMinDistance(t,e,r){if(xr(e,t)){let i=e.pointOn(t.angleD(e.center)),n=e.pointOn(e.center.angleD(t));r=this.arcShortestLine(e,r,t,i),r=this.arcShortestLine(e,r,t,n)}else r=this.minLineSegment(r,e.start(),t),r=this.minLineSegment(r,e.svgEnd,t);return r}point2ArcMinLine(t,e,r){if(xr(e,r)){let i=r.distance1(e.center);i>e.rx||i>e.ry?t=this.minLineForArcAndLine(e,t,r):t=this.arcInnerLineFootSegment(e,t,r)}return t}point2LineMinLine(t,e,r){let i=fi.foot(e,r);return e.bbox().extendOfSize(1e-8).isContains(i)?t=this.minLineSegment(t,i,r):(t=this.minLineSegment(t,e.start(),r),t=this.minLineSegment(t,e.end(),r)),t}minLineSegment(t,e,r){let i=e.distance1(r);return i<this.minDistance&&(this.minDistance=i,t=new S(e,r)),t}arcShortestLine(t,e,r,i){if(xr(t,i)){let n=new S(r,i),s=n.length();s<this.minDistance&&(this.minDistance=s,e=n)}return e}static foot(t,e){if(t.isPoint())return t.start();if(!N.eq(t.b,0)&&!N.eq(t.a,0)){let r=(t.b*t.b*e.x-t.a*t.b*e.y-t.a*t.c)/(t.b*t.b+t.a*t.a),i=(-t.a*t.b*e.x+t.a*t.a*e.y-t.b*t.c)/(t.b*t.b+t.a*t.a);return new b(r,i)}else return N.eq(t.b,0)&&!N.eq(t.a,0)?new b(t.start().x,e.y):!N.eq(t.b,0)&&N.eq(t.a,0)?new b(e.x,t.start().y):e}};function xr(a,t){if(N.eq(a.sweepAngle,360))return!0;let e=J.regularD(t.angleD(a.center));return a.sweepAngle>0?(N.less(e,a.startAngle)&&(e+=360),N.greatereq(a.endAngle(),e)):(N.greater(e,a.startAngle)&&(e-=360),N.lesseq(a.endAngle(),e))}var Gn=Math.PI*2,n_=Math.PI,Fn=Math.PI/2,s_=Math.sin(Math.PI/180);function Ni(a){return a=a%Gn,a<=-Fn?a+=Math.PI:a>=Fn&&(a-=Math.PI),a}function o_(a){return a/Math.PI*180}function zr(a){return a==null||a<=.01?.01:a}function nt(a){return a>.01?a:.01}function u_(a){return a=a%Gn,a<=-Fn?a+=Math.PI:a>=Fn&&(a-=Math.PI),a}function h_(a){return a/180*Math.PI}function Ps(a,t=1){let e=Math.pow(10,t);return Math.round(a*e+1e-10)/e}function c_(a,t){var n,s;let e=Math.min((n=a.toString().split(".")[1])==null?void 0:n.length,(s=t.toString().split(".")[1])==null?void 0:s.length),r=a.toFixed(e+1),i=t.toFixed(e+1);return Ps(+r)==Ps(+i)}function f_(a){return Ps((a%360+360)%360,3)}var xl=class{constructor(t,e,r){this._start=null;this._previous=null;this.next=null;this.interInStart=!1;this.intersInEnd=!1;this.othersIntersCount=0;this.shape=t,this.group=e,this.index=r,this._end=t.end()}reset(){this.interInStart=!1,this.intersInEnd=!1,this.othersIntersCount=0}set previous(t){this._previous=t,this.previous!=null&&(this._start=this.previous.shape.end())}get previous(){return this._previous}get start(){return this._start}get end(){return this._end}getNext(){let t=null,e=this.intersInEnd,r=this.next;for(;e&&r!=this;)if(r.interInStart){t=r;break}else r=r.next;return t}getStartDirect(){if(this.shape instanceof S)return this.shape.direct;if(this.shape instanceof R){let t=Math.abs((this.shape.startAngle+360)%360);return this.interInStart&&this.othersIntersCount==0&&(t=Ps(t,1)),this.shape.sweep()==1?N.greatereq(t,90)&&N.less(t,270)?new b(0,-1):new b(0,1):N.greater(t,90)&&N.lesseq(t,270)?new b(0,1):new b(0,-1)}else return null}getEndDirect(){if(this.shape instanceof S)return this.shape.direct;if(this.shape instanceof R){let t=Math.abs((this.shape.endAngle()+360)%360);return this.intersInEnd&&this.othersIntersCount==0&&(t=Ps(t,1)),this.shape.sweep()==1?N.greater(t,90)&&N.lesseq(t,270)?new b(0,-1):new b(0,1):N.greatereq(t,90)&&N.less(t,270)?new b(0,1):new b(0,-1)}else return null}},an=class{constructor(){this.horizontal=new b(1,0)}pointInPolyline(t,e){if(!e.bbox().isContains(t))return!1;for(let n of e.primitives)if(this.inEdge(t,n))return!0;if(!this.isClose(e))return!1;let i=[];return e.points(.1,n=>{i.push(n)}),this.isSelect(t.x,t.y,i)}inEdge(t,e){if(!e.bbox().isContains(t))return!1;if(e instanceof S){let i=fi.foot(e,t).distance1(t);return N.eq(i,0)?e.bbox().isContains(t):!1}else if(e instanceof R){let r=t.distance1(e.center);return N.eq(r,e.rx)?xr(e,t):!1}return!1}isSelect(t,e,r){let i=!1;for(let o=0,l=r.length-1;o<l;o++){let u=r[o],h=r[o+1];if(t==u.x&&e==u.y||t==h.x&&e==h.y)return!0;if(u.y<e&&h.y>=e||u.y>=e&&h.y<e){let c=u.x+(e-u.y)*(h.x-u.x)/(h.y-u.y);if(t==c)return!0;c>t&&(i=!i)}}let n=r[r.length-1],s=r[0];if(t==n.x&&e==n.y||t==s.x&&e==s.y)return!0;if(n.y<e&&s.y>=e||n.y>=e&&s.y<e){let o=n.x+(e-n.y)*(s.x-n.x)/(s.y-n.y);if(t==o)return!0;o>t&&(i=!i)}return i}isClose(t){return t.primitives.length>0&&t.primitives[0].start().distance2(t.primitives[t.primitives.length-1].end())<1e-8}map2Sides(t,e){let r=new Array,i=0,n=null;for(let s of t.primitives){let o=new xl(s,e,i);n!=null&&(n.next=o,o.previous=n),r.push(o),n=o,i++}return r[r.length-1].next=r[0],r[0].previous=r[r.length-1],r}inPolyline(t,e,r=0){let i=e.bbox(),{x:n,y:s}=t;if(!i.isContains1(n,s))return!1;for(let u of e.primitives)if(this.inEdge(t,u))return!0;let o=this.map2Sides(e,r);for(let u of o){let h=u.shape.bbox();if(h.isContainsY1(s)&&N.greater(h.maxX,n)){let c=u.shape;if(c instanceof S){let f=this.horizontal.cross(c.direct);if(N.eq(f,0)){let d=!1;N.greatereq(u.start.x,n)&&(u.interInStart=!1,d=!d),N.greatereq(u.end.x,n)&&(u.intersInEnd=!1,d=!d),d&&(u.othersIntersCount=1);continue}else{if(N.eq(u.start.y,s)&&N.greatereq(u.start.x,n)&&N.eq(u.end.y,s)&&N.greatereq(u.end.x,n))continue;if(N.eq(u.start.y,s)&&N.greatereq(u.start.x,n))u.interInStart=!0;else if(N.eq(u.end.y,s)&&N.greatereq(u.end.x,n))u.intersInEnd=!0;else{let d=(u.end.x-u.start.x)/(u.end.y-u.start.y)*(s-u.start.y)+u.start.x;N.greatereq(d,n)&&(u.othersIntersCount=1)}}}else if(c instanceof R){let{center:f}=c,d=t.distance1(f);if(N.greatereq(Math.abs(c.sweepAngle),360)){N.lesseq(d,c.rx)&&(u.othersIntersCount=1);continue}let p=Math.abs(s-f.y);if(N.eq(p,c.rx)){N.greatereq(u.start.x,n)&&N.eq(u.start.y,s)&&(u.interInStart=!0),N.greatereq(u.end.x,n)&&N.eq(u.end.y,s)&&(u.intersInEnd=!0);continue}else{let m=ku(c,s);if(m>0){for(let g=0;g<m;g+=2)if(N.greatereq(U[g],n)){let x=new b(U[g],U[g+1]);x.equals1(u.start)?u.interInStart=!0:x.equals1(u.end)?u.intersInEnd=!0:u.othersIntersCount++}}}}else throw new Error("not supported!")}}let l=0;for(let u of o){if(u.intersInEnd){let h=u.getNext();if(h!=null){let c=u.getEndDirect(),f=h.getStartDirect();c!=null&&f!=null&&N.greater(c.y*f.y,0)&&l++}}l+=u.othersIntersCount}return o.length=0,l%2==1}inPolygon(t,e){let r=!1;for(let i of e)this.inPolyline(t,i)&&(r=!r);return r}},Cc=class{constructor(t){this.horizontal=new b(1,0);this.map=new Map;this.pls=t}inEdge(t,e){if(!e.bbox().isContains(t))return!1;if(e instanceof S){let i=fi.foot(e,t).distance1(t);return N.eq(i,0)?e.bbox().isContains(t):!1}else if(e instanceof R){let r=t.distance1(e.center);return N.eq(r,e.rx)?xr(e,t):!1}return!1}map2Sides(t,e){let r=this.map.get(t);if(r!=null)return r;r=new Array;let i=0,n=null;for(let s of t.primitives){let o=new xl(s,e,i);n!=null&&(n.next=o,o.previous=n),r.push(o),n=o,i++}return r[r.length-1].next=r[0],r[0].previous=r[r.length-1],this.map.set(t,r),r}inPolyline(t,e,r=0){let i=e.bbox(),{x:n,y:s}=t;if(!i.isContains1(n,s))return!1;for(let u of e.primitives)if(this.inEdge(t,u))return!0;let o=this.map2Sides(e,r);for(let u of o){u.reset();let h=u.shape.bbox();if(h.isContainsY1(s)&&N.greater(h.maxX,n)){let c=u.shape;if(c instanceof S){let f=this.horizontal.cross(c.direct);if(N.eq(f,0)){let d=!1;N.greatereq(u.start.x,n)&&(u.interInStart=!1,d=!d),N.greatereq(u.end.x,n)&&(u.intersInEnd=!1,d=!d),d&&(u.othersIntersCount=1);continue}else{if(N.eq(u.start.y,s)&&N.greatereq(u.start.x,n)&&N.eq(u.end.y,s)&&N.greatereq(u.end.x,n))continue;if(N.eq(u.start.y,s)&&N.greatereq(u.start.x,n))u.interInStart=!0;else if(N.eq(u.end.y,s)&&N.greatereq(u.end.x,n))u.intersInEnd=!0;else{let d=(u.end.x-u.start.x)/(u.end.y-u.start.y)*(s-u.start.y)+u.start.x;N.greatereq(d,n)&&(u.othersIntersCount=1)}}}else if(c instanceof R){let{center:f}=c,d=t.distance1(f);if(N.greatereq(Math.abs(c.sweepAngle),360)){N.lesseq(d,c.rx)&&(u.othersIntersCount=1);continue}let p=Math.abs(s-f.y);if(N.eq(p,c.rx)){N.greatereq(u.start.x,n)&&N.eq(u.start.y,s)&&(u.interInStart=!0),N.greatereq(u.end.x,n)&&N.eq(u.end.y,s)&&(u.intersInEnd=!0);continue}else{let m=ku(c,s);if(m>0){for(let g=0;g<m;g+=2)if(N.greatereq(U[g],n)){let x=new b(U[g],U[g+1]);x.equals1(u.start)?u.interInStart=!0:x.equals1(u.end)?u.intersInEnd=!0:u.othersIntersCount++}}}}else throw new Error("not supported!")}}let l=0;for(let u of o){if(u.intersInEnd){let h=u.getNext();if(h!=null){let c=u.getEndDirect(),f=h.getStartDirect();c!=null&&f!=null&&N.greater(c.y*f.y,0)&&l++}}l+=u.othersIntersCount}return l%2==1}inPolygon(t){let e=!1;for(let r of this.pls)this.inPolyline(t,r)&&(e=!e);return e}},wt=new an;var Ju=class{isInConstraintCompatible(t,e){let r=t.shape(t.layer,0);if(e instanceof ye||e instanceof De){let i=e instanceof ye?new S(e.start,e.end):e.arc;return this.getPtsCtrlPoints([i]).every(s=>wt.inPolyline(s,r))}else if(e instanceof Le||e instanceof ve||e instanceof Ke||e instanceof mt||e instanceof Ue){let i=e.shape(e.layer,0);return this.getPtsCtrlPoints(i.primitives).every(s=>wt.inPolyline(s,r))}else if(e instanceof ue||e instanceof ce){let i=e.center;return wt.inPolyline(i,r)}else if(e instanceof he){let i=e.location;return wt.inPolyline(i,r)}else if(e instanceof ft){let i=e.bbox().center();return wt.inPolyline(i,r)}return!1}getPtsCtrlPoints(t){let e=[];for(let r=0;r<t.length;r++){let i=t[r];if(i instanceof S)r==0&&e.push(i.start()),e.push(i.end());else if(i instanceof R)if(N.less(Math.abs(i.sweepAngle),360))r==0&&e.push(i.start()),e.push(i.center),e.push(i.end());else{let n=i.center,s=i.rx,o=n.add(new b(-1,0).mul(s)),l=n.add(new b(1,0).mul(s)),u=n.add(new b(0,1).mul(s)),h=n.add(new b(0,-1).mul(s));e.push(n),e.push(o,l,u,h)}}return e}},Pl=new Ju;var eh=.01,bd=.8,Tc=.1,fD=!0;function Rc(a){if(a.length===1)return a[0].items;{let t=new Array;for(let e of a)F.addAll(t,e.items);return t}}function Ca(a,t){return Rc(Wr(a,t))}function gd(a,t){return a.pourIndex-t.pourIndex}function vc(a){return new ze(10)}var pD=new class extends dt{decide1(t){return t[0]&&t[1]}}(2),yd=new class extends dt{decide1(t){return t[0]&&t[1]&&!t[2]}}(3),xd=new class extends dt{decide1(t){return t[0]&&!t[1]}}(4),Sl=class{constructor(t,e,r){this.pours=[];this.pourClearance=[];this.thermalClearance=[];this.thermalConnector=[];this.outlineCache=[];this.pcbLayerRTreeMap=new Nt;this.shapeRTree=new ze(20);this.cache=new Array(100);this.box2d=new H;this.netPolylineIndex={};this.productWidth=NaN;this.minStrokeWidth=NaN;this.baseClearance=NaN;this.ratio=0;this.delta=0;this.constraintTreeMap=new Nt;this.logger=e.logger,this.document=t,this.ev=r,this.setting=e}outputDebug(t){if(t.debug){let e=t.display(),r=new on(e,ot.DUMMY).export();r!==null&&F.downloadFile("debug.pcbdoc",new Blob(r))}}merge1(t,e,r){let i=new at(t);return this.merge2(i,e,r),i}merge2(t,e,r){if(r!==null){let n=new It(e.rule,this.logger,t);for(var i=0;i<r.length;i++){let s=e.weight(i),o=r[i];if(o!==null)for(let l of o)n.addPolyline(l.asClose(),s)}n.simplify(),this.outputDebug(t)}}merge3(t,e,r){let i=new at(t);return this.merge4(i,e,r),i}merge4(t,e,r){if(r!==null){let n=new It(e,this.logger,t);for(var i=0;i<r.length;i++){let s=r[i];if(s!==null)for(let o of s)n.addPolyline(o.asClose())}n.simplify(),this.outputDebug(t)}}merge5(t,e){let r=new Array;if(e.forEach(n=>{F.addAll(r,n)}),r.length>1){let n=this.merger(t,[r[0]],r[1]);for(let s=2,o=r.length;s<o;s++){let l=r[s];n=this.merger(t,this.getPls(n),l)}return n}let i=new at(!1);return i.onPolylineGroup(new ee(r),0),i}getPls(t){let e=new Array;return t.plGrps.forEach(r=>{F.addAll(e,r.items)}),e}merger(t,e,r){let i=new at(!1),n=new It(t,this.logger,i);return e.forEach(s=>{n.addPolyline(s.asClose())}),n.addPolyline(r.asClose()),n.simplify(),i}fillArea(){this.addDocShapes2RTree(),this.addPolygonPour2Doc()}addDocShapes2RTree(){for(let t of this.document.shapes){if(t instanceof ir)for(let e of t.shapes)this.addShape2RTree(e);else this.addShape2RTree(t);this.box2d.ext1(t.bbox())}}addPolygonPour2Doc(){this.ratio=.1,ie(this.pours,gd,0,this.pours.length);let t=this.buildOutline();this.pours.length>0&&(this.delta=1/this.pours.length/5);for(let e of this.pours){if(e.method!==null&&this.setting.contains(e.id)&&e.needCopper){let r=this.getPour(e,t);this.ev.onShape(r)}else this.ev.onShape(e);this.addNode2RTree(e)}}addShape2RTree(t){t instanceof Ve?this.pours.push(t):(this.addNode2RTree(t),this.ev.onShape(t))}addNode2RTree(t){if(t instanceof Hr){this.constraintTreeMap.computeIfAbsent(t.layer,vc).add(t);return}switch(t.layer.type){case 4:case 7:case 5:case 0:this.pcbLayerRTreeMap.computeIfAbsent(t.layer,vc).add(t);break;case 11:t instanceof ve&&t.outlines.primitives.forEach(e=>{this.outlineCache.push(e)});break;default:break}}updateProgress(){hr.publish("progressUpdate",{ratio:this.ratio,descripte:"copper"}),this.ratio+=this.delta}getPour(t,e){this.shapeRTree.clear(),this.pourClearance.length=0,this.thermalClearance.length=0,this.thermalConnector.length=0,this.netPolylineIndex={},this.minStrokeWidth=Number.POSITIVE_INFINITY,this.baseClearance=0,this.productWidth=0,this.logger.info3("pp %s step 1",t.id),this.updateProgress(),this.baseClearance=t.clearance,t.method instanceof st?this.productWidth=t.method.neckThickness:t.method instanceof At?this.productWidth=t.method.gridWidth:this.productWidth=bd,this.getSinglePourLayerPolyline(t);let r=this.combindOutlines(t,e);this.logger.info3("pp %s step 2",t.id),this.updateProgress(),this.mergeSameNet(this.baseClearance),this.logger.info3("pp %s step 3",t.id),this.updateProgress();let i=this.merge1(!1,xd,[r,this.pourClearance]);this.logger.info3("pp %s step 4",t.id),this.updateProgress();let n=[];if(t.method instanceof st)for(let s of i.plGrps)n.push(s);else if(t.method instanceof At){let s=t.method.gridWidth+t.method.gridClearance;s==0?s=this.productWidth*2:this.productWidth+=eh;for(let o of i.plGrps){let l=0;t.method.angle==45&&(l=Math.PI/4),this.gnrGrids(n,s,o,l)}}return this.logger.info3("pp %s step 5",t.id),this.updateProgress(),new Ve(t.id,t.net,t.layer,t.method,this.productWidth-eh,t.clearance,t.thermal,t.keepIsland,t.pourIndex,t.needCopper,t.outlines,n)}combindOutlines(t,e){let r=this._getClearance(t.outlineClearance)-Tc/2,i=new Array,n=new Array,s=new Array,o=new Array;F.addAll(n,Rc(Wr(B.build2(t.outlines),-this.productWidth/2)));for(let u of e.search(t.bbox().extendOfSize(t.outlineClearance)))if(s.push(u),r>0)for(let h of u.primitives)o.push(h.stroke(r*2,1,1));let l=this.mergeNoneZero(o);for(let u of this.merge1(!1,yd,[n,s,l]).plGrps)for(let h of u.items)i.push(h);return i}mergeNoneZero(t){let r=new Array;for(let n=0;n<t.length;n+=25){let s=n+25;t.length<s&&(s=t.length);let o=this.merge3(!1,Kt,[t.slice(n,s)]).plGrps;for(let l of o)F.addAll(r,l.items)}let i=new Array;if(r.length==1)F.addAll(i,r);else{let n=this.merge3(!1,Kt,[r]).plGrps;for(let s of n)F.addAll(i,s.items)}return i}mergeSameNet(t){let e=t+t+Math.min(this.minStrokeWidth/2,t);for(let r in this.netPolylineIndex){let i=this.netPolylineIndex[r],n={};class s extends b{constructor(f,d){super(f.x,f.y);this.v=f,this.index=d}}let o=new Set,l=new ze(50);for(let h=0;h<i.points.length;h++){let c=i.points[h];l.add(new s(c,h))}for(let h=0;h<i.points.length;h++){let c=i.points[h];if(o.has(c))continue;let f=!1,d=c.bbox().extendOfSize(e),p=l.search(d);for(let m of p)this.addAllPlIds(n,i,m.v),o.add(m.v),f=!0;f&&(this.addAllPlIds(n,i,c),o.add(c))}let u=new Array;for(let h in n)u.push(i.plIndex[h]);if(u.length>2){let h=this.mergeNoneZero(u);F.addAll(this.pourClearance,h)}else F.addAll(this.pourClearance,u);for(let h=0;h<i.plIndex.length;h++)h in n||this.pourClearance.push(i.plIndex[h])}}addAllPlIds(t,e,r){let i=e.centerPlIds.get(r);if(i!==null)for(let n in i)t[n]=!0}gnrGrids(t,e,r,i){let n=new Array;for(let s of r.items)n.push(s);this.fillGrids(e,n,r,i+0),this.fillGrids(e,n,r,i+Math.PI/2),t.push(new ee(n))}fillGrids(t,e,r,i){let n=new sn(this.logger),s=me.rotate(-i),o=me.rotate(i);for(let h of r.items)n.addPolyline(h.multiply3(s));let l=this.box2d.build().transform(s),u=new Array;for(let h=l.minY;h<=l.maxY;h+=t){let c=new S(new b(l.minX,h),new b(l.maxX,h));F.addAll(u,n.scan(h,c))}for(let h of u){let c=new Array;c.push(h.multiply3(o)),e.push(B.build1(Ir(c)))}}zoom(t){let e=new Array;for(let r of t.items){let i=gr.zoomCorner(r,this.productWidth/2);i!==null&&e.push(i)}return e.length>0?new ee(e):null}buildConnection(t,e){let r=new gs(e);for(let i of this.shapeRTree.search(e.bbox())){let n=!1,s=null;if(i instanceof he){let o=i.shape(t.layer,0);o instanceof B&&(s=o)}else i instanceof ue||i instanceof ce||i instanceof ye||i instanceof De||i instanceof Le||i instanceof Ke?s=i.shape(t.layer,0):i instanceof Ve&&i!==t&&(i.net,t.net);s!==null&&(n=r.intersected(s.asClose())),n&&r.connected.push(i)}return r}getSinglePourLayerPolyline(t){let e=this.getMaxClearance(t),r=t.bbox().extendOfSize(e),i=this.pcbLayerRTreeMap.get(t.layer);if(i!==null)for(let s of i.search(r))this.dispatcher(s,t);let n=this.pcbLayerRTreeMap.get(I.MULTI);if(n!==null)for(let s of n.search(r))if(s instanceof ye||s instanceof yr){let o=s.shape(s.layer,0);o!==null&&this.pourClearance.push(o)}else this.dispatcher(s,t)}hasNet(t){return t instanceof ye||t instanceof De||t instanceof Ke||t instanceof mt||t instanceof Le||t instanceof ue||t instanceof ce||t instanceof he||t instanceof Ve}dispatcher(t,e){let r=!D.nullOrEmpty(t.net)&&this.hasNet(t)&&t.net===e.net;if(r&&this.shapeRTree.add(t),t instanceof ye&&(r?this.getTrackConnect(t,e)!="0"&&this.generatePcbTrack(t,e):this.generatePcbTrack(t,e)),t instanceof De&&(r?this.getTrackConnect(t,e)!="0"&&this.generatePcbArc(t,e):this.generatePcbArc(t,e)),t instanceof mt)if(!r)this.generatePcbRegion(t,e);else{let i=this.getTrackConnect(t,e);e.thermal&&i!="0"&&this.generatePcbRegion(t,e)}if(t instanceof Ke&&!r&&this.generatePcbRegion(t,e),t instanceof ft&&!r&&this.generatePcbboxShape(t,e),t instanceof Le&&!r&&this.generatePcbLine(t,e),t instanceof Qe&&!r&&this.generatePcbProhibit(t,e),t instanceof Ue&&!r&&this.generatePcbSlot(t,e),t instanceof ue){let i=t;r||this.generatePcbVia(i,e)}if(t instanceof ce){let i=t;r||this.generatePcbBlindVia(i,e)}if(t instanceof he){let i=t,n=t.layer.equals(I.MULTI)?e.multiLayerThermal:e.thermal;if(t.padRule)n=t.padRule.connectMode!=1;else if(r){let s=this.matchConstraintRule(t,e);if(s.length>0){for(let o of s)if(n=t.layer.equals(I.MULTI)?o.multiLayerThermal:o.thermal,n)break}}r||this.generatePcbPad1(i,e),r&&n&&this.generatePcbPad2(i,e)}if(t instanceof Ve){let i=t,n=i.shape(i.layer,0);if(n!==null&&!(r&&e.method instanceof st&&i.method instanceof st)){if(!r){let s=this.getClearance(i,e,0);F.addAll(this.pourClearance,Ca(n,s))}}}}generatePcbTrack(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r);i!==null&&this.updateIndex(t.net,t.width,i,[t.start,t.end])}generatePcbArc(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r);i!==null&&this.updateIndex(t.net,t.width,i,[t.arc.start(),t.arc.end()])}buildOutline(){let t=new hi(this.box2d.build(),2,Tc,this.logger,this.outlineCache),e=new ze(20);for(let r of t.detect().items)e.add(r);return e}generatePcbRegion(t,e){let r=t.shape(e.layer,0);if(r!==null){let i=this.getClearance(t,e,0);if(r instanceof ee){let n=new Array;for(let o of r.items)for(let l of o.primitives){let u=l.stroke(i*2,1,0);n.push(u)}let s=this.merge1(!1,hl,[r.items,n]);for(let o of s.plGrps)F.addAll(this.pourClearance,o.items)}else if(Ia(r))F.addAll(this.pourClearance,Ca(r,this.getClearance(t,e,0)));else{let n=gr.zoomPolygon(r,this.getClearance(t,e,0));n&&F.addAll(this.pourClearance,[n])}}}generatePcbboxShape(t,e){let r=t.shape(e.layer,0);r!==null&&F.addAll(this.pourClearance,Ca(r,this.getClearance(t,e,0)))}generatePcbProhibit(t,e){let r=t.shape(e.layer,0);r!==null&&t.copper&&F.addAll(this.pourClearance,Ca(r,this.productWidth/2+.001))}generatePcbLine(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,0);i!==null&&i.primitives.forEach(n=>{this.updateIndex(t.net,t.width,n.stroke(t.width+r*2,1,0),[n.start(),n.end()])})}generatePcbSlot(t,e){let r=t.shape(e.layer,0);if(r!==null){let i=this.getClearance(t,e,0);F.addAll(this.pourClearance,Ca(r,i))}}getMaxClearance(t){let e=t.clearance;for(let r of this.document.rules)r instanceof sr&&(r.clearance>e&&(e=r.clearance),r.boardClearance>e&&(e=r.boardClearance),r.spokeSpace>e&&(e=r.spokeSpace));return e}getThermalSpace(t,e,r=!1){let i=-1;if(t.padRule){if(i=Math.max(i,t.padRule.lineClearance),N.eq(i,0))return 0;if(i!=-1)return this._getClearance(i)}let n=this.matchConstraintRule(t,e);if(n.length>0){for(let l of n){let u=t.layer.equals(I.MULTI)?l.multiLayerSpokeSpace:l.spokeSpace;i=Math.max(i,u)}if(N.eq(i,0))return 0;if(i!=-1)return this._getClearance(i)}let s=this.matchRules(t,e),o=["NETWORKSRULE","CUSTOMREGIONID","NETRULE"];for(let l of o){for(let u of s)if(u instanceof sr&&this.isMatchOrder(u,t.net,e.net,l)){let h=t.layer.equals(I.MULTI)?u.multiLayerSpokeSpace:u.spokeSpace;i=Math.max(i,h)}if(N.eq(i,0))return 0;if(i!=-1)return this._getClearance(i)}return 0}getTrackConnect(t,e){let r=this.matchConstraintRule(t,e);if(r.length>0){for(let s of r)if(s.trackConnect!="0")return s.trackConnect}let i=this.matchRules(t,e),n=["NETWORKSRULE","CUSTOMREGIONID","NETRULE"];for(let s of n)for(let o of i)if(o instanceof sr&&this.isMatchOrder(o,t.net,e.net,s))return o.trackConnect;return"0"}getClearance(t,e,r){let i=-1,n=this.matchConstraintRule(t,e);if(n.length>0){for(let l of n)t instanceof Ue||t instanceof ve?i=Math.max(i,l.boardClearance):i=Math.max(i,l.clearance);return i!=-1?this._getClearance(i):this._getClearance(Math.max(i,r,this.baseClearance))}let s=this.matchRules(t,e),o=["NETWORKSRULE","CUSTOMREGIONID","NETRULE"];for(let l of o){for(let u of s)u instanceof sr&&this.isMatchOrder(u,t.net,e.net,l)&&(t instanceof Ue||t instanceof ve?i=Math.max(i,u.boardClearance):i=Math.max(i,u.clearance));if(i!=-1)return this._getClearance(i)}return this._getClearance(Math.max(i,r,this.baseClearance))}matchConstraintRule(t,e){let r=t.bbox(),i=[],n=this.constraintTreeMap.get(e.layer);if(n!=null){let l=n.search(r);for(let u=0;u<l.length;u++)i.push(l[u])}let s=this.constraintTreeMap.get(I.MULTI);if(s!=null){let l=s.search(r);for(let u=0;u<l.length;u++)i.push(l[u])}let o=new Array;for(let l of i)if(Pl.isInConstraintCompatible(l,t))for(let u of this.document.rules)u.selector instanceof zt&&u instanceof sr&&u.selector.id==l.id&&o.push(u);return o}isMatchOrder(t,e,r,i){switch(i){case"NETWORKSRULE":return this.isBetweenNetSelector(t,e,r);case"CUSTOMREGIONID":return this.isIdelector(t);case"NETRULE":return this.isNetSelector(t)||this.isDefaultSelector(t);default:return!1}}isBetweenNetSelector(t,e,r){return t.selector instanceof nr&&this.matchNets(e,r,t.selector)}isIdelector(t){return t.selector instanceof zt}isNetSelector(t){return t.selector instanceof xt}isDefaultSelector(t){return t.selector instanceof ht}matchNets(t,e,r){let i=new Array;for(let n of r.selectors)n instanceof xt&&i.push(n);return i.length==2&&(i[0].net==t&&i[1].net==e||i[0].net==e&&i[1].net==t)}_getClearance(t){return t+eh+this.productWidth/2}matchRules(t,e){let r=new Set,i=new Array,n=new Array,s=new Array;if(t instanceof Ve){let o=["NETWORKSRULE","CUSTOMREGIONID","NETRULE"];for(let l of o)for(let u of this.document.rules)if(u instanceof sr)switch(l){case"NETWORKSRULE":{this.isBetweenNetSelector(u,t.net,e.net)&&r.add(u);break}case"CUSTOMREGIONID":{this.isIdelector(u)&&(this.isMatch(t,u.selector,!0)||this.isMatch(e,u.selector,!0))&&r.add(u);break}case"NETRULE":{(this.isNetSelector(u)||this.isDefaultSelector(u))&&(this.isMatch(t,u.selector)||this.isMatch(e,u.selector,!0))&&r.add(u);break}}return r}for(let o of this.document.rules){if(o.selector instanceof ht){s.push(o);continue}t.net!=""&&t.net==e.net&&o.selector instanceof nr||(this.isMatch(t,o.selector)&&i.push(o),this.isMatch(e,o.selector,!0)&&n.push(o))}return i.length>0?F.addAllSet(r,i):t instanceof Ue||t instanceof ve||t instanceof ft||t instanceof Qe||F.addAllSet(r,s),n.length>0?F.addAllSet(r,n):F.addAllSet(r,s),r}isMatch(t,e,r=!1){if(t.net!=""){if(e instanceof xt)return e.net===t.net;if(e instanceof nr){for(let i of e.selectors)if(i instanceof xt&&i.net===t.net)return!0;return!1}else return e instanceof zt?e.id===t.id:e instanceof ht}else return r&&e instanceof zt?e.id===t.id:e instanceof ht}generatePcbVia(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r);i!==null&&this.updateIndex(t.net,i.bbox().width(),i,[t.center]);let n=t.shape(I.MULTI,r);n!==null&&n instanceof B&&this.updateIndex(t.net,n.bbox().width(),n,[t.center])}generatePcbBlindVia(t,e){let r=this.getClearance(t,e,0),i=t.getOutsideShapeWithHole(e.layer,r);i!==null&&this.updateIndex(t.net,i.bbox().width(),i,[t.center])}generatePcbPad2(t,e){let r=this.getThermalSpace(t,e);if(N.eq(r,0))return;r=r>0+this.productWidth/2?r:.001+this.productWidth/2;let i=t.shape(e.layer,r),n=t.shape(I.MULTI,r),s=!0;if(i instanceof B&&n instanceof B&&i.equals(n)&&(s=!1),Array.isArray(i))for(let o of i)for(let l of o.items)this.updateIndex(t.net,l.bbox().width(),l,[t.location]);else i instanceof B&&this.updateIndex(t.net,i.bbox().width(),i,[t.location]);s&&n!==null&&n instanceof B&&this.updateIndex(t.net,n.bbox().width(),n,[t.location])}generatePcbPad1(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r),n=t.shape(I.MULTI,r),s=!0;if(i instanceof B&&n instanceof B&&i.equals(n)&&(s=!1),i!==null)if(i instanceof B)this.updateIndex(t.net,i.bbox().width(),i,[t.location]);else for(let o of i)for(let l of o.items)this.updateIndex(t.net,l.bbox().width(),l,[t.location]);s&&n!==null&&n instanceof B&&this.updateIndex(t.net,n.bbox().width(),n,[t.location])}updateIndex(t,e,r,i){t=t.toUpperCase().trim();let n=this.netPolylineIndex[t];n===void 0&&(n=new nn(t),this.netPolylineIndex[t]=n),n.add(r,i),this.minStrokeWidth>e&&(this.minStrokeWidth=e)}};var Rr=class{constructor(t,e,r,i){this._connectMode=0;this._lineWidth=1;this._lineClearance=1;this._lineAngle=br;this._connectMode=t,this._lineWidth=e,this._lineClearance=r,this._lineAngle=i}static getPadRule(t){if(t)return new Rr(t.connectMode,t.lineWidth,t.lineClearance,t.lineAngle)}static getDefRule(){return new Rr(0,1,1,br)}get lineAngle(){return this._lineAngle}set lineAngle(t){this._lineAngle=t}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t}get connectMode(){return this._connectMode}set connectMode(t){this._connectMode=t}get lineClearance(){return this._lineClearance}set lineClearance(t){this._lineClearance=t}};var Pd=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.ENC_LINE=1]="ENC_LINE",i[i.ENC_ARC=2]="ENC_ARC",i[i.ENC_BEZIER=3]="ENC_BEZIER",i))(Pd||{}),Be=Pe.fmtNumber,Ta=class{constructor(){this.state=0;this.prev=null;this.buffer=new Array}encPl(t){for(let e of t.primitives)this.encPt(e)}encPt(t){if(t instanceof S)this.encLine1(t);else if(t instanceof R)this.encArc(t);else if(t instanceof we){let e=t.points(.1),r=B.build4(e);for(let i of r.primitives)this.encLine1(i)}else throw new Error("")}encBezier(t){let e=t.end(),r=t.controls.length;if(this.state===0){let i="";r==4?i+="M %s %s C ":r==3&&(i+="M %s %s Q ");for(let s=1;s<r;s++)i+="%s %s ";let n=new Array;for(let s of t.controls)n.push(Be(s.x)),n.push(Be(s.y));this.out(i,...n)}else if(t.start().equals(this.prev)){let i="";r==3?i+="S ":r==2&&(i+="T ");for(let s=1;s<r;s++)i+="%s %s ";let n=new Array;for(let s of t.controls)n.push(Be(s.x)),n.push(Be(s.y))}else{let i="";r==4?i+="M %s %s C ":r==3&&(i+="M %s %s Q ");for(let s=1;s<r;s++)i+="%s %s ";let n=new Array;for(let s of t.controls)n.push(Be(s.x)),n.push(Be(s.y));this.out(i,...n)}this.prev=e,this.state=3}encArc(t){let e=t.svgEnd;this.state===0?this.out("M %s %s A %s %s %s %d %d %s %s ",Be(t.start().x),Be(-t.start().y),Be(t.rx),Be(t.ry),0,t.isLarge()?1:0,t.sweep()===1?0:1,Be(e.x),Be(-e.y)):t.start().equals(this.prev)?this.state!==2?this.out("A %s %s %s %d %d %s %s ",Be(t.rx),Be(t.ry),0,t.isLarge()?1:0,t.sweep()===1?0:1,Be(e.x),Be(-e.y)):this.out("%s %s %s %d %d %s %s ",Be(t.rx),Be(t.ry),0,t.isLarge()?1:0,t.sweep()===1?0:1,Be(e.x),Be(-e.y)):this.out("L %s %s A %s %s %s %d %d %s %s ",Be(t.start().x),Be(-t.start().y),t.rx,t.ry,0,t.isLarge()?1:0,t.sweep()===1?0:1,Be(e.x),Be(-e.y)),this.prev=e,this.state=2}encLine1(t){this.encLine2(t.start(),t.end())}encLine2(t,e){this.state===0?this.out("M %s %s L %s %s ",Be(t.x),Be(-t.y),Be(e.x),Be(-e.y)):(this.state!==1&&this.out("L "),t.equals(this.prev)?this.out("%s %s ",Be(e.x),Be(-e.y)):this.out("%s %s %s %s ",Be(t.x),Be(-t.y),Be(e.x),Be(-e.y))),this.prev=e,this.state=1}close(t){this.state!==0&&(t&&this.out("Z "),this.state=0,this.prev=null)}toString(){return this.buffer.join("")}out(t,...e){e.length===0?this.buffer.push(t):this.buffer.push(Pe.format(t,...e))}};function Ec(a){return a===32||a===9||a===13||a===10}function kD(a){return a===13||a===10}var Ll=class{constructor(){this._line=1;this._col=0}line(){return this._line}col(){return this._col}_feed(t){return t===10?(this._col=0,this._line++):this._col++,this.feed(t)}parse(t){let e=t.length;for(let r=0;r<e;r++){let i=t.charCodeAt(r);if(!this._feed(i))return this}return this.finish(),this}};var th=500,Bc=String.fromCharCode,Ml=class{constructor(){this.buffer=new Array}size(){return this.buffer.length}isEOF(){return!1}write(t){return this.buffer.push(t),1}writen1(t){return this.writen2(t,0,t.length)}writen2(t,e,r){let i=this.buffer;for(let n=0,s=e;n<r;n++,s++)i.push(t[s]);return r}writeAsync(t,e){e(this.write(t))}writenAsync1(t,e){e(this.writen1(t))}writenAsync2(t,e,r,i){i(this.writen2(t,e,r))}writeStr(t){let e=t.length,r=new Array(e);for(let i=0;i<e;i++)r[i]=t.charCodeAt(i);return this.writen1(r)}clear(){this.buffer.length=0}toString(){let t=this.buffer,e=t.length;if(e<=th)return Bc.apply(null,t);{let r=new Array;for(let i=0;i<t.length;i+=th){let n=Math.min(e-i,th),s=Bc.apply(null,t.slice(i,i+n));r.push(s)}return r.join("")}}};var _c=(n=>(n[n.UNKNOW=0]="UNKNOW",n[n.NUMBER_INTEGER=1]="NUMBER_INTEGER",n[n.NUMBER_DECIMAL=2]="NUMBER_DECIMAL",n[n.NUMBER_E=3]="NUMBER_E",n[n.NUMBER_E_SIGNED=4]="NUMBER_E_SIGNED",n))(_c||{}),Oc=(O=>(O[O.UNKNOW=0]="UNKNOW",O[O.MOVE_X=1]="MOVE_X",O[O.MOVE_Y=2]="MOVE_Y",O[O.LINE_X=3]="LINE_X",O[O.LINE_Y=4]="LINE_Y",O[O.HORIZONTAL_X=5]="HORIZONTAL_X",O[O.VERTICAL_Y=6]="VERTICAL_Y",O[O.CUBIC_BEZIER_X1=7]="CUBIC_BEZIER_X1",O[O.CUBIC_BEZIER_Y1=8]="CUBIC_BEZIER_Y1",O[O.CUBIC_BEZIER_X2=9]="CUBIC_BEZIER_X2",O[O.CUBIC_BEZIER_Y2=10]="CUBIC_BEZIER_Y2",O[O.CUBIC_BEZIER_X=11]="CUBIC_BEZIER_X",O[O.CUBIC_BEZIER_Y=12]="CUBIC_BEZIER_Y",O[O.ARC_RX=13]="ARC_RX",O[O.ARC_RY=14]="ARC_RY",O[O.ARC_ROTATION=15]="ARC_ROTATION",O[O.ARC_LARGE=16]="ARC_LARGE",O[O.ARC_SWEEP=17]="ARC_SWEEP",O[O.ARC_X=18]="ARC_X",O[O.ARC_Y=19]="ARC_Y",O[O.SMOOTH_CUBIC_BEZIER_X2=20]="SMOOTH_CUBIC_BEZIER_X2",O[O.SMOOTH_CUBIC_BEZIER_Y2=21]="SMOOTH_CUBIC_BEZIER_Y2",O[O.SMOOTH_CUBIC_BEZIER_X=22]="SMOOTH_CUBIC_BEZIER_X",O[O.SMOOTH_CUBIC_BEZIER_Y=23]="SMOOTH_CUBIC_BEZIER_Y",O[O.QUADRATIC_BEZIER_X1=24]="QUADRATIC_BEZIER_X1",O[O.QUADRATIC_BEZIER_Y1=25]="QUADRATIC_BEZIER_Y1",O[O.QUADRATIC_BEZIER_X=26]="QUADRATIC_BEZIER_X",O[O.QUADRATIC_BEZIER_Y=27]="QUADRATIC_BEZIER_Y",O))(Oc||{});function Sd(a){return 97<=a&&a<=122||65<=a&&a<=90}function _t(a){let t=parseFloat(a);if(isFinite(t))return t;throw new Error("expect number")}var Al=class extends Ll{constructor(e,r=!0,i=ot.DUMMY){super();this.buffer=new Ml;this.group=new Array;this.subPartStart=b.ORIGIN;this.curPoint=b.ORIGIN;this.lexState=0;this.parseState=0;this.isAbsolute=!1;this.isLargeArc=!1;this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=Number.NaN;this.y=Number.NaN;this.rx=Number.NaN;this.ry=Number.NaN;this.rotation=Number.NaN;this.sweep=1;this.prevBezierCtrl2=null;this.logger=i,this.cb=e,this.yAxis=r?-1:1}on(e){return this.cb(e)}feed(e){switch(this.logger.include(0)&&this.logger.debug3("L: %c(%s)|%s",e,String.fromCharCode(e),_c[this.lexState]),this.lexState){case 0:return Ec(e)?!0:48<=e&&e<=57||e===45||e===43?(this.pushBuffer(e),this.lexState=1,!0):e===46?(this.pushBuffer(e),this.lexState=2,!0):Sd(e)?this.feedS(String.fromCharCode(e)):(this.logger.warning3("unknow letter %c",e),!0);case 1:return 48<=e&&e<=57?(this.pushBuffer(e),!0):e===46?(this.pushBuffer(e),this.lexState=2,!0):e===101||e===69?(this.pushBuffer(e),this.lexState=3,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;case 2:return 48<=e&&e<=57?(this.pushBuffer(e),!0):e===101||e===69?(this.pushBuffer(e),this.lexState=3,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;case 3:return 48<=e&&e<=57?(this.pushBuffer(e),!0):e===45||e===43?(this.pushBuffer(e),this.lexState=4,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;case 4:return 48<=e&&e<=57?(this.pushBuffer(e),!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;default:return!0}}finish(){this.feed(32),this.tryNotify()}feedS(e){switch(this.logger.include(0)&&this.logger.debug3("P: %s|%s|%s|%s",e,Oc[this.parseState],this.curPoint,this.subPartStart),this.parseState){case 0:switch(e){case"M":this.isAbsolute=!0,this.parseState=1;break;case"m":this.isAbsolute=!1,this.parseState=1;break;case"L":this.isAbsolute=!0,this.parseState=3;break;case"l":this.isAbsolute=!1,this.parseState=3;break;case"H":this.isAbsolute=!0,this.parseState=5;break;case"h":this.isAbsolute=!1,this.parseState=5;break;case"V":this.isAbsolute=!0,this.parseState=6;break;case"v":this.isAbsolute=!1,this.parseState=6;break;case"z":case"Z":{this.group.push(new S(this.curPoint,this.subPartStart));let n=this.tryNotify();return this.curPoint=this.subPartStart,n}case"C":this.isAbsolute=!0,this.parseState=7;break;case"c":this.isAbsolute=!1,this.parseState=7;break;case"S":this.isAbsolute=!0,this.parseState=20;break;case"s":this.isAbsolute=!1,this.parseState=20;break;case"A":this.isAbsolute=!0,this.parseState=13;break;case"a":this.isAbsolute=!1,this.parseState=13;break;case"Q":this.isAbsolute=!0,this.parseState=24;break;case"q":this.isAbsolute=!1,this.parseState=24;break;default:this.logger.warning3("unknow %s",e)}return!0;case 1:let r=this.tryNotify();return this.x=_t(e),this.parseState=2,r;case 2:{this.y=this.yAxis*_t(e);let n;return this.isAbsolute?n=new b(this.x,this.y):n=this.curPoint.add1(this.x,this.y),this.curPoint=n,this.subPartStart=n,this.parseState=3,!0}case 3:return this.x=parseFloat(e),isFinite(this.x)?(this.parseState=4,!0):(this.parseState=0,this.feedS(e));case 4:{this.y=this.yAxis*_t(e);let n;return this.isAbsolute?n=new b(this.x,this.y):n=this.curPoint.add1(this.x,this.y),this.group.push(new S(this.curPoint,n)),this.curPoint=n,this.parseState=3,!0}case 5:if(this.x=parseFloat(e),isFinite(this.x)){let n;return this.isAbsolute?n=new b(this.x,this.curPoint.y):n=this.curPoint.add1(this.x,0),this.group.push(new S(this.curPoint,n)),this.curPoint=n,!0}else return this.parseState=0,this.feedS(e);case 6:if(this.y=parseFloat(e),isFinite(this.y)){this.y=this.yAxis*this.y;let n;return this.isAbsolute?n=new b(this.curPoint.x,this.y):n=this.curPoint.add1(0,this.y),this.group.push(new S(this.curPoint,n)),this.curPoint=n,!0}else return this.parseState=0,this.feedS(e);case 7:let i=parseFloat(e);return isFinite(i)?(this.x1=i,this.parseState=8,!0):(e!=="s"&&e!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(e));case 8:return this.y1=this.yAxis*_t(e),this.parseState=9,!0;case 9:return this.x2=_t(e),this.parseState=10,!0;case 10:return this.y2=this.yAxis*_t(e),this.parseState=11,!0;case 11:return this.x=_t(e),this.parseState=12,!0;case 12:{this.y=this.yAxis*_t(e);let n,s,o;return this.isAbsolute?(n=new b(this.x1,this.y1),s=new b(this.x2,this.y2),o=new b(this.x,this.y)):(n=this.curPoint.add1(this.x1,this.y1),s=this.curPoint.add1(this.x2,this.y2),o=this.curPoint.add1(this.x,this.y)),this.prevBezierCtrl2=s,this.group.push(new we([this.curPoint,n,s,o])),this.curPoint=o,this.parseState=7,!0}case 13:return this.rx=parseFloat(e),isFinite(this.rx)?(this.parseState=14,!0):(this.parseState=0,this.feedS(e));case 14:return this.ry=_t(e),this.parseState=15,!0;case 15:return this.rotation=_t(e),this.parseState=16,!0;case 16:return this.isLargeArc=_t(e)===1,this.parseState=17,!0;case 17:return this.sweep=_t(e)===1?0:1,this.parseState=18,!0;case 18:return this.x=_t(e),this.parseState=19,!0;case 19:{this.y=this.yAxis*_t(e);let n;return this.isAbsolute?n=new b(this.x,this.y):n=this.curPoint.add1(this.x,this.y),this.group.push(R.build1(this.curPoint,n,this.rx,this.ry,this.isLargeArc,this.sweep)),this.curPoint=n,this.parseState=13,!0}case 20:return this.x2=parseFloat(e),isFinite(this.x2)?(this.parseState=21,!0):(e!=="s"&&e!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(e));case 21:return this.y2=this.yAxis*_t(e),this.parseState=22,!0;case 22:return this.x=_t(e),this.parseState=23,!0;case 23:{this.y=this.yAxis*_t(e);let n,s;this.isAbsolute?(n=new b(this.x2,this.y2),s=new b(this.x,this.y)):(n=this.curPoint.add1(this.x2,this.y2),s=this.curPoint.add1(this.x,this.y));let o;return this.prevBezierCtrl2?o=this.curPoint.add(this.curPoint.sub(this.prevBezierCtrl2)):o=this.curPoint,this.prevBezierCtrl2=n,this.group.push(new we([this.curPoint,o,n,s])),this.curPoint=s,this.parseState=20,!0}case 24:return this.x1=parseFloat(e),isFinite(this.x1)?(this.parseState=25,!0):(e!=="s"&&e!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(e));case 25:return this.y1=this.yAxis*_t(e),this.parseState=26,!0;case 26:return this.x=_t(e),this.parseState=27,!0;case 27:{this.y=this.yAxis*_t(e);let n,s;return this.isAbsolute?(n=new b(this.x1,this.y1),s=new b(this.x,this.y)):(n=this.curPoint.add1(this.x1,this.y1),s=this.curPoint.add1(this.x,this.y)),this.prevBezierCtrl2=n,this.group.push(new we([this.curPoint,n,s])),this.curPoint=s,this.parseState=24,!0}default:return this.logger.warning3("unsupported parse state %s",this.parseState),!0}}pushBuffer(e){this.buffer.write(e)}getCleanBuffer(){let e=this.buffer.toString();return this.buffer.clear(),e}tryNotify(){if(this.group.length===0)return!0;{let e=B.build1(Ir(this.group));return this.group.length=0,this.on(e)}}onException(e){throw e}};var rh=.01,wd=.8,Dc=.1,gV=!0;function kc(a){if(a.length===1)return a[0].items;{let t=new Array;for(let e of a)F.addAll(t,e.items);return t}}function Ss(a,t){return kc(Wr(a,t))}function Ld(a,t){return a.pourIndex-t.pourIndex}function Md(a){return new ze(10)}var yV=new class extends dt{decide1(t){return t[0]&&t[1]}}(2),Ad=new class extends dt{decide1(t){return t[0]&&t[1]&&!t[2]}}(3),Id=new class extends dt{decide1(t){return t[0]&&!t[1]}}(4),Il=class{constructor(t,e,r){this.pours=[];this.pourClearance=[];this.thermalClearance=[];this.thermalConnector=[];this.outlineCache=[];this.pcbLayerRTreeMap=new Nt;this.shapeRTree=new ze(20);this.cache=new Array(100);this.box2d=new H;this.netPolylineIndex={};this.productWidth=NaN;this.minStrokeWidth=NaN;this.baseClearance=NaN;this.ratio=0;this.delta=0;this.logger=e.logger,this.document=t,this.ev=r,this.setting=e,this.useWebService=!0}outputDebug(t){if(t.debug){let e=t.display(),r=new on(e,ot.DUMMY).export();r!==null&&F.downloadFile("debug.pcbdoc",new Blob(r))}}merge1(t,e,r){let i=new at(t);return this.merge2(i,e,r),i}merge2(t,e,r){if(r!==null){let n=new It(e.rule,this.logger,t);for(var i=0;i<r.length;i++){let s=e.weight(i),o=r[i];if(o!==null)for(let l of o)n.addPolyline(l.asClose(),s)}n.simplify(),this.outputDebug(t)}}merge3(t,e,r){let i=new at(t);return this.merge4(i,e,r),i}merge4(t,e,r){if(r!==null){let n=new It(e,this.logger,t);for(var i=0;i<r.length;i++){let s=r[i];if(s!==null)for(let o of s)n.addPolyline(o.asClose())}n.simplify(),this.outputDebug(t)}}merge5(t,e){let r=new Array;if(e.forEach(n=>{F.addAll(r,n)}),r.length>1){let n=this.merger(t,[r[0]],r[1]);for(let s=2,o=r.length;s<o;s++){let l=r[s];n=this.merger(t,this.getPls(n),l)}return n}let i=new at(!1);return i.onPolylineGroup(new ee(r),0),i}getPls(t){let e=new Array;return t.plGrps.forEach(r=>{F.addAll(e,r.items)}),e}merger(t,e,r){let i=new at(!1),n=new It(t,this.logger,i);return e.forEach(s=>{n.addPolyline(s.asClose())}),n.addPolyline(r.asClose()),n.simplify(),i}fillArea(){return Ii(this,null,function*(){this.addDocShapes2RTree(),yield this.addPolygonPour2Doc()})}addDocShapes2RTree(){for(let t of this.document.shapes){if(t instanceof ir)for(let e of t.shapes)this.addShape2RTree(e);else this.addShape2RTree(t);this.box2d.ext1(t.bbox())}}addPolygonPour2Doc(){return Ii(this,null,function*(){this.ratio=.1,ie(this.pours,Ld,0,this.pours.length);let t=this.buildOutline();this.pours.length>0&&(this.delta=1/this.pours.length/5);for(let e of this.pours){if(e.method!==null&&this.setting.contains(e.id)&&e.needCopper){let r=yield this.getPour(e,t);this.ev.onShape(r)}else this.ev.onShape(e);this.addNode2RTree(e)}})}addShape2RTree(t){t instanceof Ve?this.pours.push(t):(this.addNode2RTree(t),this.ev.onShape(t))}addNode2RTree(t){switch(t.layer.type){case 4:case 7:case 5:case 0:this.pcbLayerRTreeMap.computeIfAbsent(t.layer,Md).add(t);break;case 11:t instanceof ve&&t.outlines.primitives.forEach(e=>{this.outlineCache.push(e)});break;default:break}}updateProgress(){hr.publish("progressUpdate",{ratio:this.ratio,descripte:"copper"}),this.ratio+=this.delta}getPour(t,e){return Ii(this,null,function*(){this.shapeRTree.clear(),this.pourClearance.length=0,this.thermalClearance.length=0,this.thermalConnector.length=0,this.netPolylineIndex={},this.minStrokeWidth=Number.POSITIVE_INFINITY,this.baseClearance=0,this.productWidth=0,this.logger.info3("pp %s step 1",t.id),this.updateProgress(),this.baseClearance=t.clearance,t.method instanceof st?this.productWidth=t.method.neckThickness:t.method instanceof At?this.productWidth=t.method.gridWidth:this.productWidth=wd,this.getSinglePourLayerPolyline(t);let r=this.combindOutlines(t,e);this.logger.info3("pp %s step 2",t.id),this.updateProgress(),this.mergeSameNet(this.baseClearance),this.logger.info3("pp %s step 3",t.id),this.updateProgress();let i;if(this.useWebService){let s=[];s.push("OUTLINE");for(let u of r){let h=new Ta;h.encPl(u),s.push(h.toString())}s.push("HOLE");for(let u of this.pourClearance){let h=new Ta;h.encPl(u),s.push(h.toString())}let o=s.join(`
`);try{o=yield(yield fetch("http://localhost:9189/pour",{method:"post",body:o,credentials:"omit"})).text()}catch(u){console.error(u)}let l=new Array;ic(o,u=>{new Al(h=>(l.push(h),!0)).parse(u)}),i={plGrps:[new ee(l)]}}else i=this.merge1(!1,Id,[r,this.pourClearance]);this.logger.info3("pp %s step 4",t.id),this.updateProgress();let n=[];if(t.method instanceof st)for(let s of i.plGrps)n.push(s);else if(t.method instanceof At){let s=t.method.gridWidth+t.method.gridClearance;s==0?s=this.productWidth*2:this.productWidth+=rh;for(let o of i.plGrps){let l=0;t.method.angle==45&&(l=Math.PI/4),this.gnrGrids(n,s,o,l)}}return this.logger.info3("pp %s step 5",t.id),this.updateProgress(),new Ve(t.id,t.net,t.layer,t.method,this.productWidth-rh,t.clearance,t.thermal,t.keepIsland,t.pourIndex,t.needCopper,t.outlines,n)})}combindOutlines(t,e){let r=this._getClearance(t.outlineClearance)-Dc/2,i=new Array,n=new Array,s=new Array,o=new Array;F.addAll(n,kc(Wr(B.build2(t.outlines),-this.productWidth/2)));for(let u of e.search(t.bbox().extendOfSize(t.outlineClearance)))if(s.push(u),r>0)for(let h of u.primitives)o.push(h.stroke(r*2,1,1));let l=this.mergeNoneZero(o);for(let u of this.merge1(!1,Ad,[n,s,l]).plGrps)for(let h of u.items)i.push(h);return i}mergeNoneZero(t){let r=new Array;for(let n=0;n<t.length;n+=25){let s=n+25;t.length<s&&(s=t.length);let o=this.merge3(!1,Kt,[t.slice(n,s)]).plGrps;for(let l of o)F.addAll(r,l.items)}let i=new Array;if(r.length==1)F.addAll(i,r);else{let n=this.merge3(!1,Kt,[r]).plGrps;for(let s of n)F.addAll(i,s.items)}return i}mergeSameNet(t){let e=t+t+Math.min(this.minStrokeWidth/2,t);for(let r in this.netPolylineIndex){let i=this.netPolylineIndex[r],n={};class s extends b{constructor(f,d){super(f.x,f.y);this.v=f,this.index=d}}let o=new Set,l=new ze(50);for(let h=0;h<i.points.length;h++){let c=i.points[h];l.add(new s(c,h))}for(let h=0;h<i.points.length;h++){let c=i.points[h];if(o.has(c))continue;let f=!1,d=c.bbox().extendOfSize(e),p=l.search(d);for(let m of p)this.addAllPlIds(n,i,m.v),o.add(m.v),f=!0;f&&(this.addAllPlIds(n,i,c),o.add(c))}let u=new Array;for(let h in n)u.push(i.plIndex[h]);if(!this.useWebService&&u.length>2){let h=this.mergeNoneZero(u);F.addAll(this.pourClearance,h)}else F.addAll(this.pourClearance,u);for(let h=0;h<i.plIndex.length;h++)h in n||this.pourClearance.push(i.plIndex[h])}}addAllPlIds(t,e,r){let i=e.centerPlIds.get(r);if(i!==null)for(let n in i)t[n]=!0}gnrGrids(t,e,r,i){let n=new Array;for(let s of r.items)n.push(s);this.fillGrids(e,n,r,i+0),this.fillGrids(e,n,r,i+Math.PI/2),t.push(new ee(n))}fillGrids(t,e,r,i){let n=new sn(this.logger),s=me.rotate(-i),o=me.rotate(i);for(let h of r.items)n.addPolyline(h.multiply3(s));let l=this.box2d.build().transform(s),u=new Array;for(let h=l.minY;h<=l.maxY;h+=t){let c=new S(new b(l.minX,h),new b(l.maxX,h));F.addAll(u,n.scan(h,c))}for(let h of u){let c=new Array;c.push(h.multiply3(o)),e.push(B.build1(Ir(c)))}}zoom(t){let e=new Array;for(let r of t.items){let i=gr.zoomCorner(r,this.productWidth/2);i!==null&&e.push(i)}return e.length>0?new ee(e):null}buildConnection(t,e){let r=new gs(e);for(let i of this.shapeRTree.search(e.bbox())){let n=!1,s=null;if(i instanceof he){let o=i.shape(t.layer,0);o instanceof B&&(s=o)}else i instanceof ue||i instanceof ce||i instanceof ye||i instanceof De||i instanceof Le||i instanceof Ke?s=i.shape(t.layer,0):i instanceof Ve&&i!==t&&(i.net,t.net);s!==null&&(n=r.intersected(s.asClose())),n&&r.connected.push(i)}return r}getSinglePourLayerPolyline(t){let e=this.getMaxClearance(t),r=t.bbox().extendOfSize(e),i=this.pcbLayerRTreeMap.get(t.layer);if(i!==null)for(let s of i.search(r))this.dispatcher(s,t);let n=this.pcbLayerRTreeMap.get(I.MULTI);if(n!==null)for(let s of n.search(r))if(s instanceof ye||s instanceof yr){let o=s.shape(s.layer,0);o!==null&&this.pourClearance.push(o)}else this.dispatcher(s,t)}hasNet(t){return t instanceof ye||t instanceof De||t instanceof Ke||t instanceof mt||t instanceof Le||t instanceof ue||t instanceof ce||t instanceof he||t instanceof Ve}dispatcher(t,e){let r=!D.nullOrEmpty(t.net)&&this.hasNet(t)&&t.net===e.net;if(r&&this.shapeRTree.add(t),t instanceof ye&&(r?this.getTrackConnect(t,e)!="0"&&this.generatePcbTrack(t,e):this.generatePcbTrack(t,e)),t instanceof De&&(r?this.getTrackConnect(t,e)!="0"&&this.generatePcbArc(t,e):this.generatePcbArc(t,e)),t instanceof mt)if(!r)this.generatePcbRegion(t,e);else{let i=this.getTrackConnect(t,e);e.thermal&&i!="0"&&this.generatePcbRegion(t,e)}if(t instanceof Ke&&!r&&this.generatePcbRegion(t,e),t instanceof ft&&!r&&this.generatePcbboxShape(t,e),t instanceof Le&&!r&&this.generatePcbLine(t,e),t instanceof Qe&&!r&&this.generatePcbProhibit(t,e),t instanceof Ue&&!r&&this.generatePcbSlot(t,e),t instanceof ue){let i=t;r||this.generatePcbVia(i,e)}if(t instanceof ce){let i=t;r||this.generatePcbBlindVia(i,e)}if(t instanceof he){let i=t,n=t.layer.equals(I.MULTI)?e.multiLayerThermal:e.thermal;t.padRule&&(n=t.padRule.connectMode!=1),r||this.generatePcbPad1(i,e),r&&n&&this.generatePcbPad2(i,e)}if(t instanceof Ve){let i=t,n=i.shape(i.layer,0);if(n!==null&&!(r&&e.method instanceof st&&i.method instanceof st))if(r)F.addAll(this.pourClearance,Ss(n,this.productWidth/2));else{let s=this.getClearance(i,e,0);F.addAll(this.pourClearance,Ss(n,s))}}}generatePcbTrack(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r);i!==null&&this.updateIndex(t.net,t.width,i,[t.start,t.end])}generatePcbArc(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r);i!==null&&this.updateIndex(t.net,t.width,i,[t.arc.start(),t.arc.end()])}buildOutline(){let t=new hi(this.box2d.build(),2,Dc,this.logger,this.outlineCache),e=new ze(20);for(let r of t.detect().items)e.add(r);return e}generatePcbRegion(t,e){let r=t.shape(e.layer,0);if(r!==null){let i=this.getClearance(t,e,0);if(r instanceof ee){let n=new Array;for(let o of r.items)for(let l of o.primitives){let u=l.stroke(i*2,1,0);n.push(u)}let s=this.merge1(!1,hl,[r.items,n]);for(let o of s.plGrps)F.addAll(this.pourClearance,o.items)}else if(Ia(r))F.addAll(this.pourClearance,Ss(r,this.getClearance(t,e,0)));else{let n=gr.zoomPolygon(r,this.getClearance(t,e,0));n&&F.addAll(this.pourClearance,[n])}}}generatePcbboxShape(t,e){let r=t.shape(e.layer,0);r!==null&&F.addAll(this.pourClearance,Ss(r,this.getClearance(t,e,0)))}generatePcbProhibit(t,e){let r=t.shape(e.layer,0);r!==null&&t.copper&&F.addAll(this.pourClearance,Ss(r,this.productWidth/2+.001))}generatePcbLine(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,0);i!==null&&i.primitives.forEach(n=>{this.updateIndex(t.net,t.width,n.stroke(t.width+r*2,1,0),[n.start(),n.end()])})}generatePcbSlot(t,e){let r=t.shape(e.layer,0);if(r!==null){let i=this._getClearance(e.outlineClearance);F.addAll(this.pourClearance,Ss(r,i))}}getMaxClearance(t){let e=t.clearance;for(let r of this.document.rules)r instanceof sr&&(r.clearance>e&&(e=r.clearance),r.boardClearance>e&&(e=r.boardClearance),r.spokeSpace>e&&(e=r.spokeSpace));return e}getThermalSpace(t,e,r=!1){let i=this.matchRules(t,e),n=["NETWORKSRULE","CUSTOMRULE","CUSTOMREGIONID","NETRULE"],s=-1;for(let o of n){if(o=="CUSTOMRULE")t.padRule&&(s=Math.max(s,t.padRule.lineClearance));else for(let l of i)if(l instanceof sr&&this.isMatchOrder(l,t.net,e.net,o)){let u=t.layer.equals(I.MULTI)?l.multiLayerSpokeSpace:l.spokeSpace;s=Math.max(s,u)}if(N.lesseq(s,0))return 0;if(s!=-1)return this._getClearance(s)}return 0}getTrackConnect(t,e){let r=this.matchRules(t,e),i=["NETWORKSRULE","CUSTOMREGIONID","NETRULE"];for(let n of i)for(let s of r)if(s instanceof sr&&this.isMatchOrder(s,t.net,e.net,n))return s.trackConnect;return"0"}getClearance(t,e,r){let i=-1,n=this.matchRules(t,e),s=["NETWORKSRULE","CUSTOMREGIONID","NETRULE"];for(let o of s){for(let l of n)l instanceof sr&&this.isMatchOrder(l,t.net,e.net,o)&&(t instanceof Ue||t instanceof ve?i=Math.max(i,l.boardClearance):i=Math.max(i,l.clearance));if(i!=-1)return this._getClearance(i)}return this._getClearance(Math.max(i,r,this.baseClearance))}isMatchOrder(t,e,r,i){switch(i){case"NETWORKSRULE":return this.isBetweenNetSelector(t,e,r);case"CUSTOMREGIONID":return this.isIdelector(t);case"NETRULE":return this.isNetSelector(t)||this.isDefaultSelector(t);default:return!1}}isBetweenNetSelector(t,e,r){return t.selector instanceof nr&&this.matchNets(e,r,t.selector)}isIdelector(t){return t.selector instanceof zt}isNetSelector(t){return t.selector instanceof xt}isDefaultSelector(t){return t.selector instanceof ht}matchNets(t,e,r){let i=new Array;for(let n of r.selectors)n instanceof xt&&i.push(n);return i.length==2&&(i[0].net==t&&i[1].net==e||i[0].net==e&&i[1].net==t)}_getClearance(t){return t+rh+this.productWidth/2}matchRules(t,e){let r=new Array,i=new Array,n=new Array,s=new Array;for(let o of this.document.rules){if(o.selector instanceof ht){s.push(o);continue}this.isMatch(t,o.selector)?i.push(o):this.isMatch(e,o.selector)&&n.push(o)}return i.length>0?F.addAll(r,i):F.addAll(r,s),n.length>0?F.addAll(r,n):F.addAll(r,s),r}isMatch(t,e){if(t.net!=""){if(e instanceof xt)return e.net===t.net;if(e instanceof nr){for(let r of e.selectors)if(r instanceof xt&&r.net===t.net)return!0;return!1}else return e instanceof zt?e.id===t.id:e instanceof ht}else return e instanceof ht}generatePcbVia(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r);i!==null&&this.updateIndex(t.net,i.bbox().width(),i,[t.center]);let n=t.shape(I.MULTI,r);n!==null&&n instanceof B&&this.updateIndex(t.net,n.bbox().width(),n,[t.center])}generatePcbBlindVia(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r);i!==null&&this.updateIndex(t.net,i.bbox().width(),i,[t.center]);let n=t.shape(I.MULTI,r);n!==null&&t.isContains(e.layer)&&n instanceof B&&this.updateIndex(t.net,n.bbox().width(),n,[t.center])}generatePcbPad2(t,e){let r=this.getThermalSpace(t,e);if(N.lesseq(r,0))return;r=r>0+this.productWidth/2?r:.001+this.productWidth/2;let i=t.shape(e.layer,r);if(Array.isArray(i))for(let s of i)for(let o of s.items)this.updateIndex(t.net,o.bbox().width(),o,[t.location]);else i instanceof B&&this.updateIndex(t.net,i.bbox().width(),i,[t.location]);let n=t.shape(I.MULTI,r);n!==null&&n instanceof B&&this.updateIndex(t.net,n.bbox().width(),n,[t.location])}generatePcbPad1(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r);if(i!==null)if(i instanceof B)this.updateIndex(t.net,i.bbox().width(),i,[t.location]);else for(let s of i)for(let o of s.items)this.updateIndex(t.net,o.bbox().width(),o,[t.location]);let n=t.shape(I.MULTI,r);n!==null&&n instanceof B&&this.updateIndex(t.net,n.bbox().width(),n,[t.location])}updateIndex(t,e,r,i){t=t.toUpperCase().trim();let n=this.netPolylineIndex[t];n===void 0&&(n=new nn(t),this.netPolylineIndex[t]=n),n.add(r,i),this.minStrokeWidth>e&&(this.minStrokeWidth=e)}};function Uc(a){return Ii(this,null,function*(){let t={},e={},r={},i=JSON.parse(a),n=new Zi;n.sourceName=i.sourceName,n.contributor=i.contributor,n.scale=i.scale,i.rules.forEach(g=>{if(g.CopperRule!=null){let x=g.CopperRule,y;if(x.Selector.AllSelector!=null)y=new ht;else if(x.Selector.NetSelector!=null)y=new xt(x.Selector.NetSelector);else if(x.Selector.OrSelector!=null){let L=x.Selector.OrSelector,w=new Array;for(let C of L){let T=new xt(C);w.push(T)}y=new nr(w)}else x.Selector.IdSelector!=null?y=new zt(x.Selector.IdSelector):y=new ht;let P=new sr(y,x.clearance,x.boardClearance,x.thermal,x.spokeWidth,x.spokeSpace,x.multiLayerThermal,x.multiLayerSpokeWidth,x.multiLayerSpokeSpace,x.trackConnect);n.rules.push(P)}}),i.shapes.forEach(g=>{for(let x in g){let y=g[x];if(x==="PcbBlindVia"){let P=new Array;if(y.unuseLayers)for(let w of y.unuseLayers){let C=new I(Qt(w.type),w.order);P.push(C)}let L=new ce(y.id,y.net,new b(y.center.x,y.center.y),y.holeDiameter,new I(Qt(y.startLayer.type),y.startLayer.order),y.startLayerPad,y.innerPad,new I(Qt(y.endLayer.type),y.endLayer.order),y.endLayerPad,y.mask,P);n.shapes.push(L)}else if(x==="PcbVia"){let P=new Array;if(y.unuseLayers)for(let w of y.unuseLayers){let C=new I(Qt(w.type),w.order);P.push(C)}let L=new ue(y.id,y.net,new b(y.center.x,y.center.y),y.holeDiameter,y.topPad,y.innerPad,y.botPad,y.mask,P);n.shapes.push(L)}else if(x==="PcbarcTrack"){let P=y.arc.sweepAngle>0?1:0,L=new De(y.net,new I(Qt(y.layer.type),y.layer.order),R.build2(new b(y.arc.center.x,y.arc.center.y),y.arc.startAngle,y.arc.startAngle+y.arc.sweepAngle,y.arc.rx,y.arc.ry,P),y.width,y.id);n.shapes.push(L)}else if(x==="PcbTrack"){let P=new ye(y.net,new I(Qt(y.layer.type),y.layer.order),new b(y.start.x,y.start.y),new b(y.end.x,y.end.y),y.width,y.id);n.shapes.push(P)}else if(x==="PcbboxShape"){let P=new ft(new I(Qt(y.layer.type),y.layer.order),new b(y.leftLow.x,y.leftLow.y),new b(y.leftUp.x,y.leftUp.y),new b(y.rightLow.x,y.rightLow.y),new b(y.rightUp.x,y.rightUp.y),y.id);n.shapes.push(P)}else if(x==="PcbPad"){let P=y.shapes.PadShapes.top,L=y.shapes.PadShapes.inner,w=y.shapes.PadShapes.bot;P!=null&&(P.PadShape.outline!=null&&(P.PadShape.outline=et(P.PadShape.outline)[0]),P=new pt(P.PadShape.type,P.PadShape.xSize,P.PadShape.ySize,P.PadShape.cornerRadius,P.PadShape.outline)),L!=null&&(L.PadShape.outline!=null&&(L.PadShape.outline=et(L.PadShape.outline)[0]),L=new pt(L.PadShape.type,L.PadShape.xSize,L.PadShape.ySize,L.PadShape.cornerRadius,L.PadShape.outline)),w!=null&&(w.PadShape.outline!=null&&(w.PadShape.outline=et(w.PadShape.outline)[0]),w=new pt(w.PadShape.type,w.PadShape.xSize,w.PadShape.ySize,w.PadShape.cornerRadius,w.PadShape.outline));let C=new Gr(y.hole.PadHole.type,y.hole.PadHole.size,y.hole.PadHole.length,y.hole.PadHole.rotation,y.hole.PadHole.offsetX,y.hole.PadHole.offsetY),T=null;y.padRule&&(T=new Rr(y.padRule.connectMode,y.padRule.lineWidth,y.padRule.lineClearance,y.padRule.lineAngle));let M=new Array;if(y.unuseLayers)for(let W of y.unuseLayers){let k=new I(Qt(W.type),W.order);M.push(k)}let E=new he(y.id,y.net,new I(Qt(y.layer.type),y.layer.order),new b(y.center.x,y.center.y),y.rotation,new Fr(new I(Qt(y.shapes.PadShapes.layer.type),y.shapes.PadShapes.layer.order),P,L,w),C,y.pasteMaskEx,y.topSolderMaskEx,y.bottomSolderMaskEx,y.designator,y.plated,void 0,T,M);n.shapes.push(E)}else if(x==="PcbLine"){let P=Ne(y.outlines),L=new Le(y.net,new I(Qt(y.layer.type),y.layer.order),y.type,y.width,P,y.id);n.shapes.push(L)}else if(x==="PcbPolygonPour"){let P=y.method;P.HatchedPourMethod!=null&&(P=new At(P.HatchedPourMethod.gridWidth,P.HatchedPourMethod.gridClearance,P.HatchedPourMethod.angle)),P.SolidPourMethod!=null&&(P=new st(P.SolidPourMethod.neckThickness));let L=new Ve(y.id,y.net,new I(Qt(y.layer.type),y.layer.order),P,y.outlineClearance,y.clearance,y.thermal,y.keepIsland,y.pourIndex,y.needCopper,Ne(y.outlines).primitives,[],y.name);L.multiLayerThermal=y.multiLayerThermal,L.multiLayerClearance=y.multiLayerClearance,n.shapes.push(L)}else if(x==="PcbProhibit"){let P=new Qe(y.id,new I(Qt(y.layer.type),y.layer.order),y.type,y.copper,y.track,y.device,y.plane,y.region,Ne(y.outlines));n.shapes.push(P)}else if(x==="PcbRegion"){let P=new Ke(y.net,new I(Qt(y.layer.type),y.layer.order),y.type,y.outlines[0]instanceof Array?new ee(et(y.outlines)):Ne(y.outlines),y.id);n.shapes.push(P)}else if(x==="PcbConstraint"){let P=new Hr(y.net,new I(Qt(y.layer.type),y.layer.order),y.type,Ne(y.outlines),y.id);n.shapes.push(P)}else if(x==="PcbBoardOutline"){let P=new ve(y.id,y.type,Ne(y.outlines));n.shapes.push(P)}else if(x==="PcbSlot"){let P=new Ue(y.id,y.type,Ne(y.outlines));n.shapes.push(P)}else if(x==="PcbTearDrop"){let P=Ne(y.outline),L=new mt(y.id,y.net,new I(Qt(y.layer.type),y.layer.order),P,y.connect);n.shapes.push(L)}}}),i.layerStack.forEach(g=>{let x=new I(Qt(g.type),g.order);n.layerStack.add(x)});let u=n.build(),h=new ot(1),c=new cs(h),f=new ps(h,u.layerStack),d=[],p={};self.POUR_USE_WEB_SERVICE?yield new Il(u,c,new class{onShape(x){x instanceof Ve&&x.needCopper&&d.push(x)}onPourConnection(x,y){p[x]=y}}).fillArea():new Sl(u,c,new class{onShape(x){x instanceof Ve&&x.needCopper&&d.push(x)}onPourConnection(x,y){p[x]=y}}).fillArea(),h.info2("complete pour");let m=c.pours();if(m.length===0)for(let g of d)Vc(e,r,f,p,g);else{let g={};for(let x of d)g[x.id]=x;for(let x of m){let y=g[x.s];y===void 0?e[x.s]=[]:Vc(e,r,f,p,y)}}t.pours=e,self.workerName!=null&&(t.workerName=self.workerName),hr.publish("progressUpdate",{ratio:1,descripte:"copper"}),hr.publish("copperResult",t)})}var Qt=a=>{switch(a){case"MULTI":return 0;case"TOP_SILK":return 1;case"TOP_PASTE_MASK":return 2;case"TOP_PASTE_MASK":return 3;case"TOP":return 4;case"SIGNAL":return 5;case"PLANE":return 6;case"BOTTOM":return 7;case"BOT_PASTE_MASK":return 8;case"BOT_SOLDER_MASK":return 9;case"BOT_SILK":return 10;case"OUTLINE":return 11;case"DOCUMENT":return 12;case"MECHANICAL":return 13;default:return 16}};function Vc(a,t,e,r,i){let n=Cd(i.id,e,r[i.id]),s=Pe.format("%s_%d",i.net,e.info2(i.layer).id);s in t||(t[s]={});let o=t[s];if(o[i.id]=n,i.method instanceof At){let l=i.coppered,u=new Array;for(let h of l){let c=wa(h.items);u.push(c)}a[i.id]={stroke:Pe.fmtNumber(i.method.gridWidth),paths:u,needCopper:i.needCopper}}else{let l=i.coppered,u=new Array;for(let h of l){let c=wa(h.items);u.push(c)}a[i.id]={paths:u,needCopper:i.needCopper}}}function Cd(a,t,e){let r=new Array;if(e!==void 0)for(let i of e){let n=new Array,s=new Array;for(let o of i.connected){let l="",u="",h="",c=b.ORIGIN;o instanceof he?(l="PAD",h=t.info2(o.layer).id.toString(),c=o.location,u=o.id):o instanceof ue&&(l="VIA",h=t.info2(I.MULTI).id.toString(),c=o.center,u=o.id);let f=o.bbox();n.push({cmd:l,fid:a,gid:u,layerId:h,width:f.width(),height:f.height(),x:c.x,y:-c.y})}r.push({connectedPadOrViaArr:n,polygon:[]})}return r}var Pr=class extends de{constructor(e,r,i,n,s,o,l,u){super(u||"",e,Pr.checkPlane(r));this.multiLayerThermal=!1;this.outlineGrps=[];this.outline=o,this.outlineClearance=D.normal(i),this.clearance=D.positiveOr0(n),this.thermal=s,this.coppered=l}static checkPlane(e){if(e.type===6)return e;throw new Error("plane zone must in plane layer")}multiply3(e){let r;if(this.coppered!==null){r=new Array(this.coppered.length);for(let i=0;i<this.coppered.length;i++)r[i]=this.coppered[i].multiply3(e)}else r=null;return new Pr(this.net,this.layer,this.outlineClearance,this.clearance,this.thermal,this.outline.multiply3(e),r)}bbox(){return this.outline.bbox()}shape(e,r){return this.layer.equals(e)?this.outline:this.layer.equals(I.MULTI)?this.outline:null}};var nh=new ot(2),Tl=class{getUnion(t,e=!0){return e&&(t=t.map(r=>this.asSameSweep([r])[0])),Ma(Kt,t)}asSameSweep(t){let e=0;return t.forEach(r=>e+=r.area(.01)),e>0?t.map(r=>r.reverse()):t}getSubtraction(t,e){let r=new at(!1),i=new It(cl.rule,nh,r);for(let n of t){let s=cl.weight(0);i.addPolyline(n,s)}for(let n of e){let s=cl.weight(1);i.addPolyline(n,s)}return i.simplify(),r.plGrps}getIntersection(t,e){let r=new at(!1),i=new It(fl.rule,nh,r);for(let n of t){let s=fl.weight(0);i.addPolyline(n,s)}for(let n of e){let s=fl.weight(1);i.addPolyline(n,s)}return i.simplify(),r.plGrps}getMutuallyExclusive(t,e){let r=new at(!1),i=new It(pl.rule,nh,r);for(let n of t){let s=pl.weight(0);i.addPolyline(n,s)}for(let n of e){let s=pl.weight(1);i.addPolyline(n,s)}return i.simplify(),r.plGrps}};function Gc(a){let t=a.length;if(t<3)return 0;let e=a[0].x*(a[t-1].y-a[1].y);for(let r=1;r<t-1;r++)e+=a[r].x*(a[r-1].y-a[r+1].y);return e+=a[t-1].x*(a[t-2].y-a[0].y),Math.abs(e/2)}function sh(a){let t=a.length;if(t==0)return 0;let e=Gc(a[0]);for(let r=1;r<t;r++)e-=Gc(a[r]);return e}function Wc(a){let t=0;for(let e of a){let r=new Array;for(let i of e.items){let n=new Array;i.points(.1,s=>{n.push(s)}),r.push(n)}t+=sh(r)}return t}var Rl=class{constructor(t,e,r){this.planes=new Array;this.outlines=new Array;this.outlineGrps=new Array;this.outlineOrder=new Array;this.planes=e,this.outlineGrps=t;for(let i of t)this.outlines.push(i[0]);this.outlines.forEach(i=>{this.outlineOrder.push(i)}),this.ratios=new Array(this.outlineOrder.length).fill(0),this.ids=new Array(this.outlineOrder.length).fill(""),this.nets=new Array(this.outlineOrder.length).fill(""),this.layers=new Array(this.outlineOrder.length).fill(r),this.outlineClearance=new Array(this.outlineOrder.length).fill(0),this.clearance=new Array(this.outlineOrder.length).fill(0),this.thermal=new Array(this.outlineOrder.length).fill(!1),this.check(r)}getPoints(t){let e=new Array;return t.points(.1,r=>{e.push(r)}),e}getPoints1(t){let e=new Array;for(let r of t)e.push(this.getPoints(r));return e}getRatio(t,e){let r=t[0],i=sh(this.getPoints1(t)),n=e.outline,s=new Tl,o=s.getIntersection([r],[n]);if(o.length==0)return 0;let l=new Array;for(let f=1;f<t.length;f++)l.push(t[f]);for(let f=1;f<e.coppered[0].items.length;f++)l.push(e.coppered[0].items[f]);let u=s.getSubtraction(o[0].items,l);return Wc(u)/i}check(t){this.planes.forEach(e=>{if(!e.layer.equals(t))return;this.outlines.forEach(i=>{let n=this.outlineOrder.indexOf(i),s=this.outlineGrps[n],o=this.getRatio(s,e);this.ratios[n]<o&&(this.ratios[n]=o,this.ids[n]=e.id,this.nets[n]=e.net,this.layers[n]=e.layer,this.outlineClearance[n]=e.outlineClearance,this.clearance[n]=e.clearance,this.thermal[n]=e.thermal)})})}};var Td=.01,xU=.8,Hc=.1,PU=!0;function zc(a){if(a.length===1)return a[0].items;{let t=new Array;for(let e of a)F.addAll(t,e.items);return t}}function Yc(a,t){return zc(Wr(a,t))}function qc(a){return new ze(10)}var SU=new class extends dt{decide1(t){return t[0]&&t[1]}}(2),Rd=new class extends dt{decide1(t){return t[0]&&t[1]&&!t[2]}}(3),vd=new class extends dt{decide1(t){return t[0]&&!t[1]}}(2),Nd=new class extends dt{decide1(t){return t[0]&&!t[1]&&(t[2]||!t[3])}}(4),vl=class{constructor(t,e,r,i){this.planeZones=[];this.planeClearance=[];this.thermalClearance=[];this.thermalConnector=[];this.outlineCache=[];this.pcbLayerRTreeMap=new Nt;this.shapeRTree=new ze(20);this.cache=new Array(100);this.box2d=new H;this.netPolylineIndex={};this.minStrokeWidth=NaN;this.baseClearance=NaN;this.ratio=0;this.delta=0;this.exclusion={};this.needCopperLayers=new Array;this.constraintTreeMap=new Nt;this.logger=r.logger,this.document=t,this.needCopperLayers=e,this.ev=i,this.setting=r}outputDebug(t){if(t.debug){let e=t.display(),r=new on(e,ot.DUMMY).export();r!==null&&F.downloadFile("debug.pcbdoc",new Blob(r))}}merge1(t,e,r){let i=new at(t);return this.merge2(i,e,r),i}merge2(t,e,r){if(r!==null){let n=new It(e.rule,this.logger,t);for(var i=0;i<r.length;i++){let s=e.weight(i),o=r[i];if(o!==null)for(let l of o)n.addPolyline(l.asClose(),s)}n.simplify(),this.outputDebug(t)}}merge3(t,e,r){let i=new at(t);return this.merge4(i,e,r),i}merge4(t,e,r){if(r!==null){let n=new It(e,this.logger,t);for(var i=0;i<r.length;i++){let s=r[i];if(s!==null)for(let o of s)n.addPolyline(o.asClose())}n.simplify(),this.outputDebug(t)}}fillArea(){this.addDocShapes2RTree(),this.addPolygonPour2Doc()}addDocShapes2RTree(){for(let t of this.document.shapes){if(t instanceof ir)for(let e of t.shapes)this.addShape2RTree(e);else this.addShape2RTree(t);this.box2d.ext1(t.bbox())}}needCopper(t){for(let e of this.needCopperLayers)if(t.equals(e))return!0;return!1}addPolygonPour2Doc(){this.ratio=.1;let t=this.buildOutline(),e=this.getLayers();for(let r of e){if(!this.needCopper(r))continue;let i=this.buildPlane(r,t),n=new Rl(i,this.planeZones,r),s=new Array,o=new Array;for(let l=0,u=n.outlineOrder.length;l<u;l++)if(n.nets[l]!=""){let h=new Pr(n.nets[l],n.layers[l],n.outlineClearance[l],n.clearance[l],n.thermal[l],n.outlineOrder[l],[],n.ids[l]);h.multiLayerThermal=n.thermal[l],h.outlineGrps=n.outlineGrps[l],o.push(n.outlineGrps[l]),s.push(h)}else{let h=this.getRules(),c;for(let d of h)d instanceof ai&&(c=d);let f=new Pr(n.nets[l],n.layers[l],c.boardClearance,c.clearance,c.thermal,n.outlineOrder[l],[]);f.multiLayerThermal=c.thermal,f.outlineGrps=n.outlineGrps[l],o.push(n.outlineGrps[l]),s.push(f)}s.length>0&&(this.delta=1/s.length/5);for(let l=0,u=s.length;l<u;l++){let h=s[l],c=o[l],f=this.getPour(h,t,c);this.ev.onShape(f),this.addNode2RTree(h)}}}addShape2RTree(t){t instanceof Pr?this.planeZones.push(t):(this.addNode2RTree(t),this.ev.onShape(t))}addNode2RTree(t){if(t instanceof Hr){this.constraintTreeMap.computeIfAbsent(t.layer,qc).add(t);return}switch(t.layer.type){case 5:case 6:case 0:this.pcbLayerRTreeMap.computeIfAbsent(t.layer,qc).add(t);break;case 11:t instanceof ve&&t.outlines.primitives.forEach(e=>{this.outlineCache.push(e)});break;default:break}}updateProgress(){hr.publish("progressUpdate",{ratio:this.ratio,descripte:"plane"}),this.ratio+=this.delta}getPour(t,e,r){this.shapeRTree.clear(),this.planeClearance.length=0,this.thermalClearance.length=0,this.thermalConnector.length=0,this.netPolylineIndex={},this.minStrokeWidth=Number.POSITIVE_INFINITY,this.baseClearance=0,this.exclusion={},this.logger.info3("pp %s step 1",t.id),this.updateProgress(),this.baseClearance=t.clearance,this.getSinglePourLayerPolyline(t);let i=this.combindOutlines(t,e,r);this.logger.info3("pp %s step 2",t.id),this.updateProgress(),this.mergeSameNet(this.baseClearance),this.logger.info3("pp %s step 3",t.id),this.updateProgress();let n=this.merge1(!1,Nd,[i,this.planeClearance]);this.logger.info3("pp %s step 4",t.id),this.updateProgress();let s=[],o=n.plGrps;for(let l of o)s.push(l);return this.logger.info3("pp %s step 5",t.id),this.updateProgress(),new Pr(t.net,t.layer,t.outlineClearance,t.clearance,t.thermal,t.outline,s,t.id)}combindOutlines(t,e,r){let i=this._getClearance(t.outlineClearance)-Hc/2,n=new Array,s=new Array,o=new Array,l=new Array;F.addAll(s,zc(Wr(t.outline,0)));for(let f of e.search(t.bbox().extendOfSize(.01)))if(o.push(f),i>0)for(let d of f.primitives)l.push(d.stroke(i*2,1,1));for(let f=1,d=r.length;f<d;f++)l.push(r[f]);let u=25,h=new Array;for(let f=0;f<l.length;f+=u){let d=f+u;l.length<d&&(d=l.length);let p=this.merge3(!1,Kt,[l.slice(f,d)]).plGrps;for(let m of p)F.addAll(h,m.items)}let c=new Array;if(h.length==1)F.addAll(c,h);else{let f=this.merge3(!1,Kt,[h]).plGrps;for(let d of f)F.addAll(c,d.items)}for(let f of this.merge1(!1,Rd,[s,o,c]).plGrps)for(let d of f.items)n.push(d);return n}mergeSameNet(t){let e=t+t+Math.min(this.minStrokeWidth/2,t);e*=e;for(let r in this.netPolylineIndex){let i=this.netPolylineIndex[r],n={};for(let o=0;o<i.points.length;o++){let l=i.points[o],u=!1;for(let h=o+1;h<i.points.length;h++){let c=i.points[h];l.distance2(c)<e&&(this.addAllPlIds(n,i,c),u=!0)}u&&this.addAllPlIds(n,i,l)}let s=new Array;for(let o in n)s.push(i.plIndex[o]);if(s.length>2)for(let o of this.merge3(!1,Kt,[s]).plGrps)F.addAll(this.planeClearance,o.items);else F.addAll(this.planeClearance,s);for(let o=0;o<i.plIndex.length;o++)o in n||this.planeClearance.push(i.plIndex[o])}}addAllPlIds(t,e,r){let i=e.centerPlIds.get(r);if(i!==null)for(let n in i)t[n]=!0}fillGrids(t,e,r,i){let n=new sn(this.logger),s=me.rotate(-i),o=me.rotate(i);for(let h of r.items)n.addPolyline(h.multiply3(s));let l=this.box2d.build().transform(s),u=new Array;for(let h=l.minY;h<=l.maxY;h+=t){let c=new S(new b(l.minX,h),new b(l.maxX,h));F.addAll(u,n.scan(h,c))}for(let h of u){let c=new Array;c.push(h.multiply3(o)),e.push(B.build1(Ir(c)))}}getSinglePourLayerPolyline(t){let e=this.getMaxClearance(t),r=t.bbox().extendOfSize(e),i=this.pcbLayerRTreeMap.get(t.layer);if(i!==null)for(let s of i.search(r))this.dispatcher(s,t);let n=this.pcbLayerRTreeMap.get(I.MULTI);if(n!==null)for(let s of n.search(r))if(s instanceof ye||s instanceof yr){let o=s.shape(s.layer,0);o!==null&&this.planeClearance.push(o)}else this.dispatcher(s,t)}hasNet(t){return t instanceof ye||t instanceof Le||t instanceof ue||t instanceof ce||t instanceof he}dispatcher(t,e){let r=!D.nullOrEmpty(t.net)&&this.hasNet(t)&&t.net===e.net;if(r&&this.shapeRTree.add(t),t instanceof Le&&!r&&this.generatePcbLine(t,e),t instanceof Qe&&!r&&this.generatePcbProhibit(t,e),t instanceof Ue&&!r&&this.generatePcbSlot(t,e),t instanceof ue){let i=t;r||this.generatePcbVia(i,e)}if(t instanceof ce){let i=t;r||this.generatePcbBlindVia(i,e)}if(t instanceof he){let i=t,n=e.multiLayerThermal;if(t.padRule)n=t.padRule.connectMode!=1;else if(r){let s=this.matchConstraintRule(t,e);if(s.length>0){for(let o of s)if(n=o.multiLayerThermal,n)break}}r||this.generatePcbPad1(i,e),r&&n&&this.generatePcbPad2(i,e)}if(t instanceof Pr&&t!=e){let i=t;if(i.shape(i.layer,0)!==null&&!r){let s=this.getClearance(i,e,0);for(let o of t.outlineGrps)for(let l of o.primitives)this.planeClearance.push(l.stroke(s*2,1,0))}}}generatePcbTrack(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r);i!==null&&this.updateIndex(t.net,t.width,i,[t.start,t.end])}buildOutline(){let t=new ze(20);if(this.outlineCache.length==0)return t;let e=new hi(this.box2d.build(),2,Hc,this.logger,this.outlineCache);for(let r of e.detect().items)t.add(r);return t}buildPlane(t,e){let r=new Array,i=this.pcbLayerRTreeMap.get(t);return e.items().forEach(n=>{let s=new Array;i!=null&&i.search(n.bbox().extendOfSize(.01)).forEach(l=>{if(l instanceof Le){let u=l.width;l.outlines.primitives.forEach(h=>{s.push(h.stroke(u,1,0))})}});for(let o of this.merge1(!1,vd,[[n],s]).plGrps)ie(o.items,(l,u)=>u.bbox().area()-l.bbox().area(),0,o.items.length),r.push(o.items)}),r}getLayers(){let t=new Array;for(let e of this.document.layerStack)e.type==6&&t.push(e);return t}generatePcbLine(t,e){let r=t.shape(e.layer,0);r!==null&&r.primitives.forEach(i=>{this.updateIndex(t.net,t.width,i.stroke(t.width,1,0),[i.start(),i.end()])})}generatePcbProhibit(t,e){let r=t.shape(e.layer,0);if(r!==null&&t.plane){let i=this._getClearance(0);F.addAll(this.planeClearance,Yc(r,i))}}generatePcbSlot(t,e){let r=t.shape(e.layer,0);if(r!==null){let i=this.getClearance(t,e,0);F.addAll(this.planeClearance,Yc(r,i))}}getClearance(t,e,r){let i=-1,n=this.matchConstraintRule(t,e);if(n.length>0){for(let l of n)t instanceof Ue||t instanceof ve?i=Math.max(i,l.boardClearance):i=Math.max(i,l.clearance);return i!=-1?this._getClearance(i):this._getClearance(Math.max(i,r,this.baseClearance))}let s=this.matchRules(t,e),o=["NETWORKSRULE","CUSTOMREGIONID","NETRULE"];for(let l of o){for(let u of s)u instanceof ai&&this.isMatchOrder(u,t.net,e.net,l)&&(t instanceof Ue||t instanceof ve?i=Math.max(i,u.boardClearance):i=Math.max(i,u.clearance));if(i!=-1)return this._getClearance(i)}return this._getClearance(Math.max(i,r,this.baseClearance))}matchConstraintRule(t,e){let r=t.bbox(),i=[],n=this.constraintTreeMap.get(e.layer);if(n!=null){let l=n.search(r);for(let u=0;u<l.length;u++)i.push(l[u])}let s=this.constraintTreeMap.get(I.MULTI);if(s!=null){let l=s.search(r);for(let u=0;u<l.length;u++)i.push(l[u])}let o=new Array;for(let l of i)if(Pl.isInConstraintCompatible(l,t))for(let u of this.document.rules)u.selector instanceof zt&&u instanceof ai&&u.selector.id==l.id&&o.push(u);return o}isMatchOrder(t,e,r,i){switch(i){case"NETWORKSRULE":return this.isBetweenNetSelector(t,e,r);case"CUSTOMREGIONID":return this.isIdelector(t);case"NETRULE":return this.isNetSelector(t)||this.isDefaultSelector(t);default:return!1}}isIdelector(t){return t.selector instanceof zt}isBetweenNetSelector(t,e,r){return t.selector instanceof nr&&this.matchNets(e,r,t.selector)}isNetSelector(t){return t.selector instanceof xt}isDefaultSelector(t){return t.selector instanceof ht}matchNets(t,e,r){let i=new Array;for(let n of r.selectors)n instanceof xt&&i.push(n);return i.length==2&&(i[0].net==t&&i[1].net==e||i[0].net==e&&i[1].net==t)}_getClearance(t){return t+Td}matchRules(t,e){let r=new Set,i=new Array,n=new Array,s=new Array;for(let o of this.document.rules){if(o.selector instanceof ht){s.push(o);continue}this.isMatch(t,o.selector)&&i.push(o),this.isMatch(e,o.selector)&&n.push(o)}return i.length>0?F.addAllSet(r,i):F.addAllSet(r,s),n.length>0?F.addAllSet(r,n):F.addAllSet(r,s),r}getMaxClearance(t){let e=t.clearance;for(let r of this.document.rules)r instanceof ai&&(r.clearance>e&&(e=r.clearance),r.boardClearance>e&&(e=r.boardClearance),r.spokeSpace>e&&(e=r.spokeSpace));return e}getRules(){let t=new Array;for(let e of this.document.rules)e.selector instanceof ht&&t.push(e);return t}isMatch(t,e){if(t.net!=""){if(e instanceof xt)return e.net===t.net;if(e instanceof nr){for(let r of e.selectors)if(r instanceof xt&&r.net===t.net)return!0;return!1}else return e instanceof zt?e.id===t.id:e instanceof ht}else return e instanceof ht}generatePcbVia(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r);i!==null&&this.updateIndex(t.net,i.bbox().width(),i,[t.center]);let n=t.shape(I.MULTI,r);n!==null&&n instanceof B&&this.updateIndex(t.net,n.bbox().width(),n,[t.center])}generatePcbBlindVia(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r);i!==null&&this.updateIndex(t.net,i.bbox().width(),i,[t.center]);let n=t.shape(I.MULTI,r);n!==null&&t.isContains(e.layer)&&n instanceof B&&this.updateIndex(t.net,n.bbox().width(),n,[t.center])}generatePcbPad2(t,e){let r=this.getThermalSpace(t,e);if(N.eq(r,0))return;r=r>.6?r:.601;let i=t.shape(e.layer,r);if(Array.isArray(i))for(let s of i)for(let o of s.items)this.updateIndex(t.net,o.bbox().width(),o,[t.location]);else i instanceof B&&this.updateIndex(t.net,i.bbox().width(),i,[t.location]);let n=t.shape(I.MULTI,r);n!==null&&n instanceof B&&this.updateIndex(t.net,n.bbox().width(),n,[t.location])}generatePcbPad1(t,e){let r=this.getClearance(t,e,0),i=t.shape(e.layer,r);if(i!==null)if(i instanceof B)this.updateIndex(t.net,i.bbox().width(),i,[t.location]);else for(let s of i)for(let o of s.items)this.updateIndex(t.net,o.bbox().width(),o,[t.location]);let n=t.shape(I.MULTI,r);n!==null&&n instanceof B&&this.updateIndex(t.net,n.bbox().width(),n,[t.location])}getThermalSpace(t,e){let r=-1;if(t.padRule){if(r=Math.max(r,t.padRule.lineClearance),N.eq(r,0))return 0;if(r!=-1)return this._getClearance(r)}let i=this.matchConstraintRule(t,e);if(i.length>0){for(let o of i){let l=t.layer.equals(I.MULTI)?o.multiLayerSpokeSpace:o.spokeSpace;r=Math.max(r,l)}if(N.eq(r,0))return 0;if(r!=-1)return this._getClearance(r)}let n=this.matchRules(t,e),s=["NETWORKSRULE","CUSTOMRULE","CUSTOMREGIONID","NETRULE"];for(let o of s){for(let l of n)if(l instanceof ai&&this.isMatchOrder(l,t.net,e.net,o)){let u=t.layer.equals(I.MULTI)?l.multiLayerSpokeSpace:l.spokeSpace;r=Math.max(r,u)}if(N.eq(r,0))return 0;if(r!=-1)return this._getClearance(r)}return 0}updateIndex(t,e,r,i){t=t==null?void 0:t.toUpperCase().trim();let n=this.netPolylineIndex[t];n===void 0&&(n=new nn(t),this.netPolylineIndex[t]=n),n.add(r,i),this.minStrokeWidth>e&&(this.minStrokeWidth=e)}};function Kc(a){let t={},e=new Array,r=new Array,i=new Array,n=new Array,s=new Array,o={},l=JSON.parse(a),u=new Zi;u.sourceName=l.sourceName,u.contributor=l.contributor,u.scale=l.scale,l.rules.forEach(C=>{if(C.PlaneRule!=null){let T=C.PlaneRule,M;if(T.Selector.AllSelector!=null)M=new ht;else if(T.Selector.NetSelector!=null)M=new xt(T.Selector.NetSelector);else if(T.Selector.OrSelector!=null){let W=T.Selector.OrSelector,k=new Array;for(let O of W){let se=new xt(O);k.push(se)}M=new nr(k)}else T.Selector.IdSelector!=null?M=new zt(T.Selector.IdSelector):M=new ht;let E=new ai(M,T.clearance,T.boardClearance,T.thermal,T.spokeWidth,T.spokeSpace,T.multiLayerThermal,T.multiLayerSpokeWidth,T.multiLayerSpokeSpace);u.rules.push(E)}}),l.shapes.forEach(C=>{for(let T in C){let M=C[T];if(T==="PcbBlindVia"){let E=new Array;if(M.unuseLayers)for(let k of M.unuseLayers){let O=new I(Ft(k.type),k.order);E.push(O)}let W=new ce(M.id,M.net,new b(M.center.x,M.center.y),M.holeDiameter,new I(Ft(M.startLayer.type),M.startLayer.order),M.startLayerPad,M.innerPad,new I(Ft(M.endLayer.type),M.endLayer.order),M.endLayerPad,M.mask,E);u.shapes.push(W)}else if(T==="PcbVia"){let E=new Array;if(M.unuseLayers)for(let k of M.unuseLayers){let O=new I(Ft(k.type),k.order);E.push(O)}let W=new ue(M.id,M.net,new b(M.center.x,M.center.y),M.holeDiameter,M.topPad,M.innerPad,M.botPad,M.mask,E);u.shapes.push(W)}else if(T==="PcbarcTrack"){let E=M.arc.sweepAngle>0?1:0,W=new De(M.net,new I(Ft(M.layer.type),M.layer.order),R.build2(new b(M.arc.center.x,M.arc.center.y),M.arc.startAngle,M.arc.startAngle+M.arc.sweepAngle,M.arc.rx,M.arc.ry,E),M.width,M.id);u.shapes.push(W)}else if(T==="PcbTrack"){let E=new ye(M.net,new I(Ft(M.layer.type),M.layer.order),new b(M.start.x,M.start.y),new b(M.end.x,M.end.y),M.width,M.id);u.shapes.push(E)}else if(T==="PcbboxShape"){let E=new ft(new I(Ft(M.layer.type),M.layer.order),new b(M.leftLow.x,M.leftLow.y),new b(M.leftUp.x,M.leftUp.y),new b(M.rightLow.x,M.rightLow.y),new b(M.rightUp.x,M.rightUp.y),M.id);u.shapes.push(E)}else if(T==="PcbConstraint"){let E=new Hr(M.net,new I(Ft(M.layer.type),M.layer.order),M.type,Ne(M.outlines),M.id);u.shapes.push(E)}else if(T==="PcbPad"){let E=M.shapes.PadShapes.top,W=M.shapes.PadShapes.inner,k=M.shapes.PadShapes.bot;E!=null&&(E.PadShape.outline!=null&&(E.PadShape.outline=et(E.PadShape.outline)[0]),E=new pt(E.PadShape.type,E.PadShape.xSize,E.PadShape.ySize,E.PadShape.cornerRadius,E.PadShape.outline)),W!=null&&(W.PadShape.outline!=null&&(W.PadShape.outline=et(W.PadShape.outline)[0]),W=new pt(W.PadShape.type,W.PadShape.xSize,W.PadShape.ySize,W.PadShape.cornerRadius,W.PadShape.outline)),k!=null&&(k.PadShape.outline!=null&&(k.PadShape.outline=et(k.PadShape.outline)[0]),k=new pt(k.PadShape.type,k.PadShape.xSize,k.PadShape.ySize,k.PadShape.cornerRadius,k.PadShape.outline));let O=new Gr(M.hole.PadHole.type,M.hole.PadHole.size,M.hole.PadHole.length,M.hole.PadHole.rotation,M.hole.PadHole.offsetX,M.hole.PadHole.offsetY),se=null;M.padRule&&(se=new Rr(M.padRule.connectMode,M.padRule.lineWidth,M.padRule.lineClearance,M.padRule.lineAngle));let Y=new Array;if(M.unuseLayers)for(let ae of M.unuseLayers){let le=new I(Ft(ae.type),ae.order);Y.push(le)}let $=new he(M.id,M.net,new I(Ft(M.layer.type),M.layer.order),new b(M.center.x,M.center.y),M.rotation,new Fr(new I(Ft(M.shapes.PadShapes.layer.type),M.shapes.PadShapes.layer.order),E,W,k),O,M.pasteMaskEx,M.topSolderMaskEx,M.bottomSolderMaskEx,M.designator,M.plated,void 0,se,Y);u.shapes.push($)}else if(T==="PcbLine"){let E=Ne(M.outlines),W=new Le(M.net,new I(Ft(M.layer.type),M.layer.order),M.type,M.width,E,M.id);u.shapes.push(W)}else if(T==="PcbPolygonPour"){let E=M.method;E.HatchedPourMethod!=null&&(E=new At(E.HatchedPourMethod.gridWidth,E.HatchedPourMethod.gridClearance,E.HatchedPourMethod.angle)),E.SolidPourMethod!=null&&(E=new st(E.SolidPourMethod.neckThickness));let W=new Ve(M.id,M.net,new I(Ft(M.layer.type),M.layer.order),E,M.outlineClearance,M.clearance,M.thermal,M.keepIsland,M.pourIndex,M.needCopper,Ne(M.outlines).primitives,[]);W.multiLayerThermal=M.multiLayerThermal,W.multiLayerClearance=M.multiLayerClearance,u.shapes.push(W)}else if(T==="PcbProhibit"){let E=new Qe(M.id,new I(Ft(M.layer.type),M.layer.order),M.type,M.copper,M.track,M.device,M.plane,M.region,Ne(M.outlines));u.shapes.push(E)}else if(T==="PcbRegion"){let E=new Ke(M.net,new I(Ft(M.layer.type),M.layer.order),M.type,M.outlines[0]instanceof Array?new ee(et(M.outlines)):Ne(M.outlines),M.id);u.shapes.push(E)}else if(T==="PcbBoardOutline"){let E=new ve(M.id,M.type,Ne(M.outlines));u.shapes.push(E)}else if(T==="PcbSlot"){let E=new Ue(M.id,M.type,Ne(M.outlines));u.shapes.push(E)}else if(T==="PcbPlaneZone"){let E=new Pr(M.net,new I(Ft(M.layer.type),M.layer.order),M.outlineClearance,M.clearance,M.thermal,Ne(M.outline),[new ee(et(M.coppered))],M.id);E.multiLayerThermal=M.thermal,u.shapes.push(E)}else if(T==="PcbTearDrop"){let E=Ne(M.outline),W=new mt(M.id,M.net,new I(Ft(M.layer.type),M.layer.order),E,M.connect);u.shapes.push(W)}}}),l.layerStack.forEach(C=>{let T=new I(Ft(C.type),C.order);u.layerStack.add(T)});let d=l.planes,p=new Array;d.forEach(C=>{let T=new I(Ft(C.type),C.order);p.push(T)});let m=u.build(),g=new ot(1),x=new cs(g),y=new ps(g,m.layerStack),P=[],L={};new vl(m,p,x,new class{onShape(T){T instanceof Pr&&P.push(T)}onPourConnection(T,M){L[T]=M}}).fillArea(),g.info2("complete pour");let w=x.pours();if(w.length===0)for(let C of P)Xc(e,s,r,i,n,o,y,L,C);else{let C={};for(let T of P)C[T.id]=T;for(let T of w){let M=C[T.s];M!=null&&Xc(e,s,r,i,n,o,y,L,M)}}t.pours=e,t.layers=r,t.nets=i,t.styles=n,t.ids=s,self.workerName!=null&&(t.workerName=self.workerName),hr.publish("progressUpdate",{ratio:1,descripte:"plane"}),hr.publish("planeResult",t)}var Ft=a=>{switch(a){case"MULTI":return 0;case"TOP_SILK":return 1;case"TOP_PASTE_MASK":return 2;case"TOP_PASTE_MASK":return 3;case"TOP":return 4;case"SIGNAL":return 5;case"PLANE":return 6;case"BOTTOM":return 7;case"BOT_PASTE_MASK":return 8;case"BOT_SOLDER_MASK":return 9;case"BOT_SILK":return 10;case"OUTLINE":return 11;case"DOCUMENT":return 12;case"MECHANICAL":return 13;default:return 16}},Ed=a=>{switch(a.type){case 6:return a.order+14;default:return 0}};function Xc(a,t,e,r,i,n,s,o,l){let u=Bd(l.id,s,o[l.id]),h=Pe.format("%s_%d",l.net,s.info2(l.layer).id);h in n||(n[h]={});let c=n[h];c[l.id]=u;let f=l.coppered;for(let d of f){let p=wa(d.items);t.push(l.id),a.push(p),e.push(Ed(l.layer)),r.push(l.net),i.push(l.thermal)}}function Bd(a,t,e){let r=new Array;if(e!==void 0)for(let i of e){let n=new Array,s=new Array;for(let o of i.connected){let l="",u="",h="",c=b.ORIGIN;o instanceof he?(l="PAD",h=t.info2(o.layer).id.toString(),c=o.location,u=o.id):o instanceof ue&&(l="VIA",h=t.info2(I.MULTI).id.toString(),c=o.center,u=o.id);let f=o.bbox();n.push({cmd:l,fid:a,gid:u,layerId:h,width:f.width(),height:f.height(),x:c.x,y:-c.y})}r.push({connectedPadOrViaArr:n,polygon:[]})}return r}var pi=class{constructor(){this.triangle=new Array;this.item=null;this.width=0}addItem(t,e){this.item=t,this.width=e}addTriangle(t,e,r){this.triangle.push(t),this.triangle.push(e),this.triangle.push(r)}bbox(){if(this.item!=null){let t=new H;return t.ext1(this.item.bbox()).ext7(this.width/2),t.build()}else{let t=new H;return this.triangle.forEach(e=>{t.ext2(e)}),t.build()}}};var Ct=class extends de{constructor(e,r,i,n,s){super(e,r,i);this.rtree=new ze(50);this.shapeRtree=new ze(50);this.pointInLine=0;this.directs=new Set;if(this.method=n,this.outlines=s,this.method instanceof st){this.addTriangleItems();let o=new Array;for(let l of s){o.push(l);for(let u of l.primitives)if(this.rtree.add(u),this.method.neckThickness>0){if(u instanceof S||u instanceof R){let c=new pi;c.addItem(u,this.method.neckThickness),this.shapeRtree.add(c)}let h=u.stroke(this.method.neckThickness,1,0).asClose();o.push(h),h.primitives.forEach(c=>{this.rtree.add(c)})}}this.shapes=new ee(o)}else if(this.method instanceof At){let o=new Array;for(let l of this.outlines)for(let u of l.primitives){if(u instanceof S||u instanceof R){let c=new pi;c.addItem(u,this.method.gridWidth),this.shapeRtree.add(c)}let h=u.stroke(this.method.gridWidth,1,0).asClose();h.primitives.forEach(c=>{this.rtree.add(c)}),o.push(h)}this.shapes=new ee(o)}this.__bbox=this.calcBBox()}addTriangleItems(){for(let e of this.outlines){let r=new Array;e.points(.05,o=>{r.push(o)});let i=new Array,n=null;for(let o=0;o<r.length-2;o+=2){let l=r[o],u=r[o+1],h=r[o+2],c=new pi;c.addTriangle(l,u,h),this.shapeRtree.add(c),i.push(l),n=h}r.indexOf(n)==r.length-2&&i.push(n);for(let o=0;o<i.length-2;o+=2){let l=i[o],u=i[o+1],h=i[o+2],c=new pi;c.addTriangle(l,u,h),this.shapeRtree.add(c),i.push(l)}}}calcBBox(){let e=new H;for(let r=0;r<this.outlines.length;r++)e.ext1(this.outlines[r].bbox());return e.build()}inPolygons(e){this.pointInLine=0,this.directs.clear();let r=!1,i=this.shapeRtree.search(e.bbox().extendOfSize(1e-8));for(let n of i){if(n.item!=null){let s=n.item;if(s instanceof S&&s.inArea(e,n.width,1))return!0;if(s instanceof R&&s.inArea(e,n.width))return!0}n.triangle.length>0&&(r=this.getSelect(e,n.triangle[0],n.triangle[1],n.triangle[2],r))}return this.pointInLine/2%2>0&&(r=!r),this.pointInLine=0,r}shape(e,r){return e.equals(this.layer)?this.shapes:null}bbox(){return this.__bbox}multiply3(e){let r=new Array(this.outlines.length);for(let i=0;i<r.length;i++)r[i]=this.outlines[i].multiply3(e);return new Ct(this.id,this.net,this.layer,this.method,r)}getSelect(e,r,i,n,s){return this.checkEndpoint(e,r,i,n)||this.pointInTriangle(e,r,i,n)&&(s=!s),s}pointInTriangle(e,r,i,n){let s=this.inInner(e,r,i,n),o=this.inInner(e,i,n,r),l=this.inInner(e,n,r,i);if(s>=0&&o>=0&&l>=0&&!(s==0&&o==0&&l==0)){if(s==0||o==0||l==0){let u=null;s==0&&(u=this.getNormal(r,i,n)),o==0&&(u=this.getNormal(i,n,r)),l==0&&(u=this.getNormal(n,r,i));let h=!0;this.directs.forEach(c=>{c.equals(u)&&(h=!1,u=c)}),h?(this.directs.add(u),this.pointInLine++):(this.directs.delete(u),this.pointInLine--)}return!0}return!1}inInner(e,r,i,n){let s=i.sub(r).normalize(),o=n.sub(r).normalize(),l=e.sub(r).normalize(),u=s.cross(l),h=s.cross(o);return u*h}checkEndpoint(e,r,i,n){if(e.y==r.y){if(i.y>e.y&&n.y>e.y||i.y<e.y&&n.y<e.y)return!0}else if(e.y==i.y){if(r.y>e.y&&n.y>e.y||r.y<e.y&&n.y<e.y)return!0}else if(e.y==n.y){if(r.y>e.y&&i.y>e.y||r.y<e.y&&i.y<e.y)return!0}else{if(Math.abs(i.sub(r).cross(n.sub(i)))<1e-8)return!0;if(r.y>e.y&&i.y>e.y&&n.y>e.y)return!0;if(r.y<e.y&&i.y<e.y&&n.y<e.y)return!0}return!1}getNormal(e,r,i){let n=r.sub(e).normalize(),s=i.sub(e),o=new b(-n.y,n.x);return o.mul(s.dot(o)).normalize()}};var Tt=class extends de{constructor(e,r,i,n){super(e,r,i);this.rtree=new ze(50);this.shapeRtree=new ze(50);this.pointInLine=0;this.directs=new Set;this.outlines=n,this.addTriangleItems(),this.__bbox=this.calcBBox();for(let s of n)for(let o of s.primitives)this.rtree.add(o);this.shapes=new ee(this.outlines)}addTriangleItems(){for(let e of this.outlines){let r=new Array;e.points(.1,o=>{r.push(o)});let i=new Array,n=null;for(let o=0;o<r.length-2;o+=2){let l=r[o],u=r[o+1],h=r[o+2],c=new pi;c.addTriangle(l,u,h),this.shapeRtree.add(c),i.push(l),n=h}r.indexOf(n)==r.length-2&&i.push(n);for(let o=0;o<i.length-2;o+=2){let l=i[o],u=i[o+1],h=i[o+2],c=new pi;c.addTriangle(l,u,h),this.shapeRtree.add(c),i.push(l)}}}calcBBox(){let e=new H;for(let r=0;r<this.outlines.length;r++)e.ext1(this.outlines[r].bbox());return e.build()}shape(e,r){return e.equals(this.layer)?this.shapes:null}bbox(){return this.__bbox}multiply3(e){let r=new Array(this.outlines.length);for(let i=0;i<r.length;i++)r[i]=this.outlines[i].multiply3(e);return new Tt(this.id,this.net,this.layer,r)}inPolygons(e){this.pointInLine=0,this.directs.clear();let r=!1,i=this.shapeRtree.search(e.bbox().extendOfSize(1e-8));for(let n of i)n.triangle.length>0&&(r=this.getSelect(e,n.triangle[0],n.triangle[1],n.triangle[2],r));return this.pointInLine/2%2>0&&(r=!r),this.pointInLine=0,r}getSelect(e,r,i,n,s){return this.checkEndpoint(e,r,i,n)||this.pointInTriangle(e,r,i,n)&&(s=!s),s}pointInTriangle(e,r,i,n){let s=this.inInner(e,r,i,n),o=this.inInner(e,i,n,r),l=this.inInner(e,n,r,i);if(s>=0&&o>=0&&l>=0&&!(s==0&&o==0&&l==0)){if(s==0||o==0||l==0){let u=null;s==0&&(u=this.getNormal(r,i,n)),o==0&&(u=this.getNormal(i,n,r)),l==0&&(u=this.getNormal(n,r,i));let h=!0;this.directs.forEach(c=>{c.equals(u)&&(h=!1,u=c)}),h?(this.directs.add(u),this.pointInLine++):(this.directs.delete(u),this.pointInLine--)}return!0}return!1}inInner(e,r,i,n){let s=i.sub(r).normalize(),o=n.sub(r).normalize(),l=e.sub(r).normalize(),u=s.cross(l),h=s.cross(o);return u*h}checkEndpoint(e,r,i,n){if(e.y==r.y){if(i.y>e.y&&n.y>e.y||i.y<e.y&&n.y<e.y)return!0}else if(e.y==i.y){if(r.y>e.y&&n.y>e.y||r.y<e.y&&n.y<e.y)return!0}else if(e.y==n.y){if(r.y>e.y&&i.y>e.y||r.y<e.y&&i.y<e.y)return!0}else{if(Math.abs(i.sub(r).cross(n.sub(i)))<1e-8)return!0;if(r.y>e.y&&i.y>e.y&&n.y>e.y)return!0;if(r.y<e.y&&i.y<e.y&&n.y<e.y)return!0}return!1}getNormal(e,r,i){let n=r.sub(e).normalize(),s=i.sub(e),o=new b(-n.y,n.x);return o.mul(s.dot(o)).normalize()}};function VG(a){let t=[];return a.forEach(e=>{for(let r in e){let i=e[r];if(r==="PcbBlindVia"){let n=new Array;if(i.unuseLayers)for(let o of i.unuseLayers){let l=new I(Ee(o.type),o.order);n.push(l)}let s=new ce(i.id,i.net,new b(i.center.x,i.center.y),i.holeDiameter,new I(Ee(i.startLayer.type),i.startLayer.order),i.startLayerPad,i.innerPad,new I(Ee(i.endLayer.type),i.endLayer.order),i.endLayerPad,i.mask,n);t.push(s)}else if(r==="PcbVia"){let n=new Array;if(i.unuseLayers)for(let o of i.unuseLayers){let l=new I(Ee(o.type),o.order);n.push(l)}let s=new ue(i.id,i.net,new b(i.center.x,i.center.y),i.holeDiameter,i.topPad,i.innerPad,i.botPad,i.mask,n);t.push(s)}else if(r==="PcbarcTrack"){let n=i.arc.sweepAngle>0?1:0,s=new De(i.net,new I(Ee(i.layer.type),i.layer.order),R.build2(new b(i.arc.center.x,i.arc.center.y),i.arc.startAngle,i.arc.startAngle+i.arc.sweepAngle,i.arc.rx,i.arc.ry,n),i.width,i.id);t.push(s)}else if(r==="PcbTrack"){let n=new ye(i.net,new I(Ee(i.layer.type),i.layer.order),new b(i.start.x,i.start.y),new b(i.end.x,i.end.y),i.width,i.id);t.push(n)}else if(r==="PcbboxShape"){let n=new ft(new I(Ee(i.layer.type),i.layer.order),new b(i.leftLow.x,i.leftLow.y),new b(i.leftUp.x,i.leftUp.y),new b(i.rightLow.x,i.rightLow.y),new b(i.rightUp.x,i.rightUp.y),i.id);t.push(n)}else if(r==="PcbPad"){let n=i.shapes.PadShapes.top,s=i.shapes.PadShapes.inner,o=i.shapes.PadShapes.bot;n!=null&&(n.PadShape.outline!=null&&(n.PadShape.outline=et(n.PadShape.outline)[0]),n=new pt(n.PadShape.type,n.PadShape.xSize,n.PadShape.ySize,n.PadShape.cornerRadius,n.PadShape.outline)),s!=null&&(s.PadShape.outline!=null&&(s.PadShape.outline=et(s.PadShape.outline)[0]),s=new pt(s.PadShape.type,s.PadShape.xSize,s.PadShape.ySize,s.PadShape.cornerRadius,s.PadShape.outline)),o!=null&&(o.PadShape.outline!=null&&(o.PadShape.outline=et(o.PadShape.outline)[0]),o=new pt(o.PadShape.type,o.PadShape.xSize,o.PadShape.ySize,o.PadShape.cornerRadius,o.PadShape.outline));let l=new Gr(i.hole.PadHole.type,i.hole.PadHole.size,i.hole.PadHole.length,i.hole.PadHole.rotation,i.hole.PadHole.offsetX,i.hole.PadHole.offsetY),u=null;i.padRule&&(u=new Rr(i.padRule.connectMode,i.padRule.lineWidth,i.padRule.lineClearance,i.padRule.lineAngle));let h=new Array;if(i.unuseLayers)for(let f of i.unuseLayers){let d=new I(Ee(f.type),f.order);h.push(d)}let c=new he(i.id,i.net,new I(Ee(i.layer.type),i.layer.order),new b(i.center.x,i.center.y),i.rotation,new Fr(new I(Ee(i.shapes.PadShapes.layer.type),i.shapes.PadShapes.layer.order),n,s,o),l,i.pasteMaskEx,i.topSolderMaskEx,i.bottomSolderMaskEx,i.designator,i.plated,i.flag,u,h);t.push(c)}else if(r==="PcbLine"){let n=Ne(i.outlines),s=new Le(i.net,new I(Ee(i.layer.type),i.layer.order),i.type,i.width,n,i.id);t.push(s)}else if(r==="PcbPolygonPour"){let n=i.method;n.HatchedPourMethod!=null&&(n=new At(n.HatchedPourMethod.gridWidth,n.HatchedPourMethod.gridClearance,n.HatchedPourMethod.angle)),n.SolidPourMethod!=null&&(n=new st(n.SolidPourMethod.neckThickness));let s=new Ve(i.id,i.net,new I(Ee(i.layer.type),i.layer.order),n,i.outlineClearance,i.clearance,i.thermal,i.keepIsland,i.pourIndex,i.needCopper,Ne(i.outlines).primitives,[],i.name);t.push(s)}else if(r==="PcbProhibit"){let n=new Qe(i.id,new I(Ee(i.layer.type),i.layer.order),i.type,i.copper,i.track,i.device,i.plane,i.region,Ne(i.outlines));t.push(n)}else if(r==="PcbRegion"){let n=new Zt(i.net,new I(Ee(i.layer.type),i.layer.order),i.type,i.outlines[0]instanceof Array?new ee(et(i.outlines)):Ne(i.outlines));t.push(n)}else if(r==="PcbBoardOutline"){let n=new ve(i.id,i.type,Ne(i.outlines));t.push(n)}else if(r==="PcbSlot"){let n=new Ue(i.id,i.type,Ne(i.outlines));t.push(n)}}}),t}var Ee=a=>{switch(a){case"MULTI":return 0;case"TOP_SILK":return 1;case"TOP_PASTE_MASK":return 2;case"TOP_PASTE_MASK":return 3;case"TOP":return 4;case"SIGNAL":return 5;case"PLANE":return 6;case"BOTTOM":return 7;case"BOT_PASTE_MASK":return 8;case"BOT_SOLDER_MASK":return 9;case"BOT_SILK":return 10;case"OUTLINE":return 11;case"DOCUMENT":return 12;case"MECHANICAL":return 13;default:return 16}};function Zc(a){let t=[];return a.forEach(e=>{for(let r in e){let i=e[r];if(r==="PcbBlindVia"){let n=new Array;if(i.unuseLayers)for(let o of i.unuseLayers){let l=new I(Ee(o.type),o.order);n.push(l)}let s=new ce(i.id,i.net,new b(i.center.x,i.center.y),i.holeDiameter,new I(Ee(i.startLayer.type),i.startLayer.order),i.startLayerPad,i.innerPad,new I(Ee(i.endLayer.type),i.endLayer.order),i.endLayerPad,i.mask,n);t.push(s)}else if(r==="PcbVia"){let n=new Array;if(i.unuseLayers)for(let o of i.unuseLayers){let l=new I(Ee(o.type),o.order);n.push(l)}let s=new ue(i.id,i.net,new b(i.center.x,i.center.y),i.holeDiameter,i.topPad,i.innerPad,i.botPad,i.mask,n);t.push(s)}else if(r==="PcbarcTrack"){let n=i.arc.sweepAngle>0?1:0,s=new De(i.net,new I(Ee(i.layer.type),i.layer.order),R.build2(new b(i.arc.center.x,i.arc.center.y),i.arc.startAngle,i.arc.startAngle+i.arc.sweepAngle,i.arc.rx,i.arc.ry,n),i.width,i.id);t.push(s)}else if(r==="PcbTrack"){let n=new ye(i.net,new I(Ee(i.layer.type),i.layer.order),new b(i.start.x,i.start.y),new b(i.end.x,i.end.y),i.width,i.id);t.push(n)}else if(r==="PcbboxShape"){let n=new ft(new I(Ee(i.layer.type),i.layer.order),new b(i.leftLow.x,i.leftLow.y),new b(i.leftUp.x,i.leftUp.y),new b(i.rightLow.x,i.rightLow.y),new b(i.rightUp.x,i.rightUp.y),i.id);t.push(n)}else if(r==="PcbPad"){let n=i.shapes.PadShapes.top,s=i.shapes.PadShapes.inner,o=i.shapes.PadShapes.bot;n!=null&&(n.PadShape.outline!=null&&(n.PadShape.outline=et(n.PadShape.outline)[0]),n=new pt(n.PadShape.type,n.PadShape.xSize,n.PadShape.ySize,n.PadShape.cornerRadius,n.PadShape.outline)),s!=null&&(s.PadShape.outline!=null&&(s.PadShape.outline=et(s.PadShape.outline)[0]),s=new pt(s.PadShape.type,s.PadShape.xSize,s.PadShape.ySize,s.PadShape.cornerRadius,s.PadShape.outline)),o!=null&&(o.PadShape.outline!=null&&(o.PadShape.outline=et(o.PadShape.outline)[0]),o=new pt(o.PadShape.type,o.PadShape.xSize,o.PadShape.ySize,o.PadShape.cornerRadius,o.PadShape.outline));let l=new Gr(i.hole.PadHole.type,i.hole.PadHole.size,i.hole.PadHole.length,i.hole.PadHole.rotation,i.hole.PadHole.offsetX,i.hole.PadHole.offsetY),u=null;i.padRule&&(u=new Rr(i.padRule.connectMode,i.padRule.lineWidth,i.padRule.lineClearance,i.padRule.lineAngle));let h=new Array;if(i.unuseLayers)for(let f of i.unuseLayers){let d=new I(Ee(f.type),f.order);h.push(d)}let c=new he(i.id,i.net,new I(Ee(i.layer.type),i.layer.order),new b(i.center.x,i.center.y),i.rotation,new Fr(new I(Ee(i.shapes.PadShapes.layer.type),i.shapes.PadShapes.layer.order),n,s,o),l,i.pasteMaskEx,i.topSolderMaskEx,i.bottomSolderMaskEx,i.designator,i.plated,i.flag,u,h);t.push(c)}else if(r==="PcbLine"){let n=Ne(i.outlines),s=new Le(i.net,new I(Ee(i.layer.type),i.layer.order),i.type,i.width,n,i.id);t.push(s)}else if(r==="PcbPolygonPour"){let n=i.method;n.HatchedPourMethod!=null&&(n=new At(n.HatchedPourMethod.gridWidth,n.HatchedPourMethod.gridClearance,n.HatchedPourMethod.angle)),n.SolidPourMethod!=null&&(n=new st(n.SolidPourMethod.neckThickness));let s=new Ve(i.id,i.net,new I(Ee(i.layer.type),i.layer.order),n,i.outlineClearance,i.clearance,i.thermal,i.keepIsland,i.pourIndex,i.needCopper,Ne(i.outlines).primitives,[],i.name);t.push(s)}else if(r==="PcbProhibit"){let n=new Qe(i.id,new I(Ee(i.layer.type),i.layer.order),i.type,i.copper,i.track,i.device,i.plane,i.region,Ne(i.outlines));t.push(n)}else if(r==="PcbRegion"){let n=new Ke(i.net,new I(Ee(i.layer.type),i.layer.order),i.type,i.outlines[0]instanceof Array?new ee(et(i.outlines)):Ne(i.outlines),i.id);t.push(n)}else if(r==="PcbTearDrop"){let n=Ne(i.outline),s=new mt(i.id,i.net,new I(Ee(i.layer.type),i.layer.order),n,i.connect);t.push(s)}else if(r==="PcbBoardOutline"){let n=new ve(i.id,i.type,Ne(i.outlines));t.push(n)}else if(r==="PcbSlot"){let n=new Ue(i.id,i.type,Ne(i.outlines));t.push(n)}else if(r==="PcbCopper"){let n=i.method;n.HatchedPourMethod!=null&&(n=new At(n.HatchedPourMethod.gridWidth,n.HatchedPourMethod.gridClearance,n.HatchedPourMethod.angle)),n.SolidPourMethod!=null&&(n=new st(n.SolidPourMethod.neckThickness));let s=new Ct(i.id,i.net,new I(Ee(i.layer.type),i.layer.order),n,et(i.outlines));t.push(s)}else if(r==="PlaneResult"){let n=new Tt(i.id,i.net,new I(Ee(i.layer.type),i.layer.order),et(i.outlines));t.push(n)}}}),t}function _d(a){return new ze(10)}var ws=class{constructor(t){this.layerRTreeMap=new Nt;this.box2d=new H;this.map={};this.shapes=Zc(t),this.addDocShapes2RTree()}getOutline(){let t=new Array;return this.shapes.forEach(e=>{e instanceof ve&&t.push(e)}),t}getShape(t){return this.map[t]}getDRCShapes(t,e){let r=this.getItems(t.layer,t.bbox().extendOfSize(e));if(t.layer.equals(I.MULTI)||this.getItems(I.MULTI,t.bbox().extendOfSize(e)).forEach(n=>{r.push(n)}),t.layer.equals(I.OUTLINE)||this.getItems(I.OUTLINE,t.bbox().extendOfSize(e)).forEach(n=>{r.push(n)}),t.layer.equals(I.MULTI)||t.layer.equals(I.OUTLINE)){let i=this.layerRTreeMap.keys();for(;i.hasNext();){let n=i.next();if(n.equals(I.MULTI)||n.equals(I.OUTLINE))continue;this.getItems(n,t.bbox().extendOfSize(e)).forEach(o=>{r.push(o)})}}return r}getNearShapes(t,e){let r=this.getItems(t.layer,t.bbox().extendOfSize(e));if(t.layer.equals(I.MULTI)||this.getItems(I.MULTI,t.bbox().extendOfSize(e)).forEach(n=>{r.push(n)}),t.layer.equals(I.OUTLINE)||this.getItems(I.OUTLINE,t.bbox().extendOfSize(e)).forEach(n=>{r.push(n)}),t.layer.equals(I.MULTI)||t.layer.equals(I.OUTLINE)){let i=this.layerRTreeMap.keys();for(;i.hasNext();){let n=i.next();if(n.equals(I.MULTI)||n.equals(I.OUTLINE))continue;this.getItems(n,t.bbox().extendOfSize(e)).forEach(o=>{r.push(o)})}}return r.filter(i=>i instanceof ue||i instanceof ce||i instanceof he||i instanceof ye||i instanceof De)}getTearViaAndPadShapes(t,e){let r=this.getItems(t.layer,t.bbox().extendOfSize(e));if(t.layer.equals(I.MULTI)||this.getItems(I.MULTI,t.bbox().extendOfSize(e)).forEach(n=>{r.push(n)}),t.layer.equals(I.OUTLINE)||this.getItems(I.OUTLINE,t.bbox().extendOfSize(e)).forEach(n=>{r.push(n)}),t.layer.equals(I.MULTI)||t.layer.equals(I.OUTLINE)){let i=this.layerRTreeMap.keys();for(;i.hasNext();){let n=i.next();if(n.equals(I.MULTI)||n.equals(I.OUTLINE))continue;this.getItems(n,t.bbox().extendOfSize(e)).forEach(o=>{r.push(o)})}}return r.filter(i=>i instanceof ue||i instanceof ce||i instanceof he)}getTearTrackShapes(t,e){let r=this.getItems(t.layer,t.bbox().extendOfSize(e));if(t.layer.equals(I.MULTI)||this.getItems(I.MULTI,t.bbox().extendOfSize(e)).forEach(n=>{r.push(n)}),t.layer.equals(I.OUTLINE)||this.getItems(I.OUTLINE,t.bbox().extendOfSize(e)).forEach(n=>{r.push(n)}),t.layer.equals(I.MULTI)||t.layer.equals(I.OUTLINE)){let i=this.layerRTreeMap.keys();for(;i.hasNext();){let n=i.next();if(n.equals(I.MULTI)||n.equals(I.OUTLINE))continue;this.getItems(n,t.bbox().extendOfSize(e)).forEach(o=>{r.push(o)})}}return r.filter(i=>i instanceof ye||i instanceof De)}getItems(t,e){let r=this.layerRTreeMap.get(t);return r!=null?r.search(e):new Array}addDocShapes2RTree(){for(let t of this.shapes){if(t instanceof ir)for(let e of t.shapes)this.addNode2RTree(e);else this.addShape2RTree(t);this.box2d.ext1(t.bbox())}}addShape2RTree(t){t instanceof Ve||this.addNode2RTree(t)}addNode2RTree(t){switch(this.map[t.id]=t,t.layer.type){case 4:case 7:case 5:case 6:case 0:case 11:this.layerRTreeMap.computeIfAbsent(t.layer,_d).add(t);break;default:break}}};var Ie=class{constructor(t,e,r){this.id1=t,this.id2=e,this.relation=r}getResult(){let t=this.relation.line,e=this.relation.pt1,r=this.relation.pt2;return{id1:this.id1,id2:this.id2,pl1:ls(this.relation.pl1),pl2:ls(this.relation.pl2),relation:this.relation.relation,distance:this.relation.distance,line:this.getPath(t),pt1:this.getPath(e),pt2:this.getPath(r)}}getPath(t){return t==null?[]:ls(B.build2([t]))}};var q=class{constructor(t,e,r,i=!0){this.pl1=t,this.pl2=e,this.clearance=r;let{relation:n,distance:s,line:o,pt1:l,pt2:u}=this.getRelation();this.relation=n,this.distance=s,this.line=o,this.pt1=l,this.pt2=u,this.setDistZeroWhenContain=i}getRelation(){let t=3,e=Number.MAX_VALUE,r=null,i=null,n=null;for(let s of this.pl1.primitives){for(let o of this.pl2.primitives){if(s instanceof S&&N.eq(s.start().distance2(s.end()),0)||o instanceof S&&N.eq(o.start().distance2(o.end()),0))continue;let l=new fi(s,o),u=l.getDistance(),h=l.getLine();if(N.less(u,e)&&(e=u,r=h,i=s,n=o),N.eq(e,0)){t=0;break}}if(N.eq(e,0)){t=0;break}}return t!=0&&(i!=null&&this.isClose(this.pl2)&&this.pointInPolyline(i.start(),this.pl2)?(t=2,this.setDistZeroWhenContain&&(e=0)):n!=null&&this.isClose(this.pl1)&&this.pointInPolyline(n.start(),this.pl1)&&(t=1,this.setDistZeroWhenContain&&(e=0))),{relation:t,distance:e,line:r,pt1:i,pt2:n}}pointInPolyline(t,e){if(!e.bbox().isContains(t))return!1;let i=[];return e.points(.1,n=>{i.push(n)}),this.isSelect(t.x,t.y,i)}isSelect(t,e,r){let i=!1;for(let o=0,l=r.length-1;o<l;o++){let u=r[o],h=r[o+1];if(t==u.x&&e==u.y||t==h.x&&e==h.y)return!0;if(u.y<e&&h.y>=e||u.y>=e&&h.y<e){let c=u.x+(e-u.y)*(h.x-u.x)/(h.y-u.y);if(t==c)return!0;c>t&&(i=!i)}}let n=r[r.length-1],s=r[0];if(t==n.x&&e==n.y||t==s.x&&e==s.y)return!0;if(n.y<e&&s.y>=e||n.y>=e&&s.y<e){let o=n.x+(e-n.y)*(s.x-n.x)/(s.y-n.y);if(t==o)return!0;o>t&&(i=!i)}return i}isClose(t){return t.primitives.length>0&&t.primitives[0].start().distance2(t.primitives[t.primitives.length-1].end())<1e-8}};var ln=class{constructor(t,e=!1){this.check=new an;this.maxClearance=t,this.checkSameNet=e}isSameNet(t,e){return this.checkSameNet?!1:this.hasNet(t)&&this.hasNet(e)?t.net==e.net:!1}hasNet(t){return t instanceof ye||t instanceof De||t instanceof he||t instanceof ue||t instanceof ce||t instanceof Ke||t instanceof mt||t instanceof Le||t instanceof Ct||t instanceof Tt}isSingleLayerShape(t){return t instanceof ye||t instanceof De||t instanceof he&&!t.layer.equals(I.MULTI)||t instanceof ft||t instanceof Ke||t instanceof mt||t instanceof Le||t instanceof Ct||t instanceof Tt}getPcbLineOutline(t){if(t.type==0){let r=t.shape(t.layer,0).primitives[0],i=R.build2(r.center,0,180,r.rx,r.ry,1),n=R.build2(r.center,180,360,r.rx,r.ry,1);return B.build2([i,n])}else return t.shape(t.layer,0)}getPcbBoardOutlineOutline(t){if(t.type==0){let r=t.shape(I.OUTLINE,0).primitives[0],i=R.build2(r.center,0,180,r.rx,r.ry,1),n=R.build2(r.center,180,360,r.rx,r.ry,1);return B.build2([i,n])}else return t.shape(I.OUTLINE,0)}getPolylineGroupRelation(t,e){let r=new Array;for(let i of t.items){let n=new q(i,e,this.maxClearance);r.push(n)}return ie(r,(i,n)=>i.distance-n.distance,0,r.length),r[0]}pointInPlGrps(t,e){return t.inPolygons(e)}checkCopper(t,e){let r=this.getCopperRaltion(t.rtree,e);if(r!=null&&r.relation==0)return r;let i=e.primitives[0].start();if(this.pointInPlGrps(t,i))return new q(e,e,this.maxClearance);{let o=t.shape(t.layer,0).items[0].primitives[0].start();return new an().pointInPolyline(o,e.closeEndpoint())?new q(e,e,this.maxClearance):r}}checkOutlineCopper(t,e){let r=this.getCopperRaltion(t.rtree,e);if(r!=null&&r.relation==0)return r;let i=e.primitives[0].start();return this.pointInPlGrps(t,i)?new q(e,e,this.maxClearance):r}checkCoppers(t,e){let r=t.shape(t.layer,0),i=e.shape(e.layer,0),n=new Array;for(let h of i.items){let c=this.getCopperRaltion(t.rtree,h);if(c!=null&&n.push(c),c!=null&&c.relation==0)return c}let s=r.items[0].primitives[0].start(),o=i.items[0].primitives[0].start();return this.pointInPlGrps(e,s)?new q(i.items[0],i.items[0],this.maxClearance):this.pointInPlGrps(t,o)?new q(r.items[0],r.items[0],this.maxClearance):(ie(n,(h,c)=>h.distance-c.distance,0,n.length),n[0])}getCopperRaltion(t,e){let r=new Array;for(let i of e.primitives){let n=t.search(i.bbox().extendOfSize(this.maxClearance+.1));for(let s of n){if(s instanceof S&&s.start().distance2(s.end())<1e-8)continue;let o=new q(B.build2([s]),B.build2([i]),this.maxClearance);r.push(o)}}if(r.length==0){let i=t.items()[0],n=e.primitives[0],s=new q(B.build2([i]),B.build2([n]),this.maxClearance);r.push(s)}return ie(r,(i,n)=>i.distance-n.distance,0,r.length),r[0]}};var El=class extends ln{constructor(){super(...arguments);this.result=new Array}checkShapeRelation(e,r,i=!1){if(!(!i&&this.isSameNet(e,r))&&!this.checkProhibit(e,r))if(r instanceof ve)this.outlineCheck(e,r);else if(r instanceof Ct){let n=this.checkCoppers(e,r);n!=null&&this.result.push(new Ie(e.id,r.id,n))}else if(this.isSingleLayerShape(r)){if(!e.layer.equals(r.layer))return;let n=e.layer,s=r.shape(n,0);if(r instanceof Le){s=this.getPcbLineOutline(r);let o=new Array;for(let l of s.primitives){let u=l.stroke(r.width,1,0).asClose();o.push(u)}s=new ee(o)}if(s instanceof B){let o=this.checkCopper(e,s.asClose());o!=null&&this.result.push(new Ie(e.id,r.id,o))}else if(s instanceof ee){let o=new Array;for(let u of s.items){let h=this.checkCopper(e,u);h!=null&&o.push(h)}ie(o,(u,h)=>u.distance-h.distance,0,o.length);let l=o[0];l!=null&&this.result.push(new Ie(e.id,r.id,l))}}else{if(r instanceof ce&&!r.isContains(e.layer))return;let n=e.layer,s=r.shape(n,0),o=this.checkCopper(e,s);if(r instanceof he||r instanceof ue||r instanceof ce){let l=r.shape(I.MULTI,0),u=this.checkCopper(e,l);(o==null||u!=null&&o.distance>u.distance)&&(o=u)}o!=null&&this.result.push(new Ie(e.id,r.id,o))}}outlineCheck(e,r){let i=this.getPcbBoardOutlineOutline(r),n=this.checkOutlineCopper(e,i);n!=null&&this.result.push(new Ie(e.id,r.id,n))}checkProhibit(e,r){if(r instanceof Qe){if(r.copper&&(e.layer.equals(r.layer)||r.layer.equals(I.MULTI))){let i=r.shape(r.layer,0),n=this.checkCopper(e,i.asClose());this.result.push(new Ie(e.id,r.id,n))}return!0}return!1}};var Bl=class extends ln{constructor(){super(...arguments);this.result=new Array}checkShapeRelation(e,r,i=!1){if(!(!i&&this.isSameNet(e,r))&&!this.checkProhibit(e,r))if(r instanceof ve)this.outlineCheck(e,r);else if(r instanceof Tt){let n=this.checkCoppers(e,r);n!=null&&this.result.push(new Ie(e.id,r.id,n))}else if(this.isSingleLayerShape(r)){if(!e.layer.equals(r.layer)||r instanceof Le)return;let n=e.layer,s=r.shape(n,0);if(s instanceof B){let o=this.checkCopper(e,s);o!=null&&this.result.push(new Ie(e.id,r.id,o))}else if(s instanceof ee){let o=new Array;for(let u of s.items){let h=this.checkCopper(e,u);h!=null&&o.push(h)}ie(o,(u,h)=>u.distance-h.distance,0,o.length);let l=o[0];l!=null&&this.result.push(new Ie(e.id,r.id,l))}}else{if(r instanceof ce&&!r.isContains(e.layer))return;let n=e.layer,s=r.shape(n,0),o=this.checkCopper(e,s);if(r instanceof he||r instanceof ue||r instanceof ce){let l=r.shape(I.MULTI,0),u=this.checkCopper(e,l);(o==null||u!=null&&o.distance>u.distance)&&(o=u)}o!=null&&this.result.push(new Ie(e.id,r.id,o))}}outlineCheck(e,r){let i=this.getPcbBoardOutlineOutline(r),n=this.checkOutlineCopper(e,i);n!=null&&this.result.push(new Ie(e.id,r.id,n))}checkProhibit(e,r){if(r instanceof Qe){if(r.plane&&(e.layer.equals(r.layer)||r.layer.equals(I.MULTI))){let i=r.shape(r.layer,0),n=this.checkCopper(e,i.asClose());this.result.push(new Ie(e.id,r.id,n))}return!0}return!1}};var Sr=class{constructor(t,e,r){this.pl1=t,this.pl2=e,this.clearance=r;let{relation:i,distance:n,line:s,pt1:o,pt2:l}=this.getRelation();this.relation=i,this.distance=n,this.line=s,this.pt1=o,this.pt2=l}getRelation(){let t=this.pl1 instanceof ee?this.pl1.getOutMostPolyline():this.pl1,e=this.pl2 instanceof ee?this.pl2.getOutMostPolyline():this.pl2,r=new q(t,e,this.clearance,!1);if(r.relation==3||r.relation==0){let{relation:c,distance:f,line:d,pt1:p,pt2:m}=r;return{relation:c,distance:f,line:d,pt1:p,pt2:m}}let i=this.pl1 instanceof ee?this.pl1.items:[this.pl1],n=this.pl2 instanceof ee?this.pl2.items:[this.pl2],s=r;for(let c of i)for(let f of n){let d=new q(c,f,this.clearance,!1);if(d.distance<s.distance&&(s=d),d.relation==0){let{relation:p,distance:m,line:g,pt1:x,pt2:y}=d;return{relation:p,distance:m,line:g,pt1:x,pt2:y}}}if(r.relation==1&&wt.inPolygon(n[0].start(),i)||r.relation==1&&wt.inPolygon(i[0].start(),n)){let{relation:c,distance:f,line:d,pt1:p,pt2:m}=r;return{relation:c,distance:f,line:d,pt1:p,pt2:m}}let{distance:o,line:l,pt1:u,pt2:h}=r;return{relation:3,distance:o,line:l,pt1:u,pt2:h}}};var _l=class extends ln{constructor(){super(...arguments);this.result=new Array}checkShapeRelation(e,r){this.isSameNet(e,r)||this.checkProhibit(e,r)||(e instanceof ve?this.outlineCheck(e,r):r instanceof ve?this.outlineCheck(r,e):this.isSingleLayerShape(e)&&this.isSingleLayerShape(r)?this.singleShapeCheck(e,r):!this.isSingleLayerShape(e)&&!this.isSingleLayerShape(r)?this.multiShapeCheck(e,r):this.isSingleLayerShape(e)?this.singleMultiShapeCheck(e,r):this.singleMultiShapeCheck(r,e))}singleShapeCheck(e,r){if(!e.layer.equals(r.layer))return;let i=e.layer;if(e instanceof Le&&r instanceof Le){if(i.type==6)return;let n=e.shape(i,0),s=r.shape(i,0),o=new Array,l=new Array;for(let h of n.primitives){let c=h.stroke(e.width,1,0).asClose();o.push(c)}for(let h of s.primitives){let c=h.stroke(r.width,1,0).asClose();l.push(c)}let u=new Array;for(let h of o)for(let c of l){let f=new q(h,c,this.maxClearance);u.push(f)}ie(u,(h,c)=>h.distance-c.distance,0,u.length),u.length>0&&this.result.push(new Ie(e.id,r.id,u[0]))}else if(e instanceof Le&&!(r instanceof Le)){if(i.type==6)return;let n=e.shape(i,0),s=r.shape(i,0).asClose(),o=new Array;for(let u of n.primitives){let h=u.stroke(e.width,1,0).asClose();o.push(h)}let l=new Array;for(let u of o){let h=new q(u,s,this.maxClearance);l.push(h)}ie(l,(u,h)=>u.distance-h.distance,0,l.length),l.length>0&&this.result.push(new Ie(e.id,r.id,l[0]))}else if(!(e instanceof Le)&&r instanceof Le){if(i.type==6)return;let n=e.shape(i,0).asClose(),s=r.shape(i,0),o=new Array;for(let u of s.primitives){let h=u.stroke(r.width,1,0).asClose();o.push(h)}let l=new Array;for(let u of o){let h=new q(n,u,this.maxClearance);l.push(h)}ie(l,(u,h)=>u.distance-h.distance,0,l.length),l.length>0&&this.result.push(new Ie(e.id,r.id,l[0]))}else{let n=e.shape(i,0).asClose(),s=r.shape(i,0).asClose(),o=new q(n,s,this.maxClearance);this.result.push(new Ie(e.id,r.id,o))}}singleMultiShapeCheck(e,r){if(r instanceof ce&&!r.isContains(e.layer))return;let i=e.layer;if(e instanceof Le){if(i.type==6)return;let n=e.shape(i,0),s=r.shape(i,0).asClose(),o=new Array,l=new Array;for(let h of n.primitives){let c=h.stroke(e.width,1,0).asClose();o.push(c)}if(l.push(s),r instanceof he||r instanceof ue||r instanceof ce){let h=r.shape(I.MULTI,0).asClose();l.push(h)}let u=new Array;for(let h of o)for(let c of l){let f=new q(h,c,this.maxClearance);u.push(f)}ie(u,(h,c)=>h.distance-c.distance,0,u.length),u.length>0&&this.result.push(new Ie(e.id,r.id,u[0]))}else{let n=e.shape(i,0).asClose(),s=r.shape(i,0).asClose(),o=new q(n,s,this.maxClearance);if(r instanceof he||r instanceof ue||r instanceof ce){let l=r.shape(I.MULTI,0).asClose(),u=new q(n,l,this.maxClearance);o.distance>u.distance&&(o=u)}this.result.push(new Ie(e.id,r.id,o))}}multiShapeCheck(e,r){e instanceof he?this.dispatchPad(e,r):e instanceof ce?this.dispatchBlind(e,r):e instanceof ue?this.dispatchVia(e,r):this.dispatchMulti(e,r)}checkProhibit(e,r){if(e instanceof Qe){if((e.track&&(r instanceof ye||r instanceof De)||e.region&&r instanceof Ke)&&(e.layer.equals(r.layer)||e.layer.equals(I.MULTI))){let i=e.shape(e.layer,0),n=r.shape(r.layer,0),s=new Sr(i,n,this.maxClearance);this.result.push(new Ie(e.id,r.id,s))}return!0}else if(r instanceof Qe){if((r.track&&(e instanceof ye||e instanceof De)||r.region&&e instanceof Ke)&&(e.layer.equals(r.layer)||r.layer.equals(I.MULTI))){let i=e.shape(e.layer,0),n=r.shape(r.layer,0),s=new Sr(i,n,this.maxClearance);this.result.push(new Ie(e.id,r.id,s))}return!0}return!1}dispatchPad(e,r){r instanceof he?this.checkPadPad(e,r):r instanceof ce?this.checkPadBlindVia(e,r):r instanceof ue?this.checkPadVia(e,r):this.checkPadMulti(e,r)}dispatchBlind(e,r){r instanceof he?this.checkPadBlindVia(r,e):r instanceof ce?this.checkBlindBlind(e,r):r instanceof ue?this.checkViaBlindVia(r,e):this.checkBlindMulti(e,r)}dispatchVia(e,r){r instanceof he?this.checkPadVia(r,e):r instanceof ce?this.checkViaBlindVia(e,r):r instanceof ue?this.checkViaVia(e,r):this.checkViaMulti(e,r)}dispatchMulti(e,r){r instanceof he?this.checkPadMulti(r,e):r instanceof ce?this.checkBlindMulti(r,e):r instanceof ue?this.checkViaMulti(r,e):this.checkMultiMulti(e,r)}checkPadPad(e,r){let i=I.TOP_COPPER,n=I.BOT_COPPER,s=new I(5,1),o=I.MULTI,l=e.shape(i,0).asClose(),u=e.shape(n,0).asClose(),h=e.shape(s,0).asClose(),c=e.shape(o,0).asClose(),f=r.shape(i,0).asClose(),d=r.shape(n,0).asClose(),p=r.shape(s,0).asClose(),m=r.shape(o,0).asClose(),g=new q(l,f,this.maxClearance),x=new q(u,d,this.maxClearance),y=new q(h,p,this.maxClearance),P=new q(c,m,this.maxClearance),L=new q(l,m,this.maxClearance),w=new q(u,m,this.maxClearance),C=new q(h,m,this.maxClearance),T=new q(c,f,this.maxClearance),M=new q(c,d,this.maxClearance),E=new q(c,p,this.maxClearance),W=[g,x,y,P,L,w,C,T,M,E];ie(W,(k,O)=>k.distance-O.distance,0,W.length),this.result.push(new Ie(e.id,r.id,W[0]))}checkPadVia(e,r){let i=I.TOP_COPPER,n=I.BOT_COPPER,s=new I(5,1),o=I.MULTI,l=e.shape(i,0),u=e.shape(n,0),h=e.shape(s,0),c=e.shape(o,0),f=r.shape(i,0),d=r.shape(o,0),p=new q(l,f,this.maxClearance),m=new q(u,f,this.maxClearance),g=new q(h,f,this.maxClearance),x=new q(c,f,this.maxClearance),y=new q(l,d,this.maxClearance),P=new q(u,d,this.maxClearance),L=new q(h,d,this.maxClearance),w=new q(c,d,this.maxClearance),C=[p,m,g,x,y,P,L,w];ie(C,(T,M)=>T.distance-M.distance,0,C.length),this.result.push(new Ie(e.id,r.id,C[0]))}checkPadBlindVia(e,r){let i=I.TOP_COPPER,n=I.BOT_COPPER,s=new I(5,1),o=I.MULTI,l=e.shape(i,0).asClose(),u=e.shape(n,0).asClose(),h=e.shape(s,0).asClose(),c=e.shape(o,0).asClose(),f=r.shape(o,0).asClose(),d=[];if(r.isContains(i)){let p=r.shape(i,0).asClose(),m=new q(l,p,this.maxClearance),g=new q(l,f,this.maxClearance),x=new q(c,p,this.maxClearance);d.push(m),d.push(g),d.push(x)}if(r.isContains(n)){let p=r.shape(n,0).asClose(),m=new q(u,p,this.maxClearance),g=new q(u,f,this.maxClearance),x=new q(c,p,this.maxClearance);d.push(m),d.push(g),d.push(x)}if(r.startLayer.type==5){let p=r.shape(r.startLayer,0).asClose(),m=new q(h,p,this.maxClearance),g=new q(h,f,this.maxClearance),x=new q(c,p,this.maxClearance);d.push(m),d.push(g),d.push(x)}else if(r.endLayer.type==5){let p=r.shape(r.endLayer,0).asClose(),m=new q(h,p,this.maxClearance),g=new q(h,f,this.maxClearance),x=new q(c,p,this.maxClearance);d.push(m),d.push(g),d.push(x)}ie(d,(p,m)=>p.distance-m.distance,0,d.length),this.result.push(new Ie(e.id,r.id,d[0]))}checkPadMulti(e,r){let i=I.TOP_COPPER,n=I.BOT_COPPER,s=new I(5,1),o=I.MULTI,l=e.shape(i,0).asClose(),u=e.shape(n,0).asClose(),h=e.shape(s,0).asClose(),c=e.shape(o,0).asClose(),f=r.shape(i,0).asClose(),d=new q(l,f,this.maxClearance),p=new q(u,f,this.maxClearance),m=new q(h,f,this.maxClearance),g=new q(c,f,this.maxClearance),x=[d,p,m,g];ie(x,(y,P)=>y.distance-P.distance,0,x.length),this.result.push(new Ie(e.id,r.id,x[0]))}checkViaVia(e,r){let i=I.TOP_COPPER,n=I.MULTI,s=e.shape(i,0).asClose(),o=e.shape(n,0).asClose(),l=r.shape(i,0).asClose(),u=r.shape(n,0).asClose(),h=new q(s,l,this.maxClearance),c=new q(o,u,this.maxClearance),f=new q(o,l,this.maxClearance),d=new q(s,u,this.maxClearance),p=[h,f,d,c];ie(p,(m,g)=>m.distance-g.distance,0,p.length),this.result.push(new Ie(e.id,r.id,p[0]))}checkViaBlindVia(e,r){let i=I.TOP_COPPER,n=r.startLayer,s=I.MULTI,o=e.shape(i,0).asClose(),l=e.shape(s,0).asClose(),u=r.shape(n,0).asClose(),h=r.shape(s,0).asClose(),c=new q(o,u,this.maxClearance),f=new q(l,h,this.maxClearance),d=new q(l,u,this.maxClearance),p=new q(o,h,this.maxClearance),m=[c,d,p,f];ie(m,(g,x)=>g.distance-x.distance,0,m.length),this.result.push(new Ie(e.id,r.id,m[0]))}checkViaMulti(e,r){let i=I.TOP_COPPER,n=I.MULTI,s=e.shape(i,0).asClose(),o=e.shape(n,0).asClose(),l=r.shape(i,0).asClose(),u=new q(s,l,this.maxClearance),h=new q(o,l,this.maxClearance),c=[u,h];ie(c,(f,d)=>f.distance-d.distance,0,c.length),this.result.push(new Ie(e.id,r.id,c[0]))}checkBlindBlind(e,r){let i=e.startLayer,n=e.endLayer,s=r.startLayer,o=r.endLayer,l=I.MULTI,u=e.shape(l,0).asClose(),h=r.shape(l,0).asClose(),c=new Array;if(r.isContains(i)){let f=e.shape(i,0).asClose(),d=r.shape(i,0).asClose(),p=new q(f,d,this.maxClearance);c.push(p);let m=new q(u,h,this.maxClearance);c.push(m)}else if(r.isContains(n)){let f=e.shape(n,0).asClose(),d=r.shape(n,0).asClose(),p=new q(f,d,this.maxClearance);c.push(p);let m=new q(u,h,this.maxClearance);c.push(m)}else if(e.isContains(s)){let f=e.shape(s,0).asClose(),d=r.shape(s,0).asClose(),p=new q(f,d,this.maxClearance);c.push(p);let m=new q(u,h,this.maxClearance);c.push(m)}else if(e.isContains(o)){let f=e.shape(o,0).asClose(),d=r.shape(o,0).asClose(),p=new q(f,d,this.maxClearance);c.push(p);let m=new q(u,h,this.maxClearance);c.push(m)}c.length>0&&(ie(c,(f,d)=>f.distance-d.distance,0,c.length),this.result.push(new Ie(e.id,r.id,c[0])))}checkBlindMulti(e,r){let i=e.startLayer,n=I.MULTI,s=e.shape(i,0).asClose(),o=e.shape(n,0).asClose(),l=r.shape(i,0).asClose(),u=new q(s,l,this.maxClearance),h=new q(o,l,this.maxClearance),c=[u,h];ie(c,(f,d)=>f.distance-d.distance,0,c.length),this.result.push(new Ie(e.id,r.id,c[0]))}checkMultiMulti(e,r){let i=e.layer,n=e.shape(i,0).asClose(),s=r.shape(i,0).asClose(),o=new q(n,s,this.maxClearance);this.result.push(new Ie(e.id,r.id,o))}outlineCheck(e,r){this.isSingleLayerShape(r)?this.outlineSingleShapeCheck(r,e):this.outlineMultiShapeCheck(e,r)}outlineSingleShapeCheck(e,r){let i=e.layer,n=this.getPcbBoardOutlineOutline(r),s=new Array;for(let l of n.primitives)s.push(B.build2([l]));let o=new Array;if(e instanceof Le){if(i.type==6)return;let l=e.shape(i,0),u=new Array;for(let h of l.primitives){let c=h.stroke(e.width,1,0).asClose();u.push(c)}for(let h of u)for(let c of s){let f=new q(h,c,this.maxClearance);o.push(f)}ie(o,(h,c)=>h.distance-c.distance,0,o.length),o.length>0&&this.result.push(new Ie(e.id,r.id,o[0]))}else{let l=e.shape(i,0).asClose();for(let u of s){let h=new q(l,u,this.maxClearance);o.push(h)}ie(o,(u,h)=>u.distance-h.distance,0,o.length),o.length>0&&this.result.push(new Ie(e.id,r.id,o[0]))}}outlineMultiShapeCheck(e,r){r instanceof he?this.outlinePadCheck(e,r):r instanceof ce?this.outlineBlindCheck(e,r):r instanceof ue?this.outlineViaCheck(e,r):r instanceof Ue&&this.outlineSlotCheck(e,r)}outlinePadCheck(e,r){let i=I.TOP_COPPER,n=I.BOT_COPPER,s=new I(5,1),o=I.MULTI,l=r.shape(i,0).asClose(),u=r.shape(n,0).asClose(),h=r.shape(s,0).asClose(),c=r.shape(o,0).asClose(),f=this.getPcbBoardOutlineOutline(e),d=[];for(let p of f.primitives){let m=B.build2([p]),g=new q(l,m,this.maxClearance),x=new q(u,m,this.maxClearance),y=new q(h,m,this.maxClearance),P=new q(c,m,this.maxClearance);d.push(g),d.push(x),d.push(y),d.push(P)}ie(d,(p,m)=>p.distance-m.distance,0,d.length),this.result.push(new Ie(e.id,r.id,d[0]))}outlineBlindCheck(e,r){let i=r.startLayer,n=I.MULTI,s=r.shape(i,0).asClose(),o=r.shape(n,0).asClose(),l=this.getPcbBoardOutlineOutline(e),u=[];for(let h of l.primitives){let c=B.build2([h]),f=new q(s,c,this.maxClearance),d=new q(o,c,this.maxClearance);u.push(f),u.push(d)}ie(u,(h,c)=>h.distance-c.distance,0,u.length),this.result.push(new Ie(e.id,r.id,u[0]))}outlineViaCheck(e,r){let i=I.TOP_COPPER,n=I.MULTI,s=r.shape(i,0).asClose(),o=r.shape(n,0).asClose(),l=this.getPcbBoardOutlineOutline(e),u=[];for(let h of l.primitives){let c=B.build2([h]),f=new q(s,c,this.maxClearance),d=new q(o,c,this.maxClearance);u.push(f),u.push(d)}ie(u,(h,c)=>h.distance-c.distance,0,u.length),this.result.push(new Ie(e.id,r.id,u[0]))}outlineSlotCheck(e,r){let i=e.layer,n=r.shape(i,0).asClose(),s=this.getPcbBoardOutlineOutline(e),o=[];for(let l of s.primitives){let u=B.build2([l]),h=new q(n,u,this.maxClearance);o.push(h)}ie(o,(l,u)=>l.distance-u.distance,0,o.length),this.result.push(new Ie(e.id,r.id,o[0]))}};var Ol=class{constructor(t){this.config=null;this.config=t}isCheckDistance(t,e){let r=this.config;if(!r)return!0;let i=[this.matchBaseDistanceConfig(t,e)];return i.push(r.distanceSameComponentItem.distanceSameComponentItem),this.isTrack(t)&&this.isTrack(e)&&i.push(r.diff.minGap),i=i.filter(n=>n),i.length?i.some(n=>n.enforce):!0}matchBaseDistanceConfig(t,e,r=!0){let i=null,n=this.config;if(t instanceof Qe)return n.prohibitRegionRule.overlapWithOtherObject;let s=null;return this.isTrack(t)?s=n.distanceTrack:t instanceof he?s=n.distancePad:t instanceof ce||t instanceof ue?s=n.distanceVia:t instanceof Ke||t instanceof mt?s=n.distanceFillRegion:t instanceof Ue?s=n.distanceSlot:t instanceof Le?s=n.distanceLine:t instanceof ft?s=n.distanceTextImage:t instanceof Ct?s=n.distanceCopper:t instanceof Tt&&(s=n.distancePlaneZone),s&&(this.isTrack(e)?i=s["track"]:e instanceof he?i=s["pad"]:e instanceof ce||e instanceof ue?i=s["via"]:e instanceof Ke?i=s["fillRegion"]:e instanceof mt?i=s["fillRegion"]:e instanceof Ue?i=s["slot"]:e instanceof Le?i=s["line"]:e instanceof ft?i=s["textAndImage"]:e instanceof ve&&(i=s["outline"])),!i&&r?this.matchBaseDistanceConfig(e,t,!1):i}isTrack(t){return t instanceof ye||t instanceof De}};var Ls=class{constructor(t,e,r=!1,i=null){this.checkMap={};this.ratio=0;this.delta=0;this.maxClearance=t,this.drcMap=e,this.checkSameNet=r,this.ruleCustomCheck=new Ol(i),this.copperCheck=new El(this.maxClearance),this.planeCheck=new Bl(this.maxClearance),this.safeCheck=new _l(this.maxClearance,this.checkSameNet)}updateProgress(t){self.workerBus!=null&&(this.ratio+=this.delta,self.workerBus.publish("progressUpdate",{ratio:t||this.ratio,descripte:"Design rule check"}))}getResult(){let t={},e=new Array;for(let n of this.copperCheck.result)e.push(n.getResult());t.copper=e;let r=new Array;for(let n of this.planeCheck.result)r.push(n.getResult());t.plane=r;let i=new Array;for(let n of this.safeCheck.result)i.push(n.getResult());return t.safe=i,t}check(t,e=!1){this.delta=1/[...t].length,this.checkMap={};for(let r of t)r instanceof Ct?this.checkCopperClearance(r,e):r instanceof Tt?this.checkInnerClearance(r,e):this.checkSafeClearance(r,e),this.updateProgress();this.updateProgress(1)}checkCopperClearance(t,e=!1){let r=this.drcMap.getDRCShapes(t,this.maxClearance);for(let i of r){if(i==t)continue;let n=this.getCheckedResult(t.id,i.id);n==null&&this.isCheck(t,i)&&(this.copperCheck.checkShapeRelation(t,i,e),n=!0,this.addCheckMap(t.id,i.id,n))}}checkInnerClearance(t,e=!1){let r=this.drcMap.getDRCShapes(t,this.maxClearance);for(let i of r){if(i==t)continue;let n=this.getCheckedResult(t.id,i.id);n==null&&this.isCheck(t,i)&&(this.planeCheck.checkShapeRelation(t,i,e),n=!0,this.addCheckMap(t.id,i.id,n))}}checkSafeClearance(t,e=!1){let r=this.drcMap.getDRCShapes(t,this.maxClearance);for(let i of r){if(i==t)continue;let n=this.getCheckedResult(t.id,i.id);n==null&&this.isCheck(t,i)&&(i instanceof Ct?(this.copperCheck.checkShapeRelation(i,t,e),n=!0,this.addCheckMap(t.id,i.id,n)):i instanceof Tt?(this.planeCheck.checkShapeRelation(i,t,e),n=!0,this.addCheckMap(t.id,i.id,n)):(this.safeCheck.checkShapeRelation(t,i),n=!0,this.addCheckMap(t.id,i.id,n)))}}getCheckedResult(t,e){let r=null;return this.checkMap[t]!=null&&(r=this.checkMap[t][e]),r==null&&this.checkMap[e]!=null&&(r=this.checkMap[e][t]),r}addCheckMap(t,e,r){this.checkMap[t]==null&&(this.checkMap[t]={}),this.checkMap[t][e]=r}isCheck(t,e){return!!this.ruleCustomCheck.isCheckDistance(t,e)}};var Dd=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],bt=class extends He{static translate(t,e,r){return new bt([1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1])}static translate1(t){return new bt([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1])}static rotateX(t){let e=Math.cos(t),r=Math.sin(t);return new bt([1,0,0,0,0,e,r,0,0,-r,e,0,0,0,0,1])}static rotateY(t){let e=Math.cos(t),r=Math.sin(t);return new bt([e,0,-r,0,0,1,0,0,r,0,e,0,0,0,0,1])}static rotateZ(t){let e=Math.cos(t),r=Math.sin(t);return new bt([e,r,0,0,-r,e,0,0,0,0,1,0,0,0,0,1])}static scale(t,e=t,r=t){return new bt([t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1])}static flipX(){return new bt([1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])}static flipY(){return new bt([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static rotateZForPoint(t,e){return t.equals1(b.ORIGIN)?bt.rotateZ(e):bt.translate(-t.x,-t.y,0).rotateZ(e).translate1(t.x,t.y,0)}static getMatrix4(t,e,r,i){let n=Math.cos(e),s=Math.sin(e),o=r*(t.x*n-t.y*s)+i.x,l=t.x*s+t.y*n+i.y,u=[r*n,s,0,0,-s*r,n,0,0,0,0,1,0,o,l,0,1];return new bt(u)}constructor(t=Dd){super(4,4,t)}translate(t){return this.multiply4(bt.translate1(t))}translate1(t,e,r){return this.multiply4(bt.translate(t,e,r))}rotateX(t){return this.multiply4(bt.rotateX(t))}rotateY(t){return this.multiply4(bt.rotateY(t))}rotateZ(t){return this.multiply4(bt.rotateZ(t))}scale(t,e=t,r=t){return this.multiply4(bt.scale(t,e,r))}scale1(t){return this.multiply4(bt.scale(t.x,t.y,t.z))}setOrigin(t,e,r){return bt.translate(-t,-e,-r).multiply4(this).translate1(t,e,r)}setOrigin1(t){return this.setOrigin(t.x,t.y,t.z)}multiply4(t){let e=new Array(16);return He.mul(4,4,4,this.data,t.data,e),new bt(e)}inverse(){let t=this.getInverseMatrix();return new bt(t.data)}toMatrix3(){let t=this.data;return new me([t[0],t[1],0,t[4],t[5],0,t[12],t[13],1])}},X=bt;X.ORIGIN=new bt;var Ms=class{constructor(t=3){this.state=3;this.state=t}getValue(t){return(this.state>>t&1)==1}setValue(t,e){let r=1<<t;e?this.state=this.state|r:this.state=this.state&(15^r)}};var Dl=class extends Ms{constructor(t=6){super(t)}get bboxChange(){return this.getValue(0)}set bboxChange(t){this.setValue(0,t)}get needUpdateTree(){return this.getValue(1)}set needUpdateTree(t){this.setValue(1,t)}};var As=class{constructor(){this.map={}}static getInstance(){return As.manager==null&&(As.manager=new As),As.manager}getContext(t){let e=this.map[t];return e==null&&(e=new Dl,this.map[t]=e),e}delete(t){delete this.map[t]}},Is=As;Is.manager=null;var un=class{constructor(){this.change=!1;this.parent=null;this.groupID=null}get globalIndex(){return this._globalIndex}set globalIndex(t){this._globalIndex=t}get context(){return Is.getInstance().getContext(this.globalIndex)}setParent(t){this.parent=t}getParent(){return this.parent}setGroupID(t){this.groupID=t}getGroupID(){return this.groupID}rotateFor(t,e){let r=X.rotateZForPoint(t,e);this.transform(r)}remove(){Is.getInstance().delete(this._globalIndex)}update4Childs(){}};var kl=class{constructor(t,e,r,i){this.alignment=r,this.size=i,this.alignmentLength=r*8,this.index=t,this.data=e}getNEmpty(t=1){let e=this.index.findNEmpty(t),r=new Array(t),i=0;for(let n of e){this.index.markUsed(n);let s=this.data.byteOffset+n*this.alignmentLength,o=new Float64Array(this.data.buffer,s,this.alignment);r[i]=o,i++}return r}remove(t){if(this.data.buffer===t.buffer&&this.data.byteOffset<=t.byteOffset&&this.data.byteOffset+this.alignmentLength*this.size>t.byteOffset+this.alignmentLength){let e=(t.byteOffset-this.data.byteOffset)/this.alignmentLength;this.index.markRemove(e)}}isEmpty(){return this.index.isEmpty()}hasNEmpty(t=1){return this.index.hasNEmpty(t)}drop(){this.data=null,this.index.remove()}};var uz=4294967295,hz=0;function kd(a){let t=a.toString(2),e=32-t.length;return e>0?"0".repeat(e)+t:t}var di=class{constructor(t){this.flags=new Int32Array(t.buffer,t.byteOffset,4),this.index=new Uint32Array(t.buffer,t.byteOffset+16,t.length-4)}get size(){return this.flags[0]}get marked(){return this.flags[1]}get emptyStart(){return this.flags[2]}get max(){return this.flags[3]}set marked(t){this.flags[1]=t}set emptyStart(t){this.flags[2]=t}set max(t){this.flags[3]=t}static build(t){let e=new Int32Array(Math.ceil(t/32)+16);return new di(e)}isEmpty(){return this.marked===0}getMarked(){return this.marked}getChunk(t){return this.index[t]}isUsed(t){let e=t/32|0,r=this.index[e];return r===4294967295?!0:r===0?!1:(r>>31-t&1)===1}markUsed(t){let e=t/32|0,r=this.index[e],i=1<<31-t;r&i||(this.index[e]=r|i,this.marked++),t>this.max&&(this.max=t)}markRemove(t){let e=t/32|0,r=this.index[e],i=1<<31-t;r&i&&(this.index[e]=r&(4294967295^i),this.marked--,t<this.emptyStart&&(this.emptyStart=t))}reset(){this.index.fill(0),this.marked=0,this.emptyStart=0,this.max=-1}remove(){this.index=null,this.marked=0,this.emptyStart=0,this.max=-1}findEmpty(t=1){if(this.size-this.marked<t)return-1;let e=this.index,r=-1,i=!1;for(let n=Math.floor(this.emptyStart/32);n<e.length;n++){let s=e[n];if(s===0){if(r===-1){if(r=n*32,i||(this.emptyStart=r,i=!0),t<=32)return r}else if((n+1)*32-r>=t)return r}else if(s!==4294967295)for(let o=31;o>=0;o--)if(s>>o&1)r=-1;else{let l=n*32+31-o;if(r===-1&&(r=l,i||(this.emptyStart=r,i=!0)),l-r+1>=t)return r}else r=-1}return-1}hasNEmpty(t=1){return this.size-this.marked>=t}findNEmpty(t=1){let e=[];if(this.size-this.marked<t)return e;if(this.size-this.max-1>=t){let i=this.max+t;for(let n=this.max+1;n<=i;n++)e.push(n);return e}let r=this.index;for(let i=Math.floor(this.emptyStart/32);i<r.length;i++){if(this.marked+e.length===i*32){for(let s=i*32;e.length!==t;s++)e.push(s);return this.emptyStart=e[0],e}let n=r[i];if(n===0){let s=i*32;if(e.indexOf(s)==-1){if(e.push(s),e.length>=t)return this.emptyStart=e[0],e;{let o=t-e.length;if(o<32){for(let l=0;l<o;l++)e.push(s+l+1);return this.emptyStart=e[0],e}else for(let l=0;l<31;l++)e.push(s+l+1)}}}else if(n!==4294967295){for(let s=31;s>=0;s--)if(!(n>>s&1)){let o=i*32+31-s;if(e.indexOf(o)==-1&&(e.push(o),e.length==t))return this.emptyStart=e[0],e}}}return this.emptyStart=e.length===0?this.size:e[0],[]}debug(){let t=[],e=this.index;for(let r=0;r<e.length;r++)t.push(kd(e[r]));console.log(t.join(" "))}};var Qc=new Error("list is empty"),Vl=4*1024,oh=128+4,$c=512+16,Jc=(Vl*4+3)*4+$c,Vd=Vl*4+3+oh,Wn=class{constructor(t){this.buffer=t}get offset(){return this.buffer[0]}set offset(t){this.buffer[0]=t}get byteLength(){return this.buffer[1]}set byteLength(t){this.buffer[1]=t}get prev(){return this.buffer[2]}set prev(t){this.buffer[2]=t}get next(){return this.buffer[3]}set next(t){this.buffer[3]=t}getListBuffer(t){if(t<0)return null;let e=new Int32Array(this.buffer.buffer,t,4);return new Wn(e)}insertAfter(t){if(t.next=this.next,this.next=t.buffer.byteOffset,t.prev=this.buffer.byteOffset,t.next!==-1){let e=this.getListBuffer(t.next);e.prev=t.buffer.byteOffset}}insertBefore(t){if(t.prev=this.prev,this.prev=t.buffer.byteOffset,t.next=this.buffer.byteOffset,t.prev!==-1){let e=this.getListBuffer(t.prev);e.next=t.buffer.byteOffset}}remove(){if(this.prev!==-1){let t=this.getListBuffer(this.prev);t.next=this.next}if(this.next!==-1){let t=this.getListBuffer(this.next);t.prev=this.prev}}},ah=class{constructor(t,e){this._next=e,this.buffer=t}getListBuffer(t){let e=new Int32Array(this.buffer,t,4);return new Wn(e)}hasNext(){return this._next!==-1}next(){let t=this.getListBuffer(this._next);if(t!==null)return this._next=t.next,t;throw new Error("iterator is null")}},lh=class{constructor(t){this.index=new di(new Int32Array(t.buffer,t.byteOffset,oh)),this.buffer=new Int32Array(t.buffer,t.byteOffset+$c,Vl*4+3)}get first(){return this.buffer[1]}set first(t){this.buffer[1]=t}get last(){return this.buffer[2]}set last(t){this.buffer[2]=t}add(t,e){return this.addLast(t,e)}push(t,e){return this.addLast(t,e)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let t=this.first;if(t===-1)throw Qc;{let e=this.getListBuffer(t);this.remove(t);let{offset:r,byteLength:i}=e;return{offset:r,byteLength:i}}}removeLast(){let t=this.last;if(t===-1)throw Qc;{let e=this.getListBuffer(t);this.remove(t);let{offset:r,byteLength:i}=e;return{offset:r,byteLength:i}}}createListBuffer(t,e){let r=this.index.findEmpty();this.index.markUsed(r);let i=(r*4+3)*4,n=new Int32Array(this.buffer.buffer,this.buffer.byteOffset+i,4).fill(-1),s=new Wn(n);return s.offset=t,s.byteLength=e,s}getListBuffer(t){let e=new Int32Array(this.buffer.buffer,t,4);return new Wn(e)}hasNEmpty(t){return Vl-this.buffer[0]>=t}addLast(t,e){let r=this.createListBuffer(t,e);return this.first===-1||this.last===-1?(this.first=r.buffer.byteOffset,this.last=this.first,this.buffer[0]=1,r):this.insertAfter(this.getListBuffer(this.last),r)}addFirst(t,e){let r=this.createListBuffer(t,e);return this.first===-1||this.last===-1?(this.first=r.buffer.byteOffset,this.last=r.buffer.byteOffset,this.buffer[0]++,r):this.insertBefore(this.getListBuffer(this.first),r)}insertAfter(t,e){return t.insertAfter(e),t.buffer.byteOffset===this.last&&(this.last=e.buffer.byteOffset),this.buffer[0]++,e}insertBefore(t,e){return t.insertBefore(e),t.buffer.byteOffset===this.first&&(this.first=e.buffer.byteOffset),this.buffer[0]++,e}remove(t){let e=this.getListBuffer(t);e.remove();let r=(t/8-3)/4;this.index.markRemove(r),t===this.first&&(this.first=e.next),t===this.last&&(this.last=e.prev),this.buffer[0]--}size(){return this.buffer[0]}clear(){this.first=-1,this.last=-1,this.buffer[0]=0,this.index.reset()}isEmpty(){return this.first==-1}delete(){this.buffer=null,this.index.remove()}iterator(){return new ah(this.buffer.buffer,this.first)}},Ra=class{constructor(){this.map=new Map;this.bitMap=new Map;this.lists=new Array;this.addList=new Map}createNewBuffer(){let t=new SharedArrayBuffer(Jc*32+8+16),e=this.getIndex(),r=new Int16Array(t,0,2),i=new Int32Array(t,4,5).fill(0);i[0]=32,i[1]=0,i[2]=0,i[3]=-1;let n=new di(i);return r[0]=e,r[1]=0,this.map.set(e,t),this.bitMap.set(e,n),this.addList.set(e,t),e}nextEmptyBuffer(t=1){for(let[r,i]of this.bitMap)if(i.hasNEmpty(t))return r;return this.createNewBuffer()}fixMap(){let t=new Array,e=new Array;for(let[r,i]of this.addList)r!==new Int16Array(i,0,2)[0]&&(t.push(r),e.push(i));for(let r of t)this.addList.delete(r);for(let r of e)new Int16Array(r,0,2)[0]>=0&&this.addList.set(new Int16Array(r,0,2)[0],r)}autoFix(){let t=new Array,e=new Map;for(let[i,n]of this.map)i!==new Int16Array(n,0,2)[0]&&(t.push(i),e.set(n,this.bitMap.get(i)));for(let i of t)this.map.delete(i),this.bitMap.delete(i);for(let[i,n]of e){let s=new Int16Array(i,0,2)[0];s>=0?(this.map.set(s,i),this.bitMap.set(s,n)):n.remove()}this.fixMap();let r=new Array;for(let i of this.lists)i.isEmpty()?i.delete():r.push(i);this.lists.length=0;for(let i of r)this.lists.push(i)}getIndex(){let t=0;for(;this.map.get(t)!=null;)t++;return t}addMemoey(t,e=!1){let r=new Int16Array(t,0,2),i=r[0];if(this.map.get(i)==null||r[1]==0){let s=new Int32Array(t,4,5),o=new di(s);e&&(i=this.getIndex(),r[0]=i,r[1]++,this.addList.set(i,t)),this.map.set(i,t),this.bitMap.set(i,o)}}getLinkedList(t){let e=this.lists.length;if(e>0){let r=this.lists[e-1],i=r.getListBuffer(r.last);if(i.byteLength>=t)return{list:r,node:i};for(let n=0;n<e;n++){r=this.lists[n];let s=r.iterator();for(;s.hasNext();)if(i=s.next(),i.byteLength>=t)return{list:r,node:i}}}return null}isEmpty(t){let e=0,r=null;for(let i of this.lists){let n=i.iterator();for(;n.hasNext();)if(r=n.next(),r.offset==e)e=r.offset+r.byteLength;else return!1}return e===t}nextEmpty(){for(let o=0;o<this.lists.length;o++){let l=this.lists[o];if(l.hasNEmpty(1))return l}let t=this.nextEmptyBuffer(1),e=this.map.get(t),r=this.bitMap.get(t),i=r.findEmpty(1);r.markUsed(i);let n=new Int32Array(e,i*Jc+8+16,Vd);n[0]=oh-4,n[1]=0,n[2]=0,n[3]=-1;let s=new lh(n);return s.first=-1,s.last=-1,this.lists.push(s),s}clear(){for(let t of this.lists)t.delete();this.lists.length=0,this.map.clear();for(let[,t]of this.bitMap)t.remove();this.bitMap.clear()}free(t,e){for(let i of this.lists){let n=i.iterator(),s=null;for(;n.hasNext();)if(s=n.next(),s.offset>t){let o=s.getListBuffer(s.prev),l=0;switch(o!=null&&this.isContinuous(o.offset,o.byteLength,t)&&l++,this.isContinuous(t,e,s.offset)&&(l+=2),l){case 0:{if(i.hasNEmpty(1))i.insertBefore(s,i.createListBuffer(t,e));else{let u=i.pop();i.insertBefore(s,i.createListBuffer(t,e)),this.free(u.offset,u.byteLength)}return}case 1:{o.byteLength+=e;return}case 2:{s.offset-=e,s.byteLength+=e;return}default:{o.byteLength+=e+s.byteLength,i.remove(s.buffer.byteOffset);return}}}}this.nextEmpty().addLast(t,e)}isContinuous(t,e,r){return t+e===r}};var va=class{constructor(t,e){this.buffer=t,this.manager=e}allocateMemory(t){let e=this.manager.getLinkedList(t);if(e==null)return null;{let{list:r,node:i}=e,n=i.offset,s=i.byteLength-t;return s>0?(i.offset=i.offset+t,i.byteLength=s):r.remove(i.buffer.byteOffset),{buffer:this.buffer,byteOffset:n}}}remove(t){if(this.buffer===t.buffer){let e=t.byteOffset,r=t.length*8;this.manager.free(e,r)}}isEmpty(){return this.manager.isEmpty(this.buffer.byteLength)}hasNEmpty(t){return this.manager.getLinkedList(t)!=null}drop(){this.buffer=null,this.manager.clear()}};var Ei=class{constructor(){this.buffers=new Map;this.map=new Map;this.pointerMap=new Map;this.addList=new Map}static getInstance(){return Ei.manager==null&&(Ei.manager=new Ei),Ei.manager}createNewBuffer(t=Ei.block){t>=Ei.block?t=t+8:t=Ei.block;let e=new SharedArrayBuffer(t),r=new Ra;r.free(8,t-8);let i=this.getIndex();console.log(`create Buffer:${i}`);let n=new Int32Array(e,0,2);return n[0]=i,n[1]=0,this.map.set(i,e),this.pointerMap.set(i,r),this.addList.set(e,r),i}autoFix(){let t=new Array,e=new Map;for(let[r,i]of this.map)if(r!==new Int32Array(i,0,2)[0]){t.push(r);let n=this.pointerMap.get(r);n.autoFix(),e.set(i,n)}for(let r of t)this.map.delete(r);for(let[r,i]of e){let n=new Int32Array(r,0,2)[0];n>=0?(this.map.set(n,r),this.pointerMap.set(n,i)):(i.clear(),this.buffers.delete(r))}}getIndex(){let t=0;for(;this.map.get(t)!=null;)t++;return t}addMemory(t,e,r=!1){let i=new Int32Array(t,0,2),n=i[0],s=this.map.get(n),o=this.buffers.get(s);if(o==null||i[1]==0){let l=new Ra;r&&(n=this.getIndex(),i[0]=n,i[1]++,this.addList.set(t,l)),this.map.set(n,t),this.pointerMap.set(n,l),o=new va(this.map.get(n),this.pointerMap.get(n)),this.buffers.set(t,o);for(let u of e)l.addMemoey(u,r)}else{let l=this.pointerMap.get(n);for(let u of e)l.addMemoey(u,r)}}allocateMemory(t){return this.nextEmpty(t).allocateMemory(t)}deallocateMemory(t){let e=this.buffers.get(t.buffer);e!=null&&e.remove(t)}isEmpty(){let t=!0;for(let e of this.buffers.values())e.isEmpty()||(t=!1);return t}nextEmpty(t){for(let n of this.buffers.values())if(n.hasNEmpty(t))return n;let e=this.createNewBuffer(t),r=this.map.get(e),i=new va(this.map.get(e),this.pointerMap.get(e));return this.buffers.set(r,i),i}clear(){for(let t of this.buffers.values())t.drop();this.buffers.clear(),this.map.clear(),this.pointerMap.clear()}},cr=Ei;cr.manager=null,cr.block=4*1024*1024;var Cs=class{constructor(t,e=10240){this.map=new Map;this.cache=new Map;this.alignment=t,this.size=e,this.mapSize=Math.ceil(this.size/32)+4,this.mapByteLength=this.mapSize*4,this.byteLength=this.alignment*this.size*8+this.mapByteLength}static getManager(t){t=+t;let e=Cs.alignMapManager.get(t);return e==null&&(e=new Cs(t),Cs.alignMapManager.set(t,e)),e}static clear(){for(let[t,e]of Cs.alignMapManager)e.clear()}createBuffer(){let t=cr.getInstance().allocateMemory(this.byteLength);return new Int8Array(t.buffer,t.byteOffset).fill(0),this.addBuffer(t.byteOffset,t.buffer,this.map),this.initBitMap(t.byteOffset,t.buffer),this.getMemory(t.byteOffset,t.buffer)}initBitMap(t,e){let r=new Int32Array(e,t,this.mapSize);r[0]=this.size,r[1]=0,r[2]=0,r[3]=-1}addBuffer(t,e,r){let i=r.get(e);i==null&&(i=new Set,r.set(e,i)),i.add(t)}getMemory(t,e){let r=this.cache.get(e);if(r!=null){let o=r[t];if(o!=null)return o}let i=new di(new Int32Array(e,t,this.mapSize)),n=new Float64Array(e,t+this.mapByteLength,this.size),s=new kl(i,n,this.alignment,this.size);return r!=null?r[t]=s:(r={},r[t]=s,this.cache.set(e,r)),s}addMemory(t,e,r=!1){this.addBuffer(e,t,this.map)}autoFix(){let t=new Array;for(let[e,r]of this.map){let i=new Array;for(let n of r){let s=this.getMemory(n,e);s.isEmpty()&&s.index.size==this.size&&i.push(n)}for(let n of i)this.removeOffset(r,n);r.size==0&&t.push(e)}for(let e of t)this.map.delete(e);this.cache.clear()}removeOffset(t,e){t!=null&&t.delete(e)}deallocateMemory(t){let e=new Array;for(let[r,i]of this.map){let n=new Array;for(let s of i)if(r==t.buffer&&s<=t.byteOffset){let o=this.getMemory(s,r);o.remove(t),o.isEmpty()&&n.push(s)}for(let s of n)cr.getInstance().deallocateMemory(new Float64Array(r,s,this.size+this.mapSize/2)),this.removeOffset(i,s);i.size==0&&e.push(r)}for(let r of e)this.map.delete(r)}isEmpty(){return!0}nextEmpty(t=1){for(let[e,r]of this.map)for(let i of r){let n=this.getMemory(i,e);if(n.hasNEmpty(t))return n}return this.createBuffer()}clear(){this.map.clear()}},hn=Cs;hn.alignMapManager=new Map;var Na={sharedSwitch:!0};function cn(a,t){if(Na.sharedSwitch&&a){let e=cr.getInstance().allocateMemory(t);return new Float64Array(e.buffer,e.byteOffset,t/8)}else return new Float64Array(new ArrayBuffer(t))}function z(a,t){return Na.sharedSwitch&&a?hn.getManager(t).nextEmpty().getNEmpty()[0]:new Float64Array(new ArrayBuffer(t*8))}function Ts(a){Na.sharedSwitch&&cr.getInstance().deallocateMemory(a)}function fn(a){if(!Na.sharedSwitch||a==null)return;let t=a.length;hn.getManager(t).deallocateMemory(a)}var Fe=class extends un{constructor(){super(...arguments);this._bbox=null;this._modify=0;this._isEmpty=!1}clearCache(){this._bbox=null}get isEmpty(){return this._isEmpty}updateBuffer(e,r){this.buffer&&this.buffer.set(r,e)}updateShapeBuffer(e,r){this.updateBuffer(e,r),this.parent!=null&&this.parent.update4Childs(),this.modify=!0,this._bbox=null}remove(){fn(this.buffer),this.recycle()}recycle(){this.buffer=null,this._isEmpty=!0,super.remove()}inOutline(e,r){return this.inShape(e.x,e.y,r)}buildBBox(){return this.isEmpty?null:(this.modify&&(this.clearCache(),this._bbox=this.updateBox(),this.modify=!1),this._bbox==null&&(this._bbox=this.bbox),this._bbox)}getMathGraphics(e,r){let i=this.buildBBox();if(i!=null){let n=new Array,s=new S(i.LL(),i.LR()),o=new S(i.LR(),i.UR()),l=new S(i.UR(),i.UL()),u=new S(i.UL(),i.LL());return n.push(s),n.push(o),n.push(l),n.push(u),B.build2(n)}else return null}};var vr=class extends Fe{constructor(e,r,i){super();this.globalIndex=e,this.update(r,i)}update(e,r){this.buffer=e,this._net=r,this.clearCache()}get net(){return this._net}set net(e){this._net=e,this.change=!0}};function Ea(a,t,e,r,i,n){if(isNaN(e))throw new Error("line error,width is NaN");if(e<0)return;function s(h){return r==i?!0:n===1?r>i?h>=r&&h<=Z?!0:h>=0&&h<=i:h>=r&&h<=i:r>i?h>=i&&h<=r:h>=i&&h<=Z?!0:h>=0&&h<=r}let o=new H;if(t<0)return null;if(t==0)return o.ext2(a),null;let l=a.add(new b(Math.cos(r)*t,Math.sin(r)*t)),u=a.add(new b(Math.cos(i)*t,Math.sin(i)*t));if(o.ext6(l.x,l.y).ext6(u.x,u.y),s(0)){let h=a.add(new b(t,0));o.ext6(h.x,h.y)}if(s(br)){let h=a.add(new b(0,t));o.ext6(h.x,h.y)}if(s(Math.PI)){let h=a.add(new b(-t,0));o.ext6(h.x,h.y)}if(s(br*3)){let h=a.add(new b(0,-t));o.ext6(h.x,h.y)}return o.ext7(e/2),o.build()}function Nr(a){return a>=0&&a<=Z||(a%=Z,a<0&&(a+=Z)),a}function ef(a,t,e,r,i=1){if(i==1)if(r>e){let n=(r-e)/2+e;return a.add(new b(Math.cos(n),Math.sin(n)).mul(t))}else{if(r==e)return a.add(new b(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(t));{let n=(r+Z-e)/2+e;return a.add(new b(Math.cos(n),Math.sin(n)).mul(t))}}else if(r>e){let n=(e+Z-r)/2+r;return a.add(new b(Math.cos(n),Math.sin(n)).mul(t))}else{if(r==e)return a.add(new b(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(t));{let n=(e-r)/2+r;return a.add(new b(Math.cos(n),Math.sin(n)).mul(t))}}}var pn=class extends R{constructor(t,e,r,i,n){super(t,e,r,i,n)}static build2(t,e,r,i,n,s){D.positive(i),D.positive(n),D.normal(e),D.normal(r);let o;return e===r?(e=J.regularD(e),r=J.regularD(r),o=0):(e=J.regularD(e),r=J.regularD(r),s===1?r<=e&&(r+=360):r>=e&&(e+=360),o=r-e),new pn(i,n,t,e,o)}static build3(t,e,r,i,n){return D.positive(i),D.positive(n),D.normal(r),new pn(i,n,t,J.regularD(e),r)}static build4(t,e,r,i,n,s){let o=t.angleD(r),l=e.angleD(r);return pn.build2(r,o,l,i,n,s)}};var Ud=.001/180*Math.PI,Ul=class{constructor(){this.deltaAngle=Ud;this.minLength=.01}fixStart(t,e,r,i,n){let s=t.sub(e).normalize(),o=i.sub(e).normalize(),l=Math.acos(s.dot(o));if(Math.abs(r*l)>this.minLength&&l>this.deltaAngle)return t;{let h=this.minLength/r,c=Math.max(h,this.deltaAngle),f=t.angle(e),d=i.angle(e),p=this.getAngle(n,f,d);return Math.abs(p)>Math.PI?n===1?f=d+c:f=d-c:n===1?f=d-c:f=d+c,new b(Math.cos(f),Math.sin(f)).mul(r).add(e)}}fixEnd(t,e,r,i,n){let s=i.sub(e).normalize(),o=t.sub(e).normalize(),l=Math.acos(s.dot(o));if(Math.abs(r*l)>this.minLength&&l>this.deltaAngle)return t;{let h=this.minLength/r,c=Math.max(h,this.deltaAngle),f=i.angle(e),d=t.angle(e),p=this.getAngle(n,f,d);return Math.abs(p)>Math.PI?n===1?d=f-c:d=f+c:n===1?d=f+c:d=f-c,new b(Math.cos(d),Math.sin(d)).mul(r).add(e)}}fixStartAngle(t,e,r,i){let n=this.getAngle(i,t,r),s=Z-n;if(s=Math.min(s,n),Math.abs(e*s)>this.minLength&&s>this.deltaAngle)return t;{let l=this.minLength/e,u=Math.max(l,this.deltaAngle);return Math.abs(n)>Math.PI?i===1?t=r+u:t=r-u:i===1?t=r-u:t=r+u,t}}fixEndAngle(t,e,r,i){let n=this.getAngle(i,r,t),s=Z-n;if(s=Math.min(s,n),Math.abs(e*s)>this.minLength&&s>this.deltaAngle)return t;{let l=this.minLength/e,u=Math.max(l,this.deltaAngle);return Math.abs(n)>Math.PI?i===1?t=r-u:t=r+u:i===1?t=r+u:t=r-u,t}}getAngle(t,e,r){r=(r%Z+Z)%Z,e=(e%Z+Z)%Z;let i=0;return t==1?i=(r-e+Z)%Z:i=(e-r+Z)%Z,(i%Z+Z)%Z}};var Gd=new Ul,Rs=class extends Fe{constructor(e,r){super();this.modelType="Arc";this._layerId=null;this._center=null;this._radius=null;this._width=null;this._startAngle=null;this._endAngle=null;this._sweep=null;this.globalIndex=e,this.update(r)}update(e){this.buffer=e,this.clearCache()}cacheLastValue(){this._layerId=this.layerId,this._center=this.center,this._radius=this.radius,this._width=this.width,this._startAngle=this.startAngle,this._endAngle=this.endAngle,this._sweep=this.sweep}recycle(){super.recycle(),this.cacheLastValue()}static build(e,r,i,n,s,o,l,u,h,c=1,f,d=!1){s=nt(s);let p=z(d,Rs.Blength).fill(0),m=Q.getCache().BuildArcCache;return m[0]=r,m[1]=i.x,m[2]=i.y,m[3]=n,m[4]=Nr(o),m[5]=Nr(l),m[6]=u==0?0:1,m[7]=s,m[8]=h?1:0,m[9]=c,p.set(m,1),f==null&&(f=Ea(i,n,s,o,l,u)),p.set(f.data,11),new Rs(e,p)}get modify(){return this.buffer!=null&&this._modify!=this.buffer[0]}set modify(e){e?this._modify==this.buffer[0]&&this.buffer[0]++:this._modify=this.buffer[0]}get layerId(){return this.buffer==null?this._layerId:this.buffer[1]}set layerId(e){let r=Q.getCache().ARRAY1;r[0]=e,this.updateBuffer(1,r)}get arcType(){return this.buffer[10]}set arcType(e){let r=Q.getCache().ARRAY1;r[0]=e,this.updateBuffer(10,r)}get angle(){let e=new li,{angle:r}=e.angleToPoint(this.center,this.radius,this.startAngle,this.endAngle,this.sweep);return r}set angle(e){let r=new li,{center:i,radius:n,startAngle:s,endAngle:o,sweep:l}=r.pointToAngle(this.start,this.end,e);this.center=i,this.radius=n,this.startAngle=s,this.endAngle=o,this.sweep=l}get center(){return this.buffer==null?this._center:new b(this.buffer[2],this.buffer[3])}set center(e){let r=Q.getCache().ARRAY2;r[0]=e.x,r[1]=e.y,this.updateShapeBuffer(2,r)}get radius(){return this.buffer==null?this._radius:this.buffer[4]}set radius(e){e==0&&(e=1e-8);let r=Q.getCache().ARRAY1;r[0]=e,this.updateShapeBuffer(4,r)}get width(){return this.buffer==null?this._width:this.buffer[8]}set width(e){e=nt(e);let r=Q.getCache().ARRAY1;r[0]=e,this.updateShapeBuffer(8,r)}get startAngle(){return this.buffer==null?this._startAngle:this.buffer[5]}set startAngle(e){let r=Q.getCache().ARRAY1;r[0]=Nr(e),this.updateShapeBuffer(5,r)}get endAngle(){return this.buffer==null?this._endAngle:this.buffer[6]}set endAngle(e){let r=Q.getCache().ARRAY1;r[0]=Nr(e),this.updateShapeBuffer(6,r)}get sweepAngle(){return this.sweep==1?((this.endAngle-this.startAngle)%Z+Z)%Z:((this.endAngle-this.startAngle)%Z-Z)%Z}get sweep(){return this.buffer==null?this._sweep:this.buffer[7]==0?0:1}set sweep(e){let r=Q.getCache().ARRAY1;r[0]=e==0?0:1,this.updateShapeBuffer(7,r)}get bbox(){return new j(this.buffer[11],this.buffer[12],this.buffer[13],this.buffer[14])}set bbox(e){this.updateBuffer(11,e.data)}get isSegment(){return this.width==0}get midPoint(){let e=this.startAngle,r=this.endAngle,i=this.sweep,n=this.center,s=this.radius;if(i==1)if(r>e){let o=(r-e)/2+e;return n.add(new b(Math.cos(o),Math.sin(o)).mul(s))}else{if(r==e)return n.add(new b(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(s));{let o=(r+Z-e)/2+e;return n.add(new b(Math.cos(o),Math.sin(o)).mul(s))}}else if(r>e){let o=(e+Z-r)/2+r;return n.add(new b(Math.cos(o),Math.sin(o)).mul(s))}else{if(r==e)return n.add(new b(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(s));{let o=(e-r)/2+r;return n.add(new b(Math.cos(o),Math.sin(o)).mul(s))}}}get start(){return this.center.add(new b(Math.cos(this.startAngle),Math.sin(this.startAngle)).mul(this.radius))}set start(e){e=Gd.fixStart(e,this.center,this.radius,this.end,this.sweep);let r=this.end,i=this.start,n=this.midPoint,s=r.distance2(e),o=Math.sqrt(n.distance2(i)-r.distance2(i)/4);(o<.1||isNaN(o))&&(o=.1);let l=o/2+s/o/8;l==0&&(l=1e-8),this.radius=l;let u=r.sub(e),h=e.add(r).mul(.5),c;this.sweep==1?c=new b(-u.y,u.x).normalize():c=new b(u.y,-u.x).normalize();let f=h.add(c.mul(l-o));this.center=f;let d=e.sub(f).normalize(),p=r.sub(f).normalize();this.startAngle=Math.atan2(d.y,d.x),this.endAngle=Math.atan2(p.y,p.x)}get end(){return this.center.add(new b(Math.cos(this.endAngle),Math.sin(this.endAngle)).mul(this.radius))}set end(e){let r=this.end,i=this.start,n=this.midPoint,s=e.distance2(i),o=Math.sqrt(n.distance2(i)-r.distance2(i)/4);(o<.1||isNaN(o))&&(o=.1);let l=o/2+s/o/8;l==0&&(l=1e-8),this.radius=l;let u=e.sub(i),h=i.add(e).mul(.5),c;this.sweep==1?c=new b(-u.y,u.x).normalize():c=new b(u.y,-u.x).normalize();let f=h.add(c.mul(l-o));this.center=f;let d=i.sub(f).normalize(),p=e.sub(f).normalize(),m=Math.atan2(d.y,d.x),g=Math.atan2(p.y,p.x);this.startAngle=m,this.endAngle=g}get length(){let e=0;return this.sweep==1?e=(this.endAngle-this.startAngle+Z)%Z:e=(this.startAngle-this.endAngle+Z)%Z,e*this.radius}set length(e){let r=e/this.radius;this.sweep==1?this.endAngle=this.startAngle+r:this.endAngle=this.startAngle-r}set midPoint(e){let r=this.end,i=this.start,n=this.midPoint,s=r.sub(i),o;this.sweep==1?o=new b(-s.y,s.x).normalize():o=new b(s.y,-s.x).normalize();let l=e.sub(n),u=o.mul(l.dot(o)),h=n.add(u),c=r.distance2(i),f=Math.sqrt(h.distance2(i)-r.distance2(i)/4);(f<.1||isNaN(f))&&(f=.1);let d=f/2+c/f/8;d==0&&(d=1e-8),this.radius=d;let p=i.add(r).mul(.5),m=n.sub(p),g=h.sub(p);m.dot(g)<0&&(this.sweep==1?this.sweep=0:this.sweep=1),this.sweep==1?o=new b(-s.y,s.x).normalize():o=new b(s.y,-s.x).normalize();let y=p.add(o.mul(d-f));this.center=y;let P=i.sub(y).normalize(),L=r.sub(y).normalize(),w=Math.atan2(P.y,P.x),C=Math.atan2(L.y,L.x);this.startAngle=w,this.startAngle=C}get primitive(){return this.arcType==1?R.build2(this.center,this.startAngle/Math.PI*180,this.endAngle/Math.PI*180,this.radius,this.radius,this.sweep):pn.build2(this.center,this.startAngle/Math.PI*180,this.endAngle/Math.PI*180,this.radius,this.radius,this.sweep)}getAngle(){return this.sweep==1?(this.endAngle-this.startAngle+Z)%Z:(this.startAngle-this.endAngle+Z)%Z}setStartAngleAndEndAngle(e,r){this.startAngle=e,this.endAngle=r}get locked(){return this.buffer[9]==1}set locked(e){let r=Q.getCache().ARRAY1;r[0]=e?1:0,this.updateBuffer(9,r)}transform(e){let{radius:r,startAngle:i,endAngle:n,center:s}=this,o=s.add(new b(Math.cos(i)*r,Math.sin(i)*r)),l=s.add(new b(Math.cos(n)*r,Math.sin(n)*r)),u=this.sweepAngle,h=i+u/2,c=s.add(new b(Math.cos(h)*r,Math.sin(h)*r)),f=s.multiply4(e),d=o.multiply4(e),p=l.multiply4(e),m=c.multiply4(e),g=d.sub(f),x=p.sub(f),y=Math.atan2(g.y,g.x),P=Math.atan2(x.y,x.x);y<0&&(y+=Z),P<0&&(P+=Z),this.center=f,this.startAngle=y,this.endAngle=P;let L=m.sub(d),w=p.sub(m);L.cross(w)>=0?this.sweep=1:this.sweep=0}inShape(e,r,i){let n=this.width;n<.05&&i!=null&&(n=10/i.getScale());let s=this.sweep==0,o=s?this.endAngle:this.startAngle,l=s?this.startAngle:this.endAngle;o%=Z,o<0&&(o+=Z),l%=Z,l<0&&(l+=Z);let u=this.radius-n/2,h=this.radius+n/2,c=e-this.center.x,f=r-this.center.y,d=Math.atan2(f,c);if(d<0&&(d+=Z),o<=l&&d>=o&&d<=l||o>l&&(d>=o&&d<=Z||d>=0&&d<=l)||o==l){var p=Math.sqrt(c*c+f*f);return p<=h&&p>=u}else{var p=(h+u)/2,m=new b(this.center.x+Math.cos(o)*p,this.center.y+Math.sin(o)*p),g=new b(this.center.x+Math.cos(l)*p,this.center.y+Math.sin(l)*p),x=e-m.x,y=r-m.y,P=e-g.x,L=r-g.y;return x*x+y*y<=n*n/4?!0:P*P+L*L<=n*n/4}}updateBox(){return this.bbox=Ea(this.center,this.radius,this.width,this.startAngle,this.endAngle,this.sweep),this.bbox}getMathGraphics(e=this.layerId,r=0){return this.isEmpty?null:this.layerId==e?this.primitive.stroke(this.width+r*2,1,0):null}clone(e=!1){let r=z(e,Rs.Blength);return r.set(this.buffer),new Rs(this.globalIndex,r)}},qt=Rs;qt.Blength=11+4;var vs=class extends vr{constructor(){super(...arguments);this.modelType="ArcTrack"}update(e,r){super.update(e,r),this.model=new qt(this.globalIndex,e)}static build(e,r,i,n,s,o,l,u,h,c,f,d,p=!1){s=nt(s);let m=z(p,vs.Blength).fill(0),g=Q.getCache().BuildArcTrackCache;return g[0]=r,g[1]=i.x,g[2]=i.y,g[3]=n,g[4]=Nr(o),g[5]=Nr(l),g[6]=u==0?0:1,g[7]=s,g[8]=h?1:0,g[9]=f,m.set(g,1),d==null&&(d=Ea(i,n,s,o,l,u)),m.set(d.data,11),new vs(e,m,c)}recycle(){this.model.cacheLastValue(),super.recycle(),this.model.buffer=null}get modify(){return this.model.modify}set modify(e){this.model.modify=e}get layerId(){return this.model.layerId}set layerId(e){this.model.layerId=e}get center(){return this.model.center}set center(e){this.model.center=e}get radius(){return this.model.radius}set radius(e){this.model.radius=e}get arcType(){return this.model.arcType}set arcType(e){this.model.arcType=e}get width(){return this.model.width}set width(e){e=nt(e),this.model.width=e}get startAngle(){return this.model.startAngle}set startAngle(e){this.model.startAngle=Nr(e)}get endAngle(){return this.model.endAngle}set endAngle(e){this.model.endAngle=Nr(e)}get isCCW(){return this.sweep===1}get sweepAngle(){return this.model.sweepAngle}get sweep(){return this.model.sweep}set sweep(e){this.model.sweep=e}get bbox(){return this.model.bbox}set bbox(e){this.model.bbox=e}get isSegment(){return this.model.isSegment}get midPoint(){return this.model.midPoint}get start(){return this.model.start}set start(e){this.model.start=e}get end(){return this.model.end}set end(e){this.model.end=e}get angle(){return this.model.angle}set angle(e){this.model.angle=e}get length(){return this.model.length}set length(e){this.model.length=e}set midPoint(e){this.model.midPoint=e}get primitive(){return this.model.primitive}get locked(){return this.model.locked}set locked(e){this.model.locked=e}transform(e){this.model.transform(e)}inShape(e,r,i){return this.model.inShape(e,r,i)}updateBox(){return this.model.buildBBox()}getMathGraphics(e=this.layerId,r=0){return this.model.getMathGraphics(e,r)}clone(e=!1){let r=z(e,vs.Blength);return r.set(this.buffer),new vs(this.globalIndex,r,this.net)}},Er=vs;Er.Blength=11+4;function Bi(a,t,e){return t.distance1(a)<=e}function lt(a,t,e,r,i){r===0&&i!=null&&(r=10/i);let{x:n,y:s}=a,o=n-t.x,l=s-t.y,u=n-e.x,h=s-e.y,c=e.x-t.x,f=e.y-t.y,d=new b(-f,c).normalize(),p=c+d.x*r/2,m=f+d.y*r/2,g=p*p+m*m,x=o*o+l*l,y=u*u+h*h,P=Math.abs(o*f-l*c)/2,w=Math.sqrt(c*c+f*f)*r/4;if(P<=w&&x<=g&&y<=g)return!0;{let C=r/2;return x<=C*C?!0:y<=C*C}}function uh(a){switch(a){case"SLOT":return 0;case"ROUND":return 1;case"RECT":return 2}}function rf(a){switch(a){case 0:return"SLOT";case 1:return"ROUND";case 2:return"RECT";default:break}}function nf(a,t,e,r,i,n,s){let o=new H;switch(i){case"ROUND":{let l=s.add(a);return o.ext2(l).ext7(r),o.build()}case"SLOT":{let l=(e-r*2)/2,u=X.getMatrix4(b.ORIGIN,n+t,1,s.add(a)),h=new b(-l,0).multiply4(u),c=new b(l,0).multiply4(u);return o.ext2(h).ext2(c).ext7(r),o.build()}case"RECT":{let l=s.add(a),u=n+t,h=X.getMatrix4(b.ORIGIN,u,1,l);return new j(-e/2,e/2,-r,r).transform(h.toMatrix3())}default:throw new Error("this hole style is not supported !!!")}}var Ns=class{constructor(t,e){this.parent=null;this.buffer=e,this.id=t}setParent(t){this.parent=t}static build(t,e,r,i,n,s,o=!1){let l=z(o,Ns.Blength),u=zr(r*2);return e=zr(e),i=="ROUND"&&(e=u),u>e&&(e=u),r=u/2,l[0]=e,l[1]=r,l[2]=uh(i),l[3]=n,l[4]=s.x,l[5]=s.y,new Ns(t,l)}updateBuffer(t,e){this.buffer&&(this.buffer.set(e,t),this.parent!=null&&(this.parent.modify=!0,this.parent.change=!0))}get holeLength(){return this.buffer[0]}set holeLength(t){t=nt(t);let e=this.holeRadius*2;t<e&&(t=e);let r=Q.getCache().ARRAY1;r[0]=t,this.updateBuffer(0,r)}get holeRadius(){return this.buffer[1]}set holeRadius(t){let e=nt(t*2);e>this.holeLength&&(this.holeLength=e),t=e/2;let r=Q.getCache().ARRAY1;r[0]=t,this.updateBuffer(1,r)}get holeShape(){return rf(this.buffer[2])}set holeShape(t){let e=Q.getCache().ARRAY1;e[0]=uh(t),this.updateBuffer(2,e)}get holeRotation(){return this.buffer[3]}set holeRotation(t){let e=Q.getCache().ARRAY1;e[0]=t,this.updateBuffer(3,e)}get holeOffset(){return new b(this.buffer[4],this.buffer[5])}set holeOffset(t){let e=Q.getCache().ARRAY2;e[0]=t.x,e[1]=t.y,this.updateBuffer(4,e)}get rotation(){return this.parent==null?0:this.parent.rotation}get center(){return this.parent==null?b.ORIGIN:this.parent.center}getHolebbox(t,e){return nf(t,e,this.holeLength,this.holeRadius,this.holeShape,this.holeRotation,this.holeOffset)}inShape(t,e,r){let i=r==null?1:r.getScale();switch(this.holeShape){case"ROUND":{let n=this.holeOffset.add(this.center);return Bi(new b(t,e),n,this.holeRadius)}case"SLOT":{let n=(this.holeLength-this.holeRadius*2)/2,s=X.rotateZ(this.holeRotation+this.rotation).translate1(this.holeOffset.x+this.center.x,this.center.y+this.holeOffset.y,0),o=new b(-n,0).multiply4(s),l=new b(n,0).multiply4(s);return lt(new b(t,e),o,l,this.holeRadius,i)}case"RECT":{let n=this.holeOffset.add(this.center),s=this.holeRotation+this.rotation,o=X.rotateZForPoint(n,-s),l=this.holeLength/2;return new j(n.x-l,n.x+l,n.y-this.holeRadius,n.y+this.holeRadius).isContains(n.multiply4(o))}default:throw new Error("this hole style is not supported !!!")}}getShape(t){let e=X.rotateZ(this.holeRotation).translate1(this.holeOffset.x,this.holeOffset.y,0).rotateZ(this.rotation).translate1(this.center.x,this.center.y,0),r=b.ORIGIN,i;if(this.holeShape=="ROUND")i=B.build2([R.build2(r,0,360,this.holeRadius+t,this.holeRadius+t,1)]);else if(this.holeShape=="RECT"){let n=this.holeRadius*2+t*2,s=r.add1(-this.holeRadius-t,0),o=r.add1(this.holeRadius+t,0);i=new S(s,o).stroke(n,0,1).asClose()}else{let n=this.holeLength-this.holeRadius*2,s=r.add1(-n/2,0),o=r.add1(n/2,0);i=new S(s,o).stroke(this.holeRadius*2+t*2,1,1).asClose()}return i.multiply3(e.toMatrix3())}clone(t=!1){let e=z(t,Ns.Blength);return e.set(this.buffer),new Ns(this.id,e)}remove(){fn(this.buffer),this.buffer=null}},Yr=Ns;Yr.Blength=5+1;var Es=class{constructor(t,e,r){this.parent=null;this.id=t,this.buffer=e,this._pl=r}setParent(t){this.parent=t}static build(t,e,r,i,n,s,o=!1){let l=z(o,Es.Blength),u=Q.getCache().BuildPadStyleCache;return u[0]=hh(e),u[1]=zr(r),u[2]=zr(i),u[3]=n,l.set(u,0),new Es(t,l,s)}updateBuffer(t,e){this.buffer&&(this.buffer.set(e,t),this.parent!=null&&(this.parent.modify=!0,this.parent.change=!0))}get pl(){return this._pl}set pl(t){this._pl=t,this.parent!=null&&(this.parent.modify=!0)}get type(){return sf(this.buffer[0])}set type(t){let e=Q.getCache().ARRAY1;e[0]=hh(t),this.updateBuffer(0,e),t=="ELLIPSE"&&(this.height=this.width),t!=="RECT"&&(this.ratio=0)}get width(){return this.buffer[1]}set width(t){t=zr(t);let e=Q.getCache().ARRAY1;e[0]=t,this.updateBuffer(1,e),this.type=="ELLIPSE"&&this.updateBuffer(2,e)}get height(){return this.buffer[2]}set height(t){t=zr(t);let e=Q.getCache().ARRAY1;e[0]=t,this.updateBuffer(2,e),this.type=="ELLIPSE"&&this.updateBuffer(1,e)}get ratio(){return this.buffer[3]}set ratio(t){let e=Q.getCache().ARRAY1;e[0]=t,this.updateBuffer(3,e)}get center(){return this.parent==null?b.ORIGIN:this.parent.center}get rotation(){return this.parent==null?0:this.parent.rotation}inShape(t,e,r){let i=r==null?1:r.getScale();switch(this.type){case"ELLIPSE":return Bi(new b(t,e),this.center,this.width/2);case"OVAL":{let n=X.rotateZForPoint(this.center,this.rotation);if(this.width>this.height){let s=(this.width-this.height)/2,o=this.center.add1(-s,0).multiply4(n),l=this.center.add1(s,0).multiply4(n);return lt(new b(t,e),o,l,this.height,i)}else if(this.height>this.width){let s=(this.height-this.width)/2,o=this.center.add1(0,-s).multiply4(n),l=this.center.add1(0,s).multiply4(n);return lt(new b(t,e),o,l,this.width,i)}else{let s=this.width/2;return Bi(new b(t,e),this.center,s)}}case"RECT":{let n=X.rotateZForPoint(this.center,-this.rotation),s=new b(t,e).multiply4(n),o=this.width/2,l=this.height/2,u=Math.min(o,l)*this.ratio,h=this.center.add1(-o,l),c=this.center.add1(-o,-l),f=this.center.add1(o,l),d=this.center.add1(o,-l),p=c.add1(u,u),m=d.add1(-u,u),g=f.add1(-u,-u),x=h.add1(u,-u);if(new j(c.x,f.x,c.y,f.y).isContains(s)){if(s.x<p.x){if(s.y<p.y)return s.distance1(p)<=u;if(s.y>x.y)return s.distance1(x)<=u}if(s.x>m.x){if(s.y<m.y)return s.distance1(m)<=u;if(s.y>g.y)return s.distance1(g)<=u}return!0}else return!1}default:return wt.inPolygon(new b(t,e),[this._pl])}}clone(t=!1){let e=z(t,Es.Blength);e.set(this.buffer);let r=this._pl;return this._pl!=null&&(r=r.clone()),new Es(this.id,e,r)}getShape(t){let{center:e,width:r,height:i,rotation:n,type:s}=this,o=X.getMatrix4(e.mul(-1),n,1,e),l;switch(s){case"ELLIPSE":{let u=r/2+t;if(u<=0)return null;l=B.build2([R.build2(e,0,360,u,u,0)]);break}case"OVAL":{if(r>i){let u=(r-i)/2,h=i+t*2;if(h<0)return null;l=this.getStrokePolyline(e.add(new b(-u,0)),e.add(new b(u,0)),h/2,0)}else if(r<i){let u=(i-r)/2,h=r+t*2;if(h<0)return null;l=this.getStrokePolyline1(e.add(new b(0,-u)),e.add(new b(0,u)),h/2,0)}else{let u=r/2+t;if(u<=0)return null;l=B.build2([R.build2(e,0,360,u,u,0)])}l=l.multiply3(o.toMatrix3());break}case"RECT":{let u=r/2+t;if(u<0)return null;let h=i+t*2;if(h<0)return null;l=kn(e.add(new b(-u,0)),e.add(new b(u,0)),h,this.ratio),l=l.multiply3(o.toMatrix3());break}case"POLYGON":{l=this._pl,t!=0&&(l=of(l,t));break}}return l==null?void 0:l.asClose()}remove(){fn(this.buffer),this.buffer=null}getStrokePolyline(t,e,r,i){return i===0?B.build2([R.build3(t,-90,-180,r,r),R.build3(e,90,-180,r,r)]):B.build2([R.build3(t,90,180,r,r),R.build3(e,-90,180,r,r)])}getStrokePolyline1(t,e,r,i){return i===0?B.build2([R.build3(t,0,-180,r,r),R.build3(e,180,-180,r,r)]):B.build2([R.build3(t,180,180,r,r),R.build3(e,0,180,r,r)])}},$t=Es;$t.Blength=3+1;function hh(a){switch(a){case"ELLIPSE":return 0;case"RECT":return 1;case"OVAL":return 2;case"POLYGON":return 3;default:throw new Error("Input Error!!!")}}function sf(a){switch(a){case 0:return"ELLIPSE";case 1:return"RECT";case 2:return"OVAL";case 3:return"POLYGON";default:throw new Error("Input Error!!!")}}function Wd(a,t,e,r,i,n,s){let o=new H;switch(e){case"ELLIPSE":return o.ext2(a).ext7(Math.min(r,i)/2),o.build();case"OVAL":{let l=X.getMatrix4(a.mul(-1),t,1,a);if(r>i){let u=(r-i)/2,h=i/2,c=a.add1(-u,0).multiply4(l),f=a.add1(u,0).multiply4(l);return o.ext2(c).ext2(f).ext7(h),o.build()}else{let u=(i-r)/2,h=r/2,c=a.add1(0,-u).multiply4(l),f=a.add1(0,u).multiply4(l);return o.ext2(c).ext2(f).ext7(h),o.build()}}case"RECT":{let l=r/2,u=i/2,h=n*Math.min(l,u),c=X.getMatrix4(a.mul(-1),t,1,a),f=new b(a.x-l,a.y+u),d=new b(a.x-l,a.y-u),p=new b(a.x+l,a.y+u),m=new b(a.x+l,a.y-u),g=d.add1(h,h).multiply4(c),x=m.add1(-h,h).multiply4(c),y=p.add1(-h,-h).multiply4(c),P=f.add1(h,-h).multiply4(c),L=new H;return L.ext2(g).ext2(x).ext2(y).ext2(P).ext7(h),L.build()}case"POLYGON":return s.bbox();default:throw new Error("this pad style is not supported !!!")}}function Bs(a,t,e){return Wd(a,t,e.type,e.width,e.height,e.ratio,e.pl)}function Fl(a,t,e,r,i,n,s,o,l,u){switch(a){case 1:{let h=Bs(t,e,r),c=Math.max(o,l);return c>0?h.extendOfSize(c):h}case 2:{let h=Bs(t,e,i),c=Math.max(o,u);return c>0?h.extendOfSize(c):h}case 12:{let h=new H,c=Bs(t,e,r),f=Math.max(o,l),d=Bs(t,e,i),p=Math.max(o,u);return h.ext1(c.extendOfSize(f>0?f:0)).ext1(d.extendOfSize(p>0?p:0)).ext1(Bs(t,e,n)).ext1(s.getHolebbox(t,e)),h.build()}default:return Bs(t,e,n)}}function of(a,t){let e=(r,i)=>i.bbox().area()-r.bbox().area();if(t>=0){let r=gr.zoomPolygon(a,t);if(!r)return null;let i=Wr(r,0);if(ie(i,e,0,i.length),i.length>0){let n=i[0].items;for(let s of n)return s}return r}else{let r=a.bbox();if(Math.abs(t)>r.width()||Math.abs(t)>r.height())return null;let i=Wr(a,t);if(ie(i,e,0,i.length),i.length>0){let n=i[0].items;for(let s of n)return s}return null}}function Hd(a,t,e,r,i,n,s,o,l,u,h,c,f,d,p,m,g,x,y,P=!1){let L=null,w=null,C=null,T=null;return t===1?L=$t.build(a,e,r,i,n,null,P):t===2?w=$t.build(a,s,o,l,u,null,P):(L=$t.build(a,e,r,i,n,null,P),w=$t.build(a,s,o,l,u,null,P),C=$t.build(a,h,c,f,d,null,P),T=Yr.build(a,p,m,g,x,y,P)),{top:L,bottom:w,inner:C,hole:T}}function z8(a,t,e,r,i,n,s,o,l=!1){let u=null,h=null,c=null,f=null,d=o instanceof B?o:zd(o);o instanceof B||o.forEach(m=>m.remove());let p=$t.build(a,"POLYGON",-1,-1,-1,d,l);return t===1?u=p:t===2?h=p:(u=p,h=p.clone(l),c=p.clone(l),f=Yr.build(a,e,r,i,n,s,l)),{top:u,bottom:h,inner:c,hole:f}}function zd(a){let t=a.map(e=>e.primitive);return B.build2(t)}function Y8(a,t,e,r,i,n,s,o,l,u,h,c,f,d,p,m,g,x,y,P,L,w,C,T,M,E,W,k,O,se,Y,$){let ae=Hd(a,t,n,s,o,l,u,h,c,f,d,p,m,g,W,k,O,se,Y);return tt.build(a,t,e,r,i,x,y,P,L,w,C,T,M,E,ae.top,ae.bottom,ae.inner,ae.hole,$)}var mi=class{static compress(t){if(!t)return 0;let e=0;for(let r of t)e+=1<<r-15;return e}static decompress(t){let e=[];for(let r=0;r<46-15;r++)t>>r&1&&e.push(r+15);return e}};var be=class{constructor(){this._items=new Array;this.map=new Map;this._visible=!0;this._last=null;this.addList=new Set;this.delList=new Set}get items(){return this._items}set items(t){this._items=t}survive(t){this.addList.add(t),this.delList.delete(t)}del(t){this.delList.add(t),this.addList.delete(t)}clearList(){this.addList.clear(),this.delList.clear()}getItem(t){return this.map.get(t)}getAllItem(){let t=new Array(this.map.size),e=this.map.values(),r=0;for(let i of e)t[r]=i,r++;return t}get visible(){return this._visible}set visible(t){this._visible=t}recycle(){this.items.length=0,this.map.clear()}};var Gl=(r=>(r.SAFE="SAFE",r.INNER="INNER",r.COPPER="COPPER",r))(Gl||{}),_s=class{constructor(t){this.rule=new Array;this.type=t}addRule(t){t.type=this.type,this.rule.push(t)}};var wr=class{constructor(t){this._name=t}get name(){return this._name}set name(t){this._name=t}};var Wl=class extends wr{constructor(){super(...arguments);this.safe=new _s("SAFE");this.inner=new _s("INNER");this.copper=new _s("COPPER")}deltetRule4Net(e){this.deleteRule(this.safe.rule,e),this.deleteRule(this.inner.rule,e),this.deleteRule(this.copper.rule,e)}deleteRule(e,r){let i=[...e];for(let n of i)if(n.net1==r||n.net2==r){let s=e.indexOf(n);s>=0&&e.splice(s,1)}}};var af={UNIT_NAME:"mm"},qr=class{constructor(t,e){this._name=t,this.buffer=e}get unit(){return af.UNIT_NAME}set unit(t){af.UNIT_NAME=t}get name(){return this._name}set name(t){this._name=t}updateBuffer(t,e){this.buffer&&this.buffer.set(e,t)}remove(){fn(this.buffer),this.buffer=null}};var Xr=class extends qr{};var Os=class{constructor(t,e,r){this.buffer=r,this._name=e,this.key=t}static build(t,e,r,i,n,s=!1){return t.set([e,i,n,s?1:0],1+1+e*(3+1)),new Os(e,r,t)}remove(){this.buffer=null}updateBuffer(t,e){this.buffer&&this.buffer.set(e,t)}getValue(t){let e=t+1+1+this.key*(3+1);return this.buffer[e]}get name(){return this._name}set name(t){this._name=t}get startLayer(){return this.getValue(1)}set startLayer(t){this.updateBuffer(1,[t])}get endLayer(){return this.getValue(2)}set endLayer(t){this.updateBuffer(2,[t])}isContains(t){if(this.startLayer===t||this.endLayer===t)return!0;if(this.startLayer==1){if(t!=2&&t<this.endLayer)return!0}else if(this.startLayer==2){if(t!=1&&t>this.endLayer)return!0}else if(t!=1&&t!=2&&t>this.startLayer&&t<this.endLayer)return!0;return!1}get used(){return this.getValue(3)==1}set used(t){this.updateBuffer(2,[t?1:0])}getMenu(){return{name:this._name,cmd:this._name,tips:""}}},Ba=class extends Xr{constructor(e,r,i){super(e,r);this.change=!1;this.blindVias=new Array;this.map={};this.nameMap=i,this.generateChilds()}update(e,r){this.buffer=e,this.nameMap=r,this.clearCache(),this.generateChilds()}clearCache(){for(let e of this.blindVias)e.remove();this.blindVias.length=0,this.map={},this.change=!1}static build(e,r,i=!0){let n=cn(i,Ba.Blength);return n.set([r?1:0,0]),new Ba(e,n,{})}generateChilds(){this.blindVias.length=0,this.map={};for(let e in this.nameMap){let r=new Os(this.nameMap[e],e,this.buffer);this.blindVias.push(r),this.map[r.key]=r}ie(this.blindVias,(e,r)=>e.key-r.key,0,this.blindVias.length)}getBlindVia(e){for(let r of this.blindVias)if(r.name===e)return r;return null}addBlind(e,r,i,n=!0){let s=this.buffer[1],o=this.buffer;this.buffer=cn(n,(this.buffer.length+3+1)*8),this.buffer.set(o),this.buffer.set([s],1);let l=Os.build(this.buffer,s,e,r,i);return this.blindVias.push(l),this.map[l.key]=l,this.nameMap[l.name]=l.key,s++,Ts(o),l}get isDefault(){return this.buffer[0]==1}set isDefault(e){this.updateBuffer(0,[e?1:0])}get data(){let e=new Array;for(let r of this.blindVias)e.push({name:r.name,startLayer:r.startLayer,endLayer:r.endLayer,used:r.used,key:r.key});return e}set data(e){this.change=!0;let r=0,i=new Array,n={};for(let o of e){let l=o.name,u=parseInt(o.startLayer),h=parseInt(o.endLayer);if(u==1){if(h==2||u==h)continue}else if(u==2){if(h==1||u==h)continue}else if(u==h)continue;let c=this.map[o.key],f=0;c!=null&&(f=c.used?1:0),i.push(r,u,h,f),n[l]=r,r++}let s=cn(!0,(1+1+r*4)*8);s.set([this.isDefault?1:0,r],0),s.set(i,1+1),Ts(this.buffer),this.buffer=s,this.nameMap=n,this.generateChilds()}getAllVias(){return[...this.blindVias]}getContainsLayerVias(e){let r=new Set;return this.blindVias.forEach(i=>{i.isContains(e)&&r.add(i)}),r}getFirst(){return this.blindVias.length>0?this.blindVias[0]:null}getOptions(){let e=new Array;for(let r of this.blindVias){let i={value:r.name,text:r.name,startLayerId:r.startLayer,endLayerId:r.endLayer};e.push(i)}return e}remove(){Ts(this.buffer),this.buffer=null}clone(e=!0){let r=cn(e,this.buffer.byteLength);r.set(this.buffer);let i=JSON.parse(JSON.stringify(this.nameMap));return new Ba(this.name,r,i)}},Ds=Ba;Ds.Blength=(1+1)*8;var er=class extends qr{};er.defUnitName="mil",er.defNetClearance=1,er.defBoardClearance=1,er.defPadConnectRule={connectMode:0,lineClearance:1,lineWidth:1,lineAngle:Fn};var ks=class extends er{static build(t,e=er.defNetClearance,r=er.defBoardClearance,i=er.defPadConnectRule,n=er.defPadConnectRule,s=ks.defTrackConnect,o=!1,l=!0){let u=z(l,ks.Blength).fill(0);return u[0]=o?1:0,u[1]=e,u[2]=r,u[3]=i.connectMode,u[4]=i.lineClearance,u[5]=i.lineWidth,u[6]=i.lineAngle,u[7]=n.connectMode,u[8]=n.lineClearance,u[9]=n.lineWidth,u[10]=n.lineAngle,u[11]=s,new ks(t,u)}get isDefault(){return this.buffer[0]==1}set isDefault(t){this.updateBuffer(0,[t?1:0])}get trackConnect(){return this.buffer[11]}set trackConnect(t){this.updateBuffer(11,[t])}get singleConnectMode(){return this.buffer[3]}set singleConnectMode(t){this.buffer[3]=t}get singleLineClearance(){return this.buffer[4]}set singleLineClearance(t){this.buffer[4]=t}get singleLineWidth(){return this.buffer[5]}set singleLineWidth(t){this.buffer[5]=t}get singleLineAngle(){return this.buffer[6]}set singleLineAngle(t){this.buffer[6]=t}get multiConnectMode(){return this.buffer[7]}set multiConnectMode(t){this.buffer[7]=t}get netClearance(){return this.buffer[1]}set netClearance(t){this.buffer[1]=t}get boardClearance(){return this.buffer[2]}set boardClearance(t){this.buffer[2]=t}get multiLineClearance(){return this.buffer[8]}set multiLineClearance(t){this.buffer[8]=t}get multiLineWidth(){return this.buffer[9]}set multiLineWidth(t){this.buffer[9]=t}get multiLineAngle(){return this.buffer[10]}set multiLineAngle(t){this.buffer[10]=t}get singlePadConnectRule(){return{connectMode:this.singleConnectMode,lineClearance:this.singleLineClearance,lineWidth:this.singleLineWidth,lineAngle:this.singleLineAngle}}set singlePadConnectRule(t){this.singleConnectMode=t.connectMode,this.singleLineClearance=t.lineClearance,this.singleLineWidth=t.lineWidth,this.singleLineAngle=t.lineAngle}get multiPadConnectRule(){return{connectMode:this.multiConnectMode,lineClearance:this.multiLineClearance,lineWidth:this.multiLineWidth,lineAngle:this.multiLineAngle}}set multiPadConnectRule(t){this.multiConnectMode=t.connectMode,this.multiLineClearance=t.lineClearance,this.multiLineWidth=t.lineWidth,this.multiLineAngle=t.lineAngle}getMaxClearance(){return Math.max(this.netClearance,this.boardClearance)}clone(t=!0){return ks.build(this.name,this.netClearance,this.boardClearance,this.singlePadConnectRule,this.multiPadConnectRule,this.trackConnect,this.isDefault,t)}},Hn=ks;Hn.Blength=11+1,Hn.defTrackConnect=0;var fh=(l=>(l[l.isDefault=0]="isDefault",l[l.strokeWidthMin=1]="strokeWidthMin",l[l.strokeWidthDefault=2]="strokeWidthDefault",l[l.strokeWidthMax=3]="strokeWidthMax",l[l.differentialPairSpacingMin=4]="differentialPairSpacingMin",l[l.differentialPairSpacingDefault=5]="differentialPairSpacingDefault",l[l.differentialPairSpacingMax=6]="differentialPairSpacingMax",l[l.differentialPairLenTolerMax=7]="differentialPairLenTolerMax",l))(fh||{});var Vs=class extends Xr{static build(t,e,r,i,n,s,o,l,u,h=!0){let c=z(h,Vs.Blength);return c[0]=Number(e),c[1]=r,c[2]=i,c[3]=n,c[4]=s,c[5]=o,c[6]=l,c[7]=u,new Vs(t,c)}get isDefault(){return this.buffer[0]==1}set isDefault(t){this.buffer[0]=t?1:0}get strokeWidthMin(){return this.buffer[1]}set strokeWidthMin(t){this.updateBuffer(1,[t])}get strokeWidthDefault(){return this.buffer[2]}set strokeWidthDefault(t){this.updateBuffer(2,[t])}get strokeWidthMax(){return this.buffer[3]}set strokeWidthMax(t){this.updateBuffer(3,[t])}get differentialPairSpacingMin(){return this.buffer[4]}set differentialPairSpacingMin(t){this.updateBuffer(4,[t])}get differentialPairSpacingDefault(){return this.buffer[5]}set differentialPairSpacingDefault(t){this.updateBuffer(5,[t])}get differentialPairSpacingMax(){return this.buffer[6]}set differentialPairSpacingMax(t){this.updateBuffer(6,[t])}get differentialPairLenTolerMax(){return this.buffer[7]}set differentialPairLenTolerMax(t){this.updateBuffer(7,[t])}clone(t=!0){let e=z(t,Vs.Blength);return new Vs(this.name,e)}},Us=Vs;Us.Blength=nc(fh).length;var _a=class extends wr{constructor(e,r="default",i=new Set){super(e);this._nets=new Set;this._netLengthPhysics="default";this.update(r,i)}update(e="default",r=new Set){this._netLengthPhysics=e,this._nets=r}get netLengthPhysics(){return this._netLengthPhysics}set netLengthPhysics(e){this._netLengthPhysics=e}getNet(e){}removeNetwork(e){if(this._nets.has(e)){let r=ke.getInstance().getNet(e);r!=null&&r.equalLengthGroup===this&&(r.equalLengthGroup=null),this._nets.delete(e)}}getAllNetIds(){return[...this._nets]}getAllNets(){let e=new Array;for(let r of this._nets){let i=ke.getInstance().getNet(r);e.push(i)}return e}remove(){for(let e of this._nets){let r=ke.getInstance().getNet(e);r!=null&&r.equalLengthGroup===this&&(r.equalLengthGroup=null)}this._nets.clear()}addEqualLengthGroup(e){this._nets.add(e.name),e.equalLengthGroup=this}getEqualLengthGroup(e){}};var Fs=class extends er{getMaxClearance(){return Math.max(this.netClearance,this.boardClearance)}static build(t,e=er.defNetClearance,r=er.defBoardClearance,i=er.defPadConnectRule,n=!1,s=!0){let o=z(s,Fs.Blength).fill(0);return o[0]=n?1:0,o[1]=e,o[2]=r,o[3]=i.connectMode,o[4]=i.lineClearance,o[5]=i.lineWidth,o[6]=i.lineAngle,new Fs(t,o)}get isDefault(){return this.buffer[0]==1}set isDefault(t){this.updateBuffer(0,[t?1:0])}get multiConnectMode(){return this.buffer[3]}set multiConnectMode(t){this.buffer[3]=t}get multiLineClearance(){return this.buffer[4]}set multiLineClearance(t){this.buffer[4]=t}get multiLineWidth(){return this.buffer[5]}set multiLineWidth(t){this.buffer[5]=t}get multiLineAngle(){return this.buffer[6]}set multiLineAngle(t){this.buffer[6]=t}get netClearance(){return this.buffer[1]}set netClearance(t){this.buffer[1]=t}get boardClearance(){return this.buffer[2]}set boardClearance(t){this.buffer[2]=t}get multiPadConnectRule(){return{connectMode:this.multiConnectMode,lineClearance:this.multiLineClearance,lineWidth:this.multiLineWidth,lineAngle:this.multiLineAngle}}set multiPadConnectRule(t){this.multiConnectMode=t.connectMode,this.multiLineClearance=t.lineClearance,this.multiLineWidth=t.lineWidth,this.multiLineAngle=t.lineAngle}clone(t=!0){let e=z(t,Fs.Blength);return new Fs(this.name,e)}},Gs=Fs;Gs.Blength=6+1;var Ws=class extends wr{constructor(){super(...arguments);this._safeSpacing="default";this._trackPhysics="default";this._differentailPhysics="default";this._netLengthPhysics="default";this._blindViaPhysics="default";this._radiusPhysics="default";this._innerPlane="default";this._copperPlane="default";this._solderExpansion="default";this._pasteExpansion="default"}get safeSpacing(){return this._safeSpacing}set safeSpacing(e){this._safeSpacing=e}get trackPhysics(){return this._trackPhysics}set trackPhysics(e){this._trackPhysics=e}get netLengthPhysics(){return this._netLengthPhysics}set netLengthPhysics(e){this._netLengthPhysics=e}get differentailPhysics(){return this._differentailPhysics}set differentailPhysics(e){this._differentailPhysics=e}get blindViaPhysics(){return this._blindViaPhysics}set blindViaPhysics(e){this._blindViaPhysics=e}get radiusPhysics(){return this._radiusPhysics}set radiusPhysics(e){this._radiusPhysics=e}get innerPlane(){return this._innerPlane}set innerPlane(e){this._innerPlane=e}get copperPlane(){return this._copperPlane}set copperPlane(e){this._copperPlane=e}get solderExpansion(){return this._solderExpansion}set solderExpansion(e){this._solderExpansion=e}get pasteExpansion(){return this._pasteExpansion}set pasteExpansion(e){this._pasteExpansion=e}};var zn=class extends Ws{constructor(e,r="default",i="default",n="default",s="default",o="default",l="default",u="default",h="default",c="default",f="default",d=null,p=null,m=null,g=!0,x=null){super(e);this._netClassName=null;this._equalLengthGroupName=null;this._netDifferentailName=null;this._showRatline=!0;this._color=null;this._safeSpacing=r,this._trackPhysics=i,this._differentailPhysics=n,this._netLengthPhysics=s,this._blindViaPhysics=o,this._radiusPhysics=l,this._innerPlane=u,this._copperPlane=h,this._solderExpansion=c,this._pasteExpansion=f,this._netClassName=d,this._equalLengthGroupName=p,this._netDifferentailName=m,this._showRatline=g,this._color=x}hasNet(e){return this.name!=null&&this.name==e}get color(){return this._color}set color(e){this._color=e}get showRatline(){return this._showRatline}set showRatline(e){this._showRatline=e}get netLengthPhysics(){return this._netLengthPhysics}set netLengthPhysics(e){this._netLengthPhysics=e,this.equalLengthGroup!=null&&(this.equalLengthGroup.netLengthPhysics=e)}get netClass(){return ke.getInstance().getNetClass(this._netClassName)}set netClass(e){e!=null?this._netClassName=e.name:this._netClassName=null}get equalLengthGroup(){return ke.getInstance().getEqualLengthGroup(this._equalLengthGroupName)}set equalLengthGroup(e){e!=null?this._equalLengthGroupName=e.name:this._equalLengthGroupName=null}get differentailPhysics(){return this._differentailPhysics}set differentailPhysics(e){this._differentailPhysics=e,this.netDifferentail!=null&&(this.netDifferentail.differentailPhysics=e)}get netDifferentail(){return ke.getInstance().getNetDifferential(this._netDifferentailName)}set netDifferentail(e){e!=null?this._netDifferentailName=e.name:this._netDifferentailName=null}get isPositiveNet(){return this.netDifferentail!=null?this.netDifferentail.positiveNet==this:!1}remove(){this.netClass!=null&&this.netClass.removeNetwork(this._name)}};var Oa=class extends wr{constructor(e,r=null,i=null,n="default"){super(e);this._positiveNet=null;this._negativeNet=null;this._differentailPhysics=null;this._positiveNet=r,this._negativeNet=i,this._differentailPhysics=n}hasNet(e){return this._positiveNet!=null&&this._positiveNet==e||this._negativeNet!=null&&this._negativeNet==e}get positiveNet(){return ke.getInstance().getNet(this._positiveNet)}set positiveNet(e){this._positiveNet=e==null?void 0:e.name}get negativeNet(){return ke.getInstance().getNet(this._negativeNet)}set negativeNet(e){this._negativeNet=e==null?void 0:e.name}get differentailPhysics(){return this._differentailPhysics}set differentailPhysics(e){this._differentailPhysics=e}addNetDifferentail(e){e.netDifferentail=this}removeNetDifferentail(e){this._positiveNet==e&&this.positiveNet!=null&&(this.positiveNet.netDifferentail=null),this._negativeNet==e&&this.negativeNet!=null&&(this.negativeNet.netDifferentail=null)}getAllNets(){let e=new Array;return this.positiveNet!=null&&e.push(this.positiveNet),this.negativeNet!=null&&e.push(this.negativeNet),e}remove(){this.removeNetDifferentail(this._positiveNet),this.removeNetDifferentail(this._negativeNet)}fillPositiveNet(e){this._positiveNet=e==null?void 0:e.name,this.addNetDifferentail(e)}fillNegativeNet(e){this._negativeNet=e==null?void 0:e.name,this.addNetDifferentail(e)}};var Hs=class extends Xr{static build(t,e,r,i,n=!0){let s=z(n,Hs.Blength).fill(0);return s[0]=e?1:0,s[1]=r,s[3]=i,new Hs(t,s)}get isDefault(){return!!this.buffer[0]}set isDefault(t){this.updateBuffer(0,[Number(t)])}get netLengthMin(){return this.buffer[1]}set netLengthMin(t){this.updateBuffer(1,[t])}get netLengthMax(){return this.buffer[3]}set netLengthMax(t){this.updateBuffer(3,[t])}clone(t=!0){let e=z(t,Hs.Blength);return e.set(this.buffer),new Hs(this.name,e)}},zs=Hs;zs.Blength=3+1;var _i=class extends Ws{constructor(e,r="default",i="default",n="default",s="default",o="default",l="default",u="default",h="default",c="default",f="default",d=new Set){super(e);this._nets=new Set;this.update(r,i,n,s,o,l,u,h,c,f,d)}update(e="default",r="default",i="default",n="default",s="default",o="default",l="default",u="default",h="default",c="default",f=new Set){this._safeSpacing=e,this._trackPhysics=r,this._differentailPhysics=i,this._netLengthPhysics=n,this._blindViaPhysics=s,this._radiusPhysics=o,this._innerPlane=l,this._copperPlane=u,this._solderExpansion=h,this._pasteExpansion=c,this._nets.clear(),F.addAllSet(this._nets,f)}hasNet(e){return this._nets.has(e)}addNetwork(e){this._nets.add(e.name),e.netClass=this}getNet(e){return this._nets.has(e)?ke.getInstance().getNet(e):null}removeNetwork(e){if(this._nets.has(e)){let r=ke.getInstance().getNet(e);r!=null&&r.netClass===this&&(r.netClass=null),this._nets.delete(e)}}getAllNets(){let e=new Array;for(let r of this._nets){let i=ke.getInstance().getNet(r);e.push(i)}return e}remove(){for(let e of this._nets){let r=ke.getInstance().getNet(e);r!=null&&r.netClass===this&&(r.netClass=null)}this._nets.clear()}};var Ys=class extends qr{};var Yd=(e=>(e[e.isDefault=0]="isDefault",e[e.clearances=1]="clearances",e))(Yd||{}),dn=class extends Ys{static build(t,e=!1,r=[0,1],i=[0,0],n=!0){let s=z(n,r.length+1);s[0]=e?1:0;for(let o=0;o<r.length;o++)s[r[o]+1]=i[o];return new dn(t,s)}get isDefault(){return this.buffer[0]==1}set isDefault(t){this.updateBuffer(0,[t?1:0])}get clearances(){let t=[];return this.buffer.forEach((e,r)=>{r>=1&&t.push(e)}),t}set clearances(t){t.forEach((e,r)=>{this.updateBuffer(r+1,[e])})}get deviceClearance(){return this.buffer[0+1]}get thru2SmdClearance(){return this.buffer[1+1]||0}clone(t=!0){let e=z(t,this.buffer.length);return e.set(this.buffer),new dn(this.name,e)}};var qs=class extends qr{};var Xs=class extends qs{static build(t,e=!1,r=0,i=0,n=-100,s=-100,o=!0){let l=z(o,Xs.Blength).fill(0);return l[0]=e?1:0,l[1]=r,l[2]=i,l[3]=n,l[4]=s,new Xs(t,l)}get isDefault(){return this.buffer[0]==1}set isDefault(t){this.updateBuffer(0,[t?1:0])}get padTopExpansion(){return this.buffer[1]}set padTopExpansion(t){this.updateBuffer(1,[t])}get padBottomExpansion(){return this.buffer[2]}set padBottomExpansion(t){this.updateBuffer(2,[t])}get testPointTopExpansion(){return this.buffer[3]}set testPointTopExpansion(t){this.updateBuffer(3,[t])}get testPointBottomExpansion(){return this.buffer[4]}set testPointBottomExpansion(t){this.updateBuffer(4,[t])}clone(t=!0){let e=z(t,Xs.Blength);return e.set(this.buffer),new Xs(this.name,e)}},Ks=Xs;Ks.Blength=4+1;var Zs=class extends Xr{static build(t,e=!1,r=Nn(.025),i=Nn(.0305),n=Nn(.5),s=Nn(.015),o=Nn(.01525),l=Nn(.3),u=!0){let h=z(u,Zs.Blength).fill(0);return h[0]=e?1:0,h[1]=r,h[2]=i,h[3]=n,h[4]=s,h[5]=o,h[6]=l,new Zs(t,h)}get isDefault(){return this.buffer[0]==1}set isDefault(t){this.updateBuffer(0,[t?1:0])}get minRadius(){return this.buffer[1]}set minRadius(t){this.updateBuffer(1,[t])}get defalutRadius(){return this.buffer[2]}set defalutRadius(t){this.updateBuffer(2,[t])}get maxRadius(){return this.buffer[3]}set maxRadius(t){this.updateBuffer(3,[t])}get minInner(){return this.buffer[4]}set minInner(t){this.updateBuffer(4,[t])}get defalutInner(){return this.buffer[5]}set defalutInner(t){this.updateBuffer(5,[t])}get maxInner(){return this.buffer[6]}set maxInner(t){this.updateBuffer(6,[t])}clone(t=!0){let e=z(t,Zs.Blength);return e.set(this.buffer),new Zs(this.name,e)}},js=Zs;js.Blength=6+1;var mn=class extends wr{constructor(e,r="default",i="default"){super(e);this._regionType="region";this._safeClearance=null;this._otherClearance=null;this._track=null;this._diff=null;this._radius=null;this._innerPlane=null;this._copperPlane=null;this._innerPlane=r,this._copperPlane=i}static build(e,r="region"){let i=new mn(e);return i._regionType=r,i}get regionType(){return this._regionType}get safeClearance(){return this._safeClearance}set safeClearance(e){this._safeClearance=e}get otherClearance(){return this._otherClearance}set otherClearance(e){this._otherClearance=e}get track(){return this._track}set track(e){this._track=e}get diff(){return this._diff}set diff(e){this._diff=e}get radius(){return this._radius}set radius(e){this._radius=e}get innerPlane(){return this._innerPlane}set innerPlane(e){this._innerPlane=e}get copperPlane(){return this._copperPlane}set copperPlane(e){this._copperPlane=e}toJSON(){return{safeClearance:this.safeClearance,otherClearance:this.otherClearance,track:this.track,diff:this.diff,radius:this.radius,innerPlane:this.innerPlane,copperPlane:this.copperPlane}}};var Xd=[.6,-1,-1,-1,-1,-1,-1,.6,.6,-1,-1,-1,-1,-1,.6,.6,.6,-1,-1,-1,-1,.6,.6,.6,.6,-1,-1,-1,.6,.6,.6,.6,.6,-1,-1,.6,.6,.6,.6,.6,.6,-1,.6,.6,.6,.6,.6,.6,.6,1.18,1.18,1.18,1.18,1.18,1.18,1.18],Kd=[0,1,2,3,4,5,6],Zd=[0,1,2,3,4,5,6,7],Da=8,Hl=7,jd=7,Qd=Kd,$d=Zd,bn=class extends Ys{static build(t,e=!1,r=Xd,i=!0){let n=cn(i,(r.length+1)*8);return n[0]=e?1:0,n.set(r,1),new bn(t,n)}get isDefault(){return this.buffer[0]==1}set isDefault(t){this.updateBuffer(0,[t?1:0])}get data(){let t=new Array;for(let e=0;e<Da;e++){let r=new Array;for(let i=0;i<Hl&&i<=e;i++)r.push(this.buffer[this.getPosition(e,i)]);t.push(r)}return t}setData(t){this.buffer[0]=this.isDefault?1:0,this.buffer.set(t,1)}modifyClearance(t,e,r){this.updateBuffer(this.getPosition(t,e),[r])}modifyAllClearance(t){for(let e=0;e<Da;e++)for(let r=0;r<Hl&&r<=e;r++)this.modifyClearance(e,r,t)}modifyRowClearance(t,e){for(let r=0;r<Hl&&r<=t;r++)this.modifyClearance(t,r,e)}modifyColClearance(t,e){for(let r=t;r<Da;r++)this.modifyClearance(r,t,e)}getClearance(t,e){return t>=e?this.buffer[this.getPosition(t,e)]||0:this.buffer[this.getPosition(e,t)]||0}getRowLabel(){let t=new Array;for(let e of Qd){let r=this.getLabel(e);t.push(r)}return t}getColLabel(){let t=new Array;for(let e of $d){let r=this.getLabel(e);t.push(r)}return t}remove(){Ts(this.buffer),this.buffer=null}getPosition(t,e){return t*jd+e+1}getLabel(t){switch(t){case 0:return"Track";case 1:return"Pad";case 2:return"Via";case 3:return"Fill Region/Teardrop";case 4:return"Slot Region";case 5:return"Line";case 6:return"Text/Image";case 7:return"Board Outline"}}getType(t){switch(t){case"Track":return 0;case"Pad":return 1;case"Via":return 2;case"Fill Region/Teardrop":return 3;case"Slot Region":return 4;case"Line":return 5;case"Text/Image":return 6;case"Board Outline":return 7}}getMaxClearance(){let t=0;for(let e=0;e<Da;e++)for(let r=0;r<Hl&&r<=e;r++){let i=this.buffer[this.getPosition(e,r)];i>t&&(t=i)}return t}getItemMaxClearance(t){let e=0;for(let r=0;r<Da;r++){let i=this.getClearance(r,t);e=Math.max(e,i)}return e}clone(t=!0){let e=cn(t,this.buffer.byteLength);return e.set(this.buffer),new bn(this.name,e)}};var Qs=class extends qs{static build(t,e=!1,r=.2,i=.2,n=.2,s=.2,o=-100,l=-100,u=!0){let h=z(u,Qs.Blength).fill(0);return h[0]=e?1:0,h[1]=r,h[2]=i,h[3]=n,h[4]=s,h[5]=o,h[6]=l,new Qs(t,h)}get isDefault(){return this.buffer[0]==1}set isDefault(t){this.updateBuffer(0,[t?1:0])}get padTopExpansion(){return this.buffer[1]}set padTopExpansion(t){this.updateBuffer(1,[t])}get padBottomExpansion(){return this.buffer[2]}set padBottomExpansion(t){this.updateBuffer(2,[t])}get testPointTopExpansion(){return this.buffer[3]}set testPointTopExpansion(t){this.updateBuffer(3,[t])}get testPointBottomExpansion(){return this.buffer[4]}set testPointBottomExpansion(t){this.updateBuffer(4,[t])}get viaTopExpansion(){return this.buffer[5]}set viaTopExpansion(t){this.updateBuffer(5,[t])}get viaBottomExpansion(){return this.buffer[6]}set viaBottomExpansion(t){this.updateBuffer(6,[t])}clone(t=!0){let e=z(t,Qs.Blength);return e.set(this.buffer),new Qs(this.name,e)}},$s=Qs;$s.Blength=6+1;var Js=class extends Xr{static build(t,e,r,i,n,s=!0){let o=z(s,Js.Blength).fill(0);return o[0]=e?1:0,o[1]=r,o[2]=i,o[3]=n,new Js(t,o)}get isDefault(){return!!this.buffer[0]}set isDefault(t){this.updateBuffer(0,[Number(t)])}get minWidth(){return this.buffer[1]}set minWidth(t){this.updateBuffer(1,[t])}get defaultWidth(){return this.buffer[2]}set defaultWidth(t){this.updateBuffer(2,[t])}get maxWidth(){return this.buffer[3]}set maxWidth(t){this.updateBuffer(3,[t])}clone(t=!0){let e=z(t,Js.Blength);return e.set(this.buffer),new Js(this.name,e)}},eo=Js;eo.Blength=3+1;var Jd=(i=>(i[i.START=0]="START",i[i.ROUTING=1]="ROUTING",i[i.END=2]="END",i[i.INTERRUPT=3]="INTERRUPT",i))(Jd||{}),lf=(r=>(r[r.All=0]="All",r[r.SelectNets=1]="SelectNets",r[r.SelectComponents=2]="SelectComponents",r))(lf||{}),em=(r=>(r[r.FOURTYFIVE=0]="FOURTYFIVE",r[r.NINETY=1]="NINETY",r[r.NINETYARC=2]="NINETYARC",r))(em||{}),tm=(o=>(o[o.Default=0]="Default",o[o.Random=1]="Random",o[o.CustomNetFirst=2]="CustomNetFirst",o[o.PadsMoreFirst=3]="PadsMoreFirst",o[o.PadsLessFirst=4]="PadsLessFirst",o[o.PadsFarFirst=5]="PadsFarFirst",o[o.PadsNearFirst=6]="PadsNearFirst",o))(tm||{}),rm=(e=>(e[e.SpeedFirst=0]="SpeedFirst",e[e.CompletionFirst=1]="CompletionFirst",e))(rm||{}),im=(r=>(r[r.LESS=0]="LESS",r[r.MID=1]="MID",r[r.MORE=2]="MORE",r))(im||{}),uf={routingRange:0,routingCorner:0,isKeep:!0,viaQuatity:0,routingEffectPriority:1,routingNetPriority:0,layers:[1,2,12],ignoreNets:[]};var to=class extends qr{constructor(e,r,i,n){super(e,n);this.layers=r,this.ignoreNets=i,this.buffer=n}static build(e,r,i,n,s,o,l,u,h=!1,c=!0){let f=z(c,to.Blength).fill(0);return f[0]=h?1:0,f[1]=n,f[2]=s?1:0,f[3]=o,f[4]=l,f[5]=u,new to(e,r,i,f)}get isDefault(){return this.buffer[0]==1}set isDefault(e){this.updateBuffer(0,[e?1:0])}get routingCorner(){return this.buffer[1]}set routingCorner(e){this.updateBuffer(1,[e])}get isKeep(){return!!this.buffer[2]}set isKeep(e){this.updateBuffer(2,[e?1:0])}get viaQuatity(){return this.buffer[3]}set viaQuatity(e){this.updateBuffer(3,[e])}get routingEffectPriority(){return this.buffer[4]}set routingEffectPriority(e){this.updateBuffer(4,[e])}get routingNetPriority(){return this.buffer[5]}set routingNetPriority(e){this.updateBuffer(5,[e])}get config(){return{routingRange:0,layers:this.layers,ignoreNets:this.ignoreNets,routingCorner:this.routingCorner,isKeep:this.isKeep,viaQuatity:this.viaQuatity,routingEffectPriority:this.routingEffectPriority,routingNetPriority:this.routingNetPriority}}updateConfig(e){Object.assign(this,e)}clone(e=!0){let r=z(e,to.Blength);return r.set(this.buffer),new to(this.name,[...this.layers],[...this.ignoreNets],r)}},ro=to;ro.Blength=5+1;var bi=class{constructor(t,e){this._pad1=t,this._pad2=e}static createPadItemJSON(t,e,r,i,n=""){return{id:i||"",isDissociate:t,designator:e,number:r,nets:[],belongDeiviceId:n}}static createPadItemShowTitle(t){return t.isDissociate?t.id:t.designator?`${t.designator}:${t.number}`:t.belongDeiviceId?`${t.belongDeiviceId}:${t.number}`:t.id}get pad1Title(){return this._pad1}get pad2Title(){return this._pad2}get parent(){return this._parent}get pad1(){return this.createPadItemJSON(this._pad1)}get pad2(){return this.createPadItemJSON(this._pad2)}createPadItemJSON(t){if(t==null)return null;let e="",r="",i=!0,n="";return t.indexOf(":")>=0?(e=t.split(":")[0],r=t.split(":")[1],i=!1):n=t,bi.createPadItemJSON(i,e,r,n)}set parent(t){this._parent=t}toJSON(){return{pad1:this.pad1,pad2:this.pad2}}};var Yn=class extends wr{constructor(e,r=[]){super(e);this._number=e+rc(),this._details=r,this.details.forEach(i=>{i.parent=this})}static build(e){return new Yn(e)}get groupName(){return this._name}set groupName(e){this._name=e}get details(){return this._details}set details(e){this._details=e}get groupColor(){return this._groupColor}set groupColor(e){this._groupColor=e}get number(){return this._number}deletePadsPairGroupDetailItemByPairName(e,r="-"){let i=-1;for(let n=0;n<this.details.length;n++){let s=bi.createPadItemShowTitle(this.details[n].pad1),o=bi.createPadItemShowTitle(this.details[n].pad2);if(`${s}${r}${o}`===e){i=n;break}}if(i<=-1)return!1;this.details.splice(i,1)}updatePadsPairGroupDetails(e){return this.details=e,this.details.forEach(r=>{r.parent=this}),this.details}toJSON_ofDeatails(){let e=[];return this.details.forEach(r=>{e.push({pad1:r.toJSON().pad1,pad2:r.toJSON().pad2})}),e}};var Et=class{static isHexFormate(t){return!t||typeof t!="string"?!1:/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)}static of1(t){return this.of2(t>>16&255,t>>8&255,t&255)}static of2(t,e,r,i=255){return new Et(t/255,e/255,r/255,i/255)}static of3(t){t.startsWith("#")&&(t=t.substr(1));let e=t.length;if(e==3)return new Et(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15);if(e==6)return new Et(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255);if(e==8)return new Et(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,parseInt(t.substr(6,2),16)/255);throw new Error("invalid color string")}static of4(t){let e=parseInt(t.r*255+"").toString(16),r=parseInt(t.g*255+"").toString(16),i=parseInt(t.b*255+"").toString(16);return e.length<2&&(e="0"+e),r.length<2&&(r="0"+r),i.length<2&&(i="0"+i),("#"+e+r+i).toUpperCase()}static of5(t,e){if(t.startsWith("#")&&(t=t.substr(1)),t.length==3)return new Et(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15,e);if(t.length==6)return new Et(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,e);throw new Error("invalid color string")}static of6(t,e){return new Et(t.r,t.g,t.b,e)}static of7(t){return t==null?null:Et.of3(t)}constructor(t,e,r,i=1){this.r=D.positiveOr0(t),this.g=D.positiveOr0(e),this.b=D.positiveOr0(r),this.alpha=i}hashCode(){return this.r+this.g+this.b+this.alpha}equals(t,e=!1){let r=this.r===t.r&&this.g===t.g&&this.b===t.b;return e?r:r&&this.alpha===t.alpha}add(t,e,r,i){return new Et(Math.max(0,Math.min(1,this.r+t)),Math.max(0,Math.min(1,this.g+e)),Math.max(0,Math.min(1,this.b+r)),Math.max(0,Math.min(1,this.alpha+i)))}mul(t){return new Et(Math.max(0,Math.min(1,this.r*t)),Math.max(0,Math.min(1,this.g*t)),Math.max(0,Math.min(1,this.b*t)),this.alpha)}mul1(t){return new Et(Math.max(0,this.r*t),Math.max(0,this.g*t),Math.max(0,this.b*t),this.alpha)}getData(){return[this.r,this.g,this.b,this.alpha]}toString(){let t=(this.r*255).toString(16),e=(this.g*255).toString(16),r=(this.b*255).toString(16);return t.length<2&&(t="0"+t),e.length<2&&(e="0"+e),r.length<2&&(r="0"+r),"#"+t.substr(0,2)+e.substr(0,2)+r.substr(0,2)}toString1(){let t=(this.r*255).toString(16),e=(this.g*255).toString(16),r=(this.b*255).toString(16),i=(this.alpha*255).toString(16);return t.length<2&&(t="0"+t),e.length<2&&(e="0"+e),r.length<2&&(r="0"+r),i.length<2&&(i="0"+i),"#"+t.substr(0,2)+e.substr(0,2)+r.substr(0,2)+i.substr(0,2)}toRGBA(){let t=this.r*255,e=this.g*255,r=this.b*255;return[t,e,r,this.alpha]}toRGBAString(){let t=this.r*255,e=this.g*255,r=this.b*255;return`rgba(${t},${e},${r},${this.alpha})`}isWHITE(){return this.r===1&&this.g===1&&this.b===1&&this.alpha===1}},Ge=Et;Ge.WHITE=new Et(1,1,1,1),Ge.BLACK=new Et(0,0,0,1),Ge.RED=new Et(1,0,0,1),Ge.GREEN=new Et(0,1,0,1),Ge.BLUE=new Et(0,0,1,1),Ge.Gray=Et.of3("#9966ff"),Ge.Silver=Et.of3("#D2D2D2"),Ge.Golden=Et.of3("#DCAA14");var Ae=class extends be{constructor(){super();this.safeSpacings={};this.otherSpacings={};this.trackPhysics={};this.netLengthPhysics={};this.differentialPhysics={};this.blindViaPhysics={};this.radiusPhysics={};this.innerPlanes={};this.copperPlanes={};this.solderExpansions={};this.pasteExpansions={};this.nets={};this.netClass={};this.netDifferentials={};this.regionSelectors={};this.autoRouters={};this.equalLengthGroups={};this.padsPairGroups={};this.betweenNetRule=new Wl("");this.ruleTemplateName=""}static getInstance(){return Ae.manager==null&&(Ae.manager=new Ae),Ae.manager}correctRuleData(){let e=.01,r=Ae.getInstance().getAllTrackPhysics();for(let i of r)i.minWidth=Math.max(i.minWidth,e),i.maxWidth=Math.max(i.maxWidth,e),i.defaultWidth=Math.max(i.defaultWidth,i.minWidth),i.defaultWidth=Math.min(i.defaultWidth,i.maxWidth)}correctDefault(){let e="Common";if(Ae.getInstance().getDefaultSafeSpacing()==null){let x=Ae.getInstance().getAllSafeSpacing();if(x.size>0)for(let y of x){y.isDefault=!0;break}else{let y=Ae.getInstance().addSafeSpacing("safeClearance");y.isDefault=!0}}if(Ae.getInstance().getDefaultOtherSpacing()==null){let x=Ae.getInstance().getAllOtherSpacing();if(x.size>0)for(let y of x){y.isDefault=!0;break}else{let y=Ae.getInstance().addOtherSpacing("otherClearance");y.isDefault=!0}}if(Ae.getInstance().getDefaultTrackPhysics()==null){let x=Ae.getInstance().getAllTrackPhysics();if(x.size>0)for(let y of x){y.isDefault=!0;break}else{let y=Ae.getInstance().addTrackPhysics("trackWidth");y.isDefault=!0}}if(Ae.getInstance().getDefaultNetLengthPhysics()==null){let x=Ae.getInstance().getAllNetLengthPhysics();if(x.size>0)for(let y of x){y.isDefault=!0;break}else{let y=Ae.getInstance().addNetLengthPhysics("netLength");y.isDefault=!0}}if(Ae.getInstance().getDefaultDifferentailPhysics()==null){let x=Ae.getInstance().getAllDifferentailPhysics();if(x.size>0)for(let y of x){y.isDefault=!0;break}else{let y=Ae.getInstance().addDifferentialPhysics("differentialPair");y.isDefault=!0}}if(Ae.getInstance().getDefaultBlindPhysics()==null){let x=Ae.getInstance().getAllBlindPhysics();if(x.size>0)for(let y of x){y.isDefault=!0;break}else{let y=Ae.getInstance().addBlindPhysics("blindVia");y.isDefault=!0}}if(Ae.getInstance().getDefaultRadiusPhysics()==null){let x=Ae.getInstance().getAllRadiusPhysics();if(x.size>0)for(let y of x){y.isDefault=!0;break}else{let y=Ae.getInstance().addRadiusPhysics("viaSize");y.isDefault=!0}}if(Ae.getInstance().getDefaultInnerPlane()==null){let x=Ae.getInstance().getAllInnerPlane();if(x.size>0)for(let y of x){y.isDefault=!0;break}else{let y=Ae.getInstance().addInnerPlane("innerPlane");y.isDefault=!0}}if(Ae.getInstance().getDefaultCopperPlane()==null){let x=Ae.getInstance().getAllCopperPlane();if(x.size>0)for(let y of x){y.isDefault=!0;break}else{let y=Ae.getInstance().addCopperPlane("copperRegion");y.isDefault=!0}}if(Ae.getInstance().getDefaultSolderExpansion()==null){let x=Ae.getInstance().getAllSolderExpansion();if(x.size>0)for(let y of x){y.isDefault=!0;break}else{let y=Ae.getInstance().addSolderExpansion("solderMaskExpansion");y.isDefault=!0}}if(Ae.getInstance().getDefaultPasteExpansion()==null){let x=Ae.getInstance().getAllPasteExpansion();if(x.size>0)for(let y of x){y.isDefault=!0;break}else{let y=Ae.getInstance().addPasteExpansion("pasteMaskExpansion");y.isDefault=!0}}this.getDefaultAutoRouter()==null&&(this.addAutoRouter(e).isDefault=!0);let m=Ae.getInstance().getAllNetDifferentails(),g=new Array;for(let x of m)(x.negativeNet==null||x.positiveNet==null)&&g.push(x.name);Ae.getInstance().deleteNetDifferentail(g)}addAutoRouterByBuffer(e,r,i,n){let s=this.autoRouters[e];return s!=null?(s.layers=r,s.ignoreNets=i):(s=new ro(e,r,i,n),this.autoRouters[e]=s),s}addSafeSpacingByBuffer(e,r){let i=this.safeSpacings[e];return i!=null?i.buffer=r:(i=new bn(e,r),this.safeSpacings[e]=i),i}addOtherSpacingByBuffer(e,r){let i=this.otherSpacings[e];return i!=null?i.buffer=r:(i=new dn(e,r),this.otherSpacings[e]=i),i}addTrackPhysicsByBuffer(e,r){let i=this.trackPhysics[e];return i!=null?i.buffer=r:(i=new eo(e,r),this.trackPhysics[e]=i),i}addDifferentialPhysicsByBuffer(e,r){let i=this.differentialPhysics[e];return i!=null?i.buffer=r:(i=new Us(e,r),this.differentialPhysics[e]=i),i}addNetLengthPhysicsByBuffer(e,r){let i=this.netLengthPhysics[e];return i!=null?i.buffer=r:(i=new zs(e,r),this.netLengthPhysics[e]=i),i}addBlindPhysicsByBuffer(e,r,i){let n=this.blindViaPhysics[e];return n!=null?n.update(r,i):(n=new Ds(e,r,i),this.blindViaPhysics[e]=n),n}addRadiusPhysicsByBuffer(e,r){let i=this.radiusPhysics[e];return i!=null?i.buffer=r:(i=new js(e,r),this.radiusPhysics[e]=i),i}addInnerPlaneByBuffer(e,r){let i=this.innerPlanes[e];return i!=null?i.buffer=r:(i=new Gs(e,r),this.innerPlanes[e]=i),i}addCopperPlaneByBuffer(e,r){let i=this.copperPlanes[e];return i!=null?i.buffer=r:(i=new Hn(e,r),this.copperPlanes[e]=i),i}addSolderExpansionByBuffer(e,r){let i=this.solderExpansions[e];return i!=null?i.buffer=r:(i=new $s(e,r),this.solderExpansions[e]=i),i}addPasteExpansionByBuffer(e,r){let i=this.pasteExpansions[e];return i!=null?i.buffer=r:(i=new Ks(e,r),this.pasteExpansions[e]=i),i}addNetByBuffer(e,r="default",i="default",n="default",s="default",o="default",l="default",u="default",h="default",c="default",f="default",d=null,p=null,m=null,g=!1,x=null){if(e==null)return null;let y=this.nets[e];return y==null?(y=new zn(e,r,i,n,s,o,l,u,h,c,f,d,p,m,g,x),this.nets[e]=y):(y.safeSpacing=r,y.trackPhysics=i,y.differentailPhysics=n,y.netLengthPhysics=s,y.blindViaPhysics=o,y.radiusPhysics=l,y.innerPlane=u,y.copperPlane=h,y.solderExpansion=c,y.pasteExpansion=f,y.showRatline=g,y.color=x),y}addRegionSelectorByBuffer(e,r,i,n,s,o,l,u){let h=this.regionSelectors[e];return h==null&&(h=mn.build(e),this.regionSelectors[e]=h),h.safeClearance=r,h.otherClearance=i,h.track=n,h.diff=s,h.radius=o,h.innerPlane=l,h.copperPlane=u,h}addNetClassByBuffer(e,r,i,n,s,o,l,u,h,c,f,d){let p=this.netClass[e];return p!=null?p.update(r,i,n,s,o,l,u,h,c,f,new Set(d)):(p=new _i(e,r,i,n,s,o,l,u,h,c,f,new Set(d)),this.netClass[e]=p),p}addNetDifferentailByBuffer(e,r,i,n){let s=this.netDifferentials[e];if(s==null&&(s=new Oa(e),this.netDifferentials[e]=s),r){let o=this.getNet(r);s.fillPositiveNet(o)}if(i){let o=this.getNet(i);s.fillNegativeNet(o)}return n&&(s.differentailPhysics=n),s}addEqualLengthGroupByBuffer(e,r,i){let n=this.equalLengthGroups[e];return n!=null?n.update(r,new Set(i)):(n=new _a(e,r,new Set(i)),this.equalLengthGroups[e]=n),n}addPadsPairByBuffer(e,r){let i=this.padsPairGroups[e];if(i==null){let n=new Array;for(let o of r){let l=new bi(o[0],o[1]);n.push(l)}let s=new Yn(e,n);this.padsPairGroups[e]=s}else{let n=new Array;for(let s of r){let o=new bi(s[0],s[1]);n.push(o)}return i.updatePadsPairGroupDetails(n),i}}addAutoRouter(e,r){let i=Object.assign({},uf,r),n=ro.build(e,i.layers,i.ignoreNets,i.routingCorner,i.isKeep,i.viaQuatity,i.routingEffectPriority,i.routingNetPriority);return this.autoRouters[e]=n,this.survive(e),n}addSafeSpacing(e){let r=bn.build(e);return this.safeSpacings[e]=r,this.survive(e),r}addOtherSpacing(e){let r=dn.build(e);return this.otherSpacings[e]=r,this.survive(e),r}addTrackPhysics(e,r=!1,i=.5,n=1,s=10){let o=eo.build(e,r,i,n,s);return this.trackPhysics[e]=o,this.survive(e),o}addDifferentialPhysics(e,r=!1,i=.5,n=1,s=10,o=.6,l=.6,u=5,h=1){let c=Us.build(e,r,i,n,s,o,l,u,h);return this.differentialPhysics[e]=c,this.survive(e),c}addNetLengthPhysics(e,r=!1,i=0,n=0){let s=zs.build(e,r,i,n);return this.netLengthPhysics[e]=s,this.survive(e),s}addBlindPhysics(e){let r=Ds.build(e,!1);return this.blindViaPhysics[e]=r,this.survive(e),r}addRadiusPhysics(e){let r=js.build(e);return this.radiusPhysics[e]=r,this.survive(e),r}addInnerPlane(e){let r=Gs.build(e);return this.innerPlanes[e]=r,this.survive(e),r}addCopperPlane(e){let r=Hn.build(e);return this.copperPlanes[e]=r,this.survive(e),r}addSolderExpansion(e){let r=$s.build(e);return this.solderExpansions[e]=r,this.survive(e),r}addPasteExpansion(e){let r=Ks.build(e);return this.pasteExpansions[e]=r,this.survive(e),r}addNet(e){if(e==null)return null;let r=this.nets[e];return r==null&&(r=new zn(e),this.nets[e]=r),r}addRegionSelector(e){let r=this.regionSelectors[e];return r==null&&(r=mn.build(e),this.regionSelectors[e]=r),r}addConstraintSelector(e){let r=this.regionSelectors[e];return r==null&&(r=mn.build(e,"constraint"),this.regionSelectors[e]=r,r.safeClearance=null,r.otherClearance=null,r.track=null,r.diff=null,r.radius=null,r.innerPlane=null,r.copperPlane=null),r}updateRegionSelector(e,r){let i=this.getRegion(e);if(i==null)return;let n=[],{safeClearance:s,otherClearance:o,track:l,diff:u,radius:h,innerPlane:c,copperPlane:f}=r;return r.safeClearance!==void 0&&(!s||!this.getSafeSpacing(s)?(i.safeClearance=null,s&&n.push({type:"Safe Spacing",name:s})):i.safeClearance=s),r.otherClearance!==void 0&&(!o||!this.getOtherSpacing(o)?(i.otherClearance=null,o&&n.push({type:"Other Spacing",name:o})):i.otherClearance=o),r.track!==void 0&&(!l||!this.getTrackPhysics(l)?(i.track=null,l&&n.push({type:"Track",name:l})):i.track=l),r.diff!==void 0&&(!u||!this.getDifferentailPhysics(u)?(i.diff=null,u&&n.push({type:"Differential Pair",name:u})):i.diff=u),r.radius!==void 0&&(!h||!this.getRadiusPhysics(h)?(i.radius=null,h&&n.push({type:"Via Size",name:h})):i.radius=h),r.innerPlane!==void 0&&(!c||!this.getInnerPlane(c)?(i.innerPlane=null,c&&n.push({type:"Plane Zone",name:c})):i.innerPlane=c),r.copperPlane!==void 0&&(!f||!this.getCopperPlane(f)?(i.copperPlane=null,f&&n.push({type:"Copper Zone",name:f})):i.copperPlane=f),n}addNetClass(e){let r=new _i(e);return this.netClass[e]=r,r}addNetDifferentail(e,r,i,n){let s=new Oa(e);if(this.netDifferentials[e]=s,r){let o=this.getNet(r);s.fillPositiveNet(o)}if(i){let o=this.getNet(i);s.fillNegativeNet(o)}return n&&(s.differentailPhysics=n),s}addEqualLengthGroup(e){let r=new _a(e);return this.equalLengthGroups[e]=r,r}getSafeSpacing(e){return this.getRule(this.safeSpacings,e)}getNetClearance(){return this.getDefaultSafeSpacing().data[0][0]}getOtherSpacing(e){return this.getRule(this.otherSpacings,e)}getTrackPhysics(e){return this.getRule(this.trackPhysics,e)}getTrackWidth(){return this.getDefaultTrackPhysics().defaultWidth}getDifferentailPhysics(e){return this.getRule(this.differentialPhysics,e)}getNetLengthPhysics(e){return this.getRule(this.netLengthPhysics,e)}getBlindPhysics(e){return this.getRule(this.blindViaPhysics,e)}getRadiusPhysics(e){return this.getRule(this.radiusPhysics,e)}getViaDiameter(){return this.getDefaultRadiusPhysics().defalutRadius*2}getViaHoleD(){return this.getDefaultRadiusPhysics().defalutInner*2}getInnerPlane(e){return this.getRule(this.innerPlanes,e)}getCopperPlane(e){return this.getRule(this.copperPlanes,e)}getSolderExpansion(e){return this.getRule(this.solderExpansions,e)}getPasteExpansion(e){return this.getRule(this.pasteExpansions,e)}getMaxSafe(){let e=this.getDefaultSafeSpacing().getMaxClearance();return Object.values(this.safeSpacings).forEach(r=>{let i=r.getMaxClearance();i>e&&(e=i)}),e}getItemMaxClearance(e){switch(e){case 8:return this.getMaxCopper();case 9:return this.getMaxPlane();case 11:{let s=0;return Object.values(this.otherSpacings).forEach(o=>{s=Math.max(s,o.deviceClearance,o.thru2SmdClearance)}),s}case 10:return 0;default:let r=this.getMaxCopper(),i=this.getMaxPlane(),n=Math.max(r,i);return Object.values(this.safeSpacings).forEach(s=>{let o=s.getItemMaxClearance(e);n=Math.max(n,o)}),n}}getMaxCopper(){let e=this.getDefaultCopperPlane().getMaxClearance();return Object.values(this.copperPlanes).forEach(r=>{let i=r.getMaxClearance();i>e&&(e=i)}),e}getMaxPlane(){let e=this.getDefaultInnerPlane().getMaxClearance();return Object.values(this.innerPlanes).forEach(r=>{let i=r.getMaxClearance();i>e&&(e=i)}),e}getNet(e){return this.getRuleSelector(this.nets,e)}getSpecctraNetClass(){let e=[];for(let r of Object.keys(this.nets||{}))e.push({net:r,width:this.getTrackPhysics(this.nets[r].trackPhysics).defaultWidth,clearance:this.getSafeSpacing(this.nets[r].safeSpacing).data[0][0],viaHoleD:this.getRadiusPhysics(this.nets[r].radiusPhysics).defalutInner*2,viaHoleDiameter:this.getRadiusPhysics(this.nets[r].radiusPhysics).defalutRadius*2});return e}getNetClass(e){return this.netClass[e]}getNetDifferential(e){return this.netDifferentials[e]}getRegion(e){return this.regionSelectors[e]}getAutoRouter(e){return this.autoRouters[e]}getEqualLengthGroup(e){return this.equalLengthGroups[e]}deleteSafeSpacing(e){this._last=this.safeSpacings[e],this._last!=null&&(this._last.remove(),this.survive(this._last.name),delete this.safeSpacings[e])}deleteOtherSpacing(e){this._last=this.otherSpacings[e],this._last!=null&&(this._last.remove(),this.del(this._last.name),delete this.otherSpacings[e])}deleteTrackPhysics(e){this._last=this.trackPhysics[e],this._last!=null&&(this._last.remove(),this.del(this._last.name),delete this.trackPhysics[e])}deleteDifferentailPhysics(e){this._last=this.differentialPhysics[e],this._last!=null&&(this._last.remove(),this.del(this._last.name),delete this.differentialPhysics[e])}deleteNetLengthPhysics(e){this._last=this.netLengthPhysics[e],this._last!=null&&(this._last.remove(),this.del(this._last.name),delete this.netLengthPhysics[e])}deleteBlindPhysics(e){this._last=this.blindViaPhysics[e],this._last!=null&&(this._last.remove(),this.del(this._last.name),delete this.blindViaPhysics[e])}deleteRadiusPhysics(e){this._last=this.radiusPhysics[e],this._last!=null&&(this._last.remove(),this.del(this._last.name),delete this.radiusPhysics[e])}deleteInnerPlane(e){this._last=this.innerPlanes[e],this._last!=null&&(this._last.remove(),this.del(this._last.name),delete this.innerPlanes[e])}deleteCopperPlane(e){if(this._last=this.copperPlanes[e],this._last!=null){this._last.remove(),this.del(this._last.name);for(let r in this.nets){let i=this.nets[r];i.copperPlane==this._last.name&&(i.copperPlane="default")}for(let r of this.getAllCopperPlaneRegions())r.copperPlane==this._last.name&&(r.copperPlane="default");delete this.copperPlanes[e]}}deleteSolderExpansion(e){this._last=this.solderExpansions[e],this._last!=null&&(this._last.remove(),this.del(this._last.name),delete this.solderExpansions[e])}deletePasteExpansion(e){this._last=this.pasteExpansions[e],this._last!=null&&(this._last.remove(),this.del(this._last.name),delete this.pasteExpansions[e])}deleteAutoRouter(e){this._last=this.autoRouters[e],this._last!=null&&(this._last.remove(),this.del(this._last.name),delete this.autoRouters[e])}deleteNet(e){let r=this.nets[e];if(r==null)return;this.betweenNetRule.deltetRule4Net(r);let i=r.netClass;if(r.netDifferentail!=null){let n=r.netDifferentail;n.remove(),delete this.netDifferentials[n.name]}r!=null&&r.remove(),delete this.nets[e],i!=null&&i.getAllNets().length==0&&this.deleteNetClass(i.name)}deleteNetClass(e){let r=this.netClass[e];r.getAllNets().forEach(i=>{i.safeSpacing="default",i.trackPhysics="default",i.blindViaPhysics="default",i.radiusPhysics="default",i.innerPlane="default",i.copperPlane="default",i.solderExpansion="default",i.pasteExpansion="default"}),this.betweenNetRule.deltetRule4Net(r),r!=null&&r.remove(),delete this.netClass[e]}deleteNetDifferentail(e){e.forEach(r=>{let i=this.netDifferentials[r];i.getAllNets().forEach(n=>n.differentailPhysics="default"),i!=null&&i.remove(),delete this.netDifferentials[r]})}deleteRegion(e){delete this.regionSelectors[e]}deleteEqualLengthGroup(e){let r=this.equalLengthGroups[e];return r.getAllNets().forEach(i=>i.netLengthPhysics="default"),r!=null&&r.remove(),delete this.equalLengthGroups[e]}deletePadsPairGroup(e){delete this.padsPairGroups[e]}getDefaultSafeSpacing(){return this.getDefault(this.safeSpacings)}getDefaultOtherSpacing(){return this.getDefault(this.otherSpacings)}getDefaultTrackPhysics(){return this.getDefault(this.trackPhysics)}getDefaultDifferentailPhysics(){return this.getDefault(this.differentialPhysics)}getDefaultNetLengthPhysics(){return this.getDefault(this.netLengthPhysics)}getDefaultBlindPhysics(){return this.getDefault(this.blindViaPhysics)}getDefaultRadiusPhysics(){return this.getDefault(this.radiusPhysics)}getDefaultInnerPlane(){return this.getDefault(this.innerPlanes)}getDefaultCopperPlane(){return this.getDefault(this.copperPlanes)}getDefaultSolderExpansion(){return this.getDefault(this.solderExpansions)}getDefaultPasteExpansion(){return this.getDefault(this.pasteExpansions)}getDefaultAutoRouter(){return this.getDefault(this.autoRouters)}getAllSafeSpacing(){return this.getAll(this.safeSpacings)}getAllOtherSpacing(){return this.getAll(this.otherSpacings)}getAllTrackPhysics(){return this.getAll(this.trackPhysics)}getAllDifferentailPhysics(){return this.getAll(this.differentialPhysics)}getAllNetLengthPhysics(){return this.getAll(this.netLengthPhysics)}getAllBlindPhysics(){return this.getAll(this.blindViaPhysics)}getAllRadiusPhysics(){return this.getAll(this.radiusPhysics)}getAllInnerPlane(){return this.getAll(this.innerPlanes)}getAllCopperPlane(){return this.getAll(this.copperPlanes)}getAllSolderExpansion(){return this.getAll(this.solderExpansions)}getAllPasteExpansion(){return this.getAll(this.pasteExpansions)}getAllNets(){let e=new Set;for(let r in this.nets){let i=this.nets[r];e.add(i)}return e}getAllRegions(){let e=new Set;for(let r in this.regionSelectors){let i=this.regionSelectors[r];e.add(i)}return e}getAllCopperPlaneRegions(){let e=new Set;for(let r in this.regionSelectors){let i=this.regionSelectors[r];i.regionType==="region"&&e.add(i)}return e}getAllConstraintRegions(){let e=new Set;for(let r in this.regionSelectors){let i=this.regionSelectors[r];i.regionType==="constraint"&&e.add(i)}return e}getNoDifferentail(){let e=new Set;for(let r in this.nets){let i=this.nets[r];i.netDifferentail==null&&e.add(i)}return e}getAllNetClass(){return this.getAllSelector(this.netClass)}getAllEqualLengthGroups(){return this.getAllSelector(this.equalLengthGroups)}getAllNetDifferentails(){return this.getAllSelector(this.netDifferentials)}getAllAutoRouterRules(){return this.getAll(this.autoRouters)}getAll(e){let r=new Set;for(let i in e)r.add(e[i]);return r}getAllSelector(e){let r=new Set;for(let i in e)r.add(e[i]);return r}getDefault(e){for(let r in e)if(e[r].isDefault)return e[r];return null}getRule(e,r){return!r||r=="default"?this.getDefault(e):e[r]}getRuleSelector(e,r){return e[r]}renameNetClass(e,r){let i=this.netClass[e];i!=null&&(i.name=r,this.netClass[r]=i,e!==r&&delete this.netClass[e]),this.renameBetweenNetRule(this.betweenNetRule.safe.rule,e,r),this.renameBetweenNetRule(this.betweenNetRule.inner.rule,e,r),this.renameBetweenNetRule(this.betweenNetRule.copper.rule,e,r)}renameBetweenNetRule(e,r,i){for(let n of e)n.net1 instanceof _i&&n.net1.name==r&&(n.net1.name=i),n.net2 instanceof _i&&n.net2.name==r&&(n.net2.name=i)}renameEqualLengthGroup(e,r){let i=this.equalLengthGroups[e];i!=null&&(i.name=r,this.equalLengthGroups[r]=i,e!==r&&delete this.equalLengthGroups[e])}renameNetDifferentail(e,r,i,n){this.netDifferentials[e]!=null&&this.deleteNetDifferentail([e]),this.addNetDifferentail(r,i,n)}getBetweenNetRuleByNet(e,r,i,n,s){switch(s){case 0:return this.betweenNetRule.safe.rule.length==0?null:this.getSafeRuleByNets(e,r,i,n);case 7:return this.betweenNetRule.inner.rule.length==0?null:this.getPlaneRuleByNets(i,n);case 8:return this.betweenNetRule.copper.rule.length==0?null:this.getCopperRuleByNets(i,n)}return null}getCopperRuleByNets(e,r){let i=this.getBetweenNetRule(this.betweenNetRule.copper,e,r),n=null;for(let s of i){let o=this.getCopperPlane(s.ruleName);(n==null||n.netClearance<o.netClearance)&&(n=o)}return n}getPlaneRuleByNets(e,r){let i=this.getBetweenNetRule(this.betweenNetRule.inner,e,r),n=null;for(let s of i){let o=this.getInnerPlane(s.ruleName);(n==null||n.netClearance<o.netClearance)&&(n=o)}return n}getSafeRuleByNets(e,r,i,n){let s=this.getBetweenNetRule(this.betweenNetRule.safe,i,n),o=null;for(let l of s){let u=this.getSafeSpacing(l.ruleName);(o==null||o.getClearance(e,r)<u.getClearance(e,r))&&(o=u)}return o}getBetweenNetRule(e,r,i){let n=new Array;for(let s of e.rule)(s.net1.hasNet(r)&&s.net2.hasNet(i)||s.net1.hasNet(i)&&s.net2.hasNet(r))&&n.push(s);return n}getRuleByID(e,r){let i=this.getRegion(e);switch(r){case 7:return i!=null?this.getInnerPlane(i.innerPlane):null;case 8:return i!=null?this.getCopperPlane(i.copperPlane):null;default:return null}}getRuleByNet(e,r){switch(r){case 0:return this.getSafeSpacingByNet(e);case 1:return this.getOtherSpacingByNet(e);case 2:return this.getTrackPhysicsByNet(e);case 3:return this.getNetLengthPhysicsByNet(e);case 4:return this.getDifferentailPhysicsByNet(e);case 5:return this.getBlindPhysicsByNet(e);case 6:return this.getRadiusPhysicsByNet(e);case 7:return this.getInnerPlaneByNet(e);case 8:return this.getCopperPlaneByNet(e);case 9:return this.getPasteExpansionByNet(e);case 10:return this.getSolderExpansionByNet(e)}}getDefaultRule(e){switch(e){case 0:return this.getDefaultSafeSpacing();case 1:return this.getDefaultOtherSpacing();case 2:return this.getDefaultTrackPhysics();case 4:return this.getDefaultDifferentailPhysics();case 5:return this.getDefaultBlindPhysics();case 6:return this.getDefaultRadiusPhysics();case 7:return this.getDefaultInnerPlane();case 8:return this.getDefaultCopperPlane();case 9:return this.getDefaultPasteExpansion();case 10:return this.getDefaultSolderExpansion()}}getSafeSpacingByNet(e){let r=this.getNet(e);return this.getSafeSpacing(r==null?void 0:r.safeSpacing)}getOtherSpacingByNet(e){return this.getDefaultOtherSpacing()}getTrackPhysicsByNet(e){let r=this.getNet(e);return this.getTrackPhysics(r==null?void 0:r.trackPhysics)}getNetLengthPhysicsByNet(e){let r=this.getNet(e);return this.getNetLengthPhysics(r==null?void 0:r.netLengthPhysics)}getDifferentailPhysicsByNet(e){var i;let r=this.getNet(e);return this.getDifferentailPhysics((i=r==null?void 0:r.netDifferentail)==null?void 0:i.differentailPhysics)}getBlindPhysicsByNet(e){let r=this.getNet(e);return this.getBlindPhysics(r==null?void 0:r.blindViaPhysics)}getRadiusPhysicsByNet(e){let r=this.getNet(e);return this.getRadiusPhysics(r==null?void 0:r.radiusPhysics)}getInnerPlaneByNet(e){let r=this.getNet(e);return this.getInnerPlane(r==null?void 0:r.innerPlane)}getCopperPlaneByNet(e){let r=this.getNet(e);return this.getCopperPlane(r==null?void 0:r.copperPlane)}getSolderExpansionByNet(e){let r=this.getNet(e);return this.getSolderExpansion(r==null?void 0:r.solderExpansion)}getPasteExpansionByNet(e){let r=this.getNet(e);return this.getPasteExpansion(r==null?void 0:r.pasteExpansion)}isDiffPair(e,r){var i;if(e!=r){let n=this.getNet(e);if(n!=null&&((i=n.netDifferentail)!=null&&i.hasNet(r)))return!0}return!1}getRule4Order(e,r,i,n){let s=new Array,o=e.net,l=r.net;switch(i){case"BetweenNetRule":{if(o!=null&&l!=null){let u=this.getBetweenNetRuleByNet(e.shapeType,r.shapeType,o,l,n);u!=null&&s.push(u)}return s}case"CustomPlaneRule":{let u=this.getRuleByID(e.id,n);u!=null&&s.push(u);let h=this.getRuleByID(r.id,n);return h!=null&&s.push(h),s}case"NetRule":{if(o!=null||n==0){let u=this.getRuleByNet(o,n);u!=null&&s.push(u)}if(l!=null||n==0){let u=this.getRuleByNet(l,n);u!=null&&s.push(u)}return s}default:return s.push(this.getDefaultRule(n)),s}}getCopperRule(e,r){let i=["BetweenNetRule","CustomPlaneRule","NetRule"];for(let n of i){let s=this.getRule4Order(e,r,n,8);if(s.length>0)return ie(s,(o,l)=>this.isNeedBoardClearance(e)?l.boardClearance-o.boardClearance:l.netClearance-o.netClearance,0,s.length),s[0]}return this.getDefaultCopperPlane()}isNeedBoardClearance(e){return e.shapeType==7||e.shapeType==5&&e.layerId==11||e.shapeType==4}getPlaneRule(e,r){let i=["BetweenNetRule","CustomPlaneRule","NetRule"];for(let n of i){let s=this.getRule4Order(e,r,n,7);if(s.length>0)return ie(s,(o,l)=>this.isNeedBoardClearance(e)?l.boardClearance-o.boardClearance:l.netClearance-o.netClearance,0,s.length),s[0]}return this.getDefaultInnerPlane()}getSafaClearance(e,r){let i=["BetweenNetRule","CustomPlaneRule","NetRule"];for(let s of i){let o=this.getSafeClearanceByOrder(e,r,s);if(o!=null)return o}return this.getDefaultSafeSpacing().getClearance(e.shapeType,r.shapeType)}getSafeClearanceByOrder(e,r,i){switch(i){case"BetweenNetRule":{if(e.net!=null&&r.net!=null){let n=this.getSafeRuleByNets(e.shapeType,r.shapeType,e.net,r.net);if(n!=null)return n.getClearance(e.shapeType,r.shapeType)}return null}case"CustomPlaneRule":{if(e.shapeType==0&&r.shapeType==0&&this.isDiffPair(e.net,r.net)){let n=this.getDifferentailPhysicsByNet(e.net);if(n!=null)return n.differentialPairSpacingMin}return null}case"NetRule":{let n=this.getSafeSpacingByNet(e.net),s=this.getSafeSpacingByNet(r.net);return Math.max(n.getClearance(e.shapeType,r.shapeType),s.getClearance(e.shapeType,r.shapeType))}default:return this.getDefaultSafeSpacing().getClearance(e.shapeType,r.shapeType)}}getSafeRule(e,r){let i=["BetweenNetRule","NetRule"],n=this.getDefaultSafeSpacing(),s=e.shapeType,o=r.shapeType;for(let l of i){let u=this.getRule4Order(e,r,l,0);if(u.length>0)return ie(u,(h,c)=>c.getClearance(s,o)-h.getClearance(s,o),0,u.length),u[0]}return n}addPadsPairGroup(e,r=[]){let i=new Yn(e,r);return this.padsPairGroups[e]=i,i}getAllCopperPlanesRules(){return this.copperPlanes}getPadsPairGroupItemByGroupName(e){return this.padsPairGroups[e]}getAllPadsPairGroups(){return this.getAllSelector(this.padsPairGroups)}getAllPadsPairGroupsInstances(){return Object.values(this.padsPairGroups)}getRuleTemplateName(){return this.ruleTemplateName}setRuleTemplateName(e){this.ruleTemplateName=e}setSpecialColor(e,r){if(e!=null){let i=this.getNet(e);i&&(r==null||r.equals(Ge.BLACK)?i.color=null:i.color=r)}}recycleAll(){this.recycleMap(this.safeSpacings),this.recycleMap(this.otherSpacings),this.recycleMap(this.trackPhysics),this.recycleMap(this.netLengthPhysics),this.recycleMap(this.differentialPhysics),this.recycleMap(this.blindViaPhysics),this.recycleMap(this.radiusPhysics),this.recycleMap(this.innerPlanes),this.recycleMap(this.copperPlanes),this.recycleMap(this.solderExpansions),this.recycleMap(this.pasteExpansions),this.safeSpacings={},this.otherSpacings={},this.trackPhysics={},this.netLengthPhysics={},this.differentialPhysics={},this.blindViaPhysics={},this.radiusPhysics={},this.innerPlanes={},this.copperPlanes={},this.solderExpansions={},this.pasteExpansions={}}deleteAll(){this.clearMap(this.safeSpacings),this.clearMap(this.otherSpacings),this.clearMap(this.trackPhysics),this.clearMap(this.netLengthPhysics),this.clearMap(this.differentialPhysics),this.clearMap(this.blindViaPhysics),this.clearMap(this.radiusPhysics),this.clearMap(this.innerPlanes),this.clearMap(this.copperPlanes),this.clearMap(this.solderExpansions),this.clearMap(this.pasteExpansions),this.safeSpacings={},this.otherSpacings={},this.trackPhysics={},this.netLengthPhysics={},this.differentialPhysics={},this.blindViaPhysics={},this.radiusPhysics={},this.innerPlanes={},this.copperPlanes={},this.solderExpansions={},this.pasteExpansions={}}recycleMap(e){for(let r in e){let i=e[r];i.buffer=null}}clearMap(e){for(let r in e)e[r].remove()}recycle(){this.deleteAll(),this.deleteAllRuleSelector()}deleteAllRuleSelector(){this.nets={},this.netClass={},this.netDifferentials={},this.regionSelectors={},this.autoRouters={},this.equalLengthGroups={},this.padsPairGroups={},this.betweenNetRule.safe.rule.length=0,this.betweenNetRule.copper.rule.length=0,this.betweenNetRule.inner.rule.length=0}},ke=Ae;ke.manager=null;function om(a,t){let e;return a.layerId==2?a.isTestPad?e=t.testPointBottomExpansion:e=t.padBottomExpansion:a.isTestPad?e=t.testPointTopExpansion:e=t.padTopExpansion,e}function ph(a){if(a.modelType=="Pad"){if(a.expansionType==1){let t=a.net,e=ke.getInstance().getSolderExpansionByNet(t),r=ke.getInstance().getPasteExpansionByNet(t);a.pasteExpansion=om(a,r),a.topSolderExpansion=a.isTestPad?e.testPointTopExpansion:e.padTopExpansion,a.bottomSolderExpansion=a.isTestPad?e.testPointBottomExpansion:e.padBottomExpansion}}else if(a.expansion===1){let t=a.net,e=ke.getInstance().getSolderExpansionByNet(t);a.topExpansion=e.viaTopExpansion,a.bottomExpansion=e.viaBottomExpansion}}var io=class extends Fe{constructor(e,r,i,n,s,o,l,u,h=null){super();this.modelType="Pad";this._bottomSolderExpansion=null;this._topSolderExpansion=null;this._rotation=null;this._globalIndex=e,this.update(r,i,n,s,o,l,u,h)}update(e,r,i,n,s,o,l,u=null){var c,f,d,p;let h=e[1];h===1?(D.notnull(n),D.mustnull(o),D.mustnull(s),D.mustnull(l)):h===2?(D.mustnull(n),D.mustnull(o),D.notnull(s),D.mustnull(l)):h===12?(D.notnull(n),D.notnull(o),D.notnull(s),D.notnull(l)):(D.mustnull(n),D.notnull(o),D.mustnull(s),D.mustnull(l)),this.buffer=e,this._num=r,this._net=i||"",this._top=n,this._bottom=s,this._inner=o,this._hole=l,(c=this._top)==null||c.setParent(this),(f=this._bottom)==null||f.setParent(this),(d=this._inner)==null||d.setParent(this),(p=this._hole)==null||p.setParent(this),this.updateBox(),this.padRule=u,this.clearCache()}clearCache(){super.clearCache(),this._unusedInnerLayers=null,this._bottomSolderExpansion=null,this._topSolderExpansion=null,this._rotation=null}get net(){return this._net}set net(e){this._net=e,this.change=!0}get num(){return this._num}set num(e){this._num=e,this.change=!0}static build(e,r,i,n,s,o,l,u,h,c,f,d,p,m,g,x,y,P,L=null,w=0,C,T=!1){let M=z(T,io.Blength),E=Q.getCache().BuildPadCache;return E[0]=r,E[1]=i,E[2]=s.x,E[3]=s.y,E[4]=o,E[5]=m?1:0,E[6]=h,E[7]=c,E[8]=f,E[9]=d,E[10]=mi.compress(p),E[11]=l?1:0,E[12]=w,M.set(E,1),C==null&&(C=Fl(r,s,o,g,x,y,P,0,0,0)),M.set(C.data,14),new io(e,M,n,u,g,x,y,P,L)}get modify(){return this.buffer!=null&&this._modify!=this.buffer[0]}set modify(e){e?this._modify==this.buffer[0]&&this.buffer[0]++:this._modify=this.buffer[0]}getExpansionRatio(e,r,i,n){let s=Math.min(r,i)/2;return(s*e+n)/(s+n)}get globalIndex(){return this._globalIndex}set globalIndex(e){this._globalIndex=e,this._top!=null&&(this._top.id=e),this._bottom!=null&&(this._bottom.id=e),this._inner!=null&&(this._inner.id=e),this._hole!=null&&(this._hole.id=e)}isPolygon(){return this.pads.every(e=>e.type==="POLYGON")}oppositeLayer(){if(this.layerId==12&&this.type==2){let e=this._top;this._top=this._bottom,this._bottom=e;let r=this.topSolderExpansion;this.topSolderExpansion=this.bottomSolderExpansion,this.bottomSolderExpansion=r,this.change=!0}}get padType(){return this.buffer[13]}set padType(e){this.updateBuffer(13,[e])}get isTestPad(){return this.padType==1}set isTestPad(e){e?this.padType=1:this.padType=0}get padRule(){return this._padRule}set padRule(e){this._padRule=e}get pads(){return[this.top,this.bottom,this.inner].filter(r=>r)}get top(){return this._top}set top(e){var r;this._top=e,(r=this._top)==null||r.setParent(this)}get bottom(){return this._bottom}set bottom(e){var r;this._bottom=e,(r=this._bottom)==null||r.setParent(this)}get inner(){return this._inner}set inner(e){var r;this._inner=e,(r=this._inner)==null||r.setParent(this)}get hole(){return this._hole}set hole(e){var r;this._hole=e,(r=this._hole)==null||r.setParent(this)}get holeShape(){var e;return(e=this.hole)==null?void 0:e.holeShape}set holeShape(e){this.hole&&(this.hole.holeShape=e)}get holeLength(){var e;return(e=this.hole)==null?void 0:e.holeLength}set holeLength(e){this.hole&&(this.hole.holeLength=e)}get holeOffset(){var e;return((e=this.hole)==null?void 0:e.holeOffset)||b.ORIGIN}set holeOffset(e){this.hole&&(this.hole.holeOffset=e)}get holeRotation(){var e;return((e=this.hole)==null?void 0:e.holeRotation)%Z}set holeRotation(e){this.hole&&(this.hole.holeRotation=e)}get holeRadius(){var e;return(e=this.hole)==null?void 0:e.holeRadius}set holeRadius(e){this.hole&&(this.hole.holeRadius=e)}get plated(){return this.buffer[6]==1}set plated(e){this.updateBuffer(6,[e?1:0])}get unusedInnerLayers(){return this._unusedInnerLayers||(this._unusedInnerLayers=mi.decompress(this.buffer[11])),this._unusedInnerLayers}set unusedInnerLayers(e){let r=mi.compress(e);this.buffer[11]!=r&&(this._unusedInnerLayers=e,this.updateBuffer(11,[r]))}getOneInnerInUse(){for(let e=15;e<=46;e++)if(!this.isUnuseLayer(e))return e;return null}isUnuseLayer(e){let r=1<<e-15;return(this.buffer[11]&r)!==0}get layerId(){return this.buffer[1]}set layerId(e){var i,n,s,o,l,u;let r=this.layerId;if(r!=e){let h=Q.getCache().ARRAY1;h[0]=e,this.updateShapeBuffer(1,h);let c=!(this.buffer instanceof ArrayBuffer);switch(r){case 1:{if(e==2)this._bottom=this._top,ph(this),this.expansionType===2&&(this.bottomSolderExpansion=this.topSolderExpansion),this._top=null;else{this._bottom=this._top.clone(c),this._inner=this._top.clone(c);let f=this._top.width*.3;this._hole=Yr.build(this.globalIndex,f,f,"ROUND",0,b.ORIGIN,c),(i=this._bottom)==null||i.setParent(this),(n=this._inner)==null||n.setParent(this),(s=this._hole)==null||s.setParent(this)}break}case 2:{if(e==1)this._top=this._bottom,ph(this),this.expansionType===2&&(this.topSolderExpansion=this.bottomSolderExpansion),this._bottom=null;else{this._top=this._bottom.clone(c),this._inner=this._bottom.clone(c);let f=this._bottom.width*.3;this._hole=Yr.build(this.globalIndex,f,f,"ROUND",0,b.ORIGIN,c),(o=this._top)==null||o.setParent(this),(l=this._inner)==null||l.setParent(this),(u=this._hole)==null||u.setParent(this)}break}default:e==1?(this._bottom=null,this._inner=null,this._hole=null):(this._top=null,this._inner=null,this._hole=null),this.type=1}this.change=!0}}get type(){return this.buffer[2]}set type(e){var n,s,o;if(this.type!=e&&this.layerId==12){let l=(this._top||this._bottom||this._inner).buffer;(n=this._top)==null||n.updateBuffer(0,l),(s=this._bottom)==null||s.updateBuffer(0,l),(o=this._inner)==null||o.updateBuffer(0,l)}let i=Q.getCache().ARRAY1;i[0]=e,this.updateShapeBuffer(2,i)}get center(){return new b(this.buffer[3],this.buffer[4])}set center(e){let r=Q.getCache().ARRAY2;r[0]=e.x,r[1]=e.y,this.updateShapeBuffer(3,r)}get rotation(){return this._rotation==null&&(this._rotation=this.buffer[5]),this._rotation}set rotation(e){if(this._rotation!=e){this._rotation=e;let r=Q.getCache().ARRAY1;r[0]=e,this.updateShapeBuffer(5,r)}}get expansionType(){return this.buffer[7]}set expansionType(e){let r=Q.getCache().ARRAY1;r[0]=e,this.updateBuffer(7,r)}get pasteExpansion(){return this.buffer[8]}set pasteExpansion(e){let r=Q.getCache().ARRAY1;r[0]=e,this.updateShapeBuffer(8,r)}get topSolderExpansion(){return this._topSolderExpansion==null&&(this._topSolderExpansion=this.buffer[9]),this._topSolderExpansion}set topSolderExpansion(e){this._topSolderExpansion!=e&&(this.updateShapeBuffer(9,[e]),this._topSolderExpansion=e)}get bottomSolderExpansion(){return this._bottomSolderExpansion==null&&(this._bottomSolderExpansion=this.buffer[10]),this._bottomSolderExpansion}set bottomSolderExpansion(e){if(this._bottomSolderExpansion!=e){let r=Q.getCache().ARRAY1;r[0]=e,this.updateShapeBuffer(10,r),this._bottomSolderExpansion=e}}get bbox(){return new j(this.buffer[14],this.buffer[15],this.buffer[16],this.buffer[17])}set bbox(e){this.updateBuffer(14,e.data)}flip(e){let r=this.center,i=this.rotation,n=r.multiply4(e),s=(Math.PI-i)%Z;if(this.center=n,this.rotation=s,this.transformPl(e),this.hole){let o=X.rotateZ(this.hole.holeRotation).translate1(this.hole.holeOffset.x,this.hole.holeOffset.y,0).rotateZ(i).translate1(r.x,r.y,0),l=b.ORIGIN.multiply4(o).multiply4(e);this.hole.holeOffset=l.multiply4(X.translate(-n.x,-n.y,0).rotateZ(-s)),this.hole.holeRotation=(Math.PI-this.hole.holeRotation)%Z}}rotateFor(e,r){let i=X.rotateZForPoint(e,r);this.transform(i)}transform(e){this.rotation=b.caculateAngle(this.rotation,e)%Z,this.center=this.center.multiply4(e),this.transformPl(e)}transformPl(e){let r=e.toMatrix3();this._top!=null&&this._top.type==="POLYGON"&&(this._top.pl=this._top.pl.multiply3(r)),this._bottom!=null&&this._bottom.type==="POLYGON"&&(this._bottom.pl=this._bottom.pl.multiply3(r)),this._inner!=null&&this._inner.type==="POLYGON"&&(this._inner.pl=this._inner.pl.multiply3(r))}remove(){var e,r,i,n;(e=this._top)==null||e.remove(),(r=this._bottom)==null||r.remove(),(i=this._inner)==null||i.remove(),(n=this._hole)==null||n.remove(),super.remove()}inShape(e,r,i){switch(this.layerId){case 1:return this._top.inShape(e,r,i);case 2:return this._bottom.inShape(e,r,i);default:return this._top.inShape(e,r,i)||this._bottom.inShape(e,r,i)||this._inner.inShape(e,r,i)?!0:this._hole.inShape(e,r,i)}}get locked(){return this.buffer[12]==1}set locked(e){this.updateBuffer(12,[e?1:0])}updateBox(){return this.bbox=Fl(this.layerId,this.center,this.rotation,this.top,this.bottom,this.inner,this.hole,0,0,0),this.bbox}getPad(e){let r=[1,7,5],i=[2,8,6];return r.includes(e)?this.top:i.includes(e)?this.bottom:this.inner}getBBox(e){let{pasteExpansion:r,topSolderExpansion:i,bottomSolderExpansion:n}=this;return e&&(r=0,i=0,n=0),Fl(this.layerId,this.center,this.rotation,this.top,this.bottom,this.inner,this.hole,r,i,n)}getFileGraphics(e,r,i){if(this.isEmpty)return null;if(e==12){let n=[];return i=i||[1,2,15],i.forEach(s=>{n.push(this.getMathGraphics(s,r))}),n}else return[this.getMathGraphics(e,r)]}getMathGraphics(e=this.layerId,r=0){if(this.isEmpty||this.isUnuseLayer(e))return null;if(e==1){if(this._top!=null)return this._top.getShape(r)}else if(e==2){if(this._bottom!=null)return this._bottom.getShape(r)}else if(e==12||47===e){if(this._hole!=null)return this._hole.getShape(r)}else if(6==e){if(this._bottom!=null)return this._bottom.getShape(r+this.bottomSolderExpansion)}else if(8==e){if(this._bottom!=null)return this._bottom.getShape(r+this.pasteExpansion)}else if(5==e){if(this._top!=null)return this._top.getShape(r+this.topSolderExpansion)}else if(7==e){if(this._top!=null)return this._top.getShape(r+this.pasteExpansion)}else if(this._inner!=null)return this._inner.getShape(r);return null}clone(e=!1){let r=z(e,io.Blength);r.set(this.buffer);let i=this.padRule==null?null:this.padRule.clone(e),n=this.top==null?null:this.top.clone(e),s=this.bottom==null?null:this.bottom.clone(e),o=this.inner==null?null:this.inner.clone(e),l=this.hole==null?null:this.hole.clone(e);return new io(this.globalIndex,r,this._num,this._net,n,s,o,l,i)}multiply3(e){let r=e.toMatrix3();return this.getMathGraphics().multiply3(r)}},tt=io;tt.Blength=14+4;function ka(a,t,e){if(isNaN(e))throw new Error("line error,width is NaN");if(e<0)return;let r=Q.getCache().boxCache,i=e/2;return r[0]=Math.min(a.x,t.x)-i,r[1]=Math.max(a.x,t.x)+i,r[2]=Math.min(a.y,t.y)-i,r[3]=Math.max(a.y,t.y)+i,new j(r[0],r[1],r[2],r[3])}var no=class extends Fe{constructor(e,r){super();this.modelType="Line";this._layerId=null;this._start=null;this._end=null;this._width=null;this.globalIndex=e,this.update(r)}cacheLastValue(){this._layerId=this.layerId,this._start=this.start,this._end=this.end,this._width=this.width}recycle(){super.recycle(),this.cacheLastValue()}update(e){this.buffer=e,this.clearCache()}static build(e,r,i,n,s,o,l,u=!1){s=nt(s);let h=z(u,no.Blength),c=Q.getCache().BuildLineCache;return c[0]=r,c[1]=i.x,c[2]=i.y,c[3]=n.x,c[4]=n.y,c[5]=s,c[6]=o?1:0,h.set(c,1),l==null&&(l=ka(i,n,s)),h.set(l.data,8),new no(e,h)}get modify(){return this.buffer!=null&&this._modify!=this.buffer[0]}set modify(e){e?this._modify==this.buffer[0]&&this.buffer[0]++:this._modify=this.buffer[0]}get isSegment(){return this.width==0}get layerId(){return this.buffer==null?this._layerId:this.buffer[1]}set layerId(e){let r=Q.getCache().ARRAY1;r[0]=e,this.updateBuffer(1,r)}get start(){return this.buffer==null?this._start:new b(this.buffer[2],this.buffer[3])}set start(e){let r=Q.getCache().ARRAY2;r[0]=e.x,r[1]=e.y,this.updateShapeBuffer(2,r)}get end(){return this.buffer==null?this._end:new b(this.buffer[4],this.buffer[5])}set end(e){let r=Q.getCache().ARRAY2;r[0]=e.x,r[1]=e.y,this.updateShapeBuffer(4,r)}get width(){return this.buffer==null?this._width:this.buffer[6]}set width(e){e=nt(e);let r=Q.getCache().ARRAY1;r[0]=e,this.updateShapeBuffer(6,[e])}get bbox(){return new j(this.buffer[8],this.buffer[9],this.buffer[10],this.buffer[11])}set bbox(e){this.updateBuffer(8,e.data)}get direct(){return this.end.sub(this.start).normalize()}get length(){return this.start.distance1(this.end)}get primitive(){return new S(this.start,this.end)}set length(e){let r=this.end.sub(this.start).normalize(),i=this.start.add(r.mul(e));this.end=i}get center(){return this.start.add(this.end).mul(.5)}transform(e){let r=this.start.multiply4(e),i=this.end.multiply4(e),n=Q.getCache().ARRAY4;n[0]=r.x,n[1]=r.y,n[2]=i.x,n[3]=i.y,this.updateShapeBuffer(2,n)}inShape(e,r,i){let n=this.width;n<.001&&i!=null&&(n=10/i.getScale());let s=e-this.start.x,o=r-this.start.y,l=e-this.end.x,u=r-this.end.y,h=this.end.x-this.start.x,c=this.end.y-this.start.y,f=new b(-c,h).normalize(),d=h+f.x*n/2,p=c+f.y*n/2,m=d*d+p*p,g=s*s+o*o,x=l*l+u*u,y=Math.abs(s*c-o*h)/2,L=Math.sqrt(h*h+c*c)*n/4;if(y<=L&&g<=m&&x<=m)return!0;{let w=n/2;return g<=w*w?!0:x<=w*w}}get locked(){return this.buffer[7]==1}set locked(e){let r=Q.getCache().ARRAY1;r[0]=e?1:0,this.updateBuffer(7,r)}updateBox(){let e=ka(this.start,this.end,this.width);return this.bbox=e,e}getMathGraphics(e=this.layerId,r=0){return this.isEmpty?null:this.layerId==e?this.primitive.stroke(this.width+r*2,1,0):null}clone(e=!1){let r=z(e,no.Blength);return r.set(this.buffer),new no(this.globalIndex,r)}},Ot=no;Ot.Blength=8+4;var so=class extends vr{constructor(){super(...arguments);this.modelType="Track"}update(e,r){super.update(e,r),this.model=new Ot(this.globalIndex,e)}recycle(){this.model.cacheLastValue(),super.recycle(),this.model.buffer=null}static build(e,r,i,n,s,o,l,u,h=!1){s=nt(s);let c=z(h,so.Blength),f=Q.getCache().BuildTrackCache;return f[0]=r,f[1]=i.x,f[2]=i.y,f[3]=n.x,f[4]=n.y,f[5]=s,f[6]=o?1:0,c.set(f,1),u==null&&(u=ka(i,n,s)),c.set(u.data,8),new so(e,c,l)}get modify(){return this.model.modify}set modify(e){this.model.modify=e}get globalIndex(){return this._globalIndex}set globalIndex(e){this._globalIndex=e,this.model!=null&&(this.model.globalIndex=e)}get midPoint(){return this.model.center}get isSegment(){return this.model.isSegment}get layerId(){return this.model.layerId}set layerId(e){this.model.layerId=e}get start(){return this.model.start}set start(e){this.model.start=e}get end(){return this.model.end}set end(e){this.model.end=e}get width(){return this.model.width}set width(e){e=nt(e),this.model.width=e}get bbox(){return this.model.bbox}set bbox(e){this.model.bbox=e}get direct(){return this.model.direct}get length(){return this.model.length}get primitive(){return this.model.primitive}set length(e){e=nt(e),this.model.length=e}get center(){return this.model.center}rotateFor(e,r){let i=X.rotateZForPoint(e,r);this.transform(i)}transform(e){this.model.transform(e)}inOutline(e){return this.inShape(e.x,e.y)}inShape(e,r){return this.model.inShape(e,r)}get locked(){return this.model.locked}set locked(e){this.model.locked=e}updateBox(){return this.model.updateBox()}getMathGraphics(e=this.layerId,r=0){return this.model.getMathGraphics(e,r)}clone(e=!1){let r=z(e,so.Blength);return r.set(this.buffer),new so(this.globalIndex,r,this.net)}},ut=so;ut.Blength=8+4;function dh(a,t,e,r,i){let n=new H;n.ext2(t).ext7(Math.max(a,e));let s=Math.max(r,i);return s>0&&n.ext7(s),n.build()}function hf(a,t,e,r){switch(t){case 1:{if(e===a||r===a)return!0;if(e==1){if(a!=2&&a<r)return!0}else if(e==2){if(a!=1&&a>r)return!0}else if(r==1){if(a!=2&&a<e)return!0}else if(r==2){if(a!=1&&a>e)return!0}else if(a!=1&&a!=2&&a>e&&a<r)return!0;return!1}default:return!0}}function cf(a){return a==1||a==3||a==5||a==7||a==9||a==58}function $e(a){return a==2||a==4||a==6||a==8||a==10||a==59}function mh(a){return a==2?1:a==4?3:a==6?5:a==8?7:a==10?9:a==1?2:a==3?4:a==5?6:a==7?8:a==9?10:a==58?59:a==59?58:a}function cQ(a){return cf(a)?5:$e(a)?6:a}function fQ(a){return cf(a)?7:$e(a)?8:a}function qn(a){return a==="SIGNAL"||a==="TOP"?!0:a==="BOTTOM"}function oo(a){return a==="PLANE"}function ff(a){return["TOP","BOTTOM","PLANE","SIGNAL"].includes(a)}function pQ(a){return a==="DRILL_DRAWING"}function dQ(a){return(a|0)===a&&a>=15&&a<=46}function mQ(a){return(a|0)===a&&(a>=15&&a<=46||a==1||a==2||a==12)}function um(a){return(a|0)===a&&a>=71&&a<=100}function bQ(a){return[49,50,51].includes(a)}function gQ(a){return 48===a}function yQ(a){return[48,49,50,51].includes(a)}function xQ(a){return[48,49,50,51,52].includes(a)}function PQ(a){return[51,50].includes(a)}function SQ(a){return[53,54,55].includes(a)}function wQ(a){return!!(a==11||a==12||a==13||a==14||a==56||a==57||um(a))}function LQ(a){return a==50||a==51||a==48||a==49}function Xn(a){return 12==a}function MQ(a){return 11==a}function AQ(a){return 14===a}function IQ(a){return 1==a}function CQ(a){return[58,59].includes(a)}function TQ(a){return 2==a}var ao=class extends Fe{constructor(e,r,i,n){super();this.modelType="Via";this.globalIndex=e,this.update(r,i,n)}update(e,r,i){this.buffer=e,this._net=r,this._name=i,this._unusedInnerLayers=null,this.clearCache()}static build(e,r,i,n,s,o,l,u,h,c,f,d,p,m,g,x=!1){u=nt(u*2)/2,c=nt(c*2)/2;let y=z(x,ao.Blength).fill(0),P=Q.getCache().BuildViaCache;return P[0]=r,P[1]=u,P[2]=h.x,P[3]=h.y,P[4]=c,P[5]=f,P[6]=d,P[7]=p,P[8]=n,P[9]=s,P[10]=mi.compress(o),P[11]=m?1:0,y.set(P,1),g==null&&(g=dh(u,h,c,d,p)),y.set(g.data,13),new ao(e,y,l,i)}get net(){return this._net}set net(e){this._net=e,this.change=!0}get name(){return this._name}set name(e){this._name=e,this.change=!0}get modify(){return this.buffer!=null&&this._modify!=this.buffer[0]}set modify(e){e?this._modify==this.buffer[0]&&this.buffer[0]++:this._modify=this.buffer[0]}isContains(e){return hf(e,this.type,this.startLayer,this.endLayer)}isUnuseLayer(e){let r=1<<e-15;return(this.buffer[11]&r)!==0}get bbox(){return new j(this.buffer[13],this.buffer[14],this.buffer[15],this.buffer[16])}set bbox(e){this.updateBuffer(13,e.data)}get unusedInnerLayers(){return this._unusedInnerLayers||(this._unusedInnerLayers=mi.decompress(this.buffer[11])),this._unusedInnerLayers}set unusedInnerLayers(e){let r=mi.compress(e);this.buffer[11]!=r&&(this._unusedInnerLayers=e,this.updateBuffer(11,[r]))}get layerId(){return 12}set layerId(e){}get expansion(){return this.buffer[6]}set expansion(e){this.updateBuffer(6,[e])}get type(){return this.buffer[1]}set type(e){this.type!=e&&this.updateShapeBuffer(1,[e])}get startLayer(){return this.buffer[9]}set startLayer(e){this.updateBuffer(9,[e])}get endLayer(){return this.buffer[10]}set endLayer(e){this.updateBuffer(10,[e])}get radius(){return this.buffer[2]}set radius(e){e=nt(e*2)/2,this.updateShapeBuffer(2,[e])}get center(){return new b(this.buffer[3],this.buffer[4])}set center(e){this.updateShapeBuffer(3,[e.x,e.y])}get holeRadius(){return this.buffer[5]}set holeRadius(e){e=nt(e*2)/2,this.updateShapeBuffer(5,[e])}get topExpansion(){return this.buffer[7]}set topExpansion(e){this.updateShapeBuffer(7,[e])}get bottomExpansion(){return this.buffer[8]}set bottomExpansion(e){this.updateShapeBuffer(8,[e])}rotateFor(e,r){let i=X.rotateZForPoint(e,r);this.transform(i)}transform(e){this.center=this.center.multiply4(e)}inOutline(e){let r=Math.max(this.radius,this.holeRadius);return Bi(e,this.center,r)}inShape(e,r){return this.inOutline(new b(e,r))}get locked(){return this.buffer[12]==1}set locked(e){this.updateBuffer(12,[e?1:0])}getMathGraphics(e=this.layerId,r=0){if(this.isEmpty||this.isUnuseLayer(e))return null;if(e==12||e===47)return B.build2([R.build3(this.center,0,-360,this.holeRadius,this.holeRadius)]);if([5,6].includes(e)){let i=e==5?this.topExpansion:this.bottomExpansion,n=this.radius+i;return n<=0?null:B.build2([R.build3(this.center,0,-360,n,n)])}else return B.build2([R.build3(this.center,0,-360,this.radius+r,this.radius+r)])}getFileGraphics(e,r,i){if(this.isEmpty)return null;if(Xn(e)){let n=[];return i=i||[this.getOneInnerInUse()].filter(Boolean),i.forEach(s=>{n.push(this.getMathGraphics(s,r))}),n}else return[this.getMathGraphics(e,r)]}updateBox(){return this.bbox=dh(this.radius,this.center,this.holeRadius,this.topExpansion,this.bottomExpansion),this.bbox}clone(e=!1){let r=z(e,ao.Blength);return r.set(this.buffer),new ao(this.globalIndex,r,this._net,this._name)}multiply3(e){let r=e.toMatrix3();return this.getMathGraphics().multiply3(r)}getOneInnerInUse(){for(let e=15;e<=46;e++)if(!this.isUnuseLayer(e))return e;return null}},Ze=ao;Ze.Blength=13+4;var Kn=class{get mainId(){return this._mainId}get relatedIds(){return this._relatedIds}constructor(t,e=new Set){this._mainId=t,this._relatedIds=e}deleteRelatedId(t){this.relatedIds.delete(t)}addRelatedId(t){this.relatedIds.add(t)}clear(){this._mainId=null,this._relatedIds=null}toJSON(){return{mainId:this.mainId,relatedIds:Array.from(this.relatedIds)}}};var lo=class extends be{static getInstance(){return lo.manager==null&&(lo.manager=new lo),lo.manager}constructor(){super()}addConnect(t,e){this.map.set(t,new Kn(t,e))}delConnect(t){let e=this.map.get(t);e&&(e.clear(),this.map.delete(t))}addConnectRelatedId(t,e){this.map.has(t)||this.map.set(t,new Kn(t)),this.map.get(t).addRelatedId(e)}delConnectRelatedId(t,e){let r=this.map.get(t);r instanceof Kn&&(r.deleteRelatedId(e),r.relatedIds.size===0&&this.delConnect(r.mainId))}getMainIdsByRelatedId(t){let e=[];for(let[r,i]of this.map)i instanceof Kn&&i.relatedIds.has(t)&&e.push(r);return e}},Va=lo;Va.manager=null;var uo=class extends Fe{constructor(e,r){super();this.modelType="Box";this.globalIndex=e,this.update(r)}update(e){this.buffer=e,this.clearCache()}static build(e,r,i,n,s,o,l,u,h=!1){let c=z(h,uo.Blength),f=Q.getCache().BuildBoxCache;if(f[0]=r,f[1]=i.x,f[2]=i.y,f[3]=n.x,f[4]=n.y,f[5]=s.x,f[6]=s.y,f[7]=o.x,f[8]=o.y,f[9]=l?1:0,c.set(f,1),u==null){let d=Q.getCache().boxCache;d[0]=Math.min(i.x,n.x,s.x,o.x),d[1]=Math.max(i.x,n.x,s.x,o.x),d[2]=Math.min(i.y,n.y,s.y,o.y),d[3]=Math.max(i.y,n.y,s.y,o.y),u=new j(d[0],d[1],d[2],d[3])}return c.set(u.data,11),new uo(e,c)}get modify(){return this.buffer!=null&&this._modify!=this.buffer[0]}set modify(e){e?this._modify==this.buffer[0]&&this.buffer[0]++:this._modify=this.buffer[0]}get layerId(){return this.buffer[1]}set layerId(e){let r=Q.getCache().ARRAY1;r[0]=e,this.updateBuffer(1,r)}get leftLow(){return new b(this.buffer[2],this.buffer[3])}set leftLow(e){let r=Q.getCache().ARRAY2;r[0]=e.x,r[1]=e.y,this.updateShapeBuffer(2,r)}get leftUp(){return new b(this.buffer[4],this.buffer[5])}set leftUp(e){let r=Q.getCache().ARRAY2;r[0]=e.x,r[1]=e.y,this.updateShapeBuffer(4,r)}get rightLow(){return new b(this.buffer[6],this.buffer[7])}set rightLow(e){let r=Q.getCache().ARRAY2;r[0]=e.x,r[1]=e.y,this.updateShapeBuffer(6,r)}get rightUp(){return new b(this.buffer[8],this.buffer[9])}set rightUp(e){let r=Q.getCache().ARRAY2;r[0]=e.x,r[1]=e.y,this.updateShapeBuffer(8,r)}get bbox(){return new j(this.buffer[11],this.buffer[12],this.buffer[13],this.buffer[14])}set bbox(e){this.updateBuffer(11,e.data)}get center(){return this.leftLow.add(this.rightUp).mul(.5)}set center(e){let r=this.center;this.leftLow=this.leftLow.sub(r).add(e),this.leftUp=this.leftUp.sub(r).add(e),this.rightLow=this.rightLow.sub(r).add(e),this.rightUp=this.rightUp.sub(r).add(e)}extendOfSize(e){let r=this.rightLow.sub(this.leftLow).normalize().mul(e),i=this.leftUp.sub(this.leftLow).normalize().mul(e);return this.leftLow=this.leftLow.sub(r).sub(i),this.leftUp=this.leftUp.sub(r).add(i),this.rightLow=this.rightLow.add(r).sub(i),this.rightUp=this.rightUp.add(r).add(i),this}get height(){return this.leftLow.distance1(this.leftUp)}get width(){return this.leftLow.distance1(this.rightLow)}isIntersection(e){if(this.intersectionBox(e)||e.intersectionBox(this))return!0;for(let r of e.primitives)for(let i of this.primitives)if(r.bbox().isIntersect(i.bbox())&&Xe(r,i)>0)return!0;return!1}intersectionBox(e){let r=this.rightLow.sub(this.leftLow).normalize(),i=Math.atan2(r.y,r.x);if(N.eq(i,0)){let m=new H().ext2(this.leftLow).ext2(this.rightLow).ext2(this.rightUp).ext2(this.leftUp).build();return!!(m.isContains(e.leftLow)||m.isContains(e.rightLow)||m.isContains(e.rightUp)||m.isContains(e.leftUp))}let n=X.translate(-this.leftLow.x,-this.leftLow.y,0).rotateZ(-i).translate1(this.leftLow.x,this.leftLow.y,0),s=this.leftLow.multiply4(n),o=this.rightLow.multiply4(n),l=this.rightUp.multiply4(n),u=this.leftUp.multiply4(n),h=new H().ext2(s).ext2(o).ext2(l).ext2(u).build(),c=e.leftLow.multiply4(n);if(h.isContains(c))return!0;let f=e.rightLow.multiply4(n);if(h.isContains(f))return!0;let d=e.rightUp.multiply4(n);if(h.isContains(d))return!0;let p=e.leftUp.multiply4(n);return!!h.isContains(p)}transform(e){this.leftLow=this.leftLow.multiply4(e),this.leftUp=this.leftUp.multiply4(e),this.rightLow=this.rightLow.multiply4(e),this.rightUp=this.rightUp.multiply4(e)}inShape(e,r,i){if(this.width==0&&this.height==0)return!1;let n=this.leftLow.sub(this.leftUp).normalize(),s=this.rightUp.sub(this.rightLow).normalize(),o=this.rightLow.sub(this.leftLow).normalize(),l=this.leftUp.sub(this.rightUp).normalize(),u=new b(e,r),h=u.sub(this.leftUp).normalize(),c=u.sub(this.leftLow).normalize(),f=u.sub(this.rightLow).normalize(),d=u.sub(this.rightUp).normalize();return n.cross(h)*s.cross(f)>=0&&o.cross(c)*l.cross(d)>=0}get rotation(){return this.rightLow.sub(this.leftLow).normalize().angle(b.ORIGIN)}get primitives(){let e=new S(this.leftLow,this.rightLow),r=new S(this.rightLow,this.rightUp),i=new S(this.rightUp,this.leftUp),n=new S(this.leftUp,this.leftLow);return[e,r,i,n]}get locked(){return this.buffer[10]==1}set locked(e){this.updateBuffer(10,[e?1:0])}updateBox(){let e=Math.min(this.buffer[2],this.buffer[4],this.buffer[6],this.buffer[8]),r=Math.max(this.buffer[2],this.buffer[4],this.buffer[6],this.buffer[8]),i=Math.min(this.buffer[3],this.buffer[5],this.buffer[7],this.buffer[9]),n=Math.max(this.buffer[3],this.buffer[5],this.buffer[7],this.buffer[9]);return this.updateBuffer(11,[e,r,i,n]),this.bbox}getMathGraphics(e=this.layerId,r=0){if(this.isEmpty)return null;if(this.layerId==e){let i=this.rightLow.sub(this.leftLow).normalize().mul(r),n=this.leftUp.sub(this.leftLow).normalize().mul(r),s=this.leftLow.sub(i).sub(n),o=this.leftUp.sub(i).add(n),l=this.rightLow.add(i).sub(n),u=this.rightUp.add(i).add(n),h=new Array,c=new S(s,l),f=new S(l,u),d=new S(u,o),p=new S(o,s);return h.push(c),h.push(f),h.push(d),h.push(p),B.build2(h)}return null}clone(e=!1){let r=z(e,uo.Blength);return r.set(this.buffer),new uo(this.globalIndex,r)}},gt=uo;gt.Blength=11+4;var Lr=class{static getStringPath(t){let e,r,i,n;if(!t)return"";var s="",o="";if(typeof t=="object"&&(s=t.text,!s))return"";t&&(i=+t.fontSize,n=+t.fontWidth,e=t.x,r=t.y),Lr.setFontHeight(i),i=Lr.getFontHeight();var l={},u=e;for(let h=0,c=s.length;h<c;h++){if(s[h]==" "){e+=Lr.getSapceWidth();continue}if(s[h]==`
`){e=u,r+=Math.max(+i+n,+i);continue}l=Lr.getCharInfo(s[h],e,r),o+=l[0],e+=l[1]+n+i*.15}return o}static setFontHeight(t){Lr.height=+t}static getFontHeight(){return Lr.height||4.5}static getCharInfo(t,e,r){function i(c,f,d,p,m){let g="",x=c.length;for(let y=0;y<x;y++){let P=c[y].split(" "),L=0,w=P.length;for(;L<w;L+=2)P[L]=or(d+f*P[L],2),P[L+1]=or(p+f*(+P[L+1]-16),2);let C="M "+P[0]+" "+P[1];for(L=2;L<w;L++)L%2===0&&(C+="L"),C+=P[L]+" ";g+=C}return g}if(Lr.fontPath[t]){var n=Lr.fontPath[t].path,s=Lr.getPathBBox(n),o=Math.abs(s.R-s.L),l=Math.abs(s.T-s.B);l===0&&(l=1);var u=Lr.getFontHeight()/32;o=o*u;var h=i(n,u,e,r,l);return[h,o]}else return["",0]}static getPathBBox(t){for(var e=t.length,r={L:9999,T:-9999,R:-9999,B:9999},i,n,s=0;s<e;s++){for(var o=t[s].split(" "),l=0,u=o.length;l<u;l+=2)i=+o[l],n=+o[l+1],r.L>i&&(r.L=i),r.T<n&&(r.T=n),r.R<i&&(r.R=i),r.B>n&&(r.B=n);o=null}return r}static getSapceWidth(){return Lr.height*.7}static everyCharHasDefaultFontPath(t){let e=t.toString().replace(/\s/g,"").split("");for(let r of e)if(Lr.fontPath[r]==null)return!1;return!0}},ho=Lr;ho._fontsCache={},ho.fontPath={"!":{path:["1 -12 1 2","1 7 0 8 1 9 2 8 1 7"]},'"':{path:["0 -12 0 -5","8 -12 8 -5"]},"#":{path:["8 -16 1 16","14 -16 7 16","1 -3 15 -3","0 3 14 3"]},$:{path:["5 -16 5 13","9 -16 9 13","14 -9 12 -11 9 -12 5 -12 2 -11 0 -9 0 -7 1 -5 2 -4 4 -3 10 -1 12 0 13 1 14 3 14 6 12 8 9 9 5 9 2 8 0 6"]},"%":{path:["18 -12 0 9","5 -12 7 -10 7 -8 6 -6 4 -5 2 -5 0 -7 0 -9 1 -11 3 -12 5 -12 7 -11 10 -10 13 -10 16 -11 18 -12","14 2 12 3 11 5 11 7 13 9 15 9 17 8 18 6 18 4 16 2 14 2"]},"&":{path:["20 -3 20 -4 19 -5 18 -5 17 -4 16 -2 14 3 12 6 10 8 8 9 4 9 2 8 1 7 0 5 0 3 1 1 2 0 9 -4 10 -5 11 -7 11 -9 10 -11 8 -12 6 -11 5 -9 5 -7 6 -4 8 -1 13 6 15 8 17 9 19 9 20 8 20 7"]},"'":{path:["2 -15 2 -9"]},"`":{path:["2 -15 4 -9"]},"(":{path:["7 -16 5 -14 3 -11 1 -7 0 -2 0 2 1 7 3 11 5 14 7 16"]},")":{path:["0 -16 2 -14 4 -11 6 -7 7 -2 7 2 6 7 4 11 2 14 0 16"]},"*":{path:["5 -6 5 6","0 -3 10 3","10 -3 0 3"]},"+":{path:["9 -9 9 9","0 0 18 0"]},",":{path:["2 5 1 6 0 5 1 4 2 5 2 7 0 9"]},"-":{path:["0 0 18 0"]},".":{path:["1 4 0 5 1 6 2 5 1 4"]},"/":{path:["18 -16 0 16"]},0:{path:["6 -12 3 -11 1 -8 0 -3 0 0 1 5 3 8 6 9 8 9 11 8 13 5 14 0 14 -3 13 -8 11 -11 8 -12 6 -12"]},1:{path:["0 -8 2 -9 5 -12 5 9"]},2:{path:["1 -7 1 -8 2 -10 3 -11 5 -12 9 -12 11 -11 12 -10 13 -8 13 -6 12 -4 10 -1 0 9 14 9"]},3:{path:["2 -12 13 -12 7 -4 10 -4 12 -3 13 -2 14 1 14 3 13 6 11 8 8 9 5 9 2 8 1 7 0 5"]},4:{path:["10 -12 0 2 15 2","10 -12 10 9"]},5:{path:["12 -12 2 -12 1 -3 2 -4 5 -5 8 -5 11 -4 13 -2 14 1 14 3 13 6 11 8 8 9 5 9 2 8 1 7 0 5"]},6:{path:["12 -9 11 -11 8 -12 6 -12 3 -11 1 -8 0 -3 0 2 1 6 3 8 6 9 7 9 10 8 12 6 13 3 13 2 12 -1 10 -3 7 -4 6 -4 3 -3 1 -1 0 2"]},7:{path:["14 -12 4 9","0 -12 14 -12"]},8:{path:["5 -12 2 -11 1 -9 1 -7 2 -5 4 -4 8 -3 11 -2 13 0 14 2 14 5 13 7 12 8 9 9 5 9 2 8 1 7 0 5 0 2 1 0 3 -2 6 -3 10 -4 12 -5 13 -7 13 -9 12 -11 9 -12 5 -12"]},9:{path:["13 -5 12 -2 10 0 7 1 6 1 3 0 1 -2 0 -5 0 -6 1 -9 3 -11 6 -12 7 -12 10 -11 12 -9 13 -5 13 0 12 5 10 8 7 9 5 9 2 8 1 6"]},":":{path:["1 -3 0 -2 1 -1 2 -2 1 -3","1 4 0 5 1 6 2 5 1 4"]},";":{path:["1 -3 0 -2 1 -1 2 -2 1 -3","2 5 1 6 0 5 1 4 2 5 2 7 0 9"]},"<":{path:["16 -9 0 0 16 9"]},"=":{path:["0 -3 18 -3","0 3 18 3"]},">":{path:["0 -9 16 0 0 9"]},"?":{path:["0 -7 0 -8 1 -10 2 -11 4 -12 8 -12 10 -11 11 -10 12 -8 12 -6 11 -4 10 -3 6 -1 6 2","6 7 5 8 6 9 7 8 6 7"]},"@":{path:["15 -4 14 -6 12 -7 9 -7 7 -6 6 -5 5 -2 5 1 6 3 8 4 11 4 13 3 14 1","9 -7 7 -5 6 -2 6 1 7 3 8 4","15 -7 14 1 14 3 16 4 18 4 20 2 21 -1 21 -3 20 -6 19 -8 17 -10 15 -11 12 -12 9 -12 6 -11 4 -10 2 -8 1 -6 0 -3 0 0 1 3 2 5 4 7 6 8 9 9 12 9 15 8 17 7 18 6","16 -7 15 1 15 3 16 4"]},A:{path:["8 -12 0 9","8 -12 16 9","3 2 13 2"]},B:{path:["0 -12 0 9","0 -12 9 -12 12 -11 13 -10 14 -8 14 -6 13 -4 12 -3 9 -2","0 -2 9 -2 12 -1 13 0 14 2 14 5 13 7 12 8 9 9 0 9"]},C:{path:["15 -7 14 -9 12 -11 10 -12 6 -12 4 -11 2 -9 1 -7 0 -4 0 1 1 4 2 6 4 8 6 9 10 9 12 8 14 6 15 4"]},D:{path:["0 -12 0 9","0 -12 7 -12 10 -11 12 -9 13 -7 14 -4 14 1 13 4 12 6 10 8 7 9 0 9"]},E:{path:["0 -12 0 9","0 -12 13 -12","0 -2 8 -2","0 9 13 9"]},F:{path:["0 -12 0 9","0 -12 13 -12","0 -2 8 -2"]},G:{path:["15 -7 14 -9 12 -11 10 -12 6 -12 4 -11 2 -9 1 -7 0 -4 0 1 1 4 2 6 4 8 6 9 10 9 12 8 14 6 15 4 15 1","10 1 15 1"]},H:{path:["0 -12 0 9","14 -12 14 9","0 -2 14 -2"]},I:{path:["0 -12 0 9"]},J:{path:["10 -12 10 4 9 7 8 8 6 9 4 9 2 8 1 7 0 4 0 2"]},K:{path:["0 -12 0 9","14 -12 0 2","5 -3 14 9"]},L:{path:["0 -12 0 9","0 9 12 9"]},M:{path:["0 -12 0 9","0 -12 8 9","16 -12 8 9","16 -12 16 9"]},N:{path:["0 -12 0 9","0 -12 14 9","14 -12 14 9"]},O:{path:["6 -12 4 -11 2 -9 1 -7 0 -4 0 1 1 4 2 6 4 8 6 9 10 9 12 8 14 6 15 4 16 1 16 -4 15 -7 14 -9 12 -11 10 -12 6 -12"]},P:{path:["0 -12 0 9","0 -12 9 -12 12 -11 13 -10 14 -8 14 -5 13 -3 12 -2 9 -1 0 -1"]},Q:{path:["6 -12 4 -11 2 -9 1 -7 0 -4 0 1 1 4 2 6 4 8 6 9 10 9 12 8 14 6 15 4 16 1 16 -4 15 -7 14 -9 12 -11 10 -12 6 -12","9 5 15 11"]},R:{path:["0 -12 0 9","0 -12 9 -12 12 -11 13 -10 14 -8 14 -6 13 -4 12 -3 9 -2 0 -2","7 -2 14 9"]},S:{path:["14 -9 12 -11 9 -12 5 -12 2 -11 0 -9 0 -7 1 -5 2 -4 4 -3 10 -1 12 0 13 1 14 3 14 6 12 8 9 9 5 9 2 8 0 6"]},T:{path:["7 -12 7 9","0 -12 14 -12"]},U:{path:["0 -12 0 3 1 6 3 8 6 9 8 9 11 8 13 6 14 3 14 -12"]},V:{path:["0 -12 8 9","16 -12 8 9"]},W:{path:["0 -12 5 9","10 -12 5 9","10 -12 15 9","20 -12 15 9"]},X:{path:["0 -12 14 9","14 -12 0 9"]},Y:{path:["0 -12 8 -2 8 9","16 -12 8 -2"]},Z:{path:["14 -12 0 9","0 -12 14 -12","0 9 14 9"]},"[":{path:["0 -16 0 16","1 -16 1 16","0 -16 7 -16","0 16 7 16"]},"\\":{path:["0 -12 14 12"]},"]":{path:["6 -16 6 16","7 -16 7 16","0 -16 7 -16","0 16 7 16"]},"^":{path:["8 -14 0 0","8 -14 16 0"]},_:{path:["0 16 18 16"]},a:{path:["12 -5 12 9","12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"]},b:{path:["0 -12 0 9","0 -2 2 -4 4 -5 7 -5 9 -4 11 -2 12 1 12 3 11 6 9 8 7 9 4 9 2 8 0 6"]},c:{path:["12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"]},d:{path:["12 -12 12 9","12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"]},e:{path:["0 1 12 1 12 -1 11 -3 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"]},f:{path:["8 -12 6 -12 4 -11 3 -8 3 9","0 -5 7 -5"]},g:{path:["12 -5 12 11 11 14 10 15 8 16 5 16 3 15","12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"]},h:{path:["0 -12 0 9","0 -1 3 -4 5 -5 8 -5 10 -4 11 -1 11 9"]},i:{path:["0 -12 1 -11 2 -12 1 -13 0 -12","1 -5 1 9"]},j:{path:["4 -12 5 -11 6 -12 5 -13 4 -12","5 -5 5 12 4 15 2 16 0 16"]},k:{path:["0 -12 0 9","10 -5 0 5","4 1 11 9"]},l:{path:["0 -12 0 9"]},m:{path:["0 -5 0 9","0 -1 3 -4 5 -5 8 -5 10 -4 11 -1 11 9","11 -1 14 -4 16 -5 19 -5 21 -4 22 -1 22 9"]},n:{path:["0 -5 0 9","0 -1 3 -4 5 -5 8 -5 10 -4 11 -1 11 9"]},o:{path:["5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6 13 3 13 1 12 -2 10 -4 8 -5 5 -5"]},p:{path:["0 -5 0 16","0 -2 2 -4 4 -5 7 -5 9 -4 11 -2 12 1 12 3 11 6 9 8 7 9 4 9 2 8 0 6"]},q:{path:["12 -5 12 16","12 -2 10 -4 8 -5 5 -5 3 -4 1 -2 0 1 0 3 1 6 3 8 5 9 8 9 10 8 12 6"]},r:{path:["0 -5 0 9","0 1 1 -2 3 -4 5 -5 8 -5"]},s:{path:["11 -2 10 -4 7 -5 4 -5 1 -4 0 -2 1 0 3 1 8 2 10 3 11 5 11 6 10 8 7 9 4 9 1 8 0 6"]},t:{path:["3 -12 3 5 4 8 6 9 8 9","0 -5 7 -5"]},u:{path:["0 -5 0 5 1 8 3 9 6 9 8 8 11 5","11 -5 11 9"]},v:{path:["0 -5 6 9","12 -5 6 9"]},w:{path:["0 -5 4 9","8 -5 4 9","8 -5 12 9","16 -5 12 9"]},x:{path:["0 -5 11 9","11 -5 0 9"]},y:{path:["1 -5 7 9","13 -5 7 9 5 13 3 15 1 16 0 16"]},z:{path:["11 -5 0 9","0 -5 11 -5","0 9 11 9"]},"{":{path:["5 -16 3 -15 2 -14 1 -12 1 -10 2 -8 3 -7 4 -5 4 -3 2 -1","3 -15 2 -13 2 -11 3 -9 4 -8 5 -6 5 -4 4 -2 0 0 4 2 5 4 5 6 4 8 3 9 2 11 2 13 3 15","2 1 4 3 4 5 3 7 2 8 1 10 1 12 2 14 3 15 5 16"]},"|":{path:["0 -16 0 16"]},"}":{path:["0 -16 2 -15 3 -14 4 -12 4 -10 3 -8 2 -7 1 -5 1 -3 3 -1","2 -15 3 -13 3 -11 2 -9 1 -8 0 -6 0 -4 1 -2 5 0 1 2 0 4 0 6 1 8 2 9 3 11 3 13 2 15","3 1 1 3 1 5 2 7 3 8 4 10 4 12 3 14 2 15 0 16"]},"~":{path:["0 3 0 1 1 -2 3 -3 5 -3 7 -2 11 1 13 2 15 2 17 1 18 -1","0 1 1 -1 3 -2 5 -2 7 -1 11 2 13 3 15 3 17 2 18 -1 18 -3"]},"\xB0":{path:["3 -11 0 -8 3 -5 6 -8 3 -11"]},\u03A9:{path:["0 9 7 9 5 6 3 3 2 0 2 -3 3 -6 4 -8 6 -10 8 -11 12 -11 14 -10 16 -8 17 -6 18 -3 18 0 17 3 15 6 13 9 20 9"]},\u03BC:{path:["0 14 1 4 1 -6 1 4 2 7 4 8 6 8 8 7 10 4 10 -6 10 6 11 8 12 9"]}};function Br(a,t){return $e(a)!==t}function zl(a){let t=Q.getCache().textOffsetCache;switch(a){case 3:return t[0];case 2:return t[1];case 1:return t[2];case 6:return t[3];case 5:return t[4];case 4:return t[5];case 9:return t[6];case 8:return t[7];case 7:return t[8];default:return t[0]}}function Kr(a,t,e){let r={text:a,x:e/2,y:-e/2,fontSize:t-e,fontWidth:e},n=a.split(`
`).length,s=t*n,o=hm(r,s-t),l=new H;l.ext2(b.ORIGIN);for(let c of o)for(let f of c.primitives)l.ext1(f.bbox());let u=l.ext7(e/2).build(),h=new j(0,u.maxX,0,s);return{width:h.width(),height:h.height(),path:o}}function Oi(a,t,e){let r=Math.pow(10,t),i=Math.round(a*10*r)/r,n=new Ht;return e!="mil"&&(i=n.conversion1("mil",e,i)),i.toFixed(t)}function hm(a,t){let e=new Array;if(!a)return e;let r=Q.getCache().textCache;function i(y){if(r.has(y))return r.get(y);{let P=y.split(" ");return r.set(y,P),P}}let{text:n,x:s,y:o,fontSize:l,fontWidth:u}=a,h=s,c=o;function f(y,P=2){let L=Math.pow(10,P);return Math.round(y*L+1e-10)/L}let d=l/32,p=null,m=null,g=null,x=null;for(let y of n)switch(y){case" ":{h+=l*.7;break}case`
`:{h=s,c+=Math.max(l+u,l);break}default:{let P=ho.fontPath[y];if(P!=null){let L=P.path,w=h;for(let C of L){let T=i(C),M=T.length,E=new Xt,W=null;for(let k=0;k<M;k+=2)p=f(h+d*+T[k]),m=t-f(c+d*(+T[k+1]-16)),w=Math.max(w,p),W==null?W=new b(p,m):(g=new b(p,m),x=new S(W,g),E.push(x),W=g);E.size()>0&&(e.push(B.build7(E.toArray())),E.clear())}h=w+u+l*.15}break}}return e}var Zn=class{constructor(t,e,r,i){this.pts1=t,this.pts2=e,this.plgrp1=r,this.plgrp2=i}static build2(t,e){let r=new Array,i=new Array;for(let o of t.primitives)r.push(o);for(let o of e.primitives)i.push(o);let n=new ee([t]),s=new ee([e]);return new Zn(r,i,n,s)}static build3(t,e){let r=new Array,i=new Array;t.forEach(o=>{for(let l of o.primitives)r.push(l)}),e.forEach(o=>{for(let l of o.primitives)i.push(l)});let n=new ee(t),s=new ee(e);return new Zn(r,i,n,s)}intersection(){return vi.isIntersect(this.plgrp1,this.plgrp2)}inInner(){if(vi.isIntersect(this.plgrp1,this.plgrp2)&&(this.isClose(this.pts1)||this.isClose(this.pts2))){for(let e of this.pts1)for(let r of this.pts2)if(Xe(e,r)>0)return!1;return!0}else return!1}isClose(t){return!!(t.length>0&&t[0].start().equals1(t[t.length-1].end()))}hasInterEdge(){for(let t of this.pts1)for(let e of this.pts2)if(Xe(t,e)>0)return!0;return!1}};var gn=class{constructor(t,e,r,i,n){this.text=t,this.group=e,this.pl=r,this.flag=i,this.order=n}clone(){let{text:t,group:e,pl:r,flag:i,order:n}=this;return new gn(t,e,r.clone(),i,n)}};var co=class{constructor(t,e,r){this.pls=new Array;this.map=new Map;r=this.sort(r);let{outline:i,hole:n}=this.getOutline(r),s=0;i.forEach(u=>{this.pls.push(new gn(t,e,u,!0,s))});let o=!0,l=n;for(s++;l.size>0;){let{outline:u,hole:h}=this.getOutline1(l,o);o?u.forEach(c=>{this.pls.push(new gn(t,e,c,!1,s))}):u.forEach(c=>{this.pls.push(new gn(t,e,c,!0,s))}),l=h,o=!o,s++}}getPolyline(t){let e=this.map.get(t);if(e!=null)return e;{let r=new Array;for(let n of t.primitives)if(n instanceof we){let s=null;for(let o of n.points(.01))s!=null&&r.push(new S(s,o)),s=o}else r.push(n);let i=B.build2(r);return this.map.set(t,i),i}}getOutline1(t,e){return this.getOutline([...t])}sort(t){return t.sort((e,r)=>r.bbox().area()-e.bbox().area())}getOutline(t){let e=new Set,r=new Set;for(let i=0,n=t.length;i<n;i++){let s=t[i];if(!e.has(s)&&!r.has(s)){i+1>=n&&e.add(s);for(let o=i+1;o<n;o++){let l=t[o];if(!e.has(l)&&!r.has(l)){if(!s.bbox().isInside(l.bbox().extendOfSize(1e-4))&&!l.bbox().isInside(s.bbox().extendOfSize(1e-4)))continue;Zn.build2(this.getPolyline(s),this.getPolyline(l)).intersection()&&(s.bbox().area()>l.bbox().area()?(e.add(s),r.add(l)):(e.add(l),r.add(s)))}}!e.has(s)&&!r.has(s)&&e.add(s)}}return{outline:e,hole:r}}};var pf=(r=>(r[r.NOTSHOW=0]="NOTSHOW",r[r.ONLYAXIS=1]="ONLYAXIS",r[r.SHOW=2]="SHOW",r))(pf||{}),df=(r=>(r[r.Line=0]="Line",r[r.Point=1]="Point",r[r.None=2]="None",r))(df||{}),fo=class{constructor(){this.visible=2;this._flip=!1;this._currentCoord=!0;this._gridColor=Ge.WHITE;this._transparency=.3;this._multiGridColor=Ge.WHITE;this._multiTransparency=.55;this._coordinateAxisColor=Ge.WHITE;this._coordinateAxisTransparency=1;this._stepX=.5;this._stepY=.5;this._snapX=.5;this._snapY=.5;this._pattern=!0;this._multiRatio=5;this._multiStyle=2;this._angleDelta=Math.PI/4;this._startAngle=0;this._endAngle=Z;this._step=39.37;this._minRadius=3.937;this._maxRadius=393.7;this._gridInstance=null}static getInstance(){return fo._instance==null&&(fo._instance=new fo),fo._instance}get flip(){return this._flip}set flip(t){this._flip=t}get gridColor(){return this._gridColor}set gridColor(t){this._gridColor=t,this._gridInstance!=null&&this._gridInstance.modifyColor(t,1-this.transparency)}get currentCoord(){return this._currentCoord}set currentCoord(t){this._currentCoord=t}get minRadius(){return this._minRadius}set minRadius(t){this._minRadius=t}get maxRadius(){return this._maxRadius}set maxRadius(t){this._maxRadius=t}get angleDelta(){return this._angleDelta}set angleDelta(t){this._angleDelta=t}get radius(){return this._step}set radius(t){this._step=t}get startAngle(){return this._startAngle}set startAngle(t){t%=Z,t<0&&(t+=Z),this._startAngle=t}get endAngle(){return this._endAngle}set endAngle(t){this._endAngle=t}get sweepAngle(){return this.endAngle>this.startAngle?this.endAngle-this.startAngle:this.endAngle-this.startAngle+Z}modify(t,e,r,i,n){this._stepX=t,this._stepY=e,this._snapX=r,this._snapY=i,this._pattern=n,this._gridInstance!=null&&this._gridInstance.flush()}updateGridParam(t,e,r,i){let n=t?2:1;this._stepX=e,this._stepY=r,t!==void 0&&(this.visible=n),i!==void 0&&(this._pattern=i),this._gridInstance!=null&&this._gridInstance.flush()}attach(t){this._gridInstance=t,this._gridInstance!=null&&(this._gridInstance.flush(),this._gridInstance.modifyColor(this._gridColor,1-this.transparency))}setGridX(t){t>0&&(this._stepX=t,this._gridInstance!=null&&this._gridInstance.flush())}getGridX(){return this._stepX}setGridY(t){t>0&&(this._stepY=t,this._gridInstance!=null&&this._gridInstance.flush())}getGridY(){return this._stepY}getMultiRatio(){return this._multiRatio}setMultiRatio(t){t>=1&&(this._multiRatio=t)}getMultiStyle(){return this._multiStyle}setMultiStyle(t){return this._multiStyle=t}setSnapX(t){t>0&&(this._snapX=t)}getSnapX(){return this._snapX}setSnapY(t){t>0&&(this._snapY=t)}getSnapY(){return this._snapY}get pattern(){return this._pattern}set pattern(t){this._pattern=t,this._gridInstance!=null&&this._gridInstance.flush()}get transparency(){return this._transparency}set transparency(t){this._transparency=t}get multiGridColor(){return this._multiGridColor}set multiGridColor(t){this._multiGridColor=t}get multiTransparency(){return this._multiTransparency}set multiTransparency(t){this._multiTransparency=t}get coordinateAxisColor(){return this._coordinateAxisColor}set coordinateAxisColor(t){this._coordinateAxisColor=t}get coordinateAxisTransparency(){return this._coordinateAxisTransparency}set coordinateAxisTransparency(t){this._coordinateAxisTransparency=t}},Zr=fo;Zr._instance=null;var fJ=0,mf="@",pJ="#000000",dJ="default",mJ=12,bJ=.8;var po=class{constructor(){this._origin=b.ORIGIN;this._doctype=0;this._id="";this._tabId="";this._isactive=!1;this._owner=null;this._unit="mil";this.frameObservers=new Array;this._footprintIsConnectDevice=!1;this.name="";this.altGridSize={GridX:{number:5,unit:this.unit},GridY:{number:5,unit:this.unit}};this._gridType="grid";this._multiType="none";this._multiRatio=5;this.forceDeactive=!1;this._backgroundColor=new Ge(0,0,0,1);this._openRuler=!1;this.antialias=!1;this._needRenderPanelize=!1;this._renderMode=0;this.time=new Date().getTime();this.num=Math.floor(Math.random()*100);this.subThreadRuning=!1}static getInstance(){return po.env==null&&(po.env=new po),po.env}get channel(){return(this.time+this.num).toString()}modify(t,e,r,i,n,s,o,l){this.doctype=t,this.id=e,this.tabId=r,this.isactive=i,this.owner=n,this.customerCode=s,this.name=o,this.origin=l}get gridType(){return this._gridType}set gridType(t){if(t!=null&&this._gridType!=t&&Zr.getInstance().visible!=0)switch(this._gridType=t,t){case"grid":Zr.getInstance().pattern=!0,Zr.getInstance().visible=2;break;case"outlets":Zr.getInstance().pattern=!1,Zr.getInstance().visible=2;break;case"none":Zr.getInstance().visible=1;break}}get multiType(){return this._multiType}set multiType(t){let e=Zr.getInstance();if(this._multiType!=t)switch(this._multiType=t,t){case"grid":e.setMultiStyle(0);break;case"outlets":e.setMultiStyle(1);break;case"none":e.setMultiStyle(2);break}}get multiRatio(){return this._multiRatio}set multiRatio(t){let e=Zr.getInstance();this._multiRatio!=t&&(this._multiRatio=t,e.setMultiRatio(t))}get unit(){return this._unit}set unit(t){this._unit=t;for(let e of this.frameObservers)e.modifyUnit(t)}get projectId(){let t=this._tabId.split(mf);return t.length==2?t[1]:""}attachFrameObserver(t){return!this.frameObservers.includes(t)&&t!=null&&(this.frameObservers.push(t),t.modifyUnit(this._unit),t.modifyBgColor(this._backgroundColor),t.resize(),t.setAntialias(this.antialias),t.openRuler=this._openRuler,t.needRenderPanelize=this._needRenderPanelize,t.renderMode=this._renderMode),!0}getBgColor(){return this._backgroundColor}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t;for(let e of this.frameObservers)e.modifyBgColor(t)}resize(t,e){for(let r of this.frameObservers)r.resize(t,e)}get openRuler(){return this._openRuler}set openRuler(t){this._openRuler=t;for(let e of this.frameObservers)e.openRuler=t}get needRenderPanelize(){return this._needRenderPanelize}set needRenderPanelize(t){this._needRenderPanelize=t;for(let e of this.frameObservers)e.needRenderPanelize=t}get renderMode(){return this._renderMode}set renderMode(t){this._renderMode=t;for(let e of this.frameObservers)e.renderMode=t}getAntialias(){return this.antialias}setAntialias(t){this.antialias=t;for(let e of this.frameObservers)e.setAntialias(t)}get origin(){return this._origin}set origin(t){this._origin=t}get customerCode(){return this._customerCode}set customerCode(t){this._customerCode=t}get owner(){return this._owner}set owner(t){this._owner=t}get clientOnlineService(){return this._clientOnlineService}set clientOnlineService(t){this._clientOnlineService=t}get doctype(){return this._doctype}set doctype(t){this._doctype=t}get id(){return this._id}set id(t){this._id=t}get tabId(){return this._tabId}set tabId(t){this._tabId=t}get isactive(){return this._isactive}set isactive(t){this._isactive=t}get footprintIsConnectDevice(){return this._footprintIsConnectDevice}set footprintIsConnectDevice(t){this._footprintIsConnectDevice=t}},yn=po;yn.env=null;var mo=class extends Fe{constructor(e,r,i,n,s,o,l,u,h,c,f,d,p,m){super();this.modelType="Text";this.matrixChange=!1;this._globalIndex=e,this.update(r,i,n,s,o,l,u,h,c,f,d,p,m)}get positionIsNull(){return this._positionIsNull}set positionIsNull(e){this._positionIsNull=e,this.change=!0}update(e,r,i,n,s,o,l,u,h,c,f,d,p){this.buffer=e,this._box=r,this.key=i,this.showKey=n,this.value=s,this.showValue=o,this.fontFamily=l,this.fontSize=u,this.reverse=h,this.reverseExpansion=c,this.positionIsNull=f,this.outline=d,this.silkColor=p,this.matrixChange=!1,this.clearCache()}get box(){return this.reset4Matrix(),this._box}set box(e){this._box=e,this.matrixChange=!1}get modify(){return this._box.modify}set modify(e){this._box.modify=e}set globalIndex(e){this._globalIndex=e,this._box!=null&&(this._box.globalIndex=e)}get globalIndex(){return this._globalIndex}static build(e,r,i,n,s,o,l,u,h,c,f,d,p,m,g,x,y,P,L,w,C,T=null,M,E=!1){let W=z(E,mo.Blength),k=Q.getCache().BuildTextCache;k[0]=i,k[1]=f.x,k[2]=f.y,k[3]=c,k[4]=d,k[5]=p,k[6]=x?1:0,W.set(k,0);let O=Br(r,x),se=zl(d),Y=new b(se.x*L,se.y*w),$=X.getMatrix4(Y,c,O?-1:1,f),ae=b.ORIGIN.multiply4($),le=new b(0,w).multiply4($),ge=new b(L,0).multiply4($),Me=new b(L,w).multiply4($),Je=gt.build(e,r,ae,le,ge,Me,C,M,E);return new mo(e,W,Je,n,s,o,l,u,h,m,g,y,P,T)}get bbox(){return this._box.bbox}set bbox(e){this._box.bbox=e}get matrix(){let e=Br(this.layerId,this.mirror),r=zl(this.origin),i=new b(r.x*this.width,r.y*this.height),n=this.rotation;return X.getMatrix4(i,n,e?-1:1,this.position)}getMatrix(e=this.width,r=this.height){let i=Br(this.layerId,this.mirror),n=zl(this.origin),s=new b(n.x*e,n.y*r),o=this.rotation;return X.getMatrix4(s,o,i?-1:1,this.position)}get layerId(){return this._box.layerId}set layerId(e){this.layerId!=e&&(this._box.layerId=e,this.matrixChange=!0)}get type(){return this.buffer[0]}set type(e){this.updateShapeBuffer(0,[e])}get position(){return new b(this.buffer[1],this.buffer[2])}set position(e){let r=Q.getCache().ARRAY2;r[0]=e.x,r[1]=e.y,this.updateShapeBuffer(1,r),this.matrixChange=!0}get rotation(){return this.buffer[3]}set rotation(e){if(Math.abs(this.rotation-e)<1e-8)return;let r=Q.getCache().ARRAY1;r[0]=e,this.updateShapeBuffer(3,r),this.matrixChange=!0}get origin(){return this.buffer[4]}set origin(e){if(this.origin==e)return;let r=Q.getCache().ARRAY1;r[0]=e,this.updateShapeBuffer(4,r),this.matrixChange=!0}get strokeWidth(){return this.buffer[5]}set strokeWidth(e){let r=Q.getCache().ARRAY1;r[0]=e,this.updateShapeBuffer(5,r)}get mirror(){return this.buffer[6]==1}set mirror(e){if(this.mirror==e)return;let r=Q.getCache().ARRAY1;r[0]=e?1:0,this.updateShapeBuffer(6,r),this.matrixChange=!0}get width(){return this._box.width}get height(){return this._box.height}updateBox4(e,r){let i=this.getMatrix(e,r);this.reset4(e,r,i),this.matrixChange=!1}transform(e,r){if(!r){let n=new b(e.data[0],e.data[1]).normalize(),s=Math.atan2(n.y,n.x);Br(this.layerId,this.mirror)?this.updateShapeBuffer(3,[this.rotation-s]):this.updateShapeBuffer(3,[this.rotation+s])}let i=this.position.multiply4(e);this.updateShapeBuffer(1,[i.x,i.y]),this.matrixChange=!0}inShape(e,r,i){return this.reset4Matrix(),this._box.inShape(e,r,i)}reset4Matrix(){this.matrixChange&&(this.reset4(this.width,this.height,this.matrix),this.matrixChange=!1)}reset4(e,r,i){let n=new b(i.data[12],i.data[13]);this._box.leftLow=n,e==0&&r==0?(this._box.leftUp=n,this._box.rightLow=n,this._box.rightUp=n):(this._box.leftUp=new b(0,r).multiply4(i),this._box.rightLow=new b(e,0).multiply4(i),this._box.rightUp=new b(e,r).multiply4(i))}get locked(){return this._box.locked}set locked(e){this._box.locked=e}updateBox(){return this.reset4Matrix(),this._box.updateBox()}getMathGraphics(e=this.layerId,r=0){return this.reset4Matrix(),this._box.getMathGraphics(e,r)}clone(e=!1){let r=z(e,mo.Blength);r.set(this.buffer),this.reset4Matrix();let i=this._box.clone(e),n=new Array;for(let s of this.outline)n.push(s.clone());return new mo(this.globalIndex,r,i,this.key,this.showKey,this.value,this.showValue,this.fontFamily,this.fontSize,this.reverse,this.reverseExpansion,this.positionIsNull,n,this.silkColor)}getRealOutline(){let e=this.matrix,r=this.outline;if(this.type==1){let i=pm(this);return i.forEach(n=>{n.pl=n.pl.multiply3(e.toMatrix3())}),i}else return r.map(i=>i.multiply3(e.toMatrix3()))}getTextOutline(){let e=this.matrix,r=this.outline;return this.type==1?(r=r.map(i=>i.multiply3(e.toMatrix3())),r):r.map(i=>i.multiply3(e.toMatrix3()))}getText(){let e="",r=this.key,i=this.value,n=this.showKey,s=this.showValue;return r!=""&&i===""&&yn.getInstance().doctype!=3&&this.getParent()==null&&r!="Footprint"&&!yn.getInstance().footprintIsConnectDevice&&(i=`<${r}>`),n?s?e=r+":"+i:e=r:s?e=i:e="",e}},Ye=mo;Ye.Blength=6+1;function pm(a){let t=new Array,e=new co("",0,a.outline);return t=[...t,...e.pls],t}var _e=class extends Fe{constructor(){super(...arguments);this.coppers=new Set;this._silkColor=null}get silkColor(){return this._silkColor}set silkColor(e){this._silkColor=e,this.change=!0}};var xn=class extends Fe{get globalIndex(){return this._globalIndex}set globalIndex(e){this._globalIndex=e,this.box!=null&&(this.box.globalIndex=e)}get modify(){return this.box.modify}set modify(e){this.box.modify=e}get matrix(){let e=Br(this.layerId,this.mirror);return X.rotateZ(this.rotation).scale(e?-1:1,1,1).translate1(this.start.x,this.start.y,0)}get layerId(){return this.box.layerId}set layerId(e){this.layerId!=e&&(this.box.layerId=e,this.reset4Matrix(this.matrix))}get start(){return new b(this.buffer[0],this.buffer[1])}set start(e){this.updateShapeBuffer(0,[e.x,e.y]),this.reset4Matrix(this.matrix)}get width(){return this.buffer[2]}set width(e){this.updateShapeBuffer(2,[e]),this.reset4(this.width,this.height,this.matrix)}get height(){return this.buffer[3]}set height(e){this.updateShapeBuffer(3,[e]),this.reset4(this.width,this.height,this.matrix)}get rotation(){return this.buffer[4]}set rotation(e){this.updateShapeBuffer(4,[e]),this.reset4Matrix(this.matrix)}get mirror(){return this.buffer[5]==1}set mirror(e){this.updateShapeBuffer(5,[e?1:0]),this.reset4Matrix(this.matrix)}get center(){return this.box.center}set center(e){let r=e.sub(this.center),i=X.translate(r.x,r.y,0);this.transform(i)}get bbox(){return this.box.bbox}set bbox(e){this.box.bbox=e}transform(e){let r=new b(e.data[0],e.data[1]).normalize(),i=Math.atan2(r.y,r.x);Br(this.layerId,this.mirror)?this.rotation-=i:this.rotation+=i,this.start=this.start.multiply4(e)}inShape(e,r,i){return this.box.inShape(e,r,i)}reset4Matrix(e){this.reset4(this.width,this.height,e)}reset4(e,r,i){this.box.leftUp=b.ORIGIN.multiply4(i),this.box.leftLow=new b(0,-r).multiply4(i),this.box.rightLow=new b(e,-r).multiply4(i),this.box.rightUp=new b(e,0).multiply4(i)}get locked(){return this.box.locked}set locked(e){this.box.locked=e}updateBox(){return this.box.buildBBox()}getMathGraphics(e=this.layerId,r){return this.isEmpty?null:this.layerId==e?this.box.getMathGraphics(e,r):null}};var bo=class extends xn{constructor(e,r,i,n,s){super();this.modelType="Image";this.globalIndex=e,this.update(r,i,n,s)}update(e,r,i,n){this.buffer=e,this.box=r,this._template=i,this.silkColor=n,this.clearCache()}static build(e,r,i,n,s,o,l,u,h,c,f=!1){let d=z(f,bo.Blength);d[0]=i.x,d[1]=i.y,d[2]=n,d[3]=s,d[4]=o,d[5]=l?1:0;let p=Br(r,l),m=X.translate(0,-s,0).rotateZ(o).scale(p?-1:1,1,1).translate1(i.x,i.y,0),g=gt.build(e,r,b.ORIGIN,new b(0,s),new b(n,0),new b(n,s),h,c,f);return g.transform(m),g.updateBox(),new bo(e,d,g,u)}get template(){return this._template}clone(e=!1){let r=z(e,bo.Blength);r.set(this.buffer);let i=this.box.clone(e),n=new Array;for(let s of this._template)n.push(s.clone());return new bo(this.globalIndex,r,i,n,this.silkColor)}getViewMatrix(){let e=new H;this._template.forEach(l=>{e.ext1(l.bbox())});let r=e.build(),i=X.translate(-r.UL().x,-r.UL().y,0),n=r.height(),s=r.width(),o=X.scale(this.width/s,this.height/n,1);return i.multiply4(o).multiply4(this.matrix)}getRealPath(){let e=this.getViewMatrix().toMatrix3();return this._template.map(r=>r.multiply3(e))}getPath(){let e=this.getViewMatrix(),r=this.getTemplatePath();return r.forEach(i=>{i.pl=i.pl.multiply3(e.toMatrix3())}),r}getPathByTemplatePath(e){let r=this.getViewMatrix(),i=e;return i=i.map(n=>n.clone()),i.forEach(n=>{n.pl=n.pl.multiply3(r.toMatrix3())}),i}getTemplatePath(){let e=this._template.map(n=>n.clone());return new co("",0,e).pls}},Mr=bo;Mr.Blength=5+1;var dm=new Set(["Name","Unique ID","3D Model","3D Model Title","3D Model Transform"]),mm=6.75,go=class extends Fe{constructor(e,r,i,n,s,o,l,u,h){super();this.modelType="Component";this._attrsMap={};this.pads=new Array;this.attrs={};this.others=new Array;this._silkColor=null;this.globalIndex=e,this.update(r,i,n,s,o,l,u,h)}update(e,r,i,n,s,o,l,u){this.buffer=e,this._attrsMap=r,this._footprintUUID=o,this._deviceUUID=l,this.box=s,this._silkColor=u;for(let h of n)h.modelType==="Pad"?this.pads.push(h):this.others.push(h),h.setParent(this);for(let h of i)this.attrs[h.key]=h,h.setParent(this);n.length=0,i.length=0,this.clearCache()}static build(e,r,i,n,s,o,l,u,h,c,f,d,p=!1){let m=z(p,go.Blength);m.set([r,i.x,i.y,n,s.x,s.y],0);for(let g of dm)o[g]==null&&(o[g]="");return h.globalIndex=e,h.layerId=r,new go(e,m,o,l,u,h,c,f,d)}get attrsMap(){return this._attrsMap}get modify(){return this.box.modify}set modify(e){this.box.modify=e}get reuseBlock(){return this._attrsMap["Reuse Block"]||""}set reuseBlock(e){this._attrsMap["Reuse Block"]=e.trim(),this.change=!0}get combinationID(){return this._attrsMap["Group ID"]||""}set combinationID(e){this._attrsMap["Group ID"]=e.trim(),this.change=!0}get channelID(){return this._attrsMap["Channel ID"]||""}set channelID(e){this._attrsMap["Channel ID"]=e.trim(),this.change=!0}get deviceUUID(){return this._deviceUUID}get footprintUUID(){return this._footprintUUID}set footprintUUID(e){this._footprintUUID=e,this.change=!0}get numShape(){return this.attrs["Designator"]}set numShape(e){this.attrs["Designator"]=e,e.setParent(this),this.change=!0}get deviceShape(){return this.attrs["Device"]}set deviceShape(e){this.attrs["Device"]=e,e.setParent(this),this.change=!0}get idShape(){return this.attrs["Footprint"]}set idShape(e){this.attrs["Footprint"]=e,e.setParent(this),this.change=!0}get attributes(){return Object.values(this.attrs)}get attrKeyText(){return this.attrs}getPads(){return this.pads}get attrKeyValue(){let e={};for(let r in this._attrsMap)r!="Reuse Block"&&r!="Channel ID"&&r!="Group ID"&&r!="Reuse Block"&&(e[r]=this._attrsMap[r]);return e}getVias(){let e=new Array;for(let r of this.others)r instanceof Ze&&e.push(r);return e}getItems(){let e=new Array;for(let r of this.pads)e.push(r);for(let r of this.others)e.push(r);return e}getOutlines(){return this.others.filter(e=>e instanceof _e&&e.layerId==11)}getAttrs(){return this.attrs}get layerId(){return this.buffer[0]}set layerId(e){if(this.layerId!=e){for(let l of this.pads){let u=l.layerId;u==12?l.oppositeLayer():u==1?l.layerId=2:u==2&&(l.layerId=1)}let r=new Set;for(let l of this.others){let u=l.layerId;if(u!=null){let h=mh(u);h===u&&l.modelType=="Text"&&r.add(l),l.layerId=h}}let i=Object.values(this.attrs);for(let l of i){let u=mh(l.layerId);u===l.layerId&&r.add(l),l.layerId=u}let n=this.position,s=X.getMatrix4(n.mul(-1),0,-1,n);for(let l of this.pads)l.flip(s);for(let l of i)r.has(l)||(l.position=l.position.multiply4(s));for(let l of this.others)l instanceof Ye?r.has(l)||(l.position=l.position.multiply4(s)):l instanceof Mr?l.start=l.start.multiply4(s):l.transform(s);for(let l of r){let u=l.origin;if(u===4||u===5||u===6)l.position=l.position.multiply4(s);else{let h=1;(u===7||u===8||u===9)&&(h=-1);let c=b.getVector2(l.rotation).mul(h),f=l.position.add(c.mul(l.box.width));l.position=f.multiply4(s)}l.rotation=Math.PI*2-l.rotation}r.clear(),i.length=0;let o=(Math.PI-this.rotation)%Gn;this.updateBuffer(0,[e]),this.updateBuffer(3,[o]),this.box.layerId=e,this.box.transform(s)}}flip(e){let{x:r,y:i}=this.position,{_x:n,_y:s,_z:o}=e?{_x:1,_y:-1,_z:1}:{_x:-1,_y:1,_z:1},l=X.translate(-r,-i,0).scale(n,s,o).translate1(r,i,0);for(let c of this.pads)c.flip(l);for(let c of this.attributes)if(!c.locked){let f=c.position.multiply4(l);c.position=f,c.mirror=!c.mirror,e&&(c.rotation=c.rotation+Math.PI)}for(let c of this.others)c.transform(l);let u=Math.PI*2-this.rotation;e&&(u=u+Math.PI);let h=this.position.multiply4(l);this.updateBuffer(3,[u]),this.updateBuffer(1,[h.x,h.y]),this.box.transform(l)}get position(){return new b(this.buffer[1],this.buffer[2])}set position(e){let r=e.sub(this.position),i=X.translate(r.x,r.y,0);this.transform(i)}get name(){return this._attrsMap["Designator"]}set name(e){this._attrsMap["Designator"]!=e&&(this._attrsMap["Designator"]=e,this.numShape.value=e)}get silkColor(){return this._silkColor}set silkColor(e){this._silkColor=e,this.change=!0}get footprintId(){return this._attrsMap["Footprint"]}set footprintId(e){this.idShape.value=e,this._attrsMap["Footprint"]=e}get device(){return this._attrsMap["Device"]}set device(e){this.deviceShape.value=e,this._attrsMap["Device"]=e}get designator(){return this._attrsMap["Designator"]}addAttribute(e){this.attrs[e.key]=e;let r=/^=\{([^\}]+)\}/g;(e.key!=="Name"||e.key=="Name"&&!r.test(this._attrsMap[e.key]))&&(this._attrsMap[e.key]=e.value),e.setParent(this),this.change=!0}removeAttribute(e){delete this.attrs[e.key],delete this._attrsMap[e.key],e.setParent(null),this.change=!0}getFormulaName(){let e=this._attrsMap.Name;if(!e||!e.startsWith("="))return e;e=e.slice(1);let r=/\{([^\}]+)\}/g,i=[],n=[];for(;i=r.exec(e);)n.push(i[1]);let s=this._attrsMap;s.ID=this.globalIndex;for(let o=0;o<n.length;o++){let l=n[o],u=`{${l}!}`;s.hasOwnProperty(l)&&(u=s[l]),e=e.replace(`{${l}}`,u)}return delete s.ID,e}get rotation(){return this.buffer[3]%Gn}set rotation(e){if(this.rotation!=e){let r=e-this.rotation,i=this.position,n=X.translate(-i.x,-i.y,0).rotateZ(r).translate1(i.x,i.y,0);for(let o of this.pads)o.transform(n);let s=Object.values(this.attrs);for(let o of s)o.transform(n);for(let o of this.others)o.transform(n);this.box.transform(n)}this.updateBuffer(3,[e])}multiply4(e){for(let s of this.pads)s.transform(e);for(let s of this.attributes)s.transform(e);for(let s of this.others)s.transform(e);let r=new b(e.data[0],e.data[1]).normalize(),i=Math.atan2(r.y,r.x);this.layerId==2?this.updateShapeBuffer(3,[this.rotation+i]):this.updateShapeBuffer(3,[this.rotation+i]);let n=this.position.multiply4(e);this.updateBuffer(1,[n.x,n.y]),this.box.transform(e)}transform(e){for(let o of this.pads)o.transform(e);for(let o of this.attributes)o.locked||o.transform(e);for(let o of this.others)o.transform(e);let r=new b(e.data[0],e.data[1]).normalize(),i=Math.atan2(r.y,r.x),n=(this.rotation+i)%Gn,s=this.position.multiply4(e);this.updateBuffer(3,[n]),this.updateBuffer(1,[s.x,s.y]),this.box.transform(e)}getAttrBBox(){let e=new H,r=!1;for(let i in this.attrs){let n=this.attrs[i];(n.showKey&&n.key!==""||n.showValue&&n.value!=="")&&(r=!0,e.ext1(this.attrs[i].bbox))}if(r)return e.build()}set textOffset(e){this.updateBuffer(4,[e.x,e.y])}get textOffset(){return new b(this.buffer[4],this.buffer[5])}addATTRMap(e,r){this._attrsMap[e]=r,this.change=!0}modifyATTRMap(e,r){this._attrsMap[e]=r,this.change=!0}deleteATTRMap(e){delete this._attrsMap[e],this.change=!0}remove(){super.remove(),this.box.remove()}clearMap(){this._attrsMap={}}getNewTextPosition(){let e=this.box.leftLow,r=this.box.leftLow.sub(this.box.leftUp).normalize(),i=this.textOffset.length(),n=e.add(r.mul(i)),s=this.attributes.length,o=mm+.5,l=.001;for(let u=1;u<s+1;u++){let h=e.add(r.mul(u*o)),c=!0;for(let f=0;f<s;f++){let d=this.attributes[f],p=h.add(r.mul(o-l)),m=h.sub(r.mul(o-l)),g=new H;g.ext2(m).ext2(p);let x=g.build();if(!d.positionIsNull&&x.isContains(d.position)){c=!1;break}}if(c){n=h;break}}return n.y>e.add(r.mul(i)).y&&(i+=-o),this.textOffset=new b(this.textOffset.x,i+o),n}resetAttr(e){e&&e.key!=""&&(e.showValue||e.showKey)&&e.positionIsNull&&(e.origin!=3&&(e.origin=3),e.position=this.getNewTextPosition(),e.positionIsNull=!1,e.key==="Name"&&(e.value=e.value))}get bbox(){return this.box.bbox}set bbox(e){this.box.bbox=e}inShape(e,r){return this.box.inShape(e,r)}get locked(){return this.box.locked}set locked(e){this.box.locked=e}updateBox(){return this.box.buildBBox()}getMathGraphics(e=this.layerId,r=0){return this.box.getMathGraphics(e,r)}clone(e=!1){let r=z(e,go.Blength);r.set(this.buffer);let i=Ai({},this._attrsMap),n=new Array(this.attributes.length),s=0;for(let h of this.attributes)n[s]=h.clone(e),s++;let o=this.getItems(),l=new Array(o.length);s=0;for(let h of o)l[s]=h.clone(e),s++;let u=this.box.clone(e);return new go(this.globalIndex,r,i,n,l,u,this.footprintUUID,this.deviceUUID,this._silkColor)}},fr=go;fr.Blength=5+1;var _r=class{static normal(t,e,r){let i=e.sub(t),n=r.sub(e);return i.cross(n)}constructor(t,e,r){this.x=t,this.y=e,this.z=r}cross(t){return new _r(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){var t=this.length();return new _r(this.x/t,this.y/t,this.z/t)}sub(t){return new _r(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new _r(this.x+t.x,this.y+t.y,this.z+t.z)}scale(t){return new _r(this.x*t,this.y*t,this.z*t)}neg(){return new _r(-this.x,-this.y,-this.z)}multiply4(t){var e=this.x*t.data[0]+this.y*t.data[4]+this.z*t.data[8]+t.data[12],r=this.x*t.data[1]+this.y*t.data[5]+this.z*t.data[9]+t.data[13],i=this.x*t.data[2]+this.y*t.data[6]+this.z*t.data[10]+t.data[14],n=this.x*t.data[3]+this.y*t.data[7]+this.z*t.data[11]+t.data[15];return new _r(e/n,r/n,i/n)}},pr=_r;pr.ORIGIN=new _r(0,0,0),pr.X_UNIT_VECTOR=new _r(1,0,0),pr.Y_UNIT_VECTOR=new _r(0,1,0),pr.Z_UNIT_VECTOR=new _r(0,0,1);function ii(a,t,e,r,i,n,s,o){if(r=Nr(r),i=Nr(i),e==0)return!1;if(s==0&&o!=null&&(s=10/o),n==0){let T=r;r=i,i=T}let{x:l,y:u}=a,h=s/2,c=e-h,f=e+h,d=l-t.x,p=u-t.y,m=Math.atan2(p,d);if(m<0&&(m+=Z),r<=i&&m>=r&&m<=i||r>i&&(m>=r&&m<=Z||m>=0&&m<=i)||r==i){var g=Math.sqrt(d*d+p*p);return g<=f&&g>=c}else{var g=(f+c)/2,x=new pr(t.x+Math.cos(r)*g,t.y+Math.sin(r)*g,0),y=new pr(t.x+Math.cos(i)*g,t.y+Math.sin(i)*g,0),P=l-x.x,L=u-x.y,w=l-y.x,C=u-y.y;return P*P+L*L<=s*s/4?!0:w*w+C*C<=s*s/4}}var yo=class extends Fe{constructor(e,r,i,n,s){super();this.globalIndex=e,this.update(r,i,n,s)}update(e,r,i,n){this._net=e,this.source=r,this.pls=n,this.buffer=i,this.clearCache()}get modify(){return!1}set modify(e){}get net(){return this._net}set net(e){this._net=e,this.change=!0}updateBox(){let e=new H;for(let r of this.pls)e.ext1(r.bbox());return this.bbox=e.build(),this.bbox}get start(){return this.pls.length>0?this.pls[0].primitives[0].start():null}};function gf(a){switch(a){case"solid":return 0;case"90grid":return 1;case"45grid":return 2;case"none":return 3}}function bm(a){switch(a){case 0:return"solid";case 1:return"90grid";case 2:return"45grid";case 3:return"none"}}var jn=.8,xo=class extends yo{constructor(){super(...arguments);this.modelType="Copper"}static build(e,r,i,n,s,o,l,u,h,c,f=!1){let d=z(f,xo.Blength),p=Q.getCache().ARRAY6;p[0]=r,p[1]=gf(n),p[2]=s,p[3]=o,p[4]=l?1:0,p[5]=h?1:0,d.set(p,0);let m=et(u);if(c==null){let g=new H,x=null,y=null,P=m.length;for(let L=0;L<P;L++)y=m[L],x=y.bbox(),g.ext1(x);switch(n){case"solid":{l&&g.ext7(jn/2);break}case"90grid":case"45grid":{g.ext7(s/2);break}case"none":break}c=g.build()}return d.set(c.data,6),new xo(e,i,u,d,m)}get modify(){return!1}set modify(e){}get layerId(){return this.buffer[0]}set layerId(e){this.updateBuffer(0,[e])}get bbox(){return new j(this.buffer[6],this.buffer[7],this.buffer[8],this.buffer[9])}set bbox(e){this.updateBuffer(6,e.data)}get locked(){return this.buffer[5]==1}set locked(e){this.updateBuffer(5,[e?1:0])}get style(){return bm(this.buffer[1])}set style(e){this.updateShapeBuffer(0,[gf(e)])}get gridLineWidth(){return this.buffer[2]}set gridLineWidth(e){this.updateShapeBuffer(2,[e])}get clearance(){return this.buffer[3]}set clearance(e){this.updateShapeBuffer(3,[e])}get optimization(){return this.buffer[4]==1}set optimization(e){this.updateShapeBuffer(4,[e?1:0])}get optimizationWidth(){return .8}get isSolid(){return this.style=="solid"}get copperPath(){return this.source}transform(e){}updateBox(){let e=new H;for(let r of this.pls)e.ext1(r.bbox());switch(this.style){case"solid":{this.optimization&&e.ext7(jn/2);break}case"90grid":case"45grid":{e.ext7(this.gridLineWidth/2);break}case"none":break}return this.bbox=e.build(),this.bbox}clone(e=!1){let r=z(e,xo.Blength);r.set(this.buffer);let i=JSON.parse(JSON.stringify(this.source)),n=new Array;for(let s of this.pls)n.push(s.clone());return new xo(this.globalIndex,this.net,i,r,n)}inShape(e,r){let{style:i,optimization:n,gridLineWidth:s}=this,o=new b(e,r);switch(i){case"solid":{let l=wt.inPolygon(o,this.pls);if(!l&&n){for(let u of this.pls)for(let h of u.primitives)if(h instanceof S?l=lt(o,h.start(),h.end(),jn):h instanceof R&&(l=ii(o,h.center,h.rx,h.startAngle/180*Math.PI,h.endAngle()/180*Math.PI,h.sweep(),jn)),l)return l}return l}case"90grid":case"45grid":{let l=!1;for(let u of this.pls)for(let h of u.primitives)if(h instanceof S?l=lt(o,h.start(),h.end(),s):h instanceof R&&(l=ii(o,h.center,h.rx,h.startAngle/180*Math.PI,h.endAngle()/180*Math.PI,h.sweep(),s)),l)return l;return!1}case"none":break}return!1}rotateFor(e,r){let i=X.rotateZForPoint(e,r);this.transform(i)}getOutline(e=this.layerId,r=0){return this.pls}getRealOutline(){let e=new Array,{style:r,optimization:i,gridLineWidth:n}=this;for(let s of this.pls)switch(r){case"solid":{if(e.push(s),i)for(let o of s.primitives){let l=o.stroke(jn,1,0);e.push(l)}break}case"90grid":case"45grid":{for(let o of s.primitives){let l=o.stroke(n,1,0);e.push(l)}break}case"none":break}return e}getMathGraphics(e=this.layerId,r=0){let i=new Array,{style:n,optimization:s,gridLineWidth:o}=this;switch(n){case"solid":if(F.addAll(i,this.pls),s)for(let l of this.pls)for(let u of l.primitives)i.push(u.stroke(jn,1,0));case"90grid":case"45grid":for(let l of this.pls)for(let u of l.primitives)i.push(u.stroke(jn,1,0));case"none":break}return new ee(i)}},Ar=xo;Ar.Blength=6+4;var Po=class extends yo{constructor(){super(...arguments);this.modelType="Inner";this._layerId=null}static build(e,r,i,n,s,o,l,u=!1){let h=z(u,Po.Blength),c=Q.getCache().ARRAY3;c[0]=r,c[1]=n?1:0,c[2]=o?1:0,h.set(c,0);let f=et(s);if(l==null){let d=new H,p=null,m=null,g=f.length;for(let x=0;x<g;x++)m=f[x],p=m.bbox(),d.ext1(p);l=d.build()}return h.set(l.data,3),new Po(e,i,s,h,f)}get layerId(){return this._layerId==null&&(this._layerId=this.buffer[0]),this._layerId}set layerId(e){this._layerId=e,this.updateBuffer(0,[e])}get bbox(){return new j(this.buffer[3],this.buffer[4],this.buffer[5],this.buffer[6])}set bbox(e){this.updateBuffer(3,e.data)}get locked(){return this.buffer[2]==1}set locked(e){this.updateBuffer(2,[e?1:0])}get style(){return this.buffer[1]==1}set style(e){this.updateShapeBuffer(1,[e?1:0])}get copperPath(){return this.source}transform(e){}inShape(e,r,i){return wt.inPolygon(new b(e,r),this.pls)}getOutline(e,r){return this.pls}clone(e=!1){let r=z(e,Po.Blength);r.set(this.buffer);let i=JSON.parse(JSON.stringify(this.source)),n=new Array;for(let s of this.pls)n.push(s.clone());return new Po(this.globalIndex,this.net,i,r,n)}getMathGraphics(e=this.layerId,r=0){return new ee(this.pls)}},Or=Po;Or.Blength=3+4;var Yl=class{constructor(t,e,r,i,n,s=!0){this._isKeepIsland=!0;this._layerId=t,this._thickness=r,this._permittivity=i,this._lossTangent=n,this._material=e,this._isKeepIsland=s}get layerId(){return this._layerId}get material(){return this._material}get thickness(){return this._thickness}get permittivity(){return this._permittivity}get lossTangent(){return this._lossTangent}get layerName(){return Bt.getInstance().getLayer(this.layerId).name}get layerType(){return Bt.getInstance().getLayer(this.layerId).type}get isKeepIsland(){return this._isKeepIsland}set isKeepIsland(t){this._isKeepIsland=t}};var Qn=class{constructor(t,e,r,i,n,s){this.layerId=t,this.type=e,this.hashed=t,this.name=r,this.status=i,this.activeColor=n,this.deactiveColor=s}get config(){return this.status.config}set config(t){this.status.config=t}get visible(){return this.status.visible}set visible(t){this.status.visible=t}get locked(){return this.status.locked}set locked(t){this.status.locked=t}get state(){return this.status.state}hashCode(){return this.hashed}equals(t){return t instanceof Qn?this.layerId===t.layerId:!1}};var So=class extends be{constructor(){super(...arguments);this.activeLayer=0;this._layerPhys=[];this.helpLayerMask={}}static getInstance(){return So.manager==null&&(So.manager=new So),So.manager}getLayerPhys(){return this._layerPhys}setLayerPhys(e){this._layerPhys=e}addLayerPhy(e,r,i,n,s,o){this._layerPhys.push(new Yl(e,r,i,n,s,o))}getLayerPhy(e){for(let r of this._layerPhys)if(r.layerId===e)return r;return null}getfilterPhyLayers(){let e={};for(let[r,i]of this.map)i.type=="SUBSTRATE"?this.getLayerPhy(i.layerId)!=null&&(e[r]=i):e[r]=i;return e}addLayer(e,r,i,n,s,o){let l=new Qn(e,r,i,n,s,o);return this.map.set(e,l),l}addHelpLayer(e,r,i,n,s,o){let l=new Qn(e,r,i,n,s,o);return this.helpLayerMask[e]=l,l}getHelpLayer(e){return this.helpLayerMask[e]}modifyLayer(e,r,i,n,s,o){let l=this.map.get(e);return l==null?this.addLayer(e,r,i,n,s,o):(l.type=r,l.name=i,l.config=n.config,l.visible=n.visible,l.locked=n.locked,l.activeColor=s,l.deactiveColor=o,l)}getLayer(e){return this.map.get(e)}setLayer(e){let r=e.layerId;this.map.set(r,e)}getAllCopperLayer(){let e=new Array;for(let[r,i]of this.map)i.config&&ff(i.type)&&e.push(i);return e}getAllCopperLayerIds(){return this.getAllCopperLayer().map(e=>e.layerId)}getAllSignalLayers(){return this.getAllCopperLayer().filter(e=>qn(e.type))}getAllSignalLayerIds(){return this.getAllSignalLayers().map(e=>e.layerId)}getAllPlaneLayer(){let e=new Array;for(let[r,i]of this.map)i.config&&oo(i.type)&&e.push(i);return e}getAllPlaneLayerIds(){return this.getAllPlaneLayer().map(e=>e.layerId)}recycle(){this.map.clear(),this._layerPhys.length=0}},Bt=So;Bt.manager=null;var bh=ke.getInstance(),gh=class{isLine(t){return t instanceof _e&&t.type==="Line"}isBoardOutline(t){return t instanceof _e&&(t.type==="Board Outline"||t.type==="Line"&&t.layerId===11)}isPour(t){return t instanceof _e&&t.type==="Copper Region"}isFill(t){return t instanceof _e&&t.type==="Fill Region"}isProhibit(t){return t instanceof _e&&t.type==="Prohibited Region"}isSlot(t){return t instanceof _e&&t.type==="Slot Region"}isRegion(t){return t instanceof _e&&t.type==="Fill Region"}isTearDrop(t){return t instanceof _e&&t.type==="TearDrop"}isPcbBoxShape(t){return t instanceof xn||t instanceof Ye}isSingleLayerShape(t){return!!(t instanceof vr||t instanceof tt&&!Xn(t.layerId)||this.isRegion(t)||this.isLine(t)||this.isTearDrop(t)||t instanceof fr||this.isPcbBoxShape(t)||t instanceof Ar||t instanceof Or)}isPlaneLayer(t){let e=Bt.getInstance().getLayer(t);return e&&oo(e.type)}isUnuseLayer(t){let e=Bt.getInstance().getLayer(t);return e==null||!e.config}isSmdComponent(t){return t.getPads().every(r=>!Xn(r.layerId))}getShapeNetDiff(t){if(t.net)return bh.getNet(t.net).netDifferentail}getShape2NetDiff(t,e){if(t.net&&e.net){let r=bh.getNet(t.net),i=bh.getNet(e.net);if(r.netDifferentail==i.netDifferentail&&r.netDifferentail!=null)return r.netDifferentail}}},yf=new gh;function te(a=!0){return{enforce:a,level:-9999}}var xf={["distanceSameComponentItem"]:{distanceSameComponentItem:te()},["prohibitRegionRule"]:{overlapWithOtherObject:te()},["trackRule"]:{minTrackWidth:te(),maxTrackWidth:te()},["netLength"]:{minLength:te(),maxLength:te()},["holeSize"]:{minViaSize:te(),maxViaSize:te()},["connect"]:{sameNetNotConnect:te(),checkFreeCopper:te(),checkFreeTrack:te(),checkFreeLine:te(),checkFreeFillRegion:te()},["diff"]:{minWidth:te(),maxWidth:te(),minGap:te(),maxLengthTolerance:te()},["distanceTrack"]:{["track"]:te(),["pad"]:te(),["via"]:te(),["fillRegion"]:te(),["slot"]:te(),["line"]:te(),["textAndImage"]:te(),["outline"]:te()},["distancePad"]:{["pad"]:te(),["via"]:te(),["fillRegion"]:te(),["slot"]:te(),["line"]:te(),["textAndImage"]:te(),["outline"]:te()},["distanceVia"]:{["via"]:te(),["fillRegion"]:te(),["slot"]:te(),["line"]:te(),["textAndImage"]:te(),["outline"]:te()},["distanceFillRegion"]:{["fillRegion"]:te(),["slot"]:te(),["line"]:te(),["textAndImage"]:te(),["outline"]:te()},["distanceSlot"]:{["slot"]:te(),["line"]:te(),["textAndImage"]:te(),["outline"]:te()},["distanceLine"]:{["line"]:te(),["textAndImage"]:te(),["outline"]:te()},["distanceTextImage"]:{["textAndImage"]:te(),["outline"]:te()},["distanceComponent"]:{["component"]:te(),["pad"]:te()},["distancePlaneZone"]:{["track"]:te(),["pad"]:te(),["via"]:te(),["fillRegion"]:te(),["slot"]:te(),["line"]:te(),["textAndImage"]:te(),["outline"]:te()},["distanceCopper"]:{["track"]:te(),["pad"]:te(),["via"]:te(),["fillRegion"]:te(),["slot"]:te(),["line"]:te(),["textAndImage"]:te(),["outline"]:te()}};var gi=class{constructor(){this._isOpenDRCCustomCheck=!1;this.config=xf}static getInstance(){return gi.instance==null&&(gi.instance=new gi),gi.instance}get isOpenDRCCustomCheck(){return this._isOpenDRCCustomCheck}set isOpenDRCCustomCheck(t){this._isOpenDRCCustomCheck=!!t}updateConfig(t){this.config=t}isCheck(t){return!this.isOpenDRCCustomCheck||!t?!0:t.enforce}isCheckDistance(t,e){if(!this.isOpenDRCCustomCheck)return!0;let r=null;return this.isSameComponentChild(t,e)?r=this.distanceSameComponentItem.distanceSameComponentItem:yf.getShape2NetDiff(t,e)?r=this.diff.minGap:(r=this.matchDistanceConfig(t,e),r||(r=this.matchDistanceConfig(e,t))),this.isCheck(r)}isSameComponentChild(t,e){let r=t.getParent(),i=e.getParent();return r instanceof fr&&i instanceof fr&&r.globalIndex===i.globalIndex}matchDistanceConfig(t,e){let r=null;if(t instanceof _e&&t.type=="Prohibited Region"||e instanceof _e&&e.type=="Prohibited Region")return this.prohibitRegionRule.overlapWithOtherObject;if(t instanceof fr)return e instanceof tt?this.distanceComponent.pad:this.distanceComponent.component;let i=null;return t instanceof vr?i=this.distanceTrack:t instanceof tt?i=this.distancePad:t instanceof Ze?i=this.distanceVia:t instanceof _e&&t.type=="Fill Region"?i=this.distanceFillRegion:t instanceof _e&&t.type=="Slot Region"?i=this.distanceSlot:t instanceof _e&&t.type=="Line"?i=this.distanceLine:t instanceof Ye||t instanceof Mr?i=this.distanceTextImage:t instanceof Ar?i=this.distanceCopper:t instanceof Or&&(i=this.distancePlaneZone),i&&(e instanceof vr?r=i["track"]:e instanceof tt?r=i["pad"]:e instanceof Ze?r=i["via"]:e instanceof _e&&e.type=="Fill Region"?r=i["fillRegion"]:e instanceof _e&&e.type=="Slot Region"?r=i["slot"]:e instanceof _e&&e.type=="Line"?r=i["line"]:e instanceof Ye||e instanceof Mr?r=i["textAndImage"]:e instanceof _e&&e.type=="Board Outline"&&(r=i["outline"])),r}get distanceSameComponentItem(){return this.config.distanceSameComponentItem}get prohibitRegionRule(){return this.config.prohibitRegionRule}get trackRule(){return this.config.trackRule}get netLength(){return this.config.netLength}get holeSize(){return this.config.holeSize}get connect(){return this.config.connect}get diff(){return this.config.diff}get distanceTrack(){return this.config.distanceTrack}get distancePad(){return this.config.distancePad}get distanceVia(){return this.config.distanceVia}get distanceFillRegion(){return this.config.distanceFillRegion}get distanceSlot(){return this.config.distanceSlot}get distanceLine(){return this.config.distanceLine}get distanceTextImage(){return this.config.distanceTextImage}get distanceComponent(){return this.config.distanceComponent}get distancePlaneZone(){return this.config.distancePlaneZone}get distanceCopper(){return this.config.distanceCopper}};var Sf=118.11,hne=.1/10,xe=new Ht().conversion("mm","mil",1)/10,cne=3.6*xe,fne={["M2"]:7.874,["M3"]:11.811,["M4"]:15.748,["M5"]:19.685,["M6"]:23.622},pne=90,dne=new Rn(39.37,10).ratio,wo={M2:{holeDiameterWithoutSpigot:1.8*xe,holeDiameterWithSpigot:2.2*xe,topStiffWidth:3*xe,botStiffWidth:5*xe,topStiffDistance:2*xe,stiffThickness:1.2*xe,screwheadHeight:2.5*xe,screwheadDiameter:4*xe,thickness:1.27*xe},M3:{holeDiameterWithoutSpigot:2.8*xe,holeDiameterWithSpigot:3.2*xe,topStiffWidth:3*xe,botStiffWidth:5*xe,topStiffDistance:2*xe,stiffThickness:1.2*xe,screwheadHeight:3.2*xe,screwheadDiameter:5.8*xe,thickness:1.27*xe},M4:{holeDiameterWithoutSpigot:3.8*xe,holeDiameterWithSpigot:4.2*xe,topStiffWidth:3*xe,botStiffWidth:5*xe,topStiffDistance:2*xe,stiffThickness:1.5*xe,screwheadHeight:4.2*xe,screwheadDiameter:7.5*xe,thickness:1.27*xe},M5:{holeDiameterWithoutSpigot:4.8*xe,holeDiameterWithSpigot:5.2*xe,topStiffWidth:3*xe,botStiffWidth:6*xe,topStiffDistance:3*xe,stiffThickness:1.5*xe,screwheadHeight:5.2*xe,screwheadDiameter:9*xe,thickness:1.27*xe},M6:{holeDiameterWithoutSpigot:5.8*xe,holeDiameterWithSpigot:6.2*xe,topStiffWidth:3*xe,botStiffWidth:6*xe,topStiffDistance:3*xe,stiffThickness:2*xe,screwheadHeight:6.2*xe,screwheadDiameter:10.5*xe,thickness:1.27*xe}};var Lo=class extends Ms{static build(t,e,r){let i=new Lo;return i.config=t,i.visible=e,i.locked=r,i}constructor(t=6){super(t)}get config(){return this.getValue(0)}set config(t){this.setValue(0,t)}get visible(){return this.getValue(1)}set visible(t){this.setValue(1,t)}get locked(){return this.getValue(2)}set locked(t){this.setValue(2,t)}};var Mo=class{constructor(){this.GGEIDs=new Set;this.id=0}addId(t){this.GGEIDs.add(t)}has(t){return this.GGEIDs.has(t)}getID(t="e"){for(;;){let e=this.id++,r=t+e;if(!this.GGEIDs.has(r))return e}}delete(t){this.GGEIDs.delete(t)}};function Re(a,t,e,r=!1){let i=new Xt;for(let[n,s]of a)(e||s.change||t.has(n))&&(i.addLast(s),r&&(s.change=!1));return i.toArray()}var ql=class{static createId(){let t="arc"+ql.GGEID.getID("arc");return ql.GGEID.addId(t),t}},yh=ql;yh.GGEID=new Mo;var Ao=class extends be{static getInstance(){return Ao.manager==null&&(Ao.manager=new Ao),Ao.manager}addModel(t){this.map.set(t.globalIndex,t),this.survive(t.globalIndex)}addArc(t,e,r,i,n,s,o,l,u,h=1){return this._last=qt.build(t,e,r,i,n,s,o,l,u,h,null,!0),this.addModel(this._last),this._last}addByBuffer(t,e){return this._last=this.map.get(t),this._last!=null?this._last.update(e):(this._last=new qt(t,e),this.map.set(t,this._last)),this._last}delete(t){t instanceof qt&&(this.map.delete(t.globalIndex),this.del(t.globalIndex))}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}},Pn=Ao;Pn.manager=null;function xh(a,t,e){if(isNaN(t))throw new Error("Circle error,radius is NaN");if(t<0)return;let r=new H;return r.ext2(a).ext7(t+e/2),r.build()}var Ph=class{updatePropsBySpecification(t,e,r,i){let n=wo[e];if(e!=="Custom"&&n){let s=this.specificationToProps(n,t.height,i);t.thickness=s.thickness,t.holeDiameter=s.holeDiameter,r?t.stiffenerProps=s.stiffenerProps:t.stiffenerProps=null,i?t.counterboreProps=s.counterboreProps:t.counterboreProps=null}}specificationToProps(t,e,r){return{thickness:t.thickness,holeDiameter:r?t.holeDiameterWithSpigot:t.holeDiameterWithoutSpigot,counterboreProps:{height:t.screwheadHeight,diameter:t.screwheadDiameter},stiffenerProps:{topWidth:t.topStiffWidth,bottomWidth:t.botStiffWidth,height:e-t.topStiffDistance,stiffThickness:t.stiffThickness}}}getSpecificationByFuzzyMatch(t){let{needCounterbore:e,holeDiameter:r,height:i}=t,n,s=Number.MAX_VALUE,o=wo;return Object.keys(o).map(l=>{let{holeDiameterWithSpigot:u,holeDiameterWithoutSpigot:h}=o[l],f=Math.abs((e?u:h)-r);f<s&&(s=f,n=l)}),this.specificationToProps(wo[n],i,e)}getScrewPillarSize(t){let{holeDiameter:e,counterboreProps:r,stiffenerProps:i}=t,n=e/2,s=n;r&&(s=r.diameter/2);let o=0,l=0;return i&&(o=Math.max(i.topWidth,i.bottomWidth)+n,l=i.stiffThickness),{innerRadius:n,outerRadius:s,stiffToCenterLength:o,stiffStrokeWidth:l}}},Ga=new Ph;var yt=class{constructor(){this.groupID=null;this.parent=null}setParent(t){this.parent=t}set change(t){this.parent!=null&&(this.parent.change=t)}setGroupID(t){this.groupID=t}clone(){return new yt}};var ise=.1/10,Di=class extends yt{constructor(e,r){super();this._stiffenerProps=null;this._counterboreProps=null;this._height=r,this._specification=e}get specification(){return this._specification}set specification(e){if(e!=="Custom"){let{needCounterbore:r,needStiffener:i}=this;Ga.updatePropsBySpecification(this,e,i,r)}this._specification=e,this.change=!0}get height(){return this._height}set height(e){this._height=e,this.change=!0}get holeDiameter(){return this._holeDiameter}set holeDiameter(e){e!==this._holeDiameter&&(this._holeDiameter=e),this.change=!0}get thickness(){return this._thickness}set thickness(e){e!==this._thickness&&(this._thickness=e),this.change=!0}get stiffenerProps(){return this._stiffenerProps?Ai({},this._stiffenerProps):null}set stiffenerProps(e){this._stiffenerProps=e?Ai({},e):null,this.change=!0}updateStiffenerProps(e){let r=this._stiffenerProps;r&&(ei(e.topWidth)&&e.topWidth!==r.topWidth&&(r.topWidth=e.topWidth),ei(e.bottomWidth)&&e.bottomWidth!==r.bottomWidth&&(r.bottomWidth=e.bottomWidth),ei(e.height)&&e.height!==r.height&&(r.height=e.height),ei(e.stiffThickness)&&e.stiffThickness!==r.stiffThickness&&(r.stiffThickness=e.stiffThickness))}get counterboreProps(){return this._counterboreProps?Ai({},this._counterboreProps):null}set counterboreProps(e){this._counterboreProps=e?Ai({},e):null,this.change=!0}updateCounterboreProps(e){let r=this._counterboreProps;r&&(ei(e.height)&&e.height!==r.height&&(r.height=e.height),ei(e.diameter)&&e.diameter!==r.diameter&&(r.diameter=e.diameter))}get needStiffener(){return!!this.stiffenerProps}set needStiffener(e){if(e){if(!this.needStiffener){let r=Ga.getSpecificationByFuzzyMatch(this);this.stiffenerProps=r.stiffenerProps}}else this.stiffenerProps=null;this.change=!0}get needCounterbore(){return!!this.counterboreProps}set needCounterbore(e){if(this.specification!=="Custom"){let r=wo[this.specification];if(e!==this.needCounterbore&&r){let i=Ga.specificationToProps(r,this.height,e);this.holeDiameter=i.holeDiameter}}if(e){if(!this.needCounterbore){let r=Ga.getSpecificationByFuzzyMatch(this);this.counterboreProps=r.counterboreProps}}else this.counterboreProps=null;this.change=!0}toJSON(){return{height:this.height,specification:this.specification,holeDiameter:this.holeDiameter,thickness:this.thickness,counterboreProps:this.counterboreProps,stiffenerProps:this.stiffenerProps}}clone(){return new Di(this.specification,this.height)}getParameters(){}};function wf(a,t,e,r,i,n){let s=X.rotateZForPoint(t,-i),o=a.multiply4(s),l=Math.min(e/2,r/2,n),u=t,h=new b(t.x,t.y-r),c=new b(t.x+e,t.y),f=new b(t.x+e,t.y-r),d=h.add1(l,l),p=f.add1(-l,l),m=c.add1(-l,-l),g=u.add1(l,-l);if(new j(h.x,c.x,h.y,c.y).isContains(o)){if(o.x<d.x){if(o.y<d.y)return o.distance1(d)<=l;if(o.y>g.y)return o.distance1(g)<=l}if(o.x>p.x){if(o.y<p.y)return o.distance1(p)<=l;if(o.y>m.y)return o.distance1(m)<=l}return!0}else return!1}function Xl(a,t,e,r,i,n,s,o=!1){let l=X.rotateZForPoint(t,-i),u=a.multiply4(l),h=Math.min(e/2,r/2,n),c=t,f=new b(t.x,t.y-r),d=new b(t.x+e,t.y),p=new b(t.x+e,t.y-r),m=f.add1(h,h),g=p.add1(-h,h),x=d.add1(-h,-h),y=c.add1(h,-h),P=new b(c.x,m.y),L=new b(c.x,y.y),w=new b(y.x,c.y),C=new b(x.x,c.y),T=new b(p.x,x.y),M=new b(p.x,g.y),E=new b(g.x,p.y),W=new b(m.x,p.y);return!!(lt(u,P,L,s)||lt(u,w,C,s)||lt(u,T,M,s)||lt(u,E,W,s)||!o&&(ii(u,m,h,On,On*1.5,1,s)||ii(u,g,h,On*1.5,Z,1,s)||ii(u,x,h,0,On/2,1,s)||ii(u,y,h,On/2,On,1,s)))}function Sh(a,t,e,r,i,n){let s=Math.min(t/2,e/2,i),o=X.rotateZForPoint(a,r),l=a,u=new b(a.x,a.y-e),h=new b(a.x+t,a.y),c=new b(a.x+t,a.y-e),f=u.add1(s,s).multiply4(o),d=c.add1(-s,s).multiply4(o),p=h.add1(-s,-s).multiply4(o),m=l.add1(s,-s).multiply4(o),g=new H;return g.ext2(f).ext2(d).ext2(p).ext2(m).ext7(s+n/2),g.build()}var Io=class extends _e{constructor(e,r,i,n,s,o){super();this.modelType="Rect";this.globalIndex=e,this.update(r,i,n,s,o)}update(e,r,i,n,s){this.buffer=e,this._type=r,this.net=i,this._silkColor=n,this.component=s,this.clearCache()}static build(e,r,i,n,s,o,l,u,h,c,f,d,p,m,g=!1){let x=z(g,Io.Blength);return x[1]=i,x[2]=n.x,x[3]=n.y,x[4]=nt(s),x[5]=nt(o),x[6]=l,x[7]=u,x[8]=Dr(c,r),x[9]=f?1:0,m==null&&(m=Sh(n,s,o,l,u,x[8])),x.set(m.data,10),new Io(e,x,r,h,d,p)}get modify(){return this.buffer!=null&&this._modify!=this.buffer[0]}set modify(e){e?this._modify==this.buffer[0]&&this.buffer[0]++:this._modify=this.buffer[0]}get net(){return this._net}set net(e){this._net=e,this.change=!0}get layerId(){return this.buffer[1]}set layerId(e){this.updateBuffer(1,[e])}get start(){return new b(this.buffer[2],this.buffer[3])}set start(e){this.updateShapeBuffer(2,[e.x,e.y])}get width(){return this.buffer[4]}set width(e){e=nt(e),this.updateShapeBuffer(4,[e])}get height(){return this.buffer[5]}set height(e){e=nt(e),this.updateShapeBuffer(5,[e])}get rotation(){return this.buffer[6]}set rotation(e){this.updateShapeBuffer(6,[e])}get radius(){return this.buffer[7]}set radius(e){this.updateShapeBuffer(7,[e])}get strokeWidth(){return this.buffer[8]}set strokeWidth(e){e=Dr(e,this.type),this.updateShapeBuffer(8,[e])}get bbox(){return new j(this.buffer[10],this.buffer[11],this.buffer[12],this.buffer[13])}set bbox(e){this.updateBuffer(10,e.data)}get leftLow(){let e=X.rotateZForPoint(this.start,this.rotation);return new b(this.buffer[2],this.buffer[3]-this.buffer[5]).multiply4(e)}set leftLow(e){let r=this.start,i=X.rotateZForPoint(r,-this.rotation),n=X.rotateZForPoint(r,this.rotation),s=e.multiply4(i),o=this.getBox(s,new b(this.buffer[2]+this.buffer[4],this.buffer[3])),l=new b(o[0],o[3]).multiply4(n),u=Math.abs(o[2]-o[0]),h=Math.abs(o[3]-o[1]);this.updateShapeBuffer(2,[l.x,l.y,u,h])}get leftUp(){return new b(this.buffer[2],this.buffer[3])}set leftUp(e){let r=this.start,i=X.rotateZForPoint(r,-this.rotation),n=X.rotateZForPoint(r,this.rotation),s=e.multiply4(i),o=this.getBox(s,new b(this.buffer[2]+this.buffer[4],this.buffer[3]-this.buffer[5])),l=new b(o[0],o[3]).multiply4(n),u=Math.abs(o[2]-o[0]),h=Math.abs(o[3]-o[1]);this.updateShapeBuffer(2,[l.x,l.y,u,h])}get rightLow(){let e=X.rotateZForPoint(this.start,this.rotation);return new b(this.buffer[2]+this.buffer[4],this.buffer[3]-this.buffer[5]).multiply4(e)}set rightLow(e){let r=this.start,i=X.rotateZForPoint(r,-this.rotation),n=X.rotateZForPoint(r,this.rotation),s=e.multiply4(i),o=this.getBox(s,r),l=new b(o[0],o[3]).multiply4(n),u=Math.abs(o[2]-o[0]),h=Math.abs(o[3]-o[1]);this.updateShapeBuffer(2,[l.x,l.y,u,h])}get rightUp(){let e=X.rotateZForPoint(this.start,this.rotation);return new b(this.buffer[2]+this.buffer[4],this.buffer[3]).multiply4(e)}set rightUp(e){let r=this.start,i=X.rotateZForPoint(r,-this.rotation),n=X.rotateZForPoint(r,this.rotation),s=e.multiply4(i),o=this.getBox(s,new b(this.buffer[2],this.buffer[3]-this.buffer[5])),l=new b(o[0],o[3]).multiply4(n),u=Math.abs(o[2]-o[0]),h=Math.abs(o[3]-o[1]);this.updateShapeBuffer(2,[l.x,l.y,u,h])}getBox(e,r){let i=Math.min(e.x,r.x),n=Math.max(e.x,r.x),s=Math.min(e.y,r.y),o=Math.max(e.y,r.y);return n-i<.01&&(n=i+.01),o-s<.01&&(s=o-.01),[i,s,n,o]}get realCornerRadius(){return Math.min(this.width/2,this.height/2,this.radius)}get cornerRatio(){return this.realCornerRadius/Math.min(this.width/2,this.height/2)}getAllLinesInOrder(){let e=this.getLines(),r=this.getArcs();return[r[0],e[0],r[1],e[1],r[2],e[2],r[3],e[3]].filter(i=>i!=null)}get type(){return this._type}set type(e){this._type=e,this.modify=!0}get component(){return this._component}set component(e){var r;this._component=e,(r=this._component)==null||r.setParent(this),this.modify=!0}rotateFor(e,r){let i=X.rotateZForPoint(e,r);this.transform(i)}transform(e){let r=this.rightLow,i=this.start.multiply4(e);r=r.multiply4(e),this.rotation=b.caculateAngle(this.rotation,e)%Z;let n=X.translate(-i.x,-i.y,0).rotateZ(-this.rotation),s=X.rotateZ(this.rotation).translate1(i.x,i.y,0),o=new H;o.ext2(i.multiply4(n)).ext2(r.multiply4(n));let l=o.build();this.start=l.UL().multiply4(s)}inOutline(e){return this.inShape(e.x,e.y)}inShape(e,r){switch(this._type){case"Line":case"Board Outline":case"3D Shell - Outline":return Xl(new b(e,r),this.start,this.width,this.height,this.rotation,this.radius,this.strokeWidth);default:return Xl(new b(e,r),this.start,this.width,this.height,this.rotation,this.radius,this.strokeWidth)?!0:wf(new b(e,r),this.start,this.width,this.height,this.rotation,this.radius)}}isSelectOnlyLine(e,r){return Xl(new b(e,r),this.start,this.width,this.height,this.rotation,this.radius,this.strokeWidth,!0)}getEndPoints(){let{leftUp:e,leftLow:r,rightUp:i,rightLow:n,realCornerRadius:s}=this,o=n.sub(r).normalize(),l=e.sub(r).normalize(),u=r.add(o.mul(s)),h=n.add(o.mul(-s)),c=n.add(l.mul(s)),f=i.add(l.mul(-s)),d=i.add(o.mul(-s)),p=e.add(o.mul(s)),m=e.add(l.mul(-s)),g=r.add(l.mul(s));return[u,h,c,f,d,p,m,g]}getMidPoints(){let e=[],{leftUp:r,leftLow:i,rightUp:n,rightLow:s,realCornerRadius:o}=this,l=s.sub(i).normalize(),u=r.sub(i).normalize(),h=i.add(l.mul(o)),c=s.add(l.mul(-o)),f=s.add(u.mul(o)),d=n.add(u.mul(-o)),p=n.add(l.mul(-o)),m=r.add(l.mul(o)),g=r.add(u.mul(-o)),x=i.add(u.mul(o)),y=[h,c,f,d,p,m,g,x];for(let P=0;P<y.length;P=P+2){let L=y[P],w=y[P+1],C=L.add(w).mul(.5);e.push(C)}if(o>0){let P=h.add(u.mul(this.radius)),L=f.add(l.mul(-this.radius)),w=p.add(u.mul(-this.radius)),C=g.add(l.mul(this.radius)),T=[P,L,w,C],M=[x,h,c,f,d,p,m,g];for(let E=0;E<4;E++){let W=T[E],k=ef(W,o,M[E*2].angle(W),M[E*2+1].angle(W),1);e.push(k)}}return e}getArcCenterPoints(){if(this.radius>0){let{leftUp:e,leftLow:r,rightUp:i,rightLow:n,realCornerRadius:s}=this,o=n.sub(r).normalize(),l=e.sub(r).normalize(),u=r.add(o.mul(s)),h=n.add(l.mul(s)),c=i.add(o.mul(-s)),f=e.add(l.mul(-s)),d=u.add(l.mul(this.radius)),p=h.add(o.mul(-this.radius)),m=c.add(l.mul(-this.radius)),g=f.add(o.mul(this.radius));return[d,p,m,g]}return[]}getLines(){let{leftUp:e,leftLow:r,rightUp:i,rightLow:n,realCornerRadius:s}=this,o=n.sub(r).normalize(),l=e.sub(r).normalize(),u=new S(r.add(o.mul(s)),n.add(o.mul(-s))),h=new S(n.add(l.mul(s)),i.add(l.mul(-s))),c=new S(i.add(o.mul(-s)),e.add(o.mul(s))),f=new S(e.add(l.mul(-s)),r.add(l.mul(s)));return[u,h,c,f]}getArcs(){let e=[],{leftUp:r,leftLow:i,rightUp:n,rightLow:s,realCornerRadius:o}=this;if(this.radius>0){let l=s.sub(i).normalize(),u=r.sub(i).normalize(),h=i.add(l.mul(o)),c=s.add(l.mul(-o)),f=s.add(u.mul(o)),d=n.add(u.mul(-o)),p=n.add(l.mul(-o)),m=r.add(l.mul(o)),g=r.add(u.mul(-o)),x=i.add(u.mul(o)),y=h.add(u.mul(o)),P=f.add(l.mul(-o)),L=p.add(u.mul(-o)),w=g.add(l.mul(o)),C=[y,P,L,w],T=[x,h,c,f,d,p,m,g];for(let M=0;M<C.length;M++){let E=C[M];e.push(R.build2(E,T[M*2].angleD(E),T[M*2+1].angleD(E),o,o,1))}}return e}get polyline(){return kn(this.leftLow.add(this.leftUp).mul(.5),this.rightLow.add(this.rightUp).mul(.5),this.height,2*this.realCornerRadius/Math.min(this.width,this.height))}get locked(){return this.buffer[9]==1}set locked(e){this.updateBuffer(9,[e?1:0])}updateBox(){return this.bbox=Sh(this.start,this.width,this.height,this.rotation,this.radius,this.strokeWidth),this.bbox}getMathGraphics(e=this.layerId){return this.isEmpty?null:this.layerId==e||this.layerId==12||11==this.layerId?kn(this.leftLow.add(this.leftUp).mul(.5),this.rightLow.add(this.rightUp).mul(.5),this.height,2*this.realCornerRadius/Math.min(this.width,this.height)):null}clone(e=!1){var n;let r=z(e,Io.Blength);r.set(this.buffer);let i=(n=this.component)==null?void 0:n.clone();return new Io(this.globalIndex,r,this._type,this.net,this._silkColor,i)}},ki=Io;ki.Blength=10+4;var Co=class extends be{static getInstance(){return Co.manager==null&&(Co.manager=new Co),Co.manager}addModel(t){this.map.set(t.globalIndex,t),this.survive(t.globalIndex)}addByBuffer(t,e,r,i,n,s){return this._last=this.map.get(t),this._last==null?(this._last=new ki(t,e,r,i,n,s),this.map.set(t,this._last)):this._last.update(e,r,i,n,s),this._last}addRect(t,e,r,i,n,s,o,l,u=1,h=0,c=0,f=null){return this._last=ki.build(t,e,r,i,n,s,h,c,o,u,l,f,null,null,!0),this.addModel(this._last),this._last}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}delete(t){t instanceof ki&&(this.map.delete(t.globalIndex),this.del(t.globalIndex))}},jr=Co;jr.manager=null;function wh(a){let t=new H;for(let e of a)for(let r of e)t.ext1(r.buildBBox());return t.build()}var To=class extends _e{constructor(e,r,i,n,s,o,l){super();this.modelType="Polygon";this.pl=null;this._childrens=new Array;this.needUpdateCache=!1;this.globalIndex=e,this.update(r,i,n,s,o,l)}update(e,r,i,n,s,o){this.buffer=e,this._type=r,this._silkColor=s,this._childrens=i;for(let l of this._childrens)for(let u of l)u.setParent(this);this._net=n,this._component=o,this.clearCache()}clearCache(){super.clearCache(),this.pl=null}static build(e,r,i,n,s,o,l,u,h,c,f=!1){let d=z(f,To.Blength);return d[1]=i,d[2]=Dr(s,r),d[3]=l?1:0,c==null&&(c=wh(n)),d.set(c.data,4),new To(e,d,r,n,o,u,h)}get modify(){if(this.buffer==null)return!1;if(this._modify!=this.buffer[0])return!0;for(let e of this._childrens)for(let r of e)if(r.modify)return!0;return!1}set modify(e){e?this._modify==this.buffer[0]&&this.buffer[0]++:this._modify=this.buffer[0]}get bbox(){return new j(this.buffer[4],this.buffer[5],this.buffer[6],this.buffer[7])}set bbox(e){this.updateBuffer(4,e.data)}get layerId(){return this.buffer[1]}set layerId(e){this.updateBuffer(1,[e]);for(let r of this._childrens)for(let i of r)i.layerId=e}get outline(){if(this.needUpdateCache||this.pl==null){let e=new Array;for(let r of this._childrens){let i=new Array;for(let n of r){let s=n.primitive;i.push(s)}e.push(B.build2(i))}this.pl=e.length==1?e[0]:new ee(e),this.needUpdateCache=!1}return this.pl}get net(){return this._net}set net(e){this._net=e,this.change=!0}get strokeWidth(){return this.buffer[2]}set strokeWidth(e){e=Dr(e,this.type),this.updateShapeBuffer(2,[e]);for(let r of this._childrens)for(let i of r)i.width=e}get type(){return this._type}set type(e){this._type=e,this.modify=!0}get component(){return this._component}set component(e){var r;this._component=e,(r=this._component)==null||r.setParent(this),this.modify=!0}get childrens(){return this._childrens}set childrens(e){this._childrens=e;for(let r of e)for(let i of r)i.setParent(this);this.modify=!0,this.change=!0,this.needUpdateCache=!0}get start(){return this.childrens[0][0].start}get end(){return this.childrens[this.childrens.length-1][0].end}rotateFor(e,r){let i=X.rotateZForPoint(e,r);this.transform(i)}transform(e){for(let r of this._childrens)for(let i of r)i.transform(e);this.modify=!0,this.needUpdateCache=!0}inOutline(e){return this.inShape(e.x,e.y)}inShape(e,r,i){switch(this._type){case"Line":case"Board Outline":case"3D Shell - Outline":{for(let n of this.childrens)for(let s of n)if(s.inShape(e,r))return!0;return!1}default:{let n=wt.inPolygon(new b(e,r),this.outline instanceof ee?this.outline.items:[this.outline]);if(n)return n;for(let s of this.childrens)for(let o of s)if(o.inShape(e,r,i))return!0;return!1}}}get locked(){return this.buffer[3]==1}set locked(e){this.updateBuffer(3,[e?1:0])}updateBox(){return this.bbox=wh(this._childrens),this.bbox}getMathGraphics(e,r){if(this.needUpdateCache||this.pl==null){let i=new Array;for(let n of this.childrens){let s=new Array;for(let o of n)if(o instanceof Ot){let l=o.primitive;s.push(l)}else if(o instanceof qt){let l=o.primitive;if(o.length>1e-8&&o.end.distance1(o.start)<.1&&o.getAngle()>Math.PI){let u=l.sweepAngle/2,h=l.startAngle+u,c=R.build3(l.center,l.startAngle,u,l.rx,l.ry),f=R.build3(l.center,h,u,l.rx,l.ry);s.push(c),s.push(f)}else s.push(l)}i.push(B.build2(s))}this.pl=i.length==1?i[0]:new ee(i)}return this.pl}update4Childs(){this.modify=!0,this.change=!0,this.needUpdateCache=!0}clone(e=!1){var s;let r=z(e,To.Blength);r.set(this.buffer);let i=this._childrens.map(o=>o.map(l=>l.clone(e))),n=(s=this.component)==null?void 0:s.clone();return new To(this.globalIndex,r,this._type,i,this.net,this._silkColor,n)}isClose(){return this.childrens.every(e=>{if(e.length==2){if(e[0]instanceof Ot&&e[1]instanceof Ot)return!1;{let r=e[0],i=e[e.length-1];if(r.start.distance1(i.end)<this.strokeWidth)return!0}}else if(e.length>2){let r=e[0],i=e[e.length-1];if(r.start.distance1(i.end)<this.strokeWidth)return!0}return!1})}},Vi=To;Vi.Blength=4+4;var Ro=class extends be{static getInstance(){return Ro.manager==null&&(Ro.manager=new Ro),Ro.manager}addModel(t){this.map.set(t.globalIndex,t),this.survive(t.globalIndex)}addByBuffer(t,e,r,i,n,s,o){return this._last=this.map.get(t),this._last!=null?this._last.update(e,r,i,n,s,o):(this._last=new Vi(t,e,r,i,n,s,o),this.map.set(t,this._last)),this._last}addPolygon(t,e,r,i,n,s,o,l,u,h){return n=Dr(n,e),this._last=Vi.build(t,e,r,i,n,s,o,l,u,h,!0),this.addModel(this._last),this._last}delete(t){t instanceof Vi&&(this.map.delete(t.globalIndex),this.del(t.globalIndex))}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}},Qr=Ro;Qr.manager=null;function Af(a,t,e){if(!(a.component instanceof Di))return!1;let i=!1,n=gm(a);for(let s in n){let o=n[s];switch(s){case"circle":for(let l of o)if(i=Bi(new b(t,e),l.center,l.radius),i)return!1;break;case"line":for(let l of o)if(i=lt(new b(t,e),l.start,l.end,l.width),i)return!1;break}if(i)break}return i}function gm(a){let t=a.component,e={},r=Lf(t),{innerRadius:i,stiffToCenterLength:n,stiffStrokeWidth:s}=r;if(e.circle=[{center:a.center,radius:i}],n>0&&s>0){e.line=[];let o=new b(a.center.x,a.center.y+n),l=new b(a.center.x,a.center.y-n);e.line.push({start:o,end:l,width:s});let u=new b(a.center.x-n,a.center.y),h=new b(a.center.x+n,a.center.y);e.line.push({start:u,end:h,width:s})}return e}function Lf(a){let{holeDiameter:t,counterboreProps:e,stiffenerProps:r}=a,i=t/2,n=i;e&&(n=e.diameter/2);let s=0,o=0;return r&&(s=Math.max(r.topWidth,r.bottomWidth)+i,o=r.stiffThickness),{innerRadius:i,outerRadius:n,stiffToCenterLength:s,stiffStrokeWidth:o}}function If(a){let t=a.component,e=a.radius+a.strokeWidth/2,r=new H().ext2(a.center).ext7(e);if(t instanceof Di&&t.stiffenerProps){let{stiffToCenterLength:i}=Lf(t),n=Math.max(0,i-e);r.ext7(n)}return r.build()}function Dr(a,t,e=.01){let r=Mf(t);if(r>0)return r;if(a>=e)return a;switch(t){case"3D Shell - Outline":return new Ht().conversion("mm","mil",1.5)/10;default:return 1}}function Mf(a){let t=yn.getInstance().doctype===ct.CNCPRINTVIEW;switch(a){case"Slot Region":return t?5:.1;case"3D Shell - Side Slot Region":case"3D Shell - Top Slot Region":return t?5:1;case"TearDrop":return t?5:.001;case"Copper Region":case"Fill Region":case"FPC Stiffener":case"Prohibited Region":case"Constraint Region":case"3D Shell - Top/Bottom Entity":case"3D Shell - Side Entity":return t?5:.02;default:return-1}}function Rae(a,t,e){if(t==e)return a;let r=Dr(a,t);return(e!="3D Shell - Outline"&&t=="3D Shell - Outline"||Mf(e)>0&&(t=="Board Outline"||t=="Line"))&&(r=Dr(-1,t)),r}function vae(a,t){return!qn(Bt.getInstance().getLayer(a).type)||t=="Prohibited Region"||t=="Constraint Region"}function Nae(a){let t=s=>!a||typeof a!="function"?a===s.type:a(s),e=[],r=jr.getInstance().getAllItem(),i=$r.getInstance().getAllItem(),n=Qr.getInstance().getAllItem();for(let s of r)t(s)&&e.push(s);for(let s of i)t(s)&&e.push(s);for(let s of n)t(s)&&e.push(s);return e}function Eae(a){switch(a){case"Board Outline":case"Slot Region":case"Copper Region":case"Fill Region":case"Prohibited Region":case"Constraint Region":case"TearDrop":case"3D Shell - Outline":case"3D Shell - Side Slot Region":case"3D Shell - Top Slot Region":case"3D Shell - Top/Bottom Entity":case"3D Shell - Side Entity":case"3D Shell - Screw Pillar":case"FPC Stiffener":return!0;default:return!1}}function Bae(a,t=1e-8){if(a.length==1){let e=a[0];if(e instanceof R&&N.greatereq(Math.abs(e.sweepAngle),359.9))return!0}else if(a.length==2){if(a[0]instanceof S&&a[1]instanceof S)return!1;{let e=a[0],r=a[a.length-1];if(e.start().distance1(r.end())<=t)return!0}}else if(a.length>2){let e=a[0],r=a[a.length-1];if(e.start().distance1(r.end())<=t)return!0}return!1}function _ae(a,t,e){switch(e){case"Copper Region":case"Fill Region":case"Line":case"TearDrop":let r=Bt.getInstance().getLayer(t);return r!=null&&qn(r.type)?a||"":null;default:return null}}var vo=class extends _e{constructor(e,r,i,n,s,o){super();this.modelType="Circle";this.globalIndex=e,this.update(r,i,n,s,o)}update(e,r,i,n,s){this.buffer=e,this._type=r,this._net=i,this._silkColor=n,this._component=s,this.clearCache()}static build(e,r,i,n,s,o,l,u,h,c,f,d=!1){let p=z(d,vo.Blength);return p[1]=i,p[2]=n.x,p[3]=n.y,p[4]=zr(s),p[5]=Dr(o,r),p[6]=l?1:0,f==null&&(f=xh(n,s,o)),p.set(f.data,7),new vo(e,p,r,u,h,c)}get modify(){return this.buffer!=null&&this._modify!=this.buffer[0]}set modify(e){e?this._modify==this.buffer[0]&&this.buffer[0]++:this._modify=this.buffer[0]}get bbox(){return new j(this.buffer[7],this.buffer[8],this.buffer[9],this.buffer[10])}set bbox(e){this.updateBuffer(7,e.data)}get layerId(){return this.buffer[1]}set layerId(e){this.updateBuffer(1,[e])}get center(){return new b(this.buffer[2],this.buffer[3])}set center(e){this.updateShapeBuffer(2,[e.x,e.y])}get radius(){return this.buffer[4]}set radius(e){e=zr(e),this.updateShapeBuffer(4,[e])}get strokeWidth(){return this.buffer[5]}set strokeWidth(e){e=Dr(e,this.type,zr(-1)),this.updateShapeBuffer(5,[e])}get type(){return this._type}set type(e){this._type=e,this.change=!0}get net(){return this._net}set net(e){this._net=e,this.change=!0}get component(){return this._component}set component(e){var r;this._component=e,(r=this._component)==null||r.setParent(this),this.modify=!0}get primitive(){return R.build2(this.center,0,360,this.radius,this.radius,1)}transform(e){this.center=this.center.multiply4(e)}inShape(e,r){switch(this._type){case"Line":case"Board Outline":case"3D Shell - Outline":{let i=this.center.distance1(new b(e,r));return i<=this.radius+this.strokeWidth/2&&i>=this.radius-this.strokeWidth/2}case"3D Shell - Screw Pillar":{let i=this.center.distance1(new b(e,r))<=this.radius+this.strokeWidth/2;return i||(i=Af(this,e,r)),i}default:return this.center.distance1(new b(e,r))<=this.radius+this.strokeWidth/2}}isSelectOnlyLine(e,r){let i=this.center.distance1(new b(e,r));return i<=this.radius+this.strokeWidth/2&&i>=this.radius-this.strokeWidth/2}get locked(){return this.buffer[6]==1}set locked(e){this.updateBuffer(6,[e?1:0])}updateBox(){return this.type==="3D Shell - Screw Pillar"?this.bbox=If(this):this.bbox=xh(this.center,this.radius,this.strokeWidth),this.bbox}getMathGraphics(e=this.layerId,r=0){return this.isEmpty?null:this.layerId==e||this.layerId==12||11==this.layerId?B.build2([R.build2(this.center,0,360,this.radius+r,this.radius+r,1)]):null}clone(e=!1){var n;let r=z(e,vo.Blength);r.set(this.buffer);let i=(n=this.component)==null?void 0:n.clone();return new vo(this.globalIndex,r,this._type,this._net,this._silkColor,i)}},Ui=vo;Ui.Blength=7+4;var No=class extends be{static getInstance(){return No.manager==null&&(No.manager=new No),No.manager}addModel(t){this.map.set(t.globalIndex,t),this.survive(t.globalIndex)}addByBuffer(t,e,r,i,n,s){return this._last=this.map.get(t),this._last!=null?this._last.update(e,r,i,n,s):(this._last=new Ui(t,e,r,i,n,s),this.map.set(t,this._last)),this._last}addCircle(t,e,r,i,n,s,o,l,u=null){return this._last=Ui.build(t,e,r,i,n,s,o,l,u,null,null,!0),this.addModel(this._last),this._last}delete(t){t instanceof Ui&&(this.map.delete(t.globalIndex),this.del(t.globalIndex))}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}},$r=No;$r.manager=null;var Kl=class{constructor(){this.nums=new Set}add(t){return t==""||this.nums.has(t)?!1:(this.nums.add(t),!0)}getNum(t){if(t.endsWith("?")&&(t=t.replace("?","")),this.nums.has(t.toUpperCase())){let e=t.split(/[^0-9]+/);if(e[e.length-1]=="")return this.getNum(t+"1");if(e[e.length-1].match(/[0-9]+/)){let r=parseInt(e[e.length-1])+1;return this.getNum(t.replace(new RegExp(e[e.length-1]+"$"),r.toString()))}else return this.getNum("A")}else return t==""?this.getNum("1"):t.toUpperCase()}getUniqueName(t){if(t.endsWith("?")&&(t=t.replace("?","")),this.nums.has(t)){let e=t.split(/[^0-9]+/);if(e[e.length-1]=="")return this.getUniqueName(t+"1");if(e[e.length-1].match(/[0-9]+/)){let r=parseInt(e[e.length-1])+1;return this.getUniqueName(t.replace(new RegExp(e[e.length-1]+"$"),r.toString()))}else return this.getUniqueName("A")}else return t==""?this.getUniqueName("1"):t}deleteNum(t){this.nums.delete(t)}clear(){this.nums.clear()}has(t){return this.nums.has(t)}};var Jn=class extends un{constructor(e,r,i){super();this.modelType="Combination";this.items=new Array;this._isEmpty=!1;this.globalIndex=e,this.update(r,i)}update(e,r){this.clearCache(),this._name=r;for(let i of e)i instanceof Ot||i instanceof qt?(i.getParent().setGroupID(this.globalIndex),this.items.push(i.getParent())):(i.setGroupID(this.globalIndex),this.items.push(i))}clearCache(){for(let e of this.items)e.setGroupID(null);this.items.length=0}get name(){return this._name}set name(e){this._name=e,this.change=!0}get locked(){for(let e of this.items)if(e.locked)return!0;return!1}getIndex(){let e=new Array;for(let r of this.items)e.push(r.globalIndex);return e}addItem(e){e instanceof Ot||e instanceof qt?e.getParent().setGroupID(this.globalIndex):e.setGroupID(this.globalIndex),this.items.push(e),this.change=!0}deleteItem(e){let r=this.items.indexOf(e);r>=0&&(this.items.splice(r,1),e.setGroupID(null),this.change=!0)}getItems(){return this.items}setItems(e){this.items=e,this.change=!0}dissolution(){for(let e of this.items)e.setGroupID(null);this.items.length=0,this._isEmpty=!0}rotateFor(e,r){let i=X.translate(-e.x,-e.y,0).rotateZ(r).translate1(e.x,e.y,0);this.transform(i)}transform(e){for(let r of this.items)r.transform(e)}isSelect(e,r){return!0}getBBox(){let e=new H;for(let r of this.items)r instanceof Fe&&e.ext1(r.buildBBox());return e.build()}get isEmpty(){return this._isEmpty}remove(){this.dissolution()}updateBox(){let e=new H;for(let r of this.items)r instanceof Fe&&e.ext1(r.buildBBox());return e.build()}clone(){throw new Error("Method not implemented.")}};var Eo=class extends be{constructor(){super(...arguments);this.numberManager=new Kl;this.num="1";this.combinOptions=new Array;this.modifyOptions=!0}static getInstance(){return Eo.manager==null&&(Eo.manager=new Eo),Eo.manager}addByBuffer(e,r,i){return this._last=this.map.get(e),this._last!=null?this._last.update(r,i):(this._last=new Jn(e,r,i),this.map.set(e,this._last),this.numberManager.add(e)),this._last}combination(e,r){let i=this.numberManager.getNum(this.num);return this.num=i,this._last=new Jn(i,e,r),this.map.set(i,this._last),this.survive(i),this.numberManager.add(i),this.modifyOptions=!0,this._last}getGroupByName(e){for(let r of this.map.values())if(r.name===e)return r;return null}getGroupNameByGroupId(e){return e?this.getItem(e).name:null}getDefaultName(){return"group"+this.numberManager.getNum(this.num)}joinCombination(e,r){let i=this.map.get(r);return e.forEach(n=>{n instanceof Ot||n instanceof qt?i.addItem(n.getParent()):i.addItem(n)}),this.modifyOptions=!0,i}removeFromCombination(e,r){let i=this.map.get(r);return e.forEach(n=>i.deleteItem(n)),this.modifyOptions=!0,i}getAllGroupId(){let e=this.map.keys(),r=new Array(this.map.size),i=0;for(let n of e)r[i]=n,i++;return r}getCombin(){return this.modifyOptions&&(this.updateCombinOptions(),this.modifyOptions=!1),this.combinOptions}updateCombinOptions(){let e=new Array;for(let r of this.map.values()){let i={};i.value=r.name,i.text=r.name,e.push(i)}this.combinOptions=e}copy(e){}rebuild(e,r,i){this.numberManager.add(e),(i==null||i=="")&&(i="group"+e);let n=new Jn(e,r,i);return this.map.set(e,n),this.survive(e),this.modifyOptions=!0,n}delete(e){if(e instanceof Jn)this.numberManager.deleteNum(e.globalIndex),this.map.delete(e.globalIndex),this.del(e.globalIndex),this.modifyOptions=!0;else if(e instanceof un){let r=e.getGroupID();if(r!=null){let i=this.getItem(r);i!=null&&i.deleteItem(e)}}}getIncreaseData(e=!1,r=!1){return Re(this.map,this.addList,e,r)}},Bo=Eo;Bo.manager=null;var _o=class extends be{static getInstance(){return _o.manager==null&&(_o.manager=new _o),_o.manager}addModel(t){this.map.set(t.globalIndex,t),this.survive(t.globalIndex)}addByBuffer(t,e,r,i,n,s,o,l,u){return this._last=this.map.get(t),this._last!=null?this._last.update(e,r,i,n,s,o,l,u):(this._last=new fr(t,e,r,i,n,s,o,l,u),this.map.set(t,this._last)),this._last}add(t,e,r,i,n,s,o,l,u,h,c,f=null){return this._last=fr.build(t,e,r,i,n,s,o,l,u,h,c,f,!0),this.addModel(this._last),this._last}delete(t){t instanceof fr&&(this.map.delete(t.globalIndex),this.del(t.globalIndex))}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}},yi=_o;yi.manager=null;var Oo=class extends be{constructor(){super(...arguments);this._orders=new Array}get orders(){return this._orders}set orders(e){this._orders=e}static getInstance(){return Oo.manager==null&&(Oo.manager=new Oo),Oo.manager}addModel(e){return this.map.set(e.globalIndex,e),this.survive(e.globalIndex),e}addByBuffer(e,r,i,n,s){return this._last=this.map.get(e),this._last!=null?this._last.update(r,i,n,s):(this._last=new Ar(e,r,i,n,s),this.map.set(e,this._last)),this._last}addCopper(e,r,i,n,s,o,l,u,h=!1){return this._last=Ar.build(e,r,i,n,s,o,l,u,h,null,!0),this.addModel(this._last),this._last}deleteIndex(e){let r=this._orders.indexOf(e);r>=0&&this._orders.splice(r,1)}delete(e){if(e instanceof _e||e instanceof Ar){let r=this._orders.indexOf(e.globalIndex);r>=0&&this._orders.splice(r,1),this.map.delete(e.globalIndex),this.del(e.globalIndex);let i=e.getParent();i!=null&&i instanceof _e&&i.coppers.delete(e.globalIndex)}}getIncreaseData(e=!1,r=!1){return Re(this.map,this.addList,e,r)}},ni=Oo;ni.manager=null;var xi=class extends Fe{get globalIndex(){return this._globalIndex}set globalIndex(e){this._globalIndex=e,this.text!=null&&(this.text.globalIndex=e)}get silkColor(){return this.text.silkColor}set silkColor(e){this.text!=null&&(this.text.silkColor=e)}};function Do(a,t,e,r){let i=t.sub(a).normalize(),n=a.distance1(t);if(n>=e+6){let s=t.angle(a),o=(n-e)/2;return s>-br&&s<br?a.add(i.mul(o)):t.add(i.mul(-o))}else{i.length()==0&&(i=new b(1,0));let s=t.angle(a),o=a.add(t).mul(.5);if(s>-br&&s<br){let l=new b(-i.y,i.x);return o.add(l.mul(r).add(i.mul(-e/2)))}else{let l=new b(i.y,-i.x);return o.add(l.mul(r).add(i.mul(e/2)))}}}function ko(a,t,e,r,i,n,s,o){let l=Vo(a,t,e,r,n.box.width,s,o),u=new H;for(let h of l)u.ext1(h.bbox());return u.ext7(i/2),u.ext1(n.bbox),u.build()}function Vo(a,t,e,r,i,n,s){let o=X.rotateZ(Math.PI/12),l=X.rotateZ(-Math.PI/12),u=new Array,h=a.distance1(t);if(a.equals(t)){let c=new b(1,0),f=c.multiply4(o).mul(s),d=c.multiply4(l).mul(s),p=new S(a,a.add(f)),m=new S(a,a.add(d)),g=new S(t,t.sub(d)),x=new S(t,t.sub(f));u.push(p,m,g,x)}else{let c=t.sub(a).normalize();if(a.equals(e)&&t.equals(r)){let d=new b(-c.y,c.x).mul(n),p=d.add(a),m=d.add(t),g=new S(p,a),x=new S(m,t),y=c.multiply4(o).mul(s),P=c.multiply4(l).mul(s),L=new S(a,a.add(y)),w=new S(a,a.add(P)),C=new S(t,t.sub(P)),T=new S(t,t.sub(y));if(u.push(g,x,L,w,C,T),h>=i+6){let M=(h-i)/2,E=new S(a,a.add(c.mul(M))),W=new S(t.sub(c.mul(M)),t);u.push(E,W)}else{let M=new S(a,t);u.push(M)}}else{let f=a.sub(e).normalize().mul(n),d=t.sub(r).normalize().mul(n),p=new S(e,a.add(f)),m=new S(r,t.add(d)),g=c.multiply4(o).mul(s),x=c.multiply4(l).mul(s),y=new S(a,a.add(g)),P=new S(a,a.add(x)),L=new S(t,t.sub(x)),w=new S(t,t.sub(g));if(u.push(p,m,y,P,L,w),h>=i+6){let C=(h-i)/2,T=new S(a,a.add(c.mul(C))),M=new S(t.sub(c.mul(C)),t);u.push(T,M)}else{let C=new S(a,t);u.push(C)}}}return u}var Uo=class extends xi{constructor(e,r,i,n){super();this.modelType="Length Dimension";this.globalIndex=e,this.update(r,i,n)}update(e,r,i){this.buffer=e,this.text=r,this._unit=i,this.clearCache()}static build(e,r,i,n,s,o,l,u,h,c,f,d=10,p=3,m=5,g,x=!1){let y=i.distance1(n),P=Oi(y,l,c).toString()+c,{width:L,height:w,path:C}=Kr(P,u,h),T=Do(i,n,L,m),M=Ni($e(r)?-n.angle(i):n.angle(i)),E=$e(r)?9:3,W=Ye.build(e,r,0,"",!1,P,!0,"default",u,M,T,E,h,!1,0,!1,!1,C,L,w,f,null,null,x);g==null&&(g=ko(i,n,s,o,h,W,d,p));let k=z(x,Uo.Blength);return k.set([r,i.x,i.y,n.x,n.y,s.x,s.y,o.x,o.y,l,u,h,d,p,m],0),k.set(g.data,15),new Uo(e,k,W,c)}get modify(){return this.text.modify}set modify(e){this.text.modify=e}get layerId(){return this.buffer[0]}set layerId(e){this.updateBuffer(0,[e]),this.text.layerId=e,$e(e)&&this.text.origin!=9?this.text.origin=9:!$e(e)&&this.text.origin!=3&&(this.text.origin=3),this.updateText()}get unit(){return this._unit}set unit(e){this._unit=e,this.updateText(),this.change=!0}get textPosition(){return this.text.position}get width(){return this.buffer[11]}set width(e){this.updateShapeBuffer(11,[e]),this.text.strokeWidth=e,this.updateText()}get strokeWidth(){return this.width}set strokeWidth(e){this.width=e}get start(){return new b(this.buffer[1],this.buffer[2])}set start(e){this.updateShapeBuffer(1,[e.x,e.y]),this.updateText()}get end(){return new b(this.buffer[3],this.buffer[4])}set end(e){this.updateShapeBuffer(3,[e.x,e.y]),this.updateText()}get left(){return new b(this.buffer[5],this.buffer[6])}set left(e){this.updateShapeBuffer(5,[e.x,e.y]),this.updateText()}get right(){return new b(this.buffer[7],this.buffer[8])}set right(e){this.updateShapeBuffer(7,[e.x,e.y]),this.updateText()}get length(){return this.start.distance1(this.end)}set length(e){let i=this.end.sub(this.start).normalize().mul(e-this.length),n=X.translate(i.x,i.y,0);this.end=this.end.multiply4(n),this.right=this.right.multiply4(n)}get precision(){return this.buffer[9]}set precision(e){this.updateBuffer(9,[e]),this.updateText()}get fontSize(){return this.buffer[10]}set fontSize(e){this.updateBuffer(10,[e]),this.text.fontSize=this.fontSize,this.updateText()}get content(){return Oi(this.length,this.precision,this.unit).toString()+this._unit}get lineLen(){return this.buffer[12]}get arrLineLen(){return this.buffer[13]}get textOffset(){return this.buffer[14]}get bbox(){return new j(this.buffer[15],this.buffer[16],this.buffer[17],this.buffer[18])}set bbox(e){this.updateBuffer(15,e.data)}updateText(){let{width:e,height:r,path:i}=Kr(this.content,this.fontSize,this.width);this.text.outline=i,this.text.position=Do(this.start,this.end,e,this.textOffset);let n=$e(this.layerId);this.text.rotation=Ni(n?-this.end.angle(this.start):this.end.angle(this.start)),this.text.updateBox4(e,r)}transform(e){this.start=this.start.multiply4(e),this.end=this.end.multiply4(e),this.left=this.left.multiply4(e),this.right=this.right.multiply4(e),this.updateText()}inShape(e,r){let i=new b(e,r),n=Vo(this.start,this.end,this.left,this.right,this.text.box.width,this.lineLen,this.arrLineLen);for(let s of n)if(lt(i,s.start(),s.end(),this.width))return!0;return this.text.inShape(e,r)}get locked(){return this.text.locked}set locked(e){this.text.locked=e}calibrateLine(e,r,i,n){let s,o,l;this.start.equals(this.end)?(r?s=this.vectorProjectOnPerpendicularLine(this.right.sub(this.left),e[0].sub(e[1])):s=this.vectorProjectOnPerpendicularLine(e[0].sub(e[3]),e[1].sub(e[0])),o=0):(s=this.end.sub(this.start),o=s.length());let u=s.normalize(),h=e[3].sub(e[2]).dot(u);switch(i?l=o+h:l=o-h,n){case 0:this.end=e[3].add(u.mul(l)),this.left=e[3].add(e[1].sub(e[0]));break;case 1:this.start=e[3].sub(u.mul(l)),this.right=e[3].add(e[1].sub(e[0]));break;case 2:this.start=e[1].sub(u.mul(l));break;case 3:this.end=e[1].add(u.mul(l));break}}vectorProjectOnPerpendicularLine(e,r){let i=r.rotate(new b(0,0),Math.PI/2).normalize(),n=e.angle(i);return Math.abs(n)>Math.PI/2&&(i=i.mul(-1)),i.mul(e.dot(i))}updateBox(){return this.text.buildBBox(),this.bbox=ko(this.start,this.end,this.left,this.right,this.strokeWidth,this.text,this.lineLen,this.arrLineLen),this.bbox}getBaseGraphics(){let e=[];return this.text.outline.forEach(i=>{e.push(i.primitives.map(n=>n.multiply3(this.text.matrix.toMatrix3())))}),Vo(this.start,this.end,this.left,this.right,this.text.box.width,this.lineLen,this.arrLineLen).forEach(i=>{e.push([i])}),e}clone(e=!1){let r=z(e,Uo.Blength);r.set(this.buffer);let i=this.text.clone(e);return new Uo(this.globalIndex,r,i,this.unit)}},Fi=Uo;Fi.Blength=15+4;var Fo=class extends be{static getInstance(){return Fo.manager==null&&(Fo.manager=new Fo),Fo.manager}addModel(t){this.map.set(t.globalIndex,t),this.survive(t.globalIndex)}addByBuffer(t,e,r,i){return this._last=this.map.get(t),this._last!=null?this._last.update(e,r,i):(this._last=new Fi(t,e,r,i),this.map.set(t,this._last)),this._last}addDimension(t,e,r,i,n,s,o,l,u,h,c){return this._last=Fi.build(t,e,r,i,n,s,o,l,u,h,c,null,null,null,null,!0),this.addModel(this._last),this._last}delete(t){t instanceof Fi&&(this.map.delete(t._globalIndex),this.del(t.globalIndex))}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}},Sn=Fo;Sn.manager=null;var Go=class extends be{static getInstance(){return Go.manager==null&&(Go.manager=new Go),Go.manager}addModel(t){this.map.set(t.globalIndex,t),this.survive(t.globalIndex)}addByBuffer(t,e,r,i,n){return this._last=this.map.get(t),this._last!=null?this._last.update(e,r,i,n):(this._last=new Mr(t,e,r,i,n),this.map.set(t,this._last)),this._last}addImage(t,e,r,i,n,s,o,l,u){let h=Mr.build(t,e,r,i,n,s,o,u,l,null,!0);return this.addModel(h),h}delete(t){t instanceof Mr&&(this.del(t.globalIndex),this.map.delete(t.globalIndex))}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}},Pi=Go;Pi.manager=null;var Zl=class{static createId(){let t="line"+Zl.GGEID.getID("line");return Zl.GGEID.addId(t),t}},Lh=Zl;Lh.GGEID=new Mo;var Wo=class extends be{static getInstance(){return Wo.manager==null&&(Wo.manager=new Wo),Wo.manager}addModel(t){this.map.set(t.globalIndex,t),this.survive(t.globalIndex)}add(t,e,r,i,n,s){return this._last=Ot.build(t,e,r,i,n,s,null,!0),this.addModel(this._last),this._last}addByBuffer(t,e){return this._last=this.map.get(t),this._last!=null?this._last.update(e):(this._last=new Ot(t,e),this.map.set(t,this._last)),this._last}delete(t){t instanceof Ot&&(this.map.delete(t.globalIndex),this.del(t.globalIndex))}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}},wn=Wo;wn.manager=null;var Ho=class extends be{static getInstance(){return Ho.manager==null&&(Ho.manager=new Ho),Ho.manager}addModel(t){this.map.set(t.globalIndex,t),this.survive(t.globalIndex)}addByBuffer(t,e,r,i,n,s,o,l,u=null){return this._last=this.map.get(t),this._last==null?(this._last=new tt(t,e,r,i,n,s,o,l,u),this.map.set(t,this._last),this._last):(this._last.update(e,r,i,n,s,o,l,u),this._last)}addPad(t,e,r,i,n,s,o,l,u,h,c,f,d,p,m,g,x,y,P=null,L){return this._last=tt.build(t,e,r,i,n,s,o,l,u,h,c,f,d,p,m,g,x,y,P,L,null,!0),this.addModel(this._last),this._last}delete(t){t instanceof tt&&(this.map.delete(t.globalIndex),this.del(t.globalIndex))}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}},Si=Ho;Si.manager=null;var zo=class extends xn{constructor(e,r,i,n){super();this.modelType="Picture";this.globalIndex=e,this.update(r,i,n)}update(e,r,i){this.buffer=e,this.box=r,this._hashId=i,this.clearCache()}get hashId(){return this._hashId}set hashId(e){this._hashId=e,this.change=!0}static build(e,r,i,n,s,o,l,u,h,c,f=!1){let d=z(f,zo.Blength);d[0]=i.x,d[1]=i.y,d[2]=n,d[3]=s,d[4]=o,d[5]=l?1:0;let p=Br(r,l),m=X.translate(0,-s,0).rotateZ(o).scale(p?-1:1,1,1).translate1(i.x,i.y,0),g=gt.build(e,r,b.ORIGIN,new b(0,s),new b(n,0),new b(n,s),h,c);return g.transform(m),g.updateBox(),new zo(e,d,g,u)}needMirror(){return Br(this.layerId,this.mirror)}clone(e=!1){let r=z(e,zo.Blength);r.set(this.buffer);let i=this.box.clone(e);return new zo(this.globalIndex,r,i,this.hashId)}},Gi=zo;Gi.Blength=5+1;function Cf(a){switch(a){case 3:case 4:case 13:return a;default:return 3}}var Yo=class extends be{static getInstance(){return Yo.manager==null&&(Yo.manager=new Yo),Yo.manager}addModel(t){this.map.set(t.globalIndex,t),this.survive(t.globalIndex)}addByBuffer(t,e,r,i){return this._last=this.map.get(t),this._last!=null?this._last.update(e,r,i):(this._last=new Gi(t,e,r,i),this.map.set(t,this._last)),this._last}addImage(t,e,r,i,n,s,o,l,u){return this._last=Gi.build(t,Cf(e),r,i,n,s,o,u,l,null,!0),this.addModel(this._last),this._last}delete(t){t instanceof Gi&&(this.map.delete(t.globalIndex),this.del(t.globalIndex))}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}},Ln=Yo;Ln.manager=null;var qo=class extends be{constructor(){super(...arguments);this.layerMapSet={}}static getInstance(){return qo.manager==null&&(qo.manager=new qo),qo.manager}addModel(e){this.map.set(e.globalIndex,e);let r=this.layerMapSet[e.layerId];r==null&&(r=new Set,this.layerMapSet[e.layerId]=r),r.add(e),this.survive(e.globalIndex)}addByBuffer(e,r,i,n,s){if(this._last=this.map.get(e),this._last!=null)this._last.update(r,i,n,s);else{this._last=new Or(e,r,i,n,s),this.map.set(e,this._last);let o=this.layerMapSet[this._last.layerId];o==null&&(o=new Set,this.layerMapSet[this._last.layerId]=o),o.add(this._last)}return this._last}add(e,r,i,n,s){return this._last=Or.build(e,r,i,n,s,!1,null,!0),this.addModel(this._last),this._last}delete(e){if(e instanceof Or){let r=this.layerMapSet[e.layerId];r&&r.delete(e),this.map.delete(e.globalIndex),this.del(e.globalIndex)}}getIncreaseData(e=!1,r=!1){return Re(this.map,this.addList,e,r)}},wi=qo;wi.manager=null;function jl(a,t,e){let r=new Array,i=new S(a,t),n=new S(a,e);r.push(i,n);let s=t.sub(a),o=e.sub(a),l=Math.atan2(s.y,s.x)*180/Math.PI,u=Math.atan2(o.y,o.x)*180/Math.PI;if(l==u&&(u+=1e-8),s.cross(o)>=0){let c=R.build2(a,l,u,10,10,1);r.push(c)}else{let c=R.build2(a,l,u,10,10,0);r.push(c)}return r}function Ql(a,t,e){let r=t.sub(a).normalize(),i=e.sub(a).normalize(),n=r.add(i).normalize().mul(15);return a.add(n)}function Mh(a,t,e,r){let i=Math.pow(10,r),n=t.sub(a),s=e.sub(a),o=n.normalize().dot(s.normalize()),l=Math.acos(o)/Math.PI*180,u=Math.round(l*i)/i;return isNaN(u)&&(u=0),u.toFixed(r)}function $l(a,t,e){let r=a.add1($e(t)?-1:1,0),i=e/2+.1;return R.build2(r,0,360,i,i,1)}function Ah(a,t,e,r,i){let n=jl(a,t,e),s=new H;for(let l of n)s.ext1(l.bbox());s.ext7(i/2),s.ext1(r.bbox);let o=$l(r.bbox.UR(),r.layerId,i);return s.ext1(o.bbox()),s.build()}var Xo=class extends xi{constructor(e,r,i){super();this.modelType="Protractor Dimension";this.globalIndex=e,this.buffer=r,this.text=i,this.update(r,i)}update(e,r){this.buffer=e,this.text=r,this.clearCache()}static build(e,r,i,n,s,o,l,u,h,c,f,d=!1){let p=Mh(o,l,u,s),{width:m,height:g,path:x}=Kr(p.toString(),n,i),y=$e(r)?9:3,P=Ye.build(e,r,0,"",!1,p.toString(),!0,"default",n,0,h,y,i,!1,0,!1,!1,x,m,g,c,null,null,d);f==null&&(f=Ah(o,l,u,P,i));let L=z(d,Xo.Blength);return L.set([r,i,n,s,o.x,o.y,l.x,l.y,u.x,u.y],0),L.set(f.data,10),new Xo(e,L,P)}get modify(){return this.text.modify}set modify(e){this.text.modify=e}get layerId(){return this.buffer[0]}set layerId(e){this.updateBuffer(0,[e]),this.text.layerId=e,$e(e)&&this.text.origin!=9?this.text.origin=9:!$e(e)&&this.text.origin!=3&&(this.text.origin=3),this.updateText()}get start(){return this.end1}set start(e){this.end1=e}get end(){return this.end2}set end(e){this.end2=e}get strokeWidth(){return this.buffer[1]}set strokeWidth(e){this.updateShapeBuffer(1,[e]),this.text.strokeWidth=e,this.updateText()}get fontSize(){return this.buffer[2]}set fontSize(e){this.updateShapeBuffer(2,[e]),this.text.fontSize=e,this.updateText()}get precision(){return this.buffer[3]}set precision(e){this.updateShapeBuffer(3,[e]),this.updateText()}get center(){return new b(this.buffer[4],this.buffer[5])}set center(e){this.updateShapeBuffer(4,[e.x,e.y]),this.text.position=Ql(this.center,this.end1,this.end2),this.updateText()}get end1(){return new b(this.buffer[6],this.buffer[7])}set end1(e){this.updateShapeBuffer(6,[e.x,e.y]),this.text.position=Ql(this.center,this.end1,this.end2),this.updateText()}get end2(){return new b(this.buffer[8],this.buffer[9])}set end2(e){this.updateShapeBuffer(8,[e.x,e.y]),this.text.position=Ql(this.center,this.end1,this.end2),this.updateText()}get angle(){let e=Math.pow(10,this.precision),r=this.start.sub(this.center),i=this.end.sub(this.center),n=r.normalize().dot(i.normalize()),s=Math.acos(n)/Math.PI*180,o=Math.round(s*e)/e;return isNaN(o)&&(o=0),o}set angle(e){isNaN(e)&&(e=0);let r=e/180*Math.PI,i=this.start.sub(this.center).normalize(),n=this.end.sub(this.center).normalize(),s=this.end.sub(this.center).length();if(i.cross(n)>=0){let l=i.rotate(b.ORIGIN,r);this.end=this.center.add(l.mul(s))}else{let l=i.rotate(b.ORIGIN,-r);this.end=this.center.add(l.mul(s))}}get textPosition(){return this.text.position}set textPosition(e){this.text.position=e,this.updateText()}get bbox(){return new j(this.buffer[10],this.buffer[11],this.buffer[12],this.buffer[13])}set bbox(e){this.updateBuffer(10,e.data)}get content(){return Mh(this.center,this.end1,this.end2,this.precision)}get locked(){return this.text.locked}set locked(e){this.text.locked=e}updateText(){let{width:e,height:r,path:i}=Kr(this.content.toString(),this.fontSize,this.strokeWidth);this.text.outline=i,this.text.updateBox4(e,r)}rotateFor(e,r){let i=X.rotateZForPoint(e,r);this.transform(i)}transform(e){this.text.transform(e,!0);let r=this.center.multiply4(e),i=this.end1.multiply4(e),n=this.end2.multiply4(e);this.updateShapeBuffer(4,[r.x,r.y,i.x,i.y,n.x,n.y])}inOutline(e){return this.inShape(e.x,e.y)}inShape(e,r,i){let n=i==null?1:i.getScale(),s=new b(e,r),o=jl(this.center,this.end1,this.end2),l=$e(this.layerId)?this.text.bbox.UL():this.text.bbox.UR(),u=$l(l,this.text.layerId,this.strokeWidth);for(let h of o)if(h instanceof S){if(lt(s,h.start(),h.end(),this.strokeWidth,n))return!0}else if(ii(s,h.center,h.rx,h.startAngle/180*Math.PI,h.endAngle()/180*Math.PI,h.sweep(),this.strokeWidth,n))return!0;return ii(s,u.center,u.rx,u.startAngle/180*Math.PI,u.endAngle()/180*Math.PI,u.sweep(),this.strokeWidth/2)?!0:this.text.inShape(e,r)}updateBox(){return this.text.updateBox(),this.bbox=Ah(this.center,this.end1,this.end2,this.text,this.strokeWidth),this.bbox}getBaseGraphics(){let e=jl(this.center,this.end1,this.end2),r=$e(this.layerId)?this.text.bbox.UL():this.text.bbox.UR(),n=[[$l(r,this.text.layerId,this.strokeWidth)]];return this.text.outline.forEach(s=>{n.push(s.primitives.map(o=>o.multiply3(this.text.matrix.toMatrix3())))}),e.forEach(s=>{n.push([s])}),n}getDegree(){return{center:this.center,radius:this.strokeWidth/2+.1,width:this.strokeWidth/2}}clone(e=!1){let r=z(e,Xo.Blength);r.set(this.buffer);let i=this.text.clone(e);return new Xo(this.globalIndex,r,i)}},Wi=Xo;Wi.Blength=10+4;var Ko=class extends be{static getInstance(){return Ko.manager==null&&(Ko.manager=new Ko),Ko.manager}addModel(e){this.map.set(e.globalIndex,e),this.survive(e.globalIndex)}addByBuffer(e,r,i){return this._last=this.map.get(e),this._last!=null?this._last.update(r,i):(this._last=new Wi(e,r,i),this.map.set(e,this._last)),this._last}addProtractor(e,r,i,n,s,o,l,u,h){let c=l.sub(o).normalize(),f=u.sub(o).normalize(),d=c.add(f).normalize().mul(15);return this._last=Wi.build(e,r,i,n,s,o,l,u,o.add(d),h,null,!0),this.lastPrecision=this._last.precision,this.addModel(this._last),this._last}delete(e){e instanceof Wi&&(this.map.delete(e._globalIndex),this.del(e.globalIndex))}getIncreaseData(e=!1,r=!1){return Re(this.map,this.addList,e,r)}},Mn=Ko;Mn.manager=null;function Jl(a,t){let e=new S(a,t),r=t.sub(a).normalize(),i=r.rotate(b.ORIGIN,Math.PI/4).mul(3),n=r.rotate(b.ORIGIN,-Math.PI/4).mul(3),s=new S(t,t.sub(n)),o=new S(t,t.sub(i));return[e,s,o]}function Wa(a,t,e){let r=t.angle(a),i=t.sub(a).normalize(),n=new b(-i.y,i.x);return r>-br&&r<br?t.sub(i.mul(6)).add(n.mul(5)).sub(i.mul(e)):t.sub(i.mul(6)).sub(n.mul(5))}function Ih(a,t,e,r){let i=Jl(a,t),n=new H;for(let s of i)n.ext1(s.bbox());return n.ext7(r/2),n.ext1(e.bbox),n.build()}var Zo=class extends xi{constructor(e,r,i,n){super();this.modelType="Radius Dimension";this.globalIndex=e,this.update(r,i,n)}update(e,r,i){this.buffer=e,this.text=r,this._unit=i,this.clearCache()}static build(e,r,i,n,s,o,l,u,h,c,f,d,p=!1){let m="R"+Oi(l,u,h).toString()+h,{width:g,height:x,path:y}=Kr(m,o,s),P=$e(r)?9:3,L=Ni(n.angle(i)),w=Ye.build(e,r,0,"",!1,m,!0,"default",o,L,c,P,s,!1,0,!1,!1,y,g,x,f,null,null,p);d==null&&(d=Ih(i,n,w,s));let C=z(p,Zo.Blength);return C.set([r,i.x,i.y,n.x,n.y,s,o,l,u],0),C.set(d.data,9),new Zo(e,C,w,h)}get modify(){return this.text.modify}set modify(e){this.text.modify=e}get layerId(){return this.buffer[0]}set layerId(e){this.updateBuffer(0,[e]),this.text.layerId=this.layerId;let r=$e(e)?9:3;this.text.origin!=r&&(this.text.origin=r),this.updateText()}get textPosition(){return this.text.position}set textPosition(e){this.text.position=e}get start(){return new b(this.buffer[1],this.buffer[2])}set start(e){this.updateShapeBuffer(1,[e.x,e.y]),this.updateText(),this.text.position=Wa(this.start,this.end,this.text.width)}get end(){return new b(this.buffer[3],this.buffer[4])}set end(e){this.updateShapeBuffer(3,[e.x,e.y]),this.updateText(),this.text.position=Wa(this.start,this.end,this.text.width)}get strokeWidth(){return this.buffer[5]}set strokeWidth(e){this.updateBuffer(5,[e]),this.text.strokeWidth=e,this.updateText()}get fontSize(){return this.buffer[6]}set fontSize(e){this.updateShapeBuffer(6,[e]),this.text.fontSize=e,this.updateText()}get radius(){return this.buffer[7]}set radius(e){this.updateShapeBuffer(7,[e]),this.updateText()}get precision(){return this.buffer[8]}set precision(e){this.updateShapeBuffer(8,[e]),this.updateText()}get bbox(){return new j(this.buffer[9],this.buffer[10],this.buffer[11],this.buffer[12])}set bbox(e){this.updateBuffer(9,e.data)}get unit(){return this._unit}set unit(e){this._unit=e,this.change=!0,this.updateText()}get content(){return"R"+Oi(this.radius,this.precision,this.unit).toString()+this.unit}get locked(){return this.text.locked}set locked(e){this.text.locked=e}updateText(){let{width:e,height:r,path:i}=Kr(this.content,this.fontSize,this.strokeWidth),n=$e(this.layerId);this.text.rotation=Ni(n?-this.end.angle(this.start):this.end.angle(this.start)),this.text.outline=i,this.text.updateBox4(e,r)}transform(e){let r=this.start.multiply4(e),i=this.end.multiply4(e);this.updateShapeBuffer(1,[r.x,r.y,i.x,i.y]),this.text.transform(e)}inOutline(e){return this.inShape(e.x,e.y)}inShape(e,r,i){let n=i==null?1:i.getScale(),s=new b(e,r),o=Jl(this.start,this.end);for(let l of o)if(lt(s,l.start(),l.end(),this.strokeWidth,n))return!0;return this.text.inShape(e,r)}updateBox(){return this.text.updateBox(),this.bbox=Ih(this.start,this.end,this.text,this.strokeWidth),this.bbox}getBaseGraphics(){let e=[];return this.text.outline.forEach(i=>{e.push(i.primitives.map(n=>n.multiply3(this.text.matrix.toMatrix3())))}),Jl(this.start,this.end).forEach(i=>{e.push([i])}),e}clone(e=!1){let r=z(e,Zo.Blength);r.set(this.buffer);let i=this.text.clone(e);return new Zo(this.globalIndex,r,i,this._unit)}},Hi=Zo;Hi.Blength=9+4;var jo=class extends be{static getInstance(){return jo.manager==null&&(jo.manager=new jo),jo.manager}addModel(e){this.map.set(e.globalIndex,e),this.survive(e.globalIndex)}addByBuffer(e,r,i,n){return this._last=this.map.get(e),this._last!=null?this._last.update(r,i,n):(this._last=new Hi(e,r,i,n),this.map.set(e,this._last)),this._last}addRadius(e,r,i,n,s,o,l,u,h,c){let f=Wa(i,n,s);return this._last=Hi.build(e,r,i,n,s,o,l,u,h,f,c,null,!0),this.lastPrecision=this._last.precision,this.addModel(this._last),this._last}delete(e){e instanceof Hi&&(this.map.delete(e.globalIndex),this.del(e.globalIndex))}getIncreaseData(e=!1,r=!1){return Re(this.map,this.addList,e,r)}},An=jo;An.manager=null;var $o=class{constructor(t,e){this.matrix=X.ORIGIN;this.renderMatrix=X.ORIGIN;this.pxRatio=0;this.projection=X.ORIGIN;this.panelizeParam=new Array;this.panelizeMask=!1;this.screenPosition=b.ORIGIN;this.matrixListeners=[];this._width=t,this._height=e,this.updateFlag=!0}static getInstance(){return $o.camera==null&&($o.camera=new $o(1920,1080)),$o.camera}get width(){return this._width}get height(){return this._height}clearPanelizeInfo(){this.panelizeParam.length=0}createPanelize(t,e,r){this.panelizeParam.length=0;for(let i=0;i<e;i++)for(let n=0;n<r;n++){if(i==0&&n==0)continue;let s=new b(n*t.x,i*t.y);this.panelizeParam.push(s)}}setPanelizeMask(t){this.panelizeMask=t}getRenderMatrixs(t=!0){this.getRenderMatrix();let e=new Array,r=this.getMatrix();if(this.panelizeMask||this.panelizeParam.length==0){if(t){let i=r.multiply4(this.projection);e.push(i.data)}else e.push(r.data);return e}for(let i of this.panelizeParam){let s=X.translate(i.x,i.y,0).multiply4(r);if(t){let o=s.multiply4(this.projection);e.push(o.data)}else e.push(s.data)}return e}getScale(){return Math.sqrt(this.matrix.data[0]*this.matrix.data[0]+this.matrix.data[1]*this.matrix.data[1])}updateSize(t,e){return this._width=t,this._height=e,this.updateFlag=!0,this}getMatrix(){return this.matrix}setMatrix(t){return this.matrix=t,this.updateFlag=!0,this.matrixListeners.forEach(e=>e(t)),this}addMatrixListener(t){this.matrixListeners.push(t),this.setMatrix(this.matrix)}applyMatrix(t){this.setMatrix(this.matrix.multiply4(t))}getProjection(){return this.updateMatrix(),this.projection}getRenderMatrix(){return this.updateMatrix(),this.renderMatrix}getPxRatio(){return this.updateMatrix(),this.pxRatio}updateMatrix(){if(this.updateFlag){let t=this._width,e=this._height,r=-1,i=1e3,n=r-i;this.projection=new X([2/t,0,0,0,0,2/e,0,0,0,0,2/n,0,0,0,0,1]),this.renderMatrix=this.matrix.multiply4(this.projection);let s=pr.ORIGIN.multiply4(this.renderMatrix);if(t>e){let o=new pr(0,1,0).multiply4(this.renderMatrix);this.pxRatio=2/e/s.sub(o).length()}else{let o=new pr(1,0,0).multiply4(this.renderMatrix);this.pxRatio=2/t/s.sub(o).length()}this.updateFlag=!1}}adapt(t,e=1){let r=t.center(),i=new pr(r.x,r.y,0),n=t.width(),s=t.height(),o=this.getMatrix(),l=this.getScale();if(l==0||n==0||s==0)return;let u=this.width/n,h=this.height/s;u<=0&&(u=1),h<=0&&(h=1);let c=Math.min(u,h)/l*e,f=new pr(-o.data[12]/l,-o.data[13]/l,0),d=X.translate1(f.sub(i)).multiply4(this.getMatrix()).scale(c,c,1);this.setMatrix(d)}},Qo=$o;Qo.camera=null;var jfe=self.PCB_CAMERA=self.PCB_CAMERA||Qo.getInstance();var Jo=class extends Fe{constructor(e,r,i,n,s){super();this.modelType="Ratline";this.globalIndex=e,this.net=i,this.startId=n,this.endId=s,this.update(r)}update(e){this.buffer=e,this.clearCache()}static build(e,r,i,n,s,o,l,u,h=!1){let c=z(h,Jo.Blength);return c.set([r.x,r.y,i.x,i.y,l?1:0],0),u==null&&(u=new H().ext2(r).ext2(i).build()),c.set(u.data,5),new Jo(e,c,n,s,o)}get modify(){return!1}set modify(e){}get layerId(){return 57}set layerId(e){}get start(){return new b(this.buffer[0],this.buffer[1])}set start(e){this.updateShapeBuffer(0,[e.x,e.y])}get end(){return new b(this.buffer[2],this.buffer[3])}set end(e){this.updateShapeBuffer(2,[e.x,e.y])}get bbox(){return new j(this.buffer[5],this.buffer[6],this.buffer[7],this.buffer[8])}set bbox(e){this.updateBuffer(5,e.data)}get length(){return this.start.distance1(this.end)}rotateFor(e,r){}transform(e){}inOutline(e){return this.inShape(e.x,e.y)}inShape(e,r,i){let n=Qo.getInstance().getScale();return lt(new b(e,r),this.start,this.end,0,n)}get locked(){return this.buffer[4]==1}set locked(e){this.updateBuffer(4,[e?1:0])}updateBox(){let e=new H;return e.ext2(this.start).ext2(this.end),this.bbox=e.build(),this.bbox}clone(e=!1){let r=z(e,Jo.Blength);return r.set(this.buffer),new Jo(this.globalIndex,r,this.net,this.startId,this.endId)}},In=Jo;In.Blength=5+4;var ea=class extends be{constructor(){super(...arguments);this.idMap=new Map;this._lastRatline=null}static getInstance(){return ea.manager==null&&(ea.manager=new ea),ea.manager}addByBuffer(e,r,i,n,s){if(this._lastRatline=this.idMap.get(e),this._lastRatline!=null)this._lastRatline.update(r);else{this._lastRatline=new In(e,r,i,n,s);let o=this.map.get(i);o==null&&(o=new Array,this.map.set(this._lastRatline.net,o)),o.push(this._lastRatline),this.idMap.set(e,this._lastRatline)}return this._lastRatline}add(e,r,i,n,s,o){let l=In.build(e,r,i,n,s,o,!1,null,!0),u=this.map.get(n);return u==null&&(u=new Array,this.map.set(n,u)),u.push(l),this.idMap.set(e,l),this.survive(l.globalIndex),l}delete(e){let r=this.map.get(e);if(r!=null)for(let i of r)i.remove(),this.del(i.globalIndex),this.idMap.delete(i.globalIndex);this.map.delete(e)}deleteById(e){if(this._lastRatline=this.idMap.get(e),this.idMap.delete(e),this._lastRatline!=null&&(this.del(this._lastRatline.globalIndex),this._last=this.map.get(this._lastRatline.net),this._last!=null)){let r=this._last.indexOf(this._lastRatline);r>=0&&this._last.splice(r,1),this._last.length==0&&this.map.delete(this._lastRatline.net)}}getRatlineByNetName(e){return this.map.get(e)||[]}getRatlineLengthByName(e){let r=this.getRatlineByNetName(e),i=0;return r.forEach(n=>i+=n.length),i}getRatlineById(e){return this.idMap.get(e)}getAllNets(){let e=new Array(this.map.size),r=0;for(let i of this.map.values())e[r]=i,r++;return e}getAllRatlines(){return this.idMap.values()}recycle(){super.recycle(),this.idMap.clear()}getIncreaseData(e=!1,r=!1){return Re(this.idMap,this.addList,e,r)}},ta=ea;ta.manager=null;var ra=class extends be{static getInstance(){return ra.manager==null&&(ra.manager=new ra),ra.manager}addModel(t){this.map.set(t.globalIndex,t),this.survive(t.globalIndex)}addByBuffer(t,e,r,i,n,s,o,l,u,h,c,f,d,p){if(this._last=this.map.get(t),this._last==null){let m=new Ye(t,e,r,i,n,s,o,l,u,h,c,f,d,p);this.map.set(t,m)}else this._last.update(e,r,i,n,s,o,l,u,h,c,f,d,p);return this._last}addText(t,e,r,i,n,s,o,l,u,h,c,f,d,p,m,g=!1,x=!1,y=0,P=null){return this._last=Ye.build(t,e,y,r,i,n,s,o,l,u,c,f,d,p,m,g,x,[],0,0,h,P,null,!0),this.addModel(this._last),this._last}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}delete(t){t instanceof Ye&&(this.map.delete(t.globalIndex),this.del(t.globalIndex))}},si=ra;si.manager=null;var ia=class extends be{static getInstance(){return ia.manager==null&&(ia.manager=new ia),ia.manager}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}addModel(t){return this._last=t,this.map.set(t.globalIndex,this._last),this.survive(t.globalIndex),this._last}addTrackByBuffer(t,e,r){return this._last=this.map.get(t),this._last==null?(this._last=new ut(t,e,r),this.map.set(t,this._last)):this._last.update(e,r),this._last}addArcTrackByBuffer(t,e,r){return this._last=this.map.get(t),this._last==null?(this._last=new Er(t,e,r),this.map.set(t,this._last)):this._last.update(e,r),this._last}addTrack(t,e,r,i,n,s,o){return this._last=ut.build(t,e,r,i,n,s,o,null,!0),this.addModel(this._last),this._last}addArcTrack(t,e,r,i,n,s,o,l,u,h,c){return this._last=Er.build(t,e,r,i,l,n,s,o,u,h,c,null,!0),this.addModel(this._last),this._last}delete(t){t instanceof vr&&(this.map.delete(t.globalIndex),this.del(t.globalIndex))}},Li=ia;Li.manager=null;var na=class extends be{static getInstance(){return na.manager==null&&(na.manager=new na),na.manager}addModel(t){this.map.set(t.globalIndex,t),this.survive(t.globalIndex)}addByBuffer(t,e,r,i){return this._last=this.map.get(t),this._last!=null?this._last.update(e,r,i):(this._last=new Ze(t,e,r,i),this.map.set(t,this._last)),this._last}getIncreaseData(t=!1,e=!1){return Re(this.map,this.addList,t,e)}addVia(t,e,r,i,n,s,o,l,u,h,c,f,d,p=new Array,m=!1){e==0&&m&&(e=2);let g=Ze.build(t,e,r,i,n,p,s,o,l,u,c,f,d,h,null,!0);return this.addModel(g),g}delete(t){t instanceof Ze&&(this.map.delete(t.globalIndex),this.del(t.globalIndex))}},Mi=na;Mi.manager=null;var eu=class{constructor(t,e,r,i){this._ruleName=null;this.type="SAFE";this._net1Type=t,this._net1=e,this._net2Type=r,this._net2=i}get ruleName(){return this._ruleName}set ruleName(t){this._ruleName=t}getNet(t,e){switch(t){case"net":return ke.getInstance().getNet(e);case"netClass":return ke.getInstance().getNetClass(e);default:return null}}get net1(){return this.getNet(this._net1Type,this._net1)}get net2(){return this.getNet(this._net2Type,this._net2)}getNets(t){if(t instanceof zn)return[t.name];if(t instanceof _i){let e=t.getAllNets(),r=[];return e.forEach(i=>{r.push(i.name)}),r}return[]}};var sa=class extends yt{constructor(e){super();this.name=e}get name(){return this._name}set name(e){this._name=e,this.change=!0}toJSON(){return{name:this.name}}clone(){return new sa(this.name)}};var Pm=(e=>(e.TOP_BOTTOM="top_bottom",e.SIDE="side",e))(Pm||{}),Sm=(r=>(r[r.AUTO=0]="AUTO",r[r.UPPER_SHELLS=1]="UPPER_SHELLS",r[r.LOWER_SHELLS=2]="LOWER_SHELLS",r))(Sm||{}),Cn=class extends yt{constructor(e,r,i,n=0){super();this.type=e,this.stretchLength=r,this.lineId=i,this.belong=n}get lineId(){return this._baseLineId}set lineId(e){this._baseLineId=e,this.change=!0}get type(){return this._type}set type(e){this._type=e,this.change=!0}get stretchLength(){return this._stretchLength}set stretchLength(e){this._stretchLength=e,this.change=!0}get belong(){return this._belong}set belong(e){Cn.getBelongOptions().some(i=>i.value===e)?this._belong=e:this._belong=0,this.change=!0}static getBelongOptions(){return[{text:"Auto",value:0},{text:"Upper shell",value:1},{text:"Lower shell",value:2}]}toJSON(){return{type:this.type,lineId:this.lineId,stretchLength:this.stretchLength,belong:this.belong}}clone(){let e=new Cn(this.type,this.stretchLength,this.lineId);return e.belong=this.belong,e}};var Tf=(e=>(e.PUSH_COVER="DRAWER",e.UPPER_LOWER_SHELLS="T&B",e))(Tf||{}),wm=(i=>(i[i.X_AXIS_POSITIVE=1]="X_AXIS_POSITIVE",i[i.X_AXIS_NEGATIVE=2]="X_AXIS_NEGATIVE",i[i.Y_AXIS_POSITIVE=4]="Y_AXIS_POSITIVE",i[i.Y_AXIS_NEGATIVE=8]="Y_AXIS_NEGATIVE",i))(wm||{}),Ch=.1/10,oa=class extends yt{constructor(e,r,i,n,s){super();this._pushCoverDir=1;this._topInnerHeight=new Ht().conversion("mm","mil",0)/10;this._bottomInnerHeight=new Ht().conversion("mm","mil",0)/10;this._type=e,this._shellHeight=r,this._isDftSubstrateHeight=i===0,this._botShellHeight=n===0?r*2/3:n,this._botShellHeight=Math.max(this._botShellHeight,Ch);let o={shellHeight:r,botShellHeight:this._botShellHeight},l=this.getDefaultSubstrateHeight(e,o);this._substrateHeight=i===0?l:i,this._isDftBotShellHeight=n===0,this._shellThickness=s,this._topShellHeight=this._shellHeight-this._botShellHeight}getDefaultSubstrateHeight(e,r){let i=new Ht().conversion("mm","mil",2)/10,{shellHeight:n,botShellHeight:s}=r;return e==="T&B"&&typeof s=="number"?s-i:e==="DRAWER"&&typeof n=="number"?n*2/3-i:0}get type(){return this._type}set type(e){let r=this._type;if(this._type=e,r==="DRAWER"&&e==="T&B"&&this._botShellHeight>this.shellHeight){let i=this.shellHeight*2/3;this._botShellHeight=Math.max(i,Ch)}this.change=!0}get shellHeight(){return this._shellHeight}set shellHeight(e){if(this._shellHeight=e,this._isDftSubstrateHeight){let r={shellHeight:e,botShellHeight:e*2/3},i=this.getDefaultSubstrateHeight(this.type,r);this._substrateHeight=i}if(this._isDftBotShellHeight){let r=e*2/3;this._botShellHeight=Math.max(r,Ch)}this._topShellHeight=this._shellHeight-this._botShellHeight,this._topInnerHeight>0&&(this._topInnerHeight=this.getTopInnerHeight(this._topInnerHeight,this._botShellHeight,this._shellThickness),this._bottomInnerHeight=0),this._bottomInnerHeight>0&&(this._bottomInnerHeight=this.getBottomInnerHeight(this._bottomInnerHeight,this._topShellHeight,this._shellThickness),this._topInnerHeight=0),this.change=!0}getTopInnerHeight(e,r,i){let n=r-i;return n<0?e:e<0?0:e>n?n:e}getBottomInnerHeight(e,r,i){let n=r-i;return n<0?e:e<0?0:e>n?n:e}get substrateHeight(){return this._substrateHeight}set substrateHeight(e){this._substrateHeight=e,this._isDftSubstrateHeight=!1,this.change=!0}get botShellHeight(){return this._botShellHeight}set botShellHeight(e){this._botShellHeight=e,this._isDftBotShellHeight=!1,this.topInnerHeight=this.getTopInnerHeight(this.topInnerHeight,this._botShellHeight,this._shellThickness),this.change=!0}get topShellHeight(){return this._topShellHeight}set topShellHeight(e){this._topShellHeight=e,this.botShellHeight=this.getBottomInnerHeight(this.botShellHeight,this._topShellHeight,this._shellThickness),this.change=!0}get pushCoverDir(){return this._pushCoverDir}set pushCoverDir(e){this._pushCoverDir=e,this.change=!0}get topInnerHeight(){return this._topInnerHeight}set topInnerHeight(e){e<0||(this._topInnerHeight=this.getTopInnerHeight(e,this.botShellHeight,this.shellThickness),this._topInnerHeight>0&&(this._bottomInnerHeight=0),this.change=!0)}get bottomInnerHeight(){return this._bottomInnerHeight}set bottomInnerHeight(e){e<0||(this._bottomInnerHeight=this.getBottomInnerHeight(e,this._topShellHeight,this._shellThickness),this._bottomInnerHeight>0&&(this._topInnerHeight=0),this.change=!0)}get shellThickness(){return this._shellThickness}set shellThickness(e){this._shellThickness=e,this._topInnerHeight>0&&(this._topInnerHeight=this.getTopInnerHeight(this._topInnerHeight,this._botShellHeight,this._shellThickness),this._bottomInnerHeight=0),this._bottomInnerHeight>0&&(this._bottomInnerHeight=this.getBottomInnerHeight(this._bottomInnerHeight,this._topShellHeight,this._shellThickness),this._topInnerHeight=0),this.change=!0}get isDftBotShellHeight(){return this._isDftBotShellHeight}get isDftSubstrateHeight(){return this._isDftSubstrateHeight}getAttrs(){let[e,r,i,n,s]=[this._shellThickness,this.botShellHeight,this.topInnerHeight,this.bottomInnerHeight,this.pushCoverDir];switch(this._type){case"DRAWER":return{Thickness:e,Direction:s};case"T&B":return{Thickness:e,BottomHeight:r,TopInnerHeight:i,BottomInnerHeight:n}}}getShowType(){switch(this.type){case"DRAWER":return"Push cover";case"T&B":return"Upper and lower shell"}}toJSON(){return{type:this.type,botShellHeight:this.botShellHeight,isDftBotShellHeight:this.isDftBotShellHeight,isDftSubstrateHeight:this.isDftSubstrateHeight,shellHeight:this.shellHeight,shellThickness:this.shellThickness,substrateHeight:this.substrateHeight,pushCoverDir:this.pushCoverDir,topInnerHeight:this.topInnerHeight,bottomInnerHeight:this.bottomInnerHeight}}clone(){return new oa(this.type,this.shellHeight,this.substrateHeight,this.botShellHeight,this.shellThickness)}};var Lm=(e=>(e.TOP="Top",e.SIDE="Side",e))(Lm||{}),Mm=(r=>(r[r.Outline=4]="Outline",r[r.ScrewPillar=8]="ScrewPillar",r[r.Entity=16]="Entity",r))(Mm||{}),yde=[4,8,16],es=class extends yt{constructor(e,r,i,n){super();this._type=e,this._slotDepth=r,this._slotOption=i,this._baseLineId=n}get lineId(){return this._baseLineId}set lineId(e){this._baseLineId=e,this.change=!0}get type(){return this._type}set type(e){this._type=e,this.change=!0}get slotDepth(){return this._slotDepth}set slotDepth(e){this._slotDepth=e,this.change=!0}get slotOption(){return this._slotOption}set slotOption(e){this._slotOption=e,this.change=!0}getShowType(){switch(this.type){case"Top":return"Top/Bottom Slot Region";case"Side":return"Side Slot Region"}}toJSON(){return{type:this.type,lineId:this.lineId,slotDepth:this.slotDepth,slotOption:this.slotOption}}clone(){return new es(this.type,this.slotDepth,this.slotOption,this.lineId)}};var aa=class extends yt{constructor(e,r,i,n,s,o){super();this._copperResult=new Array;this._style=e,this._gridLineWidth=r,this._clearance=i,this._keepIsland=n,this._optimization=s,this._name=o}get style(){return this._style}set style(e){this._style=e,this.change=!0}get gridLineWidth(){return this._gridLineWidth}set gridLineWidth(e){this._gridLineWidth=e,this.change=!0}get clearance(){return this._clearance}set clearance(e){this._clearance=e,this.change=!0}get keepIsland(){return this._keepIsland}set keepIsland(e){this._keepIsland=e,this.change=!0}get optimization(){return this._optimization}set optimization(e){this._optimization=e,this.change=!0}get copperResult(){return this._copperResult}set copperResult(e){this._copperResult=e,this.change=!0}get name(){return this._name}set name(e){this._name=e,this.change=!0}toJSON(){return{style:this._style,gridLineWidth:this._gridLineWidth,clearance:this._clearance,keepIsland:this._keepIsland,optimization:this._optimization,name:this._name}}clone(){return new aa(this.style,this.gridLineWidth,this.clearance,this.keepIsland,this.optimization,this.name)}};var Am=(n=>(n.PI="Polyimide",n.FR4="FR4",n.STEEL_SHEET="Stainless Steel",n.M3_DOUBLE_SIDED_TAPE="3M Tape",n.EMI_SHIELDING_FILM="EMI Shielding Film",n))(Am||{}),Ade=["Polyimide","FR4","Stainless Steel","3M Tape","EMI Shielding Film"],Im=(e=>(e.M3468="3M468",e.M39077="3M9077",e))(Im||{}),Ide=["3M468","3M9077"],la=class extends yt{constructor(e,r,i){super();this._material="Polyimide";this._fpcModel=null;this.material=e,this.fpcModel=r,this.thickness=i}get material(){return this._material}set material(e){this._material=e,this.change=!0}get fpcModel(){return this._fpcModel}set fpcModel(e){this._fpcModel=e,this.change=!0}get thickness(){return this._thickness}set thickness(e){this._thickness=e,this.change=!0}toJSON(){return{material:this.material,fpcModel:this.fpcModel,thickness:this.thickness}}clone(){return new la(this.material,this.fpcModel,this.thickness)}};var ts=class{constructor(t,e){this.id=t,this.buffer=e}static build(t,e,r,i,n,s=!1){let o=z(s,ts.Blength);return o[0]=e,o[1]=D.notnull(r),o[2]=D.notnull(i),o[3]=D.notnull(n),new ts(t,o)}static test(){return null}static buildByJson(t,e){return e?ts.build(t,e.connectMode,e.lineClearance,e.lineWidth,e.lineAngle):null}updateBuffer(t,e){this.buffer&&this.buffer.set(e,t)}get lineAngle(){return this.buffer[3]}set lineAngle(t){this.updateBuffer(3,[t])}get lineWidth(){return this.buffer[2]}set lineWidth(t){this.updateBuffer(2,[t])}get connectMode(){return this.buffer[0]}set connectMode(t){this.updateBuffer(0,[t])}get lineClearance(){return this.buffer[1]}set lineClearance(t){this.updateBuffer(1,[t])}clone(t=!1){let e=z(t,ts.Blength);return e.set(this.buffer),new ts(this.id,e)}toJSON(){return{lineAngle:this.lineAngle,lineWidth:this.lineWidth,lineClearance:this.lineClearance,connectMode:this.connectMode}}},ua=ts;ua.Blength=3+1;var ha=class extends yt{constructor(e,r,i,n,s){super();this._device=e,this._track=r,this._copper=i,this._fill=n,this._planzone=s}get device(){return this._device}set device(e){this._device=e,this.change=!0}get track(){return this._track}set track(e){this._track=e,this.change=!0}get copper(){return this._copper}set copper(e){this._copper=e,this.change=!0}get fill(){return this._fill}set fill(e){this._fill=e,this.change=!0}get planzone(){return this._planzone}set planzone(e){this._planzone=e,this.change=!0}toJSON(){return{device:this._device,track:this._track,copper:this._copper,fill:this._fill,planzone:this._planzone}}clone(){return new ha(this.device,this.track,this.copper,this.fill,this.planzone)}};var ca=class extends yt{constructor(e){super();this._padId=e}get padId(){return this._padId}set padId(e){this._padId=e,this.change=!0}toJSON(){return{padId:this.padId}}clone(){return new ca(this.padId)}};var fa=class extends yt{constructor(e){super();this._connects=e}get connects(){return this._connects}set connects(e){this._connects=e}toJSON(){return{connects:this.connects}}clone(){return new fa(this.connects)}};var Tn=class extends xi{constructor(e,r,i,n){super();this.globalIndex=e,this.update(r,i,n)}update(e,r,i){this.buffer=e,this.text=r,this._unit=i,this.clearCache()}static build(e,r,i,n,s,o,l,u,h,c,f,d=1.2,p=.8,m=3,g,x,y=!1){let P=i.distance1(n),L=g||Oi(P,l,c).toString()+c,{width:w,height:C,path:T}=Kr(L,u,h),M=Do(i,n,w,m),E=Ni($e(r)?-n.angle(i):n.angle(i)),W=$e(r)?9:3,k=Ye.build(e,r,0,"",!1,L,!0,"default",u,E,M,W,h,!1,0,!1,!1,T,w,C,f,null,null,y);x==null&&(x=ko(i,n,s,o,h,k,d,p));let O=z(y,15+4);return O.set([r,i.x,i.y,n.x,n.y,s.x,s.y,o.x,o.y,l,u,h,d,p,m],0),O.set(x.data,15),new Tn(e,O,k,c)}get modify(){return this.text.modify}set modify(e){this.text.modify=e}get layerId(){return this.buffer[0]}set layerId(e){this.updateBuffer(0,[e]),this.text.layerId=e,$e(e)&&this.text.origin!=9?this.text.origin=9:!$e(e)&&this.text.origin!=3&&(this.text.origin=3),this.updateText()}get unit(){return this._unit}set unit(e){this._unit=e,this.updateText()}get textPosition(){return this.text.position}get width(){return this.buffer[11]}set width(e){this.updateShapeBuffer(11,[e]),this.text.strokeWidth=e,this.updateText()}get strokeWidth(){return this.width}set strokeWidth(e){this.width=e}get start(){return new b(this.buffer[1],this.buffer[2])}set start(e){this.updateShapeBuffer(1,[e.x,e.y]),this.updateText()}get end(){return new b(this.buffer[3],this.buffer[4])}set end(e){this.updateShapeBuffer(3,[e.x,e.y]),this.updateText()}get left(){return new b(this.buffer[5],this.buffer[6])}set left(e){this.updateShapeBuffer(5,[e.x,e.y]),this.updateText()}get right(){return new b(this.buffer[7],this.buffer[8])}set right(e){this.updateShapeBuffer(7,[e.x,e.y]),this.updateText()}get length(){return this.start.distance1(this.end)}set length(e){let i=this.end.sub(this.start).normalize().mul(e-this.length),n=X.translate(i.x,i.y,0);this.end=this.end.multiply4(n),this.right=this.right.multiply4(n)}get precision(){return this.buffer[9]}set precision(e){this.updateBuffer(9,[e]),this.updateText()}get fontSize(){return this.buffer[10]}set fontSize(e){this.updateBuffer(10,[e]),this.text.fontSize=this.fontSize,this.updateText()}get content(){return Oi(this.length,this.precision,this.unit).toString()+this._unit}get lineLen(){return this.buffer[12]}get arrLineLen(){return this.buffer[13]}get textOffset(){return this.buffer[14]}get bbox(){return new j(this.buffer[15],this.buffer[16],this.buffer[17],this.buffer[18])}set bbox(e){this.updateBuffer(15,e.data)}updateText(){let{width:e,height:r,path:i}=Kr(this.content,this.fontSize,this.width);this.text.outline=i,this.text.position=Do(this.start,this.end,e,this.textOffset);let n=$e(this.layerId);this.text.rotation=Ni(n?-this.end.angle(this.start):this.end.angle(this.start)),this.text.updateBox4(e,r)}transform(e){this.start=this.start.multiply4(e),this.end=this.end.multiply4(e),this.left=this.left.multiply4(e),this.right=this.right.multiply4(e),this.updateText()}inShape(e,r){let i=new b(e,r),n=Vo(this.start,this.end,this.left,this.right,this.text.box.width,this.lineLen,this.arrLineLen);for(let s of n)if(lt(i,s.start(),s.end(),this.width))return!0;return this.text.inShape(e,r)}get locked(){return this.text.locked}set locked(e){this.text.locked=e}calibrateLine(e,r,i,n){let s,o,l;this.start.equals(this.end)?(r?s=this.vectorProjectOnPerpendicularLine(this.right.sub(this.left),e[0].sub(e[1])):s=this.vectorProjectOnPerpendicularLine(e[0].sub(e[3]),e[1].sub(e[0])),o=0):(s=this.end.sub(this.start),o=s.length());let u=s.normalize(),h=e[3].sub(e[2]).dot(u);switch(i?l=o+h:l=o-h,n){case 0:this.end=e[3].add(u.mul(l)),this.left=e[3].add(e[1].sub(e[0]));break;case 1:this.start=e[3].sub(u.mul(l)),this.right=e[3].add(e[1].sub(e[0]));break;case 2:this.start=e[1].sub(u.mul(l));break;case 3:this.end=e[1].add(u.mul(l));break}}vectorProjectOnPerpendicularLine(e,r){let i=r.rotate(new b(0,0),Math.PI/2).normalize(),n=e.angle(i);return Math.abs(n)>Math.PI/2&&(i=i.mul(-1)),i.mul(e.dot(i))}updateBox(){return this.text.buildBBox(),this.bbox=ko(this.start,this.end,this.left,this.right,this.strokeWidth,this.text,this.lineLen,this.arrLineLen),this.bbox}clone(e=!1){let r=z(e,this.buffer.length);r.set(this.buffer);let i=this.text.clone(e);return new Tn(this.globalIndex,r,i,this.unit)}};var pa=class extends be{static getInstance(){return pa.manager==null&&(pa.manager=new pa),pa.manager}addDimension(t,e,r,i,n,s,o,l,u,h,c){let f=Tn.build(t,e,r,i,n,s,o,l,u,h,c);return this.map.set(t,f),f}copy(t){}delete(t){t instanceof Tn&&this.map.delete(t._globalIndex)}},Ha=pa;Ha.manager=null;function Th(a){let t=[Li.getInstance(),Si.getInstance(),Mi.getInstance(),$r.getInstance(),An.getInstance(),jr.getInstance(),si.getInstance(),Mn.getInstance(),Sn.getInstance(),Ha.getInstance(),yi.getInstance(),Qr.getInstance(),wn.getInstance(),Pn.getInstance(),Pi.getInstance(),Ln.getInstance(),ni.getInstance(),wi.getInstance()];for(let e of t){let r=e.getItem(a);if(r!=null)return r}return null}function kme(a){switch(a.modelType){case"Track":case"ArcTrack":{Li.getInstance().addModel(a);break}case"Pad":{Si.getInstance().addModel(a);break}case"Via":{Mi.getInstance().addModel(a);break}case"Image":{Pi.getInstance().addModel(a);break}case"Picture":{Ln.getInstance().addModel(a);break}case"Length Dimension":{Sn.getInstance().addModel(a);break}case"Protractor Dimension":{Mn.getInstance().addModel(a);break}case"Radius Dimension":{An.getInstance().addModel(a);break}case"Polygon":{Qr.getInstance().addModel(a);break}case"Rect":{jr.getInstance().addModel(a);break}case"Circle":{$r.getInstance().addModel(a);break}case"Copper":{ni.getInstance().addModel(a);break}case"Inner":{wi.getInstance().addModel(a);break}case"Component":{yi.getInstance().addModel(a);break}case"Line":{wn.getInstance().addModel(a);break}case"Arc":{Pn.getInstance().addModel(a);break}case"Text":{si.getInstance().addModel(a);break}default:}}var tu=class{constructor(){this.combinations=new Array;this.polygons=new Array;this.components=new Array;this.contains=null;this.trackManager=Li.getInstance();this.padManager=Si.getInstance();this.viaManager=Mi.getInstance();this.radiusManager=An.getInstance();this.textManager=si.getInstance();this.protractorManager=Mn.getInstance();this.dimensionManager=Sn.getInstance();this.imageManager=Pi.getInstance();this.pictureManager=Ln.getInstance();this.innerManager=wi.getInstance();this.ruleManager=ke.getInstance();this.polygonManager=Qr.getInstance();this.circleManager=$r.getInstance();this.rectManager=jr.getInstance();this.lineManager=wn.getInstance();this.arcManager=Pn.getInstance();this.componentManager=yi.getInstance();this.copperManager=ni.getInstance();this.connectManager=Va.getInstance();this.map=new Map}decode(t,e=!1){let r=t.memory;this.decodeMemory(r,e);let i=JSON.parse(t.world);for(let n in i)switch(n){case"layer":{let s=i[n];for(let o in s)switch(o){case"layers":{let l=s[o];for(let u of l)this.addLayer(u);break}case"layerPhys":{let l=s[o];for(let u of l)this.addLayerPhy(u);break}case"activeLayerId":{let l=s[o];Bt.getInstance().activeLayer=l;break}}break}case"shapes":{let s=i[n];for(let o in s)switch(o){case"Track":{let l=s[o];for(let u of l)this.addTrack(u);break}case"ArcTrack":{let l=s[o];for(let u of l)this.addArcTrack(u);break}case"Pad":{let l=s[o];for(let u of l)this.addPad(u);break}case"Via":{let l=s[o];for(let u of l)this.addVia(u);break}case"Image":{let l=s[o];for(let u of l)this.addImage(u);break}case"Picture":{let l=s[o];for(let u of l)this.addPicture(u);break}case"Length Dimension":{let l=s[o];for(let u of l)this.addDimension(u);break}case"Protractor Dimension":{let l=s[o];for(let u of l)this.addProtractor(u);break}case"Radius Dimension":{let l=s[o];for(let u of l)this.addRadiusMark(u);break}case"Polygon":{let l=s[o];F.addAll(this.polygons,l);break}case"Rect":{let l=s[o];for(let u of l)this.addRect(u);break}case"Circle":{let l=s[o];for(let u of l)this.addCircle(u);break}case"Copper":{let l=s[o];for(let u of l)this.addCopper(u);break}case"Inner":{let l=s[o];for(let u of l)this.addInner(u);break}case"Combination":{let l=s[o];F.addAll(this.combinations,l);break}case"Component":{let l=s[o];F.addAll(this.components,l);break}case"Line":{let l=s[o];for(let u of l)this.addLine(u);break}case"Arc":{let l=s[o];for(let u of l)this.addArc(u);break}case"Ratline":{let l=s[o];for(let u of l)this.addRatline(u);break}case"Text":{let l=s[o];for(let u of l)this.addText(u);break}}break}case"del":{let s=i[n];for(let o in s)switch(o){case"Track":{let l=s[o];for(let u of l)this.delete(this.trackManager,u,this.trackManager.delete);break}case"ArcTrack":{let l=s[o];for(let u of l)this.delete(this.trackManager,u,this.trackManager.delete);break}case"Pad":{let l=s[o];for(let u of l)this.delete(this.padManager,u,this.padManager.delete);break}case"Via":{let l=s[o];for(let u of l)this.delete(this.viaManager,u,this.viaManager.delete);break}case"Image":{let l=s[o];for(let u of l)this.delete(this.imageManager,u,this.imageManager.delete);break}case"Picture":{let l=s[o];for(let u of l)this.delete(this.pictureManager,u,this.pictureManager.delete);break}case"Length Dimension":{let l=s[o];for(let u of l)this.delete(this.dimensionManager,u,this.dimensionManager.delete);break}case"Protractor Dimension":{let l=s[o];for(let u of l)this.delete(this.protractorManager,u,this.protractorManager.delete);break}case"Radius Dimension":{let l=s[o];for(let u of l)this.delete(this.radiusManager,u,this.radiusManager.delete);break}case"Polygon":{let l=s[o];for(let u of l)this.delete(this.polygonManager,u,this.polygonManager.delete);break}case"Rect":{let l=s[o];for(let u of l)this.delete(this.rectManager,u,this.rectManager.delete);break}case"Circle":{let l=s[o];for(let u of l)this.delete(this.circleManager,u,this.circleManager.delete);break}case"Copper":{let l=s[o];for(let u of l)this.delete(this.copperManager,u,this.copperManager.delete);break}case"Inner":{let l=s[o];for(let u of l)this.delete(this.innerManager,u,this.innerManager.delete);break}case"Combination":{let l=s[o],u=Bo.getInstance();for(let h of l){let c=u.getItem(h);c!=null&&(c.dissolution(),u.delete(c))}break}case"Component":{let l=s[o];for(let u of l)this.delete(this.componentManager,u,this.componentManager.delete);break}case"Line":{let l=s[o];for(let u of l)this.delete(this.lineManager,u,this.lineManager.delete);break}case"Arc":{let l=s[o];for(let u of l)this.delete(this.arcManager,u,this.arcManager.delete);break}case"Ratline":{let l=s[o],u=ta.getInstance();for(let h of l){let c=u.getRatlineById(h);c!=null&&u.deleteById(c.globalIndex)}break}case"Text":{let l=s[o];for(let u of l)this.delete(this.textManager,u,this.textManager.delete);break}}break}case"rules":{let s=i[n];for(let o in s)switch(o){case"safe":{let l=s[o];for(let u of l)this.addSafe(u);break}case"other":{let l=s[o];for(let u of l)this.addOther(u);break}case"track":{let l=s[o];for(let u of l)this.addTrackPhysic(u);break}case"blind":{let l=s[o];for(let u of l)this.addBlindPhysic(u);break}case"radius":{let l=s[o];for(let u of l)this.addRadiusPhysic(u);break}case"plane":{let l=s[o];for(let u of l)this.addPlanePhysic(u);break}case"copper":{let l=s[o];for(let u of l)this.addCopperPhysic(u);break}case"paste":{let l=s[o];for(let u of l)this.addPasteExpansion(u);break}case"solder":{let l=s[o];for(let u of l)this.addSolderExpansion(u);break}case"diff":{let l=s[o];for(let u of l)this.addDiffPair(u);break}case"netLength":{let l=s[o];for(let u of l)this.addNetLength(u);break}case"auto":{let l=s[o];for(let u of l)this.addAutoRouter(u);break}}break}case"ruleSelects":{let s=i[n];for(let o in s)switch(o){case"nets":{let l=s[o];for(let u of l)this.addNet(u);break}case"netClass":{let l=s[o];for(let u of l)this.addNetClass(u);break}case"betweetNet":{let l=s[o];for(let u of l)this.addBetweenNetwork(u);break}case"EqualLength":{let l=s[o];for(let u of l)this.addEqualLengthGroup(u);break}case"diffPairNet":{let l=s[o];for(let u of l)this.addDiffPairNet(u);break}case"padsPair":{let l=s[o];for(let u of l)this.addPadsPair(u);break}case"regionSelector":{let l=s[o];for(let u of l)this.addRegionSelector(u);break}}break}case"ruleCustomConfig":{let{config:s,isOpenDRCCustomCheck:o}=i.ruleCustomConfig;gi.getInstance().isOpenDRCCustomCheck=o,gi.getInstance().updateConfig(s)}case"others":{let s=i[n];for(let o in s)switch(o){case"pourOrders":{ni.getInstance().orders=s[o];break}case"contains":{this.contains=s[o];break}case"connects":{let l=s[o];for(let u of l)this.addConnect(u);break}}break}}for(let n of this.polygons)this.addPolygon(n);for(let n of this.combinations)this.addCombination(n);for(let n of this.components)this.addComponent(n);if(this.contains!=null)for(let n of this.contains)this.buildContains(n[0],n[1]);this.combinations.length=0,this.polygons.length=0,this.components.length=0,this.contains=null}delete(t,e,r){let i=t.getItem(e);i!=null&&(i.recycle(),r.call(t,i))}recycle(){Bt.getInstance().recycle(),ke.getInstance().recycleAll(),ke.getInstance().deleteAllRuleSelector(),this.connectManager.recycle();for(let t of this.polygonManager.getAllItem())t.coppers.clear();for(let t of this.circleManager.getAllItem())t.coppers.clear();for(let t of this.rectManager.getAllItem())t.coppers.clear()}decodeMemory(t,e=!1){cr.getInstance().autoFix();let r=t.Memory;for(let n of r)this.decodeDynamicMemory(n,e);let i=cr.getInstance();for(let[n,s]of i.map)this.map.get(n)==null&&this.map.set(n,s);for(let n in t)if(n!="Memory"){let s=t[n];for(let o of s)this.decodeAlignMemory(n,o,e)}}decodeDynamicMemory(t,e=!1){cr.getInstance().addMemory(t.buffer,t.pointer,e),this.map.set(t.id,t.buffer)}decodeAlignMemory(t,e,r=!1){let i=hn.getManager(t),s=(r?this.map:cr.getInstance().map).get(e.id);for(let o of e.offset)i.addMemory(s,o,r);i.autoFix()}buildContains(t,e){let r=this.getItem(t[0],t[1]);if(r!=null)for(let i of e){let n=this.getItem(i[0],i[1]);n.setParent(r),r instanceof _e&&n instanceof Ar&&r.coppers.add(n.globalIndex)}}getItem(t,e){switch(t){case"Polygon":return this.polygonManager.getItem(e);case"Circle":return this.circleManager.getItem(e);case"Rect":return this.rectManager.getItem(e);case"Copper":return this.copperManager.getItem(e);default:return null}}addLayer(t){let{layerId:e,type:r,name:i,status:n,activeColor:s,deactiveColor:o}=t;return Bt.getInstance().addLayer(e,r,i,new Lo(n),Ge.of7(s),Ge.of7(o))}addLayerPhy(t){let{layerId:e,material:r,thickness:i,permittivity:n,lossTangent:s,isKeepIsland:o}=t;return Bt.getInstance().addLayerPhy(e,r,i,n,s,o)}getFloat64Array(t,e){let r=this.map.get(t.id);return new Float64Array(r,t.offset,e)}addTrack(t){let{id:e,buffer:r,net:i}=t;return this.trackManager.addTrackByBuffer(e,this.getFloat64Array(r,ut.Blength),i)}addArcTrack(t){let{id:e,buffer:r,net:i}=t;return this.trackManager.addArcTrackByBuffer(e,this.getFloat64Array(r,Er.Blength),i)}addPad(t){let{id:e,buffer:r,num:i,net:n,top:s,bottom:o,inner:l,hole:u,padRule:h}=t,c=s==null?null:new $t(e,this.getFloat64Array(s.buffer,$t.Blength),this.getPolyline(s.pl)),f=o==null?null:new $t(e,this.getFloat64Array(o.buffer,$t.Blength),this.getPolyline(o.pl)),d=l==null?null:new $t(e,this.getFloat64Array(l.buffer,$t.Blength),this.getPolyline(l.pl)),p=u==null?null:new Yr(e,this.getFloat64Array(u,Yr.Blength)),m=h==null?null:new ua(e,this.getFloat64Array(h,ua.Blength));return this.padManager.addByBuffer(e,this.getFloat64Array(r,tt.Blength),i,n,c,f,d,p,m)}addVia(t){let{globalIndex:e,buffer:r,net:i,name:n}=t;return this.viaManager.addByBuffer(e,this.getFloat64Array(r,Ze.Blength),i,n)}addImage(t){let{globalIndex:e,buffer:r,box:i,template:n,silkColor:s}=t;return this.imageManager.addByBuffer(e,this.getFloat64Array(r,Mr.Blength),new gt(e,this.getFloat64Array(i,gt.Blength)),this.getPolylines(n),Ge.of7(s))}addPicture(t){let{globalIndex:e,buffer:r,box:i,hashId:n}=t;return this.pictureManager.addByBuffer(e,this.getFloat64Array(r,Gi.Blength),new gt(e,this.getFloat64Array(i,gt.Blength)),n)}addDimension(t){let{globalIndex:e,buffer:r,text:i,unit:n}=t,{buffer:s,box:o,key:l,showKey:u,value:h,showValue:c,fontFamily:f,fontSize:d,reverse:p,reverseExpansion:m,positionIsNull:g,path:x,silkColor:y}=i,P=new Ye(e,this.getFloat64Array(s,Ye.Blength),new gt(e,this.getFloat64Array(o,gt.Blength)),l,u,h,c,f,d,p,m,g,this.getPolylines(x),Ge.of7(y));return this.dimensionManager.addByBuffer(e,this.getFloat64Array(r,Fi.Blength),P,n)}addProtractor(t){let{globalIndex:e,buffer:r,text:i}=t,{buffer:n,box:s,key:o,showKey:l,value:u,showValue:h,fontFamily:c,fontSize:f,reverse:d,reverseExpansion:p,positionIsNull:m,path:g,silkColor:x}=i,y=new Ye(e,this.getFloat64Array(n,Ye.Blength),new gt(e,this.getFloat64Array(s,gt.Blength)),o,l,u,h,c,f,d,p,m,this.getPolylines(g),Ge.of7(x));return this.protractorManager.addByBuffer(e,this.getFloat64Array(r,Wi.Blength),y)}addRadiusMark(t){let{globalIndex:e,buffer:r,text:i,unit:n}=t,{buffer:s,box:o,key:l,showKey:u,value:h,showValue:c,fontFamily:f,fontSize:d,reverse:p,reverseExpansion:m,positionIsNull:g,path:x,silkColor:y}=i,P=new Ye(e,this.getFloat64Array(s,Ye.Blength),new gt(e,this.getFloat64Array(o,gt.Blength)),l,u,h,c,f,d,p,m,g,this.getPolylines(x),Ge.of7(y));return this.radiusManager.addByBuffer(e,this.getFloat64Array(r,Hi.Blength),P,n)}addPolygon(t){let{globalIndex:e,buffer:r,type:i,childrens:n,net:s,component:o,silkColor:l}=t,u=new Array;for(let h of n){let c=new Array;for(let f of h)if(f.type=="Line"){let d=this.lineManager.getItem(f.globalIndex);c.push(d)}else{let d=this.arcManager.getItem(f.globalIndex);c.push(d)}u.push(c)}return n.length=0,this.polygonManager.addByBuffer(e,this.getFloat64Array(r,Vi.Blength),i,u,s,Ge.of7(l),this.getComponent(2,i,o))}addRect(t){let{globalIndex:e,buffer:r,type:i,net:n,silkColor:s,component:o}=t;return this.rectManager.addByBuffer(e,this.getFloat64Array(r,ki.Blength),i,n,Ge.of7(s),this.getComponent(1,i,o))}addCircle(t){let{globalIndex:e,buffer:r,type:i,net:n,silkColor:s,component:o}=t;return this.circleManager.addByBuffer(e,this.getFloat64Array(r,Ui.Blength),i,n,Ge.of7(s),this.getComponent(1,i,o))}addCopper(t){let{globalIndex:e,net:r,source:i,buffer:n,pls:s}=t;return this.copperManager.addByBuffer(e,r,i,this.getFloat64Array(n,Ar.Blength),this.getPolylines(s))}addInner(t){let{globalIndex:e,net:r,source:i,buffer:n,pls:s}=t;return this.innerManager.addByBuffer(e,r,i,this.getFloat64Array(n,Or.Blength),this.getPolylines(s))}addCombination(t){let{globalIndex:e,items:r,name:i}=t,n=new Array;for(let s of r){let o=Th(s);o!=null&&n.push(o)}return Bo.getInstance().addByBuffer(e,n,i)}addComponent(t){let{globalIndex:e,buffer:r,attrsMap:i,attributes:n,items:s,box:o,footprintUUID:l,deviceUUID:u,silkColor:h}=t,c=new Array,f=new Array;for(let d of n){let p=si.getInstance().getItem(d);p!=null&&c.push(p)}for(let d of s){let p=Th(d);p!=null&&f.push(p)}return this.componentManager.addByBuffer(e,this.getFloat64Array(r,fr.Blength),i,c,f,new gt(e,this.getFloat64Array(o,gt.Blength)),l,u,Ge.of7(h))}addLine(t){let{globalIndex:e,buffer:r}=t;return this.lineManager.addByBuffer(e,this.getFloat64Array(r,Ot.Blength))}addArc(t){let{globalIndex:e,buffer:r}=t;return this.arcManager.addByBuffer(e,this.getFloat64Array(r,qt.Blength))}addRatline(t){let{globalIndex:e,buffer:r,net:i,startId:n,endId:s}=t;return ta.getInstance().addByBuffer(e,this.getFloat64Array(r,In.Blength),i,n,s)}addText(t){let{globalIndex:e,buffer:r,box:i,key:n,showKey:s,value:o,showValue:l,fontFamily:u,fontSize:h,reverse:c,reverseExpansion:f,positionIsNull:d,path:p,silkColor:m}=t;return this.textManager.addByBuffer(e,this.getFloat64Array(r,Ye.Blength),new gt(e,this.getFloat64Array(i,gt.Blength)),n,s,o,l,u,h,c,f,d,this.getPolylines(p),Ge.of7(m))}addSafe(t){let{name:e,buffer:r}=t;return this.ruleManager.addSafeSpacingByBuffer(e,this.getFloat64Array(r,r.len))}addOther(t){let{name:e,buffer:r}=t;return this.ruleManager.addOtherSpacingByBuffer(e,this.getFloat64Array(r,r.len))}addTrackPhysic(t){let{name:e,buffer:r}=t;return this.ruleManager.addTrackPhysicsByBuffer(e,this.getFloat64Array(r,r.len))}addBlindPhysic(t){let{name:e,buffer:r,nameMap:i}=t;return this.ruleManager.addBlindPhysicsByBuffer(e,this.getFloat64Array(r,r.len),i)}addRadiusPhysic(t){let{name:e,buffer:r}=t;return this.ruleManager.addRadiusPhysicsByBuffer(e,this.getFloat64Array(r,r.len))}addPlanePhysic(t){let{name:e,buffer:r}=t;return this.ruleManager.addInnerPlaneByBuffer(e,this.getFloat64Array(r,r.len))}addCopperPhysic(t){let{name:e,buffer:r}=t;return this.ruleManager.addCopperPlaneByBuffer(e,this.getFloat64Array(r,r.len))}addPasteExpansion(t){let{name:e,buffer:r}=t;return this.ruleManager.addPasteExpansionByBuffer(e,this.getFloat64Array(r,r.len))}addSolderExpansion(t){let{name:e,buffer:r}=t;return this.ruleManager.addSolderExpansionByBuffer(e,this.getFloat64Array(r,r.len))}addDiffPair(t){let{name:e,buffer:r}=t;return this.ruleManager.addDifferentialPhysicsByBuffer(e,this.getFloat64Array(r,r.len))}addNetLength(t){let{name:e,buffer:r}=t;return this.ruleManager.addNetLengthPhysicsByBuffer(e,this.getFloat64Array(r,r.len))}addAutoRouter(t){let{name:e,buffer:r,layers:i,ignoreNets:n}=t;return this.ruleManager.addAutoRouterByBuffer(e,i,n,this.getFloat64Array(r,r.len))}getPolylines(t){let e=new Array;for(let r of t){let i=this.getPolyline(r);i!=null&&e.push(i)}return e}getPolyline(t){if(t==null)return null;let e=new Array,r=t,i=r.length;for(let n=0;n<i;n+=6)switch(r[n]){case 0:{let s=new S(new b(r[n+1],r[n+2]),new b(r[n+3],r[n+4]));e.push(s);break}case 1:{let s=R.build3(new b(r[n+1],r[n+2]),r[n+3],r[n+4],r[n+5],r[n+5]);e.push(s);break}case 2:{let s=R.build3(new b(r[n+1],r[n+2]),r[n+3],r[n+4],r[n+5],r[n+5]);e.push(s);break}}return e.length>0?B.build2(e):null}getComponent(t,e,r){switch(e){case"Prohibited Region":{let{device:i,track:n,copper:s,fill:o,planzone:l}=r;return new ha(i,n,s,o,l)}case"Constraint Region":{let{name:i}=r;return new sa(i)}case"Copper Region":{let{name:i,style:n,gridLineWidth:s,clearance:o,keepIsland:l,optimization:u}=r;return new aa(n,s,o,l,u,i)}case"Fill Region":{let{padId:i}=r;return new ca(i)}case"FPC Stiffener":{let{material:i,fpcModel:n,thickness:s}=r;return new la(i,n,s)}case"3D Shell - Outline":{let{thickness:i}=r;return new oa("T&B",Sf,0,0,i)}case"3D Shell - Screw Pillar":{if(t===0){let{specification:i,height:n}=r;return new Di(i,n)}return null}case"3D Shell - Side Slot Region":{let{type:i,slotDepth:n,slotOption:s,baseLineId:o}=r;return new es(i,n,s,o)}case"3D Shell - Top Slot Region":{let{type:i,slotDepth:n,slotOption:s,baseLineId:o}=r;return new es(i,n,s,o)}case"3D Shell - Top/Bottom Entity":{let{type:i,stretchLength:n,baseLineId:s,belong:o}=r;return new Cn(i,n,s,o)}case"3D Shell - Side Entity":{let{type:i,stretchLength:n,baseLineId:s,belong:o}=r;return new Cn(i,n,s,o)}case"TearDrop":{let{connects:i}=r;return new fa(i)}default:return null}}addNet(t){let{name:e,safeSpacing:r,trackPhysics:i,differentailPhysics:n,netLengthPhysics:s,blindViaPhysics:o,radiusPhysics:l,innerPlane:u,copperPlane:h,solderExpansion:c,pasteExpansion:f,netClassName:d,equalLengthGroupName:p,netDifferentailName:m,showRatline:g,color:x}=t,y=x==null?null:Ge.of7(x);return this.ruleManager.addNetByBuffer(e,r,i,n,s,o,l,u,h,c,f,d,p,m,g,y)}addNetClass(t){let{name:e,safeSpacing:r,trackPhysics:i,differentailPhysics:n,netLengthPhysics:s,blindViaPhysics:o,radiusPhysics:l,innerPlane:u,copperPlane:h,solderExpansion:c,pasteExpansion:f,nets:d}=t;return this.ruleManager.addNetClassByBuffer(e,r,i,n,s,o,l,u,h,c,f,d)}addBetweenNetwork(t){let{type:e,net1:r,net1Type:i,net2:n,net2Type:s,ruleName:o}=t,l=new eu(i,r,s,n);switch(l.ruleName=o,e){case"SAFE":{this.ruleManager.betweenNetRule.safe.addRule(l);break}case"COPPER":{this.ruleManager.betweenNetRule.copper.addRule(l);break}case"INNER":{this.ruleManager.betweenNetRule.inner.addRule(l);break}}return l}addEqualLengthGroup(t){let{name:e,netLengthPhysics:r,nets:i}=t;return this.ruleManager.addEqualLengthGroupByBuffer(e,r,i)}addDiffPairNet(t){let{name:e,differentailPhysics:r,positiveNet:i,negativeNet:n}=t;return this.ruleManager.addNetDifferentailByBuffer(e,i,n,r)}addPadsPair(t){let{name:e,details:r}=t;return this.ruleManager.addPadsPairByBuffer(e,r)}addRegionSelector(t){let{name:e,safeClearance:r,otherClearance:i,track:n,diff:s,radius:o,innerPlane:l,copperPlane:u}=t;return this.ruleManager.addRegionSelectorByBuffer(e,r,i,n,s,o,l,u)}addConnect(t){let{mainId:e,relatedIds:r}=t;return this.connectManager.addConnect(e,new Set(r))}};var ru=Math.PI*2;function da(a,t){if(a.length==0)return a;if(t instanceof S){let e=t.start();ie(a,(r,i)=>r.distance2(e)-i.distance2(e),0,a.length)}else{let e=t.center,r=t.start().sub(e).normalize(),i=t.sweep();ie(a,(n,s)=>{let o=n.sub(e).normalize(),l=s.sub(e).normalize(),u=r.dot(o),h=r.dot(l),c=r.cross(o),f=r.cross(l),d=Math.acos(u),p=Math.acos(h);return(i==1&&c<0||i==0&&c>0)&&(d=ru-d),(i==1&&f<0||i==0&&f>0)&&(p=ru-p),d-p},0,a.length),t.start().equals(t.end())&&a.push(t.end())}return a}function Rye(a){return a/180*Math.PI}function vye(a,t){if(a.length==0)return a;if(t instanceof S){let e=t.start();ie(a,(r,i)=>r.point.distance2(e)-i.point.distance2(e),0,a.length)}else{let e=t.center,r=t.start().sub(e).normalize(),i=t.sweep();ie(a,(n,s)=>{let o=n.point.sub(e).normalize(),l=s.point.sub(e).normalize(),u=r.dot(o),h=r.dot(l),c=r.cross(o),f=r.cross(l),d=Math.acos(u),p=Math.acos(h);return(i==1&&c<0||i==0&&c>0)&&(d=ru-d),(i==1&&f<0||i==0&&f>0)&&(p=ru-p),d-p},0,a.length)}return a}function Cm(a,t){let e=a.bbox(),r=t.bbox(),i=(e.minY+e.maxY)/2,n=(r.minY+r.maxY)/2;return i-n}function Tm(a,t){let e=a.bbox(),r=t.bbox(),i=(e.minX+e.maxX)/2,n=(r.minX+r.maxX)/2;return i-n}var Gt=class{constructor(t,e){this.childs=new Array;this._bbox=null;this.parent=null;if(this.capacity=t,typeof e!="undefined"&&Array.isArray(e))for(let r of e)this.insert(r)}bbox(){return D.notnull(this._bbox)}itor(t,e){for(let r of this.childs)r instanceof Gt?r.itor(t+1,e):e(r,t)}debug(t){for(let e of this.childs)console.log(t,e.bbox(),e instanceof Gt?"+":"-"),e instanceof Gt&&e.debug(t+" |--")}insert(t){let e=this.childs,r=t.bbox();if(!(t instanceof Gt))for(let i=0;i<e.length;i++){let n=e[i];if(n instanceof Gt&&r.isInside(n.bbox())){n.insert(t),this._bbox=j.extend2(this._bbox,r);return}}t instanceof Gt&&(t.parent=this),e.length<=this.capacity?e.push(t):(e.push(t),this.splitNode()),this._bbox=j.extend2(this._bbox,r)}remove(t){if(t instanceof Gt&&t.childs.length>0)throw new Error;let e=this.childs,r=t.bbox(),i=new Array;for(let n=0;n<e.length;n++){let s=e[n];if(s===t)return e.splice(n,1),e.length>0?(this.updateBBox(),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox()):this.parent!==null?(this.parent.remove(this),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox()):this._bbox=null,1;s instanceof Gt&&r.isInside(s.bbox())&&i.push(s)}if(t instanceof Gt)throw new Error;for(let n of i){let s=n.remove(t);if(s===1)return this.childs.length>0&&this.updateBBox(),this.parent!==null&&this.parent.childs.length>0&&this.parent.updateBBox(),1;if(s!==0)throw new Error}return 0}recycle(){this.childs.length=0}updateBBox(){let t=new H;for(let e of this.childs)t.ext1(e.bbox());this._bbox=t.build()}splitNode(){let t=this.childs,e=t.length,r=-1,i=-1,n=Number.NEGATIVE_INFINITY;for(let u=0;u<e;u++){let h=t[u];for(let c=u+1;c<e;c++){let f=t[c],d=j.extend2(h.bbox(),f.bbox()).area();d>n&&(n=d,r=u,i=c)}}let s=this.asNode(t[r]),o=this.asNode(t[i]);for(let u=0;u<e;u++)if(u!==r&&u!==i){let h=t[u],c=h.bbox(),f=j.extend2(s._bbox,c).area(),d=j.extend2(o._bbox,c).area();f<d?s.insert(h):o.insert(h)}t.length=0;let l=this.parent;l!==null&&l.childs.length<this.capacity?(s.parent=l,o.parent=l,l.childs.push(s),l.childs.push(o),l.remove(this),l.updateBBox()):(s.parent=this,o.parent=this,t.push(s),t.push(o),this.updateBBox()),this.childs.length>0&&this.updateBBox(),s.updateBBox(),o.updateBBox()}asNode(t){if(t instanceof Gt)return t;{let e=new Gt(this.capacity);return e.insert(t),e}}},Rf=.5,vf=1e5,iu=class{constructor(t){this.items=new Set;this.changeList=new Set;this.deadList=new Set;this.changed=!1;this.capacity=t,this.capacity2=t*t,this.root=new Gt(t)}itor(t){this.root.itor(0,t)}size(){return this.items.size}search(t){this.flushWhenNeed();let e=[],r=[];for(r.push(this.root);;){let i=r.shift();if(i!==void 0)for(let n of i.childs)t.isSeparated(n.bbox())||(n instanceof Gt?r.push(n):e.push(n));else break}return e}insert(t){this.items.add(t),this.changeList.add(t),this.changed=!0}remove(t){this.items.delete(t),this.deadList.add(t),this.changed=!0}bbox(){return this.flushWhenNeed(),this.root.bbox()}flushDeleteWhenNeed(){if(this.changed){let t=this.deadList.size,e=1;if(this.items.size>0&&(e=t/this.items.size),e>Rf||t>vf)this.fullRefresh(),this.deadList.clear(),this.changeList.clear(),this.changed=!1;else{for(let i of this.deadList)this.root.remove(i);this.deadList.clear(),this.changed=this.changeList.size>0}}}flushWhenNeed(){if(this.changed){let t=this.changeList.size+this.deadList.size,e=1;if(this.items.size>0&&(e=t/this.items.size),e>Rf||t>vf)this.fullRefresh();else{for(let i of this.deadList)this.root.remove(i);for(let i of this.changeList)this.items.has(i)&&this.root.insert(i)}this.deadList.clear(),this.changeList.clear(),this.changed=!1}}debug(){this.root.debug("")}recycle(){this.items.clear(),this.changeList.clear(),this.deadList.clear(),this.root.recycle(),this.changed=!1}fullRefresh(){let t=new Array;for(let e of this.items)t.push(e);for(;;){let e=this.organize(t);if(e.length>1)t=e;else break}this.root.recycle(),this.root=new Gt(this.capacity,t)}organize(t){ie(t,Tm,0,t.length);let e=t.length,r=[];for(let i=0;i<e;)if(i+this.capacity2<=e){let n=i+this.capacity2;ie(t,Cm,i,n);for(let s=i;s<n;s+=this.capacity){let o=new Gt(this.capacity,t.slice(s,s+this.capacity));r.push(o)}i=i+this.capacity*this.capacity}else{let n=new Gt(this.capacity,t.slice(i,i+this.capacity));r.push(n),i=i+this.capacity}return r}};var nu=class{constructor(t){this.layerRTreeMap={};this.capacity=t}get items(){let t=Object.values(this.layerRTreeMap),e=new Set;for(let r of t)F.addAllSet(e,r.items);return e}get changeList(){let t=Object.values(this.layerRTreeMap),e=new Set;for(let r of t)F.addAllSet(e,r.changeList);return e}get deadList(){let t=Object.values(this.layerRTreeMap),e=new Set;for(let r of t)F.addAllSet(e,r.deadList);return e}getLayerKeys(){return Object.keys(this.layerRTreeMap).map(t=>Number(t))}size(){let t=Object.values(this.layerRTreeMap),e=0;for(let r of t)e+=r.items.size;return e}search(t,e){let r=[];if(e==null){let i=Object.values(this.layerRTreeMap);for(let n of i){let s=n.search(t);F.addAll(r,s)}}else{let i=this.layerRTreeMap[e];if(i!=null){let n=i.search(t);F.addAll(r,n)}}return r}insert(t){this.getRtree(t).insert(t)}getRtree(t){let e=this.layerRTreeMap[t.layerId];return e==null&&(e=new iu(this.capacity),this.layerRTreeMap[t.layerId]=e),e}remove(t){this.getRtree(t).remove(t)}bbox(){let t=new H,e=Object.values(this.layerRTreeMap);for(let r of e)r.bbox()!=null&&t.ext1(r.bbox());return t.valid()?t.build():null}recycle(){for(let t in this.layerRTreeMap)this.layerRTreeMap[t].recycle();this.layerRTreeMap={}}flushWhenNeed(){let t=Object.values(this.layerRTreeMap);for(let e of t)e.flushWhenNeed()}};var su=class{constructor(){this.shapes=[];this.fillAllFilter()}fillAllFilter(){this.getVias(this.shapes),this.getTracks(this.shapes),this.getTexts(this.shapes),this.getImages(this.shapes),this.getPads(this.shapes),this.getProfiles(this.shapes),this.getComponents(this.shapes),this.getCoppers(this.shapes),this.getPlanes(this.shapes)}getVias(t){let e=Mi.getInstance().getAllItem();for(let r=0;r<e.length;r++)t.push(e[r])}getTracks(t){Li.getInstance().getAllItem().forEach(r=>{r.length>1e-8&&t.push(r)})}getTexts(t){si.getInstance().getAllItem().forEach(r=>{let i=r.box;this.checkLayer(r.layerId)&&(!i||i.height==0||i.width==0||t.push(r))})}getImages(t){Pi.getInstance().getAllItem().forEach(r=>{this.checkLayer(r.layerId)&&t.push(r)})}getPads(t){let e=Si.getInstance().getAllItem();for(let r=0;r<e.length;r++)t.push(e[r])}getProfiles(t){let e=$r.getInstance().getAllItem(),r=jr.getInstance().getAllItem(),i=Qr.getInstance().getAllItem();for(let n of e)this.checkProfile(n)&&t.push(n);for(let n of r)this.checkProfile(n)&&t.push(n);for(let n of i)this.checkProfile(n)&&t.push(n)}checkProfile(t){if(!this.checkLayer(t.layerId))return!1;switch(t.type){case"Line":case"Prohibited Region":case"Fill Region":case"Board Outline":case"Slot Region":case"TearDrop":return!0}return!1}getComponents(t){let e=yi.getInstance().getAllItem();for(let r=0;r<e.length;r++)t.push(e[r])}getPlanes(t){let e=wi.getInstance().getAllItem();for(let r=0;r<e.length;r++)t.push(e[r])}getCoppers(t){let e=ni.getInstance().getAllItem();for(let r=0;r<e.length;r++)t.push(e[r])}checkLayer(t){let e=Bt.getInstance().getLayer(t);return!!(Xn(t)||qn(e.type)||oo(e.type)||t==11)}};var ou=class{constructor(t){this._item=t,this._bbox=this.buildBBox()}set item(t){this._item=t}get item(){return this._item}get layerId(){return this.item.isEmpty?1:this.item.layerId}update(){this._bbox=this.buildBBox()}buildBBox(){return this._item.buildBBox()}bbox(){return this._bbox}},au=class{constructor(t){this.pcbTree=new nu(10);this.map={};t==null&&(t=new su().shapes),this.shapes=t,this.addDocShapes2RTree()}addDocShapes2RTree(){for(let t of this.shapes)this.addShape2RTree(t)}getDRCShapes(t,e=0){let r=t.buildBBox().extendOfSize(e),i=this.search(r,t.layerId);if(t.layerId!==12){let n=this.search(r,12);i.push(...n)}if(t.layerId!==11){let n=this.search(r,11);i.push(...n)}if(t.layerId===12||t.layerId===11){let n=this.pcbTree.getLayerKeys();for(let s of n){if(s===12||s===11)continue;let o=this.search(r,s);i.push(...o)}}return i}search(t,e){return this.pcbTree.search(t,e).map(r=>r.item)}getShape(t){return this.map[t]}getShapes(t=e=>!0){return this.shapes.filter(e=>t(e))}insert(t){this.shapes.push(t),this.addShape2RTree(t)}remove(t){this.map[t.globalIndex]=t,this.pcbTree.remove(new ou(t));let e=this.shapes.findIndex(r=>{if(r.globalIndex===t.globalIndex)return!0});this.shapes.splice(e,1)}addShape2RTree(t){this.map[t.globalIndex]=t;let e=Bt.getInstance().getLayer(t.layerId);switch(Ee(e.type)){case 4:case 7:case 5:case 6:case 0:case 11:this.pcbTree.insert(new ou(t));break;default:break}}getNearShapes(t,e){return this.getDRCShapes(t,e).filter(i=>i instanceof Ze||i instanceof tt||i instanceof ut||i instanceof Er)}getTearViaAndPadShapes(t,e){return this.getDRCShapes(t,e).filter(i=>i instanceof Ze||i instanceof tt)}getTearTrackShapes(t,e){return this.getDRCShapes(t,e).filter(i=>i instanceof ut||i instanceof Er)}};var Rm=(e=>(e.All="all",e.Select="selected",e))(Rm||{}),vm=(e=>(e.Add="all",e.Remove="remove",e))(vm||{}),Nm=(e=>(e.Line="line",e.Arc="arc",e))(Nm||{}),Em=(r=>(r.ROUTING="ROUTING",r.T_CONNECTION="T_CONNECTION",r.OBLIQUE_LINE="OBLIQUE_LINE",r))(Em||{}),Rh="-",za=class{constructor(t){this.hideProgress=!1;this.ratio=0;this.delta=0;this.routingIds=[];this.routingsIds=[];this.verticalTrackIds=[];this.cruciformIds={};this.padViaIds={};this.operationType=t.operationType,this.applyScope=t.applyScope,this.tearShape=t.tearShape,this.ignoreDRC=t.ignoreDRC,this.hideProgress=t.hideProgress,this.circlePadViaChecked=t.circlePadViaChecked,this.roundWidth=t.roundWidth,this.roundeHeight=t.roundeHeight,this.specialShapedPadChecked=t.specialShapedPadChecked,this.otherWidth=t.otherWidth,this.otherHeight=t.otherHeight,this.routingChecked=t.routingChecked,this.routingWidth=t.routingWidth,this.routingHeight=t.routingHeight,this.TConnectionChecked=t.TConnectionChecked,this.TConnectionWidth=t.TConnectionWidth,this.TConnectionHeight=t.TConnectionHeight;let e=t.world,r=new tu().decode(e);this.map=new au,this.ids=t.ids}addTearDrop(){this.delta=1/this.ids.length;let t=[];return this.ids.forEach(e=>{let r=this.map.getShape(e);if(r instanceof ut){let i=r,n=this.map.getNearShapes(i,0);n&&n.length&&this.getNode(i,n).forEach(o=>{let l=this.getArr(o,i);l&&(t=t.concat(l))})}else(r instanceof Ze||r instanceof Ze||r instanceof tt)&&this.map.getTearTrackShapes(r,0).forEach(n=>{if(this.isExistPadVia(r.globalIndex,n.globalIndex)||r.net!==n.net||this.isExistRouting(n.globalIndex)||this.isExistTC(n.globalIndex))return;let s=this.getArr(r,n);s&&(t=t.concat(s))});this.updateProgress()}),this.updateProgress(!0),t}getArr(t,e){let r=[],i=this.getWHT(t,e);if(!i)return;let{type:n,width:s,height:o,shape:l,routings:u,tConnection:h}=i;if(l){let f=e.getMathGraphics(e.layerId,0);if(!(l instanceof B)||(l=l.asClose(),new q(l,f,0).relation!==0))return}let c=this.getTears(e,s,o,n,l,u,h);if(c){let f=this.getGlobalIndex(e,t);if(!f)return null;this.recordId(e,t),c.forEach(d=>{r.push({tear:ls(d),net:e.net,layer:e.layerId,globalIndex:f})})}return r.length?r:null}getGlobalIndex(t,e){let r;if(e.type==="T_CONNECTION"){r=[t.globalIndex];let{verticalTrack:i}=e;i.forEach(n=>{r.push(n.globalIndex)})}else if(e.type==="ROUTING"){r=[t.globalIndex];let{routing:i}=e;i.forEach(n=>{r.push(...n.map(s=>s.globalIndex))})}else r=[t.globalIndex,e.globalIndex];return[...new Set(r)]}recordId(t,e){let{type:r}=e;if(r==="ROUTING"){this.routingIds.push(t.globalIndex);let{routing:i}=e;i.forEach(n=>{n.length===2&&this.recordRoutings(n[0].globalIndex,n[1].globalIndex)})}else if(r==="T_CONNECTION"){this.verticalTrackIds.push(t.globalIndex);let{parallelLine:i,verticalTrack:n}=e;i&&this.recordCruciform(t,i,n)}else(e instanceof tt||e instanceof Ze||e instanceof Ze)&&(this.padViaIds[e.globalIndex]=[...new Set((this.padViaIds[e.globalIndex]||[]).concat([t.globalIndex,e.globalIndex]))])}getNode(t,e){if(e.length>1){let r=[],i=[],n=[],s=[];e.forEach(u=>{if(t.globalIndex===u.globalIndex||u.net!==t.net)return;let h=u.getMathGraphics(t.layerId,0);if(!h)return;let c=this.isStart(t,h),f=this.isEnd(t,h);c?i.push(u):f?n.push(u):(u instanceof tt||u instanceof Ze||u instanceof Ze)&&s.push(u)});let o=this.analysisGroup(t,i,!0);o&&o.length&&r.push(...o);let l=this.analysisGroup(t,n,!1);return l&&l.length&&r.push(...l),s&&s.length&&r.push(...s),r}else return this.node1v1(t,e[0])}analysisGroup(t,e,r){if(e.length){if(e.length===1)return this.node1v1(t,e[0]);if(e.length>1)return this.node1vMore(t,e,r)}else return[]}node1v1(t,e){let r=[];if(e&&e.getMathGraphics()&&t.globalIndex!==e.globalIndex&&e.net===t.net){if(e instanceof tt||e instanceof Ze||e instanceof Ze){if(this.isExistPadVia(e.globalIndex,t.globalIndex)||e.net!==t.net||this.isExistRouting(t.globalIndex)||this.isExistTC(t.globalIndex))return;r.push(e)}else if(e instanceof ut)if(e.width!==t.width)if(this.isCoincident(e,t)&&!this.isExistRoutings(e.globalIndex,t.globalIndex))r.push({routing:[[t,e]],type:"ROUTING"});else{let n=this.distanceLessHalfWidth(e,t);if(n===!0&&!this.isExistRoutings(e.globalIndex,t.globalIndex))r.push({routing:[[t,e]],type:"ROUTING"});else if(n===!1){let s=this.splitTrack(e,t);s&&!this.isExistTC(t.globalIndex)&&r.push({verticalTrack:s,type:"T_CONNECTION"})}}else{let n=this.splitTrack(e,t);n&&!this.isExistTC(t.globalIndex)&&r.push({verticalTrack:n,type:"T_CONNECTION"})}}return r}node1vMore(t,e,r){let i=[],{longerTrack:n,nodes:s,verticalTrack:o,notVerticalTrack:l,parallelLine:u}=this.getTrackRelation(t,e);if(n.length)return;let{maxNode:h,maxBBoxHeigth:c}=this.getMaxNode(t,s),f=!1;if(l.length===0){if(o.length===1){let d=this.splitTrack(o[0],t);d&&(o=d)}if(this.isTConnection(t,o))f=!0;else if(u&&o.length===1)return}if(f){let d=o[0].width;if(!c||d>=c){let p=this.getCruciformKey(o),m=this.isExistTC(t.globalIndex)||this.isExistCruciform(p),g=this.isExistRoutings(t.globalIndex,o[0].globalIndex)&&this.isExistRoutings(t.globalIndex,o[1].globalIndex);!m&&!g&&i.push({verticalTrack:o,parallelLine:u,type:"T_CONNECTION"})}else c&&d<c&&(this.isExistPadVia(h.globalIndex,t.globalIndex)||i.push(h))}else{let d=new Array;if(u){let m=this.getCruciformKey([t,u]);if(this.isExistCruciform(m))return;l.push(u)}if(o.length){let m=this.getCruciformKey(o);if(this.isExistCruciform(m))return;l.push(...o)}let p;if(l.length?l.forEach(m=>{!c||m.width>c?d.push(m):c&&m.width<c&&(p=h)}):p=h,d.length){let m=new Array,g=this.sortRouting(d,t,r);if(g.length===2){let x=g[0],y=g[1];if(this.isIntersectAndParallel(x,y)&&x.width===y.width)return;this.isExistRoutings(x.globalIndex,y.globalIndex)||m.push(g)}else if(g.length>2){for(let P=0;P<g.length-1;P++){let L=g[P],w=g[P+1];this.isExistRoutings(L.globalIndex,w.globalIndex)||m.push([L,w])}let x=g[g.length-1],y=g[0];this.isExistRoutings(x.globalIndex,y.globalIndex)||m.push([x,y])}m.length&&i.push({routing:m,type:"ROUTING"})}p&&!this.isExistPadVia(p.globalIndex,t.globalIndex)&&i.push(p)}return i}sortRouting(t,e,r){let i=r?e.start:e.end,n=r?e.end.sub(e.start).normalize():e.start.sub(e.end).normalize(),s=new b(-n.y,n.x).normalize(),o=new b(n.y,-n.x).normalize(),l=new Array,u=new Array;t.forEach(p=>{let m;p.start.distance1(i)<p.end.distance1(i)?m=p.end.sub(p.start).normalize():p.start.distance1(i)>p.end.distance1(i)&&(m=p.start.sub(p.end).normalize()),m&&(J.toDegrees(Math.acos(this.fixPrecision(m.dot(s))))<=90?l.push({direct:m,track:p}):J.toDegrees(Math.acos(this.fixPrecision(m.dot(o))))<=90&&u.push({direct:m,track:p}))});let h=new Array,c=new Array;l.forEach(p=>{let{direct:m,track:g}=p,x=J.toDegrees(Math.acos(n.dot(m)));h.push({track:g,angle:x})}),u.forEach(p=>{let{direct:m,track:g}=p,x=J.toDegrees(Math.acos(n.dot(m)));c.push({track:g,angle:x})});let f=h.sort((p,m)=>p.angle-m.angle).map(p=>p.track),d=c.sort((p,m)=>p.angle-m.angle).reverse().map(p=>p.track);return[e,...f,...d]}fixPrecision(t){return N.eq(t,1)?1:N.eq(t,-1)?-1:t}getTrackRelation(t,e){let r=new Array,i=new Array,n=new Array,s=new Array,o,l=[];for(let u=0;u<e.length;u++){let h=e[u],c=!1;for(let f=0;f<e.length;f++){let d=e[f];if(h instanceof ut&&d instanceof ut&&this.isLongerLine(d,h)){c=!0;break}}c||l.push(h)}return l.forEach(u=>{u instanceof Ze||u instanceof tt||u instanceof Ze?r.push(u):u instanceof ut&&this.isLongerLine(u,t)?s.push(u):u instanceof ut&&this.isLongerLine(t,u)||(u instanceof ut&&this.isVertical(u,t)?i.push(u):u instanceof ut&&this.isIntersectingline(u,t)?n.push(u):u instanceof ut&&this.isIntersectAndParallel(u,t)&&(o=u))}),{nodes:r,verticalTrack:i,notVerticalTrack:n,longerTrack:s,parallelLine:o}}isCoincident(t,e){return t.start.equals1(e.start)||t.start.equals1(e.end)||t.end.equals1(e.start)||t.end.equals1(e.end)}distanceLessHalfWidth(t,e){let r=this.getTrackIntersPoint(t,e);if(!r)return null;let{start:i,end:n}=t,s=r.distance1(i),o=r.distance1(n),l=t.width/2;return s<=l||o<=l}splitTrack(t,e){if(!this.isVertical(t,e))return;let r=this.getTrackIntersPoint(t,e);if(!r)return;let i=this.getLine(t),n=vt.foot(i,r),{net:s,layerId:o,start:l,end:u,width:h,globalIndex:c,locked:f}=t,d=n.distance1(l),p=n.distance1(u),m=t.width/2;if(d<m||p<m)return;let g=ut.build(c,o,n,l,h,f,s),x=ut.build(c,o,n,u,h,f,s);return[g,x]}getMaxNode(t,e){let i=t.end.sub(t.start).normalize().angle(b.ORIGIN),n=X.rotateZForPoint(t.start,-i),s,o;if(e.length){o=e[0],s=o.multiply3(n).bbox().height();for(let u=1;u<e.length;u++){let h=e[u],f=h.multiply3(n).bbox().height();s<f&&(o=h,s=f)}}return{maxNode:o,maxBBoxHeigth:s}}isExistRouting(t){return this.routingIds.includes(t)}recordRoutings(t,e){let r=[t,e].sort().join(Rh);this.routingsIds.push(r)}isExistRoutings(t,e){let r=[t,e].sort().join(Rh);return this.routingsIds.includes(r)}isExistTC(t){return this.verticalTrackIds.includes(t)}getCruciformKey(t){return t.map(r=>r.globalIndex).sort().join(Rh)}isExistCruciform(t){return t in this.cruciformIds}isExistPadVia(t,e){var r;return(r=this.padViaIds[t])==null?void 0:r.includes(e)}recordCruciform(t,e,r){if(e){let i=this.getCruciformKey([t,e]);this.cruciformIds[i]=this.cruciformIds[i]||r.map(n=>n.globalIndex)}}getWHT(t,e){let r,i,n,s;if(t instanceof tt){let o=e.layerId===1?t.top:e.layerId===2?t.bottom:t.inner;if(s=t.getMathGraphics(e.layerId,0),!s)return null;if(r=o.type,r=="ELLIPSE"){if(!this.circlePadViaChecked)return null;i=o.width*this.roundWidth,n=o.width*this.roundeHeight}else{if(!this.specialShapedPadChecked)return null;i=e.width*this.otherWidth,n=e.width*this.otherHeight}return{type:r,width:i,height:n,shape:s}}else if(t instanceof Ze){if(s=t.getMathGraphics(e.layerId,0),!s||(r="ELLIPSE",!this.circlePadViaChecked))return null;let o=t.radius*2;return i=o*this.roundWidth,n=o*this.roundeHeight,{type:r,width:i,height:n,shape:s}}else if(t.type==="ROUTING"){if(!this.routingChecked)return null;r="ROUTING";let o=new Array,{routing:l}=t;return l.forEach(u=>{let h=Math.max(u[0].width,u[1].width),c=u;i=h*this.routingWidth,n=h*this.routingHeight,o.push({width:i,height:n,tracks:c})}),{type:r,routings:o}}else if(t.type==="T_CONNECTION"){if(!this.TConnectionChecked)return null;let{verticalTrack:o}=t;return r="T_CONNECTION",i=o[0].width*this.TConnectionWidth,n=o[0].width*this.TConnectionHeight,{type:r,width:i,height:n,tConnection:{verticalTrack:o,type:r}}}}getAngle(t,e){let r,i,n=Math.max(t.width,e.width);if(t.start.distance1(e.start)<n?(r=t.end.sub(t.start).normalize(),i=e.end.sub(e.start).normalize()):t.start.distance1(e.end)<n?(r=t.end.sub(t.start).normalize(),i=e.start.sub(e.end).normalize()):t.end.distance1(e.start)<n?(r=t.start.sub(t.end).normalize(),i=e.end.sub(e.start).normalize()):t.end.distance1(e.end)<n&&(r=t.start.sub(t.end).normalize(),i=e.start.sub(e.end).normalize()),r&&i)return J.toDegrees(Math.acos(r.dot(i)))}isTConnection(t,e){if(e.length!==2)return!1;let r=e[0],i=e[1];return!this.isVertical(t,r)||!this.isVertical(t,i)?!1:this.isEqWidthIntersectAndParallel(r,i)}isEqWidthIntersectAndParallel(t,e){return t.width===e.width&&this.isIntersectAndParallel(t,e)}isLongerLine(t,e){let r=t.getMathGraphics(e.layerId,0),i=e.getMathGraphics(e.layerId,0);return!(!(new q(r,i,0).relation===0)||!(t.width>=e.width)||!(t.start.distance1(t.end)>e.start.distance1(e.end))||!(this.inShape(e.start,[r])&&this.inShape(e.end,[r])))}inShape(t,e){return wt.inPolygon(t,e)}isIntersectingline(t,e){return!this.isVertical(t,e)&&!this.isIntersectAndParallel(t,e)}isIntersectAndParallel(t,e){let r=t.end.sub(t.start),i=e.end.sub(e.start);return N.eq(r.cross(i),0)}isVertical(t,e){let r=t.end.sub(t.start),i=e.end.sub(e.start);return N.eq(r.dot(i),0)}getTears(t,e,r,i,n,s,o){return i==="ROUTING"?this.dispathRouting(t,s):i==="T_CONNECTION"?this.dispathTConnection(t,o,e,r):i!="ELLIPSE"?this.dispatch(n,t,e,r,i):this.dispatchArc(n,t,e,r)}dispathRouting(t,e){let r=[],i=this.calculateRouting(t,e);return i&&r.push(i),r.length?r:null}calculateRouting(t,e){let r=[];if(e.length===1&&(e=this.singleGroupRouting(e)),e.forEach(i=>{let{tracks:n}=i,[s,o]=n,l=this.getShapePoint(o,s);l&&r.push(Dh(Ai({},i),{point:l}))}),r.length===1){let{tracks:i,width:n,height:s,point:o}=r[0],[l,u]=i;if(!o)return;let h;l.start.distance1(o)<l.end.distance1(o)?h=!0:h=!1;let c=u.getMathGraphics(l.layerId,0);return this.calculate(c,l,n,s,h)}else return this.mulGroupRouting(r)}singleGroupRouting(t){let{tracks:e,width:r,height:i}=t[0],[n,s]=e,o=this.getShapePoint(s,n);if(!o)return[];let l=s.start.distance1(o),u=s.end.distance1(o),h=s.width/2;if(l>h&&u>h){let c=[],f=s.inShape(n.start.x,n.start.y),d=s.inShape(n.end.x,n.end.y),p;if(f)p=n.end.sub(n.start).normalize();else if(d)p=n.start.sub(n.end).normalize();else return[];let m=this.getLine(n),g=this.getLine(s),x=this.getInters(m,g),y;if(x.length===1)y=x[0];else{let le=m.end().sub(m.start()).normalize();if(m=new S(m.start().sub(le.mul(s.width)),m.end().add(le.mul(s.width))),x=this.getInters(m,g),x.length===1)y=x[0];else return[]}let P=new b(-p.y,p.x),w=s.end.sub(s.start).normalize().dot(P),C,T;w>0?(C=s.start,T=s.end):(C=s.end,T=s.start);let{globalIndex:M,layerId:E,end:W,start:k,width:O,locked:se,net:Y}=s,$=ut.build(M,E,y,T,O,se,Y),ae=ut.build(M,E,y,C,O,se,Y);return c=[{tracks:[n,$],width:r,height:i},{tracks:[$,ae],width:r,height:i},{tracks:[ae,n],width:r,height:i}],c}else return t}translationLine(t,e,r){if(t instanceof S){let i=r.mul(e);return new S(t.start().add(i),t.end().add(i))}else{let i=t.rx;return i<=e?null:R.build2(t.center,t.startAngle,t.endAngle(),i-e,i-e,t.sweep())}}mulGroupRouting(t){let e,r=[],i=[];if(t.forEach(n=>{let{tracks:s,width:o,height:l,point:u}=n,[h,c]=s,f=this.getLine(h),d=c.inShape(h.start.x,h.start.y),p=c.inShape(h.end.x,h.end.y),m;if(d)m=h.end.sub(h.start).normalize();else if(p)m=h.start.sub(h.end).normalize();else return;let g=new b(-m.y,m.x),x=vt.foot(f,u),y=d?h.end:h.start,P=x.distance1(y);l=Math.min(P,l);let L=u.add(m.mul(l)),w=L.sub(g.mul(h.width/2)),C=L.add(g.mul(h.width/2));if(c.inShape(w.x,w.y)||c.inShape(C.x,C.y))return;let T=new b(-m.x,-m.y);w!=null&&C!=null&&(this.tearShape==="line"?r.push({left:w,right:C,direct:T,point:u}):i.push({left:w,right:C,direct:T,point:u}))}),r.length>1){let n=[],s=r[0].right;for(let o=0;o<r.length;o++){let l=o+1>r.length-1?0:o+1,u=r[o],h=r[l],{left:c,right:f,direct:d,point:p}=u,{left:m,right:g,direct:x,point:y}=h,P=d.dot(x);if(N.eq(P,1)||N.eq(P,-1)){n.push(c);let E=g.sub(c).normalize().dot(x);N.eq(E,1)||N.eq(E,-1)||n.push(p),s=g;continue}let L=new b(d.y,-d.x).normalize(),w=new b(-x.x,-x.y),C=L.dot(w);J.toDegrees(Math.acos(C))>90?n.push(c,f,p):s?(s.equals1(c)?n.push(c):s.equals1(f)&&n.push(f),s=null):n.push(c,f)}e=B.build4(n).asClose()}else if(i.length){let n=[],s=i[0].right;for(let l=0;l<i.length;l++){let u=l+1>i.length-1?0:l+1,h=i[l],c=i[u],{left:f,right:d,direct:p,point:m}=h,{left:g,right:x,direct:y,point:P}=c,L=p.dot(y);if(N.eq(L,1)||N.eq(L,-1)){let W=x.sub(f).normalize().dot(y);if(!(N.eq(W,1)||N.eq(W,-1))){let k=new S(f,m),O=new S(m,x);n.push(k,O)}s=x;continue}let w=new b(p.y,-p.x).normalize(),C=new b(-y.x,-y.y),T=w.dot(C);if(J.toDegrees(Math.acos(T))>90){let E=new S(f,d),W=new S(d,m),k=new S(m,g);n.push(E,W,k)}else if(s){if(s.equals1(f)){let E=new S(f,d);n.push(E)}else if(s.equals1(d)){let E=this.getLimit(d,p,g,y),W=[d,d.add(p.mul(E[0])),g.add(y.mul(E[1])),g],k=this.getBezier(W);n.push(k)}s=null}else{let E=new S(f,d),W=this.getLimit(d,p,g,y),k=[d,d.add(p.mul(W[0])),g.add(y.mul(W[1])),g],O=this.getBezier(k);n.push(E,O)}}let o=[];B.build2(n).points(.1,l=>{o.push(l)}),o.length&&(e=B.build4(o).asClose())}return e&&Un([e.primitives])?null:e}dispathTConnection(t,e,r,i){let n=[],s=this.calculateTConnection(t,e,r,i);return s&&n.push(s),n.length?n:null}calculateTConnection(t,e,r,i){let n,{verticalTrack:s}=e,o=s[0],l=s[1],u=o.width;if(o.start.equals(l.start))n=new S(o.end,l.end);else if(o.start.equals(l.end))n=new S(l.start,o.end);else if(o.end.equals(l.start))n=new S(o.start,l.end);else if(o.end.equals(l.end))n=new S(o.start,l.start);else return null;let h=this.getLine(t),c=this.getTrackIntersPoint(o,t);if(!c)return;let f=vt.foot(n,c),d,p,m;f.distance1(t.start)<f.distance1(t.end)?(d=!0,p=t.start,m=t.end):(d=!1,p=t.end,m=t.start);let g=m.sub(p).normalize(),x=new b(-g.y,g.x),y=f.add(g.mul(u/2)),P,L,w=o.start.distance1(f)<o.end.distance1(f)?o.end.sub(o.start).normalize():o.start.sub(o.end).normalize(),C=l.start.distance1(f)<l.end.distance1(f)?l.end.sub(l.start).normalize():l.start.sub(l.end).normalize(),T=x.dot(w),M=x.dot(C);if(N.eq(T,1)&&N.eq(M,-1))L=o,P=l;else if(N.eq(M,1)&&N.eq(T,-1))L=l,P=o;else return null;let E=P.start.distance1(P.end),W=E>r/2?r/2:E,k=L.start.distance1(L.end),O=k>r/2?r/2:k;if(W<=t.width/2&&O<=t.width/2)return null;let se=y.sub(x.mul(W)),Y=y.add(x.mul(O)),ae=p.distance1(m)>i?y.add(g.mul(i)):m,le=ae.sub(x.mul(t.width/2)),ge=ae.add(x.mul(t.width/2));if(Y&&se&&le&&ge)if(this.tearShape==="line"){let Me=B.build4([se,le,ge,Y]).asClose();return Me&&Un([Me.primitives])?null:Me}else{let Me=this.getLeft(h,t.width,d),Je=this.getRight(h,t.width,d);if(!Me||!Je)return null;let Dt,rt;d?(Dt=Me.start().sub(Me.end()),rt=Je.start().sub(Je.end())):(Dt=Me.end().sub(Me.start()),rt=Je.end().sub(Je.start()));let Wt=new S(ge,le),kr=this.getArc(Dt,le,se,!1),oe=new S(se,Y),ne=Fu(this.getArc(rt,ge,Y,!1)),pe=B.build2([Wt,kr,oe,ne]).asClose();return pe&&Un([pe.primitives])?null:pe}else return null}getTrackIntersPoint(t,e){let r=this.getLine(t),i=this.getLine(e),n=this.getInters(r,i),s;if(n.length===1)s=n[0];else return this.getShapePoint(t,e);return s}getShapePoint(t,e){let r=this.getLine(e),i,n=this.getPoints(t.getMathGraphics(e.layerId,0),r);if(n.length===1)i=n[0];else if(n.length===2&&n[0].equals(n[1]))i=n[0];else return;return i}dispatch(t,e,r,i,n){let s=this.isStart(e,t),o=this.isEnd(e,t),l=[];if(t!=null){if(!(s&&o))if(s||o){let u=this.calculate(t,e,r,i,s,n);u&&l.push(u)}else{let u=this.calculate(t,e,r,i,s,n);u&&l.push(u);let h=this.calculate(t,e,r,i,!s,n);h&&l.push(h)}return l.length?l:null}return null}calculate(t,e,r,i,n,s){let o=this.calculate4Points(t,e,r,i,n);if(o){let{topLeft:l,topRight:u,bottomLeft:h,bottomRight:c}=o;if(l!=null&&u!=null&&h!=null&&c!=null)if(this.tearShape==="line"){let f=B.build4([l,h,c,u]).asClose();return f&&Un([f.primitives])?null:f}else{let f=this.getLine(e),d=n?f.start():f.end(),p=f instanceof S?vt.foot(f,u).distance1(d):e.center,m=f instanceof S?vt.foot(f,c).distance1(d):e.center;if(p<m)return null;let g=f instanceof S?vt.foot(f,l).distance1(d):e.center,x=f instanceof S?vt.foot(f,h).distance1(d):e.center;return g<x?null:s&&s==="OVAL"?this.calculateOval(t,o,n):this.calculatePolygon(o,n)}else return null}else return null}calculate4Points(t,e,r,i,n){let s=this.getLine(e),o=this.getLeft(s,r,n),l=this.getRight(s,r,n),u=this.getLeft(s,e.width,n),h=this.getRight(s,e.width,n),c=new Array,f=new Array,d=new Array,p=new Array;o!=null&&(c=this.getPoints(t,o)),l!=null&&(f=this.getPoints(t,l)),u!=null&&(d=this.getPoints(t,u)),h!=null&&(p=this.getPoints(t,h));let m,g;if(d.length==0)return null;if(d.length==1&&(m=d[0]),d.length>1){let w=e.start,C=e.end,T=new S(w,C),M=da(d,T);n?m=M[M.length-1]:m=M[0]}if(p.length==0)return null;if(p.length==1&&(g=p[0]),p.length>1){let w=e.start,C=e.end,T=new S(w,C),M=da(p,T);n?g=M[M.length-1]:g=M[0]}let x,y;m!=null&&g!=null&&(x=this.getPoint4Distance(u,m,i,n),y=this.getPoint4Distance(h,g,i,n)),c.length==0&&(c=this.intersBBox(t,r,!0,s,n),c.length==0&&c.push(m));let P;if(c.length==1)P=c[0];else if(c.length>1){let w=Number.MAX_VALUE;c.forEach(C=>{let T=C.distance1(m);T<=w&&(w=T,P=C)})}f.length==0&&(f=this.intersBBox(t,r,!1,s,n),f.length==0&&f.push(g));let L;if(f.length==1)L=f[0];else if(f.length>1){let w=Number.MAX_VALUE;f.forEach(C=>{let T=C.distance1(g);T<=w&&(w=T,L=C)})}return{topLeft:x,topRight:y,bottomLeft:P,bottomRight:L,right:h,left:u,isStart:n}}calculateOval(t,e,r){let{topLeft:i,topRight:n,bottomLeft:s,bottomRight:o,right:l,left:u}=e,h=this.getTopRightDirect(l,i,n,r),c=this.getTopLeftDirect(u,i,n,r),f=new S(i,n),d,p,m=new an;t.primitives.forEach(k=>{m.inEdge(s,k)&&(d=k),m.inEdge(o,k)&&(p=k)});let g=this.getBottomLeftDirect(d,s,o),x=this.getBottomRightDirect(p,s,o),y=this.getLimit(n,h,o,x),P=[n,n.add(h.mul(y[0])),o.add(x.mul(y[1])),o],L=this.getBezier(P),w=new S(o,s),C=this.getLimit(s,g,i,c),T=[s,s.add(g.mul(C[0])),i.add(c.mul(C[1])),i],M=this.getBezier(T),E=[];return B.build2([f,L,w,M]).points(.1,k=>{E.push(k)}),B.build4(E)}calculatePolygon(t,e){let{topLeft:r,topRight:i,bottomLeft:n,bottomRight:s,right:o,left:l}=t,u=this.getTopRightDirect(o,r,i,e),h=this.getTopLeftDirect(l,r,i,e),c=new S(r,i),f=this.getArc(u,i,s,!1),d=new S(s,n),p=Fu(this.getArc(h,r,n,!1)),m=B.build2([c,f,d,p]).asClose();return m&&Un([m.primitives])?null:m}getTopRightDirect(t,e,r,i){let n;if(i){if(t instanceof S)n=t.start().sub(t.end()).normalize();else if(t instanceof R){let s=t.center.sub(r).normalize(),o=e.sub(r).normalize();s.dot(o)>=0?n=new b(s.y,-s.x):n=new b(-s.y,s.x)}}else if(t instanceof S)n=t.end().sub(t.start()).normalize();else if(t instanceof R){let s=t.center.sub(r).normalize(),o=e.sub(r).normalize();s.dot(o)>=0?n=new b(s.y,-s.x):n=new b(-s.y,s.x)}return n}getTopLeftDirect(t,e,r,i){let n;if(i){if(t instanceof S)n=t.start().sub(t.end()).normalize();else if(t instanceof R){let s=t.center.sub(e).normalize(),o=r.sub(e).normalize();s.dot(o)>=0?n=new b(-s.y,s.x):n=new b(s.y,-s.x)}}else if(t instanceof S)n=t.end().sub(t.start()).normalize();else if(t instanceof R){let s=t.center.sub(e).normalize(),o=r.sub(e).normalize();s.dot(o)>=0?n=new b(-s.y,s.x):n=new b(s.y,-s.x)}return n}getBottomLeftDirect(t,e,r){let i;if(t instanceof S){let n=t.end().sub(t.start()).normalize(),s=t.start().sub(t.end()).normalize(),o=r.sub(e).normalize();if(n.dot(o)>0)i=n;else if(s.dot(o)>0)i=s;else if(N.eq(n.dot(o),0)&&N.eq(s.dot(o),0))i=new b(o.y,-o.x);else return null}else if(t instanceof R){let n=t.center.sub(e).normalize();i=new b(n.y,-n.x)}return i}getBottomRightDirect(t,e,r){let i;if(t instanceof S){let n=t.end().sub(t.start()).normalize(),s=t.start().sub(t.end()).normalize(),o=e.sub(r).normalize();if(n.dot(o)>0)i=n;else if(s.dot(o)>0)i=s;else if(N.eq(n.dot(o),0)&&N.eq(s.dot(o),0))i=new b(-o.y,o.x);else return null}else if(t instanceof R){let n=t.center.sub(r).normalize();i=new b(-n.y,n.x)}return i}dispatchArc(t,e,r,i){let n=this.isStart(e,t),s=this.isEnd(e,t),o=[];if(t!=null&&t.primitives[0]instanceof R){if(!(n&&s))if(n||s){let l=this.calculateCircle(t.primitives[0],e,r,i,n);l&&o.push(l)}else{let l=this.calculateCircle(t.primitives[0],e,r,i,n,!0);l&&o.push(l);let u=this.calculateCircle(t.primitives[0],e,r,i,!n,!0);u&&o.push(u)}return o.length?o:null}return null}calculateCircle(t,e,r,i,n,s=!1){let o=this.getLine(e),l=this.getInters(t,o),u,h;if(l.length===1){u=l[0];let E=e.start,W=e.end;n?h=W.sub(u).normalize():h=E.sub(u).normalize()}else if(l.length>1){let E=e.start,W=e.end,k=new S(E,W),O=da(l,k);n?(u=O[0],h=E.sub(u).normalize()):(u=O[O.length-1],h=W.sub(u).normalize())}else return null;h=o instanceof S?h:u.sub(t.center).normalize();let c=o instanceof S?vt.foot(o,t.center):t.center,f=Math.sqrt(t.rx2-r*r/4),d=new b(-h.y,h.x),p=c.add(h.mul(f)),m=new S(p.sub(d.mul(100)),p.add(d.mul(100))),g=p.add(h.mul(i)),x=new S(g.sub(d.mul(100)),g.add(d.mul(100))),y=this.getInters(t,m),P=this.getLeft(o,e.width,n),L=new Array;if(P!=null)L=this.getInters(P,x);else return null;let w=this.getRight(o,e.width,n),C=new Array;if(w!=null)C=this.getInters(w,x);else return null;if(L.length==0&&(s?n?L.push(P.start()):L.push(P.end()):n?L.push(P.end()):L.push(P.start())),L.length==0)return null;let T;if(L.length==1)T=L[0];else if(L.length>1){let E=e.start,W=e.end,k=new S(E,W),O=da(L,k);n?T=O[0]:T=O[O.length-1]}if(C.length==0&&(s?n?C.push(w.start()):C.push(w.end()):n?C.push(w.end()):C.push(w.start())),C.length==0)return null;let M;if(C.length==1)M=C[0];else if(C.length>1){let E=e.start,W=e.end,k=new S(E,W),O=da(C,k);n?M=O[0]:M=O[O.length-1]}if(T!=null&&M!=null&&y.length==2){let E=y[1].sub(y[0]).normalize(),W=M.sub(T).normalize();if(E.dot(W)>0?(y.push(M),y.push(T)):(y.push(T),y.push(M)),y[0].distance2(y[1])<=T.distance2(M))return null;if(this.tearShape==="line")return B.build4(y).asClose();{let[O,se,Y,$]=y,ae=new b(-h.x,-h.y),le=t.center.sub(se),ge=t.center.sub(O),Me=new b(-le.y,le.x).normalize(),Je=new b(ge.y,-ge.x).normalize(),Dt=new S($,Y),rt=this.getLimit(Y,ae,se,Me),Wt=[Y,Y.add(ae.mul(rt[0])),se.add(Me.mul(rt[1])),se],kr=this.getBezier(Wt),oe=new S(se,O),ne=this.getLimit(O,Je,$,ae),pe=[O,O.add(Je.mul(ne[0])),$.add(ae.mul(ne[1])),$],Ce=this.getBezier(pe),Oe=[];B.build2([Dt,kr,oe,Ce]).points(.1,je=>{Oe.push(je)});let We=B.build4(Oe);return We&&Un([We.primitives])?null:We}}else return null}getLimit(t,e,r,i){let n=new S(t.sub(e.mul(1e4)),t.add(e.mul(1e4))),s=new S(r.sub(i.mul(1e4)),r.add(i.mul(1e4))),o=this.getInters(n,s);if(o.length>0){let l=o[0],u=t.distance1(r)/2;if(l.sub(t).dot(e)<0||l.sub(r).dot(i)<0){let h=t.distance1(o[0])/4,c=r.distance1(o[0])/4,f=Math.min(u,Math.max(h,c,.1));return[f,f]}else{let h=t.distance1(o[0])/2,c=r.distance1(o[0])/2,f=Math.min(u,Math.max(h,c,.1));return[f,f]}}else return[.1,.1]}getBezier(t){return new we(t)}getArc(t,e,r,i=!0){let n=new li,{center:s,radius:o,startAngle:l,endAngle:u,sweep:h}=n.tangentToArc(t,e,r,i);return R.build2(s,J.toDegrees(l),J.toDegrees(u),o,o,h)}isStart(t,e){let r=t.start;return wt.inPolyline(r,e)}isEnd(t,e){let r=t.end;return wt.inPolyline(r,e)}getLine(t){let e;return t instanceof Er?e=t.primitive:e=new S(t.start,t.end),e}getPoints(t,e){let r=new Array;return e&&t.primitives.forEach(i=>{this.getInters(i,e).forEach(s=>{r.push(s)})}),r}getInters(t,e){let r=new Array,i=Xe(t,e);if(i>0)for(let n=0;n<i;n+=2){let s=new b(U[n],U[n+1]);r.push(s)}return r}getLeft(t,e,r){if(e=e/2,t instanceof S){let i=t.end().sub(t.start()).normalize(),n;return r?n=new b(i.y,-i.x).mul(e):n=new b(-i.y,i.x).mul(e),new S(t.start().add(n),t.end().add(n))}else{let{start:i,direct:n}=this.getArcRightDirect(t,r),s=i.sub(n.mul(e)),o=t.center.distance1(s);return o?R.build2(t.center,t.startAngle,t.endAngle(),o,o,t.sweep()):null}}getRight(t,e,r){if(e=e/2,t instanceof S){let i=t.end().sub(t.start()).normalize(),n;return r?n=new b(-i.y,i.x).mul(e):n=new b(i.y,-i.x).mul(e),new S(t.start().add(n),t.end().add(n))}else{let{start:i,direct:n}=this.getArcRightDirect(t,r),s=i.add(n.mul(e)),o=t.center.distance1(s);return o?R.build2(t.center,t.startAngle,t.endAngle(),o,o,t.sweep()):null}}getArcRightDirect(t,e){let r,i,n;return e?(r=t.start(),n=t.sweep()):(r=t.end(),n=t.sweep()===1?0:1),n===0?(i=t.center.sub(r).normalize(),i=new b(-i.x,-i.y)):i=t.center.sub(r).normalize(),{start:r,direct:i}}getPoint4Distance(t,e,r,i){if(t instanceof S){let n=t.end().sub(t.start()).normalize();return i?e.distance1(t.end())>r?e.add(n.mul(r)):t.end():e.distance1(t.start())>r?e.add(n.mul(-r)):t.start()}else{let n=Math.abs(r/t.rx),s=e.sub(t.center).normalize(),o=Math.atan2(s.y,s.x),l;i?t.sweep()==1?l=o+n:l=o-n:t.sweep()==1?l=o-n:l=o+n,l=(l%Z+Z)%Z/Math.PI*180;let u=t.pointOn(l);return Ut(t,u)?u:i?t.end():t.start()}}intersBBox(t,e,r,i,n){let s=this.getLimitPoints(t,r,i,n);return s.length==0&&(s=this.interPoints(t,e,e/2,r,i,0,n)),s}getLimitPoints(t,e,r,i){let n=new Array;t.primitives.forEach(o=>{this.getInters(o,r).length>0&&(n.push(o.start()),n.push(o.end()))});let s=null;if(e){if(r instanceof S){let o=0,l=r.end().sub(r.start()).normalize(),u;i?u=new b(l.y,-l.x):u=new b(-l.y,l.x),n.forEach(h=>{let c=vt.foot(r,h),f=h.sub(c);l.cross(f)>0&&u.dot(f)>0&&f.length()>o&&(s=h,o=f.length())})}else if(r instanceof R){let{direct:o,start:l}=this.getArcRightDirect(r,i),u;n.forEach(h=>{let c=h.sub(l).normalize(),f=h.sub(r.center).length();c.dot(o)<0&&(!u||f<u)&&(s=h,u=f)})}}else if(r instanceof S){let o=0,l=r.end().sub(r.start()).normalize(),u;i?u=new b(-l.y,l.x):u=new b(l.y,-l.x),n.forEach(h=>{let c=vt.foot(r,h),f=h.sub(c);l.cross(f)<0&&u.dot(f)>0&&f.length()>o&&(s=h,o=f.length())})}else if(r instanceof R){let{direct:o,start:l}=this.getArcRightDirect(r,i),u;n.forEach(h=>{let c=h.sub(l).normalize(),f=h.sub(r.center).length();c.dot(o)>0&&(!u||f<u)&&(s=h,u=f)})}return s==null?[]:[s]}interPoints(t,e,r,i,n,s,o){let l;i?l=this.getLeft(n,e,o):l=this.getRight(n,e,o);let u=this.getPoints(t,l);if(s<6)if(u.length==0)u=this.interPoints(t,e/2,r/2,i,n,s+1,o);else{let h=this.interPoints(t,e+r,r/2,i,n,s+1,o);h.length>0&&(u=h)}return u}updateProgress(t=!1){self.workerBus!=null&&!this.hideProgress&&(t?self.workerBus.publish("progressUpdate",{ratio:1,descripte:"add tear drop"}):(this.ratio+=this.delta,self.workerBus.publish("progressUpdate",{ratio:this.ratio,descripte:"add tear drop"})))}};var lu=Kf(Fc()),zi=new lu.MessageBus(!0),hr=new lu.WorkerMessageBridge(zi,self);self.workerBus=hr,zi.subscribe("workerName",a=>{self.workerName=a}),zi.subscribe("setPourUseWebService",()=>{self.POUR_USE_WEB_SERVICE=!0}),zi.subscribe("pourDocument",a=>{Uc(a)}),zi.subscribe("planeDocument",a=>{Kc(a)}),zi.subscribe("DRCDocument",a=>{let t=JSON.parse(a),e=t.shapes,r=t.ids,i=t.maxClearance,n=new ws(e),s=new Ls(i,n),o=new Array;for(let u of r){let h=n.getShape(u);h!=null&&o.push(h)}s.check(o);let l={};l.drc=s.getResult(),self.workerName!=null&&(l.workerName=self.workerName),hr.publish("DRCResult",l)}),zi.subscribe("addTearInWorker",a=>{let e=new za(a).addTearDrop(),r=a;r.tears=e,self.workerName!=null&&(r.workerName=self.workerName),hr.publish("tearDropResult",r)}),zi.rpcService("DRC",a=>{let t=JSON.parse(a),e=t.shapes,r=t.ids,i=t.maxClearance,n=t.drcCustomSetting,s=new ws(e),o=new Ls(i,s,!1,n),l=new Array;for(let h of r){let c=s.getShape(h);c!=null&&l.push(c)}o.check(l);let u={};return u.drc=o.getResult(),self.workerName!=null&&(u.workerName=self.workerName),u}),zi.rpcService("SutureViaDrc",a=>{let t=JSON.parse(a),e=t.shapes,r=t.ids,i=t.maxClearance,n=t.checkSameNet,s=t.layer,o=new I(Ee(s.type),s.order),l=Ne(t.profile),u=new ws(e),h=new Ls(i,u,n),c=new Array,f="";for(let k of r){let O=u.getShape(k);O!=null&&(c.push(O),f=O.net)}let d=new ot(1),p=new Array,m=u.getOutline();if(m.length){let k=new Array,O=new H;if(m.forEach(se=>{O.ext1(se.bbox());let Y=se.shape(se.layer,0);k.push(...Y.primitives)}),O.valid()){let Y=new hi(O.build(),2,.1,d,k).detect().items;Y=Y.filter($=>new q($,l,0).relation!==3),Y.length&&(c=c.filter($=>{let ae=!1;for(let le of Y)if(wt.pointInPolyline($.center,le)){ae=!0;break}return ae||p.push($.id),ae}))}}h.check(c,!0);let g={},x=h.getResult(),y=x.plane,P=x.copper,L=x.safe,w=new Array,C=new Array,T=new Array,M=new Set;for(let k of P){let O=k.id1,se=k.id2,Y=u.getShape(O),$=u.getShape(se);if(Y.net==$.net){if(Y instanceof Ct&&k.relation!=3&&Y.layer.equals(o)){let ae=Y.outlines,le=$.shape(Y.layer,0);if(new Sr(new ee(ae),le,0).relation==0)continue;M.add(se)}else if($ instanceof Ct&&k.relation!=3&&Y.layer.equals(o)){let ae=$.outlines,le=Y.shape($.layer,0);if(new Sr(new ee(ae),le,0).relation==0)continue;M.add(O)}}else{if(Y instanceof Ct&&k.relation!=3&&Y.layer.equals(o)){let ae=Y.outlines,le=$.shape(Y.layer,0);if(new Sr(new ee(ae),le,0).relation==0)continue}else if($ instanceof Ct&&k.relation!=3&&Y.layer.equals(o)){let ae=$.outlines,le=Y.shape($.layer,0);if(new Sr(new ee(ae),le,0).relation==0)continue}C.push(k)}}for(let k of y){let O=k.id1,se=k.id2,Y=u.getShape(O),$=u.getShape(se);if(Y.net==$.net){if(Y instanceof Tt&&k.relation!=3&&Y.layer.equals(o)){let ae=Y.outlines,le=$.shape(Y.layer,0);if(new Sr(new ee(ae),le,0).relation==0)continue;M.add(se)}else if($ instanceof Tt&&k.relation!=3&&Y.layer.equals(o)){let ae=$.outlines,le=Y.shape($.layer,0);if(new Sr(new ee(ae),le,0).relation==0)continue;M.add(O)}}else{if(Y instanceof Tt&&k.relation!=3&&Y.layer.equals(o)){let ae=Y.outlines,le=$.shape(Y.layer,0);if(new Sr(new ee(ae),le,0).relation==0)continue}else if($ instanceof Tt&&k.relation!=3&&Y.layer.equals(o)){let ae=$.outlines,le=Y.shape($.layer,0);if(new Sr(new ee(ae),le,0).relation==0)continue}w.push(k)}}for(let k of L){let O=k.id1,se=k.id2,Y=u.getShape(O),$=u.getShape(se);Y.net==$.net?(Y instanceof he||Y instanceof ue&&$ instanceof ue||Y instanceof ce||$ instanceof he||Y instanceof ue&&$ instanceof ue||$ instanceof ce)&&T.push(k):T.push(k)}for(let k of r)!M.has(k)&&!p.includes(k)&&p.push(k);let E=!1,W=u.getItems(o,l.bbox());for(let k of W)if((k instanceof Ct||k instanceof Tt)&&k.net==f){E=!0;break}return x.plane=w,x.copper=C,x.safe=T,g.drc=x,g.filterIds=p,g.hasSameNetCoppers=E,self.workerName!=null&&(g.workerName=self.workerName),g});})();
//# sourceMappingURL=https://modules.lceda.cn/pro-pcb/2.1.59.2028e8da/js/worker.js.map
